<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="addtopath function doesnt add all_users"><title>addtopath function doesnt add all_users - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">addtopath function doesnt add all_users</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=257963">addtopath function doesnt add all_users</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">jweinraub</span><br><span class="post-time small text-muted">20th October 2006 17:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>addtopath function doesnt add all_users</strong><br>I made a booboo on my last installer than overwrote the allusers path so i need to make a patch for my future installer. so i only want to add it to the path if it isn't in there, that way it wont add multiple strings of it.<br><br>i want to add it to: HKEY_LOCAL_MACHINE "SYSTEM\CurrentControlSet\Control\Session Manager\Environment" "Path"<br><br>in the beginning of the code i do this:<br><br>!define ALL_USERS<br><br>!include "WinMessages.NSH"<br>!include "AddToPath.nsh"<br><br><br>later on i do this:<br><br>Push "%SystemRoot%\System32\WBEM"<br>Call AddToPath<br><br>it doesn't add it into the environment variables.<br><br>what am i doing wrong?<br>would this check automatically if it isnt in the path already or do i need to use StrStr to search?<br><br>thanks<br><br>also when the program gets uninstalled i still want to keep the path change present as i overwrote a system path that is required by winders.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">20th October 2006 17:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">AddToPath checks if the path exists at all and if it already exists in the user's PATH variable. If the folder doesn't exist, or already present in PATH, it won't do anything.<br><br>Nothing will be done in the uninstaller unless you call un.RemoveFromPath.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jweinraub</span><br><span class="post-time small text-muted">20th October 2006 17:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">okay...but i dont have "%SystemRoot%\System32\WBEM" in my path and it isnt being added.<br><br>i do have other entries in the path just not that.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">20th October 2006 17:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">%SystemRoot%\System32\WBEM is not a valid path, so it doesn't exist as far as AddToPath is concerned. You should use $SYSDIR or ExpandEnvStrings.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jweinraub</span><br><span class="post-time small text-muted">20th October 2006 17:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Oh Ho!!! Todah Rabah!!!!!!<br><br>But, i just re-ran the installer and now that string was added a second time so now i have two C:\windows\system32\wbem listed.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jweinraub</span><br><span class="post-time small text-muted">20th October 2006 20:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">any idea? i am unsure how to use StrStr to check if it is there already though.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jweinraub</span><br><span class="post-time small text-muted">20th October 2006 20:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">well i got around it doing it like this and it seems to work.<br><br>ReadRegStr $1 HKLM \<br>"SYSTEM\CurrentControlSet\Control\Session Manager\Environment" Path<br>Push $1<br>Push "wbem"<br>Call StrStr<br>Pop $R0<br><br>StrCmp $R0 "" true false<br><br>true:<br>; the item isnt here so add it now<br>Push "$sysdir\wbem"<br>Call AddToPath<br>Goto End<br><br>false:<br>;nothing to do today, hurray!<br>Goto End</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>