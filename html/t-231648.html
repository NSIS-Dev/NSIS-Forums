<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="[POSIX] [CVS] test failure - double free" />

  <title>[POSIX] [CVS] test failure - double free - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">[POSIX] [CVS] test failure - double free</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=231648">[POSIX] [CVS] test failure - double free</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pabs</span><br />
      <span class="post-time small text-muted">22nd November 2005 08:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>[POSIX] [CVS] test failure - double free</strong><br />
      I got the following failure with today's CVS. I'm not sure, but the test code is so simple that this makes me think this is a cppunit bug. Any ideas?</p>

      <blockquote>
        $ gdb build/release/tests/test<br />
        GNU gdb 6.3.90_20051119-debian<br />
        Copyright 2004 Free Software Foundation, Inc.<br />
        GDB is free software, covered by the GNU General Public License, and you are<br />
        welcome to change it and/or distribute copies of it under certain conditions.<br />
        Type "show copying" to see the conditions.<br />
        There is absolutely no warranty for GDB. Type "show warranty" for details.<br />
        This GDB was configured as "i486-linux-gnu"...Using host libthread_db library "/lib/tls/libthread_db.so.1".<br />
        <br />
        (gdb) run<br />
        Starting program: /home/pabs/devel/debian/misc/nsis/NSIS/build/release/tests/test<br />
        *** glibc detected *** free(): invalid pointer: 0x08059388 ***<br />
        <br />
        Program received signal SIGABRT, Aborted.<br />
        0xb7cb47a7 in raise () from /lib/tls/libc.so.6<br />
        (gdb) bt<br />
        #0 0xb7cb47a7 in raise () from /lib/tls/libc.so.6<br />
        #1 0xb7cb604b in abort () from /lib/tls/libc.so.6<br />
        #2 0xb7ceb005 in __fsetlocking () from /lib/tls/libc.so.6<br />
        #3 0xb7cf1657 in malloc_usable_size () from /lib/tls/libc.so.6<br />
        #4 0xb7cf1af2 in free () from /lib/tls/libc.so.6<br />
        #5 0xb7e9e7c1 in operator delete () from /usr/lib/libstdc++.so.6<br />
        #6 0x0804bfe3 in __gnu_cxx::new_allocator&lt;std::string*&gt;::deallocate (this=0xbfb60607, __p=0x8059388) at new_allocator.h:94<br />
        #7 0x0804c124 in std::_Deque_base&lt;std::string, std::allocator&lt;std::string&gt; &gt;::_M_deallocate_map (this=0xbfb60684, __p=0x8059388, __n=8) at stl_deque.h:411<br />
        #8 0x0804c17e in ~_Deque_base (this=0xbfb60684) at stl_deque.h:430<br />
        #9 0xb7f03ec3 in CppUnit::TestPath::TestPath () from /usr/lib/libcppunit-1.10.so.2<br />
        #10 0xb7efb433 in CppUnit::Test::resolveTestPath () from /usr/lib/libcppunit-1.10.so.2<br />
        #11 0xb7f0fe5c in CppUnit::TestRunner::run () from /usr/lib/libcppunit-1.10.so.2<br />
        #12 0xb7f1511b in CppUnit::TextTestRunner::run () from /usr/lib/libcppunit-1.10.so.2<br />
        #13 0x0805069b in main (argc=1, argv=0xbfb608f4) at Source/Tests/textrunner.cpp:18
      </blockquote>I got this with vanilla CVS and with the POSIX install patch (new version soon).
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">22nd November 2005 19:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">All of the stack entries are outside of the tests code. Did it even reach some of test code?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pabs</span><br />
      <span class="post-time small text-muted">23rd November 2005 08:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Correct, the tests are not being called. I wonder if this is a toolchain issue perhaps - symbol naming change or something. Any suggestions for tracking down why the tests are not called?<br />
      <br />
      Edit: it probably has something to do with this: <a href="http://bugs.debian.org/339158" target="_blank">http://bugs.debian.org/339158</a> (libstdc++ allocator change). There is a new version available for that, so I'll wait until that is available and try again.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pabs</span><br />
      <span class="post-time small text-muted">23rd November 2005 10:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">On another related issue, the endian test fails on m68k:</p>

      <blockquote>
        /build/buildd/nsis-2.11/build/release/tests/test<br />
        ..F..<br />
        <br />
        endian.cpp:31:Assertion<br />
        Test name: EndianTest::testFixEndian<br />
        equality assertion failed<br />
        - Expected: 2018915346 (0x78563412)<br />
        - Actual : 305419896 (0x12345678)<br />
        <br />
        Failures !!!<br />
        Run: 4 Failure total: 1 Failures: 1 Errors: 0<br />
        scons: *** [test-code] Error 1
      </blockquote>Full logs are available here:<br />
      <a href="http://experimental.debian.net/fetch.php?&amp;pkg=nsis&amp;ver=2.11-1&amp;arch=m68k&amp;stamp=1132413921&amp;file=log&amp;as=raw" target="_blank">http://experimental.debian.net/fetch...ile=log&amp;as=raw</a><br />
      <br />
      I don't have access to any m68k machines yet, but I might be able to get my sponsor to find the problem, or get access to one later. Looking at the code I don't understand why it fails.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pabs</span><br />
      <span class="post-time small text-muted">24th November 2005 02:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Explanation of the endianness problem: util.h wasn't detecting the endianness correctly when defining FIX_ENDIAN_INT32_INPLACE. On linux you detect this by including endian.h and testing if BYTE_ORDER == LITTLE_ENDIAN. I'm not sure how portable this is, so there is no proper patch yet. A quick grep reveals a few places test for __BIG_ENDIAN__, most of them are not relevant because they are in code that is compiled using the Win32 cross compiler.<br />
      <br />
      <a href="http://lists.debian.org/debian-68k/2005/11/msg00043.html" target="_blank">http://lists.debian.org/debian-68k/2.../msg00043.html</a><br />
      <a href="http://lists.debian.org/debian-68k/2005/11/msg00045.html" target="_blank">http://lists.debian.org/debian-68k/2.../msg00045.html</a><br />
      <br />
      Ugh, shouldn't have posted that question at 3am :/</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
