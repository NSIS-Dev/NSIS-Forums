<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="DeleteRegKey problem" />

  <title>DeleteRegKey problem - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">DeleteRegKey problem</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=271260">DeleteRegKey problem</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">selanac</span><br />
      <span class="post-time small text-muted">16th May 2007 18:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>DeleteRegKey problem</strong><br />
      I'm attempting to clean up previous installations detected in the config section. If detected I attempt to clean up a particular registry entry with:<br />
      <br />
      DeleteRegKey HKCU "Environment\E3ROOT"<br />
      <br />
      This fails and I don't know why. The entry does in fact exist, and I have admin priveleges. Is there a way to get more details on the cause of the error?<br />
      <br />
      Script:<br />
      <br />
      # Auto-generated by EclipseNSIS Script Wizard<br />
      # Apr 13, 2007 4:02:47 PM<br />
      <br />
      Name E3<br />
      <br />
      # Defines<br />
      !define REGKEY "SOFTWARE\$(^Name)"<br />
      !define VERSION 4.0<br />
      !define COMPANY UC<br />
      !define URL ""<br />
      <br />
      # MUI defines<br />
      !define MUI_ICON "${NSISDIR}\Contrib\Graphics\Icons\modern-install.ico"<br />
      !define MUI_FINISHPAGE_NOAUTOCLOSE<br />
      !define MUI_STARTMENUPAGE_REGISTRY_ROOT HKLM<br />
      !define MUI_STARTMENUPAGE_NODISABLE<br />
      !define MUI_STARTMENUPAGE_REGISTRY_KEY ${REGKEY}<br />
      !define MUI_STARTMENUPAGE_REGISTRY_VALUENAME StartMenuGroup<br />
      !define MUI_STARTMENUPAGE_DEFAULTFOLDER E3<br />
      !define MUI_UNICON "${NSISDIR}\Contrib\Graphics\Icons\modern-uninstall.ico"<br />
      !define MUI_UNFINISHPAGE_NOAUTOCLOSE<br />
      <br />
      # Included files<br />
      !include Sections.nsh<br />
      !include MUI.nsh<br />
      <br />
      # Variables<br />
      Var StartMenuGroup<br />
      <br />
      # Installer pages<br />
      !insertmacro MUI_PAGE_WELCOME<br />
      !insertmacro MUI_PAGE_DIRECTORY<br />
      !insertmacro MUI_PAGE_STARTMENU Application $StartMenuGroup<br />
      !insertmacro MUI_PAGE_INSTFILES<br />
      !insertmacro MUI_PAGE_FINISH<br />
      !insertmacro MUI_UNPAGE_CONFIRM<br />
      !insertmacro MUI_UNPAGE_INSTFILES<br />
      <br />
      # Installer languages<br />
      !insertmacro MUI_LANGUAGE English<br />
      <br />
      # Installer attributes<br />
      OutFile setup.exe<br />
      InstallDir $PROGRAMFILES\E3<br />
      CRCCheck on<br />
      XPStyle on<br />
      ShowInstDetails show<br />
      VIProductVersion 4.0.0.0<br />
      VIAddVersionKey ProductName E3<br />
      VIAddVersionKey ProductVersion "${VERSION}"<br />
      VIAddVersionKey CompanyName "${COMPANY}"<br />
      VIAddVersionKey FileVersion ""<br />
      VIAddVersionKey FileDescription ""<br />
      VIAddVersionKey LegalCopyright ""<br />
      InstallDirRegKey HKLM "${REGKEY}" Path<br />
      ShowUninstDetails show<br />
      <br />
      # Installer sections<br />
      Section -Main SEC0000<br />
      SetOutPath $INSTDIR\standalone<br />
      SetOverwrite on<br />
      File /r deploy\standalone\*<br />
      WriteRegStr HKLM "${REGKEY}\Components" Main 1<br />
      SectionEnd<br />
      <br />
      Section -post SEC0001<br />
      WriteRegStr HKLM "${REGKEY}" Path $INSTDIR<br />
      SetOutPath $INSTDIR<br />
      WriteUninstaller $INSTDIR\uninstall.exe<br />
      !insertmacro MUI_STARTMENU_WRITE_BEGIN Application<br />
      SetOutPath $SMPROGRAMS\$StartMenuGroup<br />
      CreateShortcut "$SMPROGRAMS\$StartMenuGroup\Uninstall $(^Name).lnk" $INSTDIR\uninstall.exe<br />
      !insertmacro MUI_STARTMENU_WRITE_END<br />
      WriteRegStr HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)" DisplayName "$(^Name)"<br />
      WriteRegStr HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)" DisplayVersion "${VERSION}"<br />
      WriteRegStr HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)" Publisher "${COMPANY}"<br />
      WriteRegStr HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)" DisplayIcon $INSTDIR\uninstall.exe<br />
      WriteRegStr HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)" UninstallString $INSTDIR\uninstall.exe<br />
      WriteRegDWORD HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)" NoModify 1<br />
      WriteRegDWORD HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)" NoRepair 1<br />
      SectionEnd<br />
      <br />
      Section -config SEC0002<br />
      SetOutPath $INSTDIR\standalone<br />
      CreateShortcut "$SMPROGRAMS\$StartMenuGroup\Case Manager .lnk" $INSTDIR\standalone\E3CaseManager.cmd<br />
      CreateShortcut "$SMPROGRAMS\$StartMenuGroup\Utility Window .lnk" $INSTDIR\standalone\E3UtilityWindow.cmd<br />
      CreateShortcut "$SMPROGRAMS\$StartMenuGroup\Admin Tool .lnk" $INSTDIR\standalone\E3AdminTool.cmd<br />
      SetOutPath $PROFILE\e3.config<br />
      IfFileExists $PROFILE\e3.config\e3commonPrefs.xml 0 +4<br />
      MessageBox MB_OK "Detected previous E3 installation... Cleaning up"<br />
      Delete $PROFILE\e3.config\e3commonPrefs.xml<br />
      DeleteRegKey HKCU "Environment\E3ROOT"<br />
      IfErrors 0 +2<br />
      MessageBox MB_OK "Error in DeleteRegKey"<br />
      ClearErrors<br />
      FileOpen $0 $PROFILE\e3.config\e3commonPrefs.xml w<br />
      FileWrite $0 '&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;$\n'<br />
      FileWrite $0 '&lt;!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd"&gt;$\n'<br />
      FileWrite $0 "&lt;properties&gt;$\n"<br />
      FileWrite $0 "&lt;comment&gt;E3 Common Preferences&lt;/comment&gt;$\n"<br />
      FileWrite $0 '&lt;entry key="E3Home"&gt;'<br />
      FileWrite $0 $INSTDIR<br />
      FileWrite $0 "\standalone"<br />
      FileWrite $0 "&lt;/entry&gt;$\n"<br />
      FileWrite $0 "&lt;/properties&gt;$\n"<br />
      FileClose $0<br />
      SectionEnd<br />
      <br />
      # Macro for selecting uninstaller sections<br />
      !macro SELECT_UNSECTION SECTION_NAME UNSECTION_ID<br />
      Push $R0<br />
      ReadRegStr $R0 HKLM "${REGKEY}\Components" "${SECTION_NAME}"<br />
      StrCmp $R0 1 0 next${UNSECTION_ID}<br />
      !insertmacro SelectSection "${UNSECTION_ID}"<br />
      GoTo done${UNSECTION_ID}<br />
      next${UNSECTION_ID}:<br />
      !insertmacro UnselectSection "${UNSECTION_ID}"<br />
      done${UNSECTION_ID}:<br />
      Pop $R0<br />
      !macroend<br />
      <br />
      # Uninstaller sections<br />
      Section /o un.Main UNSEC0000<br />
      RmDir /r /REBOOTOK $INSTDIR\standalone<br />
      DeleteRegValue HKLM "${REGKEY}\Components" Main<br />
      SectionEnd<br />
      <br />
      Section un.post UNSEC0001<br />
      DeleteRegKey HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)"<br />
      Delete /REBOOTOK "$SMPROGRAMS\$StartMenuGroup\Case Manager .lnk"<br />
      Delete /REBOOTOK "$SMPROGRAMS\$StartMenuGroup\Utility Window .lnk"<br />
      Delete /REBOOTOK "$SMPROGRAMS\$StartMenuGroup\Admin Tool .lnk"<br />
      Delete /REBOOTOK "$SMPROGRAMS\$StartMenuGroup\Uninstall $(^Name).lnk"<br />
      Delete /REBOOTOK $INSTDIR\uninstall.exe<br />
      Delete $PROFILE\e3.config\e3commonPrefs.xml<br />
      DeleteRegKey /ifempty HKCU "Environment\E3ROOT"<br />
      DeleteRegKey HKCU "Environment\MODTRAN_DATA"<br />
      DeleteRegKey HKCU "Environment\MODTRAN5_DATA"<br />
      DeleteRegValue HKLM "${REGKEY}" StartMenuGroup<br />
      DeleteRegValue HKLM "${REGKEY}" Path<br />
      DeleteRegKey /IfEmpty HKLM "${REGKEY}\Components"<br />
      DeleteRegKey /IfEmpty HKLM "${REGKEY}"<br />
      RmDir /REBOOTOK $SMPROGRAMS\$StartMenuGroup<br />
      RmDir /REBOOTOK $INSTDIR<br />
      SectionEnd<br />
      <br />
      # Installer functions<br />
      Function .onInit<br />
      InitPluginsDir<br />
      FunctionEnd<br />
      <br />
      <br />
      # Uninstaller functions<br />
      Function un.onInit<br />
      ReadRegStr $INSTDIR HKLM "${REGKEY}" Path<br />
      !insertmacro MUI_STARTMENU_GETFOLDER Application $StartMenuGroup<br />
      !insertmacro SELECT_UNSECTION Main ${UNSEC0000}<br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">16th May 2007 18:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Seems like E3ROOT is a value and not a key. You should use DeleteRegValue.</p>
      <pre>
<code>DeleteRegValue HKCU Environment E3ROOT</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">selanac</span><br />
      <span class="post-time small text-muted">16th May 2007 19:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">kichik,<br />
      Thanks alot, that was it. Pardon my ignorance, it's my first attempt with NSIS, chaulk it up to newbee-ism.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
