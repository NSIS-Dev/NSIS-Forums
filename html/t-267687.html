<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Another Custom Page question"><title>Another Custom Page question - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Another Custom Page question</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=267687">Another Custom Page question</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">is99</span><br><span class="post-time small text-muted">13th March 2007 11:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Another Custom Page question</strong><br>I know I can change the imahe at the header of the installer using someting like this:<br><br>!define MUI_HEADERIMAGE<br>!define MUI_HEADERIMAGE_BITMAP "..\Sources\top.bmp"<br><br><br>But this will change it in all the pages of the installer.<br><br>Is it possible to change it only for one custom page?<br><br>For exampele I can change the text in the header of a custom page using !insertmacro MUI_HEADER_TEXT in the function of this custom page, but can I also change the bitmap ?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">13th March 2007 13:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=158179" target="_blank">http://forums.winamp.com/showthread....hreadid=158179</a><br><br><a href="http://nsis.sourceforge.net/ModernUI_Mod_to_Display_Images_while_installing_files" target="_blank">http://nsis.sourceforge.net/ModernUI...stalling_files</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">is99</span><br><span class="post-time small text-muted">13th March 2007 14:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Actually I alredy sow this, but I think its a bit too complicated and not exaclty what I'm looking for.<br><br>NSIS supports changing HEADERIMAGE in all the pages, so isn\t there some more easy way to change the HEADERIMAGE only in one custom page and not in all the pages?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">13th March 2007 14:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">if you dig a bit on these, you'll get to the point you like to go, it is too close.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">is99</span><br><span class="post-time small text-muted">13th March 2007 14:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If you know I'm close and you know the answer why then not tell me it?<br>Why do I need to waist hours looking for it if you already know the answer ?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">13th March 2007 14:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, as you probably know, if I had a piece or code ready or even near ready, that'd be already posted here.<br>I'm just realizing that infos provided in above links, seem enough for someone who cares to start digging ;)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">13th March 2007 15:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, I'm in a good temper today, plus it was more easy than expected...<br></p><pre>
<code>!define LR_LOADFROMFILE     0x0010<br>!define LR_CREATEDIBSECTION 0x2000<br>!define IMAGE_BITMAP        0<br>!define sysLoadImage        "user32::LoadImageA(i, t, i, i, i, i) i"<br>!define IMG_CHANGE          "$PLUGINSDIR\win.bmp"<br>!define IMG_RESTORE         "$PLUGINSDIR\modern-header.bmp"<br>!define BMP_CTL             "1046"<br><br>!macro CHANGE_HEADER_IMG _IMAGE<br>  GetDlgItem $0 $HWNDPARENT ${BMP_CTL}<br>  System::Call '${sysLoadImage} (0, s, ${IMAGE_BITMAP}, 0, 0, ${LR_CREATEDIBSECTION}|${LR_LOADFROMFILE}) .r6' "${_IMAGE}"<br>  SendMessage $0 ${STM_SETIMAGE} ${IMAGE_BITMAP} $6<br>  ShowWindow  $HWNDPARENT ${SW_HIDE}<br>  ShowWindow  $HWNDPARENT ${SW_RESTORE}<br>!macroend<br><br>!include "mui.nsh"<br><br>!define MUI_HEADERIMAGE<br>!define MUI_HEADERIMAGE_BITMAP "${NSISDIR}\Contrib\Graphics\Header\orange.bmp"<br><br>!insertmacro MUI_PAGE_WELCOME<br>!insertmacro MUI_PAGE_LICENSE "${NSISDIR}\Docs\Modern UI\License.txt"<br>!insertmacro MUI_PAGE_COMPONENTS<br>Page Custom custcreate custleave<br>!insertmacro MUI_PAGE_DIRECTORY<br>!insertmacro MUI_PAGE_INSTFILES<br>!insertmacro MUI_PAGE_FINISH<br><br>!insertmacro MUI_LANGUAGE "English"<br><br>OutFile "Test.exe"<br>InstallDir "$EXEDIR"<br><br>Function custcreate<br>   !insertmacro CHANGE_HEADER_IMG "${IMG_CHANGE}"<br><br>   !insertmacro MUI_HEADER_TEXT "Custom Page" \<br>   "This page should show a different image"<br>   push $0<br>   InstallOptions::Dialog "$PLUGINSDIR\custom.ini"<br>   pop $0<br>   pop $0<br><br>   !insertmacro CHANGE_HEADER_IMG "${IMG_RESTORE}"<br>FunctionEnd<br><br>Function custleave<br>MessageBox MB_YESNO "Continue?" IDYES noabort<br>Abort<br>noabort:<br>FunctionEnd<br><br>Function .onInit<br>   InitPluginsDir<br>   File /oname=${IMG_CHANGE} "${NSISDIR}\Contrib\Graphics\Header\win.bmp"<br>   GetTempFileName $0<br>   Rename $0 "$PLUGINSDIR\custom.ini"<br><br>   WriteINIStr "$PLUGINSDIR\custom.ini" "settings" "numfields" "1"<br>   WriteINIStr "$PLUGINSDIR\custom.ini" "field 1" "type" "groupbox"<br>   WriteINIStr "$PLUGINSDIR\custom.ini" "field 1" "text" "I'm a GroupBox, or not..."<br>   WriteINIStr "$PLUGINSDIR\custom.ini" "field 1" "left" "10"<br>   WriteINIStr "$PLUGINSDIR\custom.ini" "field 1" "right" "-10"<br>   WriteINIStr "$PLUGINSDIR\custom.ini" "field 1" "top" "10"<br>   WriteINIStr "$PLUGINSDIR\custom.ini" "field 1" "bottom" "-10"<br>FunctionEnd<br><br>Section -<br><br>SectionEnd</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">is99</span><br>
      <span class="post-time small text-muted">13th March 2007 16:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes a good temper indeed.<br>
      <br>
      Thanks I will try it.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br>
      <span class="post-time small text-muted">13th March 2007 19:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Let me know if the code works as expected on a full installer environment,<br>
      I'd like to post an example at wiki to be accessible by everyone who might need it :)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">is99</span><br>
      <span class="post-time small text-muted">13th March 2007 20:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes it is working.<br>
      There is one small bug I still can't point when it exactly happends.<br>
      <br>
      Sometimes when the logo is changing, I mean when I go to the page where the logo is suppose to change the installer window "hides" behing one of the other open windows.<br>
      <br>
      I mean for example I have IE open on ful screen and then I run the installer, I see the Welcome screen, licnese ..... amd then when I hit next and suppose to see the page where the image suppose to change the setup windows "hides" behing IE window.<br>
      But the image is changing as it should.<br>
      <br>
      <br>
      I will try to check it on other PCs to see if its a bug in my PC or something general.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br>
      <span class="post-time small text-muted">13th March 2007 21:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This happens because I had to to use it in the script (hide/restore window) in order to refresh it and show the changed image.<br>
      I'll check further possibilities.<br>
      <br>
      EDIT:<br>
      Actually there's no need for hide/restore window!<br>
      This happened on my old tired pc in works!<br>
      Now in home everything works just fine!<br>
      You should remove the 2 lines of code inside the macro,<br>
      ShowWindow $HWNDPARENT ${SW_HIDE} -&gt; remove it<br>
      ShowWindow $HWNDPARENT ${SW_RESTORE} -&gt; remove it</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">is99</span><br>
      <span class="post-time small text-muted">13th March 2007 21:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok I will do it and also do more tests on more PCs and see if its ok and then let you know</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br>
      <span class="post-time small text-muted">13th March 2007 21:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Cool! thanks :)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">is99</span><br>
      <span class="post-time small text-muted">14th March 2007 09:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Without these two lines the code dosn't work :(<br>
      It shows the new bitmap for a second and then it just shows white space instead of the bitmap.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br>
      <span class="post-time small text-muted">14th March 2007 11:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Works just fine on 2 pc's I'm able to test right now (XP)</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>