<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Use the default Vista font?" />

  <title>Use the default Vista font? - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Use the default Vista font?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=285009">Use the default Vista font?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vbguy</span><br />
      <span class="post-time small text-muted">15th January 2008 02:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Use the default Vista font?</strong><br />
      Is there a chance that NSIS can be fixed to use the default font for the OS instead of "MS Shell Dlg" or "MS Shell Dlg 2" fonts. For instance the default on Vista is Segoe UI 9.75pt.<br />
      <br />
      The setting is stored in the Advanced Appearance dialog; the "Message Box Text".<br />
      <br />
      I did a bit of research and I found out that the only way you can retrieve the User's Font and Font size preferences (Vista and above) is by using the GetThemeFont API.<br />
      <br />
      (From: msdn2.microsoft.com/en-us/library/aa511282.aspx )<br />
      <br />
      And here's the MSDN page for the GetThemeFont API:<br />
      <br />
      msdn2.microsoft.com/en-us/library/bb759745(VS.85).aspx<br />
      <br />
      I know this will probably take a big code change, but the Font subtleties would be a nice thing to have in NSIS.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">15th January 2008 09:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">the problem afaik, is that not only is it a different font (if that was the only problem, MS Shell Dlg would have worked) it is also a different size, so you need a special set of dialog resources just for Vista (or tweak the resource in memory)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vbguy</span><br />
      <span class="post-time small text-muted">15th January 2008 15:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Anders</i><br />
        <b>the problem afaik, is that not only is it a different font (if that was the only problem, MS Shell Dlg would have worked) it is also a different size, so you need a special set of dialog resources just for Vista (or tweak the resource in memory)</b>
      </blockquote>Well, doesn't NSIS already do that on non-Vista systems? That is, isn't the the installer dialog (and all its children like buttons, etc.) dynamically resized based on the user's font selection and DPI selection?<br />
      <br />
      Because if it already does dynamically resize, then it's just a matter of reading in the user's font preference using the GetThemeFont API for Vista+ systems.<br />
      <br />
      If NSIS doesn't dynamically resize based on font size and DPI settings, then perhaps this is a bigger problem that needs to be addressed first.<br />
      <br />
      Though, this is easy for a backseat programmer to say. If I have some time I might start fiddling with the source to see if I can come up with anything.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">15th January 2008 16:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">MS Shell Dlg maps to MS Sans Serif on 9x/NT4 and Tahoma on 2k/XP. NSIS does not do any kind of font selection, its done by the dialog manager.<br />
      <br />
      NSIS dialog resources (like most) contain the line: FONT 8, "MS Shell Dlg"<br />
      this is part of the problem, Segoe must be used at 9pt and larger to look good. Dialog/control size is based on dialog units, and dialog units are based on the size of the current font. So, you can't change the font after the dialog has been created since its created with a 8pt font size.<br />
      <br />
      I don't know a good solution.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vbguy</span><br />
      <span class="post-time small text-muted">15th January 2008 19:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Anders</i><br />
        <b>MS Shell Dlg maps to MS Sans Serif on 9x/NT4 and Tahoma on 2k/XP. NSIS does not do any kind of font selection, its done by the dialog manager.<br />
        <br />
        NSIS dialog resources (like most) contain the line: FONT 8, "MS Shell Dlg"<br />
        this is part of the problem, Segoe must be used at 9pt and larger to look good. Dialog/control size is based on dialog units, and dialog units are based on the size of the current font. So, you can't change the font after the dialog has been created since its created with a 8pt font size.<br />
        <br />
        I don't know a good solution.</b>
      </blockquote>I've been looking around some in MSDN blogs and the MSDN library, and found that there isn't a silver bullet. There's no equivalent to "MS Shell Dlg" for Vista's Segoe UI, and if you hard code Segoe UI you lose pre-Vista OS's (i.e. a majority of the users).<br />
      <br />
      There's some interesting discussion here:<br />
      http://blogs.msdn.com/michkap/archive/2006/06/11/626100.aspx<br />
      <br />
      Is there a way to modify the dialog resource's font before it's loaded, that way all child controls inherit the set font? If that were possible, then the only other (mountainous) hurdle would be to scale the dialog size, buttons size, and text box sizes.<br />
      <br />
      It seems even the easy solutions are a lot of work. I'd forgotten how much a pain working with raw windows resource is. C# has softened me.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">17th January 2008 10:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There is: you have to set "MS Shell Dlg 2" in dialog resources. And for e.g. the MUI you can select a different modiyfied dialog resource, see somewhere in documentation.<br />
      <br />
      TIP:<br />
      Somtimes if you install fonts, the Windows fontcache get corrupted. Clear you fontcache on the machine you test your installer on.<br />
      <br />
      Best to test your script on a separate clean PC, where you know nothing is tweaked or otherwise broken.<br />
      <br />
      Give a sample script and I'll see what I can do...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">17th January 2008 11:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">AFAIK, MS Shell Dlg 2 does not translate into Segoe UI</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vbguy</span><br />
      <span class="post-time small text-muted">17th January 2008 15:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by onad</i><br />
        <b>There is: you have to set "MS Shell Dlg 2" in dialog resources. And for e.g. the MUI you can select a different modiyfied dialog resource, see somewhere in documentation.<br />
        <br />
        TIP:<br />
        Somtimes if you install fonts, the Windows fontcache get corrupted. Clear you fontcache on the machine you test your installer on.<br />
        <br />
        Best to test your script on a separate clean PC, where you know nothing is tweaked or otherwise broken.<br />
        <br />
        Give a sample script and I'll see what I can do...</b>
      </blockquote>I don't have a script, I was suggesting that maybe in a future version of NSIS the installer would automatically detect the user's selected font on Vista (and newer OS) and adjust the dialog accordingly.<br />
      <br />

      <blockquote>
        <i>Originally posted by Anders</i><br />
        <b>AFAIK, MS Shell Dlg 2 does not translate into Segoe UI</b>
      </blockquote>That's right, it doesn't. Nor does the original "MS Shell Dlg" pseudofont.
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
