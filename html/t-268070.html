<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="passing data from custom page drop down menu to a &quot;leave page&quot; with functions."><title>passing data from custom page drop down menu to a "leave page" with functions. - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">passing data from custom page drop down menu to a "leave page" with functions.</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=268070">passing data from custom page drop down menu to a "leave page" with functions.</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Zethris</span><br><span class="post-time small text-muted">19th March 2007 22:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>passing data from custom page drop down menu to a "leave page" with functions.</strong><br>As part of the setup process in the install script, right after the welcome page, is a custom InstallOptions .ini page with a drop down menu. This menu has ListItems with worded selections, and numbered ListValues related to the ListItems.<br><br>As I understand it, the ListValues is associated to an integer where ListItem 1 has a ListValue of 0 and ListItem 2 would have a ListValue of 1. Is this correct?<br><br>If so, what I would like to do is pass the ListValue selected by the ListItem through to the "leave page" which will use a ReplaceInFile function to write to a config.xml file that is put into the installation directory. It will modify a special URL with the ListValue number in the part where ReplaceInFile sees _ID_ or something to that effect.<br><br>To be more descriptive at the risk of sounding redundant:<br><br>What I need to do is have a user who is installing the software, select and option from the drop down menu on step 2 of the entire installation, or the page right after the default welcome page. Depending upon what they select, a corresponding number (From ListValue) will be passed to the "leave page" which will have a function to write to a config.xml file the number of the ListValue and is then going to be put into the installation directory.<br><br>Also, they must make a selection, so if the default "Make a Selection" at ListValue 0 is still there, it would be assumed that they have not made a selection and they cannot continue until they make a selection.<br><br>Does this sound possible?<br><br>If so, how should I go about it?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">19th March 2007 23:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">List values aren't associated to any integer.<br>The selected by the user item is written to the state under the field # which represents the droplist control.<br>If you spend some time to examine-compile-execute the example I've posted on the other thread, you'll get the point to achieve what you want,<br><br><a href="http://forums.winamp.com/showthread.php?s=&amp;postid=2155232#post2155232" target="_blank">http://forums.winamp.com/showthread....32#post2155232</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Zethris</span><br><span class="post-time small text-muted">20th March 2007 00:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">One thing about that though, there is going to be 60+ options to choose from. What would be the trick to convert a word based list into numbers, like ID's based on what they select without actually revealing an ID number in the list?<br><br><br>Then, what would I do to grab that resulting data and use it for a ReplaceInFile routine?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">20th March 2007 00:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">60+ options means 60+ different actions right?<br>You need to compare the input with each one of the 60+ available options in order to execute the corresponding action.<br><br>In leave function you read the state of dropdown control from the ini so if state is option one action to perform is action one and so one.<br>If state is a something like "Plese select an option" the action is a warning message and abort which means do not proceed stay on page.<br>See below, you may copy/paste this, compile it and execute it, won't harm you.<br></p><pre>
<code>showinstdetails show<br>outfile 'test.exe'<br>Installdir "$PROGRAMFILES\My Application"<br><br>!include logiclib.nsh<br><br>page custom customcreate customleave<br>page directory<br>page instfiles<br><br>section<br>#####<br>sectionend<br><br>function customleave ;custon page leave function<br>ReadINIStr $0 "$PLUGINSDIR\custom.ini" "settings" "state"<br>${If} $0 == 0<br>ReadINIStr $0 "$PLUGINSDIR\custom.ini" "field 2" "state"<br>${AndIf} $0 == "Select an option"<br>MessageBox MB_OK "Please select an option to continue"<br>Abort<br>${EndIf}<br>ReadINIStr $0 "$PLUGINSDIR\custom.ini" "field 2" "state"<br>${If} $0 == "Option one"<br># user selected option one<br># write now the xml with what represents option one<br>${elseif} $0 == "Option two"<br># user selected option two<br># write now the xml with what represents option two<br>${else}<br># user selected option three<br># write now the xml with what represents option three<br>${EndIf}<br>functionend<br><br>function customcreate ;custom page create function<br>InstallOptions::Dialog "$PLUGINSDIR\custom.ini"<br>pop $0<br>functionend<br><br>function .onInit<br>InitPluginsDir<br><br>WriteIniStr "$PLUGINSDIR\custom.ini" "settings" "numfields" "2"<br><br>WriteIniStr "$PLUGINSDIR\custom.ini" "field 1" "type" "groupbox"<br>WriteIniStr "$PLUGINSDIR\custom.ini" "field 1" "left" "0"<br>WriteIniStr "$PLUGINSDIR\custom.ini" "field 1" "right" "-1"<br>WriteIniStr "$PLUGINSDIR\custom.ini" "field 1" "top" "10"<br>WriteIniStr "$PLUGINSDIR\custom.ini" "field 1" "bottom" "-11"<br>WriteIniStr "$PLUGINSDIR\custom.ini" "field 1" "text" "Select an option"<br><br>WriteIniStr "$PLUGINSDIR\custom.ini" "field 2" "type" "droplist"<br>WriteIniStr "$PLUGINSDIR\custom.ini" "field 2" "left" "40"<br>WriteIniStr "$PLUGINSDIR\custom.ini" "field 2" "right" "-40"<br>WriteIniStr "$PLUGINSDIR\custom.ini" "field 2" "top" "30"<br>WriteIniStr "$PLUGINSDIR\custom.ini" "field 2" "bottom" "80"<br>WriteIniStr "$PLUGINSDIR\custom.ini" "field 2" "Listitems" "Select an option|Option one|Option two|Option three"<br>WriteIniStr "$PLUGINSDIR\custom.ini" "field 2" "state" "Select an option"<br>functionend</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Zethris</span><br>
      <span class="post-time small text-muted">20th March 2007 15:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok I think I understand what you mean now and that part does now work. Thank you!<br>
      <br>
      The next question is, how do I use ReplaceInFile to write to a config.xml which is going to ultimately be put into the $INSDIR after it was modified to show the proper ID#? I seem to have some confusion with that too.<br>
      <br>
      The below might illustrate what I am trying to do, but this is kind of advanced yet for me and I could use your help.<br>
      <br>
      Here is what I have:<br>
      <br></p>
      <pre>
<code><br><br>!include LogicLib.nsh<br>!include StrRep.nsh<br>!include ReplaceInFile.nsh<br><br>!macro ReplaceInFile SOURCE_FILE SEARCH_TEXT REPLACEMENT<br>  Push "${SOURCE_FILE}"<br>  Push "${SEARCH_TEXT}"<br>  Push "${REPLACEMENT}"<br>  Call RIF<br>!macroend<br><br>Var ID_NUMBER<br><br>function SelectLeave<br><br>ReadINIStr $0 "$PLUGINSDIR\Select.ini" "settings" "state"<br>${If} $0 == 0<br>ReadINIStr $0 "$PLUGINSDIR\Select.ini" "field 2" "state"<br>${AndIf} $0 == "[Select Your Township Here]"<br>MessageBox MB_OK "Please select an option to continue Setup"<br>Abort<br>${EndIf}<br>ReadINIStr $0 "$PLUGINSDIR\Select.ini" "field 2" "state"<br>${If} $0 == "Abington Township"<br>MessageBox MB_OK "You have selected Abington Township"<br>!insertmacro ReplaceInFile "$INSTDIR\Config.xml" "__ID__" "$ID_NUMBER"<br>${elseif} $0 == "Ambler Borough"<br>MessageBox MB_OK "You have selected Ambler Borough"<br>!insertmacro ReplaceInFile "$INSTDIR\Config.xml" "__ID__" "$ID_NUMBER"<br>${elseif} $0 == "Bridgeport Borough"<br>MessageBox MB_OK "You have selected Bridgeport Borough"<br>!insertmacro ReplaceInFile "$INSTDIR\Config.xml" "__ID__" "$ID_NUMBER"<br>${elseif} $0 == "Bryn Athyn Borough"<br>MessageBox MB_OK "You have selected Bryn Athyn Borough"<br>!insertmacro ReplaceInFile "$INSTDIR\Config.xml" "__ID__" "$ID_NUMBER"<br>${elseif} $0 == "Cheltenham Township"<br>MessageBox MB_OK "You have selected Cheltenham Township"<br>!insertmacro ReplaceInFile "$INSTDIR\Config.xml" "__ID__" "$ID_NUMBER"<br>${elseif} $0 == "Collegeville Borough"<br>MessageBox MB_OK "You have selected Collegeville Borough"<br>!insertmacro ReplaceInFile "$INSTDIR\Config.xml" "__ID__" "$ID_NUMBER"<br>${elseif} $0 == "Conshohocken Borough"<br>MessageBox MB_OK "You have selected Conshohocken Borough"<br>!insertmacro ReplaceInFile "$INSTDIR\Config.xml" "__ID__" "$ID_NUMBER"<br>${else}<br>MessageBox MB_OK "You have Selected Douglass Township"<br>!insertmacro ReplaceInFile "$INSTDIR\Config.xml" "__ID__" "$ID_NUMBER"<br>${EndIf}<br><br>functionend<br><br></code>
</pre><br>
      <br>
      First, the proper messages are coming up depending upon which "state" they select. So thank you for that.<br>
      <br>
      Next, I believe I am missing a step as I will need to convert the "state" that they selected from the name of the state to a number depending on the state they select. In production the message box will be removed and it will be a silent thing to modify the Config.xml file not yet copied to the $INSTDIR. But even if I can get it to write to Config.xml, it looks like it will just put in the raw "state" as selected and not a number. So somehow I have to convert to a number and I am not sure how.<br>
      <br>
      Also, it seems that nothing is being written to the config.xml file. Where I have __ID__ it just stays as __ID__ so it seems I might be having confusion as to what directory $INSTDIR or otherwise, ReplaceInFile should be looking in to find this file find that tag and then replace it with the ID number based on the selection that is made from the drop down menu.<br>
      <br>
      One thing to note, the Config.xml I believe hasn't been copied to $INSTDIR yet because as I understand it $INSTDIR is the resulting directory the files are "installed" to. Correct? Since that happens later upon setup, where would I be able to make this change while Config.xml is "in limbo" before it is copied to the $INSTDIR ?<br>
      <br>
      Thank you so much for your help on this.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br>
      <span class="post-time small text-muted">20th March 2007 15:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If I remember correctly there are 3 plugins at wiki related to editing XMLs.<br>
      The $INSTDIR has not been created yet so you should extract your xml in $TEMP<br>
      or $PLUGINSDIR edit it and later within the install section where $INSTDIR is created copy or move it there.<br>
      Things are pretty clear I guess :)<br>
      ${If} $0 == "Abington Township" ; I know that this going to be 1,<br>
      ${elseif} $0 == "Ambler Borough" ; I know that this going to be 2,<br>
      and so on<br>
      <br>
      or<br></p>
      <pre>
<code>!define Abington_Township "1"<br>!define Ambler_Borough    "2"<br><br>function SelectLeave<br>............<br>............<br><br>ReadINIStr $0 "$PLUGINSDIR\Select.ini" "field 2" "state"<br>${If} $0 == "Abington Township"<br>MessageBox MB_OK "You have selected Abington Township"<br>!insertmacro ReplaceInFile "$INSTDIR\Config.xml" "__ID__" "${Abington_Township}"<br>${elseif} $0 == "Ambler Borough"<br>MessageBox MB_OK "You have selected Ambler Borough"<br>!insertmacro ReplaceInFile "$INSTDIR\Config.xml" "__ID__" "${Ambler_Borough}"<br><br>............<br>............<br>functionend</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br>
      <span class="post-time small text-muted">20th March 2007 15:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Also, simplified without the need of extracting the file first in $TEMP or elsewhere<br></p>
      <pre>
<code>!define Abington_Township "1"<br>!define Ambler_Borough    "2"<br><br>Var ID_NUMBER<br><br>function SelectLeave<br>.............<br>.............<br><br>ReadINIStr $0 "$PLUGINSDIR\Select.ini" "field 2" "state"<br>${If} $0 == "Abington Township"<br>MessageBox MB_OK "You have selected Abington Township"<br>StrCpy "$ID_NUMBER" "${Abington_Township}<br>${elseif} $0 == "Ambler Borough"<br>MessageBox MB_OK "You have selected Ambler Borough"<br>StrCpy "$ID_NUMBER" "${Ambler_Borough}"<br><br>.............<br>.............<br>functionend<br><br>Section -Install<br>SetOutPath "$INSTDIR"<br>File "LOCAL_PATH\config.xml"<br>!insertmacro ReplaceInFile "$INSTDIR\Config.xml" "__ID__" "$ID_NUMBER"<br><br>................<br>................<br>SectionEnd</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Zethris</span><br>
      <span class="post-time small text-muted">20th March 2007 16:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You are a beautiful person Red Wine. Thank you so much for your help!</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br>
      <span class="post-time small text-muted">20th March 2007 17:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">lol I suspect I should change my avatar :D</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script type="text/javascript" src="../js/highlight.pack.js" async>
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>