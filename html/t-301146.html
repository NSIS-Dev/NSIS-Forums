<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Running installed executable on a new process thread" />

  <title>Running installed executable on a new process thread - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Running installed executable on a new process thread</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=301146">Running installed executable on a new process thread</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">chamberlain</span><br />
      <span class="post-time small text-muted">17th December 2008 12:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Running installed executable on a new process thread</strong><br />
      Hi All,<br />
      <br />
      I have an installer which calls the installer for MySQL 5.1. Once the MySQL and our installer have finished, the final wizard page allows the user to start our application.<br />
      <br />
      The problem is that our application is not given the true environment variables from Windows, only the environment variables that were present when the installer started (it is created as a child process). During this time, the MySQL installer may or may not have altered the environment variables. Our application reports an error which disappears if you exit the application and start it again (so that it takes the current environment variables).<br />
      <br />
      Is there a clean way of starting our installer application in a truly new process from Windows at the end of our installer? Or is there a way for child processes to get the current environment variables and not a copy from the main installer process?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">17th December 2008 20:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There probably is a way to do it, maybe by running explorer.exe and having it run the application for you, but I don't know of one. What I'm sure will work is manually setting those environment variables by calling SetEnvironmentVariable. That would require you to know exactly which variables are set.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">chamberlain</span><br />
      <span class="post-time small text-muted">18th December 2008 07:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the reply kichik.<br />
      <br />
      The problem with using SetEnvironmentVariable is that I would need to know the value of the install directory of MySQL, which the user can always change via the MySQL installer.<br />
      <br />
      What I could do is put in a check to see if MySQL is installed to the default location. If it is, then I can call SetEnvironmentVariable and then allow the user to start the executable at the end of installation. If it is not present in the default location, then perhaps I can disable/hide the start option on the final page, or even replace it with a "reboot required" message.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">19th December 2008 07:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Doesn't MySQL write that value somewhere in the registry as well? At the very minimum, environment variables are written to HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Environment.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">chamberlain</span><br />
      <span class="post-time small text-muted">19th December 2008 08:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Good point! I am not sure whether that registry variable will contain the updated value from MySQL, but I will investigate it as that would be a cleaner solution to just pass the updated path to the sub process.<br />
      <br />
      That way, our installer does not need to know about sub-installers in case we add or remove them in the future.<br />
      <br />
      I will test this solution.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">chamberlain</span><br />
      <span class="post-time small text-muted">19th December 2008 10:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, I tried that and it would have worked, if weren't for the fact that the separate MySQL installer we have runs the MySQL configuration wizard as a sub-process.<br />
      <br />
      This means it tries to pass an updated PATH variable to our application which has not yet been updated.<br />
      <br />
      To get around this problem, I have disabled the "Start application" option from the final wizard page. We have several different versions of the installer (standard, full and express) and this issue only affects the full version where the user has complete control of the MySQL installer. This means that we can never guarantee that the user configures MySQL correctly and consequently cannot guarantee that the "start application" option will work.<br />
      <br />
      For our other installers this isn't a problem as MySQL either exists already on the end system, or we have control of the MySQL installer.<br />
      <br />
      Many thanks for the tips kichik!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
