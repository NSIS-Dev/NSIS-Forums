<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Set silent installer exit code?"><title>Set silent installer exit code? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Set silent installer exit code?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=313982">Set silent installer exit code?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">BSOD2600</span><br><span class="post-time small text-muted">19th October 2009 07:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Set silent installer exit code?</strong><br>How does one set a unique exit code/error level and/or error message when using the silent installer feature? I've already searched and found the following:<br>* <a href="http://forums.winamp.com/showthread.php?postid=1402278" target="_blank">How to set exit errorlevel code</a><br>* <a href="http://forums.winamp.com/showthread.php?postid=2575569" target="_blank">Error Level when installer ends</a><br><br>Neither threads had clear solutions to this problem. I've tried a bunch of various code trying to abort/quit in .onInit and other custom page functions. None appear to set the dos errorlevel (or if it does, its 9009 which clearly isn't my custom errorlevel).<br><br>Basically, I'm passing in a silent install configuration file, parsing it out for the stuff I need, running checks on the data the user provided and then if need be, quit the installer with unique error codes/messages depending what is wrong. I realize while one can display a Messagebox for the error, that sort of defeats the purpose of a "silent installer".<br><br>Suggestions?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">19th October 2009 09:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">In the thread you linked, kickik said you can't set your own exit code in NSIS.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ChocJunkie</span><br><span class="post-time small text-muted">19th October 2009 09:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by MSG</i><br><b>In the thread you linked, kickik said you can't set your own exit code in NSIS.</b></blockquote>For what reason does SetErrorLevel exist, if it's not possible to set a own exit code? Especially because the manual says so: <a href="http://nsis.sourceforge.net/Docs/AppendixD.html#D.1" target="_blank">http://nsis.sourceforge.net/Docs/AppendixD.html#D.1</a><br><br>CJ</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">BSOD2600</span><br><span class="post-time small text-muted">19th October 2009 11:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by ChocJunkie</i><br><b>For what reason does SetErrorLevel exist, if it's not possible to set a own exit code? Especially because the manual says so: <a href="http://nsis.sourceforge.net/Docs/AppendixD.html#D.1" target="_blank">http://nsis.sourceforge.net/Docs/AppendixD.html#D.1</a><br><br>CJ</b></blockquote>I agree and saw it in the manual too, but am unable to actually have it work.<br><br>Would you please provide sample code demonstrating it working?</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">19th October 2009 12:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by ChocJunkie</i><br><b>For what reason does SetErrorLevel exist, if it's not possible to set a own exit code? Especially because the manual says so: <a href="http://nsis.sourceforge.net/Docs/AppendixD.html#D.1" target="_blank">http://nsis.sourceforge.net/Docs/AppendixD.html#D.1</a><br><br>CJ</b></blockquote>Hmmm. Fair enough. :) To use that, I'd try putting IfSilent into .onGuiEnd or something like that.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">BSOD2600</span><br><span class="post-time small text-muted">19th October 2009 18:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by MSG</i><br><b>Hmmm. Fair enough. :) To use that, I'd try putting IfSilent into .onGuiEnd or something like that.</b></blockquote><a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.12" target="_blank">http://nsis.sourceforge.net/Docs/Chapter4.html#4.12</a><br><blockquote>When an installer or an uninstaller is silent, not all callback functions are called. .onGUIInit, .onGUIEnd, their uninstaller equivalents and any callback related to a specific page or page type will <b>not be called</b>.</blockquote></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">20th October 2009 12:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">.oninstsuccess and .oninstfailed then? Or just at the end of the last section.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">BSOD2600</span><br><span class="post-time small text-muted">20th October 2009 14:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by BSOD2600</i><br><b>I agree and saw it in the manual too, but am unable to actually have it work.<br><br>Would you please provide sample code demonstrating it working?</b></blockquote></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pengyou</span><br><span class="post-time small text-muted">20th October 2009 17:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I tried modifying the MUI2 'Basic.nsi' example to return an error code. When I ran it using /S on the command-line it returned the correct error code.<br><br>I don't understand your problem; perhaps because you have not supplied enough information? For example: How are you making your installer silent?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">BSOD2600</span><br><span class="post-time small text-muted">20th October 2009 18:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'm making the installer silent via the /S command.<br><br>Alright, so taking your basic.nsi example, I modified it to set an error level and it doesn't appear to work. Would you please post your sample code?<br><br></p><pre>
<code><br>C:\Program Files\NSIS\Examples\Modern UI&gt;%errorlevel%<br>'9009' is not recognized as an internal or external command,<br>operable program or batch file.<br><br>C:\Program Files\NSIS\Examples\Modern UI&gt;Basic.exe /S<br><br>C:\Program Files\NSIS\Examples\Modern UI&gt;%errorlevel%<br>'9009' is not recognized as an internal or external command,<br>operable program or batch file.<br>----------------------<br>basic.nsi<br><br>;--------------------------------<br>;Include Modern UI<br><br>  !include "MUI2.nsh"<br><br>;--------------------------------<br>;General<br><br>  ;Name and file<br>  Name "Modern UI Test"<br>  OutFile "Basic.exe"<br><br>  ;Default installation folder<br>  InstallDir "$LOCALAPPDATA\Modern UI Test"<br>  <br>  ;Get installation folder from registry if available<br>  InstallDirRegKey HKCU "Software\Modern UI Test" ""<br><br>  ;Request application privileges for Windows Vista<br>  RequestExecutionLevel user<br><br>;--------------------------------<br>;Interface Settings<br><br>  !define MUI_ABORTWARNING<br><br>;--------------------------------<br>;Pages<br><br>  !insertmacro MUI_PAGE_LICENSE "${NSISDIR}\Docs\Modern UI\License.txt"<br>  !insertmacro MUI_PAGE_COMPONENTS<br>  !insertmacro MUI_PAGE_DIRECTORY<br>  !insertmacro MUI_PAGE_INSTFILES<br>  <br>  !insertmacro MUI_UNPAGE_CONFIRM<br>  !insertmacro MUI_UNPAGE_INSTFILES<br>  <br>;--------------------------------<br>;Languages<br> <br>  !insertmacro MUI_LANGUAGE "English"<br><br>;--------------------------------<br>;Installer Sections<br><br>Section "Dummy Section" SecDummy<br>  IfSilent 0 +4<br>        SetErrorLevel 1234<br>        Abort<br><br>  SetOutPath "$INSTDIR"<br>  <br>  ;ADD YOUR OWN FILES HERE...<br>  <br>  ;Store installation folder<br>  WriteRegStr HKCU "Software\Modern UI Test" "" $INSTDIR<br>  <br>  ;Create uninstaller<br>  WriteUninstaller "$INSTDIR\Uninstall.exe"<br><br>SectionEnd<br><br>;--------------------------------<br>;Descriptions<br><br>  ;Language strings<br>  LangString DESC_SecDummy ${LANG_ENGLISH} "A test section."<br><br>  ;Assign language strings to sections<br>  !insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br>    !insertmacro MUI_DESCRIPTION_TEXT ${SecDummy} $(DESC_SecDummy)<br>  !insertmacro MUI_FUNCTION_DESCRIPTION_END<br><br>;--------------------------------<br>;Uninstaller Section<br><br>Section "Uninstall"<br><br>  ;ADD YOUR OWN FILES HERE...<br><br>  Delete "$INSTDIR\Uninstall.exe"<br><br>  RMDir "$INSTDIR"<br><br>  DeleteRegKey /ifempty HKCU "Software\Modern UI Test"<br><br>SectionEnd<br></code>
</pre><br>
      <br>
      What I really want to do, is to read in the silent answer file, parse it to check for issues and then throw various error codes/messages based before the installer actually gets to installing...
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pengyou</span><br>
      <span class="post-time small text-muted">20th October 2009 19:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I think I see what the problem is:</p>

      <blockquote>
        C:\Program Files\NSIS\Examples\Modern UI&gt;Basic.exe /S<br>
        <br>
        C:\Program Files\NSIS\Examples\Modern UI&gt;%errorlevel%<br>
        '9009' is not recognized as an internal or external command,<br>
        operable program or batch file.
      </blockquote>Try using a batch file to display the errorlevel. Here is what I used to test my script:
      <pre>
<code>test &gt;type silent-demo.bat<br>@echo off<br>echo Run 'silent-mui-demo.exe' silently by supplying /S on command line<br>silent-mui-demo.exe /S<br>echo 'silent-mui-demo.exe /S' returned %ERRORLEVEL%<br>echo.<br><br>test &gt;silent-demo<br>Run 'silent-mui-demo.exe' silently by supplying /S on command line<br>'silent-mui-demo.exe /S' returned 1500<br><br><br>test &gt;</code>
</pre>"1500" is the expected value when the script is run silently. My script is attached.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">BSOD2600</span><br>
      <span class="post-time small text-muted">20th October 2009 19:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well heck, that made it easy and my existing code does work after all. Guess my validation was wrong the whole time.<br>
      <br>
      Thanks!</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>