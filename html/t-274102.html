<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="String manipulation outside of sections or functions ?" />

  <title>String manipulation outside of sections or functions ? - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">String manipulation outside of sections or functions ?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=274102">String manipulation outside of sections or functions ?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Rudif</span><br />
      <span class="post-time small text-muted">9th July 2007 13:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>String manipulation outside of sections or functions ?</strong><br />
      Working with NSIS 2.21, I am trying to inject the FileVersion into the generated installer.<br />
      <br />
      If I add code like this<br />
      <br />
      &lt;code&gt;<br />
      !ifndef CHANGELIST<br />
      !define CHANGELIST 0 ; expect string like 98765<br />
      !endif<br />
      <br />
      !ifndef FILEVERSIONDOT<br />
      !define FILEVERSIONDOT 0.0.0.0 ; expect string like 9.87.65<br />
      !endif<br />
      <br />
      !ifndef FILEVERSIONCOMMA<br />
      !define FILEVERSIONCOMMA 0,0,0,0 ; expect string like 9,87,65<br />
      !endif<br />
      <br />
      VIProductVersion "${FILEVERSIONDOT}"<br />
      VIAddVersionKey /LANG=${LANG_ENGLISH} "ProductName" "MauiInstallExamples${PLT}"<br />
      VIAddVersionKey /LANG=${LANG_ENGLISH} "Comments" "CHANGELIST ${CHANGELIST}"<br />
      VIAddVersionKey /LANG=${LANG_ENGLISH} "CompanyName" "LeCroy Corp"<br />
      VIAddVersionKey /LANG=${LANG_ENGLISH} "FileVersion" "${FILEVERSIONCOMMA}"<br />
      &lt;/code&gt;<br />
      <br />
      early on in my .nsi script, before any section or function,<br />
      it does what I want, provided that I generate strings FILEVERSIONCOMMA and FILEVERSIONDOT from CHANGELIST number with some external program, and that I inject them into the .nsi script with "/D&lt;string&gt;" arguments to makensis.<br />
      <br />
      Questions : could I generate strings FILEVERSIONCOMMA and FILEVERSIONDOT in my .nsi script, and how?<br />
      <br />
      My understanding is that VIProductVersion and VIAddVersionKey can only be used outside sections and functions, and that commands like IntOp and StrCpy can not be used outside sections and functions.<br />
      <br />
      <br />
      TIA<br />
      Rudif</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">9th July 2007 16:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You could call the external with !system, let it create a header with the required definitions and !include that header in your script.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Rudif</span><br />
      <span class="post-time small text-muted">23rd July 2007 21:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Red Wine<br />
      <br />
      Using !system looks like a slightly cleaner alternative than injecting /DFILEVERSIONCOMMA and /DFILEVERSIONDOT, although both should work.<br />
      <br />
      You seem to confirm implicitly that there is no way to generate strings FILEVERSIONCOMMA and FILEVERSIONDOT from CHANGELIST in the main .nsi script itself, at the time of building the installer. Is this correct ?<br />
      <br />
      Thanks<br />
      Rudif</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">23rd July 2007 23:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://nsis.sourceforge.net/Invoking_NSIS_run-time_commands_on_compile-time" target="_blank">http://nsis.sourceforge.net/Invoking...n_compile-time</a><br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
