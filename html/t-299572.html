<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="NSIS, XP Embedded and EWF" />

  <title>NSIS, XP Embedded and EWF - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">NSIS, XP Embedded and EWF</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=299572">NSIS, XP Embedded and EWF</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MrK2</span><br />
      <span class="post-time small text-muted">5th November 2008 11:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>NSIS, XP Embedded and EWF</strong><br />
      I'm using NSIS to install software in a XP embedded system which has the EWF (a filesystem protection system) enabled.<br />
      <br />
      Even when I disable EWF, the installer acts weird, specially with files to be copied on reboot: They usually don't get copied. Has anyone found a similar problem so that I can have a look at it? (the forum shows nothng about EWF)<br />
      <br />
      The installer works flawlessly on a normal XP with no EWF.<br />
      <br />
      TIA,<br />
      Jordi</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">7th November 2008 22:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What exactly does EWF do and is it an official Microsoft product?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MrK2</span><br />
      <span class="post-time small text-muted">18th November 2008 18:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by kichik</i><br />
        <b>What exactly does EWF do and is it an official Microsoft product?</b>
      </blockquote>Hi kichik,<br />
      <br />
      sorry for the delay. EWF is a "Write Filter". It basically protects the hard disk by using a memory overlay, and every write done to the hard disk is "redirected" to memory, so that you don't really modify your HD and can boot exactly the same way across reboots (it's widely used for embedded devices).<br />
      <br />
      There are tools to commit changes (of course, otherwise you couldn't write to HD), but sometimes NSIS just doesn't write those files even when you've commited the overlay :?<br />
      <br />
      It is indeed an official Microsoft product, although (afaik) it is only available to XP embedded.<br />
      <br />
      <br />
      EDIT: I think it might be related to the MoveFileEx Function (supposing that NSIS is using it to delete &amp; copy the final name).Is the 'move' of MoveFileEx effective before the reboot or just after the system boots?<br />
      <br />
      EDIT2: I'm having a look at the windows event viewer. When I reboot under the circumstances that make the files disappear, I get an event 1524 and 1517, but I don't know if those could be the cause.<br />
      <br />
      EDIT3: I think I've found the problem. All my software is installed to d:\, and the TEMP &amp; TMP are pointing to e:\temp. If I change it to d:\temp then everything works... does that make sense???? D and E are obviously different primary partitions.<br />
      <br />
      The thing is I don't want to have the swap in the d:, as it could be a CF (although it isn't now) and I'd prefer to avoid all writes to it.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MrK2</span><br />
      <span class="post-time small text-muted">19th November 2008 08:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK, I think it's really a MoveFileEX behaviour problem. From MSDN's documentation<br />
      <br /></p>

      <blockquote>
        <br />
        MOVEFILE_COPY_ALLOWED<br />
        <br />
        If the file is to be moved to a different volume, the function simulates the move by using the CopyFile and DeleteFile functions.<br />
        <br />
        This value cannot be used with MOVEFILE_DELAY_UNTIL_REBOOT.
      </blockquote>So, if I want to move the file to another volume I'd have to specify MOVEFILE_COPY_ALLOWED, but I can't because it must be done on reboot.<br />
      <br />
      Does anybody has a clever idea about how to do that? I'm really lost and the deadline is here :confused: :D
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">19th November 2008 18:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You should create the temporary file right next to the file you want to overwrite. Use GetTempFilename for that. The second parameter specifies the base directory.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MrK2</span><br />
      <span class="post-time small text-muted">20th November 2008 11:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by kichik</i><br />
        <b>You should create the temporary file right next to the file you want to overwrite. Use GetTempFilename for that. The second parameter specifies the base directory.</b>
      </blockquote>That's it, lots of thanks! :)
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
