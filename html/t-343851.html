<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Function to enable Adobe Flash Player silent automatic update feature" />

  <title>Function to enable Adobe Flash Player silent automatic update feature - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Function to enable Adobe Flash Player silent automatic update feature</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=343851">Function to enable Adobe Flash Player silent automatic update feature</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Rapport12</span><br />
      <span class="post-time small text-muted">6th April 2012 22:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Function to enable Adobe Flash Player silent automatic update feature</strong><br />
      I created the following function to enable the Adobe Flash Player silent automatic update function that was <a href="http://blogs.adobe.com/asset/2012/03/an-update-for-the-flash-player-updater.html" target="_blank">introduced</a> in the recent 11.2 version. KiCHiK's "Replacing Lines in a Text File" example code was very helpful here. I believe you will also need LogicLib.nsh and x64.nsh as includes for this function to work. I tested it with Windows XP (32-Bit) and Windows 7 (64-Bit). Because you are accessing protected system files, you'll need "RequestExecutionLevel" set to "Admin" on Windows 7. I just wanted to share it incase there are other systems administrators that could find it useful. Thanks!<br />
      <br />
      <br /></p>
      <pre>
<code><font size="2">Function SilentAutoUpdateEnable<br /><br />${If} ${RunningX64}<br /><br />        IfFileExists "$WINDIR\SysWOW64\Macromed\Flash\mms.cfg" 0 CreateMMSFile64<br /><br />        ClearErrors<br />        FileOpen $0 "$WINDIR\SysWOW64\Macromed\Flash\mms.cfg" "r"                   ; open target file for reading<br />        GetTempFileName $R0                                                             ; get new temp file name<br />        FileOpen $1 $R0 "w"                                                           ; open temp file for writing<br />        loop64:<br />                FileRead $0 $2                                                          ; read line from target file<br />                IfErrors done64                                                         ; check if end of file reached<br />                StrCmp $2 "SilentAutoUpdateEnable=0$\r$\n" 0 +2                               ; compare line with search string with CR/LF<br />                        StrCpy $2 "SilentAutoUpdateEnable=1$\r$\n"                    ; change line<br />                StrCmp $2 "SilentAutoUpdateEnable=0" 0 +2                             ; compare line with search string without CR/LF (at the end of the file)<br />                        StrCpy $2 "SilentAutoUpdateEnable=1"                          ; change line<br />                FileWrite $1 $2                                                         ; write changed or unchanged line to temp file<br />        Goto loop64<br /> <br />        done64:<br />                FileClose $0                                                            ; close target file<br />                FileClose $1                                                            ; close temp file<br />                Delete "$WINDIR\SysWOW64\Macromed\Flash\mms.cfg"                      ; delete target file<br />                CopyFiles /SILENT $R0 "$WINDIR\SysWOW64\Macromed\Flash\mms.cfg"               ; copy temp file to target file<br />                Delete $R0                                                              ; delete temp file<br />        Goto Complete64<br /><br />        CreateMMSFile64:<br /><br />                FileOpen $9 "$WINDIR\SysWOW64\Macromed\Flash\mms.cfg" "w"           ; creates the file and opens it for write<br />                FileWrite $9 "AutoUpdateDisable=0$\r$\n"                              ; write the first line<br />                FileWrite $9 "SilentAutoUpdateEnable=1"                                       ; write the last line<br />                FileClose $9                                                            ; closes and saves the file<br />        <br />        Complete64:<br />        <br /><br />${Else}<br /><br />        IfFileExists "$WINDIR\system32\Macromed\Flash\mms.cfg" 0 CreateMMSFile32<br /><br />        ClearErrors<br />        FileOpen $0 "$WINDIR\system32\Macromed\Flash\mms.cfg" "r"                   ; open target file for reading<br />        GetTempFileName $R0                                                             ; get new temp file name<br />        FileOpen $1 $R0 "w"                                                           ; open temp file for writing<br />        loop32:<br />                FileRead $0 $2                                                          ; read line from target file<br />                IfErrors done32                                                         ; check if end of file reached<br />                StrCmp $2 "SilentAutoUpdateEnable=0$\r$\n" 0 +2                               ; compare line with search string with CR/LF<br />                        StrCpy $2 "SilentAutoUpdateEnable=1$\r$\n"                    ; change line<br />                StrCmp $2 "SilentAutoUpdateEnable=0" 0 +2                             ; compare line with search string without CR/LF (at the end of the file)<br />                        StrCpy $2 "SilentAutoUpdateEnable=1"                          ; change line<br />                FileWrite $1 $2                                                         ; write changed or unchanged line to temp file<br />        Goto loop32<br /><br />        done32:<br />                FileClose $0                                                            ; close target file<br />                FileClose $1                                                            ; close temp file<br />                Delete "$WINDIR\system32\Macromed\Flash\mms.cfg"                      ; delete target file<br />                CopyFiles /SILENT $R0 "$WINDIR\system32\Macromed\Flash\mms.cfg"               ; copy temp file to target file<br />                Delete $R0                                                              ; delete temp file<br />        Goto Complete32<br /><br />        CreateMMSFile32:<br /><br />                FileOpen $9 "$WINDIR\system32\Macromed\Flash\mms.cfg" "w"           ; creates the file and opens it for write<br />                FileWrite $9 "AutoUpdateDisable=0$\r$\n"                              ; write the first line<br />                FileWrite $9 "SilentAutoUpdateEnable=1"                                       ; write the last line<br />                FileClose $9                                                            ; closes and saves the file<br /><br />        Complete32:<br /><br />${EndIf}<br /><br /><br />FunctionEnd</font></code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">6th April 2012 22:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You don't need to have the code twice for 32/64. NSIS is 32-bit so will always point to SysWOW64 on 64-bit Windows and System32 on 32-bit Windows when you use $SYSDIR (unless you disable file system redirection using the macro in x64.nsh).<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br />
      <span class="post-time small text-muted">7th April 2012 01:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">from my view - code that none needs - as you pointed out to adobe blogs the updater has itself this option.<br />
      and 11.2 is present version. eot<br />
      <a href="http://www.adobe.com/products/flashplayer/distribution3.html" target="_blank">http://www.adobe.com/products/flashp...ribution3.html</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">7th April 2012 07:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for sharing. But next time please use an attachment or pastebin for something this big. :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Rapport12</span><br />
      <span class="post-time small text-muted">9th April 2012 17:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Afrow UK - You're right. The code is redundant. Thanks for the tip. :)<br />
      <br />
      Brummelchen - The code allows systems administrators that manage hundreds or thousands of systems to enable this feature automatically. I did not see an option in the native Flash installer to control this feature. The only current methods of enabling the feature, to my knowledge, are via the mms.cfg file and the Flash control panel applet.<br />
      <br />
      MSG - Thanks for the tip on using an attachment. Will do next time around.<br />
      <br />
      <br />
      Thanks for the feedback!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
