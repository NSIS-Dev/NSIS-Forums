<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="nsDialog Finishing Touches" />

  <title>nsDialog Finishing Touches - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">nsDialog Finishing Touches</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=282629">nsDialog Finishing Touches</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Fightin_Foo</span><br />
      <span class="post-time small text-muted">4th December 2007 14:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>nsDialog Finishing Touches</strong><br />
      Hello everybody, I am trying to use nsDialogs that will ask the user for a product key. I've pretty much got it to look the way I want, but does anybody know how to:<br />
      <br />
      1.) Make the cursor appear in a text box so that a user can just start typing.<br />
      <br />
      2.) Make it so hitting enter hits an OK button. I created the OK button it is not one of the ones that appear at the bottom.<br />
      <br />
      3.) Make so after enter has been hit (the OK button) the focus moves to the next/install button. So you can just hit enter again to move to the next page if you want.<br />
      <br />
      Thanks for the help everyone.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">4th December 2007 14:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <ol style="list-style-type: decimal">
        <li>Set focus to it using something similar to <a href="http://nsis.sourceforge.net/Set_Focus_to_a_Control" target="_blank">SetFocus</a>.</li>

        <li>Send WM_NEXTDLGCTL to $HWNDPARENT, passing the button's HWND as the first parameter and 1 as the second. That might do it.</li>

        <li>Send it again but pass the HWND of the next button.</li>
      </ol>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Fightin_Foo</span><br />
      <span class="post-time small text-muted">4th December 2007 15:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the tips Kichik, but can you elaborate a little on how to do them? This is my first attempt with nsDialogs and I am a little confused.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">4th December 2007 15:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, to send a message you use SendMessage and for the value of WM_NEXTDLGCTL you need WinMessages.nsh. What else?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Fightin_Foo</span><br />
      <span class="post-time small text-muted">4th December 2007 16:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I didn't know about WinMessages.nsh and had never used SendMessage before. What is the wparam and lparam that the help refers to?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">4th December 2007 16:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Every message has an opening for two parameters. The first being wParam and the second being lParam (more <a href="http://www.winprog.org/tutorial/message_loop.html" target="_blank">here</a>). I referred to those two as the first parameter and the second parameter in my reply. If you look up WM_NEXTDLGCTL in MSDN, you'll find reference to wParam and lParam explaining every possible value.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Fightin_Foo</span><br />
      <span class="post-time small text-muted">4th December 2007 16:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Okay so I think I'm begining to understand sending the message, so I can make hitting enter activate my OK button. How do I get my OK button's handle? I've tried the method described in the help with: FindWindow $1 "#32770" "" $HWNDPARENT to select the inner dialog and then using GetDlgItem but I am having no luck.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">4th December 2007 17:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You already have that HWND. You get it from nsDialogs when you create it. It's pushed on the stack.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Fightin_Foo</span><br />
      <span class="post-time small text-muted">4th December 2007 20:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks, Kichik I've gotten the buttons to be the focus and even enable and disable them to make it clearer. I have just one last thing to figure out.<br />
      <br />
      I have the focus on the text box (by using SendMessage like with the buttons) so you can just start typing. I want to have it when you hit enter the OK button is hit. Do you know how to detect the enter key?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">4th December 2007 20:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You don't need to detect the enter key. You just need to tell the dialog which button is the default. That is done using WM_NEXTDLGCTL. To set focus to the text box, you should use SetFocus() and not WM_NEXTDLGCTL.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Fightin_Foo</span><br />
      <span class="post-time small text-muted">4th December 2007 21:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am not using any ini page files (that I know of at least) so how do I use SetFocus, and what is the number that the setfocus function wants?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">4th December 2007 21:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just call user32::SetFocus(), not Function SetFocus. You don't need the rest unless you have caret drawing problems and even then ShowCaret() should suffice.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Fightin_Foo</span><br />
      <span class="post-time small text-muted">4th December 2007 22:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Okay I tried the user32::SetFocus and I got it to set the focus on the text box, but when I include the SendMessage code only the text box or the button get focus (makes sense), but hitting enter after typing a key does nothing. Is there perhaps a way just to attach a function or event to the enter key?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th December 2007 18:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Make sure you first send the message and only then call SetFocus as the message also sets the focus.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Fightin_Foo</span><br />
      <span class="post-time small text-muted">5th December 2007 19:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am sending the message to make the OK button default, then I call SetFocus to make the focus the text box, and hitting enter after typing in a key doesn't do anything I have to tab down to the OK button and hit space. Hitting enter when the OK button is the focus doesn't activate it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ClayDowling</span><br />
      <span class="post-time small text-muted">5th December 2007 20:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Fightin_Foo,<br />
      <br />
      If you can hold on until next week, I can save you the grief. The registration plugin (see the plugins repository on the wiki) will start using nsDialogs with the release that's coming.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th December 2007 20:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Attach the script so I can see what's wrong.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Fightin_Foo</span><br />
      <span class="post-time small text-muted">5th December 2007 22:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I cannot attach the script due to a confidentially agreement with my company. So I will just have to say what I am doing.<br />
      <br />
      Create the label, text box, and ok button, moving them to the spot that I want them. I disable the back button, disable the next button, and send the message to make the OK button default, call setfocus to get focus on the text box.<br />
      <br />
      When the text box is changed a function is called that gets the text and copies it to a variable<br />
      <br />
      When the ok button is clicked it checks the key. If the key is valid it disables the ok button (enablewindow), enables the next button, and then sets focus on the next button (sendmessage)<br />
      <br />
      Hopefully that is enough info to for you.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pospec</span><br />
      <span class="post-time small text-muted">6th December 2007 15:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I think that nobody here will work for your company FOR FREE. Maybe your company should ask <a href="http://www.afrowuk.co.uk/" target="_blank">AfrowUK</a> for a script ;)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th December 2007 23:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Send WM_NEXTDLGCTL before disabling the next button. If that doesn't work, reproduce the script outside of its context.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
