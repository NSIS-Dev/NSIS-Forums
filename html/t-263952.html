<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Installation type depending on file existing"><title>Installation type depending on file existing - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Installation type depending on file existing</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=263952">Installation type depending on file existing</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">MikeInVancouver</span><br><span class="post-time small text-muted">18th January 2007 21:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Installation type depending on file existing</strong><br>I am a bit of a newbie to nsis so plesae bear with me if this seems a little confusing.<br><br>I want to look to see if the .jar file we are installing already exists in teh install directory, if it doesnt I would just like to procede to the next page, but if it exists then I would like to have a dialog with 3 radio buttons as options appear. These 3 options would be "upgrade current version" which would overwrite the .jar but not the data. Option 2 wuold be "Clean Install" which would overwrite both the .jar and the data files. The third option would be "Install new in new location" which would just redirect the person back to the current page, where they could choose another directory location.<br><br>I know how to use the overwrite on/off and have a basic script working but I need to get this functionality into the script. Is this possible with a messsage box or do I need to create a custom page. Either way any hints or code examples would be greatly appreciated.<br><br>Thanks in advance,<br><br>Mike</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br><span class="post-time small text-muted">18th January 2007 23:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">i guess you know how to check for the file?<br>(IfFileExists jump_true jump_false)<br><br>then if you really want to have exactly those 3 options, you need indeed a custom page.<br><br>i'm too tired now to code it, but maybe tomorrow i can post some code.<br><br>in the meanwhile, you could browse the forums/wiki/documentation files about installtoptions :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">19th January 2007 06:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>an example to help you as a starting point</strong><br>an example to help you as a starting point :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MikeInVancouver</span><br><span class="post-time small text-muted">19th January 2007 17:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks Red Wine,<br><br>It has got me started but I am still unsure how to accomplish what I am trying to do. I want the welcome page to appear, then the Directory page and then if the .jar file exists in the directory the user specified then they choose one of the options and the script installs the appropiate files, if the file doesnt exist I want it to skip the page with options and just do a clean install.<br><br>I am wondering at what point is the SEC01 called in nsis? Is it called when the instfiles page is called? I am trying to figure out exactly how everything ties together and works, I have a basic script working but I am not sure what the proper order/priority the code is executed.<br><br>As I mentioned I am I newbie at this so thank you for your understanding.<br><br>Mike</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br><span class="post-time small text-muted">19th January 2007 18:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">all sections are executed in the instfiles page, yes.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jpodtbc</span><br><span class="post-time small text-muted">19th January 2007 18:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">assuming sec01 is your first section, it is run when the install occurs. so yes it is what is called during your instfiles page. other install sections are also called here if you have them defined.<br><br>to do what you want, you could define the .onInit function (if you haven't already) which is an initialization callback run before any pages are displayed. in this function you could check for the existence of the .jar file and setup your custom page if so.<br><br></p><pre>
<code><br>Function .onInit<br><br>IfFileExists "blah.jar" exists notexists<br><br>exists:<br> StrCpy $JarExists 1<br> !insertmacro MUI_INSTALLOPTIONS_EXTRACT "myPage.ini"<br><br>notexists:<br><br>FunctionEnd<br></code>
</pre><br>
      <br>
      then you would have function that setup your custom page like this. note that abort in a page initialization function context does not abort the installation but only the creation of that page.<br>
      <br>
      <pre>
<code><br>Function preInitMyPage<br>${If} $JarExists == 0<br> Abort<br>${EndIf}<br><br>// setup your custom page here<br>FunctionEnd<br></code>
</pre><br>
      <br>
      you'll also need to validate the response from your page with another function like this<br>
      <br>
      <pre>
<code><br>Function validateMyPage<br>// get the user response here<br>FunctionEnd<br></code>
</pre><br>
      <br>
      note that using {If} requires that you include LogicLib.nsh in your project. also using the modern ui (MUI) makes custom pages a lot easier.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br>
      <span class="post-time small text-muted">19th January 2007 19:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by MikeInVancouver</i><br>
        <b>Thanks Red Wine,<br>
        <br>
        It has got me started but I am still unsure how to accomplish what I am trying to do. I want the welcome page to appear, then the Directory page and then if the .jar file exists in the directory the user specified then they choose one of the options and the script installs the appropiate files, if the file doesnt exist I want it to skip the page with options and just do a clean install.<br>
        <br>
        I am wondering at what point is the SEC01 called in nsis? Is it called when the instfiles page is called? I am trying to figure out exactly how everything ties together and works, I have a basic script working but I am not sure what the proper order/priority the code is executed.<br>
        <br>
        As I mentioned I am I newbie at this so thank you for your understanding.<br>
        <br>
        Mike</b>
      </blockquote>Hi Mike,<br>
      provided example checks for an installation instead of asking users to point the installation folder. Assumes that the installer knows where/how to search in order to determine the existence of an installation on the target. It's based more or less on the installation structure that you mentioned on your 1st post on the top of this thread. Pages' order could be changed. Sections executed within instfiles page.<br>
      Now, the following attached example shows more or less the changed structure.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MikeInVancouver</span><br>
      <span class="post-time small text-muted">23rd January 2007 19:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you everyone,<br>
      <br>
      With your help and reading all the documentation I could find I was able to accomplish what I set out to do. I really appreciate all the informative, and helpful feedback.<br>
      <br>
      Mike</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>