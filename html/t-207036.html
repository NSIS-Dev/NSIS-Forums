<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Uninstalling older versions" />

  <title>Uninstalling older versions - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Uninstalling older versions</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=207036">Uninstalling older versions</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">phllp_w</span><br />
      <span class="post-time small text-muted">6th February 2005 12:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Uninstalling older versions</strong><br />
      I had NSIS 2.02 and just got NSIS 2.05, I noticed it has an uninstaller which uninstalls older versions.<br />
      <br />
      Can someone please tell me how to do a thing like that?<br />
      Thanks<br />
      <br />
      <br />
      P.S. I found nothing useful in the search. :(</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">glory_man</span><br />
      <span class="post-time small text-muted">7th February 2005 12:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        P.S. I found nothing useful in the search.
      </blockquote>Why not? Search with unistall and older filters.<br />
      <br />
      Try to see makensis.nsi in your NSIS\Examples - dir. There are script and ini-file (for custom page) for these purposes.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">phllp_w</span><br />
      <span class="post-time small text-muted">7th February 2005 18:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There are many examples, but none for what I need.<br />
      <br />
      I need the same thing as in the NSIS installer, so I was hoping a dev could give me the code.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pidgeot</span><br />
      <span class="post-time small text-muted">7th February 2005 22:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">AFAIK, makensis.nsi IS the NSIS install script. Look for the PageReinstall function, and see how it is used.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">phllp_w</span><br />
      <span class="post-time small text-muted">7th February 2005 23:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I tried it but I get an error and my page doesn't show in the installer. :(<br />
      <br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #0000BB">1warning</span><span style="color: #007700">:<br /></span> <span style="color: #0000BB">label</span><span style="color: #DD0000">"same_version"</span><span style="color: #0000BB">notused<br /></span></span> <!-- php buffer end -->
      <hr />
      Here's my code<br />
      PHP Code:
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">Function</span><span style="color: #0000BB">PageReinstall<br />
      <br />
      ReadRegStr$R0HKLM</span><span style="color: #DD0000">"Software\NAME"""<br />
      <br /></span> <span style="color: #0000BB">StrCmp$R0</span><span style="color: #DD0000">""</span><span style="color: #0000BB">0</span><span style="color: #007700">+</span><span style="color: #0000BB">2<br />
      Abortci8<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">Detectversion<br />
      ReadRegDWORD$R0HKLM</span><span style="color: #DD0000">"Software\NAME""VersionMajor"<br /></span> <span style="color: #0000BB">IntCmp$R0</span><span style="color: #007700">${</span><span style="color: #0000BB">VER_MAJOR</span><span style="color: #007700">}</span><span style="color: #0000BB">minor_checknew_versionolder_version<br />
      minor_check</span><span style="color: #007700">:<br /></span> <span style="color: #0000BB">ReadRegDWORD$R0HKLM</span><span style="color: #DD0000">"Software\NAME""VersionMinor"<br /></span> <span style="color: #0000BB">IntCmp$R0</span><span style="color: #007700">${</span><span style="color: #0000BB">VER_MINOR</span><span style="color: #007700">}</span><span style="color: #0000BB">new_versionolder_version<br />
      <br />
      new_version</span><span style="color: #007700">:<br />
      <br />
      !</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_WRITE</span><span style="color: #DD0000">"makensis.ini""Field1""Text""AnolderversionofNAMEisinstalledonyoursystem.It'srecommendedthatyouuninstallthecurrentversionbeforeinstalling.SelecttheoperationyouwanttoperformandclickNexttocontinue."<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_WRITE</span><span style="color: #DD0000">"makensis.ini""Field2""Text""Uninstallbeforeinstalling"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_WRITE</span><span style="color: #DD0000">"makensis.ini""Field3""Text""Donotuninstall"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_HEADER_TEXT</span><span style="color: #DD0000">"AlreadyInstalled""ChoosehowyouwanttoinstallNAME."<br /></span> <span style="color: #0000BB">StrCpy$R0</span><span style="color: #DD0000">"1"<br /></span> <span style="color: #0000BB">Gotoreinst_start<br />
      <br />
      older_version</span><span style="color: #007700">:<br />
      <br />
      !</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_WRITE</span><span style="color: #DD0000">"makensis.ini""Field1""Text""AnewerversionofNAMEisalreadyinstalled!Itisnotrecommendedthatyouinstallanolderversion.Ifyoureallywanttoinstallthisolderversion,it'sbettertouninstallthecurrentversionfirst.SelecttheoperationyouwanttoperformandclickNexttocontinue."<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_WRITE</span><span style="color: #DD0000">"makensis.ini""Field2""Text""Uninstallbeforeinstalling"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_WRITE</span><span style="color: #DD0000">"makensis.ini""Field3""Text""Donotuninstall"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_HEADER_TEXT</span><span style="color: #DD0000">"AlreadyInstalled""ChoosehowyouwanttoinstallNAME."<br /></span> <span style="color: #0000BB">StrCpy$R0</span><span style="color: #DD0000">"1"<br /></span> <span style="color: #0000BB">Gotoreinst_start<br />
      <br />
      same_version</span><span style="color: #007700">:<br />
      <br />
      !</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_WRITE</span><span style="color: #DD0000">"makensis.ini""Field1""Text""NAME${VER_DISPLAY}isalreadyinstalled.SelecttheoperationyouwanttoperformandclickNexttocontinue."<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_WRITE</span><span style="color: #DD0000">"makensis.ini""Field2""Text""ReinstallNAME${VER_DISPLAY}"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_WRITE</span><span style="color: #DD0000">"makensis.ini""Field3""Text""UninstallNAME${VER_DISPLAY}"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_HEADER_TEXT</span><span style="color: #DD0000">"AlreadyInstalled""Choosethemaintenanceoptiontoperform."<br /></span> <span style="color: #0000BB">StrCpy$R0</span><span style="color: #DD0000">"2"<br />
      <br /></span> <span style="color: #0000BB">reinst_start</span><span style="color: #007700">:<br />
      !</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_DISPLAY</span><span style="color: #DD0000">"makensis.ini"<br />
      <br /></span> <span style="color: #0000BB">FunctionEnd<br />
      <br /></span> <span style="color: #007700">Function</span><span style="color: #0000BB">PageLeaveReinstall<br />
      <br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_READ$R1</span><span style="color: #DD0000">"makensis.ini""Field2""State"<br />
      <br /></span> <span style="color: #0000BB">StrCmp$R0</span><span style="color: #DD0000">"1"</span><span style="color: #0000BB">0</span><span style="color: #007700">+</span><span style="color: #0000BB">2<br />
      StrCmp$R1</span><span style="color: #DD0000">"1"</span><span style="color: #0000BB">reinst_uninstallreinst_done<br />
      <br />
      StrCmp$R0</span><span style="color: #DD0000">"2"</span><span style="color: #0000BB">0</span><span style="color: #007700">+</span><span style="color: #0000BB">3<br />
      StrCmp$R1</span><span style="color: #DD0000">"1"</span><span style="color: #0000BB">reinst_donereinst_uninstall<br />
      <br />
      reinst_uninstall</span><span style="color: #007700">:<br /></span> <span style="color: #0000BB">ReadRegStr$R1HKLM</span><span style="color: #DD0000">"Software\NAME""UninstallString"<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">Rununinstaller<br />
      HideWindow<br />
      <br />
      ClearErrors<br />
      ExecWait</span><span style="color: #DD0000">'$R1_?=$INSTDIR'<br />
      <br /></span> <span style="color: #0000BB">IfErrorsno_remove_uninstaller<br />
      IfFileExists</span><span style="color: #DD0000">"$INSTDIR\NAMEUninstall.exe"</span><span style="color: #0000BB">no_remove_uninstaller<br />
      <br />
      Delete$R1<br />
      RMDir$INSTDIR<br />
      <br />
      no_remove_uninstaller</span><span style="color: #007700">:<br />
      <br /></span> <span style="color: #0000BB">StrCmp$R0</span><span style="color: #DD0000">"2"</span><span style="color: #0000BB">0</span><span style="color: #007700">+</span><span style="color: #0000BB">2<br />
      Quit<br />
      <br />
      BringToFront<br />
      <br />
      reinst_done</span><span style="color: #007700">:<br />
      <br /></span> <span style="color: #0000BB">FunctionEnd<br /></span></span> <!-- php buffer end -->
      <hr />
      This installer is for a product with v1.3, it needs to check for 1.0 and 1.1. No minor versions or builds are needed.<br />
      <br />
      One more thing, makensis,ini is mentioned alot, what is it all about?<br />
      <br />
      Any <b>help</b> would be appreciated. :)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pidgeot</span><br />
      <span class="post-time small text-muted">8th February 2005 10:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The warning occurs because you removed checks for revision number and build number without correcting the previous code. Replace</p>
      <pre>
<code>  minor_check: <br />    ReadRegDWORD $R0 HKLM "SoftwareNAME" "VersionMinor" <br />    IntCmp $R0 ${VER_MINOR} new_version older_version </code>
</pre>with
      <pre>
<code>  minor_check: <br />    ReadRegDWORD $R0 HKLM "SoftwareNAME" "VersionMinor" <br />    IntCmp $R0 ${VER_MINOR} same_version new_version older_version </code>
</pre>or simply define Revision and Build as 0, using the older code.<br />
      <br />
      To make the page display, make sure you actually define the page
      <pre>
<code><br />!insertmacro MUI_PAGE_WELCOME<br />!insertmacro MUI_PAGE_LICENSE "..\license.txt"<br />Page custom PageReinstall PageLeaveReinstall<br />!insertmacro MUI_PAGE_COMPONENTS<br />!insertmacro MUI_PAGE_DIRECTORY<br />!insertmacro MUI_PAGE_INSTFILES</code>
</pre>as well as any variables (VersionMajor, etc.) and functions (PageReinstallLeave) used.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">phllp_w</span><br />
      <span class="post-time small text-muted">8th February 2005 22:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for your help. ;)<br />
      <br />
      . Replaced that code, and added "Page custom PageReinstall PageLeaveReinstall" to my pages list.<br />
      . Made the installer make a reg key with VersionMajor, etc, . Defined VersionMajor, Minor, etc.<br />
      . Made the PageLeaveReinstall function so I think that's it...<br />
      <br />
      I get NO errors, but it still doesn't show up when installing. :( What else could I have done wrong?<br />
      Would it help if I emailed you my entire script so you can see what the prob is?<br />
      <br />
      Thanks again.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pidgeot</span><br />
      <span class="post-time small text-muted">9th February 2005 01:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It would be better to post it here on the forums, so I'm not the only one who can help you - to be honest, I'm just working from what I see in makensis.nsi. If you click the "Post a Reply" button, you can attach your .NSI file to your post. If need be, it can also be zipped (to save space).<br />
      <br />
      Of course, if you feel uncomfortable with doing that, go ahead and e-mail me.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">phllp_w</span><br />
      <span class="post-time small text-muted">9th February 2005 22:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have attached it to this post.<br />
      Just so you know I'm using the default makensis.ini as my .ini file, if makes any difference.<br />
      Thanks again for the help. ;)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pidgeot</span><br />
      <span class="post-time small text-muted">10th February 2005 07:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">While you've correctly put the .ini file as ReserveFile, you don't initialize the InstallOptions plugin in .onInit. This is required to show custom pages (refer to the InstallOptions readme).<br />
      <br />
      You need to insert this code in your .onInit:<br /></p>
      <pre>
<code>!insertmacro MUI_INSTALLOPTIONS_EXTRACT "makensis.ini"</code>
</pre><br />
      <br />
      Replace makensis.ini with the exact file name and path used in your ReserveFile command. I suggest you keep the script and .ini in the same directory on installation, to minimize errors (deep-linking doesn't seem to work).
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">phllp_w</span><br />
      <span class="post-time small text-muted">10th February 2005 15:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I already did all the things you mentioned about the .ini but I forgot about the custom page.<br />
      <br />
      THANKS a million buddy, now everything works fine. :D</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
