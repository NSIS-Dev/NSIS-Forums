<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="GetWindowsVer" />

  <title>GetWindowsVer - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">GetWindowsVer</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=169445">GetWindowsVer</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">o_owd</span><br />
      <span class="post-time small text-muted">15th February 2004 12:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>GetWindowsVer</strong><br />
      hello!<br />
      <br />
      i have a small problem. i tried to fix this, but i don't know what to do. in my script i use <b>GetWindowsVer</b> for my shortcuts. if it is win9x platform i use rundll32 from <b>WINDIR</b>, else from <b>SYSDIR</b>. the problem is that the shortcut is created always with <b>WINDIR</b> path. a part from the script is attached. i do not understand this. i tested on WinXP, Win2000, and WinMe.<br />
      <br />
      thanks.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">15th February 2004 12:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Maybe it's related to LogicLib, try using standard commands.<br />
      <br />
      Does rundll32 only exist in WINDIR on Win9x?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">o_owd</span><br />
      <span class="post-time small text-muted">15th February 2004 12:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">i will try and see the results.<br />
      rundll32 exists in:<br />
      <br />
      windir - win9x<br />
      and<br />
      sysdir - winnt/2000/xp<br />
      <br />
      thanks.<br />
      <br />
      edit:<br />
      <br />
      i modified the code to look like this :<br />
      <br /></p>
      <pre>
<code>CallGetWindowsVersion
<br />MessageBoxMB_OK</code><span style="color: #DD0000">"=$R0="
<br /></span><span style="color: #0000BB">Pop$R0
<br />MessageBoxMB_OK</span><span style="color: #DD0000">"=$R0="
</span>
</pre>the 1st message box show : "1"<br />
      and the second - nothing.<br />
      <br />
      is this ok ?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">15th February 2004 13:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The value of the first one has nothing to do with GetWindowsVersion.<br />
      The second one should show the version.<br />
      <br />
      That means that the problem is related to GetWindowsVersion. Can you check the registry keys used by this function?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">o_owd</span><br />
      <span class="post-time small text-muted">15th February 2004 13:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">well, i got it - almost.<br />
      <br />
      i changed $R0 to $R6 and it worked.<br />
      <br />
      $R0 - i am using this a lot before this<br />
      $R6 - i am not using this in my script.<br />
      <br />
      the funny thing is that after that, i changed back to $R0 and (surprise) it works. :igor: so at this point i can't make it to NOT work.<br />
      <br />
      i revert my windows (system restore) and try again with $R6 or $R0 and it does NOT work. :igor: i don't get it.<br />
      <br />
      if you want to investigate, i will attach the whole script.<br />
      <br />
      thanks.<br />
      <br />
      edit:<br />
      <br />
      i tried with a messagebox inside the GetWindowsVersion function. i got the same result - nothing inside $R0.<br />
      maybe this is important - the function GetWindowsVersion is not in my script. i include it : " !include "include\WindowsVer.nsh"</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">VegetaSan</span><br />
      <span class="post-time small text-muted">15th February 2004 15:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Are you making a Codec Pack. If awnser yes<br />
      Then you arent the only one, me too<br />
      <br />
      What do you really want.<br />
      Do you want to Detect the Windowd Version<br />
      and if it is Win98 then you want to create this<br />
      ShortCut<br />
      <br />
      <font size="1">CreateShortCut "$SMPROGRAMS\$STARTMENU_FOLDER\Matrix Mixer Configuration.lnk" "$WINDIR\rundll32.exe" '"$INSTDIR\MatrixMixer\matrix_mixer.ax",config'</font><br />
      <br />
      Is this what you want?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">15th February 2004 15:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Maybe at least you (o_owd) can answer Joost's question.<br />
      <br /></p>

      <blockquote>
        Can you check the registry keys used by this [GetWindowsVersion] function?
      </blockquote>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">VegetaSan</span><br />
      <span class="post-time small text-muted">15th February 2004 15:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just go to<br />
      <br />
      <a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=531&amp;instances=0" target="_blank">http://nsis.sourceforge.net/archive/...31&amp;instances=0</a><br />
      <br />
      My Script :) :) :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">o_owd</span><br />
      <span class="post-time small text-muted">15th February 2004 15:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by deguix</i><br />
        <b>Maybe at least you (o_owd) can answer Joost's question.</b>
      </blockquote>i am working on it. i am checking. there's no need to jump up (deguix)...
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">15th February 2004 17:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by VegetaSan</i><br />
        <b>Just go to<br />
        <br />
        <a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=531&amp;instances=0" target="_blank">http://nsis.sourceforge.net/archive/...31&amp;instances=0</a><br />
        <br />
        My Script :) :) :)</b>
      </blockquote>The link is wrong. Is going to NSIS Archive but not showing any page.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">VegetaSan</span><br />
      <span class="post-time small text-muted">15th February 2004 20:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just go to the NSIS Archive and search for<br />
      author "VegetaSan" and look for Windows Decection</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">15th February 2004 20:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There is already a Windows version detection function available. There is no need to create duplicate things.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">VegetaSan</span><br />
      <span class="post-time small text-muted">15th February 2004 20:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry didnt knew</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pgpatron</span><br />
      <span class="post-time small text-muted">16th February 2004 19:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I know it is not the same thing but I have a extrange problem with that function. I am trying to use the GetWindowsVersion updated by Joost:<br />
      <br />
      I enclosed it to my install script and I have been trying it only in w2000. It runs ok. It returns '2000' correctly.<br />
      <br />
      But now, I start to work in the links for my program for the start menu folder.<br />
      <br />
      I added the registry key:<br />
      !define MUI_STARTMENUPAGE_REGISTRY_ROOT "HKCU"<br />
      !define MUI_STARTMENUPAGE_REGISTRY_KEY "Software\${GROUP}\${APPNM}"<br />
      !define MUI_STARTMENUPAGE_REGISTRY_VALUENAME "Start Menu Folder"<br />
      as it is shown in the startmenu.nsi example<br />
      and the GetWindowsVersion returns '' now!!<br />
      <br />
      I have been doing some test and if I comment the last<br />
      !define the GetWindowsVersion returns again '2000'.<br />
      <br />
      Can you tell me why?<br />
      <br />
      Thanks.<br />
      <br />
      Pedro</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">16th February 2004 20:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That should have nothing to do with this function.<br />
      <br />
      Please attach a script that can be compiled on every system and reproduces this behavior.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">o_owd</span><br />
      <span class="post-time small text-muted">17th February 2004 20:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">well, i do not understand why it does not work.<br />
      <br />
      a strange thing i noticed : i tested with my script (lets say "prog1") and it does not work. i created a new script that containes only GetWindowsVersion ("prog2"). i tested it (prog2) and, of course it works. but!!! after that i tested again my script (prog1) and it works too.<br />
      <br />
      i don't know if you understand me, but i simply don't get it. maybe it's something that i don't see, something very simple. i run prog1 and it does not work. then i run prog2 - it works - and after that prog1 works too !?!<br />
      <br />
      the whole script it's attached. :cry:<br />
      thanks.<br />
      <br />
      PS: thanks Joost Verburg, pgpatron (i cannot reproduce that), VegetaSan, deguix, kichik, and all the others. thanks for your help and support, sorry for being sometimes a pain in the a.. .</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">18th February 2004 07:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Can you please attach a script that compiles on every system? I can't test this one.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">18th February 2004 11:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try to use dumpstate::debug before and after you call the function and after you pop a variable from stack (You can find that in the Archive -&gt; Downloads section), and say the results it give.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">o_owd</span><br />
      <span class="post-time small text-muted">18th February 2004 17:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">thanks deguix! this really helped me.<br />
      <br />
      i will attach a "smaller" script that should compile on every system. you only need dumpstate from the arhive. the link is above.<br />
      <br />
      the first time i run it, it does not work.<br />
      if i run it again it works.<br />
      <br />
      please tell me if you can reproduce this.<br />
      <br />
      thanks.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">18th February 2004 18:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What about a single GetWindowsVersion call? Does that work?<br />
      <br />
      If it does the problem is related to something else.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Freezerman350</span><br />
      <span class="post-time small text-muted">20th July 2004 21:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">SetOutPath "$INSTDIR\dataeasydeal"<br />
      File "dataeasydeal\data.mdb"<br />
      File "dataeasydeal\dealerinf.mdb"<br />
      File "dataeasydeal\rsharedveh.mdb"<br />
      <br />
      ;==================PARTAGE VÉRIF WIN==========================<br />
      StrCpy $1 "$windir"<br />
      IfFileExists "$1\winver.exe" +2<br />
      StrCpy $1 "$sysdir"<br />
      GetDllVersion "$1\winver.exe" $R0 $R1<br />
      IntOp $R2 $R0 / 0x00010000<br />
      IntOp $R3 $R0 &amp; 0x0000FFFF<br />
      IntOp $R4 $R1 / 0x00010000<br />
      IntOp $R5 $R1 &amp; 0x0000FFFF<br />
      StrCpy $0 "$R2.$R3.$R4.$R5"<br />
      <br />
      StrCmp $0 '5.1.2600.0' WinXP NotWinXP<br />
      WinXP:<br />
      messagebox mb_ok "Ver = XP"<br />
      nsExec::Exec 'net share dataeasydeal=c:\dataeasydeal'<br />
      NotWinXP:<br />
      <br />
      StrCmp $0 '4.0.1381.336' WinNT NotWinNT<br />
      WinNT:<br />
      messagebox mb_ok "Ver = NT"<br />
      NotWinNT:<br />
      <br />
      StrCmp $0 '5.0.2195.6703' Win2000 NotWin2000<br />
      Win2000:<br />
      messagebox mb_ok "Ver = 2000"<br />
      NotWin2000:<br />
      <br />
      StrCmp $0 '5.2.3790.0' Win2003 NotWin2003<br />
      Win2003:<br />
      messagebox mb_ok "Ver = 2003"<br />
      NotWin2003:<br />
      <br />
      StrCmp $0 '4.10.0.2222' Win98 NotWin98<br />
      Win98:<br />
      messagebox mb_ok "Ver = 98"<br />
      NotWin98:<br />
      <br />
      ; 2003 = 5.2.3790.0<br />
      ; XP = 5.1.2600.0<br />
      ; 2K = 5.0.2195.6703<br />
      ; NT = 4.0.1381.336<br />
      ; ME = 4.90.0.3000<br />
      ; 98SE = 4.10.0.2222<br />
      ; 98 = 4.10.0.1998<br />
      ; 95S2 = ???<br />
      ; 95 = 4.00.950</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
