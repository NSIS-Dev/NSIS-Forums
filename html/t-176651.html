<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Version Checker Help" />

  <title>Version Checker Help - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Version Checker Help</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=176651">Version Checker Help</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tribe25</span><br />
      <span class="post-time small text-muted">14th April 2004 21:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Version Checker Help</strong><br />
      Below is a little script that I am trying to get to work. I keep getting... install function "GetWindowsVersion" not referenced - zeroing code (3-48) out<br />
      <br />
      I am new to this and don't really understand what that is telling me. Any help would be great. If this does get the Windows version, how would I then tell the installer where to install the files based on the OS. Thanks in advance.<br />
      <br />
      <br />
      <br />
      ; Asks the user if they really want to install and register the files.<br />
      Function .onInit<br />
      MessageBox MB_YESNO "This will install Safari Remote. Do you wish to continue?" IDYES gogogo<br />
      Abort<br />
      gogogo:<br />
      FunctionEnd<br />
      <br />
      <br />
      OutFile "Testing.exe"<br />
      <br />
      Function GetWindowsVersion<br />
      <br />
      Push $R0<br />
      Push $R1<br />
      <br />
      ClearErrors<br />
      <br />
      ReadRegStr $R0 HKLM \<br />
      "SOFTWARE\Microsoft\Windows NT\CurrentVersion" CurrentVersion<br />
      <br />
      IfErrors 0 lbl_winnt<br />
      <br />
      ; we are not NT<br />
      ReadRegStr $R0 HKLM \<br />
      "SOFTWARE\Microsoft\Windows\CurrentVersion" VersionNumber<br />
      <br />
      StrCpy $R1 $R0 1<br />
      StrCmp $R1 '4' 0 lbl_error<br />
      <br />
      StrCpy $R1 $R0 3<br />
      <br />
      StrCmp $R1 '4.0' lbl_win32_95<br />
      StrCmp $R1 '4.9' lbl_win32_ME lbl_win32_98<br />
      <br />
      lbl_win32_95:<br />
      StrCpy $R0 '95'<br />
      Goto lbl_done<br />
      <br />
      lbl_win32_98:<br />
      ;;beginning of additions to support win 98 SE<br />
      push $R0<br />
      push "."<br />
      ; call strstr<br />
      pop $R0<br />
      StrCpy $R0 $R0 "" 1<br />
      StrCmp $R0 "10.2222" lbl_win32_98SE<br />
      StrCpy $R0 '98' ;;this line was not added<br />
      Goto lbl_done ;;this line was not added either<br />
      <br />
      lbl_win32_98SE:<br />
      StrCpy $R0 '98 SE'<br />
      Goto lbl_done<br />
      ;;end of additions to support win 98 SE<br />
      lbl_win32_ME:<br />
      StrCpy $R0 'ME'<br />
      Goto lbl_done<br />
      <br />
      lbl_winnt:<br />
      <br />
      StrCpy $R1 $R0 1<br />
      <br />
      StrCmp $R1 '3' lbl_winnt_x<br />
      StrCmp $R1 '4' lbl_winnt_x<br />
      <br />
      StrCpy $R1 $R0 3<br />
      <br />
      StrCmp $R1 '5.0' lbl_winnt_2000<br />
      StrCmp $R1 '5.1' lbl_winnt_XP<br />
      StrCmp $R1 '5.2' lbl_winnt_2003 lbl_error<br />
      <br />
      lbl_winnt_x:<br />
      StrCpy $R0 "NT $R0" 6<br />
      Goto lbl_done<br />
      <br />
      lbl_winnt_2000:<br />
      Strcpy $R0 '2000'<br />
      Goto lbl_done<br />
      <br />
      lbl_winnt_XP:<br />
      Strcpy $R0 'XP'<br />
      Goto lbl_done<br />
      <br />
      lbl_winnt_2003:<br />
      Strcpy $R0 '2003'<br />
      Goto lbl_done<br />
      <br />
      lbl_error:<br />
      Strcpy $R0 ''<br />
      lbl_done:<br />
      <br />
      Pop $R1<br />
      Exch $R0<br />
      <br />
      FunctionEnd<br />
      <br />
      <br />
      Section "New"<br />
      <br />
      SetShellVarContext ALL<br />
      <br />
      ; This section adds mainly DLL files to the Windows\system folder and need to be registered<br />
      <br />
      SetOutPath C:\Test<br />
      <br />
      File ..\actbar.oca<br />
      <br />
      SectionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">14th April 2004 21:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You never Call the function so it zeros it out.<br />
      <br />
      You need to add this to your section:<br />
      Call GetWindowsVersion<br />
      Pop $R0</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tribe25</span><br />
      <span class="post-time small text-muted">14th April 2004 22:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, got the Windows version, thanks. Now, if the version is Windows XP I need it to install to a certain directory, like Windows\System(32) and if WinNT then WinNT\System32. I got all the files installed correctly, just need to read the version and then install based off answer. Thanks again for the help.<br />
      <br />
      !define VERSION "1.0.0"<br />
      <br />
      Function .onInit<br />
      MessageBox MB_YESNO "This will install Safari Remote. Do you wish to continue?" IDYES gogogo<br />
      Abort<br />
      gogogo:<br />
      Call "GetWin"<br />
      MessageBox MB_OK|MB_ICONINFORMATION $0<br />
      FunctionEnd<br />
      <br />
      Function "GetWIN"<br />
      ReadRegStr $0 HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion" ProductName<br />
      StrCmp $0 "" +1 +2<br />
      ReadRegStr $0 HKLM "SOFTWARE\Microsoft\Windows NT\CurrentVersion" ProductName<br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">14th April 2004 22:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">posted twice see below</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">14th April 2004 22:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you want to check the value of a variable, use StrCmp.<br />
      <br />
      However, you don't need any version detection in this case.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">14th April 2004 22:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You could just use the variable $SYSDIR and it will give you the correct directory and skip the windows detection completely. You can also use $WINDIR if all you want is the directory where Windows is installed. Detecting which version of windows they are running and then installing into that directory doesn't solve your problem because the user can install Windows into whichever directory he wants. It could be c:\mywindir for all you know. So, use the variables above just to make sure you get the right directory.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tribe25</span><br />
      <span class="post-time small text-muted">14th April 2004 22:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, I have files going to Windows\System32...I can use $SYSDIR for that.<br />
      <br />
      I have files going to Windows\System...what would I use for that?<br />
      <br />
      And any files that go into Windows...I use $WINDIR<br />
      <br />
      Am I catching on? Thanks again for the help!!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">14th April 2004 22:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's always been my understanding that the OS only uses one or the other. So, $SYSDIR will get you Windows\System if that is what that machine uses. I could be wrong about that though. I don't see another variable for just plain system so I have to assume that's right.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
