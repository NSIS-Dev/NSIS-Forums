<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="cool wish: installer status updates for exec commands" />

  <title>cool wish: installer status updates for exec commands - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">cool wish: installer status updates for exec commands</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=140364">cool wish: installer status updates for exec commands</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vbgunz</span><br />
      <span class="post-time small text-muted">28th June 2003 02:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>cool wish: installer status updates for exec commands</strong><br />
      I read it is not possible to monitor an executed file and then display its progress on the NSIS install screen. Cool.<br />
      <br />
      How about a psuedo solution? What I mean is I know a good average time an executed file takes to complete. About one minute. During that one minute it appears NSIS has frozen when it hasn't. It just seems to stop installing and displays the message "Execute: File".<br />
      <br />
      My proposed solution I believe is really quite simple. It could look something like this.<br /></p>
      <pre>
<code>ExecWait "$INSTDIR\Application.exe" "+60" "+40"</code>
</pre><br />
      <br />
      "+60" means the application will take around 60 seconds to complete.<br />
      "+40" means 40% of the progress bar should progress in 60 seconds.<br />
      <br />
      I believe this though it might seem simple can help ease users into not thinking the application froze or locked up. I have no real idea on how to implement such an idea but leave it to the NSIS developers to implement it.<br />
      <br />
      A lot can happen in one minute and with the NSIS message of "Execute: File" might lead some users to believe they should go and execute a file...<br />
      <br />
      I would also propose that upon displaying a message like that during install it says "Executing..." rather than "Execute". Executing will probably convince the user something is executing rather than making the user think it is up to them to now execute something.<br />
      <br />
      Just some ideas. They might be minor but I believe they're helpful.<br />
      <br />
      Thanks for the super application. Excellent work indeed.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">28th June 2003 08:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">nsExec::ExecToLog "$INSTDIR\Application.exe"<br />
      Pop $0<br />
      StrCmp $0 0 0 +3<br />
      DetailPrint "Program shut itself down and never finished!"<br />
      Goto +2<br />
      DetailPrint "Program completed successfully!"<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vbgunz</span><br />
      <span class="post-time small text-muted">28th June 2003 09:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Afrow UK,<br />
      <br />
      Does your snippet work with the progress bar, changes the displayed text of Execute or something else? I am sorry but am still quite new. I read this wasn't possible on another post so is this a workaround?<br />
      <br />
      Thank you in advance</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">28th June 2003 10:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">nsExec::ExecToLog will capture the output of the command-line executable (which is an MS-DOS executable) and prints it into the LogWindow.<br />
      It prints the output as it goes along, line-by-line.<br />
      <br />
      This does not, however, make changes to the progress-bar.<br />
      The progress-bar currently only works on which sections are selected, and what is in the sections.<br />
      <br />
      You cannot currently change the progress-bar in any way (except for adding Sleep's, doing jump's, running executables, extracting files etc)<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">28th June 2003 11:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can also use the Banner plug-in to make sure the user knows the installer is doing something. Put a message that describes the ran process, that's the standard on most installers I have seen.<br />
      <br />
      As for your suggestion, I don't know how good this idea would be. What if the process takes longer than 60 seconds? Then the user, again, will think the process is stuck. There is absolutley no way you can predict how long the sub-process will take, even if all it does is sleeping for 60 seconds.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vbgunz</span><br />
      <span class="post-time small text-muted">29th June 2003 23:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you Kichik,<br />
      <br />
      I searched the archive for "banner" but came up empty. I only found frozen bubble and system hardware detection with that keyword.<br />
      <br />
      My idea for an updating progress bar is simple and if it can tie into Afrow UKs solution then NSIS will never seem frozen unless it freezes.<br />
      <br />
      I could understand your arguement of every system being different, finishing jobs at random times but if the progress bar never moves then it'll seem frozen from the start.<br />
      <br />
      My idea is only cosmetic in trying to convince the user that even on executables in which could take a while to finish NSIS is indeed working, installing files, etc.<br />
      <br />
      If an executable takes on average 60 seconds to complete then to be on the safe side and keep the progress bar moving the dev could simply state it will complete on average in two minutes (40% of the progress bar).<br />
      <br />
      If the program then exceeds the two minute time limit and the progress bar stops dead I think its better it stops after two minutes than at execution.<br />
      <br />
      I am not trying to argue anything, in no way trying to state this is a must have. I think NSIS is awesome and I truly appreciate your work on it. It is awesome the way it is now. This is just a wish to keep the progress bar moving.<br />
      <br />
      Thank you Afrow UK,<br />
      <br />
      It seems like I will have nothing but trouble with my current knowledge in trying to nest the "nsExec::ExecToLog" command. Currently the way I have it setup, it works as advertised.<br /></p>
      <pre>
<code>Section "Project_Files" SEC01<br />  SetOutPath "$INSTDIR"<br />  SetOverwrite on<br />  File "Project_Meat.7z"<br />  File "Core_Unpack_Light.bat"<br />  File "7za.exe"<br />  ExecWait "$INSTDIR\Core_Unpack_Light.bat"<br />  ...</code>
</pre><br />
      The above works. But the below presents an unsual problem my knowledge can't get me out of...<br />
      <pre>
<code>Section "Project_Files" SEC01<br />  SetOutPath "$INSTDIR"<br />  SetOverwrite on<br />  File "Project_Meat.7z"<br />  File "Core_Unpack_Light.bat"<br />  File "7za.exe"<br />  nsExec::ExecToLog "$INSTDIR\Core_Unpack_Light.bat"<br />  Pop $0<br />  StrCmp $0 0 0 +3<br />  DetailPrint "Program shut itself down and never finished!"<br />  Goto +2<br />  DetailPrint "Program completed successfully!"</code>
</pre><br />
      What seems to happen is NSIS now looks for the following files "Project_Meat.7z" "Core_Unpack_Light.bat" "7za.exe" in the executed directory. In other words, if I place those three files in the same directory where I execute the installer from those three files will do their magic. But no magic happens in the "$INSTDIR" directory the way ExecWait does it.<br />
      <br />
      I really do not know what I am doing wrong... It might seem like a bug because its definitely bugging me but most likely I am doing something wrong. My current command in the "Core_Unpack_Light.bat" is<br />
      <pre>
<code>"7za.exe" x -y Project_Meat.7z</code>
</pre><br />
      <br />
      I feel really stumped. Just trying to prove to the user something is happening without displaying the dos box and the nsExec command looks like the trick. It just doesn't work for me... Someone help tell me where I am going wrong or please give me an idea on what to try.<br />
      <br />
      Thank you
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vbgunz</span><br />
      <span class="post-time small text-muted">30th June 2003 13:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you Afrow UK,<br />
      <br />
      I made the bat file log into the NSIS window but I can't get it to log "at the time I need it to". I would like to put the nsExec command "within" "Section "Project_Files" SEC01" right after the 7za.exe extracted file but it'll never work.<br />
      <br /></p>
      <pre>
<code>Section "Project_Files" SEC01 ;default<br />  SetOutPath "$INSTDIR" <br />  SetOverwrite on<br />  File "Project_Meat.7z" ;This file needs to be executed!<br />  File "Core_Unpack_Light.bat" ;"7za.exe" x -y Project_Meat.7z<br />  File "7za.exe" ;Required file for 7z execution.<br />  nsExec::ExecToLog "$INSTDIR\Core_Unpack_Light.bat" ;Won't work here!<br />  Pop $0<br />  StrCmp $0 0 0 +3<br />  DetailPrint "Program shut itself down and never finished!"<br />  Goto +2<br />  DetailPrint "Program completed successfully!"</code>
</pre><br />
      The above code comes first in the file installation section. If I replace nsExec with ExecWait everything works out perfectly but I cannot log the bats contents into the NSIS window.<br />
      <br />
      If I use nsExec "regardless of which" right at that very moment in the script for some reason the script will execute it "BUT" their is no waiting. The rest of the NSIS script kicks in and always shuts it down prematurely.<br />
      <br />
      *If* I place the nsExec command into a section which comes directly after "Section "Project_Files" SEC01" *then* nsExec will work as it is supposed too.<br />
      <br />
      How do I get it nsExec to execute the 7z file *correctly* and wait before any of the other files are installed?<br />
      <br />
      Thank you Afrow UK
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vbgunz</span><br />
      <span class="post-time small text-muted">30th June 2003 13:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I think I figured it out. I had to add another setOutPath for the actual files...Before</p>
      <pre>
<code>Section "Project_Files" SEC01 ;default<br />  SetOutPath "$INSTDIR" <br />  SetOverwrite on<br />  File "Project_Meat.7z" ;This file needs to be executed!<br />  File "Core_Unpack_Light.bat" ;"7za.exe" x -y Project_Meat.7z<br />  File "7za.exe" ;Required file for 7z execution.<br />  nsExec::ExecToLog "$INSTDIR\Core_Unpack_Light.bat" ;Won't work here!</code>
</pre>After
      <pre>
<code>Section "Project_Files" SEC01 ;default<br />  SetOutPath "$INSTDIR" <br />  SetOverwrite on<br />  SetOutPath "$INSTDIR"<br />  File "Project_Meat.7z" ;This file needs to be executed!<br />  File "7za.exe" ;Required file for 7z execution.<br />  nsExec::ExecToLog '"$INSTDIR\7za.exe" x -y Project_Meat.7z'</code>
</pre>If you've notice I also removed the bat file and simply added the command direct to nsExec. It worked with the bat file but I was simply missing the the extra SetOutPath above the files.<br />
      <br />
      It works, sorry for posting early, just don't want to leave this unanswered as it is indeed rude to do so. Thank you Kichik and Afrow UK for your help and pointers. It is very appreciated :)
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
