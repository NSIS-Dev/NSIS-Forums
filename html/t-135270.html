<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="$INSTDIR does not initialize in .onInit function at runtime"><title>$INSTDIR does not initialize in .onInit function at runtime - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">$INSTDIR does not initialize in .onInit function at runtime</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=135270">$INSTDIR does not initialize in .onInit function at runtime</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">vtsaran</span><br><span class="post-time small text-muted">13th May 2003 19:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>$INSTDIR does not initialize in .onInit function at runtime</strong><br>Hello, listers!<br>I am at a loss.<br>I have two almost identical scripts. In both of them I initialize $instdir at compile time. Then, in the .onInit I have:<br><br>IfFileExists "$INSTDIR\myfiles*.*" Jump_if_Good Jump_If_Bad<br><br>but $INSTDIR does not initialize and installer behaves as though the files are not found. If I substitute $INSTDIR with an actual directory, then everything works fine.<br>The interesting thing is that the function which initializes the $INSTDIR at compile time is exactly the same in both scripts.<br><br>Do you have any idea about the possible causes of this misbehavior?<br><br>Thanks,<br>Victor</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rsegal</span><br><span class="post-time small text-muted">13th May 2003 19:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It would be helpful to see the function that initializes $INSTDIR</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">13th May 2003 20:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">attach script, dude :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">14th May 2003 11:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">$INSTDIR is set before .onInit if InstallDir and/or InstallDirRegKey are specified.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">vtsaran</span><br><span class="post-time small text-muted">14th May 2003 16:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hello, guys!<br>OK, here goes the script.<br>Regards,<br>Vic</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">14th May 2003 16:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I find you error:<br></p><pre>
<code><br>InstallDir "$INSTDIR"<br></code>
</pre><br>
      The above line is wrong, is should:<br>
      <pre>
<code><br>InstallDir "$PROGRAMFILES\${MUI_PRODUCT}" ;or another you want<br></code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vtsaran</span><br>
      <span class="post-time small text-muted">14th May 2003 16:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, it works in another script. Plus I want my $INSTDIR to be generated at runtime depending on the conclutions drawn from reading appropriate registry keys.<br>
      Regards,<br>
      Victor</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br>
      <span class="post-time small text-muted">14th May 2003 17:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">$INSTDIR contains the installation directory "variable"<br>
      from one of these three:<br>
      1. From the registry using the <b>InstallDirRegKey</b>.<br>
      2. When you use the <b>InstallDir</b>.<br>
      3. When the user use the <b>Browse button</b> the change the Installation path.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">14th May 2003 17:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here's how it works:<br>
      InstallDir "$PROGRAMFILES\Jeff"<br>
      $INSTDIR="C:\Program Files\Jeff"</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vtsaran</span><br>
      <span class="post-time small text-muted">14th May 2003 17:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you everybody. I can't believe how unattentive I was. There was a typing error in the line<br>
      <br>
      InstallDirRegKey HKLM "Software\${MUI_PRODUCT}" "Install_Dir"<br>
      <br>
      I accidentally omitted a quote.<br>
      So the following reads correct and works fine.<br>
      <br>
      InstallDir "$INSTDIR"<br>
      InstallDirRegKey HKLM "Software\${MUI_PRODUCT}" "Install_Dir"<br>
      <br>
      Now my $INSTDIR is defined at run time.<br>
      <br>
      Regards,<br>
      Vic</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">14th May 2003 20:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Your code is still wrong. The InstallDir sets $INSTDIR if InstallDirRegKey fails. You set something to itself when it's empty. It only works for you because the registry key is there, once it's gone you'll get an empty one instead. If you do want an empty $INSTDIR if the registry key is not there then you just don't need InstallDir.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br>
      <span class="post-time small text-muted">14th May 2003 21:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have this and it works:<br></p>
      <pre>
<code><br>InstallDirRegKey HKLM "Software\${MUI_PRODUCT}" "Install_Dir" <br>InstallDir "C:\path" <br></code>
</pre><br>
      This isnÂ´t right: InstallDir "$INSTDIR"
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vtsaran</span><br>
      <span class="post-time small text-muted">19th May 2003 21:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK, but then I don't understand something. How would I change $INSTDIR at run time? A very basic scenario: my installation directory will change depending on the version of another application installed. If I declare some path for InstallDir, then I have to stick with it. That's not what I want.<br>
      My current scenario works because if there is no InstallRegKey for my application, then I assume it was never installed on this computer, otherwise, I check for existence of certain files.<br>
      <br>
      Regards,<br>
      Vic</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br>
      <span class="post-time small text-muted">19th May 2003 21:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">In the Nsis Manual check for "SetOutPath" instruction.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vtsaran</span><br>
      <span class="post-time small text-muted">19th May 2003 21:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello,<br>
      Kichik, you were right, I grant. I took out the line<br>
      <br>
      InstallDir "$INSTDIR"<br>
      <br>
      and it still works the same. I think I understand my mistake now.<br>
      Thanks everybody.<br>
      <br>
      Regards,<br>
      Vic</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">21st May 2003 13:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just to make sure everybody understand, this is how it works:<br></p>

      <ul>
        <li>Installer starts</li>

        <li>The value specified using InstallDir is copied to $INSTDIR</li>

        <li>The value specified using InstallDirRegKey (if found) is copied to $INSTDIR</li>

        <li>.onInit is called, and later everything else</li>
      </ul><br>
      You can change $INSTDIR wherever you want in the script with worrying about InstallDir and InstallDirRegKey. Those just give the initial values.
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>