<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Online / Offline - Installer / Updater" />

  <title>Online / Offline - Installer / Updater - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Online / Offline - Installer / Updater</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=172074">Online / Offline - Installer / Updater</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">stb</span><br />
      <span class="post-time small text-muted">4th March 2004 22:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Online / Offline - Installer / Updater</strong><br />
      Hello!<br />
      <br />
      I didn't find any installer for my requirements until I looked at NSIS which looks great to me as it is fully programmable. After reading quite some docs, posts and archive entries I'm not sure how to solve the following scenario: Updater/Installer with online/offline mode. Maybe someone can give me some hints or points me to the right direction.<br />
      <br />
      The complicated part first: online/offline<br />
      I want two installers, one with all needed files (offline for CDROM) and one without files (online web installer). The online installer has to download some version information, compare this to already installed files (my software, Microsoft DLLs, ...) and download all newer or missing files. The offline installer should ask the user to use the online mode or just use the files in the package. Offline mode is obvious but online mode has to download version info and compare this with already installed files AND with version of the packaged files (of course each file has its own version).<br />
      <br />
      Second component: updater/installer<br />
      I want all installers to detect earlier versions and go in update mode instead of install mode (saw some example for this already). Files may have been added to the software or deleted, so I think about silently uninstalling the software (old uninstall.exe) and installing it from scratch, but this would remove some files I now have to download again (unchanged files). But how do I know what the update has to uninstall?<br />
      <br />
      The offline-online thing seems to be solvable like:<br />
      - extracting packaged files (if present) to TMP<br />
      - asking about online mode (if no files in TMP, force online mode)<br />
      - download online version, compare to installed version and packaged version (in offline mode just compare packaged version to installed version)<br />
      - download missing components<br />
      - install from TMP (copy files)<br />
      - installing some uninstaller<br />
      <br />
      Maybe this will get complicated in detail (maintain all those version infos), because not all files may have version compiled into (TXT vs EXE/DLL).<br />
      <br />
      Updating seems easy if no files get removed from the software (I don't want to maintain uninstall information in .nsi for each previous software version). But Updater in online mode should compare online version to installed version before uninstalling the old one and save this file (it's not necessary to download this file again). In general no file should be downloaded if the online version is not newer than the installed one or the packaged one (if available). State after updating should be the same as uninstalling with the old uninstall.exe and downloading and installing a new installer package.<br />
      <br />
      To make the problem no more complicated: I don't need optional components (at this time...), so always all components will be installed. But I see problems combining the online/offline part with updating/installing.<br />
      <br />
      Sorry for the long post, maybe someone has similar needs or ideas.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th March 2004 12:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I couldn't find anything that can't and wasn't done during my brief reading. It seems you need nothing more than NSISdl, some INI files on the server and maybe a hash plug-in like the <a href="http://nsis.sourceforge.net/archive/download.php?file=md5plugin.zip" target="_blank">md5 plug-in</a> (to compare files without versions such as TXT files).<br />
      <br />
      I think it would be best if you start with what you have and ask more specific questions as you go. It's all possible so there shouldn't be any serious problems along the way...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">willykelleher</span><br />
      <span class="post-time small text-muted">5th March 2004 17:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have done this using an ini file that I have online and I package it in the installer. If the program can't download the one online it uses the one that is packaged with it. Basicly the ini file has the minimum version I want at the client and and it also has a url where the latest can be downloaded from. I check the version's by looking them up in the registry or an xml file for 1 of the programs.<br />
      <br />
      I use a !define in the beginning of the installer to tell it to Download the programs or package them up with the in staller to put on CD. I have 4 different programs and each one can be included with installer or forced to be downloaded seperately.<br />
      <br />
      Here is a snipet where I DL a utility pack or include it based on the !define. I comment it out to force the files to be included in the installer<br />
      <br />
      !define INS_UTILS "HTTP"<br />
      <br />
      ; later in installer<br />
      Function UpdateUtils<br />
      Push $R0<br />
      ReadRegStr $R0 HKLM "SOFTWARE\MPI\Millennium" "InstallPath"<br />
      ; MessageBox MB_OK "M3 Install Path $R0"<br />
      StrCmp $R0 "" lbl_done lbl_install<br />
      lbl_install:<br />
      !ifdef INS_UTILS<br />
      call DLUTILS<br />
      goto lbl_done<br />
      !endif<br />
      !ifndef INS_UTILS<br />
      SetOutPath "$R0\QPS"<br />
      File /r ${QPS_IN}\UTILS<br />
      !endif<br />
      lbl_done:<br />
      Exch $R0<br />
      FunctionEnd<br />
      <br />
      Function GetConfig<br />
      CreateDirectory "$INSTDIR\CFG"<br />
      nsisdl::download "${CFG_ADDR}" "$INSTDIR\CFG\HTTP_CFG.ini"<br />
      ;Dumpstate::debug<br />
      ; messagebox MB_OK "DOWNLOAD ${CFG_ADDR} = $0"<br />
      pop $0<br />
      StrCmp $0 "success" success<br />
      SetDetailsView show<br />
      DetailPrint "download failed: $0"<br />
      goto uselocal<br />
      success:<br />
      SetDetailsView show<br />
      DetailPrint "download Sucess: $0"<br />
      goto skip<br />
      uselocal:<br />
      SetOutPath "$INSTDIR\CFG"<br />
      File /r ${QPS_IN}\HTTP_CFG.ini<br />
      skip:<br />
      !define CFG_HERE "$0"<br />
      ;Dumpstate::debug<br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">willykelleher</span><br />
      <span class="post-time small text-muted">5th March 2004 17:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have done this using an ini file that I have online and I package it in the installer. If the program can't download the one online it uses the one that is packaged with it. Basicly the ini file has the minimum version I want at the client and and it also has a url where the latest can be downloaded from. I check the version's by looking them up in the registry or an xml file for 1 of the programs.<br />
      <br />
      I use a !define in the beginning of the installer to tell it to Download the programs or package them up with the in staller to put on CD. I have 4 different programs and each one can be included with installer or forced to be downloaded seperately.<br />
      <br />
      Here is a snipet where I DL a utility pack or include it based on the !define. I comment it out to force the files to be included in the installer<br />
      <br />
      !define INS_UTILS "HTTP"<br />
      <br />
      ; later in installer<br />
      Function UpdateUtils<br />
      Push $R0<br />
      ReadRegStr $R0 HKLM "SOFTWARE\MPI\Millennium" "InstallPath"<br />
      ; MessageBox MB_OK "M3 Install Path $R0"<br />
      StrCmp $R0 "" lbl_done lbl_install<br />
      lbl_install:<br />
      !ifdef INS_UTILS<br />
      call DLUTILS<br />
      goto lbl_done<br />
      !endif<br />
      !ifndef INS_UTILS<br />
      SetOutPath "$R0\QPS"<br />
      File /r ${QPS_IN}\UTILS<br />
      !endif<br />
      lbl_done:<br />
      Exch $R0<br />
      FunctionEnd<br />
      <br />
      Function GetConfig<br />
      CreateDirectory "$INSTDIR\CFG"<br />
      nsisdl::download "${CFG_ADDR}" "$INSTDIR\CFG\HTTP_CFG.ini"<br />
      ;Dumpstate::debug<br />
      ; messagebox MB_OK "DOWNLOAD ${CFG_ADDR} = $0"<br />
      pop $0<br />
      StrCmp $0 "success" success<br />
      SetDetailsView show<br />
      DetailPrint "download failed: $0"<br />
      goto uselocal<br />
      success:<br />
      SetDetailsView show<br />
      DetailPrint "download Sucess: $0"<br />
      goto skip<br />
      uselocal:<br />
      SetOutPath "$INSTDIR\CFG"<br />
      File /r ${QPS_IN}\HTTP_CFG.ini<br />
      skip:<br />
      !define CFG_HERE "$0"<br />
      ;Dumpstate::debug<br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
