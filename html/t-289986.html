<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="RMDir Bug?"><title>RMDir Bug? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">RMDir Bug?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=289986">RMDir Bug?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">hungryOrb</span><br><span class="post-time small text-muted">10th April 2008 17:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>RMDir Bug?</strong><br>hi,<br>erm when using:<br><br>RMDir /r "$INSTDIR"<br><br>the uninstaller starts deleting the Program Files folder, even if the app is not installed there. My small experience suggests to me that $INSTDIR does not carry the correct path to the uninstaller. It was suggested to me to put the $INSTDIR path into the registry at install time, and then extract it later. I'll post some results ;]<br><br>Edit1: Oh two things to note:<br>1) My uninstaller is placed inside ProgramFiles.<br>2) and the default install is Program Files</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">10th April 2008 17:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">$INSTDIR=the folder the uninstaller is started from</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">10th April 2008 17:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">First you need to save the value of $INSTDIR in the registry, preferably with your Add/Remove registry (InstallLocation). Uninstalling that way is dangerous anyway but have a look at this page:<br><a href="http://nsis.sourceforge.net/Validating_" target="_blank">http://nsis.sourceforge.net/Validating_</a>$INSTDIR_before_uninstall<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">hungryOrb</span><br><span class="post-time small text-muted">11th April 2008 11:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks Stu :D That's extremely helpful :O<br>I have no choice but to use 'RMDIR /r' on account of the update (new) files being missed in the uninstaller. I know personally, I like to see absolutely no trace of things that have been chosen for uninstall as well :]<br>'RMDIR /r' seems safe, as long as the INSTDIR can be located accurately ;] Half of my adobe folder has taken a hit, but I never liked Adobe Reader much anyways xD<br><br>&lt;3@Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">hungryOrb</span><br><span class="post-time small text-muted">11th April 2008 12:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Stu, having looked at the page a lot, I've picked up on the type of validation being used, but when trying to use a similar setup, I find myself lost in placing the macro :/ It doesn't like to sit outside a section or function, but it doesn't seem to want to sit inside my onInit function either :/<br>I guess I'm just clueless on how to attach the macro to the Directory Page. I've been looking in the manual, and will continue to, but if there is some magic words that could be said, I'd be happy to include them in a sharing of my experience as a whole when the installer finishes- that is, to help other beginners ;]</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">11th April 2008 12:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It goes at the top of your uninstall section after getting the value of $INSTDIR. You can miss most of it off except the bit that checks if your application folder is appended to the end if you like (the !define ...)<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">hungryOrb</span><br><span class="post-time small text-muted">11th April 2008 12:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Oh thanks!<br>With this lot:<br><br>----------------------------<br>Function un.onInit<br>ReadRegStr $R0 HKLM "Software\VB and VBA Program Settings\${PRODUCT_NAME}\Main" "InstPathHere"<br><br>!define CHECK_PATH "\${PRODUCT_NAME}"<br>StrLen $R1 "${CHECK_PATH}"<br>StrCpy $R2 $INSTDIR "" -$R1<br>StrCmp $R2 "${CHECK_PATH}" +3<br>MessageBox MB_YESNO|MB_ICONQUESTION "Unrecognised uninstall path. Continue anyway?" IDYES +2<br>Abort<br><br>;MessageBox MB_OK "Registry: InstPathHere = $R0"<br>MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 "Are you sure you want to completely remove $(^Name)? Connectors will not be removed." IDYES +2<br>Abort<br>FunctionEnd<br>----------------------------<br><br>--= I cant extract the name of the chosen folder of install right? because I don't know how many characters its going to be? So the validation will mostly just check the default folder name right? And at this point, the INSTDIR, is where the uninst.exe is sitting, so simply replace with $R0?<br><br>And ehm. Although I've seen countless examples, at the end of a string comparison (?) the +2/+3 jump to certain points right? I'm just confused on where they jump to.. :|<br><br>Thanks for helping so much Stu, you probably would prefer to spend time doing better stuff than spoon-feeding but I appreciate it muchly :]</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">11th April 2008 15:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">No, replace $R0 with $INSTDIR on your ReadRegStr line.<br>Assuming you always append your default install folder to the end of your install path on install, this code will work fine.<br>Yes you can use this to validate the path on install as well.<br><br>There is a section in the manual regarding relative jumps.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">hungryOrb</span><br><span class="post-time small text-muted">14th April 2008 10:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks Stu :] Although I cannot use $INSTDIR, because I put the uninstaller in a different directory to the main app. I think the installer is as complete as it can get for now :)<br><br>There are holes, but, they are only dangerous if a user decides to rename an important folder to the name of the INSTDIR or messes with registry. If it was totally safe, there'd be no excitement though right? ^.^</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>