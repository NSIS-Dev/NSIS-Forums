<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Setting a reg key with variables? And calling with batch?" />

  <title>Setting a reg key with variables? And calling with batch? - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Setting a reg key with variables? And calling with batch?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=294127">Setting a reg key with variables? And calling with batch?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">-Gamah</span><br />
      <span class="post-time small text-muted">8th July 2008 00:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Setting a reg key with variables? And calling with batch?</strong><br />
      Here's what my script uses to find someone's game directory (this is an automatic addon installer)<br />
      <br /></p>

      <blockquote>
        Function .onInit<br />
        <br />
        Call GetSteamAccountName<br />
        Pop $R0 ; CaDDy-<br />
        Pop $R1 ; E\Games\Steaaam<br />
        <br />
        # Check if Steam is installed<br />
        StrCmp $R0 "" 0 +3<br />
        MessageBox MB_OK|MB_ICONSTOP $(SteamNotInstalled)<br />
        Abort<br />
        <br />
        # It is installed so set INSTDIR<br />
        StrCpy $INSTDIR "$R1\SteamApps\$R0\garrysmod\garrysmod"
      </blockquote>The "$R1\SteamApps\$R0\garrysmod\garrysmod is what i want written to a registry key.<br />
      <br />
      This brings me to the second question, is it possible to call up a registry key as a variable in a batch file? If so, how would I do so?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">8th July 2008 14:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Use ReadReg* and WriteReg* all of which are in the documentation. You could read a value in NSIS and pass it via the batch's command-line. However, what can you do in a batch that you cannot do in NSIS?<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">-Gamah</span><br />
      <span class="post-time small text-muted">8th July 2008 17:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Afrow UK</i><br />
        However, what can you do in a batch that you cannot do in NSIS?<br />
        <br />
        Stu [/B]
      </blockquote>svn checkout and svn export :P<br />
      <br />
      edit<br />
      <br />
      So something like "WriteReg HKLM\Software\UltimateGmodPack\GmodInstdir "$R1\SteamApps\$R0\garrysmod\garrysmod\" will write the actual values in on the key and not just the $R1 and $R0?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">-Gamah</span><br />
      <span class="post-time small text-muted">8th July 2008 17:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Also, if i could just use NSIS to set an environment variable, that would make things much easier.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">8th July 2008 17:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'll let you do a search for that one.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">-Gamah</span><br />
      <span class="post-time small text-muted">8th July 2008 18:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I see nothing in the documentation on SETTING an environment variable, only the ones that NSIS uses.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">8th July 2008 19:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There's also this forum you can search as well as the <a href="http://nsis.sf.net" target="_blank">Wiki</a>.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">-Gamah</span><br />
      <span class="post-time small text-muted">8th July 2008 20:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Okay I've done searching, now why doesn't this work?<br />
      <br /></p>

      <blockquote>
        Function .setReg<br />
        WriteRegStr HKLM "SYSTEM\CurrentControlSet\Control\Session Manager\Environment" "GMOD_DIR" "$R1\SteamApps\$R0\garrysmod\garrysmod"<br />
        FunctionEnd
      </blockquote>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comperio</span><br />
      <span class="post-time small text-muted">8th July 2008 21:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What does the registry look like after calling the function?<br />
      <br />
      Also, you might add a message box in your function function as a debug tool to see that $R0 and $R1 are set properly.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">8th July 2008 21:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">In what way does it not work? Are you calling the function? The . in front of the name does not make it get called automatically.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">-Gamah</span><br />
      <span class="post-time small text-muted">8th July 2008 21:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">After compiling and running the installer, the GMOD_DIR entry IS MADE IN THE KEY properly, with $R0 and $R1 set and everything.<br />
      <br />
      But when i go to command prompt and type %GMOD_DIR% it tells me that environment variable GMOD_DIR is not defined (though i'm LOOKING AT IT in regedit.exe<br />
      <br />
      any ideas?</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
