<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="How to use System::Call &quot;rapi::CeRapiInitEx..."><title>How to use System::Call "rapi::CeRapiInitEx... - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">How to use System::Call "rapi::CeRapiInitEx...</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=289013">How to use System::Call "rapi::CeRapiInitEx...</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Scrapi</span><br><span class="post-time small text-muted">25th March 2008 02:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>How to use System::Call "rapi::CeRapiInitEx...</strong><br>I am trying to detect if a device is connected via activesync by using the System.dl call to CeRapiInitEx. Apparently I do not understand how to allocate memory for the structure required by this function.<br><br>The struct is as follows:<br><br>public struct RAPIINIT<br>{<br>public int cbsize;<br>public IntPtr heRapiInit;<br>public UInt32 hrRapiInit;<br>};<br><br>HRESULT CeRapiInitEX(RAPIINIT)<br><br>Here is my failed attempt so far (any help is appreciated)<br><br>System::Call "*(i 12, i, i) i .s"<br>Pop $1<br>System::Call "rapi::CeRapiInitEX(i r1) i .r0"<br>DetailPrint "CeRapiInitEX Status: $0"<br>DetailPrint "Struct Pointer: $1"<br>System::Call "*$1(i .r2, i .r3, i .r4)"<br>System::Free $1<br>DetailPrint "cbSize: $2"<br>DetailPrint "heRapiInit: $3"<br>DetailPrint "hrRapiInit: $4"</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">25th March 2008 03:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">are you sure its not CeRapiInitEx ?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Scrapi</span><br><span class="post-time small text-muted">25th March 2008 04:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes you are correct - it is CeRapiInitEx<br><br>Ultimately I want to test the return value for success and then wait for the connection signal from kernel32::WaitForSingleObject</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">25th March 2008 19:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">What exactly doesn't work and how?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Scrapi</span><br><span class="post-time small text-muted">25th March 2008 20:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think I've got it figured out. (see below) What I was struggling with were the data types of the components of the struct and the values of the return variables. It seems that all the Microsoft docs assume that the definitions of things like S_OK are universally known. Since I am a noob with RAPI and in the NSIS scriptiong environment I don't have the headers that define S_OK, S_FAIL , etc. I was not sure what to look for in the return variable.<br><br>Anywhooo this seems to be working. Thanks for your response.<br><br>CheckConnect:<br>MessageBox MB_OK "Put PPC in Cradle"<br>System::Call "*(i 12, i, i) l .s"<br>Pop $1<br>System::Call "rapi::CeRapiInitEx(l r1) i .s"<br>Pop $0<br>DetailPrint "CeRapiInitEx Return Value: $0"<br>DetailPrint "Struct Pointer: $1"<br>System::Call "*$1(i .r2, i .r3, i .r4)"<br>System::Free $1<br>DetailPrint "cbSize: $2"<br>DetailPrint "heRapiInit Handle: $3"<br>DetailPrint "hrRapiInit Return Value: $4"<br>${If} $4 == 0<br>DetailPrint "Waiting for Signal..."<br>System::Call "Kernel32::WaitForSingleObject(i r3, l 300) i .r5"<br>DetailPrint "WaitForSingleObject Return Value: $5"<br>${Else}<br>System::Call "rapi::CeRapiUninit() i. s"<br>Pop $1<br>DetailPrint "CeRapiUninit Return Value: $1"<br>Goto CheckConnect<br>${EndIf}</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">25th March 2008 20:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">for most symbols like that, just google "define FOOBAR_SYMBOL" if you don't have the MS headers handy</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>