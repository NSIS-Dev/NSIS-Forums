<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="MSI and AD rear their ugly heads again" />

  <title>MSI and AD rear their ugly heads again - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">MSI and AD rear their ugly heads again</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=291460">MSI and AD rear their ugly heads again</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Downward FG</span><br />
      <span class="post-time small text-muted">8th May 2008 09:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>MSI and AD rear their ugly heads again</strong><br />
      Hi all,<br />
      <br />
      I put together an installer with nsis thanks to much help from this forum. It does loads of cool stuff like .NET upgrades and gac registration. Everything worked great until it was decided that the app had to be deployable using Active Directory. A look around this place revealed that I would have to do this seperately so I created an MSI in VS2005, it "installs" the nsis setup.exe and calls it as a custom action. I edited the file using ORCA so the custom action would run with the right (elevated) permissions. If I install on a machine with .NET 3 already there, everything is great. If not, disaster. My program installs fine, but all the extra stuff (.NET etc.) doesn't get there. This stuff is installed using execwait calls, and the event log on the machine even tells me it has been installed (I can even see the progress bars though they fill up much too quickly). I know this isn't nsis fault, as it works fine until it is wrapped in the msi, but if anyone has encountered anything similar, or thinks they know what I have done wrong, let me know.<br />
      <br />
      Thanks,</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Downward FG</span><br />
      <span class="post-time small text-muted">8th May 2008 09:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I think I found the problem, when checking through the logfile I see that the .NET installer exited with code 1618. This code means, "Another installation is already in progress. Complete that installation before proceeding with this install."<br />
      <br />
      I suspected this was the problem. Any suggestions?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">8th May 2008 10:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's probably because they both use MSI. Either MSI somehow has to know the NSIS installer is part of it, or the .NET installation should be done in the MSI itself.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Downward FG</span><br />
      <span class="post-time small text-muted">8th May 2008 10:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks kichik,<br />
      <br />
      If it is just nsis then everything is fine, and nsis can call as many msi installers as it likes (as long as there is only one running at a given time), but because I have this dummy msi that calls nsis, which then calls other msis I'm in trouble. The msi was going to be for adminstrators to use, with the nsis.exe available to single users, so if I get the msi to handle the .NET install I am going to end up with different dists and my boss will be unhappy. Got to love impossible requirements. I'm trying to see if I can defer the custom action or something. No doubt this will cause a permissions problem. It definately isn't an nsis issue, but if anyone has a suggestion I'd be glad to hear it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">EnCey</span><br />
      <span class="post-time small text-muted">9th May 2008 07:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I had the same problems some weeks ago, I also had to create several MSI-NSIS installers.<br />
      You could try to use a custom action tpye of +192, see <a href="http://msdn.microsoft.com/en-us/library/aa368071" target="_blank">http://msdn.microsoft.com/en-us/library/aa368071</a>(VS.85).aspx for details.<br />
      <br />
      Your NSIS installer would be executed asynchronous, so the MSI can shut down and another MSI (e.g. .NET) can be called.<br />
      The problem with this approach is that the msi is finished and installed before your NSIS installer, so if the user cancels NSIS you could have some inconsistencies.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Downward FG</span><br />
      <span class="post-time small text-muted">9th May 2008 10:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks,<br />
      <br />
      This sounds like it might work, in this case nsis is running silently so I don't need to worry about pesky users :)<br />
      <br />
      I'll give it a go and report back.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Downward FG</span><br />
      <span class="post-time small text-muted">15th May 2008 12:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">EnCey, I owe you a drink. Great solution. To all of you who are having difficulty with AD deployment, this is the way forward.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
