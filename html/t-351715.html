<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Writing to registry becomes terribly slow"><title>Writing to registry becomes terribly slow - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Writing to registry becomes terribly slow</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=351715">Writing to registry becomes terribly slow</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">zumbo</span><br><span class="post-time small text-muted">9th November 2012 17:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Writing to registry becomes terribly slow</strong><br>My installer seems to be "stuck" in the middle of execution for about a minute. Debugging revealed that two harmless looking registry commands each take about 30 seconds:<br><br>WriteRegBin HKLM "SYSTEM\ControlSet001\services\openmapdrive" "FailureActions" 80510100000000000000000003000000140000000100000060ea000000000000000000000000000000000000<br><br>WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Run" "OpenMapSysTray" "$INSTDIR\drive\OpenmapSystray.exe"<br><br>It only happens when I install a large amount of data (&gt; 100 MB) some lines before. It works fine when I comment out this data, and also if I comment out the two registry commands (previous and subsequent calls to WriteRegStr work OK). I have no idea what could cause these commands to become so slow. Any ideas?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">9th November 2012 18:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I don't know what might be causing this other than the disk cache forcing the registry be paged out but I do know that writing to ControlSet001 is probably wrong, 99.99% of the time you want the currentcontrolset!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">10th November 2012 08:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Here's a crazy idea: How about first writing to registry, and then installing the &gt;100MB data files?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">zumbo</span><br><span class="post-time small text-muted">12th November 2012 10:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">@Anders: Thanks for pointing out the ControlSet problem. The speed problem, however, can't be caused by the disk cache, since it happens invariably at the same two lines, on different machines, with different memory sizes. It must be caused by some memory problem internal to NSIS.<br><br>@MSG: I tried that as a workaround, but now the installer freezes at the end, that is, the "Finish" button stays grayed out for about 40 seconds, although installation is complete. Which strengthens my suspicion that NSIS has problems handling the memory it has allocated for the 100MB+ of data.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">12th November 2012 14:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Could it be related to a virusscanner hogging your system? A good way to test would be to disable all security software and compare results.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">zumbo</span><br><span class="post-time small text-muted">12th November 2012 16:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">@MSG: Yes, indeed, when I disable my virus scanner, the lockup is gone. Thanks! Although I still don't understand why the lockup happens at two specific lines in the script. Also, when I replace the NSIS registry commands with nsExec::ExecToStack "reg add [...]", it becomes much faster (about 15 s instead of 30 s lockup per call).</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>