<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Reading ini string error - Strange error"><title>Reading ini string error - Strange error - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Reading ini string error - Strange error</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=314519">Reading ini string error - Strange error</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">bubunia2000</span><br><span class="post-time small text-muted">11th November 2009 09:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Reading ini string error - Strange error</strong><br>Hi all,<br>I am trying to read a particular value from the ini file.<br><br>a.ini (contents).<br>-----<br>data = c:\test<br><br>I got the following code from the nsis website and try to compiled it. It is compiling fine. But when it runs it gives error "Installer corrupted Invalid OpCode".<br><br>I want the value of key "data" into some variable which I can use it in my nsis script? Can anybody help me in this regard?<br><br>Regards<br>Pradeep<br><br>Code:<br>----<br><br><br>OutFile "test_ini.exe"<br>;${ReadINIStrNS} $R0 "D:\Build\Builds\Code\test.ini" "data"<br>Section "OgO Open File Association" SEC02<br>Push $0<br>Call ReadINIStrNS<br>;Pop $0<br>;${ReadINIStrNS} $0 "D:\Build\Builds\Code\test.ini" "data"<br>SectionEnd<br><br><br>Function ReadINIStrNS<br>Exch $R0 ; key<br>Exch<br>Exch $R1 ; ini file<br>Push $R2 ; ini file handle<br>Push $R3 ; key len<br>Push $R4<br>Push $R5<br><br>FileOpen $R2 $R1 r<br>IfErrors End<br><br>StrLen $R3 $R0<br>IntOp $R3 $R3 + 1 ; inc. "="<br><br>LoopRead:<br>ClearErrors<br>IfErrors End<br>FileRead $R2 $R1<br><br>StrCpy $R4 $R1 $R3<br>StrCmp $R4 "$R0=" 0 LoopRead<br><br>StrLen $R5 $R1<br>IntOp $R3 $R5 - $R3<br>StrCpy $R0 $R1 "" -$R3<br><br>Push $R0<br>; Call TrimNewLines<br>Pop $R0<br><br>Goto +2<br><br>End:<br>StrCpy $R0 "no value!"<br><br>FileClose $R2<br><br>Pop $R5<br>Pop $R4<br>Pop $R3<br>Pop $R2<br>Pop $R1<br>Exch $R0 ; output value<br>FunctionEnd<br><br>;!define ReadINIStrNS "!insertmacro ReadINIStrNS"<br>;!macro ReadINIStrNS Var File Key<br>; Push "${File}"<br>; Push "${Key}"<br>; Call ReadINIStrNS<br>; Pop "${Var}"<br>;!macroend</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">11th November 2009 11:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You need to pop the function's result off the stack, otherwise you're corrupting your stack.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bubunia2000</span><br><span class="post-time small text-muted">11th November 2009 17:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Iam tried the following:<br>Section "OgO Open File Association" SEC02<br>Push $0<br>Call ReadINIStrNS<br>Pop $0<br><br>It still gives the "Installer Corruption Error". Could you please help me where I am doing wrong? I am basically want to get the value of key "data" in the ini file.<br><br>I tried the following as mentioned in the following example:<br><br>URL submitted by user.<br><br>Error:<br><br>Processing script file: "C:\reading_ini_file_3.nsi"<br>OutFile: "test_ini.exe"<br>Section: "OgO Open File Association" -&gt;(SEC02)<br>Push: $0<br>Pop: $0<br>Invalid command: ${ReadINIStrNS}<br>Error in script "C:\reading_ini_file_3.nsi" on line 7 -- aborting creation process<br><br>Could you please help me in this regard?<br><br>Regards<br>Pradeep</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>