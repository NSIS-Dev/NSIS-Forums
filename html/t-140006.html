<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Using System.dll to call Win32 APIs" />

  <title>Using System.dll to call Win32 APIs - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Using System.dll to call Win32 APIs</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=140006">Using System.dll to call Win32 APIs</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tirhoads</span><br />
      <span class="post-time small text-muted">24th June 2003 22:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Using System.dll to call Win32 APIs</strong><br />
      I was looking for a simple installer package the other day, and found this one. It seems to be very straight forward to use. My only problem though so far is the following:<br />
      <br />
      I have written a program to be run as a service and would like to install this service using NSIS scripting. The commands should be as follows:<br />
      <br />
      System::Call 'advapi32::OpenSCManagerA(t, t, l) l(Null, Null, 2).r0'<br />
      System::Call 'advapi32::CreateServiceA(l, t, t, l, l, l, l, t, t, t, t, t, t) l(r0, "ServiceName", "Service Description", 983551, 16, 2, 1, "ServiceLocation.exe", Null, Null, Null, "LocalSystem", Null).r1'<br />
      <br />
      The first calls returns a handle from the Service Control Managage Database and passes that handle into the first variable in the next call which creates the service. The first call seeems to be working correctly, but the second does not, and I think it is because the handle being returned from the first call is getting changed into a string variable which needs to remain a long to be passed into the second call.<br />
      <br />
      I know that I could create my own extension dll to do this or I could do the install in my program, but if I could get this to work it would be very simply and elegant.<br />
      <br />
      If anyone could help, I would greatly appreciate it.<br />
      <br />
      -tim</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">24th June 2003 22:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Usually services can install themself, I think that's the easiest solution.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">brainsucker</span><br />
      <span class="post-time small text-muted">25th June 2003 01:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">1. t "Null" will pass pointer to "Null" string to API (not the 0x0 :)<br />
      2. dword / int32 etc -&gt; use i, not the l parameter type (l stands for long, or int64).<br />
      <br />
      Try this code, please (I've checked only the correctness of functions specification, not values):<br />
      <br />
      System::Call 'advapi32::OpenSCManagerA(i 0, i 0, i 2) i .r0'<br />
      System::Call 'advapi32::CreateServiceA(i r0, t "ServiceName", t "Service Description", i 983551, i 16, i 2, i 1, t "ServiceLocation.exe", i 0, i 0, i 0, t "LocalSystem", i 0) i .r1'</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tirhoads</span><br />
      <span class="post-time small text-muted">30th June 2003 15:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you brainsucker, that worked exactly as I wanted it to.<br />
      <br />
      -tim</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tirhoads</span><br />
      <span class="post-time small text-muted">2nd July 2003 19:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>NT Service Functions</strong><br />
      If anyone is interested I have now built a couple of functions using the System plugin that do the following:<br />
      <br />
      Install a service<br />
      Start a service<br />
      UnInstall a service<br />
      <br />
      -tim</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">4th July 2003 13:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Create a page for them at The Archive, I sure it will be found useful.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
