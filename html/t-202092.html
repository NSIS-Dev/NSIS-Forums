<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Uninstall and reboot"><title>Uninstall and reboot - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Uninstall and reboot</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=202092">Uninstall and reboot</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Hansen</span><br><span class="post-time small text-muted">14th December 2004 20:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Uninstall and reboot</strong><br>Hello!<br><br>I have two questions:<br><br>1) Is there a limit on the stack size of NSIS? I would like to write a plugin which during uninstall finds some dynamically generated files to be deleted and puts them on the stack. I will then delete the files from my script with the /REBOOTOK parameter. But is there a limit on the stack size which may give a problem?<br><br>2) Consider the following situation: A user uninstalls a program. Some files cannot be removed and are then registed for removal on system reboot (because the /REBOOTOK parameter is used). The user selects not to reboot the system at this point. Next, the user reinstalls the program. When the system reboots the newly installed files are removed. Is there any good solution to this problem? One way is not to allow the user to reinstall until the system reboot. What is the good way to ensure this?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">14th December 2004 21:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">1) Stack elements are dynamically allocated so there should be no limit but your computer's memory limit.<br><br>2) There was a forum thread about this, you might find some useful information there.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Hansen</span><br><span class="post-time small text-muted">14th December 2004 21:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thank you very much for your promptly reply!<br><br>2) I managed to find the old thread (subject: Files get Deleted on Reboot after Uninstall / Install). The suggestion there is to write a "key/file" so that the uninstaller can determine that an old uninstallation has not completed.<br><br>Inspired by this I see one solution:<br><br>On uninstall:<br>* By using GetTickCount, approximate when the system was last rebooted.<br>* Create a file and write this information to it.<br>* Make the file read-only<br>* Delete the file with /REBOOTOK<br>* Make the file writeable<br>* On reinstallation, read the file. If it is there, use the time information in it to determine if the system has rebooted. If the system has not rebooted, refuse to install.<br><br>The reason it needs to be this complicated is, that we can not count on files to actually be removed on reboot. For example the files may be on a network drive. Or the user may not have sufficient permissions to schedule file removal on reboot.<br><br>Any other suggestions will be appreciated.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>