<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="need help regarding the installer with serialkey check"><title>need help regarding the installer with serialkey check - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">need help regarding the installer with serialkey check</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=274624">need help regarding the installer with serialkey check</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Veerugadde</span><br><span class="post-time small text-muted">19th July 2007 17:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>need help regarding the installer with serialkey check</strong><br>Hai,<br><br>With some knowledge , i tried an approach of building installer with with 3 steps in process.<br><br>first, checking for the active internet connection and will abort the process without connection.<br><br>secondly,checking the ip address of the client system to be within the required IP address range.On success need to move to serialkey check.<br><br>Here user needs to enter the given serial key and will check over the server after posting the key.But for time being only comparing locally.Installer is working until IP address check and the serial keycheck is not working. Please help me out<br><br><br>I am posting the code below:<br><br>; MUI 1.67 compatible ------<br>!include MUI.nsh<br>!include LogicLib.nsh<br>!include defines.nsh<br>!include sampleIP.nsh<br><br>; MUI Settings<br>!define MUI_ABORTWARNING<br>!define MUI_ICON "${NSISDIR}\Contrib\Graphics\Icons\orange-install.ico"<br>;!define MUI_ICON "${NSISDIR}\Contrib\Graphics\Icons\modern-install.ico"<br>XPStyle on<br><br>; Reserve files<br>ReserveFile "validateSerial.ini"<br>!insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br><br>;pages<br><br>; Welcome page<br>!insertmacro MUI_PAGE_WELCOME<br>Page custom SerialPageShow SerialPageLeave<br>Page custom validateSerial<br>; Instfiles page<br>!insertmacro MUI_PAGE_INSTFILES<br>; Finish page<br>!insertmacro MUI_PAGE_FINISH<br><br><br>; Language files<br>!insertmacro MUI_LANGUAGE "English"<br><br><br>; MUI end ------<br><br>Name "${PRODUCT_NAME} ${PRODUCT_VERSION}"<br>OutFile "AppDeploy.exe"<br>InstallDir "$DESKTOP"<br>ShowInstDetails show<br><br>Function .onInit<br><br>call ConnectInternet<br><br>FunctionEnd<br><br><br><br>Section -InstallerSettings<br>SetOutPath "$INSTDIR"<br>SetOverwrite ifnewer<br>Call SetMarquee<br>SectionEnd<br><br><br><br>Function ConnectInternet<br><br>Push $R0<br><br>ClearErrors<br>Dialer::AttemptConnect<br>IfErrors noie3<br><br>Pop $R0<br>StrCmp $R0 "online" connected<br>MessageBox MB_OK|MB_ICONSTOP "Cannot connect to the internet."<br>Quit ;This will quit the installer.<br>;You might want to add your own error handling.<br><br>noie3:<br><br>; IE3 not installed<br>MessageBox MB_OK|MB_ICONINFORMATION \<br>"Please connect to the internet now."<br><br>connected:<br><br>Pop $R0<br><br>FunctionEnd<br><br>Function SetMarquee<br>FindWindow $0 "#32770" "" $HWNDPARENT<br>GetDlgItem $0 $0 1004<br>System::Call user32::GetWindowLong(ir0,i-16)i.r1<br>IntOp $1 $1 | 8 # PBS_MARQUEE<br>System::Call user32::SetWindowLong(ir0,i-16,ir1)<br>IntOp $1 ${WM_USER} + 10<br>SendMessage $0 $1 1 200 $2<br>FunctionEnd<br><br><br>Section -IPCheck<br>Internet::GetLocalHostIP ${VAR_1}<br>push $1<br>call ValidateIP<br>${If} ${Errors}<br>MessageBox MB_OK|MB_ICONINFORMATION "Your IP address: $1 and INVAILD"<br>Quit<br>${Else}<br>MessageBox MB_OK|MB_ICONINFORMATION "IP Address is vaild and will continue with installation process"<br>!insertmacro MUI_INSTALLOPTIONS_EXTRACT "validateSerial.ini"<br>Call SerialPageShow<br><br>${EndIf}<br><br>SectionEnd<br><br>Function SerialPageShow<br>!insertmacro MUI_HEADER_TEXT "Enter Serial Code" "Enter the software serial code to continue."<br><br>PassDialog::Dialog Serial \<br>/HEADINGTEXT 'Please enter the serial code located on the software CD case...' \<br>/CENTER \<br>/BOXDASH 12 70 4 '' \<br>/BOXDASH 92 70 4 '' \<br>/BOXDASH 172 70 4 '' \<br>/BOXDASH 252 70 4 '' \<br>/BOX 332 70 4 ''<br><br>Pop $R0 # success, back, cancel or error<br>FunctionEnd<br><br>Function SerialPageLeave<br><br>## Pop values from stack<br>Pop $R1<br>Pop $R2<br>Pop $R3<br>Pop $R4<br>Pop $R5<br><br>;!insertmacro MUI_HEADER_TEXT "Validating..." "Please Wait"<br>;!insertmacro MUI_INSTALLOPTIONS_DISPLAY "validateSerial.ini"<br><br>;MessageBox MB_OK "Break1"<br><br>FunctionEnd<br><br><br>Function ValidateSerial<br><br>StrCmp $R1 '1BH6' +3<br>MessageBox MB_OK|MB_ICONEXCLAMATION "Please enter vaild serial number!"<br>Abort<br><br>StrCmp $R2 '2Y6M0' +3<br>MessageBox MB_OK|MB_ICONEXCLAMATION "Please enter vaild serial number!"<br>Abort<br><br>StrCmp $R3 'SL5H' +3<br>MessageBox MB_OK|MB_ICONEXCLAMATION "Please enter vaild serial number!"<br>Abort<br><br>StrCmp $R4 'MSU6' +3<br>MessageBox MB_OK|MB_ICONEXCLAMATION "Please enter vaild serial number!"<br>Abort<br><br>StrCmp $R5 'U1M3' SerialOK<br>MessageBox MB_OK|MB_ICONEXCLAMATION " Please enter vaild serial number!"<br>Abort<br>SerialOK:<br>FunctionEnd<br><br><br>Section -Prerequisites<br><br>SetOutPath $INSTDIR<br>MessageBox MB_YESNO "Install the python open source package?" /SD IDYES IDNO endNetCF<br>File "python.msi"<br>ExecWait '"msiexec" /i "$INSTDIR\python.msi"'<br>endNetCF:<br><br>SectionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">19th July 2007 17:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can't have Call SerialPageShow in there.<br>To skip the PassDialog page, call Abort in it's show function.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Veerugadde</span><br><span class="post-time small text-muted">19th July 2007 19:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hello Stu,<br><br>I had removed the call serial page from that section. Here the problem is that the installer is that starting with IPcheck and directly going on with installation process.<br><br>I need to go serialkey check after the success of IP Check only. On success of serialCheck installation process should start.Will those functions need to be called from any other sections?<br><br>thanks,</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">19th July 2007 19:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Like I said, to skip a custom page call Abort in it's show function. You cannot call these functions yourself, but only let NSIS call them using the Page instruction.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Veerugadde</span><br><span class="post-time small text-muted">19th July 2007 20:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hello Stu,<br><br>Thanks alot..i changed the code and got minor problem where the order of checking is changed.<br><br>As i said first want to check with internet connection check and IP range from which needs to go for serialkey check.But installer starts with serial keycheck and on success of check going for IP check followed by installation.<br><br>changed code is below:<br><br>!include MUI.nsh<br>!include LogicLib.nsh<br>!include defines.nsh<br>!include sampleIP.nsh<br><br>; MUI Settings<br>!define MUI_ABORTWARNING<br>!define MUI_ICON "${NSISDIR}\Contrib\Graphics\Icons\orange-install.ico"<br>;!define MUI_ICON "${NSISDIR}\Contrib\Graphics\Icons\modern-install.ico"<br>XPStyle on<br><br>;pages<br><br>; Welcome page<br>!insertmacro MUI_PAGE_WELCOME<br>#Custom pages<br>Page custom SerialPageShow SerialPageLeave<br>; Instfiles page<br>!insertmacro MUI_PAGE_INSTFILES<br>; Finish page<br>!insertmacro MUI_PAGE_FINISH<br>; Language files<br>!insertmacro MUI_LANGUAGE "English"<br>; MUI end ------<br><br>Name "${PRODUCT_NAME} ${PRODUCT_VERSION}"<br>OutFile "AppDeploy.exe"<br>InstallDir "$DESKTOP"<br>ShowInstDetails show<br><br>Function .onInit<br><br>call ConnectInternet<br><br>FunctionEnd<br><br>Section -SETTINGS<br>SetOutPath "$INSTDIR"<br>SetOverwrite ifnewer<br>Call SetMarquee<br>SectionEnd<br><br><br>;Page custom validateSerial<br>Function SerialPageShow<br>ReserveFile "validateSerial.ini"<br>!insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br>!insertmacro MUI_INSTALLOPTIONS_EXTRACT "validateSerial.ini"<br>!insertmacro MUI_HEADER_TEXT "Enter Serial Code" "Enter the software serial code to continue."<br><br>PassDialog::Dialog Serial \<br>/HEADINGTEXT 'Please enter the serial code located on the software CD case...' \<br>/CENTER \<br>/BOXDASH 12 70 4 '' \<br>/BOXDASH 92 70 4 '' \<br>/BOXDASH 172 70 4 '' \<br>/BOXDASH 252 70 4 '' \<br>/BOX 332 70 4 ''<br><br><br>Pop $R0 # success, back, cancel or error<br>FunctionEnd<br><br>Function SerialPageLeave<br><br>## Pop values from stack<br>Pop $R1<br>Pop $R2<br>Pop $R3<br>Pop $R4<br>Pop $R5<br><br>;!insertmacro MUI_HEADER_TEXT "Validating..." "Please Wait"<br>;!insertmacro MUI_INSTALLOPTIONS_DISPLAY "validateSerial.ini"<br><br>;MessageBox MB_OK "Break1"<br><br>StrCmp $R1 '1234' +3<br>MessageBox MB_OK|MB_ICONEXCLAMATION "Please enter vaild serial number!"<br>Abort<br><br>StrCmp $R2 '5678' +3<br>MessageBox MB_OK|MB_ICONEXCLAMATION "Please enter vaild serial number!"<br>Abort<br><br>StrCmp $R3 '9098' +3<br>MessageBox MB_OK|MB_ICONEXCLAMATION "Please enter vaild serial number!"<br>Abort<br><br>StrCmp $R4 '7654' +3<br>MessageBox MB_OK|MB_ICONEXCLAMATION "Please enter vaild serial number!"<br>Abort<br><br>StrCmp $R5 '3210' +3<br>MessageBox MB_OK|MB_ICONEXCLAMATION " Please enter vaild serial number!"<br>Abort<br>FunctionEnd<br><br>Function ConnectInternet<br>Push $R0<br><br>ClearErrors<br>Dialer::AttemptConnect<br>IfErrors noie3<br><br>Pop $R0<br>StrCmp $R0 "online" connected<br>MessageBox MB_OK|MB_ICONSTOP "Cannot connect to the internet."<br>Quit ;This will quit the installer.<br>;You might want to add your own error handling.<br><br>noie3:<br><br>; IE3 not installed<br>MessageBox MB_OK|MB_ICONINFORMATION \<br>"Please connect to the internet now."<br><br>connected:<br><br>Pop $R0<br><br>FunctionEnd<br><br>Function SetMarquee<br>FindWindow $0 "#32770" "" $HWNDPARENT<br>GetDlgItem $0 $0 1004<br>System::Call user32::GetWindowLong(ir0,i-16)i.r1<br>IntOp $1 $1 | 8 # PBS_MARQUEE<br>System::Call user32::SetWindowLong(ir0,i-16,ir1)<br>IntOp $1 ${WM_USER} + 10<br>SendMessage $0 $1 1 200 $2<br>FunctionEnd<br><br>Section -IPCheck<br>Internet::GetLocalHostIP ${VAR_1}<br>push $1<br>call ValidateIP<br>${If} ${Errors}<br>MessageBox MB_OK|MB_ICONINFORMATION "Your IP address: $1 and INVAILD"<br>Quit<br>${Else}<br>MessageBox MB_OK|MB_ICONINFORMATION "IP Address is vaild and will continue with installation process"<br>;!insertmacro MUI_INSTALLOPTIONS_EXTRACT "validateSerial.ini"<br><br>${EndIf}<br><br>SectionEnd<br><br>Section -Prerequisites<br><br>SetOutPath $INSTDIR<br>MessageBox MB_YESNO "Install the python open source package?" /SD IDYES IDNO endNetCF<br>File "python.msi"<br>ExecWait '"msiexec" /i "$INSTDIR\python.msi"'<br>endNetCF:<br><br>SectionEnd<br><br>Please help me out with verfication of the code.As you said i dont want to skip custom page(serialcheck) until verified.<br><br>Thanks alot.<br><br>Appreciate your help..</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">19th July 2007 20:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">So you want to first validate the user's IP address and then ask them for the serial?<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Veerugadde</span><br><span class="post-time small text-muted">19th July 2007 20:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Stu,<br><br>Ya i want to validate users IP address and on the success need to move on for serial check .<br><br>Thanks,<br><br>Veeeru</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">19th July 2007 21:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Right. I see you've put your IP address check in a section... Sections are executed on the InstFiles page, which you have after your custom page.<br><br>You need to move it into the custom page function. Also, you've got ${If} ${Errors} in there, but no ClearErrors before you call the ValidateIP function.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Veerugadde</span><br><span class="post-time small text-muted">19th July 2007 22:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hello Stu,<br><br>Thanks alot, Could you please tell me how to write an .ini file for that IP check section for changing in to custom page.<br><br><br>Thanks.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">19th July 2007 22:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You want the user to enter their IP address or something?<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Veerugadde</span><br><span class="post-time small text-muted">19th July 2007 22:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">No.. user will not enter any IP address. I am trying to get their IP address using Internet plugin and comparing that with required range by calling the validationIP function written in .nsh file.<br><br>So can you give some idea regarding how to change in to IPcheck section in to custom page.<br><br><br>Thanks alot</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">19th July 2007 23:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You don't need a custom page then if you don't want any user input. Just put it in the show function of your serial page.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Veerugadde</span><br><span class="post-time small text-muted">19th July 2007 23:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Stu,<br><br>Thanks alot and really appreciate your help..yaa its sorted out.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">19th July 2007 23:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">No problem. If you need any modifications or if you have any suggestions for the PassDialog plug-in let me know.<br><br>Stu</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>