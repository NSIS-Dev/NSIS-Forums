<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Problem with CopyFiles" />

  <title>Problem with CopyFiles - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Problem with CopyFiles</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=318963">Problem with CopyFiles</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">b179210</span><br />
      <span class="post-time small text-muted">5th May 2010 16:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Problem with CopyFiles</strong><br />
      Hi,<br />
      i have a problem with CopyFiles, i want copy (copy and then delete from "c:\test") some files from a folder to TEMP, but if error raised return back with copy from TEMP to "c:\test".<br />
      If a file is locked (i.e. "pdf") delete command from "c:\test" raised an error (but other files are deleted well), and when re-copy from TEMP to "c:\test" copy doesn't function (file locked) and no files are copied.<br />
      <br />
      These are my steps:<br />
      <br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #0000BB">CreateDirectory</span><span style="color: #DD0000">"$TEMP\Backup\"<br />
      CopyFiles"</span><span style="color: #0000BB">C</span><span style="color: #007700">:</span><span style="color: #0000BB">Test</span><span style="color: #007700">*.*</span><span style="color: #DD0000">""</span><span style="color: #0000BB">$TEMPBackup</span><span style="color: #DD0000">"<br />
      <br />
      Retry:<br />
      ClearErrors<br />
      Delete"</span><span style="color: #0000BB">C</span><span style="color: #007700">:</span><span style="color: #0000BB">Test</span><span style="color: #007700">*.*</span><span style="color: #DD0000">"<br />
      IfErrors0NoError<br />
      MessageBoxMB_RETRYCANCEL|MB_ICONQUESTION"</span><span style="color: #0000BB">Errorduringcopy</span><span style="color: #007700">,</span><span style="color: #0000BB">retry</span><span style="color: #007700">?</span><span style="color: #DD0000">"IDRETRYRetry:<br />
      ClearErrors<br />
      SetOverwriteoff;ihavetriedwithifnewer-on-try,also<br />
      ;Rollback-re-copyoriginalfilefrom$TEMP<br />
      CopyFiles"</span><span style="color: #0000BB">$TEMPBackup</span><span style="color: #007700">*.*</span><span style="color: #DD0000">""</span><span style="color: #0000BB">C</span><span style="color: #007700">:</span><span style="color: #0000BB">Test</span><span style="color: #DD0000">"<br />
      IfErrors0NoError<br />
      MessageBoxMB_ICONSTOP"</span><span style="color: #0000BB">Errorduringcopy</span><span style="color: #007700">,</span><span style="color: #0000BB">stop</span><span style="color: #DD0000">"<br />
      Abort<br />
      <br />
      NoError:<br />
      MessageBoxMB_OK"</span><span style="color: #0000BB">CopyOk</span><span style="color: #DD0000">"<br /></span></span> <!-- php buffer end -->
      <hr />
      <br />
      Many thank for your help.<br />
      Mark
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">5th May 2010 17:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That is not a good way to do it. Have you tried moving the entire folder (Rename)?<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">b179210</span><br />
      <span class="post-time small text-muted">6th May 2010 08:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have tried with "Rename" and "MoveFileFolder" functions, but error flag is raised because a file is locked.<br />
      <br />
      My simple scenario is:<br />
      <br />
      - copy all files from A folder to B folder with (or without) overwrite existing file<br />
      <br />
      but if a file is locket in B folder error is raised and no files are copied, nor file not locked.<br />
      Many thanks</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">6th May 2010 09:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Rather than do a CopyFiles using wildcards perhaps you should use Locate and copy each file individually.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">b179210</span><br />
      <span class="post-time small text-muted">6th May 2010 10:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, the problem is that i have 31 files and every time these are different..:confused:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">6th May 2010 10:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That is why you can use Locate. Do a recursive search through your source folder picking up any files.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">b179210</span><br />
      <span class="post-time small text-muted">6th May 2010 13:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, good idea :) i'm searching function for do recoursive search.<br />
      Many thanks, i will tell you :cool:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">6th May 2010 13:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Locate is in the user manual.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">b179210</span><br />
      <span class="post-time small text-muted">18th May 2010 08:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Finally i have finished my code using Locate function:<br />
      <br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #0000BB">Section<br />
      StrCpy$R0</span><span style="color: #DD0000">"C:\ftp"</span><span style="color: #007700">;</span><span style="color: #0000BB">Directorycopyfrom<br />
      StrCpy$R1</span><span style="color: #DD0000">"C:\ftp2"</span><span style="color: #007700">;</span><span style="color: #0000BB">Directorycopyinto<br />
      StrLen$R2$R0<br />
      <br />
      GetTempFileName</span><span style="color: #007700">$</span><span style="color: #0000BB">0<br />
      FileOpen$R3</span><span style="color: #007700">$</span><span style="color: #0000BB">0w<br /></span> <span style="color: #007700">${</span><span style="color: #0000BB">Locate</span><span style="color: #007700">}</span><span style="color: #DD0000">"$R0""/L=FDE""Example6"<br /></span> <span style="color: #0000BB">FileClose$R3<br />
      <br />
      IfErrors0</span><span style="color: #007700">+</span><span style="color: #0000BB">2<br />
      MessageBoxMB_OK</span><span style="color: #DD0000">'error'<br />
      <br /></span> <span style="color: #0000BB">Exec</span><span style="color: #DD0000">'"notepad.exe""$0"'</span><span style="color: #007700">;</span><span style="color: #0000BB">viewlog<br />
      SectionEnd<br />
      <br /></span> <span style="color: #007700">Function</span><span style="color: #0000BB">Example6<br />
      StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">1$R8</span><span style="color: #DD0000">''</span><span style="color: #0000BB">$R2<br />
      <br />
      StrCmp$R6</span><span style="color: #DD0000">''</span><span style="color: #0000BB">0</span><span style="color: #007700">+</span><span style="color: #0000BB">3<br />
      CreateDirectory</span><span style="color: #DD0000">'$R1$1\$R7'<br /></span> <span style="color: #0000BB">gotoend<br />
      CreateDirectory</span><span style="color: #DD0000">'$R1$1'<br /></span> <span style="color: #0000BB">CopyFiles</span><span style="color: #007700">/</span><span style="color: #0000BB">SILENT$R9</span><span style="color: #DD0000">'$R1$1'<br />
      <br /></span> <span style="color: #0000BB">IfFileExists</span><span style="color: #DD0000">'$R1$1\$R7'</span><span style="color: #0000BB">0</span><span style="color: #007700">+</span><span style="color: #0000BB">3<br />
      FileWrite$R3</span><span style="color: #DD0000">"-old:$R9-new:$R1$1\$R7-success$\r$\n"<br /></span> <span style="color: #0000BB">goto</span><span style="color: #007700">+</span><span style="color: #0000BB">2<br />
      FileWrite$R3</span><span style="color: #DD0000">"-old:$R9-new:$R1$1\$R7-failed$\r$\n"<br />
      <br /></span> <span style="color: #0000BB">end</span><span style="color: #007700">:<br /></span> <span style="color: #0000BB">Push</span><span style="color: #007700">$</span><span style="color: #0000BB">0<br />
      FunctionEnd<br /></span></span> <!-- php buffer end -->
      <hr />
      So, i can copy files and see log :)<br />
      <br />
      Many thanks for your precious help :up:<br />
      <br />
      Bye bye
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">18th May 2010 12:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can rename "Example6" to whatever you want (i.e. "LocateCallback") just to make the function mean something.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">b179210</span><br />
      <span class="post-time small text-muted">20th May 2010 11:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        You can rename "Example6" to whatever you want (i.e. "LocateCallback") just to make the function mean something.<br />
        <br />
        Stu
      </blockquote>Yes, of course ;)
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
