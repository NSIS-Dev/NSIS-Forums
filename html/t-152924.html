<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="nsExec got a serious problem?"><title>nsExec got a serious problem? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">nsExec got a serious problem?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=152924">nsExec got a serious problem?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">zwuba</span><br><span class="post-time small text-muted">17th October 2003 11:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>nsExec got a serious problem?</strong><br>Hi there!<br><br>I just tried to execute a small app I wrote which spawns a XCopy (spawnlp) - when I execute it with ExecWait everything works fine but if I try to use nsExec nothing happens ... it that possible just because I'm creating another child process in my app?<br><br>It's not very urgent but very strange isn't it? :eek:</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">17th October 2003 12:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Please post details and script code.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">zwuba</span><br><span class="post-time small text-muted">17th October 2003 12:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This is the working script code:<br><br>SetOutPath "$INSTDIR\${TOOL_TYPE_DIR}\${SW_TOOLS_DIR}"<br>File "${SOURCE_BASE_DIR}\${TOOL_TYPE_DIR}\${SW_TOOLS_DIR}\Backup.exe"<br>ExecWait "$INSTDIR\${TOOL_TYPE_DIR}\${SW_TOOLS_DIR}\Backup.exe $INSTDIR\${TOOL_TYPE_DIR}"<br><br>If I replace ExecWait with nsExec::Exec nothing happens :(<br><br>What more details do you need?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">17th October 2003 13:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Are you sure the application does not start, or is there nothing on the screen?<br><br>You should get the nsExec return value from the stack to see what happends.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">DrO</span><br><span class="post-time small text-muted">17th October 2003 13:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">or try the modified version <a href="http://forums.winamp.com/showthread.php?postid=1126974#post1126974" target="_blank">here</a> with the ExecToLog option to see if the application is running, if it is then you should see an indicator going around<br><br>-daz</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">17th October 2003 15:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">There are a few major faults with the execution line to start with.<br><br>"$\"$INSTDIR\${TOOL_TYPE_DIR}\${SW_TOOLS_DIR}\Backup.exe$\" $\"$INSTDIR\${TOOL_TYPE_DIR}$\""<br><br>If $INSTDIR or other paths in the string have spaces, then the file may not be executed, and the parameters will become two or more parameters instead of one.<br><br>Use:<br>"$\"$INSTDIR\${TOOL_TYPE_DIR}\${SW_TOOLS_DIR}\Backup.exe$\" $\"$INSTDIR\${TOOL_TYPE_DIR}$\""<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">deguix</span><br><span class="post-time small text-muted">17th October 2003 20:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Is not better to explain with single quotes (')? (I know, is the same thing, but appear more "clean")<br><br>'"$INSTDIR\${TOOL_TYPE_DIR}\${SW_TOOLS_DIR}\Backup.exe" "$INSTDIR\${TOOL_TYPE_DIR}"'</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">zwuba</span><br><span class="post-time small text-muted">20th October 2003 07:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">hi again - some news for this issue..<br><br>I just tried using ExecToLog and found the following output in my log:<br>Wait Until backup is finished...<br>Backup created in: "C:\Backups\Backup20031020-083352"<br><br>That's output from my exe but no backup was created - not even the directory!<br><br>Here is the source of my exe - I'm using a xcopy to create the directory as you can see in the last line in main()<br><br>void main(int argc, char* argv[])<br>{<br>SYSTEMTIME st;<br>int i;<br>HANDLE hStdOut;<br>COORD dwSize;<br><br><br>if(argc &lt; 2)<br>{<br>printf("USAGE: SEZBackup c:\\CDS323\n");<br>printf(" or SEZBackup c:\\SP323\n");<br>printf(" got the idea?\n");<br>exit(1);<br>}<br>strcpy(szBackupSourceDirectory,argv[1]);<br><br>// Build Backup Directory Name<br>GetLocalTime(&amp;st);<br>sprintf(szBackupTargetDirectory,"C:\\Backups\\Backup%04d%02d%02d-%02d%02d%02d",st.wYear,st.wMonth,st.wDay,st.wHour,st.wMinute,st.wSecond);<br><br>SetConsoleTitle("Backup Started...");<br>printf("Wait Until backup is finished...\n");<br><br>//////////////////////////////////////////////<br>// Set Screen Buffer size of Handler window //<br>//////////////////////////////////////////////<br>hStdOut = GetStdHandle(STD_OUTPUT_HANDLE);<br>if (hStdOut != INVALID_HANDLE_VALUE)<br>{<br>dwSize.X = 50;<br>dwSize.Y = 3;<br>SetConsoleScreenBufferSize(hStdOut, dwSize);<br>}<br>printf("Backup created in: \"%s\"\n",szBackupTargetDirectory);<br><b>i=_spawnlp( _P_WAIT, "Xcopy.exe", "Xcopy.exe", szBackupSourceDirectory, szBackupTargetDirectory,"/V","/Q","/E","/I","/H","/R", NULL);</b><br>}<br><br>I'll now to use exec instead of _spawnlp maybe this will help ...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">zwuba</span><br><span class="post-time small text-muted">20th October 2003 08:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">_execlp and _execlpe also didn't help!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">20th October 2003 12:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Why use an external program for something NSIS can do? Use CopyFiles. If you really want XCopy you can use it from NSIS too. Just use nsExec to execute it so you won't get a console window.<br><br>To get the date you can use nsisdt from the Archive's download page or a System.dll call (Archive has some examples for that one I think. If not, there are some in the forum).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">zwuba</span><br><span class="post-time small text-muted">20th October 2003 13:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">thx kichik for the hint - I wrote this app just because I didn't know how to get the actual timestamp for the directory - I tried using nsisdt but I only got this -&gt; "Error: The file you requested could not be found!"<br><br>.. but even thou there is a problem with nsExec I believe</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">20th October 2003 13:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Are you sure the filename is correct (add a dir too)?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">DrO</span><br><span class="post-time small text-muted">20th October 2003 14:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">also it seems that you never test the value of <b>i</b> to determine if the process that you're trying to run was succesfully called or not.<br><br>saying that since you do the <b>printf("Backup created in: \"%s\"\n",szBackupTargetDirectory);</b> before anything has been done.<br><br>-daz</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">zwuba</span><br><span class="post-time small text-muted">20th October 2003 15:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes I'm really sure that all paths and filenames are correct because if I replace nsexec::ExecToLog with ExecWait everything works fine<br><br>I also disabled the silent mode of xcopy and with ExecToLog I got no more output in the log than i posted above but I should get at least one line for each copied file!<br><br>@Joost<br>Sorry I forgot to mention that I got this message when trying to download the zip file from the archive server :rolleyes:</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">DrO</span><br><span class="post-time small text-muted">20th October 2003 16:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">can you post an example to work with?<br><br>-daz</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">20th October 2003 22:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Try downloading again. Somehow all of the files got deleted :(</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">zwuba</span><br><span class="post-time small text-muted">21st October 2003 07:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">@kichik<br>downloads are now working fine - thx<br><br>@DrO<br>If attached the source of the backup tool (Backup.zip) and here is a part of my script where i do the call<br><br>Section "-CreateBackupSection"<br>;SectionIn RO<br><br>CreateDirectory "$INSTDIR\${TOOL_TYPE_DIR}\${RestoreRegistry_DIR}"<br><br>; Registry<br>nsExec::ExecToLog "regedit /e /s $INSTDIR\${TOOL_TYPE_DIR}\${RestoreRegistry_DIR}\RollbackRegistry.txt HKEY_LOCAL_MACHINE\${SEZ_REG_ROOTKEY}"<br><br>SetOutPath "$INSTDIR\${TOOL_TYPE_DIR}\${SW_TOOLS_DIR}"<br>File /r "${SOURCE_BASE_DIR}\${TOOL_TYPE_DIR}\${SW_TOOLS_DIR}\SEZBackup.exe"<br>ExecWait "$INSTDIR\${TOOL_TYPE_DIR}\${SW_TOOLS_DIR}\SEZBackup.exe $INSTDIR\${TOOL_TYPE_DIR}"<br><br>; delete Rollback.exe in Instdir<br>Delete "$INSTDIR\${TOOL_TYPE_DIR}\Rollback.exe"<br>RMDir /r "$INSTDIR\${TOOL_TYPE_DIR}\${RestoreRegistry_DIR}"<br><br>SectionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">DrO</span><br><span class="post-time small text-muted">22nd October 2003 13:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">zwuba is right, there does seem to be a problem with nsExec.<br><br>i tried the code posted and it is fine when run under Execwait but when you run it under nsExec there is no output seen from xcopy (i even tried just doing "xcopy /?" in ExecToLog(..) and nothing came out :eek: ).<br><br>will check things more as to what the processes in nsExec are doing as soon as i can.<br><br>-daz</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>