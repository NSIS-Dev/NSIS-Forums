<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="System Font"><title>System Font - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">System Font</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=207640">System Font</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">bnicer</span><br><span class="post-time small text-muted">13th February 2005 13:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>System Font</strong><br>&nbsp; Is there a risk in changing the font of the installer?<br><br>Normally the default font "MS Shell Dlg" on Windows XP resolves as Tahoma. For "subjective" reasons I believe Microsoft Sans Serif looks better.<br><br>What would happen if the local target system does not have Microsoft Sans Serif?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">13th February 2005 13:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">All systems should have Sans Serif. This is so because in CSS, sans-serif is on the list of 'certified fonts' that <b>must exist on all systems</b> as specified by W3C.<br><br>Anyway, I'm sure that if the font you specify does not exist, then the default Windows font will be used anyway.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bnicer</span><br><span class="post-time small text-muted">13th February 2005 13:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">There are about three different Sans Serif fonts installed into the Windows Font folder.<br><br>Microsoft Sans Serif is not necessarily one of them.<br><br>I recently found this on the internet:<br><br>These are the only *.ttf fonts you will absolutely need...<br><br>arial.ttf<br>arialbd.ttf<br>arialbi.ttf<br>ariali.ttf<br>courbd.ttf<br>lucon.ttf<br>marlett.ttf<br>micross.ttf<br>tahoma.ttf<br>tahomabd.ttf<br>times.ttf<br>timesbd.ttf<br>verdana.ttf<br>verdanab.ttf<br>verdanai.ttf<br>verdanaz.ttf<br><br>Just now I've been experimenting with Vogue. I disable Vogue (in Adobe Type Manager) and the installer substitutes it with an illegible font.<br><br>This suggests you need to install and register fonts.<br><br>Is that true, and is there an easy script for it?<br><br>I'm too lazy to search the board, I guess.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bnicer</span><br><span class="post-time small text-muted">13th February 2005 14:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I had to make sure I wasn't spreading any lies.<br><br>I have a backup image of Windows 95 and the Fonts folder does not include micross.ttf = Microsoft Sans Serif.<br><br>That's the truth.<br><br>And I found this piece of code on the message board:<br></p><pre>
<code>
nsh
<br>System</code>::Call "GDI32::AddFontResourceA(t) i ('micross.ttf') .s"
<br>&gt;Pop $0
<br>&gt;# $0 is zero if the function failed
<br>&gt;SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0 
<br>&gt;

</pre>Would the system have time to register the font if a function were to call the code during the initialization in MUI_CUSTOMFUNCTION_GUIINIT?
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">13th February 2005 15:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://www.kayskreations.net/fonts/fonttb.html" target="_blank">http://www.kayskreations.net/fonts/fonttb.html</a><br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bnicer</span><br>
      <span class="post-time small text-muted">13th February 2005 15:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you, Stu,<br>
      <br>
      I visited your link.<br>
      <br>
      Windows XP has:<br>
      <br>
      Microsoft Sans Serif<br>
      Modern MS Sans Serif<br>
      <br>
      And Windows 95 only has:<br>
      <br>
      MS Sans Serif<br>
      <br>
      That might be a problem.<br>
      <br>
      As to using code or a plug-in to register the font, others have more experience than I do. I consider this a good point to ask:<br>
      <br>
      Can you register a font before an installation so it shows up during the installation?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">13th February 2005 18:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There's this cool plugin you can use on here (fonts.dll):<br>
      <a href="http://nsis.sourceforge.net/archive/download.php" target="_blank">http://nsis.sourceforge.net/archive/download.php</a><br>
      <br>
      You could try calling this in your installer's .onInit function, and then it should appear on your installer.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bnicer</span><br>
      <span class="post-time small text-muted">13th February 2005 23:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks. The plug-in is worth a shot.<br>
      <br>
      I tested my installer on Windows 95. A version of the installer where I changed the font to Microsoft Sans Serif replaced the missing font with a typeface that was too large. The size of the setup window increased from 503x386 to 668x469 pixels, and bold page headers did not become bigger.<br>
      <br>
      I will spare you the screenshot.<br>
      <br>
      I noticed something else in Windows 95. My code has a glitch, but I can't see what's wrong. I'm trying to hide a checkbox from non-NT Windows.<br></p>
      <pre>
<code>
onInit
<br>  UserInfo</code>::GetAccountType
<br>  Pop$1
<br>  StrCpy $ACCOUNT"$1" #
<br> StrCmp $ACCOUNT "Admin" showcheckbox 0
<br>  StrCmp $ACCOUNT"Power" showcheckbox next
<br>  showcheckbox:
<br>   StrCpy $ACCOUNT "access" #
<br> next:
<br>&gt;EndFunction
<br><br>&gt;Function SetCustom
<br>  StrCmp $ACCOUNT"access" 0 hidecheckbox
<br>   !insertmacro MUI_INSTALLOPTIONS_DISPLAY "ready.ini"
<br>    Goto end
<br>  hidecheckbox:
<br>    !insertmacro MUI_INSTALLOPTIONS_INITDIALOG "ready.ini"
<br>    Pop $MUI_HWND
<br>    GetDlgItem$0 $MUI_HWND "1203"
<br>   ShowWindow $0 ${SW_HIDE}
<br>    !insertmacro MUI_INSTALLOPTIONS_SHOW
<br>  end:
<br>&gt;FunctionEnd 
<br>&gt;

</pre>The checkbox is hidden in Windows 95 (and 98) without the <font color="darkred">UserInfo::GetAccountType</font> condition, so there must be something wrong with the condition. The code fails.<br>
      <br>
      Should I put this in a new topic under a new post, or is everyone okay with it?
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bnicer</span><br>
      <span class="post-time small text-muted">14th February 2005 09:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><i>continued from previous</i><br>
      <br>
      <b>RE</b>: a compatibility issue when asking for the account type on computers which don't have user accounts, Windows 9x and ME.<br>
      <br>
      The proposed work-around, to run an NT check before querying the account type, doesn't work either. I omitted that from the code excerpt. Here is the first function again with the part I left out:<br></p>
      <pre>
<code>
onInit
<br>  ClearErrors
<br>  UserInfo</code>::GetName
<br>  IfErrors next; an error occurs under Windows 9x!
<br> UserInfo::GetAccountType
<br>  Pop$1
<br>  StrCpy $ACCOUNT"$1" #
<br> StrCmp $ACCOUNT "Admin" showcheckbox 0
<br>  StrCmp $ACCOUNT"Power" showcheckbox next
<br>  showcheckbox:
<br>   StrCpy $ACCOUNT "access" #
<br> next:
<br>&gt;FunctionEnd 
<br>&gt;

</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">14th February 2005 12:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I think the reason that it's hidden on 9x is because of this:<br>
      ClearErrors<br>
      UserInfo::GetName<br>
      IfErrors next ; an error occurs under Windows 9x!<br>
      Am I correct to assume you generally want those without user accounts enabled (ie Win95) to have access... so you could change your code around a little if that is the case...</p>
      <pre>
<code>Function .onInit <br>  ClearErrors<br>  UserInfo::GetName<br>  IfErrors next ; an error occurs under Windows 9x!<br>  UserInfo::GetAccountType <br>  Pop $ACCOUNT<br>  StrCmp $ACCOUNT "Admin" next<br>  StrCmp $ACCOUNT "Power" next<br>    StrCpy $ACCOUNT "noaccess" #<br>  next:<br>FunctionEnd<br><br>Function SetCustom <br>  StrCmp $ACCOUNT "noaccess" hidecheckbox <br>    !insertmacro MUI_INSTALLOPTIONS_DISPLAY "ready.ini" <br>    Goto end <br>  hidecheckbox: <br>    !insertmacro MUI_INSTALLOPTIONS_INITDIALOG "ready.ini" <br>    Pop $MUI_HWND <br>    GetDlgItem $0 $MUI_HWND "1203" <br>    ShowWindow $0 ${SW_HIDE} <br>    !insertmacro MUI_INSTALLOPTIONS_SHOW <br>  end: <br>FunctionEnd</code>
</pre><br>
      <br>
      -Stu
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bnicer</span><br>
      <span class="post-time small text-muted">14th February 2005 14:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'd like to hide the checkbox. When a user ticks it, the shortcut folder will be put in the common startmenu folder for all users.<br>
      <br>
      That part of the code should be skipped by Windows 95, 98 and Windows ME. <font color="orangered">$ACCOUNT</font> should equal "" on those systems; "access" should be defined for Administrators and Power Users only.<br>
      <br>
      Maybe this is a topic for a new post.<br>
      <br>
      Better news on the original topic. If you change the installer font to "MS Sans Serif" instead of "Microsoft Sans Serif", it displays correctly in Windows 95, and Windows XP!</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">14th February 2005 16:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Have you used my code?<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bnicer</span><br>
      <span class="post-time small text-muted">14th February 2005 17:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry, no.<br>
      <br>
      I wasn't paying attention.<br>
      <br>
      Your code is better than mine, isn't it?<br>
      <br>
      I haven't tried it yet. I'll get on it.<br>
      <br>
      Thanks.<br>
      <br>
      ps: this should take about half an hour, if you want to hang around.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bnicer</span><br>
      <span class="post-time small text-muted">14th February 2005 18:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'll be out of commission for a few days I have a feeling.<br>
      <br>
      Either my motherboard short-circuited or the CPU. The whole computer is dead.<br>
      <br>
      No condolence messages, please.<br>
      <br>
      I might be up and running again sooner than you think.<br>
      <br>
      Then again, maybe not.<br>
      <br>
      ps: I'm sending this from a laptop in case you're wondering.<br>
      <br>
      pps: Be careful when you switch those harddisks.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">14th February 2005 18:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's practically the same except I've allowed those without user accounts (ie with no User Name) access for your check-box.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bnicer</span><br>
      <span class="post-time small text-muted">19th February 2005 04:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Stu, I'm back. In part.<br>
      <br>
      UserInfo::GetName fails to return an error... despite your slight variation. Thanks for the input (above).<br>
      <br>
      I think there is something perverse about the UserInfo plug-in. Wish I could put my finger on it.<br>
      <br>
      - Tom</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pengyou</span><br>
      <span class="post-time small text-muted">19th February 2005 13:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        UserInfo::GetName fails to return an error
      </blockquote>I have used the UserInfo plugin on Windows 9x systems and found that it does not return an error:<br>
      <br>
      UserInfo::GetName returns the Windows login name<br>
      UserInfo::GetAccountType returns "Admin"<br>
      <br>
      The source code for the plugin shows that GetAccountType will return "Admin" if used on Win9x systems. I think an earlier version of the UserInfo plugin did return an error but that was a long time ago (the current source code file is dated November 2003).
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bnicer</span><br>
      <span class="post-time small text-muted">19th February 2005 15:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's supposed to return an error (and skip to <font color="red">next</font>). On Windows 9x there are no users. <font color="blue">GetUserName</font> is followed by the <font color="blue">IfErrors</font> line.<br>
      <br>
      Concerning the source code, I agree with you. <font color="blue">UserInfo::GetAccountType</font> returns "Admin" on Win 9x systems. Again, why doesn't it just return "", which would be more accurate?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pengyou</span><br>
      <span class="post-time small text-muted">19th February 2005 15:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        On Windows 9x there are no users.
      </blockquote>This is not true - Win9x systems can have several users, each with their own Start Menu and desktop, etc.

      <blockquote>
        Again, why doesn't it just return "", which would be more accurate?
      </blockquote>I do not agree. On Win9x every user is an Administrator, i.e. they usually have full access to the system.

      <blockquote>
        GetUserName is followed by the IfErrors line.
      </blockquote>If you are referring to the UserInfo.nsi script, that script is dated six months before the source code for the plugin - it seems the example script was not updated when the plugin was changed to return "Admin" on Win9x systems.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bnicer</span><br>
      <span class="post-time small text-muted">19th February 2005 19:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am referring to the example.nsi. I took for granted that an error would be returned.<br>
      <br>
      I thought <font color="blue">GetAccountType</font> would detect the type of user account on NT-based OSes.<br>
      <br>
      There should be a plug-in to find out whether the user is on a non-NT-based OS.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bnicer</span><br>
      <span class="post-time small text-muted">20th February 2005 14:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I prefer happy endings and practical solutions.<br>
      <br>
      A solution to what?<br>
      <br>
      Well, if you have been following this thread, you will be aware that the example script for the UserInfo plug-in is somewhat outdated and somewhat misleading. I was misled into believing you could adopt the script in order to hide a checkbox under Windows 9x and Windows ME. You can't, but here's what you can do:<br>
      <br>
      1. Create a custom page (see ..\NSIS\Contrib\InstallOptions\Readme.html - "InstallOptions 2")<br>
      2. Create a checkbox field (edit the INI file)<br>
      3. Label the checkbox, for example: Make shortcuts available to all users<br>
      4. Insert the code below into your *.nsi script<br>
      <br></p>
      <pre>
<code>; Variables<br>Var ACCOUNT<br><br>Function .onInit <br>  ClearErrors<br>  ReadRegStr $0 HKLM \<br>  "SOFTWARE\Microsoft\Windows NT\CurrentVersion" CurrentVersion<br>  IfErrors next ; an error occurs under Windows 9x &amp; Windows ME!<br>  UserInfo::GetAccountType <br>  Pop $ACCOUNT<br>  StrCmp $ACCOUNT "Admin" end<br>  StrCmp $ACCOUNT "Power" end<br>  next:<br>    StrCpy $ACCOUNT "noaccess" #<br>  end:<br>FunctionEnd<br><br>; Ready to install page<br>Page custom SetCustom ValidateCustom "" ; Custom page. InstallOptions gets called in SetCustom.<br><br>Function SetCustom <br>  StrCmp $ACCOUNT "noaccess" hidecheckbox <br>    !insertmacro MUI_INSTALLOPTIONS_DISPLAY "ready.ini" <br>    Goto end <br>  hidecheckbox: <br>    !insertmacro MUI_INSTALLOPTIONS_INITDIALOG "ready.ini" <br>    Pop $MUI_HWND <br>    GetDlgItem $0 $MUI_HWND "1203" ; 1200 + field number - 1<br>    ShowWindow $0 ${SW_HIDE} <br>    !insertmacro MUI_INSTALLOPTIONS_SHOW <br>  end: <br>FunctionEnd</code>
</pre>Disclaimer: I'm only a junior member. I make mistakes.<br>
      <br>
      THE END
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>