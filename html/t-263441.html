<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Dynamic Version Information"><title>Dynamic Version Information - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Dynamic Version Information</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=263441">Dynamic Version Information</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Nniol</span><br><span class="post-time small text-muted">11th January 2007 07:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Dynamic Version Information</strong><br>Hi,<br><br>My install is rebuilt every night form a nightly build script, however ther version of the install file, set in<br><br>VIAddVersionKey /LANG=${LANG_ENGLISH} "FileVersion" "310.0.0.154"<br><br>VIProductVersion "310.0.0.154"<br><br>Must be the same the executable about to be installed, this can be retrieved using GetDllVersionLocal, however seeing as VIAddVersionkey and VIProductVersion can not be in Sections or Functions it is hard to make dynamic.<br><br>Is it possible to retrieve the version information in .onInit and then assign it to a variable which is later assigned in VIAddVersionKey and VIProductVersion<br><br>VIProductVersion $DynamicallyDeterminedVersionNumber<br>VIAddVersionKey /LANG=${LANG_ENGLISH} "FileVersion" $DynamicallyDeterminedVersionNumber<br><br><br>Nniol</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">11th January 2007 08:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">on the top of your script execute with !system an exe that retrieves the desired info and adds them as defines to a header e.g. versions.nsh and then !include versions.nsh to your script.<br>e.g.<br>the small exe:<br>section<br>FileOpen $0 '$EXEDIR\versions.nsh<br>call GetDllVersionLocal<br>FileWrite $0 '!define File_Ver "&lt;resulting_var_from_call&gt;"$\r$\n'<br>FileClose $0<br>sectionend<br><br>the main script,<br>!system "$EXEDIR\small.exe"<br>!include versions.nsh<br>............<br>VIProductVersion "${File_Ver}"</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">11th January 2007 08:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">edit: Red Wine beat me to it, that should teach me not to read some random blog before hitting submit :D</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Nniol</span><br><span class="post-time small text-muted">11th January 2007 09:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thaanks guys, a real life saver there<br><br>Nniol (not so Insane anymore)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">niteflyer</span><br><span class="post-time small text-muted">11th January 2007 12:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This macro does the same and a little more:<br><a href="http://nsis.sourceforge.net/NfUtils_header_file#nfu.SetVersionInfo" target="_blank">http://nsis.sourceforge.net/NfUtils_...SetVersionInfo</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">11th January 2007 13:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by niteflyer</i><br><b>This macro does the same and a little more:<br><a href="http://nsis.sourceforge.net/NfUtils_header_file#nfu.SetVersionInfo" target="_blank">http://nsis.sourceforge.net/NfUtils_...SetVersionInfo</a></b></blockquote>No doubt, though, I'd need an example to show me how to achieve the requested by Nniol issue. That's why my preferred way was the very simple code above :)</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">niteflyer</span><br><span class="post-time small text-muted">11th January 2007 13:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">${nfu.SetVersionInfo} does not include /LANG= in VIAddVersionKey but you could use ${nfu.!FileVersion} to store the version in a symbol:<br><br></p><pre>
<code><br>${nfu.!FileVersion} DynamicallyDeterminedVersionNumber "c:\myproject\myapp.exe"<br>VIProductVersion ${DynamicallyDeterminedVersionNumber}<br>VIAddVersionKey /LANG=${LANG_ENGLISH} "FileVersion" ${DynamicallyDeterminedVersionNumber}<br></code>
</pre><br>
      should do it (untested).<br>
      <br>
      see <a href="http://nsis.sourceforge.net/NfUtils_header_file#nfu..21FileVersion" target="_blank">http://nsis.sourceforge.net/NfUtils_....21FileVersion</a><br>
      <br>
      If you dont need /LANG in VIAddVersionKey then you might want to use<br>
      <br>
      <pre>
<code><br>${nfu.SetVersionInfo} "My Installer" "c:\myproject\myapp.exe" "My Company" "My Copyright 2007" "No Comments" <br></code>
</pre>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script type="text/javascript" src="../js/highlight.pack.js" async>
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>