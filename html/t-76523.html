<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Patching a previous NSIS installed program?" />

  <title>Patching a previous NSIS installed program? - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Patching a previous NSIS installed program?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=76523">Patching a previous NSIS installed program?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Nothus</span><br />
      <span class="post-time small text-muted">19th February 2002 04:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Patching a previous NSIS installed program?</strong><br />
      I wrote a little proggie, and used NSIS to install it.<br />
      <br />
      Now, I'd like to be able to patch my program, and am wondering how to make NSIS make sure that the dir the user is trying to install the patch to - really is where the original proggie is installed.<br />
      <br />
      I very much a n00b when it comes to NSIS, so I can't figure it out.<br />
      <br />
      What I need:<br />
      <br />
      Is there a way for NSIS to do a check for a certain file (in the dir that the user selects) and make sure that file is there (so that I'll know that my proggie is really installed there) and if its not, popup a error box, then kick user back to the DIR selection screen to try again??<br />
      <br />
      Does that make sense?? :)<br />
      <br />
      I'm sure its easy as hell, but I don't know NSIS well.<br />
      <br />
      THX!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rainwater</span><br />
      <span class="post-time small text-muted">19th February 2002 05:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This comes straight from the docs:<br />
      <br />
      Function .onVerifyInstDir<br />
      IfFileExists $INSTDIR\Winamp.exe PathGood<br />
      Abort<br />
      PathGood<br />
      FunctionEnd<br />
      <br />
      Of course you can add your own messageboxes as needed.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Nothus</span><br />
      <span class="post-time small text-muted">19th February 2002 06:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">thx!!<br />
      <br />
      however, one problem - when the error box pops up, you have to hit it<br />
      twice to dismiss it. Not a serious bug, but annoying.<br />
      <br />
      Here is my exact code:<br />
      <br />
      <br />
      Function .onVerifyInstDir<br />
      IfFileExists $INSTDIR\myfile.exe PathGood<br />
      MessageBox MB_OK "Sorry - this is not where myfile is, please try again."<br />
      PathGood:<br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rainwater</span><br />
      <span class="post-time small text-muted">19th February 2002 06:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You forgot to put the abort command in your example. This will keep the install button from being enabled.<br />
      <br />
      There does seem to be a bug however. The same problem occured when I tested it. Sounds like onVerifyInstDir is being called twice.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Nothus</span><br />
      <span class="post-time small text-muted">19th February 2002 06:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok.<br />
      <br />
      I wanted the Msg box to let users know that they had picked a wrong dir - else just having the install button not work might confuse them.<br />
      <br />
      is there a way to have the msg box AND abort both called? would that fix the bug?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rainwater</span><br />
      <span class="post-time small text-muted">19th February 2002 07:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Function .onVerifyInstDir<br />
      IfFileExists $INSTDIR\myfile.exe PathGood<br />
      MessageBox MB_OK "Sorry - this is not where myfile is, please try again."<br />
      Abort<br />
      PathGood:<br />
      FunctionEnd<br />
      <br />
      But the bug is still present (2 msgboxes). I will take a look and see why onVerifyInstDir is being called twice.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Nothus</span><br />
      <span class="post-time small text-muted">19th February 2002 07:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ok.<br />
      <br />
      Thx for your help! And thanks for checking out this bug. Its not serious, but it is kinda annoying.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br />
      <span class="post-time small text-muted">19th February 2002 11:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Use a structure from RegCode, see:<br />
      <br />
      <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=70530" target="_blank">http://forums.winamp.com/showthread....threadid=70530</a><br />
      <br />
      Summarized: use .onNextPage to trigger an alternative .onVerifyInstDir that will only be called when clicking "Install" and only once!<br />
      <br />
      A little extract:<br /></p>
      <pre>
<code><br />Function .onNextPage<br />  StrCmp $R9 1 good1<br />    StrCmp $R9 2 good2<br />      IntOp $R9 $R9 + 1<br />      Return<br />  good1:<br />  ...<br /><br />  ; alternative .onVerifyInstDir (only triggered when install is hit!)<br />  good2:<br />  IfFileExists "$INSTDIR" 0 PathGood<br />    MessageBox MB_YESNO|MB_ICONQUESTION '"$INSTDIR" allready exists. Continue?$\r$\n$\r$\nIf you continue a backup of existing files will be created during install in:$\r$\n"$INSTDIR\Backup by App"' IDYes PathGood<br />    Abort<br />  PathGood:<br />  IntOp $R9 $R9 + 1<br />FunctionEnd</code>
</pre><br />
      Be sure to adapt the page numbers to your install!<br />
      <br />
      <br />
      Maybe that's a solution to the problem. It avoids the bug anyway!<br />
      <br />
      Good luck, greetz, Hendri.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br />
      <span class="post-time small text-muted">19th February 2002 11:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">BTW,<br /></p>
      <pre>
<code>Function .onInit<br />  Strcpy $R9 0<br />FunctionEnd</code>
</pre>should also be included of course, but you can find everything in a zip at the url above.<br />
      <br />
      Good luck,<br />
      -Hn3.
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
