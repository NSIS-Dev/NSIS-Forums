<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="VPatch 3 wish list"><title>VPatch 3 wish list - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">VPatch 3 wish list</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=204921">VPatch 3 wish list</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">14th January 2005 22:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>VPatch 3 wish list</strong><br>I am currently rewriting VPatch (the patch generator at least) from scratch again in C++. I want to add/fix the following issues:<br>- the Delphi GenPat cannot handle files larger than 500 MB or so. Maybe even to the point where the files aren't kept completely in memory anymore... but that will hurt performance.<br>- add storage of target file date (metadata) and restore it on the target file<br>- use MD5 instead of CRC32 to decrease probability of clashes. I have had some reports of problems with CRC32... but it will make the NSIS plugin slightly bigger probably.<br><br>And the rest stays the same.<br><br>All this means I have to break compatibility of the current VPatch format. Are there any other feature requests?<br>What do you think about breaking the format in general?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bluenet</span><br><span class="post-time small text-muted">15th January 2005 00:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I want to known what problem with CRC32?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">15th January 2005 11:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Some people had a problem with the source files in a single patch having the same CRC, and/or the source and target file having the same CRC.<br>Since file identification is done on just the CRC, that can break things. It would be 'better' to use either MD5 or CRC+filesize.<br><br>I'm starting to wonder however, perhaps I should remain backwards compatible somehow to the old format. Breaking everything might not be worth it, and the features needed can be squeezed in as well.<br><br>Can anyone tell me if patching files bigger than 2GB is an issue for anyone?<br><br>Also, VPatch does not support 'direct patching' where there is just a byte patch and the rest of the file remains the same. For big files, that can be handy, but then there is no way to verify the checksum or undo anything if the patch fails...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br><span class="post-time small text-muted">15th January 2005 17:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">GREAT to hear, vpatch will be updated. i think, it's a very useful and powerful patching feature.<br><br></p><blockquote>Also, VPatch does not support 'direct patching' where there is just a byte patch and the rest of the file remains the same.</blockquote>this would be useful, indeed, as it may decrease patch's filesize.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">15th January 2005 22:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Direct patching does not lead to smaller files, as it is really a more limited version of the current patching possible. The difference in patch file size would be about 28 bytes, but this is not compensated by the increase in NSIS plugin size (which would get bigger). Also, I do not know how the situation where patching the file fails should be handled in direct patching: you have modified the original file, but it did not end up the way you wanted it to...<br><br>Current version target is now 2.5 instead of 3 because compatibility will remain. New in 2.5 will be: low memory usage! The memory usage is some fixed size (say 16MB or so) plus a certain percentage of the original file, depending on the block size you select. Smaller blocks lead to smaller patches, but uses more memory. I do not yet know how this affects performance.<br><br>I have found a case where VPatch will 'break down' and become very slow (the algorithm suddenly becomes quadratic instead of N log N). This happens a lot with big files.<br><br>Does anybody know a good checksum function which can convert a block of a certain size (always a power of 2) to a 'unique' checksum which is very different for small changes? MD5 is good, I know, but computing it, how fast is it? I need to do it millions of times so it has to be fast.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">16th January 2005 09:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The Delphi version used a slightly modified variant of Adler32 (undocumented), the C++ version now uses true Adler32 and the first 8 bytes of a block for block identification.<br>This greatly reduces the 'quadratic failure' I had before, but I have now fixed it by limiting the number of blocks that can match (to say 100).<br><br>To get a speed impression: patching a 37 MB file to a 19 MB file takes around 8 seconds with 2.5 and 107 seconds with 2.1. :D</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">29th January 2005 16:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Target file date storage will mean that the NSIS plugin needs to be extended (a little bit).<br><br>I have attached the change needed to the CVS vpatchdll.cpp file to support the upcoming new C++ patch generator. Compatibility with previous versions is maintained, but this updated DLL will be mandatory since now file dates are stored by default in the upcoming patch generator.<br><br>Can someone with CVS access upload this file?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">29th January 2005 17:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'll upload it when it's all ready.<br><br>BTW, why is targetModifiedTime global if it's only used in DoPatch and is always initialized?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">29th January 2005 20:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Good point. It doesn't have to be. I would have declared it 'inline' together with the initialization, but C doesn't like declaring variables there, only at the start of the function. I kind of forgot that.<br><br>I am working on a new distribution with everything (including much better docs). Also, I am going to have a VPatchLib.nsh with a macro which allows easy use of Vpatch, can that go into the Include folder when it's ready?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">29th January 2005 21:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Koen van de Sande</i><br><b>... can that go into the Include folder when it's ready?</b></blockquote>Sure.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">30th January 2005 22:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I have uploaded a release candidate of VPatch 3. This version is feature-complete and is ready for testing.<br><br>You can download it from <a href="http://www.tibed.net/files/vpatch3releasecandidate.zip" target="_blank">http://www.tibed.net/files/vpatch3releasecandidate.zip</a><br><br>What's new in v3-RC:<br>- new patch generator in C++, much faster and lower memory usage<br>- dates on files to update are preserved (given date of the target file on the build system)<br>- updated NSIS example using new VPatchLib, which handles error checking for you. Also, it should be clearer than the old example.<br>- more verbose error messages in the EXE runtime<br>- new DLL runtime<br>- fixed incorrect documentation<br>- GUI now uses the command-line patch generator instead of a built-in version, making results the same (and reducing complexity).<br><br>Note: this version has its version number set to 3.0 and will be released as 3.0 if there are no problems. So please remember, you are using a release candidate which might be updated later.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>