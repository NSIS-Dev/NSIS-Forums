<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Overwrite a file in use" />

  <title>Overwrite a file in use - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Overwrite a file in use</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=257330">Overwrite a file in use</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pkid</span><br />
      <span class="post-time small text-muted">11th October 2006 12:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Overwrite a file in use</strong><br />
      Hi<br />
      <br />
      I was wondering if anybody knows how to force a file to be overwritten even if it is open? I know that there is a Win32 API function that can unlock files but I am not sure how to use it with NSIS. The file is on a mapped network drive.<br />
      <br />
      Thanks</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">CancerFace</span><br />
      <span class="post-time small text-muted">11th October 2006 23:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You could try the <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/stgmgmt/fs/network_share_management_functions.asp" target="_blank">Network Share Management Functions</a>.<br />
      Use <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/stgmgmt/fs/netfileenum.asp" target="_blank">NetFileEnum</a> or <a href="http://msdn.microsoft.com/library/en-us/stgmgmt/fs/netfilegetinfo.asp" target="_blank">NetFileGetInfo</a> to get the ID of the open file, then call <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/stgmgmt/fs/netfileclose.asp" target="_blank">NetFileClose</a> or <a href="http://msdn.microsoft.com/library/en-us/netmgmt/netmgmt/netfileclose2.asp" target="_blank">NetFileClose2</a> to force the file to close.<br />
      CF</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pkid</span><br />
      <span class="post-time small text-muted">28th February 2007 06:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi<br />
      <br />
      Can I be a real idiot and ask for the Nullsoft script code to do this? In my intaller I use file *.* to extract the files to the Temp folder. I then selectively copy files from the temp folder to the install path. Say I am trying to copy file test.dll and the copy is in use in the install path. How would I go about unlocking it?<br />
      <br />
      And then how could I unlock a file if it is in a local folder and in use (e.g. would be c:\myfile.dll)<br />
      <br />
      Thanks!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">28th February 2007 12:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Look in the wiki for <a href="http://nsis.sourceforge.net/UpgradeDLL_Func_function" target="_blank">UpgradeDll</a>. That page has a function to do just what you're looking for.<br />
      <br />
      Don</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pkid</span><br />
      <span class="post-time small text-muted">28th February 2007 12:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I had looked at that. The files are on a server that can't be rebooted and the users often forget to close down the application before they leave. So we can't reboot the server, the files are locked and we need to overwrite them.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">28th February 2007 14:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Maybe this would work: rename the dlls that are locked (I suggest that you use GetTempFileName and then delete the file that it creates or the rename will fail), and then copy your new dll into the directory. New applications should load with the new version of the dll and running applications will still use the old renamed dll.<br />
      <br />
      You can clean up those old renamed Dll's by 'Delete /REBOOTOK $TempFileName' so that whenever the server finally gets rebooted they will be removed.<br />
      <br />
      Don</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
