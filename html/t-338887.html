<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Why my install is blocked by svchost.exe"><title>Why my install is blocked by svchost.exe - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Why my install is blocked by svchost.exe</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=338887">Why my install is blocked by svchost.exe</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">olesio</span><br><span class="post-time small text-muted">6th December 2011 21:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Why my install is blocked by svchost.exe</strong><br>Hello. Why my setup exe is blocked by svchost.exe (I know it from LockHunter<br>which cannot unlock) after finished instaling. When I change OutFile line in<br>script below and add some text before filename because old name is locked and<br>cannot be overwritten I can delete setup file. Old setup can be deleted only<br>after reboot. I turned off KAV 2010 anti virus but it do not help. I'm using<br>NSIS 2.46 under Windows 7 (64 bit) with SP 1 and I have UAC turned off.<br>Please help me. The sctipy is below. And sorry for my bad English.<br></p><blockquote>!define FILESSOURCEPATH "D:\UPLOAD\WINUAE\"<br>Section<br>SetOutPath "$INSTDIR\HARD_DISKS"<br>File /r "${FILESSOURCEPATH}HARD_DISKS\Demos"<br>File /r "${FILESSOURCEPATH}HARD_DISKS\HD-Games"<br>SectionEnd<br><br>!define APPDIR "WINUAE_WITH_TINY_LAUNCHER"<br>!define APPEXE "winuae_tl.exe"<br>!define APPNAME "WinUAE + Tiny Launcher + Demos + Games"<br>!define SETUPEXE "tl_games_and_demos_setup.exe"<br>!define WINUAEREGKEY "Software\_Tiny_Launcher_WinUAE"<br>!define TLCONFIGFILE "CONFIGURATIONS\!_tl.winuae"<br>!define MUI_WELCOMEPAGE_TITLE_3LINES<br><br>!include "MUI.nsh"<br>!include "nsDialogs.nsh"<br><br>Var DIALOG<br>Var MESSAGE<br><br>; The name of the installer<br>Name "${APPNAME}"<br><br>; The output file to write<br>OutFile D:\${SETUPEXE}<br><br>; The default installation directory<br>InstallDir $PROGRAMFILES\${APPDIR}<br><br>; Request application privileges for Windows Vista<br>RequestExecutionLevel user<br><br>;--------------------------------<br><br>; Pages<br><br>!insertmacro MUI_PAGE_WELCOME<br><br>; Custom page<br>Page custom AboutSetupContent<br><br>; Installer pages<br>!insertmacro MUI_PAGE_COMPONENTS<br>!insertmacro MUI_PAGE_DIRECTORY<br>!insertmacro MUI_PAGE_INSTFILES<br><br>!define MUI_FINISHPAGE_RUN<br>!define MUI_FINISHPAGE_RUN_TEXT "Launch WinUAE + Tiny Launcher"<br>!define MUI_FINISHPAGE_RUN_FUNCTION "LaunchApp"<br>!insertmacro MUI_PAGE_FINISH<br><br>; Uninstaller pages<br>!insertmacro MUI_UNPAGE_WELCOME<br>!insertmacro MUI_UNPAGE_CONFIRM<br>!insertmacro MUI_UNPAGE_INSTFILES<br><br>!insertmacro MUI_LANGUAGE "English"<br><br>;--------------------------------<br><br>; own custom page<br><br>Function AboutSetupContent<br><br>nsDialogs::Create 1018<br>Pop $DIALOG<br>!insertmacro MUI_HEADER_TEXT "About $(^NameDA) package." "This setup and its contents was prepared by olesio."<br>nsDialogs::CreateControl STATIC ${WS_VISIBLE}|${WS_CHILD}|${WS_CLIPSIBLINGS} 0 10 30 500 300 "\<br>Following package contains WinUAE - Amiga Emulator for Windows in a little\<br>bit changed version and special configuration file. Also it contain\<br>Kickstart 3.1 ROM Image and hard disk file (*.hdf) with Tiny Launcher\<br>written by user called GIBS from EAB (<a href="http://eab.abime.net" target="_blank">http://eab.abime.net</a>). I also\<br>included: Demoscene productions and popular games. Both in WHDLoad\<br>versions. This package license is no warranty. WARNING! One very\<br>important thing: you MUST own legal registered WHDLoad key and\<br>copyrighted Amiga Kickstart ROM version 3.1 file to use this setup!\<br>Enjoy and please visit TheCompany World Wide Web Page at:\<br><a href="http://thecompany.pl" target="_blank">http://thecompany.pl</a> for many Amiga Games as easy to use executables."<br>Pop $MESSAGE<br>nsDialogs::Show<br><br>FunctionEnd<br><br>Function LaunchApp<br>ExecShell "" "$INSTDIR\${APPEXE}"<br>FunctionEnd<br><br>; The stuff to install<br><br>Section "Required files" Section1<br><br>SectionIn RO<br><br>; Put files there<br>SetOverwrite on<br>SetOutPath "$INSTDIR\CONFIGURATIONS"<br>File "${FILESSOURCEPATH}${TLCONFIGFILE}"<br>SetOutPath "$INSTDIR\ROMS"<br>File "${FILESSOURCEPATH}ROMS\kick31.rom"<br>SetOutPath "$INSTDIR\HARD_DISKS"<br>File "${FILESSOURCEPATH}HARD_DISKS\4_tiny_launcher.hdf"<br>SetOutPath $INSTDIR<br>File "${FILESSOURCEPATH}${APPEXE}"<br><br>; Write WinUAE paths<br>WriteRegStr HKCU "${WINUAEREGKEY}\DetectedROMs" "ROM_015" 'KS ROM v3.1 (A1200) rev 40.68 (512k) [391773-01/391774-01] / "$INSTDIR\ROMS\kick31.rom"'<br>WriteRegStr HKCU "${WINUAEREGKEY}" "KickstartPath" "$INSTDIR\Roms\"<br>WriteRegStr HKCU "${WINUAEREGKEY}" "hdfPath" "$INSTDIR\HARD_DISKS\"<br>WriteRegStr HKCU "${WINUAEREGKEY}" "ConfigurationPath" "$INSTDIR\Configurations\"<br>WriteRegStr HKCU "${WINUAEREGKEY}" "ScreenshotPath" "$INSTDIR\Screenshots\"<br>WriteRegStr HKCU "${WINUAEREGKEY}" "StatefilePath" "$INSTDIR\Savestates\"<br>WriteRegStr HKCU "${WINUAEREGKEY}" "SaveimagePath" "$INSTDIR\SaveImages\"<br>WriteRegStr HKCU "${WINUAEREGKEY}" "VideoPath" "$INSTDIR\"<br>WriteRegStr HKCU "${WINUAEREGKEY}" "InputPath" "$INSTDIR\Inputrecordings\"<br>WriteRegStr HKCU "${WINUAEREGKEY}" "RipperPath" "$INSTDIR\"<br>WriteRegDWORD HKCU "${WINUAEREGKEY}" "QuickStartModel" 4<br>WriteRegDWORD HKCU "${WINUAEREGKEY}" "ConfigurationCache" 0<br>WriteRegDWORD HKCU "${WINUAEREGKEY}" "QuickStartConfiguration" 1<br>WriteRegDWORD HKCU "${WINUAEREGKEY}" "QuickStartCompatibility" 1<br><br>; Write the uninstall keys for Windows<br>WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPDIR}" "DisplayName" "${APPNAME}"<br>WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPDIR}" "UninstallString" '"$INSTDIR\uninstall.exe"'<br>WriteRegDWORD HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPDIR}" "NoModify" 1<br>WriteRegDWORD HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPDIR}" "NoRepair" 1<br>WriteUninstaller "uninstall.exe"<br><br>SectionEnd<br><br>; Optional section (can be disabled by the user)<br><br>Section "Desktop shortcut" Section2<br><br>CreateShortCut "$DESKTOP\Run ${APPNAME}.lnk" "$INSTDIR\${APPEXE}" "" "$INSTDIR\${APPEXE}" 0<br><br>SectionEnd<br><br>Section "Start menu shortcut" Section3<br>CreateDirectory "$SMPROGRAMS\${APPNAME}"<br>CreateShortCut "$SMPROGRAMS\${APPNAME}\Run ${APPNAME}.lnk" "$INSTDIR\${APPEXE}" "-f .\${TLCONFIGFILE}" "$INSTDIR\${APPEXE}" 0<br>CreateShortCut "$SMPROGRAMS\${APPNAME}\Uninstall.lnk" "$INSTDIR\uninstall.exe" "" "$INSTDIR\uninstall.exe" 0<br><br>SectionEnd<br><br>;--------------------------------<br>; Descriptions<br><br>LangString DESC_Section1 ${LANG_ENGLISH} "WinUAE emulator (in changed version) and other required package files (configuration, kickstart, hdf file with TIny Launcher, Demos and Games)."<br>LangString DESC_Section2 ${LANG_ENGLISH} "Creates a shortcut on the Desktop."<br>LangString DESC_Section3 ${LANG_ENGLISH} "Creates a subdirectory with shortcuts in the Start Menu."<br><br>!insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br>!insertmacro MUI_DESCRIPTION_TEXT ${Section1} $(DESC_Section1)<br>!insertmacro MUI_DESCRIPTION_TEXT ${Section2} $(DESC_Section2)<br>!insertmacro MUI_DESCRIPTION_TEXT ${Section3} $(DESC_Section3)<br>!insertmacro MUI_FUNCTION_DESCRIPTION_END<br><br>;--------------------------------<br><br>; Uninstaller<br><br>Section "Uninstall"<br><br>; Remove registry keys<br>DeleteRegKey HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPDIR}"<br>DeleteRegKey HKCU "${WINUAEREGKEY}"<br><br>; Remove files and uninstaller<br>RMDir /r $INSTDIR<br>Delete $INSTDIR\uninstall.exe<br><br>; Remove shortcuts, if any<br>Delete "$DESKTOP\Run ${APPNAME}.lnk"<br>Delete "$SMPROGRAMS\${APPNAME}\*.*"<br><br>; Remove directories used<br>RMDir "$SMPROGRAMS\${APPNAME}"<br>RMDir "$INSTDIR"<br><br>SectionEnd</blockquote></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">6th December 2011 21:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Never had this problem before but I've never used that anti-virus either. What if you output as notepad.exe instead? Also you should !include MUI2.nsh instead of MUI.nsh (MUI2 uses nsDialogs which you are already using).<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">olesio</span><br><span class="post-time small text-muted">6th December 2011 23:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hmmm when I named notepad.exe I can easly change after install so file is not locked. But when I named before sss.exe pft.exe or similar I have problem with lock. Maybe is other reason why in 99% of cases first file will be blocked but after changing filename and copy by Sgift+F5 under Total Commander the new file after install is not blocked.<br><br>EDIT: hmmm I do not know why but now under name winuae_tiny_launcher_setup.exe everything is fine. So thank you for hint with filename and wit MUI2.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">isawen</span><br><span class="post-time small text-muted">15th March 2012 18:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Same problem here</strong><br>Hi guys,<br><br>I also have this problem, the svchost.exe is locking my installer file after I install the application. I can't unlocking it and can't recompile the script as the output cannot be written.<br><br>I have KAV but it's disabled. I'm running Windows 7 Enterprise 32bit and I use Eclipse as IDE for writing NSIS script.<br><br>Thanks in advance for any suggestions,<br>Daniel</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MarkC_SSL</span><br><span class="post-time small text-muted">24th April 2012 15:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I have this problem also.<br><br>I'm using Windows 7 Ultimate 64-bit, no anti-virus or suchlike installed.<br><br>The first install triggers an svchost process that sits at 25% CPU usage. If I kill that process then I can recompile, otherwise the output file cannot be overwritten.<br><br>Been using NSIS for other projects on the same machine with no problems. Current installer isn't hugely different to what I have done before.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">24th April 2012 16:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Attach your script or a minimum script which reproduces the problem.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MarkC_SSL</span><br><span class="post-time small text-muted">25th April 2012 09:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I've found the source of the problem but not a solution. My installer includes an MSI file that installs some of our software components. It looks like that .msi (driven by InstallShield) isn't completing cleanly and it's leaving a rogue msiexec process behind.<br><br>I'm using ExecWait to run the .msi - is there a better way?<br><br>Thanks,<br><br>Mark</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MarkC_SSL</span><br><span class="post-time small text-muted">27th April 2012 15:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Actually, my previous post was incorrect.<br><br>I changed the name of the Outfile as suggested in an earlier post and that seems to have fixed it.<br><br>Previously the filename was similar to:<br><br>"blahblahblah Setup v1.2.exe"<br><br>Changing it to:<br><br>"blahblahblah Setup.exe" fixed it.<br><br>Weird!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kalverson</span><br><span class="post-time small text-muted">1st October 2012 13:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This is a bit late, but we have run into an issue where the "Windows Defender" service is responsible for locking files. Stopping the Windows defender service releases the lock and you do not have to reboot. The Windows Defender service is running as an svchost.exe in task manager.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">olesio</span><br><span class="post-time small text-muted">2nd October 2012 15:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok, but I do not use Windows Defender. Only KAV 2010 is working as antivirus software in background.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>