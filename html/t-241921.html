<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Self deleting installer" />

  <title>Self deleting installer - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Self deleting installer</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=241921">Self deleting installer</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">stb</span><br />
      <span class="post-time small text-muted">27th March 2006 11:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Self deleting installer</strong><br />
      Hi,<br />
      <br />
      feature suggestion for NSIS scripting language:<br />
      <br />
      add some command like<br />
      <br />
      "SetDeleteOnQuit true"<br />
      <br />
      This command should set some flag and the installer should delete itself when terminating (caused e.g. by Quit,Abort...).<br />
      <br />
      I know this can be done manually using some tricks and I know that Uninstallers do something similar by default (when not using special arg ?=). But it could be useful in many situations. E.g. RegTool.bin (library.nsh) is compiled using a two-step installer so in fact that binary is an uninstaller to have the Delete-on-quit feature. Could be done the easy way then.<br />
      <br />
      The command should be runtime (not compile-time).<br />
      <br />
      For installers the value should be "false" by default, of course. I know there is some issue with current uninstallers: I guess they move themself to TEMP while loading. So I would let the behaviour of uninstallers as it is (besides SetDeleteOnQuit should delete $INSTDIR/uninstall.exe at the end).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">27th March 2006 12:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You probably can combine 4.7.2.1.9 .onUserAbort and <a href="http://nsis.sourceforge.net/File:SelfDel.zip" target="_blank">SelfDel plug-in</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">28th March 2006 17:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The command can't be a runtime command because this is done before any code is run. Uninstallers don't really delete themselves, they only copy themselves to the TEMP directory and set that copy to be deleted on reboot. The copy can then delete the original, if it wants to.<br />
      <br />
      It can be made a compile time command which will simply set the uninstaller flag to the generated installer. It's just one simple flag set in the firstheader structure, called FH_FLAGS_UNINSTALL.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">stb</span><br />
      <span class="post-time small text-muted">28th March 2006 20:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi kichik,<br />
      <br />
      compile time would help with those installer-in-installer packages like regtool.bin. But that's not what I want. Are you sure that Uninstallers do not delete themself. Using MoveFile(Ex) "/deleteonreboot" would be an easy solution (one could do manually), but IIRC Uninstaller does some self-delete trick like that one mentioned on the site mentioned in the selfdel plug-in (catch22...) But you're the expert so you'll know what you write.<br />
      <br />
      Why am I looking for a run-time command? I could use this to create dynamic installers which "update" themself (downloading a installer package and executing it). Currently I execute the downloaded installer package using ExecWait (has some other advantage but needs special handling for Mutex).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">28th March 2006 20:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Uninstallers only copy themselves to the TEMP directory and execute from. You don't have to use `Delete $INSTDIR\uninstall.exe`, so it doesn't really have to delete itself. You can do the same using CopyFiles, Exec and Delete /REBOOTOK.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">28th March 2006 20:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you are happy with deleting after a reboot, then surely Delete /rebootok "$EXEDIR\setup.exe" will work (unless there is something I am missing).<br />
      <br />
      You should get the installer file name first however, using this function:<br />
      <a href="http://nsis.sourceforge.net/Get_installer_filename" target="_blank">http://nsis.sourceforge.net/Get_installer_filename</a><br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">stb</span><br />
      <span class="post-time small text-muted">28th March 2006 20:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Stu,<br />
      <br />
      but I'm not "happy" with this. (Hey, this seems to easy... we're professionals, eh?) ;-)<br />
      <br />
      Please see my self-del runtime command suggestion as "nice to have". Maybe it can be done easily. I think this would be a valuable function making installers even more powerful. I currently work around using ExecWAIT so I can delete the sub-installer after it finishes.<br />
      <br />
      Again: Is this (current uninstaller behaviour) just delete-on-reboot? My guess is: no.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">28th March 2006 20:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's not only delete-on-reboot, it's copy to TEMP, optionally delete original immediately and delete copy on reboot. Please add the request to the feature request tracker.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">28th March 2006 20:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well I could create a Wiki page for this with a small executable download and macro to delete the installer...<br />
      <br />
      It would have to be called .onGUIEnd or whatever though.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mr Inches</span><br />
      <span class="post-time small text-muted">28th March 2006 21:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Although it is not done purely in NSIS script, you could also use the InstStub.exe/ExitStub.exe component within the CABSetup suite/plugin to run the (un)installer and have it deleted afterward. No reboots are required.<br />
      <br />
      This was one of the ideas used within that suite to handle the original installer not being available because the source media changed; copy the installer to the TEMP directory and have it removed automatically when it completes.<br />
      <br />
      For the uninstaller, it would mean leaving another file (other than than the uninstaller) on the target computer, but once executed, both files (InstStub and the uninstaller) would be deleted.<br />
      <br />
      Duncan</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br />
      <span class="post-time small text-muted">28th March 2006 22:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Another solution: make a wrapper for your exe that extracts the installer to the pluginsdir, then use exewait to run it. The installer is deleted when the wrapper has finished waiting for the installer to finish (I have done the same thing on one of my installers).</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
