<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Using GetDLLVersion and assign to MUI_VERSION ?"><title>Using GetDLLVersion and assign to MUI_VERSION ? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Using GetDLLVersion and assign to MUI_VERSION ?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=125865">Using GetDLLVersion and assign to MUI_VERSION ?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">GeoffCoope</span><br><span class="post-time small text-muted">21st February 2003 12:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Using GetDLLVersion and assign to MUI_VERSION ?</strong><br>Hi<br><br>I have a script that needs to get the version number from an exe file within the installation itself.<br><br>I can get the exe version of a file after it has been installed using the below code:<br><br>; Get Version of EXE file<br>GetDLLVersion "$INSTDIR\MyApp.exe" $R0 $R1<br>IntOp $R2 $R0 / 0x00010000 ; $R2 now contains major version<br>IntOp $R3 $R0 &amp; 0x0000FFFF ; $R3 now contains minor version<br>IntOp $R4 $R1 / 0x00010000 ; $R4 now contains release<br>IntOp $R5 $R1 &amp; 0x0000FFFF ; $R5 now contains build<br>StrCpy $0 "$R2.$R3.$R4.$R5" ; $0 now contains full version number<br><br>What I really want to do is get the version number of MyApp.EXE and assign that version number to the MUI_VERSION var at the start of the script. (I want to set the OutFile as MyApp + MUI_VERSION)<br><br>Is this possible ?<br><br>Thanks for any help<br>Geoff Coope</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">21st February 2003 13:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Have a look at the FAQ question "How can I make my script depend on some registry value/the version of my product/&lt;something dynamic&gt;?". It will help you here. What you basically need to do is create another script that will compile your script with makensis /DMUI_VERSION=1.2.3.4. It will get 1.2.3.4 from the script you posted above.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">GeoffCoope</span><br><span class="post-time small text-muted">21st February 2003 13:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Great idea, I understand.<br><br>Thanks<br>Geoff Coope</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">GeoffCoope</span><br><span class="post-time small text-muted">21st February 2003 14:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Kichik<br><br>What is the minimum I need to create this installer that runs my script?<br><br>I tried this but it doesn't do anthing.<br><br>Caption "Make MyApp"<br>InstallDir "."<br>OutFile "make.exe"<br><br>Section "Go"<br>SetOutPath "empty"<br>Call GetVersion<br>SectionEnd<br><br><br>; Get Version of EXE file and send to install_data.nsi<br>; ----------------------------------------------------<br>Function GetVersion<br><br>GetDLLVersion "c:\MyApp.Exe" $R0 $R1<br><br>IntOp $R2 $R0 / 0x00010000 ; $R2 now contains major version<br>IntOp $R3 $R0 &amp; 0x0000FFFF ; $R3 now contains minor version<br>IntOp $R4 $R1 / 0x00010000 ; $R4 now contains release<br>IntOp $R5 $R1 &amp; 0x0000FFFF ; $R5 now contains build<br>StrCpy $0 "$R2.$R3.$R4.$R5" ; $0 now contains string like "1.2.0.192"<br><br>Exec '"C:\Program Files\NSIS\makensis.exe /DVERSION=$0 C:\Projects\MyApp\NSIS\install_data.nsi"'<br><br>FunctionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">21st February 2003 14:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Could be wrong, but try prefixing the "Go" name with a minus sign. Sections with a leading minus are always executed, e.g. Section -Go or Section "-Go" (not sure about whether the quotes are needed or not, and no time to test this i'm afraid)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">GeoffCoope</span><br><span class="post-time small text-muted">21st February 2003 15:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Done it,<br><br>Here it is....<br><br>This Script will get a version number (if you set one) from your EXE file and pass it to another script (your main install script) as a parameter.<br><br>1. Create a script called make.nsi<br><br>------------------------------------------------------------------<br>; Make.nsi<br>; Geoff Coope<br>; Gets the Version Number from an EXE file and passes it as<br>; a parameter $VERSION to another script.<br><br>Caption "Make"<br>InstallDir "."<br>OutFile "make.exe"<br>SilentInstall silent<br><br>Section "DoNothing"<br>SectionEnd<br><br>Function .onInit<br><br>GetDLLVersion "c:\path\afile.exe" $R0 $R1<br><br>IntOp $R2 $R0 / 0x00010000 ; $R2 now contains major version<br>IntOp $R3 $R0 &amp; 0x0000FFFF ; $R3 now contains minor version<br>IntOp $R4 $R1 / 0x00010000 ; $R4 now contains release<br>IntOp $R5 $R1 &amp; 0x0000FFFF ; $R5 now contains build<br>StrCpy $0 "$R2.$R3.$R4.$R5" ; $0 now contains string like "1.2.0.192"<br><br>Exec '"C:\Program Files\NSIS\makensis.exe" "/DVERSION=$0" "c:\projects\aProject\data.nsi"'<br>FunctionEnd<br><br>------------------------------------------------------------------<br>2. Compile the above script and you end up with "Make.exe"<br>3. Open your main install script (ive called mine data.nsi in the above example) and add the line<br>!define MUI_VERSION ${VERSION}<br><br>4. Run Make.exe and it will:<br>a) Get version number from exe in the form (x.x.x.x)<br>b) Calls another script passing the version number as $VERSION to it<br><br>You can now create installations that have the Build number in the Folder, path, install file name, registry etc...<br><br>Thanks<br>Geoff Coope</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sealite</span><br><span class="post-time small text-muted">21st February 2003 16:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>I don't like the method</strong><br>This method is not very usefull and slow down the compilation process.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">21st February 2003 16:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Compiling one installer one time is a lot faster than letting NSIS parse your script for __DATE__ and __MYPROG.EXE_VERSION__.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>