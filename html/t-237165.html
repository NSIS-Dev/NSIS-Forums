<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="error with zipdll"><title>error with zipdll - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">error with zipdll</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=237165">error with zipdll</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">rod78</span><br><span class="post-time small text-muted">4th February 2006 17:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>error with zipdll</strong><br>I'm a newbie starting to use zipdll plugin.<br>I can't understand what's wrong with this script.<br>The setup terminates but with only example1.nsi in the destination directory, the content of the zipfile is not extracted. Details windows reports a strange error:<br><br><i>Output folder: C:\666666<br>Extract: example1.nsi... 100%<br>Extracting contents of test.zip to C:\666666<br>Error:<br>Completed</i><br><br>I include the source, please help.<br><br><i>!include "zipdll.nsh"<br>; The name of the installer<br>Name "Name"<br><br>; The file to write<br>OutFile "setup.exe"<br><br>; The default installation directory<br>InstallDir $PROGRAMFILES\example<br><br>;Page license<br>Page directory<br>Page instfiles<br><br>Function .onInit<br>MessageBox MB_YESNO "This will install my program. Do you wish to continue?" IDYES gogogo<br>Abort<br>gogogo:<br>IfFileExists "test.zip" +9 0<br>MessageBox MB_RETRYCANCEL "zipfile not found" IDRETRY true IDCANCEL false<br>true:<br>Goto gogogo<br>false:<br>MessageBox MB_ICONSTOP "Installation aborted."<br>Abort<br>FunctionEnd<br><br>; The stuff to install<br>Section "" ;No components page, name is not important<br><br>; Set output path to the installation directory.<br>SetOutPath $INSTDIR<br>; Put file there<br>File example1.nsi<br>!insertmacro ZIPDLL_EXTRACT "test.zip" "$OUTDIR" "&lt;ALL&gt;"<br>SectionEnd ; end the section</i><br><br>Thanks for your support :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">4th February 2006 17:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This code is wrong:</p><pre>
<code>IfFileExists "test.zip" +9 0</code>
</pre>You're jumping over the function's end. Labels are not instructions. That should probably be +5, but you should use a label anyway, it's simpler. You can also use the <a href="http://nsis.sourceforge.net/Docs/Chapter2.html#2.3.5.1" target="_blank">LogicLib</a>, it's even simpler than that.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rod78</span><br><span class="post-time small text-muted">4th February 2006 18:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">kichik, thanks for your response but i tried to remove the entire .onInit function and the error is still the same. :(</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comperio</span><br><span class="post-time small text-muted">4th February 2006 18:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This is one example where it may be better to avoid relative jumps.<br><br>If you use relative jumps, you'll have to remember to change them any time you add or remove lines of code.<br><br>But, if you do as kichik suggests, you can make your code a bit more forgiving.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comperio</span><br><span class="post-time small text-muted">4th February 2006 18:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It looks like you are checking for the zip file in $PROGRAMFILES\example, but then you let the user pick another directory for the installation. So, by the time you get to the section, you have switched to the $INSTDIR and are trying to unzip the file (which, of course, does not exist there.)<br><br>If you expect the zip file to exist in the target folder, then you need to do you check AFTER the user picks the directory.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rod78</span><br><span class="post-time small text-muted">4th February 2006 18:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks again for your help people but i think the main problem is not caused by wrong checking directory. Even this simple code doesn't work:<br><i>!include "zipdll.nsh"<br>OutFile "setup.exe"<br>InstallDir $PROGRAMFILES\example<br><br>Section<br>SetOutPath $INSTDIR<br>!insertmacro ZIPDLL_EXTRACT "test.zip" "$OUTDIR" "&lt;ALL&gt;"<br>SetOutPath $INSTDIR<br>File example1.nsi<br>SectionEnd</i><br><br>If i change "$OUTDIR" to a specified path (i.e "c:\test") it works as expected. But i need to extract a zipfile (located in the same dir of the installer) into the destination dir.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comperio</span><br><span class="post-time small text-muted">4th February 2006 19:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">OK, I downloaded ziplib just so I could see what was going on.<br><br>I think I may have found the problem:<br>the insertmacro command (ZIPLIB_EXTRACT) is a compile-time command. $OUTDIR is a runtime variable. Therefore, $OUTDIR won't be defined when the insertmacro command is called, which is likely why your script is failing.<br><br>I found that if I changed the statement to call the plugin directly, it works perfectly:<br><br>ZipDLL::extractall "test.zip" "$OUTDIR"<br><br>The other alternative would be to wrap the extract commands into a function that you can call during runtime, but using the pluging directly is probably just as easy unless you need additional language support. (You may even want to talk to the author about any addtional change requests.)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rod78</span><br><span class="post-time small text-muted">4th February 2006 19:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks Comperio, it make sense.<br>But your code still output an error (see details) and the content of the zipfile is not extracted.<br>Can you confirm please ?<br>I'm using this code:<br><br><i>!include "zipdll.nsh"<br>OutFile "setup.exe"<br>InstallDir $PROGRAMFILES\example<br><br>Section<br>SetOutPath $INSTDIR<br>ZipDLL::extractall "test.zip" "$OUTDIR"<br>File example1.nsi<br>SectionEnd</i></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rod78</span><br><span class="post-time small text-muted">4th February 2006 19:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I resolved the problem.<br>I need to use "$EXEDIR\test.zip" to locate the zipfile correctly. Please forgive me for spamming the forum :)<br>Thanks for your help.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comperio</span><br><span class="post-time small text-muted">4th February 2006 20:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Open mouth, insert foot...<br><br>I found out that I had setup my testing wrong before. Turns out that $OUTDIR really <b><u>DOES</u></b> work in your example above.<br><br>(I forgot that I used a different ZIP file in my 2 tests, but I failed to change the name in my script. This is why I inorrectly assumed it was a compile-time/runtime problem.)<br><br>At least it good to know that someone was awake!<br>:tinfoil:</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>