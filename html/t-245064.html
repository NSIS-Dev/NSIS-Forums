<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="BgGradient and CRC patch"><title>BgGradient and CRC patch - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">BgGradient and CRC patch</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=245064">BgGradient and CRC patch</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br><span class="post-time small text-muted">1st May 2006 01:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>BgGradient and CRC patch</strong><br>I have just got back from my two week holiday from college, and I have been busy. I have added a patch to add a border, a title bar, and a system menu to bggradient, with defines in scons to turn it on and off. I also added to the crc check the ability to move a progress bar. You have to add the progress bar to the verify dialog using resource hacker, and give it and id of 3003 (I think). InstallSpiderUI already has the progress bar on it. Requires nsis 2.07 and above.<br><br>Here is the binary stubs...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br><span class="post-time small text-muted">1st May 2006 01:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">...and here is the source code. Will now work on a stub that has no compression code in it for the installers that have 'SetCompress off' in the script (for a smaller stub and to say there is 'Using no compression' instead of 'Using zlib compression' after you compile a script).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">3rd May 2006 11:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for the patches. Please submit patches to the <a href="http://sourceforge.net/tracker/?group_id=22049&amp;atid=373087" target="_blank">patch tracker</a> for easier tracking.</p><ul><li>What's the byte count on those features?</li><li>Did you test the gradient window changes with minimizing, maximizing, window switching, etc.?</li><li>2.07 required because of SCons?</li></ul></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br><span class="post-time small text-muted">3rd May 2006 23:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I am not a member of sourceforge.net yet, so I can't submit patches.<br><br>1. 1KB extra on stubs (half a KB on some)<br><br>2. Yes I have tested the patch, and the latest InstallSpiderUI release uses this patch. I made the bggradient window a child of a dummy window so that the taskbar button for the bggradient window does not show. I also disabled the minimize and maximize buttons, as well as disabling the window, so that the user cannot interact with the bggradient window on runtime (it still minimizes and maximizes with the main installer window).<br><br>3. I just relised it could actually be used with any nsis version (not just the scons built nsis) because I included a file (config_old_scons_nsis.h) with the defines for older scons nsis versions, which could be used for pre scons nsis versions as well. My mistake.<br><br>Note: files for source code taken from nsis 2.15 source.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">4th May 2006 14:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>I am not a member of sourceforge.net yet, so I can't submit patches.</blockquote>Signing up is free and requires no more than 5 minutes.<ol style="list-style-type: decimal"><li>Did you check the exact numbers in the map file?</li><li>Tried all the winkey shortcuts? Winkey+M, Winkey+D? Other applications minimizing the window? I only ask because it took me a while to get it right for the current implementation.</li></ol></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br><span class="post-time small text-muted">5th May 2006 02:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">1. Didn't know there was a map file :confused:.<br><br>2. As far as I can see, winkey+D and winkey+M do work correctly. The only thing I added for the patch is a dummy window, and changed the window style to make it have a title bar and system menu (although they can't actually be used). I have commented where the extra code is in the source.<br><br>Just registered at sourceforge.net.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br><span class="post-time small text-muted">15th May 2006 02:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Another update (hopefully for good). Fixed the bottom of the window not covering the taskbar. As before, binary stubs for NSIS 2.07 and above...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br><span class="post-time small text-muted">15th May 2006 02:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">...and the source for (almost) any nsis version.<br><br>[edit]This one will be submitted to the patch tracker in the near future (don't know how near).[/edit]</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br><span class="post-time small text-muted">16th May 2006 01:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, that day in the near future has come and gone. I have just submitted it to the patch tracker <a href="http://sourceforge.net/tracker/index.php?func=detail&amp;aid=1489215&amp;group_id=22049&amp;atid=373087" target="_blank">here</a>.<br>[edit]fixed typo[/edit]</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br><span class="post-time small text-muted">22nd May 2006 05:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I stated that the progress bar id for the verify dialog was 3003, when it is actually 3300. I didn't check until now :rolleyes:.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br><span class="post-time small text-muted">16th August 2006 00:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I have revived work on this little project again. This time, I am adding the patch as switches to the BGGradient command.<br><br>[edit]Forgot to say that the crc progress bar will not be in this patch.[/edit]<br><br>I added it in the last hour or so to the source of NSIS 2.19. I will be compiling and testing over the next five days to make sure it works the way I intended. Example usage:<br><br>BGGradient /TITLEBAR /DROPSHADOW 0000FF 000000 FFFFFF<br><br>The /TITLEBAR option adds a border and title bar to the top of the window (along with the caption from the main window).<br><br>The /DROPSHADOW option adds a black dropshadow to the text in the background.<br><br>If I'm lucky, this might be added to an NSIS release, doubtful though :(.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br><span class="post-time small text-muted">16th August 2006 23:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I didn't want to create a new thread, and since it is related to showing windows, I will ask it here.<br><br>When the background window is displayed, it is shown behind the main installer window. I am trying to do the same on one of my new plugins, but the window is in front of the installer (in other words, the window is shown, and any message boxes that pop up are mostly hidden by the window I have created). Is there a simple fix for this (like SetWindowPos)?<br><br>I have attached an example.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">19th August 2006 12:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can use SetWindowPos to set your window to show below the installer window. Call SetWindowPos on the your window's handle and pass the installer's window handle in hWndInsertAfter.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br><span class="post-time small text-muted">20th August 2006 23:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yeah, I figured that out on the weekend, but it does not work :(. I thought it would.<br><br>My next step is to use the code from the BgImage plugin to create the window (because the window for that is behind the main installer window).<br><br>Update on the BgGradient patch: I have put in the script parsing code for it, but found out it is not so easy to add a command to NSIS (2.15). I am having trouble writing and reading the correct value to and from the exehead. If someone could give me a crash course on adding info to the exehead and reading it from the exehead at runtime, that would be awesome.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">25th August 2006 12:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Simplest way is changing the header structure (Source\exehead\fileform.h and Source\fileform.cpp). Then, you'll have your information in g_header in the exehead code.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br><span class="post-time small text-muted">27th August 2006 23:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for that. I will look at it.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br><span class="post-time small text-muted">20th September 2006 23:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It's probably because I have no idea whats wrong with my code. Source\fileform.cpp has the right fields in it to add to the bg part (bg_color1-2), but source\exehead\fileform.h dosen't have the same structure and I don't know how to set it. I have managed to get it so that it makes an error everytime the bggradient command is used, which means that the data is not being read/written (correctly).<br><br>I will be away for the next two and a half weeks so you probably won't get me until the 9th of October.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">22nd September 2006 10:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">fileform.h is not automatically generated. You must add those fields on your own in the same place you've put them in fileform.cpp.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>