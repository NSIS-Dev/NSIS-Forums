<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Locate and return names multiple similar files" />

  <title>Locate and return names multiple similar files - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Locate and return names multiple similar files</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=263950">Locate and return names multiple similar files</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">carlosfocker</span><br />
      <span class="post-time small text-muted">18th January 2007 20:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Locate and return names multiple similar files</strong><br />
      &nbsp; MY goal is to be able to look in the Microsoft SQL data folder for databases file that my installer detached and tagged (file tage=&lt;Dbname&gt;_DateTimeStamp.mdf) when the software was uninstalled and display them to the user when they are reinstalling so they can select if they want to use them or not.<br />
      <br />
      So far I am able to do this for one file but I need to display all DB files in the SQL data directory. I'm have problems figuring out how to do this with the locate function. It only returns the last found file. Is there a way to loop the locate function and return the file name for each file it finds until there are no more file by the name its searching? I have been searching like this:<br />
      <br />
      ${Locate} "c:\test" "/L=F /M=dbname2311*.mdf" "FileParse"<br />
      <br />
      Also, Is there a string function that allows you to insert characters at a specific point in a string. Like this.<br />
      <br />
      String = "11122006"<br />
      <br />
      insert "/" after 2 charactor<br />
      <br />
      Now I Have 11/122006</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">18th January 2007 20:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        Is there a way to loop the locate function and return the file name for each file it finds until there are no more file by the name its searching?
      </blockquote>I believe this is similar with the given example on the following forum thread.<br />
      All you need to do is to change the empty folders to files.<br />
      <br />
      <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=263445" target="_blank">http://forums.winamp.com/showthread....hreadid=263445</a>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">18th January 2007 20:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        Also, Is there a string function that allows you to insert characters at a specific point in a string. Like this.<br />
        <br />
        String = "11122006"<br />
        <br />
        insert "/" after 2 charactor<br />
        <br />
        Now I Have 11/122006
      </blockquote>
      <pre>
<code>StrCpy$0 "11122006" # $0 is 11122006
<br />&gt;StrCpy $1 $0 2       # $1 is 11
<br />&gt;StrCpy $1 "$1/"      # $1 is 11/
<br />&gt;StrCpy $1 $0 "" 2    # $1 is 11/122006 
</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">carlosfocker</span><br />
      <span class="post-time small text-muted">19th January 2007 15:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Comm@nder21</i><br />
        <pre>
<b><code>StrCpy$0 "11122006" # $0 is 11122006
<br />&gt;StrCpy $1 $0 2       # $1 is 11
<br />&gt;StrCpy $1 "$1/"      # $1 is 11/
<br />&gt;StrCpy $1 $0 "" 2    # $1 is 11/122006 
</code></b>
</pre>
      </blockquote>That didnt work it returns 122006<br />
      <br />
      This works tho:<br />
      <pre>
<code>      StrCpy$0 "11122006" # $0 is 11122006
<br />&gt;StrCpy $1 $0 2       # $1 is 11 
<br />&gt;StrCpy $3 $0 "" 2    # $3 is 122006
<br />&gt;StrCpy $1 "$1/"      # $1 is 11/
<br />&gt;StrCpy $4 "$1$3"     # $4 is 11/122006 
</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">carlosfocker</span><br />
      <span class="post-time small text-muted">19th January 2007 18:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Heres what I ended up doing for anyone who is interested. Forgive me for the poor commenting I have a deliverable to meet.;)I will update at later time if anyone cares.<br />
      <br />
      This takes a directory path specified in $SQLDATA searches through it for the file value you specified (expamle: watchdb2311*.mdf) and as long as the file is in this format (&lt;name&gt;_MMDDYYYYmmss) it will extract the data and time in the file and return it as MM/DD/YYYY mm:ss to the field number for a DropList you specify in a custom page.<br />
      <br /></p>
      <pre>
Function FileParse
<br /><br />         Push"_" #divider char
<br />        Push $R7 #input string
<br />         Call SplitFirstStrPart
<br />         Pop $Split0 #1st part(Garbage)
<br />        Pop $R4 #rest
<br /><br />        Push "." #divider char
<br />        Push $R4 #input string
<br />         Call SplitFirstStrPart
<br />         Pop $R5 #1st part
<br />        Pop $Split3 #rest (Garbage)
<br /><br />        StrCpy $0 "$R5"      # $0 is 11122006
<br />        StrCpy $1 $0 2       # $1 is 11
<br />        StrCpy $2 $0 "" 2    # $3 is 122006
<br />        StrCpy $1 "$1/"      # $1 is 11/
<br />        StrCpy $3 "$1$2"     # $4 is 11/122006
<br /><br />        StrCpy $4 "$3" 5     
<br />         StrCpy$5 $3 "" 5
<br />         StrCpy$4 "$4/"
<br />        StrCpy $6 "$4$5"
<br /><br />        StrCpy $7 "$6" 10     
<br />         StrCpy$8 $6 "" 10
<br />         StrCpy$7 "$7 "
<br />        StrCpy $9 "$7$8"
<br /><br />        StrCpy "$1" "$9" 13     
<br />         StrCpy"$2" $9 "" 13
<br />         StrCpy "$1" "$1:"
<br />        StrCpy "$3" "$1$2"
<br />         
<br />        StrCpy $DBDATESTATE $3
<br />         StrCpy $DBDATE "$3|$DBDATE"
<br />         
<br />         Push $R0
<br />FunctionEnd
<br /><br />&gt;Function GetDBFiles
<br /><br />    Pop $FieldNumber
<br />    Pop $FileName 
<br /><br />    StrCpy $R2 0
<br />    StrCpy $R3 0
<br />    loop:
<br />    StrCpy $R1 0
<br />   ${Locate} "$SQLDATA" "/L=F /M=$FileName" "FileParse"
<br />   IntOp $R3 $R3 + 1
<br />    IntOp $R2 $R2+ $R1
<br />    StrCmp $R1 0 0 loop
<br /><br />    WriteINIStr "$PLUGINSDIR\DBCreate.ini" "Field $FieldNumber" "State" "$DBDATESTATE"
<br />   WriteINIStr "$PLUGINSDIR\DBCreate.ini" "Field $FieldNumber" "ListItems" "$DBDATE"
<br />&gt;FunctionEnd
<br /><br />&gt;Function .onInit
<br /><br />         Push "dbnameA2311*.mdf"
<br />        Push "3"
<br />         call GetDBFiles
<br /><br />         StrCpy $DBDATESTATE ""
<br />        StrCpy $DBDATE ""
<br />        Push "dbnameB2311*.mdf"
<br />        Push "5"
<br />         call GetDBFiles
<br /><br />FunctionEnd 
<br />&gt;

</pre>;);) ;)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">19th January 2007 19:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">sry, there was a small typo in my script, this one is correct:<br />
      <br /></p>
      <pre>
<code>
StrCpy $0 "11122006" # $0 is 11122006
<br />&gt;StrCpy $1 "$0" 2     # $1 is 11
<br />&gt;StrCpy $1 "$1/"      # $1 is 11/
<br />&gt;StrCpy $0 "$0" "" 2  # $0 is 122006
<br />&gt;StrCpy $1 "$1$0"     # $1 is 11/122006 
</code>
</pre>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>