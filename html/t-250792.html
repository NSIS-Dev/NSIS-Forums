<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="uninstall.exe and an external way of patching"><title>uninstall.exe and an external way of patching - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">uninstall.exe and an external way of patching</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=250792">uninstall.exe and an external way of patching</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">coco_vc</span><br><span class="post-time small text-muted">10th July 2006 15:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>uninstall.exe and an external way of patching</strong><br>Hi all,<br><br>I use NSIS to install/uninstall my application.<br><br>My application has itself a feature of updating all the application files, so my_app is able to download updated files and replace the ones installed with the ones downloaded. So this works like this:<br>- I build vers 1<br>- release it to the market<br>- then later I build vers 2<br>- create somehow a diff between these 2 versions<br>- release vers 2 on the market for new users<br>- release the diff between 1 and 2 so that my_app updates the version already installed on the users machines<br><br>Is there a way of updating the uninstall.exe also? I mean, this is generated on the fly when installing the sw on the target machine, but what I need is to somehow get the same uninstall.exe when building the software, so that:<br>- either do a diff with the previous one and then my_app can cary the diff<br>- or at least my_app will overwrite the old unistall.exe with the new uinstall.exe<br><br>So, can I do smth like this? Can I generate an uninstall.exe on build-time that would be identical with uninstall.exe generated by the installer with WriteUninstaller on runtime?<br><br>Thx,<br>Viv</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">10th July 2006 15:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">With SpamExperts I wrote a separate NSIS installer to generate the uninstall.exe. This NSIS installer just needs a dummy Section containing the WriteUninstaller line which then calls Quit and a Section Uninstall containing the uninstall code. In the main installer script, it is compiled with !system "makensis ..." and then executed with !execute to create the uninstall executable.<br><br>For having different versions, it's best to just have a version string in a file on your server. It could either contain a build number, or probably better would be a date and time.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">coco_vc</span><br><span class="post-time small text-muted">10th July 2006 16:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I hoped there is a simpler way, like a build cmd line parameter that would right away generate the uninstall too. Probably there is no such way.<br><br>What you did is what I also was thinking: running the script on the buildserver and get the uninstaller, but the way you describe is at least nicer b/c you don't really do anything while installing, just generate the uninstaller.<br><br>I'm not sure I understand the: "In the main installer script, it is compiled with !system "makensis ..." and then executed with !execute to create the uninstall executable."<br>Why not just running the second dummy installer to generate the uninstaller?<br><br>Viv</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">10th July 2006 22:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You should re-compile the installer that generates the uninstaller first, because you may make changes to the uninstall code. If you don't you may miss these changes from your update.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">coco_vc</span><br><span class="post-time small text-muted">11th July 2006 15:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Stu,<br><br>Thx for your answer, but I still fail to understand :(<br>Basicall what we want is to get the uninstall.exe, while building, so that we have the same binary that the user will have after installing.<br>The steps you describe, as far as I understood, are:<br>1) on build-time create somehow a dummy.nsi that contains:<br>- a section where is WriteUninstaller line and then Quit<br>- and a Section Uninstall containing the uninstall code, which somehow (how???) gets copied from your real installer<br>2) run the dummy.exe generate after building the above created dummy.nsi, so that you'll get the uninstall.exe which is the same binary the user will have.<br><br>Questions:<br>a) how can you generate the uninstall code on build-time? I mean how do you know automatically what to copy from your real installer into the dummy.nsi as besides Section Uninstall, there might be more functions and hidden section needed?<br>b) where and how do you use the !system and !execute calls?<br><br>Thx a lot,<br>Viv</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">11th July 2006 16:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">a) You write the uninstall code in dummy.nsi yourself. It doesn't have to be in the same .nsi script - after all as far as makensis can tell you're just building another installer completely dependent of your main one.<br><br>b) See the documentation for !system and !execute. They are compile-time instructions and should be used before you include the uninstall executable in your main installer with the File instruction (you won't be using WriteUninstaller anymore for the main installer). !system executes commands like typing it in command-prompt, whereas !execute just allows a path to a program. You could use !system for both... it doesn't matter.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">coco_vc</span><br><span class="post-time small text-muted">12th July 2006 11:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ahaa, now I finally understood. Thx for the idea Stu. I'll give it a try.<br><br>Thx,<br>Viv</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">coco_vc</span><br><span class="post-time small text-muted">4th August 2006 17:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Stu,<br><br>I did as you suggested here, but I have a question. In my uninstaller-generator.nsi I have the following code:<br></p><pre>
<code><br>!include ...<br>!define ...<br>Name "${PRODUCT_NAME}"<br>InstallDir "$PROGRAMFILES\${PRODUCT_COMPANY_LS}"<br>InstallDirRegKey HKLM "Software\${PRODUCT_COMPANY_NAME}" "${PATH_TO_MAIN_APP_REG_KEY}"<br>; Uninstaller pages<br>!insertmacro MUI_LANGUAGE "English"<br>ReserveFile "${NSISDIR}\Plugins\AdvSplash.dll"<br>!insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br><br>Section -Post<br>  WriteUninstaller "${MY_UNINSTALLER_NAME}"<br>  Quit ; to avoid any human interaction<br>SectionEnd<br><br>Function un.onInit<br>....<br></code>
</pre><br>
      <br>
      and in my main installer I have smth like:<br>
      <pre>
<code><br>  !system 'makensis /V4 /Ouninstaller.log uninstaller-generator.nsi' ; builds the uninstaller-generator.nsi to get the ${MY_UNINST_GENERATOR}<br>  !system '${MY_UNINST_GENERATOR}' ; generates the ${MY_UNINSTALLER_NAME} for being later added to the package<br></code>
</pre><br>
      <br>
      Problem is that on build-time (when building the installer.nsi), when ${MY_UNINST_GENERATOR} is run to generate the uninst.exe, the uninst.exe is generated in "$PROGRAMFILES\${PRODUCT_COMPANY_LS}" which is annoying, as this is smth that doesn't exist on the buildserver. Is there a way to force the WriteUninstaller to generate the exe in the directory where the .nsi is and from where the original build was started without using command line params?<br>
      <br>
      Thx,<br>
      Viv
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">4th August 2006 17:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">MY_UNINSTALLER_NAME in the uninstall script needs to be<br>
      $EXEDIR\uninst.exe<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">coco_vc</span><br>
      <span class="post-time small text-muted">4th August 2006 17:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, great, works! :)<br>
      <br>
      Thx Stu,<br>
      Viv</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">coco_vc</span><br>
      <span class="post-time small text-muted">7th August 2006 17:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Stu and *,<br>
      <br>
      One last question related to the issue (hope so) ...<br>
      <br>
      As we did above is: just one command to build the installer which actually does 3 things:<br>
      - builds the uninstall-generator.nsi<br>
      - runs the obtained exe to get the uninst.exe<br>
      - builds the final installer (that has in the package the uninst.exe)<br>
      <br>
      In some situations I need to do this in 2 different steps. So I need to:<br>
      - run the installer.nsi with a param showing that I just need the uninstaller to be generated<br>
      - run the installer.nsi with a param showing that I just need the final package<br>
      - sometimes run the installer.nsi with a param showing that I need both of the above<br>
      <br>
      For this I wrote the following code:<br></p>
      <pre>
<code><br>!if ${GENERATE_UNINST_AND_FINAL_PACKAGE} == "0"<br>!else<br>  !system 'makensis /V4 /Ouninstaller.log Uninstaller.nsi<br>  !system '${MY_UNINST_GENERATOR}'<br>  !if ${GENERATE_UNINST_AND_FINAL_PACKAGE} == "1"<br>    !error "NOT a real ERROR: It was desired only the step of running the uninstaller-generator which was done, so stop here!"<br>  !endif<br>!endif<br></code>
</pre><br>
      <br>
      So, this means the following behaviour depending on the value of GENERATE_UNINST_AND_FINAL_PACKAGE:<br>
      - 0 means - don't generate the uninstaller, just create the final package (so skip the 2 !system calls)<br>
      - 1 means - generate the uninstaller only, so don't create also the final package (so run the 2 !system calls only and then right away exit)<br>
      - 2 means - generate both: the uninstaller and the final package (so run the 2 !system calls and the go further)<br>
      - not defined - it's like 2, meaning generate both<br>
      <br>
      <br>
      Everything works fine, but I would like to quit the compile session without an error, as my perl-script that calls the makensis checks the return value and in case this is an error it stops, so in my case it will always stop b/c I quit the compile session with !error. Is there a way to stop the compilation (like I do now with !error), but without the compiler to return an error?<br>
      <br>
      Thx,<br>
      Viv
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">coco_vc</span><br>
      <span class="post-time small text-muted">8th August 2006 11:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I didn't get any answer to my last question. Does that mean that there is no other way to stop compilation besides the !error command? (which actually would be normal, but I anyhow asked as maybe smbd could have gave me an idea on how to do the above).<br>
      <br>
      Thx,<br>
      Viv</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">8th August 2006 12:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">No there isn't.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">coco_vc</span><br>
      <span class="post-time small text-muted">8th August 2006 13:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thx Stu.<br>
      <br>
      btw, my second !system call<br></p>
      <pre>
<code><br>!system '${MY_UNINST_GENERATOR}'<br></code>
</pre><br>
      returns 2.<br>
      <br>
      This is b/c in the uninstaller-generator.nsi I have:<br>
      <pre>
<code><br>Section -Post<br>  WriteUninstaller "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>  Quit ; to avoid any human interaction<br>SectionEnd<br></code>
</pre><br>
      <br>
      and seems that Quit makes the return code to be 2. I need Quit, as I don't want any dialog to be shown (Abort doesn't do the job), but I would also like to get the return value 0 if everything ok. I know I could do:<br>
      <pre>
<code><br>Section -Post<br>  WriteUninstaller "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>  SetErrorLevel 0<br>  Quit ; to avoid any human interaction<br>SectionEnd<br></code>
</pre><br>
      but then I will never notice when WriteUninstaller returned failure.<br>
      So, how could I do that? How could I use Quit, but still get the "correct" return value?<br>
      <br>
      Thx,<br>
      Viv
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">8th August 2006 13:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I don't think you can.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">coco_vc</span><br>
      <span class="post-time small text-muted">8th August 2006 16:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Can I then maybe replace the Quit command with smth else that supresses the dialog?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">8th August 2006 16:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">How about making the installer run silently with SilentInstall silent.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">coco_vc</span><br>
      <span class="post-time small text-muted">9th August 2006 14:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Great idea Stu! Thx!<br>
      <br>
      I changed the uninstaller-generator.nsi so that it looks like:<br></p>
      <pre>
<code><br>SilentInstall silent<br><br>Section -Post<br>  WriteUninstaller "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>SectionEnd<br><br>Function un.onInit<br>...<br></code>
</pre><br>
      <br>
      so that now the return value is 0 and also I don't need human interaction. Nice. Exactly what I needed.<br>
      <br>
      But, what is weird is that I have tried to make the WriteUninstaller call to fail, so that the return value would be different than 0, but I wasn't able to. I even tried:<br>
      <pre>
<code><br>WriteUninstaller "K:\${MY_UNINSTALLER_NAME}"<br></code>
</pre><br>
      <br>
      without having a K: on my hdd, but the return value is always 0, even though the uninst.exe wasn't obviously created.<br>
      Any clue why it didn't return failure?<br>
      And any clue how could I simulate a situation in which this installer would return failure?<br>
      <br>
      Thx,<br>
      Viv
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">9th August 2006 14:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Check if the uninstaller was created with IfFileExists and set the required error level with SetErrorLevel. If that does not work, then I guess silent installers always return 0 or something.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">coco_vc</span><br>
      <span class="post-time small text-muted">9th August 2006 15:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Actually even without silent the WriteUninstaller "K:\${MY_UNINSTALLER_NAME}" doesn't return error which I assume it's wrong, but for this problem I'll start another thread.<br>
      <br>
      I changed the code as you suggested:<br></p>
      <pre>
<code><br>Section -Post<br>  WriteUninstaller "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>  IfFileExists "$EXEDIR\${MY_UNINSTALLER_NAME}" done.Post 0<br>    SetErrorLevel 5<br>done.Post:<br>SectionEnd<br></code>
</pre><br>
      and this works fine, but this one doesn't detect all failure cases for instance: there was already an uninst.exe which was read-only so the WriteUninstaller couldn't have overwritten the file so it basically failed. Would have been nice the WriteUninstaller to actually return an error when failing for whatever reason.<br>
      <br>
      Thx,<br>
      Viv
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">9th August 2006 15:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You could delete the existing installer first with Delete which would set the error flag:<br>
      <br></p>
      <pre>
<code>Section -Post<br>  ClearErrors<br>  Delete "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>  WriteUninstaller "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>  IfErrors +2<br>  IfFileExists "$EXEDIR\${MY_UNINSTALLER_NAME}" +2<br>    SetErrorLevel 5<br>SectionEnd</code>
</pre><br>
      <br>
      -Stu
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">coco_vc</span><br>
      <span class="post-time small text-muted">9th August 2006 15:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thx Stu! Actually I wrote the code like:<br>
      <br></p>
      <pre>
<code><br>Section -Post<br>  ClearErrors<br>  Delete "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>  WriteUninstaller "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>  IfFileExists "$EXEDIR\${MY_UNINSTALLER_NAME}" done.Post 0<br>    SetErrorLevel 5<br>done.Post:<br>SectionEnd<br></code>
</pre><br>
      <br>
      as I assumed that if Delete fails, automatically the return value of the running exe will be different than 0. I hope this is ok, is it?<br>
      <br>
      The surprise was, that actually Delete is able to delete the file even if the file is read-only. I wasn't able to make the Delete fail on my file (I tried read-only and file in use, but in booth cases Delete succedes).<br>
      <br>
      Thx,<br>
      Viv
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">9th August 2006 16:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, but if Delete fails, then an old uninstall executable will exist which will be included in your installer. Surely you don't want that to happen?<br>
      The IfErrors will prevent that.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">coco_vc</span><br>
      <span class="post-time small text-muted">10th August 2006 13:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Stu,<br>
      <br>
      I don't really understand the diff between your code and my code. I'll try to explain, just from theoretical pov, as practically I wasn't able to make the Delete to fail.<br>
      <br>
      Your code:<br></p>
      <pre>
<code><br>Section -Post<br>  ClearErrors<br>  Delete "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>  WriteUninstaller "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>  IfErrors +2<br>  IfFileExists "$EXEDIR\${MY_UNINSTALLER_NAME}" +2<br>    SetErrorLevel 5<br>SectionEnd<br></code>
</pre><br>
      which means: if delete fails, the IfErrors is true so the command "SetErrorLevel 5" will be executed, so the installer will return an error, in this case error number 5.<br>
      <br>
      My code:<br>
      <pre>
<code><br>Section -Post<br>  ClearErrors<br>  Delete "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>  WriteUninstaller "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>  IfFileExists "$EXEDIR\${MY_UNINSTALLER_NAME}" done.Post 0<br>    SetErrorLevel 5<br>done.Post:<br>SectionEnd<br></code>
</pre><br>
      which means: if delete fails, automatically the error flag will be set (by the Delete call), so automatically the installer will return an error code, so smth different than 0 (let's say 3, or whatever error number is set when Delete fails)<br>
      <br>
      So, what is the diff between the 2 chunks of code, besides the fact that the returned error code might be different, like in one case is 5 and in another is let's say 3? The behaviour of the 2 parts of code is the same right?<br>
      <br>
      Thx,<br>
      Viv
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">10th August 2006 14:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I see, in which case it needs to be like this:<br></p>
      <pre>
<code><br>Section -Post<br>  ClearErrors<br>  Delete "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>  WriteUninstaller "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>  IfErrors +3<br>  IfFileExists "$EXEDIR\${MY_UNINSTALLER_NAME}" +2<br>    SetErrorLevel 5both <br>SectionEnd<br></code>
</pre><br>
      If the file is locked, then Delete will fail and we want to return the error code for it (say 3). If Delete was successful, but WriteUninstaller was not, then we want the error code to be 5.<br>
      Without the IfErrors in there, if the old uninstaller isn't deleted then you will get an apparently successful uninstall generation with no error code.<br>
      <br>
      -Stu
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">coco_vc</span><br>
      <span class="post-time small text-muted">10th August 2006 14:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Maybe I am missing some important information, b/c I still don't see the point of having the:<br></p>
      <pre>
<code><br>IfErrors +3<br></code>
</pre><br>
      in your above code.<br>
      <br>
      I mean, if in the code above the error was set by the failed Delete call, it will _not_ be reseted regardless if we have the IfErrors line or not.<br>
      I mean, if the IfErrors from above code is missing: Delete fails, so the internal error code is let's say 3. Then we do the IfFileExists which b/c the file exists (as Delete failed) will jump to the SectionEnd, but the internal error set by the failed Delete is still 3, so the uninstall generation will return 3 right?<br>
      <br>
      Thx,<br>
      Viv
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">10th August 2006 14:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ah yes I see :)<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">coco_vc</span><br>
      <span class="post-time small text-muted">10th August 2006 15:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok :) So, this is clear now ... Still, any clue how can I make Delete to fail? I tried to make the file read-only, to open it for being in use, but actually the Delete always succedes. How come?<br>
      <br>
      Viv</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">10th August 2006 15:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Because the uninstaller copies itself to the temp folder and runs itself again from there so that the original executable can be deleted.<br>
      <br>
      You need to pass it the _?=C:\tempfolder parameters to stop it being copied.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">coco_vc</span><br>
      <span class="post-time small text-muted">11th August 2006 10:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Stu,<br>
      <br>
      I wasn't talking about that. I was talking about the following scenario:<br>
      <br>
      - having an uninstaller-generator.nsi file that contains in the installer section only:<br></p>
      <pre>
<code><br>Section -Post<br>  ClearErrors<br>  Delete "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>  WriteUninstaller "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>  IfFileExists "$EXEDIR\${MY_UNINSTALLER_NAME}" done.Post 0<br>    SetErrorLevel 5<br>done.Post:<br>SectionEnd<br></code>
</pre><br>
      <br>
      - by building the above nsi I get the exe called, let's say run_me_to_generate_uninst.exe<br>
      <br>
      - by running this exe, the only thing that should happen is that in the same directory the ${MY_UNINSTALLER_NAME} should be generated<br>
      <br>
      Now, the problem is that if the ${MY_UNINSTALLER_NAME} already exists in the exe dir and it's read-only, or it's in use, sttill when running the run_me_to_generate_uninst.exe the code:<br>
      <pre>
<code><br>  Delete "$EXEDIR\${MY_UNINSTALLER_NAME}"<br></code>
</pre><br>
      succedes, even though the "$EXEDIR\${MY_UNINSTALLER_NAME}" is in use or read-only.<br>
      And I'm not sure how can this succede?<br>
      <br>
      Thx,<br>
      Viv
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">11th August 2006 10:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I very much doubt the read only flag will stop it being deleted. If the uninstaller is in use, then what I've said applies.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">coco_vc</span><br>
      <span class="post-time small text-muted">16th August 2006 15:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Stu,<br>
      <br>
      Yes, you are right, so I started the uninst.exe with _?= param.<br>
      <br>
      What I have noticed is that the following code works just fine:<br></p>
      <pre>
<code><br>Section -Post<br>  ClearErrors<br>  Delete "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>  IfErrors done_err.Post<br>  WriteUninstaller "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>  IfFileExists "$EXEDIR\${MY_UNINSTALLER_NAME}" done.Post 0<br>done_err.Post:<br>    SetErrorLevel 5<br>done.Post:<br>SectionEnd<br></code>
</pre><br>
      meaning it returns 5 when the file is in use so Delete fails.<br>
      <br>
      But I would have expected also a return error code for the following code:<br>
      <pre>
<code><br>Section -Post<br>  ClearErrors<br>  Delete "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>  WriteUninstaller "$EXEDIR\${MY_UNINSTALLER_NAME}"<br>  IfFileExists "$EXEDIR\${MY_UNINSTALLER_NAME}" done.Post 0<br>done_err.Post:<br>    SetErrorLevel 5<br>done.Post:<br>SectionEnd<br></code>
</pre><br>
      as I would expect that b/c Delete fails, the running of this exe would return an error code, but actually it returns 0. Why is that?<br>
      <br>
      Thx,<br>
      Viv
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">16th August 2006 17:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I don't think now that the error flag has anything to do with the error levels.<br>
      <br>
      These are the error levels in the documentation:<br>
      0 - Normal execution (no error)<br>
      1 - Installation aborted by user (cancel button)<br>
      2 - Installation aborted by script<br>
      <br>
      You need to set the error level yourself then like in your first example.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">coco_vc</span><br>
      <span class="post-time small text-muted">17th August 2006 11:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        I don't think now that the error flag has anything to do with the error levels.
      </blockquote>Yes, this seems to be the case. I wasn't aware of that. I somehow was sure that it will return a value diff than 0 if one instruction fails.<br>
      <br>
      Thx Stu,<br>
      Viv
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script type="text/javascript" src="../js/highlight.pack.js" async>
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>