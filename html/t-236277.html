<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="ExecCmd plug-in" />

  <title>ExecCmd plug-in - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">ExecCmd plug-in</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=236277">ExecCmd plug-in</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">24th January 2006 11:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>ExecCmd plug-in</strong><br />
      Long ago Joost Verburg wrote about WM_CHAR possibility for console windows, this appeared again few days ago <a href="http://forums.winamp.com/showthread.php?s=&amp;postid=1846930#post1846930" target="_blank">http://forums.winamp.com/showthread....30#post1846930</a> , so I updated ExecDos and suddenly found mysqladmin and gnupg problems solved :) New ExecCmd attached to this post. 'Test' dll version allows to see console window.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">25th January 2006 07:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Good news: <a href="http://nsis.sourceforge.net/ExecCmd_plug-in" target="_blank">wiki page</a>; 'ComSpec /C' now appeares at the beginning of the command line (so you don't need to use it in script), but do not forget quotes; /TIMEOUT bug fixed; new /TEST key - displays console window (for debugging); tested on XP - 2003.<br />
      Bad news - Win98 problem, console window appeares with toolbar, so I need to find another way to launch application on old systems or to write enhanced code for child console search.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">cmenzi</span><br />
      <span class="post-time small text-muted">10th September 2007 08:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>ExecCmd close immediately</strong><br />
      I have the following procedure to execute in background with execcmd.<br />
      <br />
      ExecCmd::exec /SYNC '"$TEMP\nativeImage\ngen.exe" install "$INSTDIR\xxx.exe"'<br />
      <br />
      When I use the same cmd-line with ExecWait it works perfectly, but the cmd-window appears. How can I use ExecCmd to generate native images in background, withour cmd-window?<br />
      <br />
      When I use /TEST the window appears but only for a 10th of second. When I add "&gt; log.log" to the cmd-line, the is created but it is empty.<br />
      <br />
      Any suggestion?<br />
      <br />
      thx</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">10th September 2007 08:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Might be better to use ExecDos in your situation. And no SYNC option, /ASYNC only, but this require ExecDos::wait after this. For simple situations (short calls) just remove this option at all.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">cmenzi</span><br />
      <span class="post-time small text-muted">10th September 2007 08:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks a lot.<br />
      <br />
      Now it works as I want.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">starrider78</span><br />
      <span class="post-time small text-muted">13th September 2007 19:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Is there any way to echo the command line program's standard output to the installer log?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">14th September 2007 06:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://nsis.sourceforge.net/ExecDos_plug-in" target="_blank">http://nsis.sourceforge.net/ExecDos_plug-in</a> offers a lot of output targets.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mazdakam</span><br />
      <span class="post-time small text-muted">16th November 2007 15:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">how can i run this command in cmd.exe:<br />
      <br />
      sfc /purgecache</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">16th November 2007 15:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ExecDos::exec `sfc /purgecache`<br />
      Pop $R0 # exit code<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">26th March 2008 20:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hmm I have found that ExecDos doesn't push blank lines to the stack with /TOSTACK. Also if the program outputs an empty string (or in effect, no text) then you also don't get anything on the stack.<br />
      <br />
      This is usually ok but when you need to check this value this is a problem.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">27th March 2008 12:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, Stu, this is 'by design'.</p>
      <pre>
<code>/* supress empty lines */<br />if(iStack &gt; 0)<br />...</code>
</pre>I can agree that empty lines should be pushed to stack as well, but I have not ideas what to push if no output at all (what means 'empty string'?). If no output from application, exit code can help, not 'empty string'.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">27th March 2008 15:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">In other words, if the program is a command line application and outputs nothing, maybe we should push an empty string.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">27th March 2008 16:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This case there is no difference with the only "\n" output. Just keep stack empty and check Pop error.<br />
      <i>Pops a string off of the stack into user variable $x. If the stack is empty, the error flag will be set.</i></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JoeSam</span><br />
      <span class="post-time small text-muted">19th March 2009 13:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Erm i have a noob qn (just learnt NSIS yesterday), ExecCmd doesn't seem to work for paths with spaces in them.<br />
      <br />
      E.g. $PROGRAMFILES\program can't work because of "Program Files" but "C:\program" can.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">19th March 2009 13:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">'"path2exe" params' should work</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">19th March 2009 13:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">make sure you encase paths with spaces in quotes?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ocstjf</span><br />
      <span class="post-time small text-muted">5th June 2009 22:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">In my Function un.onInit I've got:<br />
      <br />
      InitPluginsDir<br />
      ExecCmd::exec '"$INSTDIR\bin\RtiDeleteUserData.bat"' ""<br />
      <br />
      I'm using ExecCmd instead of just ExecShell because I need it to wait, and I'm using ExecCmd instead of ExecWait because I don't want to see a console window. It worked great for INSTDIR=C:\Program Files\RTI but not for INSTDIR=C:\Program Files (x86)\RTI. If I use /TEST, the console screen flashes too fast to see what's wrong. It's ever getting to run my .bat file, I know that, because that has a PAUSE in it. I know I have the source, and I could build a debug version etc etc, but: anyone have any quicker suggestions? Thanks!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br />
      <span class="post-time small text-muted">5th June 2009 22:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If it's only used temporary to delete some data, why don't you place the batch file in another 'simple' location, like c:\temp, run it from there and delete the batch file afterwards.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ocstjf</span><br />
      <span class="post-time small text-muted">5th June 2009 22:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Wow, thanks for the quick reply! It's a fairly complex bat file installed with the product. As I understand it, to copy a file w/i NSIS I have to ReadFile/WriteFile. I figured if I'm going to go to that trouble I might as well re-implement the bat file logic within NSIS. Or am I missing something?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br />
      <span class="post-time small text-muted">6th June 2009 09:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm not sure what you mean with "As I understand it, to copy a file w/i NSIS I have to ReadFile/WriteFile".<br />
      <br />
      You can add a batch file to your installer like any file, extract it to a temp folder and run it from there.</p>
      <pre>
<code>File /oname=$TEMP\RtiDeleteUserData.bat RtiDeleteUserData.bat<br />SetOutPath $TEMP<br />ExecWait '"$TEMP\RtiDeleteUserData.bat"'<br />SetOutPath $INSTDIR</code>
</pre>But if you want to have everything in your script, it will be at least more readable if you do it with NSIS commands instead of creating the batch file at runtime.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br />
      <span class="post-time small text-muted">6th June 2009 09:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ah, of course, you're using it in an uninstaller.<br />
      Sorry.<br />
      <br />
      But you can use CopyFiles to copy the batch file:</p>
      <pre>
<code>CopyFiles $INSTDIR\bin\RtiDeleteUserData.bat $TEMP\RtiDeleteUserData.bat<br />SetOutPath $TEMP<br />ExecWait '"$TEMP\RtiDeleteUserData.bat"'<br />SetOutPath $INSTDIR</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ocstjf</span><br />
      <span class="post-time small text-muted">6th June 2009 18:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by jpderuiter</i><br />
        <b>...But you can use CopyFiles to copy the batch file</b>
      </blockquote>Doh! Not sure how I missed that. That might solve some other issues for me, too. Thanks!
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Blatantuk</span><br />
      <span class="post-time small text-muted">5th November 2009 14:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>EcecCmd - mysqladmin with pipe - doesnt work</strong><br />
      Hi all,<br />
      <br />
      I am hoping someone can give some advise on the problem I'm having with the installer I'm writing. I have decided I need to use ExecDos or ExecCmd as I need to perform a console operation without showing a Cmd window.<br />
      <br />
      the command I am actually trying to perfom is this:<br />
      <br /></p>
      <pre>
<code><br />[PATH]\mysqladmin.exe --defaults-file=[PATH]\my-small****f --user=root --password=root variables | find "basedir" | find "[EXPECTEDBASEDIR]"<br /></code>
</pre><br />
      <br />
      The purpose is to launch mysqladmin and find the basedir from the variables output, and thus checking that it is the expected basedir. IE it is OUR mysql server that is running.<br />
      <br />
      So the expected NSIS code is:<br />
      <br />
      <pre>
<code><br />;Assuming ${MYSQL} contains the relative path to the mysql directory<br /><br />ExecCmd::exec '${MYSQL}\bin\mysqladmin.exe --defaults-file=${MYSQL}\bin\my-small****f --user=root --pass=root variables | find  "basedir" | find "[EXPECTEDBASEDIR]"'<br /></code>
</pre><br />
      <br />
      This works fine when the mysqlserver is up (returns 0 to stack if ffound, 1 otherwise. And also returns 1 as expected if the mysqlserver is not running.<br />
      <br />
      However if the ****f file is configured to listen to a port number that is already in a listening state (for example 80 or any port Apache is running on), mysqladmin hangs for a long period of time.<br />
      <br />
      No problem, thats why we have the /TIMEOUT switch! so the new code is this:<br />
      <pre>
<code><br />;Assuming ${MYSQL} contains the relative path to the mysql directory<br /><br />ExecCmd::exec /TIMEPOUT=10000 '${MYSQL}\bin\mysqladmin.exe --defaults-file=${MYSQL}\bin\my-small****f --user=root --pass=root variables | find  "basedir" | find "[EXPECTEDBASEDIR]"'<br /></code>
</pre><br />
      <br />
      And sure enought the timeout works and pops a nice -8 return value. however there is a problem. After performing the above command and returning from the exec call, the processes (mysqladmin.exe, and 2 instances of find.exe) continue to run and not cease like expected with ExecCmd...<br />
      <br />
      With testing, if I run the cmd with just mysqladmin (removing the 2 calls to find and the 2 pipes) then ExecCmd kills mysqladmin.exe correctly, but not when the output is piped to another app (in this case find)<br />
      <br />
      can anyone help solve this issue?<br />
      <br />
      I cant just leave mysqladmin to timeout and die on its own as the situation can arise where the installer completes but there are still child processes running, which may need to be re-used, and which is against our coding guidelines and is very poor practice.<br />
      <br />
      I do hope someone can help!<br />
      <br />
      Many thanks in advance,<br />
      <br />
      Danny
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Blatantuk</span><br />
      <span class="post-time small text-muted">5th November 2009 14:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">seems the forum has changed my configuration file extension ([dot]cnf) to ****f, sorry about that!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ChocJunkie</span><br />
      <span class="post-time small text-muted">14th December 2009 15:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>ExecCmd::Exec changes stack</strong><br />
      While struggeling with the probelm described in thread <a href="http://forums.winamp.com/showthread.php?threadid=315341" target="_blank">"Execute diskpart"</a>, I came to notice, nsExec::exec changes my stack if it failes (return code 1).<br />
      Before I'm calling the function, I push a string onto the stack. After calling the function and popping its return code, the value I'm popping from stack has been changed to 0.<br />
      <br />
      I've tried around and figured out, the ExecCmd::exec seems to mix up the stack:<br />
      <br />
      Let's assume, before calling the function, my stack looks like:<br />
      A<br />
      B<br />
      C<br />
      <br />
      - Now, I'm calling the ExecCmd::exec and getting as return: 1.<br />
      - My next pop brings me "B" and the next pop "C".<br />
      <br />
      It seems to me, that ExecCmd::exec absorbs my "A".<br />
      <br />
      <br />
      So far my problem description. I hope someone can understand my gibberish.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ChocJunkie</span><br />
      <span class="post-time small text-muted">14th December 2009 15:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, I've tested at a point where ExexCmd::exec ends successfully. It also absorbs the first value on stack.<br />
      <br />
      Summary: ExecCmd::exec pops the first entry from stack.<br />
      <br />
      It would be great, if someone could fix that.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">14th December 2009 16:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ExecCmd::exec requires at least 2 parameters. Use "" for empty stdin string.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
