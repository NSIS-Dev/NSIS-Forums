<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Changing DirRequest control properties"><title>Changing DirRequest control properties - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Changing DirRequest control properties</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=245878">Changing DirRequest control properties</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">shaunb</span><br><span class="post-time small text-muted">10th May 2006 16:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Changing DirRequest control properties</strong><br>Hi, noob alert.<br><br>I am using NSIS to create an installer for our product, I must say first a big thanks to anyone involved in the development of NSIS, or people who help out here.<br><br>Basically my query is relating to a custom page I have created, which in all essence looks near identical to the MUI_PAGE_DIRECTORY macro, although I have built a custom dialog using the DirRequest control, asking the user 'where a directory is' (not a normal install directory), anyway, its near enough finished but this question is merely about cosmetics really,<br><br>is it possible to change the "..." Caption on the button in the DirRequest control to "B&amp;rowse" or any text you like? I just want it to look near identical to the MUI_PAGE_DIRECTORY page, and this is the only thing stopping me so far.<br><br>Many thanks in advance for anyone who replies.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">shaunb</span><br><span class="post-time small text-muted">10th May 2006 16:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I just read something about this being possible in later versions of installoptions2, does this mean that functionality is included in the NSIS 2.16 release?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">10th May 2006 17:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Not that I am aware of.<br>You can try using InstallOptionsEx.<br><br>If all else fails, you'd need to change it with the System plugin by calling user32::SetWindowText and then resize the button control with user32::SetWindowPos.<br><br>May I ask why you need to create a custom dialog which is almost identical to the NSIS Directory page?<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">shaunb</span><br><span class="post-time small text-muted">10th May 2006 17:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I want to ask the 'user' for the location of their ColdFusionMX install.<br><br>I did have it working using just another MUI_PAGE_DIRECTORY, but i honestly found it easier building my own dialog rather than removing the 'space required/space available' and the title and subtitle, also I found it added the directory in question to the end, probably as I didnt set a seperate variable for it to go out of.<br><br>apologies for my noobiness I've only been on the case since this week. NSIS is very powerful though and a great tool.<br><br>Hmm, seems a little tricky, it doesnt look so bad as "..." but it'd be nice if it matched the dialog following it.<br><br>I'll keep looking around, I take it InstallOptionsEX is a seperate external plugin to InstallOptions2, and doesnt come with NSIS?<br><br>Thanks for your help.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">10th May 2006 17:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If I remember correctly, putting a \ on the end of the install dir path for the Directory pages stops the end dir name being appended to the end every time (or vise versa).<br><br>InstallOptionsEx is on the Wiki.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">10th May 2006 18:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It's your lucky day :p<br><br>I decided to have a 'break' from doing maths revision.<br>This example changes the browse button text to "Browse..." and resizes the button accordingly.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">shaunb</span><br><span class="post-time small text-muted">10th May 2006 19:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'll try it at work tomorrow, very kind of you.<br><br>thanks</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comperio</span><br><span class="post-time small text-muted">11th May 2006 01:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Nice trick, Afrow!<br>Another option is to setup a custom page with a text box and a button. (Make the button say whatever you want.)<br><br>Then, using the <a href="http://nsis.sourceforge.net/Dialog****plug-in" target="_blank">DialogsEX</a> plugin, make a folder browser appear when clicking on the button.<br><br>Sounds complicated, but it's really fairly simple. The page's exit function would look something like this:<br></p><pre>
<code><br>Function MyLeaveFunction<br>        ; This assumes that the text field is Field 5 and the browse button is Field 6<br>        ReadIniStr '$PLUGINSDIR\mypage.ini' $0 'Settings' 'State'<br>        StrCmp $0 6 DirBrowseButton Continue<br><br>    DirBrowseButton:<br>    ; browse button was pressed:<br>    ; make sure you also write the value to the ini file in case you return to the page later during the install<br>    ${ModernFolderBox} "Browse for Key Disk" "Choose a location contianing a keydisk" "C:\" ${Var_1}<br>    !insertmacro XPUI_INSTALLOPTIONS_WRITE "Page_InputcusNumber.ini" "Field 5" "State" "$1"<br>    SendMessage $2 ${WM_SETTEXT} 0 "STR:$1"<br>        abort<br>        <br>        continue:<br>        ;  [ the rest of your code goes here ]<br>FunctionEnd<br></code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">shaunb</span><br>
      <span class="post-time small text-muted">11th May 2006 09:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Seems to work fine! thanks a lot<br>
      <br>
      I noticed the defines at the top of the code arent used so I cut it down a bit, I am just fiddling with the button width size multiplication so I can get it the same width, maybe eventually position, and maybe height as the browse button on the next page.<br>
      <br>
      I just know people will look at it and moan although it looks fine to me, I will try using the example to change the other properties of the control. thanks!</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">11th May 2006 09:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yeh I put those defines in there and forgot to put them into the actual code :p<br>
      <br>
      $R3 stores the height, but I'm sure you worked that out :)<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">11th May 2006 09:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Btw, if you're displaying a NSIS Directory page before your custom page, you could get the dimensions of the browse button from there instead.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">shaunb</span><br>
      <span class="post-time small text-muted">11th May 2006 10:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hmm, maybe its more sense to ask for the product install dir using a normal nsis directory page, then ask for the CF install location after. I can now change the height and size of the button but not its location hehe.<br>
      <br>
      Anyway, I'm starting to try and fill in some logic for checking the users' input CF dir is valid, using the Locate plugin, but I'm not entirely sure how to block on the current page (obviously disable next button) and keep asking for a valid path, with a messagebox to prompt illegal paths.<br>
      <br>
      I seem to have it producing a messagebox but not reverting to the same window, it just carries on to the next NSIS page.<br>
      <br>
      I'll poke around and probably swap the page order as it looks better asking for the product dir before the CF dir.<br>
      <br>
      Obviously the "product install" path doesnt need to exist, as the installer will create it, but the 'where is CF installed' box doesnt need to create directories etc, it just needs to unzip files to the correct locations in the CF dir. I'm just having a few issues blocking on a page, waiting for a 'decent' CF path from the dirrequest, and messagebox'ing the user if its not a decent path.<br>
      <br>
      plus if I could change the button on my custom page like you said, to have the same dimensions as the Dirrequest button on the previous page, it would be great.<br>
      <br>
      obviously I'm not asking anyone to hand me this on a plate, and most of this bumf is probably me clearing it in my own head, but at least you'll maybe understand what I'm getting at, hehe :)<br>
      <br>
      Thanks again<br>
      <br>
      Then I'll think about the dir checking again. ack!</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">11th May 2006 10:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I would consider using two Directory pages again. In normal InstallOptions the NOTIFY flag doesn't work well with DirRequest fields. You won't be able to validate the new path on key up, for example. You'd have to check the path in the pages' Leave function and then call Abort to go back to the page.<br>
      <br>
      The NSIS Directory page already validates the entered directory path for you. It also removes any unwanted characters if you're dealing with the $INSTDIR variable when Pushing it to the stack.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">shaunb</span><br>
      <span class="post-time small text-muted">11th May 2006 10:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ah, hmm. whimper<br>
      <br>
      I did have it checking in the leave function before, I'm not against using another normal directory page again, but I've maybe just wasted a day creating this custom dialog, when I could have been removing parts from the default directory page.<br>
      <br>
      hm, what you've said does point to using another directory page as the best method, if I can remove all the unimportant items from the said page. I'll take a look</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">shaunb</span><br>
      <span class="post-time small text-muted">11th May 2006 11:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It seems the :<br>
      <br>
      locate CFdir<br>
      if fail<br>
      messagebox "choose correct cf dir etc yeah"<br>
      abort<br>
      else<br>
      continue:<br>
      <br>
      <br>
      : actually looks alright, I thought it would produce a blank page with the messagebox on, then go back to the previous page, but this method actually looks 'ok', now if I could get the button to move away from the textbox a bit in the dirrequest control, and get it to move up a little so the bottom of the texbox and the bottom of the button are the same level, but not at the top, that would basically mean my custom page is finished and I wouldnt have to resort to using a normal NSIS directory page and removing the irrellevant details.<br>
      <br>
      I'm good at rambling, thanks though :)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">shaunb</span><br>
      <span class="post-time small text-muted">11th May 2006 12:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well thats the logic added<br>
      <br>
      Only moving and resizing the button on the dirrequest control is an issue, but thats not really that important if it can't be moved it can't.<br>
      <br>
      thanks anyone who helped, especially Afrow UK<br>
      <br>
      (I'll probably make another topic regarding any other queries I have, after reading of course)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">11th May 2006 14:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The button can be moved, but it would need quite a bit of extra code. GetClientRect returns 0 for the X and Y coordinates (bit pointless I know) because it works with the control itself rather than anything to do with the window that it sits in.<br>
      <br>
      A better idea would be to make the DirRequest text box width smaller. This can be achieved with the same code, except you probably need to take about 10 units off, and the control ID will be one less than that of the button (e.g. 1201)<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>