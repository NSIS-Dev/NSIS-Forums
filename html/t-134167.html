<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="File Write Access check wont always work.." />

  <title>File Write Access check wont always work.. - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">File Write Access check wont always work..</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=134167">File Write Access check wont always work..</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Balder</span><br />
      <span class="post-time small text-muted">3rd May 2003 21:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>File Write Access check wont always work..</strong><br />
      Hi!<br />
      I use this method to check if I can start overwriting a exe:<br />
      -----------<br />
      StrCpy $1 0<br />
      <br />
      loop:<br />
      FileOpen $0 "$EXEDIR\MYEXE.EXE" "w"<br />
      IfErrors 0 done<br />
      IntOp $1 $1 + 1<br />
      IntCmpU $1 50 done 0 done # if we got to 50 or passed it, enough<br />
      Sleep 500 # wait for 500ms<br />
      Goto loop<br />
      done:<br />
      FileClose $0<br />
      <br />
      File "MYEXE.EXE"<br />
      ------------<br />
      Sometimes it works fine, but sometimes it doesn't. The EXE is suddenly 0 KB in size...<br />
      <br />
      Any ideas?<br />
      <br />
      Thanks!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">3rd May 2003 22:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try removing the sleep bit. Maybe having sleep there is stopping FileOpen seeing the file as writable.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">3rd May 2003 22:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you want to try whether you can overwrite, you can also use SetOverwrite try and check the error flag.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Balder</span><br />
      <span class="post-time small text-muted">3rd May 2003 23:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the replies.<br />
      SetOverwrite Try - worked just fine, TY!!<br />
      <br />
      Here is what I got in the end..<br />
      <br />
      ----------<br />
      Loop:<br />
      File "MYEXE.EXE"<br />
      <br />
      IfErrors 0 Done<br />
      IntOp $1 $1 + 1<br />
      IntCmpU $1 50 Error 0 Done # if we got to 50 or passed it, enough<br />
      Sleep 500 # wait for 500ms<br />
      ClearErrors<br />
      GoTo Loop<br />
      <br />
      Error:<br />
      MessageBox MB_OK|MB_ICONSTOP "Error message!"<br />
      <br />
      Done:<br />
      --------------<br />
      <br />
      Thanks again for the replies!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">7th May 2003 15:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just so you'll know next time, if the file was emptyed it means FileOpen didn't fail. You probably got an error because you didn't clean the error flag before you called FileOpen, and there was an error somewhere before FileOpen. It failed to reopen the file and looped 50 times because you only close the file after the loop is finished.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">7th May 2003 15:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Before loop, put ClearErrors (if you haven't already!)<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
