<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="get info from update.ini"><title>get info from update.ini - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">get info from update.ini</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=187782">get info from update.ini</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">VegetaSan</span><br><span class="post-time small text-muted">25th July 2004 22:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>get info from update.ini</strong><br>hey. I want this function in my installer. But I dont have a clue how to do it.<br><br>What I want is that the installer needs to extract update.ini to $INSTSDIR and that it needs to merge his info with os.ini so ... for example:<br><br>_______________________________________________________<br><br>Update.ini :<br><br></p><pre>
<code><br>[Global]<br>Password=NSIS<br>Nick=NSIS_dude<br>Host=mgmservers<br></code>
</pre><br>
      <br>
      let's say that this is the contents of update.ini<br>
      <br>
      _______________________________________________________<br>
      <br>
      Os.ini :<br>
      <br>
      <pre>
<code><br>[Global]<br>Password=NSIS_is_cool<br>Nick=NSIS_GIRLIE<br>Host=source<br>Version=1.0<br></code>
</pre><br>
      <br>
      and let's say this is Os.ini<br>
      ________________________________________________________<br>
      <br>
      <br>
      now .. when the installer is done with extracting update.ini then it needs to overwrite the contents of Os.ini with the contents that update.ini has. So after merging then Os.ini will be like this:<br>
      <br>
      <pre>
<code><br>[Global]<br>Password=NSIS<br>Nick=NSIS_dude<br>Host=mgmservers<br>Version=1.0<br></code>
</pre><br>
      <br>
      _______________________________________________________<br>
      <br>
      ok .. now I hope someone can help me with this. thanks.<br>
      <br>
      <br>
      With Regards, VegetaSan
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">VegetaSan</span><br>
      <span class="post-time small text-muted">26th July 2004 00:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ah sorry never mind .. allready got it .. stupid me &gt;_&lt;</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">VegetaSan</span><br>
      <span class="post-time small text-muted">26th July 2004 11:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ok .lol .. I still got a question. Will this work?<br>
      <br></p>
      <pre>
<code><br>ReadINIStr $0 "$INSTSDIR\Update.ini" "*.*" "*.*"<br>WriteINIStr "$INSTSDIR\mirc.ini" "*.*" "*.*" "$0"<br></code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">26th July 2004 15:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Uhhmmm no.<br>
      <br>
      I think the only way to do this would be to create a custom function to FileRead along with WriteINIStr. There's no way of using ReadINIStr to read through each key in the update.ini, so we will have to read each line using FileRead.<br>
      <br>
      I will write a function now...<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">atsuk</span><br>
      <span class="post-time small text-muted">26th July 2004 15:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">don't think so. you have to read each entry one by one into the variable, and then write them to another ini. afther all *.* is used with files. "*" means all, and dot between them is just like in file between name and extension, so *.* means all file names with all extensions<br>
      <br>
      edited:<br>
      but Afrow UK managed to reply faster(Y)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">26th July 2004 16:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Done!</strong><br></p>
      <pre>
<code> Function TrimNewlines<br>  Exch $R0<br>  Push $R1<br>  Push $R2<br>  StrCpy $R1 0<br><br> loop:<br>  IntOp $R1 $R1 - 1<br>  StrCpy $R2 $R0 1 $R1<br>  StrCmp $R2 "$\r" loop<br>  StrCmp $R2 "$\n" loop<br>  <br>  IntOp $R1 $R1 + 1<br>  IntCmp $R1 0 no_trim_needed<br>  StrCpy $R0 $R0 $R1<br><br> no_trim_needed:<br>  Pop $R2<br>  Pop $R1<br>  Exch $R0<br> FunctionEnd<br><br> Function SplitFirstStrPart<br>  Exch $R0<br>  Push $R1<br>  Push $R2<br>  StrLen $R1 $R0<br>  IntOp $R1 $R1 + 1<br>  loop:<br>    IntOp $R1 $R1 - 1<br>    StrCpy $R2 $R0 1 -$R1<br>    StrCmp $R1 0 exit0<br>    StrCmp $R2 "=" exit1 loop ; Change " " to "\" if str=dirpath<br>  exit0:<br>  StrCpy $R1 ""<br>  Goto exit2<br>  exit1:<br>    IntOp $R1 $R1 - 1<br>    StrCpy $R2 $R0 "" -$R1<br>    IntOp $R1 $R1 + 1<br>    StrCpy $R0 $R0 -$R1<br>    StrCpy $R1 $R2<br>  exit2:<br>  Pop $R2<br>  Exch $R1 ;rest<br>  Exch<br>  Exch $R0 ;first<br> FunctionEnd<br><br> Function ReadINIFileKeys<br>  Exch $R0 ;INI file to write<br>  Exch<br>  Exch $R1 ;INI file to read<br>  Push $R2<br>  Push $R3<br>  Push $R4 ;uni var<br>  Push $R5 ;uni var<br>  Push $R6 ;last INI section<br><br>  FileOpen $R2 $R1 r<br><br>  Loop:<br>   FileRead $R2 $R3<br>   IfErrors Exit<br><br>   Push $R3<br>    Call TrimNewLines<br>   Pop $R3<br><br>   StrCmp $R3 "" Loop<br><br>   StrCpy $R4 $R3 "" -1<br>   StrCmp $R4 "]" 0 +6<br>   StrCpy $R6 $R3 -1<br>   StrLen $R4 $R6<br>   IntOp $R4 $R4 - 1<br>   StrCpy $R6 $R6 "" -$R4<br>  Goto Loop<br><br>   Push $R3<br>    Call SplitFirstStrPart<br>   Pop $R4<br>   Pop $R5<br><br>   WriteINIStr $R0 $R6 $R4 $R5<br><br>   detailprint "$R6 $R4 $R5"<br><br>  Goto Loop<br>  Exit:<br><br>  FileClose $R1<br><br>  Pop $R6<br>  Pop $R5<br>  Pop $R4<br>  Pop $R3<br>  Pop $R2<br>  Pop $R1<br>  Pop $R0<br> FunctionEnd</code>
</pre><br>
      <br>
      Note that you need all three functions!<br>
      <br>
      Usage:<br>
      Push "update.ini"<br>
      Push "Os.ini"<br>
      Call ReadINIFileKeys<br>
      <br>
      Adding it to archive.<br>
      <br>
      -Stu
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">VegetaSan</span><br>
      <span class="post-time small text-muted">27th July 2004 14:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">cool.. thanks alot Afrow UK .. you're tha man !! :D</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">27th July 2004 16:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Uhm, just noticed an error in the function.<br>
      <br>
      Relace FileClose $R1 with FileClose <b>$R2</b><br>
      <br>
      Edit: and delete<br>
      detailprint "$R6 $R4 $R5"<br>
      (left in from testing)<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">VegetaSan</span><br>
      <span class="post-time small text-muted">27th July 2004 16:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">dont forget to update it in the archive too</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">27th July 2004 19:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Oh but of course :)<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">AaronLS</span><br>
      <span class="post-time small text-muted">25th March 2008 20:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This is a great script but I couldn't get it to blank out an ini setting. I.E. merging in:<br>
      [SomeSection]<br>
      SomeKey=<br>
      <br>
      often produces:<br>
      [SomeSection]<br>
      SomeKey=SomeKey=<br>
      <br>
      It also seems to do strange things with comments sometimes. For example, if a comment ended with ] I think it treats it like a section name. So I added a check for lines that start with ; and skip those.<br>
      <br>
      I have added skipping of comments. I think there might still be bugs if the semicolon is preceded by leading whitespace, but there are many apps that don't allow leading spaces in ini files anyhow.<br>
      <br>
      I updated the script to work with the newer versions of SplitFirstStrPart, because the version used above does not properly parse "BlankValue=", but the newer version in the wiki does parse it correctly. All that was needed was a Push "=" for SplitFirstStrPart and renaming TrimNewLines to StrTrimNewLines.<br>
      <br></p>
      <pre>
<code><br>Function ReadINIFileKeys<br>      Exch $R0 ;INI file to write<br>      Exch<br>      Exch $R1 ;INI file to read<br>      Push $R2<br>      Push $R3<br>      Push $R4 ;uni var<br>      Push $R5 ;uni var<br>      Push $R6 ;last INI section<br> <br>      FileOpen $R2 $R1 r<br> <br>      Loop:<br>       FileRead $R2 $R3   ;get next line into R3<br>       IfErrors Exit<br> <br>       Push $R3<br>        Call StrTrimNewLines <br>       Pop $R3<br> <br>       StrCmp $R3 "" Loop   ;if blank line, skip<br>       <br>       StrCpy $R4 $R3 1   ;get first char into R4<br>       StrCmp $R4 ";" Loop   ;check it for semicolon and skip line if so(ini comment)<br> <br>       StrCpy $R4 $R3 "" -1   ;get last char of line into R4<br>       StrCmp $R4 "]" 0 +6     ;if last char is ], parse section name, else jump to parse key/value<br>       StrCpy $R6 $R3 -1   ;get all except last char<br>       StrLen $R4 $R6     ;get str length<br>       IntOp $R4 $R4 - 1    ;subtract one from length<br>       StrCpy $R6 $R6 "" -$R4   ;copy all but first char to trim leading [, placing the section name in R6<br>      Goto Loop<br>       <br>       Push "="  ;push delimiting char<br>       Push $R3<br>        Call SplitFirstStrPart<br>       Pop $R4<br>       Pop $R5       <br>              <br>       WriteINIStr $R0 $R6 $R4 $R5      <br> <br>      Goto Loop<br>      Exit:<br> <br>      FileClose $R2<br> <br>      Pop $R6<br>      Pop $R5<br>      Pop $R4<br>      Pop $R3<br>      Pop $R2<br>      Pop $R1<br>      Pop $R0<br>     FunctionEnd<br></code>
</pre>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>