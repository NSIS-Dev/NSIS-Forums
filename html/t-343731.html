<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="File Command with \\?\ added to a variable path" />

  <title>File Command with \\?\ added to a variable path - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">File Command with \\?\ added to a variable path</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=343731">File Command with \\?\ added to a variable path</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dfranck</span><br />
      <span class="post-time small text-muted">2nd April 2012 23:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>File Command with \\?\ added to a variable path</strong><br />
      I am trying to use the File command to add files to my installer. Due to the location of the files on my system, I run into the 255 char limit, thus requiring the need for \\?\ added to the front of my path. I initially was using a relative path to the files I wanted included in my installer, but when the limit was reached I had to change direction.<br />
      <br />
      Does anyone have any good ideas, short of moving the files to a location with a shorter path in my directory tree, as to how I can use the File command with a variable path name.<br />
      <br />
      <br />
      I have tried passing a variable as Filespec in hopes that the value of the variable would be used, but the macro seems to pass the variable name instead of the path stored in Filespec.<br />
      <br />
      !macro InstallFilesTo Path Filespec<br />
      SetOutPath "${Path}"<br />
      File /r "${Filespec}"<br />
      !macroend<br />
      <br />
      I have tried many different approaches over the past few days, some syntax really questionable.... I am at a loss. I have tried pretty much everything I have seen posted online thus far, but I believe my situation is unique, because the installer I am trying to write needs to be able to be compiled on many different user's systems.<br />
      <br />
      Any and all help is greatly appreciated.<br />
      <br />
      Thanks,<br />
      Dan</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">3rd April 2012 22:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What actually happens when you do File "\\?\c:\insane\path\myfile.ext"? Our internal limit is probably 1024 but the MS C run time might be getting in the way. Windows is limited to MAX_PATH (256) for ansi apps so you must use the unicode fork for any chance of the \\?\ prefix working. Other solutions are: subst, UNC drive mapping or junctions/symlinks to get the path shorter...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dfranck</span><br />
      <span class="post-time small text-muted">4th April 2012 15:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Anders, first off, thank you for your response. When I use the absolute path, File "\\?\c:\insane\path\myfile.ext", the compiler and the resulting installer works great.<br />
      <br />
      When I pass "\\?\c:\insane\path\myfile.ext" in a $tempDir variable, the compiler gives File: "$tempDir" -&gt; no files found. message along with Error in script "test.nsi" on line 21 -- aborting creation process.<br />
      <br />
      I guess it doesn't make sense to me why I can use the absolute path when hard coded but not when passed in with a variable.<br />
      <br />
      i.e.<br />
      <br />
      File /r "\\?\c:\insane\path\myfile.ext"<br />
      <br />
      Var /GLOBAL tempDir<br />
      StrCpy $tempDir "\\?\c:\insane\path\myfile.ext"<br />
      File /r $tempDir<br />
      <br />
      <br />
      I will take a look at the unicode fork and your other suggestions to see if I can get them to work for me before I say give and use a batch file to relocate the files, compile the installer, and then move the files back...or something along those lines.<br />
      <br />
      Thanks again for the help.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">4th April 2012 16:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">File does not take variables! Use a define...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dfranck</span><br />
      <span class="post-time small text-muted">4th April 2012 21:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Anders, here is my solution...thanks again for the help.<br />
      <br />
      I'm using a batch file where I<br />
      <br />
      SET "INSANE_PATH=\\?\%LONG_PATH%"<br />
      <br />
      "%NSIS%\makensis.exe" /DFILE_DIRECTORY=%INSANE_PATH% myInstaller.nsi &gt; myInstaller.log<br />
      <br />
      <br />
      Then in my nsi script I just call<br />
      <br />
      File /r ${FILE_DIRECTORY}<br />
      <br />
      This does the trick... Thanks again for the advice.<br />
      <br />
      ~Dan</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br />
      <span class="post-time small text-muted">6th April 2012 21:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">this might help too<br />
      <a href="http://forums.winamp.com/showthread.php?t=343779" target="_blank">http://forums.winamp.com/showthread.php?t=343779</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dfranck</span><br />
      <span class="post-time small text-muted">6th April 2012 21:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Brummelchen, I'll talk a look</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
