<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="silent and manual install at the same time" />

  <title>silent and manual install at the same time - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">silent and manual install at the same time</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=270240">silent and manual install at the same time</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JamesKiller</span><br />
      <span class="post-time small text-muted">26th April 2007 23:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>silent and manual install at the same time</strong><br />
      Hi,<br />
      <br />
      I have to complete this task:<br />
      <br />
      if a slient install is in progress at the time that the user runs a manual install, we need to display an appropriate message and possibly an hourglass image, and wait until the silent installer finishes.<br />
      during this time, the user should be able to press cancel button to exit the installer.<br />
      is there has some callback function?<br />
      Any thoughts?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comperio</span><br />
      <span class="post-time small text-muted">27th April 2007 00:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Seems like all you'd have to do is create something in .onInit to detect whether or not an install was running based on whether its EXE was running. If it was, you could setup a loop to wait until (a) the user canceled or (b) the process terminated (completed).<br />
      <br />
      To capture a user clicking "cancel", I'd use something like the <a href="http://nsis.sourceforge.net/Nxs_plug-in" target="_blank">NXS plugin</a> since it has a cancel button already. (Plus, you could keep all your logic contained within functions called from .OnInit).<br />
      <br />
      If you needed to know that it was a <b><i>silent</i></b> vs. just a normal install, then you might write to an INI file somewhere so that you could look for the process AND the presence of a setting in the ini file to go into 'loop mode' with your install.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JamesKiller</span><br />
      <span class="post-time small text-muted">27th April 2007 17:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>please help me check my code</strong><br />
      I am using this code to find whether or not the installer is running when users attempt to install.<br />
      System::Call "kernel32::CreateMutexA(i 0, i 0, t '$(^Name)') i .r0 ?e"<br />
      Pop $0<br />
      StrCmp $0 0 launch<br />
      StrLen $0 "$(^Name)"<br />
      IntOp $0 $0 + 1<br />
      loop:<br />
      FindWindow $1 '#32770' '' 0 $1<br />
      IntCmp $1 0 found<br />
      System::Call "user32::GetWindowText(i r1, t .r2, i r0) i."<br />
      StrCmp $2 "$(^Name)" 0 loop<br />
      found:<br />
      <br />
      so if i found one installer is in silent mode, then I have to pop up a window<br />
      <br />
      nxs::Show /NOUNLOAD `$(^Name) Setup` /top `Setup installing something$\r$\nPlease wait...` /sub `$\r$\n$\r$\n Preparing...` /h 0 /pos 0 /max 100 /can 1 /end<br />
      <br />
      Sleep 1000<br />
      nxs::getWindow /NOUNLOAD<br />
      Pop $0 GetDlgItem $1 $0 2 SendMessage $1 ${WM_SETTEXT} 1 "STR:&amp;Quit" StrCpy $1 -1<br />
      doloop:<br />
      doSearch:<br />
      <br />
      nxs::HasUserAborted /NOUNLOAD<br />
      Pop $0 ; $0 now contains "1" if user clicked Cancel or "0" otherwise.<br />
      StrCmp $0 1 destroy<br />
      <br />
      nxs::Update /NOUNLOAD /sub "$\r$\n$\r$\n $1% complite" /pos $1 /end<br />
      IntCmp $1 0 doloop<br />
      <br />
      destroy:<br />
      nxs::Destroy<br />
      <br />
      ************************************<br />
      for the doloop part, should I still use<br />
      System::Call "kernel32::CreateMutexA(i 0, i 0, t '$(^Name)') i .r0 ?e"<br />
      Pop $0<br />
      StrCmp $0 0 launch<br />
      StrLen $0 "$(^Name)"<br />
      IntOp $0 $0 + 1<br />
      <br />
      to find window again?<br />
      <br />
      could someone modify my code and make it working?<br />
      <br />
      Thank you.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JamesKiller</span><br />
      <span class="post-time small text-muted">27th April 2007 20:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">and use this snippet to test:<br />
      <br />
      dloop:<br />
      <br />
      FindWindow $1 '#32770' '' 0 $1<br />
      MessageBox MB_OK $1<br />
      IntCmp $1 0 destroy 0 0<br />
      intop $R0 $R0 + 1<br />
      MessageBox MB_OK $R0<br />
      nxs::Update /NOUNLOAD /sub "$\r$\n$\r$\n $R0 detects." /pos $R0 /end<br />
      <br />
      nxs::HasUserAborted /NOUNLOAD<br />
      Pop $0 ; $0 now contains "1" if user clicked Cancel or "0" otherwise.<br />
      StrCmp $0 1 destroy<br />
      goto dloop<br />
      <br />
      but only can loop for 7 times, after 7 time,<br />
      execute<br />
      FindWindow $1 '#32770' '' 0 $1<br />
      then $1=0, but i found the installer in silent mode is still running....<br />
      <br />
      Any thoughts</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
