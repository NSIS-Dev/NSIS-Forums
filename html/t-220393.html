<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Secondary Installation Directory" />

  <title>Secondary Installation Directory - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Secondary Installation Directory</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=220393">Secondary Installation Directory</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jaymach</span><br />
      <span class="post-time small text-muted">1st July 2005 11:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Secondary Installation Directory</strong><br />
      Hi...I was wandering if it was possible to make a sort of secondary installation directory? (Note: I'm a complete n00b at NSIS.) I'm wanting something like...<br />
      <br />
      InstallDirRegKey HKLM "SOFTWARE\Microsoft\MSNMessenger" "InstallationDirectory"<br />
      InstallDir2RegKey HKLM "SOFTWARE\Patchou\MsgPlus2" "InstallationDirectory2"<br />
      <br />
      Now I know that won't work like that...but is there any way to do it? Even if I had to download some sort of plugin, I'd be happy to do so.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">glory_man</span><br />
      <span class="post-time small text-muted">1st July 2005 12:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can read this key inside .onInit function and store it in user variable.<br />
      Var InstDir2<br />
      ...<br />
      ReadRegStr $InstDir2 $HKLM "SOFTWARE\Patchou\MsgPlus2" "InstallationDirectory2"</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jaymach</span><br />
      <span class="post-time small text-muted">1st July 2005 13:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Errors...</strong><br />
      Thanks for the quick reply...unfortunately it's giving me errors :( (As I said...I'm a complete n00b so it's entirely possible I've made an obvious mistake). I'm attaching my script so you can see if I've done it right...just tell me if I've been a complete idiot. :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">glory_man</span><br />
      <span class="post-time small text-muted">1st July 2005 13:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Re: Errors...</strong><br /></p>

      <blockquote>
        <i>Originally posted by Jaymach</i><br />
        <b>Thanks for the quick reply...</b>
      </blockquote>:) Very quick - 1 hour. :D<br />
      Add before section instfiles

      <blockquote>
        Var InstDir2
      </blockquote>.<br />
      And my typo<br />
      ReadRegStr $InstDir2 <b>HKLM</b> "SOFTWARE\Patchou\MsgPlus2" "InstallationDirectory2"<br />
      Try this. Post if will other errors.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jaymach</span><br />
      <span class="post-time small text-muted">1st July 2005 13:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Lol...it was quick by my standards seeing as I usually wait about a day to get help. :P When I add it before instfiles I get<br />
      <br />
      Error: command ReadRegStr not valid outside section or function</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">glory_man</span><br />
      <span class="post-time small text-muted">1st July 2005 13:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Leave ReadRegStr in section. Add this line before section</p>
      <pre>
<code>Var InstDir2</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jaymach</span><br />
      <span class="post-time small text-muted">1st July 2005 14:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry about not replying sooner. :) Working perfectly apart from me calling the wrong part of the registry lol...thanks once more for the help. :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">1st July 2005 20:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Did you end up putting it in a section?<br />
      If so, then you should put it in your second directory page's Pre function:<br />
      <br />
      Var INSTDIR2<br />
      !define MUI_PAGE_CUSTOMFUNCTION_PRE getInstDir<br />
      !define MUI_DIRECTORYPAGE_VARIABLE $INSTDIR2<br />
      !insertmacro MUI_PAGE_DIRECTORY<br />
      <br />
      Now put that code in a Function named getInstDir.<br />
      This will put the value of $INSTDIR2 into your Directory path box.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jaymach</span><br />
      <span class="post-time small text-muted">2nd July 2005 08:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well I...uh...have no idea how to do that. :)...but a new problem...is there any way for me to get the installer to look for 2 entries in the Registry? I need it to look in both HKEY_LOCAL_MACHINE\SOFTWARE\Patchou\MsgPlus2 and HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Patchou\MsgPlus2 as on my Windows XP x64 edition, the 1st location isn't there, and has been moved to the 2nd location. I'm trying to make my installer run on both versions, so is there any way for me to try to detect both?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">2nd July 2005 12:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Easier than you think.<br />
      <br /></p>
      <pre>
<code>Var INSTDIR2<br />!define MUI_PAGE_CUSTOMFUNCTION_PRE getInstDir<br />!define MUI_DIRECTORYPAGE_VARIABLE $INSTDIR2<br />!insertmacro MUI_PAGE_DIRECTORY<br /><br />Function getInstDir<br /> ReadRegStr $INSTDIR2 HKLM "SOFTWARE\Patchou\MsgPlus2" "keyname"<br /> StrCmp $INSTDIR2 "" 0 +2<br /> ReadRegStr $INSTDIR2 HKLM "SOFTWARE\Wow6432Node\Patchou\MsgPlus2" "keyname"<br /> StrCmp $INSTDIR2 "" 0 +2<br />  StrCpy $INSTDIR2 "C:\default install dir"<br />FunctionEnd</code>
</pre><br />
      <br />
      -Stu
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
