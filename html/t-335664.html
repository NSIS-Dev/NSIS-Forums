<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="How to check if cancel button pressed in nsDialogs" />

  <title>How to check if cancel button pressed in nsDialogs - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">How to check if cancel button pressed in nsDialogs</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=335664">How to check if cancel button pressed in nsDialogs</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">howzer</span><br />
      <span class="post-time small text-muted">6th October 2011 11:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>How to check if cancel button pressed in nsDialogs</strong><br />
      Hello,<br />
      I've created a cutom page using nsDialogs. How would I check if the user has pressed the cancel button. At the moment I have a condition to make sure a text box has been filled and not left blank. If it is left blank and the user decides to cancel then and there, the same check condition gets executed and there is no way of aborting the installer. Many Thanks.<br />
      <br />
      Function ConnectionDialogShowAndLeave<br />
      Push $R0<br />
      <br />
      ${Do}<br />
      !insertmacro MUI_HEADER_TEXT "Registry Connection Details" "Please provide information regarding your connection string and database settings."<br />
      nsDialogs::Create 1018<br />
      Pop $0<br />
      ${If} $0 == error<br />
      Abort<br />
      ${EndIf}<br />
      <br />
      # LHApp Connection String<br />
      ${NSD_CreateLabel} 0 12 25% 12u "Database Connection:"<br />
      ${NSD_CreateText} 25% 10 75% 12u "$ConnectionString"<br />
      Pop $Text<br />
      GetFunctionAddress $0 GetText<br />
      nsDialogs::OnChange $Text $0<br />
      <br />
      # DBMS Radio buttons<br />
      ${NSD_CreateGroupBox} 0 40 100% 45u "Database Type"<br />
      ${NSD_CreateRadioButton} 10 60 50% 12u "Oracle"<br />
      Pop $Button1<br />
      GetFunctionAddress $0 GetButtonState<br />
      nsDialogs::OnClick $Button1 $0<br />
      <br />
      ${NSD_CreateRadioButton} 10 80 50% 12u "SQL-Server"<br />
      Pop $Button2<br />
      nsDialogs::OnClick $Button2 $0<br />
      <br />
      # Check the current value of DBMS and check the associated radio button<br />
      ${If} $DBMS == "0"<br />
      ${NSD_Check} $Button1<br />
      ${ElseIf} $DBMS == "1"<br />
      ${NSD_Check} $Button2<br />
      ${EndIf}<br />
      nsDialogs::Show<br />
      <br />
      # Set the correlating DBMS value<br />
      ${If} $Button1State == ${BST_CHECKED}<br />
      StrCpy $DBMS "0"<br />
      ${ElseIf} $Button2State == ${BST_CHECKED}<br />
      StrCpy $DBMS "1"<br />
      ${EndIf}<br />
      <br />
      <font color="red"># Ensure connection string has been provided<br />
      ${If} $ConnectionString == ""<br />
      MessageBox MB_ICONEXCLAMATION "Please provide the database connection."<br />
      ${Continue}<br />
      ${EndIf}</font><br />
      <br />
      <font color="red"># Ensure DBMS has been selected<br />
      ${If} $DBMS != "0"<br />
      ${AndIf} $DBMS != "1"<br />
      MessageBox MB_ICONEXCLAMATION "Please choose a database type."<br />
      ${Continue}<br />
      ${EndIf}</font><br />
      <br />
      # If we get here, then all details have been provided, so exit the loop<br />
      ${ExitDo}<br />
      ${Loop}<br />
      <br />
      Pop $R0<br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">6th October 2011 12:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You are validating your fields incorrectly. You should be doing it in the page leave function where you can simply call Abort to return back to the page. The leave function is not called if they click Back or Cancel.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">howzer</span><br />
      <span class="post-time small text-muted">6th October 2011 12:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If I wanted to return back to the page from another function, wouldn't I get a stack error? Wouldn't calling abort just leave the installer?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">howzer</span><br />
      <span class="post-time small text-muted">6th October 2011 12:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok I tried what you suggested and it worked! Thanks Stu. All this time I thought calling abort would just close the installer but in nsDialogs, it will just refresh the page?<br />
      <br />
      Function ConnectionDialogShow<br />
      <br />
      !insertmacro MUI_HEADER_TEXT "Registry Connection Details" "Please provide information regarding your connection string and database settings."<br />
      nsDialogs::Create 1018<br />
      Pop $0<br />
      ${If} $0 == error<br />
      Abort<br />
      ${EndIf}<br />
      <br />
      # LHApp Connection String<br />
      ${NSD_CreateLabel} 0 12 25% 12u "Database Connection:"<br />
      ${NSD_CreateText} 25% 10 75% 12u "$ConnectionString"<br />
      Pop $Text<br />
      GetFunctionAddress $0 GetText<br />
      nsDialogs::OnChange $Text $0<br />
      <br />
      # DBMS Radio buttons<br />
      ${NSD_CreateGroupBox} 0 40 100% 45u "Database Type"<br />
      ${NSD_CreateRadioButton} 10 60 50% 12u "Oracle"<br />
      Pop $Button1<br />
      GetFunctionAddress $0 GetButtonState<br />
      nsDialogs::OnClick $Button1 $0<br />
      <br />
      ${NSD_CreateRadioButton} 10 80 50% 12u "SQL-Server"<br />
      Pop $Button2<br />
      nsDialogs::OnClick $Button2 $0<br />
      <br />
      # Check the current value of DBMS and check the associated radio button<br />
      ${If} $DBMS == "0"<br />
      ${NSD_Check} $Button1<br />
      ${ElseIf} $DBMS == "1"<br />
      ${NSD_Check} $Button2<br />
      ${EndIf}<br />
      nsDialogs::Show<br />
      <br />
      FunctionEnd<br />
      <br />
      Function ConnectionDialogLeave<br />
      ${NSD_GetText} $Text $ConnectionString<br />
      ${NSD_GetState} $Button1 $Button1State<br />
      ${NSD_GetState} $Button2 $Button2State<br />
      <br />
      # Set the correlating DBMS value<br />
      ${If} $Button1State == ${BST_CHECKED}<br />
      StrCpy $DBMS "0"<br />
      ${ElseIf} $Button2State == ${BST_CHECKED}<br />
      StrCpy $DBMS "1"<br />
      ${EndIf}<br />
      <br />
      # Ensure connection string has been provided<br />
      ${If} $ConnectionString == ""<br />
      MessageBox MB_ICONEXCLAMATION "Please provide the database connection."<br />
      Abort<br />
      ${EndIf}<br />
      <br />
      # Ensure DBMS has been selected<br />
      ${If} $DBMS != "0"<br />
      ${AndIf} $DBMS != "1"<br />
      MessageBox MB_ICONEXCLAMATION "Please choose a database type."<br />
      Abort<br />
      ${EndIf}<br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">6th October 2011 14:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Read section 4.5.3 Callbacks in the manual.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
