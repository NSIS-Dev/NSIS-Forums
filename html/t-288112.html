<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Uninstall deleted all files under Program Files"><title>Uninstall deleted all files under Program Files - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Uninstall deleted all files under Program Files</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=288112">Uninstall deleted all files under Program Files</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Hernaez</span><br><span class="post-time small text-muted">7th March 2008 18:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Uninstall deleted all files under Program Files</strong><br>Have been using this installer for a few months now, it's fairly simple - just copies files to an installation directory.<br><br>Problem was that on one instance of the uninstall in addition to it's own installation directory it also wiped out the contents of Program Files.<br><br>Any ideas why this might have occurred and how I can be sure to prevent this?<br><br>The only thing I can think of is that the "${PRODUCT_DIR_REGKEY}" happened to be a duplicate of another product of ours that was also installed. I dont' actually know what this key is used for - it was inserted by the HM NIS wizard.<br><br>Here's my uninstall section, any help would be appreciated.<br><br>Section Uninstall<br>Call un.KillPro<br>Delete "$INSTDIR\${PRODUCT_NAME}.url"<br>Delete "$INSTDIR\uninst.exe"<br>RMDir /r "$INSTDIR\plugins"<br>RMDir /r "$INSTDIR\common"<br>Delete "$SMPROGRAMS\ClearCanvas Ris Client\Uninstall.lnk"<br>Delete "$SMPROGRAMS\ClearCanvas Ris Client\Website.lnk"<br>Delete "$DESKTOP\ClearCanvas Ris Client.lnk"<br>Delete "$SMPROGRAMS\ClearCanvas Ris Client\ClearCanvas Ris Client.lnk"<br>RMDir "$SMPROGRAMS\ClearCanvas Ris Client"<br><br>RMDir /r "$INSTDIR"<br><br>DeleteRegKey ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}"<br>DeleteRegKey HKLM "${PRODUCT_DIR_REGKEY}"<br>SetAutoClose true<br>SectionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rixor</span><br><span class="post-time small text-muted">7th March 2008 20:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">RMDir /r "$INSTDIR"<br><br>That call causes the installer to remove the whole $INSTDIR tree recursively, regardless of whether or not it is empty. If $INSTDIR happens to be Program Files, then it will delete everything in Program Files.<br><br>This is from the scripting reference: "Warning: using RMDir /r $INSTDIR in the uninstaller is not safe. Though it is unlikely, the user might select to install to the Program Files folder and so this command will wipe out the entire Program Files folder, including other programs that has nothing to do with the uninstaller. The user can also put other files but the program's files and would expect them to get deleted with the program. Solutions are available for easily uninstalling only files which were installed by the installer."</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>