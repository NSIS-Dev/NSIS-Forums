<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Problem with shortcut icon and NSIS"><title>Problem with shortcut icon and NSIS - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Problem with shortcut icon and NSIS</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=355827">Problem with shortcut icon and NSIS</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Arth</span><br><span class="post-time small text-muted">13th February 2013 23:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Problem with shortcut icon and NSIS</strong><br>I am trying to get an external icon installed in the program .lnk but it is not working for me. The following is the nsis.nsi statements that are involved:<br><br>!define APP_NAME "Fescue"<br>!define VERSION "01.00.00.00"<br>!define DESCRIPTION "Application"<br>!define INSTALLER_NAME "\Dropbox\Fescue\setup.exe"<br>!define MAIN_APP_EXE "Fescue.rex"<br>!define MAIN_APP_ICO "Fescue.ico"<br>!define INSTALL_TYPE "SetShellVarContext current"<br><br>!ifdef REG_START_MENU<br>!insertmacro MUI_STARTMENU_WRITE_BEGIN Application<br>CreateDirectory "$SMPROGRAMS\$SM_Folder"<br>CreateShortCut "$SMPROGRAMS\$SM_Folder\${APP_NAME}.lnk" \<br>"$INSTDIR\${MAIN_APP_EXE}" "$INSTDIR\${MAIN_APP_ICO}"<br>CreateShortCut "$DESKTOP\${APP_NAME}.lnk" "$INSTDIR\${MAIN_APP_EXE}" \<br>"$INSTDIR\${MAIN_APP_ICO}"<br>CreateShortCut "$SMPROGRAMS\$SM_Folder\Uninstall ${APP_NAME}.lnk" \<br>"$INSTDIR\uninstall.exe"<br>!endif<br><br>When I look at the .lnk file with a hex editor, or select properties on the program icon, it appears the .ico file information has been appended to the end of the target field for the program. If I manually select to change the icon on the properties panel, it works okay, but the .ico information is located in a different place in the .lnk file. Suggestions on how to get around this problem? This is on a Windows XP Pro system.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">14th February 2013 03:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Make sure $INSTDIR\${MAIN_APP_EXE} and ${MAIN_APP_ICO} exist before you call CreateShortcut...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Arth</span><br><span class="post-time small text-muted">14th February 2013 14:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks Anders, but if you read my original post, the following defines are at the first part of my script:<br>!define MAIN_APP_EXE "Fescue.rex"<br>!define MAIN_APP_ICO "Fescue.ico"<br>Is there another solution or work around?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">14th February 2013 15:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Anders means that the folders and files must exist before the shortcut is created.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Arth</span><br><span class="post-time small text-muted">14th February 2013 15:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sorry for being so dense, but see the following from my original post:<br>CreateDirectory "$SMPROGRAMS\$SM_Folder"<br>CreateShortCut "$SMPROGRAMS\$SM_Folder\${APP_NAME}.lnk" \<br>"$INSTDIR\${MAIN_APP_EXE}" "$INSTDIR\${MAIN_APP_ICO}"<br>CreateShortCut "$DESKTOP\${APP_NAME}.lnk" "$INSTDIR\${MAIN_APP_EXE}" \<br>"$INSTDIR\${MAIN_APP_ICO}"<br><br>As I stated in the original post, the shortcut is there with the execution parameter filled in and the ico parameter is also there, but following the execution parameter in the target field like:<br>C:\Fescue\fescue.rex C:\Fescue\fescue.ico<br>the fescue.ico file is also in the C:\Fescue folder after the setup.exe install has been run. I suspect the problem is with the executable not being an .exe or .dll, but the .rex is defined to have ooRexx.exe start and that is passed as the startup parameter. That all works okay - just the icon is NOT present on either the desktop or the Start Menu folder. I am asking if there is a workaround or how this should be handled.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">demiller9</span><br><span class="post-time small text-muted">14th February 2013 18:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Arth, you still don't seem to be answering Anders' concern. When you execute the code to create the SMPrograms folder and the shortcut, has the executable file been extracted yet? If the file isn't yet on the target computer, the shortcut icon won't be set properly.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">14th February 2013 20:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You forgot a parameter:</p><blockquote>Createshortcut foo.lnk bar.exe "" baz.ico</blockquote></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>