<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Issues with 32/64bit install creation!"><title>Issues with 32/64bit install creation! - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Issues with 32/64bit install creation!</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=322692">Issues with 32/64bit install creation!</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">jean_1234</span><br><span class="post-time small text-muted">24th September 2010 10:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Issues with 32/64bit install creation!</strong><br>Hi,<br><br>I'm currently trying to write an install which will hopefully determine if the OS is 32bit or 64bit and install certain files into specific locations accordingly. Some of the files are driver/inf/cat files for installing a USB device, which is done by DPInst.<br><br>I'm having 2 issues which I would love help with. the 1st in the following code :<br>!include WinVer.nsh<br><br>Section "MainSection" SEC01<br>GetVersion::WindowsPlatformArchitecture<br>Pop $R0<br>DetailPrint "Detected a $R0 bit windows architecture"<br>!if "$R0" == "32"<br>InstallDir "$PROGRAMFILES\Blah\Jeans Drivers"<br>!else<br>InstallDir "$PROGRAMFILES\Blah\Jeans Drivers 32"<br>!endif<br>SetOutPath "$INSTDIR"<br>SetOverwrite ifnewer<br>SectionEnd<br><br>but I get<br>Error: command InstallDir not valid in Section<br>Error in script : "C:\NSISSourceFiles\driver_script.nsi" on line 71 -- aborting creation process<br><br>This error seems to reflect back to the InstallDir after the !else line?!? (i.e. that's the line that turns red when I double click on the error)<br><br>Any suggestions??</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">24th September 2010 10:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">1. You're confusing !if and ${If}.<br>2. Use !include x64.nsh and ${If} ${RunningX64} (no need for my plug-in).<br>3. Use StrCpy $INSTDIR. InstallDir is a compile time instruction and cannot be used in functions or sections.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jean_1234</span><br><span class="post-time small text-muted">24th September 2010 11:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I had thought that alright but I got an error from that too so changed it!<br><br>This is what I had initially...right up the top, before any "Section" heading...<br><br>${If} ${RunningX64}<br>InstallDir "$PROGRAMFILES64\Blah\Jeans Drivers"<br>${Else}<br>InstallDir "$PROGRAMFILES\Blah\Jeans Drivers"<br>${EndIf}<br><br>That gives...<br>Error in macro _RunningX64 on macroline 2<br>Error in macto _If on macroline 9<br>Error in script "C:\NSISSourceFiles\driver_script.nsi" on line 48 -- aborting creation process</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">24th September 2010 12:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You're missing the actual error.<br><br>Edit: You can't use LogicLib outside a function/section. It's for run time, not compile time! Use my 1-3 in my first post.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jean_1234</span><br><span class="post-time small text-muted">24th September 2010 13:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sorry - and I'm not even blonde!! :)<br><br>the error is<br>Error: Can't add entry, no section or function is open!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jean_1234</span><br><span class="post-time small text-muted">24th September 2010 14:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok - I guess what I'm getting at is "Is there an easy way to determine what InstallDir should be at runtime? based on whether the user is running on a 32bit or 64bit machine?"<br><br>Thanks! :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">24th September 2010 15:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can use StrCpy $instdir "$programfiles\foo\bar" in .onInit</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jean_1234</span><br><span class="post-time small text-muted">24th September 2010 15:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Bingo!! Thanks!!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">24th September 2010 19:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I already said that in my first post (minus the use of .onInit mind).<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jean_1234</span><br><span class="post-time small text-muted">27th September 2010 10:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thank you both! I have that part sorted! :)</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>