<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Cannot find nsub.tmp?" />

  <title>Cannot find nsub.tmp? - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Cannot find nsub.tmp?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=259701">Cannot find nsub.tmp?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">winwaed</span><br />
      <span class="post-time small text-muted">16th November 2006 21:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Cannot find nsub.tmp?</strong><br />
      I've been using NSIS for some of our applications for a couple of years now.<br />
      <br />
      I occasionally get reports of it requesting a reboot and then Windows saying it can't find a temporary file. Everything is okay after that.<br />
      Unfortunately I can't reproduce the problem.<br />
      Today, a new customer reported the actual message: "<b>Windows cannot open this file nsub.tmp</b>"<br />
      <br />
      This occurs when Windows restarts.<br />
      <br />
      The application is a VB6 DLL (add-in for an MS application), but the installer also includes the VB6 runtimes (code taken from the Appendix) and a third party DLL.<br />
      <br />
      I assume the reboot is required because one of the DLLs is already loaded in memory?<br />
      <br />
      But what is causing the error? What is nsub.tmp? Has anyone seen anything like this before? What should I look for in the NSIS script?<br />
      <br />
      I didn't want to post the entire script with a "where's my bug" question, but I can post bits or the entire thing if it will prove useful...<br />
      <br />
      Richard</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">goldy1064</span><br />
      <span class="post-time small text-muted">16th November 2006 21:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">nsub.tmp sounds like the name of the $PLUGINSDIR folder. If you are trying to re-run an installer after restart that references that tmp directory, that could cause the failure as the PLUGINSDIR directory is removed when the installer exits.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">17th November 2006 11:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It most likely means the file set to automatically register the DLL files after reboot was deleted. That file should be located along with the DLL files themselves, so deleting the temporary directory on reboot shouldn't bother it. However, you should still ask your user if he does that. Also have him try and disable the anti-virus.<br />
      <br />
      Besides that, post the part of the script where the DLL files are installed, any other InstallLib calls you might have there and the version of NSIS you've used to create the installer. Maybe there's something in the script.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">winwaed</span><br />
      <span class="post-time small text-muted">17th November 2006 21:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Finding the NSIS version will take some time - it was built on my old dev machine which I retired from front-line work last week. It will still be installed on it, but it isn't connected up. I'm guessing it was about 12-18months old.<br />
      I installed the latest&amp;greatest for this PC here.<br />
      <br />
      If I understand it correctly, I'm only registering my own DLL. Here are the DLL installation extracts.<br />
      <br />
      <br />
      ; DLL stuff for VB6<br />
      !include "UpgradeDLL.nsh"<br />
      !define VBFILESDIR "VB_DLLs" ; Location of VB6 runtime files<br />
      <br />
      <br />
      Section "MainSection" SEC01<br />
      <br />
      ; stuff deleted here - list of files and menu shortcuts, registry writes,etc<br />
      <br />
      File "MileCharter.dll"<br />
      RegDLL $INSTDIR\MileCharter.dll<br />
      SectionEnd<br />
      <br />
      Section "Install VB DLLs"<br />
      !insertmacro UpgradeDLL ${VBFILESDIR}\Comcat.dll $SYSDIR\Comcat.dll $SYSDIR<br />
      !insertmacro UpgradeDLL ${VBFILESDIR}\Msvbvm60.dll $SYSDIR\Msvbvm60.dll $SYSDIR<br />
      !insertmacro UpgradeDLL ${VBFILESDIR}\Oleaut32.dll $SYSDIR\Oleaut32.dll $SYSDIR<br />
      !insertmacro UpgradeDLL ${VBFILESDIR}\Olepro32.dll $SYSDIR\Olepro32.dll $SYSDIR<br />
      !insertmacro UpgradeDLL ${VBFILESDIR}\ArmAccess.dll $SYSDIR\ArmAccess.dll $SYSDIR<br />
      !insertmacro UpgradeDLL ${VBFILESDIR}\Comdlg32.ocx $SYSDIR\Comdlg32.ocx $SYSDIR<br />
      !insertmacro UpgradeDLL ${VBFILESDIR}\mscomctl.ocx $SYSDIR\mscomctl.ocx $SYSDIR<br />
      !define UPGRADEDLL_NOREGISTER<br />
      !insertmacro UpgradeDLL ${VBFILESDIR}\Asycfilt.dll $SYSDIR\Asycfilt.dll $SYSDIR<br />
      !insertmacro UpgradeDLL ${VBFILESDIR}\Stdole2.tlb $SYSDIR\Stdole2.tlb $SYSDIR<br />
      !undef UPGRADEDLL_NOREGISTER<br />
      ; Only lease DLL count on new installation<br />
      IfFileExists $INSTDIR\MileCharter.dll skipAddSharedDLL<br />
      Push $SYSDIR\Comdlg32.ocx<br />
      Call AddSharedDLL<br />
      Push $SYSDIR\mscomctl.ocx<br />
      Call AddSharedDLL<br />
      Push $SYSDIR\ArmAccess.dll<br />
      Call AddSharedDLL<br />
      Push $SYSDIR\Asycfilt.dll<br />
      Call AddSharedDLL<br />
      Push $SYSDIR\Comcat.dll<br />
      Call AddSharedDLL<br />
      Push $SYSDIR\Msvbm60.dll<br />
      Call AddSharedDLL<br />
      Push $SYSDIR\Oleaut32.dll<br />
      Call AddSharedDLL<br />
      Push $SYSDIR\Olepro32.dll<br />
      Call AddSharedDLL<br />
      Push $SYSDIR\Stdole2.tlb<br />
      Call AddSharedDLL<br />
      skipAddSharedDLL:<br />
      SectionEnd<br />
      <br />
      <br />
      Function AddSharedDLL<br />
      Exch $R1<br />
      Push $R0<br />
      ReadRegDword $R0 HKLM Software\Microsoft\Windows\CurrentVersion\SharedDLLs $R1<br />
      IntOp $R0 $R0 + 1<br />
      WriteRegDWORD HKLM Software\Microsoft\Windows\CurrentVersion\SharedDLLs $R1 $R0<br />
      Pop $R0<br />
      Pop $R1<br />
      FunctionEnd<br />
      <br />
      Function un.DecrementSharedDLL<br />
      Exch $R1<br />
      Push $R0<br />
      ReadRegDword $R0 HKLM Software\Microsoft\Windows\CurrentVersion\SharedDLLs $R1<br />
      StrCmp $R0 "" done<br />
      IntOp $R0 $R0 - 1<br />
      IntCmp $R0 0 rk rk uk<br />
      rk:<br />
      DeleteRegValue HKLM Software\Microsoft\Windows\CurrentVersion\SharedDLLs $R1<br />
      Goto done<br />
      uk:<br />
      WriteRegDWORD HKLM Software\Microsoft\Windows\CurrentVersion\SharedDLLs $R1 $R0<br />
      done:<br />
      Pop $R0<br />
      Pop $R1<br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">winwaed</span><br />
      <span class="post-time small text-muted">17th November 2006 21:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I should also add that I am not doing anything explicitly for a reboot. Or doing anything to handle a reboot, for that matter.<br />
      <br />
      NSIS must be detecting that a reboot is required on its own (I assume something is in use).<br />
      <br />
      <br />
      Richard</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">18th November 2006 11:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, that was pretty easy to reproduce. I just installed RouterWriter.exe and got this message. It's because the RegTool was extracted without the .exe extension and Windows didn't know how to execute it. Simply upgrade to the latest version of NSIS, use <a href="http://nsis.sourceforge.net/Docs/AppendixB.html#B.4" target="_blank">Library</a> and you're set.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">winwaed</span><br />
      <span class="post-time small text-muted">18th November 2006 14:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks - yes RouteWriter's installation script was copied from MileCharter so it will have the same problem.<br />
      <br />
      So "insertmacro InstallLib" replaces the UpgradeDLL that I had?<br />
      And it looks like I no longer need the Add/Decrement DLL code?<br />
      That will simplify things :-)<br />
      <br />
      <br />
      btw, Thanks for everyone's help.<br />
      <br />
      <br />
      Richard</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">18th November 2006 14:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, InstallLib completely replaces UpgradeDLL, including the shared reference count handlers.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">winwaed</span><br />
      <span class="post-time small text-muted">18th November 2006 14:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Excellent! That does simplify things. I'll try it out this weekend - I have to build a new version for the same customer (to fix an unrelated bug).<br />
      <br />
      I already have the latest NSIS installed - I installed it when I built my new dev machine last week. (my old dev PC must have been a bit old - this Core2Duo screams :-) )<br />
      <br />
      Thanks everyone!<br />
      <br />
      Richard</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">winwaed</span><br />
      <span class="post-time small text-muted">19th November 2006 21:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Although I had problems reproducing the problem, initial tests of the rebuilt installation exe look good. I'll be passing it to the customer on Monday.<br />
      <br />
      Also the new DLL installation script bits are much better looking and cleaner - an improvement that I definitely appreciate.<br />
      <br />
      Thanks!<br />
      <br />
      Richard</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">21st November 2006 18:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You have to have an older version of one of the DLL files installed to reproduce this. On a new installation, XP apparently has an older version of MSVBVM60.dll.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
