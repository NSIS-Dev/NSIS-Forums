<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Bug in 2.08: uninstaller wont delete folder" />

  <title>Bug in 2.08: uninstaller wont delete folder - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Bug in 2.08: uninstaller wont delete folder</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=222975">Bug in 2.08: uninstaller wont delete folder</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br />
      <span class="post-time small text-muted">31st July 2005 05:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Bug in 2.08: uninstaller wont delete folder</strong><br />
      its a reproduceable fault here - nsis 2.08 uninstaller wont delete $instdir - nsis 2.07 does.<br />
      <br />
      its not fault of my script - i swapped versions w/o change.<br />
      <br />
      the uninstaller demands a reboot although the folder is empty and not in use.<br />
      <br />
      please have a look on it.<br />
      <br />
      im back on 2.07 so long</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br />
      <span class="post-time small text-muted">1st August 2005 04:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Right before you call 'Delete $Instdir' call this command:<br />
      <br />
      setoutpath "$Instdir"<br />
      setoutpath "..\" (you could try without the backslash)<br />
      <br />
      This changes the current directory to the directory before it (ex. from C:\windows to C:\ . This means C:\windows can be deleted (Do not delete C:\windows - this just an example)). This means $Instdir can be deleted.<br />
      <br />
      Hope this helps.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">2nd August 2005 20:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Right, haven't thought of that aspect when I made the change. The working directory of the installer is $INSTDIR, which is why it can't be deleted without SetOutPath. Please open a bug report and I'll fix it over the weekend.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">John P.</span><br />
      <span class="post-time small text-muted">2nd August 2005 21:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">-I just came here for this exact reason! Strange coinsidense...<br />
      <br />
      Anyway - I installed version 2.08 tonight, and ran into the same problem.<br />
      Only I was not trying to remove the $INSTDIR, I was trying to remove a folder I had created just before in the installer. I used <b>RMDir /r</b> and <b>Delete</b>, but to no avail. I don't think this has been a problem before.<br />
      <br />
      But it turned out that it was because the folder I had created and was now trying to delete, was the currently active folder just before the delete attempt (a <b>SetOutPath "the folder I'm talking about"</b> was before this in the script).<br />
      <br />
      The installer successfully deleted all the files <i>inside</i> the folder, just not the folder itself.<br />
      <br />
      However - when I now followed the advice given here, and put <b>SetOutPath "..\"</b> <i>before</i> the <b>RMDir /r "folder in question"</b> command, it worked, and the folder is now deleted. So thanks for the tip.<br />
      <br />
      However, this isn't how it's supposed to work, is it? I don't think it was like that in the earlier versions.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">2nd August 2005 21:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Maybe RMDir itself should be changed so that it will go out of the folder in case the current folder has to be deleted. That would solve all issues.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">3rd August 2005 11:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, Kichik wants to fix it over the weekend, I'm sure he will find a nice implementation, watch the CVS ;)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th August 2005 13:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Fixed.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br />
      <span class="post-time small text-muted">8th August 2005 05:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I would also like the ability to delete folders in the $INSTDIR path, example: if the $instdir is 'C:\jason\software\items', I would like to be able to delete the 'C:\jason\software' folder as well. Thinking of using setoutpath to do this but I haven't tried it yet.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">8th August 2005 10:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, ofcourse this is possible as before. Not really related to de bug as described before. As long as you keep track in your script where you install all yourr software this will work out. For now, better save than sorry, use "..\" etc.<br />
      <br />
      See manual and look at example:<br />
      <br />
      ...<br />
      ;only deletes if there are no more applications files<br />
      RMDir /REBOOTOK "$PROGRAMFILES\${CompanyRootFolder}"<br />
      ...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">stb</span><br />
      <span class="post-time small text-muted">9th August 2005 10:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have written some macros to work around the bug and to add another useful feature:<br />
      <br />
      Think about a standard installer for "mysoftware".<br />
      If the user installs into "c:\program files\tools\mysoftware" in general only "mysoftware" gets removed by the uninstaller, regardless whether "tools" or "tools\mysoftware" already exist.<br />
      <br />
      The macros at <a href="http://nsis.sourceforge.net/wiki/Dynamically_create_remove_directories" target="_blank">http://nsis.sourceforge.net/wiki/Dyn...ve_directories</a> will give you the part of the path which already existed, so you can just remove the parts created.<br />
      <br />
      Installer code:<br />
      <br /></p>
      <pre>
<code><br />  !insertmacro MakeDirBase $INSTDIR<br />  Pop $0<br />  WriteRegStr HKLM "...your_regkey_path..." "BasePath" "$0"<br /></code>
</pre><br />
      <br />
      Uninstaller code:<br />
      <br />
      <pre>
<code><br />  ReadRegStr $0 HKLM "...your_regkey_path..." "BasePath"<br />  !insertmacro RemoveDirBase "$INSTDIR" $0<br /></code>
</pre><br />
      <br />
      <a href="http://nsis.sourceforge.net/wiki/Dynamically_create_remove_directories" target="_blank">http://nsis.sourceforge.net/wiki/Dyn...ve_directories</a>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">9th August 2005 15:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">well, your macros add lots of overhead to installers, if used multiple times.<br />
      <br />
      you should rather stick to the common method used in several header files (like the WordFunc, FileFunc and TextFunc headers) where the features itself stay in Functions, and macros are only used to call them with one line.<br />
      <br />
      this will greatly decrease the overhead, and also work around the need of Index_... defines.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Ahmad1234</span><br />
      <span class="post-time small text-muted">17th August 2005 08:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi, I also have the same problem.. where do I place the new main.c.patch.txt file?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">17th August 2005 13:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's a part of the source code. For a compiled version grab the nightly build at <a href="http://nsis.sf.net" target="_blank">http://nsis.sf.net</a></p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
