<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Installing into a selected user account" />

  <title>Installing into a selected user account - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Installing into a selected user account</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=300096">Installing into a selected user account</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">NB-Dexter</span><br />
      <span class="post-time small text-muted">19th November 2008 14:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Installing into a selected user account</strong><br />
      I want to allow the user to select a user account for installation. So far, I can escalate the current user to admin, show a list of all available users, and pre-select the current user account. My problem is getting the SetShellVarContext to reflect the selected user account when it is set to "current". I need access to HKCU and LOCALAPPDATA for that user.<br />
      <br />
      I've looked at multiuser.nsh but it doesn't seem to do what I want.<br />
      <br />
      Any advice would be appreciated.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">19th November 2008 19:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Why not just have the user run the installer, no need to elevate or anything, that's how most setups do this.<br />
      <br />
      If you want to do it the hard way, you must load the users profile and redirect HKCU with RegOverridePredefKey (windows2000 and later, call with the system plugin). There is no way to override the folder constants in nsis, the best you can do is to get the path with SHGetFolderPath and use that path and not $localappdata, but to do this, you need the users token, and to get the token, the user needs to provide the password IIRC. Do you really want the user to first enter admin credentials and then credentials for a second user?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">NB-Dexter</span><br />
      <span class="post-time small text-muted">19th November 2008 20:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Anders</i><br />
        <b>Why not just have the user run the installer, no need to elevate or anything, that's how most setups do this.</b>
      </blockquote>I had a request for this functionality so I was researching the possibility. You're right, it is the hard way. I'll just require them to run the installer from the user account they want it installed into.<br />
      <br />
      Thanks for the reply.
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
