<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="I wrote some handy NSIS functions for C Programmers"><title>I wrote some handy NSIS functions for C Programmers - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">I wrote some handy NSIS functions for C Programmers</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=181764">I wrote some handy NSIS functions for C Programmers</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">TimeHorse</span><br><span class="post-time small text-muted">31st May 2004 05:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>I wrote some handy NSIS functions for C Programmers</strong><br>NSIS, unlike Python, does not have a List Type and this is good because it makes the language more like Assembly and therefore faster. However, the handy dandy C functions strtok and strchr allow list-like operations on pure strings. This IMHO goes well beyond the quite limited functionality of SPLIT_STRING and allows arbitrary delimiters, sets of delimiters (i.e. use ",.!? $\n$\t$\r" to split the input as words) and can be called repeatedly until all tokens are found. The resulting list should be tested for "" to terminate any loop. Here is the code:<br><br>; StrTok works just like ISO C strtok, where input is modified as in that function<br>; Parameter 2 is popped and it is the delimiter to split the string with<br>; Parameter 1 is then popped and it is the string to parse<br>; The resulting remaining part of input is pushed onto the stack<br>; The resulting substring is pushed onto the stack<br>;<br>; Example:<br>; Push $Input<br>; Push $Delim<br>; Call StrTok<br>; Pop $0<br>; Pop $Input<br>; MessageBox MB_OK "My next token is $0"<br>; MessageBox MB_OK "The remaining text is $Input"<br>;<br>; StrChr works just like ISO C strchr, where DELIM must be 1 char long and error is returned if DELIM is not found<br>; Parameter 2 is popped and it is the delimiter to split the string with<br>; Parameter 1 is then popped and it is the string to parse<br>; The resulting integer offset is pushed onto the stack<br>;<br>; Example:<br>; Push $Input<br>; Push $Delim<br>; Call StrChr<br>; Pop $0<br>; StrCmp $0 error +3<br>; MessageBox MB_OK "Delimiter found at offset $R0"<br>; goto +2<br>; MessageBox MB_OK "Delemiter not found"<br><br>Function StrTok<br>; Get the Delimiter ($R0)<br>Exch $R0<br><br>; Get the Input ($R1)<br>; This is second on the stack so switch it to the first and then $R0 becomes second<br>Exch 1<br>Exch $R1<br><br>; Need 2 more variables<br>Push $R2 ; A Character from the Input<br>Push $R3 ; An index into the Input<br><br>StrCpy $R3 -1<br><br>; Loop<br>StrTokLoop:<br>IntOp $R3 $R3 + 1<br>StrCpy $R2 $R1 1 $R3<br>StrCmp $R2 "" StrTokBreak<br>Push $R0 ; Delimiter<br>Push $R2 ; Character to find in the Delimeter<br>Call StrChr<br>Pop $R2 ; The position of old $R2 in the Delimeter<br>StrCmp $R2 error StrTokLoop<br><br>StrTokBreak:<br>Push $R5<br>StrCpy $R5 $R0 ; Store the Delimeter in $R5<br><br>StrCpy $R0 $R1 $R3 ; $R0 now has the parsed string<br><br>; Need to find all the delimeter and delete them<br>StrTokIsDelim:<br>IntOp $R3 $R3 + 1<br>StrCpy $R2 $R1 1 $R3<br>StrCmp $R2 "" StrTokDone<br>Push $R5 ; Delimiter<br>Push $R2 ; Character to find in the Delimeter<br>Call StrChr<br>Pop $R2 ; The position of old $R2 in the Delimeter<br>StrCmp $R2 error "" StrTokIsDelim<br><br>StrTokDone:<br>Pop $R5 ; Don't need the Delimeter copy anymore<br><br>StrCpy $R1 $R1 "" $R3 ; $R1 now has the rest of the input<br><br>Pop $R3 ; Reversal<br>Pop $R2 ; Reversal<br>Exch $R1 ; Push Input back on Stack where $R1 is<br><br>; Swap Input with stored $R0 and swap it for the result<br>Exch 1<br>Exch $R0 ; Result<br>FunctionEnd<br><br>Function StrChr<br>; Get the Delimiter ($R0) (What you're looking for)<br>Exch $R0<br><br>; Get the Input ($R1)<br>; This is second on the stack so switch it to the first and then $R0 becomes second<br>Exch 1<br>Exch $R1<br><br>; Need 2 more variables<br>Push $R2 ; A Character from the Input<br>Push $R3 ; An index into the Input<br><br>StrLen $R3 $R0 ; $R2 has the String Length<br>StrCmp $R3 1 +3<br><br>; Error -- Delim has to be 1 char<br>StrCpy $R0 error<br>Goto StrChrDone<br><br>StrCpy $R3 -1<br><br>; Loop<br>StrChrLoop:<br>IntOp $R3 $R3 + 1<br>StrCpy $R2 $R1 1 $R3<br>StrCmp $R2 "" "" +3<br><br>; Error -- Delim not found<br>StrCpy $R0 error<br>Goto StrChrDone<br><br>StrCmp $R2 $R0 "" StrChrLoop<br>; End Loop<br><br>; Need to move result to $R0<br>StrCpy $R0 $R3<br><br>StrChrDone:<br>Pop $R3 ; Reversal<br>Pop $R2 ; Reversal<br>Pop $R1 ; Reversal<br>Exch $R0 ; Result<br>FunctionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">deguix</span><br><span class="post-time small text-muted">31st May 2004 13:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ahnnn... StrTok was already included inside StrFunc.nsh header file (look for it at "Include" subdir) as a command ${StrTok}. And about StrChr, I don't use it much often...<br><br>But you can post your functions in the Archive if you want to.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">scully13</span><br><span class="post-time small text-muted">1st June 2004 20:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think StrChr would be handy. Please post to the Archive.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">deguix</span><br><span class="post-time small text-muted">2nd June 2004 02:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Is better you do it, as not everytime I'm available to update and fix the function at the time. If you know, I have several projects and manage more one is even worse for me. Register at Archive or create a page as anonymous (which doesn't need to register, but anyone can edit the page).</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>