<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Search path functions"><title>Search path functions - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Search path functions</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=77904">Search path functions</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">1st March 2002 18:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Search path functions</strong><br>&nbsp; Hi!<br><br>I have written some functions for adding/removing directories from the search path of Windows. They work for NT (without restart) and 9x.<br><br>I will be happy to see them in the functions.html file or contrib folder so they can help others but me :D<br><br>KiCHiK</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dbareis</span><br><span class="post-time small text-muted">2nd March 2002 00:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi,<br><br>Some (possibly only older editors) can put EOF characters into the file, in which case the approach you use will fail (as your "SET" would never get executed).<br><br>Just a warning,<br>Dennis</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">2nd March 2002 11:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks Dennis!<br><br>After looking in the code again, I have found out that somehow some old code got into it. I have now attached the newest code from my installer script with (I hope) all of the corrections needed.<br><br><b>Please download this version instead of the earlier one.</b><br><br>About your comment, I don't really understand what you mean. Do these editors put EOF in the middle of the file? If so, how else can I seek for the EOF?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dbareis</span><br><span class="post-time small text-muted">2nd March 2002 23:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i><br><b><br><br>About your comment, I don't really understand what you mean. Do these editors put EOF in the middle of the file? If so, how else can I seek for the EOF?</b></blockquote>In the good old days editors added a special EOF character (stupid but true) to files (the reason for the /A /B switches on a copy command), most (all?) programs (including Windows reading autoexec.bat etc) still stop reading at the EOF character.<br><br>From memory the EOF character was decimal 26, if I'm wrong then it was 27.<br><br>I don'y know how common this would be but I have seen this myself so I know it does happen (I tried to do exactly what your code does).<br><br>Bye,<br>Dennis</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">superrock</span><br><span class="post-time small text-muted">3rd March 2002 14:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>RefreshEnv</strong><br>&nbsp; Hi,<br><br>Thanks for posting the path script. It would be helpful for me to get also the source for RefreshEnv or if you could explain what exactly it contains (Api call)<br><br>Greetings,<br>Andreas<br>:)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">3rd March 2002 20:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Here is the API function called:<br><br>DWORD dwReturnValue;<br>SendMessageTimeout(HWND_BROADCAST, WM_SETTINGCHANGE, 0, (LPARAM) "Environment", SMTO_ABORTIFHUNG, 5000, &amp;dwReturnValue);<br><br>KiCHiK</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">superrock</span><br><span class="post-time small text-muted">3rd March 2002 23:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>RefreshEnv Api function</strong><br>&nbsp; Thanks kichik,<br><br>Will implement the function in an exe.<br><br>Greetings,<br>Andreas</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">GGamer</span><br><span class="post-time small text-muted">18th April 2003 01:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Kichik,<br><br>I have looked at your zip file and the archive example on sourgefourge. It is almost exactly what I am looking for. In both cases you change HKLU\Enviorment Path Key (which is for the logedon user). But in my case I want to append the path for all the users, HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Environment\ Path key (As far as I know this is the right key). I have modified your code to change this key instead. It does append the path, but it seems to fix the %SystemRoot% to a string instead of a variable, eg (in dos)<br><br>Before addation:<br><br>path=c:\winnt\system\;c:\winnt\<br><br>After addition of c:\foo<br>path=%SystemRoot%;%SystemRoot%\system;c:\foo<br><br>Do you have any suggestions?<br><br>Thanks,<br><br>Ross</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">18th April 2003 01:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Use WriteRegExpandStr instead of WriteRegStr and it should keep the variables.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">GGamer</span><br><span class="post-time small text-muted">18th April 2003 22:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks, works a treat!<br><br>Ross</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">scarletbow</span><br><span class="post-time small text-muted">3rd December 2003 18:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I am using Windows XP and when I uninstall everthing seems to work fine. When I check the path it looks ok, but when I try to type in commands that were accessible in my path I can't. Has anybody had this problem yet?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br><span class="post-time small text-muted">14th February 2007 12:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Lately i used this function:<br><a href="http://nsis.sourceforge.net/Path_Manipulation" target="_blank">http://nsis.sourceforge.net/Path_Manipulation</a><br><br>But i had to set timeout=1000 otherwise my explorer will crash badly<br>(tried several installations/deinstallations with it)<br></p><pre>
<code>
SendMessage ${HWND_BROADCAST} ${WM_WININICHANGE} 0 "STR:Environment" /TIMEOUT=5000 
<br>&gt;
</code>
</pre>HTH
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">15th February 2007 19:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If Explorer itself crashes, you probably have some rouge shell extension.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br>
      <span class="post-time small text-muted">18th February 2007 01:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">no - my system works fine. and the crash happend when opening START - Programs - &lt;subfolder&gt;, not anywhere else.<br>
      It exactly happend when i set timout=5000 and right after the (de-)installation (both concerned).<br>
      i can do vice versa many times without reboot...<br>
      BTW the system timeout here is set to 5000 instead windows default 20000 (all values in milli seconds).<br>
      <br>
      it was this line which crashes my explorer (explorer + task bar/desktop).<br>
      It was added to the script which works well.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">20th February 2007 20:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Fine, then it's not a rouge shell extension.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br>
      <span class="post-time small text-muted">21st February 2007 19:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">finally i will see when user is using the installer - but till<br>
      now no negative feedback (ok i build it in as an option). thx</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">didava</span><br>
      <span class="post-time small text-muted">12th July 2007 11:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">trojan &gt;&gt; RefreshEnv.exe</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">12th July 2007 17:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">False positive. Anyway, the SendMessage solution is simpler.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>