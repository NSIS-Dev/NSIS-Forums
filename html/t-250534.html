<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Locate crashes on C:\Recycled"><title>Locate crashes on C:\Recycled - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Locate crashes on C:\Recycled</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=250534">Locate crashes on C:\Recycled</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Shorin</span><br><span class="post-time small text-muted">6th July 2006 22:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Locate crashes on C:\Recycled</strong><br>I'm using the locate function (in FileFunc.nsh) to search windows drive (which is C:\ in this case) for a file. Whenever it gets to "C:\Recycled" it crashes the installer, with a Windows XP "0x00000005: Access Violation". I looked into it and apparently "C:\Recycled" is NOT A REAL DIRECTORY! It is actually a subdirectory (with a different name) under "C:\Recycler", which is hidden. I would prefer that Locate skip this folder entirely, but I don't see any way to do that without getting an advanced plugin (I cannot do that-don't ask).<br><br>This seems to me to be some sort of bug. I dunno why I couldn't find a post about this.<br><br>I'm looking for either a solution or ... a bugfix(?).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comperio</span><br><span class="post-time small text-muted">7th July 2006 06:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sorry for the long post, but I have found a few things that might be helpful here:<br><br>First, I did my own research (thanks to Google) and found something interesting about the "C:\recycled" folder. The best article I found on the topic was <a href="http://www.windowsitpro.com/Article/ArticleID/47677/47677.html" target="_blank">here</a>.<br>Basically, the folder "C:\Recycled" was the name of the recycle bin on Win9x computers. When upgrading to XP, the folder gets replaced by "C:\recycler" (which is the standard folder I've seen on most other XP boxes). Furthermore, the original "C:\recycled" folder may have it's attributes/permissions set in such a way that prevents access. So, my first suggestion would be to check the file attributes and security settings on your "C:\recycled" folder to see if perhaps you just don't have enought permissions or that perhaps the folder isn't read-only.<br><br>Next, I did some of my own testing that seems to support the above theory:<br>I created my own folder with no permissions and ran a search with the Locate plugin. Something a bit odd happened: I found that the LOCATE macro assigned a size ($R6) to the "permission-less" folder, even though according to the docs, folders are supposed to return a null value ("") for $R6. As soon as I gave permissions back to the folder, the macro once again worked as expected and returned a null value for the folder name. (This is what leads me to believe your issue is likely a permissions problem.)<br><br>So, bottom line here is that there appears to be a flaw in the logic in that the plugin is setting a non-null size variable when a folder has no permissions. (Unfortunately, I don't have any clever work-arounds at the moment. You might want to contact the author for help.)<br><br><b>Edit</b><br>Just a thought:<br>If you used the option "/L=FD" (as I did in my example), then you might be able to just check the size in your callback function and if it's zero, just continue on. (This is of course assuming that the file you intend to find not a 0 KB file.)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Instructor</span><br><span class="post-time small text-muted">7th July 2006 07:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><b>Comperio</b><br><a href="http://nsis.sourceforge.net/Locate" target="_blank">Locate function</a> and <a href="http://nsis.sourceforge.net/Locate_plugin" target="_blank">Locate plugin</a> are not the same.<br><br></p><blockquote>Something a bit odd happened: I found that the LOCATE macro assigned a size ($R6) to the "permission-less" folder, even though according to the docs, folders are supposed to return a null value ("") for $R6.</blockquote>In the locate <i>function</i> code for check folder or file used command [IfFileExists '...\*.*']. Because files inside doesn't exist "permission-less" folder detected as file. Locate <i>plugin</i> returns "" for "permission-less" folder.<br><br><b>Shorin</b> what parameters you use? As suggested Comperio: do you have all permissions to recycled bin folder?<br><br>P.S. and better show your code with callback function</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comperio</span><br><span class="post-time small text-muted">7th July 2006 14:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sorry, I probably used the wrong terms.<br><br>I was referring to the ${Locate} macro that is included as part of NSIS, not your stand-alone plugin. (I believe is also what Shorin was also referring to).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Shorin</span><br><span class="post-time small text-muted">7th July 2006 14:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Here is my call to the locate plugin:<br><br>${Locate} "C:\" "/M=rtsky.ini" "SetSuccess"<br><br>The "C:\" is usually supplied with the variable $9, and it has had this value during tests.<br><br>Also, regarding permissions to the "Recycled" folder (which definitely seems to be a 'virtual directory' in Windows XP), It shows that it's read only, but the checkbox for that is &lt;B&gt;tri-state&lt;/B&gt;. It is in its &lt;I&gt;partially selected&lt;/I&gt; state I think. I do not precisely what this means (or even if that state is called the &lt;I&gt;partially selected&lt;/I&gt; state). I have not been able to find out what this third state means. Perhaps it means "system".<br><br>Also I found something interesting about windows folder attributes just now:<br><br>From:<br><a href="http://support.microsoft.com/?id=326549" target="_blank">http://support.microsoft.com/?id=326549</a><br><br>Excerpt<br>Unlike the Read-only attribute for a file, the Read-only attribute for a folder is typically ignored by Windows, Windows components and accessories, and other programs. For example, you can delete, rename, and change a folder with the Read-only attribute by using Windows Explorer. The Read-only and System attributes is only used by Windows Explorer to determine whether the folder is a special folder, such as a system folder that has its view customized by Windows (for example, My Documents, Favorites, Fonts, Downloaded Program Files), or a folder that you customized by using the Customize tab of the folder's Properties dialog box. As a result, Windows Explorer does not allow you to view or change the Read-only or System attributes of folders. When a folder has the Read-Only attribute set it causes Explorer to &lt;B&gt;request the Desktop.ini of that folder&lt;/B&gt; to see if any special folder settings need to be set.<br><br>- however I do not see a Desktop.ini in C:\recycled . If anything, the function should be modified so that it does not access that folder, as it is a virtual folder (more like a shortcut).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">7th July 2006 16:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">only way to find desktop.ini is with attrib in a command prompt, its hidden in explorer</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Instructor</span><br><span class="post-time small text-muted">7th July 2006 16:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I can't reproduce the problem. Maybe you can pack this folder (without trash) and attach it.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Shorin</span><br><span class="post-time small text-muted">7th July 2006 17:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>more stuff</strong><br>This is strange. I have NO idea why it failed before. I did get success this past time I ran it. I dunno why this is happening. When it finds the file it actually crashes.<br>What's all this about (in the documentation) :<br><br>(from Locate's topic)<br>Function "Function"<br>; $R9 "path\name"<br>; $R8 "path"<br>; $R7 "name"<br>; $R6 "size" ($R6="" if directory, $R6="0" if file with /S=)<br><br>; $R0-$R5 are not used (save data in them).<br>; ...<br><br>Push $var ; &lt;B&gt;If $var="StopLocate" &lt;/B&gt;Then exit from function<br>FunctionEnd<br><br>I do believe &lt;B&gt;$var&lt;/B&gt; should be &lt;B&gt;$0&lt;/B&gt; like all the examples.<br><br>Ok... so it does work now. But having to push $0 onto the stack with a valie of "StopLocate" to end the function??... That's a somewhat strange way to do things... I think I'm going to investigate this source myself and see if I can put better error catching in this thing.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Shorin</span><br><span class="post-time small text-muted">7th July 2006 17:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think I got these html tags wrong somehow</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Shorin</span><br><span class="post-time small text-muted">7th July 2006 17:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Also, is it possible to make Locate stop before a search is done? I would like to give impatient users a chance to quit without manually terminating.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Instructor</span><br><span class="post-time small text-muted">7th July 2006 18:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>Also, is it possible to make Locate stop before a search is done? I would like to give impatient users a chance to quit without manually terminating.</blockquote>See in the docs "Example (Locate with banner - NxS plugin required):"</div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>