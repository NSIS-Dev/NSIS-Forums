<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Adding input field to modern..."><title>Adding input field to modern... - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Adding input field to modern...</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=213299">Adding input field to modern...</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Fireye</span><br><span class="post-time small text-muted">15th April 2005 18:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Adding input field to modern...</strong><br>How would I go about adding an input field to the Modern installer? I'd like to be able to add a text field into my simple script (Generated by Venis), which would allow me to set a variable. Would anyone care to tell me a good place to start?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comperio</span><br><span class="post-time small text-muted">15th April 2005 19:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The easiest way (in my opinion) would be to create a custom page using InstallOptions. (See the InstallOptions docs included with the NSIS install.)<br><br>If you were really brave, you might be able to hack the MUI ressource files. (Something I've not been brave enough to try, but it is another option.)<br><br>If you need this special input field in either the welcome or finish page, you can insert code into the PRE function of the welcome or finish page to modify the ioSpecial.ini file. (This info comes from the MUI documentation also included with the main NSIS install.)<br>:D</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">15th April 2005 19:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Try InstallOptions or, as my best suggestion, move-on to <a href="http://hmne.sourceforge.net/" target="_blank">HM Edit Nsis</a>.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Fireye</span><br><span class="post-time small text-muted">15th April 2005 20:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for the pointers, HMEdit's giving me an error right now... here's what I have:<br><br></p><pre>
<code><br>Function .onInit<br>  !insertmacro MUI_INSTALLOPTIONS_EXTRACT_AS "c:\wsus.ini" "wsus.ini"<br>FunctionEnd<br><br><br>Page custom WSUSPage<br><br>Function WSUSPage<br>!insertmacro MUI_HEADER_TEXT "WSUS Server..." "Stuff"<br>!insertmacro MUI_INSTALLOPTIONS_DISPLAY "wsus.ini"<br>!insertmacro MUI_INSTALLOPTIONS_READ $server "wsus.ini" "Field 1" "Text"<br>FunctionEnd<br></code>
</pre><br>
      <br>
      and it's giving me...<br>
      <pre>
<code><br>Function: "WSUSPage"<br>!insertmacro: MUI_HEADER_TEXT<br>!insertmacro: end of MUI_HEADER_TEXT<br>!insertmacro: MUI_INSTALLOPTIONS_DISPLAY<br>!insertmacro: end of MUI_INSTALLOPTIONS_DISPLAY<br>!insertmacro: MUI_INSTALLOPTIONS_READ<br>Usage: ReadINIStr $(user_var: output) ini_file section entry_name<br>Error in macro MUI_INSTALLOPTIONS_READ on macroline 5<br>Error in script "C:\Program Files\HMSoft\NIS Edit\wsus.nsi" on line 108 -- aborting creation process<br></code>
</pre><br>
      <br>
      Where my ini is:<br>
      <pre>
<code><br>; Ini file generated by the HM NIS Edit IO designer.<br>[Settings]<br>NumFields=2<br>Title=Setting our WSUS Server<br>NextButtonText=Next<br>BackButtonText=Previous<br><br>[Field 1]<br>Type=Text<br>State=Text<br>Left=54<br>Right=267<br>Top=28<br>Bottom=41<br><br>[Field 2]<br>Type=Label<br>Text=Server IP/Name<br>Left=0<br>Right=51<br>Top=30<br>Bottom=38<br></code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">15th April 2005 21:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Did you declare the $server variable with Var server?<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Fireye</span><br>
      <span class="post-time small text-muted">15th April 2005 21:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Nope, and i noticed that later on. I decided to go ahead and use $R0 as other people had suggested in another thread and a messagebox popup to make sure it's passing the data. I still can't get it to pass the data properly...<br>
      Here's what I have now:<br></p>
      <pre>
<code><br>Function .onInit<br>  !insertmacro MUI_INSTALLOPTIONS_EXTRACT_AS "c:\wsus.ini" "wsus.ini"<br>FunctionEnd<br><br>Page custom WSUSPage WSUSPageLeave<br><br>Function WSUSPage<br>!insertmacro MUI_HEADER_TEXT "WSUS Server..." "whee"<br>!insertmacro MUI_INSTALLOPTIONS_DISPLAY "wsus.ini"<br>  ReadINIStr $R0 "wsus.ini" "Field 1" "State"<br>FunctionEnd<br><br>Function WSUSPageLeave<br>  MessageBox MB_OK $R0<br>WriteRegStr HKEY_LOCAL_MACHINE "SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate" "WUServer" "http://$R0"<br>WriteRegStr HKEY_LOCAL_MACHINE "SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate" "WUStatusServer" "http://$R0"<br>FunctionEnd<br></code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comperio</span><br>
      <span class="post-time small text-muted">16th April 2005 21:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Seems like you'd want to read your InstallOptions ini file during the leave function instead of the show function. The MUI docs also state you can use MUI_INSTALLOPTIONS_READ from within a section (rather than a function).<br>
      <br>
      In my personal experience, I've found it better to read during the leave function becuase it allows me to verify what the user entered and call an ABORT command if necessary. On the other hand, if the users makes his/her selection via a hard-coded choice--such as radio button or drop-down menu--then either method should work.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">16th April 2005 23:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Data on the InstallOptions page is only written to the INI file after you leave the page Show function. Therefore, your INI file will remain unchanged until the Leave function is reached.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Vsleepy</span><br>
      <span class="post-time small text-muted">5th May 2005 04:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry for bumping this thread, but i had the same problem so i thought id post the solution.<br>
      <br>
      You need to init the plugins folder in the .oninit function.<br>
      If you do this then you can use the MUI_INSTALLOPTIONS_READ macro within a function.<br>
      <br>
      eg:<br>
      Function .onInit<br>
      InitPluginsDir<br>
      File /oname=$PLUGINSDIR\dcsdraft.ini MYINI.ini<br>
      !insertmacro MUI_INSTALLOPTIONS_EXTRACT "MYINI.ini"<br>
      FunctionEnd<br>
      <br>
      r,<br>
      vsleepy</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>