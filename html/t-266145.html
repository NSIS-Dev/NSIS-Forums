<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Problems creating shortcuts on Vista (32 bit) in &quot;current&quot; user context" />

  <title>Problems creating shortcuts on Vista (32 bit) in "current" user context - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Problems creating shortcuts on Vista (32 bit) in "current" user context</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=266145">Problems creating shortcuts on Vista (32 bit) in "current" user context</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TJK</span><br />
      <span class="post-time small text-muted">19th February 2007 16:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Problems creating shortcuts on Vista (32 bit) in "current" user context</strong><br />
      Using NSIS 2.22 on to create an installer that I then run on Windows Vista I create two shortcuts during installation, one in the "all" context and another in the "current" context as follows:<br />
      <br />
      SetShellVarContext all<br />
      CreateDirectory "$SMPROGRAMS\FolderName"<br />
      CreateShortCut "$SMPROGRAMS\FolderName\ShortcutName.lnk" "$INSTDIR\AppName.exe" "L=$(LanguageTLA)" "$INSTDIR\Console.exe" 0<br />
      SetShellVarContext current<br />
      CreateDirectory "$SMPROGRAMS\FolderName"<br />
      CreateShortCut "$SMPROGRAMS\FolderName\ShortcutName2.lnk" "$INSTDIR\AppName2.exe" "L=$(LanguageTLA)" "$INSTDIR\AppName2.exe" 0<br />
      <br />
      (Actually, for the "current" context shortcut I do use a language string for the shortcut name - but I have tried with a normal string as in the above extract and the symptoms are unchanged).<br />
      <br />
      Though the "FolderName" folder _is_ correctly created in both the "all" context (C:\ProgramData\Microsoft\Windows\Start Menu\Programs\FolderName) and the "current" context (C:\Users\testpc1\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\FolderName) _both_ shortcuts are created in the "all" folder.<br />
      <br />
      I have used MessageBox to show that $SMPROGRAMS is being correctly expanded dependent on the preceeding SetShellVarContext in both sections.<br />
      <br />
      Further, when I uninstall I do the following:<br />
      <br />
      SetShellVarContext all<br />
      Delete "$SMPROGRAMS\FolderName\ShortcutName.lnk"<br />
      RMDir "$SMPROGRAMS\FolderName"<br />
      <br />
      SetShellVarContext current<br />
      Delete "$SMPROGRAMS\FolderName\ShortcutName2.lnk"<br />
      RMDir "$SMPROGRAMS\FolderName"<br />
      <br />
      and I find that ShortcutName.lnk is deleted but that ShortcutName2.lnk is not deleted.<br />
      <br />
      Has anyone else seen this and if so did they find out why and how to avoid this behaviour as I can't figure it out I'd appreciate any advice.<br />
      <br />
      Thanks<br />
      <br />
      Tim</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">19th February 2007 18:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sounds like some kind of legacy redirection<br />
      <br />
      Try using "RequestExecutionLevel admin" (or highest)<br />
      <br />
      And if you are a standard user and elevate with UAC, you will be running as the admin and not "yourself" so you should not use "SetShellVarContext current" at all because it probably will not resolve to the correct folders for you</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
