<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Choose between two directories" />

  <title>Choose between two directories - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Choose between two directories</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=330703">Choose between two directories</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Aaskilde</span><br />
      <span class="post-time small text-muted">18th May 2011 13:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Choose between two directories</strong><br />
      Hi,<br />
      <br />
      I have been creating a installer for my firm, it have been a couple of months since i have been working on it, and now they have asked my to make some improvements to it.<br />
      <br />
      At the moment the installer chooses it's install patch by the registry and it works perfectly, but some of the users there is trying to install do not have the patch in the registry, and therefore i have been asked to make it so that they have two options, install by default(by the patch in the registry) or by manually selecting the patch.<br />
      <br />
      Is this something any of you can assist me with?<br />
      <br />
      Best Regards<br />
      Aaskilde</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">18th May 2011 14:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Create a custom page with nsDialogs.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Aaskilde</span><br />
      <span class="post-time small text-muted">24th May 2011 10:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hey Stu,<br />
      <br />
      I have been trying to get an idea of how i need to write the code for creating what i have been asking about. But i can't get it to work.<br />
      <br />
      I have been asked to edit an existing installer i have created, it takes a path from the registry database and install the files, but however some users who is in need of this installer have move the folders around and the path in the registry no longer works. But we do not know which users that have moved the folders and then we need two different path they can choose, the one should be default and locked maybe even just a click box, and then a way to select a folder manually to install the files.<br />
      <br />
      Is they any of you there can help me get this working, i can't get the understanding of the code to get it going, so i really could use some help.<br />
      <br />
      Aaskilde</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">24th May 2011 10:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you just want to select a single directory, why not add a directory page? You can skip the directory page by calling Abort in its pre function if the registry value you read points to a valid directory.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Aaskilde</span><br />
      <span class="post-time small text-muted">31st May 2011 14:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hey Stu,<br />
      <br />
      What you say sounds perfect, if the value in the registry is valid the installer should continue, but if not you should could point at the path manually, that is what you want me to make right?<br />
      <br />
      But i have not been using NSIS code that much and i really cant see how the code should be written.<br />
      <br />
      This is what i have for my direction patch by the registry database:<br />
      <br />
      Function InstallDirectory<br />
      !insertmacro MUI_HEADER_TEXT "Ready to install the program" "Below is the location where Neo.Dashboard will be installed"<br />
      nsDialogs::Create 1018<br />
      Pop $0<br />
      <br />
      ReadRegStr $0 HKLM "SOFTWARE\Lotus\Domino\1" "DataPath"<br />
      <br />
      <br />
      ${NSD_CreateLabel} 10u 0 100% 140u "Installing Neo.Dashboard 4.3a to:$\r$\n$\r$\n$0\Domino\html\$\r$\n$0\ \<br />
      $\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\n$\r$\n$\r$\nClick install to begin the installation.$\n$\r$\n$\rIf you want to review or change the installation, click Back.$\r$\nClick Cancel to exit the wizard."<br />
      Pop $0<br />
      <br />
      nsDialogs::Show<br />
      <br />
      FunctionEnd<br />
      <br />
      How should i start writing the code in the way that you tell me?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">31st May 2011 15:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You don't need to write a custom page for this. Just add a standard DIRECTORY page. See the MUI2 readme for details:<br />
      <a href="http://nsis.sourceforge.net/Docs/Modern%20UI%202/Readme.html" target="_blank">http://nsis.sourceforge.net/Docs/Mod...02/Readme.html</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Aaskilde</span><br />
      <span class="post-time small text-muted">6th June 2011 13:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi MSG,<br />
      <br />
      Okay i can see what you mean i have not used the directory page only my custom.<br />
      <br />
      So now i have got my custom directory page and the standard directory page.<br />
      <br />
      But let's say i need my custom directory page to be shown first and if the path in that is not found by the directory it should jump to the standard directory page so you manually can select where to install the files.<br />
      <br />
      Is that something i can write in my custom directory page shown here?<br />
      ____________________________________________________________________<br />
      Function InstallDirectory<br />
      !insertmacro MUI_HEADER_TEXT "Ready to install the program" "Below is the location where Neo.Dashboard will be installed"<br />
      nsDialogs::Create 1018<br />
      Pop $0<br />
      <br />
      ReadRegStr $0 HKLM "SOFTWARE\Lotus\Domino\1" "DataPath"<br />
      <br />
      <br />
      ${NSD_CreateLabel} 10u 0 100% 140u "Installing Neo.Dashboard 4.3 to:$\r$\n$\r$\n$0\Domino\html\$\r$\n$0\ \<br />
      $\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\n$\r$\n$\r$\nClick install to begin the installation.$\n$\r$\n$\rIf you want to review or change the installation, click Back.$\r$\nClick Cancel to exit the wizard."<br />
      Pop $0<br />
      <br />
      nsDialogs::Show<br />
      <br />
      FunctionEnd<br />
      ___________________________________________________________________</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">7th June 2011 09:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Does that mean you <i>don't</i> want to show the custom page if the path is invalid? To jump over the directory page (if the path <b>is</b> valid) just add a PRE custom function and call Abort in it. For example:</p>
      <pre>
<code>!define MUI_PAGE_CUSTOMFUNCTION_PRE DirectoryPre<br />!insertmacro MUI_PAGE_DIRECTORY<br /><br />Function DirectoryPre<br />  ${If} ${FileExists} $INSTDIR\*.*<br />    Abort<br />  ${EndIf}<br />FunctionEnd</code>
</pre>I have used $INSTDIR but use whatever Var you have used. You don't need to use $0 for your ReadRegStr; you can read into $INSTDIR. In fact, that is what InstallDirRegKey is for.<br />
      <br />
      Stu
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
