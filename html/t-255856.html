<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="How to pull all lines of a text file into a drop down" />

  <title>How to pull all lines of a text file into a drop down - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">How to pull all lines of a text file into a drop down</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=255856">How to pull all lines of a text file into a drop down</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">GarBear</span><br />
      <span class="post-time small text-muted">20th September 2006 16:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>How to pull all lines of a text file into a drop down</strong><br />
      <b>How to pull lines of text into a dropdown and select that in an NSIS install?</b><br />
      <br />
      I am building an application installation that needs to pull a list of SQL Servers from the network. I have figured out how to do it with a vb script but I am now looking for a way to take the text file created by my VB script that lists the servers on their network.<br />
      <br />
      What I have done so far...<br />
      <br /></p>

      <ul>
        <li>Created a INI script file called DBConnection.ini</li>

        <li>Created a text file using my VBS(WSH Visual Basic script)</li>

        <li>Created a demo install that pulls in only one database</li>
      </ul><br />
      // START DBConnection_Script.nsi<br />
      <br />
      !define VERSIONNUMBER "version1.0.0.0"<br />
      !define APPNAME "Choose Database"<br />
      !define APPNAMEANDVERSION "Database Connection"<br />
      Name "DB Config Test"<br />
      OutFile "Database_Setup.exe"<br />
      InstallDir "$TEMP\BLAH"<br />
      ShowInstDetails show<br />
      Var List<br />
      <br />
      !include "XPUI.nsh"<br />
      <br />
      Function .oninit<br />
      !insertmacro XPUI_INSTALLOPTIONS_EXTRACT_AS "DBConnection.ini" "DBConnection.ini"<br />
      FileOpen $4 "SVRList.txt" r<br />
      FileSeek $4 0 ; we want to start reading at the 1000th byte<br />
      FileRead $4 $1 ; we read until the end of line (including carriage return and new line) and save it to $1<br />
      FileRead $4 $2 30 ; read 30 characters from the next line<br />
      StrCpy $List $2 ; add line two to the list variable<br />
      FileClose $4 ; and close the file<br />
      FunctionEnd<br />
      <br />
      ; XPUI Settings<br />
      !define XPUI_ABORTWARNING<br />
      <br />
      ; Pages<br />
      !insertmacro XPUI_PAGE_WELCOME<br />
      Page custom "DB_Connection" "WriteDBReg"<br />
      ;!insertmacro XPUI_PAGE_INSTFILES<br />
      ;!insertmacro XPUI_PAGE_FINISH<br />
      !insertmacro XPUI_LANGUAGE "English"<br />
      <br />
      Section "DatabaseUpdate" SEC01<br />
      SectionEnd<br />
      <br />
      <br />
      Function DB_Connection<br />
      <br />
      !insertmacro XPUI_INSTALLOPTIONS_EXTRACT "DBConnection.ini"<br />
      !insertmacro XPUI_INSTALLOPTIONS_WRITE "DBConnection.ini" "Field 6" "ListItems" "$List"<br />
      !insertmacro XPUI_INSTALLOPTIONS_DISPLAY "DBConnection.ini"<br />
      <br />
      FunctionEnd<br />
      <br />
      Function WriteDBReg<br />
      !insertmacro XPUI_INSTALLOPTIONS_READ $0 "DBConnection.ini" "Field 6" "ListItems"<br />
      StrCpy $List "$0"<br />
      WriteRegStr HKEY_LOCAL_MACHINE "Software\Application\General" "ServerList" "$List"<br />
      FunctionEnd<br />
      <br />
      Section -Post<br />
      SectionEnd<br />
      // END DBConnection_Script.nsi<br />
      <br />
      // START DBConnection.ini script<br />
      [Settings]<br />
      NumFields=10<br />
      <br />
      [Field 1]<br />
      Type=Label<br />
      Text=Database Connection:<br />
      Left=5<br />
      Right=193<br />
      Top=3<br />
      Bottom=11<br />
      <br />
      [Field 2]<br />
      Type=Label<br />
      Text=Please enter the server name where you have installed Microsoft SQL Server 2005.<br />
      Left=9<br />
      Right=248<br />
      Top=22<br />
      Bottom=41<br />
      <br />
      [Field 3]<br />
      Type=Groupbox<br />
      Text=SQL 2005 Connection Information<br />
      Left=2<br />
      Right=250<br />
      Top=41<br />
      Bottom=160<br />
      <br />
      [Field 4]<br />
      Type=Checkbox<br />
      Text= Use Microsoft Windows Domain/Active Directory authentication.<br />
      Left=21<br />
      Right=239<br />
      Top=60<br />
      Bottom=70<br />
      <br />
      [Field 5]<br />
      Type=Label<br />
      Text=Server(\\Instance):<br />
      Left=10<br />
      Right=69<br />
      Top=78<br />
      Bottom=86<br />
      <br />
      [Field 6]<br />
      Type=Combobox<br />
      Text=Combobox<br />
      ListItems=<br />
      Left=73<br />
      Right=240<br />
      Top=76<br />
      Bottom=89<br />
      <br />
      [Field 7]<br />
      Type=Label<br />
      Text=Password:<br />
      Left=33<br />
      Right=66<br />
      Top=99<br />
      Bottom=107<br />
      <br />
      [Field 8]<br />
      Type=Password<br />
      Left=73<br />
      Right=240<br />
      Top=97<br />
      Bottom=110<br />
      <br />
      [Field 9]<br />
      Type=Label<br />
      Text=Database Name:<br />
      Left=12<br />
      Right=66<br />
      Top=121<br />
      Bottom=129<br />
      <br />
      [Field 10]<br />
      Type=Droplist<br />
      Text=Droplist<br />
      ListItems=<br />
      Left=73<br />
      Right=240<br />
      Top=118<br />
      Bottom=155<br />
      <br />
      // END DBConnection.ini script<br />
      <br />
      // START SVRList.txt<br />
      (Local)<br />
      ServerName1<br />
      ServerName2<br />
      ServerName3<br />
      ServerName4<br />
      // END SVRList.txt
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">20th September 2006 17:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Do you want to read the selected list box item?<br />
      It's stored in the State field attribute.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">GarBear</span><br />
      <span class="post-time small text-muted">20th September 2006 17:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Thanks for taking the time to help...</strong><br />
      Thanks for taking the time to respond. The code above opens the sqllist.txt file(which normally would have been created by the vb script) and then looks at line two, sets the list var to what was on line two and inserts the field into the dropdown - which works;however, what I am hoping to glean from the group is how to concatinate all the lines into the dropdown and allow the user to select only one, then run a check to connect and populate another list file of all the databases on that server.<br />
      <br />
      Also: I'll provide all my vb scripts later in a zip file for everyone when I get everything working. For now I am just trying to keep things as simple as possible.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">20th September 2006 17:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Loop through the lines in the file, trimming each line and concatenate each line with StrCpy...<br />
      <br />
      StrCpy $List $List|$R0<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
