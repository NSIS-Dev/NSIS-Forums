<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Problem with search &amp; replace and latest version of NSIS" />

  <title>Problem with search &amp; replace and latest version of NSIS - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.2/readable/bootstrap.min.css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Problem with search &amp; replace and latest version of NSIS</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=125728">Problem with search &amp; replace and latest version of NSIS</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">20th February 2003 08:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Problem with search &amp; replace and latest version of NSIS</strong><br />
      &nbsp; Dear folks,<br />
      <br />
      I have a problem with the search &amp; replace function written by KiCHiK<br />
      <a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=73&amp;instances=0,44" target="_blank">http://nsis.sourceforge.net/archive/...instances=0,44</a><br />
      <br />
      I took this function into my script and compiled it with the old version of NSIS (sorry old means 2.0b0). Means I had to search in several files and replace several lines. So I copied this function, renamed it and everything went fine.<br />
      <br />
      NOW, I am working with CVS version (2.0b2) and everything went wrong. Calling this function two times: one time to replace <b>four lines in FILE A</b> and replace <b>two lines in FILE B</b>. <u>Depending on which FILE is called first, the other one is getting 0KB size.</u><br />
      <br />
      So calling the function for FILE A first, makes FILE B output 0KB and vice versa.<br />
      <br />
      Thing this is not normal?<br />
      Is anybody out ther to verify this behaviour or telling me what I am doing wrong? Perhaps I can place the code somewhere...<br />
      <br />
      I am using other functions too (e.g. PATH manipulation, service check and so on). Could this be a problem?<br />
      <br />
      Regards<br />
      Mo</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">20th February 2003 09:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Here are the code lines....</strong><br />
      &nbsp;</p>
      <pre>
<font size="1"><code>
ReplaceAPParams
<br />FileOpen$0 "$INSTDIR\\Path\\to\\file_A.conf.tmp" "r"
<br />&gt;GetTempFileName $R0
<br />FileOpen$1 $R0 "w"
<br />&gt;loop:
<br />  FileRead $0 $2
<br />   IfErrors done
<br />   StrCmp$2 "++ServerRoot++$\\r$\\n" 0 +3
<br />      FileWrite$1 "ServerRoot $\\"$INSTDIRApache2$"$\\r$\\n"
<br />      Goto loop
<br />   StrCmp$2 "++DocumentRoot++$\\r$\\n" 0 +3
<br />      FileWrite$1 "DocumentRoot $\\"$INSTDIRApache2htdocs$"$\\r$\\n"
<br />      Goto loop
<br />   StrCmp$2 "++php_value include_path++$\\r$\\n" 0 +3
<br />      FileWrite$1 "php_value include_path = $\\".;$INSTDIRApache2htdocsphp$"$\\r$\\n"
<br />      Goto loop
<br />   StrCmp$2 "++mod_gzip_temp_dir++$\\r$\\n" 0 +3
<br />      FileWrite$1 "mod_gzip_temp_dir = $\\"$INSTDIRApache2tmp$"$\\r$\\n"
<br />      Goto loop
<br />   FileWrite$1 $2
<br />      Goto loop
<br /><br />done:
<br />  FileClose $0
<br />   FileClose$1
<br />   Delete "$INSTDIR\\Path\\to\\file_A.conf.tmp"
<br />  Rename $R0 "$INSTDIR\\Path\\to\\file_A.conf"
<br />&gt;FunctionEnd 
<br />&gt;
</code>
</font>
</pre><br />
      <br />
      This really works fine on this file_A. I call this function in the corresponding section with:<br />
      <pre>
<font size="1"><code>
Call ReplaceAPParams 
<br />&gt;
</code>
</font>
</pre><br />
      <br />
      What it does: Replacing the 4 lines beginning with:<br />
      ++ServerRoot++<br />
      ++DocumentRoot++<br />
      ++php_value include_path++<br />
      ++mod_gzip_temp_dir++<br />
      <br />
      AND: it really does what it should<br />
      <br />
      BUT: After this function I call another (ReplacePHPParams), and it's really the same except it's another file to be opened and some other values to be replaced.<br />
      <br />
      I call this (other) function in ITS corresponding section also with<br />
      <br />
      <pre>
<font size="1"><code>
Call ReplacePHPParams 
<br />&gt;
</code>
</font>
</pre><br />
      <br />
      The output when the installer is called:<br />
      file_A.conf 39KB<br />
      file_B.conf 0KB<br />
      <br />
      Turning this around (calling ReplacePHPParams first) makes it looking like that:<br />
      file_A.conf 0KB<br />
      file_B.conf 39KB<br />
      <br />
      (Both files have 39KB so the size should only be a indicator that it is written or not.)<br />
      <br />
      Thx for help<br />
      Mo
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">20th February 2003 13:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try b1, try the latest CVS version and if nither works attach the full script.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">20th February 2003 14:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">KiCHiK -<br />
      (Thx for ya offer:-)<br />
      <br />
      I did it already. I tried all of them. BUT my old 2.0b0 strikes after installation of a later release.... It tells me something like: Error: Can't find "MUI.nsh"<br />
      <br />
      So here is the script! (attached)<br />
      Eventually it is rubbish in some parts, that's because I extracted it from the big one....<br />
      (some messy parts: SplashScreen, etc)<br />
      <br />
      Thx in advance<br />
      Mo</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">20th February 2003 15:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I think the "IfErrors done" line does this. The error flag must have been set somewhere along the way and when it got to the function it just skipped it all because it thought there is an error. I have added ClearErrors at the top of my script in the archive and so should you for your script.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">20th February 2003 16:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry, could you be a bit more specific?<br />
      :-)<br />
      -------[edit]<br />
      commenting this line makes my system hang @installation time ---------</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">20th February 2003 16:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Add ClearErrors at the top of each function that replaces lines in your script and uses my code.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">20th February 2003 16:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">got it, sorry my fault<br />
      <br />
      COOL<br />
      Thx for debugging!<br />
      <br />
      <br />
      ------ [edit]<br />
      <br />
      It's working again, yiiieeeepppiiii<br />
      Now let's go on working<br />
      <br />
      Luv ya guys ;-)<br />
      <br />
      ----------------</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>