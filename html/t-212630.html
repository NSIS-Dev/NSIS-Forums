<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Linux makensis generated a bad Windows installer"><title>Linux makensis generated a bad Windows installer - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Linux makensis generated a bad Windows installer</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=212630">Linux makensis generated a bad Windows installer</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Tian_GCfilms</span><br><span class="post-time small text-muted">8th April 2005 20:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Linux makensis generated a bad Windows installer</strong><br>Hello,<br><br>I am project manager of <a href="https://gna.org/projects/gcfilms/" target="_blank">GCfilms</a>. This application is written in Gtk2-Perl and can be used to manage a movie collection.<br><br>We created a Windows installer using NSIS and it works perfectly when generated from a Windows system.<br><br>We managed to compile a Linux version of makensis that seems to work well also. But when generating the installer from a Linux system, it has a weird behaviour.<br><br>Installation began normally with language selection. Then we added a Perl detection to check if this dependancy is installed. This also works fine. But then the installer stops without error message (even when launched from an MS-DOS console).<br><br>Of course, we used the same .nsi file for both generations. It can be seen in our CVS repository:<br><br><a href="http://cvs.gna.org/viewcvs/gcfilms/gcfilms/packages/win32/gcfilms.nsi" target="_blank">http://cvs.gna.org/viewcvs/gcfilms/g...32/gcfilms.nsi</a><br><br>I also attach it to this thread.<br><br>Did someone already experience this kind of problem? Is there a way to have more information about the crash reasons?<br><br>Any help would be really appreciated. As we all use GNU/Linux system, it would be great if we could generate the Windows installer from this system.<br><br>Thanks a lot,<br><br>Tian.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Tian_GCfilms</span><br><span class="post-time small text-muted">8th April 2005 21:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hum I think I got it. I commented 2 lines and everything seems to be OK now. They are:<br><br>;!define MUI_ICON "${NSISDIR}/Contrib/Graphics/Icons/orange-install.ico"<br>;!define MUI_UNICON "${NSISDIR}/Contrib/Graphics/Icons/orange-uninstall.ico"<br><br>(using / or \ in paths didn't change anything)<br><br>Really strange.<br><br>Does someone have any idea about that as it could in fact hide a more important problem?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">9th April 2005 11:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I tried compiling your installer on Linux with NSIS 2.06 and everything worked fine. I have only tested it up until the components page, as it stopped before the main dialog was even shown in your test.<br><br>I had to modify the script a bit so it'll compile. I removed File instructions, changed the license path and fixed the case of the WinMessages.nsh include. The modified script is attached.<br><br>Which NSIS version did you use to compile the script? Did you use the precompiled exeheads or did you compile them using a cross compiler? If you compile the modified script, does it work well? If it doesn't, can you attach the installer itself?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Tian_GCfilms</span><br><span class="post-time small text-muted">9th April 2005 17:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks a lot for your help.<br></p><blockquote>I had to modify the script a bit so it'll compile. I removed File instructions, changed the license path and fixed the case of the WinMessages.nsh include. The modified script is attached.</blockquote>Sorry about the WinMessages.nsh stuff. I changed it before but it was not in the version I attached.<br><br>I don't have a license.txt file in my NSIS installation dir. So I used the same license file as in original version.<br><br>The problem is still the same. I attach the generated installer so you can test it if you want.<br><blockquote>Which NSIS version did you use to compile the script? Did you use the precompiled exeheads or did you compile them using a cross compiler?</blockquote>I used 2.06 version. I generated it from sources and using mingw32 as cross compiler.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">9th April 2005 17:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If you've used the cross compiler, that's probably the problem. I'll try to debug it a bit. In the meanwhile, you can compile it with the precompiled exeheads. It's better anyway since VC6 produces way smaller executables than MinGW. Don't foget to extract the original source archive again so you'll get the header files back.<br><br>I might also need the compiled makensis that produced this installer, so please save a copy of it.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Tian_GCfilms</span><br><span class="post-time small text-muted">9th April 2005 18:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I tried to generate again using this command<br><br>make USE_PRECOMPILED_EXEHEADS=1<br><br>And now it works perfectly (even with the icons lines). So it seems to be because of cross compiler as you expected.<br><br>I still have everything from previous installation. So just let me know if you something.<br><br>Thanks again for time you spent helping us.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">4th August 2005 20:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><b>Short version:</b><br><br>There's a bug in the build process, when MinGW is used.<br><br><b>Long version:</b><br><br>After playing around with the installer a bit more, I found that by removing a very certain number of dialog items, I can make the installer work again. It has the same effect of using the smaller icon, like you've mentioned in your first post. It reduces the resource section (.rsrc) size. The problem with the size is that the .ndata section follows the .rsrc section. .rsrc should precede the .ndata so editing the resources won't move .ndata. The location of .ndata is used in code which writes to it. When the .rsrc section grew over .ndata, this code overwrote the resources with other data. By reducing the .rsrc section size, with the smaller icon or less dialog items, the .ndata section was returned to its original place, given to it at linkage time.<br><br>I don't know why .ndata followed .rsrc instead of preceding it in your compiled version. There's a linker script that's supposed to set the correct order of the sections. Actually, I've just tried compiling on my own using MinGW, and it put the .ndata section last too. I'll have to dig into it a bit more to find out how to get it to order the sections correctly.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>