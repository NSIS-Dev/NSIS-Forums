<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Use !define conditionally" />

  <title>Use !define conditionally - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Use !define conditionally</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=315638">Use !define conditionally</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">HSorgYves</span><br />
      <span class="post-time small text-muted">23rd December 2009 22:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Use !define conditionally</strong><br />
      &nbsp; I want to use the !define UMUI_ALTERNATIVESTARTMENUPAGE_SETSHELLVARCONTEXT statement only if the current user has administrator priviledges. How is this possible?<br />
      <br />
      Thanks,<br />
      Yves</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">redxii</span><br />
      <span class="post-time small text-muted">24th December 2009 01:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can't set SetShellVarContext based on what privileges are available?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">HSorgYves</span><br />
      <span class="post-time small text-muted">24th December 2009 10:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I can and I do, but that only influences some directory variables not the page displayed by UMUI...<br />
      <br />
      I am even using<br /></p>
      <pre>
!define UMUI_DEFAULT_SHELLVARCONTEXT $UMUI_DEFAULT_SHELLVARCONTEXT 
<br />&gt;

</pre>and then setting $UMUI_DEFAULT_SHELLVARCONTEXT conditionally, but this method doesn't work for<br />
      <pre>
<code>
define UMUI_ALTERNATIVESTARTMENUPAGE_SETSHELLVARCONTEXT 
<br />&gt;
</code>
</pre>as it has no argument.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">24th December 2009 12:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Most probably you'll have to edit the UMUI header file.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">HSorgYves</span><br />
      <span class="post-time small text-muted">24th December 2009 13:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That's what I wanted to avoid...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SuperPat</span><br />
      <span class="post-time small text-muted">24th December 2009 23:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I would try to implement this feature soon.<br />
      The method that I will use is to try to create a file in the Program Files to determine if the application has administrator rights and if this is not the case, disable radio buttons on the start menu page.<br />
      Unless you have a better method for determining the level?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">HSorgYves</span><br />
      <span class="post-time small text-muted">24th December 2009 23:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am currently using:<br /></p>
      <pre>
<code>
xtInfoPlugin::IsAdministrator
<br />Pop$0
<br />StrCmp$0 "true" 
</code>
</pre>Something like:<br />
      <pre>
<code>
false 
<br />&gt;
</code>
</pre>would thus be enough. You could make such an argument optional and thus not break backward compatibility.<br />
      <br />
      Best Regards,<br />
      Yves
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">redxii</span><br />
      <span class="post-time small text-muted">25th December 2009 00:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by SuperPat</i><br />
        <b>Unless you have a better method for determining the level?</b>
      </blockquote>UserInfo::GetAccountType from UserInfo.dll already included in NSIS. <a href="http://nsis.sourceforge.net/IsUserAdmin" target="_blank">http://nsis.sourceforge.net/IsUserAdmin</a>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SuperPat</span><br />
      <span class="post-time small text-muted">25th December 2009 00:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by redxii</i><br />
        <b>UserInfo::GetAccountType from UserInfo.dll already included in NSIS. <a href="http://nsis.sourceforge.net/IsUserAdmin" target="_blank">http://nsis.sourceforge.net/IsUserAdmin</a></b>
      </blockquote>I think this function does not return the right answer on a windows Vista/7 with a administrateur account if the RequestExecutionLevel is set as user?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">redxii</span><br />
      <span class="post-time small text-muted">25th December 2009 01:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://nsis.sourceforge.net/Examples/UserInfo/UserInfo.nsi" target="_blank">http://nsis.sourceforge.net/Examples...o/UserInfo.nsi</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">redxii</span><br />
      <span class="post-time small text-muted">25th December 2009 07:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, even if the account is an Administrator in UAC approval mode, if they don't elevate the setup they can't create shortcuts for all users anyway, only for themselves and it's as if they are non-admins.<br />
      <br />
      UserInfo returns the right answer for what privileges the installer has. You don't want to use GetOriginalAccountType to see that they are really an administrator, the installer isn't running elevated, and assume that the context should be set to 'all'.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">HSorgYves</span><br />
      <span class="post-time small text-muted">25th December 2009 10:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have tested this on Vista. If "RequestExecutionLevel user" is set, UserInfo::GetAccountType will not return Admin, but the user has no write acces to Program Files for example, so the answer is correct as redxii says.<br />
      <br />
      Best Regards,<br />
      Yves</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SuperPat</span><br />
      <span class="post-time small text-muted">25th December 2009 11:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Very good</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">HSorgYves</span><br />
      <span class="post-time small text-muted">25th December 2009 17:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Problem solved in today's release. Thanks for your quick development!<br />
      <br />
      Best Regards,<br />
      Yves</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>