<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="ExecWait issue" />

  <title>ExecWait issue - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">ExecWait issue</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=323111">ExecWait issue</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pravin</span><br />
      <span class="post-time small text-muted">13th October 2010 12:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>ExecWait issue</strong><br />
      &nbsp; Im new to NSIS and following is my issue.<br />
      <br />
      Im having two different path directory for client and server so im using custom variables to save the path instead of $INSTDIR.<br />
      <br />
      while installation im checking whether any previous version exists and if exists im calling uninstaller to uninstall using ExecWait as follows.<br />
      <br />
      ExecWait '$G4 _?=$INSTDIR'<br />
      <br />
      <br />
      Steps :<br />
      -------<br />
      <br />
      1.exe executed.<br />
      2.prev version found.<br />
      3.uninstaller is triggered.<br />
      4.installer is disabled and uninstaller is active.<br />
      5.i shifted my focus to installer and clicked "NEXT" . Result : NO change in the installer since it is disabled.<br />
      6.i proceeded with uninstallation.<br />
      7.After Uninstallation , Installer becomes active.<br />
      8.I found installer has skipped one page since i clicked "NEXT" when it was disabled.<br />
      <br />
      <br />
      <br />
      why does the page is being skipped? How to avoid it??<br />
      <br />
      I tried searching for this issue in forum but couldnt find. if the issue is addressed already let me know the link. else please help me to find a solution. Thanks in advance.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Yathosho</span><br />
      <span class="post-time small text-muted">13th October 2010 13:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">not sure <i>why</i> this is happening, but you could <a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.14.4" target="_blank">disable</a> the next button for the time the uninstaller is active.<br />
      <br />
      you can actually copy&amp;paste the first two lines of given example.. (next=1, cancel=2, back=3)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pravin</span><br />
      <span class="post-time small text-muted">13th October 2010 14:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the response. im not able to understand which example your are talking about. could u give me the sample code to disable the next button. thanks once again.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vankaa</span><br />
      <span class="post-time small text-muted">13th October 2010 15:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Click his "disable" and you can read what you need.<br />
      <br />
      GetDlgItem $0 $HWNDPARENT 1 &lt;---- 1-next<br />
      EnableWindow $0 0</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pravin</span><br />
      <span class="post-time small text-muted">13th October 2010 18:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">thanks Yathosho and Vankaa for the respose.<br />
      <br />
      The code disabled NEXT button. but still if i click on it, after uninstallation once it enters back to the installation i find it skips pages according to total number of clicks on NEXT (disabled) button.<br />
      <br />
      some one do me a favour. using MUI create a sample nsi in which u call another installer and try clicking on the NEXT button when the installer is not in active mode and let me know whether u too face the same issue. Thanks in advance</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">13th October 2010 18:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Please submit a bug report. For now, try using a Banner (see NSIS\Docs). You could also try putting some Sleep statements after as well.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Netsurfer24</span><br />
      <span class="post-time small text-muted">14th October 2010 13:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        Please submit a bug report.
      </blockquote>I don't think that it is a bug. I guess it has more to do with the fact that the mouse clicks are being "queued" during the ExecWait. And as the button is re-enabled afterwards the previous clicks are now being processed.<br />
      <br />

      <blockquote>
        <small>Originally posted by Pravin</small><br />
        The code disabled NEXT button. but still if i click on it, after uninstallation once it enters back to the installation i find it skips pages according to total number of clicks on NEXT (disabled) button.
      </blockquote>Yes, see above for the possible reason.<br />
      <br />
      I am doing quite the same (uninstall previous version during install) as you do. IMO you have a fault in your concept. Calling the uninstaller directly from one of the installer pages is generally a bad idea. What if the user cancel the installation afterwards?<br />
      <br />
      I added a separate topmost hidden section from where I call the uninstaller (if needed). You can control this e.g. by using<br />
      <pre>
<code>SectionSetFlags${&lt;name_of_your_section&gt;} ${SF_SELECTED} 
</code>
</pre>depending on a variable's value or whatever.<br />
      <br />
      <br />
      Good luck &amp; success<br />
      <br />
      Gunther
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">14th October 2010 13:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Netsurfer24</small><br />
        I don't think that it is a bug. I guess it has more to do with the fact that the mouse clicks are being "queued" during the ExecWait. And as the button is re-enabled afterwards the previous clicks are now being processed.
      </blockquote>Yes that much is pretty obvious. I'd still regard this as a bug though because it is unexpected/undocumented behaviour.<br />
      <br />
      Stu
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Netsurfer24</span><br />
      <span class="post-time small text-muted">14th October 2010 13:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        I'd still regard this as a bug though because it is unexpected/undocumented behaviour.
      </blockquote>Sorry, but I disagree. This is pretty much the normal Windows behaviour. It has nothing to do with NSIS.<br />
      If you want to change it you have to "manipulate" the mouse handling of Windows. But as I suggested, IMHO there is no need for this.<br />
      <br />
      Gunther
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">14th October 2010 13:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This is not default Windows behaviour. I'm not sure how you got that idea. It will occur if you block the message thread for a window. In NSIS's case it still processes WM_PAINT but does not process anything else. It could be modified to process other window messages (thus eat them up) but not take any action.<br />
      <br />
      Edit: However I definitely agree that use of ExecWait outside a section for long processes (and especially uninstallers) is definitely not a good idea.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pravin</span><br />
      <span class="post-time small text-muted">14th October 2010 14:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Afro and Netsurfer for your suggestion. Thanks once again Afro for your active participation in the forum and for immediate response on the issues.<br />
      <br />
      1. Just to confirm it is a BUG i asked others to check whether they too face the same issue<br />
      Do you face the same issue?? If yes , tell me the right procedure to report a BUG.<br />
      <br />
      2. As discussed above that usage of ExecWait outside long processes is not good idea.<br />
      I'll make a note of it.<br />
      <br />
      I have a situation where user need to uninstall the previous version before proceeding. I'll try to edit the current scenario.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pravin</span><br />
      <span class="post-time small text-muted">14th October 2010 14:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Netsurfer i'll try to make utilize of the concept and the code given by you.Thanks.<br />
      <br /></p>

      <blockquote>
        SectionSetFlags ${&lt;name_of_your_section&gt;} ${SF_SELECTED}
      </blockquote>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Netsurfer24</span><br />
      <span class="post-time small text-muted">14th October 2010 14:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Stu,<br /></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        This is not default Windows behaviour. I'm not sure how you got that idea. It will occur if you block the message thread for a window. In NSIS's case it still processes WM_PAINT but does not process anything else. It could be modified to process other window messages (thus eat them up) but not take any action.
      </blockquote>Hmmm ..., I thought it is the WM_NOTIFY Message which is responsible for the mouse clicks and as it is not disabled cause you disable a button in window ...<br />
      But I am pretty shure that you have a much deeper knowledge of these things than I have - so if you it is a bug then it is bug.<br />
      <br />
      <br />

      <blockquote>
        <small>Originally posted by Pravin</small><br />
        I have a situation where user need to uninstall the previous version before proceeding. I'll try to edit the current scenario.
      </blockquote>And the user may cancel/ abort the installation after this? What happened then - the user ends up with no installation at all? The previous one already uninstalled and the new one not installed?<br />
      <br />
      At another place in my installer I solved this issue (don't want the user to click around) by hiding the whole installer window and only showing a banner during the process. Maybe this works for you, too?<br />
      <br />
      Gunther
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pravin</span><br />
      <span class="post-time small text-muted">14th October 2010 14:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        And the user may cancel/ abort the installation after this? What happened then - the user ends up with no installation at all? The previous one already uninstalled and the new one not installed?
      </blockquote><b>By Netsurfer24</b><br />
      <br />
      In uninstaller section i have a message box which will ask for the confirmation.<br />
      so only after confirmation it ll proceed to uninstall.<br />
      <br />
      After that i check my registry<br />
      <br />
      <pre>
<code>
ReadRegStr $G4 ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "UninstallString"
<br />&gt;${if} $G4 != ''" 
<br />&gt;
</code>
</pre>if the registry is not null i assume it has not uninstalled and i call the same page by a goto condition to start of the page.<br />
      <br />
      I know there must be some better way to call the page again like
      <pre>
<code>
 Call RelGotoPage 
<br />&gt;
</code>
</pre>. Im working on it :)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pravin</span><br />
      <span class="post-time small text-muted">14th October 2010 14:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have two radio button on the page<br />
      <br />
      1.Add/Reinstall ( which will uninstall and proceed with installation )<br />
      2.Uninstall ( does only uninstallation )</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pravin</span><br />
      <span class="post-time small text-muted">15th October 2010 08:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Bug raised .Artifact ID: 3087924</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>