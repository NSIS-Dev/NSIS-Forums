<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Get SecurityError 1?"><title>Get SecurityError 1? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Get SecurityError 1?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=309038">Get SecurityError 1?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">29th July 2009 14:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Get SecurityError 1?</strong><br>Function adminrights<br><br>UserMgr::GetCurrentUserName<br>Pop $1<br>#MessageBox MB_OK "$1" #Uncomment if debugging is necessary<br>UserMgr::SetRegKeyAccess "$1" "HKCU" "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\ASIM Bridge\DisplayIcon" "=a"<br>UserMgr::SetRegKeyAccess "$1" "HKCU" "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\ASIM Bridge\DisplayName" "=a"<br>UserMgr::SetRegKeyAccess "$1" "HKCU" "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\ASIM Bridge\DisplayVersion" "=a"<br>UserMgr::SetRegKeyAccess "$1" "HKCU" "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\ASIM Bridge\NSIS:Language" "=a"<br>UserMgr::SetRegKeyAccess "$1" "HKCU" "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\ASIM Bridge\Publisher" "=a"<br>UserMgr::SetRegKeyAccess "$1" "HKCU" "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\ASIM Bridge\UninstallString" "=a"<br>UserMgr::SetRegKeyAccess "$1" "HKCU" "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\ASIM Bridge\URLInfoAbout" "=a"<br>Pop $0<br>MessageBox MB_OK "GrantAccess Result : $0"<br><br>FunctionEnd<br><br><br>When I call this function, the grant access result is: Get SecurityError 1...<br><br><br>What does this mean exactly?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">29th July 2009 15:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">What are you trying to do exactly?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">29th July 2009 15:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It grabs the current username, and grants rights to write to the registry for those keys only</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">29th July 2009 15:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">current user can already write there. Besides, you can only apply ACL's to keys (folders), not values</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">29th July 2009 15:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">interesting, on the NSIS Help I followed the same format that they had in their example.<br><br>So if it comes back as Get Security Error 0 (if this is possible) it means they cant write there?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br><span class="post-time small text-muted">29th July 2009 17:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">First of all, you need a Pop $0 after each UserMgr::SetRegKeyAccess.<br>Second, as Anders said, you can only apply ACL's to keys.<br>So you only need</p><pre>
<code>UserMgr::SetRegKeyAccess "$1" "HKCU" "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\ASIM Bridge" "=a"</code>
</pre></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">29th July 2009 17:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok well this is now my total section:<br><br>!macro _UserIsAdminNT5 _a _b _t _f<br>Push $1<br>!insertmacro _LOGICLIB_TEMP<br>System::Call '*(&amp;i1 1,&amp;i1 2,&amp;i5,&amp;i1 5,&amp;i4 32,&amp;i4 544)i.r1' ;S-1-5-32-544<br>System::Call 'advapi32::CheckTokenMembership(i n,i r1,*i.s)i.s'<br>System::Free $1<br>Pop $1<br>Pop $_LOGICLIB_TEMP<br>IntCmpU $1 0 0 +2 +2<br>StrCpy $_LOGICLIB_TEMP 0<br>Pop $1<br>!insertmacro _!= $_LOGICLIB_TEMP 0 `${_t}` `${_f}`<br>!macroend<br>!define UserIsAdminNT5 `"" UserIsAdminNT5 ""`<br><br><br>(Courtesy of you Anders :) )<br><br>Function adminrights<br>${If} ${UserIsAdminNT5}<br>MessageBox MB_OK "User Type is Admin"<br>${Else}<br>MessageBox MB_OK "User Type is not Admin"<br>UserMgr::GetCurrentUserName #Gets User Account Name<br>Pop $1<br>#MessageBox MB_OK "$1" #Uncomment if debugging is necessary<br><br>UserMgr::SetRegKeyAccess "$1" "HKCU" "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\ASIM Bridge\" "=a"<br>Pop $0<br>MessageBox MB_OK "GrantAccess Result : $0"<br>${EndIf}<br>FunctionEnd<br><br><br>Its still popping that error....but is it only doing that because the user (myself right now) is an admin?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">29th July 2009 18:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Not sure why you want to put the current user on the ACL for a registry key under HKEY_CURRENT_USER. As Anders says, the current user will already have full access, and anyway a user needs to already have ownership and write access to put themselves on an ACL (unless you enable the SE_RESTORE_NAME and SE_TAKE_OWNERSHIP_NAME privileges).<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br><span class="post-time small text-muted">29th July 2009 18:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think the error message is "ERROR GetSecurityInfo 1", right?<br><br>Error 1 means ERROR_INVALID_FUNCTION...<br>Not sure why this error occures, but I found that granting a non existing registry key causes this error.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">29th July 2009 18:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Im trying to make it so that if a user isnt able to write the registry keys for the uninstaller that they will be changed so that it allows them to.<br><br>It was supposed to be HKLM, i was messing around with it and forgot to change it back.<br><br>If the user cant write the uninstaller registry keys there will be a problem no?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">29th July 2009 18:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">you should only write to HKLM if you are installing as admin (If you require admin rights to install, you should use requestexecutionlevel admin in your script and use the userinfo plugin in .onInit and display a messagebox and quit if the user is not admin)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">29th July 2009 18:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thats exactly the point...I dont want it to be admin only. I need it to be available to all users.<br><br>I figured writing to the HKCU would get around this?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">29th July 2009 18:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Uninstall registry needs to be under HKLM and unless you have administrator privileges you can't write there.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">29th July 2009 19:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">People seem to have a hard time grasping this:<br><br>Single user install: (don't have to be admin)<br>write to $localappdata and HKCU<br><br>All users install: (must be admin)<br>write to $programfiles and HKLM</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">29th July 2009 19:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Right but the install has to go on the root C:\ directory (or whatever local disk is).<br><br>Would I still need to do HKLM, or could I do HKCU?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">30th July 2009 00:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If you want your application available to all users then you don't write anything to HKCU. If your application writes anything to HKCU after install then you use EnumUsersReg to load each user hive to delete your registry keys.<br><br>Having said that there's a difference between <i>installing as admin</i> and <i>installing for admins</i>. Maybe you have that confused? Only administrator users (non limited accounts) can install applications for all users.<br><br>Your install can only be run by an administrator user anyway. Limited users can't write to the root or any folders on it and can't write to HKLM.<br><br>Stu</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>