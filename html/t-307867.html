<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="File Write Issue" />

  <title>File Write Issue - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">File Write Issue</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=307867">File Write Issue</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ryanpager</span><br />
      <span class="post-time small text-muted">1st July 2009 18:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>File Write Issue</strong><br />
      Okay, so ive got everythign in the installer, and when I was debugging it to make sure everything worked I noticed that it wasnt writing the files with the correct information;<br />
      <br />
      My code for the write file is the following:<br />
      <br />
      Function asimbridge<br />
      <br />
      !macro WriteLineB LineB<br />
      FileWrite $R0 `${LineB}$\r$\n`<br />
      !macroend<br />
      !define WriteLineB `!insertmacro WriteLine`<br />
      <br />
      Push $R0<br />
      FileOpen $R0 `$INSTDIR\ASIMBridge.bat` w<br />
      ${WriteLineB} '@echo off'<br />
      ${WriteLineB} 'rem bridge file created Thu, 25 Jun 2009 14:49:20 -0500 by user $uNameRem'<br />
      ${WriteLineB} 'rem install option: normal install'<br />
      ${WriteLineB} 'rem browser path: C:\Program Files\Internet Explorer\iexplore.exe'<br />
      ${WriteLineB} 'rem company directory: $INSTDIR'<br />
      ${WriteLineB} 'rem automatic login: on'<br />
      ${WriteLineB} ''<br />
      ${WriteLineB} 'set PHPRC="$INSTDIR\"'<br />
      ${WriteLineB} 'if not exist "$INSTDIR\php.exe" GOTO PHPERR'<br />
      ${WriteLineB} 'if not exist "$INSTDIR\%1" GOTO BRGERR'<br />
      ${WriteLineB} ''<br />
      ${WriteLineB} 'GOTO PHPEXEC'<br />
      ${WriteLineB} ''<br />
      ${WriteLineB} ':PHPEXEC'<br />
      ${WriteLineB} '"$INSTDIRphp.exe" "$INSTDIR\upload_bridge_file.php" "$INSTDIR\%1"'<br />
      ${WriteLineB} 'if ERRORLEVEL 1 GOTO RETERR'<br />
      ${WriteLineB} 'GOTO END'<br />
      ${WriteLineB} ''<br />
      ${WriteLineB} ':PHPERR'<br />
      ${WriteLineB} 'echo $INSTDIR\php.exe does not exist - please check your bridge configuration'<br />
      ${WriteLineB} 'GOTO PAUSEX'<br />
      ${WriteLineB} ''<br />
      ${WriteLineB} ':BRGERR'<br />
      ${WriteLineB} 'echo $INSTDIR\%1 does not exist - please check your bridge configuration'<br />
      ${WriteLineB} 'GOTO PAUSEX'<br />
      ${WriteLineB} ''<br />
      ${WriteLineB} ':PAUSEX'<br />
      ${WriteLineB} 'PAUSE'<br />
      ${WriteLineB} 'GOTO END'<br />
      ${WriteLineB} ''<br />
      ${WriteLineB} ':RETERR'<br />
      ${WriteLineB} 'echo "Bridge upload failed with error code %ERRORLEVEL%"'<br />
      ${WriteLineB} 'GOTO PAUSEX'<br />
      ${WriteLineB} ''<br />
      ${WriteLineB} ':END'<br />
      ${WriteLineB} 'EXIT'<br />
      ${WriteLineB} ''<br />
      ${WriteLineB} 'EXIT'<br />
      FileClose $R0<br />
      Pop $R0<br />
      FunctionEnd<br />
      <br />
      <br />
      <br />
      Now the file is writing correctly, but anywhere it says $instdir it does teh following;<br />
      <br />
      If install directory = C:\ASIM<br />
      <br />
      it will write to the file as: C:\ASIM\ASIM\*<br />
      <br />
      <br />
      Is there a way to get rid of this duplication?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">1st July 2009 23:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Check the value of $INSTDIR using a message box. Also your WriteLineB define is inserting the WriteLine macro.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ryanpager</span><br />
      <span class="post-time small text-muted">2nd July 2009 14:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yea I ran the MB, and it was correct with the install path....however it is NOT writing to my .bat file.<br />
      <br />
      <br />
      Is it not possible to write to an executable bat file?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ryanpager</span><br />
      <span class="post-time small text-muted">2nd July 2009 14:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">got it......stupid plaguing typo</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ryanpager</span><br />
      <span class="post-time small text-muted">2nd July 2009 16:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">On a ComboBox, how do you retrieve the selection that they make?<br />
      <br />
      I tried the GetSelection but it just errors out<br />
      <br />
      Any ideas?</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
