<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Win2k SP3 and up" />

  <title>Win2k SP3 and up - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Win2k SP3 and up</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=241130">Win2k SP3 and up</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">coco_vc</span><br />
      <span class="post-time small text-muted">17th March 2006 18:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Win2k SP3 and up</strong><br />
      Hi all,<br />
      <br />
      My app should be installed only on Win2000 ServicePack 3 and up, so at the beginning I have to check for this. How can I check this?<br />
      <br />
      Thx,<br />
      Viv</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dienjd</span><br />
      <span class="post-time small text-muted">17th March 2006 18:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can use a <a href="http://nsis.sourceforge.net/wiki/File:GetVersion.zip" target="_blank">plug-in</a> or <a href="http://nsis.sourceforge.net/Get_Windows_version" target="_blank">some</a> <a href="http://nsis.sourceforge.net/Get_last_installed_service_pack_version" target="_blank">functions</a>.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">19th March 2006 16:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">if you require a specific Win32 API function you can call LoadLibrary and GetProcAddress with the system plugin on the .dll containing the func</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">coco_vc</span><br />
      <span class="post-time small text-muted">21st March 2006 16:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi all,<br />
      <br />
      Thanks for your answers.<br />
      <br />
      1) I can't use the plugin as one of my requirements is that my script needs to be compilable by anybody who downloads the version of the NSIS specified in some docu. So I can't ask those to download a dll and to put it somewhere.<br />
      2) so I used the other functions in order to accomplish what I need<br />
      3) I'll post here the code I wrote to check if it's Win2000 ServicePack 3 and up<br />
      <br /></p>
      <pre>
<code><br />; check that we have the correct OS and ServicePack otherwise abort. We need Win2000 SP3 and up<br />Function checkCorrectOSandServicePack<br />#   read the registry entry SOFTWARE\Microsoft\Windows NT\CurrentVersion" CurrentVersion<br />#   - if it doesn't exists, we are on Win9x systems, so not OK<br />#   - if it starts with 3 or 4 we are on WinNT system, so not OK<br />#   - 5.0, 5.1, 5.2 mean Win2k, XP, 2003, so are OK for us.<br />  ReadRegStr $OSVer HKLM "SOFTWARE\Microsoft\Windows NT\CurrentVersion" CurrentVersion<br />  IntCmp $OSVer 5 IS_Win2000_OrMore Not_OK_OS_Or_ServicePack OK_OS_And_ServicePack ; IntCmp compares only integers, so we can't compare with 5.0, but here we don't need to, but to keep in mind that if the result is equal, means it's 5.x so Win2k and up<br />IS_Win2000_OrMore:<br />    ; check in case of Win2000 if also Service Pack is correct (for Win2000 it should be SP3 or up)<br />    StrCmp $OSVer "5.0" 0 OK_OS_And_ServicePack ; it's Win2000 or it's more?<br />      call GetServicePack ; <a href="http://nsis.sourceforge.net/wiki/Get_last_installed_service_pack_version" target="_blank">http://nsis.sourceforge.net/wiki/Get...e_pack_version</a><br />      Pop $ServicePack<br />      Pop $MinorServicePack ; just to clean the stack<br />      IntCmp $ServicePack 3 OK_OS_And_ServicePack Not_OK_OS_Or_ServicePack OK_OS_And_ServicePack<br />Not_OK_OS_Or_ServicePack:<br />    MessageBox MB_ICONEXCLAMATION|MB_OK "You need Win2000 with ServicePack 3 and up"<br />    Quit ; quit the whole installer<br />OK_OS_And_ServicePack:<br />FunctionEnd<br /></code>
</pre><br />
      <br />
      Seems to be working, but if smbd sees a problem with this method pls tell me about it.<br />
      <br />
      4) one more issue: I used the function to get the windows service pack from here: <a href="http://nsis.sourceforge.net/wiki/Get_last_installed_service_pack_version" target="_blank">http://nsis.sourceforge.net/wiki/Get...e_pack_version</a> but I noticed that in the post from here <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=156031&amp;highlight=CSDVersion" target="_blank">http://forums.winamp.com/showthread....ght=CSDVersion</a> cjs says that "CSD Version outputs "SERVICE PACK (NUMBER)"". This is weird as the function from wiki uses the implementation like there will always be only a number, so no "service pack" string in front of the number. Anybody knowing more about this issue?<br />
      <br />
      Thx,<br />
      Viv
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
