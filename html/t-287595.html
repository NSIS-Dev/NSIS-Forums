<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="logib lib switch statement fails" />

  <title>logib lib switch statement fails - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">logib lib switch statement fails</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=287595">logib lib switch statement fails</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bazzauk2002</span><br />
      <span class="post-time small text-muted">26th February 2008 03:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>logib lib switch statement fails</strong><br />
      ok here is the code im using the $DBType is from a custom ini file using a listbox as the selector the field is correct and everything compiles ok but the switch case statement always picks the default no matter what the $DBType is set to?? dont understand why??<br />
      <br />
      HELP PLEASE<br />
      <br />
      ;Get Database Type<br />
      !insertmacro MUI_INSTALLOPTIONS_READ $DBType "dbsettings" "Field4" "State"<br />
      <br />
      ${Switch} $DBType<br />
      ${Case} "Oracle 10g Server"<br />
      ;build for oracle DS xml file<br />
      ExecShell "open" "http://www.oracle.com/"<br />
      ${Break}<br />
      ${Case} "MySql Server"<br />
      ;build for Mysql Server<br />
      ExecShell "open" "http://www.mysql.com/"<br />
      ${Break}<br />
      ${Case} "MS SQL Server 2005"<br />
      ;build for MS SQLSERVER 2005 DS xml<br />
      ExecShell "open" "http://www.yahoo.com/"<br />
      ${Break}<br />
      ${Case} "MS SQL Server 2008"<br />
      ;build for MS SQLSERVER 2008 ds xml<br />
      ExecShell "open" "http://www.microsoft.com/"<br />
      ${Break}<br />
      ${Default}<br />
      ;build nothing just copy hypersonic ds xml default file<br />
      ExecShell "open" "http://www.riskdecisions.com/"<br />
      ${Break}<br />
      ${EndSwitch}</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bradharding</span><br />
      <span class="post-time small text-muted">26th February 2008 05:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Remove those ${Break}'s. They're not needed.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">26th February 2008 06:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Do not remove those breaks, Would not work properly if you do so.<br />
      <br />
      Checkout your listbox, should be a typo or something because the following works fine for me.<br />
      <br />
      Also checkout if it needs to ${TrimNewLines}.<br />
      <br /></p>
      <pre>
<code>outfile test.exe<br />showinstdetails show<br /><br />!include logiclib.nsh<br /><br />section<br />strcpy $R0 "ms sql server 2008"<br />${switch} $R0<br />${case} "oracle 10g server"<br />;build for oracle ds xml file<br />detailprint `"open" "http://www.oracle.com/"`<br />${break}<br />${case} "mysql server"<br />;build for mysql server<br />detailprint `"open" "http://www.mysql.com/"`<br />${break}<br />${case} "ms sql server 2005"<br />;build for ms sqlserver 2005 ds xml<br />detailprint `"open" "http://www.yahoo.com/"`<br />${break}<br />${case} "ms sql server 2008"<br />;build for ms sqlserver 2008 ds xml<br />detailprint `"open" "http://www.microsoft.com/"`<br />${break}<br />${default}<br />;build nothing just copy hypersonic ds xml default file<br />detailprint `"open" "http://www.riskdecisions.com/"`<br />${break}<br />${endswitch}<br />sectionend</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bazzauk2002</span><br />
      <span class="post-time small text-muted">26th February 2008 12:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>ok here is the whole thing</strong><br />
      thank for the reply<br />
      see below<br />
      <br />
      Function .onInit<br />
      !insertmacro MUI_INSTALLOPTIONS_EXTRACT_AS "dbsettings.ini" "dbsettings"<br />
      FunctionEnd<br />
      <br />
      ;Function to get user data from custom page.<br />
      Function dbsettings<br />
      ;Display the page.<br />
      !insertmacro MUI_INSTALLOPTIONS_DISPLAY "dbsettings"<br />
      <br />
      ;Get the user entered values put then in variables.<br />
      !insertmacro MUI_INSTALLOPTIONS_READ $Address "dbsettings" "Field 1" "State"<br />
      !insertmacro MUI_INSTALLOPTIONS_READ $Username "dbsettings" "Field 2" "State"<br />
      !insertmacro MUI_INSTALLOPTIONS_READ $Password "dbsettings" "Field 3" "State"<br />
      !insertmacro MUI_INSTALLOPTIONS_READ $dbType "dbsettings" "Field 4" "State"<br />
      <br />
      ExecShell "open" $dbType<br />
      ${Switch} $dbType<br />
      ${Case} "Oracle 10g Server"<br />
      ;build for oracle DS xml file<br />
      ExecShell "open" "http://www.oracle.com/"<br />
      ${Break}<br />
      ${Case} "MySql Server"<br />
      ;build for Mysql Server<br />
      ExecShell "open" "http://www.mysql.com/"<br />
      ${Break}<br />
      ${Case} "MS SQL Server 2005"<br />
      ;build for MS SQLSERVER 2005 DS xml<br />
      ExecShell "open" "http://www.yahoo.com/"<br />
      ${Break}<br />
      ${Case} "MS SQL Server 2008"<br />
      ;build for MS SQLSERVER 2008 ds xml<br />
      ExecShell "open" "http://www.microsoft.com/"<br />
      ${Break}<br />
      ${Default}<br />
      ;build nothing just copy hypersonic ds xml default file<br />
      ExecShell "open" "http://www.riskdecisions.com/"<br />
      ${Break}<br />
      ${EndSwitch}<br />
      FunctionEnd<br />
      <br />
      I have checked the .ini file and i can see no typo error at all. It seems like $dbType never gets assigned what ever is in the field ref of the ini file. Can you explain what TrimNewlines does, does the install_option_read function only return a string or is there something else added with it. I find it very difficult to see what the variables actually contain.<br />
      <br />
      regards</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">26th February 2008 12:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Small mistake: you used ${Switch} instead of ${Select}. According to the logiclib.nsh docs (at the top of the file):</p>
      <pre>
<code>;       Select..{Case[2|3|4|5]}..[CaseElse|Default]..EndSelect<br />;         - Executes one of several blocks of statements, depending on the value<br />;           of an expression.<br />;       Switch..{Case|CaseElse|Default}..EndSwitch<br />;         - Jumps to one of several labels, depending on the value of an<br />;           expression.<br /></code>
</pre><br />
      And the ${Break} is to exit a For, Do, or While loop. It isn't used in a Switch or Select statement.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">26th February 2008 13:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That is not true. In a Switch statement it is necessary to prevent fall-through execution of proceeding cases:<br />
      <br />
      ${Switch} $R0<br />
      ${Case} 0<br />
      MessageBox MB_OK `$R0 is 0!`<br />
      ${Case} 1<br />
      MessageBox MB_OK `$R0 is 0 or 1!`<br />
      ${EndSwitch}<br />
      Without a ${Break} after the first MessageBox, both will be displayed if $R0 is 0.<br />
      <br />
      ${Select} is the selection statement which does not require ${Break} (IIRC it is like VB).<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bazzauk2002</span><br />
      <span class="post-time small text-muted">26th February 2008 13:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">i think there is a bit of confusion here as the logiclib has two versions one with switch and one with select, am i correct in using the switch statement with breaks as per the user documentation for logic lib.<br />
      Course i probably wrong about this.<br />
      <br />
      Anyway....<br />
      <br />
      is this happening because the switch is happening inside the page function and not when the page returns.<br />
      <br />
      regards<br />
      bazza (has a headache)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">26th February 2008 14:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes you are right to use Break (read my post above). Also yes you can't read from the INI file in the page's show function because the new user input isn't saved to the INI file until the leave function is called.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bazzauk2002</span><br />
      <span class="post-time small text-muted">26th February 2008 14:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Stu<br />
      Thought it was a code positioning fault, anyway i have put the switch statement into the .onInstSuccess function, is this the correct one to use, dont know how to set it any other way. Have also tried putting it into another custom page called dbsettingsleave that is called straight after the dbsettings page.<br />
      <br />
      Both methods above result in the same webpage openening. I use the open webpage url to determine what the variable contains, i also tried writing it to a file and got nothing.<br />
      <br />
      here is the ini file itself<br />
      ; Ini file generated by the HM NIS Edit IO designer.<br />
      [Settings]<br />
      ;InstallOptions Editor Metadata (DO NOT EDIT): guides=8|10#8|30#8|50#8|70#1|169#1|100<br />
      NumFields=8<br />
      Title="Database Connection Settings "<br />
      <br />
      [Field 1]<br />
      ;InstallOptions Editor Metadata (DO NOT EDIT): guides=1|0|-1<br />
      Type=Text<br />
      State=<br />
      Left=169<br />
      Right=292<br />
      Top=10<br />
      Bottom=23<br />
      <br />
      [Field 2]<br />
      ;InstallOptions Editor Metadata (DO NOT EDIT): guides=8|1|-1#1|0|-1<br />
      Type=Text<br />
      State=<br />
      Left=169<br />
      Right=292<br />
      Top=30<br />
      Bottom=43<br />
      <br />
      [Field 3]<br />
      ;InstallOptions Editor Metadata (DO NOT EDIT): guides=8|2|-1#1|0|-1<br />
      Type=Password<br />
      Left=169<br />
      Right=292<br />
      Top=50<br />
      Bottom=61<br />
      <br />
      [Field 4]<br />
      ;InstallOptions Editor Metadata (DO NOT EDIT): guides=8|3|-1#1|0|-1<br />
      Type=DropList<br />
      ListItems=Hypersonic|MS SQL 2005|MS SQL 2008|Oracle 10g|My SQL 5.0<br />
      Left=169<br />
      Right=292<br />
      Top=70<br />
      Bottom=163<br />
      State=Hypersonic<br />
      <br />
      [Field 5]<br />
      ;InstallOptions Editor Metadata (DO NOT EDIT): guides=8|0|-1#1|0|1<br />
      Type=Label<br />
      Text=Server Name / IP<br />
      Left=100<br />
      Right=169<br />
      Top=10<br />
      Bottom=23<br />
      <br />
      [Field 6]<br />
      ;InstallOptions Editor Metadata (DO NOT EDIT): guides=8|1|-1#1|0|1<br />
      Type=Label<br />
      Text=User Name<br />
      Left=100<br />
      Right=169<br />
      Top=30<br />
      Bottom=40<br />
      <br />
      [Field 7]<br />
      ;InstallOptions Editor Metadata (DO NOT EDIT): guides=8|2|-1#1|0|1<br />
      Type=Label<br />
      Text=User Password<br />
      Left=100<br />
      Right=169<br />
      Top=50<br />
      Bottom=61<br />
      <br />
      [Field 8]<br />
      ;InstallOptions Editor Metadata (DO NOT EDIT): guides=8|3|-1#1|1|-1<br />
      Type=Label<br />
      Text=Database Type<br />
      Left=100<br />
      Right=170<br />
      Top=70<br />
      Bottom=80<br />
      <br />
      i just dont understand whats going on here?<br />
      <br />
      regards</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">26th February 2008 17:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Attach your script. Custom page leave functions are set with Page:<br />
      <br />
      Page Custom ShowFunction LeaveFunction<br />
      <br />
      Also check the INI file at run time. It will be under a ns###.tmp folder in %TEMP%.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bazzauk2002</span><br />
      <span class="post-time small text-muted">26th February 2008 23:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hi stu<br />
      here is the script part<br />
      <br />
      Function .onInit<br />
      !insertmacro MUI_INSTALLOPTIONS_EXTRACT_AS "sdbselect.ini" "dbsettings"<br />
      FunctionEnd<br />
      <br />
      Function dbsettings<br />
      !insertmacro MUI_INSTALLOPTIONS_DISPLAY "dbsettings"<br />
      <br />
      ;Get Database Server ID<br />
      !insertmacro MUI_INSTALLOPTIONS_READ $ServerID "dbsettings" "Field1" "State"<br />
      ;Get Database User ID<br />
      !insertmacro MUI_INSTALLOPTIONS_READ $UserID "dbsettings" "Field2" "State"<br />
      ;Get Database User Password<br />
      !insertmacro MUI_INSTALLOPTIONS_READ $UserPass "dbsettings" "Field3" "State"<br />
      ;Get Database Type<br />
      !insertmacro MUI_INSTALLOPTIONS_READ $DBType "dbsettings" "Field4" "State"<br />
      FunctionEnd<br />
      <br />
      Function dbsettingsleave<br />
      ${Switch} $DBType<br />
      ${Case} "Oracle 10g Server"<br />
      ;build for oracle DS xml file<br />
      ExecShell "open" "http://www.oracle.com/"<br />
      ${Break}<br />
      ${Case} "MySql Server"<br />
      ;build for Mysql Server<br />
      ExecShell "open" "http://www.mysql.com/"<br />
      ${Break}<br />
      ${Case} "MS SQL Server 2005"<br />
      ;build for MS SQLSERVER 2005 DS xml<br />
      ExecShell "open" "http://www.yahoo.com/"<br />
      ${Break}<br />
      ${Case} "MS SQL Server 2008"<br />
      ;build for MS SQLSERVER 2008 ds xml<br />
      ExecShell "open" "http://www.microsoft.com/"<br />
      ${Break}<br />
      ${Default}<br />
      ;build nothing just copy hypersonic ds xml default file<br />
      ExecShell "open" "http://www.riskdecisions.com/"<br />
      ${Break}<br />
      ${EndSwitch}<br />
      FunctionEnd<br />
      <br />
      its called by this<br />
      <br />
      page custom dbsettings dbsettingsleave<br />
      <br />
      any ideas ?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bazzauk2002</span><br />
      <span class="post-time small text-muted">26th February 2008 23:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">yes the tmp stuff creates a directory NS###.tmp so that part works<br />
      <br />
      dont know why the variable doesnt get assigned the value selected though.<br />
      <br />
      regards</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bazzauk2002</span><br />
      <span class="post-time small text-muted">26th February 2008 23:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">have checked the tmp ini file the installer created and the settings i chose where written to it correctly with all the HWND id as per below<br />
      <br />
      <br />
      [Field 1]<br />
      Type=Text<br />
      Left=114<br />
      Right=238<br />
      Top=33<br />
      Bottom=46<br />
      State="server"<br />
      HWND=1049724<br />
      <br />
      [Field 2]<br />
      Type=Text<br />
      Left=114<br />
      Right=238<br />
      Top=52<br />
      Bottom=65<br />
      State="washere"<br />
      HWND=853042<br />
      <br />
      [Field 3]<br />
      Type=Password<br />
      Left=114<br />
      Right=238<br />
      Top=72<br />
      Bottom=84<br />
      State="fuckinghell"<br />
      HWND=787540<br />
      <br />
      [Field 4]<br />
      Type=Listbox<br />
      ListItems=Built in Database Server|Oracle 10g Server|MySql Server|MS SQL Server 2005|MS SQL Server 2008<br />
      Left=114<br />
      Right=238<br />
      Top=92<br />
      Bottom=184<br />
      State=MS SQL Server 2005<br />
      HWND=722120<br />
      <br />
      so the custom script seems to be doing that ok its just when questying the value it dont work<br />
      <br />
      baz</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">27th February 2008 01:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The 'leave' function gets called before the program comes back from the 'display' macro. You are setting $DBType and the other variables after you return from the display macro, so they are not yet set when you run through the 'leave' function.<br />
      <br />
      Try moving the macros that read the variables into the top of the 'leave' function.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bazzauk2002</span><br />
      <span class="post-time small text-muted">27th February 2008 15:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">So you think i have to only have the dbsettings function to show the page then the leave function should have the MUI_INSTALL_OPTIONS_READ functions in there.<br />
      <br />
      regards<br />
      bazza</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bazzauk2002</span><br />
      <span class="post-time small text-muted">27th February 2008 15:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks guys but i have tried that as well and the dbtype variable never changes as i always get the Default website everytime.<br />
      <br />
      regards.<br />
      baz</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">27th February 2008 16:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Could you try debug your script with message boxes?<br />
      After each "read" add a message box to checkout if everything goes right so far.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bazzauk2002</span><br />
      <span class="post-time small text-muted">27th February 2008 22:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Its not the ligic lib switch statement that isnt working, the values entered into to custom ini file page are never retrieved from the ini file even though they exist at runtime. hope someone can help me<br />
      ;----------------------------------------<br />
      ;Include the Modern UI &amp; MUI2 interface<br />
      !include "InstallOptions.nsh"<br />
      !include "MUI.nsh"<br />
      !include "MUI2.nsh"<br />
      !include "LogicLib.nsh"<br />
      ;----------------------------------------<br />
      ;General Stuff<br />
      ;Name and File<br />
      Name "Predict! Version 4"<br />
      OutFile "SetupPR4.exe"<br />
      XPStyle on<br />
      AllowRootDirInstall true<br />
      ;Default Installation folder<br />
      InstallDir "c:\pr4"<br />
      ;Global Variables<br />
      Var ServerID<br />
      Var UserID<br />
      Var UserPass<br />
      Var DBType<br />
      ;-----------------------------------------<br />
      ;Load the custom page for database selection and assign page name.<br />
      Function .onInit<br />
      !insertmacro INSTALLOPTIONS_EXTRACT "sdbselect.ini"<br />
      FunctionEnd<br />
      Function dbsettings<br />
      !insertmacro INSTALLOPTIONS_DISPLAY "sdbselect.ini"<br />
      FunctionEnd<br />
      Function dbsettingsleave<br />
      ;Get Database Server ID<br />
      !insertmacro INSTALLOPTIONS_READ $ServerID "sdbselect.ini" "Field1" "State"<br />
      MessageBox MB_OK $ServerID<br />
      ;Get Database User ID<br />
      !insertmacro INSTALLOPTIONS_READ $UserID "sdbselect.ini" "Field2" "State"<br />
      MessageBox MB_OK $UserID<br />
      ;Get Database User Password<br />
      !insertmacro INSTALLOPTIONS_READ $UserPass "sdbselect.ini" "Field3" "State"<br />
      MessageBox MB_OK $UserPass<br />
      ;Get Database Type<br />
      !insertmacro INSTALLOPTIONS_READ $DBType "sdbselect.ini" "Field4" "State"<br />
      MessageBox MB_OK $DBType<br />
      ${Switch} $DBType<br />
      ${Case} "Oracle 10g Server"<br />
      ;build for oracle DS xml file<br />
      MessageBox MB_OK $DBType<br />
      ExecShell "open" "http://www.oracle.com/"<br />
      ${Break}<br />
      ${Case} "MySql Server"<br />
      ;build for Mysql Server<br />
      MessageBox MB_OK $DBType<br />
      ExecShell "open" "http://www.mysql.com/"<br />
      ${Break}<br />
      ${Case} "MS SQL Server 2005"<br />
      ;build for MS SQLSERVER 2005 DS xml<br />
      MessageBox MB_OK $DBType<br />
      ExecShell "open" "http://www.yahoo.com/"<br />
      ${Break}<br />
      ${Case} "MS SQL Server 2008"<br />
      ;build for MS SQLSERVER 2008 ds xml<br />
      MessageBox MB_OK $DBType<br />
      ExecShell "open" "http://www.microsoft.com/"<br />
      ${Break}<br />
      ${Default}<br />
      ;build nothing just copy hypersonic ds xml default file<br />
      MessageBox MB_OK $DBType<br />
      ExecShell "open" "http://www.riskdecisions.com/"<br />
      ${Break}<br />
      ${EndSwitch}<br />
      FunctionEnd<br />
      ;-----------------------------------------<br />
      ;Interface Settings<br />
      !define MUI_ABORTWARNING<br />
      ; MUI Settings / Icons<br />
      !define MUI_ICON "${NSISDIR}\Contrib\Graphics\Icons\orange-install-nsis.ico"<br />
      !define MUI_UNICON "${NSISDIR}\Contrib\Graphics\Icons\orange-uninstall-nsis.ico"<br />
      ; MUI Settings / Header<br />
      !define MUI_HEADERIMAGE<br />
      !define MUI_HEADERIMAGE_RIGHT<br />
      !define MUI_HEADERIMAGE_BITMAP "${NSISDIR}\Contrib\Graphics\Header\orange-r-nsis.bmp"<br />
      !define MUI_HEADERIMAGE_UNBITMAP "${NSISDIR}\Contrib\Graphics\Header\orange-uninstall-r-nsis.bmp"<br />
      ; MUI Settings / Wizard<br />
      !define MUI_WELCOMEFINISHPAGE_BITMAP "${NSISDIR}\Contrib\Graphics\Wizard\orange-nsis.bmp"<br />
      !define MUI_UNWELCOMEFINISHPAGE_BITMAP "${NSISDIR}\Contrib\Graphics\Wizard\orange-uninstall-nsis.bmp"<br />
      ;-----------------------------------------<br />
      ;Pages that the installer uses<br />
      !insertmacro MUI_PAGE_WELCOME<br />
      !insertmacro MUI_PAGE_LICENSE "SoftwareLicense.txt"<br />
      !insertmacro MUI_PAGE_COMPONENTS<br />
      !insertmacro MUI_PAGE_DIRECTORY<br />
      !insertmacro MUI_PAGE_INSTFILES<br />
      page custom dbsettings dbsettingsleave<br />
      !insertmacro MUI_PAGE_FINISH<br />
      !insertmacro MUI_UNPAGE_CONFIRM<br />
      !insertmacro MUI_UNPAGE_INSTFILES<br />
      ;-------------------------------------------<br />
      ;Languages<br />
      !insertmacro MUI_LANGUAGE "English"<br />
      ;--------------------------------------------<br />
      ;Installer Sections<br />
      Section "Java Install" SecJava<br />
      ExecWait "$EXEDIR\jdk-1_5_0_12-windows-i586-p.exe /S"<br />
      ReadRegStr $0 HKLM "SOFTWARE\JavaSoft\Java Development Kit\1.5" "JavaHome"<br />
      WriteRegExpandStr HKLM "SYSTEM\CurrentControlSet\Control\Session Manager\Environment" "JAVA_HOME" $0<br />
      SetOutPath "$INSTDIR"<br />
      SectionEnd<br />
      Section "Predict! Risk Controller" SecPRC<br />
      SetOutPath "$INSTDIR"<br />
      ReadRegDWORD $R0 HKLM "HARDWARE\DESCRIPTION\System\CentralProcessor\0" "~Mhz"<br />
      IntCmp $R0 1000 eq less more<br />
      eq:<br />
      Goto done<br />
      more:<br />
      Goto done<br />
      less:<br />
      Abort "System does not meet min. requirements, processor speed less than 1 Ghz."<br />
      done:<br />
      ClearErrors<br />
      ReadRegStr $R1 HKLM "SOFTWARE\Microsoft\Windows NT\CurrentVersion" "CurrentVersion"<br />
      StrCpy $R2 $R1 1<br />
      !if $R2 == 4<br />
      Abort "System does not meet minimum requirements, Operating System not supported."<br />
      !endif<br />
      IfErrors 0 +2<br />
      Abort "System does not meet minimum requirements, Operating System not supported."<br />
      ClearErrors<br />
      ReadRegStr $0 HKLM "SYSTEM\CurrentControlSet\Control\Session Manager\Environment" "JAVA_HOME"<br />
      IfErrors 0 +2<br />
      Abort "Java not installed or JAVA_HOME environment variable not set."<br />
      CreateDirectory $INSTDIR\jboss-4.0.5.GA<br />
      CopyFiles /SILENT $EXEDIR\jboss-4.0.5.GA\*.* $INSTDIR\jboss-4.0.5.GA 189000<br />
      WriteRegExpandStr HKLM "SYSTEM\CurrentControlSet\Control\Session Manager\Environment" "JBOSS_HOME" "$INSTDIR\jboss-4.0.5.GA"<br />
      WriteRegExpandStr HKLM "SYSTEM\CurrentControlSet\Control\Session Manager\Environment" "JBOSS_PORT" "80"<br />
      WriteRegExpandStr HKLM "SYSTEM\CurrentControlSet\Control\Session Manager\Environment" "JBOSS_HOST" "localhost"<br />
      ReadRegStr $1 HKLM "SYSTEM\CurrentControlSet\Control\Session Manager\Environment" "JBOSS_HOME"<br />
      CopyFiles /SILENT $EXEDIR\login-config.xml $1\server\default\conf 10<br />
      CopyFiles /SILENT $EXEDIR\javaservice\*.* $1\bin 700<br />
      /*RMDir /r $1\server\default\data\hypersonic*/<br />
      CopyFiles /SILENT $EXEDIR\prc4.ear $1\server\default\deploy 48000<br />
      ExecWait '"$1\bin\JBossService.exe" -install JBoss "$0\jre\bin\client\jvm.dll" -Djava.class.path="$1\bin\run.jar;$0\lib\tools.jar" -Xms400M -Xmx512M -XX:MaxPermSize=80M -start org.jboss.Main -stop org.jboss.Main -method systemExit -out "$1\bin\out.log" -err "$1\bin\err.log" -current "$1\bin" -auto -overwrite -startup 6'<br />
      ExecWait "net start Jboss"<br />
      DetailPrint "waiting for service..."<br />
      Sleep 20000<br />
      CreateDirectory "$SMPROGRAMS\Predict! Risk Controller 4"<br />
      CopyFiles /SILENT $EXEDIR\PRC4.url "$SMPROGRAMS\Predict! Risk Controller 4" 1<br />
      /*CreateDirectory $INSTDIR\dbprep<br />
      CopyFiles /SILENT $EXEDIR\dbprep\*.* $INSTDIR\dbprep 22000<br />
      SetOutPath $INSTDIR\dbprep<br />
      ExecWait "$OUTDIR\dbprep.exe"*/<br />
      WriteUninstaller $INSTDIR\uninstallPRC4.exe<br />
      CreateShortCut "$SMPROGRAMS\Predict! Risk Controller 4\UninstallPRC4.lnk" "$INSTDIR\uninstallPRC4.exe" "" "$INSTDIR\uninstallPRC4.exe" 0<br />
      SectionEnd<br />
      Section "Predict! Risk Analyser" SecPRA<br />
      SetOutPath "$INSTDIR"<br />
      ClearErrors<br />
      ReadRegStr $0 HKLM "SOFTWARE\JavaSoft\Java Development Kit\1.5" "JavaHome"<br />
      IfErrors 0 +2<br />
      Abort "Java 1.5 not installed, quiting installation."<br />
      CreateDirectory $INSTDIR\pra4<br />
      CopyFiles /SILENT $EXEDIR\pra4\*.* $INSTDIR\PRA4 16000<br />
      CreateDirectory "$SMPROGRAMS\Predict! Risk Analyser 4"<br />
      SetOutPath $INSTDIR\pra4<br />
      CreateShortCut "$SMPROGRAMS\Predict! Risk Analyser 4\PRA4.lnk" "$INSTDIR\pra4\PRA4.exe" "" "$INSTDIR\pra4\PRA4.exe" 0 SW_SHOWMAXIMIZED<br />
      SectionEnd<br />
      ;---------------------------------------------<br />
      ;Descriptions of Sections<br />
      ;Language strings<br />
      LangString DESC_SecJava ${LANG_ENGLISH} "Java JDK 1.5 is a requirement of Predict! If you already have java ensure that you deselect this item."<br />
      LangString DESC_SecPRC ${LANG_ENGLISH} "Risk Controller."<br />
      LangString DESC_SecPRA ${LANG_ENGLISH} "Risk Analyser."<br />
      ;Assign language strings to sections<br />
      !insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br />
      !insertmacro MUI_DESCRIPTION_TEXT ${SecJava} $(DESC_SecJava)<br />
      !insertmacro MUI_DESCRIPTION_TEXT ${SecPRC} $(DESC_SecPRC)<br />
      !insertmacro MUI_DESCRIPTION_TEXT ${SecPRA} $(DESC_SecPRA)<br />
      !insertmacro MUI_FUNCTION_DESCRIPTION_END<br />
      ;-------------------------------------------------<br />
      ;Uninstaller Section<br />
      Section "Uninstall"<br />
      ExecWait "net stop Jboss"<br />
      DeleteRegValue HKLM "SYSTEM\CurrentControlSet\Control\Session Manager\Environment" "JBOSS_HOME"<br />
      DeleteRegValue HKLM "SYSTEM\CurrentControlSet\Control\Session Manager\Environment" "JBOSS_PORT"<br />
      DeleteRegValue HKLM "SYSTEM\CurrentControlSet\Control\Session Manager\Environment" "JBOSS_HOST"<br />
      DeleteRegKey HKLM "SYSTEM\CurrentControlSet\Services\Jboss"<br />
      RMDir /r "$SMPROGRAMS\Predict! Risk Controller 4"<br />
      RMDir /r "$SMPROGRAMS\Predict! Risk Analyser 4"<br />
      RMDir /r $INSTDIR<br />
      Delete "$INSTDIR\Uninstall.exe"<br />
      RMDir "$INSTDIR"<br />
      SectionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">27th February 2008 23:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I guess you must use either MUI or MUI2, no both.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">28th February 2008 14:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You are trying to read from "Field1" etc when it is "Field 1" etc.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bazzauk2002</span><br />
      <span class="post-time small text-muted">28th February 2008 18:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Doh.........<br />
      thanks stu<br />
      <br />
      yes i am a dumb ass<br />
      <br />
      <br />
      regards baz</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
