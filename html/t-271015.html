<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Registry Data held in memory?" />

  <title>Registry Data held in memory? - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Registry Data held in memory?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=271015">Registry Data held in memory?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">chivalri</span><br />
      <span class="post-time small text-muted">11th May 2007 22:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Registry Data held in memory?</strong><br /></p>
      <pre>
<code>ReadRegStr$R1HKLM</code><span style="color: #DD0000">"SOFTWARE\Microsoft\MicrosoftSQLNativeClient\CurrentVersion""Version"
</span>
</pre>I have three sections that can be installed independent of one another that use SQL Express. I check in each section to see if SQL Express is installed (I do not want to install it if it is already there) by using the above command.<br />
      <br />
      If I run the installer and select two or more of the sections that run this check, all three will download and run the SQL.<br />
      <br />
      If I only choose one section the rerun the installer and add another section, the check works and the SQL is not loaded.<br />
      <br />
      I ran a test. I installed just one of the sections then put in code to halt the install. I had opened regedit prior to starting the installer. The regedit did not show the added key and value at the break. I then closed and restarted regedit and the key was there.<br />
      <br />
      I added a message box to display $R1 but it was blank all three times during the first run that SQL was not previously installed. If SQL was there before I ran the SQLinstaller, $R1 displayed the Version number.<br />
      <br />
      How do I get my installer to notice that a new registry key has been added without requiring the installer to be closed and restarted?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">goldy1064</span><br />
      <span class="post-time small text-muted">11th May 2007 23:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Why not put the entire SQL Express check/install into one hidden section that is only run if any of the sections that require it need it?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">12th May 2007 00:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've seen new data appear in RegEdit without closing and reopening it, but sometimes I need to hit F5 Refresh. Have you tried that?<br />
      <br />
      What OS are you running, maybe that makes some difference.<br />
      <br />
      Don</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">12th May 2007 08:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <b>How do I get my installer to notice that a new registry key has been added without requiring the installer to be closed and restarted?</b>
      </blockquote>There isn't such case, installer reads changed registry normally, check this code below,<br />
      <pre>
<code>outfile 'regtest.exe'<br /><br />section -<br /><br />        ReadRegStr $0 HKCU "Software\_Registry_Test" "test"<br />        MessageBox MB_OK "$$0 == {$0}"<br /><br />        IfErrors 0 +4<br /><br />        WriteRegStr HKCU "Software\_Registry_Test" "test" "Registry updated"<br />        ReadRegStr $0 HKCU "Software\_Registry_Test" "test"<br />        MessageBox MB_OK "$$0 == {$0}"<br />        <br />        DeleteRegKey HKCU "Software\_Registry_Test"<br /><br />sectionend</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">chivalri</span><br />
      <span class="post-time small text-muted">13th May 2007 01:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>
      <pre>
<code><br />DetailPrint "Pausing installation while downloaded SQL Express installer runs." <br />  ExecWait '$TEMP\SQLinstaller.exe /qb sapwd=password disablenetworkprotocols=0 securitymode=SQL INSTANCENAME=MSSQLSERVER ADDLOCAL=SQL_Engine'<br /><br />ReadRegStr $R1 HKLM "SOFTWARE\Microsoft\Microsoft SQL Native Client\CurrentVersion" "Version"<br /></code>
</pre><br />
      <br />
      If I run this, $R1 is blank. Exit installer and check registry and this value is set. What am I missing?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">13th May 2007 02:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There's a good chance that the SQLInstaller.exe unpacks some files and then starts another exe. If it exits before the other exe finishes, your script will check the registry before the actual installer has created the entries, but they will be there when you check for them.<br />
      <br />
      Verify the SQLInstaller.exe spawns another process and exits before it finishes with something like ProcExp.exe (Process Explorer) that can be downloaded from <a href="http://www.microsoft.com/technet/sysinternals/ProcessesAndThreads/ProcessExplorer.mspx" target="_blank">SysInternals</a><br />
      <br />
      Don</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
