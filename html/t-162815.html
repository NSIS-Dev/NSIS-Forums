<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Game patch file checking"><title>Game patch file checking - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Game patch file checking</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=162815">Game patch file checking</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">tonefox2</span><br><span class="post-time small text-muted">2nd January 2004 03:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Game patch file checking</strong><br>OK, kichick has helped me to start off on IRC the other day..<br><br>Now, I am stuck at a task that I am not sure if NSIS is capable of.<br><br>I am making a patch for one of my games. I have a demo version of the game, and then I have the full registered version of the game.<br><br>I am makin a universal patch for the game that updates all previous versions to the latest.<br><br>Here's my problem.<br><br>I want the installer to check to see if the user has the demo version installed or the full registered version installed. If they have the demo installed, I want the installer to DISALLOW installation of the patch; and if they do have the full registered version installed, then the installer will continue to patch the game. My reason for this is so that people can't download the demo, and then patch it to get a free full version.<br><br>Anyways, kichik said I could do this with the IfFileExists function.<br><br>Here's what I want it to do. IfFileExists can check all of the user's disk drives for the file "Final Furlong Demo.exe" or "Final Furlong.exe" and then do the corresponding action, either abort installation or continue.<br><br>Is this possible with NSIS or not?<br><br>Much thanks goes out to kichik who helped me get started!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Vytautas</span><br><span class="post-time small text-muted">2nd January 2004 05:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can't do that with IfFileExists command. To acheive that you will have to use these commands: FindFirst, FindNext and FindClose.<br><br>Good luck.<br><br>Vytautas<br><br>P.S. Can you just check to see if the specified file is a demo or not by comparing the file's CRC or something? E.G. Is the game executable for a demo version different from a full version and if so then if you compare the CRC of the demo to the users version and they match then don't install the patch. ;)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tonefox2</span><br><span class="post-time small text-muted">2nd January 2004 08:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">OK,<br><br>I'm sorry. I forget to say that I am making a patch for the FULL REGISTERED version ONLY. If a person wants to update their version of the demo, they can download a WinZip file for free, since it is the demo.<br><br>Can you please outline how I would go about using FindFirst, FindNext, FindClose functions? Maybe a lil example that has to do with my situation?<br><br>Sorry, but the NSIS User Guide doesn't explain HOW to use the functions well.<br><br>Thanks for the help!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">2nd January 2004 12:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You search for a file using FindFirst, FindNext and FindNext like <a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=266" target="_blank">this</a>. But that's <font size="1">(edit)</font>not<font size="1">(/edit)</font> what you want. You don't want to search the entire hard disk, that would be pointless and time consuming. You want the user to direct you to the directory where the game is installed (in the directory page) and not let the user pass to the next page if that directory doesn't contain "Final Furlong.exe". This you do with IfFileExists. The place you should check in is .onVerifyInstDir or the leave function of the directory page. See Examples\waplugin.nsi for an example usage of .onVerifyInstDir and Examples\LobicLib.nsi for an example of a leave function.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tonefox2</span><br><span class="post-time small text-muted">2nd January 2004 20:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">OK,<br><br>Thanks kichik.<br><br>I went to the link you provided, and copied the COMPLETE EXAMPLE. Changed it to look for my game's EXE.<br><br>However, it's not working. For testing, I removed all versions of the game from my computer before running the patch. It didn't seem like it looked for my game's EXE, and it installed with no problems.<br><br>What is the problem?<br><br>Also, if you find any other problems, make sure and point them out, because I remember seeing a lot more bugs post installation after I ran the test patch.<br><br><font size="1"><b>edited by kichik: attach large scripts next time.</b></font></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tonefox2</span><br><span class="post-time small text-muted">3rd January 2004 04:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I want to thank sgt-d for helping me with this..<br><br>The installer now correctly checks to see if the person has the full version of my game installed. If it doesn't it exits.<br><br>sgt-d, you da man!:)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sgt-d</span><br><span class="post-time small text-muted">3rd January 2004 05:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">w00t w00t!<br><br>glad to hear you got it working!<br><br>:)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">3rd January 2004 12:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>Do not copy and paste large scripts, attach them. This helps the forum stay clean and easy to read. The forum provides a vast database of questions and answers regarding NSIS, so it's important it stays clean and easy to read so users may easily find the answer they are looking for.</blockquote></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>