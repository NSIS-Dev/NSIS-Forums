<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="NSIS Unicode 2.42 does not work with new NSIS API lib"><title>NSIS Unicode 2.42 does not work with new NSIS API lib - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">NSIS Unicode 2.42 does not work with new NSIS API lib</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=301796">NSIS Unicode 2.42 does not work with new NSIS API lib</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br><span class="post-time small text-muted">7th January 2009 15:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>NSIS Unicode 2.42 does not work with new NSIS API lib</strong><br>Hello jimpark,<br><br>one of the advantages of NSIS 2.42 is that the /NOUNLOAD is no longer needed for plugins.<br>But I noticed that this does not seem to work with the Unicode version.<br><br>For example the LogEx plugin, which has a normal and a Unicode version.<br>When the normal NSIS version is used it runs OK, but when the Unicode version is used, only the first command is executed (which was the case with previous NSIS versions).<br>When I put back the /NOUNLOAD option for every command, the Unicode script runs OK.<br><br>Can you have a look at this?<br><br>Best regards,<br>JP</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jimpark</span><br><span class="post-time small text-muted">7th January 2009 19:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hey JP,<br><br>I'm looking at the source and I noticed only one pluginapi.lib. Unfortunately, we need to have two different ones. One for ANSI and another for Unicode. The stacks are actually different -- one being buffers of wide characters and the other being buffers of chars. So I think the problem is probably due to the fact that it's linking to the wrong lib. For the Unicode one, you'll need to copy the Unicode NSIS 2.42's pluginapi.lib instead.<br><br>And yes, this does complicate things for the plugin developers when they want to support both the Unicode NSIS and the ANSI. Put the libs in two different directories and create two different targets for your project, one for ANSI and one for Unicode. Then each of the projects can go out and link to the right lib.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jimpark</span><br><span class="post-time small text-muted">7th January 2009 19:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Also, I think I forgot to include the nsis_tchar.h file in the install also. So that will be fixed in 2.42.1.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br><span class="post-time small text-muted">7th January 2009 21:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi jimpark,<br><br>thanks for looking into this.<br>Linking the Unicode Plugin with the Unicode pluginapi.lib (renamed it to pluginapiU.lib for convenience) together with your intermediate Unicode NSIS version made it work.<br><br>When do you think it will be released?<br><br>Best regards,<br>Jan Pieter</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jimpark</span><br><span class="post-time small text-muted">7th January 2009 21:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, I've asked a few others who had problems with the new release to see if this release fixes all their issues. I've fixed all the issues I know about so far. I've also added a few things to help out with writing scripts that will work for both ANSI and Unicode.<br><br>For example, one of the things I've added to the System plugin is System::StrAlloc N which allocates a string buffer for N number of <i>characters</i> rather than just bytes. So System::StrAlloc 1024 will allocate 1024 bytes for ANSI NSIS while it will allocate 2048 bytes for Unicode NSIS. Another thing I've added is a predefined macro NSIS_CHAR_SIZE. This will be 1 for ANSI and 2 for Unicode. So if you are doing math and you want to know how many bytes you need to move forward for the string, you can use ${NSIS_CHAR_SIZE}. And there's of course ${NSIS_UNICODE} which is only defined in the Unicode NSIS. But that's been around for a while.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>