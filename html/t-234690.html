<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="execwait and batch-files"><title>execwait and batch-files - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">execwait and batch-files</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=234690">execwait and batch-files</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">simplex2k4</span><br><span class="post-time small text-muted">4th January 2006 13:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>execwait and batch-files</strong><br>hello everyone,<br><br>i'm new to nsis and i'm delaing with it several days. it's impressing how easy nsis is handeled.<br><br>today i ran into a problem concerning the execwait command with executing batchfiles. this doesn't work for me.<br><br>i tried many times after searching the forum here for hints. all hints seem to be logic for me, unfortunately doesn't work.<br><br>here is my problem-code:<br><br>Execwait "$instdir\mplot\cmd.win\madmin.bat"<br><br>also tried with using comspec-env var and nsexec and this<br><br>Exec 'start /wait "$instdir\mplot\cmd.win\madmin.cmd"'<br><br>as suggested here in the forum.<br><br>the batchfile contents:<br><br>setlocal<br>set MQUEST_INSTL=C:\Ideas\IdeasNX\mplot<br>set MQUEST_SHARED=%MQUEST_INSTL%\bin\i686_nt<br>call "%MQUEST_INSTL%\cmd.win\mquest_varbs.cmd"<br>start "Title" "%MQUEST_SHARED%\mqxwish.exe" "%MQUEST_INSTL%\madmin\madmin.mqx" -- %*<br>endlocal<br><br><br>i also tried programming the lines directly into nsis-script - also not working:<br><br>SetOutPath "$INSTDIR\mplot\cmd.win"<br>exec "setlocal"<br>Exec "set MQUEST_INSTL=C:\Ideas\IdeasNX\mplot"<br>Exec "set MQUEST_SHARED=%MQUEST_INSTL%\bin\i686_nt"<br>SetOutPath "$INSTDIR\mplot\cmd.win"<br>Exec "$instdir\mplot\cmd.win\mquest_varbs.cmd"<br>SetOutPath "$INSTDIR\bin\i686_nt"<br>Execwait '"%MQUEST_SHARED%\mqxwish.exe" "%MQUEST_INSTL%\madmin\madmin.mqx"'<br>Exec "endlocal"<br><br><br>i don't know if there is any command which checks a certain process. this could do the job. the exe-file above is the important thing to me. maybe i have an error in the code above? if yes - sorry for that but i can't see the anything wrong.<br><br><br>i noticed that a 'pause' command is the only thing which really make nsis waiting.<br><br><br>thanks in advance for your help.<br><br>greetings<br>simplex</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Takhir</span><br><span class="post-time small text-muted">4th January 2006 14:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Can you explain what not works? mqxwish.exe not starts? With nsExec you can use ExecToLog to see batch output. And <a href="http://nsis.sourceforge.net/ExecDos" target="_blank">ExecDos</a> also can redirect output to file. BTW Exec "set.. not works, because set is not an executable file but command line processor directive. This may help <a href="http://nsis.sourceforge.net/Setting_Environment_Variables" target="_blank">http://nsis.sourceforge.net/Setting_...ment_Variables</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">simplex2k4</span><br><span class="post-time small text-muted">4th January 2006 15:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">hello takhir,<br><br>thank you for your support.<br><br>mqxwish.exe always starts but installer finishes always before closing the exe.program.<br><br>i also tried execdos but without success.<br><br><br><br>the link you postet i quite good. i gave it a try and wrote following code with including WriteEnvStr.nsh as listed on that page:<br><br>!define ALL_USERS<br>!include WriteEnvStr.nsh # or the name you chose<br><br>Function startmadmin<br><br>Push "MQUEST_INSTL"<br>Push "$instdir\mplot"<br>Call WriteEnvStr<br>Push "MQUEST_SHARED"<br>Push "$instdir\mplot\bin\i686_nt"<br>Call WriteEnvStr<br><br>Execwait '"$instdir\mplot\bin\i686_nt\mqxwish.exe" "$instdir\mplot\madmin\madmin.mqx"'<br><br>FunctionEnd<br><br><br>nsis waits for the mqxwish.exe but the exe can't read the env-vars.<br><br>any suggestions?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Takhir</span><br><span class="post-time small text-muted">4th January 2006 17:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sorry, I had doubts when wrote previous post, but now I found this in MSDN : "The SetEnvironmentVariable function sets the value of an environment variable for the current process." And finally I cannot understand the idea of WriteEnvStr (using kernel32::SetEnvironmentVariable).<br>So the problem is following: installer not waits for batch file exit? May be mqxwish.exe starts some other application?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">simplex2k4</span><br><span class="post-time small text-muted">5th January 2006 06:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">So the problem is following: installer not waits for batch file exit? -&gt; correct.<br><br>the strange thing is that with the writeenvstr funtcion the env-vars schould be set even the machine is rebooted. this says the description: <a href="http://nsis.sourceforge.net/Setting_Environment_Variables" target="_blank">http://nsis.sourceforge.net/Setting_...ment_Variables</a><br>please see the paragraph between the first two code-segments.<br><br>May be mqxwish.exe starts some other application? -&gt;<br>mqxwish.exe is a kind of command shell which starts an special script file (madmin.mqx). that's why the command line is executed with this parameter: "$instdir\mplot\madmin\madmin.mqx"<br><br>task manager says no other program is running when mqxwish.exe does.<br><br><br>another idea of mine was to compile the batch file to an com or exe-file and wait for this. i tried with sharware program which can do such a compilation. and it works -<br><br>BUT<br><br>there is always either an advertisement showing up or the user has to press a button to continue - that is not acceptabel for me.<br>btw do you know batch compilers which are open source or freeware?<br><br>this would be an alternative way and the nsis-command is an "easy-going".<br><br>greetings,<br><br>simplex</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">simplex2k4</span><br><span class="post-time small text-muted">5th January 2006 09:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>solution!</strong><br>hello again takhir,<br><br>i've a solution right now!<br><br>it's quite simple but never thought about:<br><br>in the batch-file there is already a commandline "start" - this command supports the internal switch "/wait".<br><br>whole command in the batch-file looks like this:<br><br>start /wait "Title" "%MQUEST_SHARED%\mqxwish.exe" "%MQUEST_INSTL%\madmin\madmin.mqx" -- %*<br><br>and it works!<br><br><br>inspite, many thanks for your support.<br><br>greetings!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Takhir</span><br><span class="post-time small text-muted">5th January 2006 11:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">No I see :)<br>Your batch file launches mqxwish.exe in the new window (with new cmd) and this is why first cmd not waits. Are you sure this is really need? Or you want to start 2 applications?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">simplex2k4</span><br><span class="post-time small text-muted">10th January 2006 07:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">hello again,<br><br>sorry for my absence.<br><br>in the meantime i completed the installer and all works fine.<br><br>the command line i mentioned in my last post is correct/necessary. i tried many situations but this is the only thing which works.<br><br>thanx<br><br>simplex</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>