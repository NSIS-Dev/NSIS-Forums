<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Newbee question - how does the program flow work?" />

  <title>Newbee question - how does the program flow work? - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Newbee question - how does the program flow work?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=234799">Newbee question - how does the program flow work?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tbednarz</span><br />
      <span class="post-time small text-muted">5th January 2006 18:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Newbee question - how does the program flow work?</strong><br />
      I need to show pages depending on user input. If a user installs the software he can register as a new user and gets a new subscriber license or if the user already has such a license and just needs to reinstall the software he just can enter his subscriber key.<br />
      <br />
      So I have to show a page asking whether he has a subscription key or not. Depending on the answer I have to show diffenent pages and the following actions are somewhat different until the moment where files are copied etc. (If it is a new user he has to enter personal information which is sent over the internet to a database server which returns the license key. If it is an existing user, he has to enter his key which is veryfied on the database server and some data is returned to the setup program.)<br />
      <br />
      Could anybody please explain how such a script needs to be structured? I do not understand, where I can place optional pages. I should do something like:<br />
      <br />
      - do defines<br />
      - include MUI<br />
      - define MUI settings<br />
      - define pages:<br />
      page welcome<br />
      page license<br />
      page question<br />
      if (answer on question is A)<br />
      {<br />
      page A<br />
      page b<br />
      ...<br />
      } else<br />
      {<br />
      page x<br />
      page y<br />
      ...<br />
      }<br />
      <br />
      - installer config<br />
      - sections....<br />
      - functions ...<br />
      <br />
      To check the return values of the question page I need to call:<br />
      <br />
      !insertmacro MUI_INSTALLOPTIONS_READ "SubscriptionType.ini" $ST_NEW "Field 1" "State"<br />
      <br />
      But this statement can be executed only within a section or function. But I have to declare my pages earlier. (See pseudo code above). So how does this work? Do I need to make hidden sections for each case? And how do I assign pages to sections (or sections to pages)?<br />
      <br />
      Many thanks for your help<br />
      <br />
      Tom</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th January 2006 18:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You cannot condition the deceleration of a page, however you can <a href="http://nsis.sourceforge.net/Skipping_Pages" target="_blank">skip pages</a>.<br />
      <br />
      Deceleration of a custom page requires a function name. That function is responsible of calling the plug-in that creates the page. In that function, you can also check the return values of the page. There's no need to create a section for it.<br />
      <br />
      The complete flow of the installer is described in the <a href="http://nsis.sourceforge.net/Docs/Chapter2.html" target="_blank">tutorial</a>. If after reading the tutorial something is still unclear, please let us know so the tutorial can be improved.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tbednarz</span><br />
      <span class="post-time small text-muted">5th January 2006 22:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks a lot. "Skipping pages" is a good hint but I still do not fully understand: I need to skip multiple pages and I have the impression 'Abort' stops the installation completely. I also get an error using the following code:<br />
      <br />
      !insertmacro MUI_PAGE_WELCOME<br />
      !define MUI_LICENSEPAGE_CHECKBOX<br />
      !insertmacro MUI_PAGE_LICENSE $(myLicenseData)<br />
      Page custom SubscriptionType<br />
      !define MUI_PAGE_CUSTOMFUNCTION_PRE SubsKeyPre<br />
      Page custom SubscriptionKey<br />
      !define MUI_PAGE_CUSTOMFUNCTION_PRE SubsDataPre<br />
      Page custom SubscriberData<br />
      <br />
      !insertmacro MUI_PAGE_INSTFILES<br />
      !insertmacro MUI_PAGE_FINISH<br />
      <br />
      If I define MUI_PAGE_CUSTOMFUNCTION_PRE twice I get an error.<br />
      <br />
      The page SubscriptionType asks the user if he is already a subscriber. If he says NO the page SubscriptionKey should be skipped, if he says YES, the page SubscriberData should be skipped.<br />
      <br />
      I defined the following functions:<br />
      <br />
      Function SubsKeyPre<br />
      ${If} $IsNewSubscriber == 0<br />
      Abort<br />
      ${EndIf}<br />
      FunctionEnd<br />
      <br />
      Function SubsDataPre<br />
      ${If} $IsNewSubscriber == 1<br />
      Abort<br />
      ${EndIf}<br />
      FunctionEnd<br />
      <br />
      I guess I still misunderstand something, it does not work as expected!<br />
      <br />
      Tom</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">5th January 2006 23:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The MUI_PAGE_CUSTOMFUNCTION_PRE defines are for MUI_PAGE_* macros only... not for Custom pages.<br />
      For Custom pages you do not need to call Abort at all, but simply skip over the InstallOptions plugin call (or MUI_INSTALLOPTIONS_DISPLAY) instead.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th January 2006 08:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've added information about skipping custom pages to the FAQ item.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tbednarz</span><br />
      <span class="post-time small text-muted">6th January 2006 09:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you all very much. Got it now and it works just fine!<br />
      <br />
      Tom</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
