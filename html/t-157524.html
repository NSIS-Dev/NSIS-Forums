<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="spaning disks"><title>spaning disks - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">spaning disks</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=157524">spaning disks</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">dougburton0721</span><br><span class="post-time small text-muted">25th November 2003 06:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>spaning disks</strong><br>I am having a hard time getting this to work right.<br><br>Section "Maximum Force CHD Image"<br><br>;Installation of MAXFORCE CHD<br><br>MessageBox MB_OKCANCEL "Insert M.A.M.E. 0.77 Disk 16 (Maxforce disk 1) and Press 'OK' to install. WARNING!!!: THE AUTOMATIC INSTALLATION OF THIS FILE TEMPORARILY MAY REQUIRE APPROXIMATELY 3 GB's OF FREE DISK SPACE. THE FINAL SIZE WILL BE APPROXIMATELY 1.08 GB's AFTER AUTO-CLEANUP" IDCANCEL FINISH2<br><br>MessageBox MB_OKCANCEL "If you do not have enough disk space to install Maximum Force using this installer, you can manually copy the files and extract them with a program such as Winrar. Press OK to continue" IDCANCEL FINISH2<br>; Set output path to the installation directory.<br>SetOutPath $INSTDIR\TEMP<br>; Put file there<br>CopyFiles "$EXEDIR\MAXFORCE\*.*" "$INSTDIR\TEMP"<br><br>MessageBox MB_OKCANCEL "Insert M.A.M.E. 0.77 Disk 17 (Maxforce disk 2, WarGods &amp; Killer Instinct 2) and Press 'OK' " IDCANCEL FINISH2<br>; Set output path to the installation directory.<br>SetOutPath $INSTDIR\TEMP<br>; Put file there<br>CopyFiles "$EXEDIR\COPYING.EMX" "$INSTDIR\TEMP"<br>CopyFiles "$EXEDIR\COPYING.RSX" "$INSTDIR\TEMP"<br>CopyFiles "$EXEDIR\EMX.DLL" "$INSTDIR\TEMP"<br>CopyFiles "$EXEDIR\EMX.EXE" "$INSTDIR\TEMP"<br>CopyFiles "$EXEDIR\RAR32.EXE" "$INSTDIR\TEMP"<br>CopyFiles "$EXEDIR\RARFILES.LST" "$INSTDIR\TEMP"<br>CopyFiles "$EXEDIR\RSX.EXE" "$INSTDIR\TEMP"<br>CopyFiles "$EXEDIR\MAXFORCE\*.*" "$INSTDIR\TEMP"<br>EXECWAIT "$INSTDIR\TEMP\rar32.exe e *.rar"<br>SetOutPath $INSTDIR\ROMS\MAXFORCE<br>SetFileAttributes "$INSTDIR\ROMS\MAXFORCE" NORMAL<br>CopyFiles "$INSTDIR\TEMP\MAXFORCE.CHD" "$INSTDIR\ROMS\MAXFORCE"<br>*****************errors out******************<br>SetFileAttributes "$INSTDIR\TEMP\*.*" NORMAL<br>SetFileAttributes "$INSTDIR\TEMP" NORMAL<br>RMDir /r "$INSTDIR\TEMP"<br>FINISH2:<br>SectionEnd<br><br>the setup.exe file is on disk 1, and being run from the cd. After it copies the files over, I get an error message that the wrong volume disk is in the drive then it errors out. Any ideas on how to correct.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">25th November 2003 07:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Have you copied setup.exe to a local directory? Keeping a program from a CD-ROM running and getting the CD-ROM out usually brings trouble. You should first copy setup.exe to $TEMP and run it from there.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dougburton0721</span><br><span class="post-time small text-muted">25th November 2003 07:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I am really new when it comes to programming. Do have the code to do this? Also wouldn't that cause problems with the CopyFiles $exedir as now it would be pointing to where the setup file is now instead of the cd?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">25th November 2003 07:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I don't know any full example that does that. But it's not that complicated, you'll live :)<br><br>To get the EXE name you can parse $CMDLINE or simply use:<br><br>System::Call "Kernel32::GetModuleFileName(i 0, t .r0, i ${NSIS_MAX_STRLEN})"<br><br>This line will put the EXE's path in $0.<br><br>After you have the path of the setup EXE, you simply copy it to $TEMP and execute it with a special command line parameter that will let it know that it is no longer on the CD. Something like /NOCD should do the trick.<br><br>$EXEDIR would indeed be different, so you should send that too in the command line.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dougburton0721</span><br><span class="post-time small text-muted">25th November 2003 07:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">so to copy it over, and execute it you would have something like this:<br><br>System::Call "Kernel32::GetModuleFileName(i 0, t .r0, i ${NSIS_MAX_STRLEN})"<br>CopyFile "$0\setup.exe" "$Instdr\temp1"<br>Exec "$InstDr\temp1\setup.exe" /NOCD</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">25th November 2003 07:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">GetModuleFileName returns the full path, including the executable name, which you can't trust to be setup.exe. I'd make sure $INSTDIR\temp1 exists first. Also, the Exec line is wrong and doesn't include $EXEDIR. You shold use:<br><br>System::Call "Kernel32::GetModuleFileName(i 0, t .r0, i ${NSIS_MAX_STRLEN})"<br>CreateDirectory $INSTDIR\temp1<br>CopyFile "$0" "$INSTDIR\temp1"<br>Exec '"$InstDr\temp1\setup.exe" /NOCD $EXEDIR'<br><br>You should also parse the command line ($CMDLINE) for /NOCD and $EXEDIR. If it's there, no need to respawn the installer again.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dougburton0721</span><br><span class="post-time small text-muted">25th November 2003 08:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Forgive me for being stupid, but how would I parse the $cmdline?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">25th November 2003 08:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Search the Archive for $CMDLINE, it contains some examples.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">cosmic66</span><br><span class="post-time small text-muted">27th November 2003 12:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I have written a script that does what you need:<br>on the first launch the installer copies itself to<br>the HD, launches the installer file from<br>the HD and exits.<br><br>Example script is attached.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dougburton0721</span><br><span class="post-time small text-muted">27th November 2003 17:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks Cosmic66<br><br>Quick question, does the code make $R2 be the cd-rom drive directory? ie cd-rom is e:\ and so is $R2?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dougburton0721</span><br><span class="post-time small text-muted">28th November 2003 06:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I've just about got it all figured out now. The only problem I am having, is when I add the new code in, which copies the setup over to the hard drive and runs it from there, it skips my section on having it ask the person where to install the files, along with what files they want to install. It goes directly into copying all the files.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">cosmic66</span><br><span class="post-time small text-muted">29th November 2003 11:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I have downloaded your script and when I compile and run it,<br>it shows component and directory page (I'm using MakeNSIS v2.0b4).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dougburton0721</span><br><span class="post-time small text-muted">30th November 2003 03:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I was running MakeNSIS v2.0b3. So I downloaded verion 2.0b4, recompiled the script. Tested it, and all is well. Thanks for all your help, especially your script cosmic66. Works great.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>