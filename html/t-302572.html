<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Confused about calling wininet" />

  <title>Confused about calling wininet - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Confused about calling wininet</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=302572">Confused about calling wininet</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ghillerson</span><br />
      <span class="post-time small text-muted">30th January 2009 00:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Confused about calling wininet</strong><br />
      I'm trying to call perl scripts on a server using wininet. I can run this code from<br />
      <br />
      The function below runs from inside VBA; what I'd like to do is craft an NSIS version of it. I know I can call System::wininet, but i'm new to NSIS and struggling to understand how to pass parameters and get results for specific inet functions. Specifically, how to emulate the calls to InternetOpen and InternetOpenUrl below. Any pointers appreciated<br />
      <br />
      -----<br />
      Function GetServerScriptResponse(sUrl As String) As String<br />
      Dim s As String<br />
      Dim hOpen As Long<br />
      Dim hOpenUrl As Long<br />
      Dim bDoLoop As Boolean<br />
      Dim bRet As Boolean<br />
      Dim sReadBuffer As String * 2048<br />
      Dim lNumberOfBytesRead As Long<br />
      <br />
      hOpen = InternetOpen(scUserAgent, INTERNET_OPEN_TYPE_PRECONFIG, vbNullString, vbNullString, 0)<br />
      hOpenUrl = InternetOpenUrl(hOpen, sUrl, vbNullString, 0, INTERNET_FLAG_RELOAD, 0)<br />
      <br />
      bDoLoop = True<br />
      While bDoLoop<br />
      sReadBuffer = vbNullString<br />
      bRet = InternetReadFile(hOpenUrl, sReadBuffer, Len(sReadBuffer), lNumberOfBytesRead)<br />
      s = s &amp; Left$(sReadBuffer, lNumberOfBytesRead)<br />
      If Not CBool(lNumberOfBytesRead) Then bDoLoop = False<br />
      Wend<br />
      <br />
      If hOpenUrl &lt;&gt; 0 Then InternetCloseHandle (hOpenUrl)<br />
      If hOpen &lt;&gt; 0 Then InternetCloseHandle (hOpen)<br />
      GetServerScriptResponse = s<br />
      End Function<br />
      -----<br />
      <br />
      Here are the declarations it uses:<br />
      Private Const INTERNET_OPEN_TYPE_PRECONFIG = 0<br />
      Private Const INTERNET_OPEN_TYPE_DIRECT = 1<br />
      Private Const INTERNET_OPEN_TYPE_PROXY = 3<br />
      <br />
      Private Const scUserAgent = "VB OpenUrl"<br />
      Private Const INTERNET_FLAG_RELOAD = &amp;H80000000<br />
      <br />
      Public Declare Function InternetOpen Lib "wininet.dll" Alias "InternetOpenA" _<br />
      (ByVal sAgent As String, ByVal lAccessType As Long, ByVal sProxyName As String, _<br />
      ByVal sProxyBypass As String, ByVal lFlags As Long) As Long<br />
      <br />
      Public Declare Function InternetOpenUrl Lib "wininet.dll" Alias "InternetOpenUrlA" _<br />
      (ByVal hOpen As Long, ByVal sUrl As String, ByVal sHeaders As String, _<br />
      ByVal lLength As Long, ByVal lFlags As Long, ByVal lContext As Long) As Long<br />
      <br />
      Public Declare Function InternetReadFile Lib "wininet.dll" _<br />
      (ByVal hFile As Long, ByVal sBuffer As String, ByVal lNumBytesToRead As Long, _<br />
      lNumberOfBytesRead As Long) As Integer<br />
      <br />
      Public Declare Function InternetCloseHandle Lib "wininet.dll" _<br />
      (ByVal hInet As Long) As Integer</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">30th January 2009 07:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can also use 100% wininet.dll based <a href="http://nsis.sourceforge.net/Inetc_plug-in" target="_blank">http://nsis.sourceforge.net/Inetc_plug-in</a> plug-in. Just put inetc.dll to your C:\Program Files\NSIS\plugins folder and compile sample for the beginning.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ghillerson</span><br />
      <span class="post-time small text-muted">30th January 2009 18:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>still confused</strong><br />
      I saw inet::get and inet::put but it looked to me like those were for posting to a form and getting back from a form (and i'm a bit ignorant about these things). From your response, i'm guessing that i can call my perl script with get for functionality equivalent to calling InternetOpen and then reading the results.<br />
      <br />
      I'll give it a try tonite. Thanks<br />
      <br />
      G</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">30th January 2009 18:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You should call it from NSIS installation script (like this is done in inetc examples), not from perl. Plug-in puts server reply to local file (last parameter), but you can use text handling macros to handle this file directly from NSIS script as well.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ghillerson</span><br />
      <span class="post-time small text-muted">31st January 2009 03:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Thanks</strong><br />
      Thanks so much! I called a script and got back the expected response, which puts me well on my way to implementing my registration handler in my first NSIS script. Way easier than i thought it would be, and thanks again for your help.<br />
      <br />
      - G</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
