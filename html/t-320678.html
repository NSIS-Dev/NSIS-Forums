<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="NSIS 'ifnewer'"><title>NSIS 'ifnewer' - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">NSIS 'ifnewer'</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=320678">NSIS 'ifnewer'</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">nedloh</span><br><span class="post-time small text-muted">9th July 2010 20:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>NSIS 'ifnewer'</strong><br>The product I work on at one point used installshield and now uses NSIS.<br><br>I have an issue though, when trying to install a new version of the product over an old version, if the old version is old enough to have been installed with installshield, then certain files fail to get overwritten, which causes major problems in the product.<br><br>I lay no blame on NSIS but I am wondering how the NSIS ifnewer option is handled? How does it check if it's newer?<br><br>If it goes by the last modified date and time, then someone else must be wrong because even when the last modified date is a full year old this problem has been reported.<br><br>Thanks.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">demiller9</span><br><span class="post-time small text-muted">9th July 2010 22:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Perhaps InstallShield is 'repairing' the old files and replacing your new ones with cached versions of the originals. That is a feature of InstallShield, perhaps the biggest reason I switched from InstallShield to NSIS.<br><br>You might want to wipe out the InstallShield cache (I found it in $Windir\Installer\xxxx.msi)<br><br>Here's the code I have in one of my installers. You'll have to look up the GUID for your own installer and modify this code to delete the keys/files for your own installer.</p><pre>
<code>ClearErrors<br>ReadRegStr $R0 HKLM "${Uninstall_KEY}\InstallShield_{BE1DC3D5-CF2A-4165-B7FF-8228BE17F47B}" "DisplayVersion"<br>${Unless} ${Errors}<br>  DetailPrint "Cleaning ARP entry"<br>  # delete the old InstallShield ARP entry<br>  DeleteRegKey HKLM "${Installer_CLASSES_KEY}\5D3CD1EBA2FC56147BFF2882EB714FB7"<br>  DeleteRegKey HKLM "${Installer_CLASSES_Features}\5D3CD1EBA2FC56147BFF2882EB714FB7"<br>  DeleteRegKey HKLM "${Uninstall_KEY}\InstallShield_{BE1DC3D5-CF2A-4165-B7FF-8228BE17F47B}"<br>  DeleteRegKey HKLM "${Uninstall_KEY}\InstallShield Uninstall Information\{BE1DC3D5-CF2A-4165-B7FF-8228BE17F47B}"<br>  DeleteRegKey HKLM "${Uninstall_KEY}\{BE1DC3D5-CF2A-4165-B7FF-8228BE17F47B}"<br>  ReadRegStr $R0 HKLM "${Installer_KEY_PRD}\5D3CD1EBA2FC56147BFF2882EB714FB7\InstallProperties" "LocalPackage"<br>  Delete $R0                    ; C:\Winnt\Installer\xxxxx.msi<br>  StrCpy $R0 "$WINDIR\Installer\{BE1DC3D5-CF2A-4165-B7FF-8228BE17F47B}"<br>  RmDir /r $R0<br>  DeleteRegKey HKLM "${Installer_KEY_PRD}\5D3CD1EBA2FC56147BFF2882EB714FB7"<br>  DeleteRegKey HKLM "${Installer_KEY_UPG}\E48C006C5E337CB49B506DC4ACAD1D84"<br>  DeleteRegValue HKLM "${Installer_KEY_Fld}" "$R0\"<br>${EndUnless}</code>
</pre><br>
      Notice that the two different GUIDS are related to each other: the one beginning "BE1DC3D5-CF2A-" and the one "5D3CD1EBA2FC" are the same basic values with the sections between dashes written in reverse when they leave out the dashes.
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>