<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="installing fonts on Vista" />

  <title>installing fonts on Vista - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">installing fonts on Vista</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=279398">installing fonts on Vista</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">GDMVET</span><br />
      <span class="post-time small text-muted">19th October 2007 11:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>installing fonts on Vista</strong><br />
      Hi all,<br />
      <br />
      I'm having problems installing a font in de $FONTS directory of Windows Vista.<br />
      <br />
      I use this code which works great on Windows XP<br />
      <br />
      To copy the font :<br />
      <br />
      SetOutPath $FONTS<br />
      File "Vet-Files.ttf"<br />
      <br />
      To use the font without restarting Windows :<br />
      <br />
      GetTempFileName $R0<br />
      SetOverwrite On<br />
      File /oname=$R0 fonts.dll<br />
      ;SetOverwrite ifnewer<br />
      <br />
      Push "Vet-Files.TTF"<br />
      CallInstDLL $R0 registerFont<br />
      <br />
      I understand you can't copy files into system directories because of UAC.<br />
      <br />
      I've tried the UAC.dll plugin.<br />
      I've also tried using RequestExecutionLevel user<br />
      <br />
      But nothing works :(<br />
      <br />
      Any help would be appreciated.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">19th October 2007 12:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Where exactly does it fail? Does it not copy the font file at all? Does it fail registering?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">GDMVET</span><br />
      <span class="post-time small text-muted">19th October 2007 15:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It fails to copy the font in the $FONTS directory. The funny thing is that it does register the font. So my program runs normal shortly after installation, but not anymore after you restart the computer, because the font wasn't copied to the $FONTS directory.<br />
      <br />
      I try to package a demo-version of a database program.<br />
      Another frustrating thing is that you can't add new items in the demo-version because Windows Vista only allows users to view the data, not update it. Unless you turn of UAC which isn't the best way to go off course.<br />
      <br />
      You can see screenshots of my program on my website wwww.vet-files.com</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">19th October 2007 15:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I bet the font is actually installed under %APPDATA%\Windows\Fonts. Use <i>RequestExecutionLevel admin</i> and it should be able to write to C:\Windows\Fonts.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">GDMVET</span><br />
      <span class="post-time small text-muted">19th October 2007 15:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I can't find it under %APPDATA%<br />
      <br />
      This is the very simple code I use :<br />
      <br />
      RequestExecutionLevel admin<br />
      Name "Font"<br />
      OutFile "font.exe"<br />
      <br />
      Page instfiles<br />
      <br />
      Section ""<br />
      <br />
      SetOutPath "C:\Windows\Fonts"<br />
      File Vet-Files.ttf<br />
      <br />
      SectionEnd<br />
      <br />
      <br />
      I've got the latest version of NSIS (2.31) (which by the<br />
      way is a very nice program)<br />
      <br />
      I don't know what i'm doing wrong.<br />
      On my Windows XP this code works perfect.<br />
      <br />
      :(</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">19th October 2007 16:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Vista has some automatic file redirection when it comes to the system directory. It's usually disabled when you use RequestExecutionLevel. I don't know why it keeps redirecting in this case. Maybe if we find out where it redirects, it'll shed some light. Can you search the entire HD for vet-files.ttf?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">GDMVET</span><br />
      <span class="post-time small text-muted">19th October 2007 16:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've searched the entire HD but can't find "vet-files.ttf" anywhere :(<br />
      <br />
      (except off course in my own maps in program files)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">19th October 2007 16:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try running <a href="http://www.microsoft.com/technet/sysinternals/utilities/filemon.mspx" target="_blank">FileMon</a> in the background to see where it actually tries to write it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br />
      <span class="post-time small text-muted">19th October 2007 17:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just an idea:<br />
      It might actually copy the font in C:\Windows\Fonts correctly, but the search feature of windows scan the "Fonts" folder differently that a standard folder and search through the registered fonts rather than the actual files.<br />
      (use a DOS box to "dir" the content of this folder)<br />
      <br />
      Try adding the registerFont call to your latest scripts ?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">GDMVET</span><br />
      <span class="post-time small text-muted">19th October 2007 17:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Wizou,<br />
      <br />
      You're right !!! I used the dos box to scan for my font and it was there ! Process Monitor already showed me that the font was copied correctly to the fonts folder.<br />
      <br />
      So I changed my simple code to this :<br />
      <br />
      RequestExecutionLevel admin<br />
      Name "Font"<br />
      OutFile "font.exe"<br />
      <br />
      Page instfiles<br />
      <br />
      Section ""<br />
      <br />
      SetOutPath "C:\Windows\Fonts"<br />
      File Vet-Files.ttf<br />
      <br />
      sectionEnd<br />
      <br />
      Section "Font"<br />
      <br />
      GetTempFileName $R0<br />
      SetOverwrite On<br />
      File /oname=$R0 fonts.dll<br />
      Push "Vet-Files.TTF"<br />
      CallInstDLL $R0 registerFont<br />
      <br />
      SectionEnd<br />
      <br />
      What happens is it registers the font correct, but only once. When I restart Windows, it's not registered and my font doesn't show up anymore.<br />
      <br />
      Any ideas ? Is there another way to register a font in Vista ?<br />
      <br />
      Thx already for all the great responses<br />
      <br />
      So there must be a different code for registering the font in Vista !</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">21st October 2007 20:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I tried using the <a href="http://nsis.sourceforge.net/Register_Fonts" target="_blank">http://nsis.sourceforge.net/Register_Fonts</a> example, and it seems to work fine in Vista after a reboot</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">GDMVET</span><br />
      <span class="post-time small text-muted">22nd October 2007 09:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Anders,<br />
      <br />
      Thx for the link you provided. I already played around with FontReg.nsh awhile ago, but couldn't get it to work back then. Now I can, so my font problem is solved !<br />
      It works perfect both under XP and Vista, even after rebooting.<br />
      Thanks alot everyone for pointing in me in the right direction.<br />
      <br />
      Now there's still one big hurdle for me to overcome deploying my demo-version on Windows Vista : my demo contains a database with a backend and a frontend. The backend sits in a subfolder of $ProgramFiles\Vet-Files-Demo.<br />
      The problem is that Vista doesn't allow users to change data in the backend. I can only overcome this by letting users disable UAC on their computer, which is something I rather don't want to do. Is there a simple workaround ? Am I doing something stupid here ? I'm not really a programmer, I'm more more like a selfmade amateur ;) Any tips would be appreciated.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">22nd October 2007 10:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Give normal users write access to that folder with <a href="http://nsis.sourceforge.net/AccessControl_plug-in" target="_blank">http://nsis.sourceforge.net/AccessControl_plug-in</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">GDMVET</span><br />
      <span class="post-time small text-muted">22nd October 2007 11:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Anders,<br />
      <br />
      Thx for the link ! Works like a charm !<br />
      All my hurdles are overcome ;) I'm gonna start burning now !<br />
      Thx everybody for the great support.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
