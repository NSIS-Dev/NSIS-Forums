<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Huge installer file and slow loading..."><title>Huge installer file and slow loading... - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Huge installer file and slow loading...</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=208942">Huge installer file and slow loading...</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">xis</span><br><span class="post-time small text-muted">26th February 2005 23:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Huge installer file and slow loading...</strong><br>Hi, i haven't found any information about this ...<br>i am using NSIS to build an installer for a little software but in need an installer for the huge ressources files (something like 2.50 gigs).<br>so my installer's exe size is 1.55 gigs.<br><br>as i'm want to burn the file on a dvd-r for distribution, it takes a very long time to start my installer, maybe 10 / 15 minutes ? maybe more ...<br>anyway it should not wait even 30 seconds ...<br><br>here is my script, do someone knows how to optimise it to have normal performances ?<br>thanks much !<br><br>;--------------------------------<br>; Includes<br>!include "MUI.nsh"<br><br>;--------------------------------<br>; Parameters<br>Name "Software name"<br><br>OutFile "setup.exe"<br>!define MUI_ICON "c:\software\icons\icon.ico"<br>!define MUI_HEADERIMAGE true<br>!define MUI_HEADERIMAGE_BITMAP "c:\software\_Installers\ressources\little.bmp"<br>!define MUI_HEADERIMAGE_BITMAP_NOSTRETCH true<br>!define MUI_HEADERIMAGE_RIGHT true<br>!define MUI_WELCOMEFINISHPAGE_BITMAP "c:\software\_Installers\ressources\pic.bmp"<br>!define MUI_COMPONENTSPAGE_SMALLDESC<br><br>BrandingText " "<br>CRCCheck off<br>InstallDir ""<br>InstallDirRegKey HKLM "SOFTWARE\software" "InstallPath"<br><br><br><br>;--------------------------------<br>; Pages<br><br>!define MUI_ABORTWARNING<br>!insertmacro MUI_PAGE_WELCOME<br>!insertmacro MUI_PAGE_INSTFILES<br>!insertmacro MUI_PAGE_FINISH<br>!insertmacro MUI_LANGUAGE "French"<br><br>;--------------------------------<br>; Installations<br><br>InstType "Full install"<br><br>;--------------------------------<br>; Sections<br><br>Section "-testInstall"<br>SectionIn 1<br><br>StrLen $0 $INSTDIR<br>IntCmp $0 0 NotInstalled NotInstalled Installed<br><br>NotInstalled:<br>MessageBox MB_OK|MB_ICONSTOP "Can't find installation folder in registry"<br>Abort<br><br>Installed:<br>Sectionend<br><br>Section "Full install" sec<br>SectionIn 1<br><br>SetOutPath $INSTDIR<br>File /r files\*.*<br>SectionEnd<br><br>;--------------------------------<br>; Descriptions<br><br>LangString DESC_sec ${LANG_FRENCH} "Full install."<br><br>!insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br>!insertmacro MUI_DESCRIPTION_TEXT ${sec} $(DESC_sec)<br>!insertmacro MUI_FUNCTION_DESCRIPTION_END</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">scully13</span><br><span class="post-time small text-muted">27th February 2005 00:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Instead of including the files in the installer why don't you just copy them from a folder on the DVD using CopyFiles instead of File.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">xis</span><br><span class="post-time small text-muted">27th February 2005 09:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">i wanted to have a single fine installer...<br>but it could be a solution. is there really no solution to speed-up the installer loading ? if moving functions on top of the script ? i seen also ReserveFile instruction, it told it could help in such case , but i don't see how ... in fact, would be good if the script whould be stored at the begining of the installer, and the files at the end .<br>i hoped that disactivating CRC check whould solve the problem , but it's not.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">scully13</span><br><span class="post-time small text-muted">27th February 2005 22:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Try using the no solid compression build and switching to BZIP2 or LZMA compression. I did a test with it and got the start up time from around 20 seconds to 1-2 seconds. I used the LZMA compression. You can download the no solid compression executable from here: <a href="http://nsis.sourceforge.net/download/specialbuilds/" target="_blank">http://nsis.sourceforge.net/download/specialbuilds/</a><br><br>I've never tried the ReserveFile command for a large installer but you would only haver to change your File command to ReserveFile to try it out.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">xis</span><br><span class="post-time small text-muted">28th February 2005 20:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">my problem is rather counting in minutes than seconds :op<br>i tried reservefile, there is no amelioration, and lzma compression is waayyyyy to slow to uncompress for almost same compressed size ... so my solution will be to use ZipDLL and having an installer plus a zip file ... i don't like it much, but .. it's best solution and found, and fastest<br><br>thanks for your help ;)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">1st March 2005 18:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The script is saved at the beginning of the file. The problem is usually with files which are extracted when the installer is loading, but are located at the end of the file. The ReserveFile command is meant to be used on the top of the script with files that needs to be located at the beginning of the file.<br><br>However, your script doesn't even have an .onInit function. Your script doesn't even use solid compression. If solid compression isn't used, it doesn't matter where anything is located in the file. Without solid compression, seeking in the file is very cheap. Do you have an anti-virus? It might be scanning the executable. Check out the task manager when the installer loads and see which process takes the most CPU time.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">genetiq</span><br><span class="post-time small text-muted">6th March 2005 08:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I've got exactly the same problem:<br>1. Total size: about 1Gb (3000 files)<br>2. When I compile and start the resulting *.exe file, it takes 10-12 seconds _before_ even "verifying installer" message shows up (tested on good new HDD, and I don't even trying to burn it :))<br>3. I've tried both solid and non-solid compression methods (LZMA) which gave me almost the same installer startup speed.<br>4. It was an important breakthrough that without solid compression, temp file that has over 600Mb in size is not creating anymore.<br>5. But anyway, startup speed is very low.<br><br>What else can be done to increase startup speed? This factor is very limiting... 10-12 seconds from hdd will be equal to 3-5 minutes from cd/dvd, which render useless large NSIS installers.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">6th March 2005 11:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Which NSIS version are you using?<br><br>Someone had this problem quite a while ago, and I'm wondering if it was fixed (I can't remember).<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">genetiq</span><br><span class="post-time small text-muted">6th March 2005 13:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">2.0.5 release<br>Also tried with CRCCheck off - same thing. "Verifying installer" message is not showing up, but the problem i've described earlier still persists.<br><br>P.S. even 600Mb image is very slow. I wonder if i decide to make my own half-life2 repack... Definitely something should be done with it.<br><br>P.P.S. i've noticed that after this first "frozen" period, the following files are extracted to the %TEMP% folder:<br><br>modern-wizard.bmp<br>InstallOptions.dll<br>ioSpecial.ini<br><br>Those are definitely "NSIS-internal" files because they aree absent in my source directory and i didn't include them with File or ReserveFile directives.<br><br>As far as i can understand, those files somehow located at the end of the archive, but installer tries to decompress them first. But why so long - archive is non-solid... Very odd.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">genetiq</span><br><span class="post-time small text-muted">6th March 2005 13:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Performed another small experiment:<br>1. Speed is independant from compressor (ZLIB/LZMA/etc)<br>2. Speed is independant from user interface (oldstyle/modern).<br><br>As long as oldstyle UI doesn't decompress any files I can only assume that this problem is in NSIS itself. For example, standalone archivers (winrar, 7zip, etc) open 3-4 GB archives with ~10000 files at once.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">8th March 2005 19:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">NSIS performs no time consuming operations before showing the "verifying installer" window. All of the files you've seen in your temporary directory are also extracted after the "verifying installer". Nothing is extracted before the CRC check is done.<br><br>I still believe a virus scan is making the load time so long. I wouldn't be surprised if some anti-virus applications scan NSIS installers after all of the false virus alarms.<br><br>However, I could be missing something. So, to test it, I've created a special build which shows a message box before doing anything. It calls MessageBox on the very top of WinMain, right after the variable definitions. <a href="http://stashbox.org/uploads/1110310277/makensis-load-delay.zip" target="_blank">Download it</a> and let me know how much time it takes the message box to show.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">genetiq</span><br><span class="post-time small text-muted">8th March 2005 22:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks. I've done as you suggested and it became clear that delay occurs when loading any large exe file into memory. Wondering why, i've created another similar installer with InnoSetup and also made self-extracting WinRAR archive . When starting any of those executables, the delay was quite the same.<br><br>Despite that I always disable my anti-virus software before running installers, problem still stays.<br><br>Anyway, it became clear that NSIS is not the origin of this issue.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">robber98</span><br><span class="post-time small text-muted">9th March 2005 21:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Check the codes/functions within ".onInit" function and see if any of those making delay. That's what happened to me before. ;)</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>