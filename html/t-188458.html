<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Writing strings to Non NSIS INI files"><title>Writing strings to Non NSIS INI files - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Writing strings to Non NSIS INI files</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=188458">Writing strings to Non NSIS INI files</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">jimpy22</span><br><span class="post-time small text-muted">31st July 2004 21:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Writing strings to Non NSIS INI files</strong><br>Hi, can someone tell me how to write a user input string requested from a text box during installation into one of my own .ini files (ie not a NSIS .ini file?)<br><br>Thank you in anticipation</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">deguix</span><br><span class="post-time small text-muted">31st July 2004 21:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Use <i>ReadINIStr</i> and after <i>WriteINIStr</i>. See NSIS documentation for details.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jimpy22</span><br><span class="post-time small text-muted">31st July 2004 21:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for your reply. I have been reading documentation and forums for 3 hours now and am just very confused.<br><br>My file ia touch.ini:<br><br>[Software Title]<br>-------------------- Browser System Variables -------------------------------<br><br>--[Address Settings]<br>BrwDefaultAddress=http://IP:77/config_ip.asp?Where=RegX<br>BrwReportAddress=<br><br>--[System Settings]<br>SystemKeys=ON<br>SysDeskTop=ON<br><br>BrowserDiagMode=OFF<br>BrowserKioksMode=OFF<br>BrowserControlBar=ON<br><br>etc etc etc etc<br><br>I want to take an IP address that the user puts into a text box in the installer during installation and write it into the 'IP' bit of this line above BrwDefaultAddress=http://IP:77/config_ip.asp?Where=RegX.<br><br>And then put a value into 'X' in the same line above.<br><br>Can any one give me the code to do that - I have just ended up going around and around in circles for hours!!! Thanks.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">31st July 2004 21:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">it would be easier to first get the text from the textbox<br>then build the whole url with a couple of StrCpy's<br>then write the whole line to the .ini file</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jimpy22</span><br><span class="post-time small text-muted">31st July 2004 21:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I don't even seem to be able to hold on to the text string entered during the installation to be able to re-write the whole line and then replace it in the touch.ini file???</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">deguix</span><br><span class="post-time small text-muted">31st July 2004 21:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><pre>
<code>ReadINIStr $0 "Page.ini" "Field #" "State" ;"IP" value as you said<br>StrCpy $1 "X" ;"X" value as you said<br>WriteINIStr "Touch.ini" "Address Settings" "BrwDefaultAddress" \<br>"http://$0:77/config_ip.asp?Where=Reg$1"</code>
</pre><br>
      <br>
      Replace "Page.ini" with your page INI file, "#" with the number of the "Field" of the textbox that gets the IP.<br>
      <br>
      [EDIT] Ops! Fixed code. [/EDIT]
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">31st July 2004 21:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Using an InstallOptions dialogue, the user will enter the data into the necessary fields. He click's next, and his data will be saved into the InstallOptions INI dialogue file. You can then use ReadINIStr $R0 "IOfile.ini" "Field X" "State" to retrieve the data.<br>
      Then use WriteINIStr "touch.ini" "Address Settings" "http://IP:<b>$R0</b>/config_ip.asp?Where=RegX"<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jimpy22</span><br>
      <span class="post-time small text-muted">31st July 2004 22:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I put:<br>
      ReadINIStr $0 "ioA.ini" "Field 2" "State" ;"IP" value as you said<br>
      ReadINIStr $1 "ioA.ini" "Field 4" "State" ;"X" value as you said<br>
      WriteINIStr "$INSTDIR\PAERS Registration system\iTouch_BR.ini" "Address Settings" "BrwDefaultAddress" "http://$0:77/config_ip.asp?Where=Reg$1"<br>
      <br>
      <br>
      In the main section. After I ran the install the touch.ini file looked like this:<br>
      <br>
      [Software Title]<br>
      <br>
      -------------------- Browser System Variables -------------------------------<br>
      <br>
      --[Address Settings]<br>
      BrwDefaultAddress=<br>
      --http://192.134.0.122:77/config_ip.asp?Where=Reg1<br>
      BrwReportAddress=<br>
      <br>
      --[System Settings]<br>
      SystemKeys=ON<br>
      SysDeskTop=ON<br>
      <br>
      BrowserDiagMode=OFF<br>
      BrowserKioksMode=OFF<br>
      BrowserControlBar=ON<br>
      BrowserBiometrics=ON<br>
      BrowserNeedsFapi=YES<br>
      <br>
      BrowserReportEvents=OFF<br>
      <br>
      --[System Livery]<br>
      BrowserTitle=PAERS Registration<br>
      BrowserLogo=<br>
      BrowserBackground=<br>
      BrowserPosTop=84<br>
      BrowserPosLeft=112<br>
      BrowserSizeWidth=600<br>
      BrowserSizeHeight=450<br>
      <br>
      [Address Settings]<br>
      BrwDefaultAddress=http://:77/config_ip.asp?Where=Reg<br>
      <br>
      <br>
      It added the string at the end and did not have the user entered values? What am I doing wrong? (Thanks for the help so far)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br>
      <span class="post-time small text-muted">31st July 2004 22:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Attach (or post if it's small) the InstallOptions INI file. (ioA.ini as you mentioned)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jimpy22</span><br>
      <span class="post-time small text-muted">31st July 2004 22:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ini file attached</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jimpy22</span><br>
      <span class="post-time small text-muted">31st July 2004 22:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">and .nsi</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br>
      <span class="post-time small text-muted">31st July 2004 22:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Are you copying the page to the $PLUGINSDIR before and showing the page from there? Are you using MUI (Modern User Interface)?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jimpy22</span><br>
      <span class="post-time small text-muted">31st July 2004 22:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I don't think so - should I?<br>
      <br>
      I have posted the .nsi file as well as the .ini file.<br>
      <br>
      Thanks</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br>
      <span class="post-time small text-muted">31st July 2004 22:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Oh yeah, that's because you're using Modern UI. Instead of using ReadINIStr you should use "!insertmacro MUI_INSTALLOPTIONS_READ".</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jimpy22</span><br>
      <span class="post-time small text-muted">31st July 2004 22:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK - so have changed it to:<br>
      <br>
      ---------------------------------<br>
      !insertmacro MUI_INSTALLOPTIONS_READ $0 "ioA.ini" "Field 2" "State" ;"IP" value as you said<br>
      !insertmacro MUI_INSTALLOPTIONS_READ $1 "ioA.ini" "Field 4" "State" ;"X" value as you said<br>
      WriteINIStr "$INSTDIR\PAERS Registration system\iTouch_BR.ini" "Address Settings" "BrwDefaultAddress" "http://$0:77/config_ip.asp?Where=Reg$1"<br>
      --------------------------------------<br>
      <br>
      <br>
      As suggested but I still get the following written in to my touch.ini file (ie adds lines at end instead of adding value to brwdefaultaddress and does not enter the values entered by user?<br>
      <br>
      ---------------------------------------------<br>
      [Software Title]<br>
      <br>
      -------------------- Browser System Variables -------------------------------<br>
      <br>
      --[Address Settings]<br>
      BrwDefaultAddress=<br>
      --http://192.12.0.22:77/config_ip.asp?Where=Reg1<br>
      BrwReportAddress=<br>
      <br>
      --[System Settings]<br>
      SystemKeys=ON<br>
      SysDeskTop=ON<br>
      <br>
      BrowserDiagMode=OFF<br>
      BrowserKioksMode=OFF<br>
      BrowserControlBar=ON<br>
      BrowserBiometrics=ON<br>
      BrowserNeedsFapi=YES<br>
      <br>
      BrowserReportEvents=OFF<br>
      <br>
      --[System Livery]<br>
      BrowserTitle=PAERS Registration<br>
      BrowserLogo=<br>
      BrowserBackground=<br>
      BrowserPosTop=84<br>
      BrowserPosLeft=112<br>
      BrowserSizeWidth=600<br>
      BrowserSizeHeight=450<br>
      <br>
      [Address Settings]<br>
      BrwDefaultAddress=http://:77/config_ip.asp?Where=Reg<br>
      <br>
      -------------------------------------------------------<br>
      <br>
      <br>
      What is the other thing you said to do?<br>
      <br>
      Thanks</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">1st August 2004 00:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Have you tried removing the -- from in front of all your section headings (in iTouch_BR.ini)?<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br>
      <span class="post-time small text-muted">1st August 2004 03:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        !insertmacro MUI_PAGE_INSTFILES<br>
        Page custom CustomPageA
      </blockquote>You did put that code I said to you in a Section. This happens before you get to the page, so there will ever be an empty string. To solve this just put that code after you show "ioA.ini" (which is in the Function CustomPageA).
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>