<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Totally disabling a Section when installed." />

  <title>Totally disabling a Section when installed. - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Totally disabling a Section when installed.</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=244571">Totally disabling a Section when installed.</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">John P.</span><br />
      <span class="post-time small text-muted">25th April 2006 12:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Totally disabling a Section when installed.</strong><br />
      I have an installer where the user can choose among several Sections, arranged in Groups.<br />
      <br />
      All Sections and Groups are optional by default (unchecked).<br />
      <br />
      Now, the thing is that with my installer, if the user chooses <i>not</i> to install a couple of the options and/or Groups the first time, he/she can re-open the installer later and add those features.<br />
      <br />
      When the user re-opens the installer, I have made it so that the Sections and Groups that the user installed, are not visible on the Components page anymore. So the user can then only choose among the visible Sections/Groups, in other words the ones that weren't installed last time.<br />
      <br />
      I have done this by using <b>UnSelectSecion</b> and <b>SecionSetText [Section] ""</b>.<br />
      <br />
      However - from practical tests:<br />
      <br />
      -If the user has installed let's say all but one component from a Group, and he/she then later re-opens the installer, and uses the Group's <i>main checkbox</i> to select the remaining option within the Group, then NSIS runs <i>even the Sections that are invisible</i>.<br />
      <br />
      If the user checks only the checkbox of the remaining Section <i>within</i> the Group (and <i>don't</i> use the Group's main checkbox), then it works, and only that last, visible Section is run.<br />
      <br />
      Here's how my "Group/Section disabling and invisible making" code looks (there's one for each Group):<br />
      <br />
      [edited]-I first put in the wrong code...[/edited]<br />
      <br /></p>
      <pre>
<code><br />        ReadRegStr $0 HKLM "Software\${PRODUCT_NAME}\InstallSections" "21"<br />        ${if} $0 == 1<br />                !insertmacro UnselectSection ${Sec21}<br />                SectionSetText ${Sec21} ""<br />        ${endif}<br /><br />        ReadRegStr $0 HKLM "Software\${PRODUCT_NAME}\InstallSections" "22"<br />        ${if} $0 == 1<br />                !insertmacro UnselectSection ${Sec22}<br />                SectionSetText ${Sec22} ""<br />        ${endif}<br /><br />        ReadRegStr $0 HKLM "Software\${PRODUCT_NAME}\InstallSections" "23"<br />        ${if} $0 == 1<br />                !insertmacro UnselectSection ${Sec23}<br />                SectionSetText ${Sec23} ""<br />        ${endif}<br /><br />        ReadRegStr $0 HKLM "Software\${PRODUCT_NAME}\InstallSections" "24"<br />        ${if} $0 == 1<br />                !insertmacro UnselectSection ${Sec24}<br />                SectionSetText ${Sec24} ""<br />        ${endif}<br /><br />        ReadRegStr $0 HKLM "Software\${PRODUCT_NAME}\InstallSections" "25"<br />        ${if} $0 == 1<br />                !insertmacro UnselectSection ${Sec25}<br />                SectionSetText ${Sec25} ""<br />        ${endif}<br /><br />        ReadRegStr $0 HKLM "Software\${PRODUCT_NAME}\InstallSections" "21"<br />        ${if} $0 == 1<br />        ReadRegStr $0 HKLM "Software\${PRODUCT_NAME}\InstallSections" "22"<br />        ${if} $0 == 1<br />        ReadRegStr $0 HKLM "Software\${PRODUCT_NAME}\InstallSections" "23"<br />        ${if} $0 == 1<br />        ReadRegStr $0 HKLM "Software\${PRODUCT_NAME}\InstallSections" "24"<br />        ${if} $0 == 1<br />        ReadRegStr $0 HKLM "Software\${PRODUCT_NAME}\InstallSections" "25"<br />        ${if} $0 == 1<br />                !insertmacro UnselectSection ${SubSecMisc}<br />                SectionSetText ${SubSecMisc} ""<br />        ${endif}<br />        ${endif}<br />        ${endif}<br />        ${endif}<br />        ${endif}<br /></code>
</pre><br />
      <br />
      (the meaning of the code above is that if the individual Section is installed, then it will be invisible in the installer, and if <i>all</i> the Sections within the Group are installed, then the entire Section Group will be invisible)<br />
      <br />
      <br />
      The reason I know that the invisible Components are run when you check their Group's main checkbox, is that stuff happens during install that isn't supposed to happen, when you check that main checkbox (because what happens is part of the invisible Components), and it <i>doesn't</i> happen if you check only the remaining Component's own checkbox instead.<br />
      <br />
      <br />
      How can I make sure that the invisible Sections/Components within a Group are <i>not</i> run when the user checks the main checkbox of the Group?<br />
      <br />
      Is there such a thing as <b>DisableSection</b> or similar?<br />
      <br />
      Thanks.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br />
      <span class="post-time small text-muted">27th April 2006 10:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You need to make the section read only. This way user can't change the status.<br />
      <br /></p>
      <pre>
<code>        ReadRegStr $0 HKLM "Software\${PRODUCT_NAME}\InstallSections" "21"<br />        ${if} $0 == 1<br />                !insertmacro SetSectionFlag ${Sec21} ${SF_RO}<br />                !insertmacro UnselectSection ${Sec21}<br />                SectionSetText ${Sec21} ""<br />        ${endif}<br />...</code>
</pre>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
