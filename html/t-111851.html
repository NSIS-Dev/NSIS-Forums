<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="NSIS does not delete a file that is told to delete" />

  <title>NSIS does not delete a file that is told to delete - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">NSIS does not delete a file that is told to delete</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=111851">NSIS does not delete a file that is told to delete</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br />
      <span class="post-time small text-muted">28th October 2002 19:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>NSIS does not delete a file that is told to delete</strong><br />
      Well, I have a bit of a problem here. I tell nsis to delete a file and he does not delete it.:eek: It's a file that will be created while running the installation and the user has the choice beforehand to choose if the file will remain or not.<br />
      <br />
      Well, I attach a zip with the program, the nsi file and a folder that is needed to run the program.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">28th October 2002 19:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try using the latest CVS version, it works for me when I compile it with it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br />
      <span class="post-time small text-muted">28th October 2002 23:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">and the exe included, does work for you?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">29th October 2002 14:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The included EXE doesn't delete the file, the EXE I compiled using the latest CVS version does.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br />
      <span class="post-time small text-muted">29th October 2002 18:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am trying to do something in <a href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/nsis/NSIS/" target="_blank">this CVS folder</a> but downloading makensis.exe and makensisw.exe and try to compile gives error on line 1.<br />
      <br />
      Let's see if you can help me another bit.:)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rainwater</span><br />
      <span class="post-time small text-muted">29th October 2002 19:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by n0On3</i><br />
        <b>I am trying to do something in <a href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/nsis/NSIS/" target="_blank">this CVS folder</a> but downloading makensis.exe and makensisw.exe and try to compile gives error on line 1.<br />
        <br />
        Let's see if you can help me another bit.:)</b>
      </blockquote>Download the snapshot. The link to it is in my signature.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">29th October 2002 19:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=102204" target="_blank">http://forums.winamp.com/showthread....hreadid=102204</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br />
      <span class="post-time small text-muted">30th October 2002 00:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">well, I've downloaded the snapshot and installed it. And then make a new compilation, and then run it, and then find that that ini file is still there:(<br />
      <br />
      Sometimes just the file remains there. Sometimes it appears after two seconds (more or less) of clicking on "Close".<br />
      <br />
      <br />
      I attached a zip with nsi, new compilation and that log folder.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">30th October 2002 14:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The compiled installer inside your ZIP file deletes the file for me.<br />
      What OS are you using?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br />
      <span class="post-time small text-muted">30th October 2002 14:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am using Win98SE.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">30th October 2002 15:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">On Windows 98 it happens to me too, I will look into it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br />
      <span class="post-time small text-muted">30th October 2002 16:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks.<br />
      <br />
      Sometimes the .ini appears clearly after those .csv files, which in the script are created <b>after</b> the .ini.<br />
      <br />
      Maybe the problem is that the file to delete is created in the same installation.<br />
      <br />
      Another thing is that I didn't find how to create the file, so I used FileOpen directly.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th November 2002 15:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK, here is what I think happens:<br />
      I think that when you call WriteINIStr Windows delays write it. That means, it writes to the file whenever it feels like it, or before someone wants to read from it.<br />
      In your case you always write just before you delete it, and you don't read in between, so Windows delays the writing.<br /></p>

      <blockquote>
        Windows 95/98/Me: The DeleteFile function deletes a file even if it is open for normal I/O or as a memory-mapped file. To prevent loss of data, close files before attempting to delete them.
      </blockquote>So after you have already deleted it, Windows' WriteINIStr remembers it needed to write something and it recreates the file for it. What you need to do is to flush the file buffers before you delete it using:<br />
      <pre>
<code>WriteINIStr</code><span style="color: #DD0000">"${TMP}"""""""
</span>
</pre>It worked for me 10 out of 10 times so I guess I am correct :D
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br />
      <span class="post-time small text-muted">6th November 2002 18:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I understand that I have to write that line just before deleting the ini file.<br />
      <br />
      I tried but It didn't work, could you upload the modified ini with a compile that works for you?<br />
      <br />
      Thanks:)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th November 2002 18:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There it is.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br />
      <span class="post-time small text-muted">7th November 2002 04:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry, but it didn't work. The file is still there.<br />
      <br />
      It deletes the file when making a pause with messagebox.<br />
      <br />
      In the first try the ini appeared after presssing F5.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br />
      <span class="post-time small text-muted">8th November 2002 00:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ok kichik, I <b>am</b> your worst nightmare.:eek:<br />
      <br />
      That makensis you gave me does indeed delete the ini, <b>but</b> when working it keeps it at zero bytes, for easy deleting, of course.:)<br />
      <br />
      <br />
      I attach the compiled script, the script and logs, as always.:)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">8th November 2002 11:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Oops... Fixed that in the latest CVS version. You will have to compile again.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
