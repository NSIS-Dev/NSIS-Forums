<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="How to prevent files extraction from an Installer created with NSIS?"><title>How to prevent files extraction from an Installer created with NSIS? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">How to prevent files extraction from an Installer created with NSIS?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=335433">How to prevent files extraction from an Installer created with NSIS?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">within</span><br><span class="post-time small text-muted">30th September 2011 15:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>How to prevent files extraction from an Installer created with NSIS?</strong><br>Hi there,<br><br>I am pretty happy with NSIS, but i'd wish to avoid to extract the files directly from the Installer EXE. I've serched the Forums and the web without success.<br><br>Is it possible to prevent files extraction? if YES, then how?<br>If NO, then how can I simply encrypt my files inside the Installer EXE using some script lines within the *.nsi file, and WITOUT using a thrid-party software to run properly the Installer?<br><br>Thanks in advance,<br>within</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">30th September 2011 16:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It is possible, but you have to rebuild NSIS. All NSIS instructions have an opcode and all you need to do is change the opcode of the File instruction so that e.g. 7-zip does not find any.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">T.Slappy</span><br><span class="post-time small text-muted">2nd October 2011 06:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Do not put files into setup.exe but at first put them into archive with password, then extract that archive $PLUGINDIR or $TEMP and unpack files into final destination.<br>It may be slow to unpack huge archives but no special software/script is needed.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">2nd October 2011 07:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by T.Slappy</small><br>Do not put files into setup.exe but at first put them into archive with password, then extract that archive $PLUGINDIR or $TEMP and unpack files into final destination.</blockquote>This does NOT work. The password is stored in plaintext in the nsi script, and the nsi script can be extracted. Anything that is long enough to be a strong password will also be easy to find by someone looking through the code.<br><br>I suppose you could try to put a lot of variable manipulations here and there, and pass those variables as the password parameter, but even then it's still relatively easy to replace the plugin / unrar.exe / 7za.exe by something that simply MessageBox's the parameters it was given. Voila instant password.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">2nd October 2011 20:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">...or just check the 7zip command line in process explorer...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">2nd October 2011 20:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You don't even need process explorer any more. You can see it in task manager on Windows 7 if you add the column.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">within</span><br><span class="post-time small text-muted">3rd October 2011 08:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks to all of you for your comments and possible solutions.<br><br>Password solution might be easy to do, but quite "useless" if I read your comments...<br>Rebuild NSIS? not sure if it's a good idea...<br><br>I've gathered some information from wiki, and the NSIS resources pages and it seems I can use the password way with encryption. Seems a plug-in is necessary for compress/decompress. The thing is: I'd like to avoid special requirements for the installer to be run properly. I mean, I just wish the installer can run without any third parties to be installed first. I admit the encryption docs I've read aren't clear for me...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">3rd October 2011 10:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">What's wrong with rebuilding NSIS?<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">DrO</span><br><span class="post-time small text-muted">3rd October 2011 10:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">wouldn't making the installer use bzip compression block 7zip accessing the installer without the need to rebuild NSIS itself? (i know that used to be the way to do what seems to be asked).<br><br>-daz</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">3rd October 2011 10:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ah yes I forgot about that. It does work indeed. The only downside is the poorer compression.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yathosho</span><br><span class="post-time small text-muted">3rd October 2011 12:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by DrO</small><br>wouldn't making the installer use bzip compression block 7zip accessing the installer without the need to rebuild NSIS itself? (i know that used to be the way to do what seems to be asked).<br><br>-daz</blockquote>iirc the latest 7-zip builds also extracts bzip compressed installers<br><br>edit: it does, see screenshot</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">within</span><br><span class="post-time small text-muted">3rd October 2011 12:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by Afrow UK</small><br>What's wrong with rebuilding NSIS?<br><br>Stu</blockquote>I am not aware of doing it. Furthermore, I am not sure what do do then...</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">DrO</span><br><span class="post-time small text-muted">3rd October 2011 12:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><b>Yathosho:</b> *shrugs* wasn't aware of that having changed and from a quick try that seems to be true.<br><br>-daz</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yathosho</span><br><span class="post-time small text-muted">3rd October 2011 13:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">btw, here's the <a href="http://forums.winamp.com/showthread.php?t=245397" target="_blank">original post</a> in which the extraction of files has been discussed<br><br></p><blockquote><small>Originally posted by DrO</small><br><b>Yathosho:</b> *shrugs* wasn't aware of that having changed and from a quick try that seems to be true.</blockquote>happened with 9.x, presumably 9.16 ("<a href="http://7-zip.org/history.txt" target="_blank">NSIS support was improved</a>")</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">within</span><br><span class="post-time small text-muted">3rd October 2011 13:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">found this post, but can't figure out a solution... dumb me</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yathosho</span><br><span class="post-time small text-muted">3rd October 2011 13:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">it seems to me there's no secure way of protecting your files, but rebuilding NSIS comes closest. i think there are some valid points why it's ultimately pointless, but maybe you can describe your situation a bit better. what exactly are you trying to protect - and why?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">T.Slappy</span><br><span class="post-time small text-muted">4th October 2011 06:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by Afrow UK</small><br>What's wrong with rebuilding NSIS?<br><br>Stu</blockquote>Regular people do not like compiling and building software before they want to use it :)<br>This is Linux speciality.<br>Also 99% NSIS users has no time/resources/knowledge to rebuild NSIS from sources!</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">within</span><br><span class="post-time small text-muted">4th October 2011 09:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by Yathosho</small><br>it seems to me there's no secure way of protecting your files, but rebuilding NSIS comes closest. i think there are some valid points why it's ultimately pointless, but maybe you can describe your situation a bit better. what exactly are you trying to protect - and why?</blockquote>There are 2 reasons to limit file extracttion:<br>- first, we do provide a kind of license, that just says "you are aware of what you do... bla bla bla... and only you can use this software... bla bla bla". This softare is not ment to be widely spread, but only given to dedicated people according to a contract they have to sign. Thus, the license is here to remind them. If extraction is possible, it means the software can be available to everyone, even if they didn't sign the contract before and without agreement.<br>- we also provide the software and some sources. we don't wish this sources to be available without the above agreement and the ability to be given to third parties.<br><br><br>I believe compressing and encrypt the file and then package it into the installer is maybe the best solution. I just need to find out how!</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yathosho</span><br><span class="post-time small text-muted">4th October 2011 13:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">you will have to encrypt your file with a 3rd party app. nsis can deal with several encryption algorithms, but i haven't found a way to decrypt a file without relying on a 3rd party tool (which, as mentioned, can easily be intercepted). so the passing of the password is the real weak spot.<br><br>if the files don't exceed the strlen, i guess you could read the file into the buffer and let one of the plugins decrypt it there.<br><br><a href="http://nsis.sourceforge.net/NsisCrypt_plug-in" target="_blank">http://nsis.sourceforge.net/NsisCrypt_plug-in</a><br><a href="http://nsis.sourceforge.net/Blowfish_plug-in" target="_blank">http://nsis.sourceforge.net/Blowfish_plug-in</a><br><br>i'm not an expert on encryption/decryption, there might still be a weak spot. i'm sure there are commercial solutions to deal with that.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yathosho</span><br><span class="post-time small text-muted">4th October 2011 13:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">i'm wondering... suppose the 7-zip plugin for nsis would support commandline instructions (such as passing a password), could that password be intercepted as it can be done when using 7za.exe? can this password be extracted when using that old 7-zip 4.40 beta which could extract (portions of) the .nsi file?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">within</span><br><span class="post-time small text-muted">4th October 2011 14:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Interesting comments Yathosho. I may have to rethink some things...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">4th October 2011 14:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by Yathosho</small><br>i'm wondering... suppose the 7-zip plugin for nsis would support commandline instructions (such as passing a password), could that password be intercepted as it can be done when using 7za.exe? can this password be extracted when using that old 7-zip 4.40 beta which could extract (portions of) the .nsi file?</blockquote>Any string is visible, as far as I know. But like I said before, you can simply replace the plugin dll, and still get the password that way.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">within</span><br><span class="post-time small text-muted">6th October 2011 07:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks to all of you for comments and remarks. Interesting subject, but we'd deceided to drop down this idea. We'd rather seperate the Installer into 2: one for application itself, and one for sources (SDK) on the other side.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Brizz</span><br><span class="post-time small text-muted">3rd January 2012 02:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I have searched all over--and asked on other forums.<br><br>...This thread is what shows up in Google--and I imagine there are others that also want this..<br><br>I'm willing to edit source--and compile. ...not complete newb--but def can't sit down and code stuff from scratch.<br><br>I want to prevent NSIS executables from being able to be extracted (at least prevent it from being done simply...).<br><br>If someone knows--can you please point me to where I would find this in the source..and what exactly I would need to modify. ...would be VERY much appreciated..</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">4th January 2012 17:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You need to modify exehead\fileform.h. Insert a dummy enum value name just before EW_EXTRACTFILE (this ensures File gets a new opcode). E.g.</p><pre>
<code>EW_WHYDIDNTITHINKOFTHISDOH,<br>EW_EXTRACTFILE,</code>
</pre>Stu
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">isawen</span><br>
      <span class="post-time small text-muted">18th June 2012 19:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Why NSIS is not released with opcode changed?</strong><br></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br>
        You need to modify exehead\fileform.h. Insert a dummy enum value name just before EW_EXTRACTFILE (this ensures File gets a new opcode). E.g.
        <pre>
<code>EW_WHYDIDNTITHINKOFTHISDOH,<br>EW_EXTRACTFILE,</code>
</pre>Stu
      </blockquote>Hi Afrow,<br>
      <br>
      If this idea is good, why NSIS is not released with the opcode changed?<br>
      Compiling it is just to an easy task for me.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">18th June 2012 21:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Because then 7-zip could be modified to decompile installers using the new opcode which would defeat the purpose.<br>
      <br>
      Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">isawen</span><br>
      <span class="post-time small text-muted">19th June 2012 00:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Compiling NSIS</strong><br></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br>
        Because then 7-zip could be modified to decompile installers using the new opcode which would defeat the purpose.<br>
        <br>
        Stu
      </blockquote>Hard stuff compiling the NSIS even with the metioned prerequisites. I give up trying to compile it.:cry:
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>