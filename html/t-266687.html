<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Vista - Cannot copy files to non-admin user's Desktop/Pictures" />

  <title>Vista - Cannot copy files to non-admin user's Desktop/Pictures - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Vista - Cannot copy files to non-admin user's Desktop/Pictures</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=266687">Vista - Cannot copy files to non-admin user's Desktop/Pictures</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">marucosuz</span><br />
      <span class="post-time small text-muted">27th February 2007 01:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Vista - Cannot copy files to non-admin user's Desktop/Pictures</strong><br />
      Hello all,<br />
      <br />
      My installer copies some files to the "$DESKTOP" and "$PICTURES" folder of the current user. I have tested it with Window XP and it works fine for admin and non-admin users. However, it does not work correctly with Vista. No matter which user I am logged in as, the files are always copied into the administrator's folders as opposed to the current user's folders.<br />
      <br />
      I have tried running the "UserInfo.exe" example (that comes with the NSIS installation) as a non-admin user and noticed that UserInfo::GetName and UserInfo::GetAccountType always return the information of the Administrator user whose password was used to authorized the installation. Is this an OS bug? Can I do something to fix this?<br />
      <br />
      I am using the "RequestExecutionLevel admin" command to avoid getting the warning message after the vista installation. Also, I have tried using the "SetShellVarContext current" command just before calling "$PICTURES" but it didnt work as expected.<br />
      <br />
      Any help will be appreciated.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">27th February 2007 07:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Vista not only elevates installer's process rights (UAC), but makes it running from administrator. This way installer forgets about logged user and executes installer as it was started by admin. Thread with the same problem <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=265780" target="_blank">http://forums.winamp.com/showthread....hreadid=265780</a><br />
      May be Vista SDK can help with process token tricks (new NSIS plug-in required), but SDK "Download Size: 1 KB - 1185.7 MB*" :-( <a href="http://www.microsoft.com/downloads/details.aspx?FamilyId=C2B1E300-F358-4523-B479-F53D234CDCCF&amp;displaylang=en" target="_blank">http://www.microsoft.com/downloads/d...displaylang=en</a></p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
