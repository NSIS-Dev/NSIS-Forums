<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Recommended method to execute DLL" />

  <title>Recommended method to execute DLL - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Recommended method to execute DLL</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=227291">Recommended method to execute DLL</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jchaven</span><br />
      <span class="post-time small text-muted">30th September 2005 06:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Recommended method to execute DLL</strong><br />
      I am trying to create an install file to load several network printers with a single file. To actually install the printers uses "rundll.exe" as in this example:<br /></p>
      <pre>
<code><br />rundll32 printui.dll,PrintUIEntry <br />/if /b "Ricoh Aficio 1515 (Systems)" <br />/f "\\ntserver\install\R1515_Win2K_XP\OEMSETUP.INF" <br />/q /r "NP01-C05" /m "RICOH Aficio 1515 PCL 6" /z /u<br /></code>
</pre><br />
      <br />
      The problem is I cannot figure-out how to run these commands in the NSIS script. I have read info about "Exec", "ExecWait", "ExecShell", "ExecDLL", and "nsExec" and I can't seem to get any of them to work. I fear that it is because of all the switches used in the command.<br />
      <br />
      Here is my latest failed attempt:<br />
      <pre>
<code><br />ExecWait "rundll32 printui.dll,PrintUIEntry <br />/if /b 'Ricoh Aficio 1515 (Systems)' <br />/f '$INSTDIR\Ricoh1515F_PCL6\Win2K_XP\OEMSETUP.INF' <br />/q /r 'NP01-C05' /m 'RICOH Aficio 1515 PCL 6' /z /u"<br /></code>
</pre><br />
      <br />
      So, NSIS gurus what advice can you help give this newbie to get around this?<br />
      <br />
      TIA,<br />
      Charles
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">30th September 2005 11:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">How exactly doesn't it work? From the code you've posted above, it seems like you should get a syntax error because you've split the lines.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jchaven</span><br />
      <span class="post-time small text-muted">30th September 2005 13:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry - it was late when I posted. The error I receive is coming from the DLL and it states "The arguments are invalid"<br />
      <br />
      The arguments are not invalid -- they work from a batch. I broke the lines apart in the post for readability. In the script they are all on one line.<br />
      <br />
      Thanks,<br />
      Charles</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">30th September 2005 13:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Maybe it doesn't like single quotes? Try using double quotes for the command line and single quotes for the NSIS string itself. If that doesn't work, attach the working example and the non-working example.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jchaven</span><br />
      <span class="post-time small text-muted">30th September 2005 14:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The quotes thing was keeping it from running. The command is running now (there is a delay between commands like it is doing something) but doesn't add the printers.<br />
      <br />
      Here is the new command that does compile and appears to work but doesn't:<br />
      ExecWait 'rundll32 printui.dll,PrintUIEntry /if /b "Ricoh Aficio 1515 (Systems)" /f "$INSTDIR\Ricoh1515F_PCL6\Win2K_XP\OEMSETUP.INF" /q /r "NP01-M06" /m "RICOH Aficio 1515 PCL 6" /z /u'<br />
      <br />
      Here is the command as run from a DOS batch file:<br />
      start /wait rundll32 printui.dll,PrintUIEntry /if /b "Ricoh Aficio 1515 (Systems)" /f "C:\Temp\JCH-INSTALL_PRINTERS\Ricoh1515F_PCL6\Win2K_XP\OEMSETUP.INF" /q /r "NP01-C05" /m "RICOH Aficio 1515 PCL 6" /z /u<br />
      <br />
      I am able to get working what I need by adding the batch file to the install and using ExecWait to run it. However, it creates the DOS window and I have to make sure the $INSTDIR value is specified in my batch.<br />
      <br />
      I appreciate your help!!<br />
      <br />
      Thanks,<br />
      Charles</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">30th September 2005 14:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Maybe the working directory bothers it? Try setting it using SetOutPath.<br />
      <br />
      To avoid the DOS window, you can use the nsExec plug-in which is bundled with NSIS.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jchaven</span><br />
      <span class="post-time small text-muted">30th September 2005 15:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">SetOutPath did it -- it is working perfectly now. Thanks!!<br />
      <br />
      Thanks,<br />
      Charles</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
