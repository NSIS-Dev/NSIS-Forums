<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Trouble with Java Runtime Environment Dynamic Installer - the JRE install fails" />

  <title>Trouble with Java Runtime Environment Dynamic Installer - the JRE install fails - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Trouble with Java Runtime Environment Dynamic Installer - the JRE install fails</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=372915">Trouble with Java Runtime Environment Dynamic Installer - the JRE install fails</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">IanLes</span><br />
      <span class="post-time small text-muted">10th October 2013 14:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Trouble with Java Runtime Environment Dynamic Installer - the JRE install fails</strong><br />
      I have added Java Runtime Environment Dynamic Installer to my install and it seems to be working as expected except that the JRE dose not actually get installed. The Dynamic Installer page is displayed and it says it is downloading the JRE all the progress bars move along but at the end I get a message box that says:<br />
      <br />
      "Unable to install Java - Setup will be aborted<br />
      The JRE setup has been abnormally interrupted - return code OK"<br />
      <br />
      The detail error contains:<br />
      Detecting JRE Version<br />
      JRE Version detection complete - result = No JRE Found<br />
      About to download JRE from <a href="http://javadl.sun.com/webapps/download/AutoDL?BundleId=80814" target="_blank">http://javadl.sun.com/webapps/downlo...BundleId=80814</a><br />
      Download result = OK<br />
      Launching JRE setup<br />
      Execute: "C:\Users\ileslie\AppData\Local\Temp\jre_setup.exe" /passive REBOOT=Suppress JAVAUPDATE=0 WEBSTARTICON=0 /L \"C:\Users\ileslie\AppData\Local\Temp\jre_setup.log\"<br />
      JRE Setup finished<br />
      Delete file: C:\Users\ileslie\AppData\Local\Temp\jre_Setup.exe<br />
      <br />
      This is running in a Vista VM on my Windows 7 machine since I do not have a real computer that does not have Java installed already. I have admin privleges for the VM this happens if I run the install normally or with admin access.<br />
      <br />
      Any help or advice would be appreciated,<br />
      <br />
      Ian</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">10th October 2013 16:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What's with the backslashes on the log path in your command line? Please post your actual ExecWait code.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">IanLes</span><br />
      <span class="post-time small text-muted">10th October 2013 17:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That is the log as reported by the Java Runtime Environment Dynamic Installer plug in (<a href="http://nsis.sourceforge.net/Java_Runtime_Environment_Dynamic_Installer#Add_page_notifying_user_that_JRE_installation_is_required_.28Optional.29" target="_blank">http://nsis.sourceforge.net/Java_Run....28Optional.29</a>)<br />
      <br />
      There is no ExecWait code in my part of the script.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">10th October 2013 18:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There's an error in that header file. Remove those backslashes on the double quotes on lines 109 and 112. They don't need escaping, and besides, that is not the way to escape double quotes in NSIS script (you use $\").<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">IanLes</span><br />
      <span class="post-time small text-muted">10th October 2013 19:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for that<br />
      <br />
      I tweaked the script but that changed nothing about the behaviour. I checked the specified log file but it did not exist so clearly the jre installer never got very far. I'm going to comment out the delete line and then manually try to run the JRE installer...<br />
      <br />
      Detecting JRE Version<br />
      JRE Version detection complete - result = No JRE Found<br />
      About to download JRE from <a href="http://javadl.sun.com/webapps/download/AutoDL?BundleId=80814" target="_blank">http://javadl.sun.com/webapps/downlo...BundleId=80814</a><br />
      Download result = OK<br />
      Launching JRE setup<br />
      Execute: "C:\Users\ileslie\AppData\Local\Temp\jre_setup.exe" /passive REBOOT=Suppress JAVAUPDATE=0 WEBSTARTICON=0 /L "C:\Users\ileslie\AppData\Local\Temp\jre_setup.log"<br />
      JRE Setup finished<br />
      Delete file: C:\Users\ileslie\AppData\Local\Temp\jre_Setup.exe</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">IanLes</span><br />
      <span class="post-time small text-muted">10th October 2013 19:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK that worked - after the standard windows do you want to allow this program to run prompt. There is a plug in for that I believe. So, I guess that means I have to tweak this jre script some more.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">10th October 2013 20:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you are getting an elevation prompt then that means your own setup needs elevating first. To do that you need to add RequestExecutionLevel admin and then check in .onInit that the user is running as an administrator using the UserInfo plug-in.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">IanLes</span><br />
      <span class="post-time small text-muted">10th October 2013 20:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK thanks. Is there a way to only request elevation if the JRE needs to be installed? If the customer already has a valid JRE then nothing else about my install needs elevation for anything else. Is it possible to tweak the JRE dynamic installer script to request elevation for the setup it tries to run?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">10th October 2013 22:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by IanLes</small><br />
        OK thanks. Is there a way to only request elevation if the JRE needs to be installed? If the customer already has a valid JRE then nothing else about my install needs elevation for anything else. Is it possible to tweak the JRE dynamic installer script to request elevation for the setup it tries to run?
      </blockquote>So you never write to HKLM/$programfiles/$windir? If so you could use "requestexecutionlevel highest" and if JRE is not installed and the UserInfo plugin tells you that you are not admin you bail out with an error message telling the user to restart the installer elevated.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">IanLes</span><br />
      <span class="post-time small text-muted">11th October 2013 16:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Solved</strong><br /></p>

      <blockquote>
        <small>Originally posted by Anders</small><br />
        So you never write to HKLM/$programfiles/$windir? If so you could use "requestexecutionlevel highest" and if JRE is not installed and the UserInfo plugin tells you that you are not admin you bail out with an error message telling the user to restart the installer elevated.
      </blockquote>No need to write to the registry - this is a simple java app.<br />
      <br />
      So that was a fix. I just elevated the execution level to test it and with admin it works. I'll fine tune things a bit, as you suggested. Thank you for your advice. Very helpful.<br />
      <br />
      Ian
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
