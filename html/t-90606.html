<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="more nt/2k permissions"><title>more nt/2k permissions - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">more nt/2k permissions</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=90606">more nt/2k permissions</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">VortX21</span><br><span class="post-time small text-muted">10th June 2002 20:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>more nt/2k permissions</strong><br>anyone have a way to grant full permissions to a win2k/nt registry key? ie I want everybody to be able to use a key in HKLM/Software.<br>I hate to do something like shell regini, though I'm already having to shell CACLS to grant permissions on my DLLs.<br>Somebody must have made this work already.<br>Thanks<br>-Carl</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">10th June 2002 21:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Implementing in Win32</strong><br>What you want is easy at a C code level, just the application of a null security descriptor to the registry key. If you don't have get a satisfactory answer to this I can knock up a minature extension dll with a single function in it to do the job for you (I assume you are looking for a simpler more immediate solution than this but I thought I'd offer anyway).<br><br>---<br><br>Ximon Eighteen<br>Programmer @ Advent Publishing Systems<br>email: <a href="mailto:ximon_eighteen@3b2.com">ximon_eighteen@3b2.com</a><br>&amp; msn: <a href="mailto:ximon_eighteen@hotmail.com">ximon_eighteen@hotmail.com</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">11th June 2002 00:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>C Implementation</strong><br>Right since there was no answer given to your problem I created a small (4k) extension dll to answer your woes.<br><br>Get it here: <a href="http://www.clantpa.co.uk/nsis/x18regkeyV0.0.zip" target="_blank">http://www.clantpa.co.uk/nsis/x18regkeyV0.0.zip</a> [ ~8k ]<br><br>It contains a single function callable from an NSIS script. The function is called RemoveRegKeySecurity and expects a registry key name on the stack. The zip file contains more explicit documentation about how to specify the key name and what success or error codes you can expect in return.<br><br>This was written specifically for your problem so it doesn't contain any other functionality. If you want anything else or anyone else has a request then if its related I'll add it to that file in a new version, or else I'll just make another one. This is so I can bundle related functionality together.<br><br>I hope it works. I've made sure that the link and the uploaded zip file work perfectly (I had trouble with another one earlier today as you might have seen) and I think that the code works correctly. However since you have a real use for this code you will be the best judge.<br><br>I know how to create a null security descriptor and apply it to an object (in this case a registry key) and as far as I understand it this clears all security on the key (ie makes it fully accessible to everyone). However, I haven't got a means of testing this at the mo (I'm tired, maybe there is an obvious way, prolly just create a dummy user a log off and back on ;-)) so I've got my fingers crossed.<br><br>Feel free to get back to me about suggestions/criticisms/etc and definitely get back to me either by email or in here if you have a problem with the dll.<br><br>---<br><br>Ximon Eighteen<br>Programmer @ Advent Publishing Systems<br>email: <a href="mailto:ximon_eighteen@3b2.com">ximon_eighteen@3b2.com</a><br>&amp; msn: <a href="mailto:ximon_eighteen@hotmail.com">ximon_eighteen@hotmail.com</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">VortX21</span><br><span class="post-time small text-muted">11th June 2002 21:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Wow, thanks SJ :D<br>That dll works great - my win2k installs run nice and smoothly now. Very nice to be able to do this from NSIS instead of creating a separate app.<br>Thanks again!<br>-Carl</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">11th June 2002 23:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Glad I could help. Did you say you were using a separate program to grant permissions on DLLs? If you don't want to be using other programs I could do something about that too if you like. If so just drop me a line to say what you'd need it to do and I'll tell you if I can do it or not.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">VortX21</span><br><span class="post-time small text-muted">12th June 2002 15:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That would be really cool - if you could have your dll do both registry key security permissions and file security permissions, it'd be what a lot of people (like me) need to make installs that work well in nt/2k. Right now I shell cacls on each dll which pops up a little black dos box momentarily each time. kinda messy<br>-Carl</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">12th June 2002 15:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Do you want it with knobs on?</strong><br>Sorry for the specific nature of this post, I'm just trying to find out exactly what to implement for you (and anyone else).<br></p><ol style="list-style-type: decimal"><li>How much of the CACLS functionality do you want/require?</li><li>Is there anything not provided that you would like?</li><li>Is there anything done by CACLS that you would like to see done differently?</li><li>Specifically, of the /t /e /c /g /r /p /d options which do you want to see supported?</li></ol></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">VortX21</span><br><span class="post-time small text-muted">12th June 2002 18:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>cacls</strong><br>Well, all I'm using right now is<br><br>CACLS bob.dll /e /g Users:R<br><br>by doing<br><br>ExecShell "" "CACLS" "$0 /e /g Users:R"<br><br>All I need to do functionally is make each file readable by anyone who uses the computer. Anything else is bonus :)<br>-Carl</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">14th June 2002 03:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>K let's get it on</strong><br>Okay I'll do this soon (turns out I need it too for something else so it really will be sooner rather than later)...<br><br>Instead of me keep posting in here you can keep an eye on this project on my new forum <a href="http://www.clantpa.co.uk/nsis/forum" target="_blank">here</a> (there's a note about this specifically <a href="http://www.clantpa.co.uk/nsis/forum/viewtopic.php?p=7#7" target="_blank">here</a>)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Piotr Strycharz</span><br><span class="post-time small text-muted">17th June 2002 14:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">&gt; Okay I'll do this soon<br><br>This would be the feature I will love, too.<br>However, please note, that Windows group names are different in different languages (the "Everyone" group in my language is "Wszyscy"), so support for SIDs (or LookupAccountSid function) would be very nice feature.<br>Actually what I need is to remove ACE "Everyone" from file to secure it after installation.<br><br>-- Piotr.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">17th June 2002 15:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for pointing that out. The "Well Known" sids of which Everyone is one are a special case anyway that are accessed at a code level using bit masks rather than names so the exact spelling will not be an issue. If you hadn't mentioned it though I would possibly have introduced a language dependency without meaning to, I'll try and keep this in mind now when I do it.<br><br>If you want to follow any development that occurs on this (I'm quite busy but I will need it v. soon) then keep an eye on this : <a href="http://www.clantpa.co.uk/nsis/forum/viewtopic.php?t=7" target="_blank">http://www.clantpa.co.uk/nsis/forum/viewtopic.php?t=7</a><br><br>Please post in that thread the exact details of any functionality you would like and I will do it as soon as I can.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>