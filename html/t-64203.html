<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Compile in Borland" />

  <title>Compile in Borland - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Compile in Borland</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=64203">Compile in Borland</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rainwater</span><br />
      <span class="post-time small text-muted">30th October 2001 00:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Compile in Borland</strong><br />
      I was wondering if anyone had a makefile to compile NSIS with Borland's free compiler. I found one in the archives but it didnt work to well. Also, it would be nice if makefiles for other compilers were included in the source as well.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DuaneJeffers</span><br />
      <span class="post-time small text-muted">30th October 2001 04:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This was asked awhile ago. umm. I believe we couldn't find one.<br />
      <br />
      sorry.<br />
      <br />
      -Duane</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pjw62</span><br />
      <span class="post-time small text-muted">30th October 2001 20:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Crikey! Can it be so hard to write one? I wrote one for the exe head and makensis for VC++ 4.0. The hardest part on other compilers is getting the size tweaks right. (i.e. /nowin98, /FD etc).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rainwater</span><br />
      <span class="post-time small text-muted">30th October 2001 21:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The main problem I was having was compiling the resource file in the exehead.<br />
      <br />
      The rc file contains the line:<br /></p>
      <pre>
<span style="color: #FF8000">#include"afxres.h"
</span>
</pre>This is a mfc include so borland doesnt find it. After commenting it out, I get the error:<br />
      <br />
      - Error resource.rc 100 74: Incomplete expression<br />
      <br />
      Any ideas?<br />
      _
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pjw62</span><br />
      <span class="post-time small text-muted">4th November 2001 19:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">sounds liek your headers are not up to date..<br />
      a quick fix; open resource.rc and add<br />
      #define PBS_SMOOTH 0<br />
      <br />
      I dont know the proper value, neither do I care for the 'smoothing'.<br />
      <br />
      I just checked it and it compiles fine with Borlands free compiler.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pjw62</span><br />
      <span class="post-time small text-muted">4th November 2001 20:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">now just to get the size optimisations.. 45.5kb on default options, but new simple 'initialisation module' that simply jumps to winmain (equivalical to setting the entry point on the ms compilers).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pjw62</span><br />
      <span class="post-time small text-muted">5th November 2001 11:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Okay. There are a few problems, not with compiling makensis, but with the implementation of finding the icon offset.<br />
      <br />
      When you use the borland resource compiler, it changes offset 14h (if I remember rightly - I am at school now) from 0x00 to 0x80 in the .res file. Obviously when the application is linked, this change is maintained. When however, you bin2h, the data at 14h is _not_ changed. The result is that at the initialisation of the exe build class, memcpy does not return 0 even when the correct icon offset is reached.<br />
      <br />
      solutions<br />
      <br />
      1. (Preferred). Use the structures in winnt.h to load the icon offset from the exe header in memory (I decided it would just be easiest to find the offset of the first bitmap, second bitmap and first icon - so if you do any modifications to the resource script as long as you keep the bitmaps and icon in the right order it should be okay). This will oleviate around 100,000 memcpy calls speeding up the initialisation process alot and will fix the icon problem.<br />
      THis can be done quite easily; just cast a pointer of the dos header (struct defined in winnt.h) to the exe header and traverse through the sections until you find 1. the resource directory 2. the bitmap or icon group 3. the first actual icon or bitmaps. In order to get a file offset, remember to consider the RVA(relative virtual address or something).<br />
      <br />
      2. Easy - after bin2h'ing load the header and change the 14h (or whatever it was) offset from 0 to 0x80.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pjw62</span><br />
      <span class="post-time small text-muted">5th November 2001 11:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Another idea I just had would be why not use on the unused fields in the PE header of the exe head to store the size of the exe head. That way on loading the installer, we would not have to cycle through the header in 512 byte increments searching for the NSIS 'neato surprise' thing.<br />
      <br />
      (just a though, would save space and increase speed).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pjw62</span><br />
      <span class="post-time small text-muted">5th November 2001 19:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Nowww.. how do I submit suggestions to Justin?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pjw62</span><br />
      <span class="post-time small text-muted">6th November 2001 19:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Anyway, Rainwater, here are the makefiles I used to compile the header and makensis.<br />
      <br />
      Note; you will still need to define PBS_SMOOTH in resource.[h|rc] (either will do).</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
