<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="CreateShortCuts for all users"><title>CreateShortCuts for all users - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">CreateShortCuts for all users</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=245963">CreateShortCuts for all users</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">lievencardoen</span><br><span class="post-time small text-muted">11th May 2006 15:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>CreateShortCuts for all users</strong><br>I create some shortcuts like this :<br><br>SetShellVarContext current<br>ReadINIStr $3 "$PLUGINSDIR\user.ini" "Field 3" "State"<br>StrCmp $3 "1" 0 +2<br>SetShellVarContext all<br>CreateShortcut "$SMPROGRAMS\$StartMenuGroup\CitePlus1.lnk" "$INSTDIR\CitePlus1.exe" "" "$INSTDIR\deboeck.ICO"<br>CreateShortcut "$DESKTOP\CitePlus1.lnk" "$INSTDIR\CitePlus1.exe" "" "$INSTDIR\deboeck.ICO"<br>CreateShortcut "$QUICKLAUNCH\CitePlus1.lnk" "$INSTDIR\CitePlus1.exe" "" "$INSTDIR\deboeck.ICO"<br><br>In uninstaller I delete them like this :<br><br>SetShellVarContext current<br>ReadINIStr $3 "$PLUGINSDIR\user.ini" "Field 3" "State"<br>StrCmp $3 "1" 0 +2<br>SetShellVarContext all<br>Delete /REBOOTOK "$SMPROGRAMS\$StartMenuGroup\$(^UninstallLink).lnk"<br>Delete /REBOOTOK $INSTDIR\uninstall.exe<br>Delete /REBOOTOK "$SMPROGRAMS\$StartMenuGroup\CitePlus1.lnk"<br>Delete /REBOOTOK "$DESKTOP\CitePlus1.lnk"<br>Delete /REBOOTOK "$QUICKLAUNCH\CitePlus1.lnk"<br><br>When SetShellVarContext is set to current, the shortcuts are deleted, but when SetShellVarContext is set to all, only the shortcut in the quicklaunch bar is deleted (apparently because NSIS doesn't create the quicklaunch shortcut in All Users but in Current User).<br><br>Any ideas?<br><br>Lieven</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">11th May 2006 16:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">My guess is that your "$PLUGINSDIR\user.ini" will only exist for the installer.<br><br>Rather than check the value in the INI file, check if the shortcuts exist for either user and then delete.<br><br>E.g.<br><br></p><pre>
<code>!macro Delete File<br>SetShellVarContext current<br>IfFileExists "${File}" +2<br>SetShellVarContext all<br>Delete "${File}"<br>!macroend<br><br>!insertmacro Delete "$SMPROGRAMS\$StartMenuGroup\$(^UninstallLink).lnk"<br><br>; ...etc<br><br></code>
</pre><br>
      <br>
      -Stu
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">lievencardoen</span><br>
      <span class="post-time small text-muted">11th May 2006 16:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">SetShellVarContext current<br>
      ReadINIStr $3 "$PLUGINSDIR\user.ini" "Field 3" "State"<br>
      StrCmp $3 "1" 0 +2<br>
      SetShellVarContext all<br>
      <br>
      Apparently, the uninstaller doesn't now the state anymore of Field 3... If you install, is it possible to save variables so you can access them when you uninstall?<br>
      <br>
      Lieven</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">lievencardoen</span><br>
      <span class="post-time small text-muted">11th May 2006 16:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Wonderfull! thx!<br>
      <br>
      Is there a way to save a variable so you can access it in the uninstaller?<br>
      <br>
      Lieven</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">11th May 2006 17:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You'd have to save its value in the registry or in an INI file.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>