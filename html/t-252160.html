<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Postgres Silent Install Failure" />

  <title>Postgres Silent Install Failure - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Postgres Silent Install Failure</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=252160">Postgres Silent Install Failure</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">yugo45</span><br />
      <span class="post-time small text-muted">28th July 2006 21:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Postgres Silent Install Failure</strong><br />
      Part of my installer executes a PostgreSQL silent installer.<br />
      <br />
      The line of code that does this looks like this:<br /></p>
      <pre>
<code>execWait "MSIEXEC /i $\"postgresql-8.1-int.msi$\" /qb ADDLOCAL=server, nls, postgis, pljava, psql, pgadmin, jdbc, npgsql, psqlodbc, pgoledb, includefiles, libfiles, msvclibs, pgxs, binfiles INTERNALLAUNCH=1 DOSERVICE=1 CREATESERVICEUSER=0 DOINITDB=1 SERVICEDOMAIN=$\"%COMPUTERNAME%$\" SERVICEACCOUNT=$\"postgres$\" SERVICEPASSWORD=$\"randompass1$\" SERVICENAME=$\"PostgreSQL Database Server 8.1$\" SUPERUSER=$\"postgres$\" SUPERPASSWORD=$\"randompass2$\" LOCALE=C ENCODING=SQL_ASCII LISTENPORT=5432 PERMITREMOTE=1 PL_PGSQL=1 PL_PERL=1 PL_PERLU=1 PL_TCL=0 PL_TCLU=0 PL_PYTHONU=0 PL_JAVA=1 BASEDIR=$\"$INSTDIR\PostgreSQL\8.1$\""</code>
</pre><br />
      When I run this line of code (minus the execWait) directly in the cmd window it works fine. However when ran from the nullsoft installer the Postgres installer starts up and then throws an error saying: "User account ***9633;***9633;***9633;***9633;***9633;***9633;***9633;s***9633;***9633;***9633;***9633;\***9633;***9633;***9633;***9633;***9633;W does not exist"<br />
      <br />
      So it seems that for some reason nullsoft installer messes with the command line arguments of msiexec, and instead of reading "postgres" as the user it uses a random unknown string (always the same one).<br />
      <br />
      Any ideas why this happens?<br />
      <br />
      Thanks.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ginglese</span><br />
      <span class="post-time small text-muted">4th October 2007 08:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hi,<br />
      <br />
      i have the same issue, have you find the solution ?<br />
      <br />
      guillaume</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">yugo45</span><br />
      <span class="post-time small text-muted">4th October 2007 16:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's been a long time since I worked on this, but if I remember well I didn't manage to get that particular line of code working. Instead, I placed that code into a batch file, and then I called that batch file from the installer. So in the installer script I had:<br />
      <br />
      ExecWait "silentPostgresInstall.bat"<br />
      <br />
      I hope that helps. It worked for me.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ginglese</span><br />
      <span class="post-time small text-muted">5th October 2007 08:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks !<br />
      In fact, i have tried this method before your answer and it works.I was curious to know if there were "better" solutions, seems not.<br />
      <br />
      thanks again.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br />
      <span class="post-time small text-muted">5th October 2007 09:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">you can use Process Explorer to verify the command line passed by NSIS installer to MsiExec process</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">3point2</span><br />
      <span class="post-time small text-muted">20th November 2007 13:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've had similar problems running a silent PostgreSQL install. The batch file workaround worked for me, although it would be great if this problem was fixed.<br />
      <br />
      As a result of the batch file workaround, I then had to then figure out how to avoid a command prompt window opening while the batch file ran (used nsExec).<br />
      <br />
      A silent Java install runs with no problems from within NSIS. The error I would get from the postgresql install was "Internal account lookup failure. No mapping between account names and security IDs was done.", although in my efforts to get it to work I also stumbled on the error mentioned in the first post.<br />
      <br />
      I can't figure out whether this is a problem in the postgresql installer or whether something about being run from within NSIS affects its attempts to create or administer the postgres system user.<br />
      <br />
      Is there anyone who knows enough about NSIS internals to figure this one out?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">nsisuser18</span><br />
      <span class="post-time small text-muted">5th December 2007 21:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello,<br />
      I have to do the postgres Install Using NSIS Installer.<br />
      I have to :<br />
      Uninstall postgres(If installed)<br />
      delete pguser(if account there)<br />
      Install postgres<br />
      add pguser to local group<br />
      stop postgres<br />
      start postgres</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">acordner</span><br />
      <span class="post-time small text-muted">25th March 2008 23:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am installing 8.1.4 on a Windows XP SP2 virtual machine (VMWare). It seems that if I specify BASEDIR=&lt;path&gt; in my command line, and &lt;path&gt; is NOT the default install path, I get the error "internal account lookup failure" immediately after the postgres user account is created. If I leave the BASEDIR statement out of the command line, the install succeeds.<br />
      <br />
      When performing the initial installation, Simple File Sharing was enabled. My installation was disabling Simple File Sharing, but not until after the PostgreSQL install was complete. However, if I disable Simple File Sharing prior to installing PostgreSQL, I can specify a BASEDIR and I do not receive the error message indicated above.<br />
      <br />
      Thus, it appears the Simple File Sharing setting interferes with the PostgreSQL installation's ability to set permissions on the \&lt;BASEDIR&gt; folder.<br />
      <br />
      To disable Simple File Sharing, change the registry setting:<br />
      <br />
      HKLM\SYSTEM\CurrentControlSet\Control\Lsa\forceguest = 0<br />
      <br />
      Or uncheck the "Tools &gt; Folder Options &gt; View &gt; Use simple file sharing" option from Windows Explorer.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">acordner</span><br />
      <span class="post-time small text-muted">27th March 2008 00:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">After digging deeper, it seems that the Simple File Sharing setting is not the key to the problem. It has a lot to do with the SERVICEDOMAIN and BASEDIR settings.<br />
      <br />
      - If I do not specify BASEDIR or SERVICEDOMAIN, the installation succeeds.<br />
      <br />
      - If I specify BASEDIR but not SERVICEDOMAIN, the installation never succeeds regardless of the state of the Simple File Sharing setting.<br />
      <br />
      - I have never been able to get the installation to succeed using SERVICEDOMAIN="%COMPUTERNAME%" - it fails every time with the same "Internal account lookup failure" error.<br />
      <br />
      - If I specify SERVICEDOMAIN and pass the name of the computer as read from the Windows Registry (i.e. SERVICEDOMAIN="MYCOMPUTER"), I am also able to specify BASEDIR regardless of the state of the Simple File Sharing setting and the installation seems to succeed every time!<br />
      <br />
      Hope this helps!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">acordner</span><br />
      <span class="post-time small text-muted">27th March 2008 23:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">After more extensive testing on various operating systems (2K SP4, XP SP2, Server 2003, and Vista Business), here is information regarding the use of different "silent mode" switches in combination with the SERVICEDOMAIN and BASEDIR switches:<br />
      <br />
      <br />
      Using the command line: (do not specify SERVICEDOMAIN or BASEDIR)<br />
      msiexec /i "&lt;path&gt;\postgresql-8.1-int.msi" &lt;UIType&gt; INTERNALLAUNCH=1 SERVICEPASSWORD="&lt;pwd&gt;" CREATESERVICEUSER=1 SUPERPASSWORD="&lt;pwd&gt;" ENCODING=UTF8 ADDLOCAL=server,psql,pgadmin<br />
      <br />
      where &lt;UIType&gt; =<br />
      /qr - install succeeds on 2K/XP/Server 2003/Vista<br />
      /qn - install fails on XP/Server 2003 (assumed "Internal account lookup failure" error)<br />
      /qb - install fails on 2K/XP/Server 2003 with "Internal account lookup failure" error<br />
      <br />
      <br />
      <br />
      Using the command line: (specify both SERVICEDOMAIN and BASEDIR)<br />
      msiexec /i "&lt;path&gt;\postgresql-8.1-int.msi" &lt;UIType&gt; INTERNALLAUNCH=1 SERVICEDOMAIN="&lt;ComputerName&gt;" SERVICEPASSWORD="&lt;pwd&gt;" CREATESERVICEUSER=1 SUPERPASSWORD="&lt;pwd&gt;" ENCODING=UTF8 ADDLOCAL=server,psql,pgadmin BASEDIR="C:\PostgreSQL"<br />
      <br />
      where &lt;ComputerName&gt; is setting read from Windows Registry and &lt;UIType&gt; =<br />
      /qr - install succeeds on 2K/XP/Vista but fails on Server 2003 with "Internal account lookup failure" error<br />
      /qn - install succeeds on XP but fails on Server 2003 (assumed "Internal account lookup failure" error)<br />
      /qb - install succeeds on 2K/XP but fails on Server 2003 with "Internal account lookup failure" error<br />
      <br />
      <br />
      <br />
      Using the command line: (specify BASEDIR, do not specify SERVICEDOMAIN)<br />
      msiexec /i "&lt;path&gt;\postgresql-8.1-int.msi" &lt;UIType&gt; INTERNALLAUNCH=1 SERVICEPASSWORD="&lt;pwd&gt;" CREATESERVICEUSER=1 SUPERPASSWORD="&lt;pwd&gt;" ENCODING=UTF8 ADDLOCAL=server,psql,pgadmin BASEDIR="C:\PostgreSQL"<br />
      <br />
      where &lt;UIType&gt; =<br />
      /qr - install succeeds on 2K/XP/Server 2003/Vista<br />
      /qn - install fails on XP/Server 2003 (assumed "Internal account lookup failure" error)<br />
      /qb - install fails on 2K/XP/Server 2003 with "Internal account lookup failure" error</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">thready</span><br />
      <span class="post-time small text-muted">5th September 2008 03:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have tried to run the same silent installer on the command line - without ever using NSIS - and I get the exact same error - "User account â–¡â–¡â–¡â–¡â–¡â–¡â–¡sâ–¡â–¡â–¡â–¡\â–¡â–¡â–¡â–¡â–¡W does not exist". This looks more like a Postgres .msi installer problem - not an NSIS problem..... Has anyone solved this problem?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ginglese</span><br />
      <span class="post-time small text-muted">9th June 2009 13:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thready,<br />
      <br />
      i know it's a late answer but here is my one cents:<br />
      <br />
      Do not create the user account thanks to Posgresql installer.<br />
      Do it by hand in a batch file.<br />
      <br />
      For exemple :<br />
      net user postgres password /passwordreq:yes /PASSWORDCHG:no /add<br />
      <br />
      Guillaume</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vengaboy</span><br />
      <span class="post-time small text-muted">22nd October 2011 17:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>How to uninstall postgres</strong><br />
      Hi all, I had install postgresql server in nsis in silent mode and i want to uninstall it from the installer,<br />
      How</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">T.Slappy</span><br />
      <span class="post-time small text-muted">22nd October 2011 20:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Answer is here: <a href="http://forums.winamp.com/showthread.php?p=2812056&amp;posted=1#post2812056" target="_blank">http://forums.winamp.com/showthread....=1#post2812056</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kalverson</span><br />
      <span class="post-time small text-muted">28th October 2011 20:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Our experience with the create user was that the password for the new postgresql user was not passing the domain password policy.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
