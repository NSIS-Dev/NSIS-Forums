<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="How to attach data to window handle"><title>How to attach data to window handle - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">How to attach data to window handle</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=351787">How to attach data to window handle</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">sss123next</span><br><span class="post-time small text-muted">10th November 2012 17:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>How to attach data to window handle</strong><br>Hi all, i need to attach some data to windows handle for later use, i trying to use {Get/Set}WindowLong, but with no success, i trying following<br><br></p><pre>
<code><br>!define GWL_USERDATA -21<br>System::Call 'user32::SetWindowLong(i $hwnd, i ${GWL_USERDATA}, tr3)'<br>System::Call 'user32::GetWindowLong(i $hwnd, i ${GWL_USERDATA}) i.r4'<br>MessageBox MB_OK "USERDATA $4"<br></code>
</pre><br>
      i storing in $3 some text data, which i need to check later, but in $4 i have pointer address, how i can dereference it ?, and another problem, looks like windows loosing it's style's after this calls, is here another right way to do what i need ?
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br>
      <span class="post-time small text-muted">10th November 2012 22:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Don't use GWL_USERDATA, NSIS already uses it.<br>
      <br>
      If you want to store data "on" a hwnd, use user32::SetProp. If the control is on a nsDialogs page, use nsDialogs::SetUserData.<br>
      <br>
      If you want to store a string you cannot use the trX syntax, you need to allocate real memory with the system plugin and then use the struct syntax to copy strings in and out...</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sss123next</span><br>
      <span class="post-time small text-muted">10th November 2012 22:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">thx for info.<br>
      do i need to call free after nsDialogs::SetUserData call ?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">11th November 2012 02:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You only need to allocate memory if you call user32::SetProp or user::SetWindowLong directly. nsDialogs::SetUserData takes care of memory allocation for you. Every control you create has memory set aside for user data. nsDialogs frees this memory when the control is destroyed along with the dialog.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sss123next</span><br>
      <span class="post-time small text-muted">11th November 2012 08:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">good, thx.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>