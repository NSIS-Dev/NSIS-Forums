<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Use section index in .nsh header file?" />

  <title>Use section index in .nsh header file? - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Use section index in .nsh header file?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=333992">Use section index in .nsh header file?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Harner</span><br />
      <span class="post-time small text-muted">24th August 2011 13:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Use section index in .nsh header file?</strong><br />
      As the question says: I´m trying to use the section index in a .nsh file which configures pages and includes custom pages. I´m trying to do so with the function SectionSetInstTypes.<br />
      <br />
      When I try to get the INST Type with SectionGetInstTypes it´s not working the output is always 7.<br />
      <br />
      This is my code in the header file for the inst type:<br />
      <br />
      <i>SectionSetInstTypes ${Section2} 1<br />
      SectionGetInstTypes ${Section2} $R4<br />
      messagebox mb_ok "$R4"</i><br />
      <br />
      Is there no or any possibility to get the index in the .nsh files?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Harner</span><br />
      <span class="post-time small text-muted">25th August 2011 10:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">So far it seems i can´t use the index because the include is called before the section is declared. But what now? how can I change the InstType while runtime. I´ve got a checkbox on a custom page and depending on this box this section will or will not be installed. (Additonal to the InstType)<br />
      <br />
      Any suggestions?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">25th August 2011 13:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Include the nsh later, or put the section manipulation into a function that is defined after the sections.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Harner</span><br />
      <span class="post-time small text-muted">25th August 2011 15:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I´m totally stuck!<br />
      If I include the header, function whatever after the section where I wanna change the selection that means the installation already happens and it has no effect!?<br />
      <br />
      If I wanna change the InstType of a section while runtime then I need to do that in the leave function of the custom page...circle of death :mad:<br />
      <br />
      I don´t know how to solve this problem I tried to define a variable which represents the InstType in my header...works so far but only with one InstType because the defines are called even if they are in a normal if. So the first if will overwrite the second one. And I can´t figure out how to set !ifdef and !ifndef in the code. :igor:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">25th August 2011 16:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm not seeing what it is you're trying to do, what nsh you are including.<br />
      <br />
      I think you want to create custom pages, and with checkboxes or radio buttons or whatever, let the user choose some options. Those options would then control (enable / disable) Sections that do the actual installation and configuration to meet the user needs.<br />
      <br />
      Here's an outline of the order your nsi should have:<br />
      use !define to create strings for registry keys, program name, etc so future updates are easier<br />
      include the nsh headers at the top of the file.<br />
      define the installer attributes (name, compressor, execution level, etc)<br />
      reserve files (if using solid compression)<br />
      define the pages (standard and custom)<br />
      define/code the sections<br />
      define the language strings (if you use MUI2) for section titles and subtitles<br />
      code callback functions .onInit, etc<br />
      code page functions (pre/show/leave)<br />
      code functions called from the sections<br />
      <br />
      The nsis compiler is just one pass. Except for functions you call, nearly everything must have been compiled before you can write code that references it. Putting functions after all the sections allows the section ids to be defined, and should allow you to set or reset them even though at runtime the page leave code that has called the function was higher in the script than the sections.<br />
      <br />
      Don</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Harner</span><br />
      <span class="post-time small text-muted">26th August 2011 09:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Solved...<br />
      <br />
      My problem was that my function in my nsh file could not find the section index. This nsh includes every configuration for the pages and custom pages.<br />
      <br />
      I solved the problem with a not very nice solution as I think. I included the leave function from my nsh file after the sections in my main file. Problem solved because the function recognized the section index. But it´s not very good for any maintenance!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
