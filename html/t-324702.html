<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Cant get macro to run!"><title>Cant get macro to run! - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Cant get macro to run!</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=324702">Cant get macro to run!</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">starfighter5</span><br><span class="post-time small text-muted">8th December 2010 15:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Cant get macro to run!</strong><br>Hi all,<br><br>I have been battling for a while with this one and have decided to strip it back to basics....<br>I have been following the page at <a href="http://nsis.sourceforge.net/Macro_vs_Function" target="_blank">http://nsis.sourceforge.net/Macro_vs_Function</a><br><br>In my Function.onInit I have....<br><br></p><pre>
<code>!macro Hello<br>  DetailPrint "Hello world"<br>!macroend</code>
</pre><br>
      <br>
      Then I have.....<br>
      <br>
      <pre>
<code>Function tester<br>!insertmacro Hello<br>FunctionEnd</code>
</pre><br>
      <br>
      Lower down in my code, when I run it it doesn't display the Hellow World box, it's probably me being daft but can anyone point out my error?
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br>
      <span class="post-time small text-muted">8th December 2010 15:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Why do you define in the macro <i>in</i> your .onInit function?<br>
      <br>
      Usually you would <i>define</i> the macro before all your functions and sections. And then <i>insert</i> the macro in some function or section.<br>
      <br>
      (Just a side note: Macros don't "run". They are inserted/expanded in-place, at the moment when your installer is built)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">starfighter5</span><br>
      <span class="post-time small text-muted">8th December 2010 16:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi,<br>
      <br>
      I put the macro there as I couldn't find anywhere to tell me where to put it! I have now put it outside of my oninit so it looks like this....<br>
      <br></p>
      <pre>
<code>;Page Variables<br>Function .onInit<br>!insertmacro MUI_INSTALLOPTIONS_EXTRACT_AS "intro.ini" "intro"<br>!insertmacro MUI_INSTALLOPTIONS_EXTRACT_AS "softselect.ini" "softselect"<br>FunctionEnd<br><br>!macro Hello<br>  DetailPrint "Hello world"<br>!macroend</code>
</pre><br>
      <br>
      It still is not displaying the message though :(
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br>
      <span class="post-time small text-muted">8th December 2010 16:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Okay, let me make this clear again:<br>
      <br>
      1. Define your macro using "!macro ... !macroend" before anything else and <i>outside</i> any function/section.<br>
      <br>
      2. Then insert your macro, using "!insertmacro" at the desired place, which can be <i>in</i> a function or a section, for example.<br>
      <br>
      3. Inserting a macro basically means that the macro code will be <i>copied</i> to that place.<br>
      <br>
      4. If you inserted the macro into some function, that code won't execute until the enclosing function is called. If you inserted the macro into some section, that code won't be executed until the enclosing section is executed.<br>
      <br>
      <br>
      Try like:<br>
      <br></p>
      <pre>
<code>OutFile test.exe<br>Name "Test"<br><br>!macro Hello<br>  MessageBox MB_OK "Hello world"<br>!macroend<br><br>Function .onInit<br>  !insertmacro Hello<br>FunctionEnd<br><br>Section<br>  [Your installer section here]<br>SectionEnd</code>
</pre><br>
      <br>
      <br>
      Which is 100% equivalent to:<br>
      <br>
      <pre>
<code>Function .onInit<br>  MessageBox MB_OK "Hello world"<br>FunctionEnd<br><br>Section<br>  [Your installer section here]<br>SectionEnd</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">starfighter5</span><br>
      <span class="post-time small text-muted">8th December 2010 16:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for clarifying things for me, seems I am getting mixed up with commands<br>
      <br></p>
      <pre>
<code>  MessageBox MB_OK "Hello world"</code>
</pre><br>
      <br>
      VS<br>
      <br>
      <pre>
<code>DetailPrint "Hello world"</code>
</pre><br>
      <br>
      I was expecting Hello World to pop up in a box with DetailPrint, which it obviously won't do.<br>
      <br>
      Thanks for steering me in the right direction :)
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br>
      <span class="post-time small text-muted">8th December 2010 16:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">DetailPrint, as the name implies, writes to the installation details box...</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">starfighter5</span><br>
      <span class="post-time small text-muted">8th December 2010 16:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">My mistake.....<br>
      <br>
      On a secondary note, when using the code below<br>
      <br></p>
      <pre>
<code>Function tester<br>!insertmacro test<br>FunctionEnd</code>
</pre><br>
      <br>
      Gives me<br>
      <br>
      <pre>
<code>install function "tester" not referenced - zeroing code out</code>
</pre><br>
      <br>
      Do I need to reference the function elsewhere?
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br>
      <span class="post-time small text-muted">8th December 2010 17:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, you insert (copy) your macro into a custom function named "tester" here.<br>
      <br>
      But apparently you never call that function!<br>
      <br>
      The special .onInit function is called automatically on startup, but "normal" functions are not.<br>
      <br>
      NSIS is smart and will "zero out" (ignore) functions that are never called ;)<br>
      <br>
      <br>
      Try adding something like:<br>
      <br></p>
      <pre>
<code>Section<br>  DetailPrint "Now calling the function..."<br>  Call tester<br>SectionEnd<br></code>
</pre>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>