<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Long file names problem" />

  <title>Long file names problem - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Long file names problem</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=140078">Long file names problem</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SprinklerHead</span><br />
      <span class="post-time small text-muted">25th June 2003 14:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Long file names problem</strong><br />
      Here is a serious problem that I don't think has been resolved. The only information I could find in the forums about it was <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=90175" target="_blank">here</a>, unfortunately no one responded.<br />
      <br />
      The problem is long file names (greater than 8 characters, like bigfilename.txt) get renamed incorrectly on reboot (to bigfil~1.txt for example). This occurred on a Win98 machine here at the office, but it could happen on other operating systems as well (I haven't tried).<br />
      <br />
      Anyone have any ideas on this problem?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">25th June 2003 14:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The problem is that Win98 is DOS-based, so it renames before Windows starts. This is a Windows limitation.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SprinklerHead</span><br />
      <span class="post-time small text-muted">25th June 2003 14:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Any workaround other than renaming all installation files to &lt;= 8 characters?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">25th June 2003 14:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Wininit.ini does not support long file names. Files installed using this method should have 8.3 file names.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Vytautas</span><br />
      <span class="post-time small text-muted">25th June 2003 14:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You could try using "RunOnce" section of the registry to rename files. If this is not posible directly you might have to write a VB Script or something similar to do the actual renaming once the registry runs your command on startup.<br />
      <br />
      Hope this helps you.<br />
      <br />
      Vytautas :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">25th June 2003 15:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I don't think that will work. Usually installers use rename on reboot to replace system files. To replace 'em, the system files should not be in use.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Vytautas</span><br />
      <span class="post-time small text-muted">25th June 2003 15:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Joost Verburg</i><br />
        <b>I don't think that will work. Usually installers use rename on reboot to replace system files. To replace 'em, the system files should not be in use.</b>
      </blockquote>Is there a way to emulate a system file, e.g. make sure it is used like a systems file, so that I could test a script to see if I can get some sort of a solution for this problem?<br />
      <br />
      Vytautas
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">26th June 2003 11:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">SprinklerHead, what version of NSIS are you using? What is the code you are using? Are you using the UpgradeDLL macro or something else?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SprinklerHead</span><br />
      <span class="post-time small text-muted">26th June 2003 12:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Kichik, I am using NSIS version 2.03B. I am not using the upgradedll macro. Here is an example of the code I am using.<br />
      <br /></p>
      <pre>
<code><br />Section<br />  !insertmacro CopyLockedFile FullUpdater.exe $INSTDIR\SYSTEM "${FilesDir}"<br />SectionEnd<br /><br />;-----------------------------------------<br />; CopyLockedFile<br />;-----------------------------------------<br />; Attempts to copy a file. If the file could not be copied, then<br />; the file is copied to a temporary location and copied to<br />; its proper directory after a reboot.<br />;-----------------------------------------<br />!macro CopyLockedFile FILE_NAME OUTPUT_PATH LOCAL_PATH<br />  Push $R1<br /><br />  ClearErrors<br /><br />  ; Try to copy the file.<br />  SetOutPath ${OUTPUT_PATH}<br />  SetOverwrite Try<br />  File "${LOCAL_PATH}\${FILE_NAME}"<br />  SetOverwrite On<br /><br />  ; If we got an error copying, then the file was in use.<br />  IfErrors FileNotCopied ExitOut<br /><br />  ; The file could not be copied, most likely because it was in use.  <br />  FileNotCopied:<br />    ; Create a temporary file. The name of this file will be unique.<br />    ; The name will be stored in $R1.<br />    GetTempFileName $R1<br /><br />    ; Copy the output file over the temporary file we just created.<br />    ; For example, this would copy asteel2.exe to j2iofawer.atj<br />    ; (or some other unique temp file name).<br />    File /oname=$R1 "${LOCAL_PATH}\${FILE_NAME}"<br /><br />    ; Rename and copy the temp file ($R1) to the actual destination,<br />    ; renaming it to the proper name.<br />    ; If a reboot is required (probably always), set the reboot flag.<br />    Rename /REBOOTOK $R1 "${OUTPUT_PATH}\${FILE_NAME}"<br />    <br />  ExitOut:<br />    Pop $R1<br />!macroend<br /></code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">26th June 2003 12:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's not a NSIS related issue, wininit.ini doesn't support it. Other installers have the same limitation.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br />
      <span class="post-time small text-muted">26th June 2003 14:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The Windows API <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/fileio/base/getshortpathname.asp" target="_blank">GetShortPathName()</a> might help here. Maybe NSIS should automatically use this to get the short path name when doing the reboot related stuff.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">26th June 2003 14:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">MoveFileOnReboot does use GetShortPathName because it's required in wininit.ini. The problem is that for some bizarre reason Windows actually uses the short file name and removes the long file name completely. I am currently looking into workarounds for this.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">26th June 2003 15:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Sunjammer</i><br />
        <b>The Windows API <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/fileio/base/getshortpathname.asp" target="_blank">GetShortPathName()</a> might help here. Maybe NSIS should automatically use this to get the short path name when doing the reboot related stuff.</b>
      </blockquote>Windows automatically converts it to a short filename, as you have descripted in your post.
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
