<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Problem with the large string version of NSIS"><title>Problem with the large string version of NSIS - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Problem with the large string version of NSIS</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=315958">Problem with the large string version of NSIS</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">SuperPat</span><br><span class="post-time small text-muted">2nd January 2010 18:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Problem with the large string version of NSIS</strong><br>Hello,<br><br>When I try to compile Ultra Modern UI with the large string build of NSIS, the compiler stop without any error...<br><br>Log with the Confirm.nsi example:</p><pre>
<code>MakeNSIS v2.46 - Copyright 1995-2009 Contributors<br>See the file COPYING for license details.<br>Credits can be found in the Users Manual.<br><br>Processing config: <br>Processing plugin dlls: "C:\Program Files\NSIS\Plugins\*.dll"<br> - AdvSplash::show<br> - Banner::destroy<br> - Banner::getWindow<br> - Banner::show<br> - BgImage::AddImage<br> - BgImage::AddText<br> - BgImage::Clear<br> - BgImage::Destroy<br> - BgImage::Redraw<br> - BgImage::SetBg<br> - BgImage::SetReturn<br> - BgImage::Sound<br> - Dialer::AttemptConnect<br> - Dialer::AutodialHangup<br> - Dialer::AutodialOnline<br> - Dialer::AutodialUnattended<br> - Dialer::GetConnectedState<br> - InstallOptions::dialog<br> - InstallOptions::initDialog<br> - InstallOptions::show<br> - InstallOptionsEx::dialog<br> - InstallOptionsEx::initDialog<br> - InstallOptionsEx::setFocus<br> - InstallOptionsEx::show<br> - InstallOptionsEx::skipValidation<br> - InstallOption****legacy::dialog<br> - InstallOption****legacy::initDialog<br> - InstallOption****legacy::setFocus<br> - InstallOption****legacy::show<br> - InstallOption****legacy::skipValidation<br> - InstallOption****newAPI::dialog<br> - InstallOption****newAPI::initDialog<br> - InstallOption****newAPI::setFocus<br> - InstallOption****newAPI::show<br> - InstallOption****newAPI::skipValidation<br> - LangDLL::LangDialog<br> - Math::Script<br> - NSISArray::ArrayCount<br> - NSISArray::ArrayExists<br> - NSISArray::Clear<br> - NSISArray::Concat<br> - NSISArray::Copy<br> - NSISArray::Cut<br> - NSISArray::Debug<br> - NSISArray::Delete<br> - NSISArray::ErrorStyle<br> - NSISArray::Exists<br> - NSISArray::ExistsI<br> - NSISArray::FreeUnusedMem<br> - NSISArray::Join<br> - NSISArray::New<br> - NSISArray::Pop<br> - NSISArray::Push<br> - NSISArray::Put<br> - NSISArray::ReDim<br> - NSISArray::Read<br> - NSISArray::ReadToStack<br> - NSISArray::Reverse<br> - NSISArray::Search<br> - NSISArray::SearchI<br> - NSISArray::SetAutoReDim<br> - NSISArray::SetSize<br> - NSISArray::Shift<br> - NSISArray::SizeOf<br> - NSISArray::Sort<br> - NSISArray::Splice<br> - NSISArray::Subtract<br> - NSISArray::Swap<br> - NSISArray::Unload<br> - NSISArray::Unshift<br> - NSISArray::Write<br> - NSISArray::WriteList<br> - NSISArray::WriteListC<br> - NSISdl::download<br> - NSISdl::download_quiet<br> - SkinnedControls::setskin<br> - SkinnedControls::skinit<br> - SkinnedControls::unskinit<br> - Splash::show<br> - StartMenu::Init<br> - StartMenu::Select<br> - StartMenu::Show<br> - System::Alloc<br> - System::Call<br> - System::Copy<br> - System::Free<br> - System::Get<br> - System::Int64Op<br> - System::Store<br> - TypeLib::GetLibVersion<br> - TypeLib::Register<br> - TypeLib::UnRegister<br> - UserInfo::GetAccountType<br> - UserInfo::GetName<br> - UserInfo::GetOriginalAccountType<br> - VPatch::GetFileCRC32<br> - VPatch::GetFileMD5<br> - VPatch::vpatchfile<br> - nsDialogs::Create<br> - nsDialogs::CreateControl<br> - nsDialogs::CreateItem<br> - nsDialogs::CreateTimer<br> - nsDialogs::GetUserData<br> - nsDialogs::KillTimer<br> - nsDialogs::OnBack<br> - nsDialogs::OnChange<br> - nsDialogs::OnClick<br> - nsDialogs::OnNotify<br> - nsDialogs::SelectFileDialog<br> - nsDialogs::SelectFolderDialog<br> - nsDialogs::SetRTL<br> - nsDialogs::SetUserData<br> - nsDialogs::Show<br> - nsExec::Exec<br> - nsExec::ExecToLog<br> - nsExec::ExecToStack<br><br>!define: "MUI_INSERT_NSISCONF"=""<br><br>Changing directory to: "C:\Program Files\NSIS\Examples\******odernUI"<br><br>Processing script file: "C:\Program Files\NSIS\Examples\******odernUI\Confirm.nsi"<br>Name: "******odernUI Confirm"<br>OutFile: "Confirm.exe"<br>SetCompressor: /FINAL lzma<br>InstallDir: "$LOCALAPPDATA\******odernUI Test"<br>InstallRegKey: "HKCU\Software\******odernUI Test\"<br>!include: "C:\Program Files\NSIS\Include\UMUI.nsh"<br>!include: "C:\Program Files\NSIS\Contrib\******odernUI\UMUI.nsh"<br>NSIS Ultra Modern User Interface version 1.00 beta 2 - 2005-2009 SuperPat (C:\Program Files\NSIS\Contrib\******odernUI\UMUI.nsh:12)<br>Based on: NSIS Modern User Interface version 1.8 - 2002-2009 Joost Verburg (C:\Program Files\NSIS\Contrib\******odernUI\UMUI.nsh:13)<br>!define: "MUI_INCLUDED"=""<br>!define: "UMUI_SYSVERSION"="1.00 beta 2"<br>!define: "MUI_SYSVERSION"="1.8"<br>!define: "MUI_VERBOSE"="3"<br>!include: closed: "C:\Program Files\NSIS\Contrib\******odernUI\UMUI.nsh"<br>!include: closed: "C:\Program Files\NSIS\Include\UMUI.nsh"<br>!include: "C:\Program Files\NSIS\Include\WinMessages.nsh"<br>!include: closed: "C:\Program Files\NSIS\Include\WinMessages.nsh"<br>!define: "UMUI_SKIN"="red"<br>!define: "MUI_ABORTWARNING"=""<br>!define: "MUI_UNABORTWARNING"=""<br>Var: "STARTMENU_FOLDER"<br>!insertmacro: MUI_PAGE_LICENSE<br>!insertmacro: end of MUI_PAGE_LICENSE<br>!insertmacro: MUI_PAGE_COMPONENTS<br>!insertmacro: end of MUI_PAGE_COMPONENTS<br>!insertmacro: MUI_PAGE_DIRECTORY<br>!insertmacro: end of MUI_PAGE_DIRECTORY<br>!define: "MUI_STARTMENUPAGE_REGISTRY_ROOT"="HKCU"<br>!define: "MUI_STARTMENUPAGE_REGISTRY_KEY"="Software\******odernUI Test"<br>!define: "MUI_STARTMENUPAGE_REGISTRY_VALUENAME"="Start Menu Folder"<br>!insertmacro: UMUI_PAGE_ALTERNATIVESTARTMENU<br>!insertmacro: end of UMUI_PAGE_ALTERNATIVESTARTMENU<br>!define: "UMUI_CONFIRMPAGE_TEXTBOX"="confirm_function"<br>!insertmacro: UMUI_PAGE_CONFIRM</code>
</pre>It did the same thing when you try to insert an ultra modern page.<br>
      <br>
      Do you now why?<br>
      <br>
      Best Regards,<br>
      SuperPat
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br>
      <span class="post-time small text-muted">2nd January 2010 20:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I just tried to compile the ******odernUI (1.00 2009-12-25) basic.nsi example with the large string build and it worked...<br>
      <br>
      But when I tried to compile the confirm.nsi example makensis crashed.</p>

      <blockquote>
        <font color="red">Second chance exception 0xC00000FD (Stack Overflow) occurred in "MAKENSIS.EXE" at address 0x0044F907.</font>
      </blockquote>ps. For some reason the forum is filtering word ****** (u-l-t-r-a-m) effectively breaking urls to ******odernUI.<br>
      <br>
      PaR
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SuperPat</span><br>
      <span class="post-time small text-muted">2nd January 2010 21:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The basic.nsi example works because it does not use any InstallOptionsEx pages.<br>
      <br>
      The WelcomeFinishAbort.nsi, MultiLanguage.nsi examples work fine</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br>
      <span class="post-time small text-muted">2nd January 2010 21:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Reduced test case probably would help to solve this problem. ;)<br>
      <br>
      PaR</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br>
      <span class="post-time small text-muted">2nd January 2010 21:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">With "Stack Overflow" two things come to my mind: Either UMUI uses too many nested macros/functions, so that the stack runs out of free space (maybe the long strings build requires more stack space per macro/function call, so that's why the "normal" build works?) or there is an infinite recursion somewhere. The latter is unlikely, because it would (most-likely) apply to the "normal" build as well. Can't we simply increase the stack size ???</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SuperPat</span><br>
      <span class="post-time small text-muted">3rd January 2010 14:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by LoRd_MuldeR</i><br>
        <b>With "Stack Overflow" two things come to my mind: Either UMUI uses too many nested macros/functions, so that the stack runs out of free space (maybe the long strings build requires more stack space per macro/function call, so that's why the "normal" build works?)</b>
      </blockquote>You are right but there are only three sub-macro level where it crashes but some of them can be called several times in the same function.<br>
      <br>
      It is true that I use too many macros, and not enough functions because of their difficulty in managing it:<br>
      <br>
      Some function may be called in install script and uninstall script but it is not an obligation and an unused function causes a warning.<br>
      <br>
      I might try using a little less macro, but I think the stack will still always too small.<br>
      <br>
      <br>

      <blockquote>
        <i>Originally posted by LoRd_MuldeR</i><br>
        <b>Can't we simply increase the stack size ???</b>
      </blockquote>This would be perfect!
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br>
      <span class="post-time small text-muted">4th January 2010 20:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here's an modified version of the large string makensis.exe with stack size set to 8 MB. I used EDITBIN from the VC++ toolset to change the stack size.<br>
      <br>
      PaR</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br>
      <span class="post-time small text-muted">4th January 2010 20:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That one works for me :)<br>
      <br>
      BTW: Is there a way to detect NSIS_MAX_STRLEN at runtime?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br>
      <span class="post-time small text-muted">4th January 2010 20:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Not sure what you mean, but NSIS_MAX_STRLEN is defined at script compiletime and passing it to some runtime variable shouldn't be a problem. E.g. StrCpy $0 ${NSIS_MAX_STRLEN}<br>
      <br>
      NSIS_MAX_STRLEN is also passed on plug-in when they are called.<br>
      <br>
      PaR</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br>
      <span class="post-time small text-muted">4th January 2010 21:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ah, thanks again!<br>
      <br>
      I couldn't find <b>${NSIS_MAX_STRLEN}</b> in the docs and only tried <b>${__NSIS_MAX_STRLEN__}</b> ;)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br>
      <span class="post-time small text-muted">4th January 2010 21:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Right :)<br>
      You can run command 'makensis /HDRINFO' to get a list of options makensis was compiled with. All those options should be defined when compiling scripts.<br>
      <br>
      PaR</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">theTallGuy</span><br>
      <span class="post-time small text-muted">13th May 2010 01:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by {_trueparuex^}</small><br>
        Here's an modified version of the large string makensis.exe with stack size set to 8 MB. I used EDITBIN from the VC++ toolset to change the stack size.
      </blockquote>Is this version of the file still available somewhere? I, too, am getting the crashing issue, and would love a quick fix.<br>
      <br>
      Alternately, is there another way to change the stack size without using the VC++ toolset, which I don't have?<br>
      <br>
      Thanks in advance!<br>
      Michael
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">13th May 2010 10:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://nsis.sourceforge.net/Docs/AppendixG.html#G.1" target="_blank">http://nsis.sourceforge.net/Docs/AppendixG.html#G.1</a><br>
      <br>
      Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br>
      <span class="post-time small text-muted">15th May 2010 14:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by theTallGuy</small><br>
        Is this version of the file still available somewhere? I, too, am getting the crashing issue, and would love a quick fix.<br>
        <br>
        Alternately, is there another way to change the stack size without using the VC++ toolset, which I don't have?<br>
        <br>
        Thanks in advance!<br>
        Michael
      </blockquote>Not sure what happened to the attachment, but I uploaded another version to my website:<br>
      <a href="http://koti.mbnet.fi/vaultec/files/miscellaneous/makensis_strlen_8192_stack_8M.zip" target="_blank">http://koti.mbnet.fi/vaultec/files/m...2_stack_8M.zip</a><br>
      <br>
      The stack size is just a value in the PE header and you can change it with tools like: LordPE, PE tools, PE Explorer ... hex editor of your choice. :D<br>
      <br>
      PaR
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bnicer</span><br>
      <span class="post-time small text-muted">20th May 2010 03:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">AddSize no longer works. Is this version based on a nightly build? Otherwise, thanks.<br>
      <br>
      edit:<br>
      Nor does it automatically get the section size for 'Space required'. You have to calculate manually and SectionSetSize as a workaround.<br>
      <br>
      edit again:<br>
      It hinges on the placement of sections. Don't ask me why. They have to be before .onInit? (Or nothing installs.) I can't fix it.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bnicer</span><br>
      <span class="post-time small text-muted">20th May 2010 06:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There is another large string download from sourceforge. The installer it builds fails the integrity check. This puts me in a bind. Not being a developer, I can't build me own version.<br>
      <br>
      I'm using a single string with potentially, although unlikely, up to 150 paths of files that are in use. I'm unable to divide the string up into several smaller segments, because each path will be added onto the one string with a line break, and the string will be displayed on the MUI UnConfirmPage as a list of files. I would trim the full paths and use only the file names, as a last resort.<br>
      <br>
      Is anyone else having similar issues with the large string build: "Installer integrity check has failed"?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br>
      <span class="post-time small text-muted">20th May 2010 08:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Why not use a listbox to display the paths?<br>
      You could add one line at a time</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bnicer</span><br>
      <span class="post-time small text-muted">20th May 2010 09:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's possible. I haven't worked with listboxes before. The list has to refresh when there are still some files open after the Uninstall button is pressed, scroll down with many files, and scroll horizontally or wrap if the path is long. I think you can achieve the first two, but not sure about the third. I'll see what happens. Thanks. :up:</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br>
      <span class="post-time small text-muted">20th May 2010 09:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://lmgtfy.com/?q=listbox+horizontal+scroll" target="_blank">http://lmgtfy.com/?q=listbox+horizontal+scroll</a></p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br>
      <span class="post-time small text-muted">20th May 2010 17:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by bnicer</small><br>
        AddSize no longer works. Is this version based on a nightly build? Otherwise, thanks.<br>
        <br>
        edit:<br>
        Nor does it automatically get the section size for 'Space required'. You have to calculate manually and SectionSetSize as a workaround.<br>
        <br>
        edit again:<br>
        It hinges on the placement of sections. Don't ask me why. They have to be before .onInit? (Or nothing installs.) I can't fix it.
      </blockquote>It's the official large string build (NSIS v2.46) modified with EDITBIN.<br>
      <br>
      Are you using the correct stub files?<br>
      <br>
      PaR
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bnicer</span><br>
      <span class="post-time small text-muted">21st May 2010 00:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm using stubs that are in the stubs folder for the normal build. Is that wrong?<br>
      <br>
      What strikes me is that AddSize does not add size to the section it's in. Unless I move the section that installs files forward, nothing really happens. It's like the section wasn't there.<br>
      <br>
      edit: I just read the readme.txt, which mentions stubs. I missed that. Sorry. My mistake.<br>
      <br>
      Yes, and the sourceforge download and the large string build you posted are both up and running without a hitch now. Again, sorry for the fuss, people. :o Oops. Thanks!</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">PoRtAbLe_StEaLtH</span><br>
      <span class="post-time small text-muted">8th January 2013 15:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Not compatible with Unicode?</strong><br>
      only works with ANSI?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br>
      <span class="post-time small text-muted">8th January 2013 22:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by PoRtAbLe_StEaLtH</small><br>
        only works with ANSI?
      </blockquote>The unicode build uses large strings by default IIRC
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>