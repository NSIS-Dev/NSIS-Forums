<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Custom InstType"><title>Custom InstType - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Custom InstType</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=279052">Custom InstType</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">localmatters</span><br><span class="post-time small text-muted">15th October 2007 22:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Custom InstType</strong><br>I'm looking to allow the end user the ability to select install types from the drop down list OR enable them to select the sections from the component list. The selection from the drop down corresponds to the section checked in the component list...they're one and the same (you can liken it to a 1-1 relationship). So, I've included the custom insttype, and used the logic from the one-section.nsi example. This works fine, except I really don't need the "Custom" option appearing in the insttype drop down list. How do I remove this value and still have the user do EITHER/OR: EITHER select from the drop down list OR check the section from the components box? I am aware that I can just have the drop down list and eliminate the component list, but the client desires to have both available.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">16th October 2007 00:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Selection in the components tree is disabled when you use <i>InstType /NOCUSTOM</i>. You can hack around this by setting the Custom text to nothing or even removing it from the drop down by sending CB_DELETESTRING.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">localmatters</span><br><span class="post-time small text-muted">16th October 2007 15:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for your prompt response. Your first suggestion is an option I can use, however, I'd rather your second suggestion. It's cleaner. The only thing is, I'm not sure how to go about sending the CB_DELETESTRING message out for the drop down combo box. Do you have an example I can work with? I attempted the following in the .onInit function, but it failed to render correct results:<br>-----------------------------------<br>Push $R0<br><br>FindWindow $R0 "#32770" "" $HWNDPARENT<br>GetDlgItem $R0 $R0 1017<br>SendMessage $R0 ${CB_DELETESTRING} -1 "STR:Custom"<br><br>Pop $R0<br>------------------------------------<br>What am I doing wrong? Appreciate your help in this regard.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">16th October 2007 22:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That piece of code should work, only it should be called when the dialog is visible and not in .onInit. You should call it in the show callback function of the components page. Try MessageBox'ing $R0 to make sure you get the correct handle. You can also hide the window using ShowWindow to verify.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">localmatters</span><br><span class="post-time small text-muted">17th October 2007 16:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I just can't get this to work...I appear to be retrieving the incorrect item_id. How do I get the correct item_id of the combo box? Plus, how do I get to the "show" callback function of the components page? Once again, thanks for your help in this matter.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">17th October 2007 19:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You're using the correct control identifier. But that won't help you if you're not calling it in the proper context which is the show callback function. If you don't call it from there, the dialog and the control itself don't even exist.<br><br>I'll assume you're using the MUI and therefore you need MUI_PAGE_CUSTOMFUNCTION_SHOW.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">localmatters</span><br><span class="post-time small text-muted">17th October 2007 20:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks! That helps...one thing though, when do I declare this function? After !define MUI_STARTMENUPAGE statement and before !define MUI_FINISHPAGE_NOREBOOTSUPPORT? I inserted it before the below and got a compile error.<br><br>;--------------------------------<br>;Modern UI Configuration<br><br>!define MUI_WELCOMEPAGE<br>!define MUI_COMPONENTSPAGE<br>!define MUI_DIRECTORYPAGE<br>!define MUI_STARTMENUPAGE<br>!define MUI_FINISHPAGE_NOREBOOTSUPPORT<br>!define MUI_ABORTWARNING<br>!define MUI_UNINSTALLER<br>!define MUI_UNCONFIRMPAGE<br>; !define MUI_COMPONENTSPAGE_NODESC<br><br><br><br>;--------------------------------</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">17th October 2007 21:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">As the Modern UI readme states, right before inserting the components page macro.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">localmatters</span><br><span class="post-time small text-muted">17th October 2007 21:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The thing is I don't have "!insertmacro MUI_PAGE_COMPONENTS" macro inserted anywhere in my NSI file...(I inherited this file from an ex-developer). Therefore, I attempted the below:<br><br>;--------------------------------<br>;Modern UI Configuration<br><br>!define MUI_WELCOMEPAGE<br>!define MUI_PAGE_CUSTOMFUNCTION_SHOW delete_customstring<br><br>Function delete_customstring<br>Push $R0<br><br>FindWindow $R0 "#32770" "" $HWNDPARENT<br>GetDlgItem $R0 $R0 1017<br>SendMessage $R0 ${CB_DELETESTRING} -1 "STR:Custom"<br><br>Pop $R0<br>FuncionEnd<br>!define MUI_COMPONENTSPAGE<br>!define MUI_DIRECTORYPAGE<br>!define MUI_STARTMENUPAGE<br>!define MUI_FINISHPAGE_NOREBOOTSUPPORT<br>!define MUI_ABORTWARNING<br>!define MUI_UNINSTALLER<br>!define MUI_UNCONFIRMPAGE<br>;!define MUI_COMPONENTSPAGE_NODESC<br>;--------------------------------<br><br>and still got a compile error. The version of Nullsoft I have is 2.0b3.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">17th October 2007 21:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">2.0b3? That's older than me... :)<br><br>You'd have to look in your version's readme file for the definition of this function or upgrade.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">localmatters</span><br><span class="post-time small text-muted">18th October 2007 16:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Kichik:<br><br>Thanks a bunch for all your help! I finally got it to work! This is what was needed (the SendMessage wparam parameter needs the index of the item to be deleted from the combo box):<br>------------------------------<br>;Modern UI Configuration<br><br>!define MUI_WELCOMEPAGE<br>!define MUI_COMPONENTSPAGE<br>!define MUI_CUSTOMFUNCTION_COMPONENTS_SHOW myCustomFunc<br><br>Function myCustomFunc<br>Push $R0<br><br>FindWindow $R0 "#32770" "" $HWNDPARENT<br>GetDlgItem $R0 $R0 1017<br>;ShowWindow $R0 ${SW_HIDE}<br><br>SendMessage $R0 ${CB_DELETESTRING} 3 "STR:Custom"<br><br>Pop $R0<br>FunctionEnd<br><br>-----------------------------<br><br>Once again, thanks for helping me see the light at the end of the tunnel.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>