<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="registry access (vista?)"><title>registry access (vista?) - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">registry access (vista?)</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=266934">registry access (vista?)</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">bnicer</span><br><span class="post-time small text-muted">2nd March 2007 11:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>registry access (vista?)</strong><br>Hello All!<br><br>I have two questions. One should be a quickie:<br><br>1) What would be the most simple and elegant way to determine whether a user has write access to the registry (for example, to create an uninstall entry) at the beginning of the setup?<br><br>I have been reading some strange posts on this forum that deal with putting shortcuts on the desktop and placing them in the startmenu group under Vista. I haven't had a chance to try out Vista. My second question (based on XP) is:<br><br>2) What exactly are the differences/problems?<br><br>If still possible, I would use "UserInfo::GetAccountType" together with "SetShellVarContext". Will I be okay?<br><br>To expand on this a little, an administrator will have a checkbox for installing shortcut icons for all users or for the current user. Other users must make do with installing the icons for themselves only.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comperio</span><br><span class="post-time small text-muted">2nd March 2007 15:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><b>For #1:</b><br>A quick test would be to write something to the registry and then check for errors. If errors, you probably don't have access. (You should then probably try to delete what you just wrote just to keep things clean.)<br><br><b>For #2:</b><br>I wouldn't see a problem with what you suggest.<br><br><b>Finally for Vista:</b><br>You should make sure you include RequestExecutionLevel and set it to something other than "none". The reason is that this will add a manifest into the install and guarantee that the registry virtulization feature in Vista is disabled.<br><br>If you have not done so already, you should really read up on <a href="http://technet.microsoft.com/en-us/windowsvista/aa906021.aspx" target="_blank">UAC (user account control)</a> in Vista.<br><br>Also search the forums for Vista-related info. There's been quite a few threads about that lately.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bnicer</span><br><span class="post-time small text-muted">2nd March 2007 16:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thx. I'll take your advice and do some more reading.<br><br>Is what you are basically saying that you would only need an extra line of code and everything will work in Windows Vista as it does in XP?<br><br>If it gets much more complicated, maybe it would be best to just upgrade to Vista and test the scenarios. So I ask.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comperio</span><br><span class="post-time small text-muted">3rd March 2007 01:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>Is what you are basically saying that you would only need an extra line of code and everything will work in Windows Vista as it does in XP?</blockquote>For the most part, yes. But as I'm finding on my own, there may be a few quirky things you could run into as a result of UAC and some of Vista's virtualization (used for registry and folders under certain situtions where the user doens't have full permissions.)<br><br>You may find that having a Vista machine to play with might help spot potential problems. ;)</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bnicer</span><br><span class="post-time small text-muted">4th March 2007 18:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">In preparing myself for the transition to Vista, I'm attempting something probably pretty asinine, but if getting this to work in XP is possible, I'd be happy temporarily.<br><br>Run setup 2x:<br>2 installations<br>2 destinations<br>2 uninstallers<br>for which there are 2 registry entries<br>under HKLM and the other is under HKCU.<br><br>The problem is telling the uninstaller which installation to uninstall, the HKLM one or the HKCU one. The uninstall registry values that specify the install path can be read at runtime, but there are 2. Which one refers to the path you want to remove when clicking on the uninstaller?<br><br>Put differently, how does the uninstaller retrieve a variable for the particular instance that is unique?<br><br>It occurs to me to include a file with one or the other setup. If found, the uninstaller would target the right instance, however isn't there an easier way?<br><br>The uninstall file needs to know which registry entry it was installed with.<br><br>Maybe I can figure something out to do that, but if someone has any suggestions, that would be superb.<br><br>Thx.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bnicer</span><br><span class="post-time small text-muted">4th March 2007 19:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">A neat trick might be to have uninst.exe return its own location. Then you could compare the location to the registry uninstall string.<br><br>IfThisFileExists???</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bnicer</span><br><span class="post-time small text-muted">5th March 2007 02:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I've been looking too hard.<br><br>$INSTDIR\uninst.exe is the uninstaller location. I thought $INSTDIR had to be stored somewhere, but the uninstaller remembers it. That means for every install path the uninstaller generated is distinct, and you can read the registry to check the install path. If $INSTDIR\uninst.exe and the uninstall string are a match, the correct instance will be uninstalled.<br><br>Phew...<br><br>I gather, perhaps mistakenly, that among Vista's quirks, it may be expedient to write uninstall keys to HKCU; I'm keeping my fingers crossed this will be useful later.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>