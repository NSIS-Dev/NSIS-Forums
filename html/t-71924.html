<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Refresh with SendMessage" />

  <title>Refresh with SendMessage - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Refresh with SendMessage</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=71924">Refresh with SendMessage</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br />
      <span class="post-time small text-muted">14th January 2002 17:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Refresh with SendMessage</strong><br />
      Hi all,<br />
      <br />
      I previously asked questions about SendMessage (for those interested: I have a fight with Matlab: it doesn't understand my messages amd I don't understand it's output so we've broken up and I tried something else to install a plugin into Matlab... and succeeded :)).<br />
      <br />
      But now: how to refresh the desktop (like F5)? My little program created in NSIS edits some HTML page on the Active Desktop (Windows) and I need to refresh the desktop to load this page.<br />
      <br />
      Is it possible using SendMessage. How?<br />
      <br />
      Thx, greetz, Hendri.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">F. Heidenreich</span><br />
      <span class="post-time small text-muted">14th January 2002 18:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Nice that you've found a solution for your problem :)<br />
      <br />
      The refresh thing should work when you send an WM_SETTINGCHANGE with the hwnd HWND_BROADCAST.<br />
      <br />
      Since WM_SETTINGCHANGE resolves to 26 and HWND_BROADCAST to 0xFFFF a call to</p>
      <pre>
<code>SendMessage 65535 26 0 0</code>
</pre>should do the job.<br />
      <br />
      ~ Florian
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br />
      <span class="post-time small text-muted">14th January 2002 18:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Florian, thx a lot,<br />
      <br />
      it works great!!!<br />
      <br />
      Thx, thx, thx, greetz,<br />
      Hendri.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br />
      <span class="post-time small text-muted">14th January 2002 18:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Florian, sorry,<br />
      <br />
      for a minnute it appeared to work great, because my screen flashed,<br />
      but after implementing this into the HTML editor for my active desktop I saw that only the desktop gets a refresh, except my Active Desktop (the HTML doc).<br />
      <br />
      How to refresh this one then? (And maybe also ONLY this one if possible...)<br />
      <br />
      Can you help me, thx, greetz,<br />
      Hn3.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Nebulus</span><br />
      <span class="post-time small text-muted">1st August 2003 15:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If NSIS can exec an external vbscript, I've got the answer.<br />
      <br />
      I did have the script writing to the registry and refreshing the desktop, but it just wasn't updating to display the new page. this code does it. To test, just create a dummy HTML page and set it in your %systemroot%\web\wallpaper directory, then change the script to point to the correctly named page.<br />
      <br />
      Running the script will set the desktop, open the display properties window, move the selection up/down, then click the OK button. It's dirty, but it gets done!<br />
      <br />
      ****************************************<br />
      BEGIN CODE<br />
      ****************************************<br />
      ' Create the variables needed<br />
      Dim WSHShell<br />
      Dim WSHApp<br />
      Dim strRegKey<br />
      Dim strWallpaper<br />
      Dim strOSRoot<br />
      Dim strDesktop<br />
      Dim strDisplayProp<br />
      <br />
      ' Create the Wscript Shell object<br />
      Set WSHShell = WScript.CreateObject("WScript.Shell")<br />
      Set WSHApp = CreateObject("Shell.Application")<br />
      <br />
      ' Define the wallpaper<br />
      strWallpaper = "%SystemRoot%\Web\Wallpaper\PRWeb.html"<br />
      strDesktop = WSHShell.SpecialFolders("Desktop")<br />
      strDisplayProp = "Display Properties"<br />
      <br />
      ' Create the wallpaper key<br />
      strRegKey = "HKEY_CURRENT_USER\"<br />
      strRegKey = strRegKey &amp; "Software\"<br />
      strRegKey = strRegKey &amp; "Microsoft\"<br />
      strRegKey = strRegKey &amp; "Internet Explorer\"<br />
      strRegKey = strRegKey &amp; "Desktop\"<br />
      strRegKey = strRegKey &amp; "General\"<br />
      strRegKey = strRegKey &amp; "Wallpaper"<br />
      <br />
      ' Write the key, type, and value<br />
      WSHShell.RegWrite strRegKey, strWallpaper, "REG_EXPAND_SZ"<br />
      <br />
      WSHApp.ControlPanelItem cstr("desk.cpl")<br />
      Do Until WSHShell.AppActivate (strDisplayProp)<br />
      Loop<br />
      WSHShell.SendKeys "{down}{up}{tab 3}a~"<br />
      ****************************************<br />
      END CODE<br />
      ****************************************<br />
      <br />
      The only problem you might have is with a virus scanner - it'll throw up an alert as soon as you try to run a .vbs file. Hope that helps!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
