<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="ExecWait in Uninstall Section" />

  <title>ExecWait in Uninstall Section - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">ExecWait in Uninstall Section</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=82614">ExecWait in Uninstall Section</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">maragato</span><br />
      <span class="post-time small text-muted">27th March 2002 20:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>ExecWait in Uninstall Section</strong><br />
      I had problems when I used the ExecWait procedure in Uninstall Section!<br />
      <br />
      Example:<br />
      ExecWait "$WINDIR\notepad.exe"<br />
      <br />
      The application does not execute! (Only in Uninstall Section, but in all others instalation sections it works.)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br />
      <span class="post-time small text-muted">27th March 2002 21:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Maragato,<br />
      <br />
      I tested it, no problems at my machine! It just works fine. Maybe there are other problems in the installer...<br />
      <br />
      -Hn3.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">maragato</span><br />
      <span class="post-time small text-muted">28th March 2002 11:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Thanks for help!</strong><br />
      Please, send me a .nsi file with this case.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br />
      <span class="post-time small text-muted">28th March 2002 14:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The test file:<br />
      <br />
      if executed it runs and waits for notepad<br />
      then it creates $DESKTOP\unprob.exe<br />
      <br />
      when run this exe it starts notepad.exe again.<br />
      <br />
      Why wouldn't this not work? Maybe you did something wrong in the rest of the script. Maybe you delete notepad.exe???<br />
      <br />
      Just a guess... :)<br />
      <br />
      Good luck,<br />
      Hendri.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Piotr Strycharz</span><br />
      <span class="post-time small text-muted">9th April 2002 08:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>ExecWait: Solution</strong><br />
      There is a "feature" (bug?) in NSI scripts.<br />
      ExecWait does not work when used after RmDir /r $INSTDIR (this is where I have uninstall executable).<br />
      However it may not work in other situations, too, but I have not tested it.<br />
      <br />
      Solution: Remove $INSTDIR as the last line in your uninstall script.<br />
      <br />
      These are the fragments of the NSI file:<br />
      <br />
      ; Won't work<br />
      Section "Uninstall"<br />
      RMDir /r $INSTDIR<br />
      DeleteRegKey HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\C+Shop v 6.0"<br />
      Call un.RmDLL ; This is where ExecWait is called<br />
      SectionEnd<br />
      <br />
      ; Will work<br />
      Section "Uninstall"<br />
      DeleteRegKey HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\C+Shop v 6.0"<br />
      Call un.RmDLL<br />
      RMDir /r $INSTDIR<br />
      SectionEnd<br />
      <br />
      Piotr.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br />
      <span class="post-time small text-muted">9th April 2002 10:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Piotr,<br />
      <br />
      please tell me what this un.RmDll does. If it tries to display some text (readme.txt or something) that is supposed to be in $INSTDIR of course this will not work because you just deleted the file in the original script. So the correction is obvious then. Just do not delete files if you still have to display/execute them.<br />
      <br />
      But that's my guess for I don't know what this un.RmDll is doing. Just post this script or take a look at it yourself. I expect that this might be the solution to the problem. But I can only tell if there is really a bug or just a mistake in the script when you post the un.RMDLL script.<br />
      <br />
      Or take a look at the uninstall details (in the uninstall window) If you don't find the ExecWait command there, the uninstall could not find or execute the file.<br />
      <br />
      Good luck,<br />
      -Hendri.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Piotr Strycharz</span><br />
      <span class="post-time small text-muted">9th April 2002 10:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hendri,<br />
      <br />
      I've just removed unnecessary code to make it clear. It does not matter what function un.RmDLL does. There is FULL nsi script at the bottom that does not work.<br />
      It should probably run write.exe (it's in system directory, not in \TEMP that is removed).<br />
      Please make sure the script removes the \TEMP dir. Actually if it's not removed (eg you have it open in Command Prompt or Explorer) the script runs well.<br />
      If you move RMDIR just before SectionEnd - works fine !<br />
      <br />
      Probably (I did not look at the code) when installer get's removed (and its dir, too) it looses environment (with PATH variable)<br />
      <br />
      Piotr.<br />
      <br />
      ;<br />
      OutFile "Test.exe"<br />
      InstallDir "C:\TEMP"<br />
      <br />
      Section "Install"<br />
      SetOutPath $INSTDIR<br />
      File "C:\WINNT\Notepad.exe"<br />
      WriteUninstaller "$INSTDIR\uninst.exe"<br />
      WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\Test" \<br />
      "DisplayName" "Test"<br />
      WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\Test" \<br />
      "UninstallString" '"$INSTDIR\uninst.exe"'<br />
      SectionEnd<br />
      <br />
      Section "Uninstall"<br />
      RMDir /r $INSTDIR<br />
      ExecWait "write.exe"<br />
      DeleteRegKey HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\Test"<br />
      SectionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br />
      <span class="post-time small text-muted">9th April 2002 11:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Piotr,<br />
      <br />
      take a look at this script:</p>
      <pre>
<code>OutFile "Test.exe" <br />InstallDir "C:\TEMP"<br />name test <br /><br />Section "Install"<br />SetOutPath $INSTDIR <br />WriteUnInstaller "$INSTDIR\uninst.exe"<br />SectionEnd<br /><br />Section uninstall<br />RMDir /r $INSTDIR<br />SetOutPath $WINDIR<br />ExecWait "write.exe"<br />sectionend</code>
</pre><br />
      It works. Apparently, the problem is that once the dir has been removed, the uninstaller cannot find the path anymore. So we have to set it manually to an existing dir, eg "WinDir". BTW, the same is true for an installer like this:
      <pre>
<code>OutFile "Test.exe" <br />InstallDir "C:\TEMP"<br />name test <br /><br />Section "Install"<br />SetOutPath $INSTDIR <br />RMDir /r $INSTDIR<br />SetOutPath $WINDIR<br />ExecWait "write.exe"<br />SectionEnd</code>
</pre><br />
      I don't know if this is a bug. It seems a bit logical to me since $INSTDIR does not exists anymore. It has to do with the way Windows manages the path and how it can find it, I guess.<br />
      <br />
      But it's nice we know of the problem right now and of the solution. So there are no limitations to the script (in terms of deleting dirs ONLY at the end of the uninstall) but just take care that the program can find the files to be run by including the proper path or resetting the current dir to an existing one.<br />
      <br />
      Good luck, greetz,<br />
      -Hendri.
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
