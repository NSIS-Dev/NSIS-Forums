<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Help with script"><title>Help with script - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Help with script</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=262091">Help with script</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">JediKnight2</span><br><span class="post-time small text-muted">19th December 2006 17:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Help with script</strong><br>OK. I have waded thru the Java detect script and have fixed the script. It will detect java correctly and prompt to install if needed. ONE problem remains that I just cant figure out. If Java is NOT installed or is OLD, the program CORRECTLY prompts to install the Java package, installs it then moves to install the program. If Java IS installed, however, it DOES skip the java warnings but moves to install java anyway??? Can someone take a look for me.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sag47</span><br><span class="post-time small text-muted">19th December 2006 18:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><b>Look at your code:</b><br><font face="courier new">Function DetectJRE<br>ReadRegStr ${TEMP} HKLM "SOFTWARE\JavaSoft\Java Runtime Environment" "CurrentVersion"<br>ReadRegStr ${TEMP2} HKLM "SOFTWARE\JavaSoft\Java Runtime Environment\${TEMP}" "JavaHome"<br>Goto GetJRE<br><br><br>GetJRE:<br>IfFileExists "${TEMP2}\bin\java.exe" 0 NoFound<br>StrCpy ${VAL1} ${TEMP} 1<br>StrCpy ${VAL2} ${JRE_VERSION} 1<br>IntCmp ${VAL1} ${VAL2} 0 FoundOld FoundNew<br>StrCpy ${VAL1} ${TEMP} 1 2<br>StrCpy ${VAL2} ${JRE_VERSION} 1 2<br>IntCmp ${VAL1} ${VAL2} FoundNew FoundOld FoundNew</font><br><br><b>A possible fix:</b><br>Change IfFileExists "${TEMP2}\bin\java.exe" 0 NoFound to the following.<br><br><font face="courier new">IfFileExists "${TEMP2}\bin\java.exe" "" NoFound</font><br><br>In another installation I had errors with IfFileExists using a 0 in that blank function field. Replace it with quotes and let me know how it goes.<br><br>In fact I recommend using quotes to show blank fields instead of a 0. It seemed to cure all my errors<br>SAM</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JediKnight2</span><br><span class="post-time small text-muted">19th December 2006 18:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Nope...that didnt fix it..<br><br>I hopefully explained what it was doing correctly...like I said it is detecting that I have the correct JRE version...but it is going into the JRE install anyway..for instance..say I dont have JRE installed it comes up with a screen that tells them no JRE is present...they press next and a window comes up unzipping the JRE and installing it after that is complete it goes to the program install...well right now if the PROPER JRE is found no warning about JRE is shown but it goes straight to the JRE install...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JediKnight2</span><br><span class="post-time small text-muted">19th December 2006 20:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">For some reason I think it is in this section...<br><br>Function CheckInstalledJRE<br>Call DetectJRE<br>Pop ${TEMP}<br>StrCmp ${TEMP} "OK" NoDownloadJRE<br>Pop ${TEMP2}<br>StrCmp ${TEMP2} "None" NoFound FoundOld<br><br>FoundOld:<br>!insertmacro MUI_INSTALLOPTIONS_WRITE "jre.ini" "Field 1" "Text" "TGDTJ requires a more recent version of the Java Runtime Environment than the one found on your computer.\nThe installation of JRE ${JRE_VERSION} will start."<br>!insertmacro MUI_HEADER_TEXT "$(TEXT_JRE_TITLE)" "$(TEXT_JRE_SUBTITLE)"<br>!insertmacro MUI_INSTALLOPTIONS_DISPLAY_RETURN "jre.ini"<br>Goto DownloadJRE<br><br>NoFound:<br>!insertmacro MUI_INSTALLOPTIONS_WRITE "jre.ini" "Field 1" "Text" "No Java Runtime Environment could be found on your computer.\n The installation of JRE v${JRE_VERSION} will start."<br>!insertmacro MUI_HEADER_TEXT "$(TEXT_JRE_TITLE)" "$(TEXT_JRE_SUBTITLE)"<br>!insertmacro MUI_INSTALLOPTIONS_DISPLAY "jre.ini"<br>Goto DownloadJRE<br><br>DownloadJRE:<br>StrCpy ${DOWNLOAD_JRE_FLAG} "Download"<br>Return<br><br>NoDownloadJRE:<br>Pop ${TEMP2}<br>StrCpy ${DOWNLOAD_JRE_FLAG} "NoDownload"<br>!insertmacro MUI_INSTALLOPTIONS_WRITE "jre.ini" "UserDefinedSection" "JREPath" ${TEMP2}<br>Return<br><br>ExitInstall:<br>Quit<br><br>FunctionEnd<br><br><br>Mainly under NoDownloadJRE: ...not sure though, because it is correctly going thru the DetectJRE call..</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JediKnight2</span><br><span class="post-time small text-muted">19th December 2006 20:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">OK...I think I am making SOME headway...If I set the NoDownloadJRE: to mimick the NoFound or FoundOld it works, so that means that the CORRECT answer is given to the install that the install doesn't need a JRE install..problem is in the NoDownloadJRE: part which is<br><br>NoDownloadJRE:<br>Pop ${TEMP}<br>StrCpy ${DOWNLOAD_JRE_FLAG} "NoDownload"<br>!insertmacro MUI_INSTALLOPTIONS_WRITE "jre.ini" "UserDefinedSection" "JREPath" ${TEMP2}<br>Return<br><br>I need it to say something like, JRE Is installed click next to continue program install instead of going to the JRE install...</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>