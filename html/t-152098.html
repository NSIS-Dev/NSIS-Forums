<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="InstallDirRegKey and ReadRegStr ?"><title>InstallDirRegKey and ReadRegStr ? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">InstallDirRegKey and ReadRegStr ?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=152098">InstallDirRegKey and ReadRegStr ?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">MrRadicalEd</span><br><span class="post-time small text-muted">9th October 2003 19:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>InstallDirRegKey and ReadRegStr ?</strong><br>Im using the basic script example in the MUI folder, and I tried using the InstallDirRegKey so the installer will use that location for the installation, but it still keeps the file.exe<br><br>This is what it looks like:<br><font size="1"><br>;Folder selection page<br>InstallDir $INSTDIR<br><br>;Remember install folder<br>InstallDirRegKey HKCU Software\Valve\Steam SteamExe<br></font><br>After being compiled I test the installation and it spits out location/file.exe read from the registry key. I know I read in the manual that using InstallDirRegKey strips quotes, and the file.exe from the path.<br><br>Also I'm not sure if I quite understand how this works, but I'm trying to get individual files installed by different detected registry keys. I know it has something to do with ReadRegStr, but I haven't got the installer to do what I want it to do.<br><br>The installer would have separate sections, and each section would be installed to a specific path that was read from a registry key<br><font size="1"><br>Components:<br>[]Core<br>[]Developer<br>[]Extra<br>[]Extra2<br></font><br>Im thinking as a simple beginner and saying that maybe I can do something like this?<br><font size="1"><br>Function .onInit<br>ReadRegStr $1 HKCU "Software\Valve\Steam" SteamExe<br>ReadRegStr $2 HKCU "Software\Valve\Steam" ModInstallPath<br>FunctionEnd<br></font><br>Except when you get the path for \HKCU\Software\valve\steam SteamExe, it returns a steam.exe at the end. I only need the path itself.<br><br>For every file to install it would look like this:<br><font size="1"><br>SetOutPath "$1"<br>File "${NSISDIR}\Contrib\UIs\modern.exe"<br></font><br><br>and then all I need the installer to do is make sure the user show that they have an installed component inside say /STEAM, and that the installer would proceed if steam.exe was found.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">9th October 2003 21:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can use the GetParent function from the documentation.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MrRadicalEd</span><br><span class="post-time small text-muted">9th October 2003 21:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><font size="1"><br>$1 produces something like "c:\program files\steam\steam.exe"<br>$2 produces something like "c:\program files\steam\steamapps\user@user\half-life"<br></font><br><br>So from what I understand.. it would something like this?<br><br><font size="1"><br>Function .onInit<br>ReadRegStr $1 HKCU "Software\Valve\Steam" SteamExe<br>ReadRegStr $2 HKCU "Software\Valve\Steam" ModInstallPath<br>FunctionEnd<br><br>Function GetParent<br>Exch $R0 ; old $R0 is on top of stack<br>Push $R1<br>Push $R2<br>StrCpy $R1 -1<br>loop:<br>StrCpy $R2 $R0 1 $R1<br>StrCmp $R2 "" exit<br>StrCmp $R2 "\" exit<br>IntOp $R1 $R1 - 1<br>Goto loop<br>exit:<br>StrCpy $R0 $R0 $R1<br>Pop $R2<br>Pop $R1<br>Exch $R0 ; put $R0 on top of stack, restore $R0 to original value<br>FunctionEnd<br><br>Section ""<br>Push "$1"<br>Call GetParent<br>Pop $R0<br>SectionEnd<br></font><br>and to use the new path for a file installation I would use $R0 insteald of $1?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">deguix</span><br><span class="post-time small text-muted">9th October 2003 22:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Depend on you. Can push or pop any variable.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MrRadicalEd</span><br><span class="post-time small text-muted">9th October 2003 22:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I only got that out of the manual, and didn't understand much of it :/</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">9th October 2003 23:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">InstallDirRegKey should strip the EXE part (unless it's a real directory path) and does in my tests. What's the exact string in that registry value you're passing on to InstallDirRegKey?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MrRadicalEd</span><br><span class="post-time small text-muted">9th October 2003 23:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">c:/program files/steam/steam.exe</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">9th October 2003 23:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">No wonder then... That's an invalid path. It uses forward slashes instead of backslashes. If you want to use it, you'd have to process it yourself, replacing every slash with a backward slash to avoid problems and trimming the last part on your own. If you don't want to write something of your own, you can use some of the Archive functions, some of them will surely help.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MrRadicalEd</span><br><span class="post-time small text-muted">9th October 2003 23:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Alright.. thanks for the info. This installer is going to simplify a rather tricky install of some files for a game, and luckily there is a different registry key that is valid using back slashes..<br><br>unfortunately its path is longer than I desire. I found the GetParent documentation in the manual, but I see that you have to define the function before you use it, and I don't completely understand the use of Pop, Push, Exch, and so on</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">9th October 2003 23:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This Archive page should explain it:<br><a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=216" target="_blank">http://nsis.sourceforge.net/archive/...php?pageid=216</a></p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>