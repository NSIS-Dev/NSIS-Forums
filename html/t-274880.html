<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="ANT_HOME Problem"><title>ANT_HOME Problem - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">ANT_HOME Problem</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=274880">ANT_HOME Problem</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">madams</span><br><span class="post-time small text-muted">24th July 2007 16:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>ANT_HOME Problem</strong><br>Hi,<br><br>I have yet another problem with my installer (posted in a thread right below this): Even though I set the ANT_HOME variable at the beginning of my main section, the installer claims ANT_HOME is invalid when I try to execute an ANT command toward the end of my main section. Here is my code snippet:<br><br>SetOutPath $INSTDIR<br>SetOverwrite on<br>File /r caTissueCore1.2\*<br>WriteRegStr HKLM "${REGKEY}\Components" Main 1<br><br>${if} $antHomeDir == ''<br>!insertmacro ZIPDLL_EXTRACT "$EXEDIR\apache-ant-1.6.0-bin.zip" "C:\" "&lt;ALL&gt;"<br>Strcpy $antHomeDir "C:\apache-ant-1.6.0"<br>${endif}<br>${if} $jboss.home.dir == ''<br>!insertmacro ZIPDLL_EXTRACT "$EXEDIR\jboss-4.0.0.zip" "C:\" "&lt;ALL&gt;"<br>Strcpy $jboss.home.dir "C:\JBoss-4.0.0"<br>${endif}<br>Push $antHomeDir\bin<br>Call AddToPath<br><br>Push JBOSS_HOME<br>Push $jboss.home.dir<br>Call WriteEnvStr<br><br>Push ANT_HOME<br>Push $antHomeDir<br>Call WriteEnvStr<br><br>call editCaTissueInstall.Properties<br>call editSqlConfigFiles<br>call editTextFilesAndLogo<br><br>StrCpy $mySQLEXE "$mySQLEXEbin\mysql.exe"<br>detailPrint "cmd /C $mySQLEXE -uroot -popen123 &lt; $databaseConfigFile"<br><br>nsExec::ExecToLog 'cmd /C IF 1==1 "$mySQLEXE" -uroot -p$databaseLoginPass &lt; $databaseConfigFile'<br>nsExec::ExecToLog 'cmd /C cd $INSTDIR'<br>nsExec::ExecToLog 'cmd /C $antHomeDir\bin\ant -f deploy.xml deploy_all_with_config'<br><br>Any help would be greatly appreciated.<br><br>Thanks!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">24th July 2007 17:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You mean it is saying that the ANT_HOME environment variable does not exist?<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">madams</span><br><span class="post-time small text-muted">24th July 2007 19:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The exact error I am getting is: "ANT_HOME is set incorrectly or Ant could not be located. Please set ANT_HOME."<br><br>I know that the ANT_HOME variable is getting set correctly, becuase I have checked it in System &gt; Advanced &gt; Environmental Variables as soon as the installer finishes. Also, if I try running the installer again after the first run fails, it works perfectly. Could it be that I have to restart the computer for the changed environmental variable settings to take effect?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">24th July 2007 20:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Setting the environment variables only works for new processes started from explorer. To set it to new processed started from your process, you need to manually update the environment variables of your process.<br><br>Use:<br><br><a href="http://nsis.sourceforge.net/Setting_Environment_Variables_to_Active_Installer_Process" target="_blank">http://nsis.sourceforge.net/Setting_...taller_Process</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">madams</span><br><span class="post-time small text-muted">24th July 2007 20:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok, I edited my main section with the code in the link you provided, but I am still getting the invalid ANT_HOME error. Here's the edited code:<br><br></p><blockquote>Section -Main SEC0000<br>SetOutPath $INSTDIR<br>SetOverwrite on<br>File /r caTissueCore1.2\*<br>WriteRegStr HKLM "${REGKEY}\Components" Main 1<br><br>${if} $antHomeDir == ''<br>!insertmacro ZIPDLL_EXTRACT "$EXEDIR\apache-ant-1.6.0-bin.zip" "C:\" "&lt;ALL&gt;"<br>Strcpy $antHomeDir "C:\apache-ant-1.6.0"<br>${endif}<br>${if} $jboss.home.dir == ''<br>!insertmacro ZIPDLL_EXTRACT "$EXEDIR\jboss-4.0.0.zip" "C:\" "&lt;ALL&gt;"<br>Strcpy $jboss.home.dir "C:\JBoss-4.0.0"<br>${endif}<br>Push $antHomeDir\bin<br>Call AddToPath<br><br>ReadEnvStr $R0 "PATH"<br>StrCpy $R0 "$R0;$antHomeDir\bin"<br>System::Call 'Kernel32::SetEnvironmentVariableA(t, t) i("PATH", R0).r2'<br><br>Push JBOSS_HOME<br>Push $jboss.home.dir<br>Call WriteEnvStr<br><br>Push ANT_HOME<br>Push $antHomeDir<br>Call WriteEnvStr<br><br>ReadEnvStr $R0 "ANT_HOME"<br>StrCpy $R0 "$antHomeDir\bin"<br>System::Call 'Kernel32::SetEnvironmentVariableA(t, t) i("PATH", R0).r2'<br><br>call editCaTissueInstall.Properties<br>call editSqlConfigFiles<br>call editTextFilesAndLogo<br><br>StrCpy $mySQLEXE "$mySQLEXEbin\mysql.exe"<br>detailPrint "cmd /C $mySQLEXE -uroot -popen123 &lt; $databaseConfigFile"<br><br>nsExec::ExecToLog 'cmd /C IF 1==1 "$mySQLEXE" -uroot -p$databaseLoginPass &lt; $databaseConfigFile'<br>nsExec::ExecToLog 'cmd /C cd $INSTDIR'<br>nsExec::ExecToLog 'cmd /C $antHomeDir\bin\ant -f deploy.xml deploy_all_with_config'<br>SectionEnd</blockquote>Am I doing anything wrong?</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">madams</span><br><span class="post-time small text-muted">24th July 2007 20:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Nevermind, I made a stupid syntax error in the code above and everything works perfectly now. Thanks for all your help!</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>