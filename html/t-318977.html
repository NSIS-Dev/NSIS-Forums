<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="KillProc plug-in is not working in x64 bit machines" />

  <title>KillProc plug-in is not working in x64 bit machines - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">KillProc plug-in is not working in x64 bit machines</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=318977">KillProc plug-in is not working in x64 bit machines</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dhiraj3301</span><br />
      <span class="post-time small text-muted">6th May 2010 11:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>KillProc plug-in is not working in x64 bit machines</strong><br />
      KillProc plug-in is not working in x64 bit machines<br />
      <br />
      I have written following code:<br />
      <br />
      StrCpy $0 "Draw.exe"<br />
      KillProc::FindProcesses<br />
      ${If} $0 &gt; 0<br />
      StrCpy $0 "Draw.exe"<br />
      KillProc::KillProcesses<br />
      ${Endif}<br />
      <br />
      this code is working fine on 32 bit machine,<br />
      anyone can please suggest what to do for for killing process in x64 bit machine.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">6th May 2010 13:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Is the process a 32-bit process or a 64-bit one? What is $1 set to after calling KillProcesses?<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dhiraj3301</span><br />
      <span class="post-time small text-muted">6th May 2010 14:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">it is 64 bit process<br />
      <br />
      process name is same but it is not able to find that process using<br />
      KillProc::FindProcesses</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">6th May 2010 16:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What is the value of $1 after the KillProcesses call?<br />
      Does the plug-in kill 32-bit processes OK?<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dhiraj3301</span><br />
      <span class="post-time small text-muted">7th May 2010 04:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">the value of $1 after the KillProcesses call is 0<br />
      this plug in kill 32-bit machines processes sucessfully.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">7th May 2010 09:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This is a problem with the EnumProcessModules API and 32-bit processes. It cannot enumerate modules of a 64-bit process when the caller is a 32-bit process, therefore it fails to find your process name. If you must kill your application (i.e. you cannot safely close it with WM_CLOSE for example) then you will need to write a 64-bit executable to do it that you execute with NSIS. Don't bother trying any other plug-ins either because the EnumProcessModules limitation is not plug-in specific.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Javarome</span><br />
      <span class="post-time small text-muted">2nd November 2010 14:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I confirm the need for a 64 bit process killing ability. Anything planned about that?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">2nd November 2010 19:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Have you tried to use WMI? You should be able to query the processes (by name) and when you have the one you want to kill, call the Terminate method on the WMI process object.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Javarome</span><br />
      <span class="post-time small text-muted">11th February 2011 11:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes WMI seems to be the recommended approach to implement it, but I was more expecting a support from NSIS (or a NSIS plugin).<br />
      <br />
      That said, I also found the EnumProcessModulesEx is your friend for listing both 32 and 64 bits processes, but with static linking issues however (not located in the same library since Win7).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">11th February 2011 15:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">As I've already said, EnumProcessModulesEx is no good when the calling process is 32-bit. It will return the same results as EnumProcessModules (MSDN states this too). The only way is to use WMI (or write a 64-bit app to do it).<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">chironex</span><br />
      <span class="post-time small text-muted">21st July 2011 20:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I had the same problem and updated the code to use WMI as was suggested.<br />
      <br />
      <a href="http://chironexsoftware.com/blog/?p=34" target="_blank">http://chironexsoftware.com/blog/?p=34</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br />
      <span class="post-time small text-muted">8th January 2012 23:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">the documentation of this plugin is really poor<br /></p>

      <blockquote>
        KillProcWMI , is an NSIS plugin based on the original KillProc plugin. KillProcWMI uses WMI to acheive the same results, which avoids problems with 32bit processes not being able to kill 64 bit processes.<br />
        <br />
        All Code is freely provided, no guarantees or warranties about its quality, use at your own risk.<br />
        <br />
        Jared Allen.<br />
        ChironexSoftware.com
      </blockquote>i have tried all options to get it working - failed<br />
      <br />
      tried it with "killproc", "killprocwmi" with same filename...<br />
      <a href="http://nsis.sourceforge.net/KillProc_plug-in" target="_blank">http://nsis.sourceforge.net/KillProc_plug-in</a><br />
      <br />
      anyone with a working example? (and file places to put in except \plugins)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">9th January 2012 00:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Did you use the DLL he provided? <a href="http://www.chironexsoftware.com/downloads/KillProcWMI.zip" target="_blank">http://www.chironexsoftware.com/down...illProcWMI.zip</a><br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br />
      <span class="post-time small text-muted">9th January 2012 16:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ofc - thats why i wonder it does not work.<br />
      the major problem is that i can not compile the file!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">9th January 2012 18:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What do you mean it does not work? What do you mean you cannot compile the file? Please elaborate.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br />
      <span class="post-time small text-muted">9th January 2012 21:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">compiling<br />
      KillProc::FindProcesses<br />
      <br />
      not compiling<br />
      KillProcWMI::FindProcesses<br />
      <br />
      &gt; Invalid command: KillProcWMI::FindProcesses<br />
      <br />
      if i rename KillProcWMI.dll to KillProc.dll<br />
      and use the regular Killproc syntax<br />
      <br />
      &gt; Invalid command: KillProc::FindProcesses<br />
      <br />
      bleh<br />
      <br />
      so what is the correct syntax?<br />
      <br />
      both dll are in \plugins</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">9th January 2012 21:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There is only one function KillProcWMI::KillProc (if in doubt look at the source code, or look at the output from makensis which lists all plug-in functions).<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br />
      <span class="post-time small text-muted">9th January 2012 21:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">omg how stupid ist that?<br />
      ofc i can force terminating a thread but more polite is the option for user to end it manually<br />
      so i try to find the process at first but there is no plugin for x64 which can do that.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br />
      <span class="post-time small text-muted">14th January 2012 16:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">sorry, wont work here<br />
      <br />
      StrCpy $0 "filename.exe"<br />
      KillProcWMI::KillProc<br />
      <br />
      any new hints for 64bit?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Rapport12</span><br />
      <span class="post-time small text-muted">16th February 2012 04:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I was successful using:<br />
      <br />
      KillProcWMI::KillProc "ProcessName.exe"<br />
      <br />
      In that way I guess it works more like the older KillProc Plug-in rather than the new one. However, I was able to terminate a 64-bit process on Windows Server 2008 R2 using it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br />
      <span class="post-time small text-muted">16th February 2012 21:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">i will try next days, actually i still need WMIC to determine task and to kill it.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
