<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Need to store text files in AppData folder"><title>Need to store text files in AppData folder - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Need to store text files in AppData folder</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=334355">Need to store text files in AppData folder</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">SteveRussell</span><br><span class="post-time small text-muted">3rd September 2011 23:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Need to store text files in AppData folder</strong><br>Now that I am in Windows 7, I suddenly find that simple text files that my app updates per user are denied access. Until now, I have kept these profiles in a subfolder of my install directory.<br><br>I am wondering if I could get a bit of direction on how to use NSIS to find the right appdata folder and place some files in that location during installation. Of course, the folder name varies, such as 'Application Data' in XP and 'AppData' in Windows 7. I am thinking and hoping that this move will eliminate access problems.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">msroboto</span><br><span class="post-time small text-muted">4th September 2011 05:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Look up $APPDATA in the wiki.<br>I think that's what you want. There is a warning about how the SetShellVarContext is set.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">4th September 2011 06:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It's all in the manual.<br><br><a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.2.3" target="_blank">http://nsis.sourceforge.net/Docs/Chapter4.html#4.2.3</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">SteveRussell</span><br><span class="post-time small text-muted">4th September 2011 08:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thank you, gentlemen. I did discover $APPDATA after posting, but this is a new concept for me.<br><br>I am wondering: When might "All Users" be chosen over "Current user"?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">4th September 2011 17:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If you enforce admin access for your installer (for example because you need to write to a protected directory such as $SYSTEM or $PROGRAMFILES), you must install for all users. In this case, you must use the HKLM registry hive for all registry stuff.<br><br>If you do not do anything that requires admin access, you can do one of two things:<br>1) Force admin-only installation anyway. This means installing for all users and using HKLM (see above).<br>2) Allow user-level installation. This means NOT asking for admin access, NOT writing to any protected folders, only installing for the current user, and using the HKCU registry hive instead of HKLM.<br><br>This is how windows is designed to operate, so this is how you're supposed to do it.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">5th September 2011 10:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by SteveRussell</small><br>I am wondering: When might "All Users" be chosen over "Current user"?</blockquote>I you have things that are shared with all users of your program</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">SteveRussell</span><br><span class="post-time small text-muted">5th September 2011 14:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by MSG</small><br>If you enforce admin access for your installer (for example because you need to write to a protected directory such as $SYSTEM or $PROGRAMFILES), you must install for all users.</blockquote>I definitely do write to program files. But I thought that it was no longer possible to enforce admin access with RequestExecutionLevel.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">5th September 2011 15:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You need RequestExecutionLevel admin but you still need to check the user is an administrator in .onInit and abort if they are not.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">SteveRussell</span><br><span class="post-time small text-muted">5th September 2011 16:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by Afrow UK</small><br>You need RequestExecutionLevel admin but you still need to check the user is an administrator in .onInit and abort if they are not.<br><br>Stu</blockquote>I would love to see an example of checking the user. Haven't found one yet.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">5th September 2011 16:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">requestexecutionlevel doesn't do anything in WinXP, or in Win7 if UAC is turned off. So use both:<br><br>requestexecutionlevel admin<br><br>function .onInit<br>userInfo::getAccountType<br>pop $0<br>${If} $0 != "Admin"<br>messageBox MB_OK "Requires admin"<br>quit<br>${EndIf}<br>functionend<br><br>(and same for un.onInit!)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">SteveRussell</span><br><span class="post-time small text-muted">5th September 2011 16:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">(Ignore this post. I had inserted code before includes.):<br><br>Thank you. I'm getting an error:<br><br>Function: ".onInit"<br>File: "UserInfo.dll"-&gt;"$PLUGINSDIR\UserInfo.dll" [compress] 1336/4096 bytes<br>Plugin Command: GetAccountType<br>Pop: $0<br>Invalid command: ${If}<br><br>------<br><br>Function .onInit<br>UserInfo::GetAccountType<br>Pop $0<br>${If} $0 != "Admin"<br>MessageBox MB_OK "Your system requires administrative permissions in order to install this software."<br>Quit<br>${EndIf}<br>FunctionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">5th September 2011 19:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">!include LogicLib.nsh</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">SteveRussell</span><br><span class="post-time small text-muted">7th September 2011 10:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Should I remove related folders and data files from the appdata folder when uninstalling?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">msroboto</span><br><span class="post-time small text-muted">7th September 2011 14:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Depends what it is. If you uninstall word do you expect the .doc files to be deleted.<br>I don't know if that analogy works in your case.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">7th September 2011 16:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You should delete everything you don't want to keep. As simple as that.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">SteveRussell</span><br><span class="post-time small text-muted">8th September 2011 23:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I kind of like the doc comparison. My tiny data files are profiles that record user progress, otherwise meaningless when the application is uninstalled. But they could remain for re-installation.<br><br>I have never before dealt programmatically with the appdata file structure, so never had to think about some of these ramifications. I treat the register very carefully, leaving it clean at uninstall. Now I am wondering about the neighborhood rules - Is it considered sloppy to allow some files to remain in appdata when the program is removed?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">12th September 2011 12:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by SteveRussell</small><br>Is it considered sloppy to allow some files to remain in appdata when the program is removed?</blockquote>That entirely depends on your definition. "Uninstallation" implies you undo the installation, but you can define "installation" as that which the installer created (so, only the original application), or you can define it as everything that comprises and belongs to the installed application (so, both the app and its settings etc).<br><br>Note that it may also depend on the size and number of files you're leaving behind. What most uninstallers do is add a checkbox or messagebox option to delete saves/settings along with the application.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">12th September 2011 13:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You should ask the user if they wish the files to be deleted. You can either use a simple MessageBox, and an uninstall component (i.e. another un. Section) or add a custom page with a check-box on it.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">SteveRussell</span><br><span class="post-time small text-muted">13th September 2011 01:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes, I need to give the user the choice to delete or keep the associated files. Thank you all again for your thoughts, which have clarified mine. I greatly appreciate your advice and direction.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">SteveRussell</span><br><span class="post-time small text-muted">13th September 2011 23:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by Afrow UK</small><br>You can either use a simple MessageBox, and an uninstall component (i.e. another un. Section)....<br><br>Stu</blockquote>Section, or Function?</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">14th September 2011 11:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can have multiple uninstall sections along with an uninstall components page (read the docs).<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">SteveRussell</span><br><span class="post-time small text-muted">18th September 2011 11:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">OK, I have created un.CleanUp_Profiles as an additional Section.<br><br>Section un.CleanUp_Profiles<br>MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 "Do you want to delete all Sign In id's associated with $(^Name)?" IDYES true IDNO false<br>true:<br>Delete "$APPDATA\${PRODUCT_FAMILY}\pf\*_scii.txtt"<br>Goto next<br>false:<br>Goto next<br>next:<br>SectionEnd<br><br>I was already conditionally deleting other files and folders in Section Uninstall, depending on whether or not other similar products have been installed in the same directory.<br><br>I don't see the docs telling me what should go inside the main section and what should not.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">19th September 2011 05:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">For NSIS it doesn't matter in which section you put it. That's entirely up to you. If you want to make it an optional section, obviously all the optional files should be deleted in that section, not in another.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>