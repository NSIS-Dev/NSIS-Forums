<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Problems with /COMPONENTSONLYONCUSTOM" />

  <title>Problems with /COMPONENTSONLYONCUSTOM - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Problems with /COMPONENTSONLYONCUSTOM</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=185988">Problems with /COMPONENTSONLYONCUSTOM</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">flyakite</span><br />
      <span class="post-time small text-muted">9th July 2004 09:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Problems with /COMPONENTSONLYONCUSTOM</strong><br />
      Alright I have searched and expirimented for the last 4 hours trying to get this to work right and I can't find a way. I can get it to work 50% right but that's about it.<br />
      <br />
      <br />
      I am creating an installer to install modified system files. Originally I had 3 install types. One install type installed all the common system files. Another install type would just install shell32, and the 3rd would bring up a custom page allowing the user to just extract the files from the installer to a directory of their choice so they could modify them on their own. It was all working using this method but the user could still choose components using the 3rd install type.<br />
      <br />
      Now, however, I've decided to just use the 3rd install type and the custom install type using /COMPONENTSONLYONCUSTOM so that the user can't choose components when using the extraction install type.<br />
      <br />
      <br />
      Here's a condensed version of my code. The goal is that when the "Extract Files Only" install type is chosen the components page disappears, then you hit next and you're given a page to choose the directory to extract the files to (THAT part works). But, then I want it that when you pull the menu down and choose the Custom install type, it turns of the "Extract" section (I want to keep that section hidden) and won't show the custom page. Whenever I choose the custom install type the extract section is still turned on and when I hit next it brings up the custom page dialog.<br />
      <br />
      Any help would be appreciated.<br />
      <br /></p>
      <pre>
<span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_PAGE_COMPONENTS
<br />PagedirectoryExtractDir</span><span style="color: #DD0000">""""
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_PAGE_INSTFILES
<br /><br /></span><span style="color: #007700">;------------------------------------------
<br />;</span><span style="color: #0000BB">InstallTypes
<br /></span><span style="color: #007700">;------------------------------------------
<br /></span><span style="color: #0000BB">InstType</span><span style="color: #DD0000">"ExtractFilesOnly"
<br /></span><span style="color: #0000BB">InstType</span><span style="color: #007700">/</span><span style="color: #0000BB">COMPONENTSONLYONCUSTOM
<br /><br /><br /></span><span style="color: #007700">;------------------------------------------
<br />;</span><span style="color: #0000BB">SectionExtractFiles
<br /></span><span style="color: #007700">;------------------------------------------
<br /></span><span style="color: #0000BB">Section</span><span style="color: #DD0000">"-EXTRACT"</span><span style="color: #0000BB">Extract
<br />SectionIn1
<br />SetOverwriteon
<br />SetOutPath</span><span style="color: #DD0000">"$INSTDIR"
<br /></span><span style="color: #0000BB">File</span><span style="color: #007700">/</span><span style="color: #0000BB">r</span><span style="color: #DD0000">"*.*"
<br /></span><span style="color: #0000BB">Delete</span><span style="color: #DD0000">"$OUTDIR\*.nsi"
<br /></span><span style="color: #0000BB">RMDir</span><span style="color: #DD0000">"$OUTDIR\misc"
<br /></span><span style="color: #0000BB">SectionEnd
<br /><br /></span><span style="color: #007700">Function</span><span style="color: #0000BB">ExtractDir
<br />ClearErrors
<br />SectionGetFlags</span><span style="color: #007700">${</span><span style="color: #0000BB">Extract</span><span style="color: #007700">}</span><span style="color: #0000BB">$R7
<br />IntOp$R7$R7</span><span style="color: #007700">&amp;${</span><span style="color: #0000BB">SF_SELECTED</span><span style="color: #007700">}
<br /></span><span style="color: #0000BB">IntCmp$R7</span><span style="color: #007700">${</span><span style="color: #0000BB">SF_SELECTED</span><span style="color: #007700">}+</span><span style="color: #0000BB">2
<br />Abort
<br />FunctionEnd
<br /><br /></span><span style="color: #007700">;------------------------------------------
<br />;</span><span style="color: #0000BB">SectionCreateRestorePoint
<br /></span><span style="color: #007700">;------------------------------------------
<br /></span><span style="color: #0000BB">Section</span><span style="color: #DD0000">"CreateRestorePoint"</span><span style="color: #0000BB">restorepoint
<br />SetOutPath</span><span style="color: #DD0000">"$TEMP"
<br /></span><span style="color: #0000BB">File</span><span style="color: #DD0000">"misc\utilities\restorepoint.vbs"
<br /></span><span style="color: #0000BB">ExecShellopen</span><span style="color: #DD0000">"$TEMP\restorepoint.vbs"
<br /></span><span style="color: #0000BB">Sleep3000
<br />SectionEnd
<br /><br /><br /><br /></span><span style="color: #007700">;------------------------------------------
<br />;</span><span style="color: #0000BB">SectionInstallshell32</span><span style="color: #007700">.</span><span style="color: #0000BB">dll
<br /></span><span style="color: #007700">;------------------------------------------
<br /></span><span style="color: #0000BB">Section</span><span style="color: #DD0000">"Shell32"</span><span style="color: #0000BB">SHELL32
<br />SetRebootFlagtrue
<br />SetOutPath</span><span style="color: #DD0000">"$SYSDIR"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">insertmacroInstallFile</span><span style="color: #DD0000">"shell32.dll""$SYSDIR"
<br /></span><span style="color: #0000BB">SectionEnd
<br /></span><span style="color: #007700">.
<br />.
<br />.
<br /></span><span style="color: #0000BB">etc</span><span style="color: #007700">....
</span>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">9th July 2004 09:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The custom installation type is not a type you can use with SectionIn. It is a type which allows the user to select whatever sections he or she wants. Therefore, the hidden "-Extract" section is not unselected when the user chooses the custom type.<br />
      <br />
      To avoid this, you can use <a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.13.10" target="_blank">GetCurInstType</a> to check the selected installation type and unselect the first section or just add this condition to the ExtractDir function.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
