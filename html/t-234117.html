<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Problem with a long string" />

  <title>Problem with a long string - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Problem with a long string</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=234117">Problem with a long string</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jnuw</span><br />
      <span class="post-time small text-muted">27th December 2005 17:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Problem with a long string</strong><br />
      Hello all.<br />
      <br />
      I have a strange problem. A co-worker asked me if I could make an exe that would simply copy the first line of a current text file into a new text file. I said, no problem, and quickly put together an nsi file using Instructor's LineRead function. (I also tried Afrow's Read from text file line number function too, and got the same problem). My problem is this, this text file i'm reading from has very long lines, over 3400 characters. I am using the long string build of NSIS 2.10, but am getting truncated output for both line read functions after character 1023.<br />
      <br />
      I can however just StrCpy my variable with a string (same string that's in Doc1.txt) that is over 3400 characters (see below), and that works just fine. So I know my Long String build is working, but it seems that both line read functions I have tried still have the 1024 character limitation.<br />
      <br />
      Any thoughts would be appreciated. I have attached the "Doc1.txt" file, so you can compile the below code and recreate the problem. Thanks all.<br />
      <br /></p>
      <pre>
<code><br />Name LineMove<br />OutFile LineMove.exe<br />AutoCloseWindow True<br />SilentInstall Silent<br /><br />Var Source<br />Var String<br /><br />Section ""<br /><br />  StrCpy $Source Doc1.txt<br />  <br />  Push $Source<br />  Push "1"<br />  Call LineRead<br />  Pop $String<br />  MessageBox MB_OK "$String"<br />  <br />StrCpy $String "abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefg\<br />hijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcd\<br />efghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyza\<br />bcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwx\<br />yzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstu\<br />vwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqr\<br />stuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmno\<br />pqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijkl\<br />mnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghi\<br />jklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdef\<br />ghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabc\<br />defghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\<br />abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvw\<br />xyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrst\<br />uvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopq\<br />rstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmn\<br />opqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijk\<br />lmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefgh\<br />ijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcde\<br />fghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzab\<br />cdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxy\<br />zabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuv\<br />wxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrs\<br />tuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnop\<br />qrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklm\<br />nopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghij\<br />klmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefg\<br />hijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcd\<br />efghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyza\<br />bcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwx\<br />yzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstu\<br />vwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqr\<br />stuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmno\<br />pqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijkl\<br />mnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghi\<br />jklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdef\<br />ghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabc\<br />defghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\<br />abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvw\<br />xyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrst\<br />uvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopq\<br />rstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmn\<br />opqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijk\<br />lmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefgh\<br />ijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcde\<br />fghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz"<br />  <br />  MessageBox MB_OK "$String"<br /><br />SectionEnd<br /><br /><br />Function LineRead<br />        Exch $1<br />        Exch<br />        Exch $0<br />        Exch<br />        Push $2<br />        Push $3<br />        Push $4<br />        ClearErrors<br /><br />        IfFileExists $0 0 error<br />        IntOp $1 $1 + 0<br />        IntCmp $1 0 error 0 plus<br />        StrCpy $4 0<br />        FileOpen $2 $0 r<br />        IfErrors error<br />        FileRead $2 $3<br />        IfErrors +3<br />        IntOp $4 $4 + 1<br />        Goto -3<br />        FileClose $2<br />        IntOp $1 $4 + $1<br />        IntOp $1 $1 + 1<br />        IntCmp $1 0 error error<br /><br />        plus:<br />        FileOpen $2 $0 r<br />        IfErrors error<br />        StrCpy $3 0<br />        IntOp $3 $3 + 1<br />        FileRead $2 $0<br />        IfErrors +4<br />        StrCmp $3 $1 0 -3<br />        FileClose $2<br />        goto end<br />        FileClose $2<br /><br />        error:<br />        SetErrors<br />        StrCpy $0 ''<br /><br />        end:<br />        Pop $4<br />        Pop $3<br />        Pop $2<br />        Pop $1<br />        Exch $0<br />FunctionEnd<br /></code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">27th December 2005 19:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">NSIS docs states that "strings are limited to 1024 characters" and thus this doesn't depend on the special build string limitation. This could be a feature request though.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">27th December 2005 19:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">1023 was actually hard-coded in the source code. I've fixed it and attached a patch. Version 2.13 will contain this fix, as well as the next <a href="http://nsis.sourceforge.net/nightly/nsis.zip" target="_blank">nightly build</a>. Thanks.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">27th December 2005 19:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">And updated the documentation. Thanks deguix.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jnuw</span><br />
      <span class="post-time small text-muted">27th December 2005 19:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you so much for your help kichik. I'm a little unsure how to implement this patch though, I'm guessing I would need to use it to re-compile the makensis.exe file correct? I have not done that before, do you know when 2.13 will be released? Sorry for the bother, thanks again for your help.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">27th December 2005 19:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, you'd have to recompile. 2.13 will be released in about a month. The next nightly build will be built, well, this night. You can also write your own function to keep reading until it reaches a new line marker, the maximum string length or the end of the file.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jnuw</span><br />
      <span class="post-time small text-muted">27th December 2005 19:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Good to know, thanks again for your help kichik.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
