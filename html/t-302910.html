<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Custom page failed on IIS 5.0"><title>Custom page failed on IIS 5.0 - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Custom page failed on IIS 5.0</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=302910">Custom page failed on IIS 5.0</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">domisse</span><br><span class="post-time small text-muted">8th February 2009 17:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Custom page failed on IIS 5.0</strong><br>Hello,<br><br>I'm writing an installer for my package and I have a problem<br>with IIS 5.0 (win2000).<br>I want to show the list of available server running on IIS in a custom page.<br>I use the latest NSIS 2.43 and the same script on a Win2000 (IIS 5.0), XP (IIS 5.1) and Server 2003 (IIS 6.0)<br>It works fine on XP and 2003 but not on 2000, I really don't understand why.<br>Is there something specific to IIS 5.0 ???<br><br><br>I have a custom page<br>Page custom PickWebsite ValidateCustom<br>to choose between IIS server available.<br><br>To get this list, I use a vbs script :<br>Function GetWebsites<br>; Output the VBScript<br>FileOpen $4 "$PLUGINSDIR\GetWebsites.vbs" w<br>FileWrite $4 'Set IISOBJ = getObject("IIS://localhost/" &amp; "w3svc")$\n'<br>FileWrite $4 'Set objFSO = CreateObject("Scripting.FileSystemObject")$\n'<br>FileWrite $4 'Set objTextFile = objFSO.OpenTextFile("$PLUGINSDIR\websites.ini", 8, True)$\n'<br>FileWrite $4 'AllSites = ""$\n'<br>FileWrite $4 'for each Web in IISOBJ$\n'<br>FileWrite $4 'if (Web.Class = "IIsWebServer") then$\n'<br>FileWrite $4 'Set IISWebSite = getObject("IIS://localhost/" &amp; "w3svc" &amp; "/" &amp; Web.Name)$\n'<br>FileWrite $4 'Set IISWebSiteRoot = getObject("IIS://localhost/" &amp; "w3svc" &amp; "/" &amp; Web.Name &amp; "/root")$\n'<br>FileWrite $4 'AllSites = AllSites &amp; "|" &amp; IISWebSite.ServerComment$\n'<br>FileWrite $4 'objTextFile.WriteLine("[" &amp; IISWebSite.ServerComment &amp; "]")$\n'<br>FileWrite $4 'objTextFile.WriteLine("Path=" &amp; IISWebSiteRoot.Path)$\n'<br>FileWrite $4 'objTextFile.WriteLine("Name=" &amp; Web.Name)$\n'<br>FileWrite $4 'objTextFile.WriteLine("LogDir=" &amp; IISWebSite.LogFileDirectory &amp; "/w3svc/" &amp; Web.Name &amp; "/")$\n'<br>FileWrite $4 'objTextFile.WriteLine("")$\n'<br>FileWrite $4 'Set IISWebSiteRoot = nothing$\n'<br>FileWrite $4 'Set IISWebSiteLogDir = nothing$\n'<br>FileWrite $4 'Set IISWebSite = Nothing$\n'<br>FileWrite $4 'end if$\n'<br>FileWrite $4 'next$\n'<br>FileWrite $4 'objTextFile.WriteLine("[Websites]")$\n'<br>FileWrite $4 'objTextFile.WriteLine("AllSites=" &amp; Right(AllSites, Len(AllSites)-1))$\n'<br>FileWrite $4 'objTextFile.Close$\n'<br>FileWrite $4 'Set objFSO = Nothing$\n'<br>FileWrite $4 'Set objTextFile = Nothing$\n'<br>FileWrite $4 'Set IISOBj = Nothing$\n'<br>FileClose $4<br><br>; Execute the script<br>nsExec::Exec /TIMEOUT=20000 '"$SYSDIR\cscript.exe" "$PLUGINSDIR\GetWebsites.vbs"'<br>FunctionEnd<br><br>which return the list of server available in AllSites.<br>(ie AllSites = "Default Web Server|MyDomain.com Server")<br><br>When I populate this value in pick_website.ini<br><br><br>function WriteIni<br><br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Settings' 'NumFields' '4'<br><br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 1' 'Type' 'Label'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 1' 'Text' 'Please Select which Web Site to set the application to use:'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 1' 'Left' '0'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 1' 'Right' '-1'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 1' 'Top' '0'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 1' 'Bottom' '10'<br><br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 2' 'Type' 'Droplist'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 2' 'Text' 'droplist'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 2' 'ListItems' ''<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 2' 'Left' '25'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 2' 'Right' '150'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 2' 'Top' '10'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 2' 'Bottom' '22'<br><br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 3' 'Type' 'label'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 3' 'Text' 'Directory for the application (leave blank for default) :'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 3' 'Left' '0'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 3' 'Right' '-1'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 3' 'Top' '30'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 3' 'Bottom' '40'<br><br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 4' 'Type' 'text'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 4' 'Text' 'webPath'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 4' 'State' ''<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 4' 'Left' '25'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 4' 'Right' '150'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 4' 'Top' '40'<br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 4' 'Bottom' '52'<br><br>FunctionEnd<br><br><br>The PickWebsite is here :<br><br>Function PickWebsite<br>Call GetWebsites<br>Call WriteIni<br>ReadINIStr $0 "$PLUGINSDIR\websites.ini" "Websites" "AllSites"<br>WriteINIStr "$PLUGINSDIR\pick_website.ini" "Field 2" "ListItems" $0<br>!insertmacro MUI_HEADER_TEXT "Webserver Configuration" "Choose the website and path that your installation will reside at."<br>!insertmacro MUI_INSTALLOPTIONS_INITDIALOG "pick_website.ini"<br>!insertmacro MUI_INSTALLOPTIONS_SHOW<br>FunctionEnd<br><br>Any help welcome !<br><br>Laurent</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comperio</span><br><span class="post-time small text-muted">8th February 2009 18:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">My suggestion would be to run your VBScript by itself on Windows 2000 to make sure it's returning the correct values before trying to troubleshoot NSIS.<br><br>Also, when you write files for Windows, make sure you end each line with both a carriage return and a line feed. In you example, you only have a line feed. Use $\r$\n at the end of each line of text.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">domisse</span><br><span class="post-time small text-muted">8th February 2009 18:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for your very fast reply !!! :)<br><br>I've ran the vbs script on Win2000 and it works fine.<br>I've also added a MessageBox<br><br>ReadINIStr $0 "$PLUGINSDIR\websites.ini" "Websites" "AllSites"<br>WriteINIStr "$PLUGINSDIR\pick_website.ini" "Field 2" "ListItems" $0<br>MessageBox MB_OK "Debug $0"<br><br>to check IIS value and it was fine also.<br><br>Will add \r\n as you suggest.....thanks !</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">domisse</span><br><span class="post-time small text-muted">14th February 2009 22:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">No way ....<br>If I use ListBox instead of Droplist it works ... the list<br>of website is displayed. Combobox fails.<br>As I need user to select only one website, listbox is not<br>an option.<br><br>If someone has a any idea why listbox works and not droplist or combobox ....<br>Any idea welcome...was not able to find anything like this on google !<br><br>Laurent<br><br>PS: I have this problem on Win2000, it works fine on XP and 2003 with droplist (same script with same NSIS version).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comperio</span><br><span class="post-time small text-muted">15th February 2009 05:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">On droplist (field 2), try using a higher value for the "bottom" setting.<br><br>See this thread:<br><a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=263440" target="_blank">http://forums.winamp.com/showthread....hreadid=263440</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">domisse</span><br><span class="post-time small text-muted">15th February 2009 12:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Great ! :)<br>It works fine !<br><br>Many thanks to you !<br><br>Laurent</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">domisse</span><br><span class="post-time small text-muted">29th June 2009 17:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sadly, someone report me there is still an issue<br>with Windows server 2003 R2 enterprise x64 Edition (SP2).<br>I have no problem with 2003 R2 32bits....<br>Does anyone have any idea ?<br>Thanks !<br><br>See <a href="http://www.w3perl.com/Immagine.jpg" target="_blank">http://www.w3perl.com/Immagine.jpg</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">29th June 2009 19:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sure you don't have a load of ||| etc in the file?<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">domisse</span><br><span class="post-time small text-muted">29th June 2009 20:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">will check....</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">domisse</span><br><span class="post-time small text-muted">30th June 2009 11:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The string send is :<br><br>Default Web Site|SharePoint Central Administration v3|default|SharePoint - LinkedCube.dsgroup.it|SharePoint - 23064|Office Server Web Services<br><br>The file :<br><br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 2' 'Type' 'Droplist'<br><br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 2' 'Text' 'droplist'<br><br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 2' 'ListItems' ''<br><br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 2' 'Left' '25'<br><br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 2' 'Right' '150'<br><br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 2' 'Top' '10'<br><br>WriteIniStr '$PLUGINSDIR\pick_website.ini' 'Field 2' 'Bottom' '500'<br><br>Any hint ?</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>