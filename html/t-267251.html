<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="ExecWait doesn't wait" />

  <title>ExecWait doesn't wait - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">ExecWait doesn't wait</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=267251">ExecWait doesn't wait</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">HendriAdriaens</span><br />
      <span class="post-time small text-muted">6th March 2007 13:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>ExecWait doesn't wait</strong><br />
      Hi,<br />
      <br />
      I'm writing a small utility to run winzip from php. The exec function of php has a bug regarding quotation in arguments and brings up a dos box that I want to suppress. Other methods (via:<br />
      $WshShell = new COM("WScript.Shell");<br />
      $oExec = $WshShell-&gt;Run($cmdline, 0, $m);<br />
      do run and do hide the dos box, but do not wait for winzip to finish (which is essential).<br />
      <br />
      I run it now via the start command of windows, but that brings up a dos box that I don't want. So I considered rerouting it via a small utility built with nsis, see below. Very simple, but it doesn't work: ExecWait doesn't wait.<br />
      <br />
      Do you know a solution?<br />
      <br />
      Thanks, best regards,<br />
      -Hendri.<br />
      (PS: I am running the latest nsis on winxp sp2).<br />
      <br />
      <br />
      name "Test"<br />
      outfile "test.exe"<br />
      <br />
      SilentInstall silent<br />
      <br />
      Section<br />
      Call GetParameters<br />
      Pop $0<br />
      ExecWait '$0'<br />
      sectionEnd<br />
      <br />
      Function GetParameters<br />
      <br />
      Push $R0<br />
      Push $R1<br />
      Push $R2<br />
      Push $R3<br />
      <br />
      StrCpy $R2 1<br />
      StrLen $R3 $CMDLINE<br />
      <br />
      ;Check for quote or space<br />
      StrCpy $R0 $CMDLINE $R2<br />
      StrCmp $R0 '"' 0 +3<br />
      StrCpy $R1 '"'<br />
      Goto loop<br />
      StrCpy $R1 " "<br />
      <br />
      loop:<br />
      IntOp $R2 $R2 + 1<br />
      StrCpy $R0 $CMDLINE 1 $R2<br />
      StrCmp $R0 $R1 get<br />
      StrCmp $R2 $R3 get<br />
      Goto loop<br />
      <br />
      get:<br />
      IntOp $R2 $R2 + 1<br />
      StrCpy $R0 $CMDLINE 1 $R2<br />
      StrCmp $R0 " " get<br />
      StrCpy $R0 $CMDLINE "" $R2<br />
      <br />
      Pop $R3<br />
      Pop $R2<br />
      Pop $R1<br />
      Exch $R0<br />
      <br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th March 2007 20:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Call the good old start.exe that does wait with nsExec that hides the dos box.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">6th March 2007 22:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">watch out, there is no such thing as start.exe on NT based systems, only w9x, on NT its built into cmd.exe<br />
      <br />
      you probably need to use something like<br />
      %comspec% /c start foobar<br />
      <br />
      (start on NT is very stupid, if you need to use a quoted path, start thinks this is the window title so you need to do: %comspec% /c Start "" "c:\foo bar", not sure what that does on 9x)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">HendriAdriaens</span><br />
      <span class="post-time small text-muted">7th March 2007 00:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Indeed, %comspec% /c Start "" "c:\foo bar" seems to work. I found it myself too earlier today, but thanks anyway. Besides, with the WshShell object and the fact that start takes /wait, I managed to write a function that executes that command without dos box and it will wait for the application to finish. So the nsis utility is not necessary anymore, but still, the ExecWait not waiting surprised me.<br />
      <br />
      -Hendri</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bhuvidya</span><br />
      <span class="post-time small text-muted">12th March 2007 00:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">i am trying to do something similar, but having no luck<br />
      <br />
      i need to run some "msi" install programs at the end of my main script<br />
      <br />
      i would like to use ExecWait, but the following doesn;t seem to work<br />
      <br />
      ExecWait '%comspec% /c Start open "$INSTDIR\Tmp\msxml.msi"'<br />
      <br />
      nothing happens<br />
      <br />
      what am i doing wrong?<br />
      <br />
      cheers<br />
      bhu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">12th March 2007 01:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">its not Start open, if you want to set the title, use doublequotes, but you really should use msiexec.exe instead of the whole %comspec% /c mess<br />
      <br />
      see <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=212645" target="_blank">http://forums.winamp.com/showthread....hreadid=212645</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bhuvidya</span><br />
      <span class="post-time small text-muted">12th March 2007 02:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">thanx very much - that works!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
