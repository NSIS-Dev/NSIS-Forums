<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="$INSTDIR with a variable" />

  <title>$INSTDIR with a variable - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">$INSTDIR with a variable</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=258513">$INSTDIR with a variable</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TYT</span><br />
      <span class="post-time small text-muted">29th October 2006 04:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>$INSTDIR with a variable</strong><br />
      Alrighty, let's see if I can explain this properly. In my script I set variables for commonly used words like the directory where I have the files installed to. So first I do this..<br />
      <br />
      # Macro<br />
      !macro setVars ;sets variables for the start page and the folder which contains the shortcut icon.<br />
      StrCpy $1 "MyProgram" ;Sets the name for the install dir.<br />
      <br />
      !macroend<br />
      <br />
      Then, further down the script I have my install directory setup like this..<br />
      <br />
      # Installer attributes<br />
      OutFile "E:\Temp\Releasing\MyFile.exe"<br />
      InstallDir "$DOCUMENTS\$1"<br />
      <br />
      Below that, I have<br />
      <br />
      Function .onInit<br />
      !insertmacro setVars<br />
      FunctionEnd<br />
      <br />
      With the .onInit loading with the Welcome page.<br />
      <br />
      In theory, the installer <i>should</i> default to My Documents\MyProgram, but it doesn't. When you first get to the directory page all you see in the text field is the path to My Documents. If you browse to a new folder or drive, the "MyProgram" bit is added to the end, but if you just hit next without browsing, everything is dumped into the My Documents folder. I can rectify this by changing the variable in the InstallDir path to say "$DOCUMENTS\MyProgram" but the program name is different between programs and I like just using one script for all of them, and I just edit the variables for the different programs.<br />
      <br />
      Do I need to add some different variables? Maybe change the placement of the Function? Start the .onInit function somewhere else? If you have any clue, please let me know.<br />
      <br />
      I've attached my .nsi file to this post, it's a frankenstein script and I know it's messy but it does what it's ( <i>mostly</i> ) supposed to do.<br />
      <br />
      Thanks to all in advance.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TYT</span><br />
      <span class="post-time small text-muted">29th October 2006 04:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">And it seems I can't even attach a file, it's no wonder I can't seem to script an installer...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">29th October 2006 07:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The value from InstallDir is processed before .onInit is called. You should manually copy a new value to $INSTDIR in .onInit.</p>
      <pre>
<code>Function .onInit<br />  StrCpy $INSTDIR $DOCUMENTS\MyProgram<br />FunctionEnd</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TYT</span><br />
      <span class="post-time small text-muted">29th October 2006 13:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That explains it, thanQ very much.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
