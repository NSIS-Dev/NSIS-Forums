<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Installing to user but require admin"><title>Installing to user but require admin - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Installing to user but require admin</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=335400">Installing to user but require admin</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">siegeon</span><br><span class="post-time small text-muted">29th September 2011 19:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Installing to user but require admin</strong><br>I have been trying to resolve a maddening issue of installing .net 4 full on a clients machine. After a stupid amount of testing it turns out that my own inexperience is more of a factor than anything else. Since I have taken over a legacy product, and I have had little to know support it has been mostly guess work. With that in mind I have attempted to update a very old .nsis script to work with the updated version of my software. The issue is now clear to me, but I need some help on resolving this.<br><br>Dot net 4 requires administrator privileges to install from an .nsis script.<br>If I change the RequestExecutionLevel to admin (from user), then the $PROFILE variable changes from the current user to the administrator, causing everything to be installed in the wrong place.<br><br>I need the software to install to the users directory ie. C:\Users\&lt;actual user&gt;\ProgramName….<br>I also need to install .net 4 full on the user machine.<br><br>I see that there is a multiuser.nsh but I do not quite understand if that applies to what I am trying to do, or how to employ it<br><br>There may be other factors at play here so I will post the entire script, with a few fields marked out. I have been banging my head against this script for quite a while now… please, anyone help.<br><br>see attached code file</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">29th September 2011 20:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Please edit your post and include your script as a file attachment. I'm not sure that there is a simple solution to your problem which will work on all versions of Windows. You may have to resort to asking the user to install .NET 4 themselves as a prerequisite.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br><span class="post-time small text-muted">29th September 2011 20:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>I need the software to install to the users directory ie. C:\Users\&lt;actual user&gt;\ProgramName….</blockquote>Why? You can't install properly to "C:\Program Files\..." ???<br><br><br>Anyway:<br><br><blockquote>I also need to install .net 4 full on the user machine.</blockquote>You can explicitly set "RequestExecutionLevel user" to make sure installer won't get elevated. Then the $PROFILE will point to the profile of the (potentially "restricted") user who has executed the installer. After that, Exec() and ExecWait() may fail to run executables, which require elevation (via Manifest). That probably applies to .NET Installer. But you can use ExeShell() - maybe with "runas" verb - to run the .NET installer from a non-elevated NSIS installer, which should trigger an UAC dialog and, if the user allows, run the 2nd installer elevated ...</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">siegeon</span><br><span class="post-time small text-muted">29th September 2011 20:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>Why? You can't install properly to "C:\Program Files\..." ???</blockquote>I have no idea, but management is resistant to the idea, and they insist that all of our products install this way...<br><br>Edit.<br>&lt;Never mind I figured it out, playing with that command now&gt;<br><br>Edit. 2<br><br>That did the trick, this is the exact result I was looking for, thank you very much for for hte help!</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br><span class="post-time small text-muted">29th September 2011 21:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by siegeon</small><br>I have no idea, but management is resistant to the idea, and they insist that all of our products install this way...</blockquote>You should explain them, that this undermines the security concept of modern operating systems: Install program files to locations where "normal" users/applications don't have access, so malware or gawky users cannot mess with those files. Not a very good advertisement.<br><br>(If the idea is to completely get away without elevation, this is bound to fails anyway as soon as you have to install .NET)</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">siegeon</span><br><span class="post-time small text-muted">29th September 2011 22:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I understand that Mulder, so rather then installing to<br><br>!define INSTALL_BASE "$PROFILE\${PRODUCT_PUBLISHER_FOLDER}"<br><br>what command would I use instead?<br><br>Also I am confused on one point, if the user who is logged in is installing the software is "restricted" why would installing to program files make a difference? And since this software requires and one point or another administrator privileges, then theoretically should the whole thing require administrator rights to install? I know we sell this product to people on various levels of managed systems, where a base user needs to be able to install our software on their system. The blow back from that is that we also require this .net 4 full... Im not sure what the best approach here is.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br><span class="post-time small text-muted">29th September 2011 22:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by siegeon</small><br>I understand that Mulder, so rather then installing to<br><br>!define INSTALL_BASE "$PROFILE\${PRODUCT_PUBLISHER_FOLDER}"<br><br>what command would I use instead?</blockquote>!define INSTALL_BASE "$PROGRAMFILES32\${YOUR_COMPANY_NAME}\${YOUR_PRODUCT_NAME}"<br><br><blockquote><small>Originally posted by siegeon</small><br>Also I am confused on one point, if the user who is logged in is installing the software is "restricted" why would installing to program files make a difference? And since this software requires and one point or another administrator privileges, then theoretically should the whole thing require administrator rights to install?</blockquote>On Vista and later, UAC will run every application (including installers*) with restricted rights - even when the user is an Admin with full rights. Elevation can give applications the full rights. For "Admin" users UAC elevation will only need a click on <i>Yes</i> and the app will still run under the current user's account. For "Restricted" (non-admin) users UAC elevation will ask the user the enter the login credentials of an Admin account and the app will then run under <i>that</i> account. In the latter case the meaning of the user-specific $PROFILE** (and everything that lies in that folder) will change, because the application is running under a different user. At the same time $PROGRAMFILES[32/64] is <i>not</i> user-specific. It's a system-wide folder that will be identical, no matter what account the application is running under...<br><br><font size="1">(*) It has to be noted that Windows will automatically detect and try to elevate NSIS-based installers, if you don't use "RequestExecutionLevel" at all<br><br>(**) At least as long as ShellVarContext is set to "current" and <b>not</b> to "all"</font><br><br><blockquote>I know we sell this product to people on various levels of managed systems, where a base user needs to be able to install our software on their system. The blow back from that is that we also require this .net 4 full... Im not sure what the best approach here is.</blockquote>Well, installing software generally requires Admin rights. That's because most installers will require elevation. And that is because most installers will correctly install program files to the protected "C:\Program Files" folder and/or will need to install (or modify) system files. A user who wants to install software on the computer must be either logged in with an "Admin" account or must have access to Admin login credentials at least. If somebody doesn't have access to an Admin account, then that's probably for a reason and that person shouldn't be trying to install the software to the computer (but ask the company's administrator team instead). Last but not least: <i>Your</i> installer will ultimately require Admin rights - regardless of where you install the program files to - anyway. That's because you need to install the .NET Framework. So then, why not install your program files correctly to $PROGRAMFILES right away ???</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">siegeon</span><br><span class="post-time small text-muted">29th September 2011 22:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Mulder thank you again, that was an excellent explanation, I now understand, ad can approach management in the next meeting about this.<br><br>Siegeon.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">30th September 2011 05:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Note that installing to Program Files is not a goal in itself. It is however the proper thing to do, if you're installing for ALL USERS. And because admin-only installers should always install for all users, this also means that installing to Program Files is the proper thing to do if you have an admin-only installer.<br><br><br>Regardless, many user-level users on older Windows versions are user-level because they choose to be. They don't want to run installers at admin level for security reasons. Personally, I would definitely prefer to install .NET myself at admin level (because I trust microsoft's installers), and then install your app at user level. I admit however that this scenario applies only to an increasingly small number of people, now that UAC exists.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">siegeon</span><br><span class="post-time small text-muted">3rd October 2011 16:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Due to the way this software was created it is a single user product, and our license covers that single user, should other users want to use our software they are obligated to purchase their own. Granted this is something that should be resolved within the software though a login system, but as there is never enough time its something far down on the list. That being said the reason we are installing to the individual user profile is to prevent access to other users. As we are targeting users it does put us in a bit of a quandary, we require Dot Net 4 full, and granted the installation of Dot Net is an administrators task on a managed system, but the solution reached in this discussion is the closest to a perfect solution I can get.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>