<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="InstallDirRegKey"><title>InstallDirRegKey - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">InstallDirRegKey</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=316839">InstallDirRegKey</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">silencshadow</span><br><span class="post-time small text-muted">6th February 2010 14:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>InstallDirRegKey</strong><br>&nbsp; Hey Guys,<br>i got a problem with InstallDirRegKey i need to check up 2 installdirregkeys for Teamspeak 3 Style package ...<br><br>InstallDirRegKey HKCU "Software\TeamSpeak 3 Client" ""<br>InstallDirRegKey HKLM "Software\TeamSpeak 3 Client" ""<br><br>its everytime set the installdir to the last ... how i can check if first not exist take the second and if the last not exist take the first??<br><br>Help plz :(</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">6th February 2010 14:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">There is only support for 1. To use more than one, you need to code it yourself in .onInit</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">silencshadow</span><br><span class="post-time small text-muted">6th February 2010 14:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Anders</i><br><b>There is only support for 1. To use more than one, you need to code it yourself in .onInit</b><hr></blockquote></div><hr>can you show me how? its needed ....<br><br>thx<br><div class="post"><p class="post-meta"><span class="post-author text-primary">silencshadow</span><br><span class="post-time small text-muted">6th February 2010 15:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">*bump*</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">6th February 2010 15:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Quote:</p><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">silencshadow</span><br><span class="post-time small text-muted">6th February 2010 15:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Im sry though ur gone away and other guys think that this is solved.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">CG!</span><br><span class="post-time small text-muted">6th February 2010 16:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">But keep your project private if you include TeamSpeak files because the TeamSpeak Systems GmbH doesn't allow repackaging and republishing w/o permission. And as far as i understood, they won't give permission.<br>it's the reason why there are no legal portable versions of TeamSpeak. The versions made with THinstall are illegal.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">silencshadow</span><br><span class="post-time small text-muted">6th February 2010 16:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Its a Skin, not illegal :) its official but i want to automatic it and i need to find out how i can check 2 regestrys from the regedit if they exist or not ... can anyone PLZ help me?!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Animaether</span><br><span class="post-time small text-muted">6th February 2010 20:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Something like this...<br>( checks HKCU first, falls back to HKLM, then falls back to a default path )<br></p><pre>
<code>
"LogicLib.nsh"
<br><br>&gt;OutFile "test.exe"
<br><br>&gt;Function .onInit
<br>   ; Clear all errors first
<br>    ClearErrors
<br>    
<br>   ; Check for the HKCU registry key (presuming paramter 'InstallLocation' by the installer.
<br>   ReadRegStr $0 HKCU "Software\TeamSpeak 3 Client" "InstallLocation"
<br>   ${Unless} ${Errors}
<br>        ; Ifthat doesnt fail, set the $InstDir variable to its value
<br>        StrCpy $InstDir$0
<br>    ${Else}
<br>        ;Otherwise, try the HKLM registry key (clear errors flag first)
<br>        ClearErrors
<br>        ReadRegStr$0 HKLM "Software\TeamSpeak 3 Client" "InstallLocation"
<br>       ${Unless} ${Errors}
<br>            ; This should look familiar
<br>            StrCpy $InstDir$0
<br>        ${Else}
<br>            ; Ifthis also failed (so HKCU -and- HKLM failed), set a default location.
<br>           StrCpy $InstDir "$PROGRAMFILES\Default\Installation\Folder\"
<br>        ${EndIf}
<br>    ${EndIf}
<br>    MessageBox MB_OK "</code>$$InstDir = $InstDir"
<br>FunctionEnd
<br><br>Section
<br>SectionEnd 
<br>&gt;

</pre>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">silencshadow</span><br>
        <span class="post-time small text-muted">6th February 2010 23:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">I say thx to you :) im very drunken, dont hope that i write stupid things :) and i have 1 more question, i want to build a exe ... i post it now ... second plz<br>
        <br></p>

        <blockquote>
          ;--------------------------------<br>
          ;Include Modern UI<br>
          <br>
          !include "MUI2.nsh"<br>
          <br>
          ;--------------------------------<br>
          ;General<br>
          <br>
          ;Name and file<br>
          Name "Xetu-Hosting Teamspeak 3 Style"<br>
          OutFile "XetuStyle1.0.exe"<br>
          <br>
          ;Get installation folder from registry if available<br>
          InstallDirRegKey HKCU "Software\TeamSpeak 3 Client" ""<br>
          ;InstallDirRegKey HKLM "Software\TeamSpeak 3 Client" ""<br>
          <br>
          <br>
          ;Request application privileges for Windows Vista<br>
          RequestExecutionLevel admin<br>
          <br>
          ;--------------------------------<br>
          <br>
          XPStyle on<br>
          Function .onInit<br>
          <br>
          SetOutPath "$TEMP"<br>
          File "C:\Users\SilencShadoW\Desktop\Desktop\Xetu-Hosting\Style\plugins\splash.bmp"<br>
          File "C:\Users\SilencShadoW\Desktop\Desktop\Xetu-Hosting\Style\plugins\splash.dll"<br>
          <br>
          <br>
          ;--------------------------------<br>
          <br>
          InitPluginsDir<br>
          File /oname=$TEMP\splash.bmp "C:\Users\SilencShadoW\Desktop\Desktop\Xetu-Hosting\Style\plugins\splash.bmp"<br>
          <br>
          advsplash::show 1000 600 400 -1 $TEMP\splash<br>
          <br>
          Pop $0 ; $0 has '1' if the user closed the splash screen early,<br>
          ; '0' if everything closed normally, and '-1' if some error occurred.<br>
          <br>
          Delete $TEMP\splash.bmp<br>
          Delete $TEMP\splash.dll<br>
          SetOutPath C:<br>
          <br>
          FunctionEnd<br>
          <br>
          ;--------------------------------<br>
          ;Variables<br>
          <br>
          Var StartMenuFolder<br>
          <br>
          ;--------------------------------<br>
          ;Interface Settings<br>
          <br>
          !define MUI_HEADERIMAGE<br>
          !define MUI_HEADERIMAGE_BITMAP "C:\Users\SilencShadoW\Desktop\Desktop\Xetu-Hosting\Style\Header\xetu.bmp"<br>
          !define MUI_ABORTWARNING<br>
          <br>
          ;--------------------------------<br>
          ;Pages<br>
          <br>
          !insertmacro MUI_PAGE_WELCOME<br>
          !insertmacro MUI_PAGE_LICENSE "C:\Users\SilencShadoW\Desktop\Desktop\Xetu-Hosting\Style\Lizenz\License.txt"<br>
          !insertmacro MUI_PAGE_COMPONENTS<br>
          !insertmacro MUI_PAGE_DIRECTORY<br>
          <br>
          ;Start Menu Folder Page Configuration<br>
          !define MUI_STARTMENUPAGE_REGISTRY_ROOT "HKCU"<br>
          !define MUI_STARTMENUPAGE_REGISTRY_KEY "Software\Xetu-Hosting Teamspeak 3 Style"<br>
          !define MUI_STARTMENUPAGE_REGISTRY_VALUENAME "Start Menu Folder"<br>
          <br>
          !insertmacro MUI_PAGE_STARTMENU Application $StartMenuFolder<br>
          <br>
          !insertmacro MUI_PAGE_INSTFILES<br>
          !insertmacro MUI_PAGE_FINISH<br>
          <br>
          <br>
          !insertmacro MUI_UNPAGE_WELCOME<br>
          !insertmacro MUI_UNPAGE_CONFIRM<br>
          !insertmacro MUI_UNPAGE_INSTFILES<br>
          !insertmacro MUI_UNPAGE_FINISH<br>
          <br>
          ;--------------------------------<br>
          ;Languages<br>
          <br>
          !insertmacro MUI_LANGUAGE "English"<br>
          <br>
          ;--------------------------------<br>
          ;Installer Section<br>
          <br>
          <br>
          Section "Xetu-Hosting Icon Pack" IconPack<br>
          <br>
          SetOutPath "$INSTDIR"<br>
          <br>
          SetOutPath $INSTDIR\gfx\Xetu<br>
          File "C:\Users\SilencShadoW\Desktop\Desktop\Xetu-Hosting\Style\gfx\Xetu\*"<br>
          <br>
          !insertmacro MUI_STARTMENU_WRITE_BEGIN Application<br>
          <br>
          !insertmacro MUI_STARTMENU_WRITE_END<br>
          <br>
          SectionEnd<br>
          <br>
          <br>
          ;___________________________________________________________________<br>
          <br>
          Section "Xetu-Hosting Emoticons" Emoticons<br>
          <br>
          SetOutPath "$INSTDIR"<br>
          <br>
          <br>
          SetOutPath $INSTDIR\gfx\Xetu\emoticons<br>
          File "C:\Users\SilencShadoW\Desktop\Desktop\Xetu-Hosting\Style\gfx\Xetu\emoticons\*"<br>
          <br>
          !insertmacro MUI_STARTMENU_WRITE_BEGIN Application<br>
          <br>
          !insertmacro MUI_STARTMENU_WRITE_END<br>
          <br>
          SectionEnd<br>
          <br>
          <br>
          ;___________________________________________________________________<br>
          <br>
          <br>
          Section "Xetu-Hosting Style" Style<br>
          <br>
          SetOutPath "$INSTDIR"<br>
          <br>
          <br>
          SetOutPath $INSTDIR\styles<br>
          File "C:\Users\SilencShadoW\Desktop\Desktop\Xetu-Hosting\Style\styles\Xetu.qss"<br>
          <br>
          ;___________________________________________________________________<br>
          <br>
          ;Store installation folder<br>
          WriteRegStr HKCU "Software\Xetu-Hosting Teamspeak 3 Style" "" $INSTDIR<br>
          <br>
          ;Create uninstaller<br>
          WriteUninstaller "$INSTDIR\XetuUninstall.exe"<br>
          <br>
          !insertmacro MUI_STARTMENU_WRITE_BEGIN Application<br>
          <br>
          ;Create shortcuts<br>
          CreateDirectory "$SMPROGRAMS\$StartMenuFolder"<br>
          CreateShortCut "$SMPROGRAMS\$StartMenuFolder\Uninstall.lnk" "$INSTDIR\XetuUninstall.exe"<br>
          <br>
          !insertmacro MUI_STARTMENU_WRITE_END<br>
          <br>
          <br>
          SectionEnd<br>
          <br>
          ;--------------------------------<br>
          ;Descriptions<br>
          <br>
          ;Language strings<br>
          LangString DESC_IconPack ${LANG_ENGLISH} "The Xetu-Hosting Icon Pack."<br>
          LangString DESC_Emoticons ${LANG_ENGLISH} "The Xetu-Hosting Emoticons."<br>
          LangString DESC_Style ${LANG_ENGLISH} "The Xetu-Hosting Style."<br>
          <br>
          <br>
          ;Assign language strings to sections<br>
          !insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br>
          !insertmacro MUI_DESCRIPTION_TEXT ${Style} $(DESC_Style)<br>
          !insertmacro MUI_DESCRIPTION_TEXT ${Emoticons} $(DESC_Emoticons)<br>
          !insertmacro MUI_DESCRIPTION_TEXT ${IconPack} $(DESC_IconPack)<br>
          !insertmacro MUI_FUNCTION_DESCRIPTION_END<br>
          <br>
          ;--------------------------------<br>
          ;Uninstaller Section<br>
          <br>
          Section "Uninstall"<br>
          <br>
          Delete "$INSTDIR\gfx\Xetu\emoticons\*"<br>
          Delete "$INSTDIR\gfx\Xetu\*"<br>
          Delete "$INSTDIR\styles\Xetu.qss"<br>
          <br>
          Delete "$INSTDIR\XetuUninstall.exe"<br>
          <br>
          RMDir "$INSTDIR\gfx\Xetu\Emoticons"<br>
          RMDir "$INSTDIR\gfx\Xetu"<br>
          <br>
          !insertmacro MUI_STARTMENU_GETFOLDER Application $StartMenuFolder<br>
          <br>
          Delete "$SMPROGRAMS\$StartMenuFolder\Uninstall.lnk"<br>
          RMDir "$SMPROGRAMS\$StartMenuFolder"<br>
          <br>
          DeleteRegKey /ifempty HKLM "Software\Xetu-Hosting Teamspeak 3 Style"<br>
          <br>
          SectionEnd
        </blockquote>Is there a way that i build this installer only as patcher? that i start it and then its checks on a site if there is a newer version of the gfx, gfx/emoticons and styles/xetu.qss ??<br>
        and how i can solve it on the server if there is a way ... thank u!
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">silencshadow</span><br>
        <span class="post-time small text-muted">7th February 2010 09:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">And i have one more Question, how can i add on the finishpage some boxes to mark like view changelog and the needed one is ... a box to mark that the installer close teamspeak 3 and restart it ... is there a way for it?</p>
      </div>
      <hr>

      <div class="footer">
        <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
      </div>

      <table cellpadding="6" cellspacing="0" border="0" width="100%">
        <tr>
          <td class="alt2">
            <hr>
            <i>Originally posted by silencshadow</i><br>
            <b>*bump*</b> Don't bump, you just posted this topic and it was #2 on the front page, bumping when you are really close to the top is just fucking rude. I was going to help you, but that is not going to happen now. You can wait (without bumping) to see if someone else gives you any help, or you can do it yourself, just take a look at the registry functions in the helpfile</td></tr></table></div></div></body></html>