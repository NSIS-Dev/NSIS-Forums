<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Set DEFAULT installation Dir (conditionally)"><title>Set DEFAULT installation Dir (conditionally) - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Set DEFAULT installation Dir (conditionally)</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=48883">Set DEFAULT installation Dir (conditionally)</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">dbareis</span><br><span class="post-time small text-muted">4th May 2001 02:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi,<br><br>Currrently I have a product whose default installation directory defaults to "C:\PROGRAM FILES\SITECOPY".<br><br>What I want is to set it to "C:\PROGRAM FILES\SITECOPY" if the user is on Windows NT/2000 (and probably XP) and to "C:\SC" if on DOS versions (95/98/ME). I want this to be the default that is shown in the choose directory dialog so the user can still place the files where they wish.<br><br>Can someone please tell me how I can do this.<br><br>Thanks for any help,<br>Dennis</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">justin</span><br><span class="post-time small text-muted">4th May 2001 06:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sure, just add the following lines to your .nsi file:<br><br></p><pre>
<code><br>Function .onInit<br>  ReadRegStr $0 HKLM "Software\Microsoft\Windows NT\CurrentVersion" SystemRoot<br>  StrCmp $0 "" 0 NoWin9x<br>    StrCpy $INSTDIR C:\SC<br>  NoWin9x:<br>FunctionEnd<br></code>
</pre><br>
      <br>
      What this does it check for HKLM\Software\Microsoft\Windows NT\CurrentVersion\SystemRoot, and if it is not empty, it knows it is on Windows NT, and skips the StrCpy line.<br>
      <br>
      Note that if you also want to use InstallDirRegKey (to let the user upgrade easily), and don't want to overwrite that install dir if the user is upgrading, you can use something like:<br>
      <br>
      <pre>
<code><br>Function .onInit<br>  StrCmp $INSTDIR "C:\Program Files\SITECOPY" 0 NoWin9x<br>  ReadRegStr $0 HKLM "Software\Microsoft\Windows NT\CurrentVersion" SystemRoot<br>  StrCmp $0 "" 0 NoWin9x<br>    StrCpy $INSTDIR C:\SC<br>  NoWin9x:<br>FunctionEnd<br></code>
</pre><br>
      <br>
      Which will only change $INSTDIR if the default (C:\program files\SITECOPY) is used..<br>
      <br>
      -Justin
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dbareis</span><br>
      <span class="post-time small text-muted">4th May 2001 10:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Excellent, thanks.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dbareis</span><br>
      <span class="post-time small text-muted">5th May 2001 01:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Justin,<br>
      <br>
      I was thinking about your response, it solved my main problem (works very well - thanks) but it would be nice if all the main options such as "DirText" could also be accessed as variables. And please if you do this either add $COMSPEC or access to environment variables in general.....<br>
      <br>
      Bye<br>
      Dennis</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>