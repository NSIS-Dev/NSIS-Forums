<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Installation Error on Windows 95" />

  <title>Installation Error on Windows 95 - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Installation Error on Windows 95</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=145473">Installation Error on Windows 95</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jcagle</span><br />
      <span class="post-time small text-muted">11th August 2003 23:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Installation Error on Windows 95</strong><br />
      I have installed my software using NSIS on Windows ME and Windows 2000 without problem. However, I just tried to install it on Windows 95 and the installer crashes when it attempts to do the following line of code (I think):<br /></p>
      <pre>
<code>CreateShortCut "$DESKTOP\${MUI_PRODUCT}.lnk" "$INSTDIR\${MUI_FILE}" \<br />"" "$INSTDIR\${MUI_FILE}" 0</code>
</pre><br />
      <br />
      I'm not sure even where to begin on this. The only thing I can think of is that the Windows 95 laptop that I'm installing on is not Win32...is that possible (The laptop is extremely old)? If so, how can I check to see if that is the case? Or, does this even matter? Any advice or pointers would be much appreciated!!!!<br />
      <br />
      Edit:<br />
      I looked under System Properties, and it says the File System is 32-bit...does that mean it's Win32?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jcagle</span><br />
      <span class="post-time small text-muted">11th August 2003 23:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">By the way, in case anyone wanted to see the actual installation dump...<br />
      <br />
      H2HINSTALL21B caused an invalid page fault in<br />
      module &lt;unknown&gt; at 0000:70bdc4e3.<br />
      Registers:<br />
      EAX=007baa10 CS=0157 EIP=70bdc4e3 EFLGS=00010246<br />
      EBX=0040a530 SS=015f ESP=0100ef84 EBP=0100f5cc<br />
      ECX=00409d30 DS=015f ESI=007ba9ac FS=1187<br />
      EDX=00000000 ES=015f EDI=007ba9ac GS=10c6<br />
      Bytes at CS:EIP:<br />
      <br />
      Stack dump:<br />
      70936e4b 007baa10 a0000001 00409d30 7095164e 007ba9ac a0000001 00000001 00409d30 0040a530 0100f148 00000409 bff9d8f3 0100f118 bfc044ca 0100eff7<br />
      <br />
      Thanks for anyone's help!!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">11th August 2003 23:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Win32 means: all 32-bit Windows platforms (Windows 95, 98, ME, NT4, 2000, XP, 2003). I recently tested my NSIS installer on Windows 95 (including CreateShortcut) and had no problems.<br />
      <br />
      So it should work on Windows 95. Which version of NSIS are you using? Did you recompile?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jcagle</span><br />
      <span class="post-time small text-muted">11th August 2003 23:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm using NSIS Version 2.0 Beta 4. What do you mean..."recompile"? Do you mean recompile my installation script? If so, the answer is "yes".</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jcagle</span><br />
      <span class="post-time small text-muted">11th August 2003 23:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Can I supply someone with a link to download my software and try to install it on Windows 95? I'm just wondering if it's my laptop/version of Windows 95, or if it's a problem for others as well. I could try to dumb up the installer so as to only attempt the "Problem" area. Thanks.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">11th August 2003 23:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What Joost meant to ask is if you have recompiled NSIS itself.<br />
      <br />
      According to the crash message the problem is outside of NSIS code in an unknown module. It's probably a DLL you're trying to register. Try focusing the "dumber" installer on [un]RegDLL instructions if it's not CreateShortcut.<br />
      <br />
      It would be useful for testing if you can generate a ZIP file with a stripped example script (with the DLL in question if it is the cause) that causes the crash.<br />
      <br />
      If your Windows 95 version isn't 32-bit NSIS shouldn't have even started.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jcagle</span><br />
      <span class="post-time small text-muted">12th August 2003 00:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I updated my NSIS via the "NSIS Update" option (via CVS - clean copy). Is there something I need to do with "recompiling" NSIS??<br />
      <br />
      I am registering some DLLs, but all my DLLs (VB related) are working fine. I will look into that, however.<br />
      <br />
      Thanks for the help...any other advice would be very helpful!!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jcagle</span><br />
      <span class="post-time small text-muted">12th August 2003 01:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've narrowed my problem down to the following bit of code (Thanks kichik for pointing me in the right direction):<br /></p>
      <pre>
<code><br />!insertmacro UpgradeDLL "${MY_SYSDIR}SHLWAPI.DLL" "$SYSDIR\SHLWAPI.DLL"<br />Push $SYSDIR\SHLWAPI.DLL<br />Call AddSharedDLL<br /></code>
</pre><br />
      <br />
      I'm going to look into it a little closer, but does anyone see anything wrong with this????<br />
      <br />
      By the way, it was recommended at one time (by kichik, I believe) to check to make sure that the installing computer has IE 4.0 or greater installed on it (SHLWAPI.DLL is installed with IE 4.0 or greater)...and tell the installing person that the computer must have IE4 in order to install my software. However, I kept the above code active because I didn't want my software to rely on IE4 being installed. The Win95 laptop has IE5.5...but the above lines of code fail!?!?!? If I choose to do the "make sure you have IE 4 or greater" way, do I still need to add a shared value to this dll??? How would my above code change? Can I skip this code entirely if they have IE4 or greater installed? When I uninstall my software, do I remove a shared value on this DLL?<br />
      <br />
      As you can see, I have a lot of questions regarding this. Thanks for everyone's help on this!!!
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dajvid</span><br />
      <span class="post-time small text-muted">12th August 2003 04:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Although I am far from an expert on system files, you may want to check as to whether you need separate versions of SHLWAPI.DLL depending on what version of Windows your installer is running on.<br />
      <br />
      When installing applications such as Internet Explorer or Microsoft Office (both of which include system file updates), the Microsoft installers install different system files depending on your version of Windows. You may need to also do the same thing with SHLWAPI.DLL.<br />
      <br />
      The first thing you need to find out is whether different versions of SHLWAPI.DLL is installed to different versions of Windows. If so, you'll need to package all of the different versions of SHLWAPI.DLL and only extract the appropriate version depending on the version of Windows your installer is running on.<br />
      <br />
      Ta,<br />
      Dave.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">12th August 2003 13:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Jcagle, <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=143829&amp;highlight=shlwapi.dll" target="_blank">my advice</a> was to check for SHLWAPI.dll and if not present require the user to install IE 4 and above. It's far more simpler than checking for the version of Windows and the version of Internet Explorer. By checking the versions you're also assuming you know which versions of Internet Explorer provide SHLWAPI.dll, and you can't be sure of that.<br />
      <br />
      As dajvid said, the Microsoft installer can install different versions of the file for different systems or configurations. It can be Unicode enabled for Windows NT and MBCS for Windows 9x, it could install a certain version for XP that uses new features that are just in XP, etc. If Microsoft didn't supply a redistributable and didn't say it's possible to redistribute the DLL on your own you should probably shouldn't.<br />
      <br />
      In conclusion, the code I'd suggest is:<br />
      <br /></p>
      <pre>
<code>Function .onInit<br />  IfFileExists $SYSDIR\SHLWAPI.DLL +3<br />    MessageBox MB_OK|MB_ICONSTOP "Required DLL missing, please \<br />      install Internet Explorer 4.0 or above. Bye."<br />    Abort<br />FunctionEnd</code>
</pre><br />
      <br />
      If there are some functions that your program imports from SHLWAPI.dll that are not in all versions of it you should check for its version too and tell the user what to install according to Microsoft supplied information.
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
