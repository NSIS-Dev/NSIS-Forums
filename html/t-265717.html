<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="InstallOption / Verify / setting new text in a &quot;Text&quot; field." />

  <title>InstallOption / Verify / setting new text in a "Text" field. - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">InstallOption / Verify / setting new text in a "Text" field.</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=265717">InstallOption / Verify / setting new text in a "Text" field.</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sheik</span><br />
      <span class="post-time small text-muted">13th February 2007 19:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>InstallOption / Verify / setting new text in a "Text" field.</strong><br />
      Hi all,<br />
      <br />
      I am using MUI (Well, UMUI), and creating a custom InstallOption page.<br />
      <br />
      On this page, I have a text field (readonly), that I populate with text, based on another setting on the page.<br />
      <br />
      I have set the "other" field setting to state of VERIFY, so I get a callback into my "verify" function.<br />
      This works.<br />
      <br />
      However, I when I try to "update" the text field, it doesn't seem to get applied, not sure why...<br />
      <br />
      I do this in the "Verify" callback:<br />
      <br />
      !insertmacro MUI_INSTALLOPTIONS_WRITE "ioA.ini" "Field 7" "State" "blah"<br />
      <br />
      Then I do an "Abort" to back out back to the Custom Page again.<br />
      When it backs out, it does not contain "blah", but instead the old text that was there before...<br />
      <br />
      I assume I have to send a message to the Window to redraw/update itself?<br />
      If so, How?<br />
      <br />
      Thanks!<br />
      Scott</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">13th February 2007 20:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        I assume I have to send a message to the Window to redraw/update itself?<br />
        If so, How?
      </blockquote>Right!<br />
      See the included example NSIS\Examples\InstallOptions\testnotify.nsi especially what the button clear does.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sheik</span><br />
      <span class="post-time small text-muted">13th February 2007 20:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yup.<br />
      Thats where I was getting the idea from.<br />
      <br />
      They do:<br />
      <br />
      ReadINIStr $1 "$PLUGINSDIR\test.ini" "Field 5" "HWND"<br />
      SendMessage $1 ${WM_SETTEXT} 0 "STR:"<br />
      <br />
      Which works and completely makes sense for setting the "text" of the buttons.<br />
      <br />
      But it does not seem to work for setting the actual text<br />
      inside of an Edit (text) box...<br />
      <br />
      Obviously it must be a different message, I just can't seem to find the right one! =)<br />
      <br />
      <br />
      Scott</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">13th February 2007 20:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The example clears the text into text fields, to set the text, you need "STR:Add_string_here".</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sheik</span><br />
      <span class="post-time small text-muted">13th February 2007 21:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ya.<br />
      <br />
      I seem to have more problems than just this one... =)<br />
      <br />
      In my "verify" (LeaveCustom) section, I am getting very very strange results on just about everything.<br />
      <br />
      Obviously I have broken something, still trying to figure out what I did... =)<br />
      <br />
      Doing the following, I get a "bizarre" output on the first<br />
      Messagebox of "1: blah" (ie, it is suggesting that $1 is coming back as "blah", which is bizarre, since I don't have "blah" anywhere in my script or .ini file...)<br />
      <br />
      The next MessageBox should display the HWND, but its displaying nothing at all!<br />
      <br />
      Function LeaveCustom<br />
      <br />
      !insertmacro MUI_INSTALLOPTIONS_WRITE "ioA.ini" "Field 7" "State" "Old Version: $1\r\nNew Version: $2"<br />
      <br />
      Strcpy $1 ""<br />
      ReadINIStr $1 "ioA.ini" "Field 7" "State"<br />
      MessageBox MB_OK "1: $1"<br />
      <br />
      ReadINIStr $1 "ioA.ini" "Field 7" "HWND"<br />
      MessageBox MB_OK "2: $1"<br />
      <br />
      Abort<br />
      <br />
      FunctionEnd<br />
      <br />
      <br />
      The .ini file for field 7 isn't much:<br />
      <br />
      [Field 7]<br />
      Type=Text<br />
      Left=9<br />
      Top=169<br />
      Right=131<br />
      Bottom=198<br />
      State=""<br />
      <br />
      Just plain bizarre.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">13th February 2007 21:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">lol, where the blah comes from when there isn't blah in your script?<br />
      Seriously, if you use ReadINIStr you need to add the $PLUGINSDIR e.g.<br />
      ReadINIStr $1 "$PLUGINSDIR\ioA.ini" "Field 7" "State"</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sheik</span><br />
      <span class="post-time small text-muted">13th February 2007 22:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">&gt; Seriously, if you use ReadINIStr you need to<br />
      &gt; add the $PLUGINSDIR e.g.<br />
      &gt; ReadINIStr $1 "$PLUGINSDIR\ioA.ini" "Field 7" "State"<br />
      <br />
      Ah, that helped immensely!<br />
      <br />
      I actually had nearly everything working, but missed the concept of needing $PLUGINSDIR !<br />
      <br />
      Thanks for your help!<br />
      Scott</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">13th February 2007 22:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This example shows the actual difference,<br /></p>
      <pre>
<code>OutFile "Test.exe"<br /><br />!include "mui.nsh"<br /><br />!insertmacro MUI_PAGE_LICENSE "${NSISDIR}\Docs\Modern UI\License.txt"<br />Page Custom custcreate custleave<br />!insertmacro MUI_PAGE_INSTFILES<br /><br />!insertmacro MUI_LANGUAGE "English"<br /><br />Section <br />   <br />SectionEnd<br /><br /><br />Function custcreate<br />   !insertmacro MUI_HEADER_TEXT "Custom Page" \<br />   "Just a simple custom page"<br />   !insertmacro MUI_INSTALLOPTIONS_WRITE "custom.ini" "field 1" "state" "some sample text"<br />   push $0<br />   InstallOptions::Dialog "$PLUGINSDIR\custom.ini"<br />   pop $0<br />   pop $0<br />FunctionEnd<br /><br /><br />Function custleave<br />   !insertmacro MUI_INSTALLOPTIONS_READ $0 "custom.ini" "Settings" "state"<br />   StrCmp $0 2 0 end<br />   !insertmacro MUI_INSTALLOPTIONS_READ $0 "custom.ini" "field 2" "State"<br />   StrCmp $0 0 0 +4<br />   !insertmacro MUI_INSTALLOPTIONS_READ $0 "custom.ini" "field 1" "HWND"<br />   SendMessage $0 ${WM_SETTEXT} 0 "STR:some sample text"<br />   Goto +3<br />   !insertmacro MUI_INSTALLOPTIONS_READ $0 "custom.ini" "field 1" "HWND"<br />   SendMessage $0 ${WM_SETTEXT} 0 "STR:The text has changed now"<br />   Abort<br />   <br />   end:<br />FunctionEnd<br /><br /><br />Function .onInit<br />   InitPluginsDir<br />   GetTempFileName $0<br />   Rename $0 "$PLUGINSDIR\custom.ini"<br /><br />   WriteINIStr "$PLUGINSDIR\custom.ini" "settings" "numfields" "2"<br />   WriteINIStr "$PLUGINSDIR\custom.ini" "field 1" "type" "text"<br />   WriteINIStr "$PLUGINSDIR\custom.ini" "field 1" "left" "10"<br />   WriteINIStr "$PLUGINSDIR\custom.ini" "field 1" "right" "-10"<br />   WriteINIStr "$PLUGINSDIR\custom.ini" "field 1" "top" "10"<br />   WriteINIStr "$PLUGINSDIR\custom.ini" "field 1" "bottom" "22"<br />   <br />   WriteINIStr "$PLUGINSDIR\custom.ini" "field 2" "type" "checkbox"<br />   WriteINIStr "$PLUGINSDIR\custom.ini" "field 2" "text" "I'm a checkbox"<br />   WriteINIStr "$PLUGINSDIR\custom.ini" "field 2" "left" "10"<br />   WriteINIStr "$PLUGINSDIR\custom.ini" "field 2" "right" "-10"<br />   WriteINIStr "$PLUGINSDIR\custom.ini" "field 2" "top" "30"<br />   WriteINIStr "$PLUGINSDIR\custom.ini" "field 2" "bottom" "42"<br />   WriteINIStr "$PLUGINSDIR\custom.ini" "field 2" "flags" "NOTIFY"<br />FunctionEnd</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sheik</span><br />
      <span class="post-time small text-muted">14th February 2007 01:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I got it working great now!<br />
      Thanks again for all your help!<br />
      <br />
      Scott</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">14th February 2007 08:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">To avoid confusion with $PLUGINSDIR when using ReadINIStr you should use the MUI_INSTALLOPTIONS_READ macro which you only give the INI file name rather than the entire path.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
