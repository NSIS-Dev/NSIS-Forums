<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="nsis and bzip2? you bet! here it is" />

  <title>nsis and bzip2? you bet! here it is - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">nsis and bzip2? you bet! here it is</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=60296">nsis and bzip2? you bet! here it is</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">zedzed23</span><br />
      <span class="post-time small text-muted">18th September 2001 15:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>nsis and bzip2? you bet! here it is</strong><br />
      Hi All,<br />
      <br />
      Well I've hacked up the freely available bzip2 and nsis source codes and married them. Here's the result:<br />
      <br />
      <a href="http://mentasm.com/~zed/nsis/" target="_blank">http://mentasm.com/~zed/nsis/</a><br />
      <br />
      Note, the code currently tries ALL NINE different blocksizes (0..9) and picks the best one. This means compression time is VERY long, but decompression isn't affected.<br />
      <br />
      On my installer, I saved about 40k, but it will vary with different filetypes, let me know how you go.<br />
      <br />
      --zz</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">prodangle</span><br />
      <span class="post-time small text-muted">18th September 2001 17:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">looks like a good idea - but it didn't work for me :)<br />
      <br />
      <font face="courier new"><br />
      RegDLL/UnRegDLL: support for RegDLL not compiled in (NSIS_SUPPORT_ACTIVEXREG)<br />
      Error in script "colourificator_full.nsi" on line 58 -- aborting creation proces<br />
      s</font></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Kreft</span><br />
      <span class="post-time small text-muted">18th September 2001 18:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>uh...</strong><br />
      it worked fine for me i just made a batch file to compile the script to the new exe but wasnt the point to come up with a smaller installer? mine went from 228,000 bytes to 233,584 bytes, maybe you should look into a better compression format like ACE 2.0 or the now in development 7Z format (<a href="http://www.7-zip.com/" target="_blank">Found Here</a>) both seem to perform way better than zip in most all situations...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Kreft</span><br />
      <span class="post-time small text-muted">18th September 2001 18:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>strike that</strong><br />
      not only was the installer larger but it wont run, CRC invalid, but at least it compiled right ;) :eek:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">prodangle</span><br />
      <span class="post-time small text-muted">18th September 2001 20:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Re: uh...</strong><br /></p>

      <blockquote>
        <i>Originally posted by Kreft</i><br />
        <b>it worked fine for me i just made a batch file to compile the script to the new exe but wasnt the point to come up with a smaller installer? mine went from 228,000 bytes to 233,584 bytes, maybe you should look into a better compression format like ACE 2.0 or the now in development 7Z format (<a href="http://www.7-zip.com/" target="_blank">Found Here</a>) both seem to perform way better than zip in most all situations...</b>
      </blockquote>bzip2 is used 'cos it's free. Im pretty sure .ace isnt, and although Ive never heard of 7Z Ill assume it's not free either
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">prodangle</span><br />
      <span class="post-time small text-muted">18th September 2001 20:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Re: strike that</strong><br /></p>

      <blockquote>
        <i>Originally posted by Kreft</i><br />
        <b>not only was the installer larger but it wont run, CRC invalid, but at least it compiled right ;) :eek:</b>
      </blockquote>Sorry, I should've got all this said in one post, but the download page says<br />
      <br />
      <font face="courier new">You must put CRCCheck off in your script for this to work</font>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Kreft</span><br />
      <span class="post-time small text-muted">19th September 2001 00:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">my bad on the crc check, i understand free, but why bother if the results are not a head above what already exists? :confused:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">prodangle</span><br />
      <span class="post-time small text-muted">19th September 2001 06:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">differant files compress differantly. In <b>most</b> cases this will be better compression than normal, but not always. A lot of people will get better results with this. Just as there will be files which ZIP better than they ACE, but in the majority of cases ACE works out better.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">zedzed23</span><br />
      <span class="post-time small text-muted">19th September 2001 07:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The results you get will vary, but generally they will be better! As I said, my installer came out 40kb smaller. The problem is that bzip2 doesn't like small files. In a perfect world, nsis would merge small files so that they can be compressed more efficiently.<br />
      <br />
      I think you'll generally come out infront with installers of 0.5meg+ and with large files inside.<br />
      <br />
      Ace compression would be good to use, but it's not free. I'd really like to use UPX's algorithm, but that's not released either, unless I can come up with some hack that uses the released upx.exe and then strips the exe header. I beleive UPX's uncompress code is available.<br />
      <br />
      Also, you'll find that bzip2 does ALOT better than zlib when it comes to large text files.<br />
      <br />
      --zz.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Kreft</span><br />
      <span class="post-time small text-muted">19th September 2001 15:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>suggestion</strong><br />
      i dont know how feasible this would be but you could since the compress time is already long make it compare zlib compression also and do the best out of all of the bzip2 and zlib compressions, may be a bit more work but theoreticly you would end up with the best that free can give you ;)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DuaneJeffers</span><br />
      <span class="post-time small text-muted">19th September 2001 22:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, the bzip2 would be a good idea if you don't mind ruining your apps. Zed, you have to realize that the marrage between the 2 is and was not a good idea. Not many people care if their installer was to big, because that makes it better for CD and not an internet download. Now (I'm probably sure about this, but I could be wrong) If an internet download was necessary (Like Winamp) Then I would think about using the Bzip2 product. But if I did I would use it's own compression then AFTER I have made the installer. It is hard to explain, but here is an analogy for you, The only reason WinZip doesn't use any other Huge Compressor is because of 2 things. 1) They don't want to ruin their customer's product/Zip file and 2) They don't want to wait for it to finish. I think you did a great job on the coding and the compression, but if one wanted to use it I would tack on a "USE AT YOUR OWN RISK"<br />
      <br />
      -Duane<br />
      p.s. I'm sorry if it sounds like jibberish, but I'm on a MAC!!!!!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">prodangle</span><br />
      <span class="post-time small text-muted">20th September 2001 01:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by DuaneJeffers</i><br />
        <b>Well, the bzip2 would be a good idea if you don't mind ruining your apps. Zed, you have to realize that the marrage between the 2 is and was not a good idea. Not many people care if their installer was to big, because that makes it better for CD and not an internet download. .....-Duane<br />
        p.s. I'm sorry if it sounds like jibberish, but I'm on a MAC!!!!!</b>
      </blockquote>Eh, sorry duane, but isn't the whole point in using NSIS to make small installers, at least that's the best thing about it for most users Im sure. And isn't the #1 way of distributing software over the net? OK, I can maybe see why you might be worried about not being able to have a CRC check in this version so yer files might get trojaned or something and users'll think there fine, but apart from that I think bzip2 is a bloody good idea and if your careful and do your own virus checking your files should be fine. Taking longer to compress isn't a worry either, it only ever needs to be done once, so why is taking longer a worry? As for the use at your own risk, that's kind of a given when using any kind of free software anyway - Justin's NSIS ain't bug free either. (2 fixes only since 1.44: 'Fixed a bug in ui.c which could potentially cause problems.<br />
      Fixed a bug in MoveFileOnReboot (thanks to Francis Irving)')
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DuaneJeffers</span><br />
      <span class="post-time small text-muted">20th September 2001 02:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">But if you are like me, I use small files, I mean small. Then this will not work for me. But I can see your reasoning. I might have some use for it later on, but I believe NSIS was created to have a great installer that can very at times AND have a small header file. Then when downloading a file, you only download a small installer and then the binaries (relitevely speaking). Plus the zlib compression is widely used by many companies including the ones who make WinZip, PowerArchiver and Microsoft has a ME version for unziping zip files using a varient of zlib compression. Now don't get me wrong, but smaller exes would be great, but it will not happen for very long. Once compression will hit hard drives, that will be the day when we see a difference in EXE sizes. It (like I said before) is hard to explain, but it will not happen any time soon.<br />
      <br />
      -Duane</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">zedzed23</span><br />
      <span class="post-time small text-muted">20th September 2001 06:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry DuaneJeffers, but I don't understand a single point you're trying to make. Bzip2 is not a HUGE compressor. The decompression code came out only a few kb larger than the zlib one, and most of this was because I didn't remove all the dead code in there. With a bit of tweaking it would come out roughly the same.<br />
      <br />
      How can you ruin your installers? Are you referring to the CRC check? The only reason the crc check doesn't work is because I temporarily commented it out. This was because it's in the zlib code. A crc check can be re-added without much trouble. Are you trying to say that bzip2 may be unreliable/buggy? I beleive they've tested it on many gigabytes of data.<br />
      <br />
      Why does it make it better to use zlib for CD? Do you realize the decompression code is embedded in the installer executable itself?<br />
      <br />
      Kreft: Your idea is ok, but then you'll have to put both bzip2 and zlib decompression code in the exehead. So you might loose out overall.<br />
      <br />
      --zz</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">muz</span><br />
      <span class="post-time small text-muted">20th September 2001 14:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">umm 7Z format is free under LGPL i believe if you go to the page it tells you that.. <a href="http://www.7-zip.org/" target="_blank">http://www.7-zip.org/</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Kreft</span><br />
      <span class="post-time small text-muted">20th September 2001 15:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>i thought so</strong><br />
      i thought i saw that it was free thats why i mentioned it, and about having to have both decompressors in the header... why cant you upon deciding which compression works best for the fileset then decide which decompressor to write to the header, i understand you may have to rewrite the order of some events but the outcome could be worth the effort, especially if you threw in 7Z format also, then you could simple have a command in the script (or command line) to use whichever compressor you want or 'best' where it would decide for you. just a thought but if you implement is smoothly bugfree and with crc checking i think you would have a winner.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">zedzed23</span><br />
      <span class="post-time small text-muted">21st September 2001 08:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The problem with 7z is that it's in C++, and C++ is ummm bad.<br />
      <br />
      Here's another one I'm playing with:<br />
      <br />
      <a href="http://mentasm.com/~zed/nsis/makensis_Zzip.exe" target="_blank">http://mentasm.com/~zed/nsis/makensis_Zzip.exe</a><br />
      <br />
      you can guess it uses Zzip compression and seems to beat both bzip2/zlib quiet easily. It's right up there with ACE when it comes to binaries. I also compiled it with the crc check and activex-regdll support this time.<br />
      <br />
      Disadvatanges:<br />
      - slower decompression (can't you wait 2 seconds instead of 1?)<br />
      - high memory usage (could be fixed with some work)<br />
      <br />
      My installer came out 104kb smaller than with zlib.<br />
      <br />
      --pz</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">prodangle</span><br />
      <span class="post-time small text-muted">21st September 2001 16:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Excellant - worked flawlessly and knocked 80k straight off the size of my installer, and I feel much more comfortable with it using CRC check. The disadvantages don't trouble me at all.<br />
      <br />
      Im well impressed - thanks a lot<br />
      <br />
      <br />
      :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Kreft</span><br />
      <span class="post-time small text-muted">21st September 2001 21:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>better</strong><br />
      this saved me 1k on one installer and cost me 2k on another, but that is better than bzip2 was doin me...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">eries</span><br />
      <span class="post-time small text-muted">16th October 2001 18:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>source?</strong><br />
      Could you make the source to the bzip2 and zzip NSIS versions available? thanks!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
