<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="CopyFiles [size_of_files_in_kb]" />

  <title>CopyFiles [size_of_files_in_kb] - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">CopyFiles [size_of_files_in_kb]</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=327680">CopyFiles [size_of_files_in_kb]</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dcbrewster</span><br />
      <span class="post-time small text-muted">21st February 2011 21:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>CopyFiles [size_of_files_in_kb]</strong><br />
      Compilation Problem - not execution problem.<br />
      <br />
      I cannot get the CopyFiles command to accept the optional parameter of [size_of_files_in_kb]. I have tried every combination of syntax that I can think of but no go. When I replace the "${DIRSIZE}" variable on the command line with a value such as 100 or "100", the compile works fine.<br />
      <br />
      Any suggestions?<br />
      <br />
      <br />
      <br />
      Script Extract<br />
      <br />
      Function .onInit<br />
      ${GetSize} "$EXEDIR\corrected" "/S=1K" $0 $1 $2 ;Get Directory Size<br />
      !define DIRSIZE $0 ;Save Directory Size<br />
      MessageBox MB_OK "Size is ${DIRSIZE} Kb"<br />
      IfErrors 0 End ;Errors?<br />
      MessageBox MB_ICONSTOP "Error:$\n$\nFiles not found." ;Message To User<br />
      Abort ;Abort Installation<br />
      <br />
      End:<br />
      FunctionEnd<br />
      <br />
      Section "MainSection" SEC01<br />
      SetOutPath "$INSTDIR" ;Set/Confirm Destination<br />
      SetOverwrite ON ;Overwrite Files<br />
      CopyFiles /SILENT "$EXEDIR/corrected/*.*" "$INSTDIR" "${DIRSIZE}" ;Copy files<br />
      SectionEnd<br />
      <br />
      <br />
      <br />
      BTW: Looks like the NSIS Help file needs to be corrected.<br />
      NSIS Help File<br />
      [/SILENT] [/FILESONLY] filespec_on_destsys destination_path [size_of_files_in_kb]<br />
      <br />
      <br />
      HM NSIS Editor Prompt<br />
      [/SILENT] [/FILESONLY] source_path destination_path [size_of_files_in_kb]</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">21st February 2011 23:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Can't use runtime commands during Compile time</strong><br />
      Everyone has the same confusion: Variables assigned to defined constants don't do what they expect. In this case you are telling the compiler that the number of KB that will be used for the copy is "$0". That is not a value the compiler can handle. You need to put the actual size in your source, don't try to do it at runtime, that doesn't work.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dcbrewster</span><br />
      <span class="post-time small text-muted">22nd February 2011 00:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>But, I don't know the size.</strong><br />
      Thanks, but I don't know the size of the files to be copied. The files are outside the installation routine.<br />
      <br />
      The two other copyfiles parameters accept variables but not the third?<br />
      Without the size parameter the Install Directory dialog will show 0 disk requirements.<br />
      I get the proper size via getsize but can't tell the user.<br />
      <br />
      Dave</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">22nd February 2011 06:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It sounds like you are looking for <a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.13.7" target="_blank">SectionSetSize</a>. Make sure you move the .onInit function in your code... the sections have to be declared before you reference the section ids.<br /></p>
      <pre>
<code>Section "MainSection" SEC01<br />SetOutPath "$INSTDIR" ;Set/Confirm Destination<br />SetOverwrite ON ;Overwrite Files<br />CopyFiles /SILENT "$EXEDIR/corrected/*.*" "$INSTDIR" ;Copy files<br />SectionEnd<br /><br />Function .onInit<br />${GetSize} "$EXEDIR\corrected" "/S=1K" $0 $1 $2 ;Get Directory Size<br />SectionSetSize ${SEC01} $0<br />MessageBox MB_OK "Size is $0 Kb"<br />IfErrors 0 End ;Errors?<br />MessageBox MB_ICONSTOP "Error:$\n$\nFiles not found." ;Message To User<br />Abort ;Abort Installation<br />End:<br />FunctionEnd</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dcbrewster</span><br />
      <span class="post-time small text-muted">22nd February 2011 06:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>That Worked</strong><br />
      demiller9,<br />
      <br />
      SectionSetSize did the job. Always more to learn.<br />
      <br />
      Thanks for your help.<br />
      <br />
      Dave</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
