<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Error spawning a command prompt" />

  <title>Error spawning a command prompt - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Error spawning a command prompt</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=326111">Error spawning a command prompt</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">blh83</span><br />
      <span class="post-time small text-muted">18th January 2011 01:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Error spawning a command prompt</strong><br />
      I am seeing some odd behavior when spawning a command prompt from an NSIS installer. Specifically, I am trying to run the following command:<br />
      <br />
      rundll32.exe setupapi.dll,InstallHInfSection DefaultInstall 132 myInf.inf<br />
      <br />
      This will install a filter driver on Windows. If I run this command from a command prompt without using the installer, everything works just fine (it creates the necessary registry entries from the .inf file and copies my .sys file to \Windows\System32\drivers). However, if I try and run this from the installer using something like<br />
      <br />
      nsExec::Exec '"rundll32.exe" setupapi.dll,InstallHInfSection DefaultInstall 132 myInf.inf'<br />
      <br />
      it kind of works. I say 'kind of' because only the registry entries are created but the .sys file is not being copied (and no error is returned). This seems to indicate an error registering the driver even though no error is returned. I have made sure that I am running this command from the directory which contains 'myInf.inf'.<br />
      <br />
      As an experiment, I ran the following:<br />
      <br />
      ReadEnvStr $R0 COMSPEC<br />
      Exec '"$R0" start cmd.exe'<br />
      <br />
      This opens up a command prompt that I can now interact with. If I type the rundll32 command in here directly, I still see the odd behavior that my .sys file is not being copied but no error is being returned. Is there some issue I don't know about when spawning a command prompt from the installer? This is incredibly frustrating and seemingly inexplicable. The fact that my registry entries are being created from the .inf file and no errors are returned, seems to suggest that it should work even though it isn't. Any input is appreciated.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">18th January 2011 01:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try using SetOutPath before the exec call and set it to the directory where your .sys file is.<br />
      <br />
      Also, I don't think this is really the best way to install a driver these days, but without knowing what kind of driver it is I can't really offer a better solution other than trying to read about installing drivers on MSDN and <a href="http://www.osronline.com/showlists.cfm?list=ntdev" target="_blank">http://www.osronline.com/showlists.cfm?list=ntdev</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">blh83</span><br />
      <span class="post-time small text-muted">18th January 2011 16:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for your suggestions Anders. I had tried setting the out path and it didn't help and also have made sure that I have elevated privileges. I have to install the driver this way because it is a filter driver (not a normal device driver) and I am doing it via command line. It may be that I have to write my own dll to call some DIFx functions but was hoping to avoid it.<br />
      <br />
      I just find it very odd that a command line spawned from the installer using Windows "start" function doesn't spawn a command prompt that seems to have full functionality.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
