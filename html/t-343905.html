<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="calling DLL - help needed"><title>calling DLL - help needed - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">calling DLL - help needed</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=343905">calling DLL - help needed</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br><span class="post-time small text-muted">8th April 2012 12:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>calling DLL - help needed</strong><br>&nbsp; I have a code fragment like this<br></p><pre>
<code>StrCpy$0 "removetray"
<br>&gt;StrCpy $1 ""
<br>&gt;StrCpy $2 "" 
</code>
</pre>then a dll-call of "install.dll"<br>
      $1 contains the result<br>
      <br>
      this dll knows what to do. i need a hint to (re)build this call<br>
      <a href="http://nsis.sourceforge.net/Docs/System/System.html" target="_blank">http://nsis.sourceforge.net/Docs/System/System.html</a><br>
      <a href="http://nsis.sourceforge.net/Calling_an_external_DLL_using_the_System.dll_plugin" target="_blank">http://nsis.sourceforge.net/Calling_...tem.dll_plugin</a>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br>
      <span class="post-time small text-muted">8th April 2012 13:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That DLL you are going to call, is it a NSIS plugin-DLL or some other kind of DLL?<br>
      <br>
      If it's a NSIS plug-in DLL, i.e. a DLL that implements the NSIS plug-in API, you would call it simple with a:<br>
      <b>SomePlugin::SomeFunction [Arg_1 Arg_2 ... Arg_N]</b><br>
      <br>
      If it is <b>not</b> a NSIS plug-in DLL, you can still call it by using the NSIS <i>System</i> plug-in. Though this will be more complex!<br>
      <br>
      (The System plug-in has a manual. See 'NSIS\Docs\System\System.html' for details!)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br>
      <span class="post-time small text-muted">8th April 2012 13:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you look closer, you'll see he already linked to the system plugin readme himself. I think he needs help with the system::call syntax.<br>
      <br>
      What is the syntax of the dll function you're trying to call?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br>
      <span class="post-time small text-muted">8th April 2012 14:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">a) no nsis dll - external found. there is an install.exe for 64bit buit 32bit has only the dll<br>
      <br>
      b) i have neither nor a clue - for EXE it would be 'install.exe "removetray"'<br>
      <br>
      and each time i dig in i get more and more confused<br>
      could be like this<br></p>

      <blockquote>
        System::Call 'YourDllName::YourDllFunction(i, *i, t) i(.r0, r1, .r2) .r1'
      </blockquote>but<br>
      YourDllFunction = unknown<br>
      t = unknown<br>
      <br>
      #<br>
      <br>
      i found a "public nsisfunc" which handles the command line parameters, maybe my "YourDllFunction"?
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br>
      <span class="post-time small text-muted">8th April 2012 15:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">1) It will be <font color="DarkRed">impossible</font> to call a Non-NSIS DLL, unless you know the <u>exact</u> definition of the exported function you want to call! Only if you know the exact definition of the function you want to call, preferably in C notation, you may use the System plug-in to call it.<br>
      <br>
      A proper description of a function exported from some DLL looks like this:<br>
      <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms645505%28v=vs.85%29.aspx" target="_blank">http://msdn.microsoft.com/en-us/libr...=vs.85%29.aspx</a><br>
      <br>
      <br>
      2) Just in case you are not aware of this yet: It is NOT possible to call any 64-Bit DLL's from NSIS. That's NOT a limitation of NSIS, but a limitation of the operating systems. 32-Bit processes can't load/use 64-Bit DLL's. There is NO way around that.<br>
      <br>
      (Creating 64-Bit <i>processes</i> from a 32-Bit process works perfectly fine though)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br>
      <span class="post-time small text-muted">8th April 2012 15:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">2) i mentioned for 64bit an exe-file, same purpos as dll/32bit but exe<br>
      <br>
      1) i work on this ;)<br>
      <br>
      i created some code with the system plugin and the result here is, that the install.dll must be called directly<br>
      RegisterDLL $PLUGINSDIR\System.dll Call 0<br>
      RegisterDLL $PLUGINSDIR\install.dll nsisfunc 0<br>
      <br>
      so the next questzion - again: what ist YourDllName::YourDllFunction<br></p>

      <blockquote>
        System::Call 'install::nsisfunc(i, *i, t) i(.r0) .r1'
      </blockquote>returns "1" with correct parameter in $0<br>
      other tests returned "-1"<br>
      <br>
      install.dll is extracted on runtime, not as a plugin
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br>
      <span class="post-time small text-muted">8th April 2012 15:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That "install.dll", is that a DLL you created yourself or is it some 3rd-party DLL ???<br>
      <br>
      (1) If it's your own DLL, then please show us some code. The code (C/C++) inside the DLL you want to call!<br>
      <br>
      (2) If it's a 3rd-party DLL, then please show as the <i>API specification</i> provided by whoever created the DLL.<br>
      <br>
      <b>Note:</b> If that is a 3rd-party DLL, but <i>no</i> API specification is publicly available, forget about calling it from NSIS!</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br>
      <span class="post-time small text-muted">8th April 2012 18:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">that is some of the main problem - 3rd party and no doc.<br>
      its used to install a printer driver - and its older and noone available for support (gave up).<br>
      <br>
      the other solution is to wrap that installation with my code and files - quick and dirty.<br>
      the major problem around is that the installer creates a failure message - but install<br>
      files correctly and need reboot. i can uninstall all files without a reboot but i dont have<br>
      knowledge how to install this driver so i try the original routines.<br>
      <br>
      oh, this is suprising<br></p>
      <pre>
<code>  StrCpy$0 "in"
<br> StrCpy $1 ""
<br> StrCpy $2 ""
<br> install::nsisfunc 'install::nsisfunc(i, *i, t) i(.r0, r1, .r2) .r1' 
<br> Messagebox mb_ok "install1: '$0' '$1' '$2'"
<br><br> StrCpy $0 "in"
<br> StrCpy $1 ""
<br> StrCpy $2 ""
<br> install::nsisfunc '(i, *i, t) i(.r0, r1, .r2) .r1' 
<br> Messagebox mb_ok "install2: '$0' '$1' '$2'" 
</code>
</pre>both return same (error) message as i know similar from the installer.<br>
      but i had to copy the dll to nsis plugins, strange
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br>
      <span class="post-time small text-muted">8th April 2012 19:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Brummelchen</small><br>
        that is some of the main problem - 3rd party and no doc.
      </blockquote>Then this is a lost case. Unless are able to <i>reverse engineer</i> the existing DLL :rolleyes:<br>
      <br>
      Currently you are calling a function names "nsisfunc" from the DLL "install.dll". Does that DLL really export a function of that name?<br>
      <br>
      Also you are using this function like <b><font face="Lucida Console">nsisfunc(int X, int *Y, char* Z)</font></b>. Is that how the function is defined?<br>
      <br>
      If so, how do you know that the function is defined like this? You said no Docs are available for the DLL, so where is that info from?<br>
      <br>
      <font size="3"><b>[EDIT]</b></font><br>
      <br>
      Sorry, my first comment was wrong.<br>
      <br>
      Now I noticed that you are <i>not</i> calling the DLL via System plug-in. You calling it as if it was a NSIS plug-in DLL.<br>
      <br>
      And you are passing a single String argument to it, which appears to be formated in a System-plugin-like syntax :eek:<br>
      <br>
      Previously you said that your DLL is <b>not</b> a NSIS plug-in DLL. So you are contradicting yourself. I give up...
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br>
      <span class="post-time small text-muted">8th April 2012 22:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">reverse engineering aint really possible - its possible to showup assembler but not the source code.<br>
      "nsisfunc" is given by the installer made in nsis - and there is a name in this file.<br></p>

      <blockquote>
        RegisterDLL $PLUGINSDIR\install.dll nsisfunc 0
      </blockquote>nsis code aint possible to reverse too, creates some crap, only hints.<br>
      i can only rewrite it from my experience and investigations with google and nsis wiki.<br>
      <br>
      so i put some code with system-plugin and reversed that file to compare if i am wrong.<br>
      first i was wrong but the structur of any plugin dll is close to dllname::command so i<br>
      tried install.dll as a plugin. it works this way but i still think it was not written for this purpose.<br>
      <br>
      easter is close to end and my spare time too. keep fingers crossed.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br>
      <span class="post-time small text-muted">9th April 2012 00:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The 'RegisterDLL' command is used to register COM DLL's. That's yet another completely different thing :rolleyes:</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br>
      <span class="post-time small text-muted">9th April 2012 13:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">maybe - but its the reversed command from any nsis package using dll:function<br>
      its not documented in the online help</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>