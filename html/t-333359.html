<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Moves all directories only" />

  <title>Moves all directories only - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Moves all directories only</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=333359">Moves all directories only</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">yoachan</span><br />
      <span class="post-time small text-muted">9th August 2011 03:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Moves all directories only</strong><br />
      Dear all,<br />
      <br />
      One of our department made a software, and we create an NSIS installer.<br />
      But due to some issue with Windows Vista and 7, they decided to move all data directories from "Program Files" to "Shared Documents". It won't be a big issue for a new installation.<br />
      But if somehow our client have already installed previous version of our software, we need to have an installer that will move all data directories from "Program Files" to "Shared Documents" while leaving all non directories in "Program Files".<br />
      <br />
      Is there any way for me to do this?<br />
      <br />
      I don't think either "CopyFiles" or "MoveFolder" able to tell which is directory and which is a regular file.....<br />
      <br />
      edit: /FILESONLY "CopyFiles" can copy file only... but still doesn't fit my need... :(<br />
      <br />
      any help appreciated.<br />
      <br />
      regards,<br />
      <br />
      Yoachan</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">9th August 2011 05:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's all in the manual:<br />
      <a href="http://nsis.sourceforge.net/Docs/AppendixE.html#E.1.2" target="_blank">http://nsis.sourceforge.net/Docs/AppendixE.html#E.1.2</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br />
      <span class="post-time small text-muted">9th August 2011 11:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Anyway, installing program files to "Shared Documents" generally is a bad idea! :stare:<br />
      <br />
      There is a reason why program files usually are installed to "Program Files" folder and why that folder has special protection.<br />
      <br />
      NSIS does deal properly with UAC on Vista/Win7 systems. Just use "RequestExecutionLevel admin" or use the nice UAC plug-in.<br />
      <br />
      If your software doesn't work with UAC, then it's time to fix that software. Vista is on the marked for almost 5 years now.<br />
      <br />
      (Undermining the operating system's security mechanisms is not a good advertisement for your product, I think)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">9th August 2011 21:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">An app's binary files should go into $PROGRAMFILES. Configuration files on the other hand should go into $APPDATA or $LOCALAPPDATA.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br />
      <span class="post-time small text-muted">9th August 2011 22:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Maybe I misunderstood his post :igor:<br />
      <br />
      If he indeed is moving <i>user data</i> (configuration files) from $PROGRAMFILES to $APPDATA, then it's the correct thing to do, of course.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">10th August 2011 06:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well no, that's not what he said. That's just a general statement on my part. :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">yoachan</span><br />
      <span class="post-time small text-muted">10th August 2011 07:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">@All: Thanks for your replies :)<br />
      <br /></p>

      <blockquote>
        <small>Originally posted by MSG</small><br />
        It's all in the manual:<br />
        <a href="http://nsis.sourceforge.net/Docs/AppendixE.html#E.1.2" target="_blank">http://nsis.sourceforge.net/Docs/AppendixE.html#E.1.2</a>
      </blockquote>Yes, I've never thought about creating list that way. Thank you for your help :)<br />
      <br />

      <blockquote>
        <small>Originally posted by LoRd_MuldeR</small><br />
        Anyway, installing program files to "Shared Documents" generally is a bad idea! :stare:<br />
        <br />
        There is a reason why program files usually are installed to "Program Files" folder and why that folder has special protection.<br />
        <br />
        NSIS does deal properly with UAC on Vista/Win7 systems. Just use "RequestExecutionLevel admin" or use the nice UAC plug-in.<br />
        <br />
        If your software doesn't work with UAC, then it's time to fix that software. Vista is on the marked for almost 5 years now.<br />
        <br />
        (Undermining the operating system's security mechanisms is not a good advertisement for your product, I think)
      </blockquote>True :)<br />
      <br />

      <blockquote>
        <small>Originally posted by MSG</small><br />
        An app's binary files should go into $PROGRAMFILES. Configuration files on the other hand should go into $APPDATA or $LOCALAPPDATA.
      </blockquote>True :)<br />
      <br />

      <blockquote>
        <small>Originally posted by LoRd_MuldeR</small><br />
        Maybe I misunderstood his post :igor:<br />
        <br />
        If he indeed is moving <i>user data</i> (configuration files) from $PROGRAMFILES to $APPDATA, then it's the correct thing to do, of course.
      </blockquote>True :)<br />
      <br />

      <blockquote>
        <small>Originally posted by MSG</small><br />
        Well no, that's not what he said. That's just a general statement on my part. :)
      </blockquote>True :)<br />
      <br />
      well, basically I only need to move data directories out of Program Files while leaving the program's binary and executable(s) in Program Files. That's why what I need to move is only directories, and I should leave all files that scattered in InstallDir for that will be program related - non data - files.<br />
      <br />
      regards,<br />
      <br />
      YoChan
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br />
      <span class="post-time small text-muted">10th August 2011 20:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Have look at:<br />
      <a href="http://msdn.microsoft.com/en-us/library/bb762164%28v=vs.85%29.aspx" target="_blank">http://msdn.microsoft.com/en-us/libr...=vs.85%29.aspx</a><br />
      <br />
      And:<br />
      <a href="http://msdn.microsoft.com/en-us/library/bb759795%28v=vs.85%29.aspx" target="_blank">http://msdn.microsoft.com/en-us/libr...=vs.85%29.aspx</a><br />
      <br />
      If there is no NSIS plug-in for SHFileOperation, it should be trivial to create one (with some C experience).<br />
      <br />
      Otherwise the System plugin-in may give you access to that function...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br />
      <span class="post-time small text-muted">12th August 2011 13:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've hacked something together, that should do the job:<br /></p>
      <pre>
<code><br />Section<br />    #extract some dummy files<br />    InitPluginsDir<br />    SetOutPath "$PLUGINSDIR\TestDirA"<br />    File "${NSISDIR}\Contrib\Graphics\Checks\*.*"<br /><br />    #move the directory<br />    push "$PLUGINSDIR\TestDirA"          #from<br />    push "$PLUGINSDIR\Foobar\TestDirB"   #to<br />    push $HWNDPARENT                     #hwnd<br />    StdUtils::SHFileMove /NOUNLOAD<br />    pop $0                               #result (OK/ABORTED/ERROR)<br />    DetailPrint "SHFileMove: $0" <br />    <br />    #see the result<br />    ExecShell "explore" "$PLUGINSDIR"<br />SectionEnd</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br />
      <span class="post-time small text-muted">12th August 2011 17:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Update. Highly recommended (bugfixes). Now ANSI <i>and</i> Unicode versions and also with Example+Include files.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br />
      <span class="post-time small text-muted">13th August 2011 17:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yet another update. Now complete package, including source.<br />
      <br />
      <b>Wiki page:</b><br />
      <a href="http://nsis.sourceforge.net/StdUtils_plug-in" target="_blank">http://nsis.sourceforge.net/StdUtils_plug-in</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br />
      <span class="post-time small text-muted">14th August 2011 14:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This is a bugfix release:<br />
      <br />
      Demo should now run through under Win2k. Also added "verbose" mode.<br />
      <br />
      <b>Wiki page:</b><br />
      <a href="http://nsis.sourceforge.net/StdUtils_plug-in" target="_blank">http://nsis.sourceforge.net/StdUtils_plug-in</a></p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
