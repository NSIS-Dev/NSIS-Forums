<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="ExecWait failing 10% of the time" />

  <title>ExecWait failing 10% of the time - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">ExecWait failing 10% of the time</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=283356">ExecWait failing 10% of the time</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">fifthnormal</span><br />
      <span class="post-time small text-muted">18th December 2007 03:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>ExecWait failing 10% of the time</strong><br />
      Hi,<br />
      <br />
      I have an installer that's executed about 1000 times per day.<br />
      <br />
      I bundle three sub installers within the main installer, kind of like this:<br />
      <br />
      MainInstall.exe<br />
      --SubInstall1.exe<br />
      --SubInstall2.exe<br />
      --SubInstall3.exe<br />
      <br />
      My script uses NSISdl to log data to my web server so that I know how many times the installer is run.<br />
      <br />
      I send a log message from within MainInstall.exe right before I call ExecWait SubInstall1.exe.<br />
      <br />
      Then when SubInstall1.exe runs it uses NSISdl to log to the web server that it started running.<br />
      <br />
      The logs show that ~10% of the time MainInstall.exe launches SubInstall1.exe, but SubInstall1.exe doesn't log that it started up.<br />
      <br />
      I'm curious if anyone knew of any reasons that this might be occurring.<br />
      <br />
      Thanks in advance,<br />
      <br />
      Daniel</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pospec</span><br />
      <span class="post-time small text-muted">18th December 2007 06:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Daniel, it seems that my installers has similar problems with ExecWait instruction.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">18th December 2007 19:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Are you sure it's not just some packet loss or firewall blocking the request? Can you really be sure SubInstall1.exe hasn't been executed?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">fifthnormal</span><br />
      <span class="post-time small text-muted">18th December 2007 19:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>not a firewall issue</strong><br />
      Hi kichik,<br />
      <br />
      I can rule out a firewall issue since we are logging so much data through the install. All of it is being logged correctly in other parts of the installer. So, this should rule out the firewall as an issue.<br />
      <br />
      I suppose a packet loss might be a possible issue. However since it is being run across almost 1000 computers per day I would expect the packet loss to be a much smaller percentage.<br />
      <br />
      Also, each SubInstaller contains other logging by third-party vendors which correspond with our data.<br />
      <br />
      Here are the relevant lines of code from the Main Installer. Note that I changed the url.<br />
      <br />
      #Install the Weather Partner - Begin<br />
      NSISdl::download "http://base.fakeurl.com/logImage.php?t=8&amp;c=6&amp;a=8&amp;b=0&amp;display=0&amp;e=Main%20Install%20Weather%20Start" $INSTDIR\logging<br />
      <br />
      ExecWait '"$INSTDIR\weather_install.exe"'<br />
      <br />
      NSISdl::download "http://base.fakeurl.com/logImage.php?t=8&amp;c=6&amp;a=8&amp;b=0&amp;display=0&amp;e=Main%20Install%20Weather%20Finish" $INSTDIR\logging<br />
      #Install the Weather Partner - End<br />
      <br />
      This actually launches the weather.com installer that you helped me with a few weeks ago.<br />
      <br />
      Thanks for any help!<br />
      <br />
      Daniel</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">18th December 2007 21:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Are you sure all of the installers use the same download method? Maybe some methods have different proxy detections than others. What do the other installers use?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">fifthnormal</span><br />
      <span class="post-time small text-muted">18th December 2007 23:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi kichik,<br />
      <br />
      Yes they all use the same code. Here is the code from the weather_install.exe nsis installer:<br />
      <br />
      Function .onInit<br />
      <br />
      InitPluginsDir<br />
      <br />
      NSISdl::download "http://base.fakeurl.com/logImage.php?t=8&amp;c=6&amp;a=8&amp;b=0&amp;display=0&amp;e=Weather%20Install%20Initializing" $INSTDIR\logging<br />
      <br />
      <br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">19th December 2007 19:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If it's constantly just SubInstall1.exe, I have no other suggestions but a bug in its .onInit.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">19th December 2007 21:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">My first thought here is what is $INSTDIR set to?<br />
      If the folder does not exist then NSISdl would fail in theory.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">fifthnormal</span><br />
      <span class="post-time small text-muted">20th December 2007 05:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Afrow UK,<br />
      <br />
      I've done some more testing and can replicate it now in the lab. This has turned out to be an issue with the NSISdl rather than ExecWait. The SubInstall1.exe was running, but the logging within the onInit was not occurring 10% of the time.<br />
      <br />
      This was actually due to a bug in my script. In some cases the $INSTDIR does not exist at the time the SubInstall1.exe initializes. Thus causing the initialize logging to not happen. Later on in the default section this folder is automatically created, which causes the logging to start working.<br />
      <br />
      We'll deploy the installer and monitor it for a couple days. I'm anticipating that this fixes the issue though.<br />
      <br />
      Thanks for the help!<br />
      <br />
      Daniel</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
