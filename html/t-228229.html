<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Open port on XP firewall" />

  <title>Open port on XP firewall - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Open port on XP firewall</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=228229">Open port on XP firewall</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">fabiochelly</span><br />
      <span class="post-time small text-muted">12th October 2005 09:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Open port on XP firewall</strong><br />
      Hi,<br />
      <br />
      How can I check if the XP Firewall is enabled and if a port is open?<br />
      <br />
      And if it is not, is it possible to open it from my NSIS script?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">12th October 2005 10:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well it is possible to open a port on the XP firewall(SP21 AND SP2!) , it took me three months to figure it out, and i'm quite experienced in programming. I will not give you any code since this can be mis-used also. So, it IS possible without user intervention to open a port via client software. A NSIS plugin could be created since it involves a LOT of low level stuff. So if you really want it you know you can have success, maybe tht is good motivation.<br />
      <br />
      My advise is however you should refrase your question and tell us what you want to achieve, it is possible that there is a better way... because the path you want to walk no will be loooong an difficult.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Lel</span><br />
      <span class="post-time small text-muted">7th July 2006 11:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Open port on XP firewall</strong><br />
      and what if I want to ask the user to open the port during install time, and without launching my app?<br />
      thanks</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comperio</span><br />
      <span class="post-time small text-muted">8th July 2006 01:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try this and see if it helps:<br />
      <a href="http://support.microsoft.com/default.aspx?kbid=875357" target="_blank">http://support.microsoft.com/default.aspx?kbid=875357</a><br />
      <br />
      Toward the bottom of the article, it describes a command line tool called NetSh that you might be able to take advantage of. However, it will require that your installation is run under and administrator account.<br />
      <br />
      The one problem I see is that the Windows firewall is only one of many available firewall products available to users. Seems to me it would be better to address these issues from within the application (not the installation). But that's just my opinion.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br />
      <span class="post-time small text-muted">8th July 2006 11:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">it would be too easy for malware to open any port in windows firewall - lol<br />
      but if it works - lmao - but windows firewall ist the worst firewall you can use - all leaktests passed this crap wall</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">8th July 2006 16:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">A lot of open source p2p apps can open ports in the xp firewall so not showing the code bcuz of security is wrong IMHO</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">9th July 2006 10:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I know, and if a lot of open source p2p apps do this, why not use that code as example then? I think I'm still entitled not to show my code since IMHO it can be used to disadvantage by some others.<br />
      <br />
      Do not forget a customer has a firewall for a reason: to prevent mis-use.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">QuaKx</span><br />
      <span class="post-time small text-muted">13th July 2006 10:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">IMHO: If you don't have anything to say: <b>Don't.</b><br />
      This took me 30 min to create. And I seems to work fine.<br />
      <br />
      Hope it helps!<br />
      <br />
      <font size="1"><br />
      Function OpenFWPort<br />
      Var /global PORT<br />
      <br />
      Push $0<br />
      StrCpy $PORT "80"<br />
      FileOpen $0 '$TEMP\OpenFWPort.vbs' w<br />
      <br />
      FileWrite $0 "Option Explicit$\n"<br />
      FileWrite $0 "On Error GoTo 0$\n"<br />
      FileWrite $0 "'Set Constants$\n"<br />
      FileWrite $0 "Const NET_FW_IP_PROTOCOL_UDP = 17$\n"<br />
      FileWrite $0 "Const NET_FW_IP_PROTOCOL_TCP = 6$\n"<br />
      FileWrite $0 "Const NET_FW_SCOPE_ALL = 0$\n"<br />
      FileWrite $0 "Const NET_FW_SCOPE_LOCAL_SUBNET = 1$\n"<br />
      <br />
      FileWrite $0 "'Declare variables$\n"<br />
      FileWrite $0 "Dim errornum$\n"<br />
      FileWrite $0 "'Create the firewall manager object.$\n"<br />
      FileWrite $0 "Dim fwMgr$\n"<br />
      FileWrite $0 "Set fwMgr = CreateObject($\"HNetCfg.FwMgr$\")$\n"<br />
      <br />
      FileWrite $0 "'Get the current profile for the local firewall policy.$\n"<br />
      FileWrite $0 "Dim profile$\n"<br />
      FileWrite $0 "Dim port$\n"<br />
      FileWrite $0 "Set profile = fwMgr.LocalPolicy.CurrentProfile$\n"<br />
      FileWrite $0 "Set port = CreateObject($\"HNetCfg.FWOpenPort$\")$\n"<br />
      FileWrite $0 "port.Name = $\"${_PRODUCT}$\"$\n"<br />
      FileWrite $0 "port.Protocol = NET_FW_IP_PROTOCOL_TCP$\n"<br />
      FileWrite $0 "port.Port = $PORT$\n"<br />
      <br />
      FileWrite $0 "'If using Scope, don't use RemoteAddresses$\n"<br />
      FileWrite $0 "port.Scope = NET_FW_SCOPE_ALL$\n"<br />
      FileWrite $0 "'Use this line to scope the port to Local Subnet only$\n"<br />
      FileWrite $0 "'port.Scope = NET_FW_SCOPE_LOCAL_SUBNET$\n"<br />
      FileWrite $0 "port.Enabled = TRUE$\n"<br />
      <br />
      FileWrite $0 "On Error Resume Next$\n"<br />
      FileWrite $0 "profile.GloballyOpenPorts.Add port$\n"<br />
      FileWrite $0 "errornum = E******mber$\n"<br />
      FileWrite $0 "If errornum &lt;&gt; 0 Then$\n"<br />
      FileWrite $0 " WScript.Echo($\"Adding the port failed. Error Number: $\" &amp; errornum)$\n"<br />
      FileWrite $0 "End If$\n"<br />
      <br />
      FileClose $0<br />
      <br />
      DetailPrint 'Opening firewall port $PORT'<br />
      nsExec::Exec /TIMEOUT=20000 '"$SYSDIR\cscript.exe" "$TEMP\OpenFWPort.vbs"'<br />
      Pop $1<br />
      StrCmp $1 '0' OpenPortSucceded<br />
      DetailPrint 'Error $1 in OpenFWPort.vbs'<br />
      Delete "$TEMP\OpenFWPort.vbs"<br />
      Abort 'Failed to open port'<br />
      <br />
      OpenPortSucceded:<br />
      DetailPrint 'Succeded opening port'<br />
      Delete "$TEMP\OpenFWPort.vbs"<br />
      Pop $0<br />
      FunctionEnd<br /></font></p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
