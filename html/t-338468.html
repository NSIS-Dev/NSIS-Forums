<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Conditional Compilation !define" />

  <title>Conditional Compilation !define - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Conditional Compilation !define</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=338468">Conditional Compilation !define</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wurstteppich</span><br />
      <span class="post-time small text-muted">29th November 2011 17:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Conditional Compilation !define</strong><br />
      Hi,<br />
      <br />
      currently we have a software project, which calls the installer compilation after the compilation of the main product. Since we also have customer specific distributions, we use<br /></p>

      <ul>
        <li>/D during compile time to set "changing" definitions, which changes with each built, like product version number</li>

        <li>a settings.nsh, where we set not changing definitions, but specific to this distribution, like branded application names</li>

        <li>a settings_pre.nsh, which containts definitions, which will be common in all distributions, but which should be able to be changable</li>
      </ul><br />
      The .nsh files are loaded in the main .nsh script at the beginning in the following order:<br />
      <br />
      !include "settings_pre.nsh"<br />
      !include "settings.nsh"<br />
      !include "variables.nsh"<br />
      <br />

      <blockquote>
        Originally Posted by <strong>settings.nsh</strong> !define APPNAME "App Name"<br />
        !define APPBINARYNAME "App Binary Name"<br />
        !define APPCONFIGNAME "App Config Name"<br />
        ...<br />
        ...
      </blockquote>The settings.nsh looks like that, but setting the common definitions, however APPCONFIGNAME for example is also in it and should be overwritten in the later loaded settings.nsh, if it exists there.<br />
      <br />
      <br />
      My specific problem is the "already defined" error, if a definition was already set, but maybe changed during compiling the installer or in the settings.nsh.<br />
      <br />
      Therefore the following questions arise:<br />
      <br />
      1) Do the /D commands during compile time overwrite !define in the script?<br />
      2) How can I accomplish that definitions "maybe" loaded by the settings.nsh overwrite definitions in the settings_pre.nsh (you could call it "standard definition file")?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">29th November 2011 19:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>
      <pre>
<code>!ifdef foo<br />  !undef foo<br />!endif<br />!define foo bar</code>
</pre><br />
      <br />
      or you could create a macro for those lines<br />
      <pre>
<code>!macro redefine a b<br />  !ifdef ${a}<br />    !undef ${a}<br />  !endif<br />  !define ${a} `${b}`<br />!macroend<br />!define redefine "!insertmacro redefine"</code>
</pre><br />
      <br />
      and call it like this
      <pre>
<code>${redefine} foo "bar and a half"</code>
</pre>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
