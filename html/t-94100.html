<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content=".onVerifyInstDir help (bug ?!!!)"><title>.onVerifyInstDir help (bug ?!!!) - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">.onVerifyInstDir help (bug ?!!!)</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=94100">.onVerifyInstDir help (bug ?!!!)</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">kont2432</span><br><span class="post-time small text-muted">10th July 2002 22:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>.onVerifyInstDir help (bug ?!!!)</strong><br>Function .onVerifyInstDir<br>StrCpy $4 "a.exe"<br>IfFileExists $INSTDIR\$4 Good<br>MessageBox MB_OK|MB_ICONSTOP "file does not exist"<br>Abort<br>Good:<br>FunctionEnd<br><br>This seems to produce the messagebox twice.<br>Is that a bug ?<br>Is there a work around it ?<br><br>Thank you in advance</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br><span class="post-time small text-muted">11th July 2002 07:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Search the Forum. It has been discussed before. Workaround: use .onNextPage and .onPrevPage to script an alternative .onVerifyInstDir. Use RegCodeNew or MultIni4 (keywords for search, or find them in the NSIS Archive) for example scripts.<br><br>-Hendri.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kont2432</span><br><span class="post-time small text-muted">11th July 2002 08:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Found solution (using counter variable)</strong><br>Thanks for the reply Hendri,<br><br>I did not look at your pointers since I found a<br>work-around for .onVerifyInstDir here it is:<br><br>Function .onVerifyInstDir<br>IntOp $1 $1 + 1 ; increment counter (was init to 0)<br>IntOp $1 $1 % 2 ; possible values of $1 0 and 1<br><br>IfFileExists $INSTDIR\poop.exe skip2<br>IntCmp $1 1 skip2 ; if I compare to 0 then install button is<br>;not disabled (weird !!)<br>MessageBox MB_OK "poop.exe not found $1 times"<br>; display $1 just for testing<br>Abort<br>skip2:<br>FunctionEnd<br><br><br>PS. Is there a place to report the NSIS bugs ?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br><span class="post-time small text-muted">11th July 2002 08:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">See <a href="http://www.clantpa.co.uk/nsis/wiki/" target="_blank">http://www.clantpa.co.uk/nsis/wiki/</a><br>for a bug report place.<br><br>-Hendri.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br><span class="post-time small text-muted">12th July 2002 09:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sorry kont, it does <b>not</b> work. Try this: type in the dirselect box 'c:\p' and the installbutton is activated. Click it and it will be installed. Typing another character leads to a messagebox. Then typing another allows to click install again etc...<br><br>The reason for the two messageboxes in the first place is that the return from "Browse" triggers the .onVerifyInstDir, but also the "EditBox.onChange" (this is done to check dirs when typing something in the editbox). Already a long time ago (I guess in november 2001 :)) I asked if these two routines could be removed and replaced by one: triggering .onVerifyInstDir only at clicking the button "install". This never happened, I already forgot why actually...<br><br>But now we have .onNextPage, we can replicate this behavior and activate an alternative .onVerifyInstdir only when clicking install. The first version of this alternative construction can be found in <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=70530&amp;highlight=regcode" target="_blank">RegCode</a>. Later on this construction has been implemented in <a href="http://www.clantpa.co.uk/nsis/wiki/index.php/MultIni4" target="_blank">MultIni4</a> and using MultIni4 again in <a href="http://www.clantpa.co.uk/nsis/wiki/index.php/RequestUserRegistrationDetails" target="_blank">RegCodeNew</a> (both in the NSIS Archive). MultIni4 allows for an easy integration of custom pages and constructions like the alternative .onVerifyInstDir into your installer. Check the function onPageExit and read the comments how to handle it.<br><br>[edit]<br>Haha :) I found my <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=68242" target="_blank">post</a> about .onVerifyInstDir from the past. It was in October :). Nice to read something from the past. Justin actually never replied. So nothing happened to the behavior of .onVerifyInstDir and no new function .onClickInstall, but that is not necessary anymore thanks to .onNextPage :D.<br>[/edit]<br><br>Good luck,<br>-Hendri.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kont2432</span><br><span class="post-time small text-muted">12th July 2002 22:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I did not have time to look at it yet,<br>but, Thanks for the note Hendri !!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">12th July 2002 22:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">.onVerifyInstDir should be used just to enable the install button.<br><br>From the docs:<br></p><blockquote>This callback enables control over whether or not an installation path is valid for your installer. <b>This code will be called every time the user changes the install directory, so it shouldn't do anything crazy with MessageBox or the likes.</b> If this function calls Abort, the installation path in $INSTDIR is deemed invalid.</blockquote>If you want to let the user know what kind of directory he needs to pick use DirText.<br><br>The problem is that you are using .onVerifyInstDir the wrong way... If you want a message box after the user chose his directory you would have to use .onNextPage like Smile2Me said.<br><br>I will try to fix that two calls to .onVerifyInstDir bug in my next version of NSIS 1.99.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kont2432</span><br><span class="post-time small text-muted">13th July 2002 18:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You are right it does say that in the<br>docs. I guess I did not pay careful<br>attention to that paragraph.<br><br>Thanks you kichik</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>