<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Install var in uninstall" />

  <title>Install var in uninstall - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Install var in uninstall</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=175794">Install var in uninstall</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">toroso</span><br />
      <span class="post-time small text-muted">8th April 2004 08:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Install var in uninstall</strong><br />
      &nbsp; Hi,<br />
      <br />
      I define and use an install-time variable with Var that I use in the installer. Now I would like to use this value also in the uninstaller (with the value that it was given during the install). Is it possible to accomplish this in some way?<br />
      <br />
      Thanks,<br />
      Torbj√∂rn</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">evilO</span><br />
      <span class="post-time small text-muted">8th April 2004 09:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi :)<br />
      <br />
      To achieve that, you'll have to write the value of that variable into an 'ini' file, and read that variable from the uninstaller.<br />
      <br />
      - In the installer:<br /></p>
      <pre>
<code>WriteIniStr"c:\\my_dir\\my_file.ini" "MySection" "MyVarValue" $MyVar 
<br />&gt;
</code>
</pre><br />
      - In the uninstaller:<br />
      <pre>
<code>
ReadINIStr $MyVar "c:\\my_dir\\my_file.ini" "MySection" "MyVarValue" 
</code>
</pre>evilO/Olive
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">toroso</span><br />
      <span class="post-time small text-muted">8th April 2004 09:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks, it works great!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">8th April 2004 13:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Using the registry is faster than using an INI file.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">evilO</span><br />
      <span class="post-time small text-muted">8th April 2004 13:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">True. I guess I'm too used to the 'ini' files as I have plenty of information to store and to retrieve :D..<br />
      Therefore I use the registry a less as possible, let's say the installation directory and the usual "Uninstall" keys...<br />
      <br />
      evilO/Olive</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">garu</span><br />
      <span class="post-time small text-muted">26th November 2004 14:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Install vars in uninstall</strong><br />
      &nbsp; Excuse me, but i tried to do something similar and i hit the classic "cat chasing his tail" problem.<br />
      <br />
      To be short, i'd lke to use the installer to build some dynamic directory structures that based in a common root, may have some common nodes, whose names are depending on some parms entered in a configuration page and dinamically build the related uninstallers that when invoked delete the related structure, starting from the leafs up to the point where the nodes are shared with other structures.<br />
      <br />
      The uninstaller names are dynamically generated depending on parms entered in a configuration page, but given the fact that i cannot pass the installer variables directly into the uninstaller, and i find this a truly bad limitation, i was not able to find any means to link a generated uninstaller with a generated ini file or registry keyword.<br />
      <br />
      I need some dynamic values in the uninstaller, but i cannot read them because i need another dynamic value to point me to the saved ini file or registry keys that contains them.<br />
      <br />
      I tried to use the<br />
      System::Call 'kernel32::GetModuleFileNameA(i 0, t .R0, i 1024) i r1'<br />
      call to get the uninstaller name, to use is as the name of a related ini file, but what i get back is the name with which the uninstaller copies itself into the temporary directory.<br />
      <br />
      Using that returned name, after cutting away the temp dir part, doesn't allow me to even retrieve the original installer to delete it, so it's completely useless.<br />
      <br />
      Do you think there's a way to solve this or i have to abort the idea to use NSIS to perform this job?<br />
      <br />
      Thanks, Gabriele</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">26th November 2004 14:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">$EXEDIR.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">garu</span><br />
      <span class="post-time small text-muted">26th November 2004 15:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Install vars in uninstall</strong><br />
      &nbsp; What exactly do you mean?<br />
      $EXEDIR in a uninstaller returns the<br />
      windows TEMP directory path, in short format.<br />
      What can i do with that?<br />
      <br />
      Gabriele.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">26th November 2004 15:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Oops. It's $INSTDIR or $OUTDIR.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">garu</span><br />
      <span class="post-time small text-muted">29th November 2004 08:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi kichik,<br />
      thanks for you fast response, but from it i guess you didn't understand my problem:)<br />
      I don't want to bother you again with the details, since i found myself a bypass for the problem.<br />
      I write a uninstall.exe and uninstall.ini in a leaf of the generated structure, so that they can be always written with the same name and uninstall.exe is able to find its ini file using a static name instead of a dynamic one.<br />
      Then i write a shortcut to it with the generated name in the common $INSTDIR.<br />
      <br />
      Anyway my perplexities still remain, and since before answering i spent some more time peeking around in this forum, i see i'm not alone.<br />
      <br />
      We can create really powerful and customized self contained installers, using variables, but we cannot pass a bit of these information into uninstaller unless we start polluting registry or filesystem with ini files and making strange contorsions like in my case.<br />
      <br />
      I guess it's not a technical problem, it shouldn't be too difficult to replicate the variable symbol table or whatever you use in your compiler, into the generated uninstaller, but rather a design choice.<br />
      <br />
      If your concerns are about avoiding that users may uninstall something wrong giving them too much power, i can assure you that i work since 26 years in IT, i have worked with almost all OS that have been invented and with almost all the languages that have been conceived and i have seen generations of designers striving to build foolproof products.<br />
      No way, fools are, and will always be, more clever than them and will always find a way to shoot themselves in their feets, no matter what you give in their hands.<br />
      <br />
      So please make all the variables created in the installer available into the uninstaller and give us the power to kill ourselves at our pleasure without too much fatigue:)<br />
      <br />
      Thanks Gabriele.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scrose</span><br />
      <span class="post-time small text-muted">29th November 2004 16:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Gabriele,<br />
      <br />
      Well stated. I agree with you. The uninstaller would become much more robust if it could use the values of variables as declared in the installer. The uninstaller would achieve greater independence, no longer having to necessarily rely on the registry or INI files to restore the values of needed variables.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">30th November 2004 19:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You wanted to get the directory that contained the uninstaller. $INSTDIR contains exactly that.<br />
      <br />
      As for automatically saving all of the variables from the installer in the uninstaller executable, it's very wasteful. You'll add around 30kb (1kb per variable by default). And if you're thinking of compressing it, you'd need to add the compression code to the exehead which will increase both the installer and uninstaller size by a very noticeable amount (not to mention the hard work to get the compression code to lose clib dependency).<br />
      <br />
      If you really want to avoid regitry and INI files, you can always append data to the uninstaller yourself. By default, the CRC checksum stops at the end of the data. You can then read this data using FileRead.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">M-Force</span><br />
      <span class="post-time small text-muted">22nd June 2006 15:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>How to append data to the uninstaller?</strong><br />
      &nbsp; Hi,<br />
      I want to append data to the unistaller in order to reuse the data in the uninstaller which i defined in the installer. I want to avoid creating an ini file or using the registry for storing such data.<br />
      <br />
      My question now is how to do that in detail.<br />
      <br />
      Can somebody help me with that?<br />
      <br />
      M.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">30th June 2006 09:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Use FileOpen, FileSeek, FileWrite and FileClose to write data to the uninstaller file. In the uninstaller, use FileRead to get that data. Note that you'll have to disable CRC check for the uninstaller for this to work. Use CRCCheck to do that.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pospec</span><br />
      <span class="post-time small text-muted">5th October 2007 13:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">At first - I have read <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=249431" target="_blank">http://forums.winamp.com/showthread....hreadid=249431</a> and I know how to append data to the uninstaller.<br />
      <br />
      I was trying to do it myself - posting attachment. Everything was OK until I tried to read from the uninstaller file. FileRead instruction set ErrorFlag and I don't know why.<br />
      <br />
      Any suggestions?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th October 2007 13:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">$EXEDIR is $TEMP in the uninstaller. Use $INSTDIR instead.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pospec</span><br />
      <span class="post-time small text-muted">5th October 2007 13:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Kichik, I know that. I thought that it doesn't matter from which location I read the uninstaller. Is the problem that FileRead can't read from the file in $TEMP because it is executed?<br />
      <br />
      Attaching working script:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th October 2007 13:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It can read itself, but the name is different. So you have to use $EXEPATH instead of $EXEDIR\unDataUninst.exe.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pospec</span><br />
      <span class="post-time small text-muted">5th October 2007 13:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ooops, I forgot this fact. Thank you</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">iceman5007523</span><br />
      <span class="post-time small text-muted">6th December 2007 01:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Potential solution without writing to file or registry. Sample code attached.</strong><br />
      &nbsp; I found this post while trying to get an answer to the same question the original poster had. I was trying to set/save a string value of the path to a folder somewhere other than the install path (e.g. $INSTDIR or $EXEDIR). I figured out a different way to accomplish my goal. The following methodology may work for some of your situations. I know it worked well for mine. I don't know why, but it worked for my application. Sample code is attached as a text file. Overview: Declare a global variable outside/before sections (e.g. Var /GLOBAL FormsFolder). Set the value of the variable (StrCpy $FormsFolder "F:\Main\Branch\Twig\Forms") in the initialization function, an install section (e.g. Section ""), and the uninstall section (i.e. Section "Uninstall").</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>