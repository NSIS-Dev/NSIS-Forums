<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Service Creation Function" />

  <title>Service Creation Function - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Service Creation Function</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=259210">Service Creation Function</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">stonkers</span><br />
      <span class="post-time small text-muted">9th November 2006 17:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Service Creation Function</strong><br />
      The below function, only KIND OF works. It installs the service and puts the user name in there, but you have to re-enter the password in order to start it. Can anyone see what I'm doing wrong?<br />
      <br />
      &lt;!-------------------snip--------------------&gt;<br />
      Function serviceUtility<br />
      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
      ;; Install Service if not installed ;;<br />
      ;; ;;<br />
      ;; Pass to function: ;;<br />
      ;; $R8 - Service Name ;;<br />
      ;; $R7 - Path to executable ;;<br />
      ;; ;;<br />
      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
      <br />
      !insertmacro SERVICE "installed" "$R8" 0<br />
      pop $0<br />
      strCmp $0 'false' createService<br />
      !insertmacro SERVICE "stop" "$R8" 0<br />
      Goto endServiceUtility<br />
      <br />
      createService:<br />
      strCmp $R9 "1" serviceUtility1 ;if we already have userName and password continue to create<br />
      strCpy $R9 1 ;note that we've already gotten the user, password, and computername<br />
      Dialogs::InputBox "UserID" "Please enter service username to run new service as" "OK" "Cancel" "0" ${VAR_R1}<br />
      Dialogs::InputBox "Password" "Please enter the service user password:" "OK" "Cancel" "1" ${VAR_R2}<br />
      serviceUtility1:<br />
      <br />
      nsSCM::Install "$R8" "$R8" 16 2 "$R7" "" "" "$R1" "$R2"<br />
      <br />
      <br />
      endServiceUtility:<br />
      <br />
      FunctionEnd<br />
      &lt;!------------------end snip-----------------&gt;<br />
      <br />
      Thanks Much,<br />
      Eric</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">9th November 2006 17:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try prefixing the user name with .\ as MSDN suggests.</p>

      <blockquote>
        If the service type is SERVICE_WIN32_OWN_PROCESS, use an account name in the form DomainName\UserName. The service process will be logged on as this user. If the account belongs to the built-in domain, you can specify .\UserName.
      </blockquote>It might fail to find the user, show up the dialog which has a better search method for the user, but where the password is already lost.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">stonkers</span><br />
      <span class="post-time small text-muted">9th November 2006 18:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I can't because the user is a domain user rather than local. So it's going to be:<br />
      <br />
      DomainName\UserName<br />
      <br />
      It sets the user up correctly in the service, just seems to fail on the password.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">stonkers</span><br />
      <span class="post-time small text-muted">9th November 2006 18:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK, figured it out. There is no problem with this script. The problem lies in our domain default group policy. The specific user has to be granted logon rights in order to be started with Net Start command. Is there a way to script this in NSIS that anyone knows?</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
