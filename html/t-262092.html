<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Unable to select sections without going to custom install"><title>Unable to select sections without going to custom install - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Unable to select sections without going to custom install</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=262092">Unable to select sections without going to custom install</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">davidnewcomb</span><br><span class="post-time small text-muted">19th December 2006 17:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Unable to select sections without going to custom install</strong><br>I have two sections "Install" and "Extract", and 7 sections.<br>"Extract" has 1 of the sections selected and this simply extracts the payload.<br>"Install" does a number of tests and depending on external conditions selects 1 to 6 of the sections.<br>I want to present the user with "Extract" or "Install". The user will not be able to change any of the sections selected.<br><br>Unfortunately, I keep running into problems. If I use SectionIn to designate which sections are assigned to an Install type, it switches to a 'Custom' Install option as soon as I change any of them. If I set the components page to use /NOCUSTOM then on loading it sets the Install component type to blank which disappears when I select another option.<br><br>I want it to appear with Install and all the required options preselected, so the user can just click next.<br><br>The example below is as close as I can get it :( The type of install is set to blank. When you manually set it to Install it sets the correct options, but this is an extra step which I am trying to get rid of.<br><br>!include Sections.nsh<br>!include MUI.nsh<br><br>Name InstTest<br>OutFile c:\InstText.exe<br>InstallDir C:\Data\QuentinV3<br><br><br>InstType "Install"<br>InstType "Extract"<br>InstType /NOCUSTOM<br><br>!insertmacro MUI_PAGE_COMPONENTS<br><br>Section "Install Java SDK" sec_install_java<br>SectionIn ro 1<br>SectionEnd<br><br>Section "Install MySQL database server" sec_install_mysql<br>SectionIn ro 1<br>SectionEnd<br><br>Section "ISA Manager" sec_install_isa<br>SectionIn ro 1<br>SectionEnd<br><br>Section "Configure Database" sec_config_db<br>SectionIn ro 1<br>SectionEnd<br><br>Section "Update Quantel database" sec_config_update<br>SectionIn ro 1<br>SectionEnd<br><br>Section "Downdate Quantel database" sec_config_downdate<br>SectionIn ro 1<br>SectionEnd<br><br>Section "File Extract Only" sec_extract_only<br>SectionIn ro 2<br>SectionEnd<br><br>Function .onInit<br>!insertmacro ClearSectionInInstType "${sec_install_java}" "${INSTTYPE_1}"<br>!insertmacro ClearSectionInInstType "${sec_config_update}" "${INSTTYPE_1}"<br>!insertmacro SetSectionInInstType "${sec_extract_only}" "${INSTTYPE_2}"<br>FunctionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">19th December 2006 22:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I guess this is what you're looking for :-)<br></p><pre>
<code><font color="blue">!define SF_USELECTED  0<br>!define SF_SELECTED   1<br>!define SF_RO         16<br><br>Name InstTest<br>OutFile 'InstText.exe'<br><br>InstType "Install"<br>InstType "Extract"<br>InstType /NOCUSTOM<br><br>!include MUI.nsh<br><br>!insertmacro MUI_PAGE_COMPONENTS<br>!insertmacro MUI_PAGE_INSTFILES<br><br>!insertmacro MUI_LANGUAGE "English"<br><br>Section "Install Java SDK" SEC_1<br>;;;;;;;;;;;;;;<br>SectionEnd<br><br>Section "Install MySQL database server" SEC_2<br>;;;;;;;;;;;;;;<br>SectionEnd<br><br>Section "ISA Manager" SEC_3<br>;;;;;;;;;;;;;;;<br>SectionEnd<br><br>Section "Configure Database" SEC_4<br>;;;;;;;;;;;;;<br>SectionEnd<br><br>Section "Update Quantel database" SEC_5<br>;;;;;;;;;;;;;;<br>SectionEnd<br><br>Section "Downdate Quantel database" SEC_6<br>;;;;;;;;;;;;;<br>SectionEnd<br><br>Section "File Extract Only" SEC_7<br>;;;;;;;;;;;;;;<br>SectionEnd<br><br>Function .onInit<br># execute at least this sample script twice by changing the Push below<br># respectively to contition1 contition2 and watch the action :-)<br>  Push contition1<br>  Pop $R0<br>  StrCmp $R0 'contition1' contition1 contition2<br><br>  contition1:<br>  IntOp $0 ${SF_SELECTED} | ${SF_RO}<br><br>  SectionSetFlags ${SEC_1} $0<br>  SectionSetInstTypes ${SEC_1} 1<br><br>  SectionSetFlags ${SEC_5} $0<br>  SectionSetInstTypes ${SEC_5} 1<br><br>  IntOp $0 ${SF_USELECTED} | ${SF_RO}<br><br>  SectionSetFlags ${SEC_2} $0<br><br>  SectionSetFlags ${SEC_3} $0<br><br>  SectionSetFlags ${SEC_4} $0<br><br>  SectionSetFlags ${SEC_6} $0<br><br>  IntOp $0 ${SF_USELECTED} | ${SF_RO}<br><br>  SectionSetFlags ${SEC_7} $0<br>  SectionSetInstTypes ${SEC_7} 2<br><br>  contition2:<br>  StrCmp $R0 'contition2' 0 exit<br><br>  IntOp $0 ${SF_SELECTED} | ${SF_RO}<br><br>  SectionSetFlags ${SEC_1} $0<br>  SectionSetInstTypes ${SEC_1} 1<br><br>  SectionSetFlags ${SEC_5} $0<br>  SectionSetInstTypes ${SEC_5} 1<br><br>  SectionSetFlags ${SEC_2} $0<br>  SectionSetInstTypes ${SEC_2} 1<br><br>  SectionSetFlags ${SEC_3} $0<br>  SectionSetInstTypes ${SEC_3} 1<br><br>  IntOp $0 ${SF_USELECTED} | ${SF_RO}<br><br>  SectionSetFlags ${SEC_4} $0<br><br>  SectionSetFlags ${SEC_6} $0<br><br>  IntOp $0 ${SF_USELECTED} | ${SF_RO}<br><br>  SectionSetFlags ${SEC_7} $0<br>  SectionSetInstTypes ${SEC_7} 2<br><br>  exit:<br>FunctionEnd</font></code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">davidnewcomb</span><br>
      <span class="post-time small text-muted">20th December 2006 14:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Wow thanks, You have obviously put in a lot of work for this.<br>
      It took quite a long time to understand how it works so I will add an explaination for others.<br>
      <br>
      The reason why my orginal showed blank in the selection list was because the selected sections did not match any of the predefined install types.<br>
      <br>
      After a bit of fiddling I found SetSectionInInstType in sections.nsh and wrote 2 macros to help standardise the SectionSet stuff.<br>
      <br></p>
      <pre>
<code><br>!macro AssignInstallSection P_SEC<br>  Push $0<br>  IntOp $0 ${SF_SELECTED} | ${SF_RO}<br>  SectionSetFlags ${P_SEC} $0<br>  Pop $0<br>!macroend<br><br>!macro UnassignInstallSection P_SEC<br>  Push $0<br>  IntOp $0 ${SF_USELECTED} | ${SF_RO}<br>  SectionSetFlags ${P_SEC} $0<br>  Pop $0<br>!macroend<br><br>Function .onInit<br><br>!insertmacro SetSectionInInstType ${sec_install_java} 1<br>!insertmacro AssignInstallSection ${sec_install_java}<br><br>!insertmacro ClearSectionInInstType ${sec_install_mysql} 1<br>!insertmacro UnassignInstallSection ${sec_install_mysql}<br><br>!insertmacro ClearSectionInInstType ${sec_install_isa} 1<br>!insertmacro UnassignInstallSection ${sec_install_isa}<br><br>!insertmacro ClearSectionInInstType ${sec_config_db} 1<br>!insertmacro UnassignInstallSection ${sec_config_db}<br><br>!insertmacro SetSectionInInstType ${sec_config_update} 1<br>!insertmacro AssignInstallSection ${sec_config_update}<br><br>!insertmacro ClearSectionInInstType ${sec_config_downdate} 1<br>!insertmacro UnassignInstallSection ${sec_config_downdate}<br><br>!insertmacro SetSectionInInstType ${sec_extract_only} 2<br><br></code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br>
      <span class="post-time small text-muted">20th December 2006 14:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Î¥ou're welcome!. Nice job from your side!<br>
      Perhaps you may want to take a look at the attached below sample. I think it is a little more pro looking :-)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">davidnewcomb</span><br>
      <span class="post-time small text-muted">20th December 2006 18:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Maybe 1 for the Wiki!</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br>
      <span class="post-time small text-muted">20th December 2006 18:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've already posted a <a href="http://nsis.sourceforge.net/Managing_Sections_on_Runtime" target="_blank">topic at wiki</a> with the above sample code because here in forum after a few days is not easy to find it by someone who might need it.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>