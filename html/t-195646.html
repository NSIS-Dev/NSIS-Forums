<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Devilishly cunning new problem re nsExec::Exec"><title>Devilishly cunning new problem re nsExec::Exec - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Devilishly cunning new problem re nsExec::Exec</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=195646">Devilishly cunning new problem re nsExec::Exec</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">RobGrant</span><br><span class="post-time small text-muted">5th October 2004 10:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Devilishly cunning new problem re nsExec::Exec</strong><br>OK, I _had_ it working where I unzipped a zip file and captured the output of the unzip program so I could log the files extracted like so:<br><br>!macro MACRONAME UNZIP FILE PATH<br>ExpandEnvStrings $0 "%COMSPEC%"<br>nsExec::Exec '"$0" /C ${UNZIP} ${PATH} -o ${FILE} &gt;&gt; "$INSTDIR\filelist.log"'<br>!macroend<br><br>I'd call it with:<br>!insertmacro MACRONAME "C:\temp\unzip.exe" "warfile.war" "-dwardirectory"<br><br>All fine. The moment I try and change the directory the unzip program is in however:<br><br>!insertmacro MACRONAME "$INSTDIR\temp\unzip.exe" "warfile.war" "-dwardirectory"<br><br>And it does absolutely nothin. Doesn't unzip, certainly doesn't log anything. Any ideas? I don't really know what info to give...I'm on Windows XP, NSIS version 2.01<br><br>Cheers guys<br><br>Rob</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">RobGrant</span><br><span class="post-time small text-muted">5th October 2004 10:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I should add - it unzips fine if I remove the command line append, ie:<br><br>nsExec::Exec '$0 /C ${UNZIP} ${PATH} -o ${FILE}'</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yathosho</span><br><span class="post-time small text-muted">5th October 2004 10:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">you might probably prefer the <a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=77" target="_blank">ExtractDLL</a> over using an external program. should also solve your problem.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">RobGrant</span><br><span class="post-time small text-muted">5th October 2004 10:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ooh interesting! Quick q rather than me having to hunt around the docs - where do i unzip it to?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">RobGrant</span><br><span class="post-time small text-muted">5th October 2004 11:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Having looked, I assume I put ExtractDLL.dll in the plugins dir, and the rest in a folder called ...\Contrib\ExtractDLL. So I do this:<br><br>Push "$INSTDIR\dir\webapp.war"<br>Push "$INSTDIR\dir\webapp\"<br>CallInstDLL ExtractDLL extract<br><br>This just creates a file called "webapp" which is precisely 0 bytes big. Any chance of it extracting to a directory?<br><br>Cheers<br><br>Rob</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">RobGrant</span><br><span class="post-time small text-muted">5th October 2004 15:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Bump!<br><br>I really don't see what's wrong here. If I even log the thing i'm chucking into nsExec and then paste the log line into a command prompt it works beautifully:<br><br>C:\WINDOWS\system32\cmd.exe /C "C:\Program Files\C-Evolution\robtest\temp\unzip.exe" -dcevolution-client -o cevolution-client.war &gt;&gt; "C:\Program Files\C-Evolution\robtest\filelist.log"<br><br>But nsExec just hates it with a passion.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">RobGrant</span><br><span class="post-time small text-muted">5th October 2004 15:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think I've narrowed it down. It doesn't like it when unzip.exe's path has a space in it (e.g. Program Files).<br><br>Not sure whether this is a problem with cmd.exe or nsExec, anyone know?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">5th October 2004 18:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You might need more quotes around your strings:<br><br>nsExec::Exec '$0 /C "${UNZIP}" "${PATH}" -o "${FILE}"'<br><br>Like you have said, if the path contains a space, it will become two arguments rather than the one, and so you should use quotes to declare it as one.<br><br>Oh and if I were you, I wouldn't use ExtractDLL. While I was using it to uncompress around 200 Zip's (for updating games) ExtractDLL wouldn't decompress about 25% of the Zip's and Unzip / WinZip would, thus now I use unzip.exe.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">RobGrant</span><br><span class="post-time small text-muted">6th October 2004 09:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yeah I agree ExtractDLL seems slightly suspect in terms of it doing what I'd expect it to do each time.<br><br>However I am trying all combinations of quoting and not quoting, and I'm not sure what the difference is. The behaviour changes ONLY when I use the append output '&gt;&gt;' operator, as thought as soon as I use that then spaces in paths become a problem.<br><br>Also extracting out the sample you give would make for an unusual command:<br><br>"C:\Program Files\unzip.exe" "-ddirectory" -o "file.war"<br><br>Like, some unzip.exe arguments quoted and some not? And would I quote the bits after the '&gt;&gt;'?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">RobGrant</span><br><span class="post-time small text-muted">6th October 2004 09:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">As I said, if I LogText the exact input I give to nsExec, and then paste that logged text into a command line, it works perfectly from the command line.<br><br>Here's the line:<br><br>C:\WINDOWS\system32\cmd.exe /C "C:\Program Files\C-Evolution\robtest\temp\unzip.exe" -dcevolution-client -o cevolution-client.war &gt;&gt; "C:\Program Files\C-Evolution\robtest\filelist.log"</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">10th October 2004 14:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">cmd.exe and command.com might also expect 8.3 file names. Paths with spaces might not be valid. I'm pretty sure it doesn't work with command.com.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>