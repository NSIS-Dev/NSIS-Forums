<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="XML editing,code from archives but not working"><title>XML editing,code from archives but not working - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">XML editing,code from archives but not working</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=132042">XML editing,code from archives but not working</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">merahul94538</span><br><span class="post-time small text-muted">17th April 2003 01:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>XML editing,code from archives but not working</strong><br>&nbsp; Code is from Archive.What I need to do it to call this script from my main installer file to make changes in my 2 XML files.<br>This is code in my main installer file but it's not working,i am doing something wrong but can't figure out<br>In WriteXML I get script,StringA,StringB value coorect but file.name and filnenew.xml comes as null.Please help.<br>Code attached.<br>What I need is that I should be able to send sourcefile name,destination file name,string to be replaced,new string from my main installer file to Writexml and get the final output in destination file name. Thank in advance<br><br>push "StringA"<br>push "StringB"<br>push "file.xml"<br>push "filenew.xml"<br><br><br>; Some code to adjust settings in XML file.<br>;<br>; By Hendri Adriaens.<br>; <a href="mailto:HendriAdriaens@hotmail.com">HendriAdriaens@hotmail.com</a><br>!define TEMP1 $R0 ;Temp variable<br>!define TEMP2 $R1 ;Temp variable<br>!define TEMP3 $R2 ;Temp variable<br>!define TEMP4 $R3 ;Temp variable<br>;outfile WriteXML.exe<br>;name WriteXML<br>; push sourcefile<br>; push destfile<br>; push search string<br>; push new string<br><br>function ParseXML<br>;MessageBox MB_YESNO "This will modify studio.txt and put output to temp.tmp.$\r$\nContinue?" IdNo Quiting<br><br>Exch $0 ;newString<br>MessageBox MB_OK $0<br>Exch<br>Exch $1 ;search string<br>MessageBox MB_OK $1<br>Exch<br>Exch $2 ;source file<br>MessageBox MB_OK $2<br>Exch<br>Exch $3 ;destfile<br>MessageBox MB_OK $3<br><br><br>FileOpen $R0 "$3" "r"<br>FileOpen $R1 "$4" "w"<br>MessageBox MB_OK $R0<br>MessageBox MB_OK $R1<br><br><br>Loop:<br>FileRead $R0 $R2<br>StrCmp $R2 "" ExitLoop<br>push $R2<br>push $1<br>Call StrStrH<br>Pop $R3<br>StrCmp $R3 $R2 NotFound<br>FileWrite $R1 '$R3"$1" value="$2" /&gt;$\r$\n'<br>GoTo Loop<br>NotFound:<br>FileWrite $R1 $R2<br>Goto Loop<br>ExitLoop:<br>FileClose $R0<br>FileClose $R1<br>Quiting:<br>Quit<br>functionend<br><br>Function StrStrH<br>;Modified StrStr function from functions.htm<br>Exch $1<br>Exch<br>Exch $2<br>Push $3<br>Push $4<br>Push $5<br>StrLen $3 $1<br>StrCpy $4 0<br>loop:<br>StrCpy $5 $2 $3 $4<br>StrCmp $5 $1 done<br>StrCmp $5 "" done<br>IntOp $4 $4 + 1<br>Goto loop<br>done:<br>StrCpy $1 $2 $4<br>Pop $5<br>Pop $4<br>Pop $3<br>Pop $2<br>Exch $1<br>FunctionEnd<br><br>section<br>sectionend</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">iceman_k</span><br><span class="post-time small text-muted">17th April 2003 06:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">In the first place, you seem to be pushing your arguments in the wrong order.<br>The documentation for the script says:<br><br></p><pre>
<code><br>; push sourcefile <br>; push destfile <br>; push search string <br>; push new string <br></code>
</pre><br>
      <br>
      So you should push in that order.<br>
      <br>
      Secondly, the ParseXML function seems to be extracting the arguments incorrectly.<br>
      It should be doing:<br>
      <br>
      <pre>
<code><br>Exch $0 ;newString <br>MessageBox MB_OK $0 <br>Exch <br>Exch $1 ;search string <br>MessageBox MB_OK $1 <br>Exch <br>Exch 2<br>Exch $2 ;dest file <br>Exch <br>Exch 2<br>Exch 3<br>Exch $3 ;source file <br></code>
</pre><br>
      <br>
      Please correct me if I am wrong.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">merahul94538</span><br>
      <span class="post-time small text-muted">17th April 2003 06:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>XML editing..............................</strong><br>
      &nbsp; I put that documentation in and I think stack is LAST IN FIRST OUT, correct me if I am wrong. That's what I assume and I get the valye for STRINGA and STRINGB correct in the function but just not the 2 files. It could be the extraction problem,I will look into it more.Anybody else ?<br>
      Thanks for your reply</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">virtlink</span><br>
      <span class="post-time small text-muted">17th April 2003 10:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I think that you should use Pop to get the value on the stack instead of Exch. Exch exchanges the top value on the stack with the value in the variable. Pop moves the value on the stack to the variable, so that the next value on the stack becomes the top value:<br>
      <br></p>
      <pre>
<code>push "StringA"
<br>&gt;push "StringB"
<br>&gt;push "file.xml"
<br>&gt;push "filenew.xml" 
</code>
</pre>The stack contains:<br>
      <pre>
<code>filenew.xml<br>file.xml<br>StringB<br>StringA</code>
</pre><br>
      <br>
      Then, using Pop:<br>
      <pre>
<code>
Pop $0
<br>MessageBox MB_OK$0 
<br>&gt;
</code>
</pre>The stack contains:<br>
      <pre>
<code>file.xml<br>StringB<br>StringA</code>
</pre><br>
      And the message box should show: filenew.xml<br>
      <br>
      Then pop again, and so on.<br>
      <br>
      I'm not sure about the order in which the items come on the stack and leave stack. But I think that Push puts the item on top of the stack, and Pop takes the top item of the stack.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">iceman_k</span><br>
      <span class="post-time small text-muted">17th April 2003 12:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If Pop is used to get the values from the stack, you lose the current values in the registers- which could have bad consequences later.<br>
      Another problem I noticed with ParseXML is that it is not restoring the register values when it completes.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">17th April 2003 12:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The stack operations in this function are wrong. Where did you take it from? I can't find it in the archive...<br>
      <br>
      Please attach large scripts next time.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script type="text/javascript" src="../js/highlight.pack.js" async>
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>