<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Uninstall with MultiUser.nsh"><title>Uninstall with MultiUser.nsh - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Uninstall with MultiUser.nsh</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=288468">Uninstall with MultiUser.nsh</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">GlibReaper</span><br><span class="post-time small text-muted">14th March 2008 11:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Uninstall with MultiUser.nsh</strong><br>Hi.<br><br>I'm fairly new to NSIS, so I might be missing a trick, but I've checked the forums, the interweb, etc and I can't find an answer. I'm running NSIS 2.35 and I just played with the MultiUser options. By using MULTIUSER_PAGE_INSTALLMODE I can ask the user where he wants to install my application to. But the uninstall doesn't work properly. If I use MULTIUSER_INSTALLMODE_COMMANDLINE then the uninstall works perfectly for All User installations, but it doesn't work for Current User. And if I use MULTIUSER_INSTALLMODE_DEFAULT_CURRENTUSER it's the opposite: it works fine for the current user, but not for all users.<br><br>Any ideas?<br><br>Glib</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">16th March 2008 20:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Is it the same as the following?<br><br><a href="http://sourceforge.net/tracker/index.php?func=detail&amp;aid=1913048&amp;group_id=22049&amp;atid=373085" target="_blank">http://sourceforge.net/tracker/index...49&amp;atid=373085</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">16th March 2008 21:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">No, it's not related to that bug.<br><br>The uninstaller should know whether the application it's linked to is installed for the current user or for all users. Note that a system-wide and current-user version may be installed at the same time.<br><br>A simple solution is to add the /CurrentUser or /AllUsers command-line switch to your uninstaller location for the Windows Add/Remove programs control panel.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bwinterscheidt</span><br><span class="post-time small text-muted">17th March 2008 04:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'm having similar troubles on uninstall with multiuser.nsh...<br><br>I don't have MULTIUSER_INSTALLMODE_COMMANDLINE or MULTIUSER_INSTALLMODE_DEFAULT_CURRENTUSER defined, but the uninstaller always runs in 'current' context when installed for AllUsers, in 'all' context when installed for current user.<br><br>@kichik: the bug you link to is noted as fixed, but the current code (2.35) still appears as Ivan described. do we need to implement his fix ourselves until the next release?<br><br>I've tried swapping these around, and it doesn't seem to have any affect?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bwinterscheidt</span><br><span class="post-time small text-muted">17th March 2008 05:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">After throwing messageboxes into each macro to see if it fires, I'm noticing that things are breaking somewhere in MULTIUSER_INIT_CHECKS Un un., and it's never calling the MULTIUSER_INSTALLMODE_ALLUSERS/CURRENTUSER macros where SetShallVarContext is set.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bwinterscheidt</span><br><span class="post-time small text-muted">17th March 2008 06:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hmm. These are always undefined (install *and* uninstall)...<br><br>!ifdef MULTIUSER_INSTALLMODE_DEFAULT_REGISTRY_KEY &amp; MULTIUSER_INSTALLMODE_DEFAULT_REGISTRY_VALUENAME<br><br>Are these *designed* to be different values than the MULTIUSER_INSTALLMODE_INSTDIR_REGISTRY_KEY &amp; MULTIUSER_INSTALLMODE_INSTDIR_REGISTRY_VALUENAME ?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bwinterscheidt</span><br><span class="post-time small text-muted">17th March 2008 06:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Okay, my problem is fixed with these steps:<br><br>1) Implement Ivan's suggestion, swapping the CurrentUser/AllUsers at lines 256 and 264 of NSIS 2.35's MultiUser.nsh<br><br>2) add two lines as follows into my script:<br>!define MULTIUSER_INSTALLMODE_DEFAULT_REGISTRY_KEY "${MULTIUSER_INSTALLMODE_INSTDIR_REGISTRY_KEY}"<br>!define MULTIUSER_INSTALLMODE_DEFAULT_REGISTRY_VALUENAME "${MULTIUSER_INSTALLMODE_INSTDIR_REGISTRY_VALUENAME}"<br><br>Thanks for letting me post to myself. Hopefully someone else finds this useful. ;)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">18th March 2008 14:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">For the uninstaller I would recommend you to also implement what I suggested in my previous post. A registry key won't work for uninstallation if both a per-user as well as a per-machine installation exists.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bwinterscheidt</span><br><span class="post-time small text-muted">21st March 2008 05:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks. Is this switch added to the UninstallString registry value? Or somewhere else?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">21st March 2008 14:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes, that's right. You also need to set MULTIUSER_INSTALLMODE_COMMANDLINE.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>