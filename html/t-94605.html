<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="DeleteRegKey" />

  <title>DeleteRegKey - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">DeleteRegKey</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=94605">DeleteRegKey</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rio</span><br />
      <span class="post-time small text-muted">15th July 2002 13:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>DeleteRegKey</strong><br />
      Hello Everybody,<br />
      <br />
      during my installation I want to delete a key in<br />
      <br />
      HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Enum\USB<br />
      <br />
      This works fine under Win98 and WinME with the commant:<br />
      <br />
      DeleteRegKey HKEY_LOCAL_MACHINE "Enum\USB\Vid_074d&amp;Pid_3556"<br />
      <br />
      <br />
      under Win2000 with the command:<br />
      DeleteRegKey HKEY_LOCAL_MACHINE "System\CurrentControlSet\Enum\USB\Vid_074d&amp;Pid_3556"<br />
      i´ve got following problem:<br />
      even logged in as administrator, i don´t have authorisation to<br />
      delete a key in the registry. (On a new / clean W2k)<br />
      :cry:<br />
      now my question is:<br />
      is there any possibility to change authorisation during<br />
      an installation with NSIS ?<br />
      <br />
      hope anybody can help me<br />
      best regards<br />
      rio</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br />
      <span class="post-time small text-muted">15th July 2002 16:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You would also get this problem on NT I expect since both use a "proper" security model and protect system resources. No ordinary user will be allowed to delete that key, only an administrator will be able to. Therefore, as is the case with many installers, the user running the installer will need to be a local administrator.<br />
      <br />
      A process cannot elevate it's only permission level, that would bypass the security model. A user (and processes run by that user) only has the permissions that they have been granted by an administrator (or other user with sufficient permissions)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rio</span><br />
      <span class="post-time small text-muted">16th July 2002 07:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Sunjammer,<br />
      <br />
      the problem is, even logged in as administrator I can´t delete<br />
      the reg key. The authorisations in the registry for administrators are set to "read only" on a new win2k (I don´t have tested it under NT). Only a user "system" ?!? have permission to write :igor:<br />
      The funny about is that I can change the authorisation level to "full access" (as administrator). If I change the authorisation level the installer will work fine. Now I want do this automatically without<br />
      change authorisation levels manually. Can I change the levels within the installer (when the user is an administrator of course), or is there an other way to delete registry keys.<br />
      <br />
      greetings<br />
      rio</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br />
      <span class="post-time small text-muted">16th July 2002 12:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The thing is I have to wonder why you want to do this. The key you want to change is deliberately not accessible by default because only the system account (ie. device drivers running as system, and the kernel itself) should ever touch that part of the registry.<br />
      <br />
      Anyway, what you are really asking is "Is there an NSIS function that can change the security setting of a registry key" - answer = No.<br />
      <br />
      I wrote a tiny extension DLL for someone a while back that removed all security on a registry key (that is explicitly what that person wanted) which might be of use to you (<a href="http://www.clantpa.co.uk/nsis/x18regkeyV0.0.zip" target="_blank">download it</a>), but to be honest I think if you go around changing the security of that key on a system your installer is running on you'd better have a very good reason.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rio</span><br />
      <span class="post-time small text-muted">23rd July 2002 08:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">@Sunjammer<br />
      <br />
      thank you for your help,<br />
      :)<br />
      Now I have found a correct way to solve my problem.<br />
      rio<br />
      :D</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br />
      <span class="post-time small text-muted">23rd July 2002 09:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If it's something that other people would find useful please post your solution here (or PM me and I'll mention it in my archive).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rio</span><br />
      <span class="post-time small text-muted">23rd July 2002 09:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Your solution unfortunatly don´t solve my problem with registry access. So I used the W2k DDK to build an "quiet" exe who do my installation, and start this exe from NSIS which also do a versionchecking of windows.<br />
      <br />
      <br />
      rio</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
