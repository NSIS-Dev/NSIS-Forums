<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="$INSTDIR &gt; InstallDir ?" />

  <title>$INSTDIR &gt; InstallDir ? - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">$INSTDIR &gt; InstallDir ?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=201537">$INSTDIR &gt; InstallDir ?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MysticHead</span><br />
      <span class="post-time small text-muted">8th December 2004 17:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>$INSTDIR &gt; InstallDir ?</strong><br />
      Hello,<br />
      <br />
      I've been reading the forums/archive/manual and I haven't been able to find the answer to this question, though search results are often a bit overwhelming so maybe I missed it... sorry if that's the case.<br />
      <br />
      Does $INSTDIR take precidence over InstallDir?<br />
      <br />
      The documentation talks about InstallDir setting the default directory. Does that mean that InstallDir is ONLY used if $INSTDIR is NOT set?<br />
      <br />
      It seems to work this way, but I wanted to clarify that it was the intent and not simply that my script was written in such a way as to make it look like this was happening.<br />
      <br />
      I've used VenisIX to get my basic script, and then I've continued to modify it. I'm using .onInit to set the value of $INSTDIR to C:\3rdPartyAppDir\myApp but I just realized that after the funcion end, in "main installer settings" InstalDir is being set to $PROGRAMFILES\myApp<br />
      <br />
      As I said everything seems to work fine, but I wanted to make sure it was working correctly:)<br />
      <br />
      thanks,<br />
      <br />
      -marc</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">8th December 2004 18:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you want to overwrite InstallDir, you simply change the value of $INSTDIR. $INSTDIR will initially contain the value set with InstallDir until you change the value using StrCpy.<br />
      <br />
      E.g.<br />
      Function .onInit<br />
      IfFileExists "C:\blah\*.*" 0 +2<br />
      StrCpy $INSTDIR "C:\blah"<br />
      FunctionEnd<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MysticHead</span><br />
      <span class="post-time small text-muted">8th December 2004 22:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I wasn't trying to overwrtie anything. I just noticed that by accident I was using InstallDir AFTER I'd already used StrCpy to set $INSTDIR in my .onInit function. It seemed like the InstallDir line was simply being ignored, and I didn't know if that was by design or by chance.<br />
      <br />
      --------------------<br />
      E.g.<br />
      Function .onInit<br />
      IfFileExists "C:\blah\*.*" 0 +2<br />
      StrCpy $INSTDIR "C:\blah"<br />
      FunctionEnd<br />
      <br />
      Name "mySwellApp"<br />
      InstallDir "$PROGRAMFILES\${APPNAMEANDVERSION}"<br />
      InstallDirRegKey HKLM "Software\${APPNAMEANDVERSION}" ""<br />
      <br />
      etc...<br />
      -----------<br />
      <br />
      Really I guess I can just remove this InstallDir line, as it seems to be ignored. Originally I thought that it might be better to leave it in as a default, incase the $INSTDIR value wasn't set properly. I did some further testing and it looks like NSIS already takes care of the case where $INSTDIR == "" and just forces you to browse for a folder.<br />
      <br />
      I should have given that a shot before posting originally.<br />
      <br />
      Thanks.<br />
      <br />
      -marc</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">9th December 2004 01:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Installdir is a compile time instruction</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">9th December 2004 19:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">InstallDir sets the default value. The value of $INSTDIR is set as follows:</p>

      <ol style="list-style-type: decimal">
        <li>Value from command line (/D=)</li>

        <li>If $INSTDIR is invalid, value from InstallDirRegKey</li>

        <li>If $INSTDIR is invalid, value from InstallDir</li>
      </ol>After all these, your script starts to execute, including .onInit. It is free to change $INSTDIR.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MysticHead</span><br />
      <span class="post-time small text-muted">10th December 2004 16:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>I think I got it</strong><br />
      OK, thanks. I think I've got it.<br />
      <br />
      InstallDir is set at compile time (along with InstallDirRegKey) and they will contain the default values of $INSTDIR.<br />
      <br />
      Once the script is actually run .onInit (or other functions) can freely replace that default value, giving $INSTDIR a new (current) value, basically at run time.<br />
      <br />
      So is it correct to say that InstallDir sort of breaks out from the idea that each instruction is read/acted on sequentially? Or is it that it's still read in sequence, but portions of the script are read when compiling and other portions are read when running?<br />
      <br />
      I'm sorry if I'm making this overly complicated. I really do think I understand the answer to my original question, I'm just trying to make sure I've got it straight...not _trying_ to just beat this horse into the ground.<br />
      <br />
      thanks again,<br />
      <br />
      -marc</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">10th December 2004 17:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">InstallDir is performed sequentially, but doesn't belong to the same context as the code in .onInit. It's an installer attribute. If your script has two InstallDir lines, only the last one will count.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
