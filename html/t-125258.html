<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Detect Free RAM?" />

  <title>Detect Free RAM? - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Detect Free RAM?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=125258">Detect Free RAM?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br />
      <span class="post-time small text-muted">16th February 2003 16:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Detect Free RAM?</strong><br />
      How can we detect free RAM in the end-user machine? :weird:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">16th February 2003 17:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">System does it again :D<br />
      <br /></p>
      <pre>
<code>System</code><span style="color: #007700">::</span><span style="color: #0000BB">Alloc32
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"Kernel32::GlobalMemoryStatus(i)v(r1)"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"*$1(&amp;i4.r2,&amp;i4.r3,&amp;i4.r4,\
<br />&amp;i4.r5,&amp;i4.r6,&amp;i4.r7,&amp;i4.r8,&amp;i4.r9)"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Free</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br />DetailPrint</span><span style="color: #DD0000">"Structuresize(useless):$2Bytes"
<br /></span><span style="color: #0000BB">DetailPrint</span><span style="color: #DD0000">"Memoryload:$3%"
<br /></span><span style="color: #0000BB">DetailPrint</span><span style="color: #DD0000">"Totalphysicalmemory:$4Bytes"
<br /></span><span style="color: #0000BB">DetailPrint</span><span style="color: #DD0000">"Freephysicalmemory:$5Bytes"
<br /></span><span style="color: #0000BB">DetailPrint</span><span style="color: #DD0000">"Totalpagefile:$6Bytes"
<br /></span><span style="color: #0000BB">DetailPrint</span><span style="color: #DD0000">"Freepagefile:$7Bytes"
<br /></span><span style="color: #0000BB">DetailPrint</span><span style="color: #DD0000">"Totalvirtual:$8Bytes"
<br /></span><span style="color: #0000BB">DetailPrint</span><span style="color: #DD0000">"Freevirtual:$9Bytes"
</span>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br />
      <span class="post-time small text-muted">16th February 2003 17:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>wao</strong><br />
      thanks !!!!<br />
      <br />
      :eek: didnÂ´t know that trick :eek:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">liquidmotion</span><br />
      <span class="post-time small text-muted">16th February 2003 19:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">in mirc, just type /stat :)<br />
      <br />
      oh wait, you need moo.dll :P</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br />
      <span class="post-time small text-muted">17th February 2003 01:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, try everything..... but how can we convert to MB in Nsis,<br />
      because the $4 return in Bytes ?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">17th February 2003 13:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This one for example:<br />
      <a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=78" target="_blank">http://nsis.sourceforge.net/archive/....php?pageid=78</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br />
      <span class="post-time small text-muted">17th February 2003 21:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">jejeje...yeah...IntOp... does it !!!!<br />
      <br />
      Thanks :D</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">spanky</span><br />
      <span class="post-time small text-muted">18th February 2003 04:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I love system.dll.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">testtube</span><br />
      <span class="post-time small text-muted">6th February 2008 08:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Old thread but I was trying to figure out how to determine how to detect the amount of system memory at install time and came across this via google.<br />
      <br />
      This was very useful and got me on the right track. Most of our install targets are 64 bit systems so I needed a solution that could handle this (not 32 bit integer limited) and found I needed to use <a href="http://msdn2.microsoft.com/en-us/library/aa366589(VS.85).aspx" target="_blank">GlobalMemoryStatusEX</a> instead of <a href="http://msdn2.microsoft.com/en-us/library/aa366586(VS.85).aspx" target="_blank">GlobalMemoryStatus</a> . One key difference is that the structure passed to GlobalMemoryStatusEx, <a href="http://msdn2.microsoft.com/en-us/library/aa366770(VS.85).aspx" target="_blank">MEMORYSTATUSEX</a>, must have the structure size set (This isn't necessary with GlobalMemoryStatus and <a href="http://msdn2.microsoft.com/en-us/library/aa366772(VS.85).aspx" target="_blank">MEMORYSTATUS</a>. If anyone's interested here's the code I used:<br />
      <br /></p>
      <pre>
<code><br />  ## allocate<br />  System::Alloc 64<br />  Pop $0<br />  ## set<br />  # GlobalMemoryStatusEx requires structure size to set in <br />  # MEMORYSTATUSEX instance passed in as argument<br />  System::Call "*$0(i 64, i 0, l 0, l 0, l 0, l 0, l 0, l 0, l 0)"<br />  ## call<br />  System::Call "Kernel32::GlobalMemoryStatusEx(i r0)"<br />  ## get<br />  System::Call "*$0(i.r1, i.r2, l.r3, l.r4, l.r5, l.r6, l.r7, l.r8, l.r9)"<br />  ## free<br />  System::Free $0<br />  ## print<br />  DetailPrint "Structure size: $1 bytes"<br />  DetailPrint "Memory load: $2%"<br />  DetailPrint "Total physical memory: $3 bytes"<br />  DetailPrint "Free physical memory: $4 bytes"<br />  DetailPrint "Total page file: $5 bytes"<br />  DetailPrint "Free page file: $6 bytes"<br />  DetailPrint "Total virtual: $7 bytes"<br />  DetailPrint "Free virtual: $8 bytes"<br />  DetailPrint "Free extended virtual: $9 bytes"<br /></code>
</pre><br />
      <br />
      I thought this might save someone some time.<br />
      <br />
      I apologize it it's poor etiquette to dredge up old threads. Every forum seems to have different rules...<br />
      <br />
      edit:<br />
      The URLs posted above were function and structure names with links to Microsoft's MSDN docs. Right now all I see is "URL submitted by user" Sorry if this makes the post unreadable..
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th February 2008 19:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You should add this code to the Wiki page:<br />
      <a href="http://nsis.sourceforge.net/Determining_free_memory_using_the_System_plugin" target="_blank">http://nsis.sourceforge.net/Determin..._System_plugin</a><br />
      <br />
      And here are the links again so everyone can read them.<br />
      <br />
      First link to GlobalMemoryStatusEx:<br />
      <a href="http://msdn2.microsoft.com/en-us/library/aa366589" target="_blank">http://msdn2.microsoft.com/en-us/library/aa366589</a>(VS.85).aspx<br />
      <br />
      Second link to GlobalMemoryStatus:<br />
      <a href="http://msdn2.microsoft.com/en-us/library/aa366586" target="_blank">http://msdn2.microsoft.com/en-us/library/aa366586</a>(VS.85).aspx<br />
      <br />
      Third link to MEMORYSTATUSEX:<br />
      <a href="http://msdn2.microsoft.com/en-us/library/aa366770" target="_blank">http://msdn2.microsoft.com/en-us/library/aa366770</a>(VS.85).aspx<br />
      <br />
      Fourth link to MEMORYSTATUS:<br />
      <a href="http://msdn2.microsoft.com/en-us/library/aa366772" target="_blank">http://msdn2.microsoft.com/en-us/library/aa366772</a>(VS.85).aspx</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">testtube</span><br />
      <span class="post-time small text-muted">7th February 2008 23:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just a heads up...<br />
      <br />
      If you are going to manipulate values returned from the output of GlobalMemoryStatusEX use <i>Math::Script</i> instead of <i>IntOp</i>. <i>IntOp</i> functionality appears to be limited to signed 4 byte integers...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">7th February 2008 23:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">the system plugin has Int64Op</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">testtube</span><br />
      <span class="post-time small text-muted">7th February 2008 23:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        the system plugin has Int64Op
      </blockquote>Excellent! Math::Script seemed a little too heavy weight for my needs...<br />
      <br />
      Also, you may want to change your sig to <i>Int64Op $PostCount $PostCount + 1</i> as your post count reaches 2^(32-1)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">qwerty53</span><br />
      <span class="post-time small text-muted">11th February 2008 19:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>How do I make it work on 64bit ? (returns negative numbers)</strong><br />
      on 64bit The following code<br /></p>
      <pre>
<code>System</code><span style="color: #007700">::</span><span style="color: #0000BB">Alloc32
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"Kernel32::GlobalMemoryStatus(i)v(r1)"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"*$1(&amp;i4.r2,&amp;i4.r3,&amp;i4.r4,&amp;i4.r5,\
<br />&amp;i4.r6,&amp;i4.r7,&amp;i4.r8,&amp;i4.r9)"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Free</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br /><br /></span><span style="color: #007700">;$</span><span style="color: #0000BB">5</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">FreeRAM
<br /></span><span style="color: #007700">;$</span><span style="color: #0000BB">4</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">TotalRAM
<br />IntOp$R5</span><span style="color: #007700">$</span><span style="color: #0000BB">5</span><span style="color: #007700">/</span><span style="color: #0000BB">1048576</span><span style="color: #007700">;</span><span style="color: #0000BB">1048576</span><span style="color: #007700">=</span><span style="color: #0000BB">1024</span><span style="color: #007700">*</span><span style="color: #0000BB">1024</span><span style="color: #007700">,or</span><span style="color: #0000BB">MegaX
<br />IntOp$R4</span><span style="color: #007700">$</span><span style="color: #0000BB">4</span><span style="color: #007700">/</span><span style="color: #0000BB">1048576</span><span style="color: #007700">;</span><span style="color: #0000BB">1048576</span><span style="color: #007700">=</span><span style="color: #0000BB">1024</span><span style="color: #007700">*</span><span style="color: #0000BB">1024</span><span style="color: #007700">,or</span><span style="color: #0000BB">MegaX
<br />MessageBoxMB_OK</span><span style="color: #DD0000">"R5:$R55:$5R4:$R44:$4"
</span>
</pre>gives this (also picture attached):<br />
      R5: -813 5: -852815872 R4: -256 4: -269082624<br />
      <br />
      the real total memory is: 3.75GB of RAM<br />
      <br />
      How do I make this work for a 64 bit system?<br />
      if pissible hoe to make one coade to work for both 64bit and 32bit?<br />
      <br />
      Thanks!
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">testtube</span><br />
      <span class="post-time small text-muted">12th February 2008 04:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Have you read the entire thread? I would guess "no"...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">qwerty53</span><br />
      <span class="post-time small text-muted">12th February 2008 17:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Get negative crap</strong><br />
      Hi,<br />
      Sorry for not reading the thread :-).<br />
      So after this code:<br /></p>
      <pre>
<code>System</code><span style="color: #007700">::</span><span style="color: #0000BB">Alloc64
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br /></span><span style="color: #FF8000">##set
<br />#GlobalMemoryStatusExrequiresstructuresizetosetin
<br />#MEMORYSTATUSEXinstancepassedinasargument
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"*$0(i64,i0,l0,l0,l0,l0,l0,l0,l0)"
<br /></span><span style="color: #FF8000">##call
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"Kernel32::GlobalMemoryStatusEx(ir0)"
<br /></span><span style="color: #FF8000">##get
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"*$0(i.r1,i.r2,l.r3,l.r4,l.r5,l.r6,l.r7,l.r8,l.r9)"
<br /></span><span style="color: #FF8000">##free
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Free</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br /><br />MessageBoxMB_OK</span><span style="color: #DD0000">"TotalRAM:$3FreeRAM:$4"
<br /></span><span style="color: #0000BB">IntOp$vTotalRAMtemp</span><span style="color: #007700">$</span><span style="color: #0000BB">3</span><span style="color: #007700">*</span><span style="color: #0000BB">1
<br />IntOp$vTotalRAM$vTotalRAMtemp</span><span style="color: #007700">/</span><span style="color: #0000BB">1
<br /><br /><br />MessageBoxMB_OK</span><span style="color: #DD0000">"TotalRAM:$vTotalRAM"
<br /></span><span style="color: #007700">;$</span><span style="color: #0000BB">4</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">FreeRAM
<br /></span><span style="color: #007700">;$</span><span style="color: #0000BB">3</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">TotalRAM
<br /><br />IntOp$vTotalRAM</span><span style="color: #007700">$</span><span style="color: #0000BB">3</span><span style="color: #007700">/</span><span style="color: #0000BB">1048576</span><span style="color: #007700">;</span><span style="color: #0000BB">1048576</span><span style="color: #007700">=</span><span style="color: #0000BB">1024</span><span style="color: #007700">*</span><span style="color: #0000BB">1024</span><span style="color: #007700">,or</span><span style="color: #0000BB">MegaX
<br />IntOp$vFreeRAM</span><span style="color: #007700">$</span><span style="color: #0000BB">4</span><span style="color: #007700">/</span><span style="color: #0000BB">1048576</span><span style="color: #007700">;</span><span style="color: #0000BB">1048576</span><span style="color: #007700">=</span><span style="color: #0000BB">1024</span><span style="color: #007700">*</span><span style="color: #0000BB">1024</span><span style="color: #007700">,or</span><span style="color: #0000BB">MegaX
<br />MessageBoxMB_OK</span><span style="color: #DD0000">"vTotalRAM:$vTotalRAM"
</span>
</pre>on a 64 bit machine I get: -262776<br />
      if I printout the $3 it gives the right value in bytes: 4025884672.<br />
      in fact I get negative number even if I do $3 +1<br />
      <br />
      thanks
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">testtube</span><br />
      <span class="post-time small text-muted">12th February 2008 17:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">In posts subsequent to the GlobalMemoryStatusEX post you'll find that you need to use System::Int64Op to do 64 bit math.<br />
      <br />
      My code looks like:<br />
      <br /></p>
      <pre>
<code><br />  System::Alloc 64<br />  Pop $0<br />  System::Call "*$0(i 64)"<br />  System::Call "Kernel32::GlobalMemoryStatusEx(i r0)"<br />  System::Call "*$0(i, i, l.r1, l, l, l, l, l, l)"<br />  System::Free $0<br />  ; convert bytes to megabytes<br />  System::Int64Op $1 / 1048576<br />  Pop $1<br /></code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">qwerty53</span><br />
      <span class="post-time small text-muted">12th February 2008 20:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>THANKS ALOT!!!!!!!!!!!!</strong><br />
      THANKS ALOT!!!!!!!!!!!!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
