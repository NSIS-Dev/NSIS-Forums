<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="MUI LangString bug?" />

  <title>MUI LangString bug? - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">MUI LangString bug?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=147907">MUI LangString bug?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">G_J</span><br />
      <span class="post-time small text-muted">2nd September 2003 12:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>MUI LangString bug?</strong><br />
      Hi,<br />
      <br />
      I'm using a MUI multi-lingual installer.<br />
      onInit uses !insertmacro MUI_LANGDLL_DISPLAY to present the user with a list of languages, after which $LANGUAGE gets populated.<br />
      Later on within the onInit function I am checking whether the application being installed is already present and running. If so, MessageBox is used to request the user to close it, so that it could be upgraded smoothly. There is a loop that ensures that the user really closes the application before proceeding.<br />
      The problem is that the MessageBox text is multilingual and thus references $(AppIsRunningMessage), which is a LangString defined previously for each applicable language. However, there seems to be a bug in which the $() always returns the English version of the message regardless of the value of $LANGUAGE. I am using LangStrings and $() successfully in other areas of the installer, the problem reported here occurs only in the onInit, yet I cannot rewrite the installer to do the MessageBox elsewhere.<br />
      <br />
      Please let me know if there is a fix for this or a good workaround.<br />
      <br />
      Thanks,<br />
      GJ</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">2nd September 2003 12:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The language you set in .onInit isn't really set until .onInit ends. Therefore the language NSIS found most fit would be used for any LangString in .onInit. You can show the message in .onGUIInit or in a custom page.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">G_J</span><br />
      <span class="post-time small text-muted">2nd September 2003 15:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Kichik,<br />
      <br />
      Thanks for the swift response. It's strange that $() doesn't work in .onInit because if I dump the value of $LANGUAGE itself during .onInit (e.g. in a MessageBox) I see that it does get set after the user selects the installation language. Strange. Anyway, I was able to work around the problem by displaying the MessageBox in my custom Upgrade page. But then I had to use 'Quit' instead of 'Abort' to stop installation if the user wanted to. Quick question: are there harmful side-effects that Quit has, compared to an Abort during .onInit (e.g. is it possible that temp files won't be deleted, the plugins folder won't get cleaned, etc)?<br />
      <br />
      Another remaining issue is that I am doing the same thing in the uninstall, i.e. checking if the app is running and asking the user to close it if so, before proceeding. Here I populate $LANGUAGE myself from the registry in un.onInit (first thing) but again I see that $() doesn't work on LangStrings in un.onInit. This is very unfortunate.<br />
      I can't use un.onGUIInit because the compiler complains that it already exists. Is there something else I can do without rewriting my uninstall completely?<br />
      <br />
      Thanks,<br />
      Gilad</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">2nd September 2003 15:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">$LANGUAGE is set in .onInit, but NSIS re-reads it only after .onInit. Quit doesn't have any side-effects I know of. The plug-ins directory is deleted and the bzip2 temporary file is deleted once closed anyway. Unless you put something out of $PLUGINSDIR, I don't think there should be any problem with Quit. Though I think it would be nicer for the user to click his way out of there, giving him time to see the message.<br />
      <br />
      Because the MUI itself uses .onGUIInit and un.onGUIInit you should define a certain define to tell it to call your own function from its .onGUIInit. See the MUI readme for more information.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">G_J</span><br />
      <span class="post-time small text-muted">2nd September 2003 21:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Kichik,<br />
      <br />
      Thanks. I have it working well now, in the install and uninstall. You have been extremely helpful. I have another question, but I will submit it separately to keep the forum organized.<br />
      <br />
      GJ</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">glory_man</span><br />
      <span class="post-time small text-muted">3rd January 2005 17:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK.<br />
      I understand all. But inside .onInit and un.onInit I call MessageBox with "YES/NO" and if user press "Yes" -&gt; abort installation/uninstallation. How can I do it (with multilangauge messagebox text)?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">4th January 2005 15:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Your only option is comparing $LANGUAGE to language ids and displaying the correct message. If you use the LogicLib, it shouldn't be too complicated.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
