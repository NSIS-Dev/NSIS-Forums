<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="servicelib doesn't work with uninstall functions"><title>servicelib doesn't work with uninstall functions - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">servicelib doesn't work with uninstall functions</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=272961">servicelib doesn't work with uninstall functions</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">MidnightJava</span><br><span class="post-time small text-muted">17th June 2007 06:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>servicelib doesn't work with uninstall functions</strong><br>I'm following the instructions for using servicelib, but the !define doesn't seem to get defined, for some reason.<br><br>From an uninstaller section, I call the following function:<br><br></p><pre>
<code>Function un.uninstallServices<br>    !undef UN<br>    !define UN ".un"<br>    <br>    #if client service running, stop it<br>    !insertmacro SERVICE "running" "rcb_Client" "action=stop;"<br>FunctionEnd</code>
</pre><br>
      <br>
      But I get the following error on the !insertmacro line above:<br>
      <br>
      Call must be used with function names starting with "un." in the uninstall section.<br>
      Usage: Call function_name | [:label_name]<br>
      Error in macro SERVICE on macroline 4<br>
      Error in script "C:\Documents and Settings\Mark\My Documents\Eclipse\RemoteClipBoard\rcb_setup.nsi" on line 469 -- aborting creation process<br>
      <br>
      And by looking at line 4 of the SERVICE macro in servicelib.nsh<br>
      <br>
      <pre>
<code>!macro SERVICE ACTION NAME PARAM<br>    Push '${ACTION}'<br>    Push '${NAME}'<br>    Push '${PARAM}'<br>    Call ${UN}Service &lt;-- blows up here<br>  !macroend</code>
</pre><br>
      <br>
      It would appear that the !define had no effect.<br>
      <br>
      What am I missing??
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">17th June 2007 09:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You should do it like this:<br></p>
      <pre>
<code>  !macro SERVICE UN ACTION NAME PARAM<br>    Push '${ACTION}'<br>    Push '${NAME}'<br>    Push '${PARAM}'<br>    Call ${UN}Service<br>  !macroend</code>
</pre><br>
      <br>
      !insertmacro SERVICE "un." "running" "rcb_Client" "action=stop;"<br>
      !insertmacro SERVICE "" "running" "rcb_Client" "action=stop;"<br>
      <br>
      Stu
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">17th June 2007 20:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The correct usage is actually:</p>
      <pre>
<code>Push "action"<br>Push "name"<br>Push "param"<br>Call un.Service<br>Pop $0 ;response</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MidnightJava</span><br>
      <span class="post-time small text-muted">17th June 2007 20:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The servicelib documentation mentions two methods, equivalent to what Kichik and Afrow UK have suggested. However, the instructions in the comments of servicelib.nsh for invoking from the uninstaller seem to be incorrect.<br>
      <br>
      For method 1 (Kichik's post) the instructions say to call Service (not un.Service), and the call to un.Service or Service is handled internal to Service, depending on the defined value of UN. Likewise with method 2, there is no UN parameter when inserting the macro SERVICE, and the define for UN is used instead.<br>
      <br>
      Does the documentation for servicelib (and the change to SERVICE to add the UN parameter) need to be corrected? I'm using Version 1.4 Dec 7 2006, which was what I found by searching this site.<br>
      <br>
      Also is there some scope rule for defines being violated the way I attempted to run this? It seems that using !define UN should have worked.<br>
      <br>
      Thanks for your help. The script is working as needed.<br>
      <br>
      -Mark</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>