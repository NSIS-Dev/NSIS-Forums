<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="InstallOptions" />

  <title>InstallOptions - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">InstallOptions</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=65778">InstallOptions</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">felfert</span><br />
      <span class="post-time small text-muted">16th November 2001 05:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>InstallOptions</strong><br />
      I just played around with the new contrib InstallOptions and noticed the following:<br />
      <br />
      - Window doesn't update correctly<br />
      - edit controls dont autoscroll<br />
      <br />
      Attached is a patch which fixes bot issues and adds a new feature<br />
      for controls of type "DirRequest":<br />
      By setting Text=... you can set a root directory to browse in.<br />
      I use that now for a dialog which enables selection of program<br />
      group for installing shortcuts in startmenu.<br />
      Another change, i made is allocating the HWNDList dynamically.<br />
      <br />
      Apart from these issues, InstallOptions a very useful extension.<br />
      -Fritz</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">alexj</span><br />
      <span class="post-time small text-muted">16th November 2001 08:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've got that problem too.<br />
      <br />
      Can You tell me how to apply that patch,<br />
      which utilities are needed, etc... ?<br />
      <br />
      Or, maybe, you can post the patched<br />
      InstallerOptions.cpp file itself?<br />
      It is not that big, especially zipped :)<br />
      <br />
      Thanks in advance</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">felfert</span><br />
      <span class="post-time small text-muted">16th November 2001 08:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by alexj</i><br />
        <b>I've got that problem too.<br />
        <br />
        Can You tell me how to apply that patch,<br />
        which utilities are needed, etc... ?<br />
        <br />
        Or, maybe, you can post the patched<br />
        InstallerOptions.cpp file itself?<br />
        It is not that big, especially zipped :)<br />
        <br />
        Thanks in advance</b>
      </blockquote>diff and patch are the usual tools for distributing source changes<br />
      in the Unix (Linux) world.<br />
      I use patch.exe which is part of cygwin, a <b>very</b> useful<br />
      posix environment, freely available at <a href="http://sources.redhat.com/cygwin/" target="_blank">http://sources.redhat.com/cygwin/</a><br />
      <br />
      Unpack the zipfile, then<br />
      cd into the directory where your original .cpp is and run<br />
      patch -p0 &lt; /path/where/you/unzipped/InstallerOption.patch<br />
      <br />
      Ciao<br />
      -Fritz<br />
      <br />
      BTW:<br />
      Hardcore programmers also can read the .patch (it's a text-file) and apply the changes by hand ;) :<br />
      <br />
      Each change begins with a line<br />
      <br />
      @@ -o1,o2 +n1,n2<br />
      <br />
      where<br />
      o1 is the start line-number in the old file<br />
      o2 is the end line-number in the old file<br />
      n1 is the start line-number in the new file<br />
      n2 is the end line-number in the new file<br />
      <br />
      Then (in unified diffs like this) 2 lines of unchanged context<br />
      follow, followed by the changed lines, followed by another 2 lines<br />
      of unchanged context. The changed lines are simply prefixed by '-'<br />
      or '+'. '-' means "delete that line", '+' means "add that line".<br />
      <br />
      Pretty simple, eh?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">alexj</span><br />
      <span class="post-time small text-muted">16th November 2001 09:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks .<br />
      <br />
      Actually, that's what I did while waiting for Your answer :)<br />
      <br />
      But next time I'll use patch, sure.<br />
      <br />
      - Alex J.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">locnar42</span><br />
      <span class="post-time small text-muted">16th November 2001 18:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">One quick point about this patch.<br />
      The HWNDList is not used for the controls which you define, but rather for the controls on the main NSIS dialog. The reason they aren't allocated dynamically is because it would require counting the enumerating the controls an extra time.<br />
      Anyway, the patch has a bug if the number of controls on the NSIS window is greater than 2*(number of option controls+10).<br />
      This will work most all the time, but it is a potential bug (not that the hardcoded limit of 150 is much better).<br />
      <br />
      I'll merge the changes into the Install Options source and let you know when it's done.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">felfert</span><br />
      <span class="post-time small text-muted">18th November 2001 00:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by locnar42</i><br />
        <b>One quick point about this patch.<br />
        The HWNDList is not used for the controls which you define, but rather for the controls on the main NSIS dialog.<br /></b>
      </blockquote>Of course you are right. I realized that when i looked closer into the source (my patch was a 5min quickhack to get what i wanted). But you don't need to count them. I now changed the HWNDList to a linked list where elements get added on initial traversal of the window-hierachy. Size of exe is still the same and number of windows is now virtually unlimited.<br />
      More in a PM ...<br />
      <br />
      -Fritz
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">locnar42</span><br />
      <span class="post-time small text-muted">19th November 2001 01:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>update available</strong><br />
      Ok, so I posted a new version of Install Options to the <a href="http://installoptions.sourceforge.net" target="_blank">website</a>. Click <a href="http://installoptions.sourceforge.net/io.zip" target="_blank">here</a> to download it.<br />
      <br />
      This version adds a couple of things.</p>

      <ul>
        <li>Listbox controls (single or multi select).</li>

        <li>Edit controls will autoscroll.</li>

        <li>Window should draw properly.</li>

        <li>Added ROOT property to dirrequest controls to specify the root. Used this instead of TEXT because TEXT can be used to specify an initial directory.</li>
      </ul>Also, I went ahead and wrote the code to allocate HWNDList dynamically.<br />
      <br />
      Let me know if you experience any problems, or if you have any other requests.<br />
      <br />
      michael
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">felfert</span><br />
      <span class="post-time small text-muted">21st November 2001 06:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, it still has some display flaws.<br />
      The initial display is correct, but when some other window is moved above (e.g. The BrowseForDir-Window), then the "old" contents of the installer window gets partially displayed (see attached jpg). I think, the main reason for that is the wait-loop in the ExecWait function of NSIS which still dispatches WM_PAINT messages. But i may be wrong with that (Im a UnixGuru not a WinGuru).<br />
      <br />
      Meanwhile i have "DLLified" InstallerOptions and added 3 things to NSIS:[list=1][*]An ExecDLL command for running a function in a DLL (basically LoadLibrary(), GetProcAddress(), calling external func, pushing result on stack)[*]The .onDlgPage feature described in my Post "A better integration of InstallOptions"[*]An additional variable $SECTIONS which reflects the current selected components. (For running some dialogs conditionally)[/list=1]<br />
      <br />
      When running as DLL, this has several advantages. For example, the caller (NSIS) can provide some additional internals to the called function. Also, the existing Buttons and Icons can be reused. I simply change the DialogProc temporarily, so that the Cancel, Back and Next Buttons are used instead of the Ok. (The Ok seems to appear somewhat surprising, especially because the the user thinks that he is still using the same program). The Icon is kept and the "ComponentText" temporaily replaced.<br />
      The only disadvantage is size. The same code results in 24k when compiled as DLL. Luckily, most of this added space seems to be good compressable relocation table or so. Compressed size is still app. 5k.<br />
      <br />
      -Fritz</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">locnar42</span><br />
      <span class="post-time small text-muted">21st November 2001 21:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">felfert,<br />
      What version of windows are you using?<br />
      Also, what is your localized language?<br />
      <br />
      The main reason IO isn't a DLL is the main NSIS distribution doesn't support it. If Justin adds this support, then I'd agree and would probably switch it. Until then, I would much rather it work with all versions. I think my biggest complaint with the current workings is there is no way to run it until after the installation starts copying files.<br />
      <br />
      From my perspective, if I was going to modify NSIS to run the DLL, then I would much rather add all of IO into NSIS by adding Dialog/DialogEnd commands (which is actually where I started).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Tresni</span><br />
      <span class="post-time small text-muted">24th November 2001 19:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Same Problem</strong><br />
      I'm running Windows 98 SE and my local language is English.. I get the exact same redraw problems mentioned in this post..<br />
      <br />
      Is this just my system or a real problem?</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
