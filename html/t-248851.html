<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="NSIS Navigate through functions"><title>NSIS Navigate through functions - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">NSIS Navigate through functions</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=248851">NSIS Navigate through functions</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">fistos</span><br><span class="post-time small text-muted">16th June 2006 03:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>NSIS Navigate through functions</strong><br>Hello,<br><br><br><br>I am trying to setup an NSIS installer that reboots during the middle of my installation, then when the PC is rebooted the program will automatically continue the installation then when its finished it will pop-up the FINISH page.<br><br><br><br>I have succesfully managed to write my installer to the registry, with an argument so it could launch on the next reboot with the following code:<br><br><br><br>Function CPAGEFINISH<br><br><br><br>IfRebootFlag 0 noreboot<br><br><br><br>!define MUI_FINISHPAGE_NOAUTOCLOSE<br><br>!define MUI_FINISHPAGE_TITLE "Installation Half-Done"<br><br>!define MUI_FINISHPAGE_TEXT "The installation is not complete but needs to reboot before going \<br><br>on. Do you want to reboot now or wait until later to finish this?"<br><br>!define MUI_FINISHPAGE_TEXT_REBOOTNOW "Reboot now"<br><br>!define MUI_FINISHPAGE_TEXT_REBOOTLATER "I want to manually reboot later"<br><br><br><br>StrCpy $varRebootNext 1<br><br><br><br>System::Call 'kernel32::GetModuleFileNameA(i 0, t .R0, i 1024) i r1'<br><br>;$R0 will contain the installer filename<br><br>WriteRegStr HKLM Software\Microsoft\Windows\CurrentVersion\Run "SurfsUpDS" "$R0 /STAGE2"<br><br><br><br>I have no idea how to make my program start from a specific Section after the PC is rebooted. I've tried the GetParameters and goto, but it never worked.<br><br>I would like to have something like that:<br><br><br>Function .onInit<br><br><br><br>Call GetParameters<br><br>Pop $R1<br><br>${if} $R0 == "STAGE2"<br><br>goto SectionAFTERREBOOT<br><br><br><br><br><br>I know this code won't work but I would like to do something similar.<br><br><br><br>Thanks</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">CancerFace</span><br><span class="post-time small text-muted">16th June 2006 06:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I am not sure how to go to a specific section, but if you wanted to run something from your .onInit, I was thinking that this should work: write a flag somewhere on the system registry before rebooting, read this flag during .onInit and if it exists then go to a specific point within your .onInit. The flag could be a number, incremented for every reboot, so you could redirect the installer to a different section every time (if you want say to restart more than once). You could also define some parameter and then setup your sections conditionally so that they would not be executed upon reboot. Something like this:<br></p><pre>
<code>.onInit<br>ClearErrors<br>ReadRegValue $0 HKLM "Software\&lt;YourKey&gt;" "Flag"<br>IfErrors &lt;label_if_not_reboot&gt;<br>StrCmp $0 1 &lt;label_if_reboot_1&gt;<br>StrCmp $0 2 &lt;label_if_reboot_2&gt;<br><br>...<br><br>&lt;label_if_reboot&gt;<br>StrCpy $Parameter 1<br>...<br><br>Section &lt;SomeName&gt;<br>${If} $Parameter 0<br>&lt;things to do before reboot&gt;<br>...<br>${Else}<br>&lt;things to do after reboot&gt;<br>...<br>${EndIf}</code>
</pre>Hope this helps<br>
      <br>
      CF
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comperio</span><br>
      <span class="post-time small text-muted">17th June 2006 07:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Let's say for sake of argument the $Value variable holds the value you pass to it. And using your example, let's say a value of "Stage2" means we want to go to run section.<br>
      <br>
      This might be the code:<br></p>
      <pre>
<code><br>InstType "normal"<br>InstType "Stage2"<br><br>Section -Norm<br>        SectionIn 1<br>        ### This section would be the start of the install<br>        MessageBox MB_OK "You are in section '-Norm'."<br>SectionEnd<br><br>Section -Stage2<br>        SectionIn 2<br>        ### This section would be executed only when stage 2 is done<br>        MessageBox MB_OK "you are in section '-Stage2'."<br>SectionEnd<br><br>Function .onInit<br>        ### Determine if this is a normal or Stage2 by looking <br>        ### Set the value of $Value<br>        Call GetParameters<br>        Pop $Value<br>        ### Then, just compare the value and act accordingly<br>        StrCmp $Value "Stage2" SetStage2 SetNormal<br>        <br>        SetStage2:<br>        SetCurInstType 1<br>        Goto end<br>        <br>        SetNormal:<br>        SetCurInstType 0<br>        <br>        end:<br>FunctionEnd<br></code>
</pre>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>