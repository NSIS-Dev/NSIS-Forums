<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Delete all directories except 1"><title>Delete all directories except 1 - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Delete all directories except 1</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=177612">Delete all directories except 1</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">22nd April 2004 17:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Delete all directories except 1</strong><br>Is there a way to:<br><br>RMDIR /R "C:\SomeDir\*" exclude="OneDirName"<br><br>Thanks,<br>Eric</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">22nd April 2004 19:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You'll have to specify the names of all other directories.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">22nd April 2004 20:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ouch! Thanks!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">22nd April 2004 21:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Or use FindFirst, FindNext and FindClose to find all the directories and simply skip the directory you don't want to delete.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rsegal</span><br><span class="post-time small text-muted">22nd April 2004 23:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I actually made an app which does the reverse of what you're looking for stonkers. It will scan a folder you have specified to include in an installer and exclude those files/folders you specify. Very useful if you have something like a CVS working copy and want to exclude all those "CVS" folders.<br><br>You can read about it more here,<br><br><a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=150770&amp;highlight=FolderList" target="_blank">http://forums.winamp.com/showthread....ght=FolderList</a><br><br>I was going to make a RMDIR type version as well but got side tracked with a bunch of other tasks at work. If there is demand perhaps I'll look into it again or if there's anyone who knows STL and C++ you can help me do it. I would welcome the extra hands.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">23rd April 2004 22:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It looks to me like FindFirst, FindNext, and FindClose work on files rather than directories. Is there a way to specify only to find directories?<br><br>Thanks Again,<br>Eric</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br><span class="post-time small text-muted">24th April 2004 18:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">no, findfirst etc. also finds directorys. you can check for directorys by using:<br></p><pre>
<code>IfFileExists $DIRECTORY\*.* isDirectory isFile</code>
</pre></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">26th April 2004 21:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">OK, I wrote a little tester and got it to work. Can someone point out things I could have done to make this simpler:<br><br>***********************************************<br>;Backgound Colors<br>BGGradient 800080 000000 FFFFFF<br>BrandingText " "<br><br>;Title Of Your Application<br>Name "KillAllButOne"<br><br>;Output File Name<br>OutFile "KillAllBut1.exe"<br><br>;The Default Installation Directory<br>InstallDir "D:\KillButOne"<br><br>;The text to prompt the user to enter a directory<br>DirText "Wait for processes to finish and reboot"<br><br>Section "KillDirectories"<br><br>FindFirst $0 $1 D:\KillButOne\*<br>StrCmp $1 "" GetOut<br>IfFileExists D:\KillButOne\$1 kill continue<br><br>kill:<br>call KillDir<br><br>continue:<br><br>DoAgain:<br>FindNext $0 $1<br>StrCmp $1 "" GetOut<br>IfFileExists D:\KillButOne\$1 kill2 continue2<br><br>kill2:<br>call KillDir<br><br>continue2:<br>goto DoAgain<br>GetOut:<br>FindClose $1<br><br>SectionEnd<br><br>;--------------------------------<br>; Functions<br><br><br>Function KillDir<br>StrCmp $1 "." skip<br>StrCmp $1 ".." skip<br>StrCmp $1 "DontKillMe" skip<br>RMDIR /r D:\KillButOne\$1<br><br>MessageBox MB_OKCANCEL|MB_ICONEXCLAMATION "Killed the directory $1" IDOK skip<br>skip:<br><br>FunctionEnd<br>***********************************************<br><br><br>Thanks,<br>Eric</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">26th April 2004 21:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'm definitely doing something wrong because it kills files as well as directories.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">26th April 2004 22:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The find commands find both files and directories.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">27th April 2004 14:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Is there a command that tells me whether I have a file or directory? I thought I could use fileExists to do that, but it doesn't seem to do this.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">deguix</span><br><span class="post-time small text-muted">27th April 2004 23:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">IfFileExists "FileOrFolderName/*.*" Folder File<br><br>Replace "FileOrFolderName" with the variable where the folder and file names are found.<br><br>Files don't have other files inside themselves and folders that don't have files in them have at least the folder ".", so this above will work.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">28th April 2004 16:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ahhhh, you tricky deguix, Thanks!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">28th April 2004 16:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'll post the working example in case anyone needs one in the future:<br><br>;NSIS Script For Doc<br><br>;Backgound Colors<br>BGGradient 800080 000000 FFFFFF<br>BrandingText " "<br><br>;Title Of Your Application<br>Name "KillAllButOne"<br><br>;Output File Name<br>OutFile "KillAllBut1.exe"<br><br>;The Default Installation Directory<br>InstallDir "D:\KillButOne"<br><br>;The text to prompt the user to enter a directory<br>DirText "Wait for processes to finish and reboot"<br><br>Section "KillDirectories"<br><br>FindFirst $0 $1 $INSTDIR\*<br>StrCmp $1 "" GetOut<br>IfFileExists $INSTDIR\$1\*.* kill continue<br><br>kill:<br>call KillDir<br><br>continue:<br><br>DoAgain:<br>FindNext $0 $1<br>StrCmp $1 "" GetOut<br>IfFileExists $INSTDIR\$1\*.* kill2 continue2<br><br>kill2:<br>call KillDir<br><br>continue2:<br>goto DoAgain<br>GetOut:<br>FindClose $1<br><br>SectionEnd<br><br>;--------------------------------<br>; Functions<br><br><br>Function KillDir<br>StrCmp $1 "." skip<br>StrCmp $1 ".." skip<br>StrCmp $1 "DontKillMe" skip<br>RMDIR /r $INSTDIR\$1<br><br>MessageBox MB_OKCANCEL|MB_ICONEXCLAMATION "Killed the directory $1" IDOK skip<br>skip:<br><br>FunctionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">shantanu_gadgil</span><br><span class="post-time small text-muted">22nd September 2004 19:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi stonkers:<br><br>Read your code to remove all but one dir...:)<br><br>Optimized it and made it into a function. :)<br><br>Modular coding and all...you know :)<br><br>There are a bunch of messageboxes for "debugging" purposes :)<br><br>Enjoy!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">22nd September 2004 21:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I have re-written both functions (for dirs and files) onto the archive:<br><br><a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=618" target="_blank">http://nsis.sourceforge.net/archive/...b.php?page=618</a><br><br>-Stu</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>