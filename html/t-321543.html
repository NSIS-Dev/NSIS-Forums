<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="${DriveSpace} and some strange values" />

  <title>${DriveSpace} and some strange values - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">${DriveSpace} and some strange values</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=321543">${DriveSpace} and some strange values</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">orecchionebruno</span><br />
      <span class="post-time small text-muted">10th August 2010 14:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>${DriveSpace} and some strange values</strong><br />
      Hi I'm sorry to write again for same problem, but I don't know how solve this problem. May some one can help me.<br />
      <br />
      I encounter a strange problem with some value returned by ${DriveSpace}.<br />
      <br />
      - I get any free space values and this values are corrected. So I get space of my C:\, E:\, D:\, H:\, etc. and any values are corrected<br />
      - If I compare any values that I get by ${DriveSpace}, the conditions actions ${If} works correctly ONLY with an exception. The exception is with my E:\ value.<br />
      <br />
      What I want to say that a script as this, works with any drive excepeted with my "E:\":<br />
      <br />
      ${GetRoot} $MYPATH1 $1<br />
      ${DriveSpace} "$1\" "/D=F /S=B" $1<br />
      <br />
      ${GetRoot} $MYPATH2 $2<br />
      ${DriveSpace} "$2\" "/D=F /S=B" $2"<br />
      <br />
      ${If} "$MYPATH1 " U&gt;= "$MYPATH2"<br />
      MessageBox MB_OK "PATH1 &gt;= PATH2"<br />
      ${Else}<br />
      MessageBox MB_OK "PATH1 &lt; PATH2"<br />
      ${EndIf}<br />
      <br />
      Any one have a suggestion to solve this problem?<br />
      <br />
      Thanksss<br />
      Bruno</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">10th August 2010 20:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You know you're performing an Unsigned Integer comparison between the paths you specify ($MYPATH1 and $MYPATH2), right? I would suspect that you'd want to perform that comparison between the drive sizes returned by ${DriveSpace}, which you're storing in $1 and $2</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">orecchionebruno</span><br />
      <span class="post-time small text-muted">11th August 2010 10:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Animaether, I'm sorry upper I made a mistake translating my variables. I correct the script, but the problem that I wrote is that happens.<br />
      <br />
      ${GetRoot} $MYPATH1 $1<br />
      ${DriveSpace} "$1\" "/D=F /S=B" $FreeSpace1<br />
      <br />
      ${GetRoot} $MYPATH2 $2<br />
      ${DriveSpace} "$2\" "/D=F /S=B" $FreeSpace2<br />
      <br />
      ${If} "$FreeSpace1" U&gt;= "$FreeSpace2"<br />
      MessageBox MB_OK "PATH1 &gt;= PATH2"<br />
      ${Else}<br />
      MessageBox MB_OK "PATH1 &lt; PATH2"<br />
      ${EndIf}<br />
      <br />
      Regarding the reason to use Unsigned Integer comparison with free space, this is because I obtain different results with other drives if I use it or not.<br />
      <br />
      For example if I compare C:\ and D:\ free space (..and both are hard disk), the comparison with Unsigned Integerworks correctly but doens't work correclty with E:\. But I make same comparison without Unsigned Integer, the good result is with E:\ but is wrong with D:\.<br />
      <br />
      In any case, the values that DriveSpace get are apparently correct so I mean that I can read right free space if I put that values on MessageBox. The problem is only with comparison.<br />
      <br />
      Now I'm reading this your suggestion:<br />
      http://forums.winamp.com/showthread.php?t=321260&amp;highlight=%24{DriveSpace}<br />
      and I want change way to get the free space and to compare as in that example:<br />
      System::Int64Op $2 &gt; $0<br />
      <br />
      thankss again, I write my results<br />
      Ciaoo<br />
      <br />
      Bruno</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">11th August 2010 10:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by orecchionebruno</small><br />
        Regarding the reason to use Unsigned Integer comparison with free space, this is because I obtain different results with other drives if I use it or not.<br />
        <br />
        For example if I compare C:\ and D:\ free space (..and both are hard disk), the comparison with Unsigned Integerworks correctly but doens't work correclty with E:\. But I make same comparison without Unsigned Integer, the good result is with E:\ but is wrong with D:\.
      </blockquote>This is an incredibly wrong reason to use Uint compare. You should use Uint compare when you have two Uints. If you have signed ints, you should obviously use signed int compare. It sounds to me like you don't know what kind of ints you have, at all. Figure that out first, THEN you'll know whether you should compare them as ints or as Uints.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">orecchionebruno</span><br />
      <span class="post-time small text-muted">11th August 2010 10:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks MSG,<br />
      <br />
      in effect I don't know wich values I have... :)<br />
      <br />
      I just get any values from {DriveSpace} and I started to use "Unsigned Integer comparison" for the problem that I wrote upper.<br />
      <br />
      So what could be the problem using {DriveSpace} values?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">orecchionebruno</span><br />
      <span class="post-time small text-muted">11th August 2010 11:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've found where is the problem and it looks works...<br />
      <br />
      if I get size in "Byte" the comparison give me the problem that wrote upper BUT if I get values in "KiloBytes" everything works.<br />
      <br />
      So, now the question is "the problem are the quantity of numbers"?<br />
      <br />
      PS: I forgot I used {DriveSpace}</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">orecchionebruno</span><br />
      <span class="post-time small text-muted">11th August 2010 11:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by MSG</small><br />
        Figure that out first, THEN you'll know whether you should compare them as ints or as Uints.
      </blockquote>sorry but in my language "figure" could means different words so I didn't understood what you mean with this sentence.. can you please explain me this again?<br />
      <br />
      Thankss
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">11th August 2010 12:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">To figure something out = to find out, to learn, to investigate.<br />
      <br />
      First you need to know what kind of int you have (signed or unisigned, etc), THEN you can know how to use them.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">11th August 2010 13:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm not sure why either are you are worried about the type of integer comparison test to perform in this case. Unless you've got negative disk space (lol) then you can do an unsigned integer comparison. The unsigned integer comparison here is purely to ignore the sign if one exists. Are you confusing the data type with the comparison? In NSIS integers are just strings; there are no int/uint data types.<br />
      <br />
      Edit: Also how about displaying the actual values in a message box? You may find that you need to do a 64-bit unsigned integer test if the value is too big.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">orecchionebruno</span><br />
      <span class="post-time small text-muted">11th August 2010 15:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">so signed and unsigned means positive or negative numbers?<br />
      <br />
      I write a better way this test:<br />
      <br />
      Drive | free space<br />
      C:\ = 417290768 kb = 427305746432 byte<br />
      D:\ = 443209756 kb = 453846790144 byte<br />
      E:\ = 2616004 kb = 2678788096 byte<br />
      H:\ = 164932 kb = 168890368 byte<br />
      <br />
      Method 1:<br />
      <br />
      section "test"<br />
      StrCpy $0 'C:\'<br />
      ; StrCpy $1 'D:\'<br />
      StrCpy $1 'E:\'<br />
      ; StrCpy $1 'H:\'<br />
      <br />
      System::Call 'kernel32::GetDiskFreeSpaceExA(t, *l, *l, *l) i(r0,.r2,,.)'<br />
      System::Int64Op $2 / 1024 ;convert value in KiloByte<br />
      Pop $2<br />
      StrCpy $4 $2<br />
      <br />
      System::Call 'kernel32::GetDiskFreeSpaceExA(t, *l, *l, *l) i(r1,.r2,,.)'<br />
      System::Int64Op $2 / 1024 ;convert value in KiloByte<br />
      Pop $2<br />
      StrCpy $5 $2<br />
      <br />
      ${If} $4 U&lt; $5<br />
      MessageBox MB_OK "$4 &lt; $5"<br />
      ${Else}<br />
      MessageBox MB_OK "$4 &gt; $5"<br />
      ${EndIf}<br />
      sectionend<br />
      <br />
      Method 2:<br />
      <br />
      section "test"<br />
      StrCpy $1 'C:\'<br />
      ; StrCpy $1 'D:\'<br />
      StrCpy $1 'E:\'<br />
      ; StrCpy $1 'H:\'<br />
      <br />
      <br />
      ;${DriveSpace} "$0\" "/D=F /S=B" $4 ;retrieves value in byte<br />
      ;${DriveSpace} "$1\" "/D=F /S=B" $5 ;retrieves value in byte<br />
      ${DriveSpace} "$0\" "/D=F /S=K" $4 ;retrieves value in Kilobyte<br />
      ${DriveSpace} "$1\" "/D=F /S=K" $5 ;retrieves value in Kilobyte<br />
      <br />
      ${If} $4 U&lt; $5<br />
      MessageBox MB_OK "$4 &lt; $5"<br />
      ${Else}<br />
      MessageBox MB_OK "$4 &gt; $5"<br />
      ${EndIf}<br />
      sectionend<br />
      <br />
      I made this test, and with both methods in conditional script I've obtained this result:<br />
      <br />
      With "${If} $4 U&lt; $5":<br />
      417290768 &gt; 443209756 works (also with &gt;= , &lt;, &lt;=)<br />
      417290768 &gt; 2616004 Works<br />
      417290768 &gt; 164932 Works<br />
      <br />
      427305746432 &gt; 453846790144 Works<br />
      427305746432 &gt; 2678788096 Doesn't work<br />
      427305746432 &gt; 168890368 Works<br />
      <br />
      With "${If} $4 &lt; $5":<br />
      417290768 &gt; 443209756 Works (also with &gt;= , &lt;, &lt;=)<br />
      417290768 &gt; 2616004 Works<br />
      417290768 &gt; 164932 Works<br />
      <br />
      427305746432 &gt; 453846790144 Doesn't work<br />
      427305746432 &gt; 2678788096 works<br />
      427305746432 &gt; 168890368 Works</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">11th August 2010 16:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by orecchionebruno</small><br />
        so signed and unsigned means positive or negative numbers?
      </blockquote>No. Google can tell you the difference between a signed and unsigned int.<br />
      <br />
      Afrow UK is right of course, it shouldn't really matter in this case. The reason why you're seeing different behavior between int and uint compare is that your numbers overflow the 32 bits available to NSIS (you'll find out why this is once you learn the difference between signed and unsigned, btw).<br />
      <br />
      You need to compare with 64 bits precision. You can do this with the system plugin (Int64Op command).
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">orecchionebruno</span><br />
      <span class="post-time small text-muted">11th August 2010 16:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        Are you confusing the data type with the comparison? In NSIS integers are just strings; there are no int/uint data types.
      </blockquote>yes I am, but why If do this, teh condition say that $4 &lt; $5?:<br />
      <br />
      section "test"<br />
      StrCpy $4 427305746432<br />
      StrCpy $5 453846790144<br />
      <br />
      ${If} $4 &lt; $5<br />
      MessageBox MB_OK "True: $4 &lt; $5"<br />
      ${Else}<br />
      MessageBox MB_OK "False: $4 &gt; $5"<br />
      ${EndIf}<br />
      sectionend<br />
      <br />

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        You may find that you need to do a 64-bit unsigned integer test if the value is too big.
      </blockquote>Sorry.. what I have to do? :D if you mean to do the test "64-bit integer tests" and "Unsigned integer tests" included in LogicLib.nsi, I dot it and I passed.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">orecchionebruno</span><br />
      <span class="post-time small text-muted">11th August 2010 16:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by MSG</small><br />
        You need to compare with 64 bits precision. You can do this with the system plugin (Int64Op command).
      </blockquote>thanks now I try ...and I search
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">orecchionebruno</span><br />
      <span class="post-time small text-muted">11th August 2010 17:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thankss this way does what I expected:<br />
      System::Int64Op $4 &lt; $5</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
