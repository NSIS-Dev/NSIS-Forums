<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Help w/ mysql script" />

  <title>Help w/ mysql script - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Help w/ mysql script</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=172715">Help w/ mysql script</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">StanLogan</span><br />
      <span class="post-time small text-muted">9th March 2004 18:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Help w/ mysql script</strong><br />
      Hi,<br />
      <br />
      On a previous thread, there was information about execting a .sql script against mysql. I'm trying this, but having no luck.<br />
      <br />
      I'm running the installer on WindowsME, so I've changed from cmd to command. Also, I've always run mysqld.exe, rather than mysql.exe, so I changed the path to point to that. I confirm that I am executing the statement that I expect to run the script, but basically, nothing happens. Can anyone help? Here's my code:<br />
      <br />
      ; unpack the mysql update<br />
      SetOutPath "$INSTDIR"<br />
      File "schema.sql"<br />
      <br />
      ; execute the update against mysql<br />
      StrCpy $mySQLEXE "C:\mysql\bin\mysqld.exe"<br />
      StrCpy $dbUser "root"<br />
      StrCpy $dbPassword "rootpass"<br />
      StrCpy $dbHost "localhost"<br />
      StrCpy $dbPort "3306"<br />
      MessageBox MB_OK "pre exec"<br />
      nsExec::ExecToStack 'command /C "$mySQLEXE" -u$dbUser -p$dbPassword -h$dbHost -P$dbPort &lt; "$INSTDIR\schema.sql"'<br />
      MessageBox MB_OK "post exec"<br />
      <br />
      Thanks!<br />
      Stan</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Spatacoli</span><br />
      <span class="post-time small text-muted">9th March 2004 18:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I thought that mysqld.exe is the server and mysql.exe is the client. Running the server isn't going to do anything but start mySQL again. I use mysql.exe because I need a client application to run scripts against a server that is already running.<br />
      <br />
      But if I'm wrong do these two things. First, run it from the command line to ensure it works there. Second, try it without all the variables. What I mean is spell out all those variables such as:<br />
      <br />
      nsExec::ExecToStack 'command /C "C:\mysql\bin\mysqld.exe" -u$root -prootpass -hlocalhost -P3306 &lt; "$INSTDIR\schema.sql"'<br />
      <br />
      Good luck</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">StanLogan</span><br />
      <span class="post-time small text-muted">9th March 2004 18:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi,<br />
      <br />
      I started out trying to execute mysql.exe, both before and after I had launched mysqld.exe. It makes sense though that it's client and server - I thought mysql.exe was the non-debug version (it's been almost 2 years since I looked at a local install of mysql - it took me 10 minutes to figure out how to shut it down last night :) ).<br />
      <br />
      I'll go try it from the command line and see what happens.<br />
      <br />
      Stan</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">StanLogan</span><br />
      <span class="post-time small text-muted">9th March 2004 20:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Working from the command line, I found several issues - one was my user was not set up correctly in mysql, and the schema doc itself needed a fix.<br />
      <br />
      Now, it works fine from the command line, like this:<br />
      <br />
      C:\mysql\bin\&gt;mysql.exe -utheuser -pthepass -hlocalhost -P3306 &lt; C:\INSTEST\schema.sql<br />
      <br />
      However, this doesn't work:<br />
      <br />
      nsExec::ExecToLog 'command /C C:\mysql\bin\mysql.exe -utheuser -pthepass -hlocalhost -P3306 &lt; "$INSTDIR\schema.sql"'<br />
      <br />
      Nor does this:<br />
      <br />
      nsExec::ExecToLog 'command /C C:\mysql\bin\mysql.exe -utheuser -pthepass -hlocalhost -P3306 &lt; $INSTDIR\schema.sql'<br />
      <br />
      $INSTDIR is set to C:\INSTEST.<br />
      <br />
      Does anyone have more suggestions?<br />
      <br />
      Thanks,<br />
      Stan</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">9th March 2004 20:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There have been several topics about this subject, please use the search.<br />
      <br />
      &lt; is a feature of the console and not a normal command line syntax.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">StanLogan</span><br />
      <span class="post-time small text-muted">9th March 2004 20:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Joost,<br />
      <br />
      I had read several of the previous posts. I may not have gotten the point, but I did read them :).<br />
      <br />
      I went back and read some more, and here is what I found I needed to do to make it work (on WindowME anyway) - I had to add this line:<br />
      <br />
      ExpandEnvStrings $0 "%COMSPEC%"<br />
      <br />
      to get the actual path to 'command' into $0, and then I quoted that in the statement, like this:<br />
      <br />
      nsExec::ExecToLog '"$0" /C "C:\mysql\bin\mysql.exe" -utheuser -pthepass -hlocalhost -P3306 &lt; "$INSTDIR\schema.sql"'<br />
      <br />
      My question now is, will this form work on all versions of windows?<br />
      <br />
      Thanks for everyone's help.<br />
      Stan</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">9th March 2004 21:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, that should work.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">StanLogan</span><br />
      <span class="post-time small text-muted">9th March 2004 21:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Very good.<br />
      <br />
      Thanks again!<br />
      Stan</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">StanLogan</span><br />
      <span class="post-time small text-muted">12th March 2004 00:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just a clarification here, for future archive searchers.<br />
      <br />
      This line:<br />
      <br />
      nsExec::ExecToLog '"$0" /C "C:\mysql\bin\mysql.exe" -utheuser -pthepass -hlocalhost -P3306 &lt; "$INSTDIR\schema.sql"'<br />
      <br />
      Did not work on Windows XP. The problem seemed to be quoting the path to the executable. It gave an error of 'The filename, directory name or volume label syntax is incorrect'. The working version would be:<br />
      <br />
      nsExec::ExecToLog '"$0" /C C:\mysql\bin\mysql.exe -utheuser -pthepass -hlocalhost -P3306 &lt; "$INSTDIR\schema.sql"'<br />
      <br />
      Enjoy!<br />
      Stan</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
