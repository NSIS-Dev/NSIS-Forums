<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Processes::FindProcess vs. nsProcess::FindProcess vs. FindProcDLL" />

  <title>Processes::FindProcess vs. nsProcess::FindProcess vs. FindProcDLL - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Processes::FindProcess vs. nsProcess::FindProcess vs. FindProcDLL</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=322583">Processes::FindProcess vs. nsProcess::FindProcess vs. FindProcDLL</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">nsnb</span><br />
      <span class="post-time small text-muted">20th September 2010 17:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Processes::FindProcess vs. nsProcess::FindProcess vs. FindProcDLL</strong><br />
      &nbsp; I noticed that there are multiple plug-ins with similar functionality:<br />
      <br />
      <a href="http://nsis.sourceforge.net/FindProcDLL_plug-in" target="_blank">http://nsis.sourceforge.net/FindProcDLL_plug-in</a><br />
      <br />
      <a href="http://nsis.sourceforge.net/Processes_plug-in" target="_blank">http://nsis.sourceforge.net/Processes_plug-in</a><br />
      <br />
      <a href="http://forums.winamp.com/showthread.php?t=230998" target="_blank">http://forums.winamp.com/showthread.php?t=230998</a><br />
      <br />
      My question now is <b>when and why choose one over the other?</b> What are the differences between them? Is one a newer version of another?<br />
      <br />
      I found <a href="http://forums.winamp.com/showthread.php?t=274475" target="_blank">this excellent thread</a> which provides a clue ("FindProcDLL only finds processes of the currently logged in user"), but I haven't found more information.<br />
      <br />
      Could you please shed some light on this?<br />
      <br />
      Thanks.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">20th September 2010 18:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Without looking at the source code, I can guess some use API's that only work prior to Vista or after Windows 98. None of the plug-ins will allow you to find a 64-bit process (because this cannot be done from a 32-bit process unless you use WMI).<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">nsnb</span><br />
      <span class="post-time small text-muted">20th September 2010 19:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        Without looking at the source code, I can guess some use API's that only work prior to Vista or after Windows 98. None of the plug-ins will allow you to find a 64-bit process (because this cannot be done from a 32-bit process unless you use WMI).
      </blockquote>Further investigation suggests that nsProcess by <a href="http://forums.winamp.com/showthread.php?t=230998" target="_blank">Instructor</a> is the newest of all and supports finding a 64-bit process <b>if NSIS itself was built on an x64 system</b>. It doesn't support Unicode, however, which a <a href="http://sourceforge.net/projects/findkillprocuni/files/" target="_blank">recent revision of FindProceDLL</a> does.<br />
      <br />
      The <a href="http://nsis.sourceforge.net/Processes_plug-in" target="_blank">Processes plug-in</a> has an x64 Vista fix, but there is no information about what that fix means.<br />
      <br />
      My conclusion is that <b>nsProcess</b> is the most mature &amp; complete package (except that some reported it triggers their anti-virus software). I can, of course, be mistaken - so if you think otherwise please let me know.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">820815</span><br />
      <span class="post-time small text-muted">20th September 2010 21:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://forums.winamp.com/showthread.php?t=290325" target="_blank">ProcFunc</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">20th September 2010 22:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by nsnb</small><br />
        ...and supports finding a 64-bit process <b>if NSIS itself was built on an x64 system</b>.
      </blockquote>The limitation is because NSIS is 32-bit; it is nothing to do with the platform that NSIS is built on. If NSIS was rebuilt as an x64 binary then we wouldn't have the problem. I think I posted a link on this issue in the LockedList plug-in forum topic while I was trying to find a solution. x64 NSIS is not going to be here any time soon - it'd be a lot of work.<br />
      <br />
      So really there are 2 solutions that I can think of at this time. Use WMI (someone posted a header file in a recent post) or write a 64-bit executable which does what the plug-ins do (you could make it a console application and read its output using nsExec::ExecToStack).<br />
      <br />
      Post 7000 FTW.<br />
      <br />
      Edit: In regards to ProcFunc, it uses CreateToolhelp32Snapshot among others (including the FindProcDLL plug-in). From MSDN CreateToolhelp32Snapshot:<br />

      <blockquote>
        If the specified process is a 64-bit process and the caller is a 32-bit process, this function fails and the last error code is ERROR_PARTIAL_COPY (299).
      </blockquote>Stu
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">razvar</span><br />
      <span class="post-time small text-muted">11th April 2011 11:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can use IssProc (google it). It was made for Inno but works with nsis, even if the setup is 32bit you will get the 64bit processes, dll's or any file type in use (no WMI required)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hnedka</span><br />
      <span class="post-time small text-muted">3rd June 2011 10:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi, I have created a modification of FindProcDLL plugin, because I found out it doesn't work on 64 bit Windows. It's alpha so far, briefly tested (ANSI version not at all). For the time being I don't recommend it for any serious project.<br />
      <br />
      Changes you won't like:<br />
      - removed support for Win9x (too much trouble with it, sorry)<br />
      <br />
      Positive changes:<br />
      - can find 64 bit processes (no WMI)<br />
      - can find processes called like a short path (for example you are looking for Program.exe, but it's called with a short path, so the real process name is e.g. PROGR~1.EXE and you wouldn't find it before)<br />
      - excludes current process from all searches<br />
      <br />
      - you can search for an entire path (or any part of it - from the left), for example:<br /></p>
      <pre>
<code>FindProcDLL</code>::FindProc "C:\Program Files\MyProg\Prog.exe"
<br />&gt;FindProcDLL::FindProc "C:\Program Files" 
</pre>- you can search for a subpath from the right (backslash is expected in the process path right before the searched string):<br />
      <pre>
<code>FindProcDLL</code>::FindProc "MyProg\Prog.exe"
<br />&gt;FindProcDLL::FindProc "Program Files\MyProg\Prog.exe" 
</pre>- integrated KillProc function (all of the above updates apply to it):<br />
      <pre>
<code>FindProcDLL</code>::KillProc "myprog.exe" 
</pre>- added function WaitProcEnd, which waits for a process to exit (doesn't consume any processor time, uses WaitForSingleObject):<br />
      <pre>
<code>
FindProcDLL::WaitProcEnd "myprog.exe" -1 
<br />&gt;
</code>
</pre>the second parameter is timeout, if it is reached, the function returns 100 and doesn't wait for the process (recommended value is -1);<br />
      if there was no process to wait for, 0 is returned, if successfully waited, returns 1<br />
      <br />
      - added function WaitProcStart, which waits until a certain process start (very processor-intensive, timeout is this time used for the polling interval, set at least 250 ms, 500 is better)<br />
      <pre>
<code>
FindProcDLL::WaitProcStart "myprog.exe" 300 
<br />&gt;
</code>
</pre>returns 0 on success<br />
      <br />
      - plugin size is 3.5 kB ;)<br />
      <br />
      All returned values go to $R0, just like in the standard version. I will likely upgrade it soon, if and when I encounter any bugs. Let me know if you find something.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hnedka</span><br />
      <span class="post-time small text-muted">3rd June 2011 10:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Updated the file from the previous post. Can't edit it now, waits for authorization.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">PoRtAbLe_StEaLtH</span><br />
      <span class="post-time small text-muted">9th September 2012 21:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Thank You Sooo Much !!!!!!</strong><br />
      &nbsp;</p>

      <blockquote>
        <small>Originally posted by hnedka</small><br />
        Updated the file from the previous post. Can't edit it now, waits for authorization.
      </blockquote>i have been struggling with this for a few weeks now.. originally.. i thought it was due to CreateMuteX. .. your MOD fixed it!!!!<br />
      <br />
      what a relief :)<br />
      <br />
      thank you sooo much for sharing .. i couldn't have done it ..<br />
      <br />
      <b>P.S.</b><br />
      hnedka's MOD deserves it's own Wiki page ! :up:
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>