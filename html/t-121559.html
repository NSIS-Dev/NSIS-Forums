<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Windows Installer (MSI)" />

  <title>Windows Installer (MSI) - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Windows Installer (MSI)</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=121559">Windows Installer (MSI)</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">isaiahbarney</span><br />
      <span class="post-time small text-muted">15th January 2003 18:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Windows Installer (MSI)</strong><br />
      Will there ever be consideration for support of Windows Installer, .msi, .msm. extensions, etc.<br />
      I would love to help such developement. I am sure others would too.<br />
      A Windows Installer table can be created that is fast and has little overhead. I thought maybe in the future NSIS could include support for .msi functions.<br />
      <br />
      Just a thought.<br />
      :p<br />
      :cool:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">15th January 2003 18:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This kind of a change is quite huge. Let us first finish NSIS 2 :D</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">virtlink</span><br />
      <span class="post-time small text-muted">16th January 2003 18:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">A great idea, but I agree with kichik. By the way, reading msi-files also comes with a lot of changes to the code, and not all functions are supported.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">stb</span><br />
      <span class="post-time small text-muted">22nd March 2006 10:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I thought about MSI again (compare <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=241434" target="_blank">http://forums.winamp.com/showthread....hreadid=241434</a>) and have some ideas to share.<br />
      <br />
      I think, reading MSI might be one thing but the bigger advantage I see would be storing standard NSIS installers as MSI package so companies can use MSI to deploy packages to machines automatically. NSIS support /S (silent) but this does not integrate into Microsoft standard tools.<br />
      <br />
      One basic idea (already posted somewhere) is to build a simple MSI package just containing the installer.exe and calling this on the target machine using some start-up registry key. This would require rebooting.<br />
      <br />
      On other idea: MSI packages can contain COM dlls. We could use a fake COM dll which as DllRegisterServer implemented. This DLL could contain the NSIS installer (data after the code) and the DllregisterServer could extract the installer and run it with /S (silent). This way we could use some static wrapper dll (kind of stub, could be included by NSIS) and don't have to change anything within our installers (I don't want to limit the actions to standard MSI actions, so translation my scripts is no option to me -- that's why I use NSIS). And this would not require reboot (in general). Maybe giving the reboot flag of NSIS back to MSI would be a good idea, too.<br />
      <br />
      The only thing we would need to add to our scripts:<br />
      <br />
      OutFileMsi "myinstaller.msi"<br />
      <br />
      Any more thoughts/ideas out there?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sgt-d</span><br />
      <span class="post-time small text-muted">24th October 2006 21:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">i am dying for a good msi packager and nsis would dominate in this area.<br />
      <br />
      even if it was just an msi that would contain an exe inside and then execute it - that would be better than nothing at all.<br />
      <br />
      right now the only tools out there are total crap, or crippled freeware.<br />
      <br />
      even still, i don't want to learn how to program my installer differently... the exe's i make with nsis can do some very tricky stuff. i don't want to have to figure out how to get everything to work via msi programming just because i am forced to use msi files for active directory installations.<br />
      <br />
      it's bad enough i have to repackage all of my exe's that microsoft now considers "legacy software".<br />
      <br />
      what a crock of sh--!<br />
      <br />
      anyway, any decent workable nsis-msi solution right now would PWN.<br />
      <br />
      thanks,<br />
      <br />
      sgt</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">stb</span><br />
      <span class="post-time small text-muted">26th October 2006 09:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've already build a basic dll implementing DllRegisterServer which runs some EXE. Currently cannot find time to continue this.<br />
      <br />
      One problem is to get the installer to the disk. It cannot be extracted by DllRegisterServer itself because DllRegisterServer does not know the path of the dll itself (without process list tricks). Currently I plan this solution:<br />
      Build an MSI containing EXE and fake-DLL. First extract EXE, then store EXE's path somewhere (registry?), then extract fake-DLL and register it (dll runs EXE).<br />
      <br />
      One more problem: What about reboot? It would be great if the MSI installer knows whether to reboot. So we would have to store the reboot flag when quitting NSIS installer (e.g. registry) and DllRegisterServer or MSI "script" should read this value and see it as MSI reboot flag. Does someone know how reboot in MSI works?<br />
      <br />
      I already tried ORCA (MS Platform SDK) and WiX for building/editing MSI. Had no time to continue here (I think WiX is the better solution).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">26th October 2006 12:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The DLL can figure out its path by saving hInstance in DllMain and then using it with GetModuleFileName. To pass on the reboot flag, you can use the <a href="http://nsis.sourceforge.net/Docs/AppendixD.html#D.1" target="_blank">error level value</a>.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">stb</span><br />
      <span class="post-time small text-muted">12th January 2007 10:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">@kichik: How to get the error level value back to Windows Installer? AFAIK error level is something an exe file will "return" (process attribute). What I want to do is calling DllRegisterServer on some DLL.<br />
      <br />
      I could easily store the reboot flag into registry or in some file. How to get MSI to "read" this?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">12th January 2007 18:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I don't know how MSI handles this. It probably has some kind of ProcessExitCode property in its database.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">16th January 2007 10:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Correct, I've done this. It is a programmers nightmare to do however.<br />
      <br />
      If one one wants to go the NSIS way with MSI packages:<br />
      <br />
      You NEED the ORCA tool from Microsoft and then create an custom action which calls your silent NSIS setup exe.<br />
      <br />
      TIP:<br />
      I think you better start using MAKEMSI ( <a href="http://www.dennisbareis.com/" target="_blank">http://www.dennisbareis.com/</a> ) it free and quite easy to learn.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rossi323</span><br />
      <span class="post-time small text-muted">29th January 2007 10:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hello,<br />
      <br />
      when is it planned to integrate MSI-package creation into NSIS?<br />
      <br />
      now we have running our setup-routines under nullsoft, but for Windows Vista Certification, we aspire in the next half year, we need MSI packages.<br />
      <br />
      it will save a lot of work to us, when not to reorganize our setups.<br />
      <br />
      Thanks in advance<br />
      Thomas</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">29th January 2007 11:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">... "but for Windows Vista Certification, we aspire in the next half year, we need MSI packages"...<br />
      <br />
      "aspire" ? I'm more tempted to say you are forced by Microsoft. Note that not even all their Windows Vista apps come in MSI packages.<br />
      <br />
      Note that MSI is very limited to what an installer should do (not taking into account custom action ofcourse)<br />
      <br />
      Anyhow, feel free to help improving NSIS and MSI combination by writing your efforts and solution in a Wiki.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
