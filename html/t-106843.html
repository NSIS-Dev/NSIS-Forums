<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="When to register locked font?"><title>When to register locked font? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">When to register locked font?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=106843">When to register locked font?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">SprinklerHead</span><br><span class="post-time small text-muted">24th September 2002 18:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>When to register locked font?</strong><br>If a font file is locked and you have to do a reboot to update it, when do you call RegisterFont? Is it ok to call RegisterFont right after the Rename call, like this...<br><br>SetOutPath $TEMP<br>GetTempFileName $R1<br>file /oname=$R1 "${FilesDir}${FONT_NAME}"<br>Rename /REBOOTOK $R1 $WINDIR\Fonts\${FONT_NAME}<br>fonts::registerFont "$WINDIR\Fonts\${FONT_NAME}"<br><br>It seems like it should work, since the old font file is there still. The reason I ask is because it seems like half the time my installation works fine, but the other half the fonts aren't right. I am having a really hard time with the font installation for some reason.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">24th September 2002 19:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Have you tried unregistering the old font first?<br><br>Registering/unregistering is only for the current session, for the font to be loaded everytime you need to write some registry entries as you already know. You also need to send WM_FONTCHANGE using SendMessageTimeour. With NSIS just write SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0 /TIMEOUT=5000. This is only possible with the newest version of NSIS from the CVS. Maybe after you unregister the font and send this message you will be able to replace the font without a reboot.<br><br>If this doesn't work and you do replace the file after reboot, you don't need to call registerFont at all because the registry entries are already there after a reboot.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">SprinklerHead</span><br><span class="post-time small text-muted">24th September 2002 19:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><b>Registering/unregistering is only for the current session, for the font to be loaded everytime you need to write some registry entries as you already know.</b></blockquote>I didn't already know :eek:. It seems to me like you would almost always want the fonts to be loaded everytime - not just for the current session. In fact, I can't think of a time when you wouldn't. Of course, I am not entirely sure what a "session" is either. So what registry keys do I need to add/adjust?<br><br><blockquote><b>Have you tried unregistering the old font first?</b></blockquote>No, but I'll try that. It looks almost like I don't have to call registerfont/unregisterfont in the font.dll at all. Is that the case? These fonts I am trying to install are for my app and I want them to be used permanently.<br><br>So it looks like I need to...<br><br>- unregister the old one<br>- copy the font file<br>- write some registry keys (think I saw this in another post somewhere)<br>- send the system font message<br><br>Is that right? Sorry for being a pain, but I am about to pull all my hair out over this. Seems like I am getting closer though.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">24th September 2002 19:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Registering and unregistering is done so you can use it the font without a reboot. If you don't write the registry keys, which are mentioned in that other thread called "Font", the font won't be loaded after reboot.<br><br></p><blockquote>- unregister the old one<br>- copy the font file<br>- write some registry keys (think I saw this in another post somewhere)<br>- send the system font message</blockquote>You have to register the font after you copy it so you will be able to use it without a reboot. Then you send the message.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">SprinklerHead</span><br><span class="post-time small text-muted">24th September 2002 19:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">OK, I think I got it. Thanks again.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>