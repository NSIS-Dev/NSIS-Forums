<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Another string tokenizer"><title>Another string tokenizer - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Another string tokenizer</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=296562">Another string tokenizer</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">badger101101</span><br><span class="post-time small text-muted">27th August 2008 17:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Another string tokenizer</strong><br>I recently did some work on an installer and came across the need to tokenize a list of strings. I first attempted to use the macro as defined here: <a href="http://nsis.sourceforge.net/Split_strings" target="_blank">http://nsis.sourceforge.net/Split_strings</a> which tokenizes strings of the form "string1" "string2" ... "stringN". One problem with the macro is that it doesn't allow your strings to contain spaces. So I wrote a simple function to parse a string based on a delimiter instead. You may want to convert it into a macro, or even optimize it a bit, but I thought it might be useful for someone.<br><br></p><pre>
<code><br>Function gettoken<br>  Pop $0 ;list of strings<br>  Pop $1 ;desired token number<br>  StrCpy        $R0 0  ;base index<br>  StrCpy        $R1 -1 ;string index<br>  StrCpy        $R3 1  ;iteration<br>  StrLen        $R5 $0<br>  <br>token_nextchar:<br>  IntOp         $R1 $R1 + 1   <br>  IntCmp        $R1 $R5 token_empty 0 0<br>  StrCpy        $R2 $0 1 $R1<br>  StrCmp        $R2 '|' 0 token_nextchar<br>  IntCmp        $R3 $1 token_return token_nexttoken 0<br>token_nexttoken:<br>  IntOp         $R0 $R1 + 1<br>  IntOp         $R3 $R3 + 1<br>  Goto          token_nextchar<br>token_return:<br>  IntOp         $R4 $R1 - $R0<br>  StrCpy        $R2 $0 $R4 $R0<br>  Goto          token_done<br>token_empty:<br>  StrCpy        $R2 "_empty_"<br>token_done:<br>  Push          $R2<br>FunctionEnd<br></code>
</pre><br>
      <br>
      Currently the delimiter is hard-coded to '|' but you could easily make that a parameter. Before calling the function, you need to push both the token number you want returned and the list of strings onto the stack. One caveat to note is that the the list of string needs to have a delimiter at the very end. So an example of a working list of strings would be:<br>
      <br>
      "The United States of America|Japan|Korea|China|"<br>
      <br>
      You can iterate from 1 to N calling the function at each index to tokenize the entire list. The return value is pushed onto the stack. Your iteration can terminate if the return value was "_empty_".
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>