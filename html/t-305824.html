<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Upgrading versions" />

  <title>Upgrading versions - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Upgrading versions</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=305824">Upgrading versions</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">engsoft</span><br />
      <span class="post-time small text-muted">28th April 2009 18:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Upgrading versions</strong><br />
      Hi,<br />
      <br />
      I have a couple of questions that I'm hoping someone could answer for me. We are still using version 2.01 of The NSIS. If we upgrade to the latest version will we have to update our scripts or will they run under the newer version?<br />
      <br />
      Second using the 2.01 I'm building an update to one of our programs. When it's installed over an older version the icon for the desktop and start menu don't update to the newer icon.<br />
      If I change the display settings in XP or Vista then the icon updates. Is there a way to force Windows to update the icon?<br />
      <br />
      Thanks in advance</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">28th April 2009 20:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Some minor mods may be needed, like it would be recommended that you switch to MUI2.nsh<br />
      <br />
      Why not install on another machine and try compiling from there?<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">engsoft</span><br />
      <span class="post-time small text-muted">29th April 2009 17:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the info I set up the newer version on another machine.<br />
      <br />
      In regards to this question,<br />
      <br />
      When it's installed over an older version the icon for the desktop and start menu don't update to the newer icon.<br />
      If I change the display settings in XP or Vista then the icon updates. Is there a way to force Windows to update the icon?<br />
      <br />
      I've read somethings about the RefreshShellIcons<br />
      <br />
      Is this the only way to do this? If it is what is the syntax to force a refresh of a desktop and start menu icon?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">29th April 2009 21:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">From Examples\makensis.nsi (the NSIS install script):<br />
      <br />
      !define SHCNE_ASSOCCHANGED 0x8000000<br />
      !define SHCNF_IDLIST 0<br />
      <br />
      System::Call 'Shell32::SHChangeNotify(i ${SHCNE_ASSOCCHANGED}, i ${SHCNF_IDLIST}, i 0, i 0)'<br />
      <br />
      Edit: Similar code at:<br />
      <a href="http://nsis.sourceforge.net/Refresh_shell_icons" target="_blank">http://nsis.sourceforge.net/Refresh_shell_icons</a><br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">engsoft</span><br />
      <span class="post-time small text-muted">29th April 2009 21:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I can't get it to work for some reason.<br />
      <br />
      Is there anything else I'd need to have in the script for it to work?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">29th April 2009 22:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Are you pointing to an ico file or an exe file?<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">29th April 2009 22:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Please try this code as well:<br /></p>
      <pre>
<code><br />  !define SPI_SETNONCLIENTMETRICS 42<br />  ClearErrors<br />  ReadRegStr $R0 HKCU `Control Panel\Desktop\WindowMetrics` `Shell Icon Size`<br />  IfErrors 0 +2<br />  StrCpy $R0 32<br />  IntOp $R1 $R0 + 1<br />  WriteRegStr HKCU `Control Panel\Desktop\WindowMetrics` `Shell Icon Size` $R1<br />  SendMessage ${HWND_BROADCAST} ${WM_SETTINGCHANGE} ${SPI_SETNONCLIENTMETRICS} 0 /TIMEOUT=10000<br />  WriteRegStr HKCU `Control Panel\Desktop\WindowMetrics` `Shell Icon Size` $R0<br />  SendMessage ${HWND_BROADCAST} ${WM_SETTINGCHANGE} ${SPI_SETNONCLIENTMETRICS} 0 /TIMEOUT=10000<br /></code>
</pre><br />
      <br />
      Edit: if not using MUI, make sure you !include WinMessages.nsh.<br />
      <br />
      Stu
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
