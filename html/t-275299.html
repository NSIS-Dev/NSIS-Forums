<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="InstallOptions fields &quot;move&quot; with different DPIs"><title>InstallOptions fields "move" with different DPIs - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">InstallOptions fields "move" with different DPIs</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=275299">InstallOptions fields "move" with different DPIs</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">arantius</span><br><span class="post-time small text-muted">2nd August 2007 22:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>InstallOptions fields "move" with different DPIs</strong><br>I've set up a page with InstallOptions.dll to involve some paragraphs of text with links embedded right in the middle of them, like you see all over the web.<br><br>I did it by placing the paragraph in full as a label, then positioning a link field of *just* the right size and position to cover up the word that it is "turning into" a link.<br><br>Problem is, even though the docs for IO.dll say that it handles different DPI settings, it doesn't.<br><br>I've attached a file that contains an installer script based on the example included with NSIS, and screenshots of the resulting executable running at 96 and 120 dpi. In 120, the word "link" is off to the left of where it should be, though the position is perfect at the (default) 96 dpi.<br><br>I've searched the forum for just "DPI" and can only find it mentioned in passing. Am I doing something wrong? Can I fix this?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">3rd August 2007 18:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It handles different DPIs by using dialog units for sizes instead of pixels. This way, when you switch to another DPI, you don't have to recalculate how many pixels you need. However, this calculation is not good enough to aim at exactly one letter out a complete sentence as a dialog unit or even a pixel doesn't have a high enough resolution.<br><br>You can calculate the exact location with GetTextExtentPoint32.</p><pre>
<code>!insertmacro MUI_INSTALLOPTIONS_INITDIALOG "ioA.ini"<br>Pop $7<br><br>!insertmacro MUI_INSTALLOPTIONS_READ $8 "ioA.ini" "Field 1" "HWND"<br>!insertmacro MUI_INSTALLOPTIONS_READ $9 "ioA.ini" "Field 3" "HWND"<br><br>System::Call user32::GetDC(ir9)i.r0<br><br>SendMessage $9 ${WM_GETFONT} 0 0 $1<br>System::Call gdi32::SelectObject(ir0,ir1)<br><br>StrCpy $1 "link"<br>StrLen $2 $1<br>System::Call gdi32::GetTextExtentPoint32(ir0,tr1,ir2,*l.r1)<br>System::Int64Op $1 &gt;&gt; 32<br>System::Int64Op $1 &amp; 0xffffffff<br><br>StrCpy $1 "This is a long line with a "<br>StrLen $2 $1<br>System::Call gdi32::GetTextExtentPoint32(ir0,tr1,ir2,*l.r1)<br>System::Int64Op $1 &amp; 0xffffffff<br>System::Call user32::MapWindowPoints(ir9,ir7,*lsr1,i1)<br>System::Int64Op $1 &gt;&gt; 32<br>System::Int64Op $1 &amp; 0xffffffff<br><br>System::Call user32::ReleaseDC(ir0)<br><br>System::Call user32::MoveWindow(ir8,is,is,is,is,i1)<br><br>!insertmacro MUI_INSTALLOPTIONS_SHOW</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">arantius</span><br>
      <span class="post-time small text-muted">3rd August 2007 20:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you very much kichik!</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>