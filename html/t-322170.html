<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="[Help] Regarding Reading/Writing Unicode Files" />

  <title>[Help] Regarding Reading/Writing Unicode Files - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.2/readable/bootstrap.min.css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">[Help] Regarding Reading/Writing Unicode Files</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=322170">[Help] Regarding Reading/Writing Unicode Files</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">GaNi</span><br />
      <span class="post-time small text-muted">3rd September 2010 06:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>[Help] Regarding Reading/Writing Unicode Files</strong><br />
      &nbsp; I was just wandering if there was a possibility to Find and replace strings within a Loaded Unicode File from a ANSI NSIS.<br />
      <br />
      I want to replace the string found with a bunncha big content... or could i import a File(Content) to be replaced with?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br />
      <span class="post-time small text-muted">3rd September 2010 16:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Take a look at my <a href="http://wiz0u.free.fr/prog/nsisFile/" target="_blank">nsisFile plugin</a>.<br />
      You can use it to search and replace any sequence of bytes.<br />
      <br />
      In your case, make sure you specify a sequence of bytes that represents Unicode characters (like 480065006C006C006F00 for "Hello")<br />
      <br />
      Use bin version for ANSI NSIS<br />
      (binU version is for Unicode NSIS)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">gringoloco023</span><br />
      <span class="post-time small text-muted">3rd September 2010 17:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Or you can try this plug-in !<br />
      It's based on the original textreplace plug-in by Instructor but can deal with utf-16LE files.<br />
      <br />
      We have used the replace function for a while now in several projects, but never done much testing on the find function<br />
      <br />
      Just set option /U=1 for UTF-16LE, see the readme for additional details !</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">GaNi</span><br />
      <span class="post-time small text-muted">3rd September 2010 18:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by gringoloco023</small><br />
        Or you can try this plug-in !<br />
        It's based on the original textreplace plug-in by Instructor but can deal with utf-16LE files.<br />
        <br />
        We have used the replace function for a while now in several projects, but never done much testing on the find function<br />
        <br />
        Just set option /U=1 for UTF-16LE, see the readme for additional details !
        <hr />
      </blockquote>
    </div>
    <hr />
    I used UNICODE PLUGIN.<br />
    Unicode(UTF-16LE) -&gt; ANSI Failed.<br />
    <br />
    So i decided to convert UTF-16LE -&gt; UTF-8 and UTF-8 -&gt; ANSI and worked.<br />
    And used text replace on it. :D<br />
    <br />
    Thank you anways. Will try the new plugin now.<br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">GaNi</span><br />
      <span class="post-time small text-muted">3rd September 2010 18:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        Originally Posted by <strong>gringoloco023</strong> (Post 2694742) Or you can try this plug-in !<br />
        It's based on the original textreplace plug-in by Instructor but can deal with utf-16LE files.<br />
        <br />
        We have used the replace function for a while now in several projects, but never done much testing on the find function<br />
        <br />
        Just set option /U=1 for UTF-16LE, see the readme for additional details !
      </blockquote>It correctly reads on Unicode files but doesnt write on Unicode with ANSI NSIS.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">gringoloco023</span><br />
      <span class="post-time small text-muted">3rd September 2010 19:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You confuse me...<br />
      <br />
      Quote:</p>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">GaNi</span><br />
        <span class="post-time small text-muted">4th September 2010 05:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">${textreplace::FillReadBuffer} "$INSTDIR\update\modder\resource\l4d360ui_info.txt" $0<br />
        <br />
        ${textreplace::ReplaceInFile} "$INSTDIR\update\modder\resource\l4d360ui_tu_english.txt" "$INSTDIR\update\modder\resource\l4d360ui_tu_english.txt" "// -- End Game Lobby Changes" "$0" "/U=1 /PO=1" $1<br />
        <br />
        ${textreplace::FreeReadBuffer} "$0"<br />
        ${textreplace::Unload}<br />
        <br />
        ;-------------------------------------------------<br />
        <br />
        ${textreplace::FillReadBuffer} "$INSTDIR\update\modder\resource\ui\l4d360ui\bloginfo.txt" $0<br />
        <br />
        ${textreplace::ReplaceInFile} "$INSTDIR\update\modder\resource\ui\l4d360ui\blogpost.txt" "$INSTDIR\update\modder\resource\ui\l4d360ui\blogpost.txt" "***text02" "$0" "/U=1 /PO=1" $1<br />
        <br />
        ${textreplace::FreeReadBuffer} "$0"<br />
        ${textreplace::Unload}<br />
        <br />
        ;------------------------------------ EOF<br />
        <br />
        <br />
        I tried the ANSI Plugin with newtextreplace.nsh, it didn't replace the file content i needed in the unicode file infact it put some Chinese characters.</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">gringoloco023</span><br />
        <span class="post-time small text-muted">4th September 2010 08:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">I would need the actual text files you are using, to reproduce this.<br />
        <br />
        Could you please zip them up and supply a link ?</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">GaNi</span><br />
        <span class="post-time small text-muted">4th September 2010 09:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"></p>

        <blockquote>
          <small>Originally posted by gringoloco023</small><br />
          I would need the actual text files you are using, to reproduce this.<br />
          <br />
          Could you please zip them up and supply a link ?
        </blockquote>Here they are.<br />
        <br />
        I repeat, i try to implement a whole content of a file(ANSI text file) in these unicode text Files.
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">gringoloco023</span><br />
        <span class="post-time small text-muted">4th September 2010 09:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">There you go, it would basically be impossible to implement a whole content of an ANSI text file into a unicode text Files. You would end up with 'Chinese' characters :) . I suggest you to re-code the ansi text file to unicode first.<br />
        <br />
        As soon as I find some time I will have a look into it as well</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">GaNi</span><br />
        <span class="post-time small text-muted">4th September 2010 09:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"></p>

        <blockquote>
          <small>Originally posted by gringoloco023</small><br />
          There you go, it would basically be impossible to implement a whole content of an ANSI text file into a unicode text Files. You would end up with 'Chinese' characters :) . I suggest you to re-code the ansi text file to unicode first.<br />
          <br />
          As soon as I find some time I will have a look into it as well
        </blockquote>oh lol so you mean ANSI to Unicode doesnt work ?<br />
        <br />
        awright, i will try using unicode to unicode Writing.<br />
        <br />
        Thank you :D<br />
        <br />
        Edit: Even Unicode to unicode failed :(
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">GaNi</span><br />
        <span class="post-time small text-muted">4th September 2010 10:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">I even tried to<br />
        ReadBuffer from a unicode file and paste it over an Unicode file. it copies few texts and fonts change to something else. Donot know what to do-.-</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">gringoloco023</span><br />
        <span class="post-time small text-muted">4th September 2010 23:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Sorry about this (I'm still learning C ). What I done wrong is that it was taking the string length from the handle number, instead of the text file in the buffer.<br />
        <br />
        As well I fixed a bug what was including the BOM into the ReadBuffer, which then ended up in the middle of your resulting text file.<br />
        <br />
        We never used anything else than just replacing basic strings, so I never realized these bugs.<br />
        <br />
        Anyway, it should be fixed now :)</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">GaNi</span><br />
        <span class="post-time small text-muted">10th September 2010 12:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"></p>

        <blockquote>
          <small>Originally posted by gringoloco023</small><br />
          Sorry about this (I'm still learning C ). What I done wrong is that it was taking the string length from the handle number, instead of the text file in the buffer.<br />
          <br />
          As well I fixed a bug what was including the BOM into the ReadBuffer, which then ended up in the middle of your resulting text file.<br />
          <br />
          We never used anything else than just replacing basic strings, so I never realized these bugs.<br />
          <br />
          Anyway, it should be fixed now :)
        </blockquote>thanks, will test now.
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">gringoloco023</span><br />
        <span class="post-time small text-muted">16th October 2010 15:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"><strong>Gani, forgot about you..</strong><br />
        &nbsp; FYI, I totally rewrote the newtextreplace plugin and now there is no problem anymore to replace in one encoding with another encoding. Also the issue with case-insensative for non-ansi characters is solved.<br />
        <br />
        So no more chinese letters for you :)<br />
        <br />
        <a href="http://forums.winamp.com/showthread.php?t=322832&amp;highlight=newtextreplace" target="_blank">http://forums.winamp.com/showthread....newtextreplace</a><br />
        <br />
        please let me know if you have any issues with the plug-in.<br />
        <br />
        regards</p>
      </div>
      <hr />

      <div class="footer">
        <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
      </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
      hljs.initHighlightingOnLoad();
      //]]>
      </script>

      <table cellpadding="6" cellspacing="0" border="0" width="100%">
        <tr>
          <td class="alt2">
            <hr />
            I used UNICODE PLUGIN.<br />
            Unicode(UTF-16LE) -&gt; ANSI Failed.<br />
            <br />
            So i decided to convert UTF-16LE -&gt; UTF-8 and UTF-8 -&gt; ANSI and worked. It's called newtextreplace plug-in, and doesn't need any converting ! It does exactly the same as the textreplace plug-in and is used in the same way, but deals with utf-16 files if you add option /U=1<br />
            <pre>
<code>
  ${textreplace::ReplaceInFile} "C:\input.txt" "C:\output.txt" "abc" "xyz" "/U=1" $0 
<br />&gt;
</code>
</pre>One thing I forgot to mention is that case-insensitive is not working for non-ansi characters. (As we had a need to replace just ansi characters in binary files, and to do case-insensitive in binary files got a bit complicated to the code)<br />

            <blockquote>
              It correctly reads on Unicode files but doesnt write on Unicode with ANSI NSIS.
            </blockquote>Be sure to use the ansi version of the plug-in, 'NewTextReplace_v0.4.1\Ansi\Plugin\newtextreplace.dll'<br />
            Could you send (part of) the script your using
          </td>
        </tr>
      </table>
    </div>
  </div>
</body>
</html>
