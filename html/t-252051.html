<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Problem with install forcing app shutdown - Tried multiple solutions - Please comment" />

  <title>Problem with install forcing app shutdown - Tried multiple solutions - Please comment - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Problem with install forcing app shutdown - Tried multiple solutions - Please comment</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=252051">Problem with install forcing app shutdown - Tried multiple solutions - Please comment</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Webree</span><br />
      <span class="post-time small text-muted">27th July 2006 12:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Problem with install forcing app shutdown - Tried multiple solutions - Please comment</strong><br />
      Hi guys,<br />
      <br />
      I'm trying to force a shutdown of a VB6 application with a system tray icon. The main form is docked above the Windows taskbar (Locked into position and decreases desktop workable area, APPBAR class for those of you who know).<br />
      <br />
      I've tried multiple ways of shutting down the application on Install/Uninstall, I need this implemented effectively for the "Live Update" procedure within my APP.<br />
      <br />
      I've tried the common SendMessage {WM_CLOSE} - and also Takhir's <a href="http://nsis.sourceforge.net/Close_or_Terminate" target="_blank">Find and Close or Terminate Plugin</a><br />
      <br />
      The FCT plugin DOES shut down my toolbar, I get my window space back (It undocks) and every thing shuts down and then restarts once installed.<br />
      <br />
      But... Two problems...<br />
      <br />
      Once in a while I will see a windows error dialog popup (Windows recovered from an error, Send report, dont send report). That's something I really need to avoid...<br />
      <br />
      Also: The System Tray icon remains in the tray. So upon restarting, there are 2 icons present until the ghost one is hovered over.<br />
      <br />
      Perhaps this is something I need to program into my app, but all your comments or alternatives would be appreciated!<br />
      <br />
      Regards,<br />
      Steve</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">27th July 2006 13:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If the icon is still there after you're closing it with the FCT plugin then that means that FCT couldn't close it with WM_CLOSE and terminated it instead.<br />
      <br />
      WM_CLOSE doesn't close the window?<br />
      What if you put End in the closing event in your VB app?<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Webree</span><br />
      <span class="post-time small text-muted">27th July 2006 15:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I tried End... The first time the icon disappeared, but subsequent tries -&gt; Still the same problem.<br />
      <br />
      It's not a consistent thing, which is the most annoying part.<br />
      <br />
      It may show a windows error, it may not.<br />
      It may leave a locked dock space where the toolbar used to be, it may not.<br />
      <br />
      Is it possible to send a call to my app which will trigger a function programmed into my app via NSIS? Then I can program a clean shutdown within the app itself invoked by the installer.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">27th July 2006 17:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Are you sure you aren't meant to remove the icon yourself (i.e. from in the app closing event)?<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">27th July 2006 18:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">We need to clarify the situation. So what I understood. Sometimes FCT closes your application with WM_CLOSE and everything is OK. But termination is still often situation and may cause application internal error (with 'error report' dialog) or may not, in both cases tray icon stays undeleted. The main question is why app's reactions on WM_CLOSE differ? Just tested with 2 old VP apps - works fine. Is your program busy with some tasks? Increase timeout this case. Latest FCT version also includes WM_SYSCOMMAND-SC_CLOSE option, may be this can help.<br />
      About interprocess communication - I not used VB for a long time and not sure what can be implemented, but simple ways are DDE, WM_COPY, Mailslots.<br />
      But I still guess that the best way is to understand why application behavior on WM_CLOSE is so strange.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
