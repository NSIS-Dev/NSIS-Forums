<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Isolated components prevent DLL conflicts" />

  <title>Isolated components prevent DLL conflicts - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Isolated components prevent DLL conflicts</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=217316">Isolated components prevent DLL conflicts</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MrPeacock</span><br />
      <span class="post-time small text-muted">28th May 2005 19:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Isolated components prevent DLL conflicts</strong><br />
      Thought this might be of interest as it is not mentioned in the NSIS manual or the forum ...<br />
      <br />
      from Microsoft knowledgebase <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/msi/setup/isolated_components.asp" target="_blank">http://msdn.microsoft.com/library/de...components.asp</a><br />
      <br />
      Authors of installation packages can specify that the installer copy the shared files (commonly shared DLLs) of an application into that application's folder rather than to a shared location. This private set of files (DLLs) are then used only by the application. Isolating the application together with its shared components in this manner has the following advantages:<br />
      <br />
      The application always uses the versions of the shared files with which it was deployed.<br />
      Installing the application does not overwrite other versions of the shared files by other applications.<br />
      Subsequent installations of other applications using different versions of the shared files cannot overwrite the files used by this application.<br />
      Because the current implementation of COM keeps a single full path in the registry for each CLSID/Context pair, it forces all applications to use the same version of a shared DLL. To enable an application to keep a private copy of a COM server, the system loader in Windows 98 and Windows 2000 checks for the presence of a .LOCAL file in the application's folder. If the system loader detects a <b>.LOCAL file</b>, it alters its search logic to prefer DLLs located in the same folder as the application.<br />
      <br />
      When Windows Installer version 1.1 and later versions execute the IsolateComponents action they copy the files of the component (commonly a shared DLL) specified in the Component_Shared column of the IsolatedComponent table into the same folder as the component (commonly an .exe file) specified in the Component_Application column. The installer creates a file in this directory, zero bytes in length, having the short file name of the key file for Component_Application (typically the name is the same as the application's .exe) appended with .LOCAL. The installer uses the registration for the component in its shared location and does not write any registration information for the copy of the component in the private location. The IsolatedComponent action and table are not available with Windows Installer version 1.0.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">28th May 2005 20:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Please create a <a href="http://nsis.sf.net/wiki" target="_blank">Wiki</a> page.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RossW</span><br />
      <span class="post-time small text-muted">24th November 2006 19:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Does anyone have a code example for this? I'd be very interested to see how exactly this is done.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">25th November 2006 09:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What I could gather from this, is that you need to create an empty file named app.exe.local and put all the COM DLL files in the same directory. You can create that file using FileOpen.<br />
      <br />
      A quick search on my computer showed TortoiseCVS uses that. You can take a look at its <a href="http://tortoisecvs.cvs.sourceforge.net/tortoisecvs/TortoiseCVS/build/TortoiseCVS.iss?revision=1.104&amp;view=markup" target="_blank">installer script</a>. It seems to do nothing more than create that file.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MrPeacock</span><br />
      <span class="post-time small text-muted">25th November 2006 09:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Code example</strong><br />
      This is the interesting part of the script that I mailed to you, I can't tell if everything works as it should however, so no guarantees ! :p<br />
      <br />
      ...<br />
      Section "System" SEC03<br />
      SetOverwrite on<br />
      SetOutPath "$SYS_FOLDER"<br />
      ; RdP: hele directory met DLL, OCX etc. kopieeren naar bijv. \Windows\system32<br />
      File /r "E:\CD\system\"<br />
      ; RdP: LET OP: indien .exe en .dll's in een directory (isolated components),<br />
      ; dan "Zwfina.local" bestand aanmaken en DLL's niet registreren !<br />
      StrCmp $SYS_FOLDER $INSTDIR 0 lblRegistreren<br />
      File "E:\CD\program\${PRODUCT_NAME}.local"<br />
      Return<br />
      <br />
      lblRegistreren:<br />
      ; RdP: registreer VB6 .dll's<br />
      ; RegDLL $SYS_FOLDER\*.dll<br />
      :p :p</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
