<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="${registry::KeyExists} not working"><title>${registry::KeyExists} not working - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">${registry::KeyExists} not working</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=290603">${registry::KeyExists} not working</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">cherdeg</span><br><span class="post-time small text-muted">21st April 2008 09:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>${registry::KeyExists} not working</strong><br>Hi all...<br><br>I seem to get dumber every day...why wouldn't this work? The goal is to Quit if the file or one of the keys is found and to only install if not. The keys defined do both exist in the testing machine's registry.<br><br>!include "Registry.nsh"<br><br>;Check if our Cygwin directory is located on the local machine<br>IfFileExists "$INSTDIR\cygwin.bat" 0 DoInstall<br>MessageBox MB_ICONSTOP "The directory c:\cygwin does already exist. Please first remove any installation of cygwin and then restart this installer..."<br>Quit<br><br>;Check if the standard Cygwin Registry keys exist (x32)<br>${registry::KeyExists} "HKEY_LOCAL_MACHINE\SOFTWARE\Cygnus Solutions" $R0<br>StrCmp $R0 "0" DoInstall ByeReg<br>;Check if the standard Cygwin Registry keys exist (x64)<br>${registry::KeyExists} "HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Cygnus Solutions" $R0<br>StrCmp $R0 "0" DoInstall ByeReg<br><br>;This is the label to jump to if a registy key is found<br>ByeReg:<br>MessageBox MB_ICONSTOP "RegistryKeys for Cygwin exist on this machine. Please first remove any installation of cygwin and then restart this installer..."<br>Quit<br><br>;This is the label to jump to if Cygwin is not installed yet.<br>DoInstall:<br>[...]<br><br>I can't see any error...but e.g. I have no clue which kind of value $R0 does contain - it doesn't seem to be documented anywhere. At least it would be interesting if it is a string or boolean or integer...to know if I should use StrCmp or IntCmp.<br><br>Can anybody help me?<br><br>Regards,<br><br>Chris</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">demiller9</span><br><span class="post-time small text-muted">21st April 2008 10:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It returns a string -- in NSIS they are all strings. You can use StrCmp or IntCmp when the docs say the return codes are 0 and -1.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">cherdeg</span><br><span class="post-time small text-muted">21st April 2008 11:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Okay - strings. Thank you so far. But can you see a problem regarding my code rendering it useless?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">demiller9</span><br><span class="post-time small text-muted">21st April 2008 11:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Is $INSTDIR set when you want to look for the bat file? a messagebox would confirm that.<br><br>What fails? Does it detect when there is no cygwin installation, or does it not detect when there is an installation?<br><br>Try using the short aliases for the registry hives HKLM instead of HKEY_LOCAL_MACHINE. The docs aren't clear whether you can use either or both forms.<br><br>If those suggestions don't help, see if there is a key value to be read. On my computer there are values in "HKCU\Software\Cygnus Solutions\Cygwin\mounts v2" "cygdrive flags".</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">cherdeg</span><br><span class="post-time small text-muted">21st April 2008 12:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The "IfFileExists" part works perfectly - no error there. The only problem occurs when trying to check the registry keys...<br><br>H E C K ! ! !<br><br>...this shitty GOTO-Crap!!! Once again it shit on my head. Nobody with a brain should ever have implemented such a shit into anything!!! Himmelherrgottzack!!!<br><br>Sorry, all. That had to get out. My whole weekend was invested in the debugging of this crap. Right now I found it:<br><br>All the time I looked onto my code as if it was ca "CASE" statement. But of course it has to be shitty GOTOs.<br><br>So nothing of my "${registry::KeyExists}"-code is wrong, it works a suppose. But if the file does not exist, it jumps directly to the DoInstall: and simply skips all of the "${registry::KeyExists}"-code. The right code of course must look like this:<br><br>IfFileExists "$INSTDIR\cygwin.bat" 0 <b>CheckReg</b><br>MessageBox MB_ICONSTOP "The directory c:\cygwin does already exist."<br>Quit<br><br><b>CheckReg</b>:<br>${registry::KeyExists} "HKEY_LOCAL_MACHINE\SOFTWARE\Cygnus Solutions" $R0<br>StrCmp $R0 "0" ByeReg DoInstall<br>${registry::KeyExists} "HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Cygnus Solutions" $R0<br>StrCmp $R0 "0" ByeReg DoInstall<br><br>ByeReg:<br>MessageBox MB_ICONSTOP "RegistryKeys for Cygwin exist on this machine."<br>Quit<br><br>;This is the label to jump to if Cygwin is not installed yet.<br>DoInstall:<br><br>I simply can't jump from the first check to the end but must do all checks sequentially.<br><br>My fault, if you see me somewhere, just kick me (I'll wear a t-shirt expressing this).<br><br>Regards,<br><br>Chris</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">demiller9</span><br><span class="post-time small text-muted">21st April 2008 12:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The logiclib header has SELECT, and SWITCH CASE statements and many other useful keywords. I don't write any scripts without it.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">cherdeg</span><br><span class="post-time small text-muted">21st April 2008 12:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'll definiteley have a look at it for the next version of any of my installers. Many thanks for the hint!</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>