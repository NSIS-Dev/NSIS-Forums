<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="changed command line behaviour for makensisw in v.2.25?" />

  <title>changed command line behaviour for makensisw in v.2.25? - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">changed command line behaviour for makensisw in v.2.25?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=269002">changed command line behaviour for makensisw in v.2.25?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">flizebogen</span><br />
      <span class="post-time small text-muted">5th April 2007 12:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>changed command line behaviour for makensisw in v.2.25?</strong><br />
      Hi,<br />
      <br />
      i compile my scripts by batch file. I use the following code:<br />
      <br />
      start ..\..\NSISCompiler\makensisw.exe /DSOME_DEFINE scriptfile.nsi<br />
      <br />
      Unfortunately the doesn't work anymore in 2.25. It seems to me that makensisw treats every parameter as a filename as therefor fails to open /DSOME_DEFINE.<br />
      <br />
      Can anyone confirm?<br />
      <br />
      Regards<br />
      <br />
      Flizebogen</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">5th April 2007 12:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try:<br />
      start "..\..\NSISCompiler\makensisw.exe" "/DSOME_DEFINE scriptfile.nsi"<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">flizebogen</span><br />
      <span class="post-time small text-muted">5th April 2007 13:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">No that gives only a different error message. This time provided by makensis and not the wrapper</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">5th April 2007 17:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">cmdline behaviour hasnt changed, just tested, works fine for me.<br />
      <br />
      problem on first post:<br />
      the /D switch is interpreted by the "start" command itself, so it won't work. type "start /?" in your cmdline and read :)<br />
      <br />
      problem on the second post:<br />
      afrows solution is right, but you should not call "makensisw.exe" but "makensis.exe"<br />
      makensisw is just a GUI wrapper for the makensis cmdline compiler.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">5th April 2007 23:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">when using start and quoted paths on NT, you need to provide a title aswell (very stupid move by MS)<br />
      <br />
      try: start "" "..\..\NSISCompiler\makensis.exe" /DSOME_DEFINE scriptfile.nsi</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">flizebogen</span><br />
      <span class="post-time small text-muted">6th April 2007 08:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I tested it on a second XP machine and the problem is there too.<br />
      <br />
      There are various reasons for using makensisw instead of the compiler itself.<br />
      <br />
      - Log of compilation is cut off in ms-dos box<br />
      - possibility to recompile<br />
      <br />
      I used the start command to immediate close the dos box.<br />
      <br />
      @anders<br />
      <br />
      Yes the online help for start says the first parameter should be the title but the command is also executed if the title is missing.<br />
      <br />
      @ Afrow UK<br />
      <br />
      If i quote everything than i'm forced to add a title for the "start" command. But this still doesn't work. The error message i get is:<br />
      <br /></p>
      <pre>
<code>Commandlinedefined</code><span style="color: #007700">:</span><span style="color: #DD0000">"SOMEDEFINEscriptname.nsi"
</span>
</pre>If i drop the "start" command and call makensisw directly without quoting i get the following message:<br />
      <br />
      <pre>
<code>MakeNSISv2.25</code><span style="color: #007700">-</span><span style="color: #0000BB">Copyright1995</span><span style="color: #007700">-</span><span style="color: #0000BB">2007Contributors
<br />SeethefileCOPYING</span><span style="color: #007700">for</span><span style="color: #0000BB">licensedetails</span><span style="color: #007700">.
<br /></span><span style="color: #0000BB">CreditscanbefoundintheUsersManual</span><span style="color: #007700">.
<br /><br /></span><span style="color: #0000BB">Cantopenscript</span><span style="color: #DD0000">"/DSOMEDEFINE"
</span>
</pre>If i change the call to makensis.exe then it compiles fine regardless of the not set Title for the "start" command. It also compiles fine if i use the makensisw.exe (v.2.2) from nsis 2.24.<br />
      <br />
      For me this is the prove that makensisw parameter handling is buggy /differs from makensisw.exe v.2.2
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">8th April 2007 16:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Command line handling has changed for MakeNSISw v2.3. It passes `--` to escape the script name now that makensis supports both dash and slash as the switch escape code. Please open a bug report for it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">10th April 2007 12:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">"v2.3" ? possibly since v2.23?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">flizebogen</span><br />
      <span class="post-time small text-muted">10th April 2007 14:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">No<br />
      <br />
      Makensisw.exe v.2.3 is shipped with nsis 2.25<br />
      Makensisw.exe v.2.2 is shipped with nsis 2.24</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">10th April 2007 16:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ah, sorry plus the "w", I never see and use, I need to put of my :cool:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br />
      <span class="post-time small text-muted">31st August 2007 12:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">strange, I have a similar problem with MakeNSISw (Release 2.30)<br />
      <br />
      This doesn't work<br />
      <font size="3"><br /></font></p>
      <pre>
<font size="3"><code>start "" "%NSISDIR%\makensisw.exe" /DABCDEFGHIJKLMNOPQ=1 /DABCDEFGHI=2 Update.nsi<br /><br />MakeNSIS v2.30 - Copyright 1995-2007 Contributors<br />See the file COPYING for license details.<br />Credits can be found in the Users Manual.<br /><br />Processing config: <br />Processing plugin dlls: "C:\Program Files\NSIS\Plugins\*.dll"<br />...</code></font>
</pre><font size="3"><br />
      But this works: (ABCDEFGH instead of ABCDEFGHI)<br /></font>
      <pre>
<font size="3"><code>start "" "%NSISDIR%\makensisw.exe" /DABCDEFGHIJKLMNOPQ=1 /DABCDEFGH=2 Update.nsi<br /><br />MakeNSIS v2.30 - Copyright 1995-2007 Contributors<br />See the file COPYING for license details.<br />Credits can be found in the Users Manual.<br /><br />Command line defined: "ABCDEFGHIJKLMNOPQ=1"<br />Command line defined: "ABCDEFGH=2"<br />Processing config: <br />Processing plugin dlls: "C:\Program Files\NSIS\Plugins\*.dll"<br />...</code></font>
</pre><font size="3"><br />
      <br />
      Seems like a buffer limit to the optional arguments ?</font>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br />
      <span class="post-time small text-muted">31st August 2007 15:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This does not happen if I call makensis.exe directly..<br />
      Any idea ?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">31st August 2007 21:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Both scripts work fine for me. I can't reproduce.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br />
      <span class="post-time small text-muted">3rd September 2007 14:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I tracked the bug down to this:<br />
      The following WORKS:<br /></p>
      <pre>
<code><br />SET Path=C:\123456789<br />"C:\Program Files\NSIS\makensisw.exe" -D12345678901234567890123456789012345 -DBUG Test.nsi<br /></code>
</pre><br />
      The following DOESN'T WORK: (one char LESS in argument)<br />
      <pre>
<code><br />SET Path=C:\123456789<br />"C:\Program Files\NSIS\makensisw.exe" -D1234567890123456789012345678901234 -DBUG Test.nsi<br /></code>
</pre><br />
      <br />
      So just having a char LESS as parameter make it work !<br />
      <br />
      (The link with "start" was that "start" seems to add an additionnal space on the command-line before the first argument)<br />
      <br />
      There seems to be something also with the PATH variable length because if you SET Path=C:\12345678 it seems to work<br />
      <br />
      In my opinion there must be a problem in MakeNSISw argument parser
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br />
      <span class="post-time small text-muted">3rd September 2007 14:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">as it seems to be dependent on the PATH variable length and the argument length, I'm guessing a buffer overflow bug, with a '\0' a bit too far that erase the parsed defines (-D)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">4th September 2007 03:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Both still work for me.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br />
      <span class="post-time small text-muted">4th September 2007 13:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What can I do to track the bug further and provide more information ?<br />
      I don't see what could be wrong in my machine configuration that is causing this, but it is really annoying</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th September 2007 00:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Create a better model for the issue. Does it happen with makensis.exe? If environment variables seem to affect, clear them all and add some until it happens. Delete all files but makensis.exe and makensisw.exe and the stubs and see if it depends on other files. Etc...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br />
      <span class="post-time small text-muted">13th September 2007 13:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I was able to reproduce the problem while debugging <b>MakeNSISw</b> inside Visual Studio, and tracking down the problem through assembly-code... !<br />
      <br />
      So from what I can see, when passing 2 arguments like this:<br /></p>
      <pre>
<code>SET Path=C:\123456789<br />"C:\Program Files\NSIS\makensisw.exe" -D1234567890123456789012345678901234 -DBUG Test.nsi</code>
</pre><br />
      the second time GlobalReAlloc is called (inside AddScriptCmdArgs), it fails (returns 0) with ERROR_NOT_ENOUGH_MEMORY<br />
      <br />
      I have no idea why reallocating to 30 bytes fails however... probably the global heap is not correctly initialized
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br />
      <span class="post-time small text-muted">13th September 2007 15:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">found the problem in MakeNSISw !<br />
      <br /></p>
      <pre>
<code>char *args = (char *) GlobalLock(g_sdata.script_cmd_args);<br />...<br />GlobalUnlock(args);<br /></code>
</pre><br />
      <br />
      it should be<br />
      <pre>
<code>char *args = (char *) GlobalLock(g_sdata.script_cmd_args);<br />...<br />GlobalUnlock(g_sdata.script_cmd_args);<br /></code>
</pre><br />
      <br />
      otherwise the HGLOBAL is not correctly unlocked and the memory block can only be reallocated in-place (which sometimes is not possible =&gt; ERROR_NOT_ENOUGH_MEMORY)<br />
      <br />
      can you fix this ?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">14th September 2007 18:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Please submit the details as a bug report, or even a patch if you have one and I'll look thoroughly into it tomorrow.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br />
      <span class="post-time small text-muted">17th September 2007 09:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">done<br />
      <a href="http://sourceforge.net/tracker/index.php?func=detail&amp;aid=1796053&amp;group_id=22049&amp;atid=373085" target="_blank">http://sourceforge.net/tracker/index...49&amp;atid=373085</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jimpark</span><br />
      <span class="post-time small text-muted">17th September 2007 14:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, I remember seeing this bug while going through my changes. The bug is in utils.cpp in Contrib/Makensisw, in the function CompileNSISScript(). The GlobalAlloc size does not account for the " -- " in the command line. My source code changes for Unicode support fixes this problem both in the ANSI and Unicode version.<br />
      <br />
      <a href="http://www.scratchpaper.com/nsis-05-Sep-2007.csv-setup.exe" target="_blank">http://www.scratchpaper.com/nsis-05-....csv-setup.exe</a> (ANSI)<br />
      <a href="http://www.scratchpaper.com/nsis-05-Sep-2007.cvs-unicode-setup.exe" target="_blank">http://www.scratchpaper.com/nsis-05-...code-setup.exe</a> (Unicode)<br />
      <br />
      Please look at the thread on "Unicode" for more information about these builds.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br />
      <span class="post-time small text-muted">17th September 2007 15:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">note that jimpark points out a bug different than mine, but also linked to command-line parameters.<br />
      (mine is in function AddScriptCmdArgs)<br />
      <br />
      jimpark you should add the description for your bug to my bug report or create a new bug report, for tracking purpose</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
