<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Downloading and executing vcredist_x86.exe if necessary" />

  <title>Downloading and executing vcredist_x86.exe if necessary - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Downloading and executing vcredist_x86.exe if necessary</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=260449">Downloading and executing vcredist_x86.exe if necessary</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Olaf van der Spek</span><br />
      <span class="post-time small text-muted">26th November 2006 18:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Downloading and executing vcredist_x86.exe if necessary</strong><br />
      Hi,<br />
      <br />
      I've got a VC8/2005 app that requires certain DLLs. Those can be installed with vcredist_x86.exe, but that exe is 2.5 mbyte.<br />
      Is there a way to check whether the DLLs are already installed and only download/install them if they're not?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br />
      <span class="post-time small text-muted">26th November 2006 19:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><b>ifFileExists</b> can help you..also check <b>nsisdl</b></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">26th November 2006 20:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Olaf van der Spek - you may also need to download and install Windows Installer 3.1. I recently ran into a need to install the vcredist_x86 you mention, and it pops up an error ("1723") if the system doesn't have WI 3.1. And you'll need to set the switches to block the reboots that both of them want to do.<br />
      <br />
      If you do search for the file(s), be aware that they install do different locations on different versions of the operating system. (That's why they were released as an executable instead of a simpler merge module.)<br />
      <br />
      Don</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Olaf van der Spek</span><br />
      <span class="post-time small text-muted">26th November 2006 21:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I don't like to hard-code paths. Maybe just trying to load the DLLs and checking whether that succeeds is better.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ranahimal</span><br />
      <span class="post-time small text-muted">30th November 2006 12:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Same problem!</strong><br />
      I have same problem regarding vcredist_x86.exe.<br />
      I want to check and install it if necessary...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Adion</span><br />
      <span class="post-time small text-muted">30th November 2006 15:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am also looking for a solution for this.<br />
      At first I tried to see if it would be possible to install the relevant files myself, but it seems very difficult to get them to register correctly.<br />
      So the vcredist_x86.exe also seems the only solution, but I can find 4 instances of msvcr80.dll on my computer, so I also don't know how to check for it being installed correctly.<br />
      <br />
      I would asume though that one version of vcredist_x86.exe only installs one version of msvcr80.dll, so chances are that the location for that specific version will always be the same and can be checked for.<br />
      Anyone has an idea how to find out which version will be in there though?<br />
      <br />
      I also didn't know about Windows Installer. Which version is installed on a standard windows xp installation?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">30th November 2006 16:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I check the registry value HKLM Microsoft\Windows\CurrentVersion\Uninstall\{A49F249F-0C91-497F-86DF-B2585E8E76B7}\DisplayName to see if the redistributable package has been installed. If that value exists then I don't install either exe.<br />
      <br />
      The switches for installing Windows Installer 3.1 would be "WindowsInstaller-KB893803-v2-x86.exe /quiet /norestart" and the switches for the redistributable "VCRedist_x86.exe /Q"<br />
      <br />
      Don</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Olaf van der Spek</span><br />
      <span class="post-time small text-muted">30th November 2006 18:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by demiller9</i><br />
        <b>I check the registry value HKLM Microsoft\Windows\CurrentVersion\Uninstall\{A49F249F-0C91-497F-86DF-B2585E8E76B7}\DisplayName to see if the redistributable package has been installed. If that value exists then I don't install either exe.<br /></b>
      </blockquote>Does that work on XP x64? IA64? Vista?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">30th November 2006 18:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Olaf van der Spek</i><br />
        <b>Does that work on XP x64? IA64? Vista?</b>
      </blockquote>I don't have any of those OS so I can't answer your question.<br />
      <br />
      Don
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br />
      <span class="post-time small text-muted">30th November 2006 18:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I though that you were developers ;)<br />
      <br />
      Don't you guys need MSVCP80.DLL and MSVCR80.DLL?<br />
      <br />
      Find them, if isnot present....download the redist installer...<br />
      <br />
      There are tons of examples of about this tasks...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Adion</span><br />
      <span class="post-time small text-muted">30th November 2006 18:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The problem is of course that you need to be sure of their location.<br />
      Just searching the complete system dir may be slow, and if the version is not correct I think it may even refuse to use that version, so I'm not sure if it is actually that simple :)<br />
      <br />
      I would suppose that the registry check would work on other versions of windows as well, since it's always the x86 version you are installing. I'll try if I can check that tomorrow on Vista 64-bit.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br />
      <span class="post-time small text-muted">30th November 2006 19:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Adion</i><br />
        <b>The problem is of course that you need to be sure of their location.<br />
        Just searching the complete system dir may be slow, and if the version is not correct I think it may even refuse to use that version, so I'm not sure if it is actually that simple :)<br /></b>
      </blockquote>Not necesary, because you'll search for a specific file...<br />
      <br />
      See codeproject <a href="http://www.codeproject.com/cpp/vcredists_x86.asp" target="_blank">article</a>.<br />
      <br />
      It's so simple... I don't know wny the mambo-jumbo thingy :p
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Adion</span><br />
      <span class="post-time small text-muted">11th December 2006 14:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The codeproject article also suggests to try and load a dll to see if the runtimes are already installed.<br />
      In the NSIS documentation I did find out how to call a function from a dll, but I have found nothing about error handling.<br />
      Does anyone know how to check if calling a function failed?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">11th December 2006 17:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Perhaps this code example would be helpful to detect if the runtimes are installed and check the required version.<br /></p>
      <pre>
<code>OutFile "locate_msvcp80.exe"<br />ShowInstDetails show<br /><br />!include "FileFunc.nsh"<br />!include "WordFunc.nsh"<br /><br />!insertmacro Locate<br />!insertmacro VersionCompare<br /><br />!define DLL_VER "8.00.50727.42"<br /><br />Section<br /><br />        StrCpy $1 $WINDIR 3<br />        ${Locate} "$1" "/L=F /M=MSVCP80.DLL /S=0B" "LocateCallback"<br /><br />        IfErrors 0 +2<br />        MessageBox MB_OK "Error" <br />        MessageBox MB_OK '$$R0==$R0'<br /><br />SectionEnd<br /><br />Function LocateCallback<br /><br />        MoreInfo::GetProductVersion "$R9"<br />        Pop $0<br /><br />        ${VersionCompare} "$0" "${DLL_VER}" $R1<br /><br />        StrCmp $R1 0 0 new<br />        messagebox mb_ok 'Found file at location $R9.$\r$\n \<br />        Installed version is $0 required version is ${DLL_VER}. Versions are equal.' idok end<br /><br />      new:<br />        StrCmp $R1 1 0 old<br />        messagebox mb_ok 'Found file at location $R9.$\r$\n \<br />         Installed version is $0 required version is ${DLL_VER}. Installed version is newer.' idok end<br /><br />      old:<br />        StrCmp $R1 2 0 end<br />        messagebox mb_ok 'Found file at location $R9.$\r$\n \<br />         Installed version is $0 required version is ${DLL_VER}. Installed version is older.' idok end<br /><br />     end:<br />        StrCpy "$0" StopLocate<br />        Push "$0"<br /><br />FunctionEnd</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Adion</span><br />
      <span class="post-time small text-muted">11th December 2006 18:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks, I just found the IfErrors function though, so I'm going to test if that works as expected first.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Adion</span><br />
      <span class="post-time small text-muted">14th December 2006 21:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">IfErrors does not seem to catch errors when executing System::Call.<br />
      After checking the output, it seems you can check for an output by comparing the return value of the dll call.<br />
      Maybe this behaviour should be added to the documentation of the System::Call function?<br />
      This seemed to be working for me:<br /></p>
      <pre>
<code>  ;Install runtime<br />  System::Call 'mydll::aTestFunction() i .r0'<br />  StrCmp $0 "error" 0 +3<br />  File "vcredist_x86.exe"<br />  Exec '"$INSTDIR\vcredist_x86.exe" /q'</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">azerger</span><br />
      <span class="post-time small text-muted">8th January 2007 19:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>msvcr80.dll manifest stuff</strong><br />
      Look at this example:<br />
      <a href="http://msdn2.microsoft.com/en-us/library/ms235291" target="_blank">http://msdn2.microsoft.com/en-us/library/ms235291</a>(VS.80).aspx<br />
      <br />
      I'm trying the "Deploying Visual C++ library DLLs as private assemblies" example. So far with no luck though!<br />
      <br />
      I have a win32 app and I just need these dll's, this is the correct way according to MS. Going the path of running the installer etc. is thwart with problems for the end user installations. If you can get this way to work, let me know.<br />
      <br />
      Thanks,<br />
      Art</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">arif.ali.syed</span><br />
      <span class="post-time small text-muted">4th March 2010 15:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Red Wine</i><br />
        <b>Perhaps this code example would be helpful to detect if the runtimes are installed and check the required version.<br /></b>
        <pre>
<b><code>OutFile "locate_msvcp80.exe"<br />ShowInstDetails show<br /><br />!include "FileFunc.nsh"<br />!include "WordFunc.nsh"<br /><br />!insertmacro Locate<br />!insertmacro VersionCompare<br /><br />!define DLL_VER "8.00.50727.42"<br /><br />Section<br /><br />        StrCpy $1 $WINDIR 3<br />        ${Locate} "$1" "/L=F /M=MSVCP80.DLL /S=0B" "LocateCallback"<br /><br />        IfErrors 0 +2<br />        MessageBox MB_OK "Error" <br />        MessageBox MB_OK '$$R0==$R0'<br /><br />SectionEnd<br /><br />Function LocateCallback<br /><br />        MoreInfo::GetProductVersion "$R9"<br />        Pop $0<br /><br />        ${VersionCompare} "$0" "${DLL_VER}" $R1<br /><br />        StrCmp $R1 0 0 new<br />        messagebox mb_ok 'Found file at location $R9.$\r$\n \<br />        Installed version is $0 required version is ${DLL_VER}. Versions are equal.' idok end<br /><br />      new:<br />        StrCmp $R1 1 0 old<br />        messagebox mb_ok 'Found file at location $R9.$\r$\n \<br />         Installed version is $0 required version is ${DLL_VER}. Installed version is newer.' idok end<br /><br />      old:<br />        StrCmp $R1 2 0 end<br />        messagebox mb_ok 'Found file at location $R9.$\r$\n \<br />         Installed version is $0 required version is ${DLL_VER}. Installed version is older.' idok end<br /><br />     end:<br />        StrCpy "$0" StopLocate<br />        Push "$0"<br /><br />FunctionEnd</code></b>
</pre>
      </blockquote>While Compiling this code with latest version of MakeNSISW 2.3<br />
      <br />
      I got following compilation error<br />
      <br />
      !insertmacro: macro "LocateCall" requires 3 parameter(s), passed 5!<br />
      <br />
      <br />
      Apart from that I have another query ....<br />
      <br />
      Say Microsoft has release 3 version of CRT for CRT8.<br />
      I know that if an application need v1 of CRT and if v2 or v3 is there that would work ....<br />
      <br />
      but what if there is no version of CRT8 at all and<br />
      there is CRT9 ..will my app work with that ?<br />
      <br />
      Was i clear? Say i have developed an app with VS 2008 Sp1...<br />
      <br />
      now suppose in future if somebody tries my app... he/she doens;t have VC++ 2008 SP1 runtime but have VC++ 2010 or VC++ 2012 runtime .... will that support my app theoritically.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">arif.ali.syed</span><br />
      <span class="post-time small text-muted">5th March 2010 19:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Can anybody help me compile this code</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kalverson</span><br />
      <span class="post-time small text-muted">14th November 2012 12:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You could roll your own. Here is a helpful link I used.<br />
      <a href="http://blogs.msdn.com/b/astebner/archive/2009/01/29/9384143.aspx" target="_blank">http://blogs.msdn.com/b/astebner/arc...9/9384143.aspx</a></p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
