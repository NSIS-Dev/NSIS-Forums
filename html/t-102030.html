<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="GetFileTime Example" />

  <title>GetFileTime Example - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">GetFileTime Example</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=102030">GetFileTime Example</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dselkirk</span><br />
      <span class="post-time small text-muted">26th August 2002 17:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>GetFileTime Example</strong><br />
      Hey, Basically I need to replace a file only if its newer than the existing one. I can't find any examples using the GetFileTime function. Some help would be appreciated.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">R@m00n</span><br />
      <span class="post-time small text-muted">26th August 2002 17:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here's a small example:<br />
      <br />
      It shows the functionallity of GetFileTime:<br />
      <br />
      Use StrCmp $1 NEWTIME to check if other file or not.<br />
      <br />
      <br />
      OutFile "Setup.exe"<br />
      InstallDir '$PROGRAMFILES\Test'<br />
      <br />
      LoadLanguageFile "../../Contrib/Language Files/German.nlf"<br />
      Caption "Test"<br />
      Name "Test"<br />
      DirText "Test"<br />
      <br />
      Section "Test"<br />
      SetOutPath $INSTDIR<br />
      SectionEnd<br />
      <br />
      Function .onInit<br />
      GetFileTime GetFileTime.nsi $0 $1<br />
      MessageBox MB_OK $0 ; file created<br />
      MessageBox MB_OK $1 ; file last changed<br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dselkirk</span><br />
      <span class="post-time small text-muted">26th August 2002 17:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">thanks for the example. I did something similar to try it but one of the files I tried returned a negative number. An example comparing two file would be more benifical. Thanks again though for your help.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">26th August 2002 17:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">GetFileTime returns two values that are actually one value split in half. There is the low half, and the high half. The high half is "worth" more, to get its real value you need to multiply it by 2^32. NSIS can only handle integers that can hold up to 32 bits, and can't hold this huge numbers, and that's why it is split in two. Because the high part is "worth" more you first need to compare it. If the high part is larger than the other high part the entire number is bound to be higher too. If the high parts are the same, then you need to compare the low parts.<br />
      <br />
      I use IntCmpU because a DWORD is an unsigned long.<br />
      <br /></p>
      <pre>
<span style="color: #007700">!</span><span style="color: #0000BB">defineLOW1</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">deinfeHIGH1</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineLOW2</span><span style="color: #007700">$</span><span style="color: #0000BB">2
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">deinfeHIGH2</span><span style="color: #007700">$</span><span style="color: #0000BB">3
<br />GetFileTime</span><span style="color: #007700">${</span><span style="color: #0000BB">FILENAME</span><span style="color: #007700">}${</span><span style="color: #0000BB">HIGH1</span><span style="color: #007700">}${</span><span style="color: #0000BB">LOW1</span><span style="color: #007700">}
<br /></span><span style="color: #0000BB">GetFileTimeLocal</span><span style="color: #DD0000">"c:\\programfiles\\localfile.dat"</span><span style="color: #007700">${</span><span style="color: #0000BB">HIGH2</span><span style="color: #007700">}${</span><span style="color: #0000BB">LOW2</span><span style="color: #007700">}
<br /></span><span style="color: #0000BB">IntCmpU</span><span style="color: #007700">${</span><span style="color: #0000BB">HIGH1</span><span style="color: #007700">}${</span><span style="color: #0000BB">HIGH2</span><span style="color: #007700">}</span><span style="color: #0000BB">0local_is_neweruser_has_newer
<br /></span><span style="color: #007700">;</span><span style="color: #0000BB">comparelows
<br />IntCmpU</span><span style="color: #007700">${</span><span style="color: #0000BB">LOW1</span><span style="color: #007700">}${</span><span style="color: #0000BB">LOW2</span><span style="color: #007700">}</span><span style="color: #0000BB">0local_is_neweruser_has_newer
<br /></span><span style="color: #007700">;</span><span style="color: #0000BB">fileshasthesametime
<br /></span><span style="color: #007700">Return
<br /><br /></span><span style="color: #0000BB">local_is_newer</span><span style="color: #007700">:
<br />;</span><span style="color: #0000BB">userhasanoldfile</span><span style="color: #007700">,</span><span style="color: #0000BB">installanewerversion
<br />File</span><span style="color: #007700">/</span><span style="color: #0000BB">oname</span><span style="color: #007700">=${</span><span style="color: #0000BB">FILENAME</span><span style="color: #007700">}</span><span style="color: #DD0000">"localfile.dat"
<br /></span><span style="color: #007700">Return
<br /><br /></span><span style="color: #0000BB">user_has_newer</span><span style="color: #007700">:
<br />;</span><span style="color: #0000BB">userhasanewerversion
<br />MessageBoxMB_OK</span><span style="color: #DD0000">"cheater!"
</span>
</pre>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
