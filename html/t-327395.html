<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="[NSISdl] Check downloaded files by some sort of hash" />

  <title>[NSISdl] Check downloaded files by some sort of hash - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">[NSISdl] Check downloaded files by some sort of hash</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=327395">[NSISdl] Check downloaded files by some sort of hash</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Oddsodz</span><br />
      <span class="post-time small text-muted">16th February 2011 05:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>[NSISdl] Check downloaded files by some sort of hash</strong><br />
      Hello all.<br />
      <br />
      Well today I got asked a question about my installer. "What sort of file checking have you in place for the files that get downloaded in your installer"<br />
      <br />
      And to that I had no answer as I have not added any. So I best get something in place.<br />
      <br />
      Here we go.<br />
      <br />
      If you at my .nsi file attached below. You will see that at line 280 to line 286 I use NSISdl to download 7 "prpack.7z" files.<br />
      <br />
      I Then have my installer unpack the files in to the folders that they need to go.<br />
      <br />
      Now what I wish is for some sort of file checking system in place to make sure that the files have downloaded correctly and match a hash that I have already made (not sure how yet). This way I can then insure that the "prpack.7z" files are not corrupted downloading in anyway before unpacking.<br />
      <br />
      Hope this make since.<br />
      <br />
      Anyway. Can anybody point me to the right department? I Have trolled around the forums for a few hours now. And I have failed to fined the right answers.<br />
      <br />
      Hope somebody can help me out and thanks for taking the time to read.<br />
      <br />
      Oddsodz</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">16th February 2011 06:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Have you tried googling for 'nsis md5'?<br />
      <br />
      Also, 7z will already CRC the files upon extraction. If the extraction succeeds, you can be reasonably sure that the files were downloaded correctly.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Oddsodz</span><br />
      <span class="post-time small text-muted">16th February 2011 16:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes. I Did do just that. But it says on the plugin page that it is to<br /></p>

      <blockquote>
        Generates a md5 value from either a string or contents of specified file.
      </blockquote>So it does not "Not check a md5" I think. But I maybe just too dump to see<br />
      <br />
      But the info about the contents of the "7z" files is good to know. Thanks for that. But it is the ".7z" files I want to check before they get unpacked
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">16th February 2011 19:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Oddsodz</small><br />
        So it does not "Not check a md5" I think. But I maybe just too dump to see
      </blockquote>...What? You want the plugin to NOT check the md5? :igor:<br />
      <br />
      Anyway, the md5 plugin does exactly what you need. It calculates the md5hash of a file. You can use strcmp to verify the hash to the official value. (Hint: If you want the installer to be able to verify the 7z file *without* knowing the md5sum at compiletime, you can create a php script that returns the md5hash of the on-server file. Get that using an internet plugin and you'll know what the 7z file hash should be.)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Oddsodz</span><br />
      <span class="post-time small text-muted">16th February 2011 21:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by MSG</small><br />
        ...What? You want the plugin to NOT check the md5? :igor:
      </blockquote>Opps, Looks like I was typing late at night and got that wrong.<br />
      <br />
      What I meant was that the page said that it was for "Generating" and not "Checking" MD5s. Anyway. It don't matter. My spelling is bad anyway.<br />
      <br />
      So you say this will do the trick. Now comes the cruxs. I have no clue what you mean by "strcmp". Sure I know it some sort of code command. But what I forgot to add in my 1st post was that I am a right noob in NSIS. As bad as this is going to sound, I Am going to need a "Noobs" guide. Do you happen to have any links to more up to date pages on the matter?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">16th February 2011 22:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">1. Download the 7z file using inetc (or NSISdl).<br />
      2. Download the hash using inetc/NSISdl to a plain text file in $PLUGINSDIR.<br />
      3. Hash the 7z file using the MD5 plug-in.<br />
      4. Read the hash from the file in $PLUGINSDIR (FileOpen+FileRead+FileClose).<br />
      5. Compare the two hashes (you can use StrCmp (RTFM) or ${If} a == b).<br />
      <br />
      Hopefully that will help you.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
