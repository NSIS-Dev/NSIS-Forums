<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="small problem with DotNET.nsh" />

  <title>small problem with DotNET.nsh - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">small problem with DotNET.nsh</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=304135">small problem with DotNET.nsh</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">casioclave</span><br />
      <span class="post-time small text-muted">13th March 2009 14:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>small problem with DotNET.nsh</strong><br />
      I think you know this script<br />
      <br />
      <br />
      # DotNET version checking macro.<br />
      # Written by AnarkiNet(AnarkiNet@gmail.com) originally, modified by eyal0 (for use in <a href="http://www.sourceforge.net/projects/itwister" target="_blank">http://www.sourceforge.net/projects/itwister</a>)<br />
      # Downloads and runs the Microsoft .NET Framework version 2.0 Redistributable and runs it if the user does not have the correct version.<br />
      # To use, call the macro with a string:<br />
      # !insertmacro CheckDotNET "2"<br />
      # !insertmacro CheckDotNET "2.0.9"<br />
      # (Version 2.0.9 is less than version 2.0.10.)<br />
      # All register variables are saved and restored by CheckDotNet<br />
      # No output<br />
      <br />
      !macro CheckDotNET DotNetReqVer<br />
      !define DOTNET_URL "http://www.microsoft.com/downloads/info.aspx?na=90&amp;p=&amp;SrcDisplayLang=en&amp;SrcCategoryId=&amp;SrcFamilyId=0856eacb-4362-4b0d-8edd-aab15c5e04f5&amp;u=http%3a%2f%2fdownload.microsoft.com%2fdownload%2f5%2f6%2f7%2f567758a3-759e-473e-bf8f-52154438565a%2fdotnetfx.exe"<br />
      DetailPrint "Checking your .NET Framework version..."<br />
      ;callee register save<br />
      Push $0<br />
      Push $1<br />
      Push $2<br />
      Push $3<br />
      Push $4<br />
      Push $5<br />
      Push $6 ;backup of intsalled ver<br />
      Push $7 ;backup of DoNetReqVer<br />
      <br />
      StrCpy $7 ${DotNetReqVer}<br />
      <br />
      System::Call "mscoree::GetCORVersion(w .r0, i ${NSIS_MAX_STRLEN}, *i r2r2) i .r1 ?u"<br />
      <br />
      ${If} $0 == 0<br />
      DetailPrint ".NET Framework not found, download is required for program to run."<br />
      Goto NoDotNET<br />
      ${EndIf}<br />
      <br />
      ;at this point, $0 has maybe v2.345.678.<br />
      StrCpy $0 $0 $2 1 ;remove the starting "v", $0 has the installed version num as a string<br />
      StrCpy $6 $0<br />
      StrCpy $1 $7 ;$1 has the requested verison num as a string<br />
      <br />
      ;MessageBox MB_OKCANCEL "found $0" IDCANCEL GiveUpDotNET<br />
      <br />
      ;MessageBox MB_OKCANCEL "looking for $1" IDCANCEL GiveUpDotNET<br />
      <br />
      ;now let's compare the versions, installed against required &lt;part0&gt;.&lt;part1&gt;.&lt;part2&gt;.<br />
      ${Do}<br />
      StrCpy $2 "" ;clear out the installed part<br />
      StrCpy $3 "" ;clear out the required part<br />
      <br />
      ${Do}<br />
      ${If} $0 == "" ;if there are no more characters in the version<br />
      StrCpy $4 "." ;fake the end of the version string<br />
      ${Else}<br />
      StrCpy $4 $0 1 0 ;$4 = character from the installed ver<br />
      ${If} $4 != "."<br />
      StrCpy $0 $0 ${NSIS_MAX_STRLEN} 1 ;remove that first character from the remaining<br />
      ${EndIf}<br />
      ${EndIf}<br />
      <br />
      ${If} $1 == "" ;if there are no more characters in the version<br />
      StrCpy $5 "." ;fake the end of the version string<br />
      ${Else}<br />
      StrCpy $5 $1 1 0 ;$5 = character from the required ver<br />
      ${If} $5 != "."<br />
      StrCpy $1 $1 ${NSIS_MAX_STRLEN} 1 ;remove that first character from the remaining<br />
      ${EndIf}<br />
      ${EndIf}<br />
      ;MessageBox MB_OKCANCEL "installed $2,$4,$0 required $3,$5,$1" IDCANCEL GiveUpDotNET<br />
      ${If} $4 == "."<br />
      ${AndIf} $5 == "."<br />
      ${ExitDo} ;we're at the end of the part<br />
      ${EndIf}<br />
      <br />
      ${If} $4 == "." ;if we're at the end of the current installed part<br />
      StrCpy $2 "0$2" ;put a zero on the front<br />
      ${Else} ;we have another character<br />
      StrCpy $2 "$2$4" ;put the next character on the back<br />
      ${EndIf}<br />
      ${If} $5 == "." ;if we're at the end of the current required part<br />
      StrCpy $3 "0$3" ;put a zero on the front<br />
      ${Else} ;we have another character<br />
      StrCpy $3 "$3$5" ;put the next character on the back<br />
      ${EndIf}<br />
      ${Loop}<br />
      ;MessageBox MB_OKCANCEL "finished parts: installed $2,$4,$0 required $3,$5,$1" IDCANCEL GiveUpDotNET<br />
      <br />
      ${If} $0 != "" ;let's remove the leading period on installed part if it exists<br />
      StrCpy $0 $0 ${NSIS_MAX_STRLEN} 1<br />
      ${EndIf}<br />
      ${If} $1 != "" ;let's remove the leading period on required part if it exists<br />
      StrCpy $1 $1 ${NSIS_MAX_STRLEN} 1<br />
      ${EndIf}<br />
      <br />
      ;$2 has the installed part, $3 has the required part<br />
      ${If} $2 S&lt; $3<br />
      IntOp $0 0 - 1 ;$0 = -1, installed less than required<br />
      ${ExitDo}<br />
      ${ElseIf} $2 S&gt; $3<br />
      IntOp $0 0 + 1 ;$0 = 1, installed greater than required<br />
      ${ExitDo}<br />
      ${ElseIf} $2 == ""<br />
      ${AndIf} $3 == ""<br />
      IntOp $0 0 + 0 ;$0 = 0, the versions are identical<br />
      ${ExitDo}<br />
      ${EndIf} ;otherwise we just keep looping through the parts<br />
      ${Loop}<br />
      <br />
      ${If} $0 &lt; 0<br />
      DetailPrint ".NET Framework Version found: $6, but is older than the required version: $7"<br />
      Goto OldDotNET<br />
      ${Else}<br />
      DetailPrint ".NET Framework Version found: $6, equal or newer to required version: $7."<br />
      Goto NewDotNET<br />
      ${EndIf}<br />
      <br />
      NoDotNET:<br />
      MessageBox MB_YESNOCANCEL|MB_ICONEXCLAMATION \<br />
      ".NET Framework not installed.$\nRequired Version: $7 or greater.$\nDownload .NET Framework version from <a href="http://www.microsoft.com?" target="_blank">www.microsoft.com?</a>" \<br />
      /SD IDYES IDYES DownloadDotNET IDNO NewDotNET<br />
      goto GiveUpDotNET ;IDCANCEL<br />
      OldDotNET:<br />
      MessageBox MB_YESNOCANCEL|MB_ICONEXCLAMATION \<br />
      "Your .NET Framework version: $6.$\nRequired Version: $7 or greater.$\nDownload .NET Framework version from <a href="http://www.microsoft.com?" target="_blank">www.microsoft.com?</a>" \<br />
      /SD IDYES IDYES DownloadDotNET IDNO NewDotNET<br />
      goto GiveUpDotNET ;IDCANCEL<br />
      <br />
      DownloadDotNET:<br />
      DetailPrint "Beginning download of required .NET Framework version."<br />
      NSISDL::download ${DOTNET_URL} "$TEMP\dotnetfx.exe"<br />
      DetailPrint "Completed download."<br />
      Pop $0<br />
      ${If} $0 == "cancel"<br />
      MessageBox MB_YESNO|MB_ICONEXCLAMATION \<br />
      "Download cancelled. Continue Installation?" \<br />
      IDYES NewDotNET IDNO GiveUpDotNET<br />
      ${ElseIf} $0 != "success"<br />
      MessageBox MB_YESNO|MB_ICONEXCLAMATION \<br />
      "Download failed:$\n$0$\n$\nContinue Installation?" \<br />
      IDYES NewDotNET IDNO GiveUpDotNET<br />
      ${EndIf}<br />
      DetailPrint "Pausing installation while downloaded .NET Framework installer runs."<br />
      ExecWait '$TEMP\dotnetfx.exe /q /c:"install /q"'<br />
      DetailPrint "Completed .NET Framework install/update. Removing .NET Framework installer."<br />
      Delete "$TEMP\dotnetfx.exe"<br />
      DetailPrint ".NET Framework installer removed."<br />
      goto NewDotNet<br />
      <br />
      GiveUpDotNET:<br />
      Abort "Installation cancelled by user."<br />
      <br />
      NewDotNET:<br />
      DetailPrint "Proceeding with remainder of installation."<br />
      Pop $0<br />
      Pop $1<br />
      Pop $2<br />
      Pop $3<br />
      Pop $4<br />
      Pop $5<br />
      Pop $6 ;backup of intsalled ver<br />
      Pop $7 ;backup of DoNetReqVer<br />
      !macroend<br />
      <br />
      <br />
      The problem is:<br />
      I've got a message when my dotNET is older when required<br />
      <br />
      "Your .NET Framework version: .<br />
      Required version: 2 or greater"<br />
      <br />
      So why "Your .NET Framework version: . " is empty?<br />
      Where is an error?<br />
      I whant to show my current version of .NET<br />
      For example "Your .NET Framework version: 1.1"<br />
      And if I have not got .NET at all, I want to show<br />
      "Your .NET Framework version: NOT FOUND " for example</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tossnet</span><br />
      <span class="post-time small text-muted">22nd January 2011 15:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">+1<br />
      I have the same problem on an old Windows 2000 without Framework.NET<br />
      And on a Windows 7 with all framework the message<br /></p>

      <blockquote>
        Your .NET Framework version: 2.0.50727<br />
        Required Version 3.5sp1 or greater<br />
        ...
      </blockquote>Some help please :rolleyes:<br />
      (<i>Maybe is there anothere plug in to detect/install/download FrameWork.net ?</i>)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tossnet</span><br />
      <span class="post-time small text-muted">24th January 2011 16:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I found. If it helps someone one days : <a href="http://stochfit.svn.sourceforge.net/viewvc/stochfit/trunk/StochFitMain/Installer.nsi?revision=108&amp;view=markup" target="_blank">http://stochfit.svn.sourceforge.net/...08&amp;view=markup</a></p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
