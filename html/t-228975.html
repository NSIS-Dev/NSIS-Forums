<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="DumpLog produces empty file"><title>DumpLog produces empty file - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">DumpLog produces empty file</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=228975">DumpLog produces empty file</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">ffletch2</span><br><span class="post-time small text-muted">21st October 2005 15:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>DumpLog produces empty file</strong><br>I have tried calling the DumpLog function (provided in the manual) from inside of all of my already exising sections as well as creating a new hidden section and calling it from there like this:<br>Section "-a hidden section"<br>Push "file.log"<br>Call DumpLog<br>SectionEnd<br><br>No matter what I do it always produces an empty log file. What am I doing wrong or missing?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">21st October 2005 15:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Are you sure it creates the file you're looking at? Try specifying a full path so you'll be sure which file it updates.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ffletch2</span><br><span class="post-time small text-muted">21st October 2005 16:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I tried several different paths as well as several different names. It does produce file in the location I tell it to but the file is always empty.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">21st October 2005 16:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Is that section the first section? Is your installer running in silent mode? Can you attach a complete example? It's a guessing game without a complete example.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ffletch2</span><br><span class="post-time small text-muted">21st October 2005 16:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sorry about that. Sample is attached.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">21st October 2005 16:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You're calling DumpLog on your second section. Nothing is printed to log at that point. Call it on the last section when everything is already printed to the log.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ffletch2</span><br><span class="post-time small text-muted">21st October 2005 16:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok, that worked - thanks.<br><br>2 related questions:<br>- I'd like to write other information either to that log or to the log window like the date and time of install. Is there an quick way to make that happen?<br>- I'd also like to capture the uninstall information to that file. Is there an easy way to do that?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">21st October 2005 16:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Open this file as it's opened in the function and add whatever information you want into it (using FileOpen, FileWrite and FileClose).<br><br>This function might help:<br><a href="http://nsis.sourceforge.net/wiki/Simple_write_text_to_file" target="_blank">http://nsis.sourceforge.net/wiki/Sim...e_text_to_file</a><br><br>To dump the uninstaller log, simply call that function for the uninstaller as well. Make sure you change the file open mode from "w" to "a" so it appends instead of replacing.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ffletch2</span><br><span class="post-time small text-muted">21st October 2005 20:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I have it writing the log to a file. And I am able to append information to the end of the file using the WriteToFile function. I switched the write mode to "a" in the DumpLog function in hopes of appending to the file. It appears that what its doing is writing to the same place in the file leaving everything below what it wrote intact. So if the file says this:<br><br>log start<br>line2<br>line3<br>line4<br>log stop<br>my extra text<br><br>After I uninstall then install again, it then says this:<br><br>log start<br>line2<br>line3<br>line4<br>log stop<br>my extra text<br>my extra text<br><br>So it doesn't appear to be apending, it appears to be putting a pointer at the beginning of the file, writing the log out and if there is anything left if the file after the pointer (which is at the end of the log output) that stays. Is there a way to make the file look like this:<br><br>log start<br>line2<br>line3<br>line4<br>log stop<br>my extra text<br>&lt;2nd install&gt;<br>log start<br>line2<br>line3<br>line4<br>log stop<br>my extra text</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">21st October 2005 20:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You should also seek to the end of the file after opening it in append mode. Use:</p><pre>
<code>FileSeek $0 0 END</code>
</pre>Where $0 should be the open file handle, of course.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ffletch2</span><br><span class="post-time small text-muted">24th October 2005 14:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok so I have everything working but the uninstaller portion. In the past, I have just named all functions that I'm using in the uninstaller by un.&lt;function name&gt;. However in this case I have a function that needs to be used elsewhere. Is there a way to refer to the same function in both uninstall and non-uninstall sections (without simply copying the function and renaming it)?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">24th October 2005 14:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Put the function's code inside a macro and then insert that macro into two functions, one for the installer and one for the uninstaller.</p><pre>
<code>!macro funccode UN<br>Function ${UN}func<br># ... some code...<br>FunctionEnd<br>!macroend<br><br>!insertmacro funccode ""<br>!insertmacro funccode "un."</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ffletch2</span><br>
      <span class="post-time small text-muted">24th October 2005 14:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, got that working. Note that I had to remove Function and EndFunction from within the macro to make it work. So using your example it worked when I made it look like this:<br></p>
      <pre>
<code><br>!macro funccode UN<br># ... some code...<br>!macroend<br><br>!insertmacro funccode ""<br>!insertmacro funccode "un."<br></code>
</pre><br>
      <br>
      Neat idea by the way.<br>
      <br>
      Now my problem is, I call the GetTime Macro in order to write the time to the uninstall log file. This works fine in the installer, but it coughs in the uninstaller because it contains stuff that doesn't start with "un.". I tried the same trick as above but didn't work. Any ideas?
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">24th October 2005 16:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">!macro IncludeGetTime UN<br>
      Function ${UN}GetTime<br>
      ...<br>
      FunctionEnd<br>
      !macroend<br>
      <br>
      !insertmacro IncludeGetTime ""<br>
      !insertmacro IncludeGetTime "un."<br>
      <br>
      !macro GetTime ...<br>
      Call GetTime<br>
      Pop ...<br>
      !macroend<br>
      <br>
      !macro un.GetTime ...<br>
      Call un.GetTime<br>
      Pop ...<br>
      !macroend<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ffletch2</span><br>
      <span class="post-time small text-muted">24th October 2005 16:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Actually, I found un.GetTime and called it instead.<br>
      <br>
      Thanks (again) guys for the help. I've got it all working how I want it now.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>