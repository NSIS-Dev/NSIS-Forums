<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Help with dlls"><title>Help with dlls - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Help with dlls</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=154746">Help with dlls</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">j27lee</span><br><span class="post-time small text-muted">31st October 2003 23:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Help with dlls</strong><br>Hi all,<br><br>I'm trying to call an external dll to validate a CD Key and am not sure the dll is even getting called. Is there a way to test this?<br><br>The dll returns a 1 if the key is valid and a 0 if it is invalid. Here's the section that deals with this.<br><br>SetOutPath $INSTDIR\dll<br>File bin\KeyCheck.dll<br><br>StrCpy $0 "1234567812345678"<br><br>MessageBox MB_OK "CDKEY: $0"<br>System::Call "KeyCheck::isCDKeyValid(t r0) i r1"<br>MessageBox MB_OK "RETURN_CODE after: $1"<br><br>If I run this, I get a MB with "RETURN_CODE: ". So I'm not sure if the dll is even being called. The interface is this:<br><br>INTERFACE bool isCDKeyValid(const char * cdKey);<br><br>any help would be appreciated!<br><br>Thanks,<br><br>James</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">31st October 2003 23:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You forgot the dot before r1. Use:<br><br>System::Call "KeyCheck::isCDKeyValid(t r0) i .r1"<br><br>That dot tells System.dll to ignore the input for the return value (which you should always do beacuse there is no need for input for something that doesn't take any) and treat $1 as the output for the return value.<br><br>BTW, why not create a NSIS plug-in? It would be much easier to use. There are template for more than one programming language in Contrib\ExDLL.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">j27lee</span><br><span class="post-time small text-muted">31st October 2003 23:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks kichik,<br><br>When I add the dot before r1, I get "RETURN_CODE after: error". There is one parameter (r0) unless I'm using this wrong. I noticed a change in syntax from "System::Call "CondMgr::isCDKeyValid(t) i(.r0) .r1" to the current syntax. Am I more off base than I think?<br><br>Is there any way to determine the error? or is that a function of the boolean type?<br><br>As for plugins, I haven't tried, but figured I would try with the dll as it existed. How would the implementation differ? Can they still be used as dlls from other apps?<br><br>Thanks,<br><br>james</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">31st October 2003 23:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If you are using NSIS b3 try adding another SetOutPath line (there is a bug with the current directory setting code). If you are using the latest CVS version, make sure the exported name is exactly the one used in the script. Use Dependency Walker to make sure.<br><br>There is no difference between (t)i (.r0) .r1 and (t .r0) i .r1. It's just System.dll allowing you to override the parameters with another set. It's useful if one wants to define a function using !define. For Example:<br><br>!define MyFunc "MyDLL::MyFunc (t 'default string', i, i 4)"<br>System::Call "${MyFunc} ('another string', 3, )"<br><br>As for the NSIS plug-in, you will be able to keep the other function. You will just need to add another function that NSIS can call that will be a wrapper for the original function.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">j27lee</span><br><span class="post-time small text-muted">3rd November 2003 18:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for your help kichik... i think i understand the whole thing a bit better now. In my case, turns out the dll was to blame.<br><br>Thanks again,<br><br>James</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>