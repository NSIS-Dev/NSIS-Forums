<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="I'd like to export .reg files with NSIS" />

  <title>I'd like to export .reg files with NSIS - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">I'd like to export .reg files with NSIS</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=84359">I'd like to export .reg files with NSIS</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br />
      <span class="post-time small text-muted">10th April 2002 23:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>I'd like to export .reg files with NSIS</strong><br />
      I am in need of a function which creates REG files from a branch with all sub-branches, like exporting using regedit.exe.<br />
      <br />
      And another to import them (althought it can be<br />
      done with "Exec "REGEDIT.EXE /S FILE.REG"".<br />
      <br />
      <br />
      To delete whole branches is easy with this trick:<br />
      <br />
      import this:<br />
      <br />
      REGEDIT4<br />
      <br />
      [-HKEY_CURRENT_USER\Software\Microsoft]<br />
      <br />
      <br />
      I hope some NSIS developer listen to my pray :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br />
      <span class="post-time small text-muted">11th April 2002 07:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Exporting .reg files...<br />
      Is possible but quite complicated in NSIS. Search trees in the registry is not the favorite thing I would do... Isn't this possible using regedit itself? Or search the internet for some small utility that will do this job. I'm sure someone already programmed it...<br />
      <br />
      Good luck,<br />
      -Hendri.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pomflain</span><br />
      <span class="post-time small text-muted">11th April 2002 12:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Re: I'd like to export .reg files with NSIS</strong><br /></p>

      <blockquote>
        <i>Originally posted by n0On3</i><br />
        <b>I am in need of a function which creates REG files from a branch with all sub-branches, like exporting using regedit.exe.<br />
        <br />
        And another to import them (althought it can be<br />
        done with "Exec "REGEDIT.EXE /S FILE.REG"".<br />
        <br />
        <br />
        To delete whole branches is easy with this trick:<br />
        <br />
        import this:<br />
        <br />
        REGEDIT4<br />
        <br />
        [-HKEY_CURRENT_USER\Software\Microsoft]<br />
        <br />
        <br />
        I hope some NSIS developer listen to my pray :)</b>
      </blockquote>It's staring you right in the face...<br />
      <br />
      ExecShell "" FILE.REG<br />
      <br />
      Since the .reg file is file associated in the registry to open with regedit, it will try to import the file. It will prompt you for this, you click Yes, it imports the data in the file to the registry (provided you have the proper permissions, of course).<br />
      <br />
      For deleting the branch, though, I wouldn't try using the method you mentioned above. You should just use DeleteRegKey, that's what it's there for.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br />
      <span class="post-time small text-muted">12th April 2002 18:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">for Pomflain, I didn't know that DeleteRegKey exist, and now I find surprising that NSIS can delete whole branches and can not save them. Anyway, I just wanted to explicit what functions could be added in NSIS regarding the registry, the purpose of the message is to add ExportRegKey as a function :D<br />
      <br />
      ==================<br />
      <br />
      for Smile2Me, before coming here and post the idea I found another program to export from registry -and this is how I am working now- but it's slow, big and not very versatile.<br />
      <br />
      After working with that program for one or two months I decided to post this idea in this forum because I think it's worth the implementation.<br />
      <br />
      Considering the enormous possibilites of NSIS, and that is already working with the Registry I thought it wouldn't be that difficult to implement and would provide more functionality to *the* installation program :cool:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br />
      <span class="post-time small text-muted">12th April 2002 18:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">My advise: Write a small dll that does the job. It's possible in NSIS but really tricky with a lot of if structures. That simply works better in Delphi/C++<br />
      <br />
      -Hendri.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pomflain</span><br />
      <span class="post-time small text-muted">12th April 2002 20:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by n0On3</i><br />
        <b>for Pomflain, I didn't know that DeleteRegKey exist, and now I find surprising that NSIS can delete whole branches and can not save them. Anyway, I just wanted to explicit what functions could be added in NSIS regarding the registry, the purpose of the message is to add ExportRegKey as a function :D<br /></b>
      </blockquote>Well essentially the registry functions are just wrappers for the WIN32 API registry calls. I.E. ReadRegX -&gt; RegOpenKeyEx -&gt; RegQueryValueEx. So as far as a DeleteRegKey, there isn't one. The way you delete a registry tree is the following. You call RegEnumKey and RegEnumValue (EnumRegKey and EnumRegValue in NSIS) to enumerate over the keys in the tree and then RegDeleteValue and RegDeleteKey (DeleteRegValue and DeleteRegKey in NSIS). So you could do the exact same thing in NSIS, exact same programmatically. If you REALLY wanted to have a function to import values from a file, RegLoadKey can do it, but it's limited to creating values in HKEY_USERS or HKEY_LOCAL_MACHINE, no ROOT.<br />
      <br />
      So now back to the original issue. For importing, I'd just do like I said about the ShellExecute of regedit to import the file. If that isn't a viable option and you are importing into HKU or HKLM then you can write a wrapper for RegLoad to import that file.<br />
      <br />
      If you are still having trouble with things and these solutions don't work, I can write you up some .nsi or C code for the source to make these things work, they really aren't as complicated as they might seem.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br />
      <span class="post-time small text-muted">13th April 2002 12:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Pomflain</i><br />
        <b><br />
        <br />
        So as far as a DeleteRegKey, there isn't one.<br />
        <br />
        <br />
        If you REALLY wanted to have a function to import values from a file, RegLoadKey can do it, but it's limited to creating values in HKEY_USERS or HKEY_LOCAL_MACHINE, no ROOT.<br />
        <br />
        So now back to the original issue. For importing,</b>
        <hr />
      </blockquote>
    </div>
    <hr />
    I don't understand you. In the first sentence, are you saying that there's no DeleteRegKey? because, of course, there is, at least in v1.96. If you didn't say that I didn't understand a thing.<br />
    <br />
    <br />
    Well, I don't "REALLY wanted to have a function to import values from a file". What I miss in NSIS is a function to EXPORT to a regfile (you can read this in the thread title). In my first post you can read the command I am using to import: 'Exec "REGEDIT.EXE /S FILE.REG"'<br />
    and it works, so what I need is to export.<br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br />
      <span class="post-time small text-muted">13th April 2002 15:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">As mentioned earlier, it's possible to write some script or function that reads trees of the registry and generates code similar to what regedit produces when exporting to .reg. But actually, this is quite messy in NSIS, because you will need a lot of loops, labels and StrCmp's. So either use the program you were already using or search for some source or program it yourself into a dll file.<br />
      <br />
      [Edit]<br />
      <a href="http://www.google.nl/search?hl=nl&amp;q=export+registry+code&amp;lr=" target="_blank">http://www.google.nl/search?hl=nl&amp;q=...istry+code&amp;lr=</a> might be helpfull.<br />
      [/Edit]<br />
      <br />
      Good luck,<br />
      -Hendri.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pomflain</span><br />
      <span class="post-time small text-muted">14th April 2002 06:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Sorry</strong><br />
      Yeah I meant importing a key, not deleting. I typed the wrong thing. Like I said it's really not all that complicated and doesn't require a whole bunch of loops. I already have a script that does something similar, but it doesn't export to a .reg file, it backs up a registry tree so that it can then be restored back to its original state if the program is uninstalled. If you want me to write you up some NSI scripting code or write you win32 to put into a custome installer or dll, all you have to do is ask.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br />
      <span class="post-time small text-muted">15th April 2002 20:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">for Pomflain,<br />
      <br />
      I'd be glad to use your script which backs up and restores registry tree.<br />
      <br />
      I am using NSIS to run another program which makes use of the registry. I use this program on several computers from a CompactFlash drive, and the program makes changes in the registry every time it runs; so I need to import the regfile, run the program, and on exit save the registry tree.<br />
      <br />
      The thing is that the program I am using now is very bogus and sometimes forgets data.<br />
      <br />
      See you next time :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br />
      <span class="post-time small text-muted">15th April 2002 20:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Quote:</p>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
        <span class="post-time small text-muted">24th April 2002 21:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">I think that a DLL would be faster.</p>
      </div>
      <hr />

      <div class="footer">
        <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
      </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
      hljs.initHighlightingOnLoad();
      //]]>
      </script>

      <table cellpadding="6" cellspacing="0" border="0" width="100%">
        <tr>
          <td class="alt2">
            <hr />
            <i>Originally posted by Smile2Me</i><br />
            <b>As mentioned earlier, it's possible to write some script or function that reads trees of the registry and generates code similar to what regedit produces when exporting to .reg. But actually, this is quite messy in NSIS, because you will need a lot of loops, labels and StrCmp's. So either use the program you were already using or search for some source or program it yourself into a dll file.<br />
            <br />
            Good luck,<br />
            -Hendri.</b> what's faster, the source/dll option, or the NSIS' loops?<br />
            <br />
            Anyway, I think it's messier to use to programs for just one work. :D
          </td>
        </tr>
      </table>
    </div>
  </div>
</body>
</html>
