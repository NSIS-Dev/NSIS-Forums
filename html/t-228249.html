<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="InstallDirRegKey work with (^Name)?" />

  <title>InstallDirRegKey work with (^Name)? - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">InstallDirRegKey work with (^Name)?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=228249">InstallDirRegKey work with (^Name)?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">l_d_allan</span><br />
      <span class="post-time small text-muted">12th October 2005 14:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>InstallDirRegKey work with (^Name)?</strong><br /></p>
      <pre>
<code><br />Name "My Project"<br />... some statements ...<br />InstallDir "$PROGRAMFILES\Project Family\$(^Name)"<br />InstallDirRegKey HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)" "Install_Dir"<br />.... more statements ...<br />WriteRegStr HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)" Install_Dir $INSTDIR<br /></code>
</pre><br />
      InstallDir can resolve (do variable/macro replacement of) $(^Name), as can WriteRegStr, but it doesn't seem like InstallDirRegKey can do this. If the end-user changes the Installation directory from:<br />
      C:\Program Files\Project Family\My Project<br />
      to<br />
      C:\Temp\AlternateName<br />
      then the next installation uses<br />
      C:\Program Files\Project Family\My Project<br />
      <br />
      InstallDirRegKey works ok if I don't use $(^Name):<br />
      <br />
      InstallDirRegKey HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\My Project" "Install_Dir"<br />
      <br />
      Am I doing something wrong or leaving something out? Should I be using an actual variable rather than a "pseudo variable" like Name?<br />
      <br />
      I'm helping a freeware project convert from InstallShield to NSIS, and I believe the original script was generated by the Eclipse plug-in, using the Modern UI.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">12th October 2005 14:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">InstallDirRegKey can not use language strings or variables because it's read before the language tables are initialized. It should say that in the documentation, I'll add it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">l_d_allan</span><br />
      <span class="post-time small text-muted">12th October 2005 14:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks ... you're good!<br />
      <br />
      I have always been incredibly impressed by the support made available on this forum. Oh, that other software was anywhere near as good.<br />
      <br /></p>

      <blockquote>
        InstallDirRegKey can not use language strings or variables because it's read before the language tables are initialized.
      </blockquote>Having said that, is there a technical reason why InstallDirRegKey can't resolve variables, and has to be read before the language tables are initialized? It seems like pretty much everything else can.<br />
      <br />
      If not, perhaps this statement should be forced to be very close to the top as a "clue" that it has to be treated differently?<br />
      <br />
      I was going to look around in the NSIS code to see how the "Check for Update" code worked (to clone into my own project code). Perhaps you (or someone else) could point me where to look, and this behavior could be revised, as applicable. (Just trying to help ... :-)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">12th October 2005 15:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There's no technical reason, only a functional one. InstallDirRegKey is processed before .onInit, so .onInit will be able to check $INSTDIR and manipulate it, if needed. The language table is fully selected only after .onInit, and the earliest place variables can be initialized is .onInit.<br />
      <br />
      Check for update is implemented in Contrib\MakeNSISw\update.cpp. The server backend code is attached.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">l_d_allan</span><br />
      <span class="post-time small text-muted">12th October 2005 15:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks very much for the link to the "Check for Update" code.<br /></p>
      <pre>
<code><br />!define PROJECT_FAMILY "The Family"<br />!define PROJECT_NAME "The Project"<br />Name "${PROJECT_NAME}"<br />; ... some statements ...<br />InstallDir "$PROGRAMFILES\Project Family\${PROJECT_FAMILY}\${PROJECT_NAME}"<br />InstallDirRegKey HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\${PROJECT_FAMILY}\${PROJECT_NAME}" "InstallLocation"<br />; ... some more statements ...<br />WriteRegStr HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\${PROJECT_FAMILY}\${PROJECT_NAME}" InstallLocation $INSTDIR<br /></code>
</pre><br />
      <br />
      The above seems to work ok (preview shows space before " SOFTWARE" which isn't there). My preference is to have one statement to change, and minimize the proliferation of the same information all over the script. Does this seem like a reasonable "work-around", or are there flaws I'm naively overlooking?<br />
      <br />
      The norm in the uninstall "sub-hive" seems to be only one level (${PROJECT_NAME}) rather than multiple levels (${PROJECT_FAMILY}\${PROJECT_NAME}). At least with WinXp, the Add/Remove programs seems to work ok, and reinstallations seem to recognize and use ${PROJECT_FAMILY}\${PROJECT_NAME}.<br />
      <br />
      BTW: I came across the link:<br />
      <a href="http://cvs.sourceforge.net/viewcvs.py/nsis/NSIS/Docs/Attic/AppendixD.html?rev=1.56" target="_blank">http://cvs.sourceforge.net/viewcvs.p....html?rev=1.56</a><br />
      <br />
      which seems to indicate that InstallLocation in the Uninstall "sub-hive" is the preferred place for this information. Seem reasonable?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">12th October 2005 16:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">A define is OK and it's actually the common way of doing this. It's also a liter solution because it involves no runtime code at all.<br />
      <br />
      InstallLocation under a subkey in the Software\Microsoft\Windows\CurrentVeresion\Uninstall is not only the preferred location, but the only possible location as far as I know. The Add/Remove control panel doesn't look in sub-subkeys to the best of my knowledge.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
