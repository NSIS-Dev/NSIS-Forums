<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Return to a custom page" />

  <title>Return to a custom page - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Return to a custom page</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=293037">Return to a custom page</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LordDaimos</span><br />
      <span class="post-time small text-muted">12th June 2008 07:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Return to a custom page</strong><br />
      I have an installer project with two custom pages using InstallOptions. I've gotten it to work pretty well and as satisfied with it but I'm still having one last problem with it. When I go from the first custom page to the next and then press the back button it skips to the page before my first custom page. ie it goes from page three to page one in a single click where I would want it to go to page two.<br />
      <br />
      This is the code for page two<br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">Function</span><span style="color: #0000BB">ServicePage<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">Check</span><span style="color: #007700">if</span><span style="color: #0000BB">SEC01isselected</span><span style="color: #007700">,if</span><span style="color: #0000BB">notthenabort<br />
      SectionGetFlags</span><span style="color: #007700">${</span><span style="color: #0000BB">SEC01</span><span style="color: #007700">}</span><span style="color: #0000BB">$R0<br />
      IntOp$R0$R0</span><span style="color: #007700">&amp;${</span><span style="color: #0000BB">SF_SELECTED</span><span style="color: #007700">}<br /></span> <span style="color: #0000BB">IntCmp$R0</span><span style="color: #007700">${</span><span style="color: #0000BB">SF_SELECTED</span><span style="color: #007700">}</span><span style="color: #0000BB">ShowServicePage<br />
      Abort<br />
      <br />
      ShowServicePage</span><span style="color: #007700">:<br />
      !</span><span style="color: #0000BB">insertmacroMUI_HEADER_TEXT</span><span style="color: #DD0000">"Serviceaccountsetup""Specifytheusernameandpasswordfortheaccountthattheserviceshouldrunas"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_EXTRACT</span><span style="color: #DD0000">"ServiceDialog.ini"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_DISPLAY</span><span style="color: #DD0000">"ServiceDialog.ini"<br /></span> <span style="color: #0000BB">FunctionEnd<br />
      <br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">macroEnableFieldIniFilenameSectionNameEnable<br />
      Push$R0<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_READ$R0</span><span style="color: #DD0000">"${IniFilename}""${SectionName}""HWND"<br /></span> <span style="color: #0000BB">EnableWindow$R0</span><span style="color: #007700">${</span><span style="color: #0000BB">Enable</span><span style="color: #007700">}<br /></span> <span style="color: #0000BB">Pop$R0<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">macroend<br />
      <br /></span> <span style="color: #007700">Function</span><span style="color: #0000BB">ServicePageLeave<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_READ</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"ServiceDialog.ini""Settings""State"<br /></span> <span style="color: #0000BB">IntCmp</span><span style="color: #007700">$</span><span style="color: #0000BB">010NextCheckNextCheck<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroEnableField</span><span style="color: #DD0000">"ServiceDialog.ini""Field3"</span><span style="color: #0000BB">0<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroEnableField</span><span style="color: #DD0000">"ServiceDialog.ini""Field4"</span><span style="color: #0000BB">0<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroEnableField</span><span style="color: #DD0000">"ServiceDialog.ini""Field5"</span><span style="color: #0000BB">0<br />
      Abort<br />
      <br />
      NextCheck</span><span style="color: #007700">:<br /></span> <span style="color: #0000BB">IntCmp</span><span style="color: #007700">$</span><span style="color: #0000BB">020FinishServicePageFinishServicePage<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroEnableField</span><span style="color: #DD0000">"ServiceDialog.ini""Field3"</span><span style="color: #0000BB">1<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroEnableField</span><span style="color: #DD0000">"ServiceDialog.ini""Field4"</span><span style="color: #0000BB">1<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroEnableField</span><span style="color: #DD0000">"ServiceDialog.ini""Field5"</span><span style="color: #0000BB">1<br />
      Abort<br />
      <br />
      FinishServicePage</span><span style="color: #007700">:<br />
      !</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_READ</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"ServiceDialog.ini""Field1""State"<br /></span> <span style="color: #0000BB">IntCmp</span><span style="color: #007700">$</span><span style="color: #0000BB">01SystemAccount<br />
      <br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_READ$SERVICEUSER</span><span style="color: #DD0000">"ServiceDialog.ini""Field2""State"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_READ$SERVICEPASSWORD</span><span style="color: #DD0000">"ServiceDialog.ini""Field4""State"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_READ</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"ServiceDialog.ini""Field4""State"<br /></span> <span style="color: #0000BB">StrCmp$SERVICEPASSWORD</span><span style="color: #007700">$</span><span style="color: #0000BB">00FinishServicePageEnd<br />
      MessageboxMB_ICONEXCLAMATION</span><span style="color: #007700">|</span><span style="color: #0000BB">MB_OK</span><span style="color: #DD0000">"Theinputpassworddoesn'tmatch"<br /></span> <span style="color: #0000BB">Abort<br />
      <br />
      SystemAccount</span><span style="color: #007700">:<br /></span> <span style="color: #0000BB">StrCpy$SERVICEUSER</span><span style="color: #DD0000">""<br /></span> <span style="color: #0000BB">StrCpy$SERVICEPASSWORD</span><span style="color: #DD0000">""<br />
      <br /></span> <span style="color: #0000BB">FinishServicePageEnd</span><span style="color: #007700">:<br /></span> <span style="color: #0000BB">Delete</span><span style="color: #DD0000">"$Pluginsdir\ServiceDialog.ini"<br /></span> <span style="color: #0000BB">FunctionEnd<br /></span></span> <!-- php buffer end -->
      <hr />
      This is the code for page three<br />
      PHP Code:
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">Function</span><span style="color: #0000BB">DatabasePage<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">Check</span><span style="color: #007700">if</span><span style="color: #0000BB">SEC02isselected</span><span style="color: #007700">,if</span><span style="color: #0000BB">notthenabort<br />
      SectionGetFlags</span><span style="color: #007700">${</span><span style="color: #0000BB">SEC02</span><span style="color: #007700">}</span><span style="color: #0000BB">$R0<br />
      IntOp$R0$R0</span><span style="color: #007700">&amp;${</span><span style="color: #0000BB">SF_SELECTED</span><span style="color: #007700">}<br /></span> <span style="color: #0000BB">IntCmp$R0</span><span style="color: #007700">${</span><span style="color: #0000BB">SF_SELECTED</span><span style="color: #007700">}</span><span style="color: #0000BB">ShowDatabasePage<br />
      Abort<br />
      <br />
      ShowDatabasePage</span><span style="color: #007700">:<br /></span> <span style="color: #0000BB">ReserveFile</span><span style="color: #DD0000">"SQLDialog.ini"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_HEADER_TEXT</span><span style="color: #DD0000">"Databasesetup""Specifythenecessaryparameterstoconnecttothedatabase"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_EXTRACT</span><span style="color: #DD0000">"SQLDialog.ini"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_DISPLAY</span><span style="color: #DD0000">"SQLDialog.ini"<br /></span> <span style="color: #0000BB">FunctionEnd<br />
      <br /></span> <span style="color: #007700">Function</span><span style="color: #0000BB">DatabasePageLeave<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_READ$SQLSERVER</span><span style="color: #DD0000">"SQLDialog.ini""Field2""State"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_READ$SQLUSER</span><span style="color: #DD0000">"SQLDialog.ini""Field4""State"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_READ$SQLPASSWORD</span><span style="color: #DD0000">"SQLDialog.ini""Field7""State"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_READ$SQLDATABASE</span><span style="color: #DD0000">"SQLDialog.ini""Field8""State"<br /></span> <span style="color: #0000BB">Delete</span><span style="color: #DD0000">"$TEMP\SQLDialog.ini"<br /></span> <span style="color: #0000BB">FunctionEnd<br /></span></span> <!-- php buffer end -->
      <hr />
      Anyone having any ideas why this happens?<br />
      <br />
      / Karl
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">12th June 2008 11:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Put a MessageBox before the Abort in Function ServicePage and see if you get the message when you click back. If so then it must be calling Abort and jumping over the page.<br />
      <br />
      Also you may want to move your MUI_INSTALLOPTIONS_EXTRACT insertmacros to .onInit as when you do click back and then forward again to the same page you will lose what you had entered/selected previously because the INI file will have been overwritten.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LordDaimos</span><br />
      <span class="post-time small text-muted">13th June 2008 08:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Problem solved, I moved the deleting of the .ini-files to -Post and the extraction to .onInit and it started to work as expected! Thanks!<br />
      <br />
      / Karl</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
