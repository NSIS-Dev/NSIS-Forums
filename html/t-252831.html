<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Internal compiler error while compiling a script"><title>Internal compiler error while compiling a script - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Internal compiler error while compiling a script</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=252831">Internal compiler error while compiling a script</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Phiffi</span><br><span class="post-time small text-muted">8th August 2006 09:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Internal compiler error while compiling a script</strong><br>Hello,<br>I have a problem compiling a script.<br>When I've started the process it compresses the files but after 3 hours the following error appears:<br><a href="http://img145.imageshack.us/img145/9854/nsiserrorod4.jpg" target="_blank">http://img145.imageshack.us/img145/9...iserrorod4.jpg</a><br><br>Perhaps somebody knows a solution.<br><br>Phiffi</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Truth Unknown</span><br><span class="post-time small text-muted">8th August 2006 10:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'm also gettig this error, I've tried replacing the file it stops on.<br><br></p><pre>
<code>Internal compiler error #12345: error mmapping file (1967843348, 33554432) is out of range.<br><br>Note: you may have one or two (large) stale temporary file(s)<br>left in your temporary directory (Generally this only happens on Windows 9x).</code>
</pre><br>
      <br>
      I'm using version 2.19 of NSIS.<br>
      <br>
      EDIT: Should have searched first even when this topic was on the first page. Seems NSIS cant use more than 2.0 GB of data.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Phiffi</span><br>
      <span class="post-time small text-muted">8th August 2006 14:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Oh no. Not more than 2GB? But I have to compile 12GB!<br>
      Do you know what to do in this case?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">8th August 2006 14:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You'll have to include it outside the installer in a compressed file and use ZipDLL to uncompress the file or 7za.exe from <a href="http://www.7-zip.org" target="_blank">www.7-zip.org</a> if you wish to use 7z (LZMA).<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Phiffi</span><br>
      <span class="post-time small text-muted">8th August 2006 14:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">All right, I downloaded the 7z program but what do I have to do now? The script is ready. Do I have to add something to this?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">8th August 2006 15:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You need to add code to extract the 7za.exe executable at run time to $PLUGINSDIR and then run it from there with nsExec::ExecToLog on your 7z file(s).<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Phiffi</span><br>
      <span class="post-time small text-muted">9th August 2006 13:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Could you please tell me which code I have to use and where to add this?<br>
      Perhaps a step-by-step description for noobs.<br>
      My knowledge isn't very big in scripting.<br>
      Thanks!</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">9th August 2006 14:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Use File to extract 7za.exe to $PLUGINSDIR.<br>
      Use nsExec::ExecToLog to execute 7za.exe under a Section with the correct parameters to extract the files from the 7z file.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Phiffi</span><br>
      <span class="post-time small text-muted">9th August 2006 17:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, the only exe-Files I have are 7z.exe; 7zFM.exe and 7zG.exe.<br>
      And where do I have to use "File"? Do you mean the "File" in MakeNSISW? <a href="http://img456.imageshack.us/img456/6386/filedr2.jpg" target="_blank">http://img456.imageshack.us/img456/6386/filedr2.jpg</a><br>
      I don't know which program to use for this operation.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">9th August 2006 18:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">7za.exe is the standalone command-line version of 7-Zip, which you can download from the website.<br>
      <br>
      You have written some NSIS code haven't you?<br>
      I mean File as in the NSIS instruction?<br>
      Look at the NSIS manual!<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Phiffi</span><br>
      <span class="post-time small text-muted">9th August 2006 18:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I found the file command:<br>
      File /oname=$PLUGINSDIR\7za.exe 7za.exe<br>
      Is this correct?<br>
      But I don't know which parameters I have to use for the plugin.<br>
      nsExec::ExecToLog '"${NSISDIR}\7za.exe" /CMDHELP'</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comperio</span><br>
      <span class="post-time small text-muted">10th August 2006 05:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Once you extract the file using the file command, then you launch it with nsEXEC. The purpose of nsEXEC is to run a command-line program, but redirect its output so that you don't see the ugly command window appear.<br>
      <br>
      My suggestion would be to experiment with 7za to determine the proper parameters you'll need. Once you've determined that, then run the same command using nsEXEC. The command should look something like this:<br></p>
      <pre>
<code><br>nsExec::ExecToLog /OEM '"$PLUGINSDIR\7za.exe" [-options]'<br></code>
</pre><br>
      The [-options] part is the command line options you need. (If you are having problems with this, you should consult your 7-zip help manual or try browsing the <a href="http://sourceforge.net/projects/sevenzip/" target="_blank">7-zip SourceForge Project Site</a>) Just don't forget to include any paths in quotes (as shown above and for any folder paths you might need to include as parameters.)<br>
      <br>
      Also, it would be extremely helpful for you too to take the time to lean NSIS a bit better. There's plenty of documentation in the NSIS help (as Afrow suggests) plus more examples/documentation in the NSIS directories. Plus, you can also use the search option of this forum.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Phiffi</span><br>
      <span class="post-time small text-muted">10th August 2006 10:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I searched the 7z help and found the command to extract an archive.<br>
      nsExec::ExecToLog /OEM '"$PLUGINSDIR\7za.exe" [-e]'<br>
      But how do I proceed.<br>
      In the script I created multiple sections to be later able to choice what to install but now I have to use 7z archives instead of the files is that right?<br>
      <br>
      My script looks like that:<br>
      Section "Half-Life 2 (erforderlich)" SEC01<br>
      SetOutPath "$INSTDIR\bin"<br>
      SetOverwrite try<br>
      File "NEUER ORDNER\bin\AdminServer.dll"<br>
      File "NEUER ORDNER\bin\bsppack.dll"<br>
      <br>
      I have to pack all files in one archive and add this in the script, right?:<br>
      Section "Half-Life 2 (erforderlich)" SEC01<br>
      SetOutPath "$INSTDIR\bin"<br>
      SetOverwrite try<br>
      File /oname=$PLUGINSDIR\7za.exe<br>
      nsExec::ExecToLog /OEM '"$PLUGINSDIR\7za.exe" [7za &lt;a&gt; [&lt;-m{LZMA}&gt;] &lt;Half-Life2.7z&gt; [&lt;file_names&gt;...]'<br>
      <br>
      I used -m{LZMA} for compression method LZMA and the parameter &lt;a&gt; to add files to an archive. But I don't know if I can add a complete directory on &lt;file_names&gt;</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">10th August 2006 10:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You don't actually put &lt; or &gt; in there!<br>
      Open up the 7-Zip manual in the Start menu and it has complete details about the command line version (mine does anyway).<br>
      <br>
      Why are you adding files to the archive? You're meant to be extracting them! I think you've got the wrong end of the stick. You compress your files into a 7z file with 7-Zip, include that file with your installer and extract it at run time to $INSTDIR with 7za. Remember, this code is executed at run time when the user runs the installer, <b>not</b> when you compile the installer.<br>
      <br>
      The -m switch does not set the type of compression. -t does that. You don't actually need -t though, because 7za will detect the archive type for you.<br>
      <br></p>
      <pre>
<code>nsExec::ExecToLog /OEM '"$PLUGINSDIR\7za.exe" x "$EXEDIR\Half-Life2.7z" -o"$INSTDIR"'</code>
</pre><br>
      <br>
      -Stu
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Phiffi</span><br>
      <span class="post-time small text-muted">10th August 2006 12:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, I think I get it now.<br>
      I have to compile the archive with these commands:<br>
      <br>
      Section "Half-Life 2 (erforderlich)" SEC01<br>
      SetOutPath "$INSTDIR"<br>
      SetOverwrite try<br>
      File "7za.exe"<br>
      File "Half-Life2.7z"<br>
      nsExec::ExecToLog /OEM '"$PLUGINSDIR\7za.exe" x "$EXEDIR\Half-Life2.7z" -o"$INSTDIR"'<br>
      <br></p>

      <blockquote>
        Remember, this code is executed at run time when the user runs the installer, not when you compile the installer.
      </blockquote>Means this line "nsExec::ExecToLog..." mustn't stand in the script?<br>
      <br>
      Thank you for your patience describing these things to me.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">10th August 2006 12:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can't have<br>
      File "Half-Life2.7z"<br>
      in there, because you said it's 12GB. NSIS installers can't be over 2GB.<br>
      <br>
      No, it doesn't. nsExec::ExecToLog is a run time instruction. Compile time instructions begin with a !<br>
      My point was that your code would <b>create</b> the 7z archive at run time, when you want to <b>extract</b> from it.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Phiffi</span><br>
      <span class="post-time small text-muted">10th August 2006 13:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The files in Half-Life2.7z are just a part of the whole installation and their size is 3.1 GB uncomprimized. Therefore I have to comprimize it with 7zip that the file is smaller than 2 GB. But does it matter that the whole installation-exe would be bigger than 2 GB or one file mustn't be bigger than 2 GB?<br>
      <br>
      How can I add the run time instruction to the script?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">10th August 2006 13:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Anything within Sections or Functions are executed at run time.<br>
      The NSIS installer executable can't be over 2GB. I'm not sure if the files that can be compressed into the installer need to be under 2GB as well.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Phiffi</span><br>
      <span class="post-time small text-muted">10th August 2006 14:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That means I can't add any files into the exe because it would become too big but I can add the install-exe and the 7z files in one folder and tell the install-exe to unpack the 7z files into the install directory with this commands:<br>
      <br>
      Section "Half-Life 2 (erforderlich)" SEC01<br>
      SetOutPath "$INSTDIR"<br>
      SetOverwrite try<br>
      File "7za.exe"<br>
      nsExec::ExecToLog /OEM '"$PLUGINSDIR\7za.exe" x "$EXEDIR\Half-Life2.7z" -o"$INSTDIR"'<br>
      <br>
      But is it okay if I just add the 7za.exe to the install-exe. I mean the users of this installer doesn't have 7za.exe or NSIS.<br>
      Perhaps I just change the path of 7za.exe into:<br>
      <br>
      nsExec::ExecToLog /OEM '"$INSTDIR\7za.exe" x "$EXEDIR\Half-Life2.7z" -o"$INSTDIR"'</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">10th August 2006 14:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It'd be better to just extract 7za.exe to $PLUGINSDIR because $PLUGINSDIR is deleted when the installer is closed. Plus, 7za.exe is 300+ KB so you might as well compress it. Make sure you have "SetCompressor /solid lzma" in your script.<br>
      <br>
      By the way, $PLUGINSDIR isn't the NSIS\Plugins folder! It's a temporary folder created at run time in $TEMP.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Phiffi</span><br>
      <span class="post-time small text-muted">10th August 2006 14:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The right decision would be:<br>
      <br>
      SetOutPath "$PLUGINSDIR"<br>
      SetOverwrite try<br>
      File "7za.exe"<br>
      nsExec::ExecToLog /OEM '"$PLUGINSDIR\7za.exe" x "$EXEDIR\Half-Life2.7z" -o"$INSTDIR"'<br>
      <br>
      Okay?<br>
      <br>
      Another problem: How can I add icons to my shortcuts?<br>
      <br>
      CreateShortCut "$SMPROGRAMS\Half-Life 2.lnk" "$INSTDIR\Half-Life 2.bat"<br>
      CreateShortCut "$DESKTOP\Half-Life 2.lnk" "$INSTDIR\Half-Life 2.bat"</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">10th August 2006 14:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes.<br>
      Just make sure you put InitPluginsDir before SetOutPath just in case $PLUGINSDIR has not yet been created.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">10th August 2006 14:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">See CreateShortcut in the manual.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br>
      <span class="post-time small text-muted">14th August 2006 02:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Like this:<br>
      <br>
      CreateShortCut "$SMPROGRAMS\Half-Life 2.lnk" "$INSTDIR\Half-Life 2.bat" "" "$INSTDIR\youricon.ico"<br>
      CreateShortCut "$DESKTOP\Half-Life 2.lnk" "$INSTDIR\Half-Life 2.bat" "" "$INSTDIR\yourprog.exe"</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Phiffi</span><br>
      <span class="post-time small text-muted">14th August 2006 12:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you all for your great help.<br>
      The installer-exe runs perfectly and the icons for the shortcuts too!</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>