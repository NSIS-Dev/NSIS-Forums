<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="MUI_PAGE_CUSTOMFUNCTION on Windows Vista" />

  <title>MUI_PAGE_CUSTOMFUNCTION on Windows Vista - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">MUI_PAGE_CUSTOMFUNCTION on Windows Vista</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=281809">MUI_PAGE_CUSTOMFUNCTION on Windows Vista</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RegShoe</span><br />
      <span class="post-time small text-muted">20th November 2007 10:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>MUI_PAGE_CUSTOMFUNCTION on Windows Vista</strong><br />
      Hi all,<br />
      I've created an installer which has a custom function call upon leaving a page in the installation progress.<br />
      This is to check if the chosen directory exists already and/or is empty.<br />
      <br />
      This works fine on Windows XP, but on Vista the function is called and executed, but then the installation does not continue. Without this custom function the installation does work on Vista, too.<br />
      <br />
      Here is my code:<br />
      <br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_PAGE_WELCOME<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineMUI_PAGE_CUSTOMFUNCTION_LEAVE</span><span style="color: #DD0000">"DirectoryLeave"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_PAGE_DIRECTORY<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_PAGE_INSTFILES<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_PAGE_FINISH<br />
      <br /></span> <span style="color: #007700">***91;...***93;<br />
      <br />
      Function</span><span style="color: #0000BB">DirectoryLeave<br />
      <br /></span> <span style="color: #007700">${</span><span style="color: #0000BB">DirState</span><span style="color: #007700">}</span><span style="color: #DD0000">"$INSTDIR"</span><span style="color: #0000BB">$R0<br />
      StrCmp$R010</span><span style="color: #007700">+</span><span style="color: #0000BB">2<br />
      MessageBoxMB_OKCANCEL</span><span style="color: #007700">|</span><span style="color: #0000BB">MB_ICONQUESTION</span><span style="color: #DD0000">"Installationdirectory$INSTDIRisnotempty.Setupwilldeleteallexistingfiles.$\n$\nPressOKtocontinueanyway,orpressCANCELtochooseanotherdirectory."</span><span style="color: #0000BB">IDOK_ok<br />
      Abort<br />
      <br />
      _ok</span><span style="color: #007700">:<br /></span> <span style="color: #0000BB">Delete</span><span style="color: #DD0000">"$INSTDIR\*.*"<br />
      <br /></span> <span style="color: #0000BB">FunctionEnd<br /></span></span> <!-- php buffer end -->
      <hr />
      Any help would be appreciated.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">20th November 2007 19:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">+2 skips to the next instruction which is Abort. Abort causes the user to stay on the page. I don't see how that'd work even on XP. Use the LogicLib for easier code.</p>
      <pre>
<code>${If} $Ro == 1<br />MessageBox MB_OK blah<br />Abort<br />${Else}<br />Delete ...<br />${EndIf}</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RegShoe</span><br />
      <span class="post-time small text-muted">21st November 2007 10:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi,<br />
      thanks for your help. It seems I had a logical error in my script. ;)<br />
      <br />
      Also the LogicLib did help me a lot. So, thanks again.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
