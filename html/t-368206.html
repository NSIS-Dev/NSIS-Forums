<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="MULTIUSER_PAGE_INSTALLMODE page not showing"><title>MULTIUSER_PAGE_INSTALLMODE page not showing - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">MULTIUSER_PAGE_INSTALLMODE page not showing</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=368206">MULTIUSER_PAGE_INSTALLMODE page not showing</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">MikeAtkinson</span><br><span class="post-time small text-muted">5th August 2013 15:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>MULTIUSER_PAGE_INSTALLMODE page not showing</strong><br>I'm doing a "!include MultiUser.nsh" and "!include "MUI2.nsh", the "RequestExecutionLevel admin" then later doing a "!insertmacro MULTIUSER_PAGE_INSTALLMODE".<br><br>For some systems it shows the screen for selecting between “Install for anyone using this compter” and “Install just for me”, but for other systems NSIS skips this screen.<br><br>These are identical computers which are set up in almost identical ways, with all users having administrator privileges. The first part of the file follows:<br><br>1 !define SRCDIR .<br>2 !define COMPANY "Company"<br>3 !define DVRNAME "Diver"<br>4<br>5 !define VERSION "$%VERSION_NO%-$%VERSION_PATCH%"<br>6 !define MULTIUSER_EXECUTIONLEVEL highest<br>7 !define MULTIUSER_MUI<br>8 !define MULTIUSER_INSTALLMODE_COMMANDLINE<br>9 !include MultiUser.nsh<br>10<br>11<br>12 Var /GLOBAL DRIVERFILENAME<br>13 Var /GLOBAL SETUPDRIVERFILENAME<br>14<br>15 # Function that attempts to install an ODBC driver, and gives a retry/cancel<br>16 # message box if this fails.<br>17 Function installDriver<br>18 ClearErrors<br>19 install:<br>20 nsExec::ExecToStack '"$INSTDIR\wxodbcinst.exe" -d "${DVRNAME}" -o "$DRIVERFILENAME" -s "$SETUPDRIVERFILENAME" -i "$INSTDIR"'<br>21 Pop $0 # return value<br>22 Pop $1 # message<br>23 StrCmp $0 "error" odbcinstexecfail<br>24 IntCmp $0 0 installdriverend<br>25 installdriverfail:<br>26 MessageBox MB_RETRYCANCEL "$1$\r$\n$\r$\nFailed to update ODBC drivers. Have you another ODBC client running? If so, close that application and choose Retry. Otherwise, choose Cancel to abort." IDRETRY install IDCANCEL installdriverabort<br>27<br>28 goto installdriverend<br>29<br>30 odbcinstexecfail:<br>31 MessageBox MB_OK "Failed to execute wxodbcinst.exe."<br>32 Abort<br>33<br>34 installdriverabort:<br>35 MessageBox MB_OK "Installation not successful."<br>36 Abort<br>37<br>38 installdriverend:<br>39 FunctionEnd<br>40<br>41 Function .onInit<br>42 !insertmacro MULTIUSER_INIT<br>43 FunctionEnd<br>44<br>45 Function un.onInit<br>46 !insertmacro MULTIUSER_UNINIT<br>47 FunctionEnd<br>48<br>49<br>50 !if $%PLATFORM% == Win64<br>51 !define OLDSHORTDESC "64-bit Client Tools"<br>52 !define SHORTDESC "64-bit Client Tools"<br>53 !define PACKAGE wx2clients64<br>54 !else<br>55 !define OLDSHORTDESC "32-bit Client Tools"<br>56 !define SHORTDESC "32-bit Client Tools"<br>57 !define PACKAGE wx2clients32<br>58 !endif<br>59<br>60 Name "${SHORTDESC}"<br>61 !if $%PLATFORM% == Win64<br>62 InstallDir "$PROGRAMFILES64\${COMPANY}\${PACKAGE}"<br>63 !else<br>64 InstallDir "$PROGRAMFILES\${COMPANY}\${PACKAGE}"<br>65 !endif<br>66<br>67<br>68 InstallDirRegKey HKCU "Software\${PACKAGE}" ""<br>69<br>70&gt;outfile "${SRCDIR}/setup.exe"<br>71<br>72 RequestExecutionLevel admin<br>73<br>74 !include "MUI2.nsh"<br>75<br>76<br>77 !define MUI_ICON "${SRCDIR}/icon.ico"<br>78 !define MUI_UNICON "${SRCDIR}/icon.ico"<br>79<br>80 !define MUI_HEADERIMAGE<br>81 !define MUI_HEADERIMAGE_LEFT<br>82 !define MUI_HEADERIMAGE_BITMAP "header.bmp"<br>83 !define MUI_WELCOMEFINISHPAGE_BITMAP "${NSISDIR}/Contrib/Graphics/Wizard/orange.bmp"<br>84 !define MUI_ABORTWARNING<br>85<br>86<br>87 !define MUI_WELCOMEPAGE_TEXT "..."<br>88<br>89 !insertmacro MUI_PAGE_WELCOME<br>90 !insertmacro MUI_PAGE_LICENSE "${SRCDIR}/WX2-EULA.txt"<br>91 !insertmacro MUI_PAGE_COMPONENTS<br>92 !insertmacro MULTIUSER_PAGE_INSTALLMODE<br>93 !insertmacro MUI_PAGE_DIRECTORY<br>94 !insertmacro MUI_PAGE_INSTFILES<br>95 !insertmacro MUI_PAGE_FINISH<br>96<br>97 !insertmacro MUI_UNPAGE_CONFIRM<br>98 !insertmacro MUI_UNPAGE_INSTFILES<br>99<br>100<br>101 !insertmacro MUI_LANGUAGE "English"<br>102<br>103 ...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">5th August 2013 17:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">!define MULTIUSER_EXECUTIONLEVEL highest sets RequestExecutionLevel so why do you set RequestExecutionLevel admin?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MikeAtkinson</span><br><span class="post-time small text-muted">6th August 2013 09:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for the prompt response. I have commented out that line, but there is no change.<br><br>I forgot to mention we are running Windows 7 Enterprise N, service pack 1, 64 bit.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">7th August 2013 00:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">!define MULTIUSER_EXECUTIONLEVEL highest does not make much sense here, you always want admin rights to install this driver, or can a unelevated user pass the installDriver test if the driver is already installed?<br><br>I would suggest adding some messageboxes to the multiuser code, it does try to abort the page in a couple of places...</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>