<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="setting up a virtual directory" />

  <title>setting up a virtual directory - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">setting up a virtual directory</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=153983">setting up a virtual directory</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jorge_bittencou</span><br />
      <span class="post-time small text-muted">26th October 2003 00:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>setting up a virtual directory</strong><br />
      Hi there: I´m new to NSIS but a friend of mine recommended it to me, so I decided to use it to create a setup for my web app.<br />
      <br />
      There are two things I don´t know how to and would really appreciate some help or direction. I´ve seacrhed the whole site and documentation, but am still at a loss.<br />
      <br />
      1. I want to create a virtual directory in IIS. To my knowledge, this is the same as right-cliking on a directory, selecting Sharing, cliking on the Web Sharing tab and selecting Share this Folder. But I don´t know how to set those options for a folder.<br />
      <br />
      2. I need to find out the computer name I´m installing the application on.<br />
      <br />
      Thanks in advance.<br />
      <br />
      Jorge</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">26th October 2003 09:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">These 3 threads should help you create a virtual folder for IIS:<br />
      <br />
      <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=148899&amp;highlight=virtual" target="_blank">http://forums.winamp.com/showthread....hlight=virtual</a><br />
      <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=146155&amp;highlight=virtual" target="_blank">http://forums.winamp.com/showthread....hlight=virtual</a><br />
      <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=135937&amp;highlight=virtual" target="_blank">http://forums.winamp.com/showthread....hlight=virtual</a><br />
      <br />
      You could probably use the ADSI/WMI interface with the new System.dll COM support, give it a shot if you want. It would be great if you could get it working and publish an Archive page about it.<br />
      <br />
      To find out the computer name take a look at the following thread:<br />
      <br />
      <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=150837&amp;highlight=computer+name" target="_blank">http://forums.winamp.com/showthread....=computer+name</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jorge_bittencou</span><br />
      <span class="post-time small text-muted">29th October 2003 23:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks a lot for your help. I tried the second option which just executes the script with the specified parameters and gets the virtual directory up and going.<br />
      <br />
      Jorge</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">icebrrrg</span><br />
      <span class="post-time small text-muted">30th October 2003 22:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've written some functions that set up a vdir and create an application at that point ... and back it out at uninstall. Thought I'd share. It's all adapted from the links and info in this discussion forum, thanks to all!<br />
      <br />
      There are a lot of places for customization -- the attributes for the virtual directory and the application, the type of app (I'm using an out-of-proc app), etc. All you'll need to do is place this in your script, tweak it for your install, and call the CreateVDir function in one of your sections; call un.DeleteVDir from your Uninstall section.<br />
      <br />
      <font color="indigo"><br />
      LangString ERR_VDIREXISTS ${LANG_ENGLISH} "A virtual directory named ${VDIRNAME} already exists. The new virtual directory will not be created."<br />
      <br />
      ;--------------------------------<br />
      ; CreateVDir Function<br />
      Function CreateVDir<br />
      <br />
      ;Open a VBScript File in the temp dir for writing<br />
      DetailPrint "Creating $TEMP\createVDir.vbs";<br />
      FileOpen $0 "$TEMP\createVDir.vbs" w<br />
      <br />
      ;Write the script:<br />
      ;Create a virtual dir named ${VDIRNAME} pointing to $INSTDIR\web with proper attributes<br />
      FileWrite $0 "On Error Resume Next$\n$\n"<br />
      FileWrite $0 "Set Root = GetObject($\"IIS://LocalHost/W3SVC/1/ROOT$\")$\n"<br />
      FileWrite $0 "Set Dir = Root.Create($\"IIsWebVirtualDir$\", $\"${VDIRNAME}$\")$\n$\n"<br />
      FileWrite $0 "If (E******mber &lt;&gt; 0) Then$\n"<br />
      StrCpy $1 $(ERR_VDIREXISTS) ;To substitute a LangString in the vbs copy it before<br />
      FileWrite $0 " MsgBox $\"$1$\"$\n"<br />
      FileWrite $0 " Wscript.Quit (E******mber)$\n"<br />
      FileWrite $0 "End If$\n$\n"<br />
      FileWrite $0 "Dir.Path = $\"$INSTDIR\web$\"$\n"<br />
      FileWrite $0 "Dir.AccessRead = True$\n"<br />
      FileWrite $0 "Dir.AccessWrite = False$\n"<br />
      FileWrite $0 "Dir.AccessScript = True$\n"<br />
      FileWrite $0 "Dir.AppFriendlyName = $\"${VDIRNAME}$\"$\n"<br />
      FileWrite $0 "Dir.EnableDirBrowsing = False$\n"<br />
      FileWrite $0 "Dir.ContentIndexed = False$\n"<br />
      FileWrite $0 "Dir.DontLog = True$\n"<br />
      FileWrite $0 "Dir.EnableDefaultDoc = True$\n"<br />
      FileWrite $0 "Dir.DefaultDoc = $\"default.asp$\"$\n"<br />
      FileWrite $0 "Dir.AspBufferingOn = True$\n"<br />
      FileWrite $0 "Dir.AspAllowSessionState = True$\n"<br />
      FileWrite $0 "Dir.AspSessionTimeout = 30$\n"<br />
      FileWrite $0 "Dir.AspScriptTimeout = 900$\n"<br />
      FileWrite $0 "Dir.SetInfo$\n$\n"<br />
      ;Create the application object<br />
      FileWrite $0 "Set IISObject = GetObject($\"IIS://LocalHost/W3SVC/1/ROOT/${VDIRNAME}$\")$\n$\n"<br />
      FileWrite $0 "IISObject.AppCreate2(1) 'Create an out-of-process web application$\n"<br />
      FileWrite $0 "If (E******mber &lt;&gt; 0) Then$\n"<br />
      FileWrite $0 " MsgBox $\"Error trying to create the application at 'IIS://LocalHost/W3SVC/1/ROOT/${VDIRNAME}'$\"$\n"<br />
      FileWrite $0 " WScript.Quit (E******mber)$\n"<br />
      FileWrite $0 "End If$\n"<br />
      <br />
      FileClose $0<br />
      <br />
      DetailPrint "Executing $TEMP\createVDir.vbs"<br />
      nsExec::Exec /TIMEOUT=20000 '"$SYSDIR\cscript.exe" "$TEMP\createVDir.vbs"'<br />
      DetailPrint "Virtual Directory ${VDIRNAME} successfully created."<br />
      Delete "$TEMP\createVDir.vbs"<br />
      <br />
      FunctionEnd<br />
      <br />
      ;--------------------------------<br />
      ; CreateVDir Function<br />
      Function un.DeleteVDir<br />
      <br />
      ;Open a VBScript File in the temp dir for writing<br />
      DetailPrint "Creating $TEMP\deleteVDir.vbs";<br />
      FileOpen $0 "$TEMP\deleteVDir.vbs" w<br />
      <br />
      ;Write the script:<br />
      ;Create a virtual dir named ${VDIRNAME} pointing to $INSTDIR\web with proper attributes<br />
      FileWrite $0 "On Error Resume Next$\n$\n"<br />
      ;Delete the application object<br />
      FileWrite $0 "Set IISObject = GetObject($\"IIS://LocalHost/W3SVC/1/ROOT/${VDIRNAME}$\")$\n$\n"<br />
      FileWrite $0 "IISObject.AppDelete 'Delete the web application$\n"<br />
      FileWrite $0 "If (E******mber &lt;&gt; 0) Then$\n"<br />
      FileWrite $0 " MsgBox $\"Error trying to delete the application at [IIS://LocalHost/W3SVC/1/ROOT/${VDIRNAME}]$\"$\n"<br />
      FileWrite $0 " WScript.Quit (E******mber)$\n"<br />
      FileWrite $0 "End If$\n$\n"<br />
      <br />
      FileWrite $0 "Set IISObject = GetObject($\"IIS://LocalHost/W3SVC/1/ROOT$\")$\n$\n"<br />
      FileWrite $0 "IIsObject.Delete $\"IIsWebVirtualDir$\", $\"${VDIRNAME}$\"$\n"<br />
      FileWrite $0 "If (E******mber &lt;&gt; 0) Then$\n"<br />
      FileWrite $0 " MsgBox $\"Error trying to delete the virtual directory '${VDIRNAME}' at 'IIS://LocalHost/W3SVC/1/ROOT'$\"$\n"<br />
      FileWrite $0 " Wscript.Quit (E******mber)$\n"<br />
      FileWrite $0 "End If$\n$\n"<br />
      <br />
      FileClose $0<br />
      <br />
      DetailPrint "Executing $TEMP\deleteVDir.vbs"<br />
      nsExec::Exec /TIMEOUT=20000 '"$SYSDIR\cscript.exe" "$TEMP\deleteVDir.vbs"'<br />
      DetailPrint "Virtual Directory ${VDIRNAME} successfully removed."<br />
      Delete "$TEMP\deleteVDir.vbs"<br />
      <br />
      FunctionEnd<br /></font></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">30th October 2003 22:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Best place to share is <a href="http://nsis.sf.net/archive" target="_blank">the Archive</a>. It would be easier to find it there.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">icebrrrg</span><br />
      <span class="post-time small text-muted">30th October 2003 22:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">done ...<br />
      <br />
      <a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=455&amp;instances=0,11" target="_blank">http://nsis.sourceforge.net/archive/...instances=0,11</a><br />
      <br />
      thanks,<br />
      -m-</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">stonkers</span><br />
      <span class="post-time small text-muted">13th January 2006 15:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Archive</strong><br />
      Hi, all! Where'd the archive go? I can't hit this link. Sorry if I'm behind on times, haven't been around here in a while. Eric</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">13th January 2006 15:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The Archive has been replaced by the Wiki, but all old links should still work. I don't know why this specific link doesn't work as it should...<br />
      <br />
      For now, you can simply search the Wiki for "virtual directory" and find this:<br />
      <br />
      <a href="http://nsis.sourceforge.net/Setting_up_a_virtual_directory" target="_blank">http://nsis.sourceforge.net/Setting_...tual_directory</a><br />
      <br />
      [edit] That link has the wrong page id. The instance id for the virtual directory page is 871, not 455.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
