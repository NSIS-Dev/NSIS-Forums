<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="SetSystemEnvironmentVariable"><title>SetSystemEnvironmentVariable - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">SetSystemEnvironmentVariable</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=137439">SetSystemEnvironmentVariable</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">shortpasta</span><br><span class="post-time small text-muted">1st June 2003 23:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>SetSystemEnvironmentVariable</strong><br>the application i install runs as a service.<br><br>because of this i need to set a SYSTEM environment variable and update the SYSTEM path. can anyone tell me how to do this?<br><br>the samples i found on the forums/sf.net only work on the USER environment.<br><br>PS: the only way i could find to set system environment variables is with microsoft's "setx.exe" utility (from their resource kit).<br><br>PS2: i also know that there is are "Get/SetSystemEnvironmentVariable" functions in the SDK but don't know which module.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">1st June 2003 23:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Welcome to the forum.<br><br>Use these functions:<br><a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=137" target="_blank">http://nsis.sourceforge.net/archive/...php?pageid=137</a><br><br>When you define ALL_USERS they will affect the system environment variable table and not just the user's.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">shortpasta</span><br><span class="post-time small text-muted">2nd June 2003 01:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks, it worked like you said.<br><br>i had seen that before but i immediately discarted it in my mind because it said ALL USERS and not SYSTEM account.<br><br>i looked further in microsoft's site &amp; found out that the system environment functions are *deprecated*, odd to see microsoft do this, but it speaks in favor of the "ALL USERS" concept including SYSTEM.<br><br>Later gaters!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dabneyra</span><br><span class="post-time small text-muted">1st November 2003 04:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>WriteEnvStr.nsh</strong><br>I cannot get this to work. Here is the relevant code:<br><br>!define ALL_USERS<br>!include WriteEnvStr.nsh<br>Section "Add Env Var"<br>Push Path<br>Push $INSTDIR\bin\win32<br>Call WriteEnvStr<br>SectionEnd<br><br>When I compile, I get this error ouput:<br><br>GetTempFileName -&gt; $2<br>File: "RefreshEnv\Release\RefreshEnv.exe" -&gt; no files found.<br>Usage: File [/nonfatal] [/a] ([/r] filespec [...]|/oname=outfile one_file_only)<br>!include: error in script: "C:\Program Files\NSIS\Include\WriteEnvStr.nsh" on line 52<br><br>I am sure I am just misunderstanding how to use this function. Can someone please set me straight? Thank you,<br><br>dabneyra</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">1st November 2003 14:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You are using an old version of the function. Where did you take it from?<br><br>You shold update to the latest code from the link above.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dabneyra</span><br><span class="post-time small text-muted">2nd November 2003 05:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>WriteEnvStr update</strong><br>Hi,<br><br>I think that old version was in the NSIS install. Anyway, I was able to compile with the new version using the same code as above. This time, it seems to have worked TOO well... instead of adding the install directory to the Path variable, it ENTIRELY replaced the Path directory with the install directory. The rest of my old path had been deleted. What to do? Is there some way to recover the default Windows XP Path? Sorry to continue being a pain in the ass about this, but I would really like to understand how this is working. Thanks,<br><br>dabneyra</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">2nd November 2003 07:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Isn't that what you've wanted? You've used WriteEnvStr... WriteEnvStr replaces, it doesn't add. If you want to change the path you should use the <a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=91" target="_blank">path manipulation</a> functions.<br><br>As for restoring, try system restore.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dabneyra</span><br><span class="post-time small text-muted">2nd November 2003 17:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Change Path for all users</strong><br>Hi,<br><br>I saw those functions earlier, and actually was able to use them to append to the user path variable, but not the system path variable. It was not immediately obvious to me how to use or modify the path manipulation functions to set the path for all users.<br><br>Thanks,<br>dabneyra</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dabneyra</span><br><span class="post-time small text-muted">2nd November 2003 20:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Found it!</strong><br>Hi,<br><a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=140083" target="_blank">this thread</a> had the answer I was looking for. Briefly, in case someone in the future is looking at this message to try and solve this problem, the change to be made is as follows:<br><br>In the <a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=91" target="_blank">Path Manipulation Function</a>, change<br><br>HKCU<br><br>to:<br><br>HKLM "SYSTEM\CurrentControlSet\Control\Session Manager\Environment"<br><br>Thanks for the help,<br>dabneyra</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>