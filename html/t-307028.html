<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Windows 7 - erroneous installer warning" />

  <title>Windows 7 - erroneous installer warning - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Windows 7 - erroneous installer warning</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=307028">Windows 7 - erroneous installer warning</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br />
      <span class="post-time small text-muted">2nd June 2009 23:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Windows 7 - erroneous installer warning</strong><br />
      Hi!<br />
      <br />
      I tested my installer with Winodws 7 RC-1 and I noticed that a few moments after my installer exists, Windows 7 will display a warning. That warning claims that the installer probably has failed! That's complete nonsense, as the installer obviously <i>did</i> complete successfully. So I assume it's a bug in Windows 7 and it can be ignored safely. But it still may scare my users! So I wonder: What can I do to convince Windows 7 that my installer actually did complete successfully? I already request "admin" execution level. Anything else I need to add?<br />
      <br />
      BTW: Another problem. How can I launch my application, but *without* admin rights? I know there is the UAC plugin, but I'm looking for a simpler method. I already tried to launch a second installer from my main installer and I explicitly limited the rights of that second installer to "user". But even when launching my application from that second non-admin installer, it still somehow was running with "admin" rights, as the main installer. This sucks, because it disables Drag&amp;Drop and causes other random problems. Any suggestions?<br />
      <br />
      My complete installer script is here:<br />
      <a href="http://pastie.org/498438" target="_blank">http://pastie.org/498438</a><br />
      <br />
      Cheeeeeeers<br />
      MuldeR</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">redxii</span><br />
      <span class="post-time small text-muted">3rd June 2009 00:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">NSIS has to be updated to write a manifest file correctly for 7. sourceforge.net/tracker/index.php?func=detail&amp;aid=2725883&amp;group_id=22049&amp;atid=373085<br />
      As for non-admin, your script requires admin privileges. For example: 'WriteRegStr HKLM'<br />
      HKLM requires admin privileges to write to. You can try SHCTX or HKCU instead. Writing to $PROGAMFILES also requires admin. You can take a look at multiuser.nsh.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br />
      <span class="post-time small text-muted">3rd June 2009 00:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by redxii</i><br />
        <b>NSIS has to be updated to write a manifest file correctly for 7. sourceforge.net/tracker/index.php?func=detail&amp;aid=2725883&amp;group_id=22049&amp;atid=373085</b>
      </blockquote>Thanks for info ;)<br />
      <br />
      I hope NSIS will be fixed for Windows 7 soon, so I can make the Windows 7 people happy too :D<br />
      <br />
      <br />

      <blockquote>
        <i>Originally posted by redxii</i><br />
        <b>As for non-admin, your script requires admin privileges. For example: 'WriteRegStr HKLM'<br />
        HKLM requires admin privileges to write to. You can try SHCTX or HKCU instead. Writing to $PROGAMFILES also requires admin. You can take a look at multiuser.nsh.</b>
      </blockquote>I'm aware that my Installer needs admin rights. And that's why I request the "admin" execution level. But at the end of the installer, I want to launch the application that has just been installed. The application itself should run with normal "user" rights. Unfortunately when launched by the "admin" level installer, the application will run at that higher security level too. That causes a few nasty problems, such as Drag&amp;Drop being disabled and other random glitches. So I look for a way to launch the app as the normal user from my admin-level installer...
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">redxii</span><br />
      <span class="post-time small text-muted">3rd June 2009 01:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What about this? nsis.sourceforge.net/UAC_plug-in#Launching_an_application_with_user_privileges<br />
      <br /></p>

      <blockquote>
        !define MUI_FINISHPAGE_RUN_FUNCTION ExecAppFile<br />
        <br />
        Function ExecAppFile<br />
        UAC::Exec '' '"$INSTDIR\${APPFILE}"' '' ''<br />
        FunctionEnd
      </blockquote>I don't believe you will be able to do it without a plugin because the application launched from MUI_FINISHPAGE_RUN will inherit admin privileges and NSIS hasn't done anything to automatically lower the privileges like in inno setup.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">3rd June 2009 05:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Once you are elevated, you can't go back, so I don't know what you think Inno is doing</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">redxii</span><br />
      <span class="post-time small text-muted">3rd June 2009 06:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, no, I don't <i>think</i> that, it <i>is</i> that, in 5.2.0 or later. However it does it, the process spawned from [Run] runs as non-admin after the setup having admin privileges.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pengyou</span><br />
      <span class="post-time small text-muted">3rd June 2009 09:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by redxii</i><br />
        <b>However it does it, the process spawned from [Run] runs as non-admin after the setup having admin privileges.</b>
      </blockquote>I use the UAC plugin in my NSIS installers to do that.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br />
      <span class="post-time small text-muted">3rd June 2009 10:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks. I will need to add yet another plugin to my installer then ;)<br />
      <br />
      How I love UAC...</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
