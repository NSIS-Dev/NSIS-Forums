<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="File owner &amp; permission" />

  <title>File owner &amp; permission - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">File owner &amp; permission</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=262602">File owner &amp; permission</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dogo</span><br />
      <span class="post-time small text-muted">28th December 2006 15:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>File owner &amp; permission</strong><br />
      Hello forum,<br />
      <br />
      I have got a big problem with NSIS.<br />
      <br />
      I use <a href="http://nsis.sourceforge.net/More_advanced_replace_text_in_file" target="_blank">AdvReplaceInFile</a> to replace some strings in my file I would like to change.<br />
      This works great. After all actions I set my file permissions with <a href="http://nsis.sourceforge.net/AccessControl_plug-in" target="_blank">AccessControll Plugin</a>, but the permissions and the file owner will not be set correctly.<br />
      <br />
      I suppose so that the temporary file (that will be copied over original) that will be created with <a href="http://nsis.sourceforge.net/More_advanced_replace_text_in_file" target="_blank">AdvReplaceInFile</a> does not get the file permissions from <a href="http://nsis.sourceforge.net/AccessControl_plug-in" target="_blank">AccessControll Plugin</a>.<br />
      <br />
      Is there any workaround or something I does not know ?!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">29th December 2006 10:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Did you try setting the privileges after calling AdvReplaceInFile?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dogo</span><br />
      <span class="post-time small text-muted">29th December 2006 12:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello kichik,<br />
      <br />
      yes of course, first I replace in some files, after that I<br />
      change the file privileges.<br />
      <br />
      The strange thing is that all files which were not substituted with some new text have the privileges I set. All with replaced text contain privileges like new created files within this account installer run in.<br />
      <br />
      Greetings,<br />
      <br />
      Wolfgang.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">29th December 2006 12:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, usually what this kind of functions do is create a new file and write the new data into it. You could either change that script to create the file in the correct folder, or do the replacement in another file and later manually copy the contents into the old file.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dogo</span><br />
      <span class="post-time small text-muted">29th December 2006 12:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello kichik,<br />
      <br />
      I think this will do what I want, but isn`t it a little bit strange that the<br />
      <a href="http://nsis.sourceforge.net/AccessControl_plug-in" target="_blank">AccessControl Plugin</a> will not change new file attributes which are (should ?) created befor changing attributes ?<br />
      <br />
      This seems to be a bug for me. :cry:<br />
      Looks like NSIS will copy the temporary files at the end of the installer<br />
      over my orginal ? :weird:<br />
      <br />
      The question for me is, if this is an NSIS or an Plugin problem.<br />
      <br />
      Greetings,<br />
      <br />
      Wolfgang.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">29th December 2006 13:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        Looks like NSIS will copy the temporary files at the end of the installer over my orginal?
      </blockquote>As I said, that's what those replacement scripts usually do. It's a problem with the script.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dogo</span><br />
      <span class="post-time small text-muted">29th December 2006 13:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello kichik,<br />
      <br />
      yes that is right, but the replacement script calls the rename statement within his replace function. Shouldn`t NSIS rename the file when this statment is called !? For me looks this like NSIS renaming all files at the end of the install time. But not at this time where rename is called !? I am a little bit confused now.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">29th December 2006 13:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Rename renames immediately. The problem is that the temporary files it renames is either created in the temporary folder and therefore gets a different set of privileges, or the destination file has privileges different than even those of the folder that contains it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dogo</span><br />
      <span class="post-time small text-muted">29th December 2006 14:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi,<br />
      <br />
      but shouldn`t work set file privileges as expected in your case ?!<br />
      I am right that renames copy the temp file to my $INSTDIR ?<br />
      <br />
      Flow Diagram:<br />
      <br />
      OriginalFile -&gt; ReplaceFunctionCall() -&gt; CreateTempFile -&gt;<br />
      WriteReplacementInTempFile -&gt; DeleteOriginal -&gt; RenameTempFile -&gt;<br />
      DeleteTempFile -&gt; setFilePrivileges<br />
      <br />
      NSIS Script:<br />
      <br />
      ...<br />
      <b>; Original File for String Replace.</b><br />
      <br />
      File "/oname=$INSTDIR\filename.txt" ".\filename.txt"<br />
      <br />
      <b>; Starting String Replacment.</b><br />
      <br />
      !insertmacro AdvReplaceInFile "$INSTDIR\filename.txt" "abc" "xyz" all all<br />
      <br />
      <b><br />
      ; User is existing in Windows XP Environment.<br />
      ; This should now change my file privileges on my file which<br />
      ; should be the file in which the strings are replaced,<br />
      ; But it is not.<br /></b><br />
      AccessControl::GrantOnFile "$INSTDIR\filename.txt" "Apache" "FullAccess"<br />
      AccessControl::SetFileOwner "$INSTDIR\filename.txt" "Apache"<br />
      AccessControl::SetFileGroup "$INSTDIR\filename.txt" "ApacheGroup"<br />
      ...<br />
      <br />
      This seems to be a bug for me.<br />
      Is there any workaround instead of truncate my original file and copy content of temp file ?!<br />
      <br />
      Greetings,<br />
      <br />
      Wolfgang.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">29th December 2006 14:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I haven't looked into AdvReplaceInFile, but your flow diagram describes what most of those functions do, so it's probably right. As I said, you have two options. The first, and simpler, is changing that function so it'd create the temporary file in $INSTDIR and not $TEMP. This way, it'll get the attributes of $INSTDIR automatically. Your second option is not to rename at all and manually copy the contents of the file.<br />
      <br />
      However, if all that is wrong is the file owner, you might have a problem with that AccessControl call and all you need to do is fix it. Make sure that call works on the file itself, without calling AdvReplaceInFile.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
