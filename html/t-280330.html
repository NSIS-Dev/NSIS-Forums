<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="UAC plugin, uninstaller display name" />

  <title>UAC plugin, uninstaller display name - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">UAC plugin, uninstaller display name</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=280330">UAC plugin, uninstaller display name</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">berglind</span><br />
      <span class="post-time small text-muted">30th October 2007 12:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>UAC plugin, uninstaller display name</strong><br />
      I'm working on a very typical installer, installing an application in the programs folder and launching it when the install is done. Now on Vista, I must of course run the installer in elevated mode and then launch the application in the context of the original user. Enter the UAC plugin, to the rescue. Great job and saved me a lot of headaches. The installer is working fine, it is signed with a file description and the elevation dialog displays this description.<br />
      <br />
      The uninstaller on the other hand is not signed (I know it can be done with some inner/outer exercises but I'd really rather not go there) and since it's removing files from the programs directory it must of course run elevated. And the elevation dialog asks for permission to run the program Au_.exe which is nothing similar to the actual name of the application. It seems that this is some generated temp name for the process that's being launched by the plugin.<br />
      <br />
      So my question is, is there anyway to change this name? And it's not possible to let the uninstaller request admin level directly, it must have the same execution level request as the entire installer, right?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">30th October 2007 13:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Re: UAC plugin, uninstaller display name</strong><br />
      The NSIS uninstaller copies itself to the temporary directory, runs the temporary uninstaller created and then exits. This is done so it will be able to delete itself, this is where the random name comes from.<br />
      <br />
      You can get around this by using Copyfiles to copy the uninstaller manually to $temp yourself, then do<br />
      ExecWait '"$temp\uninstall.exe" _?=$INSTDIR' (Been a couple of questions related to this already, I'm sure there are other forum threads with more information)<br />
      <br />
      <br /></p>

      <blockquote>
        <i>Originally posted by berglind</i><br />
        <b>And it's not possible to let the uninstaller request admin level directly, it must have the same execution level request as the entire installer, right?</b>
      </blockquote>I'm not sure what you mean here, but if you store the uninstall info in the HKLM part of the registry, Vista will elevate your installer even with RequestExecutionLevel user (I HATE VISTA)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">berglind</span><br />
      <span class="post-time small text-muted">30th October 2007 14:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for replying so quickly Anders! I had done some searching in the forum but I obviously didn't have the right keywords :) I'll figure it out from here.<br />
      <br />
      As for the elevation level, in my case I don't mind that it runs elevated when launched from Programs and Features. In fact I would prefer that it would run elevated from the start, also when launched from the installation folder. But as I understand, Vista determines whether to elevate from the manifest, and when NSIS generates the uninstaller I imagine it uses the same manifest as the installer. Which totally makes sense. But my speculation was if it might be possible to change it. Like putting "RequestExecutionLevel admin" in the uninstaller section or something. But I don't really find that I'm making much sense here so... :D<br />
      <br />
      One more question though. Since the installer doesn't really require admin level to start up, Vista doesn't display a shield on the icon. I know that some people are only too glad to be rid of it, but it annoys me slightly that the user won't be informed that he'll need admin privileges. There's no way around this, is there?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">30th October 2007 14:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Nope, no way around the missing shield.<br />
      <br />
      You can use the UAC plugin in the uninstaller aswell to make sure it always runs as admin, even if started from the startmenu or whatever</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bradkohl</span><br />
      <span class="post-time small text-muted">8th November 2007 01:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am having the exact same problem and to make this painfully obvious to those of us who may need it:<br />
      <br />
      In the script<br />
      1. Where do you run ExecWait '"$temp\uninstall.exe" _?=$INSTDIR' ?<br />
      2. Where do you copy uninstaller to $temp?<br />
      3. Do you still make the uninstaller the same way?<br />
      4. How do you make sure that the auto copy of installer doesn't get executed in addition to the manual copy?<br />
      <br />
      I get how to do it from command line, but I'm looking for an example of how to turn my current 'WriteUninstaller/section uninstall" duo into an executable that knows to copy it's name to $temp and run from there. Where do I put these commands in the script?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">8th November 2007 13:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The best solution would be an option to set the uninstallers RequestExecutionLevel from inside the installer, that would solve all of this.<br />
      <br />
      I hacked up some code that might do what you want (Not tested on Vista)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">berglind</span><br />
      <span class="post-time small text-muted">8th November 2007 13:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Anders</i><br />
        <b>The best solution would be an option to set the uninstallers RequestExecutionLevel from inside the installer, that would solve all of this.</b>
      </blockquote>Absolutely, that would be really neat.<br />
      <br />
      Thanks for the code, I had pretty much put this aside and decided to live with the temp name, but I'm going to try this on Vista after the weekend. In the meantime, bradkohl if you try it, please post on how it goes :)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bradkohl</span><br />
      <span class="post-time small text-muted">13th November 2007 21:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well it works but it's ugly. Originally, I had one .nsi file which on install could elevate permissions with UAC plugin do all it's magic and create an uninstaller. Now I have two files. One is an uninstall.nsi which creates the super slick $temp executing uninstall.exe. The other is the original .nsi which now packages the newly created uninstall.exe rather than writing it's own. So now everytime I make a change to uninstaller I have to recompile two files before I can check it. Additionally, the uninstall.exe writes it's own uninstaller which gets copied and execwait-ed so for a brief period of time there are two uninstall files and that's just bad mojo in my opinion. If I'm doing something wrong please please let me know, I would really like to go back to the all in one file design.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
