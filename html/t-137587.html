<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Reboot Question" />

  <title>Reboot Question - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Reboot Question</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=137587">Reboot Question</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jacob Metro</span><br />
      <span class="post-time small text-muted">2nd June 2003 18:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Reboot Question</strong><br />
      I have a question which I fear may not have a very good answer. Forgive me if I am repeating a question asked in this forum previously, I did query the forum but found no direct references to my question.<br />
      <br />
      I want to install several different packages (or portions of a bigger package). Each of these packages (or portions thereof) make registry and environmental settings changes (and other things) and therefore require a reboot. These packages depend on each other to properly function.<br />
      <br />
      Here's what I currently do. I have my user select the first package. He/She installs the first package upon which the system automatically reboots and prepares the system for the next package. My user then selects the second package. The system is rebooted after installation in like manner. My user then selects the final package. After installation the system reboots and is ready to use.<br />
      <br />
      This system works fine.<br />
      <br />
      Do to severe OS problems on any PC I've tested with, if I install all three packages without reboot the system hangs and refuses to load Windows (thanks to Bill Gates and his development team). [Of course, muchos cudos to him I can simply use the LAST KNOWN GOOD configuration option in Windows 2000/NT and be back to square one if that happens.]<br />
      <br />
      What I'd like to be able to do is this. I'd like to be able to set a tag of some kind in my installer such that...<br />
      <br />
      (Pseudocode):<br />
      <br />
      <br />
      <font color="orange"><br />
      SectionOne Finished then call SavePlace<br />
      <br />
      SavePlace:<br />
      set variable PLACE = SectionTwo<br />
      reboot<br />
      restart installer MyInstaller.exe<br />
      <br />
      StartOfInstaller:<br />
      Read variable PLACE<br />
      Place = SectionTwo<br />
      Turn off SectionOne goto SectionTwo<br />
      <br />
      SectionTwo Finished then call SavePlace<br />
      <br />
      SavePlace:<br />
      set variable PLACE = SectionThree<br />
      reboot<br />
      restart installer MyInstaller.exe<br />
      <br />
      StartofInstaller:<br />
      Read variable PLACE<br />
      place = SectionThree<br />
      Turn off SectionOne and SectionTwo goto SectionThree<br />
      <br />
      SectionThree Finished then call SavePlace<br />
      <br />
      SavePlace:<br />
      set variable PLACE = "No More Sections"<br />
      reboot<br />
      restart installer MyInstaller.exe<br />
      <br />
      StartOfInstaller:<br />
      Read variable Plave<br />
      place = "No More Sections"<br />
      Turn off SectionOne, SectionTwo, and SectionThree goto Section "No More Sections"<br />
      <br />
      "No More Sections":<br />
      MsgBox "No more sections...stuff installed"<br />
      quit<br /></font><br />
      <br />
      Is this possible? I don't know of any installer off the top of my head which has this kind of reboot support. Can this be done with NSIS? Do you think an external DLL or program could do this?<br />
      <br />
      I know this isn't a tremendously exciting question but I thought I'd throw it out since, I couldn't find a method myself.<br />
      <br />
      Sincerely,<br />
      Jacob</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">2nd June 2003 18:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You don't need an external DLL for this. It's actually quite simple to achieve. All you need to do is get the installer to start up when Windows start up (a registry key), and save the variables and step number somewhere (registry would probably work best). When the installer starts check the step number and act according to it.<br />
      <br />
      BTW, what's that poll for?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jacob Metro</span><br />
      <span class="post-time small text-muted">2nd June 2003 19:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Alrighty then....</strong><br />
      That's a good idea...<br />
      <br />
      I didn't think of that. Would you use \HKEY_CURRENT_USER\software\microsoft\windows\currentversion\runonce to store your run data?<br />
      <br />
      I'm really a novice at this scripting thing, though I can ask questions pretty well at this stage in my development.<br />
      <br />
      I searched my registry for the terms "startup" and "boot" but didn't find anything remarkably useful (at least anything that cought my attention) except for the above.<br />
      <br />
      I'm guessing you want to runonce at startup...each and every startup until completed.<br />
      <br />
      I "googled" around just now to find out how much assistance is on the internet right now for my problem. Looks like there is a bit. I'll have to check it out.<br />
      <br />
      The first 45 or 50 hits were Windows 98 related (i.e. HKLM\\Run) which doesn't help if I'm installing on lots of different types of windows boxes.<br />
      <br />
      Thanks for your prompt and kind response. NSIS is awesome!<br />
      <br />
      My minor is sociology and I thought it'd be fun to test the prevailing thought that people generally prefer monosyllabic (sp?) proper names over longer multiple-syllable names (and therefore give their children shorter and shorter names to make communication faster). You should have seen my mom run through the litagy trying to get my name out, "Stef...Aniela..Jani...no I need Jacob!!! Now!". She eventually cut my name to "Jake" to simplify it even further.<br />
      Enough of the personal stuff. That's what it's about. Just wondering if the whole world really follows the theory my professor teaches.<br />
      <br />
      My personal theory based on a review of the roster and an informal questionarre is that most people have 5 or less characters in their name, several people have lots of characters (8 or more or so), while the average hits around 6 characters or so.<br />
      <br />
      Oh well,<br />
      Let me know if you have any thoughts on either matter.<br />
      Sincerely,<br />
      Jacob</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">3rd June 2003 10:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, I was thinking of RunOnce. But you should only use it to tell Windows what file it needs to execute (process $CMDLINE for this). You should use another key, such as HKLM\Software\mySoftware to store the other data.<br />
      <br />
      I think you professor is right, names do get shorter. Mine for example is 4 chars and can easily be pronounced as one syllable as opposed to my father's name that needs some serious distortion to be pronounced as one syllable.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jacob Metro</span><br />
      <span class="post-time small text-muted">3rd June 2003 20:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Question</strong><br />
      Well, when I started working on it from that angle another thought hit me. Why can't we use several small installer packages and simply edit the registry key Runonce everytime we are about to reboot?<br />
      <br />
      Example:<br />
      <br />
      <font color="orangered"><br />
      Installed package One.<br />
      Write HKLM\Runonce = PackageTwo<br />
      Reboot<br />
      <br />
      Installed package Two.<br />
      Write HKLM\Runonce = PackageThree<br />
      reboot<br />
      <br />
      Installed package Three.<br />
      No write to HKLM\Runonce<br />
      reboot<br /></font><br />
      <br />
      Wouldn't that do what I want? How would it work in 98? I don't thing there is a RunOnce key in 98.<br />
      <br />
      I'm going to work on this procedure a bit. Let me know if I'm forgetting something, or if you've got an easier method.<br />
      <br />
      Sincerely,<br />
      Jacob Metro</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">4th June 2003 11:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The key:<br />
      HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce<br />
      works on all Windows versions.<br />
      <br />
      I haven't suggested seperate installers because I figured you'd want this installer to be available is one download and it's faster to compile just one installer. You could pack the other two installers in the first instsaller (use !system to compile) if you want to save the extra registry keys. You can also pass a command line parameter using the RunOnce key (something like "$INSTDIR\myInstaller.exe" /part2).</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
