<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Alternate install folder after selection"><title>Alternate install folder after selection - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Alternate install folder after selection</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=311214">Alternate install folder after selection</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">abcdgoldfish</span><br><span class="post-time small text-muted">1st September 2009 02:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Alternate install folder after selection</strong><br>Is there a straightforward way to provide a user the ability to select a different installation folder if the one he chooses in the Location page already exists?<br><br>It's simple to detect if the folder exists after he clicks Install but I'd like to be able to inform him (with a pop-up?) that the folder exists and give him the option to overwrite its contents, select a new folder or abort. I'd prefer it if selecting a new folder was on a Location page, this time with a blank field instead of the default.<br><br>If there isn't a straightforward way, is there any code I can grab to do the job?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">1st September 2009 14:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">you can handle all of this in the leave callback function for the directory page</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">abcdgoldfish</span><br><span class="post-time small text-muted">1st September 2009 19:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sorry to be dense but this is unfamiliar territory for me so a one liner doesn't have enough info.<br><br>In System.nsh's !macro MUI_PAGE_DIRECTORY I see a list of PageCallbacks. This included the DirectoryLeave_ I believe you are referring to.<br><br>I read the info on nsis.sourceforge.net/Docs/System/System.html#callback but it left me scratching my head. I played with some of the Example code but didn't get any apparent results. I still don't know:<br>o How to call the DirectoryLeave callback<br>o How to set up the parameter list<br>o How to use any return info to cause the directory page to be regenerated.<br><br>I'd appreciate any help on this to get me going.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kchernock</span><br><span class="post-time small text-muted">1st September 2009 20:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">; Select Install Directory Page<br>!define MUI_PAGE_CUSTOMFUNCTION_PRE preDirectory<br>!define MUI_PAGE_CUSTOMFUNCTION_LEAVE leaveDirectory<br>!define MUI_DIRECTORYPAGE_VERIFYONLEAVE<br>!insertmacro MUI_PAGE_DIRECTORY<br><br>Function preDirectory<br><br>FunctionEnd<br><br>Function leaveDirectory<br>;This is where you validate if the folder already exists<br>;If so, present message to user if they want to overwrite<br>;If yes, do nothing<br>;If no abort<br>;the abort command will return the user to the destination selection screen<br>FunctionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kchernock</span><br><span class="post-time small text-muted">1st September 2009 20:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>How to change path after failed validation</strong><br>What I have been unable to figure out is how to change the path presented to the user when returning to the destination selection screen. It returns the user with the field populated with the value that was just rejected. How do we return the value to some type of default<br><br>ie:<br>Default ($INSTDIR) is set to C:\Program Files\Xyz<br>User fills browses to C:\Recycler, which fails the validation<br>After notifying the user that C:\Recycler is not an allowable destination, how do we change the path back to C:\Program Files\Xyz?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br><span class="post-time small text-muted">11th September 2009 21:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">In the Pre callback function of the directory page, store $INSTDIR in a global variable, like $OriginalINSTDIR.<br>In the Leave callback function, check if the user gave a valid path, and if not:</p><pre>
<code>FindWindow $0 "#32770" "" $HWNDPARENT<br>GetDlgItem $R0 $0 1019<br>SendMessage $R0 ${WM_SETTEXT} 0 "STR:$OriginalINSTDIR"<br>Abort</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kchernock</span><br>
      <span class="post-time small text-muted">14th September 2009 16:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Success!!!!</strong><br>
      Thanks, this works perfectly and is exactly what I was looking for</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>