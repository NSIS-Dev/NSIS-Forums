<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Rename Registry Key"><title>Rename Registry Key - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Rename Registry Key</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=141249">Rename Registry Key</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Vytautas</span><br><span class="post-time small text-muted">6th July 2003 03:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Rename Registry Key</strong><br>Is there a way of renaming a registry key?<br><br>[EDIT]I could create a function which exports a key, renames it in the .reg file and reimports it again, but i found that in Win2000 registry files exported from command line are NOT in the standard .reg format, they seem to be compressed or something. Any ideas?[/EDIT]<br><br>Vytautas</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Vytautas</span><br><span class="post-time small text-muted">6th July 2003 04:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Actually the information in the last edit is wrong. Win2000 seems to add a bit of binary info after every character and my editor was getting confused by that. Also I tried using the <a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=318" target="_blank">ReplaceInFile</a> Function but it also does not seem to work properly, e.g. on first run it seems to make the file readable be stripping out most of the binary info then if run again it works fine, except for the first 3 chars in the file are still binary and will not allow the file to be merged into the registry. Is there a way to remove all of this binary info from the file or is there a better way to rename a key in the registry.<br><br>Vytautas</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">6th July 2003 12:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Attach the exported file and I'll have a look.<br><br>But why would you want to do that? Why don't you use what's used in the NSIS installer script? It's so much more efficient! (relating to <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=141217" target="_blank">this thread</a>).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br><span class="post-time small text-muted">6th July 2003 13:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If W2k exports same way as WinXP this is not easy. And i dont know the switch to export in old format (W9x) [REGEDIT4]</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Vytautas</span><br><span class="post-time small text-muted">6th July 2003 13:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I have attached a registry export from Windows XP for the "HCR\NSHFile". If Windows XP notepad opens the file it appears as it should however if any other editor, e.g. HM NIS Edit, it only displays 3 characters and is trimed at first binary bit.<br><br>As for the second sugestion it only restores the ".nsi" entry and it should also restore the associated "NSISFile" key in the uninstall.<br><br>Vytautas</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Vytautas</span><br><span class="post-time small text-muted">6th July 2003 13:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes Brummelchen, W2k seems to export in the same format as WinXP. From futher study of the file format I think it might have something to do with the use of 'wide', multi-byte, characters.<br><br>Vytautas</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pengyou</span><br><span class="post-time small text-muted">6th July 2003 14:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">WinXp and Win2K are using Unicode which uses two bytes per character. So instead of seeing, for example, "Windows" you'll see "W i n d o w s" (those gaps are hex 00).<br><br>If you look at nsh.reg.txt with a hex editor you can see this quite clearly:<br><br>Here are the first few bytes in hex:<br>FF FE 57 00 69 00 6E 00 64 00 6F 00 77 00 73 00<br><br>and here they are in ASCII:<br>__W_i_n_d_o_w_s_<br><br>(using '_' to represent the non-ASCII hex chars)<br><br>I don't know much about Unicode, so I cannot add much to this explanation.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Vytautas</span><br><span class="post-time small text-muted">6th July 2003 14:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks, I gathered as much what I would like to find out is there a way to convert that into NON unicode file, e.g. remove to hex 00 from the file.<br><br>Vytautas</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pengyou</span><br><span class="post-time small text-muted">6th July 2003 15:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">As I said earlier I don't know much about Unicode.<br><br>You could try making a byte-by-byte copy of the .reg file -- ignoring the first two bytes and stripping out all of the hex 00 bytes so you end up with a simple ASCII file... but that might be too simple-minded a solution to actually work.<br><br>It might be worth looking for a utility to convert from Unicode (probably UTF-8 flavour?) to plain ASCII.<br><br>The first thing Google turned up was <a href="http://www.unicode.org/" target="_blank">http://www.unicode.org/</a><br><br>Brian</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pengyou</span><br><span class="post-time small text-muted">6th July 2003 16:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Here is a sample script which turns your nsh.reg.txt file into a readable one using the simple-minded approach I mentioned earlier. The ZIP file also includes the EXE file and sample output file.<br><br>Perhaps this will help you develop a solution to your problem?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br><span class="post-time small text-muted">6th July 2003 16:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I found this via google:<br><br>Convert Unicode to ASCII.<br>In Windows 2000 and XP, TYPE offers a simple method to convert Unicode files to ASCII:<br>TYPE MyUnicode.txt &gt; MyASCII.txt<br><br><a href="http://www.robvanderwoude.com/index.html" target="_blank">http://www.robvanderwoude.com/index.html</a><br>&gt;&gt; Batchfiles &gt;&gt; TYPE<br><br>It works so far - for W9x you have to replace<br>"Windows Registry Editor Version 5.00"<br>with<br>"REGEDIT4"</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Vytautas</span><br><span class="post-time small text-muted">7th July 2003 01:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks pengyou your script worked really well but i would like to suggest one alteration. I think it might be better if you only needed to push only one filename and when converted use the following code to overwrite the file. I would also suggest that you post this function on the NSIS Archive page.</p><pre>
<code>  SetDetailsPrint none<br>  delete ${UNICODE_FILENAME}<br>  CopyFiles /SILENT ${ASCII_FILENAME} ${UNICODE_FILENAME}<br>  delete ${ASCII_FILENAME}<br>  SetDetailsPrint both</code>
</pre><br>
      Vytautas
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pengyou</span><br>
      <span class="post-time small text-muted">7th July 2003 12:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Glad I was able to help out.<br>
      <br>
      My script was written quickly just to show one way to implement the suggestion I made in an earlier message. The reason it uses two parameters is that I wanted to keep things simple - I was more interested in the loop that does the processing so I did not spend much time thinking about the parameters.<br>
      <br>
      Thanks for suggesting I put the script in the archive - that had not occurred to me. If you want to put your improved version in the archive instead, I don't mind (you can take the credit).<br>
      <br>
      Brian</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Vytautas</span><br>
      <span class="post-time small text-muted">7th July 2003 12:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Brummelchen</i><br>
        <b>Convert Unicode to ASCII.<br>
        In Windows 2000 and XP, TYPE offers a simple method to convert Unicode files to ASCII:<br>
        TYPE MyUnicode.txt &gt; MyASCII.txt<br></b>
      </blockquote>I tried your suggestion but I could not achieve a reliable way to run the type command, could you post a sample script. The only way I could get to even run the command was in a batch file which I had to modify or create at run-time, however ExecWait did not wait until the batch file finished running so on big files the installer continued before the conversion was finished.<br>
      <br>
      Pengyou I will have a closer look at your function and try to convert it for my particular requirement, e.g. only one file, however your function is a more generic converter and should exist in the archive in it's current form.<br>
      <br>
      Vytautas
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br>
      <span class="post-time small text-muted">7th July 2003 13:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">sorry - i thought that TYPE is an program - it is only implemented as a command in the commnd line interpreter (command.com or cmd.com)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Vytautas</span><br>
      <span class="post-time small text-muted">7th July 2003 13:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes and there for if you want to use command.com or cmd.com you first have to which OS the installer ir running in and thus your script quickly becomes too complicated. Unless there is another way of achieving this.<br>
      <br>
      Vytautas</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">8th July 2003 10:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">First of all, you don't need to restore the NSISFile key, it's useless. The key belongs to NSIS and if someone else uses it it's his problem. The only real value that needs to be restored is the value already restored by the original script.<br>
      <br>
      Now, as for the Unicode. Pengyou, your script only works on some Unicode characters. Not all Unicode characters use just the first byte, that would be a waste of space.<br>
      <br>
      To get the path to command.com/cmd.exe read the %COMSPEC% environment variable. Use:<br>
      <br>
      ReadEnvStr $0 COMSPEC</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pengyou</span><br>
      <span class="post-time small text-muted">8th July 2003 11:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">My script was not intended as a general purpose Unicode conversion utility -it was merely created to handle the sample nsh.reg.txt file from an earler message.<br>
      <br>
      In an earler message I said:<br></p>

      <blockquote>
        You could try making a byte-by-byte copy of the .reg file -- ignoring the first two bytes and stripping out all of the hex 00 bytes so you end up with a simple ASCII file... but that might be too simple-minded a solution to actually work.
      </blockquote>as I knew that this approach only works in some cases. However, it seemed that this was a suitable case, so I created the script as a starting point for further development.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">8th July 2003 11:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The possibility of putting the script in the archive occurred. I just wanted to make sure you understand this script doesn't work in most cases where Unicode is really needed so you'll put an appropriate warning.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Vytautas</span><br>
      <span class="post-time small text-muted">8th July 2003 12:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by kichik</i><br>
        <b>First of all, you don't need to restore the NSISFile key, it's useless. The key belongs to NSIS and if someone else uses it it's his problem. The only real value that needs to be restored is the value already restored by the original script.</b>
      </blockquote>I was thinking in more general case, i.e. you have a program that indexes .txt files so you want to add an extra option in the .txt file association and thus you modify the 'txtfile' key. However when uninstalling you program you should also restore the 'txtfile' key to the previous state. Just a thought although it looks like the script might become too cumbersome and complex and it probably won't affect the registry condition too much.<br>
      <br>
      Vytautas
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">8th July 2003 12:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you add something to txtfile you can just delete it when uninstalling. I can't think of a situation where you'd need to restore the original key which doesn't belong to your program. I would be glad to know if you have thought of something else I couldn't see...</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Vytautas</span><br>
      <span class="post-time small text-muted">8th July 2003 13:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, I guess that as long as care is taken when associating files to create a key that is descriptive of not only the file type but also the program that it is associated with it this problem should not occur. As for an example if a text editor associates '.txt' files to 'txtfile' key and then deletes the 'txtfile' key on uninstall, then '.txt' files will no longer be associated with notepad even though the value in '.txt' was restored.<br>
      <br>
      Vytautas</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">8th July 2003 13:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The developer should know not to take over keys that do not belong to him. txtfile belongs to Notepad and should stay that way. I'm afraid only Microsoft can afford to take that kind of a name for their own program.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Vytautas</span><br>
      <span class="post-time small text-muted">8th July 2003 13:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have modified my archive page relating to this subject and added information about the pitfalls of using 'common' descriptions for file types.<br>
      <br>
      Thanks for all your help,<br>
      <br>
      Vytautas</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>