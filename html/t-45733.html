<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="NSIS 1.1z up -- oops, I'm out of letters" />

  <title>NSIS 1.1z up -- oops, I'm out of letters - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">NSIS 1.1z up -- oops, I'm out of letters</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=45733">NSIS 1.1z up -- oops, I'm out of letters</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">justin</span><br />
      <span class="post-time small text-muted">28th March 2001 20:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK I put 1.1z up on <a href="http://www.firehose.net/free/nsis/" target="_blank">http://www.firehose.net/free/nsis/</a><br />
      (which apparently will finally get pushed to nullsoft.com).<br />
      <br />
      Since I'm out of letters, I'm going to make the next version (which will soley fix bugs, no new features) 1.2.0. Yay.<br />
      <br />
      For fun, here's a list of everything (in reverse-chronological order) that I've done to NSIS in the last month. The end result is a lot more functionality, and a lot less overhead (the current exe header size is 32kb, whereas it used to be about 40kb).<br />
      <br /></p>

      <ul>
        <li>Moved licensedata into string table out of datablock</li>

        <li>Removed NSIS_CONFIG_CREATESHORTCUT config option (it really didn't add much)</li>

        <li>Additional exehead size optimizations (making it use global variables more instead of passing them around and copying them).</li>

        <li>Made DeleteOnReboot code check for duplicates in wininit.ini on win9x.</li>

        <li>Enlarged resources a bit to make more room for shit (dynamic sized resources would be nice, hmm)</li>

        <li>Made install info+string table etc in datablock.</li>

        <li>Made uninstall info that is written to uninstaller compressed now.</li>

        <li>This makes for slightly smaller installers, typically.</li>

        <li>Made install types and section names stored in string table (less overhead, less stupid static string length limitations)</li>

        <li>Raised the maximum number of install types to 8 from 4 and made it a keen #define (who cares?)</li>

        <li>Added DeleteFileOnReboot function to util.c</li>

        <li>Added /ONREBOOT switch to Delete instruction</li>

        <li>Made uninstaller delete itself after reboot</li>

        <li>Updated CRC checking code for size and speed (no more seeking)</li>

        <li>Updated integrity checks to check for correct length (even when CRC checking is off)</li>

        <li>Made minimum post-header length of 516 bytes when CRC is enabled (in order to simplify the exehead).</li>

        <li>Made cancel selected when the install is aborted.</li>

        <li>Fixed a few potential bugs in libc</li>

        <li>Made OLE/COM initialization better (no more open and close and open and close)</li>

        <li>Reduced size even more (zlib table optimizations and such! - decompression is slower now though, but the header is 35840 bytes with all features on)</li>

        <li>Removed NSIS_CONFIG_COPYFILES config option (it's small anyway)</li>

        <li>Made installation logging off by default (default header size is 31744 bytes, yay!)</li>

        <li>Updated uninstall system to not litter up your temporary directory with tons of nsu* files (it now only creates 26 possible files, and cleans up unused ones on uninstall)</li>

        <li>Reduced size of header by 1k (40960 bytes now with all features turned on)</li>

        <li>Cleaned up a lot of code/errors/etc in exehead</li>

        <li>Cleaned up error/warning handling in compiler</li>

        <li>Added !error and !warning</li>

        <li>Added DeleteINISec and DeleteINIStr commands</li>

        <li>Added jump:X mode to FindWindow</li>

        <li>Made Nop instruction also work as Jump, added Jump command.</li>

        <li>Made section adding more strict (you have to create all sections, none by default to make it less prone to bugs)</li>

        <li>Removed a lot of section related bugs.</li>

        <li>Added Abort command.</li>

        <li>Added SetDetailsView.</li>

        <li>Added FindWindowByTitle (uses FindWindow but with small diffs)</li>

        <li>Fixed bad DeleteRegKey bug that was introduced in 1.1o.</li>

        <li>Fixed a few component selector bugs. Seems to be fine now.</li>

        <li>Added SectionDivider command and divider sections and all that jazz.</li>

        <li>Added $\r and $\n variables (for carriage return and newline, respectively)</li>

        <li>Made install.log write \r\n instead of \n.</li>

        <li>Optimized header size more (it is still the same size, even though stuff was added)</li>

        <li>Added optional /r switch for RMDir (removes recursive directories and deletes all files (read-only or not) from them.</li>

        <li>Made Delete delete read-only files.</li>

        <li>Massive changes to the way strings are handled. Strings are no longer in the data block, but instead in their own string table which is compressed with the header and stored in memory by the installer stub. This is a) faster, and b) allows us to compress the strings. Also, the static strings that the installer needs are no longer stored directly, instead "pointers" to them in the string table are stored (meaning many of the static length restrictions are gone). Doing this also simplifies much of exec.c, making the installer smaller. TODO: make all of the user messages configurable (maybe). Overall these changes produce installers that are about 1-2k smaller.<br />
        optimized datablock_optimize</li>

        <li>Changed the format of the output statistics.</li>

        <li>Broke stuff (see above)</li>

        <li>Added IfFileExists instruction for branching based on file/directory presence (takes wildcards, too)</li>

        <li>Changed ExecuteEntry so that branching instructions (such as MessageBox and IfFileExists) can go back if necessary (oops - negative ones were broken before.)</li>

        <li>Made add_data_compress and GetCompressedDataFromDataBlock use a slightly more efficient form (1 byte per block is saved, maximum file size is now 2gb instead of 4gb)</li>

        <li>Created BIGTEST.NSI which tests/demonstrates nearly all of the functionality of NSIS.</li>

        <li>Added Nop instruction</li>

        <li>Made it possible to put comments at the end of the line (using ; or # to deliminate it) .. if you need a parameter to start with ; or #, use quotes.</li>

        <li>Fixed GetCompressedDataFromDataBlockToMemory() (this was causing licenses to be truncated).</li>

        <li>Made MessageBox and FindWindow strings able to use variables</li>

        <li>Made last two parameters of MessageBox optional</li>

        <li>Cleaned up some resources (maintained 41.5k header size even though we added some instructions etc)</li>

        <li>Made it so that if the first section starts with - (or is ""), it is not shown in the section list.</li>

        <li>Made it so that sections beginning with a - are treated like empty sections (and are required, and not shown).</li>

        <li>Made SectionIn command additive. i.e. SectionIn 1\nSectionIn 2 adds the section to types 1 and 2.</li>

        <li>Made CreateShortCut more configurable (hotkey and showmode).</li>

        <li>Made integer parser take hexadecimal and octal numbers in addition to decimal.</li>

        <li>Added new examples (example1.nsi, example2.nsi, waplugin.nsi, and viewhtml.nsi)</li>

        <li>Reduced size of header 1.5k by removing unused portions of zlib.</li>

        <li>Improved the InstlalDirRegKey logic to handle quotes in the strings better.</li>

        <li>Removed winamp hack checking (use InstallDirRegKey to find the Winamp directory, in addition to $PROGRAMFILES\Winamp) ex: InstallDirRegKey HKEY_LOCAL_MACHINE "Software\Microsoft\Windows\CurrentVersion\Uninstall\Winamp" "UninstallString"</li>

        <li>Got rid of shell.cpp, rewrote CreateShortCut in C (using lpVtbl) and included it in util.c, and inlined Shell_Free in ui.c</li>

        <li>Removed time clipping on the Sleep command.</li>

        <li>Made compiler give warnings for certain instances that should not be fatal but should be fixed (i.e. combining LicenseData and SilentInstall)</li>

        <li>Made the install info header compressable (typically saves a few kb)</li>

        <li>Made the uninstall data compressable (typically saves ~1kb)</li>

        <li>Prettied up the output of statistics</li>

        <li>Made the space required/available displays show KB, MB, or GB.</li>

        <li>Made both exehead and compiler use the same zlib directory.</li>

        <li>made nsisconf.nsi included if available (lets you configure defaults)</li>

        <li>added PackEXEHeader command to let you use UPX or Petite or any other packer on the header.<br />
        removed one extra resource from exehead to shrink installer slightly.</li>

        <li>changed compression system to do one big deflate (should be slightly more efficient)</li>

        <li>added SetDatablockOptimize command and made it off by default (SLOW! :)</li>

        <li>made compiler print more info (compression bytes saved, etc)</li>

        <li>fixed silentinstall uninstall bug</li>
      </ul><br />
      Love,<br />
      <br />
      Justin
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">c2R</span><br />
      <span class="post-time small text-muted">29th March 2001 01:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Justin. Thats a lot of work for just one month's worth!<br />
      <br />
      What I do in programs I write for work is to use a numbering system without letters - thus getting around the problem of only 26 bugfix releases... :)<br />
      <br />
      Regards.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Thor</span><br />
      <span class="post-time small text-muted">29th March 2001 15:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Cool beans Justin ! Keep it up! :D<br />
      <br />
      Question :<br />
      you used to have this little list of todo's for "future 1.1 version" ... It's no longer there now ...<br />
      Have all those features (like DLL versions checking) been added ? Or are you still planning to do that for 1.2 releases ?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">PabUK</span><br />
      <span class="post-time small text-muted">29th March 2001 23:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Love the constant updating!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RookieKiwi</span><br />
      <span class="post-time small text-muted">31st March 2001 12:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Bugs introduced in 1.1z</strong><br />
      <br />
      Greetings from New Zealand!<br />
      <br />
      I just love the new installer, great work Justin!<br />
      <br />
      Has anybody else had problems running on Win98SE?<br />
      It installs fine, then exits with a "illegal operation" error.<br />
      <br />
      I tried to activate logging via the shift key, but this no longer works. Am I missing something?<br />
      <br />
      It all works fine when I compile with version 1.1j. Only problem is, 1.1j doesn't have the nice new "ifnewer" overwrite option. :-)<br />
      <br />
      Anybody got any ideas?<br />
      <br />
      TIA<br />
      <br />
      Andrew</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">PabUK</span><br />
      <span class="post-time small text-muted">31st March 2001 12:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have a problem like this too. Since a few version back the installer crashes on Win ME at the end, so I had to switch back to 1.1s. Maybe there is something wrong with out install scripts?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RookieKiwi</span><br />
      <span class="post-time small text-muted">1st April 2001 01:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Bug with RegDLL on Win9x and ME</strong><br />
      <br />
      After a bit more investigation, the "illegal operation" only occurs if the RegDLL command is used in the script. It works fine on Win2K Pro, but not on Win9x or ME.<br />
      <br />
      I've just confirmed that version 1.2beta also has this problem. I'll try some earlier versions and see if I can find when the problem was introduced.<br />
      <br /></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">PabUK</span><br />
      <span class="post-time small text-muted">1st April 2001 01:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you find a fix or workaround let me know so I can upgrade to these newer versions!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RookieKiwi</span><br />
      <span class="post-time small text-muted">1st April 2001 07:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Work around for RegDLL issue.</strong><br />
      <br />
      This seems to work fine for me...<br />
      <br />
      IfFileExists "$SYSDIR\RegSvr32.exe" 0 2<br />
      ExecWait '"$SYSDIR\RegSvr32.exe /s $SYSDIR\vsStr7.ocx"'<br />
      Sleep 500<br />
      <br />
      Since the $SYSDIR is where RegSvr32 is located it works on NT/2000 and Win9x. The /s is for silent registration with no popups.<br />
      <br />
      Cheers<br />
      <br />
      Andrew<br /></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">PabUK</span><br />
      <span class="post-time small text-muted">1st April 2001 13:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks i'll try that out! Any feedback from Justin on this issue yet?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RookieKiwi</span><br />
      <span class="post-time small text-muted">2nd April 2001 07:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>RegDLL issue fixed in 1.2</strong><br />
      <br />
      Confirming the RegDLL/Win9x problem is now fixed with version 1.2!<br />
      <br />
      Thanks Justin, you're a champ!<br /></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">PabUK</span><br />
      <span class="post-time small text-muted">2nd April 2001 13:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just to confirm that it has fixed the problem for me too!<br />
      <br />
      Thanks a lot Justin!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
