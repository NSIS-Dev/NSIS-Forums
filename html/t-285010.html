<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Install using Registry Key" />

  <title>Install using Registry Key - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Install using Registry Key</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=285010">Install using Registry Key</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JediKnight2</span><br />
      <span class="post-time small text-muted">15th January 2008 03:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Install using Registry Key</strong><br />
      I have searched and tried every thing I can think of and have read, but I cannot seem to get this to work.<br />
      <br />
      I have a registry key at HKLM "SOFTWARE\MyProgram" ""<br />
      Basically it shows the location of the install. I have a patched file that needs to go into the location the key shows, but in a sub folder so if the key shows C:\Program Files\MyProgram, I need it in C:\Program Files\MyProgram\lib<br />
      <br />
      I have tried this but it just wont work<br />
      <br />
      Section "MainSection" SEC01<br />
      ReadRegStr $0 HKLM SOFTWARE\MyProgram ""<br />
      IfFileExists $0\lib +2<br />
      StrCpy $0 "$INSTDIR"<br />
      SetOutPath $0<br />
      SetOverwrite on<br />
      File "file.txt"<br />
      SectionEnd<br />
      <br />
      I also tried to add the lib part on the SetOutPath, no worky</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">15th January 2008 05:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Assuming that the mentioned key behaves like the InstallDirRegKey and shows the installation dir, all you need is:<br />
      ReadRegStr $0 HKLM "SOFTWARE\MyProgram" ""<br />
      SetOutPath "$0\lib"<br />
      or in function .onInit<br />
      ReadRegStr $0 HKLM "SOFTWARE\MyProgram" ""<br />
      StrCpy $INSTDIR "$0\lib"</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">IFX</span><br />
      <span class="post-time small text-muted">15th January 2008 22:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, I searched for the term registry folder and read 10 pages worth of stuff and tried all of them. Using the onit, getParent, read the key, etc. For some reason it just wont pick it up. I have used the install directory registry key string and it will read fine from the key. However, when I try to use a read reg key in the section it isn't working.<br />
      <br />
      I tried what you had Red, but it didn't work either...I am posting my code...<br />
      <br />
      Also, for some reason my other account went dead? Not sure what happened to it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">IFX</span><br />
      <span class="post-time small text-muted">15th January 2008 22:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Forgot the file</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">15th January 2008 22:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">InstallDirRegKey has some minor processing applied to the registry key specified. For example, if it detects a path to an executable, it removes the last part. Make sure $0 contains exactly what you think it contains.<br />
      <br />
      You should use $SYSDIR instead of C:\Windows\System32.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">IFX</span><br />
      <span class="post-time small text-muted">16th January 2008 00:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">When it reads the registry key it pulls<br />
      <br />
      C:\Program Files\MyProgram<br />
      <br />
      If I use InstallDirRegKey in a non section it correctly pulls the directory...however what I need to do is append what it pulled and add \lib...so I tried various ways in the Section to read the key and add the \lib..tried Reds way and it didn't work for some reason...it might be something in my script that is why I posted it....I'm lost, it's like it totally ignores the setoutputpath in the Section</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">16th January 2008 05:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">According to the code that you've posted above, you're attempting to read a registry key which obviously doesn't exist, so $0 should be empty and the error flag up.<br />
      The key doesn't exist because your script missing that part where it should create it upon successful installation.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">IFX</span><br />
      <span class="post-time small text-muted">16th January 2008 14:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Something isn't right...the key is there because I can see it in the registry and it is at HKLM Software\MyProgram There are two strings in there...one is a default string and another is a DB location. If I take out the ReadRegStr part in the Section and use InstallDirRegKey HKLM "SOFTWARE\${SHORTNAME}" "" it correctly sets the install location. So that is where I am confused...I take the InstallDirRegKey out and use ReadRegStr in the Section and it doesn't work....</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">16th January 2008 15:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Check the value of $0 after you read it from the registry using a message box.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">IFX</span><br />
      <span class="post-time small text-muted">22nd January 2008 13:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok...I see what is going on, but I haven't figured out how to fix it. I just took that page off since it is a patch anyway..it IS going to the right directory, however when it goes to this page<br />
      ; Directory page<br />
      !insertmacro MUI_PAGE_DIRECTORY<br />
      it is printing out the wrong directory not the one that is read in the section...like I said I don't need it because it is a patch and the registry key correctly points to the location I need it to.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">22nd January 2008 13:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You need to use !define MUI_DIRECTORYPAGE_VARIABLE $Var<br />
      Otherwise it will use $INSTDIR.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
