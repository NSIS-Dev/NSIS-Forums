<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="1.94 Installer/Uninstaller bug/crash"><title>1.94 Installer/Uninstaller bug/crash - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">1.94 Installer/Uninstaller bug/crash</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=73275">1.94 Installer/Uninstaller bug/crash</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Pomflain</span><br><span class="post-time small text-muted">25th January 2002 13:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>1.94 Installer/Uninstaller bug/crash</strong><br>If you happen to set the installer or uninstaller to autoclose, and then do an ExecWait on something that can take a while and start up after the installer or uninstaller should have closed, then the program will hang and you must explicitly kill it.<br><br>I was made an uninstaller that then shells off the installer again since I was having the problem with the "uninstaller failed to initialize" with using ExecShell. So I switched to ExecWait, and that works fine. However, the uninstaller would appear behind the installer on some systems because of the latency between .onInit in the installer and the spawning of the uninstaller. So I changed it so that the installer writes it's location out to a REG_SZ and the uninstaller reads that and then tries to restart the installer just before it autocloses. The problem, however, was when I changed my ExecShell for the Hotsync.exe to an ExecWait. Hotsync.exe takes several seconds to load on any system since it scans the hardware ports and such, and it happened to launch after the uninstaller should have finished. The close button was greyed out, so I tried clicking on the 'x', but that didn't work. Nor did clicking on the left side and going to close, or alt-f4. So I'm using ExecShell again. The reason I wanted it to wait was because you could start to install the program again before the HotSync.exe restarted and that can lead to some less than perfect conditions.<br><br>So just pointing out this potential error...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rainwater</span><br><span class="post-time small text-muted">25th January 2002 16:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Try using a Sleep xxx and a BringToFront command in the initialization of your uninstaller to bring it to the front.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Pomflain</span><br><span class="post-time small text-muted">25th January 2002 20:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Been there, done that, doesn't work because that stuff is all done in .onInit so that the person doesn't pick options and then get punted from the installer. As such the window hasn't been put through the ShowWindow yet, and thus will appear on top of the installer on slower systems that take longer to get to that portion. I spent a few days trying combinations of bringtofront, and hidewindow with sleep commands and it doesn't work. What I have now works correctly, though, and doesn't depend on your system specs.<br><br>So thanks for the comment, but already tried that and it didn't work.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">justin</span><br><span class="post-time small text-muted">25th January 2002 20:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hmm, I really don't understand what your problem is. Try to explain it more clearly, please.<br><br>-Justin</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Pomflain</span><br><span class="post-time small text-muted">25th January 2002 21:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok, you set the installer or uninstaller to autoclose. You then do an ExecWait on a program that times some time to load. In this case the Palm Desktop's HotSync Manager, which takes several seconds to load since it has to gather hardware information. So the installer or uninstaller finishes and would normally just close on it's own since the autoclose has been set. However, it doesn't close because of the ExecWait. The close button is greyed out, though, and you can't kill it through normal methods.<br><br>Does that help explain it better?<br><br>It's not a problem of any kind for what I'm doing, I wanted to see what would happen, and it wasn't the result I expected.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Pomflain</span><br><span class="post-time small text-muted">25th January 2002 21:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>I've been up too late...</strong><br>Man, being up working the last 36 hours hasn't helped. I was thinking that it would return an exit code once the HotSync manager loaded correctly. However, it doesn't. I changed that line again and the uninstaller quit when I closed the HotSync. So I don't think there's a problem there. The StrCmp $x/ StrCmp "$x" thing, though, that's different...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">justin</span><br><span class="post-time small text-muted">25th January 2002 21:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Umm yeah, ExecWait waits for the child process to exit. You can use Exec if you don't want to wait.<br><br><br>StrCmp $x/StrCmp "$x"<br><br>huh?<br><br>-Justin</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Pomflain</span><br><span class="post-time small text-muted">25th January 2002 22:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I noticed that StrCmp $x str1 wasn't working like I figured. I was reading a REG_SZ from the registry and then doing StrCmp $var "" jump_equal. If the REG_SZ wasn't in the registry, then $var should be null, and always has been as far as I remember. Been using that bit in all the scripts for 5 ot 6 months. Anyway, I threw up a messagebox to make sure I was correctly reading the variable. Specifically it had to do with optional parts of the installer and how to handle an uninstall. If I installed this one optional part, then I was writing "Installed" into a registry key. That's what I was then reading back again and doing StrCmp $var on. Anyway, it was failing, so I changed it to the converse, so I made it StrCamp $var "Installed" jump_not_equal_from_before. I knew that the variable was exactly "Installed" since I was throwing it up in the messagebox. The StrCmp still failed, though. So I changed it to StrCmp "$var" jump... and then it worked.<br><br>I posted about this a few days ago but my post must have disappeared since it's nowhere to be found. I was just asking if this was the new behavior since the samples with the installed such as bigtest.nsi are using StrCmp $x "" and I was as well, but now it seems that StrCmp "$x" "" is needed to force it to a string. Thought maybe something with the internal string conversion might have gotten messed up. That's what I meant before.<br><br>Hopefully that makes sense...been up way too long at this point...</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>