<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Problem: GetTempFileName &amp; Upgrade Shared-DLLs"><title>Problem: GetTempFileName &amp; Upgrade Shared-DLLs - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Problem: GetTempFileName &amp; Upgrade Shared-DLLs</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=104044">Problem: GetTempFileName &amp; Upgrade Shared-DLLs</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">NoStarWhere</span><br><span class="post-time small text-muted">7th September 2002 08:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Problem: GetTempFileName &amp; Upgrade Shared-DLLs</strong><br>Hi All,<br><br>My OS is Windows 9x, and in my autoexec.bat has (red) lines :<br><br><font color="red">SET TEMP=C:\WINDOWS\TEMP</font><br>:temp=c:\windows\temp is default by Windows, but I re-set for sure an existing TEMP environment<br>:then remove all temporary files in TEMP folder that countn't be deleted because PC halted, Software halted or bad softwares have been created<br><font color="red">IF NOT EXIST %TEMP%\*.* GOTO endbat</font><br><font color="red">ECHO Y | DEL %TEMP%\*.* &gt; NUL</font><br><font color="red">:endbat</font><br><br><br>In .NSI:<br><br>Push $SYSDIR\xyz.dll<br>!insermacro UpgradeDLL xyz.dll<br>;Reboot<br><br>After running installer, I found in WININIT.INI, such as<br><br>[rename]<br>C:\WINDOWS\SYSTEM\xyz.dll=C:\WINDOWS\TEMP\nst_unique.TMP<br><br>After restarting computer, the file nst_unique.TMP in C:\WINDOWS\TEMP has been deleted (ensuant on the autoexec.bat) before Windows loads. And the file xyz.dll cannot be upgraded.<br><br>I think, the best of this case is never copy nst_unique.TMP to $TEMP<br>If and when GetTempFileName only assigned to user-var a value "filename.tmp" instead of "$TEMP\filename.tmp", then I want, I'll use such as "$SYSDIR\filename.tmp", "$INSDIR\filename.tmp", "$TEMP\filename.tmp", etc.<br>In the meantime, can get "filename.tmp":<br><font color="darkblue"><font face="courier new"><br>GetTempFileName $0<br>Push $0 ; ex: $0 = C:\WINDOWS\TEMP\nst_unique.TMP<br>Call Filename<br>Pop $0 ; ---&gt; $0 = nst_unique.TMP<br><br>Function Filename<br>; You are easy to write this code<br>FunctionEnd<br></font></font><br><br>Sorry my bad English... too. :cry:<br>So I hope you understand what I mean.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">7th September 2002 09:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Simply change the output file from the result of GetTempFile to the filename plus .onreboot or something alike. Put it in the same directory and it won't be deleted on reboot.<br><br>For example, if you had in the macro:<br>GetTempFileName $0<br>File /oname=$0 $R0 ; $R0 being the variable holding the filename<br><br>Replace it with:<br>File /oname=$R0.onreboot $R0</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">superrock</span><br><span class="post-time small text-muted">7th September 2002 09:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Windows-Temp</strong><br>Hi!<br><br>I made the experience, that deleting the Windows %temp% directory in Autoexec.bat is making troubles anyway. Windows is using this directory as a system part. Therefore installers will write temporary files, which are used after restarting the system.<br><br>May be it's better to delete the temp directory in a batch file in the autostart group of the Windows. Tasks for installing applications needing a Windows restart should have executed all operations before and hopefully delete all temporary stuff!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NoStarWhere</span><br><span class="post-time small text-muted">7th September 2002 11:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I agree with what you say. But I don't know users which using my installer, in their autoexec.bat has been deleting temp folder.<br><br><br>To Kichik : Thank you for quick reply. I'll try now.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>