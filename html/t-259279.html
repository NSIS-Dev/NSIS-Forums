<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Need help with my custom page (droplist)" />

  <title>Need help with my custom page (droplist) - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Need help with my custom page (droplist)</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=259279">Need help with my custom page (droplist)</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sp33dy G0nz4l3s</span><br />
      <span class="post-time small text-muted">10th November 2006 16:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Need help with my custom page (droplist)</strong><br />
      Hi,<br />
      I've created a custom page.<br />
      <br />
      <a href="http://cs-erweiterungen.de/Picture.jpg" target="_blank">http://cs-erweiterungen.de/Picture.jpg</a><br />
      <br />
      On the custom page the user can insert his steam ID/IP or a name. When he has insert his steam ID/IP or name he must choose which type it is.<br />
      <br />
      It's for define an Admin. One can define 3 Admins.<br />
      <br />
      The first "admin code" works fine but I've a problem with the 2 others.. when one choose the type of Admin in the droplist it isn't work. In the "users.ini" file are further the words Flag1 or Flag2.<br />
      <br />
      Could you help me?<br />
      <br /></p>
      <pre>
<code>; Password Page<br />Function Steam_IDPage<br />!insertmacro SectionFlagIsSet ${Section2} ${SF_SELECTED} ShowPage SkipPage<br />ShowPage:<br /><br />GetDlgItem $R0 $HWNDPARENT 2<br />EnableWindow $R0 0|1 # 0=hide, 1=show<br />GetDlgItem $R0 $HWNDPARENT 3<br />EnableWindow $R0 0|1 # 0=hide, 1=show<br />!insertmacro MUI_HEADER_TEXT "Konfiguration des Erweiterungs System" "Tragen Sie die Administratoren ein."<br />!insertmacro MUI_INSTALLOPTIONS_DISPLAY "steam_id.ini"<br /><br />SkipPage:<br /><br />FunctionEnd<br /><br />Function .OnGUIEnd<br />Call CopyFlag<br />FunctionEnd<br /><br />; Copy Flag<br />!macro REPLACE_FLAG1 SOURCE<br /><br />Push "Flag1"             #-- text to be replaced  within the " "<br />Push "${SOURCE}"             #-- replace with anything within the " "<br />Push all                      #-- replace all occurrences <br />Push all                      #-- replace all occurrences <br />Push $INSTDIR\cstrike\addons\amxmodx\configs\users.ini      #-- file to replace in <br />Call AdvReplaceInFile         #-- Call the Function<br /><br />goto done3<br />!macroend<br /><br />; Copy Flag<br />!macro REPLACE_FLAG2 SOURCE<br /><br />Push "Flag2"             #-- text to be replaced  within the " "<br />Push "${SOURCE}"             #-- replace with anything within the " "<br />Push all                      #-- replace all occurrences <br />Push all                      #-- replace all occurrences <br />Push $INSTDIR\cstrike\addons\amxmodx\configs\users.ini      #-- file to replace in <br />Call AdvReplaceInFile         #-- Call the Function<br /><br />goto done3<br />!macroend<br /><br />; Copy Flag<br />!macro REPLACE_FLAG3 SOURCE<br /><br />Push "Flag3"             #-- text to be replaced  within the " "<br />Push "${SOURCE}"             #-- replace with anything within the " "<br />Push all                      #-- replace all occurrences <br />Push all                      #-- replace all occurrences <br />Push $INSTDIR\cstrike\addons\amxmodx\configs\users.ini      #-- file to replace in <br />Call AdvReplaceInFile         #-- Call the Function<br /><br />goto done3<br />!macroend<br /><br />; Copy Flag<br />Function CopyFlag<br /><br />;1<br />Push $R0<br />ReadINIStr $R0 "$PLUGINSDIR\steam_id.ini" "Field 12" "State"<br /><br />StrCmp $R0 "Steam ID" 0 notSteamID1<br />!insertmacro REPLACE_FLAG1 ce<br />notSteamID1:<br /><br />StrCmp $R0 "IP" 0 notIP1<br />!insertmacro REPLACE_FLAG1 de<br />notIP1:<br /><br />StrCmp $R0 "Name" 0 done1<br />!insertmacro REPLACE_FLAG1 be<br />done1:<br /><br />;2<br />ReadINIStr $R0 "$PLUGINSDIR\steam_id.ini" "Field 13" "State"<br /><br />StrCmp $R0 "Steam ID" 0 notSteamID2<br />!insertmacro REPLACE_FLAG2 ce<br />notSteamID2:<br /><br />StrCmp $R0 "IP" 0 notIP2<br />!insertmacro REPLACE_FLAG2 de<br />notIP2:<br /><br />StrCmp $R0 "Name" 0 done2<br />!insertmacro REPLACE_FLAG2 be<br />done2:<br /><br />;3<br />ReadINIStr $R0 "$PLUGINSDIR\steam_id.ini" "Field 14" "State"<br /><br />StrCmp $R0 "Steam ID" 0 notSteamID3<br />!insertmacro REPLACE_FLAG3 ce<br />notSteamID3:<br /><br />StrCmp $R0 "IP" 0 notIP3<br />!insertmacro REPLACE_FLAG3 de<br />notIP3:<br /><br />StrCmp $R0 "Name" 0 done3<br />!insertmacro REPLACE_FLAG3 be<br />done3:<br /><br />Pop $R0<br />FunctionEnd<br /><br />LangString NoSteam_ID ${LANG_GERMAN} "Bitte geben Sie eine Steam_ID ein!"<br /><br />; Page Leave Feautures<br />Function PageLeaveSteam_ID<br /><br />!insertmacro MUI_INSTALLOPTIONS_READ $R0 "steam_id.ini" "Field 7" "State"<br />${If} $R0 != ""<br />Push "steamid1"             #-- text to be replaced  within the " "<br />Push "$R0"                    #-- replace with anything within the " "<br />Push all                      #-- replace all occurrences<br />Push all                      #-- replace all occurrences<br />Push $INSTDIR\cstrike\addons\amxmodx\configs\users.ini      #-- file to replace in<br />Call AdvReplaceInFile         #-- Call the Function<br />${EndIf}<br /><br />!insertmacro MUI_INSTALLOPTIONS_READ $R0 "steam_id.ini" "Field 8" "State"<br />${If} $R0 != ""<br />Push "steamid2"             #-- text to be replaced  within the " "<br />Push "$R0"                    #-- replace with anything within the " "<br />Push all                      #-- replace all occurrences<br />Push all                      #-- replace all occurrences<br />Push $INSTDIR\cstrike\addons\amxmodx\configs\users.ini      #-- file to replace in<br />Call AdvReplaceInFile         #-- Call the Function<br />${EndIf}<br /><br />!insertmacro MUI_INSTALLOPTIONS_READ $R0 "steam_id.ini" "Field 9" "State"<br />${If} $R0 != ""<br />Push "steamid3"             #-- text to be replaced  within the " "<br />Push "$R0"                    #-- replace with anything within the " "<br />Push all                      #-- replace all occurrences<br />Push all                      #-- replace all occurrences<br />Push $INSTDIR\cstrike\addons\amxmodx\configs\users.ini      #-- file to replace in<br />Call AdvReplaceInFile         #-- Call the Function<br />${EndIf}<br /><br />ReadIniStr $0 '$PLUGINSDIR\steam_id.ini' 'Field 12' 'State'<br />strcmp $0 '' error ok<br />error:<br />MessageBox MB_OK "Bitte wÃ¤hlen Sie einen 'Admintyp' aus!"<br />abort<br />ok:<br /><br />FunctionEnd</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bholliger</span><br />
      <span class="post-time small text-muted">10th November 2006 22:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi!<br />
      <br />
      What exactly is not working? You can't use the droplist box?<br />
      <br />
      Cheers<br />
      <br />
      Bruno</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sp33dy G0nz4l3s</span><br />
      <span class="post-time small text-muted">11th November 2006 10:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, right my problem ist that the code from the droplist number 2 and 3 are not working.<br />
      <br />
      I've extract the code now.<br />
      <br />
      Thanks for your help. I hope you understand my problem :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bholliger</span><br />
      <span class="post-time small text-muted">11th November 2006 11:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Speedy!<br />
      <br />
      The script reads "state" of the wrong sections.<br />
      I suggest using<br /></p>
      <pre>
<code><br />!define CMB_ADMINTYP1 "Field 5"<br />:<br />ReadINIStr $R0 "$PLUGINSDIR\steam_id.ini" "${CMB_ADMINTYP1}" "State"<br /></code>
</pre><br />
      <br />
      If you change your dialog, you only have to change the definitions in one place.<br />
      <br />
      These are the correct ReagINIStr:<br />
      <br />
      ReadINIStr $R0 "$PLUGINSDIR\steam_id.ini" "Field 10" "State"<br />
      :<br />
      ReadINIStr $R0 "$PLUGINSDIR\steam_id.ini" "Field 11" "State"<br />
      :<br />
      ReadINIStr $R0 "$PLUGINSDIR\steam_id.ini" "Field 12" "State"<br />
      <br />
      I suggest not using goto in your REPLACE_FLAGx macros. They are wrong, because they jump to done3 which is after the third instruction set.<br />
      <br />
      Just a question:<br />
      <br />
      What is the purpose of Pop in there?<br />
      <pre>
<code><br />done3:<br /><br />Pop $R0 ; &lt;&lt;--<br />FunctionEnd<br /></code>
</pre><br />
      <br />
      Ok, with these hints the script should work.<br />
      <br />
      To improve the readability of your script, you might create the macros in this manner:<br />
      <br />
      !macro REPLACE FLAG SOURCE<br />
      Push "${FLAG}" #-- text to be replaced within<br />
      Push "${SOURCE}" #-- replace with anything<br />
      Push all #-- replace all occurrences<br />
      Push all #-- replace all occurrences<br />
      Push $INSTDIR\Test.txt #-- file to replace in<br />
      Call AdvReplaceInFile #-- Call the Function<br />
      !macroend<br />
      <br />
      With this change you could remove two macros.<br />
      <br />
      Ok, hope this helps.<br />
      <br />
      Have a nice day!<br />
      <br />
      Tschuess!<br />
      <br />
      Bruno
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sp33dy G0nz4l3s</span><br />
      <span class="post-time small text-muted">11th November 2006 13:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks a lot Bruno :)<br />
      <br />
      It works fine. Only one further question.<br />
      <br />
      Is it possible when user writes something in Field 8, in Field 11 must be also choosed the "Admintyp"...<br />
      <br />
      and when he writes something in Field 9, in Field 10 must be choosed the "Admintyp"?<br />
      <br />
      Thank you</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bholliger</span><br />
      <span class="post-time small text-muted">11th November 2006 21:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Speedy!<br />
      <br />
      Yes of course!<br />
      <br />
      Just add code to your validate script (PageLeaveSteam_ID): Read every value and decide whether everything is alright. If not, tell the user why and call Abort. This will leave the dialog as it is. The user edits the entries and tries again.<br />
      <br />
      Have a nice day!<br />
      <br />
      Cheers<br />
      <br />
      Bruno</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sp33dy G0nz4l3s</span><br />
      <span class="post-time small text-muted">12th November 2006 11:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi,<br />
      I've tried now to create this code but I don't understand how I can make this code that he checks values between two Fields:<br />
      <br />
      I tried this but it's completely wrong^^:<br />
      <br /></p>
      <pre>
<code>!insertmacro MUI_INSTALLOPTIONS_READ $R1 "steam_id.ini" "Field 8" "State"<br />strcmp $R0 '' $R1 error ok<br />error:<br />MessageBox MB_OK|MB_ICONINFORMATION "$(NoAdmin)"<br />Abort<br />ok:</code>
</pre><br />
      <br />
      Could you write me an example please :)?<br />
      Thank you
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bholliger</span><br />
      <span class="post-time small text-muted">12th November 2006 12:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Speedy!<br />
      <br />
      Here's a draft how it could look like.<br />
      <br /></p>
      <pre>
<code><br />ReadIniStr $0 '$PLUGINSDIR\steam_id.ini' 'Field 12' 'State'<br />ReadIniStr $1 '$PLUGINSDIR\steam_id.ini' 'Field 7' 'State'<br /><br />${Unless} $1 == '' ; if not<br />  ${If} $0 == ''<br />    MessageBox MB_OK "Bitte wÃ¤hlen Sie einen 'Admintyp' aus!"<br />    Abort<br />  ${EndIf}<br />${EndIf}<br /></code>
</pre><br />
      <br />
      LogicLib is very useful. Here you'll find some information:<br />
      <a href="http://nsis.sourceforge.net/LogicLib" target="_blank">http://nsis.sourceforge.net/LogicLib</a><br />
      and in the Examples\LogicLib.nsi too.<br />
      <br />
      Have a nice day!<br />
      <br />
      Cheers<br />
      <br />
      Bruno
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sp33dy G0nz4l3s</span><br />
      <span class="post-time small text-muted">12th November 2006 20:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hey thanks :) !<br />
      <br />
      Works perfect</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
