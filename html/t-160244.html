<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Compile-time/Run-time defines" />

  <title>Compile-time/Run-time defines - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Compile-time/Run-time defines</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=160244">Compile-time/Run-time defines</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">AlwaysLearning</span><br />
      <span class="post-time small text-muted">17th December 2003 10:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Compile-time/Run-time defines</strong><br />
      Hello,<br />
      <br />
      I've read all related topics and documentation , but still<br />
      confused and dont know if it's possible to do what i need with NSIS installer.<br />
      <br />
      I'm building setup packages for different affiliates.<br />
      Set of setup files is the same , but what changes is<br />
      packages name and installation folder.<br />
      <br />
      Before running the setup , there is some small pre-setup<br />
      utility that can write values to registry.<br />
      <br />
      The question is : is it possible "to tell" nsis to take<br />
      these values from registry and not to "hardcode" them in the script ?<br />
      <br />
      <br />
      Here's my current installation script:<br />
      ---------------------------------<br />
      <br />
      !define MUI_PRODUCT "AAASoft" ;Define your own software name here<br />
      !define MUI_PRODUCT_LINK "AAA Soft" ;Define your own software short cut here<br />
      !define MUI_VERSION "2.1" ;Define your own software version here<br />
      <br />
      !define MUI_ICON "C:\SoftProjectV2\IconBig.ico"<br />
      !define MUI_UNICON "C:\SoftProjectV2\IconBig.ico"<br />
      <br />
      SetCompress Off<br />
      !include "MUI.nsh"<br />
      <br />
      ;--------------------------------<br />
      ;Configuration<br />
      AutoCloseWindow true ;<br />
      <br />
      ;General<br />
      OutFile "C:\SoftProjectV2\SoftSetup.exe"<br />
      <br />
      ;Folder selection page<br />
      InstallDir "$PROGRAMFILES\${MUI_PRODUCT}"<br />
      <br />
      !define MUI_UNINSTALLER<br />
      ;--------------------------------<br />
      ;Language<br />
      <br />
      !insertmacro MUI_LANGUAGE "English"<br />
      ;--------------------------------<br />
      BrandingText "Installing soft"<br />
      ;--------------------------------<br />
      ;Installer Sections<br />
      <br />
      Section "CopyingFiles"<br />
      SetOutPath "$INSTDIR"<br />
      FILE "C:\SoftProjectV2\SoftDLLS\file1.dll"<br />
      FILE "C:\SoftProjectV2\SoftDLLS\file2.dll"<br />
      FILE "C:\SoftProjectV2\SoftDLLS\file.exe"<br />
      SectionEnd<br />
      <br />
      ;Add Shortcuts<br />
      <br />
      Section "SettingEnvironment"<br />
      SetOutPath $INSTDIR<br />
      ;Create Desktop Icon<br />
      CreateShortCut "$DESKTOP\${MUI_PRODUCT_LINK}.lnk" "$INSTDIR\soft.exe"<br />
      CreateShortCut "$SMPROGRAMS\${MUI_PRODUCT_LINK}.lnk" "$INSTDIR\soft.exe"<br />
      WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${MUI_PRODUCT}" "DisplayName" "${MUI_PRODUCT_LINK}"<br />
      WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${MUI_PRODUCT}" "UninstallString" "$INSTDIR\Uninst.exe"<br />
      WriteUninstaller "$INSTDIR\Uninst.exe"<br />
      SectionEnd<br />
      <br />
      ;--------------------------------<br />
      <br />
      ;Uninstaller Section<br />
      <br />
      Section "Uninstall"<br />
      <br />
      ;Delete Files<br />
      Delete "$INSTDIR\*.*"<br />
      <br />
      ;Delete Desktop Icon<br />
      Delete "$DESKTOP\${MUI_PRODUCT_LINK}.lnk"<br />
      <br />
      ;Delete Start Menu Shortcuts<br />
      Delete "$SMPROGRAMS\${MUI_PRODUCT_LINK}.lnk"<br />
      <br />
      Delete "$INSTDIR\*.*"<br />
      RMDir /r "$INSTDIR\"<br />
      <br />
      ;Delete Uninstaller And Unistall Registry Entries<br />
      DeleteRegKey HKEY_CURRENT_USER "SOFTWARE\${MUI_PRODUCT}"<br />
      DeleteRegKey HKEY_LOCAL_MACHINE "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\${MUI_PRODUCT}"<br />
      DeleteRegKey /ifempty HKCU "Software\${MUI_PRODUCT}"<br />
      <br />
      SectionEnd<br />
      <br />
      <br />
      Function .onInstSuccess<br />
      ExecShell open "$INSTDIR\Soft.exe"<br />
      FunctionEnd<br />
      ;eof<br />
      <br />
      --------------------------------------------------------<br />
      <br />
      What i need is small modification , so if there's some specific known location in registry defining product name - script will take it from there.<br />
      <br />
      Thanks a lot!<br />
      <br />
      <br />
      <br />
      <br />
      P.S. I found out that "InstallDirRegKey" command might help,<br />
      is it correct direction ?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">17th December 2003 11:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The easiest solution is to let the utility write a NSIS include file or to create an application that reads a few registry settings and writes an include file.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Vytautas</span><br />
      <span class="post-time small text-muted">17th December 2003 11:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Do you want to be able to read the registry entries at compile-time, when the script is made on your machine, or at run-time from the users machine?<br />
      <br />
      For compile-time mods you will have to create another little program which will read these entries and write them into a NSIS compatible include file which then can be included into the main script. To execute the program you will have to use the '!system' command.<br />
      <br />
      If you want to chage these at runtime simply read them using the registry functions available in NSIS. To modify the name it-self you might need to define it with a variable and then set the variable at run-time.<br />
      <br />
      I hope this helps you!<br />
      <br />
      Vytautas ;)<br />
      <br />
      [edit]Oops joost was just a bit quicker :D[/edit]<br />
      <br />
      BTW: In future could you attach long scripts.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">AlwaysLearning</span><br />
      <span class="post-time small text-muted">17th December 2003 12:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I want these variables at run-time (on user machine).<br />
      <br />
      I would appreciate if you show me specific code i need to insert.<br />
      <br />
      Joost Verburg: "The easiest solution is to let the utility write a NSIS include file or to create an application that reads a few registry settings and writes an include file."<br />
      <br />
      It sounds like what i need. Can you please point me to some<br />
      example using this approach ?<br />
      <br />
      Vytautas : What do you mean by "In future could you attach long scripts." ? Is it a problem to paste code here ?<br />
      I deleteted unneeded strings before posting it to make it<br />
      shorter.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Vytautas</span><br />
      <span class="post-time small text-muted">17th December 2003 12:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I think that joost's idea will only work at compile-time. You were right about the "InstallDirRegKey" command, you can see how its supposed to be used from examples available with NSIS. The thoery behind my other suggestion is that if you define the name of the installer with a variable like $1 and then change $1 at run-time the name should then also change, although I could be wrong as it depends on how NSIS Installers have their names defined internally.<br />
      <br />
      As for my comment about attaching scripts it would just make the thread load quicker for us with dail-up internet :p<br />
      <br />
      Vytautas</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
