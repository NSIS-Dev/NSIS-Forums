<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Downloading Files from a list." />

  <title>Downloading Files from a list. - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.2/readable/bootstrap.min.css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Downloading Files from a list.</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=297533">Downloading Files from a list.</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Johnm312</span><br />
      <span class="post-time small text-muted">18th September 2008 03:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Downloading Files from a list.</strong><br />
      &nbsp; I have a question.<br />
      <br />
      <br />
      I had a similar script for this in the past but it is not quite working for this install.<br />
      <br />
      I have a list (actually a few). that are located on a server. that have a url followed by list of 100's of small files that I need to collect.<br />
      <br />
      My old system had INI's where there were just a few files so it was easy to manage and download<br />
      <br />
      the new server just has a text file with all the files listed that I need to grab.<br />
      <br /></p>
      <pre>
<code>
***93;
<br />&gt;ww.someserver.com/files
<br /><br />&gt;***91;Files***93;
<br />&gt;file1.dat
<br />someotherfile</code>.dat
<br />randomename.dat
<br />somthingorother.dat
<br />etc.dat 
<br />&gt;

</pre>Anyone have any ideas on how to possibly grab the files?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">QOAL</span><br />
      <span class="post-time small text-muted">18th September 2008 13:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You may be interested in a script (well two scripts) I wrote, it goes a bit further than you'd want I guess. (it crc checks the files on the users drive to check if they need updating or not.)<br />
      <br />
      I'll attach them so you can have a look.<br />
      (I left them set up to create a list of files from a local SVN check out of a game I used to work on. And download the update file from localhost and the actual files from the actual SVN.)<br />
      <br />
      My script uses 2 extra things:<br />
      CRCCheck.dll plugin form <a href="http://nsis.sourceforge.net/mediawiki/images/f/fd/CRCCheck.zip" target="_blank">http://nsis.sourceforge.net/mediawik...d/CRCCheck.zip</a><br />
      RecFind.nsh from <a href="http://nsis.sourceforge.net/RecFind:_Recursive_FindFirst,_FindNext,_FindClose" target="_blank">http://nsis.sourceforge.net/RecFind:...ext,_FindClose</a><br />
      <br />
      Basically the Generate_Update_File.nsi script creates a file that lists, recursively, all the files in a given folder and their crc's.<br />
      The Updater.nsi downloads this file and checks the users local files to see what needs updating/deleting etc.<br />
      <br />
      The code might need a bit of cleaning up, but it works.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Johnm312</span><br />
      <span class="post-time small text-muted">29th September 2008 22:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">QOAL,<br />
      <br />
      Thanks. I had had not had time to do a thing this last week. I just DL'd it and am going to take a look.<br />
      <br />
      I appreciate the help.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Johnm312</span><br />
      <span class="post-time small text-muted">30th September 2008 06:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">QOAL,<br />
      <br />
      I just got time to test your script out.<br />
      <br />
      Very nice! It is almost exactly what i had in mind. I am sure I could use this script with a few changes. I like the subdirectory searching.<br />
      <br />
      I did find 2 bugs, 1 minor and 1 major.<br />
      <br />
      #1 in the build script; It adds the text file itself to the directory list. if I don't manually remove it from the text file, the rest of the download fails after it hits that section.<br />
      <br />
      Not a big deal, I just have to remember to edit the text file or maybe change the script to create the text file in the $exedir.<br />
      <br />
      #2 In the download script; This is a bit of a problem. any source file or folder that has a space in it fails to copy.<br />
      <br />
      The download name/path is correct in the log. but, i get failed download. I took a look all over the script and did not see how to fix that. I did try it on both a UNIX and a windows host to see if maybe it was the %20 missing.<br />
      <br />
      <br />
      2 other things that i did notice that would be of help;<br />
      <br />
      1 the option to remove local files if they are not on the host. perhaps a flag to set in the text file.<br />
      <br />
      2 this is probably not something that can be changed, all of my INI's (30+) and most of my documentation wants to re-download every time I run it. I can probably find a solution to this.<br />
      <br />
      I am very impressed by this and I thank you for sharing it. If you have any ideas on the "space" issue, i would love some help.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">QOAL</span><br />
      <span class="post-time small text-muted">30th September 2008 11:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Glad you like it. :)<br />
      <br />
      Okay I've fixed those two bugs now:<br />
      It makes sure it doesn't add the updates file to the list<br />
      Replaces Spaces with %20, if any other characters need to be made web safe then take a look at line 206 of updater.nsi; copy and edit that line for extra chars.<br />
      <br />
      To force it to download a file each time, even if it's the same as on disk, change the CRC value in the generated file to something other than the correct value. I have added a check for it being FORCE, which would be better to use since it should be a tiny amount faster and also easier to see what should be always downloaded.<br />
      <br />
      To make it so you delete a file locally add the file name then 0 on the line below.<br />
      You could just make a empty file with the correct name and run the generator, has the same effect<br />
      To remove folders do folder name then RMDIR on the line below.<br />
      <br />
      As for you last point, it should only download files if they have a different CRC than what's in the updates file (aka they have been modified), hrmm.<br />
      So maybe an option to just check if a file exists locally and if it does then don't download?<br />
      Okay I just added that, you'll have to change the CRC in the generated file to ONCE for each file that needs that.<br />
      <br />
      <br />
      I might be able to do something with arrays so you can list force download (, ignore?) &amp; delete files in a separate file which the generator looks at and merges in to the update list for you. yay/nay? I'll have a play any way.<br />
      <br />
      Any thing else? :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Johnm312</span><br />
      <span class="post-time small text-muted">30th September 2008 17:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I just took a quick look at the update.<br />
      <br />
      The generator works without a hitch.<br />
      <br />
      The updater has a new bug. the word replace line for "/" "\" is now ignored, resulting in no downloaded files.<br />
      once I rem'd out the %20 line it was back to normal.<br />
      <br />
      <br />
      Something minor:<br />
      I noticed that the server path has a double // in it. This could have been in the last release and I overlooked it. I added a detailPrint line to show the server path to help debug the %20 error so now I see it.<br />
      <br /></p>

      <blockquote>
        Starting update process...<br />
        Downloading updates list file: updates.txt<br />
        <br />
        Downloading new file: \USSE262A.dat<br />
        edited_servername.com/beta/test//USSE262A.dat<br />
        Folder: subfolder<br />
        Make: C:\Dat_Sync_Demo\subfolder<br />
        Create folder: C:\Dat_Sync_Demo\subfolder<br />
        Delete file: C:\Dat_Sync_Demo\updates.txt<br />
        Updating finished!<br />
        Completed
      </blockquote>I think the extra backslash is created by the generator by adding a \ before the root files. so far my server could care less and still works.<br />
      <br />
      <br />
      Thanks for taking the time to update it.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">QOAL</span><br />
      <span class="post-time small text-muted">30th September 2008 19:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hrmm indeed<br />
      <br />
      *one hour passes*<br />
      <br />
      Should be fixed now</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Johnm312</span><br />
      <span class="post-time small text-muted">30th September 2008 20:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Bloody Brilliant!<br />
      <br />
      I tried most of the features in a single run, I than ran it a second time. It still has the issues with the INI files. I can live with that since several do get updated with each update.<br />
      <br />
      The deletion feature works fine, File/Folder names are resolved that have spaces. the second "/" is fine.<br />
      <br />
      Quote:</p>
      <hr />
      If I do go ahead with this script I'll make sure and credit you (Sorry no royalties, this is freeware).<br />
      <br />
      You defiantly gave me a useful option and saved me days of pounding my head to a pulp on my desk.<br />
      <br />
      <br />
      [Afterhought]<br />
      <br />
      I just had a thought about using your logic to create snapshot difference folder.<br />
      <br />
      Take a snapshot of the virgin game folder; then add whatever user created mods/patches/updates. Take a new snapshot, copying whatever files/folders that are not CRC original to a new folder or zip. Thus creating a user created or custom patch that they can archive or re-apply later. Perhaps this might even save me time in creating my updates.<br />
      <br />
      <br />
      Anyways...<br />
      <br />
      Thanks a ton! You defiantly made my day and I appreciate Your help.<br />
      <br />
      John

      <table cellpadding="6" cellspacing="0" border="0" width="100%">
        <tr>
          <td class="alt2">
            <hr />
            Run#1:<br />
            <br />
            Output folder: C:\Dat_Sync_Demo<br />
            Starting update process...<br />
            Downloading updates list file: updates.txt<br />
            Downloading new file: Text Document with Spaces.txt<br />
            WebServer/beta/test/Text%20Document%20with%20Spaces.txt<br />
            Downloading new file: USDDA40X.dat<br />
            WebServer/beta/test/USDDA40X.dat<br />
            Downloading new file: Version.ini<br />
            WebServer/beta/test/Version.ini<br />
            Delete file: C:\Dat_Sync_Demo\USGT45U2.dat<br />
            Folder: subfolder_test<br />
            Make: C:\Dat_Sync_Demo\subfolder_test<br />
            Create folder: C:\Dat_Sync_Demo\subfolder_test<br />
            Downloading new file: subfolder_test\USDD35.dat<br />
            WebServer/beta/test/subfolder_test/USDD35.dat<br />
            Folder: Folder with Spaces<br />
            Make: C:\Dat_Sync_Demo\Folder with Spaces<br />
            Create folder: C:\Dat_Sync_Demo\Folder with Spaces<br />
            Downloading new file: Folder with Spaces\USGT45U2.dat<br />
            WebServer/beta/test/Folder%20with%20Spaces/USGT45U2.dat<br />
            Delete file: C:\Dat_Sync_Demo\updates.txt<br />
            Updating finished!<br />
            Completed<br />
            <br />
            <br />
            <br />
            Run#2:<br />
            Output folder: C:\Dat_Sync_Demo<br />
            Starting update process...<br />
            Downloading updates list file: updates.txt<br />
            Delete file: C:\Dat_Sync_Demo\Version.ini<br />
            Downloading new file: Version.ini<br />
            WebServer/beta/test/Version.ini<br />
            Delete file: C:\Dat_Sync_Demo\updates.txt<br />
            Updating finished!<br />
            Completed<br />
            <hr />
          </td>
        </tr>
      </table><br />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">QOAL</span><br />
        <span class="post-time small text-muted">30th September 2008 20:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Awesome, I'm glad I could help out. :up:<br />
        <br />
        Nice afterthought too. :)</p>
      </div>
      <hr />

      <div class="footer">
        <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
      </div>
    </div><script src="../js/highlight.pack.js" type="text/javascript">
</script> <script type="text/javascript">
//<![CDATA[
    hljs.initHighlightingOnLoad();
    //]]>
    </script>
  </div>
</body>
</html>
