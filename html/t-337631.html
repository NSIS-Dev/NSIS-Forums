<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="access without administration rights"><title>access without administration rights - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">access without administration rights</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=337631">access without administration rights</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">NOCaut</span><br><span class="post-time small text-muted">16th November 2011 11:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>access without administration rights</strong><br>I run installer with RequestExecutionLevel user and<br><br>Function .onInit<br>!insertmacro useUAC<br>!insertmacro MULTIUSER_INIT<br>...<br><br>then run silent installer RequestExecutionLevel user and<br><br>Function .onInit<br>!insertmacro useUAC<br>!insertmacro MULTIUSER_INIT<br>....<br><br>1) I call two !insertmacro useUAC - it is bad<br>2) not have rights for delete or change key in registry<br>Function un.onInit<br>!insertmacro useUAC<br>!insertmacro MULTIUSER_UNINIT</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NOCaut</span><br><span class="post-time small text-muted">16th November 2011 11:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If i run subinstaller without !insertmacro useUAC i cant access to registry and Program Files</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">16th November 2011 12:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Please do not use the UAC plugin for getting admin access. It is much too complex for such a simple task. And if I recall correctly, it cannot be used together with multiuser.nsh. In fact, multiuser.nsh isn't really designed for new versions of Windows. You're better off not using it if you ask me.<br><br>What you need can be done much simpler:<br>1) use "requestexecutionlevel admin"<br>2) in .onInit, use the UserInfo plugin to verify that the user really has admin access<br>3) Always install for all users. Admin-level installers should always install for all users, *especially* if the user running the installer is not an administrator himself. This is how windows is designed to be used.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NOCaut</span><br><span class="post-time small text-muted">16th November 2011 13:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">bad idea<br>1) use use "requestexecutionlevel admin"<br>then all nsis const return path like administation<br>installer write all in application data admin<br>i want say when i write in registry i write in admin account key</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">16th November 2011 14:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If you're writing to HKLM, you should also be writing to all users's appdata. As I said, that's how Windows is designed to be used. If your application requires some files to be present in the *user's* appdata, you need to code your app to copy those files from alluser appdata (if they don't exist in the user's appdata yet).<br><br>(Edit: The reason why the app should do this, and not the installer itself, is that there's no way for the installer to know which users will be running the app. You cannot extract files if the installer doesn't know where they need to go.)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NOCaut</span><br><span class="post-time small text-muted">16th November 2011 14:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I know but i want change Internet explorer key. I most write in the curent user, Or i most run application and in app change reg key ?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">16th November 2011 15:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If you want to change a registry key in HKLM, you should install as all users, using admin access.<br>If you want to change a registry key in HKU, you can install for a single user, using userlevel access.<br><br>What key do you want to change?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NOCaut</span><br><span class="post-time small text-muted">16th November 2011 16:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Main<br><br>but if i run with userlevel access. i change registry but can not create folder and register dll in the system<br><br>but if i run with admin access i can reg dll but cant change registry key</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NOCaut</span><br><span class="post-time small text-muted">16th November 2011 17:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Maybe better for change registry write small *.bat or *exe file on —Å++/Delphi</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">16th November 2011 18:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">There are several ways you can do this (enumusersreg, uac plugin, runas through system plugin...), but I still say they are all wrong. I don't know what it is you want to do in HKCU\IE\Main, but I'd make sure that there isn't some all-user setting for this before messing with userlevel settings for an alluser-type application.<br><br>If there's really no other way: You can use enumusersreg to change the HKCU of every user if you want to install for every single user separately, or you can use the UAC plugin to only install for the user who executed the installer (expert option, I don't recommend it).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NOCaut</span><br><span class="post-time small text-muted">17th November 2011 08:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for EnumUsersReg. If i have any problem i write in this post within a week.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NOCaut</span><br><span class="post-time small text-muted">17th November 2011 12:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">How i can Push my params in then EnumUsersReg function ?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NOCaut</span><br><span class="post-time small text-muted">17th November 2011 15:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I have next problem:<br>i write install with admin righth<br><br>install applixation on user without admin rights + UAC<br>1)<br>when i uninstall application uninstall not have righths for program files, unreg dll file, clear registry, and etc!!!<br><br>When I add UAC function in the uninstall section all good but uninstall runs twice.<br><br>Function un.onInit<br>;!insertmacro useUAC<br>!insertmacro MULTIUSER_UNINIT<br><br>2)<br>in user user without admin rights + UAC I can not run *.exe file i try<br>- !insertmacro UAC_AsUser_ExecShell "open" "${FF_REGISTRATION}" "" "" ""<br>- Exec "$INSTDIR\${FF_REGISTRATION}"<br>not work</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">17th November 2011 16:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Again, please do not use the UAC plugin for this.<br><br>Use "requestexecutionlevel admin", and in both .onInit AND un.onInit use the UserInfo plugin to verify that the installer really has admin access (and if it doesn't, show a MessageBox error and quit).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NOCaut</span><br><span class="post-time small text-muted">17th November 2011 16:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">HOW? in Windows7 this code not work!<br>System::Call "kernel32::GetModuleHandle(t 'shell32.dll') i .s"<br>System::Call "kernel32::GetProcAddress(i s, i 680) i .r0"<br>System::Call "::$0() i .r0"<br>${If} $0 == 0<br>MessageBox MB_OK "You must have Administrator privileges to install this application.$\nPlease log in as Administrator and start the installation again."<br>Quit<br>${EndIf}</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">17th November 2011 16:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Why are you calling IsUserAnAdmin by ordinal?<br><br>Use the UserInfo plugin!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NOCaut</span><br><span class="post-time small text-muted">18th November 2011 09:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><a href="http://nsis.sourceforge.net/Examples/UserInfo/UserInfo.nsi" target="_blank">http://nsis.sourceforge.net/Examples...o/UserInfo.nsi</a> - fuk, not work always say that i am administrator group</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">18th November 2011 09:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If it says it has admin access, then it's working, isn't it? Isn't that what you've been trying to accomplish?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NOCaut</span><br><span class="post-time small text-muted">18th November 2011 10:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">then it's working, isn't it? - No because i login as USER accoun.<br><br>let's try from start: I want in user in windows7:<br>1) write in registry &amp;<br>2) register dll file<br>3) run exe file<br><br>and all that in one installer. I try write two silent install one for write in the registry and dll registry with admin right and two with user rughts + !includemacro useUAC for run Exe file. but did not work two silent installer run not correctly</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">18th November 2011 10:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The userinfo plugin is to ensure that you have admin access to begin with. It doesn't have anything to do with running a userlevel exe from an admin installer.<br><br>To run a userlevel exe from an admin installer, you can either use the UAC plugin (see the example nsi scripts shipped with the plugin!), or use the ShellExecAsUser plugin.<br><br>Once again, I repeat that what you want to accomplish is NOT easy to do for a beginner. You should probably rethink your installer strategy, instead.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NOCaut</span><br><span class="post-time small text-muted">18th November 2011 11:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">i know it`s hard, because I wrote this for you so that you have helped me in. ok thanks for help. if you have any ideas write me in the post or send mail.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>