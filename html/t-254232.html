<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Right syntax for ReadRegStr?"><title>Right syntax for ReadRegStr? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Right syntax for ReadRegStr?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=254232">Right syntax for ReadRegStr?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">pdedecker</span><br><span class="post-time small text-muted">27th August 2006 11:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Right syntax for ReadRegStr?</strong><br>Hi,<br><br>I wasn't sure after reading the help file how I should use ReadRegStr, so my question is: is this the right syntax for ReadRegStr if I try to access <a href="http://img140.imageshack.us/img140/9172/regreadir5.jpg" target="_blank">this string</a>?</p><pre>
<code>            ReadRegStr $0 HKLM Software\USBsyncer\InstallDir ""<br>                IfErrors 0 +2<br>                        ReadRegStr $0 HKLM Software\MediaSync\InstallDir ""<br>                IfFileExists $0\MediaSync.exe 0 +6<br>                        MessageBox MB_OK "An old version of USBsyncer or MediaSync seems to be installed. Press OK to run its uninstaller."<br>                        IfFileExists $0\Uninstall.exe 0 +2<br>                                ExecWait '"$0\Uninstall.exe"'<br>                        IfFileExists $0\Setup.exe 0 +2<br>                                ExecWait '"$0\Setup.exe" /remove'<br>                IfFileExists $0\USBsyncer.exe 0 +6<br>                        MessageBox MB_OK "An old version of USBsyncer or MediaSync seems to be installed. Press OK to run its uninstaller."<br>                        IfFileExists $0\Uninstall.exe 0 +2<br>                                ExecWait '"$0\Uninstall.exe"'<br>                        IfFileExists $0\Setup.exe 0 +2<br>                                ExecWait '"$0\Setup.exe" /remove'</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">27th August 2006 16:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">No, the last parameter should be "InstallDir" and the third shouldn't contain "InstallDir".</p>
      <pre>
<code>ReadRegStr $0 HKLM Software\USBsyncer" "InstallDir"</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pdedecker</span><br>
      <span class="post-time small text-muted">28th August 2006 07:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I tried embedding this procedure into the OnInit function, but it doesn't seem to work here. However, I did install an older version of my software and I did create a string called InstallDir in HKLM\Software\USBsyncer with the value "C:\Program Files\MediaSync\". Why is it not working?</p>
      <pre>
<code>; USBsyncer-0.3.nsi<br>;<br>; This script is based on example1.nsi, but it remembers the directory, <br>; has uninstall support and (optionally) installs start menu shortcuts.<br>;<br>; It will install example2.nsi into a directory that the user selects,<br><br>;--------------------------------<br>;Include Modern UI<br><br>  !include "MUI.nsh"<br><br>;--------------------------------<br><br>; The name of the installer<br>Name "USBsyncer v0.3"<br>XPStyle on<br>ShowInstDetails show<br>ShowUninstDetails show<br><br>ReserveFile "ReadmePage.ini"<br>!insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br>!define MUI_FINISHPAGE_SHOWREADME "readme.txt"<br>!define MUI_FINISHPAGE_SHOWREADME_TEXT "Show Readme (recommended)"<br>!define MUI_FINISHPAGE_RUN "$INSTDIR\USBsyncer.exe"<br>!define MUI_FINISHPAGE_RUN_TEXT "Run USBsyncer"<br>!define MUI_FINISHPAGE_LINK "USBsyncer Homepage"<br>!define MUI_FINISHPAGE_LINK_LOCATION "http://usbsyncer.ueuo.com/"<br><br>; The file to write<br>OutFile "../Installer Builds/USBsyncer-output.exe"<br><br>; The default installation directory<br>InstallDir "$PROGRAMFILES\USBsyncer v0.3\"<br><br>; Registry key to check for directory (so if you install again, it will <br>; overwrite the old one automatically)<br>; InstallDirRegKey HKLM "Software\NSIS_Example2" "Install_Dir"<br><br>;--------------------------------<br><br>  !define MUI_HEADERIMAGE<br>  !define MUI_HEADERIMAGE_RIGHT<br>  !define MUI_WELCOMEFINISHPAGE_BITMAP "header_left.bmp"<br>  !define MUI_UNWELCOMEFINISHPAGE_BITMAP "header_left.bmp"<br>  !define MUI_HEADERIMAGE_BITMAP "header.bmp"<br>  !define MUI_ABORTWARNING<br>  !define MUI_UNABORTWARNING<br><br>  Function .onInit<br>        # the plugins dir is automatically deleted when the installer exits<br>        InitPluginsDir<br>        File /oname=$PLUGINSDIR\splash.bmp "splash.bmp"<br>        #optional<br>        #File /oname=$PLUGINSDIR\splash.wav "C:\myprog\sound.wav"<br><br>        advsplash::show 5000 600 400 -1 $PLUGINSDIR\splash<br><br>        Pop $0          ; $0 has '1' if the user closed the splash screen early,<br>                        ; '0' if everything closed normally, and '-1' if some error occurred.<br><br>        Delete $PLUGINSDIR\splash.bmp<br>        !insertmacro MUI_INSTALLOPTIONS_EXTRACT_AS "ReadmePage.ini" "ReadmePage.ini"<br>                ReadRegStr $0 HKLM Software\USBsyncer\ "InstallDir"<br>                IfErrors 0 +2<br>                        ReadRegStr $0 HKLM Software\MediaSync\ "InstallDir"<br>                IfFileExists $0\MediaSync.exe 0 +6<br>                        MessageBox MB_OK "An old version of USBsyncer or MediaSync seems to be installed. Press OK to run its uninstaller."<br>                        IfFileExists $0\Uninstall.exe 0 +2<br>                                ExecWait '"$0\Uninstall.exe"'<br>                        IfFileExists $0\Setup.exe 0 +2<br>                                ExecWait '"$0\Setup.exe" /remove'<br>                IfFileExists $0\USBsyncer.exe 0 +6<br>                        MessageBox MB_OK "An old version of USBsyncer or MediaSync seems to be installed. Press OK to run its uninstaller."<br>                        IfFileExists $0\Uninstall.exe 0 +2<br>                                ExecWait '"$0\Uninstall.exe"'<br>                        IfFileExists $0\Setup.exe 0 +2<br>                                ExecWait '"$0\Setup.exe" /remove'<br><br>  FunctionEnd<br>        <br>;--------------------------------<br><br>; Pages<br><br>!insertmacro MUI_PAGE_WELCOME<br>!insertmacro MUI_PAGE_LICENSE "license.txt"<br>Page custom ReadmePage<br>!insertmacro MUI_PAGE_DIRECTORY<br>!insertmacro MUI_PAGE_COMPONENTS<br>!insertmacro MUI_PAGE_INSTFILES<br>!insertmacro MUI_PAGE_FINISH<br>  <br>!insertmacro MUI_UNPAGE_CONFIRM<br>!insertmacro MUI_UNPAGE_COMPONENTS<br>!insertmacro MUI_UNPAGE_INSTFILES<br><br>!insertmacro MUI_LANGUAGE "English"<br><br>;--------------------------------<br><br>; Readme<br><br>  LangString TEXT_IO_TITLE ${LANG_ENGLISH} "USBsyncer Information"<br>  LangString TEXT_IO_SUBTITLE ${LANG_ENGLISH} "Please read this to learn more about the way USBsyncer works."  <br>  <br>  Function ReadmePage<br><br>  !insertmacro MUI_HEADER_TEXT "$(TEXT_IO_TITLE)" "$(TEXT_IO_SUBTITLE)"<br>  !insertmacro MUI_INSTALLOPTIONS_DISPLAY "ReadmePage.ini"<br><br>  FunctionEnd<br><br>;--------------------------------<br>  <br>; License<br><br>LicenseData license.txt<br>LicenseForceSelection checkbox<br><br>;--------------------------------<br><br>; The stuff to install<br><br>InstType "Full (recommended)"<br>InstType "Minimal"<br><br>Section "USBsyncer Core" Core<br><br>  SectionIn RO 1 2<br>  <br>  ; Set output path to the installation directory.<br>  SetOutPath $INSTDIR<br>  <br>  ; Files in the root dir<br>  File "USBsyncer.exe"<br>  File "readme.txt"<br>  File "license.txt"<br>  <br>  ; Files in the bin dir<br>  SetOutPath $INSTDIR\bin<br>  File "bin\USBwatcher.exe"<br>  <br>  ; Files in the images dir<br>  SetOutPath $INSTDIR\images<br>  File "images\appheader.gif"<br>  File "images\busy.ico"<br>  File "images\idle.ico"<br>  <br>  ; Write the installation path into the registry<br>  WriteRegStr HKLM SOFTWARE\USBsyncer "Install_Dir" "$INSTDIR"<br>  <br>  ; Write the uninstall keys for Windows<br>  WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\USBsyncer0.3" "DisplayName" "USBsyncer"<br>  WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\USBsyncer0.3" "UninstallString" '"$INSTDIR\uninstall.exe"'<br>  WriteRegDWORD HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\USBsyncer0.3" "NoModify" 1<br>  WriteRegDWORD HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\USBsyncer0.3" "NoRepair" 1<br>  WriteUninstaller "uninstall.exe"<br>  <br>SectionEnd<br><br>Section "USBsyncer Updater" Updater<br><br>  SectionIn 1<br>  <br>  ; Set output path to the installation directory.<br>  SetOutPath $INSTDIR<br>  <br>  ; Put file there<br>  File "USBupdater.exe"<br>  <br>  ; Write the installation path into the registry<br>  WriteRegStr HKLM SOFTWARE\USBsyncer "Install_Dir" "$INSTDIR"<br>  <br>  ; Write the uninstall keys for Windows<br>  WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\USBsyncer0.3" "DisplayName" "USBsyncer"<br>  WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\USBsyncer0.3" "UninstallString" '"$INSTDIR\uninstall.exe"'<br>  WriteRegDWORD HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\USBsyncer0.3" "NoModify" 1<br>  WriteRegDWORD HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\USBsyncer0.3" "NoRepair" 1<br>  WriteUninstaller "uninstall.exe"<br>  <br>SectionEnd<br><br>Section "Start with Windows" EnableOnBootup<br><br>  SectionIn 1 2<br><br>  CreateShortCut "$SMSTARTUP\USBsyncer.lnk" "$INSTDIR\USBsync.exe" "" "$INSTDIR\USBsync.exe" 0<br>  <br>SectionEnd<br><br>Section "Start Menu Shortcuts" Shortcuts<br><br>  SectionIn 1 2<br><br>  CreateDirectory "$SMPROGRAMS\USBsyncer v0.3"<br>  CreateShortCut "$SMPROGRAMS\USBsyncer v0.3\Start USBsyncer v0.3.lnk" "$INSTDIR\USBsyncer.exe" "" "$INSTDIR\USBsyncer.exe" 0<br>  CreateShortCut "$SMPROGRAMS\USBsyncer v0.3\Synchronize and quit.lnk" "$INSTDIR\USBsyncer.exe" "/syncandquit" "$INSTDIR\USBsyncer.exe" 0<br>  CreateShortCut "$SMPROGRAMS\USBsyncer v0.3\Uninstall USBsyncer v0.3.lnk" "$INSTDIR\uninstall.exe" "" "$INSTDIR\uninstall.exe" 0<br>  <br>SectionEnd<br><br>;--------------------------------<br>; Other stuff<br><br>  <br>;--------------------------------<br><br>; Uninstaller<br><br>Section "un.USBsyncer" unProgram<br><br>  SectionIn RO<br>  <br>  ; Remove registry keys<br>  DeleteRegKey HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\USBsyncer0.3"<br>  DeleteRegKey HKLM SOFTWARE\USBsyncer<br><br>  ; Remove files and uninstaller<br>  Delete $INSTDIR\USBsyncer.exe<br>  Delete $INSTDIR\USBupdater.exe<br>  Delete $INSTDIR\license.txt<br>  Delete $INSTDIR\readme.txt<br>  Delete $INSTDIR\Uninstall.exe<br>  Delete $INSTDIR\bin\*.*<br>  Delete $INSTDIR\images\*.*<br>  RMDir "$INSTDIR\bin\"<br>  RMDir "$INSTDIR\images\"<br><br>  ; Remove shortcuts, if any<br>  Delete "$SMPROGRAMS\USBsyncer v0.3\*.*"<br>  Delete "$SMSTARTUP\USBsyncer.lnk"<br><br>  ; Remove Start Menu folder<br>  RMDir "$SMPROGRAMS\USBsyncer v0.3\"<br><br>SectionEnd<br><br>Section "un.Delete settings" unPrgrmFldr<br><br>  RMDir "$INSTDIR"<br>  <br>SectionEnd<br><br>;--------------------------------<br><br>;Descriptions<br><br>  ; Installer component description strings<br>  LangString DESC_Core ${LANG_ENGLISH} "The main component of USBsyncer."<br>  LangString DESC_Updater ${LANG_ENGLISH} "A simple updater to check for new versions."<br>  LangString DESC_EnableOnBootup ${LANG_ENGLISH} "This is required for USBsyncer to work properly."<br>  LangString DESC_Shortcuts ${LANG_ENGLISH} "Creates shortcuts for USBsyncer."<br>  <br>  ; Same for uninstaller  <br>  LangString DESC_unProgram ${LANG_ENGLISH} "Uninstall USBsyncer and all its components."<br>  LangString DESC_unPrgrmFldr ${LANG_ENGLISH} "Remove the USBsyncer program directory and settings."<br>  <br>  ; Link strings to installer components<br>  !insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br>  !insertmacro MUI_DESCRIPTION_TEXT ${Core} $(DESC_Core)<br>  !insertmacro MUI_DESCRIPTION_TEXT ${Updater} $(DESC_Updater)<br>  !insertmacro MUI_DESCRIPTION_TEXT ${EnableOnBootup} $(DESC_EnableOnBootup)<br>  !insertmacro MUI_DESCRIPTION_TEXT ${Shortcuts} $(DESC_Shortcuts)<br>  !insertmacro MUI_FUNCTION_DESCRIPTION_END<br>  <br>  ; Once again, same for uninstaller<br>  !insertmacro MUI_UNFUNCTION_DESCRIPTION_BEGIN<br>  !insertmacro MUI_DESCRIPTION_TEXT ${unProgram} $(DESC_unProgram)<br>  !insertmacro MUI_DESCRIPTION_TEXT ${unPrgrmFldr} $(DESC_unPrgrmFldr)<br>  !insertmacro MUI_UNFUNCTION_DESCRIPTION_END<br><br>;--------------------------------</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">28th August 2006 11:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Your test to see if it works uses IfErrors, without clearing the errors prior to taking the test. You must use ClearErrors before the instruction you wish to test, or else IfErrors might be affected from prior failed instructions.<br>
      <br>
      Please attach large scripts in the future.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pdedecker</span><br>
      <span class="post-time small text-muted">28th August 2006 13:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">So, should I do this?</p>
      <pre>
<code>ClearErrors<br>ReadRegStr $0 HKLM Software\USBsyncer\ "InstallDir"<br>IfErrors 0 +2</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">28th August 2006 13:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>