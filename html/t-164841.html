<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Avoid recompressing .cab's?"><title>Avoid recompressing .cab's? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Avoid recompressing .cab's?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=164841">Avoid recompressing .cab's?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">TanRanger</span><br><span class="post-time small text-muted">14th January 2004 18:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Avoid recompressing .cab's?</strong><br>I'm using NSIS as a wrapper for WinINSTALL .msi files (and their corresponding data directories) to facilitate unattended software installations on Windows 2000 machines.<br><br>Unfortunately, whenever I compile a NSIS script for a program which contains many compressed .cab files, the compiler tries valiantly to recompress them. Naturally, it fails to save much disk space but adds a LOT of time to the compile process.<br><br>Does anyone know of a way to skip compression on files of certain types?<br><br>BTW, as this is my first post, I just want to add: "HOORAY FOR NSIS!" This is an awesome tool and a fantastic addition to the world of open source software. Combined with the free version of WinINSTALL and my monolithic VBScript to run the show, NSIS makes my unattended installs essentially automatic and virtually painless.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">14th January 2004 18:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Use 'SetCompress off'.<br><br>Why not use NSIS for the installer logic too? There is no need to use VBScript etc., the NSIS script langauge allows you to add any custom logic you want.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">TanRanger</span><br><span class="post-time small text-muted">14th January 2004 19:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I can't just turn compression off because I still want to compress all of the OTHER files. I just don't want to recompress those files that are already compressed cabinets. It would not be a simple task to turn compression on and off for each of the files because some programs (take any Microsoft application for example) contain scores of subdirectories full of all sorts of different file types. And that even pertains to the installation sources!<br><br>It sounds like I could do it if I had a code block for each subdirectory of my installation media tree (all eleventy-zillion of them) that would do the following:<br>- Move all ZIP, CAB, RAR, etc. files to a temp folder<br>- Add *.* (the non-archive files) to the NSIS package<br>- Move all ZIP, CAB, RAR, etc. files back to their original folder<br>- Turn off compression<br>- Add all ZIP files to the package<br>- Add all CAB files to the package<br>- Add all RAR files to the package<br>- etc...<br>- Turn compression back on again<br>Then repeat for each subdir!<br><br>*PUKE!!!*<br><br>FYI: I use a VB script because I am constantly adding packages to be installed (usually windows updates) and I don't want to have to recompile each time. This way, I can just append a couple of lines to the script that check the registry to see if the new program is installed, and then runs the new executable if it is not.<br><br>Since reboots are necessary, my VB script writes to the run key in the registry so that it launches again upon rebooting. The tail end of the script removes itself from the registry and either shuts down or reboots to allow me to inspect the machine (I've got another script to do that too... maybe I'll call it from my script and shut down or pop up a message if the inspection passes).<br><br>I'm installing dozens of commercial applications, many with settings that must be specified during install. WinINSTALL makes before and after disk images and takes the difference. The output is a set of folders (containing the files and folders that changed) and an .msi file. By applying the difference to a new machine, I perform an unattended install with the custom configuration information to boot.<br><br>WinINSTALL (the free version) does not, however, support compression. The output is just the difference-tree and the .msi file. Sending zillions of tiny, uncompressed files back and forth across the network is NOT the most efficient way of working. Hence my use of NSIS as a wrapper (and a free one).<br><br>With luck, I may even be able to get all of my NSIS installers onto the Win2K CD! Then all I'd have to do is wait untill Win2K finished installing (along with my NSIS installers) and install Office2K3 across the network (or *gasp* manually swap CD's).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">14th January 2004 20:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">'SetCompress off' does not have to apply to all files. Just set it before the CAB files and use 'SetCompress auto' afterwards.<br><br>This will only work if you are not using solid compression. ZLIB does not use solid compression by default. If you are using BZIP2 or LZMA see <a href="http://nsis.sourceforge.net/site/Special_Builds.30.0.html" target="_blank">http://nsis.sourceforge.net/site/Spe...ilds.30.0.html</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">TanRanger</span><br><span class="post-time small text-muted">14th January 2004 20:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">While I'm grateful for your help, I'm not really sure that solves my problem.<br><br>I was hoping to create a script that would work on any arbitrary group of directories. The method you suggest seems to require that I know which folders will contain compressed files. I'd much rather have the ability to add an entire tree with the File /r "C:\mypath\myfolder\*.*" command. This way, all I have to do is change the name of the root folder and it will work for any OTHER program.<br><br>I don't think this:<br><br>SetCompress off<br>File /r "C:\mypath\myfolder\*.cab"<br>File /r "C:\mypath\myfolder\*.zip"<br>File /r "C:\mypath\myfolder\*.arj"<br>SetCompress auto<br>File /r "C:\mypath\myfolder\*.*"<br><br>would work... would it?<br><br>(... well, there's one way to find out)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">TanRanger</span><br><span class="post-time small text-muted">14th January 2004 20:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">No, of course that won't work. It adds the .cab files twice!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">TanRanger</span><br><span class="post-time small text-muted">14th January 2004 20:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I guess I could just delete all of the .cab's in the install tree... but this prevents me from compiling a script where the installation files are located on a read only medium like a CD-ROM.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">14th January 2004 21:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Why not put the cab files in a different folder?</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>