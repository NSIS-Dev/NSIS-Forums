<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="store password secure in INI" />

  <title>store password secure in INI - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">store password secure in INI</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=142771">store password secure in INI</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br />
      <span class="post-time small text-muted">19th July 2003 12:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>store password secure in INI</strong><br />
      Has NSIS the possibility to encrypt passwords for storing them into INI files - then to read out the pw and decrypt it?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">19th July 2003 12:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There is no such built in possibility, but if you find a nice command line program that does it you can use it with nsExec. You can also create a plug-in.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br />
      <span class="post-time small text-muted">19th July 2003 12:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">not easy - there seems no dos program for that.<br />
      i found this one<br />
      <a href="http://www.di-mgt.com.au/cryptoMySecret.html" target="_blank">http://www.di-mgt.com.au/cryptoMySecret.html</a><br />
      <br />
      my idea is now to put the pw into his own ini and to encrypt it.<br />
      for decryption it will decrypted into a temporary ini-file which is read out and then destroyed.<br />
      <br />
      in case i find a program which can en/decrypt with output - how can i fetch this output (like the errorhandler on dos)?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">19th July 2003 13:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Use nsExec::ExecToStack to get the output and the return value.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bSecRes</span><br />
      <span class="post-time small text-muted">19th July 2003 15:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There are still a couple problems. 1st, how do you do the encryption to make it effective? User gives you a password and you read it from an inifile in the clear. Next, you take the password send it through the encryption program and out comes the encrypted hash. What method will the encryption program use? If you decide to use a one-way hash like md5 then great. But, if you will need the password in the clear again later, you have to use a two-way algorithm and a key. So either your installer has to know that key or the encryption program has to know the key. You can't rely on the security of the compiled installer to protect the key. Can you rely on the security of whatever other binary you're going to use to do the encryption?<br />
      <br />
      I just re-read your post and it seems you need to go both ways and that you'll have to store the key in the installer (the installer is not a secure place to store a key). If this is important enough that you already considered all of this, I bet this isn't the right solution. Why couldn't you use md5 sums and compare hashes from there after?<br />
      <br />
      The other problem I see with your scheme is that you assume no one can recover inifiles once the installer deletes them. I haven't tested this yet but I'm pretty sure it isn't hard to retrieve these files. Lots and lots of programs can find deleted files (even old swap and virtual memory files... always scary).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br />
      <span class="post-time small text-muted">19th July 2003 15:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">the password is not very important till now.<br />
      my old program (wich is very functional) offers input to a password which is NOT stored till now.<br />
      The newer version should do this (store pw) but i want prevent anyone to use or crack it on first sight.<br />
      The pass is used later on a RAR-archiv with 128bit AES encrytion.<br />
      password will only be asked on "saving" not on restoring.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">19th July 2003 15:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have thought of no schema what so ever. You've asked to encrypt and decrypt and I have merely told you how to do it. Deciding which method to use it up to you. I am on security expert and thus can't really help you in this matter. All I can say is that if I needed something like this I would have surely not used anything that's bidirectional unless the key is to be supplied by the user. But that's exactly the same as one-directional because you merely compare the results of the algorithm and the input of the user.<br />
      <br />
      If you do come up with a working system it would be nice if you can create an Archive page for it.<br />
      <br />
      BTW, to make sure no undelete programs recover your files you can try filling them with bogus data over and over again.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br />
      <span class="post-time small text-muted">19th July 2003 15:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">@kichik<br />
      &gt;&gt; to make sure no undelete programs recover your files<br />
      <br />
      So this was my purpose in asking for a routine.<br />
      <br />
      i put also a request on my german board if someone know where to get this<br />
      <br />
      &lt;program -e|-d password|plaintext&gt;<br />
      <br />
      Output is put onto the stack i read out with nsexec<br />
      <br />
      i am concious about deleted files and recovery programs (i am using such stuff from time to time).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bSecRes</span><br />
      <span class="post-time small text-muted">19th July 2003 15:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If the password is only for the purpose of protecting a rar file later... I wouldn't spend that much time on this. Do a ROT13 or something because rar files do crap job of protecting the password anyway. Checkout Elcomsoft. If you just want to say, AES encryption well then that's fine too. Still, if you're keeping the key in the compiled installer which it sounds llike you have to do, these things are reversible. Kichik has given fairly straightforward instructions for it on this forum in the past.<br />
      <br />
      When I'm done with my current project I'll look into writing a function for doing an md5 sum in NSIS or finding a suitable and small DLL and posting the code to use it. In a dream world of mine I'd write PGP support but...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Yathosho</span><br />
      <span class="post-time small text-muted">19th July 2003 17:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://www.7-zip.org/7z.html" target="_blank">7-zip</a> offers AES-256 encryption.<br />
      <br />
      still i wonder if the archive-method is really important. i gues one could find out the password the second your installer decompresses the encrypted password.<br />
      <br />
      was looking for a way to encrypt a password in an ini-file myself, so i will keep an eye on this thread :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bSecRes</span><br />
      <span class="post-time small text-muted">19th July 2003 17:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Storing keys safely- Methods explored</strong><br />
      If you want to encrypt stuff in a way that is reversible then you must have a key or keys. Where is the key to be stored?<br />
      <br />
      The installer compression is necessarily reversible and more or less documented. There isn't a tool for it per se (except the compiled installer itself, which works great). This method cannot be relied upon except to keep the kids out.<br />
      <br />
      The external DLL method. If you have an external DLL that is compiled in such a way as to protect the key safely, fine. This of course means the external dll also performs the encryption and the key never leaves it. This would be used as follows: Call DLL encryption function giving it the clear text. The output of the DLL function is the cipher text. Later you would call the same function to do the reverse. Still, this is a target for hackers. While it is doing its thing in memory someone can try and figure out the key. In this case, that is dangerous because assuming you use the same dll in every installer you distribute, one person cracks it and everyone has cracked it.<br />
      <br />
      The Microsoft method. Security through obscurity. In this protected DLL instead of storing a key, make a thousand (exaggeration?) registry calls get system specific information. In some crazy fashion you would take parts of all of this information and make a key out of it. It is still possible for Joe hacker to figure out the key and possibly though if done properly more difficulty the method for obtaining the key. It just makes it take longer to figure out.<br />
      <br />
      Much better security. If you can assume Internet access exists or if you have an offline channel connecting you and the user of your installer you would use asymmetric cryptography. In this method you would have a public key in the installer that encrypts whatever it is you're interested in protecting. Later, when the user needs to decrypt it, they send the cipher text to your web server or whatever and it return the clear text having decrypted it with the private key on the server. Since the private key is never even on the client's system it is as secure as the server it sits on.<br />
      <br />
      Copy protection schemes that don't rely on hardware devices or users getting challenge text encrypted by a server are always broken. Whether you're trying to do copy protection or something else, if you have the secret that is used to protect something stored in the place where the attacker has access, you are going to get your stuff reversed if the attacker has the time and skill to do it.<br />
      <br />
      Remember key size counts but.. it isn't the size of the key so much as it is how you use it. I guess that applies to a lot of things but...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br />
      <span class="post-time small text-muted">19th July 2003 19:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">@bSecRes<br />
      <br />
      My program is only for a backup from some existing data which is NOT secure (data is kept in plain text)<br />
      In any case data is better kept in a datacontainer like drivecrypt or bestcrypt so each access of a new session must be permitted.<br />
      <br />
      But that is not my purpose - i only want to give the opportunity to backup files 'cause the main program cannot do this. Backup files can be stored everywhere and restored everywhere (incl moving)<br />
      <br />
      I use rar instead ZIP because i use recovery percent for secure archiving and i almost work with winrar instead crappy winzip.<br />
      BTW RAR has i big advantage - i can cover the complete content instead getting a file list with asterixes.<br />
      <br />
      But still to mention - password is important for my backup program. but it would be nice to have the opportunity ;)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bSecRes</span><br />
      <span class="post-time small text-muted">19th July 2003 19:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I wasn't so much discussing your specific problem, as I was addressing the issue of encryption and the NSIS installer in general.<br />
      <br />
      &lt;castle metaphor&gt;<br />
      I still don't have a very clear idea about what you're trying to do but it sounds to me like you're building the castle walls at different heights. Castle walls should all be built to the same height with regard to the concern of someone going over them.<br />
      &lt;/castle metaphor&gt;<br />
      <br />
      If you are creating some code you hope to be reusable and in the future you would like it to work with more secure things than it is working on right now, great. Otherwise, without a plan for fixing the security of the stuff you're backing up, I think you're time might be better spent doing other things.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br />
      <span class="post-time small text-muted">19th July 2003 19:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">&gt;&gt; Has NSIS the possibility to encrypt passwords for storing them into INI files - then to read out the pw and decrypt it?<br />
      <br />
      the answer is NO till now so i have to work without it i did the last year<br />
      <br />
      :D</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">20th July 2003 00:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It would be nice if InstallOptions had an encription Flag.<br />
      I'm not sure how it would work...<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bSecRes</span><br />
      <span class="post-time small text-muted">20th July 2003 00:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">My point is that it can't work two-way as long as there is no protected memory. I am writing an md5 hasher now for people that want to use that somewhere in their installer. Obviously that won't work on a custom page before the value gets written to the hard disk which I think is a weakness.<br />
      <br />
      I agree that it would be cool if there was a one-way hash that NSIS could use when storing the value in the file. I would like to see that hash be md5.<br />
      <br />
      The only way to make two-way work is to go asymmetric, whereby we would have to give NSIS a public key to use to encrypt and store the password. Afterwards, though what good is it? If you put the private key on the system game over.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">20th July 2003 12:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There is already a MD5 hasher plug-in:<br />
      <a href="http://nsis.sourceforge.net/archive/download.php?file=md5plugin.zip" target="_blank">http://nsis.sourceforge.net/archive/...=md5plugin.zip</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bSecRes</span><br />
      <span class="post-time small text-muted">20th July 2003 15:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Would there be any reason to rewrite it as a .nsh file or code people can copy and paste? Would it in the end yield smaller installers? Would it in the end be really slow compared to the DLL?<br />
      <br />
      And is there anyway to use it prior to the passwords getting written to the iniFiles? (Not that I could do that either...)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">20th July 2003 15:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Writing the plug-in in a .nsh (assuming you mean a function that will use System.dll) is absolutely insane. It'll be way slower than the plug-in. Why would it yield smaller installers? If anything, the code will be much more complicated.<br />
      <br />
      You can't get InstallOptions to write it this way without changing InstallOptions. If you want to write it from the script then it's very much possible.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bSecRes</span><br />
      <span class="post-time small text-muted">20th July 2003 18:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That's what I thought. Well, when I get that C compiler on my NSIS workstation I'll get to work on the InstallOptions thing.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
