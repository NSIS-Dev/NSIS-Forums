<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Prevent installer running if non-admin user"><title>Prevent installer running if non-admin user - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Prevent installer running if non-admin user</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=291426">Prevent installer running if non-admin user</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">NEHOG</span><br><span class="post-time small text-muted">7th May 2008 20:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Prevent installer running if non-admin user</strong><br>I need to keep a non-admin user from running one of my installers (entering admin user credentials is not effective as the base programs requires the user be an admin user (not just giving credentials either!)<br><br>Is there a way to determine if the *user* is a non-admin user, so I could give an instructions message box to logon as an admin user to do the installation?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">7th May 2008 20:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Re: Prevent installer running if non-admin user</strong><br></p><blockquote><i>Originally posted by NEHOG</i><br><b>I need to keep a non-admin user from running one of my installers (entering admin user credentials is not effective as the base programs requires the user be an admin user (not just giving credentials either!)<br></b></blockquote>This makes no sense, there is no way to detect if the user elevated with admin credentials, or was admin from the start (If your app needs admin rights to run, you should check for admin rights in your app(or fix you app ;) ))<br><br>The best you can do is:<br>add RequestExecutionLevel admin to your script, that takes care of Vista. for older systems, you can use the userinfo plugin in .onInit or .onGuiInit</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">AaronLS</span><br><span class="post-time small text-muted">7th May 2008 20:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think this might be what you want if you just want to know if the current user's account type is Administrator:<br><a href="http://nsis.sourceforge.net/IsUserAdmin" target="_blank">http://nsis.sourceforge.net/IsUserAdmin</a><br><br>If you concerned with the whole Vista issue where an admin can run a program either with User security or Admin, then I don't think IsUserAdmin is what you want.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NEHOG</span><br><span class="post-time small text-muted">8th May 2008 01:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Re: Re: Prevent installer running if non-admin user</strong><br></p><blockquote><i>Originally posted by Anders</i><br><b>This makes no sense, there is no way to detect if the user elevated with admin credentials, or was admin from the start (If your app needs admin rights to run, you should check for admin rights in your app(or fix you app ;) ))<br><br>The best you can do is:<br>add RequestExecutionLevel admin to your script, that takes care of Vista. for older systems, you can use the userinfo plugin in .onInit or .onGuiInit</b></blockquote>The reason is simple. The installed program does things that only an admin user can do. However, because of the (incredible) way that MSFT did Vista, it cannot be an admin level program! (If it is admin level, then Vista will not automatically run the program on startup... UAC strikes again).<br><br>And, we run our program at the end of setup, which is why I can't allow a non-admin user to even run the setup at all. (It doesn't help that setup is a two part program, with the second half written in VB.)</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NEHOG</span><br><span class="post-time small text-muted">8th May 2008 01:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by AaronLS</i><br><b>I think this might be what you want if you just want to know if the current user's account type is Administrator:<br><a href="http://nsis.sourceforge.net/IsUserAdmin" target="_blank">http://nsis.sourceforge.net/IsUserAdmin</a><br><br>If you concerned with the whole Vista issue where an admin can run a program either with User security or Admin, then I don't think IsUserAdmin is what you want.</b></blockquote>I looked at that URL and it did look interesting. I'll drop it into my installer tomorrow and see if it will work. I'll probably take the "RequestExecutionLevel admin" out of my setup program, though I suspect that won't matter (Vista will still try to require admin there...)<br><br>Anyway, thanks for the suggestion and link. I'll report back if it was successful.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">8th May 2008 02:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">don't take out RequestExecutionLevel admin, yes Vista will elevate without it, but that is just detection that vista does and could go away at any time.<br><br>As far as startup goes, UAC is not the problem, your app is the one with the problem, just embrace the new age of non admin users and fix your app</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NEHOG</span><br><span class="post-time small text-muted">9th May 2008 00:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Anders</i><br><b>don't take out RequestExecutionLevel admin, yes Vista will elevate without it, but that is just detection that vista does and could go away at any time.<br><br>As far as startup goes, UAC is not the problem, your app is the one with the problem, just embrace the new age of non admin users and fix your app</b></blockquote>Any program in the automatic startup locations (excluding RunOnce, which leaves a malware hole big enough to drive a Hummer through!) that is marked requireAdministrator will not run automatically on startup. This is not an application problem, but a Vista problem. The application cannot run for a non-administrator user, it is a system utility.<br><br>Life would be easier if I were writing a word processor or a calendar program, but unfortunately I'm not.<br><br>So, no my app is not the one with the problem, it is Vista and MSFT with the problem in that their attempt to fix a (perceived) problem simply broke more things than it fixed. An administrator *should* be able to have requireAdministrator marked programs in their startup, but MSFT missed the fine point.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">9th May 2008 00:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by NEHOG</i><br><b>An administrator *should* be able to have requireAdministrator marked programs in their startup, but MSFT missed the fine point.</b></blockquote>No, you missed the fine point, when UAC is on, a member of the administrator group is not actually admin, they are a standard user until they elevate with UAC. The shell (explorer) is not running with a admin token, so there is no way to start a elevated process...<br>Having 5 UAC dialogs on startup would not be fun would it?<br><br>There is a special admin account not affected by UAC, you could require your users to only use that account<br><br>---<br><br><br>RunOnce only runs for administrators IIRC, its never executed for normal users.<br><br>I assume you don't actually change system settings at startup, so you could just run as normal user until you need more access when the user changes a setting, then use a COM elevation object or something like that. Or you could go the other way and not care about security at all and install a service and let it do your dirty work like some dualboot app did when they claimed they bypassed UAC</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">AaronLS</span><br><span class="post-time small text-muted">9th May 2008 01:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I personally feel Vista should only require elevated privileges to add something to run on startup as administrator, and from then on it allows it to automatically run at startup as administrator, because an administrator did allow that entry to be added.<br><br>This similar to how Linux works. There is a directory that you place scripts in that run at startup, which requires that you provide root credentials. Once it is in there however, it can run as root.<br><br>Regardless, I would just drop the discussion of which software is the "problem" and focus on a workaround such as one of those suggested by Anders. The fact is you can't fix Vista and recompile a new version for your users. You just have to accept it as it is. So that leaves it to the developer to shape the application to be jammed into Vista as best you can.<br><br>I hate Vista, but I try not to let it frustrate me because I know I have to support it, and the best I can do is learn as much about it as I can so that I'm empowered to overcome it's problems.<br><br>Try not to get to frustrated by Vista.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NEHOG</span><br><span class="post-time small text-muted">9th May 2008 18:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by AaronLS</i><br><b>I personally feel Vista should only require elevated privileges to add something to run on startup as administrator, and from then on it allows it to automatically run at startup as administrator, because an administrator did allow that entry to be added.<br><br>This similar to how Linux works. There is a directory that you place scripts in that run at startup, which requires that you provide root credentials. Once it is in there however, it can run as root.<br><br>Regardless, I would just drop the discussion of which software is the "problem" and focus on a workaround such as one of those suggested by Anders. The fact is you can't fix Vista and recompile a new version for your users. You just have to accept it as it is. So that leaves it to the developer to shape the application to be jammed into Vista as best you can.<br><br>I hate Vista, but I try not to let it frustrate me because I know I have to support it, and the best I can do is learn as much about it as I can so that I'm empowered to overcome it's problems.<br><br>Try not to get to frustrated by Vista.</b></blockquote>Oh, I'm already frustrated by Vista! ;)<br><br>It is a very complex problem for us, our development budget and time don't allow for major rewrites (such as would be needed to split the application into separate service and UI components, and marketing is very specific in what they need (and I'm paid to deliver what they want...)<br><br>We're still testing, and working, and I'm sure I'll find solutions to our problems, but Vista is eating us up with its (IMHO poorly designed) security techniques.<br><br>What scares me is that MSFT will release a new version of Windows and base it on Vista!</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">vignesh447</span><br><span class="post-time small text-muted">12th May 2008 08:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">you can use the code below to check that:<br><br><br>;Does user have Admin privileges?<br>Push $R0<br>Call IsUserAdmin<br>Pop $R0<br>${If} $R0 == "false"<br>MessageBox MB_OK|MB_ICONEXCLAMATION "This installer must be run with Administrative Privileges"<br>Abort<br>${EndIf}<br><br><br>include the header file attached it works :)</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>