<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Starting/configuring MySQL woes, help!" />

  <title>Starting/configuring MySQL woes, help! - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Starting/configuring MySQL woes, help!</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=246785">Starting/configuring MySQL woes, help!</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pisymbol</span><br />
      <span class="post-time small text-muted">23rd May 2006 00:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Starting/configuring MySQL woes, help!</strong><br />
      I have looked at many many posts regarding installation of MySQL as well as looking at the sample code up on Sourceforge.<br />
      <br />
      My problem is not that I can't do install it, its that I'm getting different results depending on target machine (variables such as FireWall/security software I believe are not a factor).<br />
      <br />
      Here is my script to start and configure MySQL:<br />
      <br /></p>

      <blockquote>
        # Start MySQL<br />
        DetailPrint "Starting MySQL Configuration..."<br />
        ExecCmd::exec /NOUNLOAD /ASYNC `"$INSTDIR\mysql-5.0.20a-win32\bin\mysqld-nt.exe"`<br />
        Pop $0 ; return value<br />
        DetailPrint "Starting MySQL Daemon returned $0"<br />
        ${If} $0 != "error"<br />
        # Load it<br />
        DetailPrint "Loading schema..."<br />
        ExpandEnvStrings $0 "%COMSPEC%"<br />
        NsExec::exec `"$0" /C $INSTDIR\mysql-5.0.20a-win32\bin\mysql.exe -u root &lt; $INSTDIR\mysql-5.0.20a-win32\my_ddl.sql`<br />
        Pop $0 ; return value<br />
        DetailPrint "Schema loading returned $0"<br />
        StrCmp $0 "0" 0 DatabaseSchemaFail<br />
        DetailPrint "Schema load successful!"<br />
        ${Else}<br />
        DatabaseSchemaFail:<br />
        MessageBox MB_OK "Install failed to load database schema. Please see documentation on how to load schema file manually!"<br />
        ${EndIf}
      </blockquote>Can someone tell me if they see something glaringly wrong? I've noticed that I can not use Exec or NsExec to start mysqld since it just hangs waiting which seems wrong based on the doc (I would assume it should fork a child process and continue).<br />
      <br />
      When it fails, it seems that the schema load fails, i.e. mysql starts but then the schema instantly fails. Occasionally on some boxes when this occurs the mysqld process dies as well. On my machine it works everytime, on other machines it fails miserably.<br />
      <br />
      Does anyone know what's going on or have seen this type of behavior before?<br />
      <br />
      Thanks!
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pisymbol</span><br />
      <span class="post-time small text-muted">23rd May 2006 03:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Btw, if anyone is doing this and has a *known* way please post!!! :-)!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RobGrant</span><br />
      <span class="post-time small text-muted">23rd May 2006 08:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Exec shouldn't hang around waiting (block), but nsExec should. I wonder if it's the nsExec call that's the problem: is it failing depending on what version of Windows you run it on? It could be that different versions handle command-line stuff slightly differently.<br />
      <br />
      Oh actually you can only install it on NT boxes can't you, otherwise the mysql version is wrong.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pisymbol</span><br />
      <span class="post-time small text-muted">23rd May 2006 15:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Rob, yes this is only NT.<br />
      <br />
      Exec most certainly hangs around when executing mysqld or mysqld-nt.exe with 5.0.20a. I think there is a real bug either in my syntax or within NSIS.<br />
      <br />
      It seems in the majority of cases, mysqld starts fine, but the schema loads fails. It doesn't make sense to me.<br />
      <br />
      Has anyone installed and loaded schema MySQL successfully on more than one machine before?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">23rd May 2006 17:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The way you're using LogicLib is wrong.<br />
      ${If} $0 != "error"<br />
      # Load it means install it, right?<br />
      ............<br />
      StrCmp $0 "0" 0 DatabaseSchemaFail<br />
      DetailPrint "Schema load successful!"<br />
      ${Else}<br />
      DatabaseSchemaFail:<br />
      MessageBox MB_OK "Install failed to load database schema. Please see documentation on how to load schema file manually!"<br />
      ${EndIf}</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pisymbol</span><br />
      <span class="post-time small text-muted">23rd May 2006 17:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Red Wine</i><br />
        <b>The way you're using LogicLib is wrong.<br />
        ${If} $0 != "error"<br />
        # Load it means install it, right?<br />
        ............<br />
        StrCmp $0 "0" 0 DatabaseSchemaFail<br />
        DetailPrint "Schema load successful!"<br />
        ${Else}<br />
        DatabaseSchemaFail:<br />
        MessageBox MB_OK "Install failed to load database schema. Please see documentation on how to load schema file manually!"<br />
        ${EndIf}</b>
      </blockquote>Yes, but I don't see how I'm using it wrong?<br />
      <br />
      If the return code does NOT equal an error, load the schema, else we can't load the schema and move on.<br />
      <br />
      I should mention that logically it a flows fine...I do get to the load schema print but the loading of the schema line fails sometimes. Its really really weird.<br />
      <br />
      Can anyone tell me why Exec doesn't work for mysqld?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pisymbol</span><br />
      <span class="post-time small text-muted">24th May 2006 23:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">For any other MySQL install stuckees...the fix is to add a --console to the mysqld-nt.exe line. For some reason, on some machines you need the --console and others you don't. With --console, it now works everytime.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
