<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="accessing registry under Vista"><title>accessing registry under Vista - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">accessing registry under Vista</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=282680">accessing registry under Vista</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Rafik</span><br><span class="post-time small text-muted">5th December 2007 13:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>accessing registry under Vista</strong><br>Howdy<br><br>I'm writing an updater to download data files in background while my game is running. Updater is working as admin using:<br><br>RequestExecutionLevel admin<br><br>Updater first runs game exe with:<br><br>Exec '"$INSTDIR\${GAME_EXEC_DIR}\${GAME_EXEC}" "${GAME_RUN_PARAM}"'<br><br>then starts downloads and during download it writes to HKLM registry information about finished files, something like that:<br><br>!define REGKEY_VER_PROGRESS "Software\${COMPANY}\${PRODUCT_NAME}\.Progress"<br><br>WriteRegStr HKLM "${REGKEY_VER_PROGRESS}" $fileGameID "1"<br><br>To my surprise, my game can't see or read registry strings created by Updater. I can see them in regedit, but my game can not? Worse if for test purpose my game writes/creates string with existing but invisible name, in regedit i can see that there are two values with the same name? What is going on? I'm sure that has something to do with Vista, but how to combat this?<br>That's what I want in short:<br>run updater as an admin to may change files in "Program Files" and at the same time create string visible from my game running with user privileges.<br>What should I do?<br><br>Greets<br>RafaÅ‚</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">5th December 2007 18:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Do both the installer and the game have a Vista manifest? It sounds like you get redirected to another hive, though I can't remember any compatibility tweak that'd do this for HKLM. Make sure both the game and the installer run with the same "vista tweak mode" by giving them both manifests.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">skullcruncha</span><br><span class="post-time small text-muted">5th December 2007 18:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You might find more suprises with Vista and the registry and also files in certain folders like "Program Files". Vista has introduced symbolic links on both the file system and registry. If a particular user updates an installed program only that user can see the updates.<br><br>It may be that if your user is not an admin and the updater runs as an admin, the game (running under the user account) won't be able to see the registry (and maybe file) edits that were made by an admin.<br><br>Try running the game as admin, then running your update process and see if the game can see the registry edits then. If so you know it's vista's new symbolic link/account permission feature that is preventing the user account from seeing the admin edits.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Rafik</span><br><span class="post-time small text-muted">5th December 2007 22:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for answers.<br>I'm using old Visual C++ 6.0 and as far as I know it's not supplied with any manifest tools. Someone maybe knows where can I get one?<br>I'm quite confused (and tired) with unpredictable(at least for me) Vista behaviours. But unfortunately need my app working under Vista too.<br>I was wondering about using some *.ini to keep informations about updates. That's because my game has free read access to files in "Program Files" even these written by Updater. I will investigate this idea further but looks like one worth a try.<br><br>Thanks again, I must say that I like convenience and simplicity of NSIS very much, too bad that it's still not quite "Vista ready". Actually I think that fault is rather on Microsoft's side and plain stupid idea of common registry file - a thing visibly not prepared for real multiuser system.<br><br>Greets RafaÅ‚</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>