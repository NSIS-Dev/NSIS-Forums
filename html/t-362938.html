<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="NSIS Registry Key Overwriting Default Open In Context Menu" />

  <title>NSIS Registry Key Overwriting Default Open In Context Menu - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">NSIS Registry Key Overwriting Default Open In Context Menu</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=362938">NSIS Registry Key Overwriting Default Open In Context Menu</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pspjhp</span><br />
      <span class="post-time small text-muted">4th June 2013 14:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>NSIS Registry Key Overwriting Default Open In Context Menu</strong><br />
      Hey everyone,<br />
      <br />
      I know this is probably an easy fix , but I'm having some trouble with it. I create a couple keys so that when someone right clicks on a directory OR file my program shows up in the options. When you click the program option then the program is launched. Easy.<br />
      <br />
      The problem is that these keys that I'm creating are making it so when I double click on a direcotyr or file that it launches my program. It is the default option for dealing with directorys/files instead of 'Open'. I would like it just to be like the 2nd or 3rd option or something after Open or Open in New Window.<br />
      Here is an example of my line of code:<br />
      WriteRegStr HKCR "Directory\shell\Context Menu Line\command" "" '"C:\\TestProgram.exe" "%1"'<br />
      <br />
      Any help would be greatly appreciated.<br />
      <br />
      Thanks!<br />
      Justin</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">4th June 2013 15:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The default value in the shell key will specify the default action. Its value should be set to "none".<br />
      <br />
      WriteRegStr HKCR "Directory\shell" "" "none"<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">5th June 2013 00:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        The default value in the shell key will specify the default action. Its value should be set to "none".<br />
        <br />
        WriteRegStr HKCR "Directory\shell" "" "none"
      </blockquote>Setting the default shell value to none is not a good idea AFAIK, do you know any MSDN docs that say otherwise?<br />
      <br />
      If all you are doing is adding HKCR\Directory\shell\mything\command it should not get invoked as the default action. The context menu for a file system folder comes from 3 places (5 on XP+) HKCR\Folder, HKCR\Directory and HKCR\AllFilesystemObjects and you should never touch the default shell value because it can mess up the way explorer opens folders!
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pspjhp</span><br />
      <span class="post-time small text-muted">7th June 2013 12:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yeah I agree however, for some reason the default action becomes my program when I try to open anything up. Until I uninstall and then it goes back to the normal thing. I'm using Windows 7 if that changes anything. I could include a small screen shot or something of my context menu and/or registry if that helps.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pspjhp</span><br />
      <span class="post-time small text-muted">7th June 2013 13:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What it seems to be doing is putting the key at the top in the shell "folder"<br />
      so under the shell "folder" it displays:<br />
      My Program<br />
      removeproperties<br />
      <br />
      don't know why it's installing it at the top.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">7th June 2013 21:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Maybe you could post the contents of a regedit exported .reg of HKCR\Directory?<br />
      <br />
      You could also try adding a dword called NeverDefault under ..\shell\mything</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">7th June 2013 23:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Anders</small><br />
        Setting the default shell value to none is not a good idea AFAIK, do you know any MSDN docs that say otherwise?
      </blockquote>"none" is the default value on Windows 7 and 8 (not checked below). Using an empty value rather than "none" changes the default action for folders to one of the commands listed in the registry key. This may be specific to the Directory shell commands list though.<br />
      <br />
      Stu
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">8th June 2013 03:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        "none" is the default value on Windows 7 and 8 (not checked below). Using an empty value rather than "none" changes the default action for folders to one of the commands listed in the registry key.
      </blockquote>OK but since you should not touch the default anyway it is going to be whatever is correct for that version of Windows.<br />
      <br />

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        This may be specific to the Directory shell commands list though.
      </blockquote>This would be my guess as well...
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pspjhp</span><br />
      <span class="post-time small text-muted">18th June 2013 18:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>HKCR\Directory contents</strong><br />
      So it looks like the software installs on other computers fine. I must have messed up my registry somehow, but not sure how... I'll also try out the DWORD thing...just worrisome of the possibility that it could occur on another person's machine. Here is the contents of my export. The 'Run Test Program' is the program that I'm running.<br />
      <br />
      Windows Registry Editor Version 5.00<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory]<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\Background]<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\Background\shell]<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\Background\shell\cmd]<br />
      @="@shell32.dll,-8506"<br />
      "Extended"=""<br />
      "NoWorkingDirectory"=""<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\Background\shell\cmd\command]<br />
      @="cmd.exe /s /k pushd \"%V\""<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\Background\shellex]<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\Background\shellex\ContextMenuHandlers]<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\Background\shellex\ContextMenuHandlers\DropboxExt]<br />
      @="{FB314ED9-A251-47B7-93E1-CDD82E34AF8B}"<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\Background\shellex\ContextMenuHandlers\Gadgets]<br />
      @="{6B9228DA-9C15-419e-856C-19E768A13BDC}"<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\Background\shellex\ContextMenuHandlers\igfxcui]<br />
      @="{3AB1675A-CCFF-11D2-8B20-00A0C93CB1F4}"<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\Background\shellex\ContextMenuHandlers\New]<br />
      @="{D969A300-E7FF-11d0-A93B-00A0C90F2719}"<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\Background\shellex\ContextMenuHandlers\Sharing]<br />
      @="{f81e9010-6ea4-11ce-a7ff-00aa003ca9f6}"<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\DefaultIcon]<br />
      @=hex(2):25,00,53,00,79,00,73,00,74,00,65,00,6d,00,52,00,6f,00,6f,00,74,00,25,\<br />
      00,5c,00,53,00,79,00,73,00,74,00,65,00,6d,00,33,00,32,00,5c,00,73,00,68,00,\<br />
      65,00,6c,00,6c,00,33,00,32,00,2e,00,64,00,6c,00,6c,00,2c,00,33,00,00,00<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shell]<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shell\cmd]<br />
      @="@shell32.dll,-8506"<br />
      "Extended"=""<br />
      "NoWorkingDirectory"=""<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shell\cmd\command]<br />
      @="cmd.exe /s /k pushd \"%V\""<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shell\find]<br />
      "LegacyDisable"=""<br />
      "SuppressionPolicy"=dword:00000080<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shell\find\command]<br />
      @=hex(2):25,00,53,00,79,00,73,00,74,00,65,00,6d,00,52,00,6f,00,6f,00,74,00,25,\<br />
      00,5c,00,45,00,78,00,70,00,6c,00,6f,00,72,00,65,00,72,00,2e,00,65,00,78,00,\<br />
      65,00,00,00<br />
      "DelegateExecute"="{a015411a-f97d-4ef3-8425-8a38d022aebc}"<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shell\Run Test Program]<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shell\Run Test Program\command]<br />
      @="\"C:\\\\Program Files (x86)\\\\Justin HP\\\\My Test Folder\\\\Test Program.exe\" \"%1\""<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex]<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\ContextMenuHandlers]<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\ContextMenuHandlers\7-Zip]<br />
      @="{23170F69-40C1-278A-1000-000100020000}"<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\ContextMenuHandlers\AgentRansack]<br />
      @="{2AE9D6D8-E348-4853-B266-C78844D31B97}"<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\ContextMenuHandlers\DropboxExt]<br />
      @="{FB314ED9-A251-47B7-93E1-CDD82E34AF8B}"<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\ContextMenuHandlers\EncryptionMenu]<br />
      @="{A470F8CF-A1E8-4f65-8335-227475AA5C46}"<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\ContextMenuHandlers\Offline Files]<br />
      @="{474C98EE-CF3D-41f5-80E3-4AAB0AB04301}"<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\ContextMenuHandlers\SavShellExt]<br />
      @="{A3A1D8A1-006D-4B93-BA27-6F6B4C9C4F1D}"<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\ContextMenuHandlers\Sharing]<br />
      @="{f81e9010-6ea4-11ce-a7ff-00aa003ca9f6}"<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\ContextMenuHandlers\{596AB062-B4D2-4215-9F74-E9109B0A8153}]<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\CopyHookHandlers]<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\CopyHookHandlers\FileSystem]<br />
      @="{217FC9C0-3AEA-1069-A2DB-08002B30309D}"<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\CopyHookHandlers\Sharing]<br />
      @="{40dd6e20-7c17-11ce-a804-00aa003ca9f6}"<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\DragDropHandlers]<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\DragDropHandlers\7-Zip]<br />
      @="{23170F69-40C1-278A-1000-000100020000}"<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\PropertySheetHandlers]<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\PropertySheetHandlers\Offline Files]<br />
      @="{7EFA68C6-086B-43e1-A2D2-55A113531240}"<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\PropertySheetHandlers\Sharing]<br />
      @="{f81e9010-6ea4-11ce-a7ff-00aa003ca9f6}"<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\PropertySheetHandlers\{1f2e5c40-9550-11ce-99d2-00aa006e086c}]<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\PropertySheetHandlers\{4a7ded0a-ad25-11d0-98a8-0800361b1103}]<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\PropertySheetHandlers\{596AB062-B4D2-4215-9F74-E9109B0A8153}]<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\PropertySheetHandlers\{ECCDF543-45CC-11CE-B9BF-0080C87CDBA6}]<br />
      <br />
      [HKEY_CLASSES_ROOT\Directory\shellex\PropertySheetHandlers\{ef43ecfe-2ab9-4632-bf21-58909dd177f0}]<br />
      @=""<br />
      <br />
      <br />
      thanks,<br />
      Justin</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pspjhp</span><br />
      <span class="post-time small text-muted">20th June 2013 15:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Anders</small><br />
        Maybe you could post the contents of a regedit exported .reg of HKCR\Directory?<br />
        <br />
        You could also try adding a dword called NeverDefault under ..\shell\mything
      </blockquote>That totally worked! Adding the dword called NeverDefault! Thanks for that. I was just thinking, is there anyway to move it up the context menu so it's right under open or whatever the first default is? Just curious. This is more like micro-optimization, just have some programs that I installed in the context menu and it put my program underneath them all.<br />
      <br />
      thanks again!<br />
      Justin
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
