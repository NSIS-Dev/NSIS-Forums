<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="CPU Detection Code" />

  <title>CPU Detection Code - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">CPU Detection Code</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=292531">CPU Detection Code</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br />
      <span class="post-time small text-muted">31st May 2008 13:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>CPU Detection Code</strong><br />
      I recently wrote the following CPU detection code:<br />
      <br /></p>
      <pre>
<code>; ---------------------------------------<br />; Installer Attributes<br />; ---------------------------------------<br /><br />Caption "CPU Info"<br />OutFile "cpuinfo.exe"<br /><br />!include StrFunc.nsh<br />${StrTok}<br />${StrLoc}<br />${StrCase}<br /><br /><br />; ---------------------------------------<br />; CPU Detection Code<br />; ---------------------------------------<br /><br />Var CPU_TYPE<br />  <br />!macro CheckCPUExt list ext label_found<br />  ${StrLoc} $0 "${list}" " ${ext} " "&gt;"<br />  StrCmp $0 "" 0 ${label_found}<br />!macroend<br /><br />Function DetectCPUType<br />  Banner::show /NOUNLOAD "Detetcing your CPU Type, please be patient..."<br /><br />  StrCpy $CPU_TYPE 5 #RTM<br /><br />  File /oname=$PLUGINSDIR\cpuinfo.exe "installer\cpuinfo.exe"<br />  nsExec::ExecToStack '"$PLUGINSDIR\cpuinfo.exe"'<br />  <br />  Pop $0<br />  Pop $1<br /><br />  Delete "$PLUGINSDIR\cpuinfo.exe"<br />  StrCmp $0 "error" CPU_DETECTION_DONE<br /><br />  ${StrTok} $1 "$1" "$\n$\r$\t:" "9" "1"<br />  ${StrCase} $1 "$1" "U"<br />  <br />  ; ------------------------------<br /><br />  StrCpy $0 "0"<br />  StrCpy $2 " "<br />  <br />  CPU_LOOP:<br />  ${StrTok} $3 $1 " " "$0" "1"<br />  IntOp $0 $0 + 1<br />  StrCmp $3 "" CPU_LOOP_END<br />  StrCmp $3 "MMX" CPU_LOOP_FOUND<br />  StrCmp $3 "3DNOW" CPU_LOOP_FOUND<br />  StrCmp $3 "3DNOW2" CPU_LOOP_FOUND<br />  StrCmp $3 "SSE" CPU_LOOP_FOUND<br />  StrCmp $3 "SSE2" CPU_LOOP_FOUND<br />  StrCmp $3 "SSE3" CPU_LOOP_FOUND<br />  StrCmp $3 "SSSE3" CPU_LOOP_FOUND<br />  Goto CPU_LOOP<br />  <br />  CPU_LOOP_FOUND:<br />  StrCpy $2 "$2$3 "<br />  Goto CPU_LOOP<br />  <br />  CPU_LOOP_END:<br />  <br />  ; ------------------------------<br /><br />  !insertmacro CheckCPUExt "$2" "MMX" HAS_MMX<br />  Goto CPU_DETECTION_DONE<br />  <br />  HAS_MMX:<br />  !insertmacro CheckCPUExt "$2" "SSE" HAS_SSE<br />  !insertmacro CheckCPUExt "$2" "3DNOW" HAS_3DNOW<br />  Goto CPU_DETECTION_DONE<br />    <br />  HAS_3DNOW:<br />  StrCpy $CPU_TYPE 2 #Athlon<br />  Goto CPU_DETECTION_DONE<br /><br />  HAS_SSE:<br />  StrCpy $CPU_TYPE 3 #P3<br />  !insertmacro CheckCPUExt "$2" "SSE2" HAS_SSE2<br />  !insertmacro CheckCPUExt "$2" "3DNOW" HAS_3DNOW<br />  Goto CPU_DETECTION_DONE<br /><br />  HAS_SSE2:<br />  StrCpy $CPU_TYPE 4 #P4<br />  Goto CPU_DETECTION_DONE<br /><br />  CPU_DETECTION_DONE:<br />  Push $2<br /><br />  Banner::destroy<br />FunctionEnd<br /><br /><br />; ---------------------------------------<br />; Install Sections<br />; ---------------------------------------<br /><br />Section ""<br />  Call DetectCPUType<br />  Pop $1<br /><br />  ;---------------------------<br />  <br />  StrCpy $0 "Unknown / Detection Faild"<br />  <br />  StrCmp $CPU_TYPE "2" 0 +2<br />  StrCpy $0 "AMD Athlon (MMX, 3DNow!)"<br />  <br />  StrCmp $CPU_TYPE "3" 0 +2<br />  StrCpy $0 "Intel Pentium III (MMX, SSE)"<br /><br />  StrCmp $CPU_TYPE "4" 0 +2<br />  StrCpy $0 "Intel Pentium 4 (MMX, SSE, SSE2)"<br /><br />  StrCmp $CPU_TYPE "5" 0 +2<br />  StrCpy $0 "Runtime CPU Detection (Generic)"<br />  <br />  ;---------------------------<br />  <br />  MessageBox MB_ICONINFORMATION "Your CPU Type is: $0$\t$\nYour CPU Capabilities are: $1"<br />SectionEnd</code>
</pre><br />
      <br />
      Note that you'll need "cpuinfo.exe" from here:<br />
      <a href="http://oss.netfarm.it/mplayer-win32.php" target="_blank">http://oss.netfarm.it/mplayer-win32.php</a>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">7th June 2008 10:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You should <a href="http://nsis.sourceforge.net/Starting_a_new_page" target="_blank">Wiki</a> it.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
