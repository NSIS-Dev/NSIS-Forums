<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Adding lines after a specific string in an ini"><title>Adding lines after a specific string in an ini - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Adding lines after a specific string in an ini</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=156247">Adding lines after a specific string in an ini</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Trestkon</span><br><span class="post-time small text-muted">15th November 2003 00:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Adding lines after a specific string in an ini</strong><br>I realize that other people have asked similar questions, but I'm finding I'm having a very hard time wrapping my head around this one. I can figure out everything else I need to do for my installer, but this one has left me in the dark.<br><br>Also, I know that the standard reply is:<br><br></p><blockquote>Use FileOpen, FileWrite, FileRead and FileClose. See the Archive for examples.</blockquote>But I'm having some troubles with that:(<br><br>I should also note that the files I'm working on is not a REAL .ini, the game (DeusEx) just has it named that way, but .ini commands such as WriteINIStr still work:)<br><br>So about halfway down in the files there is the following:<br><br>[Core.System]<br>PurgeCacheDays=30<br>SavePath=..\Save<br>CachePath=..\Cache<br>CacheExt=.uxx<br>Paths=..\TNM\Music\*.u<br>Paths=..\TNM\Maps\*.dx<br>Paths=..\TNM\Textures\*.utx<br>Paths=..\TNM\Sounds\*.uax<br>Paths=..\TNM\Music\*.umx<br><br>And I want to modify it so that I have this:<br><br>[Core.System]<br>PurgeCacheDays=30<br>SavePath=..\Save<br>CachePath=..\Cache<br>CacheExt=.uxx<b><br>Paths=..\Music\*.u<br>Paths=..\Maps\*.dx<br>Paths=..\Textures\*.utx<br>Paths=..\Sounds\*.uax<br>Paths=..\Music\*.umx</b><br><br>Any help would be greatly appreciated:)</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">15th November 2003 09:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">There are many string manipulation functions on the NSIS Archive:<br><a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=311&amp;instances=0,11" target="_blank">http://nsis.sourceforge.net/archive/...instances=0,11</a><br><br>You will need to create a new function basing it upon them.<br>I'd write you one myself, but I cannot currently.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">15th November 2003 15:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can use the one that replaces strings in the file and replace "Paths=..\TNM\" with "Paths=..\".</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Trestkon</span><br><span class="post-time small text-muted">15th November 2003 16:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hmm, looking at my post, I can see I was a little more tired than I thought. I actually have to ADD allof the TNM lines, so it would look like so:<br><br>[Core.System]<br>PurgeCacheDays=30<br>SavePath=..\Save<br>CachePath=..\Cache<br>CacheExt=.uxx<br>Paths=..\TNM\Music\*.u<br>Paths=..\TNM\Maps\*.dx<br>Paths=..\TNM\Textures\*.utx<br>Paths=..\TNM\Sounds\*.uax<br>Paths=..\TNM\Music\*.umx<br>Paths=..\Music\*.u<br>Paths=..\Maps\*.dx<br>Paths=..\Textures\*.utx<br>Paths=..\Sounds\*.uax<br>Paths=..\Music\*.umx<br><br><br>I tried the string replacing bit, but it overwrites the old ones with my new ones (which it's obviously supposed to do:p) So I'll check out that link right now.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">15th November 2003 17:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">INI files should not have duplicate names, add numbers or something else.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Trestkon</span><br><span class="post-time small text-muted">15th November 2003 17:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ya, as I said, it's a core game file, so really, the programmers just decided to give it a .ini extention. In actual fact, it's just a text file they renamed to make it seem more important.<br><br>I looked into <a href="http://nsis.sourceforge.net/archive...&amp;instances=0,11" target="_blank">http://nsis.sourceforge.net/archive...&amp;instances=0,11</a> which does search for strings in a file, but it also loops all the way through. What I want to do it run a search loop until it find a certain line, and then insert a new line (so I dont' overwrite the lines following it) and write in my new paths.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">15th November 2003 18:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think the easier method is to read every line of the file, search for the line and then write everything back, including the new line.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Trestkon</span><br><span class="post-time small text-muted">15th November 2003 18:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Joost Verburg</i><br><b>I think the easier method is to read every line of the file, search for the line and then write everything back, including the new line.</b></blockquote>Eeep, this is starting to sound quite complicated:eek:</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">15th November 2003 18:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It's not that difficult. Use the NSIS file commands to read the lines and then write everything back to the file. When writing back, write 2 lines when you found a certain line.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Trestkon</span><br><span class="post-time small text-muted">15th November 2003 18:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Joost Verburg</i><br><b>It's not that difficult. Use the NSIS file commands to read the lines and then write everything back to the file. When writing back, write 2 lines when you found a certain line.</b></blockquote>I'll...try. My NSIS skills are somewhat on the noobish side, but we'll see.<br><br>Bah, I have no clue:(</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Trestkon</span><br><span class="post-time small text-muted">16th November 2003 17:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, I've been poking around the archives, and I found a script to replace a line of text in the file. My thinking is that I can modify it to search out the line <i>before</i> the place where I want to add in my extra stuff, and then have it replace that line with itself, and my extra lines, like this:<br><br>CacheExt=.uxx <b>&lt;--Searches for this line</b><br>Paths=..\System\*.u<br>Paths=..\Textures\*.utx<br>Paths=..\Sounds\*.uax<br>Paths=..\Music\*.umx<br><br><br>And I have it replace that line with:<br><b><br>CacheExt=.uxx<br>Paths=..\TNM\System\*.u<br>Paths=..\TNM\Maps\*.dx<br>Paths=..\TNM\Textures\*.utx<br>Paths=..\TNM\Music\*.umx<br>Paths=..\TNM\Sounds\*.umx</b><br>Paths=..\System\*.u<br>Paths=..\Textures\*.utx<br>Paths=..\Sounds\*.uax<br>Paths=..\Music\*.umx<br><br>I tried modifying the script that I found to do what I want. I really don't need it to loop, as there is only one occurance of "CacheExt=.uxx" in the file, but to be honest, I couldn't figure out which part of the loop I needed to keep. I would greatly appreciate it if some kind soul could have a look at my code and point out my errors.<br><br>Cheers!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">16th November 2003 19:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That script has a few errors:<br><br>1. If you want to stretch an instruction line on more than one line you should put a backslash at the end of the line. Not closing the quotes is not enough.<br><br>2. You are both writing and reading to the same file. When writing to a file it doesn't push the next lines to the bottom, it just overrides them. You should read from one file and write to another. Once that is done, you copy the new file over.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Trestkon</span><br><span class="post-time small text-muted">16th November 2003 20:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, thanks to kichik, I'm getting closer:) I found a script in the archives that basically does what I want, but it's leaving me with a blank file, instead of adding the lines to TNM.ini</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">16th November 2003 20:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Almost there, you just mixed up some variables along the way. $6 with $2 to be exact.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Trestkon</span><br><span class="post-time small text-muted">16th November 2003 22:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Works like a dream!! Thanks so much guys, I appreciate it:D</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>