<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="GetWindowsVersion does not detect win2k!!" />

  <title>GetWindowsVersion does not detect win2k!! - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">GetWindowsVersion does not detect win2k!!</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=195756">GetWindowsVersion does not detect win2k!!</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">caykahve2003</span><br />
      <span class="post-time small text-muted">6th October 2004 13:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>GetWindowsVersion does not detect win2k!!</strong><br />
      Hello,<br />
      <br />
      I use GetWindowsVersion function (found in NSIS User Manual) to detect the OS.<br />
      <br />
      What I want to do is to detect the OS and continue according to that. The setup detects win NT 4, and Win XP, but it does not detect win 2000. I tested on two different machines with win 2000. In the function, it goes to the lbl_error label. R1 and R0 are empty only with win 2000.<br />
      <br />
      I attached necessary parts of the code to this message and added ';*****' to the end of the lines I would like to draw your attention. I also put the messages that pop up in comments.<br />
      <br />
      As Win xp and win 2000 go to the same label in the just after the function call, and XP works, I do not think that there is a problem with the rest of the code that I wrote.<br />
      <br />
      Thank you.<br />
      <br />
      Regards,<br />
      caykahve</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RobGrant</span><br />
      <span class="post-time small text-muted">6th October 2004 16:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">First thing to say I think is that posting threads with titles accusing the developers of not making a good enough method is not a 100% foolproof way of getting the best response from said developers.<br />
      <br />
      Having said that I'm sure they'll be nice.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">caykahve2003</span><br />
      <span class="post-time small text-muted">6th October 2004 17:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Posting a message here does not mean that you are accusing people. You ask for help in the forums because you are doing something wrong but you cannot realize where the error is.<br />
      <br />
      I thought that I had done everything right, but I have seen that it is not so. I cannot understand why it has happened. That is the reason I am writing here. Saying something doesn't work is not accusing people. There are a million reasons why something doesn't work. I have to express the situation as clear as possible.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">6th October 2004 20:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I tried it on a Windows 2000 server and it seemed fine. It popped both of the messages that you had marked in the script as not popping. It popped the winnt message and then the 2000 message. The value of $R1 was also 5.0. Is your test machine running Windows 2000 server? I don't think I have any non server 2000 machines here to try it on here.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">caykahve2003</span><br />
      <span class="post-time small text-muted">7th October 2004 10:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you for trying. my machine is Windows 2000, not server. $R1 is '' with mine.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">caykahve2003</span><br />
      <span class="post-time small text-muted">7th October 2004 11:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I put more messages inside the GetWindowsVersion function, and saw that on win2000, it reads the "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" key's CurrentVersion value perfectly as '5.0' but, afterwards does not jump to lbl_winnt from the line<br />
      "IfErrors 0 lbl_winnt"<br />
      and continues by trying to read the "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion" key's VersionNumber value. Afterwards what it reads is null. Therefore, the rest of the code fails.<br />
      <br />
      In the user's manual it says for ReadRegStr: "If the value is present, but is of type REG_DWORD, it will be read and converted to a string and the error flag will be set.<br />
      " The value is of type REG_SZ. I could not understand why the error flag is still set.<br />
      <br />
      BTW, I made a trial again on XP: it works correctly and jumps after reading the registry value on "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" .<br />
      <br />
      I will be happy if someone can help me...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kolos</span><br />
      <span class="post-time small text-muted">7th October 2004 12:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi,<br />
      <br />
      Try to use<br />
      strcmp $R0 "" 0 lbl_winnt<br />
      instead of<br />
      IfErrors 0 lbl_winnt</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">caykahve2003</span><br />
      <span class="post-time small text-muted">7th October 2004 13:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">that works! :)<br />
      thank you kolos!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">7th October 2004 15:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The error flag has probably been set somewhere else, I think there should a ClearErrors call before reading the key.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">caykahve2003</span><br />
      <span class="post-time small text-muted">8th October 2004 07:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ClearErrors before ReadRegStr also solved the problem. Tested on 2000, XP, and NT 4.<br />
      Thank you Joost Verburg.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
