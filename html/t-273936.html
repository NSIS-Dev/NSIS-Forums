<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="All Users Write Access" />

  <title>All Users Write Access - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">All Users Write Access</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=273936">All Users Write Access</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aspestrand</span><br />
      <span class="post-time small text-muted">6th July 2007 02:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>All Users Write Access</strong><br />
      I hope I'm not repeating a post here but I couldn't find what I was looking for here on the forum.<br />
      <br />
      In my installer I'm creating a directory under "All Users" by doing the following:<br />
      <br />
      SetShellVarContext all<br />
      CreateDirectory $APPDATA\Foo<br />
      <br />
      This works fine in XP but under Vista I do not have write permissions to the folder or any sub folders or files. When my application creates a file in $APPDATA\Foo it actually ends up being a virtualized file.<br />
      <br />
      Is it true that if I change the permissions of the folder with the AccessControl plugin to allow writing that all sub-folders and files created after will then not be virtualized and actually be writable in the real $APPDATA\Foo and not the virtualized path C:\Users\THEUSERNAME\AppData\Local\VirtualStore\ProgramData\Foo\...?<br />
      <br />
      Thanks for your time</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th July 2007 09:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You should never do that. If you allow every user to write to the same folder you allow each user to affect other users. If you want an administrator to be able to change global settings, you should create a separate elevated application or dialog to do that.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aspestrand</span><br />
      <span class="post-time small text-muted">6th July 2007 17:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">We actually just have a database stored there that needs to be accessed by all of our users. That's why it's in the All Users folder. That, as I understand it, is what the All Users folder is for is it not?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aspestrand</span><br />
      <span class="post-time small text-muted">6th July 2007 17:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">So will the AccessControl plugin do what I explained earlier?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th July 2007 18:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The AccessControl plug-in can change the permissions of that folder, but you shouldn't give users a write permission to a common folder. Every change one user makes will affect all other users. That change doesn't have to be with your program. A user can completely delete that database or even corrupt it in a way that your program will crash.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aspestrand</span><br />
      <span class="post-time small text-muted">6th July 2007 18:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That's OK. This is just a temporary situation where the DB is shared between users. In the meantime, this is the route we've decided.<br />
      <br />
      So, what about virtualization? Will the AccessControl plugin solve that issue as well?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th July 2007 18:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">No, that probably happens due to Vista compatibility trick. Adding a manifest should make it go away. If the problem is with the installer, use RequestExecutionLevel. If it's the application itself, you'll have to do it manually. You can copy the installer's manifest and modify it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aspestrand</span><br />
      <span class="post-time small text-muted">6th July 2007 18:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry. Both Vista and NSIS are fairly new to me. Are we talking about the Windows Manifest file? As in foo.exe.manifest? Or is there an NSIS manifest file? If it's the former, I'm not quite sure what you mean.<br />
      <br />
      Thanks for the help.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th July 2007 19:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">We're talking about the Windows manifest file which can also be embedded in the executable as a resource. That's what NSIS does - it embeds the manifest as a resource when you use RequestExecutionLevel. You can copy that manifest using a resource editor.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aspestrand</span><br />
      <span class="post-time small text-muted">6th July 2007 19:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ah I see. So what your saying is I could modify the manifest to give our application Admin level privileges? If that's the case, wouldn't the UAC prompt come up asking permission to run the application?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th July 2007 19:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">No, that's not what I'm saying.<br />
      <br />
      The manifest has one more "feature" up its sleeve. It tells Vista the application knows what Vista is and so handles all sorts of cases like this one. Vista therefore turns off all sorts of compatibility tricks it has for older applications.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aspestrand</span><br />
      <span class="post-time small text-muted">6th July 2007 19:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I understand now. Sorry for the confusion. Do you have a snippet I can add to my manifest to produce these effects? Or perhaps a link I could check out?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th July 2007 19:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The manifest that the installer uses has all you need. The following goes under &lt;assembly&gt;</p>

      <blockquote>
        &lt;trustInfo xmlns="urn:schemas-microsoft-com:asm.v3"&gt;<br />
        &lt;security&gt;<br />
        &lt;requestedPrivileges&gt;<br />
        &lt;requestedExecutionLevel level="asInvoker" uiAccess="false"/&gt;<br />
        &lt;/requestedPrivileges&gt;<br />
        &lt;/security&gt;<br />
        &lt;/trustInfo&gt;
      </blockquote>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aspestrand</span><br />
      <span class="post-time small text-muted">6th July 2007 20:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you very much. I'll give this a try and see if it solves our problem.<br />
      <br />
      Your help is very much appreciated and thank you for your quick replies.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
