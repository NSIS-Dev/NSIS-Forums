<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="SetShellVarContext on-the-fly ?" />

  <title>SetShellVarContext on-the-fly ? - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">SetShellVarContext on-the-fly ?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=308808">SetShellVarContext on-the-fly ?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">nsnb</span><br />
      <span class="post-time small text-muted">23rd July 2009 19:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>SetShellVarContext on-the-fly ?</strong><br />
      Can I start a section with</p>

      <blockquote>
        SetShellVarContext current
      </blockquote>Then change it later on (in same section) to

      <blockquote>
        SetShellVarContext all
      </blockquote>Then change it again to

      <blockquote>
        SetShellVarContext current
      </blockquote>?<br />
      <br />
      The goal is to place some shortcuts on the Start Menu of the Administrator only, then place some items on the Start Menu of All Users, then restore ShellVarContext back to current.<br />
      <br />
      I just tried that and it didn't work for me. So either there is an inherent limitation of which I didn't know or I am doing something wrong.<br />
      <br />
      If the latter, any idea what could possibly go wrong in simple code like this?<br />
      <pre>
<code>SetShellVarContextall
<br />CreateShortCut</code><span style="color: #DD0000">"${D_STARTMENU}\\MyApp.lnk""myapp.exe"
<br /></span><span style="color: #0000BB">SetShellVarContextcurrent
<br /></span>

<!-- php buffer end -->
                
                
                
</pre>
      <hr />
      <pre>
        

                
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br />
      <span class="post-time small text-muted">23rd July 2009 20:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Did you define D_STARTMENU somewhere?<br />
      That define will not change based on SetShellVarContext.<br />
      Use $SMPROGRAMS instead (See chapter 4.2.3 in the NSIS manual)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">nsnb</span><br />
      <span class="post-time small text-muted">24th July 2009 15:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by jpderuiter</i><br />
        <b>Did you define D_STARTMENU somewhere?</b>
      </blockquote>Yes I did. Thank you for the tip. I changed the above to:<br />
      PHP Code:
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #0000BB">SetShellVarContextall<br />
      CreateShortCut</span><span style="color: #DD0000">"$SMPROGRAMS\${D_COMPANY}\${D_PRODUCT}\\MyApp.lnk""$PROGRAMFILES\${D_COMPANY}\${D_PRODUCT}\\myapp.exe"<br /></span> <span style="color: #0000BB">SetShellVarContextcurrent<br /></span></span> <!-- php buffer end -->
      <hr />
      But this still doesn't work.<br />
      <br />
      Interestingly enough, I have no such problem with SetOutPath.<br />
      <br />
      Did changing SetShellVarContext on the fly ever worked for anyone?<br />
      <br />
      Thanks.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">nsnb</span><br />
      <span class="post-time small text-muted">24th July 2009 16:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Update: If I change:<br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #0000BB">CreateShortCut</span><span style="color: #DD0000">"$SMPROGRAMS\${D_COMPANY}\${D_PRODUCT}\\MyApp.lnk""$PROGRAMFILES\${D_COMPANY}\${D_PRODUCT}\\myapp.exe"</span> To:</span>
      <pre>
<code>CreateShortCut</code><span style="color: #DD0000">"$SMPROGRAMS\\MyApp.lnk""$PROGRAMFILES\${D_COMPANY}\${D_PRODUCT}\\myapp.exe"
</span>
</pre>It works.<br />
      <br />
      Strange. I <i>know</i> that ${D_COMPANY} and ${D_PRODUCT} are defined and valid. Why is it behaving like this?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">nsnb</span><br />
      <span class="post-time small text-muted">24th July 2009 16:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Problem solved. :)<br />
      <br />
      What was missing is the CreateDirectory statement before the CreateShortCut:<br /></p>
      <pre>
<code>CreateDirectory</code><span style="color: #DD0000">"$SMPROGRAMS\${D_COMPANY}\${D_PRODUCT}"
</span>
</pre>jpderuiter, thank you again for the clue that led to the solution.
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
