<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Easy one for you Pros" />

  <title>Easy one for you Pros - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Easy one for you Pros</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=236414">Easy one for you Pros</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dive2xs</span><br />
      <span class="post-time small text-muted">26th January 2006 08:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Easy one for you Pros</strong><br />
      Ok I have been searching but it is getting late, and I have not been able to adapt the examples and get them to work.<br />
      <br />
      Here is what i need.<br />
      <br />
      I have 2 programs that do the same thing. The Ethernet version has 1 exe file we will call "A". The serial version needs 2 exe files we will cal "B" &amp; "C". However "B" and "C" are both requires fr the second version they can be installed on two seperate computers.<br />
      <br />
      I need to allow the following 4 options.<br />
      <br />
      Install "A" only<br />
      <br />
      Install "B" only<br />
      <br />
      Install "C" only<br />
      <br />
      or<br />
      <br />
      Install "B" and "C" only</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">26th January 2006 15:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">see Sections.nsh :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dive2xs</span><br />
      <span class="post-time small text-muted">27th January 2006 01:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK this is what I have and where I am stumped.<br />
      <br /></p>
      <pre>
<code><br />;Installer Sections<br /><br />   Section /o "Ethernet Connection" Sec1<br />   SectionEnd<br /><br /> SectionGroup "Serial Connection" Sec2<br /><br />   Section /o "Server" Sec3<br />   SectionEnd<br /><br />   Section /o "Client" Sec4<br />   SectionEnd<br /><br /> SectionGroupEnd<br /><br />;--------------------------------<br />;Functions<br /><br />Function .onSelChange<br /><br />    !insertmacro StartRadioButtons $1<br />       !insertmacro RadioButton ${Sec1}<br />       !insertmacro RadioButton ${Sec2}<br />       !insertmacro RadioButton ${Sec3}<br />       !insertmacro RadioButton ${Sec4}<br />    !insertmacro EndRadioButtons<br /><br />FunctionEnd<br /></code>
</pre><br />
      <br />
      So the problem is if the user selects the serial connection and then changes to select the Ethernet version, one of the serial components stay selected.<br />
      <br />
      So the only allowable options should be<br />
      <br />
      Sec1 or Sec2(Sec3+Sec4) or Sec3 or Sec4.<br />
      <br />
      The second problem I noticed is if you de-select one of the Serial subgroups and try to reselect it, it basically flip flops. The only way to reselect it is to select the ethernet version and then select the serial version again.<br />
      <br />
      Any and all help is greatly appreciated.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">27th January 2006 14:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You shouldn't put Sec2 in the radio buttons list because it's a section group.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dive2xs</span><br />
      <span class="post-time small text-muted">27th January 2006 17:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK, but that does not make any change in the behavior of the buttons.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">28th January 2006 10:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">RadioButtons will not work here. You'll need some custom code to do it. I'll make some for you later today when I get back from January shopping :)<br />
      <br />
      Sorry I haven't replied to your Private Messages either. It was my 18th birthday on Friday and I tend to stay away from the computer on and around my birthdays ;)<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dive2xs</span><br />
      <span class="post-time small text-muted">28th January 2006 21:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hey no problem. I appreciate the help, Happy 18th! Do you get to enjoy spirits at that age in England?<br />
      <br />
      If so, Congrats and I would be jealous if I was 18 again!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">29th January 2006 10:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yep you can legally drink at 18 here in the UK!<br />
      Try this compilable script:<br /></p>
      <pre>
<code><br />!include MUI.nsh<br />!include Sections.nsh<br />OutFile dive2xs.exe<br /><br />!insertmacro MUI_PAGE_COMPONENTS<br />!insertmacro MUI_PAGE_INSTFILES<br /><br />!insertmacro MUI_LANGUAGE English<br /><br />Var T<br /><br />;Installer Sections<br /><br />   Section /o "Ethernet Connection" Sec1<br />   SectionEnd<br /><br /> SectionGroup "Serial Connection" SecGrp1<br /><br />   Section /o "Server" Sec2<br />   SectionEnd<br /><br />   Section /o "Client" Sec3<br />   SectionEnd<br /><br /> SectionGroupEnd<br /><br />Function .onInit<br /> StrCpy $T 0<br />FunctionEnd<br /><br />Function .onSelChange<br />Push $R0<br /><br /> SectionGetFlags ${Sec1} $R0<br /> IntOp $R0 $R0 &amp; ${SF_SELECTED}<br /> StrCmp $R0 ${SF_SELECTED} 0 NoUnselectSec1<br /> StrCmp $T ${Sec1} NoUnselectSec1<br />  StrCpy $T ${Sec1}<br />  !insertmacro UnselectSection ${SecGrp1}<br /> Goto End<br /> NoUnselectSec1:<br /><br /> SectionGetFlags ${Sec2} $R0<br /> IntOp $R0 $R0 &amp; ${SF_SELECTED}<br /> StrCmp $R0 ${SF_SELECTED} 0 NoUnselectSec2<br /> StrCmp $T ${Sec2} NoUnselectSec3<br />  StrCpy $T ${Sec2}<br /> Goto UnselectSec1<br /> NoUnselectSec2:<br /><br /> SectionGetFlags ${Sec3} $R0<br /> IntOp $R0 $R0 &amp; ${SF_SELECTED}<br /> StrCmp $R0 ${SF_SELECTED} 0 NoUnselectSec3<br /> StrCmp $T ${Sec3} NoUnselectSec3<br />  StrCpy $T ${Sec3}<br /> UnselectSec1:<br />  !insertmacro UnselectSection ${Sec1}<br /> NoUnselectSec3:<br /><br /> End:<br /><br />Pop $R0<br />FunctionEnd<br /></code>
</pre><br />
      <br />
      -Stu
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dive2xs</span><br />
      <span class="post-time small text-muted">29th January 2006 18:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Man, You rock! Where can I make a donation?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dive2xs</span><br />
      <span class="post-time small text-muted">30th January 2006 03:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Can I bother you for another need. I would be happy to compensate you...<br />
      <br />
      I need the ability if the choose the Sec2 I need to record an option in the registry.<br />
      <br />
      WriteRegStr HKLM SOFTWARE\program "ComPort" "comx"<br />
      <br />
      However I need them to specify which com port they are using. and then modify the "comx" to linke "com5"</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">30th January 2006 08:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Uhm, that won't be necessary but if you're offering I don't mind :) Paypal: bikube at tiscali.co.uk<br />
      <br />
      For getting user input you can use my PassDialog plugin which has a basic dialog with a single input box. Something like this:<br />
      <br /></p>
      <pre>
<code><br />LangString ${LANG_ENGLISH} BAD_PORT_NUM "Please enter a valid port number!"<br /><br />Page Custom GetPort GetPortLeave<br /><br />Function GetPort<br /> PassDialog::Dialog inputbox /HEADINGTEXT "Enter port number..." /GROUPTEXT "Serial number"<br /> Pop $R0 # success, back, cancel, error<br />FunctionEnd<br /><br />Function GetPortLeave<br /> Pop $R0 # User input string.<br /><br /> # User entered nothing!<br /> StrCmp $R0 "" 0 +3<br />  MessageBox MB_OK|MB_ICONSTOP $(BAD_PORT_NUM)<br />  Abort<br /><br /> # Check that string is number only.<br /> Push "0123456789"<br /> Push $R0<br />  Call StrCSpn<br /> Pop $R1<br /> StrCmp $R1 "" +3<br />  MessageBox MB_OK|MB_ICONSTOP $(BAD_PORT_NUM)<br />  Abort<br /><br /> # Write port number to registry.<br /> WriteRegStr HKLM "SOFTWARE\program" "ComPort" "com$R1"<br /><br />FunctionEnd</code>
</pre><br />
      <br />
      You need the <a href="http://nsis.sourceforge.net/StrCSpn%2C_StrCSpnReverse:_Scan_strings_for_characters#StrCSpnReverse" target="_blank">StrCSpnReverse</a> function for this code too.You can download my PassDialog plugin from: <a href="http://nsis.sf.net/File:PassDialog.zip" target="_blank">http://nsis.sf.net/File:PassDialog.zip</a><br />
      <br />
      -Stu
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dive2xs</span><br />
      <span class="post-time small text-muted">30th January 2006 19:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">SO how do I make it so this only works when the server (Sec2) is selected.<br />
      <br />
      Otherwise it looks good.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dive2xs</span><br />
      <span class="post-time small text-muted">30th January 2006 19:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Also got this warning:<br />
      LangString "BAD_PORT_NUM" is not set in language table of language English</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">30th January 2006 21:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Oops sorry, LangString parameters order was incorrect. Should be:<br />
      LangString BAD_PORT_NUM ${LANG_ENGLISH} "Please enter a valid port number!"<br />
      <br />
      To only show the dialog if Sec2 is selected, simply jump over the plugin call:<br /></p>
      <pre>
<code>Function GetPort<br /> SectionGetFlags ${Sec2} $R0<br /> IntOp $R0 $R0 &amp; ${SF_SELECTED}<br /> StrCmp $R0 ${SF_SELECTED} 0 SkipPage <br />  PassDialog::Dialog inputbox /HEADINGTEXT "Enter port number..." /GROUPTEXT "Serial number"<br />  Pop $R0 # success, back, cancel, error<br /> SkipPage:<br />FunctionEnd</code>
</pre><br />
      <br />
      -Stu
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dive2xs</span><br />
      <span class="post-time small text-muted">30th January 2006 22:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
