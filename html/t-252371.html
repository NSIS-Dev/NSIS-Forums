<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Trouble getting file version" />

  <title>Trouble getting file version - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Trouble getting file version</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=252371">Trouble getting file version</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">billsh</span><br />
      <span class="post-time small text-muted">1st August 2006 00:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Trouble getting file version</strong><br />
      I'm trying to get a file version and after calling GetFileVersion, the return value is always empty. I know the file exists (I've tried this on a number of files) and that there is version data in the file. I've tried using my Var and R0 to capture the result, both return an empty string.<br />
      <br />
      It sounds like maybe I'm not getting the library setup properly (i.e. like having to call StrStr before it will work), but I can't seem to find any hints. Here is a code snippet. The syntax looks pretty straighforward, so I'm not sure what I'm doing wrong. This is just test code now so I'm aborting after some debugging message boxes. I'm on version 2.16.<br />
      <br />
      Any clues?<br />
      <br />
      !include "FileFunc.nsh"<br />
      !include "WordFunc.nsh"<br />
      !include "TextFunc.nsh"<br />
      !include "StrFunc.nsh"<br />
      ${StrStr} ;Activate the StrStr Function<br />
      !insertmacro GetFileVersion<br />
      !insertmacro VersionCompare<br />
      !insertmacro LineFind<br />
      !insertmacro WordReplace<br />
      <br />
      ...<br />
      ...<br />
      <br />
      Function .onInit<br />
      Var /GLOBAL INSTALLED_VERSION<br />
      <br />
      IfFileExists "$PROGRAMFILES\foo\foo.exe" 0 NoErrorMsg<br />
      <br />
      ; See what version it is<br />
      ${GetFileVersion} '$PROGRAMFILES\foo\foo.exe' $INSTALLED_VERSION<br />
      MessageBox MB_OK "$(INSTALLED_VERSION)"<br />
      MessageBox MB_OK "${VERSION}"<br />
      Abort<br />
      <br />
      <br />
      ; Check version status<br />
      ${VersionCompare} $INSTALLED_VERSION ${VERSION} $INSTALLED_VERSION<br />
      <br />
      IntCmp 1 $R0 downgrade upgrade CurrentVer<br />
      <br />
      CurrentVer:<br />
      MessageBox MB_OK "current"<br />
      Abort<br />
      <br />
      downgrade:<br />
      MessageBox MB_OK "older"<br />
      Abort<br />
      <br />
      upgrade:<br />
      MessageBox MB_OK "Upgrade"<br />
      Abort<br />
      <br />
      NoErrorMsg:<br />
      <br />
      <br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Swapan Das</span><br />
      <span class="post-time small text-muted">1st August 2006 06:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi!<br />
      <br />
      You can use the following method for getting File Version:<br />
      <br />
      ;declare variables before the section<br />
      Var Out2<br />
      Var Out3<br />
      Var BundledExe1 ; foo.exe (this will contain your/developer's latest version of foo.exe)<br />
      <br />
      Now add the following coding inside your section:<br />
      ;supply your latest exe's(foo.exe) version no.<br />
      StrCpy $BundledExe1 "5.168.0.33"<br />
      ;To fetch ver.info of user's exsisting foo.exe<br />
      ${GetFileVersion} '$INSTDIR\foo.exe' $OUT2<br />
      ;OUT2 variable will contain the file version of foo.exe<br />
      ;you can use the messagebox to check it.<br />
      <br />
      ;now go for version compare of your and user's copy of foo.exe:<br />
      ${VersionCompare} $BundledExe1 $OUT2 $OUT3<br />
      ; $OUT3=0 Versions are equal<br />
      ; $OUT3=1 Version1 is newer<br />
      ; $OUT3=2 Version2 is newer<br />
      ${If} $OUT3 = 1<br />
      ;take action as per your requirement<br />
      ${ElseIf} $OUT3 = 2<br />
      ;take action as per your requirement<br />
      ${ElseIf} $OUT3 = 0<br />
      ;take action as per your requirement<br />
      ${EndIf}<br />
      <br />
      <br />
      I'm using this coding for real-life project and its working fine.<br />
      <br />
      With regards,<br />
      Swapan Das</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">1st August 2006 11:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You don't use parenthesis on variables.<br />
      E.g.<br />
      Bad: $(INSTALLED_VERSION)<br />
      Good: $INSTALLED_VERSION<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
