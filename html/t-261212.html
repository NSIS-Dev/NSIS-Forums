<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="At un-install remove renamed left over shortcuts best method?"><title>At un-install remove renamed left over shortcuts best method? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">At un-install remove renamed left over shortcuts best method?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=261212">At un-install remove renamed left over shortcuts best method?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">onad</span><br><span class="post-time small text-muted">6th December 2006 16:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>At un-install remove renamed left over shortcuts best method?</strong><br>SUBJECT:<br>At un-install remove renamed left over shortcuts best method?<br><br>ISSUE:<br>If an NSIS installer installs an application, it is easy at un-install to remove a known by name shortcut. However is the shortcut is renamed by a users the .lnk name changed and the un-install of the shortcut will not be performed.<br><br>WISH:<br>Like to have for a un-install improvement:<br><br>Look for shortcut and recursively delete shortcuts from a known application name e.g. "MYAPP.EXE"<br>- All users Startmenu<br>- All users Desktop<br>- Current user Startmenu<br>- Current users Desktop<br><br>* NSIS function that performs and looks like the following:<br><br>$0 = set Target to look for e.g. "MYAPP.EXE"<br>$1 = $SM value via NSIS or $DESKTOP values via NSIS<br>$2 = Current user or all users<br><br>...<br><br>Function un.removeleftovershortcuts $0 $1 $2<br><br>;PSEUDOCODE:<br>;; Look for shortcut and recursively delete shortcuts<br>; compare lastpart .lnk target with \+$0 with first stripping part after $0<br>; if same then this is a shortcut to delete<br><br>; If found delete Shortcut via dialogbox ask Delete? Y/N<br>; If silent install always delete/ nverdelete via a set boolean<br>; Refresh desktop if needed<br><br>; REAL CODE HERE PLZ :up:<br><br>FunctionEnd<br><br>...<br><br>I searched the Wiki but found no solution, maybe combine and adjust a lot of codesnippets from:<br><a href="http://nsis.sourceforge.net/Category:Disk%2C_Path_%26_File_Functions" target="_blank">http://nsis.sourceforge.net/Category...File_Functions</a><br><br>But which are the best to start with? :confused:<br><br>QUESTION:<br>Anyone already once created such a script, be so kind as to share.<br><br>Somehow I have the feeling the "Locate" NSIS Script<br><a href="http://nsis.sourceforge.net/Locate" target="_blank">http://nsis.sourceforge.net/Locate</a><br>could solve my problem but somehow cannot figure it out... maybe I should add sleep to the code ? ;)<br><br>TIA</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">onad</span><br><span class="post-time small text-muted">7th December 2006 12:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">To difficult? &gt;:-)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">7th December 2006 18:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi onad,<br>Just some thought, have no idea if could be done.<br>A method with system plugin that retrieves the target property from shortcuts in combination with locate plugin. E.g. Get shortcuts from desktop one by one with locate, pass each one to system plugin to retrieve the target, compare the retrieved target with a defined string, and remove every shortcut that has target myApp.exe.<br>Another thought, some kind of modification on MoreInfo plugin to be able ro retrieve the target property, again in combination with locate plugin.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">7th December 2006 19:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The <a href="http://nsis.sourceforge.net/ShellLink_plug-in" target="_blank">ShellLink</a> plug-in allows you to retrieve the properties of shortcuts. You could scan through all shortcuts and compare their target to your target.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">7th December 2006 19:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks to kichik (always :-)) here is something:<br></p><pre>
<code>OutFile "locate_shellink.exe"<br>ShowInstDetails show<br><br>!include "FileFunc.nsh"<br>!insertmacro Locate<br><br>!define MyApp "$PROGRAMFILES\Mozilla Firefox\firefox.exe"<br><br>Section<br>       SetShellVarContext all<br>        StrCpy $R0 ''<br><br>        ${Locate} "$DESKTOP" "/L=F /M=*.lnk /S=0B" "LocateCallback"<br><br>        IfErrors 0 +2<br>        MessageBox MB_OK "Error" IDOK +2<br>        MessageBox MB_OK "$$R0={$R0}"<br>SectionEnd<br><br><br>Function LocateCallback<br>        ShellLink::GetShortCutTarget "$R9"<br>        Pop $0<br><br>        StrCmp '$0' '${MyApp}' 0 end<br>        StrCpy "$R0" "$R9"<br>        StrCpy "$0" StopLocate<br><br>        end:<br>        Push "$0"<br>FunctionEnd</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br>
      <span class="post-time small text-muted">8th December 2006 00:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just tried another instance, uses RecFind.nsh and I think it is more accurate.<br>
      Besides it removes repeated wrong name shortcuts in a snap.<br></p>
      <pre>
<code># Execute compiled installer then manual create some copies of the generated<br># shortcut on desktop, then execute uninstaller and watch the action.<br>OutFile "RecFind_shellink.exe"<br>InstallDir '$EXEDIR'<br>ShowInstDetails show<br>ShowUninstDetails show<br><br>!include 'RecFind.nsh'<br><br>  !define ICON_SEARCH '$DESKTOP\$R0\$R1'<br>  !define MyApp '$1\nsis.exe'<br>  !define Uninst 'unshortcut.exe'<br><br>Section Install<br>;  SetShellVarContext all<br>  ReadRegStr "$1" HKLM "Software\NSIS" ""<br>   createshortcut '$DESKTOP\nsis.lnk' '${MyApp}'<br>    ShellLink::SetShortCutWorkingDirectory '$DESKTOP\nsis.lnk' '$1'<br>    Pop $0<br>   messagebox mb_ok 'errorlevel $0'<br>   writeuninstaller '$INSTDIR\${Uninst}'<br>sectionend<br><br>Section Uninstall<br>;  SetShellVarContext all<br>  ReadRegStr "$1" HKLM "Software\NSIS" ""<br>  Delete '$DESKTOP\nsis.lnk'<br>   ${RecFindOpen} '$DESKTOP' '$R0' '$R1'<br>     ${RecFindFirst}<br>       ; DetailPrint '${ICON_SEARCH}'<br>         ShellLink::GetShortCutTarget '${ICON_SEARCH}'<br>         Pop $0<br>         StrCmp '$0' '${MyApp}' 0 end<br>         messagebox mb_ok '${ICON_SEARCH}'<br>         Delete '${ICON_SEARCH}'<br>             end:<br>     ${RecFindNext}<br>   ${RecFindClose}<br>  Delete '$INSTDIR\${Uninst}'<br>SectionEnd</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br>
      <span class="post-time small text-muted">8th December 2006 09:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Great! Thanks Red Wine and Kichik,<br>
      <br>
      I will try the solutions and see if they fit in my full goal.<br>
      <br>
      Note that I still did not took an extra nap ;) since I was a really busy creating a plugin to solve the problem. I think I still will finish that plugin and post it to a Wikipage anyhow.<br>
      <br>
      I also discovered that I did something wrong resolving the shortcuttarget and storing the value :((, so that is why shelllink and locate combination did not work at all during my tryouts...</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br>
      <span class="post-time small text-muted">8th December 2006 14:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Tried it, and the second solution really works good and fast almost without enlarging the intaller size, thanks!<br>
      <br>
      No need for yet another plugin ;)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br>
      <span class="post-time small text-muted">9th December 2006 11:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, I got a step deeper.<br>
      Following example removes normal/renamed shortcut(s) from desktop and also removes normal/renamed shortcus from Start Menu along with the created Start Menu folder even if the folder is renamed and/or moved-copied elsewhere inside Start Menu!</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br>
      <span class="post-time small text-muted">11th December 2006 11:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">A little bit enhanced in order to manage shortcuts that have been copied/renamed from current user to all users and vice versa :-)</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>