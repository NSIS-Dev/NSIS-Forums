<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="AnimGif HWNDPARENT switch blocks License Page"><title>AnimGif HWNDPARENT switch blocks License Page - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">AnimGif HWNDPARENT switch blocks License Page</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=317533">AnimGif HWNDPARENT switch blocks License Page</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Alfaromeo</span><br><span class="post-time small text-muted">5th March 2010 19:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>AnimGif HWNDPARENT switch blocks License Page</strong><br>The sample script below displays an animated gif in the page dialogs respectively using animgif plugin .I'm using UMUI. The welcome page displays the gif properly whilst in the license agreement page ,it just flickers.I wanted to show the same animation on the left hand side of this license page . The problem happens since I'm using the /HWND switch to the animgif plugin in the showLicense function and passing the $HWNDPARENT . This causes the following behavior , clicking on Next in the license page doesn't take anywhere and on the second click only it moves to the next page . If I remove /HWND switch Next button works .<br>Please help<br><br></p><pre>
<code><br><br>;NSIS Ultra Modern User Interface<br>;Background Image Example Script<br>;Written by SuperPat<br><br>;--------------------------------<br>;General<br><br>  ;Name and file<br>  Name "******odernUI Test"<br>  OutFile "PageBG.exe"<br><br>  ;Default installation folder<br>  InstallDir "$LOCALAPPDATA\******odernUI Test"<br>  <br>  ;Get installation folder from registry if available<br>  InstallDirRegKey HKCU "Software\******odernUI Test" ""<br><br>  ;Request application privileges for Windows Vista<br>  RequestExecutionLevel user<br><br>;--------------------------------<br>;Include ******odernUI<br><br>  !include "UMUI.nsh"<br><br><br>;--------------------------------<br>;Interface Settings<br><br>; A unique background image<br>!define UMUI_UNIQUEBGIMAGE<br>!define UMUI_UNUNIQUEBGIMAGE<br><br>!define UMUI_PAGEBGIMAGE<br>!define UMUI_UNPAGEBGIMAGE<br>!define UMUI_PAGEBGIMAGE_BMP "${NSISDIR}\Contrib\******odernUI\Skins\blue\PageBG.bmp"<br><br>        <br>        !define MUI_ABORTWARNING<br>        !define MUI_UNABORTWARNING<br><br>        !define UMUI_USE_ALTERNATE_PAGE<br>        !define UMUI_USE_UNALTERNATE_PAGE<br>        <br>        !define MUI_LICENSEPAGE_RADIOBUTTONS<br>;--------------------------------<br>;Pages<br>!define MUI_PAGE_CUSTOMFUNCTION_SHOW showWelcome<br>!define MUI_PAGE_CUSTOMFUNCTION_LEAVE leaveWelcome<br>  !insertmacro MUI_PAGE_WELCOME<br>!define MUI_PAGE_CUSTOMFUNCTION_SHOW showLicense<br>!define MUI_PAGE_CUSTOMFUNCTION_LEAVE leaveLicense<br>  !insertmacro MUI_PAGE_LICENSE "${NSISDIR}\Docs\******odernUI\License.txt"<br>  !insertmacro MUI_PAGE_COMPONENTS<br>  !insertmacro MUI_PAGE_DIRECTORY<br>  <br>  <br>  Var STARTMENU_FOLDER<br>  !insertmacro UMUI_PAGE_ALTERNATIVESTARTMENU Application $STARTMENU_FOLDER<br><br>!insertmacro UMUI_PAGE_CONFIRM<br><br>  !insertmacro MUI_PAGE_INSTFILES<br>  <br>  <br>;       !define MUI_FINISHPAGE_RUN "blabla.exe"<br>;       !define MUI_FINISHPAGE_RUN_TEXT "run blabla"<br>        !define MUI_FINISHPAGE_SHOWREADME "blabla.htm"<br>        !define MUI_FINISHPAGE_SHOWREADME_TEXT "blabla readme"<br>        !define MUI_FINISHPAGE_LINK "******odernUI Home Page"<br>        !define MUI_FINISHPAGE_LINK_LOCATION "http://******odernui.sourceforge.net/"<br>  !insertmacro MUI_PAGE_FINISH<br><br>        !define UMUI_ABORTPAGE_LINK "******odernUI Home Page"<br>        !define UMUI_ABORTPAGE_LINK_LOCATION "http://******odernui.sourceforge.net/"<br>  !insertmacro UMUI_PAGE_ABORT<br><br><br>  !insertmacro MUI_UNPAGE_WELCOME<br>  !insertmacro MUI_UNPAGE_CONFIRM<br>  !insertmacro MUI_UNPAGE_INSTFILES<br>  <br>        !define MUI_FINISHPAGE_LINK "******odernUI Home Page"<br>        !define MUI_FINISHPAGE_LINK_LOCATION "http://******odernui.sourceforge.net/"<br>  !insertmacro MUI_UNPAGE_FINISH<br><br>        !define UMUI_ABORTPAGE_LINK "******odernUI Home Page"<br>        !define UMUI_ABORTPAGE_LINK_LOCATION "http://******odernui.sourceforge.net/"<br>  !insertmacro UMUI_UNPAGE_ABORT<br>  <br>;--------------------------------<br>;Languages<br> <br>  !insertmacro MUI_LANGUAGE "English"<br><br>;--------------------------------<br>;Installer Sections<br><br>Section "Dummy Section" SecDummy<br><br>  SetOutPath "$INSTDIR"<br>  <br>  ;ADD YOUR OWN FILES HERE...<br>  <br>  ;Store installation folder<br>  WriteRegStr HKCU "Software\******odernUI Test" "" $INSTDIR<br>  <br>  ;Create uninstaller<br>  WriteUninstaller "$INSTDIR\Uninstall.exe"<br><br>SectionEnd<br><br>;--------------------------------<br>;Descriptions<br><br>  ;Language strings<br>  LangString DESC_SecDummy ${LANG_ENGLISH} "A test section."<br><br>  ;Assign language strings to sections<br>  !insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br>    !insertmacro MUI_DESCRIPTION_TEXT ${SecDummy} $(DESC_SecDummy)<br>  !insertmacro MUI_FUNCTION_DESCRIPTION_END<br> <br>;--------------------------------<br>;Uninstaller Section<br><br>Section "Uninstall"<br><br>  ;ADD YOUR OWN FILES HERE...<br><br>  Delete "$INSTDIR\Uninstall.exe"<br><br>  RMDir "$INSTDIR"<br><br>  DeleteRegKey /ifempty HKCU "Software\******odernUI Test"<br><br>SectionEnd <br>Function showWelcome<br><br>; for Back button - dll reset<br>  AnimGif::stop<br>; left logo on the Welcome page<br>  AnimGif::play /NOUNLOAD /HALIGN=RIGHT /VALIGN=TOP "$EXEDIR\tweety.gif"<br><br>FunctionEnd<br><br>Function leaveWelcome<br>  AnimGif::stop<br>FunctionEnd<br><br>Function showLicense<br>; for Back button - dll reset<br> AnimGif::stop<br>; left logo on the Welcome page<br>  AnimGif::play /NOUNLOAD  /HWND=$HWNDPARENT /HALIGN=LEFT /VALIGN=TOP "$EXEDIR\tweety.gif"<br><br>FunctionEnd<br><br>Function leaveLicense<br>  AnimGif::stop<br>FunctionEnd<br> <br></code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Alfaromeo</span><br>
      <span class="post-time small text-muted">8th March 2010 03:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Can anybody help ? If i don't pass /HWND=$HWNDPARENT to the AnimGif plugin , I'm able to navigate to the next dialog .If I do pass , I need to press Next Button twice to navigate to next page.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br>
      <span class="post-time small text-muted">8th March 2010 06:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Is this a UMUI issue only? If no, can you prepare minimum size script reproducing the situation on MUI/MUI2?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Alfaromeo</span><br>
      <span class="post-time small text-muted">8th March 2010 08:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Takhir,<br>
      Thanks for replying.<br>
      It isn't an UMUI issue only. The reason why I want to pass $HWNDPARENT to /HWND switch is because I need to show the animation on extreme left corner of the dialog.The default only points to child window.<br>
      <br>
      Here is a sample script that uses MUI2. To demonstrate , please have any two gif files "WelcomeAnimate.gif" and "Banner.gif" in the current NSI file location.Now compile and run the installer . In component page Next button press , it takes you to the same component page.Again press Next , now it moves into directory page .<br>
      This is a flaw since I'm having /HWND=$HWNDPARENT in the "showComponents" function. Now remove the /HWND switch in the same function, recompile and run , the navigation works as expected .This is applicable to any page . not just License Page as I mentioned earlier in my post.<br>
      <br></p>
      <pre>
<code><br><br>!include "MUI2.nsh"<br>Name "AnimaionTest"<br>OutFile "Animation.exe"<br>InstallDir "$LOCALAPPDATA\AnimationTest"<br>RequestExecutionLevel user<br>!define MUI_ABORTWARNING<br>!define MUI_PAGE_CUSTOMFUNCTION_SHOW showLicense<br>!define MUI_PAGE_CUSTOMFUNCTION_LEAVE leaveLicense<br>!insertmacro MUI_PAGE_LICSENSE "{NSISDIR}\Docs\Modern UI\License.txt"<br>!define MUI_PAGECUSTOMFUNCTION_SHOW showComponents<br>!define MUI_PAGECUSTOMFUNCTION_LEAVE leaveComponents<br>!insertmacro MUI_PAGE_COMPONENTS<br>!insertmacro MUI_PAGE_DIRECTORY<br>!insertmacro MUI_PAGE_INSTFILES<br>!insertmacro MUI_UNPAGE_CONFIRM<br>!insertmacro MUI_UNPAGE_INSTFILES<br>!insertmacro MUI_LANGUAGE "English"<br><br>Section "Dummy" Dummy<br>SetOutPath "$INSTDIR"<br>SectionEnd<br><br>Function .onInit<br>InitPluginsDir<br>File /oname=$PLUGINSDIR\WelcomeAnimate.gif WelcomeAnimate.gif<br>File /oname=$PLUGINSDIR\Banner.gif Banner.gif<br>FunctionEnd<br><br>Function un.onInit<br>FunctionEnd<br><br>Function showComponents<br>AnimGif::play /NOUNLOAD /HWND=$HWNDPARENT /VALIGN=CENTER /HALIGN=RIGHT "$PLUGINSDIR\WelcomeAnimate.gif"<br>FunctionEnd<br><br>Function leaveComponents<br>AnimGif::stop<br>FunctionEnd<br><br>Function showLicense<br>AnimGif::play /NOUNLOAD /VALIGN=TOP /HALIGN=CENTER "$PLUGINSDIR\Banner.gif"<br>FunctionEnd<br><br>Function leaveLicense<br>AnimGif::stop<br>FunctionEnd<br><br></code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br>
      <span class="post-time small text-muted">8th March 2010 10:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">First of all about flickering - you cannot draw image on the window part which is already occupied by other 'child' window (and it covers parent), this case you should draw on the 'child' window.</p>
      <pre>
<code>Function showComponents<br>AnimGif::play /NOUNLOAD /HWND=$HWNDPARENT /VALIGN=CENTER /HALIGN=RIGHT "$PLUGINSDIR\sonic.gif"<br>FunctionEnd</code>
</pre><br>
      As you can see on the attached image central part of NSIS dialog is another dialog with controls which are child relative to this dialog. Another words - you can use animated gifs on the free part of top level 'child'. By default target is a child dialog (Spy++ shows it's border on attached image). Clear understanding of windows hierarchy required :).<br>
      I could not reproduce 'Next' problem with your script (with few fixes like MUI_PAGECUSTOMFUNCTION_SHOW and MUI_PAGE_LICSENSE wording), but I remember that I had such situation long ago... You can try to use SetFocus to the Next button if problem will not be resolved with correct target windows (see AnimGif and AnimGifPe included samples).
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Alfaromeo</span><br>
      <span class="post-time small text-muted">8th March 2010 17:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry for the typo.<br>
      <br>
      Here is the corrected script. Never mind about the flickering since I will be using UMUI large dialog, which has enough space around the child dialog.To reproduce I have it simulated in the following MUI code . I still face issue with the Next button, it needs to be pressed twice .<br>
      <br></p>
      <pre>
<code><br><br>!include "MUI2.nsh"<br>Name "AnimaionTest"<br>OutFile "Animation.exe"<br>InstallDir "$LOCALAPPDATA\AnimationTest"<br>RequestExecutionLevel user<br>!define MUI_ABORTWARNING<br>!define MUI_PAGE_CUSTOMFUNCTION_SHOW showLicense<br>!define MUI_PAGE_CUSTOMFUNCTION_LEAVE leaveLicense<br>!insertmacro MUI_PAGE_LICENSE "${NSISDIR}\Docs\Modern UI\License.txt"<br>!define MUI_PAGE_CUSTOMFUNCTION_SHOW showComponents<br>!define MUI_PAGE_CUSTOMFUNCTION_LEAVE leaveComponents<br>!insertmacro MUI_PAGE_COMPONENTS<br>!insertmacro MUI_PAGE_DIRECTORY<br>!insertmacro MUI_PAGE_INSTFILES<br>!insertmacro MUI_UNPAGE_CONFIRM<br>!insertmacro MUI_UNPAGE_INSTFILES<br>!insertmacro MUI_LANGUAGE "English"<br><br>Section "Dummy" Dummy<br>SetOutPath "$INSTDIR"<br>SectionEnd<br><br>Function .onInit<br>InitPluginsDir<br>File /oname=$PLUGINSDIR\tweety.gif tweety.gif<br>FunctionEnd<br><br>Function un.onInit<br>FunctionEnd<br><br>Function showComponents<br>AnimGif::play /NOUNLOAD /HWND=$HWNDPARENT /VALIGN=CENTER /HALIGN=RIGHT "$PLUGINSDIR\tweety.gif"<br>FunctionEnd<br><br>Function leaveComponents<br>AnimGif::stop<br>FunctionEnd<br><br>Function showLicense<br>AnimGif::play /NOUNLOAD /HWND=$HWNDPARENT /VALIGN=TOP /HALIGN=RIGHT "$PLUGINSDIR\tweety.gif"<br><br>FunctionEnd<br><br>Function leaveLicense<br>AnimGif::stop<br>FunctionEnd<br><br></code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br>
      <span class="post-time small text-muted">8th March 2010 18:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks, Alfaromeo, with your last script I could reproduce and understand :) situation. Catched main dlg messages should be re-send for correct click handling. Please test attached dll.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Alfaromeo</span><br>
      <span class="post-time small text-muted">9th March 2010 03:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Takhir,<br>
      <br>
      Excellent that fixes it.<br>
      Can we also have some switches like /LEFT /BOTTOM , wherein I can specify the co-ordinates for positioning the animation.With the existing positioning switches , I cannot fine tune the position coordinates . With the one I mentioned I could possibly pass any integer values to specify the position.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br>
      <span class="post-time small text-muted">14th March 2010 12:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I had a free minute and updated wiki' plug-in sources and binaries: $HWNDPARENT buttons click fix. Positioning in percents of width/height now. Unicode version added.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Alfaromeo</span><br>
      <span class="post-time small text-muted">15th March 2010 11:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Takhir,<br>
      <br>
      You are the dude. Thanks ,please consider this solved.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>