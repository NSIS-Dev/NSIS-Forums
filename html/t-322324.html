<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Customizing File command?" />

  <title>Customizing File command? - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Customizing File command?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=322324">Customizing File command?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">siggel</span><br />
      <span class="post-time small text-muted">10th September 2010 08:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Customizing File command?</strong><br />
      &nbsp; Hi all,<br />
      I have some quite complicated requirements for using the File command, in order to overwrite program files, but not overwrite configuration etc. Unfortunately I don't even know which files are contained, but I know, that such configuration files end on e.g. .cfg Therefore I need to use /r instead of specifying each file separately.<br />
      <br />
      Overwriting the program files is quite easy:<br />
      File /nonfatal /r /x *.cfg patch\partA\*.*<br />
      <br />
      But for the *.cfg files I'd like to check whether they already exist, differ and take according actions like putting a file aside the existing one with ".new" appended to the name. And a summary file would be fine, so when running silently the user has a chance to know, which files need to be checked.<br />
      <br />
      My first idea would be to unpack them to another location and implement my own script for diffing etc. Does that sound reasonable or are there macros available already for things like that. Or maybe can I implement a "custom" SetOverwrite mode?<br />
      <br />
      Thx<br />
      siggel<br />
      <br />
      PS: I have no influence on the incoming files, so I have no chance to do more sophisticated patching. Just in case you wonder...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">10th September 2010 09:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The File command itself can't really be extended/customized for this purpose.<br />
      You're on the right track with extracting to a separate location, then enumerating the files extract, and using CopyFiles conditionally, as that is what gives you access to details about the source files, and the destination files (if existing).<br />
      <br />
      Can't say there's an existing library. I started one a while back but realized that for a custom project it's pretty simple.. but for a generic solution you run into a whole host of problems stemming directly from the File command's complexity.<br />
      I.e. if you create a macro to wrap the File command, you'll either need separate macros for File /x, File /r, File /r /x, etc. or have a single Macro but with optional flags for everything; which would often go un-used.. meaning that a user's script might look like `${File} SomeFile.ext "" "" "" "" "" ""`<br />
      <br />
      The way I started to solve that was using context defines.. e.g.<br /></p>
      <pre>
!define file.recursive<br />!define file.exclude *.svn<br />${File} "somefolder\*.*" 
</pre>Where the defines would cause the actual File command being used to be `File /r /x *.svn "somefolder\*.*"`<br />
      But I'm not really working too actively on it.<br />
      <br />
      Ideally the File command would trigger callbacks with some filled variables.. one before writing a file (so that you can Abort it if you decide not to write out the file), and one after writing it (so that you can perform logging or whatever, for use with /r mostly).<br />
      <br />
      The other option that is generally used is to generate a file using another utility (or even another NSIS installer) that has single commands for each individual file - essentially replacing /r in a way - for inclusion in your main installer. You could use that to generate a more complex variant (wrapping the config files with a ${Unless} ${FileExists}) as well. Never been fond of that route, myself, though :)
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>