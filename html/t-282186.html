<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Troubles when retrieving the state of a checkbox" />

  <title>Troubles when retrieving the state of a checkbox - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Troubles when retrieving the state of a checkbox</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=282186">Troubles when retrieving the state of a checkbox</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mikkelmr</span><br />
      <span class="post-time small text-muted">27th November 2007 09:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Troubles when retrieving the state of a checkbox</strong><br />
      Hi all<br />
      <br />
      Using nsDialogs, I'm trying to check the state of a checkbox each time it's clicked.<br />
      <br />
      First of all it seems like the nsDialogs::OnChange event isn't working for checkboxes... or am I wrong?<br />
      <br />
      Instead I tryed the nsDialogs::OnClick event like this:<br />
      <br />
      GetFunctionAddress $0 onClick<br />
      nsDialogs::OnChange /NOUNLOAD $CHECKBOX $0<br />
      <br />
      Function onClick<br />
      SendMessage $CHECKBOX ${BM_GETSTATE} 0 0 $0<br />
      <br />
      ${If} $0 == "1"<br />
      MessageBox MB_ICONEXCLAMATION|MB_OK "CheckBox checked"<br />
      ${Else}<br />
      MessageBox MB_ICONEXCLAMATION|MB_OK "CheckBox unchecked"<br />
      ${EndIf}<br />
      <br />
      FunctionEnd<br />
      <br />
      The problem is that the value/state of the checkbox is either 520 or 521, when checked in the onClick event handler.<br />
      <br />
      But when checked in the leave page function it's 0 or 1.<br />
      <br />
      How come this behavior? Is a bug or am I doing something wrong?<br />
      <br />
      Best regards<br />
      Mikkel Munck Rasmussen</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">27th November 2007 18:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You should indeed use OnClick for checkboxes. You can use the ${NSD_OnClick} macro for easier usage.<br />
      <br />
      520 and 521 are invalid states. I don't understand how you can get them from BM_GETSTATE.<br />
      <br />
      Also, you forgot to pop the HWND in OnCLick. $CHECKBOX is passed on the stack and must be popped or else the stack would get corrupted.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mikkelmr</span><br />
      <span class="post-time small text-muted">27th November 2007 19:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks a lot for your answer<br />
      <br />
      Well, I based my code on the example that comes with the NSIS installation: NSISDIR\Examples\nsDialogs\example.nsi<br />
      <br />
      And the problem is the same here. You can check this by changing the OnCheckbox function on line 69 to:<br />
      <br />
      Function OnCheckbox<br />
      <br />
      SendMessage $CHECKBOX ${BM_GETSTATE} 0 0 $0<br />
      MessageBox MB_OK "Checkbox state: $0"<br />
      <br />
      FunctionEnd<br />
      <br />
      And the problem is the same.<br />
      <br />
      <br />
      And what do you mean by "pop the HWND in OnClick"? Could you please provide an example?<br />
      <br />
      Thanks in advance<br />
      <br />
      \Mikkel</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">27th November 2007 21:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Use BM_GETCHECK instead. I don't know what are those 0x208 flags BM_GETSTATE adds, but BM_GETCHECK seems to work better.<br />
      <br />
      As for popping, the examples were flawed. I fixed them for the next version. You just have to Pop one item from the stack every time your OnClick and OnChange callback function is called. That item is the HWND of the item for which the notification is sent.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mikkelmr</span><br />
      <span class="post-time small text-muted">28th November 2007 10:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks a lot for your help!<br />
      <br />
      BM_GETCHECK did the job.<br />
      <br />
      \Mikkel</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
