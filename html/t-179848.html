<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="NSIS compile error"><title>NSIS compile error - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">NSIS compile error</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=179848">NSIS compile error</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">ovidiu</span><br><span class="post-time small text-muted">13th May 2004 15:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>NSIS compile error</strong><br>I'm getting the following error while trying to compile NSIS.<br>Anyone can tell me which library am i missing ?<br><br><i>Ui.obj : error LNK2001: unresolved external symbol __aullshr<br>Release-bzip2/exehead_bzip2.exe : fatal error LNK1120: 1 unresolved externals<br></i></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">15th May 2004 11:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Which compiler?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">lroathe</span><br><span class="post-time small text-muted">4th June 2004 23:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Re: NSIS compile error</strong><br></p><blockquote><i>Originally posted by ovidiu</i><br><b>I'm getting the following error while trying to compile NSIS.<br>Anyone can tell me which library am i missing ?<br><br><i>Ui.obj : error LNK2001: unresolved external symbol __aullshr<br>Release-bzip2/exehead_bzip2.exe : fatal error LNK1120: 1 unresolved externals<br></i></b><hr></blockquote></div><hr>I am also seeing this error, and have been unable to find any reference to aullshr in the windows docs or headers.<br><br>I am using MSVS (vc) 6.0 with the latest service pack.<br><div class="post"><p class="post-meta"><span class="post-author text-primary">iceman_k</span><br><span class="post-time small text-muted">5th June 2004 02:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Make sure that you also have the latest <a href="http://www.microsoft.com/msdownload/platformsdk/sdkupdate/" target="_blank">Platform SDK</a> downloaded.<br>Then register the PSDK directories with Visual Studio using the shortcuts installed with the PSDK.<br>Then try compiling again.<br>Maybe it will fix the problem.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">lroathe</span><br><span class="post-time small text-muted">5th June 2004 03:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Quote:</p><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">iceman_k</span><br><span class="post-time small text-muted">5th June 2004 04:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Not that I know of.<br>I just tried compiling and it worked fine. I assume you are using the latest CVS version?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">lroathe</span><br><span class="post-time small text-muted">5th June 2004 04:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Trying to compile the latest from CVS, just checked it out this afternoon. The aullshr reference is in gui.c if that helps.<br><br>Actually, the only reason I want to compile is to modify the error message reported for "Corrupt Installation Detected" -- many of my users get this when downloading our products (they range from 25MB to 105MB in size) and it would be good if that message indicated it was probably a download problem and give a suggestion on how to solve it.<br><br>Can I otherwise modify this string?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">5th June 2004 09:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">__aullshr is probably VC6 SP6's function that performs shift right operations on unsigned long long variables. No idea what the 'a' is for :)<br><br>Try replacing Ui.c line 907:</p><pre>
<code>available = (int)(available64.QuadPart &gt;&gt; 10);</code>
</pre>with:<pre>
<code>available = (int)(Int64ShrlMod32(available64.QuadPart, 10));</code>
</pre></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">lroathe</span><br><span class="post-time small text-muted">5th June 2004 17:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i><br><b>__aullshr is probably VC6 SP6's function that performs shift right operations on unsigned long long variables. No idea what the 'a' is for :)<br><br>Try replacing Ui.c line 907:</b><pre>
<b><code>available = (int)(available64.QuadPart &gt;&gt; 10);</code></b>
</pre><b>with:</b><pre>
<b><code>available = (int)(Int64ShrlMod32(available64.QuadPart, 10));</code></b>
</pre></blockquote>That was exactly the problem, and I can now compile and link all targets! Now, why the frick does my copy of VC6 SP6 generate a call to that function, but is then not able to link in that function? Could it be that there is a way to setup VC6 with long-long support libraries as an option?<br><br>Anyway, thanks for the help!<br><br>PS: my guess at the function name is "arithmatic unsigned long long shift right"</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">iceman_k</span><br><span class="post-time small text-muted">5th June 2004 18:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Alternately, you can extract ullshr.obj from libc:<br></p><pre>
<code><br>lib /extract:build\intel\st_obj\ullshr.obj libc.lib<br></code>
</pre><br>
        <br>
        and link it in the project.
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">iceman_k</span><br>
        <span class="post-time small text-muted">2nd July 2004 16:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"></p>

        <blockquote>
          <i>Originally posted by kichik</i><br>
          <b>__aullshr is probably VC6 SP6's function that performs shift right operations on unsigned long long variables. No idea what the 'a' is for :)<br>
          <br>
          Try replacing Ui.c line 907:<br></b>
          <pre>
<b><code>available = (int)(available64.QuadPart &gt;&gt; 10);</code></b>
</pre><b>with:</b>
          <pre>
<b><code>available = (int)(Int64ShrlMod32(available64.QuadPart, 10));</code></b>
</pre>
        </blockquote>Any plans of making this change in the CVS source?
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
        <span class="post-time small text-muted">2nd July 2004 22:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">No. It produces larger code. A better solution must be found.</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">iceman_k</span><br>
        <span class="post-time small text-muted">3rd July 2004 03:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Is this of any use to you?<br>
        <a href="http://www.dpi.ufv.br/downloads/C++%20Introductory%20Edition" target="_blank">ullshr.asm</a></p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
        <span class="post-time small text-muted">3rd July 2004 13:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Hmm... Visual C++ Introductory Edition? I assume you meant to link to an implementation of ullshr. I prefer not to get assembler in yet. Extracting __aullshr as an .obj file and linking to it so SP6 can find does seem like a possible solution. I would, of course, prefer a code change solution that will both work on SP6 and SP5 and not increase code size.</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">iceman_k</span><br>
        <span class="post-time small text-muted">3rd July 2004 19:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Oops! :o<br>
        Certainly didn't mean to imply that you needed an intro to VC++.<br>
        Here is the correct link:<br>
        <a href="http://www.dpi.ufv.br/downloads/C++%20Introductory%20Edition/VCB600ENU1/VC98/CRT/SRC/PLATFORM/ULLSHR.ASM" target="_blank">ullshr.asm</a><br>
        <br>
        But, yes, it is assembly.<br>
        So, perhaps not the right solution for now.</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">RDaneel</span><br>
        <span class="post-time small text-muted">3rd July 2004 20:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Hmmm... going along with kichik, let's not be too hasty here. :)<br>
        <br>
        I built from CVS on June 3 (because of the NT4 installer problem with GetDiskFreeSpaceEx), and this chunk of code dealing with the 64-bit right-shift is right there in the sources... and *I* used a vc6 SP6 system to do it.<br>
        <br>
        BUT, I am still using the code generator (c2.dll) from the "Processor Pack" for SP5... and possibly because of the newer ["vc7"] compiler piece, all I see is inline code generated for the code sequence in question:<br></p>

        <blockquote>
          mov eax, DWORD PTR _available64$93998[ebp]<br>
          mov ecx, DWORD PTR _available64$93998[ebp+4]<br>
          shrd eax, ecx, 10<br>
          shr ecx, 10 ; 0000000aH
        </blockquote>This is with the NSIS-standard optimization setting of "Minimize Size", BTW. However, I do specify the "Pentium Pro" (/G6) code generation option, since that more accurately reflects the in-use processor architectures one is like ly to see these days.<br>
        <br>
        So, since as I recall, kichik uses the Processor Pack, this could explain why only some people are seeing this linking issue - the people who are not using the Processor Pack. :)<br>
        <br>
        As to *why* the linking problem exists, it is not really clear to me - the "ullshr.asm" file has been part of the CRT sources for a long time - take a look in ..\CRT\SRC\Intel.<br>
        <br>
        As for vc6 SP6 + the SP5 Processor Pack, I have been using this combination since SP6 came out with no difficulty. Besides not seeing any trouble myself, I might point out that SP6 does NOT include a new version of c2.dll, so the possibility of incompatible changes to the intermediate representation from the compiler's earlier passes is small. :)
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">iceman_k</span><br>
        <span class="post-time small text-muted">3rd July 2004 22:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Hmmm... I didn't try VS6 SP6 + SP5 processor pack.<br>
        Let me try that and see.</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">RDaneel</span><br>
        <span class="post-time small text-muted">3rd July 2004 22:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">If you have any trouble doing this... SP6 *will* attempt to remove/disable the Processor Pack. :(<br>
        <br>
        I took care of this by saving the contents of the appropriate "Bin" directory first, and then restoring any of the c2.dll / MASM support files I needed to after the SP6 update was done.<br>
        <br>
        One could take this approach, or if the "damage" has already been done, using 7-Zip or WinZip to pull the relevant files straight out of the SP5 Processor Pack installer would probably be fine too. :)<br>
        <br>
        Note that this all works fine if one just wants the superior code generator from the Processor Pack... if you want to actually use the processor Pack as MS intended (to have compiler support for the MMX/SSE etc H/W), there may be a little more environment needed to restore - see the .reg files in the PP installer, for example.</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
        <span class="post-time small text-muted">7th July 2004 18:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"></p>

        <blockquote>
          <i>Originally posted by RDaneel</i><br>
          <b>As to *why* the linking problem exists, it is not really clear to me - the "ullshr.asm" file has been part of the CRT sources for a long time - take a look in ..\CRT\SRC\Intel.</b>
        </blockquote>We don't use CRT ;)
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">bluenet</span><br>
        <span class="post-time small text-muted">1st October 2004 01:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">I got another error: NSIS\Source\DialogTemplate.cpp(353) : error C2065: 'DS_SHELLFONT' : undeclared identifier<br>
        What wrong for me? Compiler is VC++ 6 with SP6<br>
        I find it define in exehead\resource.h<br>
        <br>
        I try to add<br>
        <br></p>
        <pre>
<span style="color: #FF8000">#ifndefDS_SHELLFONT
<br>#defineDS_SHELLFONT(DS_SETFONT|DS_FIXEDSYS)
<br>#endif
</span>
</pre>to DialogTemplate.h it compile OK. :D
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
        <span class="post-time small text-muted">1st October 2004 10:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Fixed, thanks.</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
        <span class="post-time small text-muted">16th September 2005 17:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">I've added a check to the SConscript to check for this specific case and use Int64ShrlMod32 instead. Building using SP6 should no longer require manual intervention.</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Wizou</span><br>
        <span class="post-time small text-muted">17th March 2010 11:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">I have a problem building NSIS with MSVC 2005 tools:<br></p>

        <blockquote>
          as /coff -o build\debug\System\Source\Call.obj Contrib\System\Source\Call.S<br>
          'as' was not found.
        </blockquote>After some investigation, I think the problem is that SCons should use masm.py configuration in order to use the ml.exe MASM compiler that comes with MSVC, instead of as.exe (from MingW?)<br>
        <br>
        But I don't know how to tell SCons to do that..
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
        <span class="post-time small text-muted">22nd March 2010 15:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Are you sure ml.exe is in the PATH? At least on VC6 it required a separate installation of the Processor Pack, iirc.</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Wizou</span><br>
        <span class="post-time small text-muted">23rd March 2010 10:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">thanks! after adding MSVC dir to the PATH, it worked</p>
      </div>
      <hr>

      <div class="footer">
        <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
      </div><script type="text/javascript" src="../js/highlight.pack.js" async>
</script><script type="text/javascript">
//<![CDATA[
      hljs.initHighlightingOnLoad();
      //]]>
      </script>

      <table cellpadding="6" cellspacing="0" border="0" width="100%">
        <tr>
          <td class="alt2">
            <hr>
            <i>Originally posted by iceman_k</i><br>
            <b>Make sure that you also have the latest <a href="http://www.microsoft.com/msdownload/platformsdk/sdkupdate/" target="_blank">Platform SDK</a> downloaded.<br>
            Then register the PSDK directories with Visual Studio using the shortcuts installed with the PSDK.<br>
            Then try compiling again.<br>
            Maybe it will fix the problem.</b> Unfortunately I had already done that. Does NSIS require .net?</td></tr></table></div></div></body></html>