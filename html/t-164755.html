<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Memory hole?"><title>Memory hole? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Memory hole?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=164755">Memory hole?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">spanky</span><br><span class="post-time small text-muted">14th January 2004 01:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Memory hole?</strong><br>I'm not sure why but this example below will use upwards towards 90MB of memory within 20 mins. In my test I pointed the download file to something small, around 20K in size.<br>I've tested this bug(?) with various builds, including the latest CVS release.<br><br><font color="darkblue"><br>-------------------------<br>Name "memoryhole"<br>OutFile "memoryhole.exe"<br>Caption "memoryhole"<br>SilentInstall silent<br><br>Section ""<br><br>foo:<br>NSISdl::download <a href="http://www.noname.com/poo.jpg" target="_blank">http://www.noname.com/poo.jpg</a> $EXEDIR\outfile.exe<br>sleep 25<br>goto foo<br><br>SectionEnd<br>-------------------------<br></font></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rainwater</span><br><span class="post-time small text-muted">14th January 2004 01:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Unless its leaking memory, I don't see a bug since its an infinite loop.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">spanky</span><br><span class="post-time small text-muted">14th January 2004 02:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by rainwater</i><br><b>Unless its leaking memory, I don't see a bug since its an infinite loop.</b></blockquote>It uses more and more memory with each loop. That is a memory leak, is it not?!</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">14th January 2004 20:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">No, is not. Like rainwater said, you only have an endless loop, but it'll grab memory.<br>Leak is when you don't empty the space in the memory. In this case you just loading up.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">spanky</span><br><span class="post-time small text-muted">15th January 2004 00:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">so why is it gobbling up memory and how can it be freed?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">15th January 2004 01:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">mmm, because there's no exit for the loop.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">spanky</span><br><span class="post-time small text-muted">15th January 2004 05:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">what you say makes no sense. I don't see why having "no exit for the loop" is a reason for this example to gobble 90MB+ in less than 20 mins.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yathosho</span><br><span class="post-time small text-muted">15th January 2004 12:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">that's how IE works, and i think not NSIS is to blame for this ;)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">15th January 2004 12:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">NSISdl does not use IE.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">15th January 2004 20:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by spanky</i><br><b>what you say makes no sense. I don't see why having "no exit for the loop" is a reason for this example to gobble 90MB+ in less than 20 mins.</b></blockquote>It's memory "usage", no leaking, of the Win32 APIs. Since there's no stop in the loop, the OS (Windows) works endless.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">spanky</span><br><span class="post-time small text-muted">15th January 2004 23:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">ah, so the usage is keeping track of where it is in the loop?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">16th January 2004 16:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">16th January 2004 17:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">No, that's not supposed to happen. No API call should increase memory usage when used in a loop assuming its freeing function is also called in the loop.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">spanky</span><br><span class="post-time small text-muted">17th January 2004 01:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i><br><b>No, that's not supposed to happen. No API call should increase memory usage when used in a loop assuming its freeing function is also called in the loop.</b></blockquote>so would this mean there is a bug in NSIS?</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">17th January 2004 04:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It's not a NSIS bug. It's the computer working out with an endless loop.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">17th January 2004 11:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It is a bug in the NSISdl plug-in.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">17th January 2004 17:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Lobo, try:<br><br>loop:<br>sleep 1<br>goto loop</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">17th January 2004 19:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><pre>
<code><br>Name "memoryleak"<br>OutFile "memoryleak.exe"<br>Caption "memoryleak"<br>SilentInstall silent<br><br>Section ""<br>Loop:<br>sleep 1<br>goto Loop<br>SectionEnd<br></code>
</pre><br>
      The memory usage of the EXE still 2,188 KB. No overflow of the memory...
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br>
      <span class="post-time small text-muted">17th January 2004 22:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Indeed. So there is something wrong with NSISdl.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br>
      <span class="post-time small text-muted">18th January 2004 12:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I stand corrected then. I thought an infinite loop would start eating up the stack, but I guess it doesn't.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">1st February 2004 18:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The main leak is in your code. You forgot to Pop the returned value. This leaks 1KB each iteration of the loop. Other than that, there were some problems with NSISdl. Hopefully they were all fixed in the latest CVS version. See the <a href="http://nsis.sf.net/changelog.php" target="_blank">change log</a> for more details.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script type="text/javascript" src="../js/highlight.pack.js" async>
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>