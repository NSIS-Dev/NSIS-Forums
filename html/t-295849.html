<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Can an NSIS installer read data appended to installer .exe after it was created?"><title>Can an NSIS installer read data appended to installer .exe after it was created? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Can an NSIS installer read data appended to installer .exe after it was created?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=295849">Can an NSIS installer read data appended to installer .exe after it was created?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">nsnb</span><br><span class="post-time small text-muted">12th August 2008 17:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Can an NSIS installer read data appended to setup.exe after it was created?</strong><br>&nbsp; I would like to append a small chunk of data (less than 256 bytes) to the setup.exe file generated by the NSIS compiler (i.e. after the NSIS script has been compiled, possibly with compression).<br><br>I know that this is possible, that the small chunk of data won't be CRC'ed, and that the modified setup.exe will run as if that small chunk of data was not appended.<br><br>However, I am interested in being able to read it from within the NSIS script when the user runs the installer. Is this possible? If so, is there already a plugin (or even built-in API) that helps facilitate that?<br><br>For example, can I use NSIS's FileSeek and FileRead to accomplish the above, although these operations are to be performed on the same setup.exe that does those two operations?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comperio</span><br><span class="post-time small text-muted">12th August 2008 17:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This <a href="http://nsis.sourceforge.net/ReadCustomerData" target="_blank">wiki article</a> might help.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">nsnb</span><br><span class="post-time small text-muted">12th August 2008 17:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Comperio</i><br><b>This <a href="http://nsis.sourceforge.net/ReadCustomerData" target="_blank">wiki article</a> might help.</b></blockquote>OMG - you are so good! That is exactly what I was looking for. Thank you very much, Comperio.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">nsnb</span><br><span class="post-time small text-muted">23rd September 2008 00:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Tips to anyone who might be looking to use the excellent article written by Andrey Tarantsov:<br><br><a href="http://nsis.sourceforge.net/ReadCustomerData" target="_blank">http://nsis.sourceforge.net/ReadCustomerData</a><br><br>It works very well. However, it works <b>only if you <font color="red">don't</font> compile the NSIS script with a <font color="indigo">compressor</font></b><br><br>In my case the compressed result is not much smaller than the uncompressed so it makes no difference for me (I am happy :)).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">nsnb</span><br><span class="post-time small text-muted">23rd September 2008 02:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by nsnb</i><br><b>It works very well. However, it works</b> only if you <font color="red">don't</font> compile the NSIS script with a <font color="indigo">compressor</font></blockquote>Sorry, I have to take back what I just wrote above. My "discovery" documented above was due to a bug in my implementation of <b>Function ReadCustomerData</b>.<br><br>Andrey Tarantsov uses a very robust method to search for CUSTDATA:<br><pre>
<code>
loop:
<br> FileSeek $1 $2 END
<br>  FileRead$1 $3 $4
<br>  StrCmp$3 $R1 found
<br>  IntOp$2 $2 + 1
<br>  IntCmp$2 0 loop loop 
<br>&gt;
</code>
</pre>But it is also <i>very</i> slow. This is because it keeps reading the file 1024 times to search for CUSTDATA...<br>
      <br>
      I thought of accelerating this by reading the last 1024 bytes in the file only once, then searching for the string in memory. It worked, but is not as robust as Trantsov's: in my implementation compression effects whether CUSTDATA is found. This is clearly my bug.
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>