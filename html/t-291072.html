<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="WMI plug-in" />

  <title>WMI plug-in - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">WMI plug-in</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=291072">WMI plug-in</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">l0k1</span><br />
      <span class="post-time small text-muted">30th April 2008 15:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>WMI plug-in</strong><br />
      Attached plugin supports wmi request from MS API call.<br />
      I have included script sample.<br />
      <br />
      For now it can retrieve :<br />
      <br />
      * OS Name<br />
      * OS Version<br />
      * AntiVirus Name<br />
      * FireWall Name<br />
      * CPU Name<br />
      * Desktop resolution<br />
      * Any information if you provide correct parameters<br />
      <br />
      Any suggestion are welcomed.<br />
      <br />
      More info could be found at the NSIS Wiki plugin page<br />
      <a href="http://nsis.sourceforge.net/WmiInspector_plug-in" target="_blank">http://nsis.sourceforge.net/WmiInspector_plug-in</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">l0k1</span><br />
      <span class="post-time small text-muted">6th May 2008 14:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've just added<br />
      <br />
      * SQL Version</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">l0k1</span><br />
      <span class="post-time small text-muted">6th May 2008 15:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Forgot to join file :o</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">l0k1</span><br />
      <span class="post-time small text-muted">31st July 2008 14:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Added :<br />
      <br />
      *UserName<br />
      *ShortUserName<br />
      *UserSID<br />
      <br />
      to retrieve user name and SID from registry.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">southcot</span><br />
      <span class="post-time small text-muted">27th April 2009 07:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm very much a newbie to NSIS. I have two questions regarding this plugin:-<br />
      <br />
      1<br />
      I can't get the examples to work I get an error:-<br />
      <br />
      "WmiInspector::Request"<br />
      <br />
      I am guessing that it is something to do with where I place the plugin files which I assume are WmiInspector.vcproj, WmiInspector.cpp and WmiInspector.sln? Can anyone advise?<br />
      <br />
      <br />
      2<br />
      The WMI call I want to replicate in NSIS is contained in the following:-<br /></p>
      <pre>
<code><br />Set objWMISvc = GetObject( "winmgmts:\\" &amp; strComputerName &amp; "\root\cimv2" )<br />Set colItems = objWMISvc.ExecQuery( "Select * from Win32_ComputerSystem", , 48 )<br />For Each objItem in colItems<br />    strComputerDomain = objItem.Domain<br />    If objItem.PartOfDomain Then<br />        WScript.Echo "Computer Domain: " &amp; strComputerDomain<br />    Else<br />        WScript.Echo "Workgroup: " &amp; strComputerDomain<br />    End If<br />Next<br /></code>
</pre><br />
      <br />
      I am unsure how to go about this and would be grateful for some pointers.<br />
      <br />
      Charlie
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">27th April 2009 13:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Those files you mention are for the source code. You just need to put the DLL file in the NSIS\Plugins folder<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">southcot</span><br />
      <span class="post-time small text-muted">27th April 2009 13:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the speedy response. I open the zip at <a href="http://nsis.sourceforge.net/WmiInspector_plug-in" target="_blank">http://nsis.sourceforge.net/WmiInspector_plug-in</a> and the only files there are:-<br />
      <br />
      TestWmiInspector.exe<br />
      TestWmiInspector..nsi<br />
      WmiInspector.cpp<br />
      WmiInspector.vcproj<br />
      WmiInspector.sln<br />
      <br />
      No DLL. Same for the files attached to this message.<br />
      <br />
      Charlie</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">27th April 2009 14:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Looks like l0k1 forgot to put the actual plugin in the Zip!<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">southcot</span><br />
      <span class="post-time small text-muted">27th April 2009 15:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">So I'm not going mad after all then :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">southcot</span><br />
      <span class="post-time small text-muted">27th April 2009 15:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Is there a way of tracking it down?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">27th April 2009 15:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You will need to build the plugin yourself using Visual Studio. If you are using Windows XP or 2000 you can build with Visual Studio Express Editions C++ 2008 and the Windows Server 2003 PSDK.<br />
      <br />
      <a href="http://www.microsoft.com/Express/" target="_blank">http://www.microsoft.com/Express/</a><br />
      <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=0baf2b35-c656-4969-ace8-e4c0c0716adb&amp;displaylang=en" target="_blank">http://www.microsoft.com/downloads/d...displaylang=en</a><br />
      <br />
      I cannot build for you as I am running Windows Vista (I can only install the Windows Server 2008 PSDK).<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">southcot</span><br />
      <span class="post-time small text-muted">28th April 2009 06:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hmm uncharted territory for me but I'll give it a go. The blurb on <a href="http://www.microsoft.com/Express/" target="_blank">http://www.microsoft.com/Express/</a> tells me I also need the Microsoft MSDN Express Library. Presumably that's correct. Could you give me pointers what I do when I have these all installed?<br />
      <br />
      Charlie</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sgiusto</span><br />
      <span class="post-time small text-muted">28th April 2009 11:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello,<br />
      the .zip file CONTAINS the .dll<br />
      Please double check that you don't have it.<br />
      Regards<br />
      Stefano</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">southcot</span><br />
      <span class="post-time small text-muted">28th April 2009 11:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Nope when I click on any of the zips I just get the five files listed:-<br />
      <br />
      TestWmiInspector.exe<br />
      TestWmiInspector..nsi<br />
      WmiInspector.cpp<br />
      WmiInspector.vcproj<br />
      WmiInspector.sln<br />
      <br />
      What URL are you using?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">southcot</span><br />
      <span class="post-time small text-muted">28th April 2009 11:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hang on I have just cleared my cache and the second link on this thread does indeed now show the DLL Grrrrrrrrrrrrrrrrrrrr.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">28th April 2009 11:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The file on the Wiki does not contain the dll.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">southcot</span><br />
      <span class="post-time small text-muted">28th April 2009 12:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That would fit with the cache problem I hit as it was the first one I opened.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">southcot</span><br />
      <span class="post-time small text-muted">6th May 2009 18:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am trying to capture the domain or the computer using:-<br />
      <br /></p>

      <blockquote>
        WmiInspector::Request "CIMV2" "Win32_OperatingSystem" "Domain"
      </blockquote>gives me an error whereas:-<br />
      <br />

      <blockquote>
        WmiInspector::Request "CIMV2" "Win32_OperatingSystem" "Caption"
      </blockquote>works fine yet both values are stings. Am I missing something here?<br />
      <br />
      Also how do I recover a boolean value - in particular the WMI value "PartOfDomain"<br />
      <br />
      Can anyone give me some pointers?<br />
      <br />
      Charlie
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">6th May 2009 21:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Domain and PartOfDomain are not in Win32_OperatingSystem; they are in Win32_ComputerSystem.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">southcot</span><br />
      <span class="post-time small text-muted">7th May 2009 07:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Aha so often the answer to something that has bugged me for days proves to be frustatingly simple. Thanks for the help on all of this.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">lamprizzle</span><br />
      <span class="post-time small text-muted">28th September 2009 20:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>wmi calls returning arrays</strong><br />
      Hey l0k1, I noticed the plugin doesn't support any WMI calls that return an array of ints...<br />
      <br />
      WmiInspector::Request "CIMV2" "Win32_SystemEnclosure" "ChassisTypes"<br />
      ; see <a href="http://msdn.microsoft.com/en-us/library/aa394474" target="_blank">http://msdn.microsoft.com/en-us/library/aa394474</a>(VS.85).aspx<br />
      <br />
      Internally, I need to handle the case where var.vt is VT_ARRAY|VT_I4, but I haven't figured that out yet. Have you?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kriiC</span><br />
      <span class="post-time small text-muted">16th January 2010 10:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">how can i read all values (not just one) from request? How can i add loop to walk throw all values?<br />
      ---<br />
      And there is problem with Unicode NSIS. i compiled with ANSI NSIS and its ok, Unicode NSIS gives me request return in chinese ot smth</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dougcvc</span><br />
      <span class="post-time small text-muted">19th September 2010 20:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Wmi</strong><br />
      Im not sure if its possible to read through all results using this plug in but i created a macro based on the wmic command that reads through all results.<br />
      <br />
      Download WMI.nsh attached to this post and see the following file as an example:<br />
      <br />
      <br /></p>
      <pre>
<code><br />Name WMI<br />OutFile WMI.exe<br />RequestExecutionLevel Admin<br />OutFile "fileread.exe" <br /><br />!include WMI.nsh<br />!include LogicLib.nsh<br />Section ""<br /><br />${GetWMI} root\CIMV2 Win32_DiskDrive model callback_Function<br />${GetWMI} root\CIMV2 Win32_NetworkAdapter name callback_Function<br />${GetWMI} root\CIMV2 Win32_UserAccount name callback_Function<br />SectionEnd<br /><br />Function callback_Function<br />#$R0 = result number, $R1 = total results, $R2 = result name<br />detailprint "$R0/$R1=$R2"<br />FunctionEnd<br /></code>
</pre><br />
      <br />
      Usage ${GetWMI} namespace classes property callback_Function<br />
      <br />
      In the callback function results are $R0 = result number, $R1 = total results, $R2 = Result name.<br />
      <br />
      Theres a WMI code creator tool which is useful for finding out the namespaces, classes , and properties which can be downloaded here<br />
      <br />
      <a href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=2cc30a64-ea15-4661-8da4-55bbc145c30e&amp;displaylang=en" target="_blank">http://www.microsoft.com/downloads/e...displaylang=en</a>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">20th September 2010 18:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Please make a Wiki page. Also I would recommend wrapping your header in:<br />
      <br />
      !ifndef __WMI_Included__<br />
      !define __WMI_Included__<br />
      ...<br />
      !endif<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dougcvc</span><br />
      <span class="post-time small text-muted">28th September 2010 19:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">created a wiki page <a href="http://nsis.sourceforge.net/WMI_header" target="_blank">here</a>.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
