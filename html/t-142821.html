<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Looking for a little help" />

  <title>Looking for a little help - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Looking for a little help</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=142821">Looking for a little help</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TonyDS</span><br />
      <span class="post-time small text-muted">19th July 2003 19:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Looking for a little help</strong><br />
      &nbsp; Hi,<br />
      <br />
      I'm looking for a little help, :)<br />
      <br />
      I put together a script using HM NIS Script Wizard<br />
      <br />
      But I've made a few changes to it<br />
      <br />
      What I'm looking for is a script which helps me, if the file exists it will be backed up, but I would like another option, if uninstalled the backedup files will will be placed back in the original directories.<br />
      <br />
      Is this possible?<br />
      <br />
      I know I could use copyfile, to backup the files<br />
      <br />
      I have seen this script <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=113987&amp;highlight=backup" target="_blank">Backup</a><br />
      <br />
      Plus I'm a total novice to NSIS, and I'm not sure what all the commands and so on mean, I have looked through your documentation, but just can't figure it out :igor:<br />
      <br />
      I have attached the script I'm working with <a href="http://www.darksaber.freeserve.co.uk/temp/text.txt" target="_blank">Text</a><br />
      <br />
      It works fine so far, I still have to make a few changes so it will delete all the installed files, but I would like if possible to back them up first<br />
      <br />
      Would it be possible for someone, to create that script and explain how to use.<br />
      <br />
      Please<br />
      <br />
      I would be so grateful<br />
      <br />
      Thanks so much:D</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">20th July 2003 00:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">## Place in installer<br />
      IfFileExists "$INSTDIR\filetobackup.exe" 0 nobackup<br />
      CreateDirectory "$INSTDIR\backup"<br />
      CopyFiles "$INSTDIR\filetobackup.exe" "$INSTDIR\backup\filetobackup.exe"<br />
      nobackup:<br />
      <br />
      ## Place in uninstaller<br />
      IfFileExists "$INSTDIR\backup\filetobackup.exe" 0 nobackup<br />
      CopyFiles "$INSTDIR\backup\filetobackup.exe" "$INSTDIR\filetobackup.exe"<br />
      RMDir /r "$INSTDIR\backup"<br />
      nobackup:<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TonyDS</span><br />
      <span class="post-time small text-muted">20th July 2003 01:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks alot, but the only problem was I kept getting a error with the<br />
      <br />
      <font color="red">nobackup</font><br />
      <br />
      at the end of the IfFileExists line<br />
      <br />
      and a error with the<br />
      <br />
      <font color="red">nobackup:</font><br />
      <br />
      at the end<br />
      <br />
      once I removed them it created the backup dir and placed the file in to it<br />
      <br />
      but once I tried to restore the backup file nothing happened plus it didn't delete the backup dir<br />
      <br />
      could you explain what the <font color="red">nobackup</font> means<br />
      <br />
      Thanks again so much</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">20th July 2003 11:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Um.<br />
      If you have the codes seperated into the Uninstall section and Install section, then it will work.<br />
      If you put the whole lot in the same section, then it defeats the purpose of the code.<br />
      <br />
      1st part backs up the file if it is found.<br />
      2nd part returns the file on uninstall from the backup folder.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TonyDS</span><br />
      <span class="post-time small text-muted">20th July 2003 13:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yeah I did that<br />
      <br />
      Sorry to be a nuisance<br />
      <br />
      But would it be possible to put it into my script<br />
      <br />
      To show me how to do it<br />
      <br />
      Or do you have it in a script with it in, which I could learn from<br />
      <br />
      Again I know Iâ€™m a pain<br />
      <br />
      Thanks<br />
      <br />
      -Tony</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">20th July 2003 13:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Section "Backup old files"<br />
      IfFileExists "$INSTDIR\filetobackup.exe" 0 nobackup<br />
      CreateDirectory "$INSTDIR\backup"<br />
      CopyFiles "$INSTDIR\filetobackup.exe" "$INSTDIR\backup\filetobackup.exe"<br />
      nobackup:<br />
      SectionEnd<br />
      <br />
      Section "Uninstall"<br />
      IfFileExists "$INSTDIR\backup\filetobackup.exe" 0 nobackup<br />
      CopyFiles "$INSTDIR\backup\filetobackup.exe" "$INSTDIR\filetobackup.exe"<br />
      RMDir /r "$INSTDIR\backup"<br />
      nobackup:<br />
      SectionEnd<br />
      <br />
      The Uninstall section is what makes up your uninstaller.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TonyDS</span><br />
      <span class="post-time small text-muted">20th July 2003 15:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Stu<br />
      <br />
      I finally got it to work :)<br />
      <br />
      Now I just have to repeat the script for around 300 files :cry:<br />
      <br />
      I've done it with two sets of files and it works fine<br />
      <br />
      Hopefully I won't bug you again about this<br />
      <br />
      Thanks so much<br />
      <br />
      And to the guys who made or contribute to NSIS<br />
      <br />
      Thanks also :up:<br />
      <br />
      -Tony</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">20th July 2003 15:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">To make the script shorter and easier to maintain you can use a macro just like the one in the link you posted in your first post.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TonyDS</span><br />
      <span class="post-time small text-muted">20th July 2003 15:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks, I would if I knew how to implement it in to my script<br />
      <br />
      I know this might be asking a lot<br />
      <br />
      I have uploaded my script again with the changes Afrow UK suggested <a href="http://www.darksaber.freeserve.co.uk/temp/text.txt" target="_blank">Text script updated</a><br />
      <br />
      If it's possible and if you have the time could you take a look at it and replace it with your script, please<br />
      <br />
      Sorry but I learn better if I know where to put things :confused:<br />
      <br />
      I would greatly appreciate it if you could :D<br />
      <br />
      Please<br />
      <br />
      Thanks so much</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">20th July 2003 15:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's very simple.<br />
      <br /></p>
      <pre>
<code>!macro BackupFile FILE<br />IfFileExists "$INSTDIR\${FILE}" 0 +3<br />CreateDirectory "$INSTDIR\backup" <br />CopyFiles "$INSTDIR\${FILE}" "$INSTDIR\backup\${FILE}"<br />!macroend</code>
</pre><br />
      <br />
      Put this code on the top of your script and for every file you want to backup use:<br />
      <br />
      <pre>
<code>!insertmacro BackupFile file_name</code>
</pre><br />
      <br />
      To restor them at uninstall time put this macro on top:<br />
      <br />
      <pre>
<code>!macro RestoreFile FILE<br />IfFileExists "$INSTDIR\backup\${FILE}" 0 +3<br />CopyFiles "$INSTDIR\backup\${FILE}" "$INSTDIR\${FILE}"<br />!macroend</code>
</pre><br />
      <br />
      and for every file you want restored (in the uninstall section) use this code:<br />
      <br />
      <pre>
<code>!insertmacro RestoreFile file_name</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TonyDS</span><br />
      <span class="post-time small text-muted">20th July 2003 19:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok thanks that works fine<br />
      <br />
      In your other script you have subfolder<br />
      <br />
      Would there be any chance of you showing me how to include them also<br />
      <br />
      Please<br />
      Sorry again about this<br />
      <br />
      <b>Edit</b><br />
      <br />
      <font color="red">No matter I figured it out, from your previous script, simple as you said</font> :)<br />
      <br /></p>
      <pre>
!macro BackupFile DIR FILE
<br />IfFileExists"$INSTDIR\${DIR}\${FILE}" 0 +3
<br />CreateDirectory "$INSTDIR\backup\${DIR}" 
<br />&gt;CopyFiles "$INSTDIR\${FILE}" "$INSTDIR\backup\${DIR}\${FILE}"
<br />&gt;!macroend 
<br />&gt;

</pre>
      <pre>
<code>
"subfolder" "file_name"
<br /><br />&gt;!insertmacro BackupFile "file_name" 
</code>
</pre>
      <pre>
!macro RestoreFile DIR FILE
<br />IfFileExists"$INSTDIR\backup\${DIR}\${FILE}" 0 +3
<br />CopyFiles "$INSTDIR\backup\${DIR}\${FILE}" "$INSTDIR\${DIR}\${FILE}"
<br />&gt;!macroend 
<br />&gt;

</pre>
      <pre>
<code>
"Subfolder" "file_name"
<br /><br />&gt;!insertmacro RestoreFile "file_name" 
</code>
</pre>Thanks so much both of you for your help :D
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TonyDS</span><br />
      <span class="post-time small text-muted">21st July 2003 01:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yeah I made a mistake with the script above<br />
      <br />
      should have been<br /></p>
      <pre>
!insertmacro BackupFile "subfolder" "file_name"
<br /><br />&gt;!insertmacro BackupFile "" "file_name" 
</pre>Anyhow<br />
      <br />
      Thanks for the help :up:
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>