<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="System plugin"><title>System plugin - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">System plugin</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=106294">System plugin</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">brainsucker</span><br><span class="post-time small text-muted">21st September 2002 03:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>System plugin</strong><br>General purpose of this plugin is to allow you to call any DLL functions (for ex. kernel32.dll-&gt;GetDiskFreeSpaceExA) from within NSIS script. Some additional functionality... Coming, at least... :)<br><br>Read LastComments.txt and System.txt. MSVC++7.0 required to compile (or project conversion). Compiled dll and example script included...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">21st September 2002 09:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Word of warning, this will only work with a certain number of parameters because the NSIS code only allows a fixed number. I *believe* someone just increased this limit slightly but it's still a low number (it used to be somewhere around 5 or 6). Also, invisibly behind the scenes NSIS is entitled to use some of these slots itself, off the top of my head I can't remember if the current implementation of plugin calls uses any or not but I think it's likely that it does and so you have even less args that you can pass to a called function via this plugin.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">brainsucker</span><br><span class="post-time small text-muted">21st September 2002 13:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Arguments???</strong><br>... :-( ) ...<br><br>Certain number of parameters???? 5-6? What parameters do you mean?<br><br>Calls to external dll's thru System Plugin uses the stack to pass the parameters (at least control ones, other are specified by format). And I thought NSIS have un-sized stack, am I right? Yes, I just looked at source code, it creates and disposes elements at runtime using GlobalAlloc and GlobalFree. To plugin stack passed by pointer too, so there mustn't be any problems with CallInstDll. The dll::proc just pushes params to stack, so no problems here too. Surely, you meant something other?<br><br>By the way: in the worst case this is not a problem too, user can pass allowed number of arguments thru stack and place others to $/$R variables, he just need to specify this by ParamID.<br><br>For example, the MessageBox: the case of passing all args thru stack (takes all args from stack, and places result to $R0):<br><br>System::FullCall 33 "Example 1" "Just something" 0 "ssss?annnn" "user32.dll?MessageBoxA?iissi"<br><br>And the case of passing args thru variables:<br><br>StrCpy $R1 "Just something"<br>StrCpy $R2 "Example1"<br>StrCpy $R3 33<br>System::FullCall "nbcd?annnn" "user32.dll?MessageBoxA?iissi"</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">21st September 2002 14:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yeah it uses the stack to pass variables, but in the code I think the variables to a command keyword are packed into an opcode structure which is stored in the installer exe and then acted upon at install time. This opcode structure stacks up the args it knows about then calls the plugin. So if the opcode structure doesn't have enough space for all of your args they won't get stacked... that is unless someone changed the code recently.<br><br>-- Sunjammer</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">brainsucker</span><br><span class="post-time small text-muted">21st September 2002 16:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>dll:proc</strong><br>Checked the NSIS code once again: argument pushes are separate entrys (EW_PUSHPOP), just like EW_REGISTERDLL which calls proc itself.<br><br>P.S. Thanx for you care!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">21st September 2002 17:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hmm I'm sure I replied to earlier saying that the code has indeed changed and I was/am wrong :).. However my system or the board ate my post it seems :P<br><br>I also said that after thinking about it for a while I think you're right about the order of the arguments, especially in the case where you are dealing with a printf like function (or anything else that uses the first arg as a means of saying how many more args there will be).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">brainsucker</span><br><span class="post-time small text-muted">21st September 2002 19:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>huh</strong><br>1. :) You've posted that message to another thread ("Feature request')...<br>2. Cool... Now I have an ally! :)</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>