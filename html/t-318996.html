<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Customize language selection dialog" />

  <title>Customize language selection dialog - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Customize language selection dialog</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=318996">Customize language selection dialog</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jdt2oo7</span><br />
      <span class="post-time small text-muted">7th May 2010 01:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Customize language selection dialog</strong><br />
      Hello all,<br />
      <br />
      1. Is there a way to use the bitmap image of the installation wizard in the language selection dialog also?<br />
      2. For #1 to work, we'll need increase the size of the language selection dialog, can we do that?<br />
      <br />
      Only things that we can customized from reading the readme file are:<br />
      - The window title of the language selection dialog.<br />
      - The text to display on the language selection dialog.<br />
      <br />
      Thanks!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">7th May 2010 09:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You need to modify the LangDLL plug-in.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">CrushBug</span><br />
      <span class="post-time small text-muted">10th May 2010 22:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Or write your own, which is what we are having to do.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">11th May 2010 01:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You could also create your own dialog using existing constructs. I think this (from Afrow UK) is one of the more sensible solutions:<br /></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        The easiest solution would be to move your custom dialog to another NSIS executable and run that from .onInit. You can store the chosen language in the registry temporarily or pass it as the exit code (error level): <a href="http://nsis.sourceforge.net/Docs/AppendixD.html#D.1" target="_blank">http://nsis.sourceforge.net/Docs/AppendixD.html#D.1</a>.
      </blockquote><a href="http://forums.winamp.com/showthread.php?t=318551" target="_blank">http://forums.winamp.com/showthread.php?t=318551</a>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">CrushBug</span><br />
      <span class="post-time small text-muted">11th May 2010 17:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">While that is true, you would not be able to get a full, localized multi-code page selection. I don't think it would be much better than the existing one.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">11th May 2010 18:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by CrushBug</small><br />
        you would not be able to get a full, localized multi-code page selection.
      </blockquote>Perhaps I missed something, but as far as I know, the only thing the LangDLL plugin does is to take the stack of UI text data, language IDs and strings, build a small UI from that with the UI text data and a dropdown, and return the chosen language when done.<br />
      <br />
      All of the actual language handling itself is unrelated to that part - and that part can certainly be set up using e.g. nsDialogs.. at which point you can add a bitmap or any other control.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bnicer</span><br />
      <span class="post-time small text-muted">12th May 2010 18:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><u>Quoting the manual</u>:<br />
      <br />
      4.10.1 Language Selection<br />
      When the installer starts up it goes through these steps to select the interface language:<br />
      <br />
      1. Get user's default Windows UI language<br />
      2. Find a perfect match for the language<br />
      3. If there is no perfect match, find a primary language match<br />
      4. If there is no match, use the first language defined in the script (make sure your first language is a common one like English)<br />
      5. If the language variable $LANGUAGE has changed during .onInit, NSIS goes through steps 2 to 4 again.<br />
      <br />
      <u>In my experience</u>:<br />
      <br />
      1. The codepage is determined by the system language<br />
      2. You include language files<br />
      <br />
      !insertmacro MUI_LANGUAGE "Italian" ; default<br />
      !insertmacro MUI_LANGUAGE "English"<br />
      <br />
      The codepage is redefined to Italian on an Italian OS, English on an English OS, and Italian on a German OS. Italian, appearing first, is the default.<br />
      <br />
      3a. Insert the LangDLL macro in .onInit<br />
      <br />
      !insertmacro MUI_LANGDLL_DISPLAY<br />
      <br />
      The language dialog will display.<br />
      <br />
      3b. Alternatively ...<br />
      <br />
      ;Language selection dialog<br />
      <br />
      Push ""<br />
      Push ${LANG_Italian}<br />
      Push Italian<br />
      Push ${LANG_ENGLISH}<br />
      Push English<br />
      Push A<br />
      LangDLL::LangDialog "$(MESSAGE_INST_LANG_TITLE)" "$(MESSAGE_INST_LANG_INFO)"<br />
      Pop $LANGUAGE<br />
      StrCmp $LANGUAGE "cancel" 0 +2<br />
      Abort<br />
      <br />
      The language dialog will also display.<br />
      <br />
      4. You only want to display the language dialog if neither English, nor Italian are the Windows language.<br />
      <br />
      ${If} $LANGUAGE != 1033 ; English<br />
      ${AndIf} $LANGUAGE != 1040 ; Italian<br />
      !insertmacro MUI_LANGDLL_DISPLAY<br />
      ${EndIf}<br />
      <br />
      Will this display the language dialog on a German OS, but not on an Italian or English OS?<br />
      <br />
      It shouldn't. Remember, the installer's codepage was set to 1040, Italian.<br />
      <br />
      The installation obviously can't be in German because the German language file was never inserted.<br />
      <br />
      Is there a known method of displaying the language dialog on the German OS to let the user choose between installing in Italian or English, and skipping the language dialog, if the Windows UI language is Italian or English? In short, to get the system codepage 1031 (for German) before the installer redefines the codepage based on the included languages in the script?<br />
      <br />
      ---------<br />
      Note, I'm about to go trawling (on the forum/in the documentation) for an environment variable or system call that returns the user's system language. It would be much better, if the installer retained the original codepage, instead of redefining it.<br />
      ---------</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">CrushBug</span><br />
      <span class="post-time small text-muted">12th May 2010 18:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Animaether</small><br />
        Perhaps I missed something, but as far as I know, the only thing the LangDLL plugin does is to take the stack of UI text data, language IDs and strings, build a small UI from that with the UI text data and a dropdown, and return the chosen language when done.<br />
        <br />
        All of the actual language handling itself is unrelated to that part - and that part can certainly be set up using e.g. nsDialogs.. at which point you can add a bitmap or any other control.
      </blockquote>The Lang DLL plugin cannot do this (should be a language select image there):<br />
      <br />
      <a href="http://www.scratchpaper.com/home" target="_blank">http://www.scratchpaper.com/home</a><br />
      <br />
      We need to support English, French, German, Italian, Spanish, Czech, Hungarian, Polish and Russian. Lang select has to take place before GUI init and language isn't set there so we cannot set the text on the Lang DLL to Russian if we are on a Russian OS and see it display properly unless you change your code page for non-Unicode. This is a PITA for testing. What we want is a language select dialog similar to how Steam does its language selection, showing both the name of the language in the current OS language as well as the name of the language in its native language. Our Loc QA constantly ding us for the lack of full loc support in language select. For that, we are going to write our own Language select plug-in.<br />
      <br />
      Everything else you say is completely correct and is not a problem that we are having.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">12th May 2010 21:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by CrushBug</small><br />
        What we want is a language select dialog similar to how Steam does its language selection, showing both the name of the language in the current OS language as well as the name of the language in its native language.
      </blockquote>Well that's what I'm saying.. you should be able to do that using nsDialogs + the unicode build of NSIS of course, created as a separate installer executable, run with execwait from .onINit, and returning the value needed to select the language in .onInit.<br />
      <br />
      A plugin may be easier, of course, but I do think it can be done without :)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">CrushBug</span><br />
      <span class="post-time small text-muted">12th May 2010 21:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Animaether</small><br />
        Well that's what I'm saying.. you should be able to do that using nsDialogs + the unicode build of NSIS of course...
      </blockquote>We aren't allowed to use the Unicode build which is why we have to do it ourselves via a plug-in.<br />
      <br />
      It is the struggle that we have where we are limited in what we can and can not do with NSIS due to corporate regulations. NSIS is 90% of what we need with the power and flexibility to cover another 5-8% through our own plug-ins and funky scripting. The rest we just tell them we cannot do or conform to the rules. There are just a few things, that if changed in NSIS, would make it perfect for us. But we love what we have and are much happier with NSIS than our past battles with InstallShield and the like.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">12th May 2010 22:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by CrushBug</small><br />
        We aren't allowed to use the Unicode build which is why we have to do it ourselves via a plug-in.
      </blockquote>Ahhhhh... gotcha :) Yes, that would complicate matters vastly ;)<br />
      <br />
      Good luck with the plugin :)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">12th May 2010 23:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I would have used the existing LangDLL plug-in as a base (assuming you haven't already) or otherwise writen a new plug-in (as you are doing) or even just a standard Windows executable (a bit quicker to produce).<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
