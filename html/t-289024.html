<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Beginner Installer Help - Looks at Custom Pages, and Writing to Registry" />

  <title>Beginner Installer Help - Looks at Custom Pages, and Writing to Registry - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Beginner Installer Help - Looks at Custom Pages, and Writing to Registry</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=289024">Beginner Installer Help - Looks at Custom Pages, and Writing to Registry</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hungryOrb</span><br />
      <span class="post-time small text-muted">25th March 2008 12:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Beginner Installer Help - Looks at Custom Pages, and Writing to Registry</strong><br />
      <font color="firebrick">I realise this was written in a hasty manner, and I apologise for that. I'd like to update it where necessary over time, as I understand more about NSIS.<br />
      If anyone feels they need to correct or insert any info then please post and I'll get to it, or simply write it as an extension of this.<br />
      <br />
      Most of what I've learnt is thanks to Cheryll, RedWine, and AfrowUK. Thanks guys (means girls too ofc!) :)</font><br />
      <br />
      ===================================================<br />
      <i><font color="silver">(Based from my experience alone, which is very limited :shock: , and some help I received.) There is no surety whatsoever in believing this is the correct way of doing things, and even more folly is to believe that all of it is 100% correct. keke.</font></i><br />
      <br />
      Basic NSIS Guide to creating a simple installer Manual can be found <a href="http://nsis.sourceforge.net/Docs/" target="_blank">here</a>.<br />
      <br />
      <br />
      1) Download the latest HM NIS Edit from <a href="http://hmne.sourceforge.net/" target="_blank">Sourceforge</a>.<br />
      <br />
      2) Run the Script Wizard, inputting your application's details where appropriate. If you find something you are unsure of, leave the default unchanged. When you reach the 'Application Files' section, you'll want to separate your application's main folder of files into ones that are going into different directories. Sub-folders wouldn't matter here, so for example, your application and its files would go in one section appropriately titled, and the system files that the app runs would go under another section aimed at installing to Windows\System folder. The rest of the options are very simple, so when ready go ahead and finish the script wizard.<br />
      <br />
      3) Peruse the script, and try to make sense of the general layout. Typically !defines go first which are referred to at different parts of the installer by name. A define that looks like this for example:<br />
      <br /></p>
      <pre>
<code>!define PRODUCT_NAME "My application"</code>
</pre><br />
      <br />
      Is going to add your application name to the PRODUCT_NAME variable, and can be referred to as:<br />
      <br />
      <pre>
<code>${PRODUCT_NAME}</code>
</pre><br />
      <br />
      After !defines you'll generally find MUI instructions which refer to the MUI.nsh file (This MUI.nsh file needs to be included via the !include "MUI.nsh" call, usually at the start of the script), which holds useful lines of code that call certain installer pages. Next are some simple install options that you just checked or entered while in the wizard. Then we have the Sections, which include setting up the Start menu .lnk's, and partially representing the 'Application Files' section that you worked through in the wizard.<br />
      The uninstall sections come next with consistently mostly self-explaining commands that will initiate deletes, message boxes and registry edits, and others. Obviously, when dealing with these uninstaller commands, we are editing the script of the uninstaller executable.<br />
      <br />
      Try to order your sections and commands in the order that you want them to happen, (duh? wasn't obvious to me in the beginning though xD ) this means that your first page (perhaps your welcome page) would go in front of all other page commands.<br />
      <br />
      ---<br />
      <br />
      A little about Registry and Custom Pages<br />
      Adding values to registry via user inputted variables can be relatively simple. In creating my first installer, I used a custom page that asked the user for a couple of details. The Custom Page was defined as a function in the script, and when the Function ended, the values left on the page were added to the registry. These are the elements that make up the custom page and it's details:<br />
      <br />
      1) First in the script there are the variables that are declared, this can be anywhere before they are used. They look as simple as this:<br />
      <br />
      <pre>
<code>var Username<br />var Password</code>
</pre><br />
      <br />
      2) Then we make the custom page's aesthetics by clicking the "New Install Options File" under the File menu in HM NIS Edit. On this sheet we can simply click a form element from the right menu's icons and click on the sheet where we'd like the element to appear. Make sure you note down, or name the "FieldNum" value in each of your element's appropriately, because that will be our handle when taking the input from that element in the install script. Also, to set a default just enter what you'd like into the "State" box. You'll find both of these and the other values on the right after selecting a placed element.<br />
      Once you are happy with the page, save it as a .ini file and it's probably a good idea to put the .ini file in the same directory as your install script (.nsi).<br />
      <br />
      3) Next we must start the function that will be our custom page with an initialisation command:<br />
      <br />
      <pre>
<code><br />    Function .onInit<br />       !insertmacro MUI_INSTALLOPTIONS_EXTRACT_AS "login.ini" "login"<br />      Functionend<br /></code>
</pre><br />
      <br />
      Where login.ini is the name of your ini file. :shock:<br />
      <br />
      After which, we announce the page and set it's titles with something like this:<br />
      <br />
      <pre>
<code><br />      LangString CUSTOM_TITLE ${LANG_ENGLISH} "Enter your Login Details."<br />       LangString CUSTOM_SUBTITLE ${LANG_ENGLISH} " "<br />       Page custom LoginPage<br /></code>
</pre><br />
      <br />
      4) Our last group of code is the function itself, which displays the page, gets the values we want from the input boxes and does whatever it wants with them. It'll look something like this:<br />
      <br />
      <pre>
<code><br />    Function CustomPage<br /><br />       !insertmacro MUI_HEADER_TEXT "$(CUSTOM_TITLE)" "$(CUSTOM_SUBTITLE)"<br />       # Display the page.<br />       !insertmacro MUI_INSTALLOPTIONS_DISPLAY "Custom"<br /><br />       # Get the user entered values.<br />       !insertmacro MUI_INSTALLOPTIONS_READ $Username "Custom" "Field 1" "State"<br />       !insertmacro MUI_INSTALLOPTIONS_READ $Password "Custom" "Field 2" "State"<br />       !insertmacro MUI_INSTALLOPTIONS_READ $Server "Custom" "Field 3" "State"<br />       !insertmacro MUI_INSTALLOPTIONS_READ $Autoupdate "Custom" "Field 4" "State"<br />       !insertmacro MUI_INSTALLOPTIONS_READ $AUpdatePath "Custom" "Field 5" "State"<br />       <br />    WriteRegStr HKCU "Software\VB and VBA Program Settings\${PRODUCT_NAME}\Main" "MySQLUser" $Username ;As per install instruction file.<br />    WriteRegStr HKCU "Software\VB and VBA Program Settings\${PRODUCT_NAME}\Main" "MySQLPass" $Password<br />    WriteRegStr HKCU "Software\VB and VBA Program Settings\${PRODUCT_NAME}\Main" "MySQLADDR" $Server<br />    WriteRegStr HKCU "Software\VB and VBA Program Settings\${PRODUCT_NAME}\Main" "AutoUpdatePath" $AUpdatePath<br /><br />       ${If} $Autoupdate = 1 ;control is selected<br />       WriteRegStr HKCU "HKEY_CURRENT_USER\Software\VB and VBA Program Settings\${PRODUCT_NAME}\Main" "AutoUpdateEnable"="1"<br />       ${EndIf}<br />       ${If} $Autoupdate = 0 ;control isn't selected ... ._.<br />       WriteRegStr HKCU "HKEY_CURRENT_USER\Software\VB and VBA Program Settings\${PRODUCT_NAME}\Main" "AutoUpdateEnable"="0"<br />       ${EndIf}<br /><br />    FunctionEnd<br /></code>
</pre><br />
      <br />
      We are simply putting the input box values in variables, then putting the variable values into the registry. The last couple of statements use the 'LogicLib.nsh' which extends NSIS to be able to use If's/EndIf's and others. Must be included at beginning of script. What is added to the registry here, is going to stay in the registry unless the keys are deleted in the uninstaller. If you want them to be deleted, then simply delete them using a command similar to this:<br />
      <br />
      <pre>
<code><br />    DeleteRegValue HKCU "Software\VB and VBA Program Settings\${PRODUCT_NAME}\Main" "MySQLUser"<br /></code>
</pre><br />
      <br />
      And that's it!<br />
      <br />
      ---
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">25th March 2008 15:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've noticed before on another thread that you can't get users input within custom page create function, you have to do it within custom page leave function.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
