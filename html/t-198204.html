<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Previous installation directory" />

  <title>Previous installation directory - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Previous installation directory</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=198204">Previous installation directory</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RiteshN</span><br />
      <span class="post-time small text-muted">3rd November 2004 07:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Previous installation directory</strong><br />
      &nbsp; Hello,<br />
      <br />
      I have an app called XXX.<br />
      <br />
      Using NSIS, I have installing it in \Program File\XXX.<br />
      <br />
      Now we are coming out with two editions of XXX. XXX Enterprise and simple XXX.<br />
      <br />
      I am creating the installer using NSIS (version I am not sure but if required i can download NSIS 2.02). Now I want to check whether \Program Files\XXX exists or not. If it exists then I would like to install both Enterprise and Basic version in XXX otherwise I would like to install in \Program Files\XXX Enterprise or \Program Files\XXX Basic whichever the case maybe?<br />
      <br />
      How can I check whether \XXX exists and how to go about with it?<br />
      <br />
      Regards,<br />
      RiteshN</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">3rd November 2004 08:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Read NSIS Help description of:<br />
      InstallDir<br />
      InstallDirRegKey<br />
      and use something like this<br />
      WriteRegStr HKCU "${REG_PATH}" "${INST_DIR}" "$INSTDIR"</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RiteshN</span><br />
      <span class="post-time small text-muted">3rd November 2004 12:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry but I am still confised. I read the docs but I am unable to understand how to replace current installation.<br />
      <br />
      This is a required part from my current nsis script:<br />
      <br /></p>
      <pre>
<code>
HM NIS Edit Wizard helper defines
<br />&gt;!define PRODUCT_NAME "XXX"
<br />&gt;!define PRODUCT_VERSION "1.0"
<br />&gt;!define PRODUCT_PUBLISHER "Me"
<br />&gt;!define PRODUCT_WEB_SITE "http://www.me.com"
<br />&gt;!define PRODUCT_DIR_REGKEY "Software\Microsoft\Windows\CurrentVersion\App Paths\xxx.exe"
<br />&gt;!define PRODUCT_UNINST_KEY "Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}"
<br />&gt;!define PRODUCT_UNINST_ROOT_KEY "HKLM"
<br /><br />&gt;Name "${PRODUCT_NAME} ${PRODUCT_VERSION}"
<br />&gt;OutFile "G:\\output\\xxx.exe"
<br />&gt;InstallDir "$PROGRAMFILES\${PRODUCT_NAME}"
<br />&gt;InstallDirRegKey HKLM "${PRODUCT_DIR_REGKEY}" ""
<br />&gt;ShowInstDetails show
<br />ShowUnInstDetails show 
<br />&gt;
</code>
</pre>as I see in my new scripty I will have something like the following:<br />
      <br />
      <pre>
<code>
HM NIS Edit Wizard helper defines
<br />&gt;!define PRODUCT_NAME "XXX Enterprise"
<br />&gt;!define PRODUCT_VERSION "2.0"
<br />&gt;!define PRODUCT_PUBLISHER "Me"
<br />&gt;!define PRODUCT_WEB_SITE "http://www.me.com"
<br />&gt;!define PRODUCT_DIR_REGKEY "Software\Microsoft\Windows\CurrentVersion\App Paths\xxxent.exe"
<br />&gt;!define PRODUCT_UNINST_KEY "Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}"
<br />&gt;!define PRODUCT_UNINST_ROOT_KEY "HKLM"
<br /><br />&gt;Name "${PRODUCT_NAME} ${PRODUCT_VERSION}"
<br />&gt;OutFile "G:\\output\\xxxent.exe"
<br />&gt;InstallDir "$PROGRAMFILES\${PRODUCT_NAME}"
<br />&gt;InstallDirRegKey HKLM "${PRODUCT_DIR_REGKEY}" ""
<br />&gt;ShowInstDetails show
<br />ShowUnInstDetails show 
<br />&gt;
</code>
</pre>But I am unable to understand where to check whether XXX is already installed then use the current installation directory otherwise use "$PROGRAMFILES\${PRODUCT_NAME}" i.e. XXX Enterprise or XXX Basic.<br />
      <br />
      A sample script will be very helpful.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">3rd November 2004 13:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">1. Use correct registry paths with slashes<br />
      !define PRODUCT_DIR_REGKEY "Software\Microsoft\Windows\CurrentVersion\App Pathsxxx.exe"<br />
      The same for uninst key.<br />
      <br />
      2. Try to read this value from registry at the beginnig of installation. If this is first installation you will get error. For example<br />
      ReadRegStr $0 HKLM "${PRODUCT_DIR_REGKEY}" ""</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RiteshN</span><br />
      <span class="post-time small text-muted">3rd November 2004 13:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        1. Use correct registry paths with slashes<br />
        !define PRODUCT_DIR_REGKEY "Software\Microsoft\Windows\CurrentVersion\App Pathsxxx.exe"<br />
        The same for uninst key.
      </blockquote>I am using slashes but when I pasted it as code out here, the board didnt like it :)<br />
      <br />

      <blockquote>
        Try to read this value from registry at the beginnig of installation. If this is first installation you will get error. For example<br />
        ReadRegStr $0 HKLM "${PRODUCT_DIR_REGKEY}" ""
      </blockquote>OK. understood a little. But how do I handle the error and proceed?<br />
      <br />
      Thanks for your patience.<br />
      <br />
      Regards,<br />
      Karam
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">3rd November 2004 13:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">MessageBox, Abort.<br />
      <br />
      Use [code] not [php]<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RiteshN</span><br />
      <span class="post-time small text-muted">3rd November 2004 14:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I will try to make myself more clear.<br />
      <br />
      In my previous script i had:<br />
      <br /></p>
      <pre>
<code><br />!define PRODUCT_NAME "XXX"<br />!define PRODUCT_VERSION "1.0"<br />PRODUCT_DIR_REGKEY "Software\Microsoft\Windows\CurrentVersion\App Paths\XXX.exe"<br />!define PRODUCT_DIR_REGKEYENT "Software\Microsoft\Windows\CurrentVersion\App Paths\XXX.exe"<br />!define PRODUCT_UNINST_KEY "Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}"<br />!define PRODUCT_UNINST_ROOT_KEY "HKLM"<br /><br />Name "${PRODUCT_NAME} ${PRODUCT_VERSION}"<br />OutFile "G:\output\xxx.exe"<br />InstallDir "$PROGRAMFILES\${PRODUCT_NAME}"<br />InstallDirRegKey HKLM "${PRODUCT_DIR_REGKEY}" ""<br />ShowInstDetails show<br />ShowUnInstDetails show<br /></code>
</pre><br />
      <br />
      This means by default it will install XXX in \\Program Files\\XXX folder or if the user changes it while installation. In the registry, the uninstallation folder is also kept as \\Program Files\\XXX. I have been creating upgrades to my app in the same way. Therefore if a user upgraded then NSIS automatically detected the previous installation. I think it was due to the fact that my product name was always XXX till now.<br />
      <br />
      Now I am having two editions: XXX and XXX Enterprise. As I see, I wont have any problems with XXX as it will recoginise the previous installation.<br />
      <br />
      I am having difficulty with XXX Enterprise. If I put the PRODUCT_NAME as XXX Enterprise, it is doing a complete new installation even if XXX is installed before i.e. \\Program Files\\XXX Enterprise coz it is not matching with XXX.<br />
      <br />
      Also, the binary name has changed from XXX to XXXEnt.exe so the shortcut in the program menu also needs to be changed.<br />
      <br />
      Hope this sheds more light on the matter.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RiteshN</span><br />
      <span class="post-time small text-muted">3rd November 2004 14:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Afrow UK</i><br />
        <b>MessageBox, Abort.<br />
        <br />
        Use [code] not [php]<br />
        <br />
        -Stu</b>
      </blockquote>I dont want to abort. Gives wrong impression to the user :(
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">3rd November 2004 14:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>
      <pre>
<code>Function .onInit<br /> Push $R0<br /><br /> ReadRegStr $R0 "Software\Microsoft\Windows\CurrentVersion\App Paths\XXX.exe" ""<br /> StrCmp $R0 "" +3<br />  MessageBox MB_OK "${PRODUCT_NAME} already installed"<br />   Abort<br /><br /> Pop $R0<br />FunctionEnd</code>
</pre><br />
      <br />
      Is that the general thing you want?<br />
      <br />
      -Stu
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RiteshN</span><br />
      <span class="post-time small text-muted">3rd November 2004 15:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">No.<br />
      <br />
      What I want is that if XXX is installed then XXX Enterprise also gets installed in same directory as XXX otherwise, it should do a new installation as XXX Enterprise.<br />
      <br />
      Therefore, I have to basically change the installation directory during the installation process :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">3rd November 2004 15:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That is already the default behavour.<br />
      If no registry value is found for InstallDirRegKey then the InstallDir value is used instead.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RiteshN</span><br />
      <span class="post-time small text-muted">3rd November 2004 16:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am aware of this feature and it works great for me.<br />
      <br />
      My problem is that with XXX Enterprise, my product name is XXX Enterprise and it being first release will never be present in anybodys computer. It will always create a new one. What I want is that if it finds XXX (which was being used till date) then it should install in XXX folder rather XXX Enterprise as it will happen normally.<br />
      <br />
      I guess - I am not able to make myself clear.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">3rd November 2004 17:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">So why doesn't this work?<br />
      <br /></p>
      <pre>
<code>InstallDirRegKey HKCU "Software\Microsoft\Windows\CurrentVersion\App Paths\XXX.exe" ""<br />InstallDir "C:\Program Files\XXX Enterprise"</code>
</pre><br />
      <br />
      -Stu
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RiteshN</span><br />
      <span class="post-time small text-muted">4th November 2004 08:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Nope. It dosnt work.<br />
      <br />
      Here is a sample of my nsi:<br />
      <br /></p>
      <pre>
<code><br />!define PRODUCT_NAME "XXX Enterprise"<br />!define PRODUCT_VERSION "4.0 RC 1"<br />!define PRODUCT_PUBLISHER "MyCompany"<br />!define PRODUCT_WEB_SITE "http://www.me.com"<br />!define PRODUCT_DIR_REGKEY "Software\Microsoft\Windows\CurrentVersion\App Paths\XXXEnt.exe"<br />!define PRODUCT_UNINST_KEY "Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}"<br />!define PRODUCT_UNINST_ROOT_KEY "HKLM"<br /><br />...<br />...<br /><br />InstallDir "$PROGRAMFILES\${PRODUCT_NAME}"<br />InstallDirRegKey HKCU "Software\Microsoft\Windows\CurrentVersion\App Paths\XXX.exe" ""<br /></code>
</pre><br />
      <br />
      In this case even if my previous version of XXX was installed, by the default the installation directory is always shown to be XXX Enterprise. I want to keep it XXX if XXX is installed.<br />
      <br />
      BTW, the following code:<br />
      <br />
      <pre>
<code><br />CreateShortCut "$SMPROGRAMS\${PRODUCT_NAME}\XXXEnt.lnk" "$INSTDIR\XXXEnt.exe"<br /></code>
</pre><br />
      <br />
      is also not creating creating a menu under All Programs. Am I doing something wrong as it was previously working?
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>