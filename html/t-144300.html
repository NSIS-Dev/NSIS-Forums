<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Refreshing the desktop background - possible?"><title>Refreshing the desktop background - possible? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Refreshing the desktop background - possible?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=144300">Refreshing the desktop background - possible?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Nebulus</span><br><span class="post-time small text-muted">1st August 2003 03:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Refreshing the desktop background - possible?</strong><br>Ok, I'm making an installer for an embeded flash desktop, which is basically a very formatted HTML page with a flash file in it. When set to the desktop background, it can make for some very nice desktop apps.<br><br>Anyway, I can edit the registry entry for the wallpaper, and I can get the files into %systemroot%\web\wallpaper like they need to be. However, just setting the registry value isn't enough - the desktop background has to be refreshed.<br><br>Has anyone done this, or do you know how to? Any help would be appreciated. Thanks!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">1st August 2003 13:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You could do a Reboot, or you could use the System DLL.<br>I'd help you but I don't know where to start [System DLL side] :p<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">1st August 2003 13:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">There is a "Change resolution" Plugin on the <a href="http://nsis.sourceforge.net/archive/download.php" target="_blank">NSIS Archive downloads page</a>.<br>Maybe that could help (source)<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Nebulus</span><br><span class="post-time small text-muted">1st August 2003 13:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks, I'll check it out!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">1st August 2003 14:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I have found the solution here:<br><a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=71924&amp;highlight=desktop" target="_blank">http://forums.winamp.com/showthread....hlight=desktop</a><br><br>-Stu :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Nebulus</span><br><span class="post-time small text-muted">1st August 2003 14:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Nah, I tried that as well. Like that thread mentions, the desktop refreshes, but the active desktop/wallpaper doesn't update. This is a weird thing that I just don't get. Any reason the deasktop refreshes without sending an update to the wallpaper/active desktop?<br><br>Thanks for the help!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">1st August 2003 14:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hmm looking at my Registry, once the string setting the path to my desktop image is changed, I have to go to desktop properties to apply it.<br><br>I think that a while ago, somone wrote a System dll call which opened up the desktop properties dialog box...<br><br>Try searching for that<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">1st August 2003 14:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok, this should open desktop properties<br><br>ExecShell open "rundll32.exe shell32.dll,Control_RunDLL desk.cpl,,3"<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Nebulus</span><br><span class="post-time small text-muted">1st August 2003 15:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If NSIS can exec an external vbscript, I've got the answer.<br><br>I did have the script writing to the registry and refreshing the desktop, but it just wasn't updating to display the new page. this code does it. To test, just create a dummy HTML page and set it in your %systemroot%\web\wallpaper directory, then change the script to point to the correctly named page.<br><br>Running the script will set the desktop, open the display properties window, move the selection up/down, then click the OK button. It's dirty, but it gets done!<br><br>****************************************<br>BEGIN CODE<br>****************************************<br>' Create the variables needed<br>Dim WSHShell<br>Dim WSHApp<br>Dim strRegKey<br>Dim strWallpaper<br>Dim strOSRoot<br>Dim strDesktop<br>Dim strDisplayProp<br><br>' Create the Wscript Shell object<br>Set WSHShell = WScript.CreateObject("WScript.Shell")<br>Set WSHApp = CreateObject("Shell.Application")<br><br>' Define the wallpaper<br>strWallpaper = "%SystemRoot%\Web\Wallpaper\PRWeb.html"<br>strDesktop = WSHShell.SpecialFolders("Desktop")<br>strDisplayProp = "Display Properties"<br><br>' Create the wallpaper key<br>strRegKey = "HKEY_CURRENT_USER\"<br>strRegKey = strRegKey &amp; "Software\"<br>strRegKey = strRegKey &amp; "Microsoft\"<br>strRegKey = strRegKey &amp; "Internet Explorer\"<br>strRegKey = strRegKey &amp; "Desktop\"<br>strRegKey = strRegKey &amp; "General\"<br>strRegKey = strRegKey &amp; "Wallpaper"<br><br>' Write the key, type, and value<br>WSHShell.RegWrite strRegKey, strWallpaper, "REG_EXPAND_SZ"<br><br>WSHApp.ControlPanelItem cstr("desk.cpl")<br>Do Until WSHShell.AppActivate (strDisplayProp)<br>Loop<br>WSHShell.SendKeys "{down}{up}{tab 3}a~"<br>****************************************<br>END CODE<br>****************************************</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">1st August 2003 15:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If the vb script is compiled into a basic command-line program, then you can use<br><br>nsExec::Exec "path_to\myvbapp.exe"<br><br>to execute it unseen.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">1st August 2003 15:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Btw, that topic you posted in was created before NSIS 2.0b0 came out :)<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Nebulus</span><br><span class="post-time small text-muted">1st August 2003 15:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Cool, so it could exec the vbs - as long as the user has windows scripting host installed....<br><br>Is there a function out there for NSIS that'll check for that?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">1st August 2003 15:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This may be useful:<br><br><a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=162" target="_blank">http://nsis.sourceforge.net/archive/...php?pageid=162</a><br><br>-Stu</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>