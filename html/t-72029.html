<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="1.94 Uninstaller problem."><title>1.94 Uninstaller problem. - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">1.94 Uninstaller problem.</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=72029">1.94 Uninstaller problem.</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Pomflain</span><br><span class="post-time small text-muted">15th January 2002 17:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>1.94 Uninstaller problem.</strong><br>I've got a portion of code which reads the old registry and prompts to uninstall the old version if it's found. Been using this since 1.61. It was fine with 1.91, but I just installed 1.94. Now it says "Error initializing uninstaller," when it tries to run the unistaller executable. It gets this information from the registry key like this:<br><br>ReadRegStr $9 HKEY_LOCAL_MACHINE "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\${PROGNAME}" "UninstallString"<br><br>ClearErrors<br><br>Sleep 500<br>Exec "$9"<br>IfErrors DisplayMsgBox Fin<br><br>Just noticed it when I tried to uninstall a 1.94 built version, but it didn't happen with the version that I last built, which was with 1.91.<br><br>Thanks.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Pomflain</span><br><span class="post-time small text-muted">17th January 2002 20:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Ok.</strong><br>This problem seems to have cropped up in version 1.80. No problems with 1.70, but anything later than 1.80 and it happens.<br><br>I've also noticed this odd UDebugOut.default which is always 0 bytes and has a somewhat random date. Not sure if that's related, but I can't use any of these later versions because I need to be able to spawn off the uninstaller from within an installer. It would be nice if that was a standard option built into the compiler, but I'll be perfectly happen if this can be fixed so it works ok again.<br><br>Thanks.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rainwater</span><br><span class="post-time small text-muted">17th January 2002 20:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Don't you need to use ExecWait instead of Exec, to wait for the uninstaller to finish?<br><br>Since all you are really doing is running the uninstaller exe, that would mean that the uninstaller is not working correctly. Maybe you built the program with a version of NSIS that had a bug in the uninstaller.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Pomflain</span><br><span class="post-time small text-muted">17th January 2002 21:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Well..</strong><br></p><blockquote><i>Originally posted by rainwater</i><br><b>Don't you need to use ExecWait instead of Exec, to wait for the uninstaller to finish?<br><br>Since all you are really doing is running the uninstaller exe, that would mean that the uninstaller is not working correctly. Maybe you built the program with a version of NSIS that had a bug in the uninstaller.</b></blockquote>Yeah, I can try that. I wrote all that stuff 5 or 6 months ago and I know that ExecWait didn't do anything as far as having the uninstaller run first. I'd prefer that behavior because occasionally someone will switch off the installer/uninstaller and then come back and run the installer first and the the uninstaller after and obviously you know what happens. I'll try switching over to ExecWait, but I don't think that's the problem. Long time ago heard someone say something about rundll32 being part of it because on the 9x kernel and ME the uninstaller will almost always fail to launch in the fashion, but it works if you do it "normally." Just need to have that check in there. Tell all the users to make sure to go to the control panel and uninstall the app first, but I also put that check in there again because I know that many of them won't uninstall it first. I'll let you know what happens.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rainwater</span><br><span class="post-time small text-muted">17th January 2002 21:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can always put the uninstaller stuff in your installer. Make a required section that checks for the program and then remove, modify whatever you need to do.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Pomflain</span><br><span class="post-time small text-muted">17th January 2002 21:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hmm, yeah that "fixed" the problem. It doesn't wait until the uninstaller finishes, so the behavior is still the same, but it fixed the error with it says the uninstaller can't initialize. So it appears to be a problem with ExecShell in 1.80+ versions.<br><br>Thanks.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Pomflain</span><br><span class="post-time small text-muted">17th January 2002 21:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Ok that wasn't too smart...</strong><br>You're probably wondering why I'm talking about ExecShell when the code says Exec above. I pasted in the wrong portion, the portion I pasted is for the 9x/ME versions where if the installer fails with ExecShell I have it sleep and try with Exec instead.<br><br>Function .onInit<br><br>ClearErrors<br><br>ReadRegStr $9 HKEY_LOCAL_MACHINE "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\${PROGNAME}" "UninstallString"<br>StrCmp $9 "" Clean PrevInst<br><br>Clean:<br>Goto InitDone<br><br>PrevInst:<br><br>ReadRegStr $8 HKEY_LOCAL_MACHINE "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\${PROGNAME}" "DisplayName"<br>MessageBox MB_YESNO "$8 found$\nUninstall this version?" IDNO InitDone<br>;ExecShell "open" "$9" SW_SHOWNORMAL<br>ExecWait "$9"<br>;Abort ; causes installer to quit.<br><br>IfErrors InstErr InitDone<br>InstErr:<br>Call FailedUninst<br><br>InitDone:<br>FunctionEnd<br><br>That's what I had and as you can see I took out the ExecShell line and changed it to ExecWait and that fixed that portion of the problem.<br><br>Sorry about that...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Pomflain</span><br><span class="post-time small text-muted">18th January 2002 00:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Another issue I just noticed...</strong><br>Just noticed this, when the uninstaller finishes, I have it attempt to delete the directory where the files were installed. I then have it try to delete the parent directory. I've always known RMDir to fail if there are files or other directories nested inside the current directory. The reason for attempting to delete the parent directory is because all the apps I have go into their own directory and if you no longer had an of the apps installed, it should delete the main directory so everything is gone.<br><br>Anyway, I just noticed that it's no longer wanting to delete the current directory. So, I put in a messagebox to see if the variable was messed up some how, and it wasn't. However, when I do that it correctly deletes the directory. So I tried putting in a sleep instead, but that didn't work either. Any ideas on this problem?<br><br>Thanks.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>