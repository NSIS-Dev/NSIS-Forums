<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Code to install an application in user mode(Limited privilege)" />

  <title>Code to install an application in user mode(Limited privilege) - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Code to install an application in user mode(Limited privilege)</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=330063">Code to install an application in user mode(Limited privilege)</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">balamdu01</span><br />
      <span class="post-time small text-muted">27th April 2011 05:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Code to install an application in user mode(Limited privilege)</strong><br />
      I am having an installer that will install the application only in the admin mode. If i try to install in user mode(Limited privilege), then it is saying that "you are not having administrator privilege to install this". But i want to install the application in user mode. Can anyone please tell me how to code in NSIS to install the application in user mode.<br />
      Thanks in advance.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">27th April 2011 06:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Use the UserInfo plugin in .onInit:<br />
      <br />
      UserInfo::GetAccountType<br />
      Pop $1<br />
      ${If} $1 == "Admin"<br />
      StrCpy $ACCESSLEVEL "Admin"<br />
      SetShellVarContext all<br />
      ${Else}<br />
      StrCpy $ACCESSLEVEL "NotAdmin"<br />
      SetShellVarContext current<br />
      ${EndIf}<br />
      <br />
      And then in the rest of your script you can use that variable to determine what code should be executed.<br />
      Note: For userlevel installs, the default installpath should be $LOCALAPPDATA\YourPath.<br />
      Note: If you want the user to be able to choose a different direction, you'll need to check for sufficient access privileges in the selected directory. (see here: <a href="http://forums.winamp.com/showthread.php?t=317018" target="_blank">http://forums.winamp.com/showthread.php?t=317018</a> ).<br />
      Note: If you don't want to use that, you'll probably need to skip the DIRECTORY page and force $LOCALAPPDATA as install dir.<br />
      Note: By setting SetShellVarContext in the above If Else code, you can use WriteRegStr <b>SHCTX</b> "software\etc" for both admin and userlevel registry commands</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">balamdu01</span><br />
      <span class="post-time small text-muted">27th April 2011 14:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">My product is having third party tools like JRE , Flash player , .. etc.. which requires only admin mode to install these software's. The above code is not working while installing the third party tools.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">balamdu01</span><br />
      <span class="post-time small text-muted">27th April 2011 14:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am having an installer that will install the application only in the admin mode. If i try to install in user mode(Limited privilege), then it is saying that "you are not having administrator privilege to install this".My application has third party tools(Supporting softwares) like JRE , Flashplayer , .. etc. But i want to install the application in user mode. Can anyone please tell me in detail how to code in NSIS to install the application in user mode .<br />
      Thanks in advance.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Highcoder</span><br />
      <span class="post-time small text-muted">27th April 2011 15:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>...</strong><br />
      You can´t install these 3rd party apps in usermode. There is no way around. You need adminrights.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">balamdu01</span><br />
      <span class="post-time small text-muted">27th April 2011 15:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the reply. I can install <b>Microsoft Office</b> in <b>User mode(Limited privilege)</b>.It will ask Admin password.After entering the password, It will install in the user mode with admin privilege. My requirement is like this.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Highcoder</span><br />
      <span class="post-time small text-muted">27th April 2011 15:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>...</strong><br />
      Ah ok... i know what you want. But if you need adminrights for the 3rd party apps anyway why don´t you install your app with adminrights too? Do your app really NEED a userlevel install? Beacuse it would be much easier that way.<br />
      <br />
      For Win Vista/7 (with UAC on) add following line to your code:<br />
      <br />
      <b>RequestExecutionLevel admin</b><br />
      <br />
      and to ensure that the user have adminrights use the code from MSG in the .onInit function and have a look to the notes he wrote.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br />
      <span class="post-time small text-muted">27th April 2011 15:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.1.32" target="_blank">http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.1.32</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">balamdu01</span><br />
      <span class="post-time small text-muted">2nd May 2011 11:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you all for your notes and references.<br />
      <br />
      We have decided not to install our app in User mode (Limited Privilege) and will only install in Admin mode. Here the install of our s/w and the associated 3rd party tools goes off fine.<br />
      <br />
      However, I am facing a new problem. Our customers SHOULD have the option of running the app in User mode (after installing in Admin mode).<br />
      <br />
      If the app is installed in C:\Program Files, then it doesnt work in User mode (it works alright in Admin mode). I have noticed that if the app is installed in another path say D:\ then it works alright.<br />
      <br />
      Question - Why does this happen ? How is it possible to overcome this problem ?<br />
      <br />
      Thank You</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">2nd May 2011 11:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">In what way does it not work? Is your application trying to write to that folder?<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">balamdu01</span><br />
      <span class="post-time small text-muted">2nd May 2011 12:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the reply.<br />
      Yes. we are writing text file (.txt files) in that path.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Highcoder</span><br />
      <span class="post-time small text-muted">2nd May 2011 15:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>...</strong><br />
      This is (and always was) a bad idea. But you´re not the only one who does this mistake.<br />
      Apps should store files they want to write into (like configfiles etc.) in %APPDATA% and NOT in %PROGRAMFILES%. That is not a new fact but in the past many programmers don´t care about. Most incompatibilities of older programs running under vista/7 are related to this design fault.<br />
      <br />
      Program -&gt; %PROGRAMFILES%<br />
      configfiles (files that need write access in usermode) -&gt; %APPDATA%</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
