<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="NSISArray sort function" />

  <title>NSISArray sort function - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">NSISArray sort function</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=232330">NSISArray sort function</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">johnny44</span><br />
      <span class="post-time small text-muted">1st December 2005 19:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>NSISArray sort function</strong><br />
      I just started working with arrays and I'm having problems with the sort function. It simply doesn't sort! before posting here I decided to look at the examples provided with the plugin and even the sort.nsi script provided doesn't do anything. The debug screen before and after</p>
      <pre>
<code>${TestArray-&gt;Sort} ""</code>
</pre>are exactly the same.<br />
      <br />
      Has anyone had this problem?<br />
      Thanks for your help.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">1st December 2005 20:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's been a while since I last modified the sort function but last time I checked it worked.<br />
      I'll have a look.<br />
      <br />
      Edit: You are correct. The sort function is broken, and it was broken when new code was added to sort one array by another.<br />
      I'll upload v0.9 soon.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">johnny44</span><br />
      <span class="post-time small text-muted">1st December 2005 20:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's in my .onInit Function, can it go there or should it be used only in sections?<br />
      <br />
      Sort2Arrays.nsi seems to work....weird, the code is pretty much the same......</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">1st December 2005 21:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Uploaded.<br />
      <a href="http://nsis.sourceforge.net/File:NSISArray.zip" target="_blank">http://nsis.sourceforge.net/File:NSISArray.zip</a><br />
      <br />
      You may have noticed (or not) that the Sort function was falsely throwing the "(3) Index out of range." error message (which you'd find by checking the $ArrayErr variable). This told me exactly where the problem was thankfully.<br />
      The function throws this error message when using two sorting arrays and when the two arrays are not equal in size.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">johnny44</span><br />
      <span class="post-time small text-muted">1st December 2005 21:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Works great! you're quick!<br />
      <br />
      I'd also like to know if the arrays are limited to 32 columns? I tried setting the size to larger numbers, but it seems limited to 32.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">1st December 2005 23:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">See section <b>1.10 Array sizes</b> in the documentation (Docs\NSISArray\)<br />
      If you would like a custom sized arrays plugin build and don't have the tools then let me know.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">johnny44</span><br />
      <span class="post-time small text-muted">2nd December 2005 15:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry....I read the readme until the function definitions. Didn't see 2 of the most important sections for me, array sizes and error messages. Mea culpa....<br />
      <br />
      As for custom Arrays, 256 items would be enough in my case, 128 is a bit short. I ain't no programmer and I don't have the tools to recompile so I'm gonna work with 128, unless it takes only 2 seconds for you to recompile for 256 items and 128 characters. That would be much appreciated.<br />
      <br />
      Could you also test the IsFull function? I tried using it and it never jumped to the full label. It's not major since I went around the problem using</p>
      <pre>
<code>StrCmp $ArrayErr "3" flush 0</code>
</pre><br />
      <br />
      Thanks to your help, my installer is now almost complete!
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">johnny44</span><br />
      <span class="post-time small text-muted">2nd December 2005 19:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry to bug you again Stu, but can you also check the ReadToStack function. The ReadToStack.nsi example does not seem to work. It looks like an empty string is popped from the stack. Nothing comes out when using range 0 -1 but with 0 3 I get a blank item in between each item:<br /></p>
      <pre>
<code><br />item 0:<br />item 1: one<br />item 2:<br />item 3:two<br /></code>
</pre><br />
      I looked at $ArrayErr and it holds the first item (zero).<br />
      <br />
      If I leave the range at 0 3 and place<br />
      <pre>
<code><br />!define ArrayErrorMsgBox<br /></code>
</pre><br />
      at the beginning, it works. If I change the range back to 0 -1 and leave the !define, I get error message (3)index out of range. I hope this helps you find the problem.<br />
      <br />
      Edit:<br />
      <br />
      Here's something else regarding the WriteList and WriteListC functions. I modified the Is.nsi example like this:<br />
      <pre>
<code><br />!define FuncName 'Is Functions'<br />name '${FuncName}'<br />outfile 'ArrayExample - ${FuncName}.exe'<br />caption '${FuncName}'<br />!define ArrayErrorMsgBox<br />!include NSISArray.nsh<br />showinstdetails show<br /><br />${Array} "TestArray"<br /><br />Section<br />  DetailPrint "Initializing array..."<br />  ${TestArray-&gt;Init}<br />  DetailPrint "Testing 'WriteList'..."<br />  ${TestArray-&gt;WriteList} "'a' 'b' 'c' 'd' 'e' 'f' 'g' 'h' 'i' 'j' 'k' 'l' 'm' 'n' 'o' 'p' 'q' 'r' 's' 't' 'u' 'v' 'w' 'x' 'y' 'z' '1' '2' '3' '4' '5' '6' '7' '8' '9' '0'"<br />  ${TestArray-&gt;Debug}<br />  ${TestArray-&gt;Concat} $0 "&amp;"<br />        DetailPrint "$0"<br />  DetailPrint "Testing 'IsEmpty'..."<br />  ${TestArray-&gt;IsEmpty} +2 0<br />  DetailPrint "TestArray is NOT empty!"<br />  DetailPrint "Testing 'IsFull'..."<br />  ${TestArray-&gt;IsFull} +2 0<br />  DetailPrint "TestArray is NOT full!"<br />  DetailPrint "Testing 'IsInRange'..."<br />  ${TestArray-&gt;IsInRange} 3 0 +2<br />  DetailPrint "Index of 3 is in range of TestArray!"<br />  DetailPrint "Testing 'IsInRange' again..."<br />  ${TestArray-&gt;IsInRange} 4 +2 0<br />  DetailPrint "Index of 4 is NOT in range of TestArray!"<br />  ${TestArray-&gt;Delete}<br />  ${ArrayUnload}<br />SectionEnd<br /><br />page instfiles<br /></code>
</pre><br />
      The WriteList and WriteListC functions do not seem to care about the 32 items limit. The debug screen shows all 36 items and all of them are passed to the concatenation function.<br />
      Notice that the IsFull function still shows up as non-full.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">2nd December 2005 23:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">My goodness. It appears that lstrcpy redimensions the array. In other words it doesn't matter what index of the array you write to... it will still be written. I wrote to an index of 99 of a 32 dimension array and the value that I wrote is returned when refering to that index.<br />
      <br />
      Therefore it seems that there is not limit to the number of items in the array. I'm now going to see if there's really a limit to the number of arrays that you can have.<br />
      <br />
      I've fixed all the other problems, but this appears to be even more major.<br />
      <br />
      Edit: In some cases it writes the data successfully, but in others either no data is written or the installer crashes. Therefore I'm going to stick to having fixed sized arrays like it should be (I'll make WriteList induce Index out of range error if there are too many items to be written).<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">2nd December 2005 23:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Done.<br />
      IsFull was failing because you wrote &gt;32 items to a 32 item array. IsFull does a less than or equal to comparison, not a greater than.<br />
      <a href="http://nsis.sourceforge.net/File:NSISArray.zip" target="_blank">http://nsis.sourceforge.net/File:NSISArray.zip</a><br />
      <br />
      Edit: What array dimensions would you like for your custom DLL. NSISArray is 32 x 1024 strings. NSISArray128 is 128 x 256 strings.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">johnny44</span><br />
      <span class="post-time small text-muted">5th December 2005 14:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Stu,<br />
      <br />
      The array size that would be best suited for my application is 256 items X 128 characters.<br />
      <br />
      I confirm that the IsFull function works great, but I'm still having problems with the ReadToStack example. If I don't modify anything I still get this<br /></p>
      <pre>
<code><br />Item 0:<br />Item 1: one<br />Item 2:<br />Item 3: two<br /></code>
</pre><br />
      When I change the range to 0 3 I get all empty strings. This is the opposite behavior from when I mentioned it to you in the first place.<br />
      <br />
      EDIT: **DELETED**<br />
      <br />
      EDIT2: My bad, !define ArrayPluginAll 128.[B]
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">5th December 2005 16:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry about that. Properly fixed now.<br />
      <br />
      <a href="http://nsis.sf.net/File:NSISArray.zip" target="_blank">http://nsis.sf.net/File:NSISArray.zip</a><br />
      <br />
      And here is the 256 x 128 build attached.<br />
      Simply use !define ArrayPluginAll 256 after placing the .dll in the Plugins folder.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">johnny44</span><br />
      <span class="post-time small text-muted">5th December 2005 17:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">great, I just think you forgot to attach the 256 X 128 build....</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">5th December 2005 18:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hmm, here it is.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">johnny44</span><br />
      <span class="post-time small text-muted">6th December 2005 14:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hey Stu, it's your favourite bugger again!<br />
      <br />
      Thanks for the 256X128 array plugin. I tried it and it seems to work except in some weird cases where the first item is corrupted in my second array. I didn't do much testing on it though and it might just be me so don't worry about it.<br />
      <br />
      My script is going well and now I am to the point where I need to find out if an item is alredy there. I'm using the SearchI function and there seems to be a problem with it. Only the first 3 characters are compared. If they match, it returns the first matching index value.<br />
      <br />
      Could you look into it? The Search function seems to do the same thing. Here's a test script:<br /></p>
      <pre>
<code><br />!define FuncName 'SearchI'<br />name '${FuncName}'<br />outfile 'ArrayExample - ${FuncName}.exe'<br />caption '${FuncName}'<br />!define ArrayNoValVar<br />!include NSISArray.nsh<br />!include StrFunc.nsh<br />showinstdetails show<br /><br />${StrTrimNewLines}<br />${Array} "TestArray"<br /><br /><br />Function .onInit<br />        GetTempFileName $R9<br />        FileOpen $R2 $R9 w<br />        FileWrite $R2 "Cat$\r$\n"<br />        FileWrite $R2 "catt$\r$\n"<br />        FileWrite $R2 "cate$\r$\n"<br />        FileWrite $R2 "catherine$\r$\n"<br />        FileWrite $R2 "CaDog$\r$\n"<br />        FileWrite $R2 "CaHippo$\r$\n"<br />        FileClose $R2<br />  CopyFiles /SILENT $R9 "animals.txt"<br />        Delete $R9<br />FunctionEnd<br /><br />Section<br />  DetailPrint "Initializing array.."<br />  ${TestArray-&gt;Init}<br />        FileOpen $R0 animals.txt r<br />Loop:<br />        ClearErrors<br />        FileRead $R0 $0<br />        IfErrors End<br />        Push $0<br />        Call StrTrimNewLines<br />        Pop $0<br />        DetailPrint "ArrayItem:$0"<br />        ${TestArray-&gt;SearchI} $1 "$0" 0<br />        DetailPrint "Index:$1"<br />        StrCmp $1 "-1" 0 same<br />        ${TestArray-&gt;Shift} "$0"<br />        Goto Loop<br />Same:<br />        DetailPrint "Item previously added"<br />        Goto Loop<br />End:<br />        DetailPrint "TestArray should contain:Cat, catt, cate, catherine, CaDog and CaHippo"<br />        ${TestArray-&gt;Debug}<br />  ${TestArray-&gt;Delete}<br />  ${ArrayUnload}<br />        FileClose $R0<br />        Delete "$EXEDIR\animals.txt"<br />SectionEnd<br /><br />page instfiles<br /></code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">6th December 2005 15:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'll take a look at it when I get home (2 hours from now). I wouldn't be suprised if there's an error because I wrote my own search procedures.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">johnny44</span><br />
      <span class="post-time small text-muted">6th December 2005 16:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I confirm the bug with !define ArrayPlugin 256.<br /></p>
      <pre>
<code><br />Name "WriteListC"<br />OutFile "WriteListC_test.exe"<br />Caption "$(^Name)"<br /><br />!define ArrayPlugin 256<br />!define ArrayNoValVar<br />!include NSISArray.nsh<br />${Array} SoftList<br />XPStyle on<br />ShowInstDetails show<br /><br />Section<br />  ${SoftList-&gt;Init}<br />  DetailPrint "Writing one, two, three..."<br />  ${SoftList-&gt;WriteListC} "one|two|three" "|"<br />  ${SoftList-&gt;Debug} <br />  ${SoftList-&gt;Delete}        <br />  ${ArrayUnload}<br />SectionEnd<br /></code>
</pre><br />
      This test script shows weird characters at the end of the first item. The problem appears when used with WriteListC only. The 128 plugin seems to have a similar behaviour in this test script .<b>EDIT: for the 128 plugin, only the first array has this problem. The second and subsequent arrays in your script will be fine.:</b> WriteList, Push and Shift work OK
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">6th December 2005 21:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here it is. Took longer than expected mainly because there was more work needed than expected.<br />
      <br />
      The strange characters appearing on the end of the strings were caused by stack corruption (I think that is the correct term). I was getting the end of the actual "WriteListC" function name appended to my first array item (so it was "oneListC")!<br />
      I've fixed this problem by using using static variables throughout instead, and by clearing the contents of each static variable when finished with.<br />
      This means the DLL's have increased in size a little (1KB) but all variables will be created when the function(s) are first ran, rather than every time they are ran.<br />
      <br />
      I've also fixed the Search and SearchI functions. The original code that I wrote was very dodgy (I must have been drunk or something!)<br />
      <br />
      I've also added a ${myArray-&gt;Print} instruction to the script header for debugging purposes.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">johnny44</span><br />
      <span class="post-time small text-muted">9th December 2005 17:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">My first version is complete and working!! I'm now integrating new features and modifying certain aspects. On the wishlist side of things....Back to the sort function:<br /></p>
      <pre>
<code><br />!define FuncName 'Sort'<br />name '${FuncName}'<br />outfile 'ArrayExample - ${FuncName}.exe'<br />caption '${FuncName}'<br />!define ArrayNoValVar<br />!include NSISArray.nsh<br />showinstdetails show<br /><br />${Array} "TestArray"<br /><br />Section<br />  DetailPrint "Initializing array..."<br />  ${TestArray-&gt;Init}<br />  ${TestArray-&gt;WriteList} "'1' '2' '3' '13' '21'"<br />  DetailPrint "Sorting..."<br />  DetailPrint "Now View the sorted version:"<br />  ${TestArray-&gt;Sort} ""<br />  ${TestArray-&gt;Debug}<br />  ${TestArray-&gt;Delete}<br />  ${ArrayUnload}<br />SectionEnd<br /><br />page instfiles<br /></code>
</pre><br />
      sorts in this order: (1, 13, 2, 21, 3) this is not really what we usually want for numbers. Is there any way you could modify this? That's about it for now.<br />
      <br />
      BTW, A HUGE thanks for making things work for me. I just could not believe how fast you answered my requests. I now have a working application and you played a major role in it. AfrowUK rules!!!
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">9th December 2005 18:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'll see what I can do. I think it's because it uses a string comparison rather than a proper number comparison.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
