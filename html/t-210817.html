<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Search for a File on entire System"><title>Search for a File on entire System - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Search for a File on entire System</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=210817">Search for a File on entire System</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">sreedhar_kumar</span><br><span class="post-time small text-muted">19th March 2005 08:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Search for a File on entire System</strong><br>Hi All,<br><br>I know that there is Code available for the following:<br><br><b>(1) Find what drives are available on a System.<br><br>(2) Search for a File in a particular Drive</b><br><br><br>Now I want to Search for a File in all Drives i.e. I want to integrate the above two programs.<br>How can I do that. (Please see the attached ZIP File for above 2 programs)<br><br><br>By the way, is there any code already available that can SEARCH FOR A FILE IN ALL THE AVAILABLE DRIVES AND GIVE THE LOCATION WHERE THE FILE WAS FOUND<br>(If such a Code is found, no need to integrate above 2 Programs).<br><br><br>Note: My requirement is to integrate above 2 programs and search for a File. Because it will search one Drive at a time. Help me in integrating both the programs.<br><br><br>Attaching the 2 Programs....<br><br><br><br>-Sreedhar</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sreedhar_kumar</span><br><span class="post-time small text-muted">19th March 2005 08:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Attachments didn't worked.<br>Sending the Code for 2 Programs......<br><br><br>*********GetDrives Program Begins Here******************<br>;This Program searches for all Drives located on your System.<br>OutFile "MyGetDrives.exe"<br><br>Function GetDrives<br>!define GetDrives `!insertmacro GetDrives`<br><br>!macro GetDrives _DRV _FUNC<br>Push $0<br>Push `${_DRV}`<br>GetFunctionAddress $0 `${_FUNC}`<br>Push `$0`<br>Call GetDrives<br>Pop $0<br>!macroend<br><br>Exch $1<br>Exch<br>Exch $0<br>Exch<br>Push $2<br>Push $3<br>Push $4<br>Push $5<br>Push $8<br>Push $9<br><br>System::Alloc 1024<br>Pop $2<br><br>StrCmp $0 '' 0 typeset<br>StrCpy $0 ALL<br>goto drivestring<br><br>typeset:<br>StrCpy $5 -1<br>IntOp $5 $5 + 1<br>StrCpy $8 $0 1 $5<br>StrCmp $8$0 '' enumex<br>StrCmp $8 '' +2<br>StrCmp $8 '+' 0 -4<br>StrCpy $8 $0 $5<br>IntOp $5 $5 + 1<br>StrCpy $0 $0 '' $5<br><br>StrCmp $8 'FDD' 0 +3<br>StrCpy $5 2<br>goto drivestring<br>StrCmp $8 'HDD' 0 +3<br>StrCpy $5 3<br>goto drivestring<br>StrCmp $8 'NET' 0 +3<br>StrCpy $5 4<br>goto drivestring<br>StrCmp $8 'CDROM' 0 +3<br>StrCpy $5 5<br>goto drivestring<br>StrCmp $8 'RAM' 0 typeset<br>StrCpy $5 6<br><br>drivestring:<br>System::Call 'kernel32::GetLogicalDriveStringsA(i,i) i(1024,r2)'<br><br>enumok:<br>System::Call 'kernel32::lstrlenA(t) i(i r2) .r3'<br>StrCmp $3$0 '0ALL' enumex<br>StrCmp $3 0 typeset<br>System::Call 'kernel32::GetDriveTypeA(t) i (i r2) .r4'<br><br>StrCmp $0 ALL +2<br>StrCmp $4 $5 letter enumnext<br>StrCmp $4 2 0 +3<br>StrCpy $8 FDD<br>goto letter<br>StrCmp $4 3 0 +3<br>StrCpy $8 HDD<br>goto letter<br>StrCmp $4 4 0 +3<br>StrCpy $8 NET<br>goto letter<br>StrCmp $4 5 0 +3<br>StrCpy $8 CDROM<br>goto letter<br>StrCmp $4 6 0 enumex<br>StrCpy $8 RAM<br><br>letter:<br>System::Call '*$2(&amp;t1024 .r9)'<br><br>Push $0<br>Push $1<br>Push $2<br>Push $3<br>Push $4<br>Push $5<br>Push $8<br>Call $1<br>Pop $9<br>Pop $8<br>Pop $5<br>Pop $4<br>Pop $3<br>Pop $2<br>Pop $1<br>Pop $0<br>StrCmp $9 'Stop' enumex<br><br>enumnext:<br>IntOp $2 $2 + $3<br>IntOp $2 $2 + 1<br>goto enumok<br><br>enumex:<br>System::Free $2<br><br>Pop $9<br>Pop $8<br>Pop $5<br>Pop $4<br>Pop $3<br>Pop $2<br>Pop $1<br>Pop $0<br>FunctionEnd<br><br>Section "GetDrivesSection"<br>${GetDrives} "HDD" "GetDrivesExample1"<br>SectionEnd<br><br>Function GetDrivesExample1<br>;MessageBox MB_OK "$9 ($8 Drive)"<br>MessageBox MB_OK "$9"<br>Push $0<br>FunctionEnd<br>**************GetDrives Program Ends Here*************<br><br><br>**************SearchFile Program Begins Here*********<br>; Feel free to change FileName and DriveName.<br>OutFile "MySearchFileExample.exe"<br><br>Section "OK"<br>Push "startup.bat"<br>Push "C:\"<br>Push $0<br>GetFunctionAddress $0 "MyFunction"<br>Exch $0<br>Push "1"<br>Push "1"<br>MessageBox MB_OK "Click OK to search for 'startup.bat' in C:\"<br>Call SearchFile<br>SectionEnd<br><br>Function SearchFile<br><br>Exch 4<br>Exch<br>Exch 3<br>Exch $R0 ; directory in which to search<br>Exch 4<br>Exch<br>Exch $R1 ; file or folder name to search in<br>Exch 3<br>Exch 2<br>Exch $R2<br>Exch 2<br>Exch $R3<br>Exch<br>Push $R4<br>Exch<br>Push $R5<br>Exch<br>Push $R6<br>Exch<br>Exch $R7 ;search folders with "."<br><br>StrCpy $R5 $R2 ;$R5 = custom function name<br>StrCpy $R6 $R3 ;$R6 = include subfolders<br><br>StrCpy $R2 ""<br>StrCpy $R3 ""<br><br># Remove \ from end (if any) from the file name or folder name to search<br>StrCpy $R2 $R1 1 -1<br>StrCmp $R2 \ 0 +2<br>StrCpy $R1 $R1 -1<br><br># Detect if the search path have backslash to add the backslash<br>StrCpy $R2 $R0 1 -1<br>StrCmp $R2 \ +2<br>StrCpy $R0 "$R0\"<br><br># File (or Folder) Search<br>##############<br><br># Get first file or folder name<br><br>FindFirst $R2 $R3 "$R0$R1"<br><br>FindNextFile:<br><br># This loop, search for files or folders with the same conditions.<br><br>StrCmp $R3 "" NoFiles<br>StrCpy $R4 "$R0$R3"<br><br># Preparing variables for the Callback function<br><br>Push $R7<br>Push $R6<br>Push $R5<br>Push $R4<br>Push $R3<br>Push $R2<br>Push $R1<br>Push $R0<br><br># Call the Callback function<br><br>Call $R5<br><br># Returning variables<br><br>Push $R8<br>Exch<br>Pop $R8<br><br>Exch<br>Pop $R0<br>Exch<br>Pop $R1<br>Exch<br>Pop $R2<br>Exch<br>Pop $R3<br>Exch<br>Pop $R4<br>Exch<br>Pop $R5<br>Exch<br>Pop $R6<br>Exch<br>Pop $R7<br><br>StrCmp $R8 "Stop" 0 +3<br>Pop $R8<br>Goto Done<br><br>Pop $R8<br><br># Detect if have another file<br><br>FindNext $R2 $R3<br>Goto FindNextFile ;and loop!<br><br># If don't have any more files or folders with the condictions<br><br>NoFiles:<br><br>FindClose $R2<br><br># Search in Subfolders<br>#############<br><br># If you don't want to search in subfolders...<br><br>StrCmp $R6 0 NoSubfolders 0<br><br># SEARCH FOLDERS WITH DOT<br><br># Find the first folder with dot<br><br>StrCmp $R7 1 0 EndWithDot<br><br>FindFirst $R2 $R3 "$R0*.*"<br>StrCmp $R3 "" NoSubfolders<br>StrCmp $R3 "." FindNextSubfolderWithDot 0<br>StrCmp $R3 ".." FindNextSubfolderWithDot 0<br>IfFileExists "$R0$R3\*.*" RecallingOfFunction 0<br><br># Now, detect the next folder with dot<br><br>FindNextSubfolderWithDot:<br><br>FindNext $R2 $R3<br>StrCmp $R3 "" NoSubfolders<br>StrCmp $R3 "." FindNextSubfolder 0<br>StrCmp $R3 ".." FindNextSubfolder 0<br>IfFileExists "$R0$R3\*.*" RecallingOfFunction FindNextSubfolderWithDot<br><br>EndWithDot:<br><br># SEARCH FOLDERS WITHOUT DOT<br><br># Skip ., and .. (C:\ don't have .., so have to detect if is :\)<br><br>FindFirst $R2 $R3 "$R0*."<br><br>Push $R6<br><br>StrCpy $R6 $R0 "" 1<br>StrCmp $R6 ":\" +2<br><br>FindNext $R2 $R3<br><br>Pop $R6<br><br># Now detect the "really" subfolders, and loop<br><br>FindNextSubfolder:<br><br>FindNext $R2 $R3<br>StrCmp $R3 "" NoSubfolders<br>IfFileExists "$R0$R3\" FindNextSubfolder<br><br># Now Recall the function (making a LOOP)!<br><br>RecallingOfFunction:<br><br>Push $R1<br>Push "$R0$R3\"<br>Push "$R5"<br>Push "$R6"<br>Push "$R7"<br>Call SearchFile<br><br># Now, find the next Subfolder<br><br>Goto FindNextSubfolder<br><br># If don't exist more subfolders...<br><br>NoSubfolders:<br><br>FindClose $R2<br><br># Returning Values to User<br><br>Done:<br><br>Pop $R7<br>Pop $R6<br>Pop $R5<br>Pop $R4<br>Pop $R3<br>Pop $R2<br>Pop $R1<br>Pop $R0<br><br>FunctionEnd<br><br>Function MyFunction<br>MessageBox MB_OK "startup.bat found at: $R0"<br><br>Push "Stop"<br>FunctionEnd<br><br>******************SearchFile Program Ends Here*********</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Instructor</span><br><span class="post-time small text-muted">21st March 2005 08:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Subject was already discussed<br><a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=203599" target="_blank">http://forums.winamp.com/showthread....hreadid=203599</a><br><br><br>Algorithm of this script (Locate + GetDrives):<br><br>1. Modern UI custom page<br>2. Start search button<br>3. Find specified file or file mask in all drives<br>4. Banner shows search in directory<br>5. Add founded files in List Box.<br>6. You must select one to enable Next button<br>7. If file deleted (since it found) then:<br>-Next button - disable<br>-Not existed file will deleted from List Box<br><br><a href="http://forums.winamp.com/attachment.php?s=&amp;postid=1620549" target="_blank">Script used header</a></p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>