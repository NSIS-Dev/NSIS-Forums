<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="UpdateResource()" />

  <title>UpdateResource() - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">UpdateResource()</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=244686">UpdateResource()</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">prsTM</span><br />
      <span class="post-time small text-muted">26th April 2006 19:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>UpdateResource()</strong><br />
      I want to stamp an affiliate ID into our installer without rebuilding it. I tried writing a small utility that would add a resource to the setup.exe using BeginUpdateResource(), UpdateResource(), and EndUpdateResource(), closely following the example on MSDN.<br />
      <br />
      Yes, I realize I'd need to set CRCCheck off.<br />
      <br />
      However, after my utility exited, I see my installer has been truncated from ~480K to ~40K. The utility works properly on itself, so it must be due to the format of the installer itself.<br />
      <br />
      Anyone know how make this work?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">28th April 2006 12:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Use !packhdr and then CRCCheck will work and the installer won't be truncated because there'll be nothing to truncate at that stage.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">prsTM</span><br />
      <span class="post-time small text-muted">28th April 2006 14:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm not sure I understand.<br />
      <br />
      I think I take away from your post that tweaking the resources blows up because the executable header is compressed, right?<br />
      <br />
      So are you saying this problem is unique to the NSIS proprietary compression, and that say, UPX won't enable the corruption?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">28th April 2006 14:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">No, I'm saying you should execute your executable editor using !packhdr instead of executing it after the installer is created. That's what !packhdr is for. It's for modifying the stub before anything is added to it and before the CRC is calculated.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">prsTM</span><br />
      <span class="post-time small text-muted">28th April 2006 15:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ah! Now I understand.<br />
      <br />
      Unfortunately, that doesn't fit my requirements. Forgive me if I wasn't clear in my original post, but what I want to do is to distribute the completed installer along with my resource tweek utility so that affiliates can stamp their own ID into it.<br />
      <br />
      The fallback solution is to ask them to install the NSIS compiler, and distribute nsi script and install files. Then they could build the installer with their affiliate ID as an argument. But then I wouldn't need my resource tweeker to get the ID into the installer.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">28th April 2006 15:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">In this case you can use CResourceEditor from the NSIS source code, instead of UpdateResource(). It will not truncate the data tacked to the installer. Though the CRC check will still fail.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">prsTM</span><br />
      <span class="post-time small text-muted">28th April 2006 15:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Cool, I didn't know that was there. Thanks very much!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
