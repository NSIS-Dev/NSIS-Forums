<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="How to replace old program version with new one?"><title>How to replace old program version with new one? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">How to replace old program version with new one?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=297469">How to replace old program version with new one?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">qforce3</span><br><span class="post-time small text-muted">16th September 2008 15:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>How to replace old program version with new one?</strong><br>Hello everybody,<br><br>I'm new to NSIS and creating installers went very well so far for me. However, what I'm wondering about is this: What do you do if an <b>older</b> version of your program is already installed?</p><ul><li>Deinstall it first, then install the new version?</li><li>Overwrite everything and hope there's no garbage left?</li><li>Manually maintain a list of file 'differences' between each version and take that into account during installation?</li></ul>Some more questions:<ul><li>What if you want to transfer the settings of the old version to the new one?</li><li>What if the user tries to install an older version over a newer one?</li></ul>Thanks for any help you guys can give me!</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">16th September 2008 15:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">When my installer finds an older version, it goes into upgrade mode: It overwrites only those files that I know have changed since any previous version. I'm the release engineer, I know which files have to be overwritten, so I just put those File commands in a separate section. All other File commands (for all unchanged files) are only executed in Reinstall and Newinstall modes.<br><br>If the installer finds a newer version of my project installed, it issues a warning "you're trying to install an older version than [previously installed version]". If the user chooses to continue, I once again do the all-knowing trick: I design the source code so that it can handle this situation. Any files I know were different (or not present yet, or are missing now) I extract. Any other files I leave alone.<br><br>As for overwriting settings, that's never been a problem for my projects.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">qforce3</span><br><span class="post-time small text-muted">16th September 2008 16:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">So if I understand correctly, that means, if you have the following versions:<br>- noob-app-1.0<br>- noob-app-1.1<br>- noob-app-1.2<br>- noob-app-1.3 &lt;= current version<br>then you would manually maintain a list of differences between 1.0 and 1.3, 1.1 and 1.3, and 1.2 and 1.3, right?<br><br>Huh... sounds very laborious to me, especially if there are many files to keep track of. Isn't there any way to automate this task?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comperio</span><br><span class="post-time small text-muted">16th September 2008 19:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think the easiest way would be to call the prior version's uninstall program (maybe in silent mode) before installing the new version. This would ensure that you replaced all the files and that any unnecessary (old) files were cleaned up.<br><br>If the app in question follows Microsoft best practices, then the settings should be separate from the application (like under the user's %AppData% folder), so re-installing shouldn't affect those. But if not, then you'll need to first save the old settings somewhere before you delete them during the uninstall.<br><br>If you want to prevent installing an older version on top of a new version, you'll need to do a version check right off the bat (in .OnInit, for example).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">setdosa</span><br><span class="post-time small text-muted">17th September 2008 17:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi, I am also trying the same way but I am not getting the required setup. can you please help me on how I can do this? say after the .OnInit what should I use to make the installer do a self verification of its previopus version???</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comperio</span><br><span class="post-time small text-muted">17th September 2008 18:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You'd need to get the version from somewhere--like maybe the registry or from the file itself. Then, use VersionCompare to compare the versions. See the help file for info on usage. Basically, it would look something like this:</p><pre>
<code>!include logiclib.nsh<br>!include wordfunc.nsh<br>!insertmacro VersionCompare<br>...<br>Function .onInit<br><font color="green">   ; assume $OldVersion is already set and that ${ThisVersion} is already defined<br>   ; set $0ldVersion to "0.0.0.0" if old version is not found</font><br>   ${VersionCompare} "$OldVersion" "${ThisVersion}" $0<br>   ${If} $0 = 1<br>      <font color="green">; this version is OLDER</font><br>      MessageBox MB_OK "This version is older than than existing!"<br>      Abort<br>   ${EndIf}<br>   ...<br>FunctionEnd</code>
</pre>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>