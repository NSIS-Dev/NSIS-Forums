<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="MUI installer error on NT4" />

  <title>MUI installer error on NT4 - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">MUI installer error on NT4</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=130129">MUI installer error on NT4</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RDaneel</span><br />
      <span class="post-time small text-muted">29th March 2003 03:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>MUI installer error on NT4</strong><br />
      [Probably for Joost]<br />
      <br />
      My question is really a two-parter:<br />
      <br />
      1) only on NT4 (SP6), my MUI NSIS-built installer ALWAYS gives the following error when installing back-to-back (note that with my in-use DLL, the installer is always doing a "/REBOOTOK" rename operation, and the user (me) always accepts the "reboot now?" invitation):<br />
      <br />
      Error opening file for writing: "\\ioSpecial.ini"<br />
      <br />
      followed by an "Abort-Retry-Ignore" dialog... this is BEFORE anything of the installer is displayed. Anyway, if I do an "Ignore", the installer limps along (probably with messed-up pages displayed), whereas if I do ONE "Abort", and then run the installer again, it ALWAYS is happy and runs without error.<br />
      <br />
      This particular behavior ONLY happens on NT4 - not 95, 98, 2000, or XP.<br />
      <br />
      2) Possibly related to the above, under 95, 98, or NT4 each of the above-described back-to-back installs always leaves a "nstN.tmp" folder in the system temp directory, containing the following files:<br />
      <br />
      InstallOptions.dll<br />
      Startmenu.dll<br />
      System.dll<br />
      modern-wizard.bmp<br />
      ioSpecial.ini<br />
      <br />
      Note that while this same folder of files is left for 95, 98, and NT4, there is only the associated run-time error mentioned above under NT4.<br />
      <br />
      OTOH, these installer-generated folders are NOT left behind under 2000 or XP when doing the same sequence of operations.<br />
      <br />
      Is this possibly going to be handled when the new remove-directory-on-reboot functionality is implemented, or is this something else entirely? And, can I provide any more info to help figure this out? :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">29th March 2003 11:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You have probably forgot to unload System.dll. If you fon't unload it NSIS can't delete it ;)<br />
      Remove /NOUNLOAD from the last call to System.dll.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RDaneel</span><br />
      <span class="post-time small text-muted">29th March 2003 18:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by kichik</i><br />
        <b>You have probably forgot to unload System.dll. If you fon't unload it NSIS can't delete it ;)<br />
        Remove /NOUNLOAD from the last call to System.dll.</b>
      </blockquote>Thanks for the reminder, but I don't think that is the issue... and did you notice the part about the same installer <b>works</b> properly under 2000 and XP, and only leaves these temp folders on 95, 98, and NT4? :)<br />
      <br />
      Here is the end of the installer (the <i>section</i> started with "SetPluginUnload alwaysoff"):<br />
      <br />
      <pre>
<code>        # [attempt to] rename and register our Shell extension<br />        Rename /REBOOTOK "$INSTDIR\RFtpSX.tmp" "$INSTDIR\RFtpSX.dll"<br />        IfRebootFlag delayedRegistration<br />        RegDLL "$INSTDIR\RFtpSX.dll"<br />        System::Call 'Shell32::SHChangeNotify(i, i, i, i) v (${SHCNE_ASSOCCHANGED}, ${SHCNF_IDLIST}, 0, 0)'<br />        System::Call 'Ole32::CoFreeUnusedLibraries() v'<br />        Goto doneWithDLL<br />delayedRegistration:<br />        WriteRegStr HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce" \<br />     "Register $INSTDIR\RFtpSX.dll" '"$SYSDIR\rundll32.exe" "$INSTDIR\RFtpSX.dll,DllRegisterServer"'<br />doneWithDLL:<br /><br />        # write our Uninstall info<br />        WriteRegStr HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\RFtpPRO" \<br />                "DisplayName" "RFtp Professional"<br />        WriteRegStr HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\RFtpPRO" \<br />                "UninstallString" "$R9"<br /><br />        SetPluginUnload manual<br />        System::Free 0  ; (make plugin go alway)<br /><br />        # create uninstaller<br />        WriteUninstaller "Uninstall.exe"<br />SectionEnd<br /></code>
</pre><br />
      <br />
      Comments? Anyone? BTW, I tried to adapt the reg-dll-at-reboot code from the UpgradeDLL macro... did I "borrow" the code correctly? ;)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">29th March 2003 18:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can never know with Microsoft... :p<br />
      <br />
      If all of the files are still there it seems $PLUGINSDIR was destroyed in some bizzare way... Probably has something to do with brainsucker's bug that I haven't reached to yet. He had about the same thing where $PLUGINGSDIR is empty somehow. I'll check it tomorrow or in two days (kinda busy next two days) and let you both know.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RDaneel</span><br />
      <span class="post-time small text-muted">29th March 2003 22:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just to let you know - I am using the released BETA 3... :)<br />
      <br />
      I have been waiting for the dust to settle with the newer System.dll.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
