<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Un-installing a previous installation while installing a new version." />

  <title>Un-installing a previous installation while installing a new version. - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Un-installing a previous installation while installing a new version.</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=79180">Un-installing a previous installation while installing a new version.</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bdoherty</span><br />
      <span class="post-time small text-muted">13th March 2002 20:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Un-installing a previous installation while installing a new version.</strong><br />
      If I have an installation already installed, and I know therefore that I have a un-install file. When I check to make sure my files are there can I give the user the option of uninstalling the original installation without aborting the new installation?<br />
      <br />
      I have the following code:<br />
      ; Check if we're about to try to install over an existing installation.<br />
      IfFileExists "$INSTDIR\MyAppReadme.htm" warn install<br />
      warn:<br />
      MessageBox MB_OK|MB_ICONSTOP "You are trying to install over an existing installation of MyAppReadme.$\nPlease uninstall the existing version and run the installer again."<br />
      Abort<br />
      <br />
      install:<br />
      <br />
      I assume I can use ExecWait to trigger the uninstMyApp.exe but I am unsure as to how to write this code or where this code will go in the NSI file.<br />
      <br />
      <br />
      :confused:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DuaneJeffers</span><br />
      <span class="post-time small text-muted">14th March 2002 02:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, you can run the Uninstall App by using the ExecWait command, but you can do much more. Like Silently Uninstalling the application by using the UnInstallSilent tag. That way, when you run the new install, you can uninstall the previous app before using the new one.<br />
      <br />
      -Duane</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">justin</span><br />
      <span class="post-time small text-muted">14th March 2002 05:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you use ExecWait on the uninstaller it won't work, since the uninstaller will duplicate itself and exit immediately.<br />
      <br />
      Instead, use this:<br />
      <br />
      ExecWait '"$INSTDIR\uninstall.exe" /S _=$INSTDIR'<br />
      <br />
      The /S will tell it to be silent, and the _=$INSTDIR tells it to immediately uninstall from $INSTDIR.<br />
      <br />
      Note that if you do this, the uninstaller won't be able to remove itself, which should be OK, but any logic to detect whether the uninstall was complete in the uninstaller could cause popups (i.e. "could not remove program directory" if you put that in).<br />
      <br />
      -Justin</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DuaneJeffers</span><br />
      <span class="post-time small text-muted">14th March 2002 08:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well Gee, you learn something new everyday.<br />
      <br />
      Thanks J.<br />
      -Duane</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bdoherty</span><br />
      <span class="post-time small text-muted">14th March 2002 23:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>conditional branching</strong><br />
      Ok, I think I get it. Now, how do I deal with it along with the MessageBox code I have above? I would like to give the users the option to un-install the previous installation, abort the current installation, or chose another directory and continue. I have no idea how to set up the conditional branching; any sample would be of great help.<br />
      <br />
      Also, I assume once I uninstall the original app, if it is unable to remove itself, I can overwrite the original un-installer with a new one?<br />
      :hang:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br />
      <span class="post-time small text-muted">15th March 2002 07:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Giving users the ability to select another dir at error (eg alread installed in this dir) is possible using .onNextPage after the initial dir selection has taken place. You can then check whether this is the dir that is already installed to (using registry or IfFileExists) and abort the function (so not continueing) if the user wants to select another dir. You could also use .onVerifyInstDir but the problem with this function is that it is triggered onKeyPress so when typing something in the dirselectionbox, after every letter, the message might appear...<br />
      <br />
      For an example how to do this see this thread:<br />
      <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=70530&amp;highlight=regcode" target="_blank">http://forums.winamp.com/showthread....hlight=regcode</a><br />
      <br />
      Good luck,<br />
      greetz, Hendri.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pomflain</span><br />
      <span class="post-time small text-muted">18th March 2002 14:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Re: conditional branching</strong><br /></p>

      <blockquote>
        <i>Originally posted by bdoherty</i><br />
        <b>Ok, I think I get it. Now, how do I deal with it along with the MessageBox code I have above? I would like to give the users the option to un-install the previous installation, abort the current installation, or chose another directory and continue. I have no idea how to set up the conditional branching; any sample would be of great help.<br />
        <br />
        Also, I assume once I uninstall the original app, if it is unable to remove itself, I can overwrite the original un-installer with a new one?<br />
        :hang:</b>
      </blockquote>I might have you covered. This is almost exactly what I've done with a suite of installers and I think I've got it working pretty well now. What I do is detect the old installation and ask them if they want to uninstall or just continue with the new installation. Sometimes you just can't uninstall because something is messed up, so they have the option to just continue if something like that happens. If they chose to uninstal then the uninstaller is spawned off and the installer closes, but writes out its location from $CMDLINE. The uninstaller runs and once it completes, relaunches the installer and everything is good.<br />
      <br />
      Sound like what you are looking for?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bdoherty</span><br />
      <span class="post-time small text-muted">18th March 2002 19:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Re: conditional branching</strong><br />
      Sound's great!<br />
      I am looking for just that, can you post the code and/or email me the code?<br />
      :up:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pomflain</span><br />
      <span class="post-time small text-muted">18th March 2002 20:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Re: Re: conditional branching</strong><br /></p>

      <blockquote>
        <i>Originally posted by bdoherty</i><br />
        <b>Sound's great!<br />
        I am looking for just that, can you post the code and/or email me the code?<br />
        :up:</b>
      </blockquote>Sure, what's your e-mail? Don't want to embarrass by posting my work on here...
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pomflain</span><br />
      <span class="post-time small text-muted">18th March 2002 20:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Re: conditional branching</strong><br /></p>

      <blockquote>
        <i>Originally posted by bdoherty</i><br />
        <b>Ok, I think I get it. Now, how do I deal with it along with the MessageBox code I have above? I would like to give the users the option to un-install the previous installation, abort the current installation, or chose another directory and continue. I have no idea how to set up the conditional branching; any sample would be of great help.<br />
        <br />
        Also, I assume once I uninstall the original app, if it is unable to remove itself, I can overwrite the original un-installer with a new one?<br />
        :hang:</b>
      </blockquote>I might have you covered. This is almost exactly what I've done with a suite of installers and I think I've got it working pretty well now. What I do is detect the old installation and ask them if they want to uninstall or just continue with the new installation. Sometimes you just can't uninstall because something is messed up, so they have the option to just continue if something like that happens. If they chose to uninstal then the uninstaller is spawned off and the installer closes, but writes out its location from $CMDLINE. The uninstaller runs and once it completes, relaunches the installer and everything is good.<br />
      <br />
      Sound like what you are looking for?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bdoherty</span><br />
      <span class="post-time small text-muted">18th March 2002 22:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>conditional branching</strong><br />
      I hear ya!<br />
      Thanks, this will really help me out!<br />
      <br />
      My email is <a href="mailto:btdoherty@att.net">btdoherty@att.net</a><br />
      <br />
      <br />
      :hang:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jcagle</span><br />
      <span class="post-time small text-muted">25th July 2003 20:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Pomflain, could you send me this code as well? Thanks!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpodtbc</span><br />
      <span class="post-time small text-muted">23rd February 2007 17:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by justin</i><br />
        ExecWait '"$INSTDIR\uninstall.exe" /S _=$INSTDIR'
      </blockquote>i couldn't get this to work until i looked at the nsis documentation which showed<br />
      <br />
      _?=$INSTDIR<br />
      <br />
      <br />
      use that argument if you want to ExecWait your uninstaller.
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
