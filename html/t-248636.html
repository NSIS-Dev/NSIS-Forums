<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Loops and Sections." />

  <title>Loops and Sections. - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Loops and Sections.</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=248636">Loops and Sections.</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Database</span><br />
      <span class="post-time small text-muted">13th June 2006 19:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Loops and Sections.</strong><br />
      I'm trying to make a code that checks the registry for information, such as the name and the location of files. How can I make the installer create a section for each key it finds, with the name ripped from the registry?<br />
      <br />
      My code currectly:<br /></p>

      <blockquote>
        Function .onInit<br />
        StrCpy $number 1<br />
        start:<br />
        ReadRegStr $0 HKLM "Software\MATY Auto Installer\Sec$number" "Name"<br />
        Pop $0<br />
        StrCmp $0 "success" ok<br />
        Goto end<br />
        ok:<br />
        StrCpy $number $number+1<br />
        Goto start<br />
        end:<br />
        FunctionEnd
      </blockquote>How can I do this?<br />
      <br />
      Thanks,<br />
      <br />
      Database
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">13th June 2006 19:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You cannot create Sections dynamically.<br />
      You could instead, however, display a list with the EmbeddedLists plugin (on Wiki).<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Database</span><br />
      <span class="post-time small text-muted">13th June 2006 19:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks, but this probably won't help. What I am trying to do as a whole, is set up an installer to detect new files on a server, and offer them for download.<br />
      <br />
      Any ideas?<br />
      Thanks,<br />
      <br />
      Database</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">16th June 2006 13:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You could create a pool of invisible sections that you'd use show for each registry key. The number of sections will be limited but you'll be able to dynamically "create" sections.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">16th June 2006 17:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've done this many a time. I wrote a number of programs in NSIS with dialogs for selecting files for download. The list of files was stored as plain text on a server and downloaded when the program was ran.<br />
      I always just used an InstallOptions list box control, but for future projects I can use EmbeddedLists either with a checked list box, or a tree view control with check boxes (almost identical to the one on the NSIS Components page).<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Database</span><br />
      <span class="post-time small text-muted">17th June 2006 10:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Wow, very useful. The problem is that I need the file with the file locations to be seperate from the installer, so it can be easily updated every time the installer is run.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Database</span><br />
      <span class="post-time small text-muted">17th June 2006 10:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Another thing: Can you elaborate on how you did the list of files, and how you got the installer to read them?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">17th June 2006 11:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">List of files:<br />
      <a href="http://hmd.hostileintent.org/swupdata/scripts/swupdata.txt" target="_blank">http://hmd.hostileintent.org/swupdat...s/swupdata.txt</a><br />
      <br />
      To read from the file, used FileOpen, FileRead and FileClose.<br />
      Files are downloaded with the InetLoad plugin.<br />
      <br />
      Edit: this is called SwUpdata, which is at <a href="http://swupdata.sf.net" target="_blank">http://swupdata.sf.net</a><br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Database</span><br />
      <span class="post-time small text-muted">17th June 2006 12:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Wow, very cool. I'm using an INI file again now... I'll probably do the same thing as you've done :)<br />
      <br />
      -Data</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Database</span><br />
      <span class="post-time small text-muted">17th June 2006 12:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK, I'm trying to create a loop for this, so it loops through and propogates the sections with the names, descriptinos, and locations of the files.<br />
      <br />
      This is the code so far for the whole program:<br />
      <br /></p>

      <blockquote>
        Var number<br />
        Var number2<br />
        <br />
        Name "${PRODUCT_NAME} ${PRODUCT_VERSION}"<br />
        OutFile "Setup.exe"<br />
        InstallDir "$PROGRAMFILES\MATY Auto Updater"<br />
        InstallDirRegKey HKLM "${PRODUCT_DIR_REGKEY}" ""<br />
        ShowInstDetails show<br />
        <br />
        Function .onInit<br />
        ReadINIStr $0 $EXEDIR\settings.ini Sec$number Name<br />
        SectionSetText SEC$number2 $0<br />
        FunctionEnd<br />
        <br />
        Section "" SEC01<br />
        ReadINIStr $1 $EXEDIR\settings.ini Sec00 Location<br />
        NSISdl::download $1 $exedir\temp\$0.zip<br />
        CreateDirectory $INSTDIR\abortbedmaking<br />
        SectionEnd<br />
        <br />
        Section "" SEC02<br />
        ReadINIStr $1 $EXEDIR\settings.ini Sec01 Location<br />
        NSISdl::download $1 $exedir\temp\$0.zip<br />
        CreateDirectory $INSTDIR\abortbedmaking<br />
        SectionEnd<br />
        <br />
        Section "" SEC03<br />
        ReadINIStr $1 $EXEDIR\settings.ini Sec02 Location<br />
        NSISdl::download $1 $exedir\temp\$0.zip<br />
        CreateDirectory $INSTDIR\abortbedmaking<br />
        SectionEnd<br />
        <br />
        Section -Extract<br />
        IfFileExists $exedir\temp\abortbedmaking.zip a b<br />
        a:<br />
        nsisunz::UnzipToLog "$exedir\temp\abortbedmaking.zip" "$instdir\abortbedmaking"<br />
        Pop $0<br />
        StrCmp $0 "success" b<br />
        DetailPrint "$0" ;print error message to log<br />
        b:<br />
        <br />
        SectionEnd<br />
        <br />
        Section -Post<br />
        Sleep 5000<br />
        WriteRegStr HKLM "${PRODUCT_DIR_REGKEY}" "" "$INSTDIR\AppMainExe.exe"<br />
        Delete $exedir\temp\*.*<br />
        SectionEnd<br />
        <br />
        ; Section descriptions<br />
        !insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br />
        ReadINIStr $2 $EXEDIR\settings.ini Sec00 Description<br />
        !insertmacro MUI_DESCRIPTION_TEXT ${SEC01} $2<br />
        !insertmacro MUI_FUNCTION_DESCRIPTION_END
      </blockquote>-Data
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
