<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="List of all users" />

  <title>List of all users - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.2/readable/bootstrap.min.css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">List of all users</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=318536">List of all users</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">xreboot</span><br />
      <span class="post-time small text-muted">20th April 2010 13:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>List of all users</strong><br />
      &nbsp; Hi there.<br />
      <br />
      I was wondering, for my backup program, if it is possible to get a list of users and use them as variables in cmd or nsis?<br />
      <br />
      So i can backup all of my users with one click.<br />
      <br />
      Thanks in advance.<br />
      <br />
      Rob</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br />
      <span class="post-time small text-muted">20th April 2010 13:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://nsis.sourceforge.net/User_Management_using_API_calls#Enumerate_all_users" target="_blank">http://nsis.sourceforge.net/User_Man...rate_all_users</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">xreboot</span><br />
      <span class="post-time small text-muted">20th April 2010 14:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Only crashing my installer.<br />
      Any variables i have to define before executing the macro?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">20th April 2010 15:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The script mentioned in that wiki page makes uses of the NSISArray plugin and header - make sure the compiler can find those.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">xreboot</span><br />
      <span class="post-time small text-muted">20th April 2010 15:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">yes i'm not getting any error in compiling my script aswell i'm using<br /></p>
      <pre>
<code>!include "NSISArray.nsh"</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">20th April 2010 15:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">what if you try this?<br /></p>
      <pre>
<code>
FunctionEnd 
<br />&gt;
</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">xreboot</span><br />
      <span class="post-time small text-muted">20th April 2010 15:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">then i get a popup of all users. Is it also possible to display them in a list?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">xreboot</span><br />
      <span class="post-time small text-muted">20th April 2010 16:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">i got it :)<br />
      <br /></p>
      <pre>
<code>Function users<br /> !insertmacro MUI_HEADER_TEXT "userlist" "overzicht van alle gebruikers"<br />  ReadRegStr $0 HKLM "System\CurrentControlSet\Control\ComputerName\ActiveComputerName" "ComputerName"<br />  System::Call 'netapi32::NetUserEnum(w "\\$0",i 0,i 2,*i .R0,i ${NSIS_MAX_STRLEN}, *i .R1,*i .R2,*i .r1)i .r2'<br />  StrCpy $R8 $R0<br />  IntOp $R2 $R2 - 1<br />  SetOutPath "$INSTDIR\"<br />  StrCpy "$1" "$INSTDIR"<br />  FileOpen "$0" "users.bat" "w"<br />  FileWrite "$0" "$1$\r$\n"<br />  ${ForEach} $9 0 $R2 + 1<br />    System::Call "*$R0(w.R9)"<br />          FileWrite "$0" "set user$9=[$R9]$\r$\n"<br />    IntOp $R0 $R0 + 4<br />  ${Next}<br />  FileClose "$0"<br />  System::Call 'netapi32.dll::NetApiBufferFree(i R8)i .R1'<br />FunctionEnd<br /></code>
</pre><br />
      <br />
      Ty for the help!
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">20th April 2010 16:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Not sure why your installer hung/crashed before.. might have been NSISArray - not really needed.. the macro should use a callback function instead and let the user decide what to do with the info. I might propose an edit to that wiki page later.<br />
      <br />
      Anyway - glad it's all sorted :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">xreboot</span><br />
      <span class="post-time small text-muted">20th April 2010 16:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">one more issue...<br />
      <br />
      i do this now:<br />
      <br /></p>
      <pre>
<code><br />  ${ForEach} $9 0 $R2 + 1<br />    System::Call "*$R0(w.R9)"<br />          !define user$9 $R9<br />    IntOp $R0 $R0 + 4<br />  ${Next}<br /></code>
</pre><br />
      <br />
      But i cant recall my defined users.<br />
      <br />
      Is there any workaround?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">20th April 2010 17:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by xreboot</small><br />
        one more issue...<br />
        <br />
        <pre>
<code><br />          !define user$9 $R9<br /></code>
</pre><br />
        <br />
        But i cant recall my defined users.<br />
        <br />
        Is there any workaround?
      </blockquote>Defines are created at compile-time, rather than runtime. If you need the list of users the installer is run on, use a variable instead. Or fall back to the text file output and read from that, or use NSISArray to store each user in an array (which the original macro did) :)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">CancerFace</span><br />
      <span class="post-time small text-muted">21st April 2010 09:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have not been keeping up with Afro's NSISArray array plugin development, but I am pretty sure that the wiki page macro works with version 1.x ...<br />
      <br />
      Here is what also works with v.2.3 that I just tested:<br />
      First some definitions ...<br /></p>
      <pre>
<code>!define NERR_Success 0<br />!define NERR_More_Data 234<br />!define strNET_DISPLAY_USER '(w,w,i,w,i,i)i'</code>
</pre><br />
      Then the macro:<br />
      <pre>
<code>!macro EnumLocalUsers SERVER_NAME ARRAY_NAME ERRORFLAG<br />!define Index "Line${__LINE__}"<br />StrCpy ${ERRORFLAG} 0<br />; $R0 gets number of entries, $R1 is an array of NET_DISPLAY_USER structures<br />System::Call /NOUNLOAD 'netapi32::NetQueryDisplayInformation(w "${SERVER_NAME}",i 1,i 0,i 99, i ${NSIS_MAX_STRLEN},*i .R2,*i .R0)i.r5'<br />StrCmp $5 ${NERR_Success} ${Index}_No_Error<br />StrCmp $5 ${NERR_More_Data} ${Index}_No_Error ${Index}_Error<br />${Index}_Error:<br />  StrCpy ${ERRORFLAG} 1<br />  Goto ${Index}_End<br />${Index}_No_Error:<br />  StrCpy $R7 $R0<br />  NSISArray::New /NOUNLOAD ${ARRAY_NAME} $R2 2<br />  StrCpy $2 0<br />  ${Index}_Feed:<br />          StrCmp $2 $R2 ${Index}_Stop<br />          System::Call '*$R0${strNET_DISPLAY_USER}(.R9,,,,,)'<br />    IntOp $R0 $R0 + 24<br />    NSISArray::Write /NOUNLOAD ${ARRAY_NAME} $2 '$R9'<br />    IntOp $2 $2 + 1<br />    Goto ${Index}_Feed<br />        ${Index}_Stop:<br />  NSISArray::FreeUnusedMem /NOUNLOAD<br />${Index}_End:<br />System::Call /NOUNLOAD 'netapi32::NetApiBufferFree(i R7)i.r5'<br />!undef Index<br />!macroend</code>
</pre><br />
      Call the macro (for the local machine):<br />
      <pre>
<code>StrCpy $1 0<br />!insertmacro EnumLocalUsers "" LocalUsers $1<br />${If} $1 = 1<br />  MessageBox MB_OK|MB_ICONSTOP|MB_TOPMOST "Error on the API call!"<br />${EndIf}</code>
</pre><br />
      and if I debug I get all the local users in the array object:<br />
      <pre>
<code>NSISArray::Debug /NOUNLOAD LocalUsers</code>
</pre><br />
      <br />
      Hope this helps,<br />
      CF
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">xreboot</span><br />
      <span class="post-time small text-muted">22nd April 2010 11:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Alright, i got it now, but how can i exclude stuff like SUPPORT_388945a0<br />
      ?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">22nd April 2010 14:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">v2.3 had a MS VC90 CRT dependency (in its XML manifest) which I've now sorted in v2.4. Let me know if the crashing is fixed.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">xreboot</span><br />
      <span class="post-time small text-muted">22nd April 2010 14:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">got it all fixed :).<br />
      <br />
      For those with a similar problem:<br />
      <a href="http://pastebin.com/R4tfTHhW" target="_blank">http://pastebin.com/R4tfTHhW</a></p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>