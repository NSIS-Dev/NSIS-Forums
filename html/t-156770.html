<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Calling a custom plugin from the Uninstall section fails" />

  <title>Calling a custom plugin from the Uninstall section fails - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Calling a custom plugin from the Uninstall section fails</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=156770">Calling a custom plugin from the Uninstall section fails</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">CoffeeMug</span><br />
      <span class="post-time small text-muted">19th November 2003 09:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Calling a custom plugin from the Uninstall section fails</strong><br />
      Hello everyone. I've created a custom C++ plugin to perform certain specialized tasks during the install and uninstall. The plugin currently has two functions, one called from the main installation section, the other called from the Uninstall section. Calling the function from the main section works like a charm. However, when I call the cleanup function from the Uninstall section the code never executes. The script compiles fine and uninstall completes successfully but the uninstaller doesn't attempt to execute the cleanup function from the plugin. I am using the latest development snapshot. Here's a piece of code from my script:<br />
      <br />
      Section Uninstall<br />
      ; Uninstall the trigger<br />
      InstallHelper::CleanupFunc ; &lt;--- this never executes<br />
      <br />
      Delete "$INSTDIR\${PRODUCT_NAME}.url" ; &lt;--- this executes fine<br />
      ; ..........<br />
      SectionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">19th November 2003 12:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Plug-ins in uninstaller sections should work fine. Are you sure there is no bug in your code?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">CoffeeMug</span><br />
      <span class="post-time small text-muted">19th November 2003 16:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Although one can never be 100% sure, however it is a rather simple example... I have a plugin with a TestFunction that displays a message box on entry. When I call TestFunction from the main section the message box displays fine. When I call it from Uninstall, it simply does not display. All other code in Uninstall executes (native NSIS functions). I removed all other code just to see if this works, and it fails. I do not have any conditional code in my script...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">19th November 2003 16:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Works fine for me. Using the NSIS latest version? Can you post an example with plug-in and source?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">CoffeeMug</span><br />
      <span class="post-time small text-muted">19th November 2003 17:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I used the latest development snapshot (downloaded it yesterday). I attach the code for the installer to this post. There's nothing special about the plugin, especially considering that the same function is called from the main section perfectly fine. Perhaps the plugin is "removed" by the uninstall script before it tries to call it?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">19th November 2003 17:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The plug-in is bundled inside the uninstaller data block, it can't be removed. How do you test that the plug-in has not been called?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">CoffeeMug</span><br />
      <span class="post-time small text-muted">19th November 2003 17:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, the function does some cleanup in the database and when I check the db the cleanup has never occured. It does clean up the database when I call it from the main section. After a while I just started popping up message box on entry.<br />
      <br />
      The plugin dll uses one of the dlls I install (DBHelper.dll). Perhaps the function isn't called because I remove DBHelper.dll before I call the the plugin? I tried to move the call to the plugin above the "Delete" commands but it doesn't seem to have any effect.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">19th November 2003 17:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Make sure all the DLLs that plug-in depends on are in somewhere the loader can find them. The best place is the current working directory which is set using SetOutPath.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">CoffeeMug</span><br />
      <span class="post-time small text-muted">19th November 2003 18:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Could you please give a little more information? Do you mean at the time I compile the install script or during the actual runtime of install/uninstall on a target machine?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">19th November 2003 18:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you DLL files depend on other files, make sure that the loader can find them.<br />
      <br />
      If you store these files in the current folder (which you can set using SetOutPath), the loader will find them.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">CoffeeMug</span><br />
      <span class="post-time small text-muted">19th November 2003 22:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Placing a SetOutPath in the uninstall section and setting it to the $INSTDIR worked like a charm. Thank you very much for your help. NSIS is an amazing piece of software. I am doing some custom work for managing COM+ applications through NSIS (creating a COM+ application, installing a component, etc.) and when I have time I'll try to donate the code. Keep up the good work!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
