<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Including a file at runtime"><title>Including a file at runtime - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Including a file at runtime</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=271644">Including a file at runtime</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Andrew Peacock</span><br><span class="post-time small text-muted">23rd May 2007 13:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Including a file at runtime</strong><br>&nbsp; Hi,<br>I'd like to be able to include an optional text file at runtime. The NSIS script then reads that text file (if it exists), stores the content in a variable, and uses that variable later.<br><br>All working well.<br><br>My question is how to share this file with others.<br><br>I'm using:<br></p><pre>
<code>
IfFileExists $EXEDIRdata.txt 0 affiddone 
<br>&gt;
</code>
</pre>to work out where to find the text file, but that doesn't work if the installer is ZIPped. The only option is to ask the user to extract the ZIP file before they run the installer.<br>
      <br>
      Is there any way to point the NSIS script to the text file within the ZIP file directly?<br>
      <br>
      Regards,<br>
      Andy
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">23rd May 2007 14:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Why don't you have the data file in the installer, or do you need to have a static installer with a changing data file?<br>
      <br>
      Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Andrew Peacock</span><br>
      <span class="post-time small text-muted">23rd May 2007 14:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The latter - static installer with changing data file,<br>
      Andy</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">23rd May 2007 14:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">How about storing the data file on a website and downloading it with InetC? Or maybe rather than using a Zip file for distribution, use another basic wrapper installer with no UI, has CRCCheck off, extracts the two files then runs the extracted installer all in .onInit before calling Quit.<br>
      <br>
      To build the wrapper installer, I would use a batch file that calls makensis.exe<br>
      <br>
      Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Andrew Peacock</span><br>
      <span class="post-time small text-muted">23rd May 2007 14:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Stu,<br>
      OK, alot of that was meaningless to me... but it sounds like you know what you're talking about, so I'll have a scoot around the forum and piece together the relevant code.<br>
      <br>
      Thanks for the pointers!<br>
      <br>
      Andy</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">23rd May 2007 15:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Something like this.<br>
      <br></p>
      <pre>
<code>Name "My Installer Wrapper"<br>OutFile setup.exe<br><br>SilentInstall silent<br>CRCCheck off<br><br>Function .onInit<br><br>  SetOutPath $EXEDIR<br>  File data.txt<br>  File install.exe<br><br>  Exec "$EXEDIR\install.exe"<br><br>  Quit<br><br>FunctionEnd<br><br>Section<br>SectionEnd<br></code>
</pre><br>
      <br>
      I also put SilentInstall silent in there so that no GUI resources are added to the installer.<br>
      <br>
      Stu
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Andrew Peacock</span><br>
      <span class="post-time small text-muted">23rd May 2007 15:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Stu,<br>
      You da man!<br>
      <br>
      Thanks very much. I was never really sure what the .onInit etc routines do, but I think I've got that now, as well.<br>
      <br>
      Thanks again,<br>
      Andy</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Andrew Peacock</span><br>
      <span class="post-time small text-muted">23rd May 2007 16:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Stu,<br>
      Had a look at it, and that's not exactly what I want. Mainly because I wasn't being very specific :-)<br>
      <br>
      So, here's the scenario:<br>
      <br>
      1. I've created an installer which can take the value of an optional text file, and use it later in the program.<br>
      <br>
      2. I give that installer to resellers.<br>
      <br>
      3. THEY add that text file, with their own details, that I'll never see.<br>
      <br>
      4. The resellers give the ZIP (or other) file to users, who run the install, which picks up the reseller's details and installs appropriately.<br>
      <br>
      So, the resellers never have access to NSIS to create a new, unique installer.<br>
      <br>
      What I'd like is like the ZIP function where it asks "Do you want to extract to a folder before installing?", so that the install .exe and the data.txt file are in the same folder. The install can then work as planned.<br>
      <br>
      Any chance you can shed some light on how to do this?<br>
      <br>
      Regards,<br>
      Andy</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">theblazingangel</span><br>
      <span class="post-time small text-muted">23rd May 2007 16:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">if thats what you want then why not use an sfx archive...<br>
      <br>
      - you supply the main installer<br>
      - reseller creates the text file, then packages the two files together as an sfx archive<br>
      - end user runs the sfx archive and specifies where to extract to, the sfx archive extracts the files and calls your installer<br>
      <br>
      it might be a better idea to not go down the route of asking for an extraction location though. instead have the files extracted to a temporary location silently. if you can't do this with sfx archives, it can be done by wrapping your installer and the reseller's text file in another NSIS installer, Afrow UK supplied a script for this above.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br>
      <span class="post-time small text-muted">23rd May 2007 17:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Provided that,<br>
      1. the text file is always wrapped in a zip with a standard name or at least a range of names<br>
      2. the zip resides into the same place with your main installer (this is preferred because the main installer won't need to perform a search to locate the zip)<br>
      You could use one of the available <a href="http://nsis.sourceforge.net/Category:Plugins" target="_blank">unzip plugins</a> to extract the zip in a temporary place, read the required data and remove it.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Andrew Peacock</span><br>
      <span class="post-time small text-muted">25th May 2007 12:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for your help all. I'm looking at using server-side RAR to create a self-extracing ZIP. The reseller will enter their details into a PHP form, the server creates the ZIP, the reseller distributes the ZIP, and (hopefully) the self-extracting ZIP will correctly locate the data file.<br>
      <br>
      Regards,<br>
      Andy</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">25th May 2007 17:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Good idea :)<br>
      <br>
      Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">chivalri</span><br>
      <span class="post-time small text-muted">25th May 2007 18:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I had the same issue. I have a software package that gets rebranded by some of our bigger distributors. I have created the installer so that the software gets rebranded if an ini file exists in $EXEDIR/custom. If the file is not there then the installer looks and works as usual. If it is there, the skin of the installer is changed using the distributors graphics and information and the changes are made to the installed applications.<br>
      <br></p>
      <pre>
<code>Function .onInit<br>  strCpy $MyAPP_NAME "My Software"<br>  strCpy $DoStamp "0"<br>  IfFileExists "$EXEDIR\custom\custom.ini" GoodToDoStamp<br>  goto NoStamp<br>  GoodToDoStamp:<br>  strCpy $DoStamp "1"<br>  strCpy $MyAPP_NAME "Resellers Software"<br>  NoStamp:<br>FunctionEnd<br></code>
</pre><br>
      <br>
      Then in each section I run this code<br>
      <pre>
<code>  ${If} $DoStamp != "0"<br>    ${StampMacro} "This Section"<br>  ${EndIf}</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Andrew Peacock</span><br>
      <span class="post-time small text-muted">25th May 2007 20:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Chivalri,<br>
      Does the end user have to unzip to a folder first, or did you also use a self-extracting exe? If the latter, what's the process for getting the self-extractor created?<br>
      <br>
      Regards,<br>
      Andy</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">chivalri</span><br>
      <span class="post-time small text-muted">1st June 2007 22:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Neither. In my particular case, I have created an installer that has my company's logo and text in it as well as all over the software that is installed. This is the default operation.<br>
      <br>
      If a distributor wants to put their stamp on the installer and the software, they must create a sub directory from $EXEDIR named custom and create a custom.ini file in that directory that has their text changes and paths to the replacement graphics.<br>
      <br>
      I ran a simple test for you using Stu's code. I added a statement to launch my setup.exe after unpacking the installer and the custom dir and then removed the installer and custom dir when done and it worked very well.<br>
      <br>
      I did not make a delivery mechanism for getting the installer and the custom mods to the customer. In the instructions I provided to the distributors, I suggested they put the installer on a CD and have the custom dir there along with any other extra software they wish to add.<br>
      <br>
      It works well this way.<br>
      <br>
      I ran a demo for our distributors showing that if I dropped the setup.exe into 4 different folders (each with their own custom dir) I got 4 different company skins on both the installer and the applications.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Andrew Peacock</span><br>
      <span class="post-time small text-muted">1st June 2007 22:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Chivalri,<br>
      Ah, OK. That makes sense. I was trying to make this download only rather than CD, so that won't help in this situation.<br>
      <br>
      But thanks very much for taking the time to share your experience. Much appreciated.<br>
      <br>
      Regards,<br>
      Andy</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">chivalri</span><br>
      <span class="post-time small text-muted">4th June 2007 15:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">My normal delivery for the file is by download and using code like Stu's I tested to verify that a single file download could contain the custom folder and the setup file and auto launch the setup file after unpacking.<br>
      <br>
      For me, this works well since I am using a package based (web or cd delivery) install system. Thus the setup file is small (less than 4 Mb) and adding the extra step for a distributor to wrap the package with their "skin" does not require much extra time in the setup or download.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>