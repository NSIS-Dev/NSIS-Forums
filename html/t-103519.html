<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="New installer script functions"><title>New installer script functions - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">New installer script functions</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=103519">New installer script functions</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">bayden</span><br><span class="post-time small text-muted">4th September 2002 08:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>New installer script functions</strong><br>Hi! I just discovered this forum, and wanted to ask around to see if I'm doing something useful or wasting my time...<br><br>For my private build of NSIS 1.98, I've just about finished enabling the following new functions:<br>---<br>Download "http://www.foo.com/dl/blah.cab" "$TEMP\out.cab"<br>Expand "%TEMP\out.cab" "$INSTDIR"<br>---<br><br>Is this sort of thing old hat and already scheduled for inclusion in NSIS 2.0?<br><br>Thanks for any feedback,<br><br>Eric Lawrence<br>Applications Architect<br>Bayden Systems</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">4th September 2002 08:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">There is already a DLL that can download files for you. It is called NSIS-dl, and is included in the Bin dir in your NSIS 1.98. The sources are in Contrib\NSISdl.<br><br>Another DLL written by CodeSquid can extract files from ZIPs. You can find it at Sunjammer's NSIS Archive (have a look at the FAQ for links). It would be great if you make a DLL for extracting from CAB files too, and post it here.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bayden</span><br><span class="post-time small text-muted">4th September 2002 08:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>DLs</strong><br>I took a look at the code which performs a HTTP download, and while it looks complete, it seems excessively complicated. URLMon exports a single function which will perform a file download, and adding a reference to it adds just 500 bytes to the installer... much less than the NSISDL.dll, which is ~15kb.<br><br>I would think that downloads and decompression are something central enough to make it into the engine itself.<br><br>Thanks for the feedback!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">4th September 2002 08:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Is this function exported from WinInet.dll?<br>As far as I know NSISdl didn't use it deliberately because it is slow and heavy. NSISdl uses Nullsoft's JNet-lib, which uses socks for fast operations.<br><br>I don't think these functions are crucial enough to be included in the "engine". NSIS 2 provides a very easy way to call DLL functions by Sunjammer. Just write them as any other functions and NSIS will inculde the file, extract and delete it for you.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bayden</span><br><span class="post-time small text-muted">4th September 2002 10:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Actually, it's exported by URLMon. URLMon is always loaded in Windows and has shipped since IE3.<br><br>I've got both compression and download in my installer for a &lt;1kb increase in output size.<br><br>But I agree, the DLL system is great, and its good that it's there.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">fastfreeware</span><br><span class="post-time small text-muted">10th September 2002 05:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Download code in NSIS</strong><br>Thanks, this is very good if there is download code<br>already in the NSIS installer. I will use it, but<br>I have two additional questions:<br><br>1) Does anyone know if the DLL's<br>specified allow you to gauge progress of the download,<br>so I can generate a status bar (this would be from VB).<br><br>2) I would imagine that this would let my installer<br>check to see whether certain mandatory libraries are<br>available, and download the ones that are not. I<br>also hope to use this to check to see if certain<br>optional libraries for my APP are already installed,<br>and download them based on a user dialog (explaining<br>how long it will take, etc).<br><br>--For non-system files, I will use a file existence test.<br>But how do I do this for system files?<br><br>Can I write a script that tests the date and/or the<br>Windows Version of a DLL? The issue here is I need<br>to make sure the user has a consistent version of<br>the database libraries jet 3.5 and dao 3.51.<br><br>-rc</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bayden</span><br><span class="post-time small text-muted">10th September 2002 05:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Limits...</strong><br>My code does not support a progress bar, unfortunately. It would require wrapping an ugly COM interface, and since C++ is not my native language, I decided to pass.<br><br>With regard to checking system libraries-- My code checks Delphi libraries only, sorry.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">10th September 2002 06:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">NSISdl uses a progress bar if quiet mode is not used.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">fastfreeware</span><br><span class="post-time small text-muted">10th September 2002 16:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Great -- this clarifies what I want my script to do (it<br>installs a free database software program for nonprofits).<br><br>But I am not sure if there is a way to combine the<br>behavior of UpgradeDLL with NSISdll. That's really<br>want I want to do. The installer will include the<br>items that most users have. If the installation<br>takes place on an old pc, I want to have UpgradeDLL<br>obtain the required files from the internet, so that<br>they don't have to be part of the install package.<br><br>So if I can detect that the user is running an old<br>version of Windows95 (lacking MSVCRT.DLL or a newer<br>version of OLEAUT32.DLL), I can have the script end<br>with 2 possible scenarios (user dialogues):<br><br>1) ODB was installed successfully. Do you want to<br>run the program now?<br><br>2) ODB was installed, but before you run the program<br>you will some updates to Windows. Would you like to<br>automatically download and install them now? (Make sure your internet connnection is active before clicking Yes.)<br><br>Can a combination of UpgradeDLL and NSISdl.dll handle<br>this functionality? Do I need to use GetDLLVersion instead?<br>Any sample scripts I can refer to?<br><br>-rc</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">10th September 2002 16:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Edit the updgrade DLL macro you have to move after reboot from the place you tell him (where you have downloaded the file to) instead of extracting it and moving the extracted file on reboot.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">saritha</span><br><span class="post-time small text-muted">29th July 2004 06:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">how to use nsisdl to download a file from http:\abc.com \t.zip and how to extract a zip file</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>