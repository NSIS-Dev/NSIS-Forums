<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Is it unloading the files or what?"><title>Is it unloading the files or what? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Is it unloading the files or what?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=294609">Is it unloading the files or what?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">shanetracer</span><br><span class="post-time small text-muted">16th July 2008 11:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Is it unloading the files or what?</strong><br>I found this code on the internet and have been trying to get it to work:<br><br>## Sections Group 1<br>SectionGroup /e "Program #1" PROG1<br>Section "Main" SEC1<br>##All the files in Group 1 will be installed to the same location, $INSTDIR<br>SetOutPath "$INSTDIR"<br>## Main files to install here<br><br>messagebox mb_ok sec1<br><br>SectionEnd<br><br>Section "Other" SEC2<br>## Other files to install here<br><br>messagebox mb_ok sec2<br><br>SectionEnd<br><br>SectionGroupEnd<br><br>## Sections Group 2<br>SectionGroup /e "Program #2" PROG2<br><br>Section "Main" SEC3<br>##All the files in Group 2 will be installed to the same location, $INSTDIR<br>SetOutPath "$INSTDIR"<br>## Main files to install here<br><br>messagebox mb_ok sec3<br><br>SectionEnd<br><br>Section "Other" SEC4<br>## Other files to install here<br><br>messagebox mb_ok sec4<br><br>SectionEnd<br><br>SectionGroupEnd<br><br>##===========================================================================<br>## Settings<br>##===========================================================================<br><br>!define PROG1_InstDir "C:\PROG1"<br>!define PROG1_StartIndex ${PROG1}<br>!define PROG1_EndIndex ${SEC2}<br><br>!define PROG2_InstDir "C:\PROG2"<br>!define PROG2_StartIndex ${PROG2}<br>!define PROG2_EndIndex ${SEC4}<br><br>##===========================================================================<br>## Please don't modify below here unless you're a NSIS 'wiz-kid'<br>##===========================================================================<br><br>## Create $PLUGINSDIR<br>Function .onInit<br>InitPluginsDir<br>FunctionEnd<br><br>## If user goes back to this page from 1st Directory page<br>## we need to put the sections back to how they were before<br>Var IfBack<br>Function SelectFilesCheck<br>StrCmp $IfBack 1 0 NoCheck<br>Call ResetFiles<br>NoCheck:<br>FunctionEnd<br><br>## Also if no sections are selected, warn the user!<br>Function ComponentsLeave<br>Push $R0<br>Push $R1<br><br>Call IsPROG1Selected<br>Pop $R0<br>Call IsPROG2Selected<br>Pop $R1<br>StrCmp $R0 1 End<br>StrCmp $R1 1 End<br>Pop $R1<br>Pop $R0<br>MessageBox MB_OK|MB_ICONEXCLAMATION "$(NoSectionsSelected)"<br>Abort<br><br>End:<br>Pop $R1<br>Pop $R0<br>FunctionEnd<br><br>Function IsPROG1Selected<br>Push $R0<br>Push $R1<br><br>StrCpy $R0 ${PROG1_StartIndex} # Group 1 start<br><br>Loop:<br>IntOp $R0 $R0 + 1<br>SectionGetFlags $R0 $R1 # Get section flags<br>IntOp $R1 $R1 &amp; ${SF_SELECTED}<br>StrCmp $R1 ${SF_SELECTED} 0 +3 # If section is selected, done<br>StrCpy $R0 1<br>Goto Done<br>StrCmp $R0 ${PROG1_EndIndex} 0 Loop<br><br>Done:<br>Pop $R1<br>Exch $R0<br>FunctionEnd<br><br>Function IsPROG2Selected<br>Push $R0<br>Push $R1<br><br>StrCpy $R0 ${PROG2_StartIndex} # Group 2 start<br><br>Loop:<br>IntOp $R0 $R0 + 1<br>SectionGetFlags $R0 $R1 # Get section flags<br>IntOp $R1 $R1 &amp; ${SF_SELECTED}<br>StrCmp $R1 ${SF_SELECTED} 0 +3 # If section is selected, done<br>StrCpy $R0 1<br>Goto Done<br>StrCmp $R0 ${PROG2_EndIndex} 0 Loop<br><br>Done:<br>Pop $R1<br>Exch $R0<br>FunctionEnd<br><br>## Here we are selecting first sections to install<br>## by unselecting all the others!<br>Function SelectFilesA<br><br># If user clicks Back now, we will know to reselect Group 2's sections for<br># Components page<br>StrCpy $IfBack 1<br><br># We need to save the state of the Group 2 Sections<br># for the next InstFiles page<br>Push $R0<br>Push $R1<br><br>StrCpy $R0 ${PROG2_StartIndex} # Group 2 start<br><br>Loop:<br>IntOp $R0 $R0 + 1<br>SectionGetFlags $R0 $R1 # Get section flags<br>WriteINIStr "$PLUGINSDIR\sections.ini" Sections $R0 $R1 # Save state<br>!insertmacro UnselectSection $R0 # Then unselect it<br>StrCmp $R0 ${PROG2_EndIndex} 0 Loop<br><br># Don't install prog 1?<br>Call IsPROG1Selected<br>Pop $R0<br>StrCmp $R0 1 +4<br>Pop $R1<br>Pop $R0<br>Abort<br><br># Set current $INSTDIR to PROG1_InstDir define<br>StrCpy $INSTDIR "${PROG1_InstDir}"<br><br>Pop $R1<br>Pop $R0<br>FunctionEnd<br><br>## Here we need to unselect all Group 1 sections<br>## and then re-select those in Group 2 (that the user had selected on<br>## Components page)<br>Function SelectFilesB<br>Push $R0<br>Push $R1<br><br>StrCpy $R0 ${PROG1_StartIndex} # Group 1 start<br><br>Loop:<br>IntOp $R0 $R0 + 1<br>!insertmacro UnselectSection $R0 # Unselect it<br>StrCmp $R0 ${PROG1_EndIndex} 0 Loop<br><br>Call ResetFiles<br><br># Don't install prog 2?<br>Call IsPROG2Selected<br>Pop $R0<br>StrCmp $R0 1 +4<br>Pop $R1<br>Pop $R0<br>Abort<br><br># Set current $INSTDIR to PROG2_InstDir define<br>StrCpy $INSTDIR "${PROG2_InstDir}"<br><br>Pop $R1<br>Pop $R0<br>FunctionEnd<br><br>## This will set all sections to how they were on the components page<br>## originally<br>Function ResetFiles<br>Push $R0<br>Push $R1<br><br>StrCpy $R0 ${PROG2_StartIndex} # Group 2 start<br><br>Loop:<br>IntOp $R0 $R0 + 1<br>ReadINIStr "$R1" "$PLUGINSDIR\sections.ini" Sections $R0 # Get sec flags<br>SectionSetFlags $R0 $R1 # Re-set flags for this sec<br>StrCmp $R0 ${PROG2_EndIndex} 0 Loop<br><br>Pop $R1<br>Pop $R0<br>FunctionEnd<br><br>## Here we are deleting the temp INI file at the end of installation<br>Function DeleteSectionsINI<br>Delete "$PLUGINSDIR\Sections.ini"<br>FlushINI "$PLUGINSDIR\Sections.ini"<br>FunctionEnd<br><br>Whenever I add more than two sections to sectiongroup 2 and don't select group 1 in the setup itself, it does not jump to sectiongroup 2 without displaying some sort of status bar. It looks like it's installing the components of sectiongroup 1. How do I get rid of this step?<br><br>Cheers<br><br>Rich</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pospec</span><br><span class="post-time small text-muted">16th July 2008 11:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">How do we get rid of reading such a huge posts?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">shanetracer</span><br><span class="post-time small text-muted">16th July 2008 12:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Anything smart to say or just moaning?<br><br></p><blockquote><i>Originally posted by pospec</i><br><b>How do we get rid of reading such a huge posts?</b></blockquote></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>