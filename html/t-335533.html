<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="LineFind : discovering an existing line that starts with a dedecated string: HOW?" />

  <title>LineFind : discovering an existing line that starts with a dedecated string: HOW? - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">LineFind : discovering an existing line that starts with a dedecated string: HOW?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=335533">LineFind : discovering an existing line that starts with a dedecated string: HOW?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">within</span><br />
      <span class="post-time small text-muted">3rd October 2011 13:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>LineFind : discovering an existing line that starts with a dedecated string: HOW?</strong><br />
      Hi there,<br />
      <br />
      I'd wish to modify a text file only if a dedicated string in this file is NOT written there already.<br />
      <br />
      I'd like to compare each lines in a file to check if this line starts with a dedicated string, let's say a line can be:<br />
      'user is defined as blabla'<br />
      <br />
      and string to use for check is 'user'.<br />
      <br />
      so, as soon as, within a file, the script does find a line that starts with 'user' it will stop and goto another part of the script that will do 'action 1', or if it does not find any line that starts with the string 'user', it will do 'action 2'.<br />
      <br />
      I thought I could use ${LineFind} "[File1]" "[File2|/NUL]" "[LineNumbers]" "Function"<br />
      <br />
      but I have some difficulties for the 'Function', and compare process...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">3rd October 2011 13:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ClearErrors<br />
      FileOpen $0 $INSTDIR\file.dat r<br />
      IfErrors notfound<br />
      loop:<br />
      FileRead $0 $1<br />
      IfErrors goto notfound<br />
      StrCpy $2 $1 4<br />
      StrCmp $2 "user" bingo<br />
      goto loop<br />
      end:<br />
      FileClose $0<br />
      notfound:<br />
      MessageBox MB_OK "Not found."<br />
      goto done<br />
      bingo:<br />
      MessageBox MB_OK "Found."<br />
      goto done<br />
      done:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">within</span><br />
      <span class="post-time small text-muted">3rd October 2011 16:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks very much MSG for your code!<br />
      <br />
      I'll test it tomorrow.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">3rd October 2011 20:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Oh, and you should always FileClose. So you could move that to below the done label, I guess.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">within</span><br />
      <span class="post-time small text-muted">4th October 2011 09:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Indeed, the FileClose was not at the best positon. I had to add anothyer one too, depending on conditions.<br />
      <br />
      here is my code:<br />
      <br /></p>
      <pre>
<code>Section SecSetServ<br /><br />        ; check if Environement variable is already defined<br />        ClearErrors<br />        FileOpen $0 "$WINDIR\system32\drivers\etc\services" a         ; Open mode is  "a" for append<br />        IfErrors notfound<br />        loop:<br />        FileRead $0 $1<br />        IfErrors notfound<br />        StrCpy $2 $1 4<br />        StrCmp $2 "user" found<br />        Goto loop<br />        notfound:<br />        Goto done<br />        found:<br />        Goto finished<br />        done: <br />        FileClose $0<br />  ; Modify system files ("service" files)<br />  Call SysFiles                                         <br />  Goto veryend<br /><br />  finished:<br />  FileClose $0<br />  ${GetTime} "" "L" $0 $1 $2 $3 $4 $5 $6<br />  Push "$2/$1/$0 $4:$5:$6 [INSTALL] - Services ports ALREADY defined.$\r$\n $\r$\n" ;text to write to file <br />  Push "$INSTDIR\_setup.log" ;file to write to <br />  Call WriteToFile<br /><br />  veryend:<br />  <br />SectionEnd</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">within</span><br />
      <span class="post-time small text-muted">4th October 2011 10:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">tested with success!<br />
      <br />
      Thanks MSG</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">4th October 2011 12:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Next up: Using LogicLib instead of Strcmp and goto's. :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">within</span><br />
      <span class="post-time small text-muted">4th October 2011 14:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I didn't know about this one; looks cool. Thanks for the tip!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
