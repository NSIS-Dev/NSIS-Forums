<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="RunAs administrator then execute as desktop user"><title>RunAs administrator then execute as desktop user - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">RunAs administrator then execute as desktop user</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=303567">RunAs administrator then execute as desktop user</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">umeca74</span><br><span class="post-time small text-muted">27th February 2009 11:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>RunAs administrator then execute as desktop user</strong><br>Hi<br><br>I have this situation for PRE-vista installations. If a normal user wants to install, I force him to use runas with admin privileges, so the installer runs elevated compared to the desktop logged user.<br><br>Q1. How do I know that this is the case? (ie differentiate runas vs normal admin user)<br><br>If my installer detects this is the case then it needs to run a step using the desktop user credentials. Is there any way to do this? (I have looked at UAC plugin but I don't think it would work under this scenario - it needs the installer to start as the desktop user?)<br><br>what I need is CreateProcessAsUser equivalent for NSIS<br><br>thanks<br>nikos</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">27th February 2009 12:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I don't 100% understand what you mean, but using the uac plugin (calling UAC::ExecCodeSegment) should be able to do what you need</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">v_automation</span><br><span class="post-time small text-muted">27th February 2009 12:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Re: RunAs administrator then execute as desktop user</strong><br>Hi<br><br>Setting RequestExecutionLevel to highest will ask user for admin rights if user is from admin group, but install will continue with normal user rights if user is normal user, but not admin and cannot run applications with admin rights</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">umeca74</span><br><span class="post-time small text-muted">28th February 2009 07:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">can UAC work in this scenario in "old" windows? (before vista)<br><br>* NORMAL user starts the installer with "runas" to elevate<br><br>* the installer runs as admin but some portions of it use the desktop user<br><br>from my understanding how UAC works, it finds out who the desktop user is when it is first launched as the desktop (ie. normal) user</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">v_automation</span><br><span class="post-time small text-muted">28th February 2009 11:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">To run as desktop user means you cannot modify registry keys except these in HKCU and cannot access system files and folders.<br><br>So you decide what will do your installer when it is started from whatever account type.<br><br>If your installer edit registry keys only in KHCU and does not copy files in system folders then no matter it is started with admin rights is will be limited to access rights of normal user<br><br>To check if installer is started with admin rights or with rights of normal user, you can try to access some registry key or folder that is not available for normal user (for example $SYSDIR). If key/folder can be accessed your installer is started with admin rights. If you get error then installer is started from normal user account</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yathosho</span><br><span class="post-time small text-muted">28th February 2009 14:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">a while ago i tried to build a fake-uac (via nsDialogs) for pre-vista windows, but i had problems when a user had an empty password. sorry, i don't recall the exact the scenario, but there were similiar problems - which made me abandon the idea at some point.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">28th February 2009 15:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">the UAC plugin works on ANY version of windows, the part where it actually elevates and uses two processes works on 2000 and later.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">umeca74</span><br><span class="post-time small text-muted">28th February 2009 16:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>the UAC plugin works on ANY version of windows, the part where it actually elevates and uses two processes works on 2000 and later</blockquote>you are the author of this plugin, right? who will ask the user for elevation, your plugin or the user beforehand? As I said if the user before launching the installer uses runas to elevate himself, then the link to the "normal" desktop user will be lost, wouldn't it? Even if your plugin uses 2 processes they will both be elevated. If not, can you tell me how you figure out the desktop user?<br><br>thanks<br>nikos</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">28th February 2009 16:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">yes, if the user does runas first, then the game is over, but you should not fight this, its the users choice, you don't know which user they really want to install as...</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>