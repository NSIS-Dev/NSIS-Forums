<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="AddToPath bug?" />

  <title>AddToPath bug? - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">AddToPath bug?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=224261">AddToPath bug?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dblock</span><br />
      <span class="post-time small text-muted">19th August 2005 14:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>AddToPath bug?</strong><br />
      I am trying to use AddToPath.<br />
      <br />
      1. If PATH is not set for the user AddToPath returns an error. Is this a known bug? Am I doing something wrong?<br />
      <br />
      2. Is there a way to use the current function to set path in HKLM?<br />
      <br />
      3. It looks like if the PATH is in the current environment it will not be added. It may have been a leftover from some other process (previous aborted installation?), but not added to the registry. This is probably wrong.<br />
      <br />
      Thx<br />
      dB.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">19th August 2005 16:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <ol style="list-style-type: decimal">
        <li>How does it return an error?</li>

        <li>AddToPath already sets the variable in the registry, if running on NT.</li>

        <li>I don't understand. What do you mean by the current environement? How can a variable be left over from another process?</li>
      </ol>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dblock</span><br />
      <span class="post-time small text-muted">19th August 2005 16:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'll try to be more clear ;)<br />
      <br />
      1. It fails and sets an error. I didn't dig into why.<br />
      <br />
      2. There're two sets of PATHs in Windows, your personal path and the system path. It sets the personal path. I want to set the system path.<br />
      <br />
      3. Let me describe a better real world scenario.<br />
      - I have an installer that does AddToPath c:\foobar.<br />
      - I already have c:\foobar in HKCU, but the installer sets path in HKLM.<br />
      - My current environment is a combination of HKLM and HKCU, hence the installer will never set the HKLM path, which is wrong.<br />
      <br />
      Thx<br />
      dB.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">19th August 2005 16:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <ol style="list-style-type: decimal">
        <li>The function wasn't designed so you can use IfErrors to check for errors after it ran. How exactly does it fail? Does it just set the error flag? Does it write the new value to the registry but doesn't notify about the change? Does it skip writing the new value at all?</li>

        <li>Define ALL_USERS before including the header file.</li>

        <li>It's a combination of both and because of that, you already have that path in the PATH variable. That's why it doesn't add it.</li>
      </ol>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dblock</span><br />
      <span class="post-time small text-muted">19th August 2005 21:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the replies.<br />
      <br />
      1. How exactly am I supposed to check for errors? The functions sets the error flag. It does not write the value to the registry.<br />
      <br />
      2. I have to also add a path to HKCU. I can't have both I presume. I guess I'll have to fork that function...<br />
      <br />
      3. Well this seems plain wrong from what the installer is trying to accomplish. I need to set the path for all users, not just for the current user installing the application.<br />
      <br />
      Thx<br />
      dB.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">19th August 2005 22:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <ol style="list-style-type: decimal">
        <li>You're not supposed to. I didn't think of this issue when I wrote it. As for the problem again, I realized I don't really understand it. What do you mean by the PATH not being set? I originally thought you meant the PATH key doesn't exist in the registry key, but that shouldn't be a problem.</li>

        <li>Indeed, you can't have both. You can create two copies of the header with different function names. I think there's also a function in the Wiki that accepts this setting on the stack and not as a define. It might be for general environment variables though and not PATH specifically.</li>

        <li>Then remove the check :)</li>
      </ol>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
