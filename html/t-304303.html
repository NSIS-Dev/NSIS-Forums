<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Backup before install" />

  <title>Backup before install - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Backup before install</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=304303">Backup before install</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Farewellx</span><br />
      <span class="post-time small text-muted">17th March 2009 20:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Backup before install</strong><br />
      hey guys,<br />
      <br />
      need help, iÂ´m trying to make a script which does a backup of the directory like c:\test to c:\testbackup, it should do that automaticly and it should pop up a confirmation ... all that should happen before it starts to install my files, which are in an zip file.... is that possible?<br />
      <br />
      thanks =)<br />
      <br />
      <br />
      <br />
      <br />
      p.s. excuse me for my poor english, my german is much better =)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">17th March 2009 21:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">yes - it's possible<br />
      no - it's not easy<br />
      <br />
      one solution...<br />
      1. extract all folders and files to a temp location (not in $TEMP, lest that gets auto-cleared)<br />
      2. loop over those folders and files (several functions available)<br />
      3. check if a given file already exists in the destination folder<br />
      4. if it does, rename that file to a backup location<br />
      5. then rename the file from your temp location to the destination location<br />
      <br />
      There's others, but the above is reasonably easy to execute :|<br />
      <br />
      ( like I mentioned in another thread.. a callback for File/etc. would be awesome )</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Farewellx</span><br />
      <span class="post-time small text-muted">17th March 2009 23:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">so there is no way to do that directly, click a button and the given folder copies to the backup folder?<br />
      i found this link <a href="http://nsis.sourceforge.net/Backup_files_on_install,_restore_on_uninstall" target="_blank">http://nsis.sourceforge.net/Backup_f...e_on_uninstall</a> but i really donÂ´t know how to import this macro to nsis<br />
      <br />
      !insertmacro BackupFile "Dir with file in it" "File" "Backup to"<br />
      <br />
      lilke: !insertmacro BackupFile "c:\test" "Backup to" "c:\test\backup"<br />
      <br />
      thanks =)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">zeeh3</span><br />
      <span class="post-time small text-muted">17th March 2009 23:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This macro only works for files, not folders.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Farewellx</span><br />
      <span class="post-time small text-muted">17th March 2009 23:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">the link is shown as "URL submitted by user" hope you can see it anyway...<br />
      <br />
      if not here it is insis.sourceforge.net/Backup_files_on_install,_restore_on_uninstall</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Farewellx</span><br />
      <span class="post-time small text-muted">17th March 2009 23:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">damn ... this one: nsis.sourceforge.net/Backup_files_on_install,_restore_on_uninstall<br />
      <br />
      thanks =)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">zeeh3</span><br />
      <span class="post-time small text-muted">17th March 2009 23:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Maybe calling SHFileOperation with system plugin can solve the problem.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">18th March 2009 02:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">well, the main problem with most of these headers is that you have to explicitly name every file.<br />
      <br />
      So if you use a File command that includes multiple files (for example, you have a folder called "documentation", and within it is a few hundred html+jpg+gif images as your docs, and you include it as 'File "documentation\*.*"'), you're SOL.<br />
      <br />
      You'd have to first build an include file using another installer that actually grabs the list of files that would be included, and spits out separate File (or in this case BackupFile) commands.<br />
      <br />
      Absolutely doable.. and absolutely annoying :\</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TobbeSweden</span><br />
      <span class="post-time small text-muted">18th March 2009 08:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I don't get it. Why can't you just do something like this?<br /></p>
      <pre>
<code>CopyFiles "C:\folder\*" "C:\folder_backup\"</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">18th March 2009 12:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Typically because you don't want to back up -all- files - just the ones you're updating/overwriting. E.g. say you're writing a mod for a game that replaces some of the model, graphics and sound files. Do you then want to back up all 7GB, even if you're only replacing, say, 200MB?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TobbeSweden</span><br />
      <span class="post-time small text-muted">18th March 2009 12:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes of course I understand that there is a need for something like that too, but didn't Farewellx specifically say he wanted to copy a whole directory to a backup location? Or did I misread that?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">18th March 2009 12:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">true that, TobbeSweden; although he didn't specify 'whole' explicitly, I suppose that is indeed all he might need :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Farewellx</span><br />
      <span class="post-time small text-muted">18th March 2009 13:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hey guys, yes the installer should copy the hole folder with all the files and subfolders</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Farewellx</span><br />
      <span class="post-time small text-muted">18th March 2009 13:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hey guys, sry for the double post again...<br />
      <br />
      i wouldnÂ´t need an nsis script if it would be possible to click the installer:<br />
      1. run my .BAT file which copies the folder/files/subf. to the right destination<br />
      2. and after that the the installer actually starts the installing process ...<br />
      <br />
      this would also solve my problem<br />
      <br />
      thx =)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">njshaw2</span><br />
      <span class="post-time small text-muted">20th March 2009 15:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Couldn't you just use NSIS' "Rename" function? That can rename a directory to another name (on the same drive), e.g.:<br />
      <br />
      Rename "C:\test" "C:\testbackup"<br />
      <br />
      That would do the job, providing you wanted the entire folder contents (including sub-folders) moved.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Farewellx</span><br />
      <span class="post-time small text-muted">23rd March 2009 00:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">the user must choose the folder before rename it or what ever ... thats what i am looking for ... user chooses the folder, clicks NEXT and the installer renames the folder automaticly to _backup</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
