<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="How to pass LOCALFILE to Library.nsh as a variable" />

  <title>How to pass LOCALFILE to Library.nsh as a variable - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">How to pass LOCALFILE to Library.nsh as a variable</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=208430">How to pass LOCALFILE to Library.nsh as a variable</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jsbach</span><br />
      <span class="post-time small text-muted">21st February 2005 14:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>How to pass LOCALFILE to Library.nsh as a variable</strong><br />
      i wish to pass a dynamic foldername to upgrade all its DLLs/OCXs but i'm getting the error:<br />
      '!error: InstallLib 1: The library $5\$1 could not be found.<br />
      Error in macro InstallLib on macroline 89'.<br />
      <br />
      Even tried to !define a custom var (i.e. var MyVar) and use it (with StrCpy $MyVar "c:\sourcedir": no way.<br />
      I've read almost all relevant posts in this forum but i must admit i can't still understand where the issue is: i would really appreciate just some hints.<br />
      Here below the abstract of the code i'm using.<br />
      Thanks in advance.<br />
      <br />
      ;test upgrade all dll in a given folder<br />
      !include Library.nsh<br />
      var ALREADY_INSTALLED<br />
      name "Get files test"<br />
      outfile "testgetfiles.exe"<br />
      InstallDir "$PROGRAMFILES\MyTest"<br />
      <br />
      Section -DoIt<br />
      push "c:\sourcedir\winlib"<br />
      call GetFiles<br />
      SectionEnd<br />
      <br />
      Function GetFiles<br />
      Exch $5<br />
      FindFirst $0 $1 "$5\*.*"<br />
      loop:<br />
      StrCmp $1 "" done<br />
      StrCmp $1 "." readnext<br />
      StrCmp $1 ".." readnext<br />
      ifFileExists "$5\$1" 0 readnext<br />
      StrCpy $ALREADY_INSTALLED 1<br />
      !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_NOTPROTECTED "$5\$1" "$SYSDIR\$1" "$SYSDIR"<br />
      readnext:<br />
      FindNext $0 $1<br />
      Goto loop<br />
      done:<br />
      FindClose $0<br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jsbach</span><br />
      <span class="post-time small text-muted">22nd February 2005 17:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>addin...</strong><br />
      forgot mention: the parameter 'localfile' in library.nsh is used 'as is'. on the contrary, destfile and tempbasedir are converted to variables ($r4/$r5).<br />
      I tried to !define in the script a compile var and use it in the Installib line (${dllpath}\$1 instead of $5\$1).<br />
      Error is the same.<br />
      What am i missing, if the case ?<br />
      thanks to anybody would help.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">22nd February 2005 18:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The issue is that localfile expects a local file name. The compiler can't predict which files the installer will find at runtime. It can't guess which files it needs to compress.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jsbach</span><br />
      <span class="post-time small text-muted">22nd February 2005 23:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>yes but thonk to UpgradeDLL_Function...</strong><br />
      thanks for quick reply, kichik.<br />
      I understand what you mean, however: should not this apply also to 'destfile' ?<br />
      Let me explain my target. i'm writing a wizard to auto generate scripts from a given source structure. i've two options: 1. create the 'File ...' lines step by step as soon my wizard recurse the folders; 2. call GetFiles function to recursively 'File...' AND 'InstallLib...' on each file the wizard finds (of course, Installib is called only if .OCX,.DLL,.TLB are detected).<br />
      Well, i found in this forum the post by mr. Opher Shachar with the function 'UpgradeDLL_Func' which seems to do exactly that job. I'm not using it for two reasons: first i'm not able to find the necessary include 'PathManip.nsh'; second, Library.nsh seems to be more feasible.<br />
      I would like to use this library, but i can't pass the dynamic folders as they're processed by the GetFiles function.<br />
      Why it is not possible to manage the 'localfile' parm the same way as 'destfile' ? Sorry, this is not clear to me.<br />
      thanks.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jsbach</span><br />
      <span class="post-time small text-muted">24th February 2005 00:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>folders can be dynamically passed...</strong><br />
      after some testing, i see now that folders can be assigned dynamically using !define. The compiler now gives error only on the filename (still a user var, this is my mistake).<br />
      Don't understand why files are treated in different way than folders; anycase, it's not an elegant (partial) solution as i have to !undef / !define the same 'source_dll_path' inside the folder recursion loop.<br />
      Guess no solution at present...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">24th February 2005 18:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">destfile doesn't contain a path of a local file that needs to be compressed into the installer while localfile does. destfile tells the Library macro where to put the file. That doesn't affect which files it needs to compress. It can be totally dependent on how the script runs on the user's machine.<br />
      <br />
      With localfile, it's a completely different story. The compiler can't run the script on your machine, while compiling it, in order to find out which files it needs to compress. Even if it could run the script somehow, it can't predict which values the registers will contain on the user's machine. It can't predict which files it needs to compress. You must specify them explicitly.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
