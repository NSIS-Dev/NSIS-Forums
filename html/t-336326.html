<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Read an ini file during installation"><title>Read an ini file during installation - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Read an ini file during installation</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=336326">Read an ini file during installation</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">wagner1308</span><br><span class="post-time small text-muted">20th October 2011 21:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Read an ini file during installation</strong><br>I am new to nsis<br><br>I want the installer read an ini file before starting the installation.<br>Ini file that will have the following information Name of the installation folder, name for shortcuts among other things.<br>With this I can have four variations of my applications eg software1.1, software1.2, software1.3, software1.4<br>And it will not need to have an installer for each application for the changes to the installer will be the destination folder and different shortcuts.<br>Does anyone have idea how I can do this?<br><br>best regards<br>Wagner.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br><span class="post-time small text-muted">20th October 2011 21:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Start by reading the documentation:<br><a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.2" target="_blank">http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.2</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">wagner1308</span><br><span class="post-time small text-muted">21st October 2011 10:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I believe that right did not explain what I do.<br>This is how I have a product installer, the installer will with an ini file. When running the installer will read the ini file and picked up some information, such as the installation folder and more.<br>reading the documentation I saw the property ReadINIStr<br>eg ReadINIStr $ 0 $ INSTDIR \ winamp winamp.ini outname<br>But my problem is I'm not keeping a fixed place, where is the ini file.<br>I have to make the installer look for an ini file when it runs and if he does not have the ini file to install a default installation of the product?<br><br>I remember that my product has many Ex versions: Standard, Professional<br><br>I know I'm not sure I could explain what I do.<br>But thanks to which I responded</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">21st October 2011 10:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">1) You can use FindFirst/FindNext to find all .ini files in a certain directory. <a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.5.12" target="_blank">http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.5.12</a><br>2) You can use ReadIniStr to read from an ini file.<br>3) To set the default installation directory, simply do the following in the .onInit function: StrCpy $INSTDIR "C:\Your\Path"<br><br>With this information, you should be able to figure out how to do it.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br><span class="post-time small text-muted">21st October 2011 12:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Does it really have to be that complicated?<br><br>Why not put the INI file into the same folder as the "Setup.exe", e.g. as "Setup.ini".<br><br>You could then simply read from the "$EXEDIR\Setup.ini" file...<br><br><br>Though I would think about a different option:<br><br>Instead of using an INI file to read the info at <i>install-time</i>, you can use Macros and set the info a <i>compile-time</i>!<br><br>This way you still had to compile a different installer EXE for each product, but it could be done in a 100% automated way.<br><br>The info that differs between different products could simply be passed to MaskeNSIS.exe via CLI parameters...<br><br>(Not more work than creating an INI file for each product and no runtime dependency on the INI file)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">wagner1308</span><br><span class="post-time small text-muted">21st October 2011 17:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">that was what I was looking for, you think your place in the ini file "$EXEDIR" will be possible for me to copy the imformation I need.<br>The matter of this macro I do not quite understand, I have little knowledge of nsis.<br>Well, I'll try to use the "$EXEDIR" with ReadIniStr. If I have problems I'll post here.<br>Thank you friends</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br><span class="post-time small text-muted">21st October 2011 17:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Normally you would use something like this to create shortcuts:<br><br><font face="Lucida Console">CreateDirectory "$SMPROGRAMS\My Company"<br>CreateShortCut "$SMPROGRAMS\My Company\My Program.lnk" "$INSTDIR\My Program.exe"</font><br><br><br>With Macros you could replace the hardcoded strings like this:<br><br><font face="Lucida Console">CreateDirectory "$SMPROGRAMS\<font color="DarkRed">${CompanyName}</font>"<br>CreateShortCut "$SMPROGRAMS\<font color="DarkRed">${CompanyName}</font>\<font color="DarkRed">${ProgramName}</font>.lnk" "$INSTDIR\My Program.exe"</font><br><br><br>These would then be defined at the top of your NSI file like:<br><br><font face="Lucida Console">!define CompanyName "My Company"<br>!define ProgramName "My Program"</font><br><br><br>Either that, or you pass them directly to the NSIS compiler as arguments:<br><br><font face="Lucida Console">makensis.exe "<b>/D</b>CompanyName=My Company" "<b>/D</b>ProgramName=My Program" Installer.nsi</font><br><br><br>In the latter case, it would be advisable to add checks like this to your NSI file:<br><br><font face="Lucida Console">!ifndef CompanyName<br>!error "CompanyName is undefined!"<br>!endif</font></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">wagner1308</span><br><span class="post-time small text-muted">21st October 2011 19:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">my friends<br>Can you make more or less what it wanted.<br>Using $EXEDIR with ReadINIStr.<br><br>But I'm not happy because my idea was to generate a single installer and when it is executed with an ini file the installer would get the information MenuGroup shortcut name and then I would just burn a CD with an installer and an ini file. if no ini file it installs the product with the settings that are already defined in the installer.<br>Now so I could do with using $EXEDIR ReadINIStr I'll have to change the installer to insert five ini files:<br>are: Standard, Professional, Professional Plus, Advanced, Special<br><br>How could I fix it?<br><br>Thank you!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br><span class="post-time small text-muted">21st October 2011 20:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Fix what? :confused:</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">msroboto</span><br><span class="post-time small text-muted">21st October 2011 20:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">How about you create one installer and 5 zip files that contain the right .ini file?<br>Standard.zip Professional.zip etc.<br><br>They download the right installer however you do that they unzip and you read the right .ini file. Alternatively, you create one installer that requires the .ini and you mail them the .ini or have some other way to get it.<br>Same idea they have to have the setup.exe and the .ini in the same directory.<br><br>None of these methods is foolproof. The .ini can be easily traded for sure.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">wagner1308</span><br><span class="post-time small text-muted">24th October 2011 11:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">the installer can read a file, where I do not have to specify the file path or put the file in EXEDIR.<br>The installer could read at the level where it is? the local directory?, so I could check if the file exists then read ini settings and picks.<br>If there is no ini file then installs with pre-existing settings.<br>Thanks for the help everyone.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">24th October 2011 13:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">What do you mean with 'the local directory'?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br><span class="post-time small text-muted">24th October 2011 13:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by wagner1308</small><br>the installer can read a file, where I do not have to specify the file path or put the file in EXEDIR.<br>The installer could read at the level where it is? the local directory?, so I could check if the file exists then read ini settings and picks.<br>If there is no ini file then installs with pre-existing settings.</blockquote>$EXEDIR refers to the directory where the installer executable (e.g. Setup.exe) is located. This is determined <i>at run-time</i>. Read "$EXEDIR\Setup.ini" and you will be reading the "Setup.ini" that is located in the very same directory where the "Setup.exe" is located, regardless of what directory that is. You can of course check for the existence of "$EXEDIR\Setup.ini" before you do that.<br><br>Was that your question? :confused:</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">wagner1308</span><br><span class="post-time small text-muted">25th October 2011 10:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">this explanation was that I lacked it worked, did not understand.<br>Thank you friends</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>