<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Strategy for Uninstallers?"><title>Strategy for Uninstallers? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Strategy for Uninstallers?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=213006">Strategy for Uninstallers?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">aekalman</span><br><span class="post-time small text-muted">12th April 2005 18:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Strategy for Uninstallers?</strong><br>Coming from InstallerVISE, I'm having a wee bit of trouble with NSIS' uninstaller strategy. InstallerVISE keeps track of every single file it installs, and then removes them based on the entries in a log file.<br><br>With my NSIS installer &amp; uninstaller, I do not want to delete entire directories / folders that I install my files to, even if I was the one who created those folders. Rather, I just want to delete the exact files that I installed, and no others.<br><br>Currently each group of files is in a unique section in a separate script file, that is then included into the main installer script.<br><br>I should mention that we're talking about lots of files (hundreds to thousands) in many different groups, and so there is no way that I can maintain separate lists of files to be installed and uninstalled. Rather, I want to create each file list once, and use that list to drive the installer and uninstaller.<br><br>So, is the best solution for me to simply include those same section scripts in the uninstaller?<br><br>Seems pretty obvious, but I want to make sure I'm not missing something.<br><br>Also, I'd like to remove each folder that I installed if after removing all of my files inside it, it's now empty. But not if some (user) files remain in that folder. How would I do that?<br><br>Thanks,</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aekalman</span><br><span class="post-time small text-muted">12th April 2005 20:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Uh oh ... I see that NSIS uses <b>File</b> and <b>Delete</b> where each one specifies the filename.<br><br>I would have preferred something like:<br><br>Install<br>File file1<br>File file2<br>File file3<br>InstallEnd<br><br>Uninstall<br>File file1<br>File file2<br>File file3<br>UnInstallEnd<br><br>because it would allow me to use a single file list to handle installs and uninstalls. So now I'm not clear on what I can do to create a single file list in one place, yet use it twice -- once to install, once to uninstall.<br><br>Ther reason why I need to explicitly remove only the files I create is that the user may create their own, useful files in the same directory, and it's imperative that I not delete them, too via a wholesale directory delete.<br><br>Any suggestions?<br><br>--Andrew</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yathosho</span><br><span class="post-time small text-muted">12th April 2005 20:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">i guess you could use some function, that processes a list of all files. i only know of <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=209161" target="_blank">this</a>, but it doesn't work recursively. maybe helps anyway.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Instructor</span><br><span class="post-time small text-muted">12th April 2005 21:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yathosho about what function you post? ("Locate" works recursively)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yathosho</span><br><span class="post-time small text-muted">12th April 2005 22:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">was speaking of <a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=596" target="_blank">MakeFileList</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">13th April 2005 11:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I already wrote something to do all this for you:<br><a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=556" target="_blank">http://nsis.sourceforge.net/archive/...php?pageid=556</a><br><br>I posted this in this topic last night, but it some how failed to get posted!<br><br>Edit: Just updated script to remove folders too (only if those folders are empty of course).<br><br>Edit: Woops posted this before in another toppic by accident!<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Instructor</span><br><span class="post-time small text-muted">13th April 2005 14:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>Edit: Just updated script to remove folders too (only if those folders are empty of course).</blockquote>1. Install order:<br>C:\ftp\a\b\c<br>C:\ftp\a<br>C:\ftp\a\b<br><br>Then you run uninstaller first empty directory will be deleted, but second will not, because it contain other empty directory.<br><br>2. Script will not write to log directories, if user used command "File /r ..."</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aekalman</span><br><span class="post-time small text-muted">13th April 2005 20:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Stu.<br><br>That looks pretty useful -- but while you're at it, could you add some more functionality? Please? :)<br><br>Specifically, the install log ought to record how many times a particular file is installed, and the uninstaller should remove it only when the file "install count" drops to zero.<br><br>E.g. Two installers (call them A and B). They both install to the same directory, and have the same license file, but A installs additional fileGroupA and B installs additional fileGroupB.<br><br>If you uninstall B, you want A's files in fileGroupA to remain (of course), and you also want the license file to remain (it was (also) installed by A, in the same place as B (re-)installed it).<br><br>That sort of functionality would be very, very cool.<br><br>Thanks,<br><br>--Andrew</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">13th April 2005 20:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ahh well that's a lot more complicated, but it's possible and I know how it will be done. I will create a new archive page for it too (so the basic method is left intact for other people to use). However, now I need some relaxing multiplayer killage (because I've been adding more comments on some source code for the last hour).<br><br>I will get your script done tonight though.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">13th April 2005 21:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok I just realised how much code would be needed to get this to work properly and to be honest, it wouldn't be worth the trouble. It'd be much easier to just not extract a file from installer B if that file already exists.<br><br>Updated entire script.<br><br>Instructor:<br>1. Added note about order. Could add more code to check for this problem, but I want to keep this as simple as possible for people.<br>2. There would be no way to get this to work for File /r. That's why you use ${File} in the first place (because File on its own is not enough). It would be possible to allow for this by calling a seperate executable to write code for each file in a folder recursively (like ${SE-AddDir} in my NSIS SFX kit) but again, I want to keep this simple.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aekalman</span><br><span class="post-time small text-muted">13th April 2005 23:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Stu.<br><br>Thanks for the feedback and your work here. I'll go ahead and use what's there for now.<br><br>--Andrew</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aekalman</span><br><span class="post-time small text-muted">7th May 2005 17:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Stu.<br><br>I'm trying to use your script, and I ran into two problems.<br><br>Here's an example of where the macros get called:<br><br>Section "Pro Libraries" SEC_SALVOPROLIBRA430<br><br>SetOverwrite on<br><br>${SetOutPath} "$INSTDIR\Lib\RA430"<br><br>${File} "d:\Pumpkin\Salvo\Lib\RA430\libsalvolra430ia.hza"<br>${File} "d:\Pumpkin\Salvo\Lib\RA430\libsalvolra430id.hza"<br>${File} "d:\Pumpkin\Salvo\Lib\RA430\libsalvolra430ie.hza"<br>${File} "d:\Pumpkin\Salvo\Lib\RA430\libsalvolra430im.hza"<br>${File} "d:\Pumpkin\Salvo\Lib\RA430\libsalvolra430it.hza"<br><br>SectionEnd<br><br><br>where $INSTDIR is C:\Pumpkin_Test.<br><br>This file is included several levels deep in the installer (due to organizational and conditional compilation issues). Note that the files that NSIS installs come from a a large directory tree, and that tree must be preserved on the destination hard disk.<br><br>1) I had to add<br><br>!undef FileID<br><br>as the last line of the File macro, in order to avoid the error message that FileID was already defined (e.g. the second time ${File} is invoked).<br><br>2) The second problem is harder -- You can see that the various files have long path names associated with them.<br><br>Trouble is, those paths are concatenated with the output dir path name in the uninstall log, e.g.<br><br>C:\Pumpkin_Test\Salvo\Lib\RA430<br>C:\Pumpkin_Test\Salvo\Lib\RA430\d:\Pumpkin\Salvo\Lib\RA430\libsalvolra430ia.hza<br>C:\Pumpkin_Test\Salvo\Lib\RA430\d:\Pumpkin\Salvo\Lib\RA430\libsalvolra430id.hza<br>C:\Pumpkin_Test\Salvo\Lib\RA430\d:\Pumpkin\Salvo\Lib\RA430\libsalvolra430ie.hza<br>C:\Pumpkin_Test\Salvo\Lib\RA430\d:\Pumpkin\Salvo\Lib\RA430\libsalvolra430im.hza<br>C:\Pumpkin_Test\Salvo\Lib\RA430\d:\Pumpkin\Salvo\Lib\RA430\libsalvolra430it.hza<br><br>When what I really need is:<br><br>C:\Pumpkin_Test\Salvo\Lib\RA430<br>C:\Pumpkin_Test\Salvo\Lib\RA430\libsalvolra430ia.hza<br>C:\Pumpkin_Test\Salvo\Lib\RA430\libsalvolra430id.hza<br>C:\Pumpkin_Test\Salvo\Lib\RA430\libsalvolra430ie.hza<br>C:\Pumpkin_Test\Salvo\Lib\RA430\libsalvolra430im.hza<br>C:\Pumpkin_Test\Salvo\Lib\RA430\libsalvolra430it.hza<br><br>How can I get the latter while keeping the files in their current source directories?<br><br>Thanks. I'm sure this stuff is really simple for NSIS pro like you -- it's still a bit daunting to me. :)<br><br>--Andrew</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">7th May 2005 19:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I've updated the File macro.<br><a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=556" target="_blank">http://nsis.sourceforge.net/archive/...php?pageid=556</a><br><br>It now takes two paramaters for the path and the file.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aekalman</span><br><span class="post-time small text-muted">7th May 2005 22:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Stu.<br><br>Thanks -- I'm working with it now.<br><br>--Andrew</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aekalman</span><br><span class="post-time small text-muted">7th May 2005 23:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Stu.<br><br>Here's a problem -- in Win98, $EXEDIR for the uninstaller is c:\windows\temp, even though I launch it from c:\Pumpkin_Test\Salvo. Therefore it cannot find the uninstaller's uninstall.log file ...<br><br>Is there a simple solution to this problem?<br><br>Thanks,<br><br>--Andrew</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aekalman</span><br><span class="post-time small text-muted">7th May 2005 23:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Stu.<br><br>Similar issue with Win2k testing ... is there perhaps an NSIS global that I've failed to set that controls where the uninstaller runs from?<br><br>In Win 98 and Win2k, $EXEDIR is returned as temp directory when I try to run the uninstaller ...<br><br>--Andrew</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aekalman</span><br><span class="post-time small text-muted">7th May 2005 23:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Stu.<br><br>Doh! I think you meant to type $INSTDIR throughout the uninstaller, instead of $EXEDIR.<br><br>Changed them to $INSTDIR and it works fine ...<br><br>I suspect $EXEDIR would be better, but $INSTDIR works for now (though it's more limited in applicability).<br><br>As you can see :), it's taking me a while to fully appreciate the "hang yourself" power of NSIS, esp. w/regards to variables and their run-timedness or lack thereof.<br><br>Thanks,<br><br>--Andrew</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">7th May 2005 23:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Where is the uninstaller located?<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aekalman</span><br><span class="post-time small text-muted">8th May 2005 00:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Stu.<br><br>I would also suggest adding a line to remove the uninstaller (.exe) itself, not just the .log file ...<br><br>Thanks,<br><br>--Andrew</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aekalman</span><br><span class="post-time small text-muted">8th May 2005 00:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Afrow UK</i><br><b>Where is the uninstaller located?<br><br>-Stu</b></blockquote>In c:\Pumpkin\Salvo, e.g. c:\Pumpkin\Salvo\Remove Salvo Pro for TI's MSP430.exe.<br><br>I'm double-clicking / launching the uninstaller from there, in a Windows window.<br><br>I don't suppose the spaces or apostrophe in the filename are causing problems?<br><br>--Andrew</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aekalman</span><br><span class="post-time small text-muted">10th May 2005 05:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Bump.<br><br>As best I can tell, the existing script won't work because of $EXEDIR problems involving the uninstall log.<br><br>Using $INSTDIR as the pathname to the uninstall log won't work (I suspect) if the user changes the install path ...<br><br>--Andrew</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">10th May 2005 08:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">$INSTDIR will be the $EXEDIR in the uninstaller unless changed.<br>NSIS uninstallers only work if they are placed in the install folder. If they are placed elsewhere then you need to tell it where the install location is (e.g. with a registry entry).<br><br>And you can't delete a program with itself (the uninstaller).<br><br>Thanks I updated the page.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aekalman</span><br><span class="post-time small text-muted">10th May 2005 21:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Stu.<br><br></p><blockquote>And you can't delete a program with itself (the uninstaller).</blockquote>It works for me -- the uninstaller is running from a copy in Windows\Temp, so it's able to remove itself (in $INSTDIR).<br><br>Am I missing something?<br><br>Thanks for all your help,<br><br>--Andrew</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">10th May 2005 22:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Oh yes I see what you mean now. Forget what I said :)<br><br>-Stu</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>