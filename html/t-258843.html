<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="setup executed by other program hangs..."><title>setup executed by other program hangs... - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">setup executed by other program hangs...</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=258843">setup executed by other program hangs...</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">MVI</span><br><span class="post-time small text-muted">3rd November 2006 18:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>setup executed by other program hangs...</strong><br>Greetings...<br><br>I've some strange problem: when multi-language setup launched by other program (autorun.exe), which sets value for MUI_LANGDLL_REGISTRY_KEY -- setup hangs: it just displayed in processes list (task manager) with no activity (processor usage == 0). But when I starts it by myself (or without setting key) -- it works fine...<br><br>Best regards...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">3rd November 2006 18:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Does it happen when you don't preset the registry? Does it happen when you run it from another installer? Does it happen with other applications ran by autorun.exe? Do you have a script example reproducing the problem? Which version of NSIS are you using?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MVI</span><br><span class="post-time small text-muted">6th November 2006 08:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i><br><b>Does it happen when you don't preset the registry?</b></blockquote>no. in this case setup works fine.<br><br><blockquote><i>Originally posted by kichik</i><br><b>Does it happen when you run it from another installer?</b></blockquote>it executed not by installer. it executed by some small autorun (using ShellExecute() (also tried CreateProcess)).<br>Both "Far file manager" and "Total commander" works fine (with and without records in registry). "Common application" also starts fine.<br><br><blockquote><i>Originally posted by kichik</i><br><b>Does it happen with other applications ran by autorun.exe?</b></blockquote>no. other applications starts fine.<br><br><blockquote><i>Originally posted by kichik</i><br><b>Do you have a script example reproducing the problem?</b></blockquote>yes. attached.<br><br><blockquote><i>Originally posted by kichik</i><br><b>Which version of NSIS are you using?</b></blockquote>2.21</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br><span class="post-time small text-muted">6th November 2006 15:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">While ago I made this <a href="http://forum.ccleaner.com/index.php?showtopic=6161" target="_blank">http://forum.ccleaner.com/index.php?showtopic=6161</a> portable wrapper for CCleaner with NSIS and some of the users told me that it hangs a very long time when it's runs from CD via autorun and when it's executed normally from the CD it doesn't hang.<br><br>I have confirmed this my self in win2k, but in windows XP I couldn't reproduce it. MVI what operating system you are using?<br><br>The portable wrapper reads and writes in the registry when it starts so I think we have a pattern here.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MVI</span><br><span class="post-time small text-muted">6th November 2006 15:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'm using Windows XP (pro sp2). Same problem appears on windows 98 and 2000.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">6th November 2006 21:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Are you also running it from a CD?<br><br>Can you attach your wrapper application, preferably with source code, so I can have complete way to reproduce this?<br><br>Are you familiar with using a debugger? Could you attach a debugger to to the hung process and see what it's doing?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MVI</span><br><span class="post-time small text-muted">7th November 2006 09:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i><br><b>Are you also running it from a CD?<br></b></blockquote>no. while testing i'm running it locally.<br><br><blockquote><i>Originally posted by kichik</i><br><b>Can you attach your wrapper application, preferably with source code, so I can have complete way to reproduce this?<br></b></blockquote>done.<br><br><blockquote><i>Originally posted by kichik</i><br><b>Are you familiar with using a debugger? Could you attach a debugger to to the hung process and see what it's doing?</b></blockquote>setup hangs somewhere in ntdll.dll. as there is no debug symbols i cant't say precisely...</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br><span class="post-time small text-muted">7th November 2006 11:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i><br><b>Can you attach your wrapper application, preferably with source code, so I can have complete way to reproduce this?</b></blockquote>Done. :) It won't do anything without CCleaner, but CCleaner isn't needed to reproduce the problem.<br><br><blockquote><i>Originally posted by kichik</i><br><b>Are you familiar with using a debugger? Could you attach a debugger to to the hung process and see what it's doing?</b></blockquote>I tried Dependency Walker. I din't expect it to hang, but it did. Last thing in the log is <b>GetUserDefaultUILanguage</b> Full log is in the attachment.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">8th November 2006 19:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">MVI, there's no attachment. {_trueparuex^}, I couldn't reproduce it with yours.<br><br>MVI, what's above ntdll.dll in the stack? Addresses in the installer will help as well.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br><span class="post-time small text-muted">9th November 2006 15:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i><br><b>{_trueparuex^}, I couldn't reproduce it with yours.</b></blockquote>Try Dependency Walker. When I start to profiling the file it hangs and the file doesn't need to be on CD. That GetUserDefaultUILanguage actually was GetProcAddress call to that function, but I have noticed that it doesn't always hang on the same place when profiling.<br><br>MVI you said on your original post that the installer hangs with 0 processor usage. In my case the portable app work as hard as it can while it hangs.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">9th November 2006 18:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">{_trueparuex^}, worked fine for me with without depends.exe on both XP and 2000.<br><br>Are you sure it hangs before .onInit is called? That function does a lot in your code, including registering many external DLL files. You also said it hanged for a long while and not completely as in MVI's case.<br><br>MVI, can you attach the code again? Your last post has no attachment.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MVI</span><br><span class="post-time small text-muted">9th November 2006 18:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">sorry.<br><a href="http://users.i.com.ua/~hunter_/Autorun.rar" target="_blank">http://users.i.com.ua/~hunter_/Autorun.rar</a><br><br>just after "pause" it 7c90eb94 (command ret)<br>then (after some "step over"s it "ups" to 01332693 where hangs again on call dword ptr ds:[13330C0h] and "here we go agin" :))</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">9th November 2006 18:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Which DLL is loaded at 01330000? <a href="http://www.sysinternals.com/Utilities/ProcessExplorer.html" target="_blank">Process Explorer</a> can tell you that.<br><br>What's above it in the stack? Where is that loop called from?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">9th November 2006 18:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">MVI, never mind, I found the problem. It's just too good to be true... You pass SW_HIDE to ShellExecute in your program so the dialog comes up hidden. I read <a href="http://blogs.msdn.com/oldnewthing/archive/2006/10/23/862750.aspx" target="_blank">about it</a> not too long ago but dismissed it because you said you've also tried CreateProcess.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br><span class="post-time small text-muted">9th November 2006 21:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i><br><b>{_trueparuex^}, worked fine for me with without depends.exe on both XP and 2000.<br><br>Are you sure it hangs before .onInit is called? That function does a lot in your code, including registering many external DLL files. You also said it hanged for a long while and not completely as in MVI's case.</b></blockquote>Oh you are going to love this... I added messageboxs to beginning of .onInit to see if it gets in it and it did. Then I added messageboxes to .onInit to see where it hangs and it hangs somewhere in GetParameters function... Can you see where this is going? :( Shame on me shame on me... Well it's stuck on the first loop. To make it short it gets stuck in endless loop if the commandline doesn't have any quotes or any spaces in it, because one $R2 in the code should be $R0. :p<br><br>Shame on me shame on me. I am sorry I wasted your time. :(</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">9th November 2006 22:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Happy ending. How can I not love it? ;)</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>