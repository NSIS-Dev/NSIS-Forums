<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Select and download files from ftp folder" />

  <title>Select and download files from ftp folder - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.2/readable/bootstrap.min.css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Select and download files from ftp folder</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=346710">Select and download files from ftp folder</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mrjohn</span><br />
      <span class="post-time small text-muted">1st August 2012 09:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Select and download files from ftp folder</strong><br />
      &nbsp; Hi ! I need to create one installer that connects to a ftp folder,gets a list of files there and then gives the option to download some of them.Is this possible with NSIS ?<br />
      Thanks !</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">1st August 2012 12:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Either write a plug-in to do it, call an existing DLL using the System plug-in or execute an existing command line executable (search Google for a DLL/EXE to use).<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mrjohn</span><br />
      <span class="post-time small text-muted">1st August 2012 13:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the answer!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mrjohn</span><br />
      <span class="post-time small text-muted">1st August 2012 18:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">For me it is hard to do that with NSIS,I don't know how to write plugin,I think i'll write a .NET app that will do the work,and I'll use it as an installer,the single problem is : there must be FRAMEWORK installed on the computer :(</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">1st August 2012 20:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Did you search for a DLL or command line FTP client for Windows? You can use either through NSIS.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">T.Slappy</span><br />
      <span class="post-time small text-muted">2nd August 2012 07:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">In present times Framework is installed on most machines.<br />
      If not then it is very easy to detect it, download and install using NSIS :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mrjohn</span><br />
      <span class="post-time small text-muted">2nd August 2012 07:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi ! I've searched for command line but I found lot of things:commercial,mounting ftp to drive,etc,not something clearly,I'll do as T.Slappy suggested,thanks !</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">2nd August 2012 08:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Err... Making your installer download and install .NET is not a better solution. For one thing, it requires a reboot. Second, it makes your installer much much more complex. Third, lots of people don't want to install .NET. Fourth, installation will take much longer.<br />
      <br />
      There are plenty of free commandline-based FTP tools out there. <a href="http://www.ncftp.com/ncftp/" target="_blank">http://www.ncftp.com/ncftp/</a> is my third google hit.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mrjohn</span><br />
      <span class="post-time small text-muted">2nd August 2012 09:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks all of you'I don't want to annoy you,but for me the shortest road is the road I know,I tried ncftp but I couldn,'t connect to my ftp account with this tool,also I don't know how to add files into NSIS installer,it is too hard,i'll use .NET solution,thanks<br />
      <br /></p>

      <blockquote>
        <small>Originally posted by MSG</small><br />
        Err... Making your installer download and install .NET is not a better solution. For one thing, it requires a reboot. Second, it makes your installer much much more complex. Third, lots of people don't want to install .NET. Fourth, installation will take much longer.<br />
        <br />
        There are plenty of free commandline-based FTP tools out there. <a href="http://www.ncftp.com/ncftp/" target="_blank">http://www.ncftp.com/ncftp/</a> is my third google hit.
      </blockquote>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">2nd August 2012 10:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Actually a fresh .NET installation does not require a reboot. Regarding FTP, one tool that comes to mind is wget. It is free and there is a Windows port (Google it) and it supports FTP file/folder listings IIRC.<br />
      <br />
      Edit: cURL is another one.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mrjohn</span><br />
      <span class="post-time small text-muted">2nd August 2012 12:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        Regarding FTP, one tool that comes to mind is wget
      </blockquote>Indeed wget works<br />
      <br />
      <pre>
<code>wget  --ftp-user=myuser --ftp-password=mypassw  ftp://mywebserver.com/update/ 
</code>
</pre>it lists files from a folder creating a file like this :<br />
      <br />
      <pre>
&lt;!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN"&gt;
<br />&lt;html&gt;
<br />&lt;head&gt;
<br />&lt;title&gt;Index of /update on mywebserver.com:21&lt;/title&gt;
<br />&lt;/head&gt;
<br />&lt;body&gt;
<br />&lt;h1&gt;Index of /update on mywebserver.com:21&lt;/h1&gt;
<br />&lt;hr&gt;
<br />&lt;pre&gt;
<br /> 2012 Jul 30 15:28  File        &lt;a href="ftp://mywebserver.com:21/update/upd_C_1_0_5_97.exe"&gt;upd_C_1_0_5_97.exe&lt;/a&gt;  (1198819 bytes)
<br /> 2012 Aug 02 05:49  File        &lt;a href="ftp://mywebserver.com:21/update/upd_G_1_0_9_39.exe"&gt;upd_G_1_0_9_39.exe&lt;/a&gt;  (1343629 bytes)
<br /> 2012 Mar 13 06:31  File        &lt;a href="ftp://mywebserver.com:21/update/upd_H_1_0_0_18.exe"&gt;upd_H_1_0_0_18.exe&lt;/a&gt;  (488752 bytes)
<br /> 2012 Feb 13 03:09  File        &lt;a href="ftp://mywebserver.com:21/update/upd_M_1_0_20_15.exe"&gt;upd_M_1_0_20_15.exe&lt;/a&gt;  (564734 bytes)
<br /> 2012 Jul 31 02:13  File        &lt;a href="ftp://mywebserver.com:21/update/upd_S_1_0_2_57.exe"&gt;upd_S_1_0_2_57.exe&lt;/a&gt;  (1249680 bytes)
<br />&lt;/pre&gt;
<br />&lt;/body&gt;
<br />&lt;/html&gt; 
</pre>now how to get files into NSIS to let user select what files wants to download ?<br />
      Thanks !
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">2nd August 2012 16:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You'll probably have to download the file list and direct output to a file:<br />
      SetOutPath $PLUGINSDIR<br />
      File ftpclient.exe<br />
      nsExec::Exec `"$PLUGINSDIR\ftpclient.exe" -param1 -param2 -etc &gt; "$PLUGINSDIR\filelist.txt"`<br />
      <br />
      And then parse that txt file using the macros listed in Appendix E of the manual: <a href="http://nsis.sourceforge.net/Docs/AppendixE.html" target="_blank">http://nsis.sourceforge.net/Docs/AppendixE.html</a><br />
      <br />
      You could output what you find to a listbox with checkboxes, or some similar control. Google finds <a href="http://forums.winamp.com/showthread.php?t=318260" target="_blank">http://forums.winamp.com/showthread.php?t=318260</a> , which links to <a href="http://nsis.sourceforge.net/EmbeddedLists_plug-in" target="_blank">http://nsis.sourceforge.net/EmbeddedLists_plug-in</a> .<br />
      You could of course also make a hundred hidden sections, then unhide &amp; rename the sections after you get the filelist. One section for each file. Then you could just use the components page, instead of bothering with a checkbox'ed listbox control.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mrjohn</span><br />
      <span class="post-time small text-muted">3rd August 2012 11:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks MSG !!!<br />
      I've done,I've created sections (I have max 7 ) default hidden (name ="") and I show them after getting the file list,I used SectionSetText.... all works, but instead using wget to download the files that shows a command window I want to use something with a real progressbar so I tried Inetc plugin, but I can't download the file with it,also with wget I can,this is the command I use :<br />
      <br />
      <br /></p>
      <pre>
<code> inetc</code>::get /caption "download" /popup "ftp://mywebserver*******" "ftp://myuser@mywebserver.info:mypassw@mywebserver*******update/upd_H_1_0_0_18.exe" "$EXEDIR\setup.exe"
<br /><br />   Pop $0 # return value = exit code, "OK" if OK
<br />   MessageBox MB_OK "Download Status: $0" 
</pre>I got error : URL Parts Error<br />
      <br />
      Thanks !
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">3rd August 2012 13:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Put /end on the end of your inetc line.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mrjohn</span><br />
      <span class="post-time small text-muted">3rd August 2012 13:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Done, but the same error<br />
      <br />
      thanks<br /></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        Put /end on the end of your inetc line.<br />
        <br />
        Stu
      </blockquote>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">3rd August 2012 14:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Does it work without the /caption and /popup switches? If not then I would suspect your URL format is wrong as then I'd assume that error means <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa384376%28v=vs.85%29.aspx" target="_blank">InternetCrackUrl</a> API failed.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mrjohn</span><br />
      <span class="post-time small text-muted">3rd August 2012 15:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi !<br />
      I tried something like this, rename user to<br />
      <b>myuser</b><br />
      not<br />
      <b><a href="mailto:myuser@mywebserver.info">myuser@mywebserver.info</a></b><br />
      <br />
      user is defined in cpanel as <b>myuser@mywebserver.info</b>,tested also with browser,simple name <b>myuser</b> doesnt work<br />
      <br />
      <br />
      So using simple <b>myuser</b> I can see the progressbar and then the message : Download Status:530:Login autenthication failed<br />
      <br /></p>
      <pre>
<code>  inetc</code>::get   "ftp://myuser:mypass@mywebserver*******public_html/pft/_public_/update/upd_H_1_0_0_18.exe" "$EXEDIR\setup.exe" 
</pre>puting back the user to <b><a href="mailto:myuser@mywebserver.info">myuser@mywebserver.info</a></b> got error : URL Parts Error<br />
      <br />
      Thanks!<br />
      <br />
      <br />
      <br />
      <br />
      <br />

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        Does it work without the /caption and /popup switches? If not then I would suspect your URL format is wrong as then I'd assume that error means <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa384376%28v=vs.85%29.aspx" target="_blank">InternetCrackUrl</a> API failed.<br />
        <br />
        Stu
      </blockquote>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">3rd August 2012 16:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This worked for me:<br /></p>
      <pre>
<code>inetc::get "ftp://myuser:mypass@mywebserver.com/public_html/pft/_public_/update/upd_H_1_0_0_18.exe" "$EXEDIR\setup.exe" /end</code>
</pre>You sure you put /end on correctly (as shown)?<br />
      <br />
      Stu
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mrjohn</span><br />
      <span class="post-time small text-muted">3rd August 2012 20:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">not working,I think there must be a bug when user is defined as<br />
      <a href="mailto:myuser@mywebserver.info">myuser@mywebserver.info</a><br />
      not<br />
      myuser<br />
      <br />
      Thanks<br />
      <br />
      <br />
      <br /></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        This worked for me:<br />
        <pre>
<code>inetc::get "ftp://myuser:mypass@mywebserver.com/public_html/pft/_public_/update/upd_H_1_0_0_18.exe" "$EXEDIR\setup.exe" /end</code>
</pre>You sure you put /end on correctly (as shown)?<br />
        <br />
        Stu
      </blockquote>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">3rd August 2012 23:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can't have an @ in the username (or password). The FTP URI specification does not allow it.<br />
      <br />
      It has to be:<br />
      ftp://&lt;user&gt;:&lt;pass&gt;@&lt;host&gt;/&lt;path&gt;<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mrjohn</span><br />
      <span class="post-time small text-muted">4th August 2012 06:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">In wget I use it like this and it works :<br />
      <br /></p>
      <pre>
<code> nsExec</code>::Exec '"wget.exe"  --ftp-user=myuser@mywebserver.info --ftp-password=mypassw ftp://mywebserver*******update/ ' 
</pre>using in wget username <b>myuser</b> instead of <b>myuser@mywebserver.info</b> it doesn't work,so I think there is a bug in this plugin,also it is working with total commander,chrome,firefox,etc<br />
      <br />
      Thanks!<br />
      <br />
      <br />

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        You can't have an @ in the username (or password). The FTP URI specification does not allow it.<br />
        <br />
        It has to be:<br />
        ftp://&lt;user&gt;:&lt;pass&gt;@&lt;host&gt;/&lt;path&gt;<br />
        <br />
        Stu
      </blockquote>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">4th August 2012 10:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">As I said it's the FTP URI specification that does not allow the @ in the username when the username is in the URI. The @ is used as the delimiter between the username and password therefore it cannot allow more than one. This is not a fault of the plug-in. Try it in IE (or any other browser) for example. The reason it works with wget is because you're not specifying the username in the FTP URI. If you are stuck with that username then you will have to use wget instead of inetc.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mrjohn</span><br />
      <span class="post-time small text-muted">4th August 2012 17:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Afrow, I'll use wget.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>