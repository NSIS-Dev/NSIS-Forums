<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Refresh *.ini" />

  <title>Refresh *.ini - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Refresh *.ini</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=273945">Refresh *.ini</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aemik</span><br />
      <span class="post-time small text-muted">6th July 2007 08:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Refresh *.ini</strong><br />
      Hello,<br />
      <br />
      I have following problem...<br />
      <br />
      I have a costum MUI Page with a list of some software that have to be installed.<br />
      I check some Reg Strings to see if the software is installed or not. When the software is not installed you can click a button and install it now.<br />
      <br />
      Now I need a refresh button for this costum page, to show that the software is now installed. Is this possible???</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th July 2007 10:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">When the page is already displayed, you cannot edit the INI. InstallOptions won't reload the INI while the page is showing. You'd have to use Windows messages or instructions like ShowWindow and EnableWindow to edit the page. How exactly does the page show the software is installed?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aemik</span><br />
      <span class="post-time small text-muted">6th July 2007 10:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The page looks like this:<br />
      <br />
      Software 1 "not installed" Button (Install now)<br />
      Software 2 "installed" Button (disabled)<br />
      Software 3 "installed" Button (disabled)<br />
      <br />
      When I click on the Installbutton I can install the software.<br />
      I need a refresh function to show that the software is now installed.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th July 2007 10:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">But what is "software 1 installed"? Is it a label? If it is, simply get its HWND by reading it from the INI and send it WM_SETTEXT. See Examples\InstallOptions\testnotify.nsi for a working example of such an operation.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aemik</span><br />
      <span class="post-time small text-muted">6th July 2007 11:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">"Software 1" is a label<br />
      "not installed" is a label<br />
      "Button (Install now)" is a button</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th July 2007 11:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Then modify the second label using SendMessage as explained above.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aemik</span><br />
      <span class="post-time small text-muted">6th July 2007 11:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I dont undertstand winmessages.nsh. What is it good for?? Ive read the docu but i dont know how to use these commands.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th July 2007 11:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It contains definitions like WM_SETTEXT.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Galatea</span><br />
      <span class="post-time small text-muted">8th November 2007 16:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have nearly the same problem, i try to do some checks and want to disply it by checkboxes.<br />
      <br />
      but its only updated on the end of the function.<br />
      Its it possible to get a refresh of the UI after the send message command?<br />
      <br /></p>
      <pre>
<code><br />Function CustomLeave<br />GetDlgItem $R0 $HWNDPARENT 1<br />EnableWindow $R0 0<br />   readinistr $2 '$PLUGINSDIR\systemcheck.ini' 'Field 4' 'HWND'<br />   SendMessage $2 ${BM_SETCHECK} 1 0<br />   Sleep 1000<br /><br />   readinistr $2 '$PLUGINSDIR\systemcheck.ini' 'Field 5' 'HWND'<br />   SendMessage $2 ${BM_SETCHECK} 1 0<br />   Sleep 1000<br />...<br />...<br />EnableWindow $R0 1<br />FunctionEnd<br /></code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">8th November 2007 17:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That piece of code looks fine and should update the display by checking the check boxes. There must be something else in the script preventing it from actually happening. Attach the complete script.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Galatea</span><br />
      <span class="post-time small text-muted">9th November 2007 08:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>
      <pre>
<code><br />!insertmacro MUI_PAGE_WELCOME<br />Page custom CustomShow CustomLeave<br />!insertmacro MUI_PAGE_LICENSE License.rtf<br />.<br />.<br />.<br />Function CustomShow <br />    GetDlgItem $R0 $HWNDPARENT 1<br />    SendMessage $R0 ${WM_SETTEXT} 1 "STR:Check"<br />    !insertmacro MUI_HEADER_TEXT "System Check" "Checking System requirements"<br />    !insertmacro INSTALLOPTIONS_DISPLAY "systemcheck.ini" <br />FunctionEnd<br /><br />Function CustomLeave<br />  GetDlgItem $R0 $HWNDPARENT 1<br />  EnableWindow $R0 0<br />  ;TODO check WinVersion<br /><br />   readinistr $2 '$PLUGINSDIR\systemcheck.ini' 'Field 4' 'HWND'<br />   SendMessage $2 ${BM_SETCHECK} 1 0<br />   Sleep 1000<br /><br />  ;TODO check browser<br />   readinistr $2 '$PLUGINSDIR\systemcheck.ini' 'Field 5' 'HWND'<br />   SendMessage $2 ${BM_SETCHECK} 1 0<br />   Sleep 1000<br /><br />    !insertmacro IsUserAdmin $0<br />    IntCmp $0 1 Ok AdminWarning<br />    AdminWarning:<br />        MessageBox MB_OK "You have no administration rights on this PC$\nAsk the Administrator for more information."<br />        Abort<br />    OK:<br />        readinistr $2 '$PLUGINSDIR\systemcheck.ini' 'Field 6' 'HWND'<br />        SendMessage $2 ${BM_SETCHECK} 1 0<br />   Sleep 1000<br />        MessageBox MB_OK "DEBUG:STOP"<br />EnableWindow $R0 1<br />FunctionEnd<br /></code>
</pre><br />
      systemcheck.ini:<br />
      <pre>
<code>[Settings]<br />NumFields=6<br /><br />[Field 1]<br />Type=Label<br />Left=107<br />Top=73<br />Right=187<br />Bottom=82<br />Text=Administrator rights<br /><br />[Field 2]<br />Type=Label<br />Left=107<br />Top=52<br />Right=187<br />Bottom=61<br />Text=Browser (IE 7)<br /><br />[Field 3]<br />Type=Label<br />Left=107<br />Top=33<br />Right=187<br />Bottom=42<br />Text=Windows Version<br /><br />[Field 4]<br />Type=CheckBox<br />Left=91<br />Top=32<br />Right=107<br />Bottom=42<br />Flags=DISABLED|NOTIFY<br /><br />[Field 5]<br />Type=CheckBox<br />Left=91<br />Top=52<br />Right=107<br />Bottom=62<br />Flags=DISABLED|NOTIFY<br /><br />[Field 6]<br />Type=CheckBox<br />Left=91<br />Top=72<br />Right=107<br />Bottom=82<br />Flags=DISABLED|NOTIFY</code>
</pre><br />
      <br />
      The checkboxes are disabled, they should be only statusdisplay, not selectabel by user.<br />
      Also on enabled they will not updated after setting, seperate labels so the text is black instead of greyout.<br />
      <br />
      Macro "IsUserAdmin" is copied from http:// nsis.sourceforge.net /Check_if_the_current_user_is_an_Administrator<br />
      <br />
      The window will be updated at the end of function, when the Messagebox is displayed,<br />
      but i need a update before every sleep
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">9th November 2007 10:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can't both sleep and update the screen. The function must return in order for the message loop to process drawing of the dialog.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Galatea</span><br />
      <span class="post-time small text-muted">9th November 2007 12:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">thanx for the fast answer.<br />
      <br />
      If I return after the first check i need another user interaction, is it possible to triger it automatical again? so i can count it how often it is called and jumps out after last loop.<br />
      <br />
      or any other idea how to implements a step-by-step display without interaction?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">9th November 2007 13:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You would really need to write a plug-in in C/C++ to do this. For example, create a dialog in your Visual Studio designer and then modify it asynchronously in another thread at run time. This is basically how the LockedList plug-in works with a dynamically updated list box.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
