<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="LogSet turns itself Off..."><title>LogSet turns itself Off... - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">LogSet turns itself Off...</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=211044">LogSet turns itself Off...</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Jnuw</span><br><span class="post-time small text-muted">21st March 2005 21:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>LogSet turns itself Off...</strong><br>I'm updating my installer (with 2.05) with some new features, and one of the things I did was move the "LogSet On" command from my first section to the .onInit function, for more complete logging. Now Iâ€™m getting logging from the very beginning of the install which is nice. However, I found a problem.<br><br>When I run my installer in silent mode, I get 100% of the logging. However when I run it in normal (MUI) mode, the logging stops right after my DirectoryLeave function. The next page in my installer is the MUI_PAGE_INSTFILES, so I just added the "LogSet On" command (for the second time) to the first line of the first section, and it continues on.<br><br>Its like my DirectoryLeave function or the INSTFILES page turns off the LogSet setting. Any thoughts?<br><br>Thanks.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Jnuw</span><br><span class="post-time small text-muted">22nd March 2005 16:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I created a sample nsi file that this problem is reproducible in. Compile the below code and run it by double clicking on it. After it runs (on you desktop is fine) you will see that the log file stops logging right after the directory leave function. Then run it in silent mode from command line, (logset.exe /S) and you will see the logging keeps going throughout the sections.<br><br>If you then un-comment the ;LogSet On command in the -Pre section, that seems to correct the problem, but having to set LogSet twice (in .onInit and in the first section) seems like a bug. Thanks all.<br><br><br></p><pre>
<code><br>; NSIS 2.05<br><br>!define PRODUCT_NAME "LogSet"<br>!include "MUI.nsh"<br>!define MUI_ABORTWARNING<br><br>; Pages<br>!insertmacro MUI_PAGE_WELCOME<br>!insertmacro MUI_PAGE_COMPONENTS<br>!define MUI_PAGE_CUSTOMFUNCTION_LEAVE "DirectoryLeave"<br>!insertmacro MUI_PAGE_DIRECTORY<br>!insertmacro MUI_PAGE_INSTFILES<br>!insertmacro MUI_PAGE_FINISH<br>!insertmacro MUI_LANGUAGE "English"<br><br>; MUI end------<br>Name "${PRODUCT_NAME}"<br>AllowRootDirInstall True<br>OutFile "LogSet.exe"<br>InstallDir "$EXEDIR"<br>ShowInstDetails Hide<br><br><br>Section "-Pre"<br>  ;LogSet On<br>  IfSilent 0 End<br>    Call DirectoryLeave<br>  End:<br>SectionEnd<br><br><br>Section "1" SEC01<br>  DetailPrint "In Section 1"<br>SectionEnd<br><br><br>Section "2" SEC02<br>   DetailPrint "In Section 2"<br>SectionEnd<br><br><br>Section "3" SEC03<br>   DetailPrint "In Section 3"<br>SectionEnd<br><br><br><br>;---------------------------------<br><br><br><br>Function .onInit<br>  LogSet On<br>  LogText ""<br>  LogText ""<br>  LogText "_________________________"<br>  LogText "Start of ${PRODUCT_NAME}"<br>FunctionEnd<br><br>Function DirectoryLeave<br>   DetailPrint "In DirectoryLeave"<br>FunctionEnd<br></code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">22nd March 2005 18:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The directory page can turn the logging on and off. If the user holds the shift key when moving into the directory page, he sees a checkbox asking him if he'd like to turn logging on. I guess the leave code doesn't check if shift was held and checks the checkbox anyway. When there is no checkbox, it turns off logging because the "checkbox" is not checked. Please submit a bug report in the bug tracker.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jnuw</span><br>
      <span class="post-time small text-muted">22nd March 2005 18:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks kichik. Will do, just going to get lunch first, thanks again!</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jnuw</span><br>
      <span class="post-time small text-muted">22nd March 2005 21:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Bugged in bug tracker, thanks!</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>