<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Help: Custom Page with MUI not working"><title>Help: Custom Page with MUI not working - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Help: Custom Page with MUI not working</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=310419">Help: Custom Page with MUI not working</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">File077</span><br><span class="post-time small text-muted">21st August 2009 05:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Help: Custom Page with MUI not working</strong><br>For some reason, my custom page doesn't run.<br><br><br>I know it is allot of code, but please take a look.<br><br>The point is they could have 2 totally different install types, so I want a screen before the directory choice that says:<br>RadioButton "Default Installation (this user)"<br>RadioButton "All Users (--nohomedir)"<br>Then depending on what they choose, I will have a better chance of pre-deterining the install path using the registration keys.<br><br>This is a work in progress, so messy, but here we have it..<br><br><a href="http://nsis.pastebin.com/m52ae8546" target="_blank">http://nsis.pastebin.com/m52ae8546</a> Line 179<br>I also tried.<br><a href="http://nsis.pastebin.com/m4d2fca04" target="_blank">http://nsis.pastebin.com/m4d2fca04</a> Line 170 and 179<br><br>Current code compiles, but I am in the middle of trying:<br></p><pre>
<code><br>/******************************************************************************<br>;NSIS Modern User Interface<br>;Copyright 2004-2009 Josh Lee<br>; Special thanks to Bob Gneu for helping with the Registry Key logic of UT3<br>;--------------------------------<br><br>-1 Compressor Setings<br>-2 User Over-ridable Config<br>-3 Constants<br>-4 Registry Information<br>-5 Variable Decleration<br>-6 Pages<br>-7 Language Definition<br>-8 Section Over-rides<br>-8.5  Page Overrides (after sections for variable def.)<br>-9 Function Decleration<br>******************************************************************************/<br><br>!include "MUI2.nsh"<br>!include FileFunc.nsh<br>!include "StrFunc.nsh"<br>${StrRep}<br><br>;=== Runtime Switches<br>SetCompress                     Auto<br>SetCompressor                   /SOLID lzma<br>SetCompressorDictSize   32<br>SetDatablockOptimize    On<br>XPStyle                                 on<br>CRCCheck                        on<br>AutoCloseWindow                 True<br>;Request application privileges for Windows Vista<br>RequestExecutionLevel   user<br>###############################################################################<br>###############################################################################<br># Begin Config<br>;--------------------------------<br>;General<br><br>        ;Name and file<br>         NAME "Unreal Tournament 3 - Jailbreak"<br>        !define VERSION "Alpha9"<br>        !define SHORTNAME "JB_${VERSION}"<br>        !define UNINSTALLER "Uninstall_Jailbreak.exe"<br>        ; Version of installer in X.X.X.X format (requried by NSIS2 MUI)<br>        !define JAILBREAK_INSTALLER_VERSION "1.0.0.0"<br>        <br>        ; Installer File name<br>        OutFile "${SHORTNAME}_Installer.exe"<br>        <br>         ;Default installation folder<br>    InstallDir "$DOCUMENTS\My Games\Unreal Tournament 3\UTGame\Published\CookedPC"<br>        <br>        ; images<br>        ;=== Icon &amp; Stye ===<br>        !define AP_ICON "required_files\JBIcon.ico"<br>        !define LOGO "required_files\logo.bmp"<br><br>        ;=== BEGIN: BASIC INFORMATION<br>        !define NAME "Unreal Tournament 3 - Jailbreak x"<br>        !define Caption "${NAME} - Installer"<br>        ;=== Program Icon<br>        Icon "${AP_ICON}"<br>        !define STARTMENUFOLDER "Unreal Tournament 3\PlanetJailbreak.com"<br>        !define DEFAULT_DESTINATION "${InstallDir}"<br>        !define CHECKRUNNING "UT3.exe"<br>        !define CLOSENAME "Unreal Tournament 3"<br>        !define PRODUCT_WEB_SITE "http://www.PlanetJailbreak.com"<br>        !define INSTALLERCOMMENTS "For additional details, visit PlanetJailbreak.com xxx:todo"<br>        !define INSTALLERADDITIONALTRADEMARKS "Jailbreak is a Trademark of PlanetJailbreakâ„¢" ;end this entry with a period and a space if used<br>        !define INSTALLERLEGALCOPYRIGHT "PlanetJailbreakâ„¢ and contributors."<br>        !define LICENSEAGREEMENT "required_files\JBLicense.txt"<br>        !define PRODUCT_COMPANY "PlanetJailBreak.com"<br>        !define PRODUCT_UNINST_KEY              "Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_COMPANY}"<br>        !define PRODUCT_UNINST_ROOT_KEY "HKLM"<br>        !define MESSAGE_INTRO           "UT3 Jailbreak has been installed."<br>        !define MESSAGE_SIGNATURE       "$\n$\nFor further assistance please use the forums at PlanetJailbreak.com. $\n$\n- UT3 Jailbreak | Project Lead - Wormbo"<br>        !define SUCCESS_MESSAGE         "${MESSAGE_INTRO} $\n$\nThere are shortcuts available to you in your installation directory. ${MESSAGE_SIGNATURE}"<br>        !define FAILURE_MESSAGE         "${MESSAGE_INTRO} $\n$\nUnfortunately your UT3 installation was not found in the registry. ${MESSAGE_SIGNATURE}"<br>        ;Interface Settings<br>        ;=== Header Icon<br>    !define MUI_ICON "${AP_ICON}"<br>        !define MUI_ABORTWARNING<br>        !define MUI_WELCOMEFINISHPAGE_BITMAP "${LOGO}"<br>        !define MUI_PAGE_CUSTOMFUNCTION_LEAVE LeaveDirectory<br>        <br>        ;Get installation folder from registry if available<br>        InstallDirRegKey HKCU "Software\Jailbreak" ""<br>        # Command Line<br>        !define UT3_BINARY_LOC                          "Binaries\UT3.exe"<br>        !define STEAM_UT3_DIR               "\steamapps\common\unreal tournament 3\"<br><br>        !define UT3_CMD_OPTIONS                         "-mod=..\Jailbreak -solomod"<br><br>        !define EDITOR_LNK                              "UnrealED - Jailbreak.lnk"<br>        !define GAME_LNK                                        "Play Jailbreak.lnk"<br># End Config<br>###############################################################################<br>###############################################################################<br># Begin Constants<br>;--------------------------------------------------------------------------------------------------------------------<br>#  Branding Variables<br>;!include "required_files\constants.nsh"<br>        BrandingText "${INSTALLERLEGALCOPYRIGHT}"<br>        VIProductVersion "${JAILBREAK_INSTALLER_VERSION}"<br>        VIAddVersionKey ProductName "${NAME}"<br>        VIAddVersionKey Comments "${INSTALLERCOMMENTS}"<br>        VIAddVersionKey PRODUCT_COMPANY "${PRODUCT_COMPANY}"<br>        VIAddVersionKey ProductWebsite "${PRODUCT_WEB_SITE}"<br>        VIAddVersionKey Website "${PRODUCT_WEB_SITE}"<br>        VIAddVersionKey LegalCopyright "${INSTALLERLEGALCOPYRIGHT}"<br>        VIAddVersionKey FileDescription "${NAME}"<br>        VIAddVersionKey FileVersion "${VERSION}"<br>        VIAddVersionKey ProductVersion "${VERSION}"<br>        VIAddVersionKey InternalName "${NAME}"<br>        VIAddVersionKey LegalTrademarks "${INSTALLERADDITIONALTRADEMARKS}"<br>        VIAddVersionKey OriginalFilename "${FILENAME}.paf.exe"<br>        VIAddVersionKey PlanetJailbreak.comInstallerVersion "${JAILBREAK_INSTALLER_VERSION}"<br># End Constants<br>###############################################################################<br>###############################################################################<br># Begin  Registry Information<br>;--------------------------------------------------------------------------------------------------------------------<br>#  Registry Key Variables<br>;!include "required_files\registry_keys.nsh"<br><br>;--------------------------------<br><br>        # UT3 CU Registry Keys<br>        !define INSTALL_CU_KEY_UNK1_32          "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{C019D439-E7F8-49EB-85FA-6D0C8CCBDA23}"<br>        !define INSTALL_CU_KEY_UNK2_32          "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{A007C579-B78D-4FDE-A85A-16987A251E53}"<br>        !define INSTALL_CU_KEY_UNK3_32          "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{FDBBAF14-5ED8-49B7-A5BE-1C35668B074D}"<br>        !define INSTALL_CU_KEY_UNK4_32          "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{69082C6E-1944-4EAD-B119-06DCBF492C3F}"<br>        !define INSTALL_CU_KEY_US_WIN_32        "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{BFA90209-7AFF-4DB6-8E4B-E57305751AD7}"<br>        !define INSTALL_CU_KEY_UNK1_64          "SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{C019D439-E7F8-49EB-85FA-6D0C8CCBDA23}"<br>        !define INSTALL_CU_KEY_UNK2_64          "SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{A007C579-B78D-4FDE-A85A-16987A251E53}"<br>        !define INSTALL_CU_KEY_UNK3_64          "SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{FDBBAF14-5ED8-49B7-A5BE-1C35668B074D}"<br>        !define INSTALL_CU_KEY_UNK4_64          "SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{69082C6E-1944-4EAD-B119-06DCBF492C3F}"<br>        !define INSTALL_CU_KEY_US_WIN_64        "SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{BFA90209-7AFF-4DB6-8E4B-E57305751AD7}"<br><br>        # UT3 LM Registry Keys<br>        !define INSTALL_LM_KEY_UNK1_32          "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{C019D439-E7F8-49EB-85FA-6D0C8CCBDA23}"<br>        !define INSTALL_LM_KEY_UNK2_32          "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{A007C579-B78D-4FDE-A85A-16987A251E53}"<br>        !define INSTALL_LM_KEY_UNK3_32          "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{FDBBAF14-5ED8-49B7-A5BE-1C35668B074D}"<br>        !define INSTALL_LM_KEY_UNK4_32          "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{69082C6E-1944-4EAD-B119-06DCBF492C3F}"<br>        !define INSTALL_LM_KEY_US_WIN_32        "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{BFA90209-7AFF-4DB6-8E4B-E57305751AD7}"<br>        !define INSTALL_LM_KEY_UNK1_64          "SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\{C019D439-E7F8-49EB-85FA-6D0C8CCBDA23}"<br>        !define INSTALL_LM_KEY_UNK2_64          "SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\{A007C579-B78D-4FDE-A85A-16987A251E53}"<br>        !define INSTALL_LM_KEY_UNK3_64          "SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\{FDBBAF14-5ED8-49B7-A5BE-1C35668B074D}"<br>        !define INSTALL_LM_KEY_UNK4_64          "SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\{69082C6E-1944-4EAD-B119-06DCBF492C3F}"<br>        !define INSTALL_LM_KEY_US_WIN_64        "SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\{BFA90209-7AFF-4DB6-8E4B-E57305751AD7}"<br>        # Steam Registry Keys<br>        !define INSTALL_KEY_STEAM               "Software\Valve\Steam"<br><br><br># End Registry Information<br>###############################################################################<br>###############################################################################<br># Begin Variable Decleration<br>;--------------------------------------------------------------------------------------------------------------------<br>;Variables<br>Var StartMenuFolder     <br># End Variable Decloration<br>###############################################################################<br>###############################################################################<br># Begin Pages<br>;--------------------------------------------------------------------------------------------------------------------<br>;Pages<br>        ; Installer Pages<br>        !define MUI_CUSTOMFUNCTION_GUIINIT CustomPageFunction<br><br>        !define MUI_WELCOMEPAGE_TITLE "Unreal Tournament 3 - Jailbreak"<br>        !insertmacro MUI_PAGE_WELCOME<br><br>        !ifdef LICENSEAGREEMENT<br>                !define MUI_LICENSEPAGE_CHECKBOX<br>        !insertmacro MUI_PAGE_LICENSE "${NSISDIR}\Docs\Modern UI\License.txt"<br>        !endif<br>        Page custom CustomPageFunction <br>        !insertmacro MUI_PAGE_COMPONENTS<br>        !insertmacro MUI_PAGE_DIRECTORY<br>        <br>        ;!define MUI_STARTMENUPAGE_REGISTRY_ROOT "HKCU" <br>        ;!define MUI_STARTMENUPAGE_REGISTRY_KEY "Software\Jailbreak" <br>        ;!define MUI_STARTMENUPAGE_REGISTRY_VALUENAME "Start Menu Folder"<br>                !define MUI_STARTPAGE_TITLE "Test"<br>        !insertmacro MUI_PAGE_STARTMENU Application $StartMenuFolder<br>  <br>  <br>        !insertmacro MUI_PAGE_INSTFILES<br>        <br>                !define MUI_FINISHPAGE_TITLE "Jailbreak"<br>        !insertmacro MUI_PAGE_FINISH<br>                !define MUI_FINISHPAGE_TEXT "$(finish)"<br>        ; Un-installer Pages<br>        !insertmacro MUI_UNPAGE_CONFIRM<br>        !insertmacro MUI_UNPAGE_INSTFILES<br># End Pages<br>Function CustomPageFunction<br>  !insertmacro MUI_HEADER_TEXT "Page Title" "Subtitle"<br>  ;!insertmacro MUI_INSTALLOPTIONS_DISPLAY "${LICENSEAGREEMENT}"<br>FunctionEnd<br><br><br>###############################################################################<br>###############################################################################<br># Begin Language Definition<br>;--------------------------------------------------------------------------------------------------------------------<br>;Language Selection Dialog Settings<br>        ;Remember the installer language<br>        !define MUI_LANGDLL_REGISTRY_ROOT "HKCU" <br>        !define MUI_LANGDLL_REGISTRY_KEY "Software\Jailbreak" <br>        !define MUI_LANGDLL_REGISTRY_VALUENAME "Installer Language"<br>;--------------------------------------------------------------------------------------------------------------------<br>;Languages<br>;!include "required_files\language_setup.nsh"<br>          !insertmacro MUI_LANGUAGE "English" ;first language is the default language<br>         /*<br>          !insertmacro MUI_LANGUAGE "French"<br>          !insertmacro MUI_LANGUAGE "German"<br>          !insertmacro MUI_LANGUAGE "Spanish"<br>          !insertmacro MUI_LANGUAGE "SpanishInternational"<br>          !insertmacro MUI_LANGUAGE "SimpChinese"<br>          !insertmacro MUI_LANGUAGE "TradChinese"<br>          !insertmacro MUI_LANGUAGE "Japanese"<br>          !insertmacro MUI_LANGUAGE "Korean"<br>          !insertmacro MUI_LANGUAGE "Italian"<br>          !insertmacro MUI_LANGUAGE "Dutch"<br>          !insertmacro MUI_LANGUAGE "Danish"<br>          !insertmacro MUI_LANGUAGE "Swedish"<br>          !insertmacro MUI_LANGUAGE "Norwegian"<br>          !insertmacro MUI_LANGUAGE "NorwegianNynorsk"<br>          !insertmacro MUI_LANGUAGE "Finnish"<br>          !insertmacro MUI_LANGUAGE "Greek"<br>          !insertmacro MUI_LANGUAGE "Russian"<br>          !insertmacro MUI_LANGUAGE "Portuguese"<br>          !insertmacro MUI_LANGUAGE "PortugueseBR"<br>          !insertmacro MUI_LANGUAGE "Polish"<br>          !insertmacro MUI_LANGUAGE "Ukrainian"<br>          !insertmacro MUI_LANGUAGE "Czech"<br>          !insertmacro MUI_LANGUAGE "Slovak"<br>          !insertmacro MUI_LANGUAGE "Croatian"<br>          !insertmacro MUI_LANGUAGE "Bulgarian"<br>          !insertmacro MUI_LANGUAGE "Hungarian"<br>          !insertmacro MUI_LANGUAGE "Thai"<br>          !insertmacro MUI_LANGUAGE "Romanian"<br>          !insertmacro MUI_LANGUAGE "Latvian"<br>          !insertmacro MUI_LANGUAGE "Macedonian"<br>          !insertmacro MUI_LANGUAGE "Estonian"<br>          !insertmacro MUI_LANGUAGE "Turkish"<br>          !insertmacro MUI_LANGUAGE "Lithuanian"<br>          !insertmacro MUI_LANGUAGE "Slovenian"<br>          !insertmacro MUI_LANGUAGE "Serbian"<br>          !insertmacro MUI_LANGUAGE "SerbianLatin"<br>          !insertmacro MUI_LANGUAGE "Arabic"<br>          !insertmacro MUI_LANGUAGE "Farsi"<br>          !insertmacro MUI_LANGUAGE "Hebrew"<br>          !insertmacro MUI_LANGUAGE "Indonesian"<br>          !insertmacro MUI_LANGUAGE "Mongolian"<br>          !insertmacro MUI_LANGUAGE "Luxembourgish"<br>          !insertmacro MUI_LANGUAGE "Albanian"<br>          !insertmacro MUI_LANGUAGE "Breton"<br>          !insertmacro MUI_LANGUAGE "Belarusian"<br>          !insertmacro MUI_LANGUAGE "Icelandic"<br>          !insertmacro MUI_LANGUAGE "Malay"<br>          !insertmacro MUI_LANGUAGE "Bosnian"<br>          !insertmacro MUI_LANGUAGE "Kurdish"<br>          !insertmacro MUI_LANGUAGE "Irish"<br>          !insertmacro MUI_LANGUAGE "Uzbek"<br>          !insertmacro MUI_LANGUAGE "Galician"<br>          !insertmacro MUI_LANGUAGE "Afrikaans"<br>          !insertmacro MUI_LANGUAGE "Catalan"<br>          !insertmacro MUI_LANGUAGE "Esperanto"<br>*/<br><br>                ;LangString welcome ${LANG_ENGLISH} "This wizard will guide you through the installation of ${NAME}.\r\n\r\nIf you are upgrading an existing installation of ${NAME}, please close UT3 before proceeding.\r\n\r\nClick Next to continue."<br>                LangString finish ${LANG_ENGLISH} "${NAME} has been installed on your device.\r\n\r\nClick Finish to close this wizard."<br>                LangString runwarning ${LANG_ENGLISH} "Please close all instances of ${CLOSENAME} and then click OK.  Jailbreak Mod can not be upgraded while it is running."<br>                LangString invaliddirectory ${LANG_ENGLISH} "The destination folder you selected is invalid.  Please choose a valid folder."<br>                LangString notenoughspace ${LANG_ENGLISH} "The device you have selected to install to does not have enough free space for Jailbreak."<br>;       LangString required ${LANG_ENGLISH} "required"<br>                ;LangString checkforplatform ${LANG_ENGLISH} "Checking for previous install of Jailbreak"<br>                ;LangString refreshmenu ${LANG_ENGLISH} "Refreshing Jailbreak Menu"<br><br>!insertmacro MUI_RESERVEFILE_LANGDLL<br>!insertmacro MUI_RESERVEFILE_LANGDLL<br># End Language Definition<br>###############################################################################<br>;--------------------------------------------------------------------------------------------------------------------<br>;Reserve Files<br>  <br>  ;If you are using solid compression, files that are required before<br>  ;the actual installation should be stored first in the data block,<br>  ;because this will make your installer start faster.<br>  <br>###############################################################################<br>###############################################################################<br># Begin Section Over-rides<br>;--------------------------------<br>;Installer Sections<br><br>Section "!Jailbreak (required)" section_jailbreak_main<br>SectionIn RO<br>        SetOutPath $INSTDIR<br><br>        ;Store installation folder<br>        WriteRegStr HKCU "Software\Jailbreak" "" $INSTDIR<br><br><br><br>        # Begin copying necessary files over<br>        ;File /oname=$OUTDIR\readme.txt                 readme.txt<br>        ;File /oname=$OUTDIR\changelog.txt      changelog.txt<br><br>        # CustomChars<br>        ;CreateDirectory        $OUTDIR\Screenshots<br><br>        ;CreateDirectory        $OUTDIR\Splash<br><br>        ;SetOutPath $INSTDIR\Splash<br>        ;File /oname=$OUTDIR\Splash.bmp                                                         ..\..\Trunk\Splash\Splash.bmp<br>        ;File /oname=$OUTDIR\EdSplash.bmp                                               ..\..\Trunk\Splash\EdSplash.bmp<br><br>        # Maps<br>        CreateDirectory         $INSTDIR\Maps<br>        # Localization<br>        CreateDirectory         $INSTDIR\Localization<br>        CreateDirectory         $INSTDIR\Localization\DEU<br>        CreateDirectory         $INSTDIR\Localization\ESN<br>        CreateDirectory         $INSTDIR\Localization\FRA<br>        CreateDirectory         $INSTDIR\Localization\INT<br>        CreateDirectory         $INSTDIR\Localization\ITA<br><br>        SetOutPath $INSTDIR\Localization<br><br>    ; Write Uninstaller information<br><br>        WriteUninstaller "$INSTDIR\${UNINSTALLER}"<br><br>        WriteRegStr "${PRODUCT_UNINST_ROOT_KEY}" "${PRODUCT_UNINST_KEY}" "DisplayName" "${NAME}"<br>        WriteRegStr "${PRODUCT_UNINST_ROOT_KEY}" "${PRODUCT_UNINST_KEY}" "UninstallString" "$INSTDIR\${UNINSTALLER}"<br>        WriteRegStr "${PRODUCT_UNINST_ROOT_KEY}" "${PRODUCT_UNINST_KEY}" "DisplayVersion" "${VERSION}"<br>        WriteRegStr "${PRODUCT_UNINST_ROOT_KEY}" "${PRODUCT_UNINST_KEY}" "URLInfoAbout" "${PRODUCT_WEB_SITE}"<br>        WriteRegStr "${PRODUCT_UNINST_ROOT_KEY}" "${PRODUCT_UNINST_KEY}" "Publisher" "${PRODUCT_COMPANY}"<br>        WriteRegStr "${PRODUCT_UNINST_ROOT_KEY}" "${PRODUCT_UNINST_KEY}" "Install Date" "${__TIMESTAMP__}"<br>            #######################################################################<br>                # Sub Section Start Menu Begin<br>                ;!include "required_files\start_menu.nsh"<br>                ;Call setStartFolder<br>                !insertmacro MUI_STARTMENU_WRITE_BEGIN Application<br><br>                        SetOutPath                      $INSTDIR<br><br>                    # Get the path to the UT3 binary<br><br>                        <br>                        <br>                        WriteIniStr             "$INSTDIR\${PRODUCT_COMPANY}.url" "InternetShortcut" "URL" "${PRODUCT_WEB_SITE}"<br>                        CreateDirectory         "$SMPROGRAMS\$StartMenuFolder"<br>                        CreateShortCut          "$SMPROGRAMS\$StartMenuFolder\Website.lnk" "$INSTDIR\${PRODUCT_COMPANY}.url"<br>                        CreateShortCut          "$SMPROGRAMS\$StartMenuFolder\Uninstall.lnk" "$INSTDIR\${UNINSTALLER}"<br><br><br>                        ClearErrors<br><br>                        # Check Current User keys first<br>                        ReadRegStr $0 HKCU "${INSTALL_CU_KEY_UNK1_32}"                        'InstallLocation'<br>                    IfErrors 0 CheckFiles<br>                        ClearErrors<br>                                ReadRegStr $0 HKCU "${INSTALL_CU_KEY_UNK2_32}"                'InstallLocation'<br>                    IfErrors 0 CheckFiles<br>                        ClearErrors<br>                                ReadRegStr $0 HKCU "${INSTALL_CU_KEY_UNK3_32}"                'InstallLocation'<br>                        IfErrors 0 CheckFiles<br>                        ClearErrors<br>                                ReadRegStr $0 HKCU "${INSTALL_CU_KEY_UNK4_32}"                'InstallLocation'<br>                        IfErrors 0 CheckFiles<br>                        ClearErrors<br>                                ReadRegStr $0 HKCU "${INSTALL_CU_KEY_US_WIN_32}"      'InstallLocation'<br>                        IfErrors 0 CheckFiles<br>                        ClearErrors<br>                                ReadRegStr $0 HKCU "${INSTALL_CU_KEY_UNK1_64}"                'InstallLocation'<br>                        IfErrors 0 CheckFiles<br>                        ClearErrors<br>                                ReadRegStr $0 HKCU "${INSTALL_CU_KEY_UNK2_64}"                'InstallLocation'<br>                        IfErrors 0 CheckFiles<br>                        ClearErrors<br>                                ReadRegStr $0 HKCU "${INSTALL_CU_KEY_UNK3_64}"                'InstallLocation'<br>                        IfErrors 0 CheckFiles<br>                        ClearErrors<br>                                ReadRegStr $0 HKCU "${INSTALL_CU_KEY_UNK4_64}"                'InstallLocation'<br>                        IfErrors 0 CheckFiles<br>                        ClearErrors<br>                                ReadRegStr $0 HKCU "${INSTALL_CU_KEY_US_WIN_64}"      'InstallLocation'<br>                        IfErrors 0 CheckFiles<br>                        ClearErrors # Check the Local Machine keys<br>                                ReadRegStr $0 HKLM "${INSTALL_LM_KEY_UNK1_32}"                'InstallLocation'<br>                    IfErrors 0 CheckFiles<br>                        ClearErrors<br>                                ReadRegStr $0 HKLM "${INSTALL_LM_KEY_UNK2_32}"                'InstallLocation'<br>                    IfErrors 0 CheckFiles<br>                        ClearErrors<br>                                ReadRegStr $0 HKLM "${INSTALL_LM_KEY_UNK3_32}"                'InstallLocation'<br>                        IfErrors 0 CheckFiles<br>                        ClearErrors<br>                                ReadRegStr $0 HKLM "${INSTALL_LM_KEY_UNK4_32}"                'InstallLocation'<br>                        IfErrors 0 CheckFiles<br>                        ClearErrors<br>                                ReadRegStr $0 HKLM "${INSTALL_LM_KEY_US_WIN_32}"      'InstallLocation'<br>                        IfErrors 0 CheckFiles<br>                        ClearErrors<br>                                ReadRegStr $0 HKLM "${INSTALL_LM_KEY_UNK1_64}"                'InstallLocation'<br>                        IfErrors 0 CheckFiles<br>                        ClearErrors<br>                                ReadRegStr $0 HKLM "${INSTALL_LM_KEY_UNK2_64}"                'InstallLocation'<br>                        IfErrors 0 CheckFiles<br>                        ClearErrors<br>                                ReadRegStr $0 HKLM "${INSTALL_LM_KEY_UNK3_64}"                'InstallLocation'<br>                        IfErrors 0 CheckFiles<br>                        ClearErrors<br>                                ReadRegStr $0 HKLM "${INSTALL_LM_KEY_UNK4_64}"                'InstallLocation'<br>                        IfErrors 0 CheckFiles<br>                        ClearErrors<br>                                ReadRegStr $0 HKLM "${INSTALL_LM_KEY_US_WIN_64}"      'InstallLocation'<br>                        IfErrors 0 CheckFiles<br>                        ClearErrors<br>                        ReadRegStr $0 HKCU "${INSTALL_KEY_STEAM}"                     'SteamPath'<br>                        IfErrors 0 CheckFiles<br>                        ClearErrors<br>                        ReadRegStr $0 HKLM "${INSTALL_KEY_STEAM}"                     'InstallPath'<br>                        IfErrors 0 CheckFiles<br>                            GOTO SkipShortcuts<br><br>                        CheckFiles:<br><br>                        ${StrRep} $0 "$0" "/" "\"<br>                        IffileExists "$0Binaries\UT3.exe" CreateShortcuts 0<br>                        IffileExists "$0\steamapps\common\unreal tournament 3\Binaries\UT3.exe" 0 SkipShortcuts<br><br>                    CreateSteamShortcuts:<br>                        # Startup Menu Shortcuts<br>                                ;CreateShortCut "$SMPROGRAMS\Gneu\Project: White\${EDITOR_LNK}"       "$0${STEAM_UT3_DIR}${UT3_BINARY_LOC}" "editor ${UT3_CMD_OPTIONS}"<br>                                ;CreateShortCut "$SMPROGRAMS\Gneu\Project: White\${GAME_LNK}"         "$0${STEAM_UT3_DIR}${UT3_BINARY_LOC}" "${UT3_CMD_OPTIONS}"<br><br>                        # Install Directory Shortcuts<br>                                ;CreateShortCut "$INSTDIR\${EDITOR_LNK}"      "$0${STEAM_UT3_DIR}${UT3_BINARY_LOC}" "editor ${UT3_CMD_OPTIONS}"<br>                                ;CreateShortCut "$INSTDIR\${GAME_LNK}"                "$0${STEAM_UT3_DIR}${UT3_BINARY_LOC}" "${UT3_CMD_OPTIONS}"<br><br>                                MessageBox MB_OK "${SUCCESS_MESSAGE}"<br><br>                        GoTo Done<br>                    CreateShortcuts:<br>                                # Startup Menu Shortcuts<br>                                ;CreateShortCut "$SMPROGRAMS\Gneu\Project: White\${EDITOR_LNK}"       "$0Binaries\UT3.exe" "editor ${UT3_CMD_OPTIONS}"<br>                                ;CreateShortCut "$SMPROGRAMS\Gneu\Project: White\${GAME_LNK}"         "$0Binaries\UT3.exe" "${UT3_CMD_OPTIONS}"<br><br>                        # Install Directory Shortcuts<br>                                ;CreateShortCut "$INSTDIR\${EDITOR_LNK}"      "$0${UT3_BINARY_LOC}" "editor ${UT3_CMD_OPTIONS}"<br>                                ;CreateShortCut "$INSTDIR\${GAME_LNK}"                "$0${UT3_BINARY_LOC}" "${UT3_CMD_OPTIONS}"<br><br>                                MessageBox MB_OK "${SUCCESS_MESSAGE}"<br>                                GoTo Done<br><br>                    SkipShortcuts:<br>                        MessageBox MB_OK "${FAILURE_MESSAGE}"<br><br>                        Done:<br>                        ;Create shortcuts<br><br>                !insertmacro MUI_STARTMENU_WRITE_END<br>                # End Sub Section Start Menu<br>                #######################################################################<br>                <br>SectionEnd<br><br>Section "Jailbreak Maps" section_maps<br>        SetOutPath $INSTDIR<br>SectionEnd<br><br>;Assign descriptions to sections<br>!insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br>        !insertmacro MUI_DESCRIPTION_TEXT ${section_jailbreak_main} "Jailbreak Mod."<br>        !insertmacro MUI_DESCRIPTION_TEXT ${section_maps} "Jailbreak Maps."<br>!insertmacro MUI_FUNCTION_DESCRIPTION_END<br><br>;--------------------------------<br>;Uninstaller Section<br><br>Section "Uninstall"<br>  Delete "$INSTDIR\${UNINSTALLER}"<br>  RMDir "$INSTDIR"<br>  DeleteRegKey /ifempty HKCU "Software\Jailbreak"<br>SectionEnd<br># End Section Over-rides<br>###############################################################################<br>###############################################################################<br># Begin Function Decleration<br>;!include "required_files\functions.nsh"<br>        ;--------------------------------<br>        ;Installer Functions<br><br>        Function .onInit<br>                InitPluginsDir<br>        File /oname=$PLUGINSDIR\splash.bmp "${LOGO}"<br>                                                ;delay   fadein   fadeout<br>                advsplash::show 2000 1000 1000 -1 $PLUGINSDIR\splash<br><br>                Pop $0 <br>        Delete $PLUGINSDIR\splash.bmp<br>                <br>                !insertmacro MUI_LANGDLL_DISPLAY<br>                Call setStartFolder<br>        FunctionEnd<br><br><br>        ;--------------------------------<br>        ;Uninstaller Functions<br><br>        Function un.onInit<br>          !insertmacro MUI_UNGETLANGUAGE<br>        FunctionEnd<br><br>        Function LeaveDirectory<br>                GetInstDirError $0<br>                ;=== Does it already exist? (upgrade)<br>                IfFileExists "$INSTDIR\Jailbreak.u" "" CheckInstallerError<br>                        ;=== Check if app is running?<br>                        StrCmp ${CHECKRUNNING} "NONE" CheckInstallerError<br>                                FindProcDLL::FindProc "${CHECKRUNNING}"<br>                                StrCmp $R0 "1" "" CheckInstallerError<br>                                        MessageBox MB_OK|MB_ICONINFORMATION "$(runwarning)"<br>                                        Abort<br>                CheckInstallerError:<br>                        ${Switch} $0<br>                            ${Case} 0 ;=== Valid directory and enough free space<br>                                        ${Break}<br>                            ${Case} 1<br>                                        MessageBox MB_OK "$(invaliddirectory)"<br>                                        Abort<br>                                        ${Break}<br>                            ${Case} 2<br>                                        IfFileExists "$INSTDIR" "" NotEnoughSpaceNoUpgrade ;=== Is upgrade<br>                                                SectionGetSize ${section_jailbreak_main} $1 ;=== Space Required for App<br>                                                ${GetRoot} "$INSTDIR" $2<br>                                                ${DriveSpace} "$2\" "/D=F /S=K" $3 ;=== Space Free on Device<br>                                                ${GetSize} "$INSTDIR" "/M=*.* /S=0K /G=1" $4 $5 $6 ;=== Current installation size<br>                                                IntOp $7 $3 + $4 ;=== Space Free + Current Install Size<br><br>                                    NotEnoughSpaceNoUpgrade:<br>                                                MessageBox MB_OK "$(notenoughspace)"<br>                                                Abort<br>                                        ${Break}<br>                        ${EndSwitch}<br>        FunctionEnd<br><br>        Function  setStartFolder<br>                StrCpy $StartMenuFolder "${STARTMENUFOLDER}"<br>        FunctionEnd<br># End Function Decleration<br>###############################################################################<br></code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">File077</span><br>
      <span class="post-time small text-muted">21st August 2009 09:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Never mind, I figured that part out.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script type="text/javascript" src="../js/highlight.pack.js" async>
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>