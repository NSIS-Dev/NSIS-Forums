<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Getting Hostname"><title>Getting Hostname - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Getting Hostname</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=305381">Getting Hostname</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">southcot</span><br><span class="post-time small text-muted">15th April 2009 17:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Getting Hostname</strong><br>VERY much a newbie to this and it's proving a steep learning curve.<br><br>I want to configure an installer that will read the current hostname of a Windows XP or Vista machine, store it for un-install purposes and then change the hostname. The searches I have made have told me little.<br><br>So far I have come across examples of code such as:-<br><br>System::Call "kernel32.dll::GetComputerNameW(t .r0,*i ${NSIS_MAX_STRLEN} r1)i.r2"<br><br>but I can't find anything I understand that tells me how to use this in a script and also what the various parameters are.<br><br>I would be grateful if someone could point me in the right direction.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Animaether</span><br><span class="post-time small text-muted">15th April 2009 17:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">that's not really typical NSIS scripting, as it invokes the System plugin that calls DLL functions (in this case, the function 'GetComputerNameW' in 'kernel32.dll'.<br><br>Example code with usage examples is provided in:<br><a href="http://nsis.sourceforge.net/Your_Computer_Name" target="_blank">http://nsis.sourceforge.net/Your_Computer_Name</a> (uses the registry rather than the GetComputerName functions)<br><br><a href="http://nsis.sourceforge.net/User_Management_using_API_calls#Get_Server_Name" target="_blank">http://nsis.sourceforge.net/User_Man...et_Server_Name</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">southcot</span><br><span class="post-time small text-muted">15th April 2009 17:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for the speedy response. I had come across the latter but couldn't see how to use the macro - part of this steep incline I'm following!! Is the ability to set the name just a mirror of GetComputerNameW using SetComputerNameW</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Animaether</span><br><span class="post-time small text-muted">15th April 2009 18:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">naw, you'd have to look into:<br><a href="http://msdn.microsoft.com/en-us/library/ms724931" target="_blank">http://msdn.microsoft.com/en-us/library/ms724931</a>(VS.85).aspx<br>The System plugin documentation should tell you how/what, but that thing still confuses me half the time :\<br>Thankfully, this was covered on these Forums before, so:<br><a href="http://forums.winamp.com/showthread.php?postid=2005624" target="_blank">http://forums.winamp.com/showthread.php?postid=2005624</a><br><br><br>I'm not sure if you could also write it out to the registry and use WM_WININICHANGE to notify the system of that change; so best to go with the above URL</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">southcot</span><br><span class="post-time small text-muted">16th April 2009 15:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This excellent the second link does the trick beautifully, many thanks. I'm not sure how I missed it when trawling for solutions, I try not to be a helpless newbie when I start something new. I am still very confused as to what the parameters mean etc. The MSDN link does not seem to offer much enlightenment on this point. I guess it will become apparent as I carry on.<br><br>Thanks again.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Animaether</span><br><span class="post-time small text-muted">16th April 2009 18:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, the System plugin is a whole different world from NSIS scripting, it does some pretty raw handling of passing data into DLL functions, getting data back, etc.<br><br></p><pre>
<code>System::Call 'kernel32.dll::SetComputerNameExA(i 5,t "$ComputerName")i.r1'</code>
</pre><br><br>That, for example, can be broken up into:<br><pre>
<code><br>System:: ; invoke something in the System plugin<br>::Call ; specifically, the Call function.<br></code>
</pre><br>
      That's NSIS's standard syntax for calling a plugin function.<br>
      <br>
      The parameters for that function follow within the ' single quotes:<br>
      <pre>
<code><br>kernel32.dll:: ; Invoke something within the kernel32 DLL file<br>::SetComputerNameExA ; Specifically, the SetComputerNameEx function.  It ends here in A so that the ANSI version is called, specifically.<br></code>
</pre><br>
      <br>
      SetComputerNameEx is, again, 'documented' over at:<br>
      <a href="http://msdn.microsoft.com/en-us/library/ms724931" target="_blank">http://msdn.microsoft.com/en-us/library/ms724931</a>(VS.85).aspx<br>
      <br>
      The parameters for that function follow within the ( ) parentheses:<br>
      <pre>
<code><br>i 5 ; The first parameter is an integer number, the number 5<br>t "$ComputerName" ; The second parameter i text, the string that follows ($ComputerName is an NSIS variable declared earlier).<br></code>
</pre><br>
      <br>
      Those two parameters follow from that function's description page at MSDN. It takes two parameters:<br>
      <br>
      the COMPUTER_NAME_FORMAT to set, which is detailed further on the link given on that MSDN page to: <a href="http://msdn.microsoft.com/en-us/library/ms724224" target="_blank">http://msdn.microsoft.com/en-us/library/ms724224</a>(VS.85).aspx (the one you'd be interested in, !define ComputerNamePhysicalDnsHostname, is the 6th item in that list - but they start counting at 0 (zero), so the number to use is 5)<br>
      <br>
      And the actual name to set. The MSDN page shows that it actually wants a pointer to a buffer in the memory that holds the string, but the System plugin is smart enough to do that work for you and just lets you specify the text directly.<br>
      <br>
      Finally, you may want to check if it worked or not, so you need the output from that function. That's define behind the parentheses:<br>
      <pre>
<code>i.r1</code>
</pre><br>
      That means that the expected result should be of an integer type (the MSDN page shows that the result should be a BOOL, which basically means it will return an integer value of either 0 (zero, false) or 1 (one, true), and that you want to store that result in $1. Note that dot in front of 'r1', that would normally be the input value as far as the System plugin goes.. but obviously there's no input to give for the -result- of a function, so you can tell System that there is no input value by using that dot.<br>
      <br>
      I'm probably not the best at explaining the finer details of the System plugin (still grappling with it a bit myself).. I'd say have a peek at the System plugin documentation, the various examples for it, and search the forums for other uses. It's *very* powerful, but whenever I can, I stay very far away from it :)
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">southcot</span><br>
      <span class="post-time small text-muted">16th April 2009 19:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Brilliant thanks again for all the help. This has opened up much more for me. The help you gave me before has meant I have already been able to start to develop the installer I need and this is icing on the cake.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script type="text/javascript" src="../js/highlight.pack.js" async>
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>