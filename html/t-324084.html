<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="When to &quot;Run as Admin&quot; for fonts?" />

  <title>When to "Run as Admin" for fonts? - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">When to "Run as Admin" for fonts?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=324084">When to "Run as Admin" for fonts?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">NealWalters</span><br />
      <span class="post-time small text-muted">16th November 2010 04:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>When to "Run as Admin" for fonts?</strong><br />
      Does anyone know which versions of Windows require "run as Admin" to install fonts?<br />
      Also, will the code below work only on Win-7, or will it also work on Win-XP and Vista?<br />
      <br />
      I'm using an old font.dll (don't have that with me today) on the app I sell, but was looking to upgrade to the new NSIS. About 5 to 10% of the users have been having problems installing the fonts, and I provide a manual procedure, but that number seems to be growing lately (I'm guessing because of Win 7).<br />
      <br />
      I wrote the following sample and tested today at home on Win7 (created with v2.46).<br />
      <br />
      <br />
      !include FontReg.nsh<br />
      !include FontName.nsh<br />
      !include WinMessages.nsh<br />
      <br />
      ; The name of the installer<br />
      Name "FontTest01"<br />
      <br />
      ; The file to write<br />
      OutFile "FontTest01.exe"<br />
      <br />
      ; The default installation directory<br />
      InstallDir $DESKTOP\Example1<br />
      <br />
      ; Request application privileges for Windows Vista<br />
      RequestExecutionLevel user<br />
      <br />
      ;--------------------------------<br />
      ; Pages<br />
      Page directory<br />
      Page instfiles<br />
      ;--------------------------------<br />
      <br />
      ; The stuff to install<br />
      Section "" ;No components page, name is not important<br />
      <br />
      ; Set output path to the installation directory.<br />
      SetOutPath $INSTDIR<br />
      <br />
      ; Put file there<br />
      File readme.txt<br />
      <br />
      SectionEnd ; end the section<br />
      <br />
      Section "Fonts"<br />
      StrCpy $FONT_DIR "c:\windows\fonts" ; one directory under current directory<br />
      !insertmacro InstallTTFFont 'hebbook.ttf'<br />
      !insertmacro InstallTTFFont 'hebbook6.ttf'<br />
      SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0 /TIMEOUT=5000<br />
      SectionEnd<br />
      <br />
      <br />
      When I didn't do right-click "run as Admin" on the fontTest01.exe, I get this error:<br />
      <br />
      Error opening file for writing: C:\windows\fonts\hebbook.ttf.<br />
      <br />
      Thanks,<br />
      Neal Walters</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">16th November 2010 07:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by NealWalters</small><br />
        Does anyone know which versions of Windows require "run as Admin" to install fonts?
      </blockquote>All NT versions. That includes 2000, XP and anything newer than that.<br />
      <br />

      <blockquote>
        <small>Originally posted by NealWalters</small><br />
        Also, will the code below work only on Win-7, or will it also work on Win-XP and Vista?
      </blockquote>Your code will not work on ANY windows version. You requestexecutionlevel user, while you need admin to install a font. (Remember: requestexecutionlevel only works on Vista/7 when UAC is turned ON! You must always use the UserInfo plugin in .onInit to verify whether you really got admin access!)
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
