<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Closing IE7 problem"><title>Closing IE7 problem - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Closing IE7 problem</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=254083">Closing IE7 problem</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">M-Force</span><br><span class="post-time small text-muted">25th August 2006 16:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Closing IE7 problem</strong><br>Hi,<br>i have an installer which needs to close all internet explorer windows prior to installation. I had no problem with IE6 but i ran into problems with IE7. I can close IE7 in case no tabs were used. The problem occurs only when there are several tabs and the installer tries to close such IE window. IE7 pops up a question if you want to close all tabs. These pop up is flaring so much that i cant even click to proceed. I guess it is because the code for closing multiple IE windows is in a loop.<br><br>Do you have any idea how to force IE7 to close even if there are mor than one tab or any other way how to handle this?<br><br>Thank you very much for your help<br><br>Have a look at my code:<br><br>!macro CLOSE_IE<br>;Closing all IE Windows<br>loop:<br>FindWindow $0 "IEFrame"<br>IntCmp $0 0 done<br>IsWindow $0 0 done<br>System::Call 'user32::PostMessageA(i,i,i,i) i($0,${WM_CLOSE},0,0)'<br>Sleep 100<br>Goto loop<br>done:<br>!macroend</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">26th August 2006 20:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">maybe the wm_command for File&gt;Exit doesnt show the warning, or a command that closes all(or all except active) tabs</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Takhir</span><br><span class="post-time small text-muted">27th August 2006 12:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">WM_SYSCOMMAND SCCLOSE may help. Or plug-in <a href="http://nsis.sourceforge.net/FCT_plug-in" target="_blank">http://nsis.sourceforge.net/FCT_plug-in</a> with /SCCLOSE key defined.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">M-Force</span><br><span class="post-time small text-muted">31st August 2006 15:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Takhir,<br><br>thank you for your answer. I tried to test your FCT_plug-in, but when i try to compile the IE.nsi i am always getting the following error:<br><br>Invalid command: fct::fct<br>Error in script ie.nsi" on line 16 -- aborting creation process<br><br>What do i need to do in order to make it compile?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Takhir</span><br><span class="post-time small text-muted">31st August 2006 15:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">put included fct.dll to your program files\nsis\plugins folder ;)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">M-Force</span><br><span class="post-time small text-muted">31st August 2006 15:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Great, that works :-)<br>Thank you<br><br>Is it also possible to have the fct.dll in a different location? So that i define the location of the fct.dll inside the script and load it?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Takhir</span><br><span class="post-time small text-muted">31st August 2006 17:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If we are talking about plug-in location on the user's comp, CallInstDll from Manual 4.11.3 'Calling plug-ins manually' should help.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dienjd</span><br><span class="post-time small text-muted">31st August 2006 20:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You could just set the registry keys telling IE7 to display the close tabs dialog to NOT display that dialog and then set them back afterwards. A lot easier and safer than using a plug-in.<br><br>I think the reg values are in HKCU\Software\Microsot\Internet Explorer\TabbedBrowsing , but I forgot the value name.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">31st August 2006 23:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">that would probably not work, I would guess that IE reads the value at startup only</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dienjd</span><br><span class="post-time small text-muted">31st August 2006 23:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Anders</i><br><b>that would probably not work, I would guess that IE reads the value at startup only</b></blockquote>That would make sense, but IE seems to read it on the go, so it does work, as of build 7.0.5700.5<br><br>The value is:<br>HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\TabbedBrowsing "WarnOnClose"<br><br>It's a DWORD where 1 means to show the dialog and 0 means not to.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dienjd</span><br><span class="post-time small text-muted">1st September 2006 04:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Re: Closing IE7 problem</strong><br></p><blockquote><i>Originally posted by M-Force</i><br><br>Have a look at my code:<br><br>!macro CLOSE_IE<br>;Closing all IE Windows<br>loop:<br>FindWindow $0 "IEFrame"<br>IntCmp $0 0 done<br>IsWindow $0 0 done<br>System::Call 'user32::PostMessageA(i,i,i,i) i($0,${WM_CLOSE},0,0)'<br>Sleep 100<br>Goto loop<br>done:<br>!macroend [/B]</blockquote>M-Force, there is a potential for your macro to get stuck in an infinite loop. If IE has a dialog window open (like Internet Options, About, etc.) it will not respond to WM_CLOSE messages.<br><br>You can prevent this from happening by doing something like this:<br><pre>
<code><br>StrCpy $R0 0 ;counter<br> loop:<br>       FindWindow $0 "IEFrame"<br>       IntCmp $0 0 done<br>       IsWindow $0 0 done<br>       System::Call 'user32::PostMessageA(i,i,i,i) i($0,${WM_CLOSE},0,0)'<br>       Sleep 100<br>       IntOp $R0 $R0 + 1 ;increment counter<br>       IntCmp $R0 50 done ;break loop in case close fails<br>       Goto loop<br>  done:<br></code>
</pre><br>
      I just picked 50 as an arbitrary high number. If a user had over 50 IE windows open they are probably crazy and wouldn't have enough memory free to install your app anyway.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">M-Force</span><br>
      <span class="post-time small text-muted">1st September 2006 16:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hey Guys,<br>
      <br>
      thank you very much for all you interesting and helpfull answers.<br>
      I tested out all the solutions and decided that changing the registry key temporarily works best for me.<br>
      <br>
      Thanks again</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>