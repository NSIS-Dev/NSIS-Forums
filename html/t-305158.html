<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="WriteIniStr to insert values on a custom page?"><title>WriteIniStr to insert values on a custom page? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">WriteIniStr to insert values on a custom page?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=305158">WriteIniStr to insert values on a custom page?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">odyssey5</span><br><span class="post-time small text-muted">9th April 2009 15:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>WriteIniStr to insert values on a custom page?</strong><br>I have created a custom page in MUI including a field that should (if it exists) read a value from registry and pre-fill out the field with this value. So far this is somewhat working:<br><br>ReadRegStr $1 HKLM "regpath..." ''<br>WriteIniStr 'custom.ini' 'Field 3' 'State' '$0'<br><br>However this does not just fill out the value in the custom page, but also alters my custom page ini-file.<br><br>I want this file to be unaltered since I use it for the setup - How do I avoid this?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">9th April 2009 15:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Not quite sure what you mean when you say that you want the ini unaltered while you feed the ini field with the value however did you try SendMessage to feed the specific field when the custom page is initialized?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">odyssey5</span><br><span class="post-time small text-muted">9th April 2009 15:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, I created the ini just to create the custom dialog, but I want to feed the text-fields with some values. It's not my intention to write any ini-files as the final values are supposed to be written in registry.<br><br>SendMessage may seem to do the job, but I don't understand the usage of it. Tried googling, with no help :(</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">9th April 2009 15:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Why googling when you have the NSIS manual, the included examples and firstly this forum?<br>SendMessage is built-in NSIS instruction and should be what you're looking for.<br>You'll probably find dozens examples here in forum.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">odyssey5</span><br><span class="post-time small text-muted">9th April 2009 16:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=303378&amp;highlight=SendMessage" target="_blank">this is the best example</a> I can find, but I'm totally lost at all the addresses :(<br><br>I'm new to this...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">odyssey5</span><br><span class="post-time small text-muted">9th April 2009 16:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">So I can't post links? Great...<br><br>h t t p://forums.winamp.com/showthread.php?s=&amp;threadid=303378&amp;highlight=SendMessage</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">9th April 2009 20:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Okay, quick and dirty but you can get an idea:<br></p><pre>
<code>outfile test.exe<br><br>!define my_custom_page '$PLUGINSDIR\custom.ini'<br><br>!include mui.nsh<br>!include winmessages.nsh<br><br>page custom cCreate<br>!insertmacro mui_page_instfiles<br><br>!insertmacro mui_language english<br><br>section -boo<br>;<br>sectionend<br><br>Function .onInit<br>InitPluginsDir<br>writeinistr '${my_custom_page}' 'settings' 'numfields' '1'<br>writeinistr '${my_custom_page}' "Field 1" "Type" "Text"<br>writeinistr '${my_custom_page}' "Field 1" "Flags" ""<br>writeinistr '${my_custom_page}' "Field 1" "State" "The Quick Brown Fox Jumps Over The Lazy Mad Dog"<br>writeinistr '${my_custom_page}' "Field 1" "Left" "10"<br>writeinistr '${my_custom_page}' "Field 1" "Right" "-10"<br>writeinistr '${my_custom_page}' "Field 1" "Top" "30"<br>writeinistr '${my_custom_page}' "Field 1" "Bottom" "42"<br>Functionend<br><br>function cCreate<br>!insertmacro MUI_INSTALLOPTIONS_INITDIALOG "custom.ini"<br><br>ReadINIStr $1 "${my_custom_page}" "Field 1" "hwnd"<br>SendMessage $1 ${EM_SETREADONLY} 1 0<br>SetCtlColors $1 0x000000 0xFFFFFF<br>ReadRegStr $R0 HKLM "Software\NSIS" ""<br>SendMessage $1 ${WM_SETTEXT} 0 'STR:$R0'<br><br>!insertmacro MUI_INSTALLOPTIONS_SHOW<br>functionend</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sprinleo</span><br>
      <span class="post-time small text-muted">17th September 2009 07:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">does anybody know what's the difference between WriteINIStr and INSTALLOPTIONS_WRITE, how are they different from each other ?<br>
      <br>
      thanks...</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br>
      <span class="post-time small text-muted">17th September 2009 11:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">No difference, MUI_INSTALLOPTIONS_WRITE is just a macro using WriteINIStr:<br>
      <a href="http://forums.winamp.com/showthread.php?postid=1610834" target="_blank">http://forums.winamp.com/showthread.php?postid=1610834</a></p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sprinleo</span><br>
      <span class="post-time small text-muted">17th September 2009 11:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ok, thanks for your quick reply, i am using this code display a custom page, but for some reason, this page is not being displayed at all, instead shows the subsequent page, thoughts ?<br>
      <br>
      WriteINIStr "winst\DatabaseServer.ini" "Field 4" "State" "0"<br>
      !insertmacro INSTALLOPTIONS_DISPLAY "winst\DatabaseServer.ini"</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>