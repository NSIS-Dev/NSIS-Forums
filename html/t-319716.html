<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="COM DLL registration"><title>COM DLL registration - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">COM DLL registration</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=319716">COM DLL registration</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">ender_shadow</span><br><span class="post-time small text-muted">6th June 2010 15:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>COM DLL registration</strong><br>Dear NSIS gods...<br><br>I am relatively new to NSIS, but have managed (with the help of the great wiki) build a decent installation of the product I am responsible for.<br><br>However, I encountered a strange problem, I am relatively sure that it's only on Windows Vista and Windows 7.. The problem deals with the registration of a COM DLL.<br><br>Part of the product I am responsible for includes a COM DLL which has to be registered as part of the installation. I use the internal NSIS command RegDLL (If memory serves) to register the DLL. However, on Windows 7, only for the first time you install the software, this fails... I have a workaround solution for this, so when you run the software it checks if the component is registered, and if not, registers it itself, however, I would prefer a solution through the install.<br><br>During my digging around I stumbled upon the following text:<br><br>"Note that DLLs &amp; OCXs sometimes fail to register automatically at install time because they depend on a newer version of some runtime library (msvcrt.dll and msvcp60.dll being common culprits). These can't yet be upgraded because it's being used by the installer itself, so registration will fail and if it's not storing the result to DllRegisterServer (or just shelling to regsvr32 /s) you won't notice until you launch the app."<br><br>This is from: <a href="http://www.fredshack.com/docs/nsis.html" target="_blank">http://www.fredshack.com/docs/nsis.html</a><br><br>Now, I assume that this is a known issue with NSIS, the question is, does anyone have a good solution to this as part of NSIS itself? or is my solution the best that currently be achieved?<br><br>Many thanks<br><br>AP</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">6th June 2010 16:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">NSIS and the official plugins do not depend on any runtime dll's (Except the native windows api dll's of course) (Are you using 3rd party plugins?)<br><br>Run <a href="http://www.dependencywalker.com/" target="_blank">http://www.dependencywalker.com/</a> on the dll you want to register (on a clean system) and see if there are any missing dependency's. You could also try to register the dll manually; run cmd.exe, run regsvr32 c:\path\your.dll<br><br>And just to make sure, we are talking x86 and not x64 Win7?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ender_shadow</span><br><span class="post-time small text-muted">6th June 2010 16:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Anders,<br><br>Thanks for the really quick reply...<br><br>I'll start from the end :) yes, you are correct, it's an x86 (i.e. 32 bit) machine.<br><br>Registering the DLL manually works fine each time (as I stated, that's my workaround), which makes it seems strange that it's some dependancy that I'm missing... also, since this does not happen on an XP machine, it doesn't seem like that's the case...<br><br>I am using 3rd party plugins, but nothing that's related to registering a COM DLL... if you'll note the quote I gave, it specifically states the situation I am facing... so, from your reply, I assume that you never encountered this situation...<br><br>Some more information about my install - I also deploy (and install) the VC++ redistributable... could this by the root cause of the problem?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">6th June 2010 21:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You could try running <a href="http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx" target="_blank">Process Monitor</a> during the install... (Might want to add MessageBox before and after you register the dll in your .nsi so you can start/stop monitoring with minimal useless output)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ender_shadow</span><br><span class="post-time small text-muted">7th June 2010 06:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Anders,<br><br>Just to make sure, what you're saying is that because the VC++ redistributable is still running, that's what is screwing up my COM registration? If so, that's an interesting direction, which I haven't considered, but since they are both in two separate sections wouldn't that protect me?<br><br>Also, the section that registers the COM dll is done before the VC++ redist... might that be the cause?<br><br>Many thanks again.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">7th June 2010 07:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I don't know what the problem is, but it would be helpful to know if loading a dll is the problem, or something else</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ender_shadow</span><br><span class="post-time small text-muted">8th June 2010 07:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Anders, thank you for your advice, I will try and see how it pans out.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>