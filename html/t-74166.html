<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="JVM detection routine?"><title>JVM detection routine? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">JVM detection routine?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=74166">JVM detection routine?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">ctran@yahoo.com</span><br><span class="post-time small text-muted">1st February 2002 21:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>JVM detection routine?</strong><br>Anyone willing to share a jvm detection/prompt routine? I use the one by Tomcat team but that doesn't work in all cases.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">DarkLord23</span><br><span class="post-time small text-muted">19th February 2002 13:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">up i'm interested!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">spaetz</span><br><span class="post-time small text-muted">20th February 2002 15:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This is what I use, if there are additional/improved version I'd be highly interested as well...<br><br>Function DetectJava<br># this function detects Sun Java from registry and calls the JavaFind utility otherwise<br><br># This is the first time we run the JavaFind<br>StrCpy $5 "No"<br><br>StartCheck:<br># First get the installed version (if any) in $2<br># then get the path in $6<br><br>StrCpy $0 "SOFTWARE\JavaSoft\Java Runtime Environment"<br># Get JRE installed version<br>ReadRegStr $2 HKLM $0 "CurrentVersion"<br>StrCmp $2 "" DetectTry2<br><br># Get JRE path<br>ReadRegStr $6 HKLM "$0\$2" "JavaHome"<br>StrCmp $6 "" DetectTry2<br><br>#We seem to have a JRE now<br>Goto GetJRE<br><br>DetectTry2:<br># we did not get a JRE, but there might be a SDK installed<br>StrCpy $0 "Software\JavaSoft\Java Development Kit"<br># Get JRE installed version<br>ReadRegStr $2 HKLM $0 "CurrentVersion"<br>StrCmp $2 "" RunJavaFind<br><br># Get JRE path<br>ReadRegStr $6 HKLM "$0\$2" "JavaHome"<br>StrCmp $6 "" RunJavaFind<br><br>GetJRE:<br>StrCpy $3 "$6\bin\java.exe"<br>StrCpy $4 "$6\bin\javaw.exe"<br><br># Check if files exists and write paths<br>IfFileExists $3 0 RunJavaFind<br>WriteINIStr "$INSTDIR\FLaunch.ini" "Freenet Launcher" "JavaExec" $3<br>IfFileExists $4 0 RunJavaFind<br>WriteINIStr "$INSTDIR\FLaunch.ini" "Freenet Launcher" "Javaw" $4<br><br># Jump to the end if we did the Java recognition correctly<br>Goto End<br><br>RunJavaFind:<br><br>!ifdef embedJava<br># Install Java runtime only if not found<br>DetailPrint "Lauching Sun's Java Runtime Environment installation..."<br>SetOutPath "$TEMP"<br>File ${JAVAINSTALLER}<br>ExecWait "$TEMP\${JAVAINSTALLER}"<br>Delete "$TEMP\${JAVAINSTALLER}"<br>Goto StartCheck<br>!else<br># opening download page<br>MessageBox MB_YESNO "I did not find Sun's Java Runtime Environment which is needed for Freenet.$\r$\nHit 'Yes' to open the download page for Java (<a href="http://java.sun.com" target="_blank">http://java.sun.com</a>),$\r$\n'No' to cancel the installation." IDYES GetJava<br>Abort<br><br>GetJava:<br># Open the download page for Sun's Java<br>ExecShell "open" "http://javasoft.com/"<br>Sleep 5000<br>MessageBox MB_OKCANCEL "Press OK to continue the Freenet installation AFTER having installed Java,$\r$\nCANCEL to abort the installation." IDOK StartCheck<br>Abort<br>!endif<br><br>AbortJava:<br>MessageBox MB_OK|MB_ICONSTOP "I still can't find any Java interpreter. Did you really installed the JRE?$\r$\nInstallation will now stop."<br>Abort<br><br>End:<br># Restore $0, $2, $5 and $6<br>Pop $6<br>Pop $5<br>Pop $2<br>Pop $0<br>FunctionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">remm</span><br><span class="post-time small text-muted">24th February 2002 18:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Also check %JAVA_HOME%</strong><br>I got a *lot* of feedback on that subject, and although auto-detecting with the registry is quite nice, many people want to specify the JDK to use using a JAVA_HOME env variable.<br><br>Also, many JDKs don't set the normal keys, so it creates lots of problems to rely only on the registry.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">irun5k</span><br><span class="post-time small text-muted">13th May 2003 05:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>need component of some sort</strong><br>Seems like the best way to do this is to have a screen similar to InstallAnywhere that lists all detected JVMs (from registry) and then gives the option for a more advanced JVM search for "orphaned" JVMs, which are common on developer machines... just the /jre file system with no registry entries.<br><br>I'm game for trying to write such a component but I've only last week written my first short NSIS install script so I'd probably need some guidance to get me going. I'm assuming such a component can be written an "plugged in", right?<br><br>Anybody interested in helping me give this a shot? NSIS, with such a feature, would have to be the absolute preferred way of all time to install Java apps on Win32.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">13th May 2003 09:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sure, plugins are easy to write and there are example plugins in the NSIS/Contrib directory. ExDLL is the directory containing the basic template for a plugin (examples given in Delphi and C code). I'm not that sure how easy it is to show your own window from a plugin but I'm pretty sure it can be done (I think the NSISUpdate program does it).<br><br>Thing is I think you could write this without a plugin, just a script that checks for registry entries and maybe scan the disk and then uses an InstallOptions page to show the results.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">irun5k</span><br><span class="post-time small text-muted">13th May 2003 15:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>good idea</strong><br>Thanks for the input- after some review I think you are probably right- this can probably be done more easily and made equally as reusable with InstallOptions which I will dive into now.<br><br>I'm sure I'll be back at some point with some questions.<br><br>Thanks</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">14th May 2003 11:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can save some time if you use LangDLL. LangDLL doesn't really care if you give it a language id or the path to Java. If you don't like the dialog showing as a combobox you can just change the resources and recompile.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pcristip</span><br><span class="post-time small text-muted">15th May 2003 08:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Check the nsis archive<br><a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=162&amp;instances=0,110" target="_blank">http://nsis.sourceforge.net/archive/...nstances=0,110</a><br><br>Chris</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">irun5k</span><br><span class="post-time small text-muted">15th May 2003 13:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>after more review...</strong><br>Okay,<br><br>Now that I've gotten into this, I don't think I can accomplish what I wanted with what I have available.<br><br>The screen below gives three functions-<br><br>1. auto detected JVMs, presumably from the registry and perhaps a java.exe in the system path.<br><br>2. user requestable more intesive auto-discovery. This involves browsing the file system for other JVMs. An extra step here is to pull back the version from the JVM when it is found. There may be a way to check a .dll, but if all else failed, one could exec "java.exe -version" and capture the system out.<br><br>3. faster, direct discovery. Let the user point you right at a JRE or JDK directory via a file chooser if they know where it is and save themselves the misery of waiting for the entire file system to be scanned. Again, in this case the version needs to be extacted from the JDK they specified.<br><br>This seems like more that could be done with the basic script or InstallOptions.<br><br>[img]http://b-gallery******shot.jpg[/img]</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>