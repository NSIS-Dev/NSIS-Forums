<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Need help making win32 calls"><title>Need help making win32 calls - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Need help making win32 calls</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=292018">Need help making win32 calls</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">xplct0</span><br><span class="post-time small text-muted">19th May 2008 22:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Need help making win32 calls</strong><br>I'm having some issues figuring out how to manually call functions in general. I'm starting out with duplicating the functionality of MessageBox, but I've run into a few quirks.<br><br>Here's the function definition:<br>int MessageBox( HWND hWnd, // handle to owner window<br>LPCTSTR lpText, // text in message box<br>LPCTSTR lpCaption, // message box title<br>UINT uType // message box style );<br><br>And here's my attempt to invoke it from NSIS:<br>strcpy $R0 "title"<br>strcpy $R1 "text"<br>System::Call "user32::MessageBoxA(i, t, t, i) (0, $R0, $R1, 1)"<br><br>The message box pops up, however both the title and the text are empty. I'm not sure if "" automatically appends '\0'. On the same note, I'm not sure what NSIS uses for NULL.<br><br>Looking through the tutorial, I find myself very confused about:<br>System::Call 'YourDllName::YourDllFunction(i, *i, t) i(.r0, r1, .r2) .r3'<br><br>I haven't seen anything in the documentation that says what '.r0' means. (I know what $r0 is...)<br><br>I'm doubly confused when later, we see the example:<br>(function definition)<br>int CmGetHotSyncExecPath(TCHAR *pPath, int *piSize);<br>(nsis declaration)<br>CmGetHotSyncExecPath(t, *i) i<br>(nsis invocation)<br>System::Call 'CondMgr::CmGetHotSyncExecPath(t, *i) i(.r0, r1r1).r2'<br><br>What is r1r1??? And once again, what is '.r0'?<br><br>Here's the tutorial:<br><a href="http://nsis.sourceforge.net/Calling_an_external_DLL_using_the_System.dll_plugin#Using_System.dll::Call" target="_blank">http://nsis.sourceforge.net/Calling_...stem.dll::Call</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">19th May 2008 22:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Use R0 and R1 instead of $R0 and $R1 in your call to pass by reference. To pass strings by value they must be surrounded by quotes.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">19th May 2008 22:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Have you looked at the System plug-in documentation?<br><br>r0-r9 is for $0-$9 and R0-R9 is for $R0-$R9.<br>Use a . to gain output in a variable.<br>For example, if you ended your call with i.r0 you would get your message box result in $0 (1 for OK or 2 for Cancel).<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">xplct0</span><br><span class="post-time small text-muted">19th May 2008 22:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I didn't when I was trying to understand that I reviewed the Variables section of the documentation, i.e.<br><br>4.2.2 Other Writable Variables<br>$0, $1, $2, $3, $4, $5, $6, $7, $8, $9, $R0, $R1, $R2, $R3, $R4, $R5, $R6, $R7, $R8, $R9<br><br>Registers. These variables can be used just like user variables...<br><br>which wasn't helping a whole lot heh.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">xplct0</span><br><span class="post-time small text-muted">19th May 2008 23:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">So my last question is dealing with passing a function pointer. Compiling the following lines results in:<br>install function "test" not referenced - zeroing code (269-271) out<br><br><br>Function test<br>MessageBox MB_OK 'This is a test.'<br>FunctionEnd<br><br>(snip)<br><br>System::Call "kernel32::CopyFileEx(t R0, t R1, k test)"</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">19th May 2008 23:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You need to read up on callbacks in the <b>System plug-in</b> documentation.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">xplct0</span><br><span class="post-time small text-muted">19th May 2008 23:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Anders, the reason is actually in my Billboard thread that I started. It's so I can use CopyFileEx... I'm trying to display images based on copy progress(I'm just trying to learn how to use system calls right now).<br><br>Afrow UK, I just found the docs on callbacks, sorry about that.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>