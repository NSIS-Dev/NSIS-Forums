<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Problems writing to registry" />

  <title>Problems writing to registry - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Problems writing to registry</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=319816">Problems writing to registry</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">davidhal</span><br />
      <span class="post-time small text-muted">10th June 2010 02:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Problems writing to registry</strong><br />
      I'm seeing some really odd behavior from NSIS on trying to write/delete to the registry.<br />
      <br />
      I have a number of calls to WriteRegStr that work fine in my script. However, I also have a large number that are silently failing. Coincidentally, the ones that fail all seem to be in HKLM. I'm verifying by simply going into the registry on my development machine and observing which changes have or have not been made.<br />
      <br />
      I am executing this before any of the sections in my installer:<br />
      ; Request application privileges for Windows Vista<br />
      RequestExecutionLevel admin<br />
      <br />
      I included a function like this to test for errors write after the registry writes and it returns Ok:<br />
      Function Test<br />
      ifErrors errorlabel<br />
      MessageBox MB_OK "OK"<br />
      quit<br />
      errorlabel:<br />
      MessageBox MB_OK "Error"<br />
      FunctionEnd<br />
      <br />
      Incredibly, I've now tried to simply compile example2.nsi that comes with NSIS and none of the writes in that seem to be making it to the registry. The relevant writes there are:<br />
      ; Write the installation path into the registry<br />
      WriteRegStr HKLM SOFTWARE\NSIS_Example2 "Install_Dir" "$INSTDIR"<br />
      <br />
      ; Write the uninstall keys for Windows<br />
      WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\Example2" "DisplayName" "NSIS Example2"<br />
      WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\Example2" "UninstallString" '"$INSTDIR\uninstall.exe"'<br />
      WriteRegDWORD HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\Example2" "NoModify" 1<br />
      WriteRegDWORD HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\Example2" "NoRepair" 1<br />
      <br />
      Does anyone have any idea what is going on and what I can do to make example2 work?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">redxii</span><br />
      <span class="post-time small text-muted">10th June 2010 05:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Are you running 64-bit Windows? By default since NSIS makes 32-bit setups, they actually write to "HKEY_LOCAL_MACHINE\Software\Wow6432Node\".</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">davidhal</span><br />
      <span class="post-time small text-muted">10th June 2010 06:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks, you're right!<br />
      <br />
      I didn't know there were a separate set of reg keys there on 64-bit systems.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
