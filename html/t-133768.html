<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Detect Graphics Card Specs? + More"><title>Detect Graphics Card Specs? + More - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Detect Graphics Card Specs? + More</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=133768">Detect Graphics Card Specs? + More</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">mattibbals</span><br><span class="post-time small text-muted">30th April 2003 20:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Detect Graphics Card Specs? + More</strong><br>Greetings!<br><br>I was wondering if there have been any discussions about how to detect the specs on the graphics card on a users computer with NSIS?<br><br>For example: My application cannot run on a computer that does not have a DirectX Compatable 32MB 3d Graphics Card.<br><br>I have seen some entries in the registry regarding DirectX version and the video driver provider but nothing that gives me all the information that I need.<br><br>How about a sound card? or a 101 key keyboard and at least 2 button mouse?<br><br>Are there some functions in the plugins that might help me to gather this information? Is there a place where I can find prototypes and/or descriptions for the functions included in the plugins?<br><br>Thanks in advance for any information regarding this.<br><br>Matthew Win Tibbals</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">30th April 2003 20:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Maybe you can search for information about how to detect this information using C/C++, so you can write a NSIS plugin.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">mattibbals</span><br><span class="post-time small text-muted">30th April 2003 20:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes.. yes.. that is what I am trying to avoid.. if I do end up having to write my own I'll be sure to post it.<br><br>On a different note, some useless information: I work only a few blocks from the Nullsoft HQ in Potrero. (@ 20th and Florida)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">30th April 2003 20:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">There is no plug-in available, so you have to write your own.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">1st May 2003 10:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>Is there a place where I can find prototypes and/or descriptions for the functions included in the plugins?</blockquote>Take a look at each plugin's readme file.<br><br>The System plugin might help you if you just want to call a few Windows API functions without writing your own plugin.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">mattibbals</span><br><span class="post-time small text-muted">15th May 2003 21:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hello,<br><br>I have not given up on this yet so don't worry.<br><br>I have found a function in an existing dll that will return the amount of video memory available to the user. This is the syntax that I am using to try and call the function that I need:<br><br>System::Call "D3D8::GetAvailableTextureMem() i().r2"<br>MessageBox MB_OK "Texture Memory: $2"<br><br>Here is the prototype to the GetAvailableTextureMem function:<br><br>UINT GetAvailableTextureMem();<br><br>The function call does not work as is because the GetAvailableTextureMem function needs to be accessed from a IDirect3DDevice8 object. Is there a way in NSIS to access the function that I need or do I need to create my own dll that creates the needed objects to access the needed function.<br><br>Thanks for any advice or feedback.<br><br>MWT</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">16th May 2003 02:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think you'll need a DLL. I say this because you can't just call that function on it's own like you realised, and in fact it's quite involved. You have to (I think) create a window, initialise Direct 3D 8, create the device, query it, release the device, release D3D, destroy the window. You might be able to skip the window creation step, and since you are only querying the device you might be able to do that without creating the device, but you still need to initialise Direct 3D and get a D3D8 device pointer at the minimum.<br><br>Microsoft give a crappy example of the basic D3D8 device creation steps <a href="http://msdn.microsoft.com/archive/en-us/dx8_c/directx_cpp/graphics_tut_2x83.asp?frame=true" target="_blank">here</a>.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">mattibbals</span><br><span class="post-time small text-muted">18th May 2003 23:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Cool! So I have the DLL built and I can call it from a Win32 Client program that I also put together. I can't for some reason seem to be able to call if from NSIS. If I try to return a variable the variable is always error. It does not seem like it is accessing the DLL at all.<br><br>Here is the function calls I have been making from my NSIS script:<br><br>System::Call 'SystemRequirements::GlobalGetTextureMemory(v) v()'<br>System::Call 'SystemRequirements::GlobalGetTextureMemory(v) 1() .r2'<br><br>Here are the function prototypes that I have been trying:<br><br>void GlobalGetTextureMemory() //I just had this spawn a message box for testing but not successfully<br>int GlobalGetTextureMemory()<br><br>I created a function that can be accessed globally which returns the TextureMemory of a users computer.<br><br>I checked through System.txt and a lot of other forum postings but did not see anything obvious that I should be doing in order to get this to work.<br><br>Thanks a lot for any help!<br><br>Thanks,<br><br>MWT</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">18th May 2003 23:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">First of all, it should be GlobalGetTextureMemory(v) i() .r2 not GlobalGetTextureMemory(v) 1() .r2 [notice the i instead of 1].<br><br>System usually fails when it can't find the plug-in or can't find the exported function in it. Since you've said you've called from another client program it must be the first reason.<br><br>But why would you want to use System.dll to call a function from your own plug-in? Why not just create a NSIS plug-in? Have a look at Contrib\ExDLL for a plug-in skeleton and other directories for more examples.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">mattibbals</span><br><span class="post-time small text-muted">19th May 2003 01:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">err... that "1" was a typo.. thanks for catching it.<br><br>I have the project from Contrib\ExDLL open and I have been playing around with it. I am still having some problems connecting to it from NSIS.<br><br>From the ExDLL project in the function "myFunction" I think I can see how variables are returned through double pointers but I am having some trouble getting it to work though.<br><br>where it says "// do your stuff here" I added the following lines for testing purposes:<br><br>DWORD dwStringSize = g_stringsize;<br>stack_t *th;<br>if (!g_stacktop) return;<br>th = (stack_t*) GlobalAlloc(GPTR, sizeof(stack_t) + g_stringsize);<br><br>strcpy(th-&gt;text, "Hello There!");<br><br>th-&gt;next = *g_stacktop;<br>*g_stacktop = th;<br><br>(the UserInfo plugin code was very helpful)<br><br>When I try to compile the NSI script I get an error on the line where I try to access exdll::myFunction<br><br>ClearErrors<br>exdll::myFunction<br>IfErrors done<br><br>pop $0<br>MessageBox MB_OK "test function2 $0"<br>done:<br><br>From the sample code that I checked out in some of the other projects it looks like this should work. There must be something that I am not doing in order to link the NSIS setup executable to my dll.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">19th May 2003 13:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You don't really need all that code. exdll.h contains functions to interact with the stack. UserInfo just uses optimized code to its purpose. Use pushstring and popstring instead.<br><br>To make NSIS recognize your plug-in put it in &lt;nsis dir&gt;\plugins. Make sure your function appears on the list on the top of the compiler output along with all of the other plug-in functions.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">mattibbals</span><br><span class="post-time small text-muted">19th May 2003 19:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thank you for all of your help! I am very close now.<br><br>I can see my function processed in the compiler output although it looks different from the others. Here is how it looks:<br><br>exdll::?myFunction@@YAXPAUHWND__@@HPADPAPAU_stack_t@@@Z<br><br>The others don't have the '?' and the '@@YAXPAUHWND__@@HPADPAPAU_stack_t@@@Z' attached to them.<br><br>Right now it is in the middle of the compiler output. (it looks like it goes alphabetically) How can I make sure that mine is at the top? (should I just rename it aaExDll?)<br><br>Also, when I try to compile my NSI script I get a "Invalid command: exdll::myFunction" when I try to access the function in the NSI script.<br><br>Thanks in advance for any more help.<br><br>MWT<br><br>---addition a few minutes later---<br><br>I got it to work by pasting<br><br>exdll::?myFunction@@YAXPAUHWND__@@HPADPAPAU_stack_t@@@Z<br><br>into the NSI script as my function call. I suspect that the extended function name is because I changed the exdll.c file to a exdll.cpp file. Is that a bad idea?<br><br>The installer is throwing an error in it execution. It spawns a messagebox entitled "Error" and the text reads "$0=" it happens before the MessageBox that I spawn in the following code: (perhaps something to do with the pop command)<br><br>Section "" ;No components page, name is not important<br><br>ClearErrors<br>exdll::?myFunction@@YAXPAUHWND__@@HPADPAPAU_stack_t@@@Z<br>IfErrors done<br>pop $0<br>MessageBox MB_OK "test function2 $0"<br>done:<br>SectionEnd ; end the section<br><br>Am I illegally using the pop command here?<br><br>Thanks again!<br><br>MWT<br><br>-----------another addition--------------<br><br>I changed exdll.cpp back to exdll.c and I still get the same error. By placing messageboxes I can tell that the error is thrown with my function call. Here are the additions that I made to the exdll.c file in order to get it wo work:<br><br>// do your stuff here<br><br>pushstring( "Testing");</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">mattibbals</span><br><span class="post-time small text-muted">19th May 2003 20:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I got the error to go away by calling "return;" right after "pushstring("Testing")" in my dll code.<br><br>Sorry for the long-ass posts and thanks for all of your help!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">21st May 2003 13:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The first error (with the function name) was indeed caused because you have changed the the file extension to .cpp. If you want to use .cpp add 'extern "C"' before the function declaration to make it a C export and not C++ export (take a look at InstallOptions for an example).<br><br>The second error is not actually an error but the code itself in the plug-in:<br><br></p><pre>
<code>char buf[1024];<br>wsprintf(buf,"$0=%s\n",getuservariable(INST_0));<br>MessageBox(g_hwndParent,buf,0,MB_OK);</code>
</pre><br>
      <br>
      This code copies the string "$0=$0" where the second $0 is the actual value of $0, and then pops up a message box with that string. It's not a bug in your code.
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>