<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="How to create desktop and quicklaunch options in NSIS installer"><title>How to create desktop and quicklaunch options in NSIS installer - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">How to create desktop and quicklaunch options in NSIS installer</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=322123">How to create desktop and quicklaunch options in NSIS installer</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">rajWRT</span><br><span class="post-time small text-muted">1st September 2010 05:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>How to create desktop and quicklaunch options in NSIS installer</strong><br>Hi<br>I want to create a desktop and quicklaunch option in my NSIS installer screen (ideally finish page ) i.e if user checks these check-boxes then shortcuts will be created .pls help me how to implement this.<br><br>Also i am including XPUI.nsh i.e all installer screen layout are XPUI based i.e it has piece of code like<br>!insertmacro XPUI_PAGE_INSTFILES<br>!insertmacro XPUI_PAGE_FINISH<br><br><br>Thanks,<br>Raj</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">1st September 2010 06:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can either create a section called "Create Shortcuts", or use nsDialogs to create a custom page. See the nsDialogs readme for a tutorial.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rajWRT</span><br><span class="post-time small text-muted">2nd September 2010 05:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks MSG, i used the nsDiaglogue to create custom page . It is also displaying desktop shortcut creation option on the page but is not creating shortcuts on desktop.I am sending piece of code.<br><br><br><br>; Environment page<br>Page custom AdditionalTasks AdditionalTasksLeave<br><br>Function AdditionalTasks<br><br>Var /GLOBAL DESKTOP_ICON<br><br>Var /GLOBAL MUI_PAGE_CUSTOM<br><br>; Var /GLOBAL Checkbox_State<br>;Var /GLOBAL Checkbox<br>; Var /GLOBAL QUICKLAUCH_ICON<br><br>!include LogicLib.nsh<br>!include nsDialogs.nsh<br>!insertmacro MUI_HEADER_TEXT " Choose Additional Tasks" " Choose the additional tasks to be performed."<br><br>nsDialogs::Create /NOUNLOAD 1018<br>Pop $MUI_PAGE_CUSTOM<br><br>${If} $MUI_PAGE_CUSTOM == error<br>Abort<br>${EndIf}<br><br>${NSD_CreateCheckBox} 5 110 100% 20 "Create a desktop icon"<br>Pop $DESKTOP_ICON<br>${NSD_SetState} $DESKTOP_ICON ${BST_CHECKED}<br><br><br>nsDialogs::Show<br>FunctionEnd<br><br>Function AdditionalTasksLeave<br>;Var /GLOBAL CURRENTUSER<br>Var /GLOBAL DESKTOPUSER<br>;Var /GLOBAL PATH<br>${NSD_GetState} $DESKTOP_ICON $DESKTOPUSER<br><br>FunctionEnd<br><br><br>Section -Post<br>WriteUninstaller "$INSTDIR\uninst.exe"<br>Call DesktopIcon<br>SectionEnd<br><br>Function DesktopIcon<br>; Create desktop icon<br>${If} $DESKTOPUSER == 1<br><br>DetailPrint "Creating desktop icon, please wait..."<br><br>; SetOutPath "$INSTDIR\bin"<br>CreateShortCut "$DESKTOP\${NOKIA} ${NOKIAWDE_INST_DIR} ${VERSION}.lnk" "$INSTDIR\${NOKIAWDE_INST_DIR}\NokiaWDE.exe"<br>${EndIF}<br>FunctionEnd<br><br><br><br>Pls help me .. where i am doing mistake.<br>Thanks</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">2nd September 2010 06:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">1) You can't !include files like logiclib or nsdialogs inside a function. If that code compiles, it's beyond me how that would be possible.<br>2) You never declared $DESKTOPUSER<br>3) You may have to use SetOutPath to define the starting directory for the shortcut ('work folder').</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rajWRT</span><br><span class="post-time small text-muted">2nd September 2010 10:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">MSG,<br>I am still struggling as it is still not creating the desktop shortcuts.I am sending the complete code:<br><br>; Script generated by the HM NIS Edit Script Wizard.<br><br>; HM NIS Edit Wizard helper defines<br>!define PRODUCT_NAME "My application"<br>!define PRODUCT_VERSION "1.0"<br>!define PRODUCT_PUBLISHER "My company, Inc."<br>!define PRODUCT_WEB_SITE "http://www.google.com"<br>!define PRODUCT_UNINST_KEY "Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}"<br>!define PRODUCT_UNINST_ROOT_KEY "HKLM"<br><br>!include nsDialogs.nsh<br>!include LogicLib.nsh<br>Var Checkbox<br>Var Checkbox_State<br>Name nsDialogs<br>XPStyle on<br><br>; MUI 1.67 compatible ------<br>!include "MUI.nsh"<br><br>; MUI Settings<br>!define MUI_ABORTWARNING<br>!define MUI_ICON "${NSISDIR}\Contrib\Graphics\Icons\modern-install.ico"<br>!define MUI_UNICON "${NSISDIR}\Contrib\Graphics\Icons\modern-uninstall.ico"<br><br>; Welcome page<br>!insertmacro MUI_PAGE_WELCOME<br>; License page<br>!define MUI_LICENSEPAGE_CHECKBOX<br>!insertmacro MUI_PAGE_LICENSE "C:\Program Files\NSIS\license.txt"<br>; Instfiles page<br>!insertmacro MUI_PAGE_INSTFILES<br><br>Page custom AdditionalTasks AdditionalTasksLeave<br>; Finish page<br>!insertmacro MUI_PAGE_FINISH<br><br>; Uninstaller pages<br>!insertmacro MUI_UNPAGE_INSTFILES<br><br>; Language files<br>!insertmacro MUI_LANGUAGE "English"<br><br>; MUI end ------<br><br>Name "${PRODUCT_NAME} ${PRODUCT_VERSION}"<br>OutFile "Setup.exe"<br>InstallDir "$PROGRAMFILES\My application"<br>ShowInstDetails show<br>ShowUnInstDetails show<br><br>Section "MainSection" SEC01<br>SectionEnd<br><br><br><br>Function AdditionalTasks<br><br>;Var /GLOBAL DESKTOP_ICON<br><br>Var /GLOBAL MUI_PAGE_CUSTOM<br><br>; Var /GLOBAL Checkbox_State<br>;Var /GLOBAL Checkbox<br>; Var /GLOBAL QUICKLAUCH_ICON<br>!insertmacro MUI_HEADER_TEXT " Choose Additional Tasks" " Choose the additional tasks to be performed."<br><br>nsDialogs::Create /NOUNLOAD 1018<br>Pop $MUI_PAGE_CUSTOM<br><br>${If} $MUI_PAGE_CUSTOM == error<br>Abort<br>${EndIf}<br><br>${NSD_CreateCheckBox} 5 110 100% 20 "Create a desktop icon"<br>Pop $Checkbox<br><br>${If} $Checkbox_State == ${BST_CHECKED}<br>${NSD_Check} $Checkbox<br>${EndIf}<br><br><br><br>; Pop $DESKTOP_ICON<br>;${NSD_SetState} $DESKTOP_ICON ${BST_CHECKED}<br><br><br>nsDialogs::Show<br>FunctionEnd<br><br>Function AdditionalTasksLeave<br>;Var /GLOBAL CURRENTUSER<br>; Var /GLOBAL DESKTOPUSER<br>;Var /GLOBAL PATH<br>;${NSD_GetState} $DESKTOP_ICON $DESKTOPUSER<br>${NSD_GetState} $Checkbox $Checkbox_State<br><br>FunctionEnd<br><br><br><br><br>Section -AdditionalIcons<br>SetOutPath $INSTDIR<br>WriteIniStr "$INSTDIR\${PRODUCT_NAME}.url" "InternetShortcut" "URL" "${PRODUCT_WEB_SITE}"<br>CreateDirectory "$SMPROGRAMS\My application"<br>CreateShortCut "$SMPROGRAMS\My application\Website.lnk" "$INSTDIR\${PRODUCT_NAME}.url"<br>CreateShortCut "$SMPROGRAMS\My application\Uninstall.lnk" "$INSTDIR\uninst.exe"<br>SectionEnd<br><br>Section -Post<br>WriteUninstaller "$INSTDIR\uninst.exe"<br>WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "DisplayName" "$(^Name)"<br>WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "UninstallString" "$INSTDIR\uninst.exe"<br>WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "DisplayVersion" "${PRODUCT_VERSION}"<br>WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "URLInfoAbout" "${PRODUCT_WEB_SITE}"<br>WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "Publisher" "${PRODUCT_PUBLISHER}"<br>Call DesktopIcon<br>SectionEnd<br><br>Function DesktopIcon<br>; Create desktop icon<br>;SetOutPath $INSTDIR<br>DetailPrint "hello world"<br>${If} $Checkbox_State == 1<br>SetOutPath "$INSTDIR"<br>CreateShortCut "$DESKTOP\${PRODUCT_NAME} ${PRODUCT_VERSION}.lnk" ""<br>DetailPrint "hello world Checkbox_State"<br>${EndIf}<br><br>FunctionEnd<br><br>Function un.onUninstSuccess<br>HideWindow<br>MessageBox MB_ICONINFORMATION|MB_OK "$(^Name) was successfully removed from your computer."<br>FunctionEnd<br><br>Function un.onInit<br>MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 "Are you sure you want to completely remove $(^Name) and all of its components?" IDYES +2<br>Abort<br>FunctionEnd<br><br>Section Uninstall<br>Delete "$INSTDIR\${PRODUCT_NAME}.url"<br>Delete "$INSTDIR\uninst.exe"<br><br>Delete "$SMPROGRAMS\My application\Uninstall.lnk"<br>Delete "$SMPROGRAMS\My application\Website.lnk"<br><br>RMDir "$SMPROGRAMS\My application"<br><br>DeleteRegKey ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}"<br>SetAutoClose true<br>SectionEnd<br><br>Pls check were i am doing mistake.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">2nd September 2010 14:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">CreateShortCut "$DESKTOP\${PRODUCT_NAME} ${PRODUCT_VERSION}.lnk" ""<br><br>I don't know about you, but I would try to actually make the shortcut POINT to something... -__-</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rajWRT</span><br><span class="post-time small text-muted">3rd September 2010 05:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">MSG,<br><br>CreateShortCut "$DESKTOP\${PRODUCT_NAME} ${PRODUCT_VERSION}.lnk" ""<br><br>this is just a dummy desktop shortcut, which does not have any link to open the product, to verify that our approach is correct.<br><br>One quick query , can we achieve the state of check box ( check box option to create the desktop shortcut) from custom page to the XPUI / MUI finish page.<br><br>Because i am creating desktop shortcut only after finish page i.e Section -Post only decides whether to create a desktop icons.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">3rd September 2010 06:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by rajWRT</small><br>this is just a dummy desktop shortcut, which does not have any link to open the product, to verify that our approach is correct.</blockquote>So in order to test whether your code is working, you're using a codeline that may very well not be valid NSIS script? Like I said, I would try to create it WITH an actual link, "to verify that your approach is correct".<br><br><blockquote><small>Originally posted by rajWRT</small><br>One quick query , can we achieve the state of check box ( check box option to create the desktop shortcut) from custom page to the XPUI / MUI finish page.</blockquote>Please rephrase the question.<br><br><blockquote><small>Originally posted by rajWRT</small><br>Because i am creating desktop shortcut only after finish page i.e Section -Post only decides whether to create a desktop icons.</blockquote>All sections are executed in the INSTFILES page. NOT in the finish page.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rajWRT</span><br><span class="post-time small text-muted">3rd September 2010 07:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Only thing i want is the desktop shortcuts should be created after the finish page.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">3rd September 2010 09:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You could try replacing the run or readme checkbox text and letting it execute a function instead of its regular action. See the MUI2 readme.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jiake</span><br><span class="post-time small text-muted">6th September 2010 04:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I found there are some mistakes in your script:<br><br>1.This is numbers comparation, not strings, using "=" not "==":<br>${If} $Checkbox_State == ${BST_CHECKED}<br>${If} $Checkbox_State == 1<br>Should be:<br>${If} $Checkbox_State = ${BST_CHECKED}<br>${If} $Checkbox_State = 1<br><br>If you are using "${If} $Checkbox_State == 1", it will also work, but this is not the correct usage. $Checkbox_State and 1 are compared as strings. But If you are using ${If} $Checkbox_State == ${BST_CHECKED}, in case the BST_CHECKED constant is defined to 1, 0x1, 0x0001 or 0x00000001, only if it is defined to 1, this expresstion is true. Using "=" for number comparation, the above four values are all equal to 1.<br><br>2. Code in Section (such as the CreateShortcut command) are executed in INSTFILES page, so you must first insert your custom page and then insert the INSTFILES page:<br><br>Page custom AdditionalTasks AdditionalTasksLeave<br>!insertmacro MUI_PAGE_INSTFILES<br><br>Finally, I suggest that you include MUI2.nsh, for MUI2 uses the nsDialogs plugin for WELCOME and FINISH page. Your installer will be smaller because it doesn't include the "InstallOptions" plugin in. Also, MUI2.nsh already include LogicLib.nsh and nsDialogs.nsh, you can include this header only.<br><br>Also you may do as MSG said, using the checkbox on the finish page to create shortcut.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>