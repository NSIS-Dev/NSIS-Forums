<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Issues with Find* commands"><title>Issues with Find* commands - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Issues with Find* commands</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=119226">Issues with Find* commands</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Bud-froggy</span><br><span class="post-time small text-muted">27th December 2002 22:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Issues with Find* commands</strong><br>&nbsp; Ok, im lost.<br>Im using the modern UI and set up a custom page.<br>Now, this custom page is given a directory, and then searches for all folders in the directory. It then displays all the folders on the custom page.<br>Now, this function works fine with my computer, but one of my guinea pigs has reported that the FindFirst and FindNext functions, when given a valid directory containing subdirectories, returns '.', '..' and then reports that there is nothing else.<br><br>Now, I was messing around with the installer on my system, and if go thru the process until my custom page, and hit back, bringing me to the 'choose installation dir', then next right away (still giving it a good dir), then it skips the entire custom page and goes to the installation, even though it worked the first time around.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">27th December 2002 23:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Have you used FindClose?<br>Is the custom page callback function called?<br>Are you sure your guinea pig has files in that directory?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Bud-froggy</span><br><span class="post-time small text-muted">28th December 2002 14:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i><br><b>Have you used FindClose?</b><br>Yes...<br><br><b>Is the custom page callback function called?</b><br>As in:<br>Page custom SetCustomMod "$(TEXT_IO_PAGETITLE)"<br>?<br>yes<b><br><br>Are you sure your guinea pig has files in that directory?</b><br>Certain... I even ftp'ed in and double checked....</blockquote></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">28th December 2002 14:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Can you please attach the script?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Bud-froggy</span><br><span class="post-time small text-muted">28th December 2002 21:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i><br><b>Can you please attach the script?</b></blockquote>The custom function starts at line 318...<br>Thanks =)</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">28th December 2002 22:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I can't test it because I don't have ioMod.ini. Can you please attach that too?<br><br>A few things I have noticed from reading the script:</p><ul><li>You are using File* to write into INI files, that's not a good idea. <a href="http://nsis.sourceforge.net/Docs/Chapter3.html#3.7.2" target="_blank">WriteIniStr and friends</a> are much much safer as you don't need to strugle with line breaks, offsets and searching for fields.</li><li>You are using Push (number) Pop $var instead of just StrCpy $var (number)</li><li>You are using:<br><pre>
<code>FileWrite $R1 "***91;Field "
<br>&gt;FileWrite $R1 $R8 
<br>&gt;
</code>
</pre>Instead of the shorter:<br>
          <pre>
<code>
FileWrite $R1 "***91;Field $R8***93;" 
</code>
</pre>
        </li>

        <li>You have two warnings because you didn't use !insertmacro MUI_PAGECOMMAND_WELCOME but defined MUI_WELCOMEPAGE, and because you defined MUI_UNINSTALLER but didn't use WriteUninstaller.</li>
      </ul>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Bud-froggy</span><br>
      <span class="post-time small text-muted">29th December 2002 10:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I maintain that the code is still in dev which accounts for all the hideous commands =)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">29th December 2002 17:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am pretty sure the problem is with the coding, the errors and warning I have mentioned above. When I ran the installer the first time I got to the custom page it showed Text=Something a lot of times and when I pressed back and then forward again it just skipped it... The IO distortion is caused by mis-using File* and the skipping by mis-checking something there:<br>
      <br></p>
      <pre>
<code>
IntOp $R8 $R8 - 1 #already loaded for next field
<br>&gt;IntCmp $R8 1 NoMod 
<br>&gt;
</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Bud-froggy</span><br>
      <span class="post-time small text-muted">30th December 2002 19:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by kichik</i><br>
        <b>I am pretty sure the problem is with the coding, the errors and warning I have mentioned above.</b><br>
        I had removed those before uplaoding it for a second time with the ioMod.ini file...<b><br>
        <br>
        When I ran the installer the first time I got to the custom page it showed Text=Something a lot of times and when I pressed back and then forward again it just skipped it... The IO distortion is caused by mis-using File* and the skipping by mis-checking something there:<br>
        <br></b>
        <pre>
<b><code>
IntOp $R8 $R8 - 1 #already loaded for next field
<br>&gt;IntCmp $R8 1 NoMod 
<br>&gt;
</code>
</b>
</pre>
      </blockquote>I dont see how this could be an issue.<br>
      The varibale is initialized to 2, meaning that we should start writing to Field 2 in the ioMod.ini...<br>
      If the installer encouters a valid directory, it will increment the varibale. At the end, i subtract 1 from it, because i add one at the end of every filewrite toioMod.ini, and if it is equal to 1, its value was never changed, since it was initialized to 2. In this case, I create a new field on my custom page, and output some text telling the user that (s)he did not select a valid directory...<br>
      <br>
      Now, I rewrote everything so that it uses the cute little ini functions (a waste if you ask me, but if it makes you happy...), but the problem persists. I tested it on a friends system with some dummy files, and the process failed miserably. It did not detect any of the valid directories, AND it did not write the error report to the custom page either... In fact, it skipped the custom page entirely. I looked at the ioMod.ini file in the $PLUGINSDIR directory, and it was untouched...<br>
      <br>
      I am off on vacation right now, so I cant do a full test and what not, but I will as soon as i get back. In the meantime, please find attached the script as well as the ioMod.ini file...
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">31st December 2002 15:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It wasn't a waste at all, you just forgot to add one thing, "$PLUGINSDIR\" ;)<br>
      <br>
      Everywhere you have used WriteIniStr you forgot to add "$PLUGINSDIR\". After I have added this it works perfectly fine for me.<br>
      <br>
      You may also want to only write the INI once so the installer won't have search for the canidates more than once, and so the IO page will "remember" what option was last selected.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Bud-froggy</span><br>
      <span class="post-time small text-muted">31st December 2002 17:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I added that yesterday and started testing...<br>
      <br>
      Try this: run the installer the first time, then let it idle on the custom page. If you then launch a new instance, the installer will skip the custom page all together and go to the installation part....<br>
      <br>
      I will continue testing once i get home becuase i feel as though i cannot concentrate here...</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">31st December 2002 17:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This error can be fixed by adding ClearErrors before the FindFirst command in SetCustomMod, line ~340. This means that a error has occured above which you have not checked. It's always a good idea to clear the error flag before you call a command that might set the error flag which you would like to later check.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">eccles</span><br>
      <span class="post-time small text-muted">1st January 2003 01:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">In case you haven't found it already, the following line towards the start of Function SetCustomMod has a typo</p>
      <pre>
<code>File /oname=$PLUGINSDIRS\ioMod.ini ioMod.ini</code>
</pre>should be $PLUGINSDIR (without trailing S).
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Bud-froggy</span><br>
      <span class="post-time small text-muted">2nd January 2003 02:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">which suprisingly does not matter since I open the the correct file a little later, and perform the writes from there.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>