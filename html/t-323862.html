<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Uninstaller - delete Winamp-Plugin" />

  <title>Uninstaller - delete Winamp-Plugin - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Uninstaller - delete Winamp-Plugin</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=323862">Uninstaller - delete Winamp-Plugin</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">blackcoder</span><br />
      <span class="post-time small text-muted">7th November 2010 13:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Uninstaller - delete Winamp-Plugin</strong><br />
      Hello,<br />
      <br />
      i have written a program consisting of one application, which gets installed in a program-folder and a winamp-plugin which gets installed in the plugin-folder from winamp.<br />
      <br />
      Now i have got the problem, that my uninstaller deletes everything (application, uninstaller, shortcuts, application-folder, ...), but not the winamp-plugin. If i have two seperate installers it works. First i had two installers and started the next installer on the .onInstSuccess. I tried a similar way with the uninstalling part, but didn't got it working. Now i tried it the way it is in the attached nsi-file, but doesn't work also. :cry:<br />
      <br />
      I attached the nsi-file.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">7th November 2010 13:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Maybe it's because it's Sunday, but I'm not seeing anything fundamentally wrong with what the code should be doing.<br />
      <br />
      Have you verified that the path you're feeding to the delete command (the one you're putting up in a messagebox) is the correct path? ( I see the script using a define for the dll file on the installer side and hardcoded names in the uninstaller. )<br />
      <br />
      Have you verified that as far as NSIS is concerned, that file also exists in that location?<br /></p>
      <pre>
<span style="color: #007700">${If}${</span><span style="color: #0000BB">FileExists</span><span style="color: #007700">}</span><span style="color: #DD0000">"&lt;path&gt;"<br /></span><span style="color: #0000BB">MessageBoxMB_OK</span><span style="color: #DD0000">"Yup-`&lt;path&gt;`exists."
</span>
</pre>If all that seems to check out...<br />
      <br />
      Have you verified that the delay you're using is actually long enough? I.e. the file might still be locked by a process (winamp or otherwise) after all. You could use a MessageBox to arbitrarily set the delay by hand. If it turns out this might be the issue, see this thread on handling that sort of thing a bit better:<br />
      <a href="http://forums.winamp.com/showpost.php?p=2709038&amp;postcount=4" target="_blank">http://forums.winamp.com/showpost.ph...38&amp;postcount=4</a><br />
      <br />
      If it seems the file always remains locked, go download Unlocker or Process Explorer or so to find out what process might have your DLL file locked. This seems a bit unlikely as your separate uninstallers did work OK.. just not ruling it out :)<br />
      <br />
      Basically, just start picking apart the entire process line by line where things -might- go wrong.<br />
      <br />
      Unrelated: In your uninstall code you determine the WinAmp folder by checking the registry.. why not use that in your .onInit to set the default $ANOTHER_DIR as well? :)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">blackcoder</span><br />
      <span class="post-time small text-muted">7th November 2010 20:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you for your help. I got it working now. The problem was that ReadRegStr returned the path with quotes at the beginning and the end ("C:\Program Files (x86)\Winamp\UninstallWA.exe"). Further i noticed then that when using GetParent on that string it removes the filename as it should, but did not add the quote at the end ("C:\Program Files (x86)\Winamp). I added some function to remove the quotes to get this working.<br />
      <br />
      Found another problem then with ReadRegStr and $InstDir. If i use $InstDir then the colon is missing in the string ("C\Program Files (x86)\Winamp\UninstallWA.exe"). I had to use an own variable to get that string with colon.<br />
      <br />
      Now one problem lasts. Using my Installer on Vista works fine, but using it on Windows XP ends up in a missing entry in the Start menu. Is this related to "SetShellVarContext all"?<br />
      <br />
      I attached my nsi-file with the changes in it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">7th November 2010 21:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try creating the start menu folder before creating the shortcut.. at least on XP, the folder doesn't get automatically created.<br /></p>
      <pre>
<code>SetOutPath</code><span style="color: #DD0000">"$SMPROGRAMS\${APP_ALT}"</span><span style="color: #FF8000">/*createfolder*/<br /></span><span style="color: #0000BB">SetOutPath</span><span style="color: #DD0000">"$INSTDIR"</span><span style="color: #FF8000">/*setactivefolderforshortcut*/<br /></span><span style="color: #0000BB">CreateShortCut</span><span style="color: #DD0000">"$SMPROGRAMS\${APP_ALT}\${APP_ALT}-Uninstall.lnk""$INSTDIR\uninstall.exe"
</span>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">blackcoder</span><br />
      <span class="post-time small text-muted">7th November 2010 22:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you. That was the problem. :)<br />
      I was wondering why setoutpath. Didn't know that it would create a folder, too.<br /></p>

      <blockquote>
        SetOutPath<br />
        Sets the output path ($OUTDIR) and creates it (recursively if necessary), if it does not exist.
      </blockquote>I tried CreateDirectory instead of SetOutPath and this works fine.<br />
      <br />
      <pre>
<code>CreateDirectory</code><span style="color: #DD0000">"$SMPROGRAMS\${APP_ALT}"
<br /></span><span style="color: #0000BB">CreateShortCut</span><span style="color: #DD0000">"$SMPROGRAMS\${APP_ALT}\${APP_ALT}-Uninstall.lnk""$INSTDIR\uninstall.exe"
<br /></span><span style="color: #0000BB">CreateShortCut</span><span style="color: #DD0000">"$SMPROGRAMS\${APP_ALT}\${APP_ALT}.lnk""$INSTDIR\${APP_FILE}.exe"
</span>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">8th November 2010 01:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">CreateDirectory ought to work just as well, really - but it won't change the active folder for any shortcuts subsequently created.. so I usually end up using SetOutpath for just about everything.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
