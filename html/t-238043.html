<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Deleting &quot;Application Data&quot; from Multiple Users during Uninstall?"><title>Deleting "Application Data" from Multiple Users during Uninstall? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Deleting "Application Data" from Multiple Users during Uninstall?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=238043">Deleting "Application Data" from Multiple Users during Uninstall?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">MankyD</span><br><span class="post-time small text-muted">14th February 2006 18:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Deleting "Application Data" from Multiple Users during Uninstall?</strong><br>The program I am installing creates a folder in each individual user's "application data" directory when the user runs the app. I'm wondering if there is a way to find every "application data" folder that the app created and remove it when I run the NSIS uninstaller (running with admin priviledges, of course.)<br><br>As an addendum to that question, does anyone know if you could do a partial uninstall - only remove shortcuts and application data for each individual user rather than everyone. Then, when the last person to have the program uinstalls it, remove everything?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">14th February 2006 19:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Either create a list (INI file or registry) of all application data dirs created on install, and read the list (ReadINI/RegString) on uninstall.<br>Another option is to create a unique file in any application data dirs created by the installer (with FileOpen, FileWrite, FileClose) and delete those dirs that contain the unique file on uninstall (check if the file exists with IfFileExists).<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">14th February 2006 20:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can also get every folder with <a href="http://nsis.sourceforge.net/EnumUsersReg" target="_blank">EnumUsersReg</a> and HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders. Actually, EnumUsersReg even shows you how to get the profile directories list (SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MankyD</span><br><span class="post-time small text-muted">14th February 2006 21:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I've come up with a first attempt at a solution (haven't tried kichik's method, but I'll check it out, thanks!) Sorry if this problem/solution seems a bit ameteur, I just started NSIS yesterday:<br><br></p><pre>
<code><br>        FindFirst $0 $1 "c:\documents and settings\*"<br>        loop:<br>          StrCmp $1 "" done<br>          StrCmp $1 "." continue<br>          StrCmp $1 ".." continue<br><br>          RMDir /r /REBOOTOK "c:\documents and settings\$1\Application Data\my_program"<br><br>        continue:<br>          FindNext $0 $1<br>          Goto loop<br>        done:<br></code>
</pre><br>
      <br>
      I hope to have a per-user uninstall option setup next. Thanks again.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MankyD</span><br>
      <span class="post-time small text-muted">14th February 2006 22:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">kichik's method worked great except for one small catch:<br>
      <br>
      <br></p>
      <pre>
<code><br>Section "un.install"<br>...<br>        ${EnumUsersReg} un.EraseAppDataCB temp.key<br>...<br><br>SectionEnd<br><br>Function "un.EraseAppDataCB"<br>         Pop $0<br>         ReadRegStr $0 HKU "$0\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders" "AppData"<br>         RMDir /r /REBOOTOK "$0\my_program"<br>FunctionEnd<br></code>
</pre><br>
      <br>
      You have to edit <a href="http://nsis.sourceforge.net/EnumUsersReg" target="_blank">EnumUsersReg</a> in order to enable it to work during the uninstallation proceess (as opposed to during the install process.) Simply add "un." in front of "_EnumUsersReg" on lines 73 and 82. A better solution would probably be to create a second version of the macro specifically for uninstall purposes.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comperio</span><br>
      <span class="post-time small text-muted">15th February 2006 00:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">MankyD,<br>
      Your first solution of sweeping through the "C:\Documents and settings" folder won't always work. The PC may not have a "C" drive, or the person setting up the users may have chosen a differnt location for each user's home appdata directory.<br>
      <br>
      The EnumUsersReg suggestion is a more fool-proof solution.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>