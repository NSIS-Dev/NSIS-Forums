<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Cancelling during MUI_PAGE_INSTFILES" />

  <title>Cancelling during MUI_PAGE_INSTFILES - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Cancelling during MUI_PAGE_INSTFILES</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=294938">Cancelling during MUI_PAGE_INSTFILES</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hazmatt</span><br />
      <span class="post-time small text-muted">22nd July 2008 23:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Cancelling during MUI_PAGE_INSTFILES</strong><br />
      The cancel buttons on the installer is grayed out when it it is installing files. Is it possible enable that? is there an option I don't know about for that?<br />
      Its one of our test center requirements that a user be able to cancel during install.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br />
      <span class="post-time small text-muted">22nd July 2008 23:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can force the button to be enabled like this:<br />
      <br /></p>
      <pre>
<code>Section ""<br />  GetDlgItem $0 $HWNDPARENT 2<br />  EnableWindow $0 1<br />SectionEnd</code>
</pre><br />
      <br />
      But I doubt it will work properly...
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hazmatt</span><br />
      <span class="post-time small text-muted">23rd July 2008 00:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yeah, would be nice to get hitting that as a callback.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">23rd July 2008 01:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">wouldn't that end up calling .onUserAbort (haven't tested), or its MUI equivalent?<br />
      <br />
      If so, you could set a variable before InstFiles, then unset it after. Then in the user abort handler, check for that variable and if it is set, run special 'abort' code specific to aborting while installing files?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br />
      <span class="post-time small text-muted">23rd July 2008 01:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The problem is, that even if .onUserAbort is invoked, calling "Abort" in that function has a special meaning and would actually prevent the installer from aborting...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">23rd July 2008 01:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">sure.. but perhaps you can check for a variable set in userAbort ( still not sure if it's invoked ;) ) in your sections before each File command and, if it's set, abort the section.. and any subsequent sections.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">23rd July 2008 02:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Looks like that should, at least in theory, work. Example code:<br />
      <br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #0000BB">outFile</span><span style="color: #DD0000">"test2008Jul22.exe"<br />
      <br /></span> <span style="color: #007700">var</span><span style="color: #0000BB">installingFiles<br /></span> <span style="color: #007700">var</span><span style="color: #0000BB">abortAbortAbort<br />
      <br />
      Section<br />
      GetDlgItem</span><span style="color: #007700">$</span><span style="color: #0000BB">0$HWNDPARENT2<br />
      EnableWindow</span><span style="color: #007700">$</span><span style="color: #0000BB">01<br />
      <br />
      StrCpy$installingFiles1<br />
      <br />
      messageboxMB_OK</span><span style="color: #DD0000">"Alwaystrigger"<br />
      <br /></span> <span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">00<br />
      _again</span><span style="color: #007700">:<br /></span> <span style="color: #0000BB">IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">+</span><span style="color: #0000BB">1<br />
      IntCmp</span><span style="color: #007700">$</span><span style="color: #0000BB">010</span><span style="color: #007700">+</span><span style="color: #0000BB">3<br />
      sleep250<br />
      goto_again<br />
      <br />
      StrCmp$abortAbortAbort1_aborted<br />
      messageboxMB_OK</span><span style="color: #DD0000">"Onlytriggerifnotaborted"<br /></span> <span style="color: #0000BB">goto_skip<br />
      _aborted</span><span style="color: #007700">:<br /></span> <span style="color: #0000BB">messageboxMB_OK</span><span style="color: #DD0000">"Onlytriggerifaborted"<br /></span> <span style="color: #0000BB">_skip</span><span style="color: #007700">:<br /></span> <span style="color: #0000BB">StrCpy$installingFiles0<br />
      SectionEnd<br />
      <br /></span> <span style="color: #007700">Function.</span><span style="color: #0000BB">onUserAbort<br />
      MessageBoxMB_OK</span><span style="color: #DD0000">"onUserAbortcalled"<br /></span> <span style="color: #0000BB">StrCmp$installingFiles10_skip<br />
      MessageBoxMB_OK</span><span style="color: #DD0000">"onUserAbortcalledduringinstFiles"<br /></span> <span style="color: #0000BB">StrCpy$abortAbortAbort1<br />
      Abort<br />
      _skip</span><span style="color: #007700">:<br /></span> <span style="color: #0000BB">FunctionEnd<br /></span></span> <!-- php buffer end -->
      <hr />
      Edit: hmm not sure if it's a limit of messageboxes, but if you don't click through the .onUserAbort messageboxes quickly enough, the Section code will continue to run in the background, the timer will hit 10, and the script will continue to think it was not aborted. Easily fixed by moving the messageboxes around.. or not using them all, they're only there for debuggery/demonstration purposes.. but it does mean that the aborting may not be *instant* if the Section's File commands continue in the background as well. Extracting files should be a fair bit slower than setting that variable, though - but I've not tested. 3am here, not going to test it fully right now either :)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Tintera</span><br />
      <span class="post-time small text-muted">20th May 2009 13:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Tryed it</strong><br />
      Just tried to add such section on MUI2 based installer.<br />
      The cancel button is still dissabled.<br />
      Would be nice to enable the cancel button when installing, but it's not must have for my installer.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">6th April 2010 01:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Old thread - just ran into it again (my topic watch stopped working somewhere along the timeline of life) and, after reading a more recent question asking the same thing, decided to give it another stab.<br />
      <br />
      Results are in:<br />
      <a href="http://nsis.sourceforge.net/InstFiles_Cancel_-_Allowing_a_user_to_cancel_installation_during_InstFiles" target="_blank">http://nsis.sourceforge.net/InstFile...ring_InstFiles</a><br />
      ( InstFiles Cancel - Allowing a user to cancel installation during InstFiles )</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Tintera</span><br />
      <span class="post-time small text-muted">6th April 2010 11:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you for the article. Seems complex but will use it if I do some next NSIS based installer.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">6th April 2010 11:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">yep.. one wasn't meant to do this sort of thing with NSIS - the Cancel button was disabled on purpose, after all :)</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
