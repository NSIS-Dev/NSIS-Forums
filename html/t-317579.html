<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Get hard disk number from drive letter" />

  <title>Get hard disk number from drive letter - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" />
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
               <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
               <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
       <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Get hard disk number from drive letter</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=317579">Get hard disk number from drive letter</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dougcvc</span><br />
      <span class="post-time small text-muted">8th March 2010 13:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Get hard disk number from drive letter</strong><br />
      Hello, i am trying to work out the disk number (if you look in computer management &gt; disk management each disk has a number 0 ,1 ,etc assigned) from a drive letter. Is this possible in any way?<br />
      <br />
      This sample script gets the volume number (\Device\HarddiskVolume1) but its the disk number i need.<br />
      <br />
      Any suggestions would be great.<br />
      <br /></p>
      <pre>
<code><br />!define name test<br />!define version 1.0<br /><br />#Install Options<br />Name "${Name}"<br />OutFile "${Name}_${Version}.exe"<br />RequestExecutionLevel Admin<br />InstallDir "$TEMP\${Name}"<br />XPStyle on<br /><br /><br />Function QueryDosDevice   <br />  !define QueryDosDevice "Kernel32::QueryDosDevice(t,t,i) i"<br />  System::Call '${QueryDosDevice}("$0",.r1,${NSIS_MAX_STRLEN})'<br />FunctionEnd<br /><br />Section ""<br />StrCpy $0 "C:"<br />call QueryDosDevice<br />detailprint "disk= $1"<br />SectionEnd</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">f0rt</span><br />
      <span class="post-time small text-muted">12th March 2010 10:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">;</span><span style="color: #0000BB">Retrieveserialnumberfromharddisk<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">Read</span><span style="color: #007700">/</span><span style="color: #0000BB">writeaccesstoI</span><span style="color: #007700">/</span><span style="color: #0000BB">Ocontrolhandleofharddiskrequiresadminrights<br />
      RequestExecutionLeveladmin<br />
      <br />
      OutFile</span><span style="color: #DD0000">"HDDSerial.exe"<br /></span> <span style="color: #0000BB">Name</span><span style="color: #DD0000">"HDDSerial"<br />
      <br /></span> <span style="color: #007700">!include</span><span style="color: #DD0000">"LogicLib.nsh"<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">FileAccessModes<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineGENERIC_READ0x80000000<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineGENERIC_WRITE0x40000000<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">FileSharingModes<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineFILE_SHARE_READ0x00000001<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineFILE_SHARE_WRITE0x00000002<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">FileCreationFlags<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineOPEN_EXISTING3<br />
      <br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineINVALID_HANDLE_VALUE</span><span style="color: #007700">-</span><span style="color: #0000BB">1<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">ATAidentitycommand<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineIDE_ATA_IDENTIFY0xEC<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">ATARegistervalues<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineIDE_DEVICE_MASTER0xA0<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineIDE_DEVICE_SLAVE0xB0<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">I</span><span style="color: #007700">/</span><span style="color: #0000BB">Ocontrolcommand<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineDFP_RECEIVE_DRIVE_DATA0x0007c088<br />
      <br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineIDENTITY_BUFFER_SIZE512<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">SizeofSENDCMDINPARAMS</span><span style="color: #007700">and</span><span style="color: #0000BB">SENDCMDOUTPARAMSstructure<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineSIZEOF_CMD_IN0x20<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineSIZEOF_CMD_OUT0x10<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">HDDSerialnumberoffset</span><span style="color: #007700">and</span><span style="color: #0000BB">lengthinATAIDENTIFYstructure<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineHDD_SERIAL_OFFSET0x14<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineHDD_SERIAL_LENGTH20<br />
      <br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">Getharddiskserialnumberfromdrivenumber<br /></span> <span style="color: #007700">;(</span><span style="color: #0000BB">startingwith0</span><span style="color: #007700">)</span><span style="color: #0000BB">provided</span><span style="color: #007700">as</span><span style="color: #0000BB">aparameterto<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">this</span><span style="color: #007700">function.<br />
      ;</span><span style="color: #0000BB">Theharddiskserialnumberisreturnedin</span><span style="color: #007700">$</span><span style="color: #0000BB">0.<br /></span> <span style="color: #007700">Function</span><span style="color: #0000BB">HDDSerial<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">Saveregisters<br />
      Exch</span><span style="color: #007700">$</span><span style="color: #0000BB">1<br />
      Push</span><span style="color: #007700">$</span><span style="color: #0000BB">2<br />
      Push</span><span style="color: #007700">$</span><span style="color: #0000BB">3<br />
      Push</span><span style="color: #007700">$</span><span style="color: #0000BB">4<br />
      Push</span><span style="color: #007700">$</span><span style="color: #0000BB">5<br />
      Push</span><span style="color: #007700">$</span><span style="color: #0000BB">6<br />
      Push</span><span style="color: #007700">$</span><span style="color: #0000BB">7<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">Gethandleofphysicaldrive<br />
      StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">3</span><span style="color: #DD0000">"\\\\.\\PhysicalDrive$1"<br /></span> <span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::CreateFile(tr3,\\<br />
      i${GENERIC_READ}|${GENERIC_WRITE},\\<br />
      i${FILE_SHARE_READ}|${FILE_SHARE_WRITE},\\<br />
      i0,i${OPEN_EXISTING},i0,i0)i.r2"<br /></span> <span style="color: #007700">${If}$</span><span style="color: #0000BB">2</span><span style="color: #007700">!=${</span><span style="color: #0000BB">INVALID_HANDLE_VALUE</span><span style="color: #007700">}<br />
      ;</span><span style="color: #0000BB">SetthebCommandReg</span><span style="color: #007700">and</span><span style="color: #0000BB">bDriveHeadRegIDERegisters<br />
      IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">5</span><span style="color: #007700">${</span><span style="color: #0000BB">IDE_ATA_IDENTIFY</span><span style="color: #007700">}+</span><span style="color: #0000BB">0<br />
      IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">5</span><span style="color: #007700">$</span><span style="color: #0000BB">5</span><span style="color: #007700">&lt;&lt;</span><span style="color: #0000BB">8<br />
      IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">7</span><span style="color: #007700">$</span><span style="color: #0000BB">1</span><span style="color: #007700">&amp;</span><span style="color: #0000BB">1<br /></span> <span style="color: #007700">${If}$</span><span style="color: #0000BB">7</span><span style="color: #007700">==</span><span style="color: #0000BB">0<br />
      IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">5</span><span style="color: #007700">$</span><span style="color: #0000BB">5</span><span style="color: #007700">|${</span><span style="color: #0000BB">IDE_DEVICE_MASTER</span><span style="color: #007700">}<br />
      ${Else}<br /></span> <span style="color: #0000BB">IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">5</span><span style="color: #007700">$</span><span style="color: #0000BB">5</span><span style="color: #007700">|${</span><span style="color: #0000BB">IDE_DEVICE_SLAVE</span><span style="color: #007700">}<br />
      ${EndIf}<br /></span> <span style="color: #0000BB">IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">5</span><span style="color: #007700">$</span><span style="color: #0000BB">5</span><span style="color: #007700">&lt;&lt;</span><span style="color: #0000BB">8<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">Allocate</span><span style="color: #007700">and</span><span style="color: #0000BB">fillSENDCMDINPARAMSstructure<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">cBufferSize</span><span style="color: #007700">,</span><span style="color: #0000BB">bSectorCountReg</span><span style="color: #007700">=</span><span style="color: #0000BB">1</span><span style="color: #007700">,</span><span style="color: #0000BB">bCommandReg</span><span style="color: #007700">/</span><span style="color: #0000BB">bDriveHeadReg</span><span style="color: #007700">,</span><span style="color: #0000BB">bDriveNumber<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"*(i${IDENTITY_BUFFER_SIZE},i0x100,ir5,ir1,\\<br />
      i0,i0,i0,i0)i.r4"<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">Allocateoutputbuffer<br />
      IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">5</span><span style="color: #007700">${</span><span style="color: #0000BB">SIZEOF_CMD_OUT</span><span style="color: #007700">}+${</span><span style="color: #0000BB">IDENTITY_BUFFER_SIZE</span><span style="color: #007700">}<br /></span> <span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Alloc</span><span style="color: #007700">$</span><span style="color: #0000BB">5<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">6<br />
      IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">70</span><span style="color: #007700">+</span><span style="color: #0000BB">0<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">SendIDENTITYcommand<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::DeviceIoControl(ir2,\\<br />
      i${DFP_RECEIVE_DRIVE_DATA},\\<br />
      ir4,i${SIZEOF_CMD_IN},\\<br />
      ir6,ir5,\\<br />
      *ir7r7,i0)i.r3"<br /></span> <span style="color: #007700">${If}$</span><span style="color: #0000BB">3</span><span style="color: #007700">!=</span><span style="color: #0000BB">0<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">ExtractHDDserialnumber<br />
      IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">5</span><span style="color: #007700">${</span><span style="color: #0000BB">SIZEOF_CMD_OUT</span><span style="color: #007700">}+${</span><span style="color: #0000BB">HDD_SERIAL_OFFSET</span><span style="color: #007700">}<br /></span> <span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"*$6(&amp;m$5,&amp;m${HDD_SERIAL_LENGTH}.r0)"<br /></span> <span style="color: #007700">${Else}<br /></span> <span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"Error:DeviceIoControlfailed"<br /></span> <span style="color: #007700">${EndIf}<br /></span> <span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Free</span><span style="color: #007700">$</span><span style="color: #0000BB">6<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Free</span><span style="color: #007700">$</span><span style="color: #0000BB">4<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::CloseHandle(ir2)i.r3"<br /></span> <span style="color: #007700">${Else}<br /></span> <span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"Error:CreateFilefailedfor\\\\.\\PhysicalDrive$1"<br /></span> <span style="color: #007700">${EndIf}<br />
      <br />
      ;</span><span style="color: #0000BB">Restoreregisters<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">7<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">6<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">5<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">4<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">3<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">2<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">1<br />
      FunctionEnd<br />
      <br /></span> <span style="color: #007700">Function.</span><span style="color: #0000BB">onInit<br />
      InitPluginsDir<br />
      Push0<br />
      CallHDDSerial<br />
      MessageBoxMB_OK</span><span style="color: #DD0000">"HDDSerialNumber=$0"<br /></span> <span style="color: #0000BB">Quit<br />
      FunctionEnd<br />
      <br />
      Section<br />
      SectionEnd<br /></span></span> <!-- php buffer end -->
      <hr />
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">f0rt</span><br />
      <span class="post-time small text-muted">12th March 2010 12:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The previous posted code served as a basis for this one.<br />
      <br />
      GetVolumeNameForVolumeMountPoint returns the volume name<br />
      and the IOCTL_VOLUME_GET_VOLUME_DISK_EXTENTS command is used to get the hard disk number associated with the drive letter.<br />
      <br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">;</span><span style="color: #0000BB">Getharddisknumberfromdriveletter<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">Read</span><span style="color: #007700">/</span><span style="color: #0000BB">writeaccesstoI</span><span style="color: #007700">/</span><span style="color: #0000BB">Ocontrolhandleofharddiskrequiresadminrights<br />
      RequestExecutionLeveladmin<br />
      <br />
      OutFile</span><span style="color: #DD0000">"HDDNumber.exe"<br /></span> <span style="color: #0000BB">Name</span><span style="color: #DD0000">"HDDNumber"<br />
      <br /></span> <span style="color: #007700">!include</span><span style="color: #DD0000">"LogicLib.nsh"<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">FileAccessModes<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineGENERIC_READ0x80000000<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineGENERIC_WRITE0x40000000<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">FileSharingModes<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineFILE_SHARE_READ0x00000001<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineFILE_SHARE_WRITE0x00000002<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">FileCreationFlags<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineOPEN_EXISTING3<br />
      <br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineINVALID_HANDLE_VALUE</span><span style="color: #007700">-</span><span style="color: #0000BB">1<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">MaximumlengthofvolumeGUID</span><span style="color: #007700">(</span><span style="color: #0000BB">includingterminatingzero</span><span style="color: #007700">)<br />
      !</span><span style="color: #0000BB">defineMAXLEN_VOLUME_GUID51<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">I</span><span style="color: #007700">/</span><span style="color: #0000BB">Ocontrolcommand<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineIOCTL_VOLUME_GET_VOLUME_DISK_EXTENTS0x00560000<br />
      <br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineEXTENTS_BUFFER_SIZE512<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">Getharddisknumberfromdriveletter<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">provided</span><span style="color: #007700">as</span><span style="color: #0000BB">aparametertothis</span><span style="color: #007700">function.<br />
      ;</span><span style="color: #0000BB">Theharddisknumberisreturnedin</span><span style="color: #007700">$</span><span style="color: #0000BB">0.<br /></span> <span style="color: #007700">Function</span><span style="color: #0000BB">HDDNumber<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">Saveregisters<br />
      Exch</span><span style="color: #007700">$</span><span style="color: #0000BB">1<br />
      Push</span><span style="color: #007700">$</span><span style="color: #0000BB">2<br />
      Push</span><span style="color: #007700">$</span><span style="color: #0000BB">3<br />
      Push</span><span style="color: #007700">$</span><span style="color: #0000BB">4<br />
      Push</span><span style="color: #007700">$</span><span style="color: #0000BB">5<br />
      Push</span><span style="color: #007700">$</span><span style="color: #0000BB">6<br />
      Push</span><span style="color: #007700">$</span><span style="color: #0000BB">7<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">Getvolumenameassociatedwithdriveletter<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::GetVolumeNameForVolumeMountPoint(tr1,tr3r3,i${MAXLEN_VOLUME_GUID})i.r2"<br /></span> <span style="color: #007700">${If}$</span><span style="color: #0000BB">2</span><span style="color: #007700">!=</span><span style="color: #0000BB">0<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">Gethandleofvolume<br />
      StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">3</span><span style="color: #007700">$</span><span style="color: #0000BB">3</span><span style="color: #007700">-</span><span style="color: #0000BB">1<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::CreateFile(tr3,\\<br />
      i${GENERIC_READ}|${GENERIC_WRITE},\\<br />
      i${FILE_SHARE_READ}|${FILE_SHARE_WRITE},\\<br />
      i0,i${OPEN_EXISTING},i0,i0)i.r2"<br /></span> <span style="color: #007700">${If}$</span><span style="color: #0000BB">2</span><span style="color: #007700">!=${</span><span style="color: #0000BB">INVALID_HANDLE_VALUE</span><span style="color: #007700">}<br />
      ;</span><span style="color: #0000BB">Allocateoutputbuffer<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Alloc</span><span style="color: #007700">${</span><span style="color: #0000BB">EXTENTS_BUFFER_SIZE</span><span style="color: #007700">}<br /></span> <span style="color: #0000BB">Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">4<br />
      IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">50</span><span style="color: #007700">+</span><span style="color: #0000BB">0<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">SendIOCTL_VOLUME_GET_VOLUME_DISK_EXTENTScommand<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::DeviceIoControl(ir2,\\<br />
      i${IOCTL_VOLUME_GET_VOLUME_DISK_EXTENTS},\\<br />
      i0,i0,\\<br />
      ir4,i${EXTENTS_BUFFER_SIZE},\\<br />
      *ir5r5,i0)i.r3"<br /></span> <span style="color: #007700">${If}$</span><span style="color: #0000BB">3</span><span style="color: #007700">!=</span><span style="color: #0000BB">0<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">ExtractHDDnumber<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"*$4(i.r5,i,i.r0)"<br /></span> <span style="color: #007700">${If}$</span><span style="color: #0000BB">5</span><span style="color: #007700">==</span><span style="color: #0000BB">0<br />
      StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"Error:InvalidDISK_EXTENTdata"<br /></span> <span style="color: #007700">${EndIf}<br />
      ${Else}<br /></span> <span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"Error:DeviceIoControlfailed"<br /></span> <span style="color: #007700">${EndIf}<br /></span> <span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Free</span><span style="color: #007700">$</span><span style="color: #0000BB">4<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::CloseHandle(ir2)i.r3"<br /></span> <span style="color: #007700">${Else}<br /></span> <span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"Error:CreateFilefailedfor$3"<br /></span> <span style="color: #007700">${EndIf}<br />
      ${Else}<br /></span> <span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"Error:GetVolumeNameForVolumeMountPointfailedfor$1"<br /></span> <span style="color: #007700">${EndIf}<br />
      <br />
      ;</span><span style="color: #0000BB">Restoreregisters<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">7<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">6<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">5<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">4<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">3<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">2<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">1<br />
      FunctionEnd<br />
      <br /></span> <span style="color: #007700">Function.</span><span style="color: #0000BB">onInit<br />
      InitPluginsDir<br />
      StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">1</span><span style="color: #DD0000">"C:\\"<br /></span> <span style="color: #0000BB">Push</span><span style="color: #007700">$</span><span style="color: #0000BB">1<br />
      CallHDDNumber<br />
      MessageBoxMB_OK</span><span style="color: #DD0000">"HDDNumberfor$1=$0"<br /></span> <span style="color: #0000BB">Quit<br />
      FunctionEnd<br />
      <br />
      Section<br />
      SectionEnd<br /></span></span> <!-- php buffer end -->
      <hr />
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dougcvc</span><br />
      <span class="post-time small text-muted">12th March 2010 13:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">thank u works just as i wanted it to.<br />
      <br />
      would have never figured all that out :eek:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">BobBergman</span><br />
      <span class="post-time small text-muted">4th November 2010 19:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Batch file for showing Disk Number, Partition Number, Drive Letter, Drive Label</strong><br />
      @ECHO OFF<br />
      SETLOCAL<br />
      SETLOCAL ENABLEDELAYEDEXPANSION<br />
      <br />
      REM This Batch file Finds, Displays and Saves the Following for each Drive on the Cmputer.<br />
      REM<br />
      REM Disk Number Partition Number Drive Letter Drive Label<br />
      REM<br />
      REM It was tested usng the "XP Home Edition" and will not work on versions prior to 2000<br />
      REM<br />
      <br />
      REM ------------- Alphabet, Diskpart Script File Commands and File Names ----------------<br />
      <br />
      REM L1, L3 ,L3 are commands for use in Diskpart.exe<br />
      REM S1 is the Location of the DiskPart.exe script file<br />
      REM S3 is the location of the resultant "Drive Disk Partition" Table<br />
      <br />
      Set Alphabet=C D E F G H I J K L M N O P Q R S T U V W X Y Z<br />
      Set L1=Select Volume<br />
      set L2=List Volume<br />
      Set L3=List Disk<br />
      Set L4=List Partition<br />
      Set S1=DiskPartScript.txt<br />
      Set S2=DiskPart.txt<br />
      Set S3=DriveInfo.txt<br />
      <br />
      Rem ---------------------------- Delete Existing Files -----------------------------------<br />
      <br />
      If Exist %S1% Del %S1%<br />
      If Exist %S2% Del %S2%<br />
      If Exist %S3% Del %S3%<br />
      If Exist Vol.txt Del Vol.txt<br />
      <br />
      REM ---------------------Build the "DiskPart.exe" Script File ----------------------------<br />
      <br />
      For %%1 in (%Alphabet%) DO if Exist %%1:\Nul (Echo %L1% %%1&gt;&gt;%S1%)^<br />
      &amp;(Echo %L2%&gt;&gt;%S1%)&amp;(ECHO %L3%&gt;&gt;%S1%)^<br />
      &amp;(ECHO %L4%&gt;&gt;%S1%)<br />
      <br />
      Rem ----------------- Execute DiskPart Using the Above Script File------------------------<br />
      <br />
      Diskpart /s %S1%&gt;&gt;%S2%<br />
      <br />
      REM ------------------ Set the Drive Labels in "LBL*" Using "VOL"-------------------------<br />
      <br />
      For %%1 in (%Alphabet%) DO if Exist %%1:\Nul Vol %%1:&gt;&gt;Vol.txt<br />
      For /f "Tokens=1-5* delims= " %%1 in (Vol.txt) DO If "%%2"=="in" Set LBL%%4=%%4 %%6<br />
      <br />
      REM ------- Extract the Disk Number, Partition Number, Drive Letter &amp; Volume Label -------<br />
      <br />
      For /f "Tokens=1-5" %%1 in (%S2%) DO (If "%%1 %%2"=="* Volume" Set LBL=!LBL%%4!)^<br />
      &amp;(If "%%1 %%2"=="* Disk" Set Line=%%3)^<br />
      &amp;(If "%%1 %%2"=="* Partition" (Set Line=!Line! %%3)^<br />
      &amp;(Set Line=!Line! !LBL!)&amp;(ECHO !Line!&gt;&gt;%S3%))<br />
      <br />
      REM -------------------------- Display the Results ---------------------------------------<br />
      <br />
      ECHO.<br />
      ECHO.<br />
      Type %S3%<br />
      ECHO.<br />
      ECHO.<br />
      <br />
      Rem --------------------------------- EXIT -----------------------------------------------<br />
      <br />
      ECHO When Ready to Exit<br />
      Pause</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
