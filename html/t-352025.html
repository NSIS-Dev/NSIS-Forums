<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="How to include REPAIR,REMOVE featture in NSIS?"><title>How to include REPAIR,REMOVE featture in NSIS? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">How to include REPAIR,REMOVE featture in NSIS?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=352025">How to include REPAIR,REMOVE featture in NSIS?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">ilaiyaraja</span><br><span class="post-time small text-muted">15th November 2012 05:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>How to include REPAIR,REMOVE featture in NSIS?</strong><br>I have written nsis script for my application.The installation steps are working fine.If i install second time in same directory it should ask REPAIR or REMOVE option? How do i include this feature in my script?<br><br><br>Can anyone help me?<br><br>Thanks.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">15th November 2012 06:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You'll have to code this yourself. You'll have to write autodetection code, show a custom (nsDialogs) page if necessary, and execute different installation code inside your sections depending on the option chosen by the user.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ilaiyaraja</span><br><span class="post-time small text-muted">15th November 2012 06:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks MSG.<br>ok..using nsDialogs customize the installation page.but when i install same application second time,then only include repair or remove option.How can i find out the application already installed or not?<br><br><br>WriteRegDWORD HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)" NoModify 1<br>WriteRegDWORD HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)" NoRepair 1<br>I saw this code in my script by default when i created installer.Is this lines are related to repair or remove feature?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">15th November 2012 07:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">In your custom page function, add some code that does some auto-detection of your application:<br>${If} ${FileExists} "$INSTDIR\Somefile1.ext"<br>${AndIf} ${FileExists} "$INSTDIR\Somefile2.ext"<br>;Show a custom page<br>${EndIf}<br><br>Also: In the custom page's leave function, set a $variable to remember what option the user chose, and in your sections, simply do<br>${If} $variable == "repair"<br>;do repair stuff<br>${Else}<br>;do reinstall stuff<br>${EndIf}</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">T.Slappy</span><br><span class="post-time small text-muted">15th November 2012 08:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The easiest solution is to create nsDialogs page with 2 radiobuttons: Repair and Remove.<br><br>Repair will simply launch installer as is - so all files, values, settings etc will be overwritten to their default values.<br><br>Remove will launch uninstaller (and immediately quit installer)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ilaiyaraja</span><br><span class="post-time small text-muted">15th November 2012 13:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks Slappy. I have tried.<br>Function nsDialogsPage<br><br>nsDialogs::Create 1018<br>Pop $Dialog<br><br>${If} $Dialog == error<br>Abort<br>${EndIf}<br><br>${NSD_CreateRadioButton} 0 0 100% 12u "Repair"<br>Pop $hwnd<br>${NSD_OnClick $hwnd ???<br>${NSD_CreateRadioButton} 0 13u 100% -13u "Remove"<br>Pop $hwnd<br>${NSD_OnClick $hwnd ???<br>nsDialogs::Show<br>FunctionEnd<br><br>How to call un installer function? I think un installer function starts from this funtion un.init. If i put un.init it should returns error message? How to call un installer function?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">16th November 2012 05:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by ilaiyaraja</small><br>How to call un installer function?</blockquote>You cannot call an uninstaller function, but you can execute the uninstaller:<br>ExecWait "$INSTDIR\Uninstall.exe"</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ilaiyaraja</span><br><span class="post-time small text-muted">16th November 2012 06:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks MSG.<br>It's working fine using this command.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ilaiyaraja</span><br><span class="post-time small text-muted">30th November 2012 10:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>You cannot call an uninstaller function, but you can execute the uninstaller:<br>ExecWait "$INSTDIR\Uninstall.exe"</blockquote>Function Remove<br>ExecWait "$INSTDIR\Uninstall.exe"<br>FunctionEnd.<br>It will call the un insall function and open the un intall window.once the user click the un install button then only the files are removed.<br>Is there any way if the user click remove radio button immediately un install functionality happen without opening one more window or dont want to ask again user input?</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">1st December 2012 00:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well you could just copy all the uninstall code (delete files, registry, etc) from the uninstall section to a RemovePrevious section in your installer. Or create a silent uninstaller I guess, but that's probably overkill.<br><br>(Keep in mind that it's bad form to be making changes to a user's system before the user clicks Install. Any page before INSTFILES should not be writing/deleting stuff. Therefore it's best to put the delete code in a section, because sections are executed only on the instfiles page. Maybe it could be the first section of your installer, and maybe an always-enabled one.)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ilaiyaraja</span><br><span class="post-time small text-muted">1st December 2012 03:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>Well you could just copy all the uninstall code (delete files, registry, etc) from the uninstall section to a RemovePrevious section in your installer. Or create a silent uninstaller I guess, but that's probably overkill.<br><br>(Keep in mind that it's bad form to be making changes to a user's system before the user clicks Install. Any page before INSTFILES should not be writing/deleting stuff. Therefore it's best to put the delete code in a section, because sections are executed only on the instfiles page. Maybe it could be the first section of your installer, and maybe an always-enabled one.)</blockquote>ok..thanks. MSG "it's bad form to be making changes to a user's system before the user clicks Install".<br>Based on this i have changed the scenario.<br><br>If the user checked the remove radio button,then un install the software like the status bar and followed by finish page and finally end.Is it possible?<br>Function Remove<br>ExecWait "$INSTDIR\Uninstall.exe"<br>Quit<br>FunctionEnd.<br>This is my remove function code.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">1st December 2012 08:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well you could make an uninstaller with only an uninstfiles page, sure. But then you're still making changes to the system before your own installer's instfiles page. My point is it's better to call that uninstaller from your first section, not from a page's leave function or something like that.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>