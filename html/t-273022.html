<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Problems with SQL Server Express in installation" />

  <title>Problems with SQL Server Express in installation - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Problems with SQL Server Express in installation</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=273022">Problems with SQL Server Express in installation</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">trust11</span><br />
      <span class="post-time small text-muted">18th June 2007 14:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Problems with SQL Server Express in installation</strong><br />
      Hi all:<br />
      Im new in all this and i dont know how can i do this.<br />
      im trying to install SQL Server and restore a database with problems.<br />
      First of all i install the version 2.0 of Compact Framework:<br />
      <br />
      SetOverwrite on<br />
      SetOutPath "$INSTDIR"<br />
      File "dotnetfx.exe"<br />
      ExecWait '$INSTDIR\dotnetfx.exe /Q /C:"install.exe /noaspupgrade /q"'<br />
      <br />
      Then i install the SQL Server Express:<br />
      <br />
      File "SQLEXPR_ESN.EXE"<br />
      ExecWait '$INSTDIR\SQLEXPR.EXE /qb ADDLOCAL=ALL INSTANCENAME=MSSQLSERVER SECURITYMODE=SQL SAPWD=onix SQLAUTOSTART=1 DISABLENETWORKPROTOCOLS=0'<br />
      <br />
      And after this i try to restore the database:<br />
      <br />
      nsExec::Exec osql -E -Q "RESTORE FILELISTONLY FROM DISK = '$INSTDIR\BD.bak'"<br />
      nsExec::Exec osql -E -Q "restore database BD from disk='$INSTDIR\BD.bak' WITH NORECOVERY, MOVE 'BD' TO 'C:\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\Data\BD.MDF', MOVE 'BD_Log' TO 'C:\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\Data\BD_Log.LDF'"<br />
      <br />
      I think that im installing the first two things OK but it doesnt restore the database.<br />
      Can you help me please????</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br />
      <span class="post-time small text-muted">18th June 2007 14:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try to reading <a href="http://www.winamp-es.com/foros/viewtopic.php?t=3959" target="_blank">here</a> first and if doesn't help I'm sure here are people that know more :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">trust11</span><br />
      <span class="post-time small text-muted">18th June 2007 14:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry about it :(<br />
      There few people help and i thought that here maybe someone could help me.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sgiusto</span><br />
      <span class="post-time small text-muted">18th June 2007 15:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Are you sure that sql express installs OSQL? the new command line interface is sqlcmd.<br />
      You can also try to use the MSSQL plugin. You find it at the plugins page on official nsis site.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">trust11</span><br />
      <span class="post-time small text-muted">18th June 2007 16:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi sgiusto:<br />
      Im trying the MSSQL plugin but i cant get it working. This is the code im using.<br />
      Do you know what im doing bad?<br />
      <br />
      MSSQL_OLEDB::SQL_Logon /NOUNLOAD ""(local)\MSSQLSERVER" "sa" "onix"<br />
      MSSQL_OLEDB::SQL_Execute /NOUNLOAD "RESTORE FILELISTONLY FROM DISK = '$INSTDIR\BD.bak'"<br />
      MSSQL_OLEDB::SQL_Execute /NOUNLOAD "restore database BD from disk='$INSTDIR\BD.bak' WITH NORECOVERY, MOVE 'BD' TO 'C:\Archivos de programa\Microsoft SQL Server\MSSQL.1\MSSQL\Data\BD.mdf', MOVE 'BD_Log' TO 'C:\Archivos de programa\Microsoft SQL Server\MSSQL.1\MSSQL\Data\BD_Log.ldf'"<br />
      MSSQL_OLEDB::SQL_Logout</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br />
      <span class="post-time small text-muted">18th June 2007 17:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">MSSQL_OLEDB::SQL_Logon /NOUNLOAD ""(local)\MSSQLSERVER" "sa" "onix"<br />
      <br />
      You have an additional quote at the begining</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">chivalri</span><br />
      <span class="post-time small text-muted">18th June 2007 20:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I had this same problem. Part of the problem is that the path environment is not set for the system to find osql (or sqlcmd for that matter) until after your installer closes.<br />
      <br />
      I spent well over a full day trying to figure this out. Eventually, I found that if I called the osql using the full path, the command ran as expected. I think that sqlcmd is faster than osql but both work.<br />
      <br />
      Try something like this<br />
      &lt;code&gt;<br />
      ExecWait '$TEMP\SQLEXPR.EXE /qb sapwd=password disablenetworkprotocols=0 securitymode=SQL INSTANCENAME=MSSQLSERVER ADDLOCAL=SQL_Engine'<br />
      ExecWait '"$PROGRAMFILES\Microsoft SQL Server\90\Tools\Binn\osql" -U sa -P password -i "$PATHTO\mysqlfile.sql"'<br />
      &lt;/code&gt;</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">trust11</span><br />
      <span class="post-time small text-muted">19th June 2007 08:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi chivalri:<br />
      Ive tried the code you said and when it says :<br />
      "Didnt found the stored procedure TAPE"<br />
      And dont do anything.<br />
      <br />
      Can you help me please?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">trust11</span><br />
      <span class="post-time small text-muted">19th June 2007 08:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This is the code ive used:<br />
      <br />
      ExecWait '"$PROGRAMFILES\Microsoft SQL Server\90\Tools\Binn\osql" -U sa -P onix -i "$INSTDIR\BD.sql"'</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">19th June 2007 10:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Where is the .exe?<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">trust11</span><br />
      <span class="post-time small text-muted">19th June 2007 10:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Which .exe Afrow UK ?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">19th June 2007 10:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You are trying to execute "osql" without the .exe.<br />
      Yes this would work in command prompt, but not here.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Swapan Das</span><br />
      <span class="post-time small text-muted">21st December 2007 10:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Dear trust11 &amp; Everybody,<br />
      <br />
      I'm stuck with the same issue. After installing Sql Express from NSIS, I want to run sqlcmd from nsis script so that I can make the login password for user 'sa' blank. But I'm unable to execute that and the reasons are unknown to me but must be in the same lines as discussed in this thread.<br />
      <br />
      Can anyone please let me know the exact command to be given in NSIS Script to run sqlcmd ( from $PROGRAMFILES\Microsoft SQL Server\90\Tools\Binn\SQLCMD.EXE) to alter the password for the user sa. The sql query file (AlterLoginPswd.sql):<br />
      ALTER LOGIN sa WITH PASSWORD= '',CHECK_EXPIRATION=OFF,CHECK_POLICY=OFF<br />
      <br />
      Regards,<br />
      <br />
      <br />
      [ps.:Its a little bit urgent, bear with me please]</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">meaningoflights</span><br />
      <span class="post-time small text-muted">5th January 2008 05:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        [ps.:Its a little bit urgent, bear with me please] [/B]
        <hr />
      </blockquote>
    </div>
    <hr />
    Here, here!! Its sad because there isn't a solid example out there..<br />
    <br />
    <font size="1">Hi All,<br />
    <br />
    I too am in an really bad position, marketing jumped the gun and now mgt are going to kick my arse if I cant write an installer before advertisements come out.. ! arrhhhh!<br />
    <br />
    To test the installation, I am using a program called MojoPac.com on a external HDD, instead of VMware so I'm not sure if thats the root cause.<br />
    <br />
    <br />
    Problem<br />
    ============<br />
    Run the following script, it doesn't install WindowsInstaller3.1, or .Net2.0 or SQLExpress.<br />
    <br />
    Here is the log it produces:<br />
    Windows Version Analysis<br />
    Windows Version Determined<br />
    Windows Permission Analysis<br />
    Windows Permission Determined<br />
    Windows Installer Analysis<br />
    Windows Installer complete<br />
    .Net Analysis<br />
    SQL Server Analysis<br />
    Checking for existing SQL Server Instance<br />
    SQL Server Analysis Completed<br />
    <br />
    <br />
    Cause<br />
    ===========<br />
    Maybe because MojoPac uses the host OS??? I cant install on my local PC cos I have SQL Ent edition, Win 3.1 and .Net 2 already installed.<br />
    <br />
    Resolution<br />
    ===========<br />
    I'm in process of getting VM ware setup on a scsi disk.<br />
    <br />
    Please help me guys, thanks in advance, its heaps urgent! :) :) :)</font><br />
    <br />
    <br />
    <font size="3">Here are the references I found to make this script</font><br />
    <br />
    <a href="http://nsis.sourceforge.net/NSISLog_plug-in" target="_blank">http://nsis.sourceforge.net/NSISLog_plug-in</a><br />
    <br />
    <a href="http://www.johnsadventures.com/archives/2005/11/my_installer_fixation_and_nsis.html" target="_blank">http://www.johnsadventures.com/archi..._and_nsis.html</a><br />
    <br />
    <a href="http://nsis.sourceforge.net/Installing_the_Microsoft_.NET_Framework" target="_blank">http://nsis.sourceforge.net/Installi....NET_Framework</a><br />
    <br />
    <a href="http://msdn2.microsoft.com/en-us/library/ms144259.aspx" target="_blank">http://msdn2.microsoft.com/en-us/library/ms144259.aspx</a><br />
    <br />
    <a href="http://blogs.msdn.com/sanchan/archive/2006/05/28/609097.aspx" target="_blank">http://blogs.msdn.com/sanchan/archiv...28/609097.aspx</a><br />
    <br />
    <a href="http://forums.winamp.com/showthread.php?threadid=275340&amp;highlight=run+sql+script" target="_blank">http://forums.winamp.com/showthread....run+sql+script</a><br />
    <br />
    <font size="3">HEre's the script</font><br />
    <br />
    <br />
    !include WinVer.nsh<br />
    !include x64.nsh<br />
    <br />
    XPStyle on<br />
    <br />
    ;funky little splash fade in effect!<br />
    Function .onInit<br />
    # the plugins dir is automatically deleted when the installer exits<br />
    InitPluginsDir<br />
    File /oname=$PLUGINSDIR\splash.bmp "c:\myprog\logo.bmp"<br />
    <br />
    #optional<br />
    #File /oname=$PLUGINSDIR\splash.wav "C:\myprog\sound.wav"<br />
    <br />
    ;MessageBox MB_OK "Fading"<br />
    <br />
    advsplash::show 4000 600 400 -1 $PLUGINSDIR\splash<br />
    <br />
    Pop $0 ; $0 has '1' if the user closed the splash screen early,<br />
    ; '0' if everything closed normal, and '-1' if some error occured.<br />
    Delete $PLUGINSDIR\csplash.bmp<br />
    FunctionEnd<br />
    <br />
    <br />
    <br />
    ; HM NIS Edit Wizard helper defines<br />
    !define PRODUCT_NAME "REPLACE_WITH_APP_NAME"<br />
    !define PRODUCT_VERSION "3.0"<br />
    !define PRODUCT_PUBLISHER "REPLACE_WITH_APP_NAME"<br />
    !define PRODUCT_WEB_SITE "http://www.REPLACE_WITH_YOUR_WEBSITE.com"<br />
    !define PRODUCT_DIR_REGKEY "Software\Microsoft\Windows\CurrentVersion\App Paths\REPLACE_WITH_APP_NAME CE.exe"<br />
    !define PRODUCT_UNINST_KEY "Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}"<br />
    !define PRODUCT_UNINST_ROOT_KEY "HKLM"<br />
    <br />
    ; MUI 1.67 compatible ------<br />
    !include "MUI.nsh"<br />
    <br />
    ; MUI Settings<br />
    !define MUI_ABORTWARNING<br />
    !define MUI_ICON "${NSISDIR}\Contrib\Graphics\Icons\modern-install.ico"<br />
    !define MUI_UNICON "${NSISDIR}\Contrib\Graphics\Icons\modern-uninstall.ico"<br />
    <br />
    !define BRANDINGTEXT "REPLACE_WITH_APP_NAME Pty Ltd"<br />
    <br />
    ; Welcome page<br />
    !insertmacro MUI_PAGE_WELCOME<br />
    ; License page<br />
    !define MUI_LICENSEPAGE_RADIOBUTTONS<br />
    !insertmacro MUI_PAGE_LICENSE "..\License.rtf"<br />
    ; Directory page<br />
    !insertmacro MUI_PAGE_DIRECTORY<br />
    ; Instfiles page<br />
    !insertmacro MUI_PAGE_INSTFILES<br />
    ; Finish page<br />
    !define MUI_FINISHPAGE_RUN "$INSTDIR\REPLACE_WITH_APP_NAME.exe"<br />
    !insertmacro MUI_PAGE_FINISH<br />
    <br />
    ; Uninstaller pages<br />
    !insertmacro MUI_UNPAGE_INSTFILES<br />
    <br />
    ; Language files<br />
    !insertmacro MUI_LANGUAGE "English"<br />
    <br />
    <br />
    ; MUI end ------<br />
    <br />
    <br />
    <br />
    <br />
    <br />
    ;==================================<br />
    <br />
    !macro CHECK_MIN_WIN_VER<br />
    var /GLOBAL WIN_VER_PASSED ;Win98?<br />
    var /GLOBAL WIN_SERVICEPACK_PASSED ;Win2kSP3<br />
    var /GLOBAL SQL_SERVICEPACK_PASSED ;Win2kSP4,Win2k3SP1,WinXPSP2<br />
    StrCpy $WIN_VER_PASSED â€œ1?<br />
    StrCpy $WIN_SERVICEPACK_PASSED â€œ1?<br />
    StrCpy $SQL_SERVICEPACK_PASSED â€œ1?<br />
    <br />
    ReadRegDWORD $R0 HKLM "System\CurrentControlSet\Control\Windows" "CSDVersion"<br />
    IntOp $R0 $R0 / 256 ;get service pack major version<br />
    <br />
    nsislog::log "$INSTDIR\install.log" "Windows Version Analysis"<br />
    <br />
    ${If} ${IsWin2000}<br />
    ${If} $R0 &lt; â€œ3? ; SP3<br />
    StrCpy $WIN_SERVICEPACK_PASSED â€œ0?<br />
    ${ElseIf} $R0 &lt; â€œ4? ; SP4<br />
    StrCpy $SQL_SERVICEPACK_PASSED â€œ0?<br />
    ${EndIf}<br />
    ${ElseIf} ${IsWin2003}<br />
    ${If} $R0 &lt; â€œ1? ; SP1<br />
    StrCpy $SQL_SERVICEPACK_PASSED â€œ0?<br />
    ${EndIf}<br />
    ${ElseIf} ${IsWinXP}<br />
    ${If} $R0 &lt; â€œ2? ; SP2<br />
    StrCpy $SQL_SERVICEPACK_PASSED â€œ0?<br />
    ${EndIf}<br />
    ${ElseIf} ${AtMostWin2000}<br />
    StrCpy $WIN_VER_PASSED â€œ0?<br />
    ${EndIf}<br />
    <br />
    nsislog::log "$INSTDIR\install.log" "Windows Version Determined"<br />
    <br />
    !macroend<br />
    <br />
    <br />
    ;==================================<br />
    <br />
    <br />
    <br />
    <br />
    !macro CHECK_ADMIN_RIGHTS<br />
    <br />
    nsislog::log "$INSTDIR\install.log" "Windows Permission Analysis"<br />
    <br />
    var /GLOBAL USER_ADMIN_PASSED ;Administrator<br />
    StrCpy $USER_ADMIN_PASSED â€œ1?<br />
    userInfo::getAccountType<br />
    pop $0<br />
    ${If} $0 != â€œAdminâ€<br />
    StrCpy $USER_ADMIN_PASSED â€œ0?<br />
    ${EndIf}<br />
    <br />
    nsislog::log "$INSTDIR\install.log" "Windows Permission Determined"<br />
    !macroend<br />
    <br />
    !macro MSI_INSTALL installer_path<br />
    <br />
    nsislog::log "$INSTDIR\install.log" "Windows Installer Analysis"<br />
    ;install msi version 3<br />
    GetDllVersion â€œ$SYSDIR\msi.dllâ€ $1 $2<br />
    IntOp $3 $1 / 0Ã—00010000<br />
    IntOp $4 $1 &amp; 0Ã—0000FFFF<br />
    ;IntOp $5 $2 / 0Ã—00010000<br />
    ;IntOp $6 $2 &amp; 0Ã—0000FFFF<br />
    StrCpy $0 â€˜$3.$4'<br />
    IntCmp $0 â€œ3.1? MSI_NO_INSTALL MSI_INSTALL<br />
    MSI_INSTALL: ;may be 3.0 or 3.1<br />
    SetDetailsPrint both<br />
    DetailPrint "Updating Windows Installer"<br />
    SetDetailsPrint none<br />
    <br />
    ExecWait "${installer_path}\WindowsInstaller-KB893803-v2-x86.exe /quiet /norestart"<br />
    <br />
    Sleep 2000 ; wait for a 2 seconds<br />
    ;!insertmacro EXEC_SUBINSTALLER â€œWindows Installer 3.1? \<br />
    ;â€˜â€${installer_path}\WindowsInstaller-KB893803-v2-x86.exeâ€ /quiet /norestartâ€™<br />
    MSI_NO_INSTALL:<br />
    <br />
    nsislog::log "$INSTDIR\install.log" "Windows Installer complete"<br />
    <br />
    !macroend<br />
    <br />
    <br />
    ;==================================<br />
    <br />
    <br />
    <br />
    <br />
    !macro NET_INSTALL installer_path<br />
    <br />
    nsislog::log "$INSTDIR\install.log" ".Net Analysis"<br />
    <br />
    ;Check for framework 2.0â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“<br />
    StrCpy $1 â€œ0?<br />
    ReadRegDword $1 HKLM "SOFTWARE\Microsoft\NET Framework Setup\NDP\v2.0.50727" "Install"<br />
    ;MessageBox MB_OK $1<br />
    ${If} $1 == â€œâ€<br />
    ${If} ${RunningX64}<br />
    <br />
    <br />
    StrCpy $9 '"${installer_path}\netfx64.exe" /q /c:"install.exe /qb /noaspupgrade"'<br />
    ${Else}<br />
    StrCpy $9 '"${installer_path}\dotnetfx2.0.exe" /q /c:"install.exe /qb /noaspupgrade"'<br />
    ${EndIf}<br />
    <br />
    SetDetailsPrint both<br />
    DetailPrint "Installing .Net Framework"<br />
    nsislog::log "$INSTDIR\install.log" "Installing .Net 2.0"<br />
    <br />
    SetDetailsPrint none<br />
    ;!insertmacro EXEC_SUBINSTALLER â€œMicrosoft .Net Framework 2.0? $9<br />
    ExecWait $9<br />
    <br />
    nsislog::log "$INSTDIR\install.log" "Installation of .Net 2.0 complete"<br />
    <br />
    ${EndIf}<br />
    <br />
    <br />
    !macroend<br />
    <br />
    <br />
    <br />
    <br />
    ;==================================<br />
    <br />
    <br />
    <br />
    <br />
    <br />
    !macro IS_SQL_INSTALLED instance_name<br />
    ;original version returned a 1..<br />
    ;!macro IS_SQL_INSTALLED instance_name ;return<br />
    nsislog::log "$INSTDIR\install.log" "SQL Server Analysis"<br />
    <br />
    ;original version returned a 1 or 0..<br />
    ;strcpy ${return} â€œ0?<br />
    <br />
    StrCpy $0 â€œ0?<br />
    <br />
    ReadRegStr $0 HKLM "SOFTWARE\Microsoft\Microsoft SQL Server\${instance_name}\MSSQLServer\CurrentVersion\" "CurrentVersion"<br />
    ${If} $0 != â€œâ€ ;should = 9.if 2005 8. if 2000<br />
    <br />
    !insertmacro SQL_INSTALL $INSTDIR "REPLACE_WITH_APP_NAME" "passw0rd" "$PROGRAMFILES\Microsoft SQL Server"<br />
    <br />
    nsExec::ExecToLog '"$INSTDIR\CreateDatabase.cmd" "REPLACE_WITH_APP_NAME" "REPLACE_WITH_APP_NAME" "$INSTDIR\CreateDatabase.sql"'<br />
    <br />
    ;strcpy ${return} â€œ1?<br />
    ${EndIf}<br />
    !macroend<br />
    <br />
    <br />
    ;==================================<br />
    <br />
    <br />
    <br />
    <br />
    !macro SQL_INSTALL installer_path instance_name password install_dir<br />
    <br />
    nsislog::log "$INSTDIR\install.log" "Checking for existing SQL Server Instance"<br />
    <br />
    ;Check for existing instance<br />
    AddSize 358400<br />
    ReadRegStr $0 HKLM "SOFTWARE\Microsoft\Microsoft SQL Server\${instance_name}\MSSQLServer\CurrentVersion\" "CurrentVersion"<br />
    ${If} $0 == â€œâ€ ;should = 9.if 2005 8. if 2000<br />
    ;!insertmacro EXEC_SUBINSTALLER â€œMicrosoft SQL Server 2005 Express Editionâ€ \<br />
    ;â€˜â€${installer_path}\SQLEXPR.exeâ€ /settings ${settings_file} -q /norebootchk /qb reboot=ReallySuppress addlocal=all INSTANCENAME=${instance_name} SAPWD=${password} INSTALLSQLDIR=â€${install_dir} SCCCHECKLEVEL=IncompatibleComponents:1;MDAC25Version:0â€â€˜<br />
    <br />
    nsislog::log "$INSTDIR\install.log" "Installing SQL Server"<br />
    <br />
    ${If} ${IsWin2000}<br />
    ExecWait "${installer_path}\SQLEXPR.exe -q /norebootchk /qn reboot=ReallySuppress addlocal=all INSTANCENAME=${instance_name} SAPWD=${password} INSTALLSQLDIR=${install_dir} SQLBROWSERACCOUNT=NT AUTHORITY\SYSTEM SQLACCOUNT=NT AUTHORITY\SYSTEM AGTACCOUNT=NT AUTHORITY\SYSTEM ASACCOUNT=NT AUTHORITY\SYSTEM RSACCOUNT=NT AUTHORITY\SYSTEM SQLBROWSERAUTOSTART=1 SQLAUTOSTART=1 AGTAUTOSTART=1 ASAUTOSTART=0 RSAUTOSTART=0 SECURITYMODE=SQL DISABLENETWORKPROTOCOLS=0 ERRORREPORTING=1 SQMREPORTING=0 ENABLERANU=0 ADDUSERASADMIN=0"<br />
    ${Else}<br />
    ExecWait "${installer_path}\SQLEXPR.exe -q /norebootchk /qn reboot=ReallySuppress addlocal=all INSTANCENAME=${instance_name} SAPWD=${password} INSTALLSQLDIR=${install_dir} SQLBROWSERACCOUNT=NT AUTHORITY\NETWORK SERVICE SQLACCOUNT=NT AUTHORITY\NETWORK SERVICE AGTACCOUNT=NT AUTHORITY\NETWORK SERVICE ASACCOUNT=NT AUTHORITY\NETWORK SERVICE RSACCOUNT=NT AUTHORITY\NETWORK SERVICE SQLBROWSERAUTOSTART=1 SQLAUTOSTART=1 AGTAUTOSTART=1 ASAUTOSTART=0 RSAUTOSTART=0 SECURITYMODE=SQL DISABLENETWORKPROTOCOLS=0 ERRORREPORTING=1 SQMREPORTING=0 ENABLERANU=0 ADDUSERASADMIN=0"<br />
    <br />
    ;troubleshooting change qn to qb<br />
    ;ExecWait "${installer_path}\SQLEXPR.exe -q /norebootchk /qb reboot=ReallySuppress addlocal=all INSTANCENAME=${instance_name} SAPWD=${password} INSTALLSQLDIR=${install_dir} SQLBROWSERACCOUNT=NT AUTHORITY\NETWORK SERVICE SQLACCOUNT=NT AUTHORITY\NETWORK SERVICE AGTACCOUNT=NT AUTHORITY\NETWORK SERVICE ASACCOUNT=NT AUTHORITY\NETWORK SERVICE RSACCOUNT=NT AUTHORITY\NETWORK SERVICE SQLBROWSERAUTOSTART=1 SQLAUTOSTART=1 AGTAUTOSTART=1 ASAUTOSTART=0 RSAUTOSTART=0 SECURITYMODE=SQL DISABLENETWORKPROTOCOLS=0 ERRORREPORTING=1 SQMREPORTING=0 ENABLERANU=0 ADDUSERASADMIN=0"<br />
    <br />
    ${EndIf}<br />
    <br />
    ;ExecWait 'net start mssql$$$REPLACE_WITH_APP_NAME'<br />
    Sleep 10000 ; wait for a 10 seconds<br />
    ${EndIf}<br />
    <br />
    <br />
    nsislog::log "$INSTDIR\install.log" "SQL Server Analysis Completed"<br />
    <br />
    !macroend<br />
    <br />
    <br />
    <br />
    ;==================================<br />
    <br />
    <br />
    Name "${PRODUCT_NAME} ${PRODUCT_VERSION}"<br />
    OutFile "Setup.exe"<br />
    InstallDir "$PROGRAMFILES\REPLACE_WITH_APP_NAME"<br />
    InstallDirRegKey HKLM "${PRODUCT_DIR_REGKEY}" ""<br />
    ShowInstDetails show<br />
    ShowUnInstDetails show<br />
    <br />
    Section "MainSection" SEC01<br />
    SetOutPath "$INSTDIR"<br />
    SetOverwrite ifnewer<br />
    File "..\REPLACE_WITH_APP_NAME CE.exe"<br />
    CreateDirectory "$SMPROGRAMS\REPLACE_WITH_APP_NAME"<br />
    CreateShortCut "$SMPROGRAMS\REPLACE_WITH_APP_NAME\REPLACE_WITH_APP_NAME.lnk" "$INSTDIR\REPLACE_WITH_APP_NAME.exe"<br />
    CreateShortCut "$DESKTOP\REPLACE_WITH_APP_NAME.lnk" "$INSTDIR\REPLACE_WITH_APP_NAME.exe"<br />
    File "..\CSHttpClient.dll"<br />
    File "..\m4usms.dll"<br />
    File "..\TimeSync.exe"<br />
    <br />
    <br />
    <br />
    ;add the windows installer, .net 2.0, sql express exe's to the InstallDirectory<br />
    <br />
    ;The 64 or 32 bit switch<br />
    File "..\Components\dotnetfx2.0.exe"<br />
    ;File "..\Components\netfx64.exe"<br />
    File "..\Components\WindowsInstaller-KB893803-v2-x86.exe"<br />
    File "..\Components\SQLEXPR.exe"<br />
    File "..\Components\CreateDatabase.cmd"<br />
    File "..\Components\CreateDatabase.sql"<br />
    <br />
    <br />
    !insertmacro CHECK_MIN_WIN_VER<br />
    <br />
    !insertmacro CHECK_ADMIN_RIGHTS<br />
    <br />
    !insertmacro MSI_INSTALL $INSTDIR<br />
    <br />
    !insertmacro NET_INSTALL $INSTDIR<br />
    <br />
    !insertmacro IS_SQL_INSTALLED "REPLACE_WITH_APP_NAME"<br />
    <br />
    Delete "$INSTDIR\dotnetfx2.0.exe"<br />
    ;File "..\Components\netfx64.exe"<br />
    Delete "$INSTDIR\WindowsInstaller-KB893803-v2-x86.exe"<br />
    Delete "$INSTDIR\SQLEXPR.exe"<br />
    Delete "$INSTDIR\CreateDatabase.cmd"<br />
    Delete "$INSTDIR\CreateDatabase.sql"<br />
    <br />
    SectionEnd<br />
    <br />
    <br />
    Section -AdditionalIcons<br />
    WriteIniStr "$INSTDIR\${PRODUCT_NAME}.url" "InternetShortcut" "URL" "${PRODUCT_WEB_SITE}"<br />
    CreateShortCut "$SMPROGRAMS\REPLACE_WITH_APP_NAME\Website.lnk" "$INSTDIR\${PRODUCT_NAME}.url"<br />
    CreateShortCut "$SMPROGRAMS\REPLACE_WITH_APP_NAME\Uninstall.lnk" "$INSTDIR\uninst.exe"<br />
    SectionEnd<br />
    <br />
    Section -Post<br />
    WriteUninstaller "$INSTDIR\uninst.exe"<br />
    WriteRegStr HKLM "${PRODUCT_DIR_REGKEY}" "" "$INSTDIR\REPLACE_WITH_APP_NAME CE.exe"<br />
    WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "DisplayName" "$(^Name)"<br />
    WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "UninstallString" "$INSTDIR\uninst.exe"<br />
    WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "DisplayIcon" "$INSTDIR\REPLACE_WITH_APP_NAME CE.exe"<br />
    WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "DisplayVersion" "${PRODUCT_VERSION}"<br />
    WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "URLInfoAbout" "${PRODUCT_WEB_SITE}"<br />
    WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "Publisher" "${PRODUCT_PUBLISHER}"<br />
    SectionEnd<br />
    <br />
    <br />
    Function un.onUninstSuccess<br />
    HideWindow<br />
    MessageBox MB_ICONINFORMATION|MB_OK "$(^Name) was successfully removed from your computer."<br />
    FunctionEnd<br />
    <br />
    Function un.onInit<br />
    MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 "Are you sure you want to completely remove $(^Name) and all of its components?" IDYES +2<br />
    Abort<br />
    FunctionEnd<br />
    <br />
    Section Uninstall<br />
    Delete "$INSTDIR\${PRODUCT_NAME}.url"<br />
    Delete "$INSTDIR\uninst.exe"<br />
    Delete "$INSTDIR\TimeSync.exe"<br />
    <br />
    Delete "$INSTDIR\REPLACE_WITH_APP_NAME.exe"<br />
    <br />
    RMDir "$INSTDIR\Styles"<br />
    <br />
    RMDir "$SMPROGRAMS\REPLACE_WITH_APP_NAME"<br />
    RMDir "$INSTDIR"<br />
    <br />
    DeleteRegKey ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}"<br />
    DeleteRegKey HKLM "${PRODUCT_DIR_REGKEY}"<br />
    SetAutoClose true<br />
    SectionEnd<br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Swapan Das</span><br />
      <span class="post-time small text-muted">5th January 2008 08:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Dear meaningoflights, thanks a lot for your source code.<br />
      I've somehow overcome the issue of installation of sql express 2005. But there are lot of things to learn from your code. Please just confirm that the code you've pasted here is running without a single error. Right now I'm into a different project will definitely have a go with your coding in near future.<br />
      <br />
      Thanks once again...<br />
      Regards,<br />
      Swapan</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">meaningoflights</span><br />
      <span class="post-time small text-muted">5th January 2008 20:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Unattended WinInstaller, SQL, .Net NSIS installtion script</strong><br />
      G'day Swapan,<br />
      <br />
      I can confirm it runs without a single error, I had to do the following fixes:<br />
      <br />
      <br />
      This line:<br />
      IntCmp $0 â€œ3.1? MSI_NO_INSTALL MSI_INSTALL MSI_NO_INSTALL<br />
      <br />
      This line:<br />
      ;StrCpy $1 â€œ0?<br />
      ;ReadRegDword $1 HKLM "SOFTWARE\Microsoft\NET Framework Setup\NDP\v2.0.50727? "Install"<br />
      ;${If} $1 != â€œ1?<br />
      <br />
      ;${registry::Read} "HKEY_LOCAL_MACHINE\Software\Microsoft\NET Framework Setup\NDP\v2.0.50727" "SP" $R0 $R1<br />
      ;${If} $R1 == ""<br />
      <br />
      ReadRegStr $R1 HKLM "SOFTWARE\Microsoft\NET Framework Setup\NDP\v2.0.50727" "Install"<br />
      ${If} $R1 == ""<br />
      <br />
      <br />
      <br />
      <br />
      This line (in two places):<br />
      ;ReadRegStr $0 HKLM "SOFTWARE\Microsoft\Microsoft SQL Server\${instance_name}\MSSQLServer\CurrentVersion\" "CurrentVersion"<br />
      ;${If} $0 != â€œ9â€ ;should = 9.if 2005 8. if 2000<br />
      <br />
      ;${registry::Read} "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\${instance_name}\MSSQLServer\CurrentVersion" "CurrentVersion" $R0 $R1<br />
      ;${If} $R1 == ""<br />
      <br />
      ReadRegStr $R1 HKLM "SOFTWARE\Microsoft\Microsoft SQL Server\${instance_name}\MSSQLServer\CurrentVersion" "CurrentVersion"<br />
      ${If} $R1 == ""<br />
      <br />
      <br />
      <br />
      To use the cmd and sql files refer to this post:<br />
      http://forums.winamp.com/showthread.php?threadid=275340&amp;highlight=run+sql+script<br />
      <br />
      Tip: Make sure the SQL Instance name is shorter than 16 chars.<br />
      <br />
      For the complete script, the original one I found posted by Scott Moore here:<br />
      http://www.JeremyThompson.Net/Rocks/Unattended WinInstaller, SQL, .Net NSIS installtion script.txt<br />
      <br />
      http://www.JeremyThompson.Net</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Swapan Das</span><br />
      <span class="post-time small text-muted">7th January 2008 08:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Re: Unattended WinInstaller, SQL, .Net NSIS installtion script</strong><br />
      Quote:</p>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">meaningoflights</span><br />
        <span class="post-time small text-muted">8th January 2008 03:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">G'day mate,<br />
        <br />
        Your instance name is shorter than 16 chars (dont add the PC name too), as per the requirements set out in BOL:<br />
        <br />
        <font size="1"><br />
        <b>Named instance</b><br />
        Choose this option to create a new named instance. Bear in mind the following when naming an instance of SQL Server:<br />
        <br />
        Instance names are not case sensitive.<br />
        <br />
        Instance names cannot contain the terms "Default," "MSSQLServer," or other reserved keywords. If a reserved keyword is used in an instance name, a Setup error will occur.<br />
        <br />
        **Instance names are limited to 16 characters.<br /></font><br />
        <br />
        JEzza<br />
        I'm still testing, finally setup VM ware with Win2000,XP and Vista, hurraaaay</p>
      </div>
      <hr />

      <div class="footer">
        <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
      </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
      hljs.initHighlightingOnLoad();
      //]]>
      </script>

      <table cellpadding="6" cellspacing="0" border="0" width="100%">
        <tr>
          <td class="alt2">
            <hr />
            <i>Originally posted by meaningoflights</i><br />
            <b><br />
            Tip: Make sure the SQL Instance name is shorter than 16 chars.<br /></b> Thanks for the detailed &amp; prompt reply. Right now I'm creating my own instance name in this format:<br />
            <br />
            [computer name]\[my instance name]<br />
            <br />
            e.g: SERVER\SWAPANLABSSE<br />
            <br />
            (where SERVER=computer name; SWAPANLABSSE=the instance name I want to create in user's system]<br />
            <br />
            "SWAPANLABSSE" is already 12 chars.+ computer name will definitely cross 16 chars., but this is working and use install SSE and with this instance name. Please clarify on this issue of instance name's max.length.<br />
            <br />
            Regards,<br />
            Swapan
          </td>
        </tr>
      </table>
    </div>
  </div>
</body>
</html>
