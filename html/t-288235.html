<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Improve NSIS unpacking"><title>Improve NSIS unpacking - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Improve NSIS unpacking</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=288235">Improve NSIS unpacking</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">********</span><br><span class="post-time small text-muted">10th March 2008 13:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Improve NSIS unpacking</strong><br>Is it possible to improve unpacking algorithm for NSIS installers in 7-Zip tool to restore original path relative to installdir directory? I understand that some paths are dynamically calculated, but are they calculated at compile time or during installation?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">16th March 2008 20:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I don't understand what you're asking for. The compression algorithm used and the paths where files are extracted are completely unrelated. Could you provide an example for clarity?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">16th March 2008 21:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Paths can depend on variables that are set at run-time. In such cases it's impossible to obtain a location from installer file.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">********</span><br><span class="post-time small text-muted">2nd September 2008 12:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i><br><b>I don't understand what you're asking for.</b></blockquote>I often use 7-Zip to get a file or two from my old NSIS installations for testing. Recently I decided to implement some automation for extracting these files. With ordinary archive, filepath relative to InstallDir is enough to get the file out of distribution. With NSIS it is not true.<br><br>One improvement is to detect when one file is added to several directories.<br><br>SetOutPath $INSTDIR<br>File example1.nsi<br>SetOutPath $INSTDIR\Kewl<br>File example1.nsi<br><br>In archive listing there will be only one entry of example1.nsi at root.<br><br>I understand that some paths are dynamically calculated at runtime, but these are rare. Most paths depends on unconditional combination of static strings that can be calculated relative to InstallDir at compile time. For example, when two strings are unconditionally assigned static values in some block and concatenated afterwards then resulting string is also static. I.e.<br><br>StrCpy $mydir "$INSTDIR\Kewl"<br>SetOutPath $mydir<br>File example2.nsi<br><br>This could create "Kewl\example2.nsi" entry inside archive instead of "$[32]\example2.nsi" Here is "unconditional assignment" - $mydir is initialized as constant and there is no branching that could make it contain different value until it is used in SetOutPath.<br><br>If the function receives only the same string variable that is written only once during script lifetime with the same constant value then this parameter to function can also be calculated as constant.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">5th September 2008 11:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">So you're suggesting a static analysis of the code to remove redundant assignments and parameter passing? It's a great feature and I do plan for it with the nobjs branch. That said, it's far from a simple task and has much more use at optimization rather than making file extraction easier for external applications. I suggest you find a better solution for keeping your original files rather than modifying the installer or compiler's behavior. It's out of their scope.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">********</span><br><span class="post-time small text-muted">5th September 2008 12:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes, I think it can be called static analysis and I am glad you considered it a great feature. The idea of marking bundled file paths as being static or dynamic is just a single use case, but it would be nice to see it at least partially working. NSIS in not an SFX archiver, of course, and extracting files from an installer is more like occasional feature, but it also appeared very useful feature in my case. =)</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>