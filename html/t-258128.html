<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Create Schema on mySQL when finising installation" />

  <title>Create Schema on mySQL when finising installation - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Create Schema on mySQL when finising installation</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=258128">Create Schema on mySQL when finising installation</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sunlight112</span><br />
      <span class="post-time small text-muted">23rd October 2006 08:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Create Schema on mySQL when finising installation</strong><br />
      I have read many information about MySQL on this forum but I still do not find my answer.<br />
      When finishing to install mysql, how can I <b>create a schema</b> and <b>run file script on command line</b> to finish my install by NSIS language.<br />
      In my opinion, I do with it but it does not work<br />
      eg:<br /></p>

      <blockquote>
        Section Run_Scrilpt<br />
        execDos::exec /NOUNLOAD /TIMEOUT=10000 '"$PROGRAMFILES\MySQL\MySQL Server 5.0\bin\mysql.exe" --user=root --password=passroot --database=openim &lt; "e:\server\openim.sql" ""'<br />
        Pop $0 # return value<br />
        MessageBox MB_OK "Exit code $0"<br />
        SectionEnd
      </blockquote>I am worry about password of root because I do not know it during user to set up our application.<br />
      Somebody used to see this problem please help me!!!<br />
      Big thank for someone can reply me!
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sunlight112</span><br />
      <span class="post-time small text-muted">23rd October 2006 11:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I also check all cases which I read on forum but It can not still run.<br /></p>

      <blockquote>
        <br />
        ExpandEnvStrings $0 %COMSPEC%<br />
        <br />
        Exec '"$0" /C "$PROGRAMFILES\MySql\MySql server 5.0\bin\mysql.exe" "openim" &lt; "$INSTDIR\openim.sql"'<br />
        Pop $0 # return value<br />
        <br />
        MessageBox MB_OK "Exit code $0"<br />
      </blockquote>I only need to create database and run script on mysql!!!!<br />
      Please help me!!!!
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sunlight112</span><br />
      <span class="post-time small text-muted">24th October 2006 05:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>How can I create a schema by NSIS</strong><br />
      I am sorry for self reply. Now I can run a script on MySQL. However, I do not know how to create a database (schema).<br />
      How can I do with it????<br />
      Your help will be really appreciated!!!<br />
      Thank alot,</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">OrdiMars</span><br />
      <span class="post-time small text-muted">24th October 2006 17:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">TO create the database test use (and then go into the db):<br />
      <br />
      CREATE DATABASE IF NOT EXISTS `test` ;<br />
      USE test;<br />
      <br />
      You may want also have a look at MySQL doc:<br />
      <a href="http://dev.mysql.com/doc/refman/5.0/en/create-database.html" target="_blank">http://dev.mysql.com/doc/refman/5.0/...-database.html</a><br />
      <br />
      Cheers,<br />
      L@u</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sunlight112</span><br />
      <span class="post-time small text-muted">25th October 2006 02:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank OrdiMars alot,<br />
      <br />
      I know this command but I do not know how to write it on NSIS because I must run this on MySQL.<br />
      On mysql,I must run MySQL.exe and type password to use mySQL after that I can make this command run.<br />
      But I do not know password of root or user who install MySQL and write it.That is the first problem which I see.<br />
      The second how can I run thing to create database on this. These document on forum also show how to run application on command line not in mysql.<br />
      <br />
      Your help is very useful for me!<br />
      Best regard,</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dandaman32</span><br />
      <span class="post-time small text-muted">25th October 2006 04:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can use InstallOptions to write a custom page that prompts the user for the MySQL root password. Then create a temporary schema file and execute MySQL twice:<br /></p>
      <pre>
<code>Page custom CustomPage CustomFinish " - MySQL root password"<br />Var $mysql_root_pass<br /><br />Function CustomPage<br />  InitPluginsDir<br />  SetOutPath $PLUGINSDIR<br />  File mysql.ini ; refer to InstallOptions docs for instructions for creating this file<br />  InstallOptions::initDialog /NOUNLOAD "$PLUGINSDIR\mysql.ini"<br />  InstallOptions::show<br />FunctionEnd<br /><br />Function CustomFinish<br />  ; NOTE: Be sure to bhange "field 1" to the field number!<br />  ReadINIStr $mysql_root_pass $PLUGINSDIR\mysql.ini "Field 1" State<br />  StrCmp $mysql_root_pass "" 0 +3<br />    MessageBox MB_YESNO|MB_ICONQUESTION "You didn't type a MySQL root password, \<br />        connection to MySQL may fail, do you want to continue?" IDYES +2<br />      Abort ; returns to the page<br />FunctionEnd<br /><br />Section<br />  GetTempFileName $R0<br />  FileOpen $R1 $R0 "w"<br />  FileWrite $R1 "CREATE DATABASE IF NOT EXISTS openim;$\r$\n"<br />  FileClose $R1<br />  ; First round: create the database<br />  execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />    '"$PROGRAMFILES\MySQL\MySQL Server 5.0\bin\mysql.exe" \<br />    --user=root --password=$mysql_root_pass &lt; "$R0" ""'<br />  Pop $0 # return value<br />  MessageBox MB_OK "Exit code $0"<br />  ; Second round: run the schema<br />  execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />    '"$PROGRAMFILES\MySQL\MySQL Server 5.0\bin\mysql.exe" \<br />    --user=root --password=passroot --database=openim &lt; "e:\server\openim.sql" ""'<br />  Pop $0 # return value<br />  MessageBox MB_OK "Exit code $0"<br />SectionEnd</code>
</pre><br />
      (edit: it may be worthy to note that I'm a little rusty at NSIS, so there might be some minor problems with this code; I couldn't test it because everything's booted into Linux at the moment)<br />
      <br />
      -dandaman32
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sunlight112</span><br />
      <span class="post-time small text-muted">25th October 2006 05:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you very much dandaman32,<br />
      I know my requirement is not suitable but I am studying about InstallOptions and many things I do not understand clearly :( .<br />
      Could you please send me the format file mysql.ini?<br />
      I am so sorry for my inconvenience because I still do not study it well.<br />
      Thank alot,<br />
      :D</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sunlight112</span><br />
      <span class="post-time small text-muted">31st October 2006 10:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <b><br />
        Section "RunDB"<br />
        GetTempFileName $R0<br />
        FileOpen $R1 $R0 "w"<br />
        FileWrite $R1 "CREATE DATABASE IF NOT EXISTS openim;$\r$\n"<br />
        FileClose $R1<br />
        ; First round: create the database<br />
        execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />
        '"$PROGRAMFILES\MySQL\MySQL Server 5.0\bin\mysql.exe" \<br />
        --user=root --password=$mysql_root_pass &lt; "$R0" ""'<br />
        Pop $0 # return value<br />
        MessageBox MB_OK "Exit code $0"<br />
        ; Second round: run the schema<br />
        execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />
        '"$PROGRAMFILES\MySQL\MySQL Server 5.0\bin\mysql.exe" \<br />
        --user=root --password=passroot --database=openim &lt; "e:\server\openim.sql" ""'<br />
        Pop $0 # return value<br />
        MessageBox MB_OK "Exit code $0"<br />
        SectionEnd</b>
      </blockquote>Now I can understand InstallOption. When I read your code, i have some confuse.<br />

      <blockquote>
        <font color="blue"><b><br />
        ; First round: create the database<br />
        execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />
        '"$PROGRAMFILES\MySQL\MySQL Server 5.0\bin\mysql.exe" \<br />
        --user=root --password=$mysql_root_pass &lt; "$R0" ""'<br /></b><br /></font>
      </blockquote>It runs $R0 to create database on mysql.When I create database on mysql, we must pass 3 function<br />
      + Run mysql.exe<br />
      + Enter password<br />
      + Type this command <b>"create database if not exists openim"</b><br />
      Firstly, your command run mysql.exe and I can not understand how to work.<br />
      Although I try your code,I does not work. I aslo change many times but I do not work.<br />
      eg:<br />
      execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />
      '"$PROGRAMFILES\MySQL\MySQL Server 5.0\bin\mysql.exe" --password=$mysql_root_pass &lt; "$R0" ""'<br />
      If someone use to see this problem, please tell me!!!<br />
      Thank you very much for your help,
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sunlight112</span><br />
      <span class="post-time small text-muted">4th November 2006 09:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>
      <pre>
<code>dandaman32 posted:<br /><font color="green"><b><br />Page custom CustomPage CustomFinish " - MySQL root password"<br />Var $mysql_root_pass<br /><br />Function CustomPage<br />  InitPluginsDir<br />  SetOutPath $PLUGINSDIR<br />  File mysql.ini ; refer to InstallOptions docs for instructions for creating this file<br />  InstallOptions::initDialog /NOUNLOAD "$PLUGINSDIR\mysql.ini"<br />  InstallOptions::show<br />FunctionEnd<br /><br />Function CustomFinish<br />  ; NOTE: Be sure to bhange "field 1" to the field number!<br />  ReadINIStr $mysql_root_pass $PLUGINSDIR\mysql.ini "Field 1" State<br />  StrCmp $mysql_root_pass "" 0 +3<br />    MessageBox MB_YESNO|MB_ICONQUESTION "You didn't type a MySQL root password, \<br />        connection to MySQL may fail, do you want to continue?" IDYES +2<br />      Abort ; returns to the page<br />FunctionEnd<br /><br />Section<br />  GetTempFileName $R0<br />  FileOpen $R1 $R0 "w"<br />  FileWrite $R1 "CREATE DATABASE IF NOT EXISTS openim;$\r$\n"<br />  FileClose $R1<br />  ; First round: create the database<br />  execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />    '"$PROGRAMFILES\MySQL\MySQL Server 5.0\bin\mysql.exe" \<br />    --user=root --password=$mysql_root_pass &lt; "$R0" ""'<br />  Pop $0 # return value<br />  MessageBox MB_OK "Exit code $0"<br />  ; Second round: run the schema<br />  execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />    '"$PROGRAMFILES\MySQL\MySQL Server 5.0\bin\mysql.exe" \<br />    --user=root --password=passroot --database=openim &lt; "e:\server\openim.sql" ""'<br />  Pop $0 # return value<br />  MessageBox MB_OK "Exit code $0"<br />SectionEnd</b></font><br /></code>
</pre><br />
      Now I can understand what you want to help me,however I run your script. It always displays <font color="red">Error 1</font><br />
      I do not know Error 1 to appear where, so I can not repair it.<br />
      However, I change your code with this:<br />
      <pre>
<code><br /><font color="blue"><br />Section <br />StrCpy $passroot_sql '123456789'<br />GetTempFileName $R0<br />  FileOpen $R1 $R0 "w"<br />  FileWrite $R1 "CREATE DATABASE IF NOT EXISTS openim;$\r$\n"<br />  FileClose $R1<br />  ; First round: create the database<br />  execDos::exec /NOUNLOAD /TIMEOUT=10000 \ 'mysql.exe --user=root --password=$passroot_sql &lt; "$R0" ""'<br />  Pop $0 # return value<br />  MessageBox MB_OK "Exit code $0"<br />  ; Second round: run the schema<br />  execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />    'mysql.exe --user=root --password=$passroot_sql --database=openim &lt; "e:\server\openim.sql" ""'<br />  Pop $0 # return value<br />  MessageBox MB_OK "Exit code $0"<br />SectionEnd<br /></font><br /></code>
</pre><br />
      It announces <font color="red">Error -14</font><br />
      I can not repair it.<br />
      Somebody see this problem, please help me,<br />
      I try my best to study NSIS during many weeks but now I am still not good.<br />
      Your help is very useful for me,<br />
      Thank a lot,
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">4th November 2006 13:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You have extra quotes after "e:\server\openim.sql". Remove them.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sunlight112</span><br />
      <span class="post-time small text-muted">6th November 2006 01:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank Kichik,<br /></p>

      <blockquote>
        Kichik posted<br />
        <b>You have extra quotes after "e:\server\openim.sql". Remove them.</b>
      </blockquote>I try with both but It can not work and show [COLOR=dark red] ERROR -14[/COLOR]<br />
      <pre>
<code><b><br />Section <br />StrCpy $passroot_sql '123456789'<br />GetTempFileName $R0<br />  FileOpen $R1 $R0 "w"<br />  FileWrite $R1 "CREATE DATABASE IF NOT EXISTS openim;$\r$\n"<br />  FileClose $R1<br />  ; First round: create the database<br />  execDos::exec /NOUNLOAD /TIMEOUT=10000 \ 'mysql.exe --user=root --password=$passroot_sql &lt; "$R0"'<br />  Pop $0 # return value<br />  MessageBox MB_OK "Exit code $0"<br />  ; Second round: run the schema<br />  execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />    'mysql.exe --user=root --password=$passroot_sql --database=openim &lt; "e:\server\openim.sql"'<br />  Pop $0 # return value<br />  MessageBox MB_OK "Exit code $0"<br />SectionEnd</b><br /></code>
</pre><br />
      <br />
      Actually, I only want to run two command on console window:<br />
      <font color="green"><b><br />
      C:\&gt;mysql.exe --user=root --password=$passroot_sql &lt; e:\db.txt <font size="3">//to create database</font><br />
      C:\&gt;mysql.exe --user=root --password=$passroot_sql &lt; e:\openim.sql <font size="3">//to run file script</font><br /></b></font><br />
      I try my best to run with all exec,execwait, execshell, ExecCmd::Exec.... but I can not work well.<br />
      Please someone help me,<br />
      Thank a lot,
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th November 2006 06:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You should consult MySQL's documentation to find out what error -14 means.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sunlight112</span><br />
      <span class="post-time small text-muted">6th November 2006 08:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank Kichik,<br />
      I will find it on mysql forum.And now I can do it well.<br />
      In my application, I use passdialog to get password of mysql to create schema or run sql. But I do not know password which user input is right or wrong.<br />
      I want to check it but in my code, I wrote it on file bat and run it. Also, I use nsExec::exec to hide window console.<br />
      How can I know error happen when user type wrong password?<br />
      Console window is hidden so how can I display error for them to know or anything else to know?<br />
      Thank you for your help,</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dandaman32</span><br />
      <span class="post-time small text-muted">6th November 2006 10:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Make a test schema (.sql file) that creates a database with a name that's total gibberish and then drops it again. Then use Pop after you call nsExec to get the return code of mysql.exe. Use StrCmp to check the status code - 0 is success, anything else is failure. AFAIK that's the only reliable way to check the password.<br />
      <br />
      -dandaman32</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sunlight112</span><br />
      <span class="post-time small text-muted">6th November 2006 10:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank dandaman32 for your reply,<br />
      I also think about this and do with it already. But I can pop error. I do not know why<br />
      In file schema.sql "create database if not exists OpenIM"<br />
      My code here:<br /></p>
      <pre>
<code><br />  <font color="blue">$passroot is got from dialog password</font><br />   FileOpen $1 $0 "w"<br />   FileWrite $1 "@echo off$\r$\n"<br />   StrCpy $2 $TEMP 2     ##C:<br />   FileWrite $1 "$2$\r$\n"<br />   FileWrite $1 "mysql.exe --user=root --password=$passroot &lt; c:\openim\home\database\schema.sql$\r$\n"<br />   FileClose $1<br />   nsExec::exec "$0"<br />   Pop $0<br />   IfErrors 0 NoAbort<br />   MessageBox MB_OK "Error code $0"<br />   Detailprint "Create database is error"<br />   NoAbort:<br />   Delete $0<br />   Detailprint "Create database successful"<br /></code>
</pre><br />
      I think I have some mistakes in my code, if you see it, please tell me!!!<br />
      Thank alot,
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">6th November 2006 11:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">-14 comes from ExecDos errors enum:</p>
      <pre>
<code><br />enum ERROR_CODES {<br />   ERR_DUPHANDLE = -16,<br />   ERR_CREATEPIPE,<br />   ERR_CREATEPROC,<br />...</code>
</pre><br />
      "Could not create process" means Win API CreateProcess() call returned error. So I guess mysql is not in path for the last script.
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
