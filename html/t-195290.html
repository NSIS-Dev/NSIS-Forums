<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="BUG: GetParameters or $CMDLINE broken in 2.01" />

  <title>BUG: GetParameters or $CMDLINE broken in 2.01 - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">BUG: GetParameters or $CMDLINE broken in 2.01</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=195290">BUG: GetParameters or $CMDLINE broken in 2.01</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">byteboon</span><br />
      <span class="post-time small text-muted">1st October 2004 18:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>BUG: GetParameters or $CMDLINE broken in 2.01</strong><br />
      Hi,<br />
      <br />
      I have an uninstall script that takes a custom parameter. After upgrading to 2.01, this script now fails to recognize the parameter. It seems that the GetParameters or $CMDLINE behaviour changed. I now get a trailing space in the returned string from GetParameters, which fails my StrCmp. I know I can add a space to my string, but this should be fixed internally if it is indeed a bug.<br />
      <br />
      Thanks,<br />
      Jeremy.<br />
      <br />
      <br />
      MY Code:<br /></p>

      <blockquote>
        Function un.onInit<br />
        SetSilent silent<br />
        <br />
        StrCpy $R0 ""<br />
        Call un.GetParameters<br />
        Pop $R0<br />
        <br />
        MessageBox MB_OK "[$R0]" ; this shows [/D ]<br />
        <br />
        StrCmp $R0 "/D" 0 GoCheckParm2 ; fails now because "/D"!="/D "<br />
        ..do stuff..<br />
        GoCheckParm2:<br />
        ..do stuff..<br />
        <br />
        ...snip...
      </blockquote>MY GetParameters (for uninstaller):<br />

      <blockquote>
        Function un.GetParameters<br />
        <br />
        Push $R0<br />
        Push $R1<br />
        Push $R2<br />
        Push $R3<br />
        <br />
        StrCpy $R2 1<br />
        StrLen $R3 $CMDLINE<br />
        <br />
        ;Check for quote or space<br />
        StrCpy $R0 $CMDLINE $R2<br />
        StrCmp $R0 '"' 0 +3<br />
        StrCpy $R1 '"'<br />
        Goto loop<br />
        StrCpy $R1 " "<br />
        <br />
        loop:<br />
        IntOp $R2 $R2 + 1<br />
        StrCpy $R0 $CMDLINE 1 $R2<br />
        StrCmp $R0 $R1 get<br />
        StrCmp $R2 $R3 get<br />
        Goto loop<br />
        <br />
        get:<br />
        IntOp $R2 $R2 + 1<br />
        StrCpy $R0 $CMDLINE 1 $R2<br />
        StrCmp $R0 " " get<br />
        StrCpy $R0 $CMDLINE "" $R2<br />
        <br />
        Pop $R3<br />
        Pop $R2<br />
        Pop $R1<br />
        Exch $R0<br />
        <br />
        FunctionEnd
      </blockquote>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">1st October 2004 21:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's $CMDLINE's behavior that changed in version 2.0. It's <a href="http://cvs.sourceforge.net/viewcvs.py/nsis/NSIS/Source/exehead/Main.c?r1=1.53&amp;r2=1.54" target="_blank">"made the command line parser cut right on /D= and _?= and not one char before. this way foo.exe "bla"/D=..., which appears to be valid in other applications, will not get the last quote cut off."</a><br />
      <br />
      Should $CMDLINE stick to the real command line or trim from the right? GetParameters already trims from the left, maybe it should trim from the right too. The uninstaller should remove the space it adds, that's what it has been doing before 2.0. But should it trim other spaces too? Someone might want to use the spaces for some reason.<br />
      <br />
      Comments anyone?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">byteboon</span><br />
      <span class="post-time small text-muted">1st October 2004 22:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Obviously I'm biased since I want my code to work like it did before but...<br />
      <br />
      I tend to think of the commandline like the C main(argc,argv[]) where a space in a non-quoted part of the commandline is treated as a delimiter for a new parameter. I understand that Windows just passes the whole line, but is it not reasonable to mimic C's behaviour? Even Windows requires a path with a space be quoted to be recognized properly. So, if I want a trailing space, I could use mycmd.exe "/D " to force the space... usually you don't want the quotes returned with the parameter, and if quotes are important you can double quote...<br />
      <br />
      This is how I would naturally expect things to be parsed:<br />
      <br />
      mycmd.exe /D -&gt; [/D]<br />
      mycmd.exe "/D " -&gt; [/D ]<br />
      mycmd.exe /D=test -&gt; [/D=test]<br />
      mycmd.exe "/D=test -&gt; [/D=test]<br />
      mycmd.exe /D="test " -&gt; [/D="test "]<br />
      mycmd.exe ""/D " " -&gt; ["/D " ] (but I guess parsing double quotes could get hairy)<br />
      <br />
      My two cents.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">1st October 2004 22:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's all true, but $CMDLINE doesn't pretend to mimic C's behavior. It just passes the command line almost as-is.<br />
      <br />
      Anyway, I have reverted the changes done in 1.54 and added a check to make sure there is a space before _=? and /D=. This will cause your script to work as before.<br />
      <br />
      Currnetly, $CMDLINE is not trimmed. It just passes the arguments the user passed as-is.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">byteboon</span><br />
      <span class="post-time small text-muted">1st October 2004 22:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Works for me, thanks for a great product! :D</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">byteboon</span><br />
      <span class="post-time small text-muted">3rd October 2004 02:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, I tried the autogenerated build from Saturday and the same problem exists. I still get a trailing space as above. Am I missing something?<br />
      <br />
      Please not that this is *not* the /D= switch for the compiler, this is my own /D switch that I use to tell the uninstaller to do something different.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">10th October 2004 14:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You are missing a compiled version ;)</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
