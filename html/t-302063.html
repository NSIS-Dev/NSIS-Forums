<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="BUG: Ampersand in path causes ExecCmd to fail"><title>BUG: Ampersand in path causes ExecCmd to fail - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">BUG: Ampersand in path causes ExecCmd to fail</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=302063">BUG: Ampersand in path causes ExecCmd to fail</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">basilisk561</span><br><span class="post-time small text-muted">14th January 2009 15:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>BUG: Ampersand in path causes ExecCmd to fail</strong><br>Hello,<br><br>At install time I extract an EXE to $PLUGINSDIR.<br><br>On a page in the installer I attempt to shell out to this EXE as so:<br><br>ExecCmd::exec '"$PLUGINSDIR\myexe.exe" param1 param2 etc'<br><br>A certain Windows user is logged in with account username "Bob &amp; Gina". The command shell attempt fails. Filemon reveals that ExecCmd is looking here:<br><br>C:\Documents and Settings\Bob &amp; Gina\Desktop\G~1\LOCALS~1\Temp\nsw557.tmp\myexe.exe<br><br>When it should be looking here:<br><br>C:\Documents and Settings\Bob &amp; Gina\LOCALS~1\Temp\nsw557.tmp\myexe.exe<br><br>Notice that "Desktop" is included in the incorrect path. This is because that is where the installer EXE is located and run from. If the installer EXE path changes, that is reflected in the path ExecCmd attempts to execute MYEXE.EXE from.<br><br>All other references to $PLUGINSDIR are evaluated properly -- installer INI files, etc. are correctly located. This is why I believe the problem resides with ExecCmd.<br><br>Any ideers on this?<br><br>FYI SetOutPath has no effect on this, in case that was a coming suggestion. :(<br><br>Thanks in advance!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">15th January 2009 08:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Seems like you're right. What about included nsExec ?<br>Does it produce the same issue ?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">basilisk561</span><br><span class="post-time small text-muted">15th January 2009 13:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Haven't tried nsExec.<br><br>I will say that it appears in the ExecCmd source that the code responsible for expanding $PLUGINSDIR and passing it to the plugins resides in NSIS itself. In other words, I would expect any plugins to have this same issue. ExecCmd just takes what it is given as far as the command line is concerned.<br><br>I would have thought this issue would have surfaced long before now. Or no?<br><br>Any things I can do like escaping the ampersand, etc. to get this working without a huge refactor like switching to nsExec?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">15th January 2009 13:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The code that expands $PLUGINSDIR is indeed not present in any plug-in but in the installer itself. But as you said, it works fine in other places and the same expansion code is used everywhere so it's probably a problem with ExecCmd.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">basilisk561</span><br><span class="post-time small text-muted">15th January 2009 14:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i><br><b>The code that expands $PLUGINSDIR is indeed not present in any plug-in but in the installer itself. But as you said, it works fine in other places and the same expansion code is used everywhere so it's probably a problem with ExecCmd.</b></blockquote>Well, I don't have any personal evidence that $PLUGINSDIR gets handed off properly to plugins. Like you said, it does expand properly everywhere else.<br><br>What about the NSIS code that takes the plugin parameters and parses them into the array of strings for handoff to the plugin?</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">15th January 2009 15:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That's the code I meant. It's all the same for both plug-ins and other script parts.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">basilisk561</span><br><span class="post-time small text-muted">15th January 2009 15:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">nsExec works in this situation. I've changed my installer to that effect. No big deal. ;)<br><br>Thanks to all who helped on this.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Takhir</span><br><span class="post-time small text-muted">15th January 2009 16:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Strange issue, might be good to have script sample. May be even reproducing situation without creation of special account :)<br>In ExecDos following 2 lines only work with path to executable</p><pre>
<code>popstring(ptp-&gt;dosExec);<br>...<br>if(!CreateProcess(NULL, ptp-&gt;dosExec, NULL, NULL, TRUE, 0, NULL, NULL, psi, &amp;pi))</code>
</pre>So I hope plug-in not changes path. To be sure I tested
      <pre>
<code>ExecDos::exec /NOUNLOAD /ASYNC /DETAILED /TIMEOUT=6000 "C:\Users\takhir\Documents\Kisa &amp; Osja\consApp.exe" "test_login$\ntest_pwd$\n"<br></code>
</pre>and this worked fine (while Windows permits ampersands in file/dir names).
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>