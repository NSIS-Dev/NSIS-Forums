<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Newbie questions makensis.nsi ? +2, ifdef, RMDir /r" />

  <title>Newbie questions makensis.nsi ? +2, ifdef, RMDir /r - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Newbie questions makensis.nsi ? +2, ifdef, RMDir /r</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=318714">Newbie questions makensis.nsi ? +2, ifdef, RMDir /r</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hawkmaster</span><br />
      <span class="post-time small text-muted">27th April 2010 16:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Newbie questions makensis.nsi ? +2, ifdef, RMDir /r</strong><br />
      Hi forum,<br />
      I like NSIS and my first installer runs fine.<br />
      I read a lot in old posts and in the documentation.<br />
      But anyhow, I have some questions :-)<br />
      <br />
      In the makensis.nsi script I saw a lot of:<br />
      +2<br />
      +3<br />
      like in;<br />
      ------------------------------------------------------------<br />
      MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 "Do you want to deinstall?" IDYES +2<br />
      ............<br />
      <br />
      IfFileExists $INSTDIR\nsisconf.nsi "" +2<br />
      ...........<br />
      StrCmp $R0 "NSISFile" 0 +2<br />
      .....<br />
      Function PageLeaveReinstall<br />
      <br />
      ${NSD_GetState} $R2 $R1<br />
      <br />
      StrCmp $R0 "1" 0 +2<br />
      StrCmp $R1 "1" reinst_uninstall reinst_done<br />
      <br />
      StrCmp $R0 "2" 0 +3<br />
      StrCmp $R1 "1" reinst_done reinst_uninstall<br />
      ------------------------------------------------------------<br />
      <br />
      As I understand and read in the doc, these are jumps.<br />
      But jumps to where?<br />
      <br />
      2. NO_STARTMENUSHORTCUTS...<br />
      <br />
      What is "NO_STARTMENUSHORTCUTS"?<br />
      I think this is an constant and with<br />
      !ifndef<br />
      we can check if this is defined?<br />
      But where is the constant defined and where will it be defined?<br />
      <br />
      Same for<br />
      VER_MAJOR &amp; VER_MINOR &amp; VER_REVISION &amp; VER_BUILD<br />
      Where are these defined?<br />
      -----------------------------------------------------------<br />
      !ifndef NO_STARTMENUSHORTCUTS<br />
      ${MementoSection} "Start Menu and Desktop Shortcuts" SecShortcuts<br />
      ....<br />
      <br />
      !ifdef VER_MAJOR &amp; VER_MINOR &amp; VER_REVISION &amp; VER_BUILD<br />
      -----------------------------------------------------------------<br />
      <br />
      In lot of Posts you can read the warning of using<br />
      <br />
      RMDir /r<br />
      <br />
      But look at the end of the script.<br />
      You can see there a lot of lines with RMDir /r<br />
      Is this a bad example?<br />
      <br />
      --------------------------------------------------------------------<br />
      <br />
      RMDir /r $INSTDIR\Bin<br />
      RMDir /r $INSTDIR\Contrib<br />
      RMDir /r $INSTDIR\Docs<br />
      RMDir /r $INSTDIR\Examples<br />
      RMDir /r $INSTDIR\Include<br />
      RMDir /r $INSTDIR\Menu<br />
      RMDir /r $INSTDIR\Plugins<br />
      RMDir /r $INSTDIR\Stubs<br />
      ------------------------------------------------------------------<br />
      <br />
      thank a lot for any help and explanation<br />
      <br />
      regards<br />
      hawk</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">27th April 2010 17:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by hawkmaster</small><br />
        Hi forum,<br />
        In the makensis.nsi script I saw a lot of:<br />
        +2<br />
        +3<br />
        As I understand and read in the doc, these are jumps.<br />
        But jumps to where?
      </blockquote>Lines relative to the line that contains that command.<br />
      <br />
      i.e.<br />
      <pre>
<span style="color: #FF8000">/*line0*/</span><span style="color: #0000BB">IfFileExists</span><span style="color: #DD0000">"c:\somefile"</span><span style="color: #0000BB">0</span><span style="color: #007700">+</span><span style="color: #0000BB">2<br /></span><span style="color: #FF8000">/*line+1*/</span><span style="color: #0000BB">MessageBoxMB_OK</span><span style="color: #DD0000">"c:\somefileexists!"<br /></span><span style="color: #FF8000">/*line+2*/
</span>
</pre>So if the file doesn't exist, the messagebox is skipped.<br />
      ( note that using '0' is a special case and it always goes to the next line - otherwise it would get stuck in a loop. You could use either 0 or +1; coders tend to use '0' to indicate a "just continue with the code" to anybody reading the source )<br />
      <br />
      I highly recommend using LogicLib instead, where this becomes:<br />
      <pre>
<span style="color: #007700">${If}${</span><span style="color: #0000BB">FileExists</span><span style="color: #007700">}</span><span style="color: #DD0000">"c:\somefile"<br /></span><span style="color: #0000BB">MessageBoxMB_OK</span><span style="color: #DD0000">"c:\somefileexists!"<br /></span><span style="color: #007700">${EndIf}
</span>
</pre>The reason is that if you add a command after the messagebox, the LogicLib version will continue to work. The other version you would have to increase the +2 to +3 (or use a named label with all its perils if this is inside a macro).<br />
      <br />
      <br />

      <blockquote>
        <small>Originally posted by hawkmaster</small><br />
        What is "NO_STARTMENUSHORTCUTS"?<br />
        I think this is an constant and with<br />
        !ifndef<br />
        we can check if this is defined?
      </blockquote>Correct<br />
      <br />

      <blockquote>
        <small>Originally posted by hawkmaster</small><br />
        But where is the constant defined and where will it be defined?
      </blockquote>They would be defined by you, the user. In the specific case of this define, it might get used by a Start Menu page. This will depend on the exact script you got that from.<br />
      This script...<br />
      <a href="http://steveprutz.wikidot.com/nsis" target="_blank">http://steveprutz.wikidot.com/nsis</a><br />
      ...uses it, for example.<br />
      You can see that he only includes the code for creating start menu shortcuts in his installer if 'NO_STARTMENUSHORTCUTS' is -not- defined.<br />
      <br />

      <blockquote>
        <small>Originally posted by hawkmaster</small><br />
        Same for<br />
        VER_MAJOR &amp; VER_MINOR &amp; VER_REVISION &amp; VER_BUILD<br />
        Where are these defined?
      </blockquote>Same applies there - they would be set by you, the user.<br />
      <br />
      These are all defines that NSIS doesn't use, itself, directly - so their usage and what they do would depend on your installer script. They aren't required, though.<br />
      <br />

      <blockquote>
        <small>Originally posted by hawkmaster</small><br />
        In lot of Posts you can read the warning of using<br />
        <br />
        RMDir /r<br />
        <br />
        But look at the end of the script.<br />
        You can see there a lot of lines with RMDir /r<br />
        Is this a bad example?
      </blockquote>Yes. It assumes that $INSTDIR is the location that was installed to. If $INSTDIR is blank, for any reason, it would then proceed to remove anything from e.g. "c:\Docs\". Although it's not likely that any of these folders exist in the root drive, it's still bad practice.<br />
      In addition - for this example script especially - if the user decided to write some of their own Include files and saved them in that Include folder thinking that would be appropriate, then the code given would also remove the Include files the user created. Typically not desired behavior.<br />
      <br />
      I hope this helps :)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">redxii</span><br />
      <span class="post-time small text-muted">27th April 2010 18:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The compiler has a define command so VER_MAJOR etc can be defined and changed at compile time and not have to modify the script to change or update the version of the installer.<br />
      <br />
      Defines are set in Tools -&gt; Settings in MakeNSISW.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hawkmaster</span><br />
      <span class="post-time small text-muted">28th April 2010 07:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank's a lot for this good explanation.<br />
      It helps me.<br />
      <br />
      What is still not really clear is the handling with constants and !ifdef:<br />
      In the script of <a href="http://steveprutz.wikidot.com/nsis" target="_blank">http://steveprutz.wikidot.com/nsis</a> or in makensis.nsi for example:<br />
      ................................<br />
      !ifndef NO_STARTMENUSHORTCUTS<br />
      CreateShortCut "$SMPROGRAMS\NSIS.lnk" "$INSTDIR\NSIS.exe"<br />
      !endif<br />
      .................<br />
      <br />
      What I am missing is something where the constant is set, like<br />
      NO_STARTMENUSHORTCUTS = "" or<br />
      NO_STARTMENUSHORTCUTS = yes<br />
      For my understanding the "CreateShortCut" is always done because the constant is never set?<br />
      Is "NO_STARTMENUSHORTCUTS" a fix name of NSIS ?<br />
      or can you write:<br />
      !ifndef NONE_SHORTCUTS_STARTMENU<br />
      ..<br />
      is this the same?<br />
      <br />
      perhaps I am thinking too much complicated :-)<br />
      <br />
      regards<br />
      hawk</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">28th April 2010 08:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If the define is never defined, then yes, the createshortcut command is always compiled into the installer. It could be defined in some !include file somewhere, of course. But google finds this:<br />
      <a href="http://forums.winamp.com/showthread.php?postid=842561" target="_blank">http://forums.winamp.com/showthread.php?postid=842561</a><br />
      So apparently the !ifndef was added to mute shortcut creation in automated NSIS installers.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
