<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="'scan for hardware changes' via NSIS?" />

  <title>'scan for hardware changes' via NSIS? - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">'scan for hardware changes' via NSIS?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=319779">'scan for hardware changes' via NSIS?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">9th June 2010 00:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>'scan for hardware changes' via NSIS?</strong><br />
      got a bit of an odd report, but that's Windows and devices for ya...<br />
      <br />
      Our installer currently (pre-)installs a hardware device driver through DPInst, simply to prevent any specific tweaks needing to be made through Windows versions, 32bit vs 64bit, and all that. This works very well, so no problems there.<br />
      <br />
      Then a curious user decides to remove the installed hardware device from the Device Manager. No problem.. if the user wants to be silly, that's totally up to them.<br />
      <br />
      But then when they re-install the hardware device driver through the installer, instead of DPInst installing, it performs a pre-install. After all, it thinks the hardware is gone (the user removed it from the device manager).<br />
      Now personally I think this is pretty much expected behavior if the user forces this, and if the user scans for hardware after installation, it will use the pre-installed package just dandy.<br />
      But from a user-friendliness point of view, the expected behavior probably -is- that the device becomes available again after driver package installation.<br />
      <br />
      So to solve this, I have to force the equivalent of the Device Manager's "scan for hardware changes" functionality - preferably without opening the device manager console and sending a mouseclick to the button ;)<br />
      <br />
      The 'scanHardware' configuration flag for DPInst sounded 100% promising but of course what it actually means is 'scan the currently recognized devices and only install the package if it is a better match than the current package installed for that device'.<br />
      <br />
      Neither the InstDrv plug-in nor 'Driver installation and update' wiki topics seem to touch on device list refreshing.<br />
      <br />
      Which leaves me with the maze that is MSDN, which tells me I should be running what is explained here...<br />
      <a href="http://support.microsoft.com/kb/259697" target="_blank">http://support.microsoft.com/kb/259697</a><br />
      whose functions are described in Cfgmgr32.dll<br />
      ...through the System plugin.<br />
      <br />
      Would that be the appropriate route to take, or is there a more obvious method that I glossed over?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br />
      <span class="post-time small text-muted">9th June 2010 08:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You might want to have a look at the devcon tool from the Windows DDK:<br />
      <a href="http://support.microsoft.com/kb/311272" target="_blank">http://support.microsoft.com/kb/311272</a><br />
      <br />
      Though I'm not sure Vista or Win7 support this tool.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">9th June 2010 11:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I forgot to mention that one...<br />
      <br />
      1. Yes, the page doesn't say anything about Vista+ support<br />
      <br />
      but even if it did, there's a dealbreaker in there<br />
      <br />
      2.</p>

      <blockquote>
        DevCon is <b>not redistributable</b>. It is provided for use as a debugging and development tool.
      </blockquote>emphasis mine
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br />
      <span class="post-time small text-muted">9th June 2010 12:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Animaether</small><br />
        DevCon is not redistributable. It is provided for use as a debugging and development tool.
      </blockquote>Hmm, missed that.<br />
      <br />
      Then I think your only option is to use the functions you mentioned in the first post.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">11th June 2010 12:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yup, seemed like it. Just wanted to double-check - thanks :)<br />
      <br />
      Function calls are now implemented... I made a wiki page for it with fully annotated macro:<br />
      <a href="http://nsis.sourceforge.net/Scan_for_hardware_changes" target="_blank">http://nsis.sourceforge.net/Scan_for_hardware_changes</a><br />
      <br />
      I still wrestle with System sometimes, so if I'm using a wrong type somewhere.. please do (help) fix; as far as I can tell, though, it works.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
