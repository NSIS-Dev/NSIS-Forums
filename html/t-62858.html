<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Optional install" />

  <title>Optional install - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Optional install</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=62858">Optional install</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">online</span><br />
      <span class="post-time small text-muted">17th October 2001 07:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Optional install</strong><br />
      Will the installer support optional install? Like letting the user choose among COM ports or enter a text?<br />
      Whats the status on this?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">locnar42</span><br />
      <span class="post-time small text-muted">25th October 2001 04:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">i have a small app which I coded to do something similar. you run it from your installer and give it the hwnd of the installer and the name of an INI file. it starts up, reparents itself to the installer (so that it looks seemless), and dynamically generates a dialog based on the INI file. Then, when the user clicks OK it saves the values back to the INI which can be read from the installer. Just include the file and extract to the temp directory. Delete it after you have your values.<br />
      <br />
      I know it would be better to put this in the source of NSIS, but I did it this way because 1) I had just gotten NSIS and wasn't comfortable with the source yet and 2) needed very quick (about 2 hour) results.<br />
      <br />
      Right now, you can put labels, text boxes, and password boxes onto the form along with a caption. It could be easily modified to allow combo box support also.<br />
      <br />
      it's on my other computer but can post it (along with source code) if you are interested.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">online</span><br />
      <span class="post-time small text-muted">25th October 2001 08:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">please do so!<br />
      regards <a href="mailto:jfina@online.no">jfina@online.no</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">justin</span><br />
      <span class="post-time small text-muted">25th October 2001 10:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes if you want, I can include this utility with the nsis distro (like splash.exe, etc :).<br />
      <br />
      -Justin</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">online</span><br />
      <span class="post-time small text-muted">25th October 2001 11:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">absolutely! :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">locnar42</span><br />
      <span class="post-time small text-muted">25th October 2001 20:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here it is. There really isn't a lot of documentation, but I did include a sample install script. Also, I went ahead and threw in support for comboboxes (both comboboxes and dropdown lists).<br />
      <br />
      You can do with the source code all you want, just imagine I wrote a license for it similar to NSIS is under.<br />
      <br />
      If somebody wants to do what they can to squeeze a few bytes out of the program, that would probably be pretty cool.<br />
      <br />
      If you notice any bugs, you can either fix them yourself (since you have the source code) or let me know and I'll do it. If you do fix any bugs or add features, I'd love to have a copy of your modifications also. You can email me at: mbishop at bytealliance dot com<br />
      <br />
      (edited the attachment to actually include a license for those who require it.)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">locnar42</span><br />
      <span class="post-time small text-muted">26th October 2001 04:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>update</strong><br />
      Well, I apoligize but I realized there is a slight problem with the above archive. When you have multiple controls on your dialog, it sets the focus to the <b>last</b> control created instead of the first as you'd expect. I introduced this when I threw in the combobox stuff at the last minute and didn't test it enough.<br />
      <br />
      Anyway, here is the fixed archive. Please download this one if you already have the above.<br />
      <br />
      <i>If you've already started modifying the code, just make sure the for loop exits the first time. The break that's in there right now only gets it out of the switch statement, then goes to the next control and sets focus all over again.</i><br />
      <br />
      later.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">online</span><br />
      <span class="post-time small text-muted">26th October 2001 06:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks!<br />
      I'll look at it!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">locnar42</span><br />
      <span class="post-time small text-muted">27th October 2001 16:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>update</strong><br />
      Ok, due to a request I received I've fixed/added a few things.<br />
      * I fixed the keyboard accelerator for the ENTER key.<br />
      * Moved the OK button so it's a standard size and in the same location as the NSIS buttons.<br />
      * Added a "Title" option to set the title caption of the installer window while the options screen is being displayed.<br />
      * I changed the documentation into an HTML file and added a bit more description.<br />
      <br />
      I recommend this download, if for no other reason than the first item. This behavior really annoyed me also.<br />
      <br />
      Let me know if you have any questions or any more requests.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Schultz</span><br />
      <span class="post-time small text-muted">28th October 2001 02:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">one feature that i would like to see in it.. Is i am needing some way for users to specify another folder outside of NSIS's Dir page.. Since i am installed something and then i need to install plugins to a few different programs but the problem is they don't set registry keys to where they are installed. Right now using this it makes the user type it in by hand.. But would nice if you could add another option like define a dir choice and place a small button that opens up a browseinfo box to select a dir.. thanks..</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">locnar42</span><br />
      <span class="post-time small text-muted">28th October 2001 08:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>another update</strong><br />
      Schultz, this one's for you...and everybody else of course.<br />
      Included in this release is support for two additional controls. "FileRequest" and "DirRequest". These controls are drawn as a text box with a command button right next to it. The command button has a caption of "..." and clicking it will pop up a dialog of the appropriate browse type.<br />
      <br />
      The FileRequest control has properties for setting the filter, specify "Open" or "Save" dialog, and a few other things.<br />
      <br />
      I also added a few other things. The next biggest change is that I added "MaxLen", "MinLen", and "ValidateText" properties to each control. If the MaxLen or MinLen is not satisfied, then a messagebox with ValidateText is shown. MinLen can be used to force input to a textbox, or to force selection of an item in a combobox.<br />
      <br />
      I also made a few more changes to the documentation to hopefully explain it even better and cleaned the source code a little bit.<br />
      <br />
      As always, let me know of any ideas/problems.<br />
      <br />
      michael</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">justin</span><br />
      <span class="post-time small text-muted">28th October 2001 09:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I took a few minutes and reduced the size of the latest installeroptions (1.2) to 8.5kb. Attached. =)<br />
      <br />
      My modifications to this are pretty much public domain, do whatever you want with em =)<br />
      <br />
      -Justin</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Schultz</span><br />
      <span class="post-time small text-muted">28th October 2001 10:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">thanks locnar42 that was exactly what i am looking for. and dang justin you sure know how to make stuff alot smaller.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Schultz</span><br />
      <span class="post-time small text-muted">28th October 2001 16:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">well i have a bug report.. it seems that if you just add two fields like this.<br />
      [Settings]<br />
      title=Select Dir<br />
      Caption=Testing this<br />
      ParentWnd=0<br />
      NumFields=2<br />
      DefaultField=2<br />
      <br />
      [Field 1]<br />
      Type=label<br />
      text=Select Dir<br />
      left=10<br />
      right=300<br />
      top=100<br />
      bottom=120<br />
      <br />
      [Field 2]<br />
      Type=DirRequest<br />
      left=10<br />
      right=300<br />
      top=122<br />
      bottom=142<br />
      <br />
      and when you click on the ... button it automatically closes the windows like you are hitting the OK button.. but if you add in a Combo box for Field 3 then it works.. or if you reverse the two and have the DirRequest as Field 1 and label as Field 2 it works except that the label is not displayed at all.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">locnar42</span><br />
      <span class="post-time small text-muted">28th October 2001 16:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, sorry about this one. I accidently reused the identifier of the OK button when creating controls.<br />
      <br />
      I'm going to post the fix here in a second, but I'm going to go ahead and use Justin's improvements because I definatly want to see this thing smaller. The problem is, if you make that change to the code which Justin posted, then the application won't exit cleanly. This only affects the Release build, not if you compile for debug.<br />
      <br />
      It restores the NSIS window, saves the settings, and then hangs. In fact, I've traced it all the way to the return statement from WinMain so it's in some of the cleanup code.<br />
      <br />
      I don't know if it's something that Justin changed or (more likely) something in the original code. I'll put the update here as soon as I have this problem worked out.<br />
      <br />
      If you have my code and can compile it yourself, then change the 1100 in ReadSettings() and AddBrowseButtons(). This will fix the problem. Otherwise, wait a bit and I'll put the fix here.<br />
      <br />
      I've got some other stuff I've got to do right now, but I'll get to it later today hopefully.<br />
      <br />
      michael</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">justin</span><br />
      <span class="post-time small text-muted">28th October 2001 19:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Oops, the hanging bug was my fault. I forgot that when not using the CRT for WinMain, you have to call ExitProcess() directly. Attached.<br />
      <br />
      -Justin</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">locnar42</span><br />
      <span class="post-time small text-muted">29th October 2001 03:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>ok, this one has it all.</strong><br />
      Ok, this version here incorporates the bug fix which Justin just posted and the fix for the problem which Schultz reported.<br />
      <br />
      Check back in a day or two because a couple of the things I'm about to put in are (with priority):<br />
      * checkbox and radio button controls. (high)<br />
      * Specify the title for the open/save dialog box. (medium)<br />
      * Specify the caption for the directory browser. (high)<br />
      * Adding a couple of additional flags for controls. (medium)<br />
      * Add an icon so the dialog can match the main NSIS window. (low)<br />
      * Ability to use a separate window (outside of NSIS) of any size so you can include as many controls as you need. (medium)<br />
      <br />
      I know how I can cut a bit more space inside the program, so all this should stay at the newly improved size of 8.5k<br />
      <br />
      Thanks Justin for pointing that out. I was scratching my head thinking that I wasn't freeing memory or freeing it twice or something. Thanks for the size reduction as well. That's some diet you put it on there. It makes it more attactive to include in a smaller installation.<br />
      <br />
      michael</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">justin</span><br />
      <span class="post-time small text-muted">29th October 2001 06:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Great. =) I'll be glad to shrink other parts too if you like. I just did the most obvious optimizations =)<br />
      <br />
      I'm kind of thinking of including a contrib\ directory in the installer, for apps like this (and I guess zip2exe and splash would go there too). Sound like a good idea? Would you be ok with having your code distributed along with it?<br />
      <br />
      -Justin</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">locnar42</span><br />
      <span class="post-time small text-muted">29th October 2001 15:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>sounds good to me</strong><br />
      Distributing it with NSIS would be fine by me. I think a contrib directory sounds like a good idea, especially if more add-ons are available. It was a while from when I started using NSIS until I came here and if others are the same way it could prove useful.<br />
      <br />
      I have already cut the compiled version down by another 512 bytes (~250 compressed bytes) and I modified a lot of lines of code to do it. If you plan on having another round of it, let me know and I'll get you the newest copy. Otherwise I'm going to wait until I add a couple of the above mentioned features before I post again. I've noticed that the mouse cursor will sometimes disappear (btw, wiggling the mouse always brings the cursor back), so I'll be fixing that as well.<br />
      <br />
      UPDATE: Project is approved and the source code should be on SourceForge sometime today. The website will be located at <a href="http://installoptions.sourceforge.net" target="_blank">http://installoptions.sourceforge.net</a> and the project page at <a href="http://sourceforge.net/projects/installoptions/" target="_blank">http://sourceforge.net/projects/installoptions/</a><br />
      <br />
      michael</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">online</span><br />
      <span class="post-time small text-muted">30th October 2001 07:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've tried the installeroption and i'm very satisfied with what i see. The only thing i'm missing is the posibility to set default vaules for the combo box<br />
      <br />
      /Jon</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Schultz</span><br />
      <span class="post-time small text-muted">30th October 2001 13:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hum not sure if this is just my system or another bug.. but sometimes when you select a folder and come back to the installer it don't repaint itself.. until you either click on the text area or the browse button again.. but again not sure if my system is what is causing this.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">locnar42</span><br />
      <span class="post-time small text-muted">30th October 2001 14:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The defaults for the combobox are going to be implemmented via the Text value in the INI file. This was supposed to already be done (I think it says so in the documentation), but it slipped my mind. Thanks for reminding me.<br />
      <br />
      As for the repaint, I'm not sure yet. I force the window to be invalidated after the browser dialog closes, but I'll check and make sure it's working all the time. Is there any way that you can see where it always happens?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Schultz</span><br />
      <span class="post-time small text-muted">30th October 2001 14:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">i think the easiest way to test this is after you select a directory.. drag an application over the text box.. After this part of the text box won't be repainted. and sometimes the ok button is also.. You can still click in there but it is a little annoying if you are doing multiple things at once..<br />
      also not sure if this matter usin WinXP</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">locnar42</span><br />
      <span class="post-time small text-muted">30th October 2001 15:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">cool, can reproduce that exactly so I should have it fixed in no time. It was a bit different problem than I was thinking, but shouldn't be a problem at all.<br />
      <br />
      I already fixed the problem about not being able to set the initial value of a combobox.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">locnar42</span><br />
      <span class="post-time small text-muted">30th October 2001 16:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, fixed the problem with the window being redrawn. After staring at the screen for a bit wondering why it was doing that, I thought I'd try something out.<br />
      What's happening is, my program does redraw the controls, but right after that the main NSIS window draws over them. To fix this, I temporarily set the window flags of the main NSIS window to include WS_CLIPCHILDREN so that it won't draw on top of my window. I restore the window flags when my program exits.<br />
      <br />
      also included here are a few more size reductions and the fix for the combobox initial value.<br />
      <br />
      Let me know if this fixes your problem.<br />
      <br />
      My apoligizies to everyone, but I changed the EXE name to InstallOptions. Make sure you change this everywhere in your script.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mcgarrah</span><br />
      <span class="post-time small text-muted">31st October 2001 15:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Neato</strong><br />
      Glad I caught this in another thread. I'm working on a registration dialog and this is much nicer than my quick/dirty first try.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
