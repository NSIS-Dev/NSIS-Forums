<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="NSIS is revolting!"><title>NSIS is revolting! - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">NSIS is revolting!</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=154436">NSIS is revolting!</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">lewellyn</span><br><span class="post-time small text-muted">29th October 2003 05:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>NSIS is revolting!</strong><br>&nbsp; Well, the time has come to make an installer that does everything I've been trying to avoid. (Well, almost...) Anyway, I hate functions. They hate me. I've attempted to draw up a treaty, NSIS responded with a Molotov cocktail... :hang:<br><br>So, since I couldn't figure out how to do what I needed myself, I turned to the docs, examples, FAQ, forum, and archive to find out if anyone else has needed these things. Sure enough, they have... Looks like I won the battle... But NSIS is trying to win the war... :mad:<br><br>1) I want to only allow the installer to be invoked once. Apparently, we had an issue with a previous installer when someone tried to install twice at once. :igor: I found the mutex recipe, but it always pops up the message box.<br><br>2) I have 3 subsections in my components page. I want 0 or 1 of the 5 items in the first subsection to always be selected. (Oh, yeah... none of the items should be a default selection.) I looked at one-section.nsi, ripped the function out and tried to modify it to fit my needs. I failed. Miserably. It's currently almost exactly as it is in one-section.nsi. It almost works. If your first selection is the subsection itself, they are all selected...<br><br>3) I have a couple of custom pages with text boxes that I would love to have white backgrounds on to match, for example, the readme page. Neither example I found wants to work and tinkering with them too much gives me a totally blank page. Go me.<br><br>I'm going to continue to pound on this nsi to try to make it submit to my will, but if someone out there in NSISland is willing to be a mediator, world peace will be reached that much sooner! :D<br><br>Seriously, though, since I'm having a difficult time, any assistance would be appreciated.<br><br>I'm hearing NSIS readying another assault, so I should get back to work. If anyone is interested, I have attached a somewhat stripped down sample. I probably should have stripped it more, but this is an accurate picture of the problem and compiles into something that shows it. Just search for [XXX] in the .nsi.<br><br>Since the zip is a bit on the larger side and is likely to be rejected by the board, you can grab it from <a href="http://www.mpsmultimedia.com/lewellyn-nsi.zip" target="_blank">http://www.mpsmultimedia.com/lewellyn-nsi.zip</a> Let me know if I missed anything in this message or if I need to clarify anything.<br><br>Viva!<br><br>--_Lewellyn<br><br>P.S. I just noticed that you can't make 2 links on the finish page. Is this intentional? Is it easily surmountable with a custom page, or should I just give in? An example of that is also in that zip file. I think that's all I have left... :/<br><br>[edit]I am using whatever NSIS Update gave me from CVS a couple of hours ago. So it should be fairly up-to-date. And none of these things sound like bugs, just a case of PEBKAC or something similar. Diagnoses welcome.[/edit]</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Vytautas</span><br><span class="post-time small text-muted">29th October 2003 12:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I had a look at your script and found the problem with your first question. First of all to get rid of the MessageBox just remove the MessageBox command. Also one of your call had an error. I created an archive page on this subject and it can be found <a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=386" target="_blank">here.</a><br><br>Good luck with the other problems.<br><br>Vytautas :D</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">29th October 2003 16:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">1) There as indeed a typo in the FAQ item. This has been solved: <a href="http://nsis.sourceforge.net/site/index.php?id=19&amp;backPID=15&amp;tx_faq_faq=29" target="_blank">http://nsis.sourceforge.net/site/ind...&amp;tx_faq_faq=29</a><br><br>2) Use a read-only (RO) Section, see documentation for details.<br><br>3) The InstallOptions / Modern UI documentation show you how to use custom colors (using SetCtlColors).<br><br>4) You can easily add one item to the custom page INI file (you can write to the ioSpecial.ini file in a custom pre function).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">lewellyn</span><br><span class="post-time small text-muted">29th October 2003 18:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">1) I hadn't noticed this typo. And all of the versions I came across looked the same to my unenlightened eye... ;)<br><br>2) I've tried using a RO section. However if I make one of the sections in that subsection RO, the section can't be selected at all, not even when you choose an InstType that includes it. I'm sure I've borked something, but I can't figure out how to unbork it... :igor:<br><br>3) Shouldn't this give me a window with Times New Roman for the background of the text box (Field 1)? Does the position of the function in the script matter? This example is from the MUI docs.<br><br></p><pre>
<code>
Pop $HWND ;HWND of dialog
<br><br>GetDlgItem $DLGITEM $HWND 1202;1200 + Field number - 1
<br><br>&gt;;$DLGITEM contains the HWND of the first field
<br>CreateFont $FONT"Times New Roman" 10 700 
<br>SendMessage $DLGITEM${WM_SETFONT} $FONT 0 
<br>&gt;
</code>
</pre>4) If I feel like attempting this, I may. It shouldn't be too hard, but neither should any of the rest of this... :(<br>
      <br>
      Thanks for the help, both of you. :)<br>
      <br>
      --_Lewellyn
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br>
      <span class="post-time small text-muted">29th October 2003 18:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">3) Works fine for me. Replace the function in the InstallOptions.nsi Modern UI example by:<br></p>
      <pre>
<code>Var HWND<br>Var DLGITEM<br>Var FONT<br><br>Function CustomPageA<br>  <br>  !insertmacro MUI_HEADER_TEXT "$(TEXT_IO_TITLE)" "$(TEXT_IO_SUBTITLE)"<br><br>  !insertmacro MUI_INSTALLOPTIONS_INITDIALOG "ioA.ini"<br>  Pop $HWND ;HWND of dialog<br>    <br>  GetDlgItem $DLGITEM $HWND 1200 ;1200 + Field number - 1<br>    <br>  ;$DLGITEM contains the HWND of the first field<br>  CreateFont $FONT "Times New Roman" 10 700 <br>  SendMessage $DLGITEM ${WM_SETFONT} $FONT 0<br>        <br>  !insertmacro MUI_INSTALLOPTIONS_SHOW<br><br>FunctionEnd</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">lewellyn</span><br>
      <span class="post-time small text-muted">29th October 2003 19:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ah... I incorrectly parsed that "1200 + Field number -1" comment. <i>*kicks himself*</i><br>
      <br>
      Anyway, it works now for changing the font. But, changing the color to white isn't working. (The license page uses white, correct? Or is it using a system color of some sort?) I replaced the CreateFont and SendMessage lines with the following and did not get the color to change:<br>
      <br></p>
      <pre>
<code>
SetCtlColors $DLGITEM $0x00FFFFFF 
<br>&gt;
</code>
</pre>However, that's just a minor annoyance. I really need to figure out how to fix the "only one or none selected" issue still, so I'll go back to that now.<br>
      <br>
      Thanks again. :)
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br>
      <span class="post-time small text-muted">29th October 2003 19:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Please check the users manual. There are multiple parmaters for SetCtlColors (text/background).</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">lewellyn</span><br>
      <span class="post-time small text-muted">29th October 2003 19:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks. I'll look at the manual again after I get the sections issue resolved, since that's more of a show-stopper. :)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br>
      <span class="post-time small text-muted">29th October 2003 19:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The sections work fine for me. Put "SectionIn RO" in one of the Sections in a SubSection.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">lewellyn</span><br>
      <span class="post-time small text-muted">29th October 2003 19:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I did that with the topmost Section in the top SubSection. However it's always unchecked, and I can't check it. And, to boot, checking the subsection as the first selection made selects everything BUT that RO section.<br>
      <br>
      I don't want clicking on the subsection to be possible, just one or none of the sections in that section. By playing with that .onSelChange function that is in one-section.nsi, I have made some interesting effects but none what I want. I'm trying to parse exactly how it works now.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br>
      <span class="post-time small text-muted">29th October 2003 19:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I don't understand what you mean. When using RO for a section inside a subsection, the section checkbox will be greyed out (disabled), that means that you can't change it (read-only).</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">lewellyn</span><br>
      <span class="post-time small text-muted">29th October 2003 20:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK. I think I'm following now... I moved the hidden required section as a (visible) read-only section in that subsection. The section checkbox is greyed out (disabled/selected), and the subsection checkbox is shaded (partially selected). However, when you click the subsection, everything becomes selected. I guess I need to make the subsection header unselectable somehow.<br>
      <br>
      This is the line I should be modifying with the number of sections to be exclusive of one another, right?<br>
      <br></p>
      <pre>
<code>
StrCmp $2 $1 0 +5 ; selection hasnt changed 
<br>&gt;
</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br>
      <span class="post-time small text-muted">29th October 2003 20:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you click on a subsection, all sections will be selected, but the RO section still remain the same. What's wrong with that?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">lewellyn</span><br>
      <span class="post-time small text-muted">29th October 2003 20:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am trying to emulate one-section.nsi's behavior, only without a default selection for the group.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">lewellyn</span><br>
      <span class="post-time small text-muted">30th October 2003 21:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">For the benefit of those searching the forums at a later date:<br>
      <br>
      kichik helped me figure it out. The solution? Don't change anything. :) Well, that's not quite true, but close.<br>
      <br>
      According to kichik: "Don't use $1 anywhere", "copy the first section you want selected, not the sub-section" to $1 in .onInit, and "you don't have to make the default section selected by default, just specify it as default". Oh, and to add a new section: "everywhere a section index is defined, you need to add another block of that for the new section", "everywhere there is ${sec4}, add the same block for ${sec5}".<br>
      <br>
      Hope that helps someone else who can't figure it all out. one-section.nsi is just magic... :)</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script type="text/javascript" src="../js/highlight.pack.js" async>
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>