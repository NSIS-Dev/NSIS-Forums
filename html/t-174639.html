<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Delete and/or RMDir"><title>Delete and/or RMDir - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Delete and/or RMDir</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=174639">Delete and/or RMDir</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">YooperNC</span><br><span class="post-time small text-muted">29th March 2004 22:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Delete and/or RMDir</strong><br>I'm using the latest full release of NSIS, 2.0. My installer creates a directory that isn't in or near the $INSTDIR. When I go to Delete files from that directory or when I try to RMDir that directory, nothing happens. No ErrorFlags are set. I have tried just about everything. I even went so far as to store the created directory in the registry and read it back out during Uninstall. I posted a MessageBox to myself, verifying that the string is correct.<br><br>Has anyone else seen this? Is it a known problem? Or is it "Operator Error". There's not much to see in my script, but if you want some pieces cut out of my installer, let me know, and I'll be happy to post them here.<br><br>Any and all help would be greatly appreciated. Thanks!<br><br>Dave</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">deguix</span><br><span class="post-time small text-muted">30th March 2004 03:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><b>RMDir</b> - 2 possibilities:</p><blockquote>Without /r [as a parameter], the directory will only be removed if it is completely empty.</blockquote><blockquote>If /REBOOTOK is specified [as a paramenter], and the directory cannot be overwritten, then the directory will be deleted when the system reboots... [so] the reboot flag will be set [but not the error flag].</blockquote><b>Delete</b> - 2 possibilities:<blockquote>The error flag is not set from trying to delete a file that does not exist.</blockquote><blockquote>If /REBOOTOK is specified and the file cannot be deleted then the file is deleted when the system reboots... [so] the reboot flag will be set.</blockquote></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pol</span><br><span class="post-time small text-muted">30th March 2004 10:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Perl script to list all files</strong><br>Hello,<br><br>I have made a simple perl sript to list all files of your project with RMDir and Delete instructions.<br><br>This is very usefull if your project have a lot of files (more than 2000 in my case) and if you want to make a clean and complete uninstall.<br><br>The result is saved in a separate file. You will need to add<br>!include "uninstall.nsh"<br>in your uninstall secion<br><br>The uninstall.nsh will look like this:<br><br>Delete "$INSTDIR\webdav\tomcat.gif"<br>Delete "$INSTDIR\webdav\tomcat-power.gif"<br>Delete "$INSTDIR\webdav\index.html"<br>Delete "$INSTDIR\webdav\WEB-INF\web.xml"<br>RMDir "$INSTDIR\webdav\WEB-INF"<br>RMDir "$INSTDIR\webdav"<br>Delete "$INSTDIR\tomcat-docs\index.html"<br>RMDir "$INSTDIR\tomcat-docs"<br>...<br><br>Philippe</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">YooperNC</span><br><span class="post-time small text-muted">30th March 2004 14:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Nowhere in the documentation do I see a "/REBOOTOK" for RMDir. Also, I have tried all combinations of "RMDir /r ...", "Delete /REBOOTOK ...", etc., and nothing has worked. Even after rebooting the OS, the files are still there. I get the subdirectory from the registry just fine with:<br><br>ReadRegStr $R6 HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${MUI_PRODUCT_NAME}" \<br>"UninstallVideoLoc"<br><br>I've tried:<br><br>Delete "$R6\*.*"<br>Delete /REBOOTOK "$R6\*.mpg" ; still there after reboot<br>RMDir /r "$R6"<br>RMDir /r $R6 ; thinking the quotes were causing a problem<br><br>I am able to remove other directories, namely $INSTDIR, but this one is being stubborn. My collegues and I are stumped. Has anyone else had luck removing files that are not in the $INSTDIR (for example)? If so, can you share some insight? Thanks!<br><br>Dave</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">deguix</span><br><span class="post-time small text-muted">30th March 2004 14:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hmmm... nowhere... What NSIS version are you using?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pengyou</span><br><span class="post-time small text-muted">30th March 2004 15:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">YooperNC wrote:<br><br>&gt;&gt;I'm using the latest full release of NSIS, 2.0.&lt;&lt;<br>&gt;&gt;Nowhere in the documentation do I see a "/REBOOTOK" for RMDir.&lt;&lt;<br><br>From the NSIS 2.0 manual:<br><br>4.9.1.8 RMDir<br>[/r|/REBOOTOK] directory_name<br>Remove the specified directory (which should be a full path). Without /r, the directory will only be removed if it is completely empty. If /r is specified, the directory will be removed recursively, so all directories and files in the specified directory will be removed. If /REBOOTOK is specified, and the directory cannot be overwritten, then the directory will be deleted when the system reboots -- if the directory will be removed on a reboot, the reboot flag will be set. The error flag is set if the directory cannot be removed.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">YooperNC</span><br><span class="post-time small text-muted">30th March 2004 20:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok. Now I see that /REBOOKOK was added to RMDir. Thanks for the clarification.<br><br>But that still doesn't help me out. Like I said, I've tried all manner of combinations and permutations of the parameters, and nothing gets rid of these files. At one point, I noticed that the files contained within this directory were "Read-Only". However, removing this attribute made no difference.<br><br>Could it be a problem that I'm running on Windows XP? (I could blame Bill Gates, then)<br><br>I could always just tell the user to delete the files after Uninstallation is complete, but I'd rather not.<br><br>Thanks to all for your time.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">30th March 2004 20:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It should work fine. Please post relevant script code and details.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">YooperNC</span><br><span class="post-time small text-muted">31st March 2004 21:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Here's the script that I'm executing:<br><br>ReadRegStr $R6 HKLM \<br>"Software\Microsoft\Windows\CurrentVersion\Uninstall\${MUI_PRODUCT_NAME}" \<br>"UninstallVideoLoc"<br>RMDir /r $R6<br>Sleep "200"<br><br>I've placed a MessageBox between the ReadRegStr and the RMDir, so I know that $R6 has exactly what I expect in it. I have also tried this:<br><br>ReadRegStr $R6 HKLM \<br>"Software\Microsoft\Windows\CurrentVersion\Uninstall\${MUI_PRODUCT_NAME}" \<br>"UninstallVideoLoc"<br>Delete /REBOOTOK "$R6\*.*"<br>Sleep "200"<br><br>Each time, the files are still there. $R6 is:<br><br>C:\Video Files\test<br><br>This subdirectory contains the following files:<br><br>b281_20021230_162454.mpg<br>b281_20030103_124700.mpg<br>b281_20030109_142723.mpg<br>b281_20030225_095223.mpg<br>b281_20030226_102234.mpg<br>c122_20021222_090342.mpg<br>c353_20030305_161208.mpg<br>c353_20030309_000920.mpg<br>c353_20030309_004436.mpg<br><br>There's nothing wrong with this directory string that I can tell. And the files are nothing more than random video files varying in size from 19KB to 102KB. They are not read-only, so no use asking that question.<br><br>I've also placed "ClearErrors" and "IfErrors" around the RMDir and Delete commands, but no errors are set. It just goes along thinking that it did its job.<br><br>We're all stumped here. This problem defies logic and reason. If you have some time and like solving tough problems, feel free to create a subdirectory like the one above, fill it with some files, and put those script lines in your Uninstall section. I'd be very interested to hear your results. Thanks!<br><br>Dave</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">31st March 2004 21:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The files are either in use or you have a wrong directory name.<br><br>Try to add it manually (without the registry key) and make sure the directory is valid.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">2nd April 2004 05:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That registry key probably contains a line break, quotes or a space. Use</p><pre>
<code>MessageBox MB_OK *$R6*</code>
</pre>and make sure nothing is between the unquoted path and the asterisks.<br><br>A similar case is presend in the FAQ:<br><a href="http://nsis.sourceforge.net/support/faq_item/?id=19&amp;backPID=15&amp;tx_faq_faq=20" target="_blank">http://nsis.sourceforge.net/support/...&amp;tx_faq_faq=20</a></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>