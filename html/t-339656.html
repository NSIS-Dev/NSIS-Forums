<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Modify sections at runtime via external config file" />

  <title>Modify sections at runtime via external config file - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Modify sections at runtime via external config file</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=339656">Modify sections at runtime via external config file</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">BreezeUADN</span><br />
      <span class="post-time small text-muted">19th December 2011 12:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Modify sections at runtime via external config file</strong><br />
      Hi, I've been looking for a simple solution for such situation:<br />
      there is a formed components structure filled with SectionGroups and Sections which is set in stone after compilation, but I need an option to remove some sections (at runtime) based on some external list, placed somewhere near setup executable.<br />
      The only solution I can think of is <a href="http://nsis.sourceforge.net/Set_section_names_according_ini_file" target="_blank">reading an .ini</a> file with such a list and marking those sections with unselected+hidden attributes... Probably there is a better solution, what do you think?<br />
      (the basic idea is to remove or unrestrict some components from installation based on an external "license" file - instead of creating various setup packages there will be just one, but with this feature...)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">BreezeUADN</span><br />
      <span class="post-time small text-muted">20th December 2011 04:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Another solution I have in mind is NSIS sources modification. Customized TreeView on the MUI_PAGE_COMPONENTS should do the trick...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">20th December 2011 06:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by BreezeUADN</small><br />
        Probably there is a better solution, what do you think?
      </blockquote>Why do you think there is a better solution? Your solution is exactly the way to do it. What's wrong with it?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">BreezeUADN</span><br />
      <span class="post-time small text-muted">20th December 2011 10:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Awww I just have a feeling that I'm "doing it wrong"... Well atm. it looks like this:<br />
      <br />
      license.lic (no true/false analysis yet - maybe will add more options instead of bool)<br />
      [allowed]<br />
      Gate = true<br />
      Gate Client = true<br />
      Gate Server = true<br />
      ...<br />
      <br /></p>
      <pre>
<code><br />!include "installerSections.nsh"<br />;--- фильтрация секций по файлу лицензии ---<br />Function FilterSections<br />  ${For} $R1 0 ${SECTIONCOUNT}<br />    SectionGetText $R1 $R2<br />    ReadINIStr $R0 ${LicensePath} "allowed" "$R2"<br />    StrCmp $R0 "" +3 0 ;если секция не найдена, переход на следующую, иначе: <br />      SectionSetFlags $R1 16 ;0+16 = снять выделение + ридонли<br />      SectionSetText $R1 "" ;скрыть<br />  ${Next}<br />FunctionEnd<br />;------<br /></code>
</pre><br />
      ${LicensePath} is defined as a result of OpenFileDialog which I call on my custom page, where I call this FilterSections inside of Validate part.<br />
      (installerSections.nsh and SECTIONCOUNT is formed by my helper program that allows to visually compose section tree from xml templates)<br />
      <br />
      The problem is that I had limited time to get acquainted with NSIS so probably many many things can be done in a much more optimal way, thus the doubts...
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">20th December 2011 17:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, that looks pretty good to me. Looks like you've got a better grasp of NSIS than you think. However, you should probably use the macros in NSIS\Include\Sections.nsh, instead of calling SectionSetFlags directly. Right now, you're throwing away all the other section flags just to set flag 0 and 16.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
