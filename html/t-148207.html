<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Newbie Help with RegKey" />

  <title>Newbie Help with RegKey - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Newbie Help with RegKey</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=148207">Newbie Help with RegKey</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LucasXX</span><br />
      <span class="post-time small text-muted">5th September 2003 12:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Newbie Help with RegKey</strong><br />
      Hi I'm haveing a problem, I'm trying to detect a registry key to see if it exist, but what ever combination I try I can't get it to work<br />
      <br />
      ReadRegStr $0 HKLM "Software\game\software" "Install Path"<br />
      ???????????? continue<br />
      MessageBox MB_ICONINFORMATION|MB_OK "Registry path can not be found"<br />
      Abort<br />
      continue:<br />
      <br />
      <br />
      All I would like it to do is if the registry key exist to continue, if it doesn't then I would like it to abort, but I just don't know what the lines should be, I have try looking through the archive and docs and the forum, but what ever combination I do it won't work<br />
      <br />
      I know it has to be in the Function .oninit, but I ca'nt cet it to work.<br />
      <br />
      I have try the Archive IfKeyExists Macro, but all I get is<br />
      <br />
      IfKeyExists not inuse or something like that<br />
      <br />
      I would be gratefull for your help<br />
      <br />
      Thank you</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th September 2003 12:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">IfKeyExists from the archive is the way to go if you want to check if the key exists. But as it seems, all you need is to know if the value inside it is valid. For that, simply compare it to "" using StrCmp. You can also use <a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.1.21" target="_blank">InstallDirRegKey</a>.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LucasXX</span><br />
      <span class="post-time small text-muted">5th September 2003 14:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This seems to work, could someone confirm that it's correct and I'm right please<br />
      <br />
      Thank you<br />
      <br />
      Function .onInit<br />
      ReadRegStr $0 HKLM "SOFTWARE\game\software" "Install Path"<br />
      StrCmp $0 "" 0 continue<br />
      MessageBox MB_ICONINFORMATION|MB_OK "Registry path can not be found"<br />
      Abort<br />
      continue:<br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th September 2003 15:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, that's a good way. But if you want to use $0 later to fill $INSTDIR you should use <a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.1.21" target="_blank">InstallDirRegKey</a> and check if $INSTDIR is empty in .onInit. It will also make sure the installation path is valid and not just not empty.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LucasXX</span><br />
      <span class="post-time small text-muted">5th September 2003 15:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok I have this<br />
      <br />
      Oh I should add that this is a upgrade for some files and not a exe application<br />
      <br />
      InstallDir "$INSTDIR"<br />
      InstallDirRegKey HKLM "Software\game\software" "Install Path"<br />
      <br />
      but how would I put $INSTDIR into the .oninit ?<br />
      <br />
      you see I don't want it to be installed to anyother DIR if the Reg key doesn't exist.<br />
      <br />
      I have read the InstallDirRegKey as you stated but I don't quite understand it</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th September 2003 15:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm sorry, I've mixed up. InstallDirRegKey checks if it's empty for you:<br />
      <br /></p>

      <blockquote>
        If this attribute is present, it will override the InstallDir attribute if the registry key is valid, otherwise it will fall back to the InstallDir default.
      </blockquote>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LucasXX</span><br />
      <span class="post-time small text-muted">5th September 2003 15:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">so is my little bit of script fine then?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th September 2003 15:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">No. InstallDir sets $INSTDIR, you can't tell it to set it to its self. You must provide a default or provide nothing. If you want to abort the installation if that regkey doesn't exist just use this:<br />
      <br />
      InstallDirRegKey HKLM "Software\game\software" "Install Path"<br />
      Function .onInit<br />
      StrCmp $INSTDIR "" 0 ok<br />
      MessageBox MB_OK "error..."<br />
      Abort<br />
      ok:<br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LucasXX</span><br />
      <span class="post-time small text-muted">5th September 2003 15:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">so what if I put<br />
      <br />
      Var GAMEDIR<br />
      <br />
      Section "-InstallDir"<br />
      ReadRegStr $GAMEDIR HKLM "Software\game\software"<br />
      StrCpy $INSTDIR "$GAMEDIR"<br />
      SectionEnd<br />
      <br />
      InstallDir "$INSTDIR"<br />
      InstallDirRegKey HKLM "Software\game\software" "Install Path"<br />
      <br />
      and then<br />
      <br />
      Function .onInit<br />
      StrCmp $INSTDIR "" 0 ok<br />
      MessageBox MB_OK "error..."<br />
      Abort<br />
      ok:<br />
      FunctionEnd<br />
      <br />
      will this work</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th September 2003 15:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Why would you want to do that? Just use the script I gave you.<br />
      <br />
      This line means nothing:<br />
      InstallDir "$INSTDIR"<br />
      <br />
      This line is missing a parameter:<br />
      ReadRegStr $GAMEDIR HKLM "Software\game\software"<br />
      <br />
      If you don't use InstallDir, InstallDirRegKey will put the value from the registry and if it's not there or the value is invalid, it'll put nothing in it. That's what you should use, my script.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LucasXX</span><br />
      <span class="post-time small text-muted">5th September 2003 15:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ok then thanks, won't bother you again :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LucasXX</span><br />
      <span class="post-time small text-muted">5th September 2003 15:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry about this I know I said I wouldn't bother you again,<br />
      <br />
      so what would happen if I removed the line InstallDir<br />
      <br />
      is InstallDirRegKey used instead?<br />
      <br />
      Or do I have to have InstallDir line in the script<br />
      <br />
      I only ask because if I have InstallDir "$PROGRAMFILES\game" it overrides the InstallDirRegKey and the Function .oninit script you supplied doesn't check if the install path is valid, if I delete the Regkey from the registry is will still install, which I don't want it to do.<br />
      <br />
      or could I put InstallDir ""<br />
      <br />
      if not what do I put so it will not override InstallDirRegKey?<br />
      <br />
      Sorry but it can be confusing and my apologise as you have been very patient so far.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LucasXX</span><br />
      <span class="post-time small text-muted">5th September 2003 19:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi just wondered if anyone could answer my question</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th September 2003 20:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">As the quote said InstallDirRegKey overrides InstallDir if the key exists and contains a valid path. If you have InstallDir in your script it will fall back to whatever you've defined using InstallDir instead to "" as you wish.<br />
      <br />
      You should simply not use InstallDir.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LucasXX</span><br />
      <span class="post-time small text-muted">5th September 2003 20:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
