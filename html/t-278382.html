<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Help me pick an installer example"><title>Help me pick an installer example - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Help me pick an installer example</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=278382">Help me pick an installer example</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">torpark</span><br><span class="post-time small text-muted">6th October 2007 17:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Help me pick an installer example</strong><br>I'm trying to build an installer that does the following. Are there any good examples out there? All I see is a sea of them.<br><br>1. Check and see if there was a prior installation, if so, allow install ontop, or uninstall the whole installation.<br>2. Ask for directory of installation<br>3. Ask some settings questions<br>4. Execute some file create, move, delete<br>5. Run another MUI page to determine some system settings and give the user option for input.<br>6. User enters serial code, we check it online.<br>7. Exit</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">torpark</span><br><span class="post-time small text-muted">8th October 2007 01:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">bump</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">8th October 2007 01:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I don't think there's a standalone example with those tasks. I will try to help you.<br><br>1. To check you can try ReadRegStr to find registry entries of past installers.<br>2. Use Page directory, or build your own with InstallOptions or nsDialogs.<br>3. Again, build your pages with above pluigns.<br>4. Exec, ExecShell<br>5. ?<br>6. Again, build your page and use InetLoad.<br>7. Close.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">torpark</span><br><span class="post-time small text-muted">8th October 2007 23:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">We aren't using the registry whatsoever. I already have the inetload code we need. Now what I really need is an example installer that asks where the program should be installed, and perhaps has an extra page or uninstall function inside it.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">9th October 2007 00:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Pretty much every installer out there asks for the installation directory. Starting from Examples\example1.nsi, through cool examples like primes.nsi ranging all the way to full <a href="http://nsis.sourceforge.net/Simple_installer_with_JRE_check" target="_blank">blown examples</a> on the Wiki. As Joel said, all you need is Page directory or MUI_PAGE_DIRECTORY.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">torpark</span><br><span class="post-time small text-muted">15th October 2007 09:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I used some examples to patch together a rudimentary installer. Now I need to add a custom page and custom code i've already made up from another installer. Can anyone help me mate the code to my installer?<br><br>I've written some code that automatically checks for proxy information on the machine. It also allows the user to enter in HTTP and HTTPS proxy information, and later ask for a password when in use. I had an old ini page for it but made up a new one, since it needs much fewer options.<br><br>I am highly motivated to finish this in the next 24 hours, and I would be willing to compensate someone who is expert to take on the task themselves.<br><br></p><pre>
<code><br>;--------------------------------<br>!include "MUI.nsh"<br>!define PROGRAM_NAME "Program"<br>!define PROGRAM_EXE "Program.exe"<br>!define INSTALLATION_DIR "$PROGRAMFILES\Program"<br>!define COMPANY_NAME "Company"<br>; The name of the installer<br>Name "${COMPANY_NAME}"<br><br>; The file to write<br>OutFile "${COMPANY_NAME}.exe"<br><br>; The default installation directory<br>CRCCheck on<br>InstallDir ${INSTALLATION_DIR}<br>ShowInstDetails show<br>LicenseText "${COMPANY_NAME} License Agreement"<br>LicenseData "license.txt"<br>XPStyle on<br><br>;--------------------------------<br><br>; Pages<br><br>Page license<br>Page directory<br>Page instfiles<br>;Modified Finish Page<br>  !define MUI_PAGE_CUSTOMFUNCTION_PRE fin_pre<br>  !define MUI_PAGE_CUSTOMFUNCTION_SHOW fin_show<br>  !define MUI_PAGE_CUSTOMFUNCTION_LEAVE fin_leave<br>  !define MUI_FINISHPAGE_SHOWREADME "${NSISDIR}\Docs\Modern UI\Changelog.txt"<br>  !define MUI_FINISHPAGE_RUN<br>  !define MUI_FINISHPAGE_RUN_FUNCTION Desc_ShortCut<br>  !define MUI_FINISHPAGE_RUN_TEXT "Create Desktop Shortcut"<br>  !insertmacro MUI_PAGE_FINISH<br>  !insertmacro MUI_UNPAGE_WELCOME<br>  !insertmacro MUI_UNPAGE_CONFIRM<br>  !insertmacro MUI_UNPAGE_INSTFILES<br>  !insertmacro MUI_UNPAGE_FINISH<br><br>;--------------------------------<br>;Languages<br><br>  !insertmacro MUI_LANGUAGE "English"<br><br><br><br>; The stuff to install<br>Section "" ;No components page, name is not important<br>  <br>        SetOutPath $INSTDIR\temp ; temporarily set output path temp dir to extract the data.<br>        File data.zip ;extract the data to install<br>        ZipDLL::extractall "$INSTDIR\temp\data.zip" "$INSTDIR" ;extract all the files in data<br>        SetOutPath $INSTDIR ; set output path temp dir to extract the data.  <br>        Delete "$INSTDIR\temp\data.zip"; remove the temp file once it was all installed.<br>        RMDir "$INSTDIR\temp" ;remove the temp dir<br>   <br>SectionEnd ; end the section<br><br>;------------------<br>;Functions<br>Function Desc_Shortcut<br>SetOutPath "$INSTDIR"<br>CreateShortCut "$DESKTOP\${PROGRAM_NAME}.lnk" "$INSTDIR\${PROGRAM_EXE}"<br>FunctionEnd<br><br>Function fin_show<br>ReadINIStr $0 "$PLUGINSDIR\iospecial.ini" "Field 6" "HWND"<br>SetCtlColors $0 0x000000 0xFFFFFF<br>FunctionEnd<br><br>Function fin_pre<br>WriteINIStr "$PLUGINSDIR\iospecial.ini" "Settings" "NumFields" "6"<br>WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 6" "Type" "CheckBox"<br>WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 6" "Text" "&amp;Create Quicklaunch Shortcut"<br>WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 6" "Left" "120"<br>WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 6" "Right" "315"<br>WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 6" "Top" "130"<br>WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 6" "Bottom" "140"<br>WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 6" "State" "1"<br>FunctionEnd<br><br>Function fin_leave<br>ReadINIStr $0 "$PLUGINSDIR\iospecial.ini" "Field 6" "State"<br>StrCmp $0 "0" end<br>SetOutPath "$INSTDIR"<br>CreateShortCut "$QUICKLAUNCH\my program.lnk" "$INSTDIR\makensisw.exe"<br>end:<br>FunctionEnd<br></code>
</pre><br>
      <br>
      And this is the INI<br>
      <br>
      <pre>
<code><br> Ini file generated by the HM NIS Edit IO designer.<br>[Settings]<br>NumFields=15<br>Title=XeroBank Configuration Wizard<br>CancelShow=1<br>CancelButtonText=&amp;Cancel<br>NextButtonText=&amp;Generate<br><br>[Field 1]<br>Type=Groupbox<br>Text=Internet Settings<br>Left=20<br>Right=260<br>Top=0<br>Bottom=68<br>Flags=NOTABSTOP<br><br>[Field 2]<br>Type=Groupbox<br>Text=Proxy Settings<br>Left=20<br>Right=260<br>Top=70<br>Bottom=140<br>Flags=NOTABSTOP|DISABLED<br><br>[Field 3]<br>Type=Label<br>Text=HTTP Proxy:<br>Left=32<br>Right=76<br>Top=86<br>Bottom=96<br>Flags=NOTABSTOP|DISABLED<br><br>[Field 4]<br>Type=Text<br>State=IP Address<br>Left=99<br>Right=171<br>Top=83<br>Bottom=96<br>MaxLen=256<br>Flags=DISABLED<br><br>[Field 5]<br>Type=Text<br>State=Port<br>Left=174<br>Right=201<br>Top=83<br>Bottom=96<br>MaxLen=5<br>Flags=DISABLED|ONLY_NUMBERS<br><br>[Field 6]<br>Type=Checkbox<br>Text=Requires Username &amp;&amp; Password<br>Left=87<br>Right=204<br>Top=97<br>Bottom=109<br>Flags=DISABLED<br><br>[Field 7]<br>Type=Label<br>Text=HTTPS Proxy:<br>Left=32<br>Right=79<br>Top=113<br>Bottom=123<br>Flags=NOTABSTOP|DISABLED<br><br>[Field 8]<br>Type=Text<br>MaxLen=256<br>State=IP Address<br>Left=99<br>Right=171<br>Top=113<br>Bottom=124<br>Flags=DISABLED<br><br>[Field 9]<br>Type=Text<br>MaxLen=5<br>State=Port<br>Left=174<br>Right=202<br>Top=113<br>Bottom=124<br>Flags=DISABLED|ONLY_NUMBERS<br><br>[Field 10]<br>Type=Checkbox<br>Text=Requires Username &amp;&amp; Password<br>Left=87<br>Right=202<br>Top=128<br>Bottom=137<br>Flags=DISABLED<br><br>[Field 11]<br>Type=Button<br>Text=Auto-Detect<br>Left=205<br>Right=255<br>Top=83<br>Bottom=136<br>Flags=DISABLED|NOTIFY<br><br>[Field 12]<br>Type=RadioButton<br>Text=Direct Connection<br>Left=44<br>Right=119<br>Top=32<br>Bottom=42<br><br>[Field 13]<br>Type=RadioButton<br>Text=Network Proxy<br>Left=44<br>Right=119<br>Top=48<br>Bottom=58<br><br>[Field 14]<br>Type=Label<br>Text=How do you connect to the internet?<br>Left=30<br>Right=146<br>Top=16<br>Bottom=24<br><br>[Field 15]<br>Type=Label<br>Text=(Most Users)<br>Flags=NOTABSTOP<br>Left=120<br>Right=159<br>Top=32<br>Bottom=40<br></code>
</pre><br>
      <br>
      And here is the old installer code we want to mate to this new INI and installer:<br>
      <br>
      <pre>
<code><br>  !include "MUI.nsh"<br><br>;---------------------<br>;includes<br>  !include "LogicLib.nsh"<br>  !include "WordFunc.nsh"<br>        !insertmacro WordFind<br>        !insertmacro WordFind2x<br>        !insertmacro WordReplace<br><br>;----------------------<br>;MUI defines<br><br>  !define BROWSERNAME "xBBrowser"<br>  !define MAILCLIENTNAME "xBMail"<br>  !define UIDISABLEWARNING "Field 2"<br>  !define UIDISABLESPLASH "Field 3"<br>  !define UIDISABLETOR "Field 4"<br>  !define UIWAITFORCIRCUIT "Field 5"<br>  !define UIPROXYREQ "Field 6"<br>  !define UIDEBUGON "Field 7"<br>  <br>  !define UITORBOX "Field 8"<br>  <br>  !define UICIRCUITLABEL "Field 9"<br>  !define UICONTROLLABEL "Field 11"<br>  !define UISOCKSLABEL "Field 13"<br>  !define UITORCOMLABEL "Field 15"<br>  <br>  !define UITORTIMEOUT "Field 10"<br>  !define UICONTROLPORT "Field 12"<br>  !define UISOCKSPORT "Field 14"  <br>  !define UITORCOMMANDS "Field 16"<br>  !define UIDELDIRDATA "Field 17"<br>  <br>  !define UIIPADDRESS1 "Field 20"<br>  !define UIPORT1 "Field 21"<br>  !define UIREQAUTH1 "Field 22"<br>  <br>  !define UIIPADDRESS2 "Field 24"<br>  !define UIPORT2 "Field 25"<br>  !define UIREQAUTH2 "Field 26"<br>  <br>  !define UIAUTODETECT "Field 27"<br>  !define UIHTTPLABEL "Field 19"<br>  !define UIHTTPSLABEL "Field 23"<br>  <br><br>;--------------------------------<br>;General<br><br>  ;Name and file<br>!define NAME "xBConfig"<br>  Name "XeroBank Configuration Wizard"<br>  OutFile "xBConfig.exe"<br><br>  ;Default installation folder<br>  InstallDir "$EXEDIR\.."<br>  <br>  ;Get installation folder from registry if available<br><br>;--------------------------------<br>;Pages<br><br>  Page custom InitPage LeavePage<br> <br>;--------------------------------<br>;Interface Settings<br><br>  !define MUI_ABORTWARNING<br>  <br>;--------------------------------<br>;Languages<br>  !insertmacro MUI_LANGUAGE "English"<br><br>;--------------------------------<br>;Reserve Files<br>  <br>  ;If you are using solid compression, files that are required before<br>  ;the actual installation should be stored first in the data block,<br>  ;because this will make your installer start faster.<br>  <br>  ReserveFile "xBConfig.ini"<br>  !insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br><br>;--------------------------------<br>;Variables<br>Icon "${NAME}.ico"<br>VAR DISABLEWARNING<br>VAR DISABLESPLASH<br>VAR DISABLETOR<br>VAR WAITFORCIRCUIT<br>VAR DEBUGON<br><br>VAR TORTIMEOUT<br>VAR CONTROLPORT<br>VAR SOCKSPORT<br>VAR TORCOMMANDS<br>VAR DELDIRDATA<br><br>VAR IPADDRESS1<br>VAR PORT1<br>VAR REQAUTH1  <br>VAR IPADDRESS2<br>VAR PORT2<br>VAR REQAUTH2<br>VAR PROXYREQ<br><br>VAR HTTPPROXY<br>VAR HTTPSPROXY<br><br><br><br><br>Var tmp<br>Var tmpstate ; holds the value of the state<br>Var tmpstate2<br>Var tmphwnd ; holds the hwnd of the element<br><br>;reads the hwnd from the ini file and sets the state of the element<br>!macro CHANGEELEMENT ELEMENT STATEVAL<br>  !insertmacro MUI_INSTALLOPTIONS_READ $tmphwnd "xBConfig.ini" "${ELEMENT}" "HWND"<br>        EnableWindow $tmphwnd ${STATEVAL}<br><br>  ; Put state change in flags of element as well<br>        !insertmacro MUI_INSTALLOPTIONS_READ $tmp "xBConfig.ini" "${ELEMENT}" "Flags"<br>        ${If} "${STATEVAL}" == "1"<br>          ${WordReplace} $tmp "DISABLED" "" "+" $tmp<br>                ${WordReplace} $tmp "||" "|" "+" $tmp<br>                !insertmacro MUI_INSTALLOPTIONS_WRITE "xBConfig.ini" "${ELEMENT}" "Flags" $tmp<br>        ${Else}<br>    !insertmacro MUI_INSTALLOPTIONS_READ $tmp "xBConfig.ini" "${ELEMENT}" "Flags"<br>                !insertmacro MUI_INSTALLOPTIONS_WRITE "xBConfig.ini" "${ELEMENT}" "Flags" "$tmp|DISABLED"<br>        ${EndIf}<br>        <br>        <br>        <br>!macroend<br><br>;change the state of a group of elements<br>!macro CHANGEGROUPSTATE STATEVALUE<br><br>  !insertmacro CHANGEELEMENT "${UIIPADDRESS1}" "${STATEVALUE}"<br>  !insertmacro CHANGEELEMENT "${UIPORT1}" "${STATEVALUE}"<br>  !insertmacro CHANGEELEMENT "${UIREQAUTH1}" "${STATEVALUE}"<br>  !insertmacro CHANGEELEMENT "${UIIPADDRESS2}" "${STATEVALUE}"<br>  !insertmacro CHANGEELEMENT "${UIPORT2}" "${STATEVALUE}"<br>  !insertmacro CHANGEELEMENT "${UIREQAUTH2}" "${STATEVALUE}"<br>  !insertmacro CHANGEELEMENT "${UIAUTODETECT}" "${STATEVALUE}"<br>  !insertmacro CHANGEELEMENT "${UIHTTPLABEL}" "${STATEVALUE}"<br>  !insertmacro CHANGEELEMENT "${UIHTTPSLABEL}" "${STATEVALUE}"<br>        <br>!macroend<br><br>!macro CHANGEGROUPSTATE2 STATEVALUE<br>        !insertmacro CHANGEELEMENT "${UITORTIMEOUT}" "${STATEVALUE}"<br>        !insertmacro CHANGEELEMENT "${UISOCKSPORT}" "${STATEVALUE}"<br>        !insertmacro CHANGEELEMENT "${UICONTROLPORT}" "${STATEVALUE}"<br>        !insertmacro CHANGEELEMENT "${UICIRCUITLABEL}" "${STATEVALUE}"<br>        !insertmacro CHANGEELEMENT "${UICONTROLLABEL}" "${STATEVALUE}"<br>        !insertmacro CHANGEELEMENT "${UISOCKSLABEL}" "${STATEVALUE}"<br>        !insertmacro CHANGEELEMENT "${UITORCOMLABEL}" "${STATEVALUE}"<br>        !insertmacro CHANGEELEMENT "${UITORCOMMANDS}" "${STATEVALUE}"<br>        !insertmacro CHANGEELEMENT "${UIDELDIRDATA}" "${STATEVALUE}"<br>!macroend<br><br>;change text field and put value in ini file<br>!macro CHANGETEXTFIELD ELEMENT VALUE<br>  !insertmacro MUI_INSTALLOPTIONS_WRITE ${VALUE} "xBConfig.ini" "${ELEMENT}" "State"<br>  !insertmacro MUI_INSTALLOPTIONS_READ $tmp "xBConfig.ini" "${ELEMENT}" "HWND"<br>        SendMessage $tmp ${WM_SETTEXT} 0 "STR:${VALUE}"<br>!macroend<br><br>;--------------------------------<br>;Installer Sections<br><br>Section "Dummy Section" SecDummy<br><br>  SetOutPath "$INSTDIR"<br>  <br>  ;ADD YOUR OWN FILES HERE...<br>  <br>  ;Store installation folder<br> <br>SectionEnd<br><br>;--------------------------------<br>;Installer Functions<br><br>Function .onInit<br><br>  ;Extract InstallOptions INI files<br>  !insertmacro MUI_INSTALLOPTIONS_EXTRACT "xBConfig.ini"<br>  <br>FunctionEnd<br><br>LangString TEXT_IO_TITLE ${LANG_ENGLISH} "XeroBank Configuration Wizard"<br>LangString TEXT_IO_SUBTITLE ${LANG_ENGLISH} "Generates XeroBank INI Files"<br><br>Function InitPage<br><br>  !insertmacro MUI_HEADER_TEXT "$(TEXT_IO_TITLE)" "$(TEXT_IO_SUBTITLE)"<br>  !insertmacro MUI_INSTALLOPTIONS_DISPLAY "xBConfig.ini"<br><br>FunctionEnd<br><br>Function LeavePage<br>  ; handle notify event of element<br>  !insertmacro MUI_INSTALLOPTIONS_READ $tmp "xBConfig.ini" "Settings" "State"     <br>        ${Switch} "Field $tmp"<br>    ${Case} "${UIPROXYREQ}"<br>      !insertmacro MUI_INSTALLOPTIONS_READ $tmpstate "xBConfig.ini" "${UIPROXYREQ}" "State"<br>                  !insertmacro CHANGEGROUPSTATE $tmpstate<br>                        Abort<br>        ${Case} "${UIAUTODETECT}"<br>                Call GetProxySettings<br><br>                        ;fill in ini-file and change text<br>                !insertmacro CHANGETEXTFIELD "${UIIPADDRESS1}" "$IPADDRESS1"<br>                !insertmacro CHANGETEXTFIELD "${UIPORT1}" "$PORT1"<br>                !insertmacro CHANGETEXTFIELD "${UIIPADDRESS2}" "$IPADDRESS2"<br>                !insertmacro CHANGETEXTFIELD "${UIPORT2}" "$PORT2"<br><br>                !insertmacro MUI_INSTALLOPTIONS_WRITE $IPADDRESS1 "xBConfig.ini" "${UIIPADDRESS1}" "State"<br>                !insertmacro MUI_INSTALLOPTIONS_WRITE $PORT1 "xBConfig.ini" "${UIPORT1}" "State"<br>                !insertmacro MUI_INSTALLOPTIONS_WRITE $IPADDRESS2 "xBConfig.ini" "${UIIPADDRESS2}" "State"<br>                !insertmacro MUI_INSTALLOPTIONS_WRITE $PORT2 "xBConfig.ini" "${UIPORT2}" "State"<br>                Abort<br><br>    ${Case} "${UIDISABLETOR}"<br>                    !insertmacro MUI_INSTALLOPTIONS_READ $tmpstate2 "xBConfig.ini" "${UIDISABLETOR}" "State"<br>                    ${If} $tmpstate2 == "1"<br>                       StrCpy $tmpstate2 "0"<br>                    ${Else}<br>                       StrCpy $tmpstate2 "1"<br>                    ${EndIf}<br>                    !insertmacro CHANGEGROUPSTATE2 $tmpstate2<br>                    Abort<br>        ${EndSwitch}<br>        <br>        !insertmacro MUI_INSTALLOPTIONS_READ $IPADDRESS1 "xBConfig.ini" "${UIIPADDRESS1}" "State"<br>        !insertmacro MUI_INSTALLOPTIONS_READ $PORT1 "xBConfig.ini" "${UIPORT1}" "State"<br>        !insertmacro MUI_INSTALLOPTIONS_READ $IPADDRESS2 "xBConfig.ini" "${UIIPADDRESS2}" "State"<br>        !insertmacro MUI_INSTALLOPTIONS_READ $PORT2 "xBConfig.ini" "${UIPORT2}" "State"<br>        !insertmacro MUI_INSTALLOPTIONS_READ $PROXYREQ "xBConfig.ini" "${UIPROXYREQ}" "State"<br>        !insertmacro MUI_INSTALLOPTIONS_READ $DISABLEWARNING "xBConfig.ini" "${UIDISABLEWARNING}" "State"<br>        !insertmacro MUI_INSTALLOPTIONS_READ $DISABLESPLASH "xBConfig.ini" "${UIDISABLESPLASH}" "State"<br>        !insertmacro MUI_INSTALLOPTIONS_READ $DISABLETOR "xBConfig.ini" "${UIDISABLETOR}" "State"<br>        !insertmacro MUI_INSTALLOPTIONS_READ $WAITFORCIRCUIT "xBConfig.ini" "${UIWAITFORCIRCUIT}" "State"<br>        !insertmacro MUI_INSTALLOPTIONS_READ $TORTIMEOUT "xBConfig.ini" "${UITORTIMEOUT}" "State"<br>        !insertmacro MUI_INSTALLOPTIONS_READ $CONTROLPORT "xBConfig.ini" "${UICONTROLPORT}" "State"<br>        !insertmacro MUI_INSTALLOPTIONS_READ $SOCKSPORT "xBConfig.ini" "${UISOCKSPORT}" "State"<br>        !insertmacro MUI_INSTALLOPTIONS_READ $REQAUTH1 "xBConfig.ini" "${UIREQAUTH1}" "State"<br>        !insertmacro MUI_INSTALLOPTIONS_READ $REQAUTH2 "xBConfig.ini" "${UIREQAUTH2}" "State"<br>        !insertmacro MUI_INSTALLOPTIONS_READ $DEBUGON "xBConfig.ini" "${UIDEBUGON}" "State"<br>        !insertmacro MUI_INSTALLOPTIONS_READ $TORCOMMANDS "xBConfig.ini" "${UITORCOMMANDS}" "State"<br>        !insertmacro MUI_INSTALLOPTIONS_READ $DELDIRDATA "xBConfig.ini" "${UIDELDIRDATA}" "State"<br><br>        <br>        ;       convert 1 = true, 0 = false<br>        ${If} $DISABLEWARNING = 1<br>                StrCpy $DISABLEWARNING "true"<br>                ${ElseIf} $DISABLEWARNING = 0<br>                        StrCpy $DISABLEWARNING "false"<br>        ${EndIf}<br>        <br>        ${If} $DISABLESPLASH = 1<br>                StrCpy $DISABLESPLASH "true"<br>                ${ElseIf} $DISABLESPLASH = 0<br>                        StrCpy $DISABLESPLASH "false"<br>        ${EndIf}<br>        <br>        ${If} $DISABLETOR = 1<br>                StrCpy $DISABLETOR "true"<br>                ${ElseIf} $DISABLETOR = 0<br>                        StrCpy $DISABLETOR "false"<br>        ${EndIf}<br>        <br>        ${If} $WAITFORCIRCUIT = 1<br>                StrCpy $WAITFORCIRCUIT "true"<br>                ${ElseIf} $WAITFORCIRCUIT = 0<br>                        StrCpy $WAITFORCIRCUIT "false"<br>        ${EndIf}<br>        <br>        ${If} $DELDIRDATA = 1<br>                StrCpy $DELDIRDATA "true"<br>                ${ElseIf} $DELDIRDATA = 0<br>                        StrCpy $DELDIRDATA "false"<br>        ${EndIf}<br><br>        <br>                ; TODO: save values to ini file/registry...<br>        ${If} $DEBUGON = 1              ;To create the log file, we need debugon to be written as 2, a 1 will just cause popups.<br>                StrCpy $DEBUGON 2<br>        ${EndIf}<br>        <br>        FileOpen $6 "$EXEDIR\..\XeroBank.ini" w<br>        FileWrite $6 ";Don't use Notepad to read or wite to this file. Use some other text editor like Wordpad. $\r"<br>        FileWrite $6 ";If you need to manually upgrade to XeroBank service, ServiceLevel 1 is XeroBank Basic, 2 is XeroBank Plus, and 3 is XeroBank Pro$\r"<br>        FileWrite $6 ";If upgrading to XeroBank Basic, put the XeroBank.key file in the \Data\XeroBank\ directory$\r" <br>        FileWrite $6 ";If you are manually adding your proxy credentials, then set the ProxyAuths like so: username:password$\r$\r"<br><br>;*************************************** Write the XeroBank Section *******************************<br>        FileWrite $6 "[XeroBank]$\r"<br>        FileWrite $6 "TorDirectory=App\tor$\r"<br>        FileWrite $6 "OutPath=App$\r"<br>        FileWrite $6 "TimerMax=$TORTIMEOUT$\r"<br>        FileWrite $6 "ServiceLevel=$\r"<br>        FileWrite $6 "WaitForTorCircuit=$WAITFORCIRCUIT$\r"<br>        FileWrite $6 "SubmissiveMode=$DISABLETOR$\r"<br>        FileWrite $6 "DeleteDirData=$DELDIRDATA$\r"<br>        FileWrite $6 "SOCKSPort=$SOCKSPort$\r"<br>        FileWrite $6 "ControlPort=$ControlPort$\r"<br>        FileWrite $6 "DebugOn=$DebugOn$\r"<br>        FileWrite $6 "TorCommands=$TorCommands$\r"<br>        FileWrite $6 "GnuPGPATHDIRECTORYApp\gpg$\r"<br>        FileWrite $6 "GnuPGHOMEDIRECTORY=Data\gpg$\r"<br>        <br>;****************************** Write the proxy data to the XeroBank section ***************************<br><br>        ${If} $PROXYREQ = 1 ;If there is a proxy, write out the proxy data<br>                FileWrite $6 "ProxyRequired=Yes$\r"<br>                ${If} $IPADDRESS1 != "IP Address"<br>                        FileWrite $6 "HttpProxyAddress=$IPADDRESS1$\r"<br>                        FileWrite $6 "HttpProxyPort=$PORT1$\r"<br>                        ${If} $REQAUTH1 = 1<br>                                FileWrite $6 "HttpProxyAuth=Ask$\r"<br>                                ${ElseIf} $REQAUTH1 = 0<br>                                        FileWrite $6 "HttpProxyAuth=No$\r"<br>                        ${EndIf}<br>                ${ElseIf} $IPADDRESS1 == "IP Address"<br>                        FileWrite $6 "HttpProxyAddress=$\r"<br>                        FileWrite $6 "HttpProxyPort=$\r"<br>                        FileWrite $6 "HttpProxyAuth=$\r"<br>                ${EndIf}<br>                ${If} $IPADDRESS2 != "IP Address"<br>                        FileWrite $6 "HttpsProxyAddress=$IPADDRESS2$\r"<br>                        FileWrite $6 "HttpsProxyPort=$PORT2$\r"<br>                        ${If} $REQAUTH2 = 1<br>                                FileWrite $6 "HttpsProxyAuth=Ask$\r"<br>                                ${ElseIf} $REQAUTH2 = 0<br>                                        FileWrite $6 "HttpsProxyAuth=No$\r"<br>                        ${EndIf}<br>                ${ElseIf} $IPADDRESS2 == "IP Address"<br>                        FileWrite $6 "HttpsProxyAddress=$\r"<br>                        FileWrite $6 "HttpsProxyPort=$\r"<br>                        FileWrite $6 "HttpsProxyAuth=$\r"<br>        ${EndIf}<br>                <br>        ${ElseIf} $PROXYREQ = 0         ;If there is no proxy, zero out the lines.<br>                FileWrite $6 "ProxyRequired=No$\r"<br>                FileWrite $6 "HttpProxyAddress=$\r"<br>                FileWrite $6 "HttpProxyPort=$\r"<br>                FileWrite $6 "HttpProxyAuth=$\r"<br>                FileWrite $6 "HttpsProxyAddress=$\r"<br>                FileWrite $6 "HttpsProxyPort=$\r"<br>                FileWrite $6 "HttpsProxyAuth=$\r"<br>        ${EndIf}<br><br>;******************************************** Now Write the Browser Prefs *********************<br>        FileWrite $6 "$\r"<br>        FileWrite $6 "[${BROWSERNAME}]$\r"<br>        FileWrite $6 "ProgramDirectory=App\Browser\firefox$\r"<br>        FileWrite $6 "ProgramExecutable=firefox.exe$\r"<br>        FileWrite $6 "ProfileDirectory=Data\Browser\profile$\r"<br>        FileWrite $6 "PluginsDirectory=Data\Browser\plugins$\r"<br>        FileWrite $6 "TempDirectory=App\Browser\temp$\r"<br>        FileWrite $6 "UserProfileDirectory=Data\Browser\userprofile$\r"<br>        FileWrite $6 "DisableSplashScreen=$DISABLESPLASH$\r"<br>        FileWrite $6 "DisableWarning=$DISABLEWARNING$\r"<br>        FileWrite $6 "SkipChromeFix=false$\r"<br>        FileWrite $6 "SkipCompregFix=false$\r"<br>        FileWrite $6 "LocalHomePage=$\r"<br>        <br>;******************************************** Now Write the Mail Prefs *********************<br>        FileWrite $6 "$\r"<br>        FileWrite $6 "[${MAILCLIENTNAME}]$\r"<br>        FileWrite $6 "ProgramDirectory=App\Mail\thunderbird$\r"<br>        FileWrite $6 "ProgramExecutable=thunderbird.exe$\r"<br>        FileWrite $6 "ProfileDirectory=Data\thunderbird\profile$\r"<br>        FileWrite $6 "PluginsDirectory=Data\thunderbird\plugins$\r"<br>        FileWrite $6 "TempDirectory=App\thunderbird\temp$\r"<br>        FileWrite $6 "UserProfileDirectory=Data\thunderbird\userprofile$\r"<br>        FileWrite $6 "DisableSplashScreen=$DISABLESPLASH$\r"<br>        FileWrite $6 "DisableWarning=$DISABLEWARNING$\r"<br>        FileWrite $6 "SkipChromeFix=false$\r"<br>        FileWrite $6 "SkipCompregFix=false$\r"<br>        <br>;********************************************* And now close the file **************************        <br>        FileClose $6<br>        <br>;       Firewall-Disabler::QueryFirewall<br>;       Pop $R0 <br>;       StrCmp $R0 "1" "" +2<br>;       Messagebox MB_OK "xBConfig has detected that the Windows Firewall is enabled.$\nIf you experience trouble with XeroBank software, try disabling it."<br>FunctionEnd<br><br>Function GetProxySettings<br>        ReadRegDWORD $R0 HKCU "Software\Microsoft\Windows\CurrentVersion\Internet Settings" ProxyEnable ;Check registry to see if proxy is enabled<br>        ${If} $R0 = 1 <br>                ReadRegStr $R0 HKCU "Software\Microsoft\Windows\CurrentVersion\Internet Settings" ProxyServer ;Read the proxy string from the reg.<br>                ${WordFind2X} "$R0" "http=" ";" "E+1" $3 ;Get http proxy data. if error, set to 1<br>                ${If} $3 != 1 ;If there is no error, do the following<br>                        StrCpy $HTTPPROXY $3<br>                        ${WordFind} "$HTTPPROXY" ":" "+1" $IPADDRESS1      <br>                        ${WordFind} "$HTTPPROXY" ":" "-1" $PORT1<br>                ${EndIf}<br>                ${WordFind2X} "$R0" "https=" ";" "E+1" $3 ;Get https proxy data. if error, set to 1<br>                ${If} $3 != 1 ;If there is no error, do the follwing:<br>                        StrCpy $HTTPSPROXY $3<br>                        ${WordFind} "$HTTPSPROXY" ":" "+1" $IPADDRESS2   ;Split it up<br>                        ${WordFind} "$HTTPSPROXY" ":" "-1" $PORT2<br>                ${EndIf}<br>        ${ElseIf} $R0 = 0<br>                MessageBox MB_OK "No Proxy Data Found. Assuming Direct Connection to Internet"<br>        ${EndIf}<br>FunctionEnd<br></code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">15th October 2007 10:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Please attach large scripts.<br>
      <br>
      One note is do not mix and match MUI pages with standard pages, i.e. do not use Page Directory, use !insertmacro MUI_PAGE_DIRECTORY.<br>
      <br>
      Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">torpark</span><br>
      <span class="post-time small text-muted">15th October 2007 20:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Okay good news. I've got it doing most of what I want it to do.<br>
      <br>
      X 0. Display the License<br>
      X 1. Install the program<br>
      X a. Ask the directory<br>
      X b. Create some temp files and extract<br>
      2. Get Proxy Information<br>
      X a. Firewall test<br>
      X b. Use It<br>
      X 3. Take serial number and download program using serial data.<br>
      a. Change box colors.<br>
      X 4. Create Icons.<br>
      <br>
      So we still have some issues.<br>
      <br>
      <b>How can I change the serial box colors?</b> (passdialog plugin)<br>
      <br>
      In the example below, the code changes the color. How do I do that with my code? How do I figure out the values?<br>
      <br></p>
      <pre>
<code><br>Name    "PassDialog InputBox"<br>OutFile "PassDialog-InputBox.exe"<br><br>## Include headers<br>!include MUI.nsh<br><br>## Pages<br> !insertmacro MUI_PAGE_WELCOME<br> Page Custom InputBoxPageShow InputBoxPageLeave<br> !insertmacro MUI_PAGE_COMPONENTS<br> !insertmacro MUI_PAGE_INSTFILES<br><br>## Password is<br>!define Password "blah"<br>!define Username "Jeff"<br><br>## Control ID's<br>!define IDC_INPUTBOX 1216<br><br>## Languages<br>!insertmacro MUI_LANGUAGE English<br><br>## Displays the input box dialog<br>Function InputBoxPageShow<br><br> !insertmacro MUI_HEADER_TEXT "Enter Details" "Enter your details."<br><br> PassDialog::InitDialog /NOUNLOAD InputBox /BOX "ja" "hello" 0<br>  Pop $R0 # Page HWND<br><br>  GetDlgItem $R1 $R0 ${IDC_INPUTBOX}<br>  SetCtlColors $R1 0xFF0000 0xFFFF00<br><br> PassDialog::Show<br><br>FunctionEnd<br><br>## Validate inpu<br>Function InputBoxPageLeave<br><br> ## Pop details from stack<br> Pop $R0<br><br> ## Display the details<br> MessageBox MB_OK|MB_ICONINFORMATION "You entered: $R0 !"<br><br>FunctionEnd<br><br>## Just a dummy section<br>Section 'A section'<br>SectionEnd<br></code>
</pre><br>
      <br>
      And here is my code for the serial box:<br>
      <br>
      <pre>
<code><br>Function InitPage<br><br>!insertmacro MUI_HEADER_TEXT "Upgrade xB Browser" "Enable XeroBank Plus Service"<br><br> PassDialog::Dialog Serial            \<br>                    /HEADINGTEXT 'Enter your XeroBank Transaction ID, displayed when you login at xerobank.com' \<br>                    /CENTER             \<br>                    /BOXDASH 12  50 4 '' \<br>                    /BOXDASH 72  50 4 ''  \<br>                    /BOXDASH 132 50 4 ''   \<br>                    /BOX         192 50 4 ''    \<br>                    <br><br>  Pop $R0 # success, back, cancel or error<br><br>FunctionEnd<br></code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">15th October 2007 21:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Notice the InitDialog and Show calls and what is in between.<br>
      <br>
      Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">torpark</span><br>
      <span class="post-time small text-muted">15th October 2007 21:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The ${IDC_INPUTBOX} however, is from up above. And that seems to make all the difference in the world. What would be the corresponding !define Control ID(s) and # for the serial boxes?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">16th October 2007 08:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I believe it tells you in the readme file.<br>
      <br>
      Stu</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>