<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="NSISdl macros" />

  <title>NSISdl macros - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">NSISdl macros</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=145147">NSISdl macros</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">8th August 2003 16:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>NSISdl macros</strong><br />
      I was using NSISdl to download multiple files throughout my installer, so I figured that it would be easier to make a macro (with error/success/cancel messages and all) without having to repeat the same code so many times (in different functions/sections).<br />
      <br />
      I've attached it below, any suggestions, comments, or changes would be much appreciated.<br />
      <br />
      I'm not sure if there are any similar macros to my ones, but it would be cool if it was included with NSIS :)<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">8th August 2003 16:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Looks nice. Maybe think of something better instead of run-time URL splitting.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">8th August 2003 16:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It fitted what I needed, but what woud you mean by that?<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">8th August 2003 16:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You are splitting parameters on run-time, that adds size to the installer.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">8th August 2003 17:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">How would I be able to go about this?<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">14th August 2003 21:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, so I should use !system, and split the string on compile time, rather than on runtime. Will this work?<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">14th August 2003 22:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That's indeed better.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">14th August 2003 22:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, I have no idea how to use !system, or split a string on compile time (using NSIS script)<br />
      <br />
      Help would be much appreciated.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">15th August 2003 00:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Is difficult to explain. [<font color="red">EDITED</font>]Have to be much changes in your macros, is too much confuse. I don't make a better function now because I don't have a "my computer" (using only public computers).<br />
      <br />
      Is better look the new version of function "Detect System Language" that I will launch tomorrow, I will use macros to don't use any space when you don't need the function and some other useful great features...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">15th August 2003 11:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The simplest way would probably be letting the user push the URLs instead of supplying them as an argument to the macro. Use something like:<br />
      <br />
      START_URLS<br />
      Push url<br />
      Push url2<br />
      ...<br />
      END_URLS<br />
      <br />
      START_URLS should push a certain string that will specify the end of the URLs list.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">15th August 2003 11:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That's a great idea Kichik!<br />
      Very simple solution that is much better than current.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">15th August 2003 11:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've got this working, but have had problems.<br />
      I'm popping NSISdl's return value from the stack, which is coinciding with the urls on the stack.<br />
      Using Pop in some places made the Invalid opcode error appear, so I replaced some with Exch (NSISdl return value pop and URLS pop)<br />
      <br />
      It seems to work now, but it would be nice if somone could check the script for me:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">15th August 2003 12:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Invalid opcode error is caused by Exch, not Pop. It happens if Exch is called and the stack is empty/not large enough. I don't think there should be any problem with NSISdl pushing stuff on the stack as long as you pop them all.<br />
      <br />
      You can also use the pushed items for NSISdl instead of popping and pushing them back.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">15th August 2003 12:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, I was having the Invalid opcode when Popping NSISdl's return value before Pushing the variable (or somthing) onto the stack first.<br />
      I knew it was the Pop because I placed messagebox before and after it; only the one before it would appear and then the error.<br />
      <br />
      I think that it looks ok and it must be working ok - it definately gets hold of "urls_start" on the stack after trying all urls.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">15th August 2003 12:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Wait, placing two fake urls in screws it up (doesn't get to "urls_start")<br />
      <br />
      I'll find out why...<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">15th August 2003 12:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok you are right, it's actually the Exch at the end of the script causing it.<br />
      Why is this, and how can I fix it?<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">15th August 2003 12:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've ended up using this to fix it:<br />
      Push $R0<br />
      Exch $R0<br />
      <br />
      Everything works great now.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">15th August 2003 12:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It happens if Exch is called and the stack is empty/not large enough. For example, calling Exch when the stack is empty will trigger this error message. This will too:<br />
      <br />
      Push a<br />
      Push b<br />
      Exch 2</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">15th August 2003 12:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here is latest script:<br />
      <br />
      [edit]Removed SplitString function[/edit]<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
