<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Uninstaller crash" />

  <title>Uninstaller crash - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Uninstaller crash</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=275306">Uninstaller crash</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MrTact</span><br />
      <span class="post-time small text-muted">2nd August 2007 23:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Uninstaller crash</strong><br />
      Hi, I am having a really weird error, and I'm stuck trying to figure out why. Any uninstaller that gets generated by my script crashes after executing the first command. What I'm looking for are suggestions how to go about debugging this. For instance, is there a way to get hold of the map data for au_.exe so I can use the postmortem debugger? Anyone have any other suggestions?<br />
      <br />
      Thanks for any thoughts on this subject.<br />
      <br />
      TimK.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">3rd August 2007 04:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Post a sample of your script if you don't mind.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DrDan</span><br />
      <span class="post-time small text-muted">3rd August 2007 16:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>One tip</strong><br />
      Make sure you don't run the uninstaller from the root of any drive as this is not valid installation location (and the uninstaller is normally created in the installation location).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MrTact</span><br />
      <span class="post-time small text-muted">20th August 2007 21:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK, I have figured out _what_ is causing this problem, but not _why_ it is causing it.<br />
      <br />
      I am using a custom build of makensis.exe, to which I have added support for an additional callback called ".onProgress" (patch file is attached). The changes don't seem all that significant, but I'm clearly shifting a pointer somewhere, because installers compiled with this change integrated into a recent CVS sync have all kinds of weird errors -- the wrong default string populating the "where to install" textbox, for instance.<br />
      <br />
      What I don't get is *why* this is disrupting memory this way. It seems like this change would be pretty harmless, since the callback func pointers are stored into a TinyGrowBuf rather than any kind of fixed size memory structure. I figure I'm missing either an initialization of some kind, or there's code somewhere that relies on the buffers holding the callback pointers to be a fixed size that is not traversing far enough. Be darned if I can find anything like either of those, though.<br />
      <br />
      If anyone who is familiar with the inner workings of makensis can point out what I'm doing wrong, I'd be extremely grateful.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">20th August 2007 21:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sounds like you recompiled only makensis.exe and not the stubs. Rebuild <i>everything</i> once you apply the patch.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MrTact</span><br />
      <span class="post-time small text-muted">21st August 2007 21:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the quick reply -- that was definitely *a* problem. I did a clean and a full rebuild and that fixed the problems with the installer. Unfortunately, the uninstaller crash resurfaced as a result.<br />
      <br />
      Back to the drawing board . . .</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">21st August 2007 21:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Debugging the stubs is a bit problematic because makensis.exe actually edits them prior to appending the data and so PDB files are invalid (though windbg probably has some method to force-load PDBs). But map files are present in the build folder and are still valid as only sections below the code are edited.<br />
      <br />
      But simply debugging the crash showed the problem, which was also my first guess once I looked a bit more into the code. progress_bar_step is zero. The first thing the debugger says is "Integer divide-by-zero". If progress_bar_len is smaller than 8, progress_bar_step will be zero.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MrTact</span><br />
      <span class="post-time small text-muted">22nd August 2007 06:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Brilliant! And also, obvious. I should have looked at the divide ops in the patch &amp; protected against potential div by zero.<br />
      <br />
      Thanks so much for your help!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
