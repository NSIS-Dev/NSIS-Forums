<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Callback function .onFileInstalled possible?"><title>Callback function .onFileInstalled possible? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Callback function .onFileInstalled possible?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=186760">Callback function .onFileInstalled possible?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">aportale</span><br><span class="post-time small text-muted">16th July 2004 10:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Callback function .onFileInstalled possible?</strong><br>Hi,<br><br>before posting a feature request on sourceforge, I want to make sure if my idea could work.<br><br>Would it be possible to have a callback function like .onFileInstalled that gets called for each file that was installed?<br><br>The name of the last installed file could be in a global variable.<br><br>This would make it possible to write a clean Log of the installed files even if<br>File /r "filetree\*.*"<br>was used.<br><br>That log could be used for an uninstall routine which only deletes the files that were installed by the installer and were not changed afterwards.<br><br>-Alessandro</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">16th July 2004 11:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That may be a good idea, but if it isn't going to be implemented, you could use the <a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=11&amp;instances=0" target="_blank">Dump log to file</a> function which dumps the install details window text to a selected file.<br><br>There is also a <a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=289" target="_blank">More advanced dump log to file</a> function which only logs files containing a selected string (this should help you)<br><br>Good luck!<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aportale</span><br><span class="post-time small text-muted">16th July 2004 14:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks,<br><br>I looked at the dump log functions, and they work well.<br><br>It is a nice point to start. Since I would like to also have informations like file size, file date and maybe crc, I would have to parse the dump log and rewrite another log file. But that would be acceptable (for now).<br><br>-Alessandro</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">16th July 2004 16:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>Would it be possible to have a callback function like .onFileInstalled that gets called for each file that was installed?</blockquote>what's wrong with <b>IfFileExists</b>?</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aportale</span><br><span class="post-time small text-muted">16th July 2004 16:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Lobo Lunar</i><br><b>what's wrong with</b> IfFileExists?</blockquote>This verification would work for single files, but not for:<br>File /R "manyFiles\*.*"<br><br>In don't know the files in "manyFiles\".<br><br>-Alessandro</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">16th July 2004 18:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Display all files and directories?<br></p><pre>
<code><br>SetCompressor lzma<br>XPStyle on<br><br>Name "Lobo Lunar"<br>OutFile "files_in_dir.exe"<br>BrandingText "Joel Almeida García"<br>InstallDir "$EXEDIR"<br>ShowInstDetails show<br><br>Section "-default"<br>DetailPrint "Displaying files and folders in the current dir:"<br>FindFirst $0 $1 $EXEDIR\*.*<br>Loop:<br>StrCmp $1 "" Exit Display<br>Display:<br>DetailPrint $1<br>FindNext $0 $1<br>Goto Loop<br>Exit:<br>FindClose $0<br>SectionEnd<br></code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aportale</span><br>
      <span class="post-time small text-muted">16th July 2004 20:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Lobo Lunar</i><br>
        <b>Display all files and directories?...</b>
      </blockquote>That is surely a good option if You are sure that the directory where You installed You App was empty.<br>
      But If You just install a bunch of files into an existing file structure, I cannot track which files were installed by the installer.<br>
      <br>
      Well, I could use Your code before the installation and afterwards, and then look for the differences. But what, if someone else stored some files into that directory during the installation?<br>
      <br>
      -Alessandro
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br>
      <span class="post-time small text-muted">16th July 2004 20:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can track the number of items, before and after the installation; then now you can compare :)<br>
      <br></p>
      <pre>
<code><br>SetCompressor lzma<br>XPStyle on<br><br>Name "Lobo Lunar"<br>OutFile "files_in_dir.exe"<br>BrandingText "Joel Almeida García"<br>InstallDir "$EXEDIR"<br>ShowInstDetails show<br><br>Section "-default"<br>DetailPrint "Displaying files and folders in the current dir:"<br>IntOp $2 $2 + 0<br>FindFirst $0 $1 $EXEDIR\*.*<br>Loop:<br>StrCmp $1 "" Exit Display<br>Display:<br>DetailPrint $1<br>IntOp $2 $2 + 1<br>FindNext $0 $1<br>Goto Loop<br>Exit:<br>FindClose $0<br>DetailPrint "Total items in the folder: $2"<br>SectionEnd<br></code>
</pre><br>
      <br>
      /edit: Update coded ;)
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">16th July 2004 20:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Afrow UK</i><br>
        <b>That may be a good idea, but if it isn't going to be implemented, you could use the <a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=11&amp;instances=0" target="_blank">Dump log to file</a> function which dumps the install details window text to a selected file.<br>
        <br>
        There is also a <a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=289" target="_blank">More advanced dump log to file</a> function which only logs files containing a selected string (this should help you)<br>
        <br>
        Good luck!<br>
        <br>
        -Stu</b>
      </blockquote>There are various functions on the Archive to do things such as file size (bytes) but obviously you would have to call the function for each file individually on run-time (which would be a bad idea).<br>
      <br>
      There are functions on the archive which recursively search directories for files. You could easily modify one of those functions and strip it down so that it simply creates a list of files in a directory and its sub-folders.<br>
      <br>
      Again though, this is all going to be done on run time, and it could take a while to generate a list depending on how many files were installed, how many sub-folders etc, so I think that the dump log is the best method currently.<br>
      <br>
      -Stu
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aportale</span><br>
      <span class="post-time small text-muted">16th July 2004 22:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Afrow UK</i><br>
        <b>Again though, this is all going to be done on run time, and it could take a while to generate a list depending on how many files were installed, how many sub-folders etc, so I think that the dump log is the best method currently.</b>
      </blockquote>Currently, Yes. And I will try to work with it although I am not content.<br>
      <br>
      Operations like file size reading or crc code generation on runtime are a bad idea if I do them all at once, for all the files. I guess the progressbar would stop for a long time, and the user would start the task manager in order to kill the installer.<br>
      <br>
      But with those callbacks I am dreaming of, these operations could be made for each file, after it was written. The installation would then also be slower but the extra calculation would be distributed over the whole time and the progressbar would still be alive.<br>
      <br>
      -Alessandro
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">17th July 2004 00:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">NSIS has CRC implemented and checks whether or not the installer is corrupted on installer initialisation.<br>
      You used to be able to turn it on or off (in 1.9) but it's on as default now (I guess).<br>
      <br>
      The GetFileSize function in the Archive works by opening the file and reading it to get the file size. There are various other methods, like using the System plugin to call an API, but the Archive function would be the quickest method.<br>
      <br>
      The only thing that I can suggest, is that you write a program (in any language you prefer) which will make a list of the files which you want to put into your installer (by recursively reading each file name from the directory(s)), or you could do this manually.<br>
      <br>
      You could use a macro for each file like so:<br></p>
      <pre>
<code>!macro ADD_FILE FILEIN FILEOUT<br> File "/oname=${FILEOUT}" "${FILEIN}"<br> # do stuff with file here<br>!macroend</code>
</pre><br>
      <br>
      Then for inserting each of the files into the installer, use:<br>
      <pre>
<code>!insertmacro ADD_FILE "path_to\file.ext" "outpath_to\file.ext"</code>
</pre><br>
      <br>
      With my NSIS Self-Extractor kit (<a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=589&amp;instances=0,8" target="_blank">http://nsis.sourceforge.net/archive/...&amp;instances=0,8</a>) I wrote a script generator consisting of DHTML (JavaScript + [X]HTML), and I used an ActiveX control for a recursive directory includer.<br>
      With my Self-Extractor kit, each file could have an 'overwrite if file exists' prompt, therefore I used an !insertmacro (like above) for each file. The script generator read the directory and for each file, it outputted the !insertmacro code for me/whoever to use.<br>
      <br>
      I also once or twice used an NSIS installer itself to generate a list of files from about 10 directories and their subdirectories. If you use an NSIS script, you could also get the file sizes which could be then stored in your main installer for when you want to check for file differences.<br>
      <br>
      -Stu
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aportale</span><br>
      <span class="post-time small text-muted">19th July 2004 22:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks, with all these tricks and solutions I cannot complain anymore .. for now ;).<br>
      <br>
      And the NSIS Self-Extractor kit is very cool. The browser based script generator does a really nice job!<br>
      <br>
      Keep it on!<br>
      <br>
      - Alessandro</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">19th July 2004 22:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Lol I just ran my script generator just now to create an installer for my HL map, and realised I left an alert in there that says "mo" (uploaded fixed product)<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>