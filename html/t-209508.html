<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Check a UserID and PW within a SQL DB" />

  <title>Check a UserID and PW within a SQL DB - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Check a UserID and PW within a SQL DB</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=209508">Check a UserID and PW within a SQL DB</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jnuw</span><br />
      <span class="post-time small text-muted">4th March 2005 17:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Check a UserID and PW within a SQL DB</strong><br />
      Hey guys.<br />
      <br />
      I would like to prompt a user to enter a username and password, then pass those to a mysql db, and find out if that is a valid name or not. I checked the Archive, and don't see any functions/plugins that can do that.<br />
      <br />
      Any help would be much appreciated, thanks!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jnuw</span><br />
      <span class="post-time small text-muted">4th March 2005 18:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here is some more information. During the installation, if the user is missing some files, I want to download them for the user, automatically. However before downloading the files, I want to check that the user is a current customer, hence I’ll ask them for their username and password. I then want to pass those credentials to the mysql db that is on the back end of our website. So the sql db is not local to the user, but I want to connect to it over the internet, make sense? Thanks for your help.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">4th March 2005 21:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It'd be much simpler to make a HTTP interface and access it using NSISdl or InetLoad. Writing a PHP page to do this kind of a test should be simpler than accessing a remote SQL server.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jnuw</span><br />
      <span class="post-time small text-muted">4th March 2005 23:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'll check into that, thanks!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jnuw</span><br />
      <span class="post-time small text-muted">20th May 2005 22:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>From a PM from dimator</i><br />
        <b>Hi,<br />
        I'm just curious if you ever found a way to prompt the user for a username and password dialog, you were looking for?<br />
        <br />
        Thanks,<br />
        DImi<br /></b>
      </blockquote>First I created a php page called vChecker.php that takes a username and password from the url, and returns a page with only 'LoggedIn' on it if the credential are good. I used the following code for that &lt;Stuff between these you must fill in for yourself&gt;:<br />
      <br />
      PHP Code:
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />
      <br />
      $name</span><span style="color: #007700">=</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">***91;</span><span style="color: #DD0000">'name'</span><span style="color: #007700">***93;;<br /></span> <span style="color: #0000BB">$pwd</span><span style="color: #007700">=</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">***91;</span><span style="color: #DD0000">'pwd'</span><span style="color: #007700">***93;;<br />
      <br />
      {<br />
      <br /></span> <span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'mysql.&lt;yourserver&gt;.com'</span><span style="color: #007700">,</span><span style="color: #DD0000">'&lt;username&gt;'</span><span style="color: #007700">,</span><span style="color: #DD0000">'&lt;password&gt;'</span><span style="color: #007700">)or<br />
      die(</span><span style="color: #DD0000">'Couldnotconnecttodatabase'</span><span style="color: #007700">);<br />
      <br /></span> <span style="color: #0000BB">mysql_select_db</span><span style="color: #007700">(</span><span style="color: #DD0000">'&lt;yourdatabase&gt;'</span><span style="color: #007700">)or<br />
      die(</span><span style="color: #DD0000">"Couldnotselectdatabase"</span><span style="color: #007700">);<br />
      <br /></span> <span style="color: #0000BB">$result</span><span style="color: #007700">=</span><span style="color: #0000BB">mysql_query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&lt;table1&gt;,&lt;table2&gt;,&lt;table3&gt;,&lt;table4&gt;FROM&lt;AnotherTable&gt;WHEREusername='$name'ANDpassword='$pwd'ANDaccepted&gt;0"</span><span style="color: #007700">)or<br />
      die(</span><span style="color: #DD0000">'cantdoit'</span><span style="color: #007700">);<br />
      <br />
      while(</span><span style="color: #0000BB">$row</span><span style="color: #007700">=</span><span style="color: #0000BB">mysql_fetch_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">))<br />
      {<br />
      if(</span><span style="color: #0000BB">$row</span><span style="color: #007700">***91;</span><span style="color: #DD0000">"password"</span><span style="color: #007700">***93;==</span><span style="color: #0000BB">$password</span><span style="color: #007700">)<br />
      {<br />
      print</span><span style="color: #DD0000">'LoggedIn'</span><span style="color: #007700">;<br />
      }else{<br />
      print</span><span style="color: #DD0000">'Denied'</span><span style="color: #007700">;<br />
      }<br />
      }<br />
      <br />
      }<br /></span> <span style="color: #0000BB">?&gt;</span></span> <!-- php buffer end -->
      <hr />
      Then in NSIS, I made a custom page that asked the user for a username and password that they would use on our website. Here is that code:<br />
      <br />
      <pre>
<code><br />Function LeaveCredentials<br />  StrCmp $NumTries 0 0 +3<br />    MessageBox MB_OK|MB_ICONSTOP "You have exceeded your logon attempts, please press Exit below."<br />    Abort<br />  StrCmp $NumTries 1 +3<br />  StrCmp $NumTries 2 +2<br />  StrCpy $NumTries 3<br /><br />  Delete "$INSTDIR\Tools\Bin\vChecker.txt"<br />  Delete "$INSTDIR\Tools\Bin\vChecker.php"<br />  ReadINIStr $Username "$PLUGINSDIR\Credentials.ini" "Field 4" "State"<br />  ReadINIStr $Password "$PLUGINSDIR\Credentials.ini" "Field 6" "State"<br /><br />  InetLoad::load /Silent "http://www.&lt;yourwebsite&gt;.com/vChecker.php?name=$Username&amp;pwd=$Password" "$INSTDIR\Tools\Bin\vChecker.php"<br />    Pop $0<br />    StrCmp $0 "OK" GotFile<br />      MessageBox MB_OK|MB_ICONSTOP "Connection Error!  Unable to verify Username and Passowrd.$\r$\nPlease try again or call us."<br />      Abort<br /><br />  GotFile:<br />  Rename "$INSTDIR\Tools\Bin\vChecker.php" "$INSTDIR\Tools\Bin\vChecker.txt"<br />  FileOpen $0 "$INSTDIR\Tools\Bin\vChecker.txt" r<br />  FileRead $0 $1<br />  FileClose $0<br />  Push $1<br />  Call Trim<br />  Pop $1<br />  StrCmp $1 "LoggedIn" +4<br />    Intop $NumTries $NumTries - 1<br />    MessageBox MB_OK|MB_ICONEXCLAMATION "The Username and Password you entered is not correct, please try again.$\r$\n$\r$\nAttempts remaining: $NumTries"<br />    Abort<br /><br />  ;here is where you put the code that runs if user gets authenticated...<br />  <br />FunctionEnd<br /></code>
</pre><br />
      <br />
      I'll be the first to say that I’m a total noob when it comes to php, and all that code I got from another forum. And as for NSIS, I’m at best an amateur, and I’m sure there is a better way to program all this...however my code seems to work well, and is solid. Wait about 10 minutes, and I’m sure someone will correct some of my crappy inefficient code. Hope this helps.<br />
      <br />
      Jnuw
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">20th May 2005 23:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well I'm suprised that works actually. Perhaps InetLoad isn't the same, but usually you have to pass it the content-length of the script output.<br />
      <br />
      e.g.<br />
      header("Content-Length: 8");<br />
      echo 'LoggedIn';<br />
      <br />
      I recommend using echo rather than print as it's a tiny bit faster (print returns true or false when it is successful or not whereas echo does not return anything).<br />
      <br />
      Also rather than have "$INSTDIR\Tools\Bin\vChecker.php" on your InetLoad call, just use "$INSTDIR\Tools\Bin\vChecker.txt" and then you don't have to rename it afterwards. Don't forget InetLoad is downloading the output of the PHP script not the script itself therefore the downloaded output is no longer of PHP file type.<br />
      <br />
      Finally you shouldn't have to use the Trim function because you aren't putting any new line characters in the PHP script output.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jnuw</span><br />
      <span class="post-time small text-muted">21st May 2005 06:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Afrow UK</i><br />
        <b>...I recommend using echo rather than print...<br />
        <br />
        ...Also rather than have "$INSTDIR\Tools\Bin\vChecker.php" on your InetLoad call, just use "$INSTDIR\Tools\Bin\vChecker.txt"...<br />
        <br />
        ...Finally you shouldn't have to use the Trim function...<br />
        -Stu</b>
      </blockquote>Thanks Stu for your help.<br />
      <br />
      I will try the echo instead of the print on monday when i get back to work. That might help the fact that i could never get 'Denied' to come up. I only get 'LoggedIn' or nothing. Doesn't really matter, all I need are differing pages.<br />
      <br />
      Also, good point on the .php vs. .txt. That will save a couple lines of code.<br />
      <br />
      As for the trim function, I found the strcmp did not work without it. Seems there was a carrage return, or some other character in there. Maybe the echo instead of the print will fix that too.<br />
      <br />
      Thanks again.<br />
      <br />
      Jnuw
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">21st May 2005 06:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">InetLoad supports http 1.1 chunked reply (i.e. without Content-Length header). The only difference is that progress bar will not appear because file length not comes from server. But for 8 bytes reply you will not see progress bar any case :)<br />
      If NSIS stack may be not empty you can add /end parameter at the end of InetLoad call string - this limits plug-in's parameters 'Pop' from the stack (requested by Afrow UK :D ).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">21st May 2005 09:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, another error I think... In the PHP script you're using $password in the selection statement when the variable is called $pwd? That should explain why you are only getting one of the two output strings.<br />
      <br />
      And also you aren't using a mysql_close(); call at the end.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
