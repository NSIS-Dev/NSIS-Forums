<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Problems using UnRegDLL" />

  <title>Problems using UnRegDLL - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Problems using UnRegDLL</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=158203">Problems using UnRegDLL</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">T595</span><br />
      <span class="post-time small text-muted">1st December 2003 12:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Problems using UnRegDLL</strong><br />
      I've searched the forum without any luck...<br />
      <br />
      I want to register/unregister some dll's with my setup program (apart from installing the rest of the application) and the first section works just fine.<br />
      <br />
      During install, I unreg the dll in two locations (to awoid duplicates) and the one that unregisters from the installation folder (marked: &gt;&gt;) works just fine during setup, but when using the exact same command during uninstall it fails...<br />
      (could not load: c:\program files\TEST\TEST.dll)<br />
      <br />
      running a "regsvr32 /U TEST.dll" from the commandprompt works just fine too, so the option would be using ExecWait, or ?<br />
      <br />
      Anyone have a solution for this problem ?<br />
      <br />
      Section "Test" TST<br />
      SetOutPath $INSTDIR\TEST<br />
      File TEST\TEST.dll<br />
      UnRegDLL $SYSDIR\TEST.dll<br />
      &gt;&gt; UnRegDLL $INSTDIR\TEST\TEST.dll<br />
      RegDLL $INSTDIR\TEST\TEST.dll<br />
      WriteUninstaller "$INSTDIR\uninstall.exe"<br />
      SectionEnd<br />
      <br />
      <br />
      Section "Uninstall"<br />
      UnRegDLL $INSTDIR\TEST\TEST.dll<br />
      RMDir /r "$INSTDIR\TEST"<br />
      SectionEnd<br />
      <br />
      <br />
      <br />
      <br />
      <br />
      Many thanks,<br />
      <br />
      Magnus</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">1st December 2003 13:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Make sure the DLL has all its dependencies where it can find them. Using the following before UnregDLL should probably do it:<br />
      <br />
      SetOutPath $INSTDIR\Test<br />
      <br />
      SetOutPath sets the working directory which is one of the directories where Windows looks for DLL dependencies. Don't forget to set it to something else before you want to delete the directory because the working directory cannot be deleted.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">T595</span><br />
      <span class="post-time small text-muted">1st December 2003 16:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Brilliant, it works like a charm...<br />
      <br />
      Thanks a lot!<br />
      <br />
      <br />
      /Magnus</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Shalafi</span><br />
      <span class="post-time small text-muted">28th September 2010 02:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry for revive so old thread, but this is the only entry about this topic that Google shows me ;)<br />
      <br />
      I have exactly the same problem; my uninstaler can't unregister a dll. It sais "could not load: C:\program files\MediaTab\MediaTab64.dll"<br />
      <br />
      I tried what T595 said, adding SetOutPath $INSTDIR\MediaTab before UnRegDll but it doesn't solve the problem. Also, I tried with different values for SetOutPath without any change.<br />
      <br />
      Any help? Thanks</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br />
      <span class="post-time small text-muted">28th September 2010 07:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I guess it's a x64 Dll?<br />
      <a href="http://forums.winamp.com/showthread.php?t=318803" target="_blank">http://forums.winamp.com/showthread.php?t=318803</a><br />
      This post is about installation, but the same applies for uninstallation:<br />
      <a href="http://nsis.sourceforge.net/Docs/AppendixB.html#B.3" target="_blank">http://nsis.sourceforge.net/Docs/AppendixB.html#B.3</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Shalafi</span><br />
      <span class="post-time small text-muted">28th September 2010 11:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for your help.<br />
      I tried what you said, but I's still failling. This is my uninstall code:<br />
      <br />
      ... stuff ...<br />
      ${If} ${RunningX64}<br />
      ;SetRegView 64 --- Commented because I used it before<br />
      Delete "$INSTDIR\Uninstall.exe"<br />
      ;UnRegDLL "$INSTDIR\MediaTab64.dll" --- Commented because I used it before<br />
      define LIBRARY_X64<br />
      !insertmacro UnInstallLib REGDLL NOTSHARED NOREBOOT_NOTPROTECTED "$INSTDIR\MediaTab64.dll"<br />
      !undef LIBRARY_X64<br />
      ... more stuff ...<br />
      <br />
      The error still is "Could not load: C:\program files\MediaTab\MediaTab64.dll"<br />
      <br />
      Thanks again; any other idea?<br />
      <br />
      P.D: manual unregistering with regsvr32 works perfect<br />
      <br />
      EDIT ------------------------<br />
      I defined LIBRARY_X64 at the begining of the script and I didn't remember it; I have commented the define at unistall part and now it's working.<br />
      Thank you so much!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
