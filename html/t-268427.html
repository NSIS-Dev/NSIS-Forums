<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="CoFreeUnusedLibraries call in InstallLib" />

  <title>CoFreeUnusedLibraries call in InstallLib - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">CoFreeUnusedLibraries call in InstallLib</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=268427">CoFreeUnusedLibraries call in InstallLib</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dienjd</span><br />
      <span class="post-time small text-muted">26th March 2007 19:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>CoFreeUnusedLibraries call in InstallLib</strong><br />
      In <a href="http://nsis.sourceforge.net/Docs/AppendixB.html#B.2.3" target="_blank">http://nsis.sourceforge.net/Docs/AppendixB.html#B.2.3</a> under LIBRARY_COM it says "...to call CoFreeUnusedLibraries after registration" and the Library.nsh code shows this.<br /></p>

      <blockquote>
        MSDN:<br />
        CoFreeUnusedLibraries<br />
        Unloads any DLLs that are no longer in use and that, when loaded, were specified to be freed automatically.
      </blockquote>Is there a reason this call is only made after registration? Why isn't it called before installation/registration also? I don't have experience with CoFreeUnusedLibraries, so I'm trying to understand its usage, but from the description it seems like you'd want to call it before installation/registration.<br />
      <br />
      Thanks.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">27th March 2007 20:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Calling it before unregistration will have no meaning because the unregistered DLL is not loaded at that stage. The idea behind this call is unloading the DLL so it can be deleted after it's unregistered.<br />
      <br />
      Calling it in the registration process is probably useful only for freeing unused memory. In that case as well it wouldn't make any sense calling it before the DLL was even loaded.<br />
      <br />
      See <a href="http://forums.winamp.com/showthread.php?threadid=126207" target="_blank">the original thread</a> for more details.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dienjd</span><br />
      <span class="post-time small text-muted">27th March 2007 21:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks, I didn't find that older thread when researching.<br />
      <br />
      I had in mind the scenario of an overinstall. For example, a COM DLL is already installed and was being used. The process using it stopped using it, but it had not been unloaded by the time you overinstall. It seemed like CoFreeUnusedLibraries or CoFreeUnusedLibrariesEx would possibly allow you to overinstall the DLL immediately without having to install it as a temp file and rename on reboot. If the DLL is actively being used, the API call would not help...this would all depend on the timing.<br />
      <br />
      I may be (make that 'probably am') completely wrong about this, so I was seeing what others thought about it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">27th March 2007 21:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It only frees DLLs of the current process, not all processes on the system.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dienjd</span><br />
      <span class="post-time small text-muted">27th March 2007 21:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ah, that makes sense. Thanks for the clarification :)</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
