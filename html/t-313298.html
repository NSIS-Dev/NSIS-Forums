<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="PATH is erased/replaced"><title>PATH is erased/replaced - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">PATH is erased/replaced</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=313298">PATH is erased/replaced</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">jan007</span><br><span class="post-time small text-muted">3rd October 2009 12:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>PATH is erased/replaced</strong><br>Hi,<br>I've made a commandline utility (.exe) that depends on a couple of dll's.<br>After looking for some kind of packer that would allow me to let users download and use a single (working) exe (with the dll's included) it seems that is impossible.<br>So someone pointed me to NSIS, which is a great tool, although I don't actually need to install software.<br><br>Crucial in my setup is that users don't have to add the directory with the exe to their environmental PATH variable. NSIS does a great job with this but in my case it erased my entire PATH even though I used A(ppend).<br>Gladly enough I read a lot of related posts before I tried, so I made a backup of my PATH.<br>But I can't seem to find a solution to this problem. My PATH contains 1081 characters and slimming it down does solve the problem. But I can't ask my users to do that or otherwise I could just as well offer a zip and make them add the dir to their PATH themselves.<br><br>1)Is there a 'real' solution to this problem?<br>2)Can I otherwise somehow count the characters of their PATH variable and show a warning that their PATH will not be updated and that they will (still) have to add it themselves manually and show/link to a manual of how to do this?<br>3)The directory which should added to the PATH variable is now hardcoded in my nsi script, but when people choose to 'install' in another directory this won't be correct. How can I retrieve what 'custom' directory they choose and use that dir to append to their PATH?<br>4)As I said before: I'm not actually installing software, it's more like saving into a dir and setting up the PATH. So, can I leave out all the registry stuff from the example.nsi or can this be usefull for other things such as an uninstaller which in my case would be just to remove the dir+contents and the PATH var?<br><br>I'm using NSIS 2.45 and Windows XP.<br><br>Thanks in advance!<br><br>Although the provided examples seem quite easy to change to reflect my setup I'm still posting it to make sure it does not contain unwanted, unneeded or even dangerous stuff.<br><br></p><pre>
<code><font color="black">!include EnvVarUpdate.nsh<br></font><font color="blue">Name</font> <font color="red">"MyApp"</font><font color="black"><br>OutFile </font><font color="red">"MyApp_installer.exe"</font><font color="black"><br>InstallDir $PROGRAMFILES\MyApp<br>InstallDirRegKey HKLM </font><font color="red">"Software\MyApp"</font> <font color="red">"Install_Dir"</font><font color="black"><br>RequestExecutionLevel admin<br><br>Page components<br>Page directory<br>Page instfiles<br><br>UninstPage uninstConfirm<br>UninstPage instfiles<br><br>Section </font><font color="red">"MyApp (required)"</font><font color="black"><br>  SectionIn RO<br>  <br>  SetOutPath $INSTDIR<br>  <br>  </font><font color="blue">File</font> <font color="red">"MyApp.exe"</font><br>  <font color="blue">File</font> <font color="red">"gc.dll"</font><br>  <font color="blue">File</font> <font color="red">"neko.dll"</font><br>  <font color="blue">File</font> <font color="red">"regexp.ndll"</font><br>  <font color="blue">File</font> <font color="red">"std.ndll"</font><br>  <font color="blue">File</font> <font color="red">"zlib.ndll"</font> <br>  <font color="blue">File</font> <font color="red">"LICENSE"</font>   <br>  <font color="blue">File</font> <font color="red">"neko_source_download.txt"</font><br>  <font color="blue">File</font> <font color="red">"howto.txt"</font><font color="black">  <br>        <br>  WriteRegStr HKLM SOFTWARE\MyApp </font><font color="red">"Install_Dir"</font> <font color="red">"$INSTDIR"</font><font color="black"><br><br>  WriteRegStr HKLM </font><font color="red">"Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp"</font> <font color="red">"DisplayName"</font> <font color="red">"MyApp"</font><font color="black"><br>  WriteRegStr HKLM </font><font color="red">"Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp"</font> <font color="red">"UninstallString"</font> <font color="red">'"$INSTDIR\uninstall.exe"'</font><font color="black"><br>  WriteRegDWORD HKLM </font><font color="red">"Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp"</font> <font color="red">"NoModify"</font><font color="black"> 1<br>  WriteRegDWORD HKLM </font><font color="red">"Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp"</font> <font color="red">"NoRepair"</font><font color="black"> 1<br>  WriteUninstaller </font><font color="red">"uninstall.exe"</font><font color="black"><br>  ${EnvVarUpdate} $0 </font><font color="red">"PATH"</font> <font color="red">"A"</font> <font color="red">"HKLM"</font> <font color="red">"C:\Program Files\MyApp"</font><font color="black"><br>SectionEnd<br><br>Section </font><font color="red">"Start Menu Shortcuts (uninstaller)"</font><font color="black"><br>  CreateDirectory </font><font color="red">"$SMPROGRAMS\MyApp"</font><font color="black"><br>  CreateShortCut </font><font color="red">"$SMPROGRAMS\MyApp\Uninstall.lnk"</font> <font color="red">"$INSTDIR\uninstall.exe"</font> <font color="red">""</font> <font color="red">"$INSTDIR\uninstall.exe"</font><font color="black"> 0<br>  CreateShortCut </font><font color="red">"$SMPROGRAMS\MyApp\howto.lnk"</font> <font color="red">"$INSTDIR\howto.txt"</font> <font color="red">""</font> <font color="red">"$INSTDIR\howto.txt"</font><font color="black"> 0<br>SectionEnd<br><br>Section </font><font color="red">"Uninstall"</font><font color="black"><br>  DeleteRegKey HKLM </font><font color="red">"Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp"</font><font color="black"><br>  DeleteRegKey HKLM SOFTWARE\MyApp<br><br>  Delete $INSTDIR\MyApp.exe<br>  Delete $INSTDIR\uninstall.exe<br>  Delete $INSTDIR\gc.dll<br>  Delete $INSTDIR\neko.dll<br>  Delete $INSTDIR\regexp.ndll<br>  Delete $INSTDIR\std.ndll<br>  Delete $INSTDIR\zlib.ndll<br>  Delete $INSTDIR\LICENSE<br>  Delete $INSTDIR\neko_source_download.txt<br>  Delete $INSTDIR\howto.txt<br><br>  Delete </font><font color="red">"$SMPROGRAMS\MyApp\*.*"</font><font color="black"><br><br>  RMDir </font><font color="red">"$SMPROGRAMS\MyApp"</font><font color="black"><br>  RMDir </font><font color="red">"$INSTDIR"</font><font color="black"><br>        <br>        ${un.EnvVarUpdate} $0 </font><font color="red">"PATH"</font> <font color="red">"R"</font> <font color="red">"HKLM"</font> <font color="red">"C:\Program Files\MyApp"</font><br>SectionEnd</code>
</pre><br>
      Cheers,<br>
      <br>
      Jan
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br>
      <span class="post-time small text-muted">3rd October 2009 15:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">1)<br>
      yes, this is a known problem, someone(not me) needs to rewrite the path functions to use the system plugin and dynamic memory so you don't run into the 1024 limit. In the mean time you could use the large string build of nsis ( <a href="http://nsis.sourceforge.net/Special_Builds" target="_blank">http://nsis.sourceforge.net/Special_Builds</a> )<br>
      <br>
      2) yes it would be possible to count (read the registry path string and check its length)<br>
      <br>
      3) $instdir</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jan007</span><br>
      <span class="post-time small text-muted">3rd October 2009 16:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Anders</i><br>
        1)In the mean time you could use the large string build of nsis ( <a href="http://nsis.sourceforge.net/Special_Builds" target="_blank">http://nsis.sourceforge.net/Special_Builds</a> )
      </blockquote>Thanks, <b>It does solve my problem.</b> (I read about it but was under the false impression I had to build that from source.)<br>
      But yesterday I read in this thread that it could still go wrong. :eek:<br>
      <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=302516" target="_blank">http://forums.winamp.com/showthread....hreadid=302516</a> threadid=302516(last post)<br>
      I'd hate to erase someone's PATH (I surely would be furious if someone/thing did it to me)<br>
      <br>
      Is there a reason the special build is not the default one? Are there any drawbacks or good reasons not to use it?<br>

      <blockquote>
        <i>Originally posted by Anders</i><br>
        2) yes it would be possible to count (read the registry path string and check its length)
      </blockquote>I guess I won't need to anymore since it works now.<br>

      <blockquote>
        <i>Originally posted by Anders</i><br>
        3) $instdir
      </blockquote>Ah, as simple as that, nice, works perfectly. Many thanks.<br>
      <br>
      Cheers,<br>
      Jan
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>