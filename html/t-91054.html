<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Can installer update itself?"><title>Can installer update itself? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Can installer update itself?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=91054">Can installer update itself?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">simham_uk</span><br><span class="post-time small text-muted">14th June 2002 14:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Can installer update itself?</strong><br>I'm nearing the completion of an online updater, and one task that would be nice is for the installer to update itself.<br><br>I have tried many different ways, such as downloading as a different name, and then renaming as the last task in the installer, but this doesnt seem to work?<br><br>Is there an easy way around this? I couldn't find anything in the forums on this topic, and don't want to have to reboot either since the updater is mostly automated.<br><br>Thanks!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">14th June 2002 14:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Couldn't you launch a detached script (i.e don't wait for it to finish) then exit the installer. The launched script (or whatever) pauses for a few seconds then runs the new installer exe?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">simham_uk</span><br><span class="post-time small text-muted">14th June 2002 14:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'm not quite sure what you mean Ximon.<br><br>If I have to run something separate, surely I'd need to delete that too, once I've finished?<br><br>What do you mean by a detached script?<br><br>Thanks for the help!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">14th June 2002 14:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Maybe I've got the wrong end of the stick but this is my idea...<br><br>- Run your installer<br>- Download a new file installer version as another filename<br>- Extract tiny assistant program<br>- Exec 'tiny assistant program'<br>- Quit<br><br>The tiny program or script or whatever sleeps for a couple of seconds to give the first installer time to quit, deletes the first installer, renames the new one then launches it and that then deletes the tiny assistant program.<br><br>It's not very neat I know :(</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">14th June 2002 16:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sleeping is not a good idea... You better send it $HWNDPARENT as a command line parameter and then it should wait until the owner process of the HWND is terminated. Same for the new installer.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">14th June 2002 16:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ah you didn't dismiss the idea outright! Cheers! :D</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">simham_uk</span><br><span class="post-time small text-muted">14th June 2002 20:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I can't thank you enough for all your help you guys!!<br><br>I did what you suggested Ximon, and it works very well.<br><br>I'm not sure what you were talking about Amir, regarding $HWNDPARENT. I presume you mean something about closing the parent window (the one that spawned the helper).<br><br>Did you mean to sendmessage or something, to get rid of it, or to detect its existence, if it's still there?<br><br>Could you explain in more detail what you mean...perhaps a small example?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">14th June 2002 20:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Glad I could help.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">15th June 2002 09:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">What I meant is that you can not be sure that after the sleep period the installer would exit. You must somehow detect that it was indeed termintated so you can replace the EXE.<br><br>Here is the code needed:<br>In the updater:<br>Exec '"$TEMP\helper.exe" $HWNDPARENT'<br><br>In the helper:<br>// Get the command line with GetCommandLine() and get the<br>// HWNDPARENT from it<br>DWORD pId;<br>HANDLE hP;<br>GetWindowThreadProcessId(hwParent, &amp;pId);<br>hP = OpenProcess(PROCESS_ALL_ACCESS, FALSE, pId);<br>WaitForSingleObject(hP, /*time-out interval*/10000);<br>CloseHandle(hP);</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">16th June 2002 06:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Alternative</strong><br>You could of course (but this isn't much "safer") just sleep n seconds then try deleting the old .exe and if it fails wait a bit longer upto a maximum by which point you decide that there is a severe problem.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">simham_uk</span><br><span class="post-time small text-muted">16th June 2002 20:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This is kinda what I'm doing Ximon.<br><br>I don't know much about C, but my helper is another installer that downloads the new Updater anyway.<br><br>I've just discovered UPX, so my installers are now much smaller...that helper is only 25k.<br><br>Thanks again guys!</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>