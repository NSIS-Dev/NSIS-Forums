<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Too heavy on Win98"><title>Too heavy on Win98 - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Too heavy on Win98</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=267888">Too heavy on Win98</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Mark Nascimento</span><br><span class="post-time small text-muted">16th March 2007 17:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Too heavy on Win98</strong><br>Please, take a look at this script. When running on Win98,<br>one on a 1.4 GHz, 256MBram, cache64+64 an on other 1.3 GHz, 64, cache 128+128,<br>the computer, after some minutes, and running other apps,<br>shows message box "explorer executed an non authoryzed..."<br>and closes the explorer, IE and all other running processes,<br>one by one, in sequence. (on both computers, in different places, independent, both win98SE)<br><br>So, SLEEP stops the use of core while sleeping?<br>Is there a way to make this script lighter or<br>not to cause crash?<br><br><br><br>OutFile "..\Monitorador.exe"<br>Name "Monitorador"<br>!include WinMessages.nsh<br>;LoadLanguageFile "D:\Roteiro\PORTUGUESEBR.NLF"<br>;Icon clip.ico<br>SilentInstall Silent<br>Page Instfiles<br><br><br>Section<br>############# Allow only one installer instance =System::Call "kernel32::CreateMutexA(i 0, i 0, t '$(^Name)') i .r0 ?e"<br>System::Call "kernel32::CreateMutexA(i 0, i 0, t '$(^Name)') i .r0 ?e"<br>Pop $R0<br>StrCmp $R0 0 DoRunInstall<br>Banner::show /NoUnload "O Monitorador jÃ¡ estÃ¡ aberto !"<br>Sleep 2000<br>Banner::Destroy<br>Abort<br>DoRunInstall:<br>########## Baixar prioridade - lower priority<br>System::Call "kernel32::GetCurrentProcess() i .s"<br>System::Call "kernel32::SetPriorityClass(i s, i 0x00000040)"<br>########## Indicar que estÃ¡ ligado para o Proxy do Papai (botÃ£o 23)<br><br>########## VÃª o que estÃ¡ lÃ¡ para nÃ£o lanÃ§ar de arranque.See what is in clipboard for not launch on start<br>Delete "$temp\mt.ini"<br>WriteIniStr "$temp\mt.ini" 1 2 Ligado<br>System::Call 'user32::OpenClipboard(i 0)'<br>System::Call 'user32::GetClipboardData(i 1) t .r0'<br>System::Call "user32::CloseClipboard()"<br>Pop $0<br>WriteIniStr "$temp\mt.ini" 1 1 $0<br>########## Iniciar o Looping - start looping/watching<br>loop:<br>ReadIniStr $2 "$temp\mt.ini" 1 2<br>StrCmp $2 desligar Fechar ;TrocarProxy.exe will close Monitorador, if I want, at any time, writing this line<br>Sleep 2000<br>System::Call 'user32::OpenClipboard(i 0)'<br>System::Call 'user32::GetClipboardData(i 1) t .r0'<br>System::Call "user32::CloseClipboard()"<br>Pop $0<br>ReadIniStr $9 "$temp\mt.ini" 1 1<br>StrCmp $0 $9 loop ; 9 Ã© o original<br>########## Agora, ver se o dado HTTP Ã© vÃ¡lido: LetÂ´s see if it is http<br>StrCpy $1 $0 7<br>StrCmp $1 "http://" 0 naoehttp<br>ClearErrors<br>Rename "$exedir\TrocarProxy.exe" "$exedir\TrocarProxy.exe"<br>IfErrors 0 +2<br>fct::fct /WC '#32770' /WT "Proxy do Papai"<br>WriteIniStr "$temp\mt.ini" 1 1 $0 ; What is in clipboard becomes original<br>WriteINIStr "$exedir\n.ini" "Field 41" Text "Do Monitorador"<br>Exec "$exedir\TrocarProxy.exe" ; The app that waits to be launched<br>GoTo loop<br>########## Agora, ver se o dado PROXY Ã© vÃ¡lido: see if proxy is valid, by my criteria<br>naoehttp:<br>StrCpy $1 $0 1 -6<br>StrCmp $1 ":" certo1 ;OK 1<br>StrCpy $1 $0 1 -5<br>StrCmp $1 ":" certo1<br>StrCpy $1 $0 1 -4<br>StrCmp $1 ":" certo1<br>StrCpy $1 $0 1 -3<br>StrCmp $1 ":" certo1 loop<br>certo1:<br>StrCpy $1 $0 "" -2<br>intop $2 $1 / $1<br>StrCmp $2 1 0 loop ;ver se Ã© nÃºmero-is it a number?<br>StrCmp $1 80 certo ;- Portas permitidas (dezena e unidade.) ALLOWED terminations<br>StrCmp $1 28 certo ;- Portas permitidas (Centena em diante Ã© irrelevante)<br>StrCmp $1 08 certo ;- Portas permitidas<br>StrCmp $1 50 certo ;- Portas permitidas<br>StrCmp $1 24 certo ;- Portas permitidas<br>StrCmp $1 88 certo ;- Portas permitidas<br>StrCmp $1 27 certo ;- Portas permitidas<br>GoTo loop<br>########## If wrong, loop. If right, certo.<br>certo:<br>########## Trocar proxy is already opened?<br>ClearErrors<br>Rename "$exedir\TrocarProxy.exe" "$exedir\TrocarProxy.exe"<br>IfErrors 0 SemRever<br>ReadIniStr $2 "$temp\mt.ini" 1 2<br>StrCmp $2 desligar Fechar ;TrocarProxy.exe will close Monitorador, if I want, at any time, writing this line<br>fct::fct /WC '#32770' /WT "Proxy do Papai"<br>SemRever:<br>########## Mudar o proxy - change proxy<br>WriteRegDWORD HKU ".DEFAULT\Software\Microsoft\Windows\CurrentVersion\Internet Settings" "ProxyEnable" 1<br>WriteRegDWORD HKLM "Config\0001\Software\Microsoft\windows\CurrentVersion\Internet Settings" "ProxyEnable" 1<br>WriteRegDWORD HKCU "Software\Microsoft\Windows\CurrentVersion\Internet Settings" "ProxyEnable" 1<br>WriteRegStr HKCU "Software\Microsoft\Windows\CurrentVersion\Internet Settings" "ProxyServer" "$0"<br>WriteRegStr HKU ".DEFAULT\Software\Microsoft\Windows\CurrentVersion\Internet Settings" "ProxyServer" "$0"<br>########## Mudar config da interface para ligar configurado - Change interface of TrocarProxy.exe<br>WriteIniStr "$exedir\n.ini" "Field 10" "State" 0<br>WriteINIStr "$exedir\n.ini" "Field 11" "Flags" "Notify|DISABLED"<br>WriteINIStr "$exedir\n.ini" "Field 2" "Flags" ""<br>WriteINIStr "$exedir\n.ini" "Field 3" "Flags" "Notify"<br>WriteINIStr "$exedir\n.ini" "Field 41" Text "Do Monitorador"<br>WriteIniStr "$temp\mt.ini" 1 1 $0 ; O que estÃ¡ no clipboard passa a ser original.<br>Exec "$exedir\TrocarProxy.exe"<br>GoTo loop<br><br>Fechar:<br>Delete "$temp\mt.ini"<br><br>sectionend<br>autoclosewindow true</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">16th March 2007 18:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think would help if you disable this 'SilentInstall Silent' and enable 'ShowInstDetails show' to see if the target systems crash at the same point of script execution.<br><br>BTW what exactly does this:<br>Rename "$exedir\TrocarProxy.exe" "$exedir\TrocarProxy.exe"</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yathosho</span><br><span class="post-time small text-muted">16th March 2007 18:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">might be unrelated, but some of my scripts only worked properly on win9x if i used "s for all variables</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Mark Nascimento</span><br><span class="post-time small text-muted">16th March 2007 19:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Rename trocarproxy.exe trocarproxy.exe<br>is the most safe way to see if trocarproxy.exe is<br>currently running. I tryied all other ways but,<br>early or later, fails.<br>Rename a file by itself NEVER FAILED.<br><br>This crash only happens when this script is active,<br>and almost always. (not ALL the times.)<br><br>It always crashes when screensave activates.<br><br>It always crashes when Explorer.exe (or IE, or IE and Explorer.exe) is on and I open<br>Excell (2K) AND Word (2K).<br><br>What you Mean? Is it like put a detailprint after each<br>action to see if the crash occurs always at the same point?<br>I think IÂ´ll try to write this on registry or inifile, because when it crashes, I can do nthing else but press<br>reset (that buton that indian woman have above and between the eyes).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Mark Nascimento</span><br><span class="post-time small text-muted">16th March 2007 19:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Tell me more. How "s ?<br>Is it<br>var s1<br>var s2 ;etc<br>instead of $1, $2 etc ?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Mark Nascimento</span><br><span class="post-time small text-muted">16th March 2007 19:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Tell me more. How "s ?<br>Is it<br>var s1<br>var s2 ;etc<br>instead of $1, $2 etc ?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Mark Nascimento</span><br><span class="post-time small text-muted">16th March 2007 19:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Undesrstood you question.<br>Rename itself, in this case, is useless.<br>ThatÂ´s because there WAS a MB_YESNO after IfErrors,<br>asking if close it and restart or leave as is.<br>Now, only closes TrocarProxy.exe.<br><br>PLEASE !</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">16th March 2007 20:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">For me is difficult reading a script to follow the the logic and determine if there is something improper or incorrect, plus I haven't access to any 9x/Me machine so I can't go further with this.<br>So all I can say is what I'd do if I had the problem, try to debug it.<br><br>BTW In my neighborhood lives a family from India (you know India? that big country in south Asia with the ancient civilization), these people are my friends, I can assure you that aside from the fact that they are nice and gently persons, they look ordinary (no buttons).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Mark Nascimento</span><br><span class="post-time small text-muted">16th March 2007 23:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thank you.<br>I'll try this.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>