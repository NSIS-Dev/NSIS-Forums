<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Setting working directory on SM links" />

  <title>Setting working directory on SM links - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Setting working directory on SM links</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=117843">Setting working directory on SM links</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dmmorris</span><br />
      <span class="post-time small text-muted">14th December 2002 15:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Setting working directory on SM links</strong><br />
      I am new to NSIS and built a fairly extensive install script using the GUI installer. I got it all working under a deadline, now I want to know why a few things didn't work as I expected. The biggest issue I ran into was when I tried to create a start menu link or desktop link with a working directory pointing to the $INSTDIR. I found I could not create a link with a working directory different than where I was creating the link. I ended up creating a link in the install directory and then a link to that link on the start menu or desktop. Here is an exmaple of my workaround:<br />
      <br />
      <br />
      Section "Start Menu Shortcuts" SecStartMenu<br />
      SectionIn 1 2<br />
      SetOutPath "$INSTDIR"<br />
      CreateShortCut "$INSTDIR\Start Server.lnk" "$INSTDIR\start.bat"<br />
      CreateShortCut "$INSTDIR\Stop Server.lnk" "$INSTDIR\stop.bat"<br />
      SetOutPath "$SMPROGRAMS\${COMPANY}"<br />
      WriteINIStr "$SMPROGRAMS\${COMPANY}\${PRODUCT}.url" "InternetShortcut" "URL" "http://127.0.0.1/${COMPANY}/setup/edit.do?action=newJob"<br />
      CreateShortCut "$SMPROGRAMS\${COMPANY}\Start Server.lnk" "$INSTDIR\Start Server.lnk"<br />
      CreateShortCut "$SMPROGRAMS\${COMPANY}\Stop Server.lnk" "$INSTDIR\Stop Server.lnk"<br />
      SectionEnd<br />
      <br />
      I couldn't find this mentioned anywhere in the forums but it would seem like something others would have run into. I tested this on Windows XP and it may work differently on W98 based on feedback I received from a W98 tester.<br />
      <br />
      Is this the correct way to do this and will it work on all Windows platforms?<br />
      <br />
      Thanks,<br />
      <br />
      David Morris</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">14th December 2002 15:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">CreateShortcut takes its current directory from the output directory ($OUTDIR) which is set by SetOutPath.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dmmorris</span><br />
      <span class="post-time small text-muted">14th December 2002 16:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi kichik,<br />
      <br />
      Maybe this is an error then. If I set $OUTDIR to anything other than the directory where I will be installing the shortcut the CreateShortCut does not work. Here is what I tried originally:<br />
      <br />
      Section "Start Menu Shortcuts" SecStartMenu<br />
      SectionIn 1 2<br />
      SetOutPath "$INSTDIR"<br />
      WriteINIStr "$SMPROGRAMS\${COMPANY}\${PRODUCT}.url" "InternetShortcut" "URL" "http://127.0.0.1/${COMPANY}/setup/edit.do?action=newJob"<br />
      CreateShortCut "$SMPROGRAMS\${COMPANY}\Start Server.lnk" "$INSTDIR\start.bat"<br />
      CreateShortCut "$SMPROGRAMS\${COMPANY}\Stop Server.lnk" "$INSTDIR\stop.bat"<br />
      SectionEnd<br />
      <br />
      This wouldn't run until I changed SetOutPath to "$SMPROGRAMS". That made my software break because the working directory was wrong. The work-around was the solution in my first post.<br />
      <br />
      Thanks,<br />
      <br />
      David Morris</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">14th December 2002 16:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What version of NSIS are you using?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dmmorris</span><br />
      <span class="post-time small text-muted">14th December 2002 16:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am using Alpha 7, but I just checked and see that Beta 0 is now posted so I will retry with that version and let you know if I see a problem.<br />
      <br />
      Thanks again,<br />
      <br />
      David Morris</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dmmorris</span><br />
      <span class="post-time small text-muted">14th December 2002 18:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am having the same problem with the Beta 0 installer. Another issue cropped up in Beta 0 -- the MUI macros don't appear to be loading. For example, the MUI_DESCRIPTION_INIT macro is no longer working in this script. I also see the same thing with the MUI example script, which I used as a base for this script. Here is a test script that demonstrates the problem:<br />
      <br />
      [edited by kichik. please attach large scripts. script attached below :down:]<br />
      <br />
      Thanks,<br />
      <br />
      David Morris</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">14th December 2002 20:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">A lot of MUI macros have been changed from a7 to b0. Please read the the MUI readme and edit your script according to it if you want it to work with b0.<br />
      <br />
      What working directory do you get with this script if not $INSTDIR? Or does it not create the shortcut at all?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dmmorris</span><br />
      <span class="post-time small text-muted">15th December 2002 02:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks, I'll take a look at the readme and fix the alpha 7 -&gt; beta 0 problems. I bet the example.nsi script has the same problem. When I locate the problems in my script I will post the results if they apply to the MUI example script.<br />
      <br />
      When I try to create the link nothing is written and I get an error in the log window after running the installer. I don't know enough about NSI to know how to get more detailed debugging messages, but I will see if I can find out how to do more logging.<br />
      <br />
      Thanks,<br />
      <br />
      David Morris</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">15th December 2002 19:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The old example file will surely have all of these problems, but the new files from 2.0b0 compile just fine with 2.0b0...<br />
      <br />
      There is no way in NSIS to get detailed debugging messages.<br />
      Have you tried any other working directories but $INSTDIR? Try $TEMP for example and see if that works.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dmmorris</span><br />
      <span class="post-time small text-muted">15th December 2002 23:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I did get my script fixed so that the tool tips and everything work with beta 0. Like you said, I just had to remove some of the internal functions and replace them with includes -- not too hard. The examples.nsi I downloaded in the examples/modern ui directory appears to be based on the alpha 7 version. The date on the examples file I downloaded as part of beta 0 is August 29th.<br />
      <br />
      Using anything other than the the same directory fails. The following test does not run:<br />
      <br />
      SetOutPath "$TEMP"<br />
      WriteINIStr "$SMPROGRAMS\${COMPANY}\${PRODUCT}.url" "InternetShortcut" "URL" "http://127.0.0.1/${COMPANY}/setup/edit.do?action=newJob"<br />
      CreateShortCut "$SMPROGRAMS\${COMPANY}\Start Server.lnk" "$INSTDIR\start.bat"<br />
      CreateShortCut "$SMPROGRAMS\${COMPANY}\Stop Server.lnk" "$INSTDIR\stop.bat"<br />
      <br />
      This does work:<br />
      <br />
      SetOutPath "$SMPROGRAMS\${COMPANY}"<br />
      WriteINIStr "$SMPROGRAMS\${COMPANY}\${PRODUCT}.url" "InternetShortcut" "URL" "http://127.0.0.1/${COMPANY}/setup/edit.do?action=newJob"<br />
      CreateShortCut "$SMPROGRAMS\${COMPANY}\Start Server.lnk" "$INSTDIR\start.bat"<br />
      CreateShortCut "$SMPROGRAMS\${COMPANY}\Stop Server.lnk" "$INSTDIR\stop.bat"<br />
      <br />
      Thanks,<br />
      <br />
      David Morris</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">18th December 2002 15:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        I couldn't find this mentioned anywhere in the forums but it would seem like something others would have run into. I tested this on Windows XP and it may work differently on W98 based on feedback I received from a W98 tester.
      </blockquote>Does differently means it's working on 98? I have XP here too and I have no problems with shortcuts creation... Can you please test this on some other computers too? Are you running the installer as an adminstrator or a normal user?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dmmorris</span><br />
      <span class="post-time small text-muted">19th December 2002 16:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">After trying the shortcut creation sample and having it work, I went back and modified my script to create the start menu directory before creating the start menu links. From my testing, it seems that if the working directory matches the start menu directory the create shortcut will create the directory if it doesn't exist. If they are not the same, you have to add an extra step to create the short cut directory. So the following works OK:<br />
      <br />
      SetOutPath "$INSTDIR"<br />
      CreateDirectory "$SMPROGRAMS\${MUI_STARTMENU_VARIABLE}"<br />
      CreateShortCut "$SMPROGRAMS\${MUI_STARTMENU_VARIABLE}\Start Server.lnk" "$INSTDIR\start.bat"<br />
      <br />
      Taking out the create directory causes this to fail unless SetOutPath specifies "$SMPROGRAMS\${MUI_STARTMENU_VARIABLE}"<br />
      <br />
      I have not had a chance to go back and recreate this on W98, but I also had someone report a problem with the working directory on a W98 box. That same install definately worked on an XP box. I hope to be able to test this later today.<br />
      <br />
      Thanks,<br />
      <br />
      David Morris</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">19th December 2002 17:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Remove the contents of your old NSIS version before installing the latest snapshot. The Modern UI example.nsi has been renamed a long time ago.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">19th December 2002 23:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I should have noticed that eariler :(<br />
      <br />
      SetOutPath creates the directory too for ease of use. It's not CreateShortcut that creates the directory... Your script was only missing the directory creation command. A shortcut can't be created into a directory that doesn't exist... The last snippest you have posted it the way to go.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
