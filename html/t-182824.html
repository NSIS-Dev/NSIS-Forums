<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Resuming an install after 3rd party install requires reboot" />

  <title>Resuming an install after 3rd party install requires reboot - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Resuming an install after 3rd party install requires reboot</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=182824">Resuming an install after 3rd party install requires reboot</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jeffTN</span><br />
      <span class="post-time small text-muted">9th June 2004 23:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Resuming an install after 3rd party install requires reboot</strong><br />
      My installer runs a number of 3rd party installers. On older systems these installers prompt the user to reboot after they have finished.<br />
      <br />
      How can I either:<br />
      <br />
      1) Resume my installer after reboot at the point where it left off.<br />
      <br />
      or<br />
      <br />
      2) Disable the prompt so the user cannot reboot until the end of my installer.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">iceman_k</span><br />
      <span class="post-time small text-muted">10th June 2004 02:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you know your 3rd party installer is going to require a reboot, then one possible solution would be to:<br />
      1) Create a registry entry indicating where your installer left off.<br />
      2) Make an entry in HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce with your installer name and location.<br />
      3) Your installer will be run after the PC reboots.<br />
      4) Read the registry entry and continue your installation.<br />
      <br />
      This is a fairly simplistic method, but it may do the trick for you.<br />
      <br />
      I don't think you can disable the reboot prompt from the 3rd party installer.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">xpulse</span><br />
      <span class="post-time small text-muted">20th December 2004 14:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>?</strong><br />
      i have the same problem.<br />
      i know what you mean,<br />
      but how can I resume on the point of the reboot?<br />
      <br />
      that the user has not to click through the welcome page, license page, etc?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">iceman_k</span><br />
      <span class="post-time small text-muted">4th January 2005 05:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If the registry entry is set call the abort function in the Pre functions for the pages you want to skip.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">johnny44</span><br />
      <span class="post-time small text-muted">27th April 2005 14:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This thread has been inactive for quite a while but I hope someone will answer me. I'm really new to NSIS and I'm not really a programmation wiz so I'd like for someone to explain to me in greater details how to implement Iceman_k's method.<br />
      <br />
      My installer installs many 3rd party softwares. It has only a WELCOME page then a COMPONENTS page where the user selects which softwares he wants to install. Some require a reboot, some don't. Finally there is the INSTFILES page and the FINISH page. I need to resume with the next software setup after a program that needs to reboot the computer is installed.<br />
      <br />
      I was thinking about adding my installer in RunOnce after a program that needs to reboot is installed, rebooting and then checking strings in the registry in the .onInit section to skip straight to the installation of the next program. Does this make sense? How do I do this? What page do I resume to? How do I know what programs were selected? Regstry key, .ini file?<br />
      <br />
      Any help would be greatly appreciated.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">nusenucontesto</span><br />
      <span class="post-time small text-muted">6th May 2005 12:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hi everyone<br />
      <br />
      im using nsis 1 week ago, and i have make something similar.<br />
      <br />
      im installing some micro$oft packages that "require reboot".<br />
      <br />
      first of all, i have make a ghost image of my computer, to be able to "reset" program installation without problems.<br />
      <br />
      then i have something similar to:<br />
      <br />
      ExecWait "my.exe"<br />
      and if you press "yes" on the my.exe reboot question my program DOES NOT RESTART. I think is better to control restarting...<br />
      <br />
      anyway, before restarting i use this line to put my program on windows startup<br />
      <br />
      WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Run" "My program" "pathtomyprogram.exe"<br />
      <br />
      with this, i can restart my program after a reboot.<br />
      <br />
      here u can find a problem...how u know "my.exe" is not already installed?<br />
      <br />
      ok...i advice u to use regedit and to export registry(all) before and after installation, u could compare both .reg files with Compareit<br />
      <br />
      i hope that helps u<br />
      <br />
      (sorry for my engl, im spanish :P)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">fishweasel</span><br />
      <span class="post-time small text-muted">7th November 2006 13:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi, I am having the same issue. My installer requires a third party application to be launched twice (once for .net or MSDE depending on section chosen) with a reboot in between, and a services for unix install - which when run unattended automatically reboots the machine.<br />
      All in , my target machine requires 2 reboots before completion of final install steps.<br />
      <br />
      I understand about putting the runonce entry into the registry. What i dont understand is where or how to put set or get attributes flags into the installer - so it can continue from where it left off after the last reboot.<br />
      <br />
      At present i am looking at creating seperate installers which are put into windows startup - and would like to have it all under one installer.<br />
      <br />
      Is there any code examples about or any working installers that i can get a look at the .nsi file to see how its done ?<br />
      <br />
      If ya could help in lay terms as i am not a programmer and have a small knowledge of scripting.<br />
      <br />
      Thx<br />
      Fish</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">iceman_k</span><br />
      <span class="post-time small text-muted">7th November 2006 16:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK, this is a simplistic scenario.<br />
      Say you have 3 sections in your installer. The first one runs when the installer is first started, and the second and third are run after the first and second reboots.<br />
      When the first section is run, write relevant installer information (installation directory, options, etc.) to the registry along with a flag indicating that the first section was run.<br />
      After the first reboot, read the registry settings in the .onInit function. If the flag is set, then you can call abort in the pre-page callbacks to skip the pages. The first section can goto its end if the flag is set.<br />
      The second section then sets a flag indicating that it was run.<br />
      Rinse and repeat for as many reboots as you need.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">fishweasel</span><br />
      <span class="post-time small text-muted">14th November 2006 23:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi,<br />
      Thanks for your response iceman_k.<br />
      I have managed to figure out how to write flags and read them in <i>.OnInit</i> and using a test script, launch relevant messageboxes to let me know the syntax and details are correct. I am unsure, however as to how i would call the abort in the pre-page call backs. the list of pages in my script are just <i>'!insertmacro LicensePage'</i> etc.<br />
      Do i have to StrCmp the registry sring i have read within the macro somewhere ? or is there a simple <i>'goto postion x within instfiles'</i> flag or attribute i can use. As it stands i can jump to parts of the function depending on the status of the registry sring by using<br />
      <i>StrCmp $0 "first_reboot" 0 +3</i><br />
      etc - its just bypassing the license, sections InstDir etc that i cant seem to get my head around .<br />
      <br />
      Thx again in advance.<br />
      Fish</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">papandopala</span><br />
      <span class="post-time small text-muted">7th November 2008 14:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello. I have same same problem and I do understand iceman_k's solution. But my installer has many sections, its difficult to skip each section by checking a flag, and I need more than 1 reboot. 2 years have gone since last post. Maybe there is a better way now to skip sections or something. It would be nice if there was a way to skip whole section groups but I think its not possible. Does anybody know anything else?<br />
      Thank you.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
