<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Strange happenings between 2 installers"><title>Strange happenings between 2 installers - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Strange happenings between 2 installers</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=148325">Strange happenings between 2 installers</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">6th September 2003 13:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Strange happenings between 2 installers</strong><br>I have made a simple installer to get the file size (FileSizeNew) of say blah.bsp on my hard drive, then write the value to an ini file which I can store on the web.<br><br>A typical value is 5036424.<br><br>Now, my main installer downloads the ini file from the web, then gets the file size of that same file (blah.bsp) on the users' hard drive (in this case, the exact same blah.bsp on my hard drive).<br><br>However, the value is always 5036425 and not 5036424.<br>It seems to add 1 on even though it is exactly the same file that my installer is getting the file size from.<br><br>Right now I am taking 1 from the file size to get it to work, but this shouldn't be happening at all.<br><br>This is not just happening to the one bsp file, but for all the files.<br>Could it be because of different installer styles (the installer to first get the file sizes is only a basic one with just an instfiles page)<br><br>-Stu :cry:</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">6th September 2003 13:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Isn't it a webserver related issue (UNIX/DOS newlines etc.)?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br><span class="post-time small text-muted">6th September 2003 13:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">not a solution - but i understood it this way:<br><br>prog gets size from file &gt; ini<br>ini uploaded to web<br>prog gets ini from web &gt; size = size+1<br><br>So ini has changed?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">6th September 2003 13:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">No, the value written to my ini file on my hard drive is always 1 less even before upload.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br><span class="post-time small text-muted">6th September 2003 13:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">So<br><br>&gt;&gt; prog gets size from file &gt; ini<br>(1st step)<br><br>writes the wrong size?<br>routines are same? 2 different progs?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">6th September 2003 17:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That is correct.<br>Same path, two different progs.<br>Either the 1st prog is getting it wrong, or the main prog is.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br><span class="post-time small text-muted">6th September 2003 18:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">is it possible to get your code or codesnippets?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">6th September 2003 19:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">To write the file sizes to my ini (txt) file:<br></p><pre>
<code>Section ""<br> FileOpen $R0 "C:\progra~1\nsis\Dev\ddayupdater\gfs\newmaps.lst" r<br>loop:<br>ClearErrors<br> FileRead $R0 $R1<br>IfErrors done<br> Push $R1<br>  Call TrimNewLines<br> Pop $R1<br> StrCmp $R1 "" done<br> StrCmp $R1 eof done<br>Push "C:\quake2\dday\maps\$R1.bsp"<br>Call FileSizeNew<br>Pop $0<br> WriteINIStr "C:\progra~1\nsis\Dev\ddayupdater\du_objects.txt" "New map versions" "$R1.bsp" "$0"<br> FileRead $R0 $0<br> Push $0<br>  Call TrimNewLines<br> Pop $0<br> WriteINIStr "C:\progra~1\nsis\Dev\ddayupdater\du_objects.txt" "New map versions" "$R1.bsp-zip" "$0"<br>Goto loop<br>done:<br>FileClose $R0<br>SectionEnd</code>
</pre><br>
      <br>
      Then in my main installer, I read the values again from the downloaded du_objects.txt and compare:<br>
      <pre>
<code>ReadINIStr $1 "$TEMP\ddayupdates\objects.du" "New map versions" "$R3"<br> StrCmp $1 "" loop_maplist<br><br>ReadINIStr $2 "$TEMP\ddayupdates\objects.du" "New map versions" "$R3-zip"<br> StrCmp $2 $R0 0 loop_maplist<br><br> Push "$EXEDIR\maps\$R3"<br> Call FileSizeNew<br> Pop $2<br> StrCmp $1 $2 loop_maplist</code>
</pre><br>
      <br>
      du_objects.txt is here: <a href="http://myweb.tiscali.co.uk/imker/ddayupdater/du_objects.txt" target="_blank">http://myweb.tiscali.co.uk/imker/dda...du_objects.txt</a><br>
      <br>
      newmaps.lst is attached as newmaps.txt<br>
      <br>
      -Stu
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br>
      <span class="post-time small text-muted">6th September 2003 20:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>
      <pre>
<code> FileRead $R0 $0<br> Push $0<br><br>  Call TrimNewLines<br> Pop $0</code>
</pre><br>
      <br>
      Somewhere between these lines...<br>
      <br>
      "TrimNewLines" ?<br>
      <br>
      i often control vars with a messagebox<br>
      <br>
      eg.<br>
      MessageBox MB_ICONINFORMATION|MB_OK "'$R0', '$0'"<br>
      <br>
      So i can see quickly whats going wrong and where - i had such a situation here.<br>
      <br>
      hmm - a bug in "FileRead $R0 $0" ?
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">6th September 2003 21:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try calling FileSizeNew without any other things on the script with those two computers you were testing on. Though I can't see a reason it might fail, you should try and make sure that's not the reason.<br>
      <br>
      Also make sure the files are really the same size on both computers... Who knows, you might have some program/virus that tacks another byte on the end.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">6th September 2003 21:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by kichik</i><br>
        <b>Try calling FileSizeNew without any other things on the script with those two computers you were testing on. Though I can't see a reason it might fail, you should try and make sure that's not the reason.<br>
        <br>
        Also make sure the files are really the same size on both computers... Who knows, you might have some program/virus that tacks another byte on the end.</b>
      </blockquote>The bsps are the same, they are the same bsps on the same computer.<br>
      The computers are the same - I am testing on one.<br>
      <br>
      -Stu
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>