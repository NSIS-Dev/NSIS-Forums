<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Building CVS with scons" />

  <title>Building CVS with scons - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Building CVS with scons</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=213712">Building CVS with scons</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LIGHTNING UK!</span><br />
      <span class="post-time small text-muted">20th April 2005 22:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Building CVS with scons</strong><br />
      I hope someone can point me in the right direction here...<br />
      <br />
      I've just downloaded + installed Python 2.4, scons 0.96.1, Microsoft SDK (core package), Microsoft Visual C++ Toolkit 2003.<br />
      <br />
      When I attempt to compile using details here:<br />
      <br />
      <a href="http://nsis.sourceforge.net/index.php?id=2&amp;backPID=2&amp;tt_news=22" target="_blank">http://nsis.sourceforge.net/index.ph...D=2&amp;tt_news=22</a><br />
      <br />
      ...this is what I'm getting:<br />
      <br /></p>
      <pre>
<code>C:\NSIS&gt;scons<br />scons: Reading SConscript files ...<br />Using default tools configuration<br />AttributeError: SConsEnvironment instance has no attribute 'RES':<br />  File "SConstruct", line 94:<br />    target = SConscript(dirs = 'Source/exehead', build_dir = build_dir, duplicat<br />e = 0, exports = exports)<br />  File "C:\Python24\scons\SCons\Script\SConscript.py", line 581:<br />    return apply(method, args, kw)<br />  File "C:\Python24\scons\SCons\Script\SConscript.py", line 508:<br />    return apply(_SConscript, [self.fs,] + files, {'exports' : exports})<br />  File "C:\Python24\scons\SCons\Script\SConscript.py", line 239:<br />    exec _file_ in stack[-1].globals<br />  File "Source\exehead\SConscript", line 77:<br />    res = env.RES(resources)</code>
</pre><br />
      <br />
      and with the mstoolkit parameter<br />
      <br />
      <pre>
<code>C:\NSIS&gt;scons MSTOOLKIT=yes<br />scons: Reading SConscript files ...<br />Using Microsoft tools configuration<br />Checking for main() in C library gdi32... yes<br />Checking for main() in C library user32... yes<br />Checking for main() in C library version... yes<br />Checking for main() in C library pthread... no<br />Checking for main() in C library stdc++... no<br />Checking for main() in C library iconv... no<br />Checking for main() in C library libiconv... no<br /><br />scons: *** Multiple ways to build the same target were specified for: AdvSplash.<br />dll<br />File "Contrib\AdvSplash\SConscript", line 18, in ?</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">21st April 2005 02:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try to update your Scons to version 0.96.90 to see if that happens again.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LIGHTNING UK!</span><br />
      <span class="post-time small text-muted">21st April 2005 09:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I had already tried that actually, but the 0.96.1 seemed to be the better of the two! Anyway, here's the log from that version<br />
      <br /></p>
      <pre>
<code>C:\NSIS&gt;scons<br />scons: Reading SConscript files ...<br />TypeError: cannot concatenate 'str' and 'NoneType' objects:<br />  File "SConstruct", line 47:<br />    prefix = GetLaunchDir() + os.sep<br />  File "C:\Python24\scons\SCons\Script\SConscript.py", line 532:<br />    env = self.factory()<br />  File "C:\Python24\scons\SCons\Script\SConscript.py", line 512:<br />    default_env = SCons.Defaults.DefaultEnvironment()<br />  File "C:\Python24\scons\SCons\Defaults.py", line 65:<br />    _default_env = apply(SCons.Environment.Environment, args, kw)<br />  File "C:\Python24\scons\SCons\Memoize.py", line 815:<br />    klassdict['__init__'] = lambda self, *args, **kw: newinit(self, args, kw)<br />  File "...\SCons\Memoizer-init-lambda&lt;C:\Python24\scons\SCons\Memoize.py&gt;", lin<br />e 1:<br />    None<br />  File "C:\Python24\scons\SCons\Memoize.py", line 774:<br />    apply(actual_init, (self,)+args, kw)<br />  File "C:\Python24\scons\SCons\Memoize.py", line 1:<br />    """Memoizer<br />  File "C:\Python24\scons\SCons\Memoize.py", line 777:<br />    apply(super(cls, self).__init__, args, kw)<br />  File "C:\Python24\scons\SCons\Memoize.py", line 815:<br />    klassdict['__init__'] = lambda self, *args, **kw: newinit(self, args, kw)<br />  File "...\SCons\Memoizer-init-lambda&lt;C:\Python24\scons\SCons\Environment.py&gt;",<br /> line 465:<br />    None<br />  File "C:\Python24\scons\SCons\Memoize.py", line 774:<br />    apply(actual_init, (self,)+args, kw)<br />  File "C:\Python24\scons\SCons\Environment.py", line 511:<br />    apply_tools(self, tools, toolpath)<br />  File "C:\Python24\scons\SCons\Environment.py", line 129:<br />    env.Tool(tool, toolpath)<br />  File "C:\Python24\scons\SCons\Environment.py", line 1055:<br />    tool(self)<br />  File "C:\Python24\scons\SCons\Tool\__init__.py", line 87:<br />    apply(self.generate, ( env, ) + args, kw)<br />  File "C:\Python24\scons\SCons\Tool\default.py", line 40:<br />    for t in SCons.Tool.tool_list(env['PLATFORM'], env):<br />  File "C:\Python24\scons\SCons\Tool\__init__.py", line 382:<br />    c_compiler = FindTool(c_compilers, env) or c_compilers[0]<br />  File "C:\Python24\scons\SCons\Tool\__init__.py", line 301:<br />    if t.exists(env):<br />  File "C:\Python24\scons\SCons\Tool\intelc.py", line 278:<br />    top = get_intel_compiler_top()<br />  File "C:\Python24\scons\SCons\Tool\intelc.py", line 142:<br />    top = get_intel_registry_value('ProductDir', version, abi)<br />  File "C:\Python24\scons\SCons\Tool\intelc.py", line 69:<br />    K = 'Software\\Intel\\Compilers\\C++\\' + version + '\\'+abi.upper()</code>
</pre><br />
      <br />
      Same for both with and without the MSTOOLKIT=yes parameter.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">21st April 2005 16:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you're using the toolkit you must use MSTOOLKIT=yes. It might not work because it can not find cl.exe in the path. Try running scons using the Visual C++ Toolkit 2003 Command Prompt. The toolkit installs a link to it on the start menu and in its installation directory.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LIGHTNING UK!</span><br />
      <span class="post-time small text-muted">21st April 2005 19:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok well I finally kinda got it working after a lot of messing around (not knowing what I'm doing!).<br />
      <br />
      MakeLangId wont complile because it cant find AFXRES.H or WINRES.h.<br />
      <br />
      halibut fails to compile because the environment paths aren't set up correctly. The MSTOOLKIT bit is effectivly ignored in the SConscript in its folder as only the default environment is used.<br />
      <br />
      You also need to ensure hhc is installed and its folder added to the 'path' environment variable.<br />
      <br />
      Download it from here:<br />
      <br />
      <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/htmlhelp/html/hwMicrosoftHTMLHelpDownloads.asp" target="_blank">http://msdn.microsoft.com/library/de...pDownloads.asp</a><br />
      <br />
      contrib/startmenu also wont compile. Needs afxres.h and winres.h too.<br />
      <br />
      <br />
      Once all that's out of the way, I'm left with this:<br />
      <br /></p>
      <pre>
<code>C:\NSIS&gt;scons MSTOOLKIT=yes<br />scons: Reading SConscript files ...<br />Using Microsoft tools configuration<br />Checking for main() in C library gdi32... yes<br />Checking for main() in C library user32... yes<br />Checking for main() in C library version... yes<br />Checking for main() in C library pthread... no<br />Checking for main() in C library stdc++... no<br />Checking for main() in C library iconv... no<br />Checking for main() in C library libiconv... no<br />Using Microsoft tools configuration<br />scons: done reading SConscript files.<br />scons: Building targets ...<br />scons: *** Source `Contrib\AdvSplash\AdvSplash' not found, needed by target `build\AdvSplash\AdvSplash.map'.  Stop.<br />scons: building terminated because of errors.</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">21st April 2005 19:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        It's now also very easy to build NSIS using the free Visual C++ Toolkit 2003 and Platform SDK.
      </blockquote>Kichik just forgot to mention about the "HTML Help Workshop" to compile the docs.<br />
      <br />
      Now, about the problem, it's maybe because you only have the core of Platform SDK. I downloaded all packages, and the latest update for WinXP SP2, and the compilation works.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LIGHTNING UK!</span><br />
      <span class="post-time small text-muted">21st April 2005 20:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, it seems the beta of scons works ok but the old one wont.<br />
      <br />
      I'm doing this build on a clean install of Windows 2003, so chances are, others will need to do them too.<br />
      <br />
      I expect you lot have already got loads of bits installed which is making life easier for you!<br />
      <br />
      Copying over the missing header files from MakeLangId and StartMenu isn't a big deal but I'd like the 'Documentation' chunk of the SContruct file fixed so that the correct environment variables are set up and it doesn't again complain about not being able to find cl.exe - which obviously it has been able to find ok for the rest of the script before that point.<br />
      <br />
      I ended up changing SConstruct<br />
      <br /></p>
      <pre>
<code>stub_env = envs[0]<br />makensis_env = envs[1]<br />plugin_env = envs[2]<br />util_env = envs[3]</code>
</pre><br />
      <br />
      to<br />
      <br />
      <pre>
<code>stub_env = envs[0]<br />makensis_env = envs[1]<br />help_env = makensis_env.Copy()<br />plugin_env = envs[2]<br />util_env = envs[3]</code>
</pre><br />
      <br />
      and then<br />
      <br />
      <pre>
<code>halibut = SConscript(<br />        dirs = 'Docs/src/bin/halibut',<br />        build_dir = build_prefix + 'halibut',<br />        duplicate = 0<br />)</code>
</pre><br />
      <br />
      to<br />
      <br />
      <pre>
<code>halibut = SConscript(<br />        dirs = 'Docs/src/bin/halibut',<br />        build_dir = build_prefix + 'halibut',<br />        duplicate = 0,<br />        exports = {'env' : help_env.Copy()}<br />)</code>
</pre><br />
      <br />
      I then changed Docs\src\bin\halibut\SConscript<br />
      <br />
      by changing:<br />
      <br />
      <pre>
<code>env = Environment()</code>
</pre><br />
      <br />
      to<br />
      <br />
      <pre>
<code>Import('env')</code>
</pre><br />
      <br />
      It then compile / linked just fine.<br />
      <br />
      I've no idea if what I've done above is ok, but it works... and that's all that matters!
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">21st April 2005 20:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">halibut SConscript was indeed using the wrong environment. I've already fixed this in the latest CVS version in a manner similar to what you've suggested.<br />
      <br />
      However, the current CVS can fail building NSIS Update. You can use the -k command line option to keep building anyway.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LIGHTNING UK!</span><br />
      <span class="post-time small text-muted">21st April 2005 21:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, I'll keep an eye out for the updated CVS version, it still seems to show the old one on sourceforge.<br />
      <br />
      Can I also point out the makensis.nsi script now fails for 2 reasons (rather than just the 1 it's failed on for a while now).<br />
      <br />
      1. 'bin2h.exe' is still referenced.<br />
      <br />
      2. 'Contrib\Library\LibraryLocal\*.exe' no longer exists because the LibraryLocal.exe is in the 'build\Library\LibraryLocal' folder.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">24th April 2005 18:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by kichik</i><br />
        <b>halibut SConscript was indeed using the wrong environment. I've already fixed this in the latest CVS version in a manner similar to what you've suggested.</b>
      </blockquote>Oops, was thinking of something else. It's really fixed in CVS now.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">iceman_k</span><br />
      <span class="post-time small text-muted">26th April 2005 05:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">A new problem building the docs:<br /></p>
      <pre>
<code><br />C:\projects\NSIS&gt;scons -j4 MSTOOLKIT=yes<br />scons: Reading SConscript files ...<br />Using Microsoft tools configuration<br />Checking for main() in C library gdi32... (cached) yes<br />Checking for main() in C library user32... (cached) yes<br />Checking for main() in C library version... (cached) yes<br />Checking for main() in C library pthread... (cached) no<br />Checking for main() in C library stdc++... (cached) no<br />Checking for main() in C library iconv... (cached) no<br />Checking for main() in C library libiconv... (cached) no<br />scons: done reading SConscript files.<br />scons: Building targets ...<br />Copy("C:\projects\NSIS\build\release\Docs", "Docs\src/../style.css")<br />scons: *** [build\release\Docs\NSIS.chm] Permission denied<br />scons: building terminated because of errors.<br /></code>
</pre><br />
      <br />
      The problem is that the files being copied in the Docs Sconscript file are read-only and that is killing Scons.<br />
      So either the destination files should be deleted first or the copy action should force an overwrite.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">26th April 2005 15:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">installed latest python (2.4.1) and scons (0.96.90).<br />
      opening console at my nsis root (E:\Programme\NSIS\) and typing "scons" just gives me an error "file or command not found".<br />
      <br />
      what am i doing wrong?<br />
      <br />
      read the news carefully, theres nothing else mentioned.<br />
      <br />
      or do i really need the vcpp toolkit?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">iceman_k</span><br />
      <span class="post-time small text-muted">26th April 2005 17:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Make sure that python, VC toolkit and hhc.exe are in your path.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LIGHTNING UK!</span><br />
      <span class="post-time small text-muted">26th April 2005 19:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Can anyone fix it so that the !InstallNSIS.BAT file (and the script it calls) actually works?<br />
      <br />
      It's great that I can now compile the CVS data without any critical errors, but if I then get stuck building the installer, it's not much use ;)<br />
      <br />
      Thanks!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">26th April 2005 20:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        Make sure that python, VC toolkit and hhc.exe are in your path.
      </blockquote>that they are in WHICH path?<br />
      <br />
      and why isn't that fact mentioned anywhere in the documentation/news?<br />
      <br />
      if i install python, it installs to "C:\Program Files\Python24" (on english systems), on mine this would be E:\Programme\Python.<br />
      scons uses the same dir:<br />
      E:\Programme\Python\scons\SCons<br />
      (doubled folder may be a bug in the installer of scons - they didnt use nsis :D)<br />
      <br />
      nsis is installed in E:\Programme\NSIS<br />
      vctoolkit (which i now downloaded and installed) is in<br />
      "E:\Programme\Microsoft VisualC++ 2003 Toolkit"<br />
      <br />
      now, what files do i have to put to which directories manually?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LIGHTNING UK!</span><br />
      <span class="post-time small text-muted">26th April 2005 20:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">if you type 'set path' from the command prompt, you should see e:\programme\python in there somewhere. If not, you need to add it via the 'properties -&gt; Advanced -&gt; Environment variables' bit when you right click My Computer.<br />
      <br />
      After that, it should just be 'scons MSTOOLKIT=yes' to get it to compile. Scons configures the other path settings it needs. Dont forget you need hhc (help workshop from microsoft) installed too.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">26th April 2005 20:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">thanks, it works!!!<br />
      great!<br />
      but PLEASE ADD THIS immediately to a faq or similar.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">26th April 2005 20:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        E:\Programme\NSIS&gt;scons -j4 MSTOOLKIT=yes<br />
        scons: Reading SConscript files ...<br />
        <br />
        scons: *** Path does not exist for option CPPPATH:<br />
        File "SConstruct", line 61, in ?<br />
        E:\Programme\NSIS&gt;
      </blockquote>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LIGHTNING UK!</span><br />
      <span class="post-time small text-muted">26th April 2005 20:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ermm don't know the answer to that one, sorry!<br />
      <br />
      if you type 'set' from the command prompt, do you get a line like:<br />
      <br />
      VCToolkitInstallDir=C:\Program Files\Microsoft Visual C++ Toolkit 2003\<br />
      <br />
      ?? (Obviously your path will be different if you changed it from the default)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">26th April 2005 21:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">i do get this path.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LIGHTNING UK!</span><br />
      <span class="post-time small text-muted">26th April 2005 21:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ok, still no idea then.<br />
      <br />
      I thought I'd had pretty much every problem is was possible to have. Now it seems I didn't ;)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">26th April 2005 21:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">iceman_k, that's very weird... SCons first tries to copy the file and then set the destination to writable:</p>
      <pre>
<code>def _copy_func(src, dest):<br />    shutil.copy2(src, dest)<br />    st=os.stat(src)<br />    os.chmod(dest, stat.S_IMODE(st[stat.ST_MODE]) | stat.S_IWRITE)</code>
</pre>I'll see if I can find a workaround or if I'm reading this right later.<br />
      <br />
      LIGHTNING UK!, makensis.nsi will be fixed later. I'm not too sure what I want to do with it yet. I'd be great if the SCons script could generate the installer script too so I only have to specify what to install and where only once. For now, you can use NSIS from the build directory or use:
      <pre>
<code>scons PREFIX="C:\Program Files\NSIS" install</code>
</pre><br />
      <br />
      Comm@nder21, are you using the latest version from CVS? I don't get any error with CPPPATH and I'm using the same versions of Python and SCons as you. Is anyone else getting this error?<br />
      <br />
      Please don't post every SCons related question or problem in this thread. It'll get pretty huge and hard to follow.<br />
      <br />
      BTW, I've finally managed to get wine to compile on my linux. It only took a night. I've also managed to get the VC Toolkit, Python and SCons to run on it. With some minor changes to everything involved, NSIS builds just fine. All except the CHM which still needs some love. A complete build took only 3 and half hours on my all so powerful Pentium 100. Once it's completely working, it'll be used to create real nightly snapshots.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">27th April 2005 16:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">yep, i updated it just atm.<br />
      <br />
      could you have a look at your environment vars if theres one called CPPPATH ?<br />
      <br />
      i don't have one, that may be the problem.<br />
      <br />
      installed all programs with their native installer programs, though.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">28th April 2005 18:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I don't have CPPPATH in my environment. CPPPATH is an option which can be used on the command line. It has a default value of None. None should be a "valid" path. Run scons with --debug=stacktrace and attach the stack trace. To get around this, you can try giving it a real path in CPPPATH.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">28th April 2005 19:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">iceman_k, I was looking at the wrong place. It's not the copy function that fails, it's the deletion of the target file before the installation. It does however make some sense as read only files shouldn't be touched. I am willing to accept with this reasonable limitation. If you wish, you can submit a <a href="https://sourceforge.net/tracker/?atid=398971&amp;group_id=30337&amp;func=browse" target="_blank">bug report</a> to scons.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">30th April 2005 16:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">updated cvs, which contained a new sconstruct scriptfile, but gave the same error.<br />
      then ran with your debug instruction:<br /></p>

      <blockquote>
        SCons error: Warning: stacktrace is not a valid debug type
      </blockquote>/edit:<br />
      updated scons to 0.96.90, like you posted in <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=214474" target="_blank">the other thread</a>.<br />
      now i get other errors, which i think are results of missing platform sdk :)<br />
      (this **** microsoft server gives me no more than 10kbit/s, no pausable downloads, not more than 2 connections a time!!!!)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">1st May 2005 09:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">downloaded and installed platform sdk (under admin account).<br />
      get the following errors:<br /></p>

      <blockquote>
        E:\Programme\NSIS&gt;scons -j4 MSTOOLKIT=yes<br />
        scons: Reading SConscript files ...<br />
        TypeError: cannot concatenate 'str' and 'NoneType' objects:<br />
        File "SConstruct", line 54:<br />
        defenv = Environment()<br />
        File "E:\Programme\Python\scons\SCons\Memoize.py", line 815:<br />
        klassdict['__init__'] = lambda self, *args, **kw: newinit(self, args, kw)<br />
        File "...\SCons\Memoizer-init-lambda&lt;E:\Programme\Python\scons\SCons\Memoize.p<br />
        y&gt;", line 1:<br />
        None<br />
        File "E:\Programme\Python\scons\SCons\Memoize.py", line 774:<br />
        apply(actual_init, (self,)+args, kw)<br />
        File "E:\Programme\Python\scons\SCons\Memoize.py", line 1:<br />
        """Memoizer<br />
        File "E:\Programme\Python\scons\SCons\Memoize.py", line 777:<br />
        apply(super(cls, self).__init__, args, kw)<br />
        File "E:\Programme\Python\scons\SCons\Memoize.py", line 815:<br />
        klassdict['__init__'] = lambda self, *args, **kw: newinit(self, args, kw)<br />
        File "...\SCons\Memoizer-init-lambda&lt;E:\Programme\Python\scons\SCons\Environme<br />
        nt.py&gt;", line 465:<br />
        None<br />
        File "E:\Programme\Python\scons\SCons\Memoize.py", line 774:<br />
        apply(actual_init, (self,)+args, kw)<br />
        File "E:\Programme\Python\scons\SCons\Environment.py", line 511:<br />
        apply_tools(self, tools, toolpath)<br />
        File "E:\Programme\Python\scons\SCons\Environment.py", line 129:<br />
        env.Tool(tool, toolpath)<br />
        File "E:\Programme\Python\scons\SCons\Environment.py", line 1055:<br />
        tool(self)<br />
        File "E:\Programme\Python\scons\SCons\Tool\__init__.py", line 87:<br />
        apply(self.generate, ( env, ) + args, kw)<br />
        File "E:\Programme\Python\scons\SCons\Tool\default.py", line 40:<br />
        for t in SCons.Tool.tool_list(env['PLATFORM'], env):<br />
        File "E:\Programme\Python\scons\SCons\Tool\__init__.py", line 382:<br />
        c_compiler = FindTool(c_compilers, env) or c_compilers[0]<br />
        File "E:\Programme\Python\scons\SCons\Tool\__init__.py", line 301:<br />
        if t.exists(env):<br />
        File "E:\Programme\Python\scons\SCons\Tool\intelc.py", line 278:<br />
        top = get_intel_compiler_top()<br />
        File "E:\Programme\Python\scons\SCons\Tool\intelc.py", line 142:<br />
        top = get_intel_registry_value('ProductDir', version, abi)<br />
        File "E:\Programme\Python\scons\SCons\Tool\intelc.py", line 69:<br />
        K = 'Software\\Intel\\Compilers\\C++\\' + version + '\\'+abi.upper()<br />
        E:\Programme\NSIS&gt;
      </blockquote>system:<br />
      - windows xp sp2<br />
      - psdk for sp2<br />
      - vc toolkit 2003<br />
      - python 2.41<br />
      - scons 0.96.90<br />
      <br />
      all installed without errors.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">iceman_k</span><br />
      <span class="post-time small text-muted">1st May 2005 13:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Make sure to register the PSDK paths.<br />
      c:\program files\microsoft sdk\setenv.bat</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">1st May 2005 19:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">i did</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">2nd May 2005 12:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">i now probably know, why scons makes so much problems.<br />
      <br />
      running it from cmd.exe gives me the last reported errors.<br />
      <br />
      running it from the vc toolkit prompt brings me the error, that it couldn't find the psdk.<br />
      so, at first it doesnt find the vc toolkit.<br />
      <br />
      the psdk is properly installed, and registered, but the scons script searches the wrong registry values.<br />
      i searched through the scons script, which contains the following lines:<br />
      <b>mstoolkit.py</b><br /></p>

      <blockquote>
        PlatformSDKDir = ""<br />
        try:<br />
        PlatformSDKDir = SCons.Util.RegGetValue(SCons.Util.HKEY_LOCAL_MACHINE, r'SOFTWARE\Microsoft\MicrosoftSDK\Directories\Install Dir')[0]<br />
        PlatformSDKDir = str(PlatformSDKDir)<br />
        except SCons.Util.RegError:<br />
        raise SCons.Errors.InternalError, "The Platform SDK directory was not found in the registry."
      </blockquote>it searches in HKLM\SOFTWARE\Microsoft\MicrosoftSDK\Directories\Install Dir<br />
      this is wrong.<br />
      on my system (see above for details) the install dir is stored in the key:<br />
      HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MicrosoftSDK\InstalledSDKs\B44C7E10-89BD-4A32-A3BF-D9D0BC4C9A05<br />
      as value:<br />
      Install Dir<br />
      <br />
      changing this solves the problem with the psdk.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">2nd May 2005 13:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">well, it now compiles (with -k) but has lots of troubles.<br />
      it always tries to run<br />
      "E:\Programme\Microsoft Platform SDK\\bin\Win64\link.exe"<br />
      which of course doesn't exist.<br />
      <br />
      1. theres a \ too much<br />
      2. i'm running win32 not 64.<br />
      <br />
      is there ANYONE out there who has a WORKING script?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">2nd May 2005 13:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">found the link.exe after some searching:<br />
      it's not provided with the psdk.<br />
      it's provided with the vc-toolkit:<br />
      E:\Programme\Microsoft Visual C++ Toolkit 2003\bin\link.exe<br />
      <br />
      why does scons use that ****** paths?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">3rd May 2005 18:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Install the PSDK for Windows 2003 server and it should work. See <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=214474" target="_blank">this thread</a> for more information.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">13th May 2005 21:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">finally got it working.<br />
      some more problems:<br />
      the environment vars still don't work.<br />
      with latest cvs (updated today) it still does not find the vc++ toolkit itself, even if the vars are set correctly.<br />
      the environment code for scons is simply wrong, there were already solutions posted, you may also find one at this link:<br />
      <a href="http://www.scons.org/faq.php#SS_4_3" target="_blank">http://www.scons.org/faq.php#SS_4_3</a><br />
      plz update the sconstruct file in cvs.<br />
      <br />
      also, theres still the wrong registry path set in the mstoolkit.py:<br /></p>

      <blockquote>
        SOFTWARE\Microsoft\MicrosoftSDK\Directories\Install Dir
      </blockquote>this is your one. its wrong. i tried it both with the xpsp2 sdk and the 2003sp1 one.<br />
      for the 2003sp1 one (the only one really working) it must be:<br />

      <blockquote>
        SOFTWARE\Microsoft\MicrosoftSDK\InstalledSDKs\8F9E5EF3-A9A5-491B-A889-C58EFFECE8B3\Install Dir
      </blockquote>pls fix that too.<br />
      thanks.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">14th May 2005 19:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">mstoolkit.py adds the bin directory of the toolkit to the path, there's no need to add the entire os path to scons' path. I have updated it to give up if it can't find VCToolkitInstallDir in the environment instead of trying "C:\Program Files\Microsoft Visual C++ Toolkit 2003".<br />
      <br />
      I have tried installing a fresh copy of PSDK on a fresh computer and indeed the registry key read in mstoolkit.py was not there. Seems like they're removed it in one of the latest versions. I have updated mstoolkit.py to look in the MSSDK environment variable. I have also made it search that registry key with the GUID, even though it's probably a bad idea. It doesn't exist on the older versions, so it'll probably change in the future.<br />
      <br />
      So now you must have two envrionment variables:</p>

      <ul>
        <li>MSSDK should point to the Platform SDK installation directory. It's created automatically, if you choose Register Environment Variables during installation of the PSDK.</li>

        <li>VCToolkitInstallDir should point to the Visual C++ Toolkit installation directory. It's also created automatically during installation.</li>
      </ul><br />
      Thanks for the information.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">17th June 2005 22:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have tried building on another with system which has just the toolkit and the Platform SDK and I got an error resulting from <a href="http://sourceforge.net/tracker/?group_id=30337&amp;atid=398971&amp;func=detail&amp;aid=1169089" target="_blank">this bug</a>. It can be easily identified by the last place in the stack trace which is intelc.py.<br />
      <br />
      This bug has already been fixed in the latest CVS version of SCons. However, no versions were released since 0.96.90. Until version 0.97 is released you can use <a href="http://nsis.sourceforge.net/scons-0.96.nsis.win32.exe" target="_blank">this build</a> I made from CVS today. Note that unlike 0.96.*, it doesn't install scons.bat in the main Python directory but in a subdirectory called Scripts. So if you want to change your PATH environment variable so you can just type 'scons' and not C:\Python\Scripts\scons.bat, don't forget to add C:\Python\Scripts.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br />
      <span class="post-time small text-muted">11th July 2005 00:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This is very off topic but it is nice to see LIGHTING UK! on the forums after the fall of dvd decrypter.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">iceman_k</span><br />
      <span class="post-time small text-muted">28th July 2005 00:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Kickhik:<br />
      Any idea about what could be causing this problem:<br /></p>

      <blockquote>
        C:\projects\NSIS\Development&gt;scons MSTOOLKIT=yes<br />
        scons: Reading SConscript files ...<br />
        Delete("nsis-27-Jul-2005.cvs")<br />
        Delete(".instdist")<br />
        Delete(".test")<br />
        Using Microsoft tools configuration<br />
        Checking for main() in C library gdi32... (cached) yes<br />
        Checking for main() in C library user32... (cached) yes<br />
        Checking for main() in C library version... (cached) yes<br />
        Checking for main() in C library pthread... (cached) no<br />
        Checking for main() in C library stdc++... (cached) no<br />
        Checking for main() in C library iconv... (cached) no<br />
        Checking for main() in C library libiconv... (cached) no<br />
        Checking for main() in C++ library cppunit... (cached) no<br />
        scons: done reading SConscript files.<br />
        scons: Building targets ...<br />
        Copy("C:\projects\NSIS\Development\build\release\Docs\chm", "Docs\src/../style.css")<br />
        scons: *** [build\release\Docs\chm\NSIS.chm] Permission denied<br />
        scons: building terminated because of errors.
      </blockquote>I don't get it with a clean build, but I still get it when I try rebuilding. Is there some verbose mode I can enable to get more details?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">28th July 2005 00:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Did you put the HTML Help compiler is your path?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">iceman_k</span><br />
      <span class="post-time small text-muted">28th July 2005 03:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It works fine if I do a clean build- it builds the CHM and everything. However, if I delete build\release\Docs\chm\NSIS.chm and run Scons again, it fails.<br />
      The reason it fails is that the Copy() commands below do not change the readonly attribute of the files.<br /></p>
      <pre>
<code><br />        chm_builder = Builder(<br />                action = [<br />                        Copy(build_dir, '${SOURCE.dir}/../style.css'),<br />                        Copy(build_dir, '${SOURCE.dir}/chmlink.js'),<br />                        Copy(build_dir, '${SOURCE.dir}/nsis.hhp'),<br />                        Action('cd "%s" &amp;&amp; "%s" ${SOURCES.abspath}' % (build_dir, halibut[0].abspath)),<br />                        hhc_action<br />                ]<br />        )<br /></code>
</pre><br />
      Since I have configured my CVS with watch/edit enabled, non-edited files have the readonly attribute set. If the build directory is empty, these are copied over without a problem.<br />
      However, the next time I run Scons, the copy fails because the target files are readonly.<br />
      This is in spite of the _copy_func definition ostensibly changing the status to writeable:<br />
      <pre>
<code><br />def _copy_func(src, dest):<br />    shutil.copy2(src, dest)<br />    st=os.stat(src)<br />    os.chmod(dest, stat.S_IMODE(st[stat.ST_MODE]) | stat.S_IWRITE)<br /></code>
</pre><br />
      <br />
      So, eventually, my work around was to create a build.bat file which fixes the readonly attribute for me:<br />
      <pre>
<code><br />setlocal<br />set MSSDK=C:\Program Files\Microsoft SDK<br />set VCToolkitInstallDir=C:\Program Files\Microsoft Visual C++ Toolkit 2003<br />path %path%;c:\python;c:\Program Files\HTML Help Workshop<br />call scons MSTOOLKIT=yes &gt; build.log 2&gt;&amp;1<br />if exist build\release\Docs\chm (<br />pushd build\release\Docs\chm<br />if exist style.css attrib -r -s -h -a style.css<br />if exist chmlink.js attrib -r -s -h -a chmlink.js<br />if exist nsis.hhp attrib -r -s -h -a nsis.hhp<br />popd<br />)<br />if exist build\release\Docs\html (<br />pushd build\release\Docs\html<br />if exist style.css attrib -r -s -h -a style.css<br />popd<br />)<br />call scons MSTOOLKIT=yes PREFIX="C:\Projects\NSIS" install &gt;&gt; build.log 2&gt;&amp;1<br />endlocal<br /></code>
</pre>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
