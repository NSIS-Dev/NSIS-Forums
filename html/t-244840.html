<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="another (external) patcher for work with nsis -&gt; aPatch (instead vpatch)"><title>another (external) patcher for work with nsis -&gt; aPatch (instead vpatch) - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">another (external) patcher for work with nsis -&gt; aPatch (instead vpatch)</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=244840">another (external) patcher for work with nsis -&gt; aPatch (instead vpatch)</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br><span class="post-time small text-muted">28th April 2006 15:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>another (external) patcher for work with nsis -&gt; aPatch (instead vpatch)</strong><br>geez i was looking these days for a script or patcher for nsis<br>(in general - a patcher with simple byte replacing at fix address)<br><br>the most patchers are search&amp;replace in all combinations.<br>but that wasnt wanted, moreover they need a source/target file.<br>(vpatch wasnt uselful same way)<br><br>so i found aPatch<br><a href="http://www.ibsensoftware.com/" target="_blank">http://www.ibsensoftware.com/</a><br><br>this patcher works with a script which can be written from nsis.<br><br>easy way:<br></p><blockquote>start<br>open &lt;file&gt;<br>search &lt;old_word&gt;<br>write &lt;new_word&gt;<br>quit<br>end</blockquote>(word can be text or hexstrings)<br>(use fileopen/filewrite/filewritebyte0D0A/fileclose)<br><br>the the script must be compiled<br>"apatch.exe script.aps"<br>(apatch.exe need to be included in nsis-package /pluginsdir)<br>(File /oname=$PLUGINSDIR\apatch.exe "apatch.exe")<br><br>it generates a simple patch.exe.<br>unfortunaltely it has a GUI with a textfiled and two<br>buttons: "Patch" and "Quit"<br><br>but is is the only me known one:<br>1) freeware<br>2) script-based<br>3) very easy (hand full of commands)<br><br>In my case easy as simple<br>- in nsis: get word, get file (io)<br>- write apatch-script<br>- compile with apatch<br>- start patch (execwait)<br>- remove all temp-files<br>- done<br><br>part of my script:<br><blockquote>start<br>open &lt;file&gt;<br>size 1227776<br>onerror goto error<br><br>backup on<br>offset 933125<br>write &lt;new_text&gt;<br>print "Success"<br>goto done<br><br>error:<br>print "Failed"<br><br>done:<br>quit<br>end</blockquote><font color="green">(open file, check filesize, goto offset, write text/hexstrings, quit)</font><br><br>Use NSIS to write the filename, old_text, new_text, custom<br>errormessages aso.<br><br>aPatch is recognized from PEid, so it contains specific<br>bytes as a exe-packer - and "patch.exe" is packed with this<br>method - so you cant disassemble it to get rid of the GUI.<br><br>feel free to post other soulutions this way - if you have<br>one without GUI - write it here pls.<br><br>btw, i tried "fileseek #", but then i got 933125 00-bytes<br>and then my text. so nsis can only work on textfiles !?</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">galil</span><br><span class="post-time small text-muted">28th April 2006 17:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>btw, i tried "fileseek #", but then i got 933125 00-bytes and then my text. so nsis can only work on textfiles !?</blockquote>If you open file in "w" mode that is what you're supposed to get.<br>Read NSIS manual about differences between r/w/a<br><br><br><blockquote>moreover they need a source/target file.<br>(vpatch wasnt uselful same way)</blockquote>Why doesn't that fit your needs?<br>If you need fixed offset patch, automatic compare of original/patched files that is offered by all these kind of patch creators just make it easier for you. Why input all the offsets and byte values by hand when you can have it done automatically.<br><br><blockquote>(apatch.exe need to be included in nsis-package /pluginsdir)</blockquote>Why do you need the patcher to be compiled on the user's system?<br>Normally you compile patcher on your system and distribute it.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br><span class="post-time small text-muted">28th April 2006 18:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">hmm, i needed filewrite /a ?<br>idd i used /w...<br>vpatch needs a source and target file to compare,<br>like all others i know. there was no one with a simple<br>replace like apatch.<br>The source file isnt fixed, that was the main problem,<br>so <b>specific code changes from time to time</b> the patcher is used.<br>it just modifies a printed line which is given at a fixed address.<br>so search/replace isnt my friend you see!?<br><br>i need to compile at runtime but user has no apatch on its system ;)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">28th April 2006 18:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Using w will delete the contents of the file.<br>Using a will not delete the contents of the file and so using FileSeek will allow you to move the write pointer to the end of the file for continuous writing.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br><span class="post-time small text-muted">28th April 2006 18:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">well i think youre right, i did it now with /a and it works, thx so much.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">galil</span><br><span class="post-time small text-muted">28th April 2006 18:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Brummelchen</i><br>it just modifies a printed line which is given at a fixed address.</blockquote>So you could simply use NSIS built-in functions FileSeek and FileWrite (and maybe also FileWriteByte if you need to null-terminate that string), file opened in "a" mode of course...</div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>