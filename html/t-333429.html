<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Write registry key to HKEY_CURRNET_USER from RunAs Admin installer"><title>Write registry key to HKEY_CURRNET_USER from RunAs Admin installer - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Write registry key to HKEY_CURRNET_USER from RunAs Admin installer</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=333429">Write registry key to HKEY_CURRNET_USER from RunAs Admin installer</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">marcins</span><br><span class="post-time small text-muted">11th August 2011 12:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Write registry key to HKEY_CURRNET_USER from RunAs Admin installer</strong><br>Hello,<br>I was looking for this a few days and I still don't know how to do this, so maybe someone here can help me!<br>I have installer that must be run as Admin to copy all files into right directories but at same time I need to write registry key to HKEY_CURRNET_USER (can be all users in the system, doesn't matter). But when I'll run installer as Admin it will write registry key (only) to Admin's HKEY_CURRNET_USER, not user that I want.<br><br>So is there any way/script to write something for HKEY_CURRENT_USER to all users in system?<br>HKEY_LOCAL_MACHINE is not good for me... must be HKEY_CURRENT_USER.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">11th August 2011 14:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can user enumusersreg to get access to all trees in the HKU hive. If you only want access to the user who first executed the installer, you'll need the UAC plugin (not recommended).<br><br>Note however that you should not write to userlevel registry in an admin-only installer. If an installer requires admin access, it should always install for all users, and thus should write to HKLM. Only userlevel installers are supposed to install for a single user. This is the way Windows is designed to be used.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">marcins</span><br><span class="post-time small text-muted">16th August 2011 09:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well it doesn't work like that to me. Can someone please help me?<br><br>When I run it on Admin account scripts add lines to registry but only for Admin.<br><br>Here is simple script that i want to use.<br><br></p><blockquote>!include "EnumUsersReg.nsh"<br>Name EnumUsersReg<br>OutFile EnumUsersReg.exe<br><br>ShowInstDetails show<br><br>Section<br>; use ${un.EnumUsersReg} in uninstaller sections<br>${EnumUsersReg} CallbackFunction temp.key<br>SectionEnd<br><br>Function CallbackFunction<br><br>Pop $0<br><br>; registry x32<br>WriteRegStr HKU "Software\JavaSoft\Prefs\com\ibm\/S/P/S/S\/S/P/S/S /Statistics\19.0\ui\doc_types\dataeditor\menus\19;/Predictive /Solutions;0;;\0;/P/S /D/A/S;0;;" "0" "separator;"<br>WriteRegStr HKU "Software\JavaSoft\Prefs\com\ibm\/S/P/S/S\/S/P/S/S /Statistics\19.0\ui\doc_types\output\menus\19;/Predictive /Solutions;0;;\0;/P/S /D/A/S;0;;" "0" "separator;"<br>WriteRegStr HKU "Software\JavaSoft\Prefs\com\ibm\/S/P/S/S\/S/P/S/S /Statistics\19.0\ui\doc_types\syntax\menus\19;/Predictive /Solutions;0;;\0;/P/S /D/A/S;0;;" "0" "separator;"<br><br>DetailPrint $0<br><br>FunctionEnd</blockquote></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">16th August 2011 17:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Software is not the the root of HKU</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">marcins</span><br><span class="post-time small text-muted">16th August 2011 19:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">So how i should write that Key? I cant use numbers like S-1-5-21... because they are different in every windows?! Please help!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">16th August 2011 21:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by marcins</small><br>So how i should write that Key? I cant use numbers like S-1-5-21... because they are different in every windows?! Please help!</blockquote>EnumUsersReg knows</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">msroboto</span><br><span class="post-time small text-muted">16th August 2011 21:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I know you say that you have to write this for every user.<br>How will you handle new users added to the system after your install?<br>Just something to consider.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">17th August 2011 03:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by msroboto</small><br>I know you say that you have to write this for every user.<br>How will you handle new users added to the system after your install?<br>Just something to consider.</blockquote>The correct way to handle this is to copy default settings to HKCU when your _application_ is started for the first time as that user</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">marcins</span><br><span class="post-time small text-muted">17th August 2011 09:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok its working now! I forgot to put $0\ before Software. Thanks for help!</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>