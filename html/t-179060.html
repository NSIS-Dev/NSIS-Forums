<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="AccessControl bugfix"><title>AccessControl bugfix - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">AccessControl bugfix</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=179060">AccessControl bugfix</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">superrock</span><br><span class="post-time small text-muted">5th May 2004 22:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>AccessControl bugfix</strong><br>Hi,<br><br>I worked on a bugfix of the AccessControl Dll. I would be interested to update the release in the archive at nis.ssourceforge.net !<br><br>Extended and bug fixed by Andreas Rock (andreas.rock@bigfoot.com)"<br>=======================================================<br><br>1. Bug fixes<br><br>1.1 Error handling<br><br>If an error occures a message box will be displayed.<br>The error message is then given back on the stack.<br>I've changed it in that way, that you must always pop the error<br>status from the stack and no message box on erros is displayed.<br><br>The message contains the error code in first 4 characters:<br>e.g. 1001::Trustee is missing<br><br>Usage new: e.g. for grant file<br><br># Give ownership for file C:\test.txt to Waterloo\Mathias<br>AccessControl::SetFileOwner \<br>"C:\test.txt" "Waterloo\Mathias"<br>pop $0<br>StrCmp $0 "" aclok<br>MessageBox MB_OK "Acl error=$0"<br>aclok:<br><br>Usage old:<br># Give ownership for file C:\test.txt to Waterloo\Mathias<br>AccessControl::SetFileOwner \<br>"C:\test.txt" "Waterloo\Mathias"<br><br><br><br>1.2 Function ParseSid: line 243 ShowError("uh..");<br><br>Must be uncommented. Error is shown by calling function!<br><br><br>2.0 Error messages, empty if no error occured<br><br>Error messages:<br><br>1001:Trustee is missing<br>1002:Permission flags are missing<br>1003:Bug: Unsupported change mode:<br>1004:Filesystem path missing<br>1005:Invalid filesystem path missing<br>1006:Root key name missing<br>1007:Bad root key name (..)<br>1008:Registry key name missing<br><br><br>2001:Bad trustee ..<br>2002:Bad permission flags ..<br>2003:Cannot read access control list. GetNamedSecurityInfo error code:..<br>2004:Cannot build new access control list. SetEntriesAcl error code:..<br>2005:Cannot apply new ownership. SetNamedSecurityInfo error code:..<br><br>3. Known bugs<br><br>The original project file for VisualStudio 1.0 only works with the release version.<br>The debug part can't produce a dll.<br>I've prepared a working project file for VisualStudio1.1 (see AccessControlStudioNet2003.zip).<br><br><br>Regards,Rocky</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">6th May 2004 18:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Please test it, give others some time to test it, and e-mail it to me when you think it's ready for uploading.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JoeAcunzo</span><br><span class="post-time small text-muted">21st January 2005 20:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The attached zip is missing AccessControl.c. I believe there is a bug in the call to GetNamedSecurityInfo. The last parameter is NULL, and according to Microsoft documentation, it cannot be NULL. I'd like to fix this problem, as I believe it may be the cause of a problem for some of my customers (this call fails).<br><br>I have the source to the original AccessControl plugin, but not to this new version. I'd like to use the new version so I can include error messages in the details window, which I save to a log file after install completes.<br><br>Can someone post or send me the source to this new version?<br><br>Thanks!<br>Joe A.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">superrock2</span><br><span class="post-time small text-muted">21st January 2005 23:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>AccessControl.c</strong><br>Hi!<br><br>I am sorry that this file is missing. Attached you will find my complete source set.<br><br>Please reply your changes!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">superrock2</span><br><span class="post-time small text-muted">21st January 2005 23:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Missing attachment</strong><br>Hi!<br><br>Sorry I was not logged properly. So I lost the attachement.<br>Attached you will find my complete source set.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">superrock2</span><br><span class="post-time small text-muted">26th January 2005 20:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>GetNamedSecurityInfo</strong><br>Hi Joe,<br><br><br>Could you solve your problem with "GetNamedSecurityInfo"?<br><br>It would be nice get the last version of it.<br>Then we could make it available in the archive.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">superrock2</span><br><span class="post-time small text-muted">26th January 2005 21:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Publishing new AccessControl plugin</strong><br>Dear Kichik,<br><br>As I saw in thread <a href="http://forums.winamp.com/showthread.php?postid=1573690#post1573690" target="_blank">http://forums.winamp.com/showthread....90#post1573690</a> the problem was only a user problem, no function problem.<br><br>I would like to publish my extension now. I have tested it well and it's working since may 2004.<br><br>The problem is, that I have added an error flag, wich must be popped from the stack. The old scripts must be changed therefore.<br><br>Should I prepare a new release with a new name like AccessControlX and publish it on the archive ?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JoeAcunzo</span><br><span class="post-time small text-muted">26th January 2005 22:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for the source Rocky, but I wouldn't post it the the archive just yet! Here's why...<br><br>Besides my problem using "Users" for a Windows group name on non-English Windows (it must be translated, or better yet, use the SID), there are at least 2 coding errors in AccessControl.<br><br>1. The last parameter of GetNamedSecurityInfo() is a NULL. According to Microsoft documentation, it must be a pointer to a pointer, and then LocalFree'ed when done.<br><br>2. It uses GetLastError() for GetNamedSecurityInfo (and other) functions, but those are documented to return the error code on the function call, and does not mention GetLastError() as usable (though it appears to work, should be fixed).<br><br>So I will make these fixes in the next few days and post the source on this thread. I'm still trying to get our maintenance release of ComputerTime onto our site at <a href="http://www.softwaretime.com." target="_blank">www.softwaretime.com.</a> Thanks.<br><br>Joe A.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">27th January 2005 15:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">superrock2, you can use the script's error flag in the latest NSIS version (extra-&gt;exec_flags.exec_error). If you use it instead of the stack, it could be compatible with the old version.<br><br>BTW, what happened to your old user? Send me a PM if you want it back.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>