<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Problem with CreateMutexA and detecting an application running" />

  <title>Problem with CreateMutexA and detecting an application running - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Problem with CreateMutexA and detecting an application running</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=170535">Problem with CreateMutexA and detecting an application running</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">lyonmsu</span><br />
      <span class="post-time small text-muted">22nd February 2004 23:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Problem with CreateMutexA and detecting an application running</strong><br />
      I have searched most of the messages that I could find referencing the createmutexa function for detecting if an application is running (as well as the FindWindow versions) but I could not seem to resolve this issue.<br />
      <br />
      What I want is to detect 2 instances:<br />
      <br />
      1. Whether the installer is running<br />
      2. Whther the application I am installing is actually running.<br />
      <br />
      I can use the one instance already supplied on the FAQ for detecting the installer without issue. When attempting to use the CreateMutexA again It detects the application is running and posts the Retry Cancel options but the Retry always believes the actual application is still running even when it has been killed?!? It is in a loop somehow with the again: label before the CreatMutexA command is executed again apparently and I do not know why?<br />
      <br />
      Here is my Code Script:<br />
      <br /></p>
      <pre>
<span style="color: #007700">Function.</span><span style="color: #0000BB">onInit
<br /><br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">'kernel32::CreateMutexA(i0,i0,t"${PRODUCT_NAME}Installer")i.r1?e'
<br /><br /></span><span style="color: #0000BB">Pop$R0
<br /><br />StrCmp$R00</span><span style="color: #007700">+</span><span style="color: #0000BB">3
<br />MessageBoxMB_OK</span><span style="color: #DD0000">"${PRODUCT_NAME}installerisalreadyrunning"
<br /></span><span style="color: #0000BB">Abort
<br /><br />again</span><span style="color: #007700">:
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">'kernel32::CreateMutexA(i0,i0,t"${PRODUCT_NAME}")i.r1?e'
<br /><br /><br /></span><span style="color: #0000BB">Pop$R1
<br /><br />StrCmp$R10</span><span style="color: #007700">+</span><span style="color: #0000BB">3
<br />MessageBoxMB_RETRYCANCEL</span><span style="color: #007700">|</span><span style="color: #0000BB">MB_ICONSTOP</span><span style="color: #DD0000">"${PRODUCT_NAME}mustnotberunninginordertoproceeedwithinstallation"</span><span style="color: #0000BB">IDRETRYagainIDCANCEL
<br />Abort
<br /><br />FunctionEnd
<br /></span>
</pre>If someone can point out what I am doing wrong or how I can do it differently (other than FindWindow since window name has not been officially established as yet") I would appreciate the help.<br />
      <br />
      Thanks
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br />
      <span class="post-time small text-muted">23rd February 2004 03:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Maybe I'm wrong but the problem with your code is that plugins doesn't allow goto statments, in your case <b>again:</b> for example.<br />
      And, see this:<br /></p>
      <pre>
<code><br />System::Call 'kernel32::CreateMutexA(i 0, i 0, t "${PRODUCT_NAME} Installer") i .r1' <br />Pop $R0<br /></code>
</pre><br />
      you are returning number, so you might use IntCmp instead.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">23rd February 2004 11:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Lobo Lunar, that is not true. You can use Goto everywhere.<br />
      <br />
      All variables are strings. For a simple comparation you can use StrCmp, that makes no difference.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br />
      <span class="post-time small text-muted">23rd February 2004 15:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I guess I keep the old fashion way :)<br />
      Thanks! for the update :D</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
