<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="progress callback and BgImage" />

  <title>progress callback and BgImage - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">progress callback and BgImage</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=205226">progress callback and BgImage</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Gosev</span><br />
      <span class="post-time small text-muted">18th January 2005 07:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>progress callback and BgImage</strong><br />
      Hi<br />
      <br />
      This is my first post to the WinAMP/NSIS forums :)<br />
      <br />
      I work for a game company and we've just decide (well, I've just decided) to migrate from InstallShield to NSIS.<br />
      <br />
      The installation I'm working on at the moment is on 2 CDs, so I'm doing a double installer (the first one asks for the language, the second is copied by the first one to the HD and does most of the work, such as the extractions from the 2 CDs)<br />
      <br />
      I need to do billboards (I'm using BgImage) that <i>change regulary</i> during installation (e.g. at 10%, 20%, 30%...) So far what I've done is to separate my files into several zip files that are roughly the same size then I do extract / show BgImage A / extract / show BgImage B and so.<br />
      <br />
      I was wondering of there was any way to link callbacks to the instfiles progression or something, so that I can call a function every 10 percentage points with the progress value and use that function to change the background image. Or is there another better way to do this?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">18th January 2005 19:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">In NSIS 2.03 or above, you can write plug-ins that will be able to execute NSIS code. Creating a plug-in to listen to Windows messages and execute NSIS code accordingly could cause problems because the NSIS code interpreter is not built for multi-threaded execution. However, if you choose your hooking correctly, it shouldn't be a problem. NSIS uses SendMessage to update the progress bar, so no code should be executed while the progress bar is updating.<br />
      <br />
      So, if you create a plug-in that hooks the progress bar and listens to PBM_SETPOS, you should be able to call a callback function in your script to update BgImage.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Gosev</span><br />
      <span class="post-time small text-muted">19th January 2005 07:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hum, long time no code, but I think I actually understood most of that :) Thanks for taking the time to answer.<br />
      <br />
      There's just one point on which I'm not clear :<br />
      <br /></p>

      <blockquote>
        <i>Originally posted by kichik</i><br />
        <b>In NSIS 2.03 or above, you can write plug-ins that will be able to execute NSIS code.<br /></b>
      </blockquote>I had imagined calling the dll with a (script) function name, but basically I don't know which parameters to pass to ExecuteCodeSegment (and more specifically how to translate the function name into ExecuteCodeSegments first parameter). I found it used in \exehead\ui.c and had a look at it in \exehead\exec.c but as I haven't looked at much else in the code I haven't really made any headway making sense of it all.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Gosev</span><br />
      <span class="post-time small text-muted">20th January 2005 18:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by kichik on mIRC</i><br />
        <b>use 2.04 and extra_parameters parameter<br />
        extra-&gt;ExecuteCodeSegment(address, 0);<br />
        you can get address using GetFunctionAddress in the script, for example.<br />
        Script execution is not thread safe, be careful with it.</b>
      </blockquote>Thanks, that's exactly what I needed
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
