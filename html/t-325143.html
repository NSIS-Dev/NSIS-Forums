<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Symbolic Links, Junctions, Hard Links" />

  <title>Symbolic Links, Junctions, Hard Links - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" />
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
               <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
               <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
       <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Symbolic Links, Junctions, Hard Links</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=325143">Symbolic Links, Junctions, Hard Links</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hnedka</span><br />
      <span class="post-time small text-muted">22nd December 2010 18:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Symbolic Links, Junctions, Hard Links</strong><br />
      Hi, I have created a set of functions to deal with symbolic links, junctions and hard links. These functions are able to create them, delete them and identify them. Treat it as an alpha, because it has been tested only on latest version of XP and 7 (32-bit) and outside of that, there are probably more bugs. It may also not work on Ansi version of NSIS. Let me know if you find any bugs. First save this to "Junction.nsh":<br />
      <br />
      <br /></p>
      <pre>
<span style="color: #007700">;</span><span style="color: #0000BB">misc
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineCreateParentFolder</span><span style="color: #DD0000">"!insertmacroCreateParentFolder"
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroCreateParentFolderPath
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">GetParent</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Path}"</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br />CreateDirectory</span><span style="color: #DD0000">"$1"
<br /></span><span style="color: #0000BB">Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">;</span><span style="color: #0000BB">info
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineIsLink</span><span style="color: #DD0000">"!insertmacroIsLink"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineIsSoftLink</span><span style="color: #DD0000">"!insertmacroIsSoftLink"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineIsHardLink</span><span style="color: #DD0000">"!insertmacroIsHardLink"
<br /><br /></span><span style="color: #007700">Function</span><span style="color: #0000BB">IsSoftLink
<br />Exch</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">GetFileAttributes</span><span style="color: #007700">}</span><span style="color: #DD0000">"$0""REPARSE_POINT"</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br /><br /></span><span style="color: #007700">${If}$</span><span style="color: #0000BB">0</span><span style="color: #007700">!=</span><span style="color: #DD0000">"1"
<br /></span><span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"0"
<br /></span><span style="color: #007700">${EndIf}
<br /></span><span style="color: #0000BB">Exch</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br />FunctionEnd
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroIsSoftLinkPathoutVar
<br />Push</span><span style="color: #DD0000">"${Path}"
<br /></span><span style="color: #0000BB">CallIsSoftLink
<br />Pop</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">Function</span><span style="color: #0000BB">IsHardLink
<br />Exch</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::CreateFileW(w`$1`,i0x40000000,i0,i0,i3,i0,i0)i.r0"
<br /><br /></span><span style="color: #007700">${If}$</span><span style="color: #0000BB">0</span><span style="color: #007700">=</span><span style="color: #DD0000">"-1"
<br /></span><span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"0"
<br /></span><span style="color: #0000BB">gotois_hard_link_end
<br /></span><span style="color: #007700">${EndIf}
<br /><br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"*(&amp;i2560)i.r1"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::GetFileInformationByHandle(ir0,ir1)i.s"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::CloseHandle(ir0)i.r0"
<br /></span><span style="color: #0000BB">Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br /><br /></span><span style="color: #007700">${If}$</span><span style="color: #0000BB">0</span><span style="color: #007700">==</span><span style="color: #DD0000">"0"
<br /></span><span style="color: #0000BB">gotois_hard_link_end
<br /></span><span style="color: #007700">${EndIf}
<br /><br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"*$1(&amp;i400,&amp;i4.r0)"
<br /><br /></span><span style="color: #007700">${If}$</span><span style="color: #0000BB">0</span><span style="color: #007700">!=</span><span style="color: #DD0000">"0"
<br /></span><span style="color: #0000BB">IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">-</span><span style="color: #0000BB">1
<br /></span><span style="color: #007700">${EndIf}
<br /><br /></span><span style="color: #0000BB">is_hard_link_end</span><span style="color: #007700">:
<br /></span><span style="color: #0000BB">Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br />FunctionEnd
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroIsHardLinkPathoutVar
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br />Push</span><span style="color: #DD0000">"${Path}"
<br /></span><span style="color: #0000BB">CallIsHardLink
<br />StrCpy</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}$</span><span style="color: #0000BB">0
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroIsLinkPathoutVar
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">IsSoftLink</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Path}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br /><br />${If}${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}==</span><span style="color: #0000BB">0
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">IsHardLink</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Path}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />${EndIf}
<br />!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">;</span><span style="color: #0000BB">files
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineCreateHardLink</span><span style="color: #DD0000">"!insertmacroCreateHardLink"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineCreateSymbolicLinkFile</span><span style="color: #DD0000">"!insertmacroCreateSymbolicLinkFile"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineCreateLinkFile</span><span style="color: #DD0000">"!insertmacroCreateLinkFile"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineDeleteLinkFile</span><span style="color: #DD0000">"!insertmacroDeleteLinkFile"
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroCreateSymbolicLinkFileJunctionTargetoutVar
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">CreateParentFolder</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Junction}"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::CreateSymbolicLinkW(w`${Junction}`,w`${Target}`,i0)i.s"
<br /></span><span style="color: #0000BB">Pop</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br /><br />${If}${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}==</span><span style="color: #DD0000">"error"
<br /></span><span style="color: #0000BB">StrCpy</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}</span><span style="color: #DD0000">"0"
<br /></span><span style="color: #007700">${EndIf}
<br />!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroCreateHardLinkJunctionTargetoutVar
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">CreateParentFolder</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Junction}"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::CreateHardLinkW(w`${Junction}`,w`${Target}`,i0)i.s"
<br /></span><span style="color: #0000BB">Pop</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroCreateLinkFileJunctionTargetoutVar
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">CreateSymbolicLinkFile</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Junction}""${Target}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br /><br />${If}${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}==</span><span style="color: #0000BB">0
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">CreateHardLink</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Junction}""${Target}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />${EndIf}
<br />!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroDeleteLinkFilePathoutVar
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">IsLink</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Path}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br /><br />${If}${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}!=</span><span style="color: #0000BB">0
<br />SetFileAttributes</span><span style="color: #DD0000">"${Path}""NORMAL"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::DeleteFileW(w`${Path}`)i.s"
<br /></span><span style="color: #0000BB">Pop</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />${EndIf}
<br />!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">;</span><span style="color: #0000BB">folders
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineCreateJunction</span><span style="color: #DD0000">"!insertmacroCreateJunction"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineCreateSymbolicLinkFolder</span><span style="color: #DD0000">"!insertmacroCreateSymbolicLinkFolder"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineCreateLinkFolder</span><span style="color: #DD0000">"!insertmacroCreateLinkFolder"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineDeleteLinkFolder</span><span style="color: #DD0000">"!insertmacroDeleteLinkFolder"
<br /><br /></span><span style="color: #007700">Function</span><span style="color: #0000BB">CreateJunction
<br />Exch</span><span style="color: #007700">$</span><span style="color: #0000BB">4
<br />Exch
<br />Exch</span><span style="color: #007700">$</span><span style="color: #0000BB">5
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">2
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">3
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">6
<br />CreateDirectory</span><span style="color: #DD0000">"$5"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::CreateFileW(w`$5`,i0x40000000,i0,i0,i3,i0x02200000,i0)i.r6"
<br /><br /></span><span style="color: #007700">${If}$</span><span style="color: #0000BB">0</span><span style="color: #007700">=</span><span style="color: #DD0000">"-1"
<br /></span><span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"0"
<br /></span><span style="color: #0000BB">RMDir</span><span style="color: #DD0000">"$5"
<br /></span><span style="color: #0000BB">gotocreate_junction_end
<br /></span><span style="color: #007700">${EndIf}
<br /><br /></span><span style="color: #0000BB">CreateDirectory</span><span style="color: #DD0000">"$4"</span><span style="color: #007700">;</span><span style="color: #0000BB">WindowsXPrequiresthatthedestinationexists
<br />StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">4</span><span style="color: #DD0000">"\??\$4"
<br /></span><span style="color: #0000BB">StrLen</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">$</span><span style="color: #0000BB">4
<br />IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">*</span><span style="color: #0000BB">2
<br />IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">1</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">+</span><span style="color: #0000BB">2
<br />IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">2</span><span style="color: #007700">$</span><span style="color: #0000BB">1</span><span style="color: #007700">+</span><span style="color: #0000BB">10
<br />IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">3</span><span style="color: #007700">$</span><span style="color: #0000BB">1</span><span style="color: #007700">+</span><span style="color: #0000BB">18
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"*(i0xA0000003,&amp;i4$2,&amp;i20,&amp;i2$0,&amp;i2$1,&amp;i20,&amp;w$1`$4`,&amp;i20)i.r2"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::DeviceIoControl(ir6,i0x900A4,ir2,ir3,i0,i0,*ir4r4,i0)i.r0"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::CloseHandle(ir6)i.r1"
<br /><br /></span><span style="color: #007700">${If}$</span><span style="color: #0000BB">0</span><span style="color: #007700">==</span><span style="color: #DD0000">"0"
<br /></span><span style="color: #0000BB">RMDir</span><span style="color: #DD0000">"$5"
<br /></span><span style="color: #007700">${EndIf}
<br /><br /></span><span style="color: #0000BB">create_junction_end</span><span style="color: #007700">:
<br /></span><span style="color: #0000BB">Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">6
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">3
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">2
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">5
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">4
<br />FunctionEnd
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroCreateJunctionJunctionTargetoutVar
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br />Push</span><span style="color: #DD0000">"${Junction}"
<br /></span><span style="color: #0000BB">Push</span><span style="color: #DD0000">"${Target}"
<br /></span><span style="color: #0000BB">CallCreateJunction
<br />StrCpy</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}$</span><span style="color: #0000BB">0
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroCreateSymbolicLinkFolderJunctionTargetoutVar
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">CreateParentFolder</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Junction}"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::CreateSymbolicLinkW(w`${Junction}`,w`${Target}`,i1)i.s"
<br /></span><span style="color: #0000BB">Pop</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br /><br />${If}${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}==</span><span style="color: #DD0000">"error"
<br /></span><span style="color: #0000BB">StrCpy</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}</span><span style="color: #DD0000">"0"
<br /></span><span style="color: #007700">${EndIf}
<br />!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroCreateLinkFolderJunctionTargetoutVar
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">CreateSymbolicLinkFolder</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Junction}""${Target}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br /><br />${If}${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}==</span><span style="color: #0000BB">0
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">CreateJunction</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Junction}""${Target}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />${EndIf}
<br />!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroDeleteLinkFolderPathoutVar
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">IsSoftLink</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Path}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br /><br />${If}${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}!=</span><span style="color: #0000BB">0
<br />SetFileAttributes</span><span style="color: #DD0000">"${Path}""NORMAL"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::RemoveDirectoryW(w`${Path}`)i.s"
<br /></span><span style="color: #0000BB">Pop</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />${EndIf}
<br />!</span><span style="color: #0000BB">macroend
<br /></span>

<!-- php buffer end -->
               
               
               
</pre>
      <hr />
      <pre>
       
Then you can use these functions:<br /><br />       PHP Code:
       
               
</pre>
      <hr />
      <pre>
               <code style="white-space:nowrap">
               
                       <!-- php buffer start --></code><span style="color: #000000">
<span style="color: #007700">!include</span><span style="color: #DD0000">"Junction.nsh"
<br /><br /></span><span style="color: #007700">;</span><span style="color: #0000BB">checks</span><span style="color: #007700">if</span><span style="color: #0000BB">targetishardlink
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">IsHardLink</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Path}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />;</span><span style="color: #0000BB">checks</span><span style="color: #007700">if</span><span style="color: #0000BB">targetisasoftlink</span><span style="color: #007700">(</span><span style="color: #0000BB">symboliclink</span><span style="color: #007700">or</span><span style="color: #0000BB">junction</span><span style="color: #007700">)
<br />${</span><span style="color: #0000BB">IsSoftLink</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Path}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />;</span><span style="color: #0000BB">checks</span><span style="color: #007700">if</span><span style="color: #0000BB">targetiseitherahardlink</span><span style="color: #007700">or</span><span style="color: #0000BB">asoftlink
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">IsLink</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Path}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br /><br />;</span><span style="color: #0000BB">createsahardlink</span><span style="color: #007700">(</span><span style="color: #0000BB">fileonly</span><span style="color: #007700">,</span><span style="color: #0000BB">mustbeonthesamevolume</span><span style="color: #007700">,and</span><span style="color: #0000BB">targetmustexist</span><span style="color: #007700">)
<br />${</span><span style="color: #0000BB">CreateHardLink</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Junction}""${Target}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />;</span><span style="color: #0000BB">createsasymboliclink</span><span style="color: #007700">for</span><span style="color: #0000BB">afile</span><span style="color: #007700">(</span><span style="color: #0000BB">Vista</span><span style="color: #007700">+,</span><span style="color: #0000BB">targetdoesn</span><span style="color: #DD0000">'tneedtoexistandcanbeanywhere)
<br />${CreateSymbolicLinkFile}"${Junction}""${Target}"${outVar}
<br />;triestocreateasymboliclinkfirstandwhenitfails,thenittriestocreateahardlink(filesonly)
<br />${CreateLinkFile}"${Junction}""${Target}"${outVar}
<br /><br />;createsasymboliclinkforafolder(Vista+,targetdoesn'</span><span style="color: #0000BB">tneedtoexist</span><span style="color: #007700">)
<br />${</span><span style="color: #0000BB">CreateSymbolicLinkFolder</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Junction}""${Target}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />;</span><span style="color: #0000BB">createsajunction</span><span style="color: #007700">(</span><span style="color: #0000BB">foldersonly</span><span style="color: #007700">,</span><span style="color: #0000BB">pathmustbeabsolute</span><span style="color: #007700">and</span><span style="color: #0000BB">targetshouldexist</span><span style="color: #007700">)
<br />${</span><span style="color: #0000BB">CreateJunction</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Junction}""${Target}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />;</span><span style="color: #0000BB">triestocreatesymboliclinkfirst</span><span style="color: #007700">and</span><span style="color: #0000BB">whenitfails</span><span style="color: #007700">,</span><span style="color: #0000BB">thenittriestocreateajunctions</span><span style="color: #007700">(</span><span style="color: #0000BB">directoriesonly</span><span style="color: #007700">)
<br />${</span><span style="color: #0000BB">CreateLinkFolder</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Junction}""${Target}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br /><br />;</span><span style="color: #0000BB">checks</span><span style="color: #007700">if</span><span style="color: #0000BB">afolderisajunction</span><span style="color: #007700">or</span><span style="color: #0000BB">asymboliclink</span><span style="color: #007700">,andif</span><span style="color: #0000BB">itis</span><span style="color: #007700">,</span><span style="color: #0000BB">itdeletesit
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">DeleteLinkFolder</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Path}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />;</span><span style="color: #0000BB">checks</span><span style="color: #007700">if</span><span style="color: #0000BB">afileisasymboliclink</span><span style="color: #007700">or</span><span style="color: #0000BB">ahardlink</span><span style="color: #007700">,andif</span><span style="color: #0000BB">itis</span><span style="color: #007700">,</span><span style="color: #0000BB">itdeletesit
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">DeleteLinkFile</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Path}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
</span></span>
</pre>All of the above returns "0" on fail and anything else (usually 1, but not always) on success.<br />
      <br />
      Some basic differences between these three guys are:<br />
      all 3 of them:<br />
      - must be located on a NTFS volume (but not necessarily their target)<br />
      - system must be Windows 2000 or newer<br />
      <br />
      Hard links:<br />
      - only for files<br />
      - both the link and the target must be on the same volume and must exist<br />
      - path must be absolute<br />
      - it is indistinguishable from the original file and doesn't really act like a link, but rather like another copy of the target file (except that when you edit one, both get changed; but you need to delete both to get that file actually deleted)<br />
      <br />
      Junctions:<br />
      - only for folders<br />
      - in XP and older, when they are deleted in the explorer, the target gets wiped out as well (see wikipedia entry on junctions)<br />
      - path must be absolute, target can be anywhere<br />
      - on Win XP SP 4, creation fails if the target doesn't exist, on Win 7, it gets created (didn't try anywhere else)<br />
      <br />
      Symbolic Links:<br />
      - only Vista and newer<br />
      - supports both files and folders<br />
      - target can be anywhere and doesn't need to exist<br />
      - path can be relative or absolute<br />
      <br />
      more info:<br />
      <a href="http://msdn.microsoft.com/en-us/library/aa365680(v=vs.85).aspx" target="_blank">http://msdn.microsoft.com/en-us/libr...(v=vs.85).aspx</a><br />
      <a href="http://msdn.microsoft.com/en-us/library/aa365006(v=vs.85).aspx" target="_blank">http://msdn.microsoft.com/en-us/libr...(v=vs.85).aspx</a><br />
      <a href="http://en.wikipedia.org/wiki/NTFS_junction_point" target="_blank">http://en.wikipedia.org/wiki/NTFS_junction_point</a><br />
      <a href="http://en.wikipedia.org/wiki/NTFS_symbolic_link" target="_blank">http://en.wikipedia.org/wiki/NTFS_symbolic_link</a>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">22nd December 2010 18:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You should create a wiki page for something like this (This stupid forum will break code even when using code tags etc)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hnedka</span><br />
      <span class="post-time small text-muted">22nd December 2010 18:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I will, thanks for the suggestion. But first I will wait a little bit and fix possible issues/bugs.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hnedka</span><br />
      <span class="post-time small text-muted">3rd June 2011 11:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have (over time) fixed various issues with the script. When I have more time, I will create a wikipage for it:<br />
      <br /></p>
      <pre>
<span style="color: #007700">!</span><span style="color: #0000BB">ifndefJUNCTION_INCLUDED
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineJUNCTION_INCLUDED
<br /><br /></span><span style="color: #007700">;</span><span style="color: #0000BB">misc
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineCreateParentFolder</span><span style="color: #DD0000">"!insertmacroCreateParentFolder"
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroCreateParentFolderPath
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">GetParent</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Path}"</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br />CreateDirectory</span><span style="color: #DD0000">"$1"
<br /></span><span style="color: #0000BB">Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">;</span><span style="color: #0000BB">info
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineIsLink</span><span style="color: #DD0000">"!insertmacroIsLink"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineIsSoftLink</span><span style="color: #DD0000">"!insertmacroIsSoftLink"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineIsHardLink</span><span style="color: #DD0000">"!insertmacroIsHardLink"
<br /><br /></span><span style="color: #007700">Function</span><span style="color: #0000BB">IsSoftLink
<br />Exch</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">GetFileAttributes</span><span style="color: #007700">}</span><span style="color: #DD0000">"$0""REPARSE_POINT"</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br /><br /></span><span style="color: #007700">${If}$</span><span style="color: #0000BB">0</span><span style="color: #007700">!=</span><span style="color: #DD0000">"1"
<br /></span><span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"0"
<br /></span><span style="color: #007700">${EndIf}
<br /></span><span style="color: #0000BB">Exch</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br />FunctionEnd
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroIsSoftLinkPathoutVar
<br />Push</span><span style="color: #DD0000">"${Path}"
<br /></span><span style="color: #0000BB">CallIsSoftLink
<br />Pop</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">Function</span><span style="color: #0000BB">IsHardLink
<br />Exch</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::CreateFileW(w`$1`,i0x40000000,i0,i0,i3,i0,i0)i.r0"
<br /><br /></span><span style="color: #007700">${If}$</span><span style="color: #0000BB">0</span><span style="color: #007700">=</span><span style="color: #DD0000">"-1"
<br /></span><span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"0"
<br /></span><span style="color: #0000BB">gotois_hard_link_end
<br /></span><span style="color: #007700">${EndIf}
<br /><br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"*(&amp;i2560)i.r1"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::GetFileInformationByHandle(ir0,ir1)i.s"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::CloseHandle(ir0)i.r0"
<br /></span><span style="color: #0000BB">Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br /><br /></span><span style="color: #007700">${If}$</span><span style="color: #0000BB">0</span><span style="color: #007700">==</span><span style="color: #DD0000">"0"
<br /></span><span style="color: #0000BB">gotois_hard_link_end
<br /></span><span style="color: #007700">${EndIf}
<br /><br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"*$1(&amp;i400,&amp;i4.r0)"
<br /><br /></span><span style="color: #007700">${If}$</span><span style="color: #0000BB">0</span><span style="color: #007700">!=</span><span style="color: #DD0000">"0"
<br /></span><span style="color: #0000BB">IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">-</span><span style="color: #0000BB">1
<br /></span><span style="color: #007700">${EndIf}
<br /><br /></span><span style="color: #0000BB">is_hard_link_end</span><span style="color: #007700">:
<br /></span><span style="color: #0000BB">Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br />FunctionEnd
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroIsHardLinkPathoutVar
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br />Push</span><span style="color: #DD0000">"${Path}"
<br /></span><span style="color: #0000BB">CallIsHardLink
<br />Exch</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br />Pop</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroIsLinkPathoutVar
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">IsSoftLink</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Path}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br /><br />${If}${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}==</span><span style="color: #0000BB">0
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">IsHardLink</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Path}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />${EndIf}
<br />!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">;</span><span style="color: #0000BB">files
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineCreateHardLink</span><span style="color: #DD0000">"!insertmacroCreateHardLink"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineCreateSymbolicLinkFile</span><span style="color: #DD0000">"!insertmacroCreateSymbolicLinkFile"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineCreateLinkFile</span><span style="color: #DD0000">"!insertmacroCreateLinkFile"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineDeleteLinkFile</span><span style="color: #DD0000">"!insertmacroDeleteLinkFile"
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroCreateSymbolicLinkFileJunctionTargetoutVar
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">CreateParentFolder</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Junction}"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::CreateSymbolicLinkW(w`${Junction}`,w`${Target}`,i0)i.s"
<br /></span><span style="color: #0000BB">Pop</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br /><br />${If}${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}==</span><span style="color: #DD0000">"error"
<br /></span><span style="color: #0000BB">StrCpy</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}</span><span style="color: #DD0000">"0"
<br /></span><span style="color: #007700">${EndIf}
<br />!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroCreateHardLinkJunctionTargetoutVar
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">CreateParentFolder</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Junction}"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::CreateHardLinkW(w`${Junction}`,w`${Target}`,i0)i.s"
<br /><br /></span><span style="color: #0000BB">Pop</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br /><br />${If}${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}==</span><span style="color: #0000BB">0
<br />StrCpy</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}</span><span style="color: #DD0000">"1"
<br /></span><span style="color: #007700">${Else}
<br /></span><span style="color: #0000BB">StrCpy</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}</span><span style="color: #DD0000">"0"
<br /></span><span style="color: #007700">${EndIf}
<br />!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroCreateLinkFileJunctionTargetoutVar
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">CreateSymbolicLinkFile</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Junction}""${Target}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br /><br />${If}${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}==</span><span style="color: #0000BB">0
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">CreateHardLink</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Junction}""${Target}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />${EndIf}
<br />!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroDeleteLinkFilePathoutVar
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">IsLink</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Path}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br /><br />${If}${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}!=</span><span style="color: #0000BB">0
<br />SetFileAttributes</span><span style="color: #DD0000">"${Path}""NORMAL"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::DeleteFileW(w`${Path}`)i.s"
<br /></span><span style="color: #0000BB">Pop</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />${EndIf}
<br />!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">;</span><span style="color: #0000BB">folders
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineCreateJunction</span><span style="color: #DD0000">"!insertmacroCreateJunction"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineCreateSymbolicLinkFolder</span><span style="color: #DD0000">"!insertmacroCreateSymbolicLinkFolder"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineCreateLinkFolder</span><span style="color: #DD0000">"!insertmacroCreateLinkFolder"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineDeleteLinkFolder</span><span style="color: #DD0000">"!insertmacroDeleteLinkFolder"
<br /><br /></span><span style="color: #007700">Function</span><span style="color: #0000BB">CreateJunction
<br />Exch</span><span style="color: #007700">$</span><span style="color: #0000BB">4
<br />Exch
<br />Exch</span><span style="color: #007700">$</span><span style="color: #0000BB">5
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">2
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">3
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">6
<br />CreateDirectory</span><span style="color: #DD0000">"$5"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::CreateFileW(w`$5`,i0x40000000,i0,i0,i3,i0x02200000,i0)i.r6"
<br /><br /></span><span style="color: #007700">${If}$</span><span style="color: #0000BB">0</span><span style="color: #007700">=</span><span style="color: #DD0000">"-1"
<br /></span><span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"0"
<br /></span><span style="color: #0000BB">RMDir</span><span style="color: #DD0000">"$5"
<br /></span><span style="color: #0000BB">gotocreate_junction_end
<br /></span><span style="color: #007700">${EndIf}
<br /><br /></span><span style="color: #0000BB">CreateDirectory</span><span style="color: #DD0000">"$4"</span><span style="color: #007700">;</span><span style="color: #0000BB">WindowsXPrequiresthatthedestinationexists
<br />StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">4</span><span style="color: #DD0000">"\??\$4"
<br /></span><span style="color: #0000BB">StrLen</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">$</span><span style="color: #0000BB">4
<br />IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">*</span><span style="color: #0000BB">2
<br />IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">1</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">+</span><span style="color: #0000BB">2
<br />IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">2</span><span style="color: #007700">$</span><span style="color: #0000BB">1</span><span style="color: #007700">+</span><span style="color: #0000BB">10
<br />IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">3</span><span style="color: #007700">$</span><span style="color: #0000BB">1</span><span style="color: #007700">+</span><span style="color: #0000BB">18
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"*(i0xA0000003,&amp;i4$2,&amp;i20,&amp;i2$0,&amp;i2$1,&amp;i20,&amp;w$1`$4`,&amp;i20)i.r2"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::DeviceIoControl(ir6,i0x900A4,ir2,ir3,i0,i0,*ir4r4,i0)i.r0"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::CloseHandle(ir6)i.r1"
<br /><br /></span><span style="color: #007700">${If}$</span><span style="color: #0000BB">0</span><span style="color: #007700">==</span><span style="color: #DD0000">"0"
<br /></span><span style="color: #0000BB">RMDir</span><span style="color: #DD0000">"$5"
<br /></span><span style="color: #007700">${EndIf}
<br /><br /></span><span style="color: #0000BB">create_junction_end</span><span style="color: #007700">:
<br /></span><span style="color: #0000BB">Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">6
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">3
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">2
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">5
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">4
<br />FunctionEnd
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroCreateJunctionJunctionTargetoutVar
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br />Push</span><span style="color: #DD0000">"${Junction}"
<br /></span><span style="color: #0000BB">Push</span><span style="color: #DD0000">"${Target}"
<br /></span><span style="color: #0000BB">CallCreateJunction
<br />Exch</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br />Pop</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroCreateSymbolicLinkFolderJunctionTargetoutVar
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">CreateParentFolder</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Junction}"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::CreateSymbolicLinkW(w`${Junction}`,w`${Target}`,i1)i.s"
<br /></span><span style="color: #0000BB">Pop</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br /><br />${If}${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}==</span><span style="color: #DD0000">"error"
<br /></span><span style="color: #0000BB">StrCpy</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}</span><span style="color: #DD0000">"0"
<br /></span><span style="color: #007700">${EndIf}
<br />!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroCreateLinkFolderJunctionTargetoutVar
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">CreateSymbolicLinkFolder</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Junction}""${Target}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br /><br />${If}${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}==</span><span style="color: #0000BB">0
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">CreateJunction</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Junction}""${Target}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />${EndIf}
<br />!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroDeleteLinkFolderPathoutVar
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">IsSoftLink</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Path}"</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br /><br />${If}${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}!=</span><span style="color: #0000BB">0
<br />SetFileAttributes</span><span style="color: #DD0000">"${Path}""NORMAL"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::RemoveDirectoryW(w`${Path}`)i.s"
<br /></span><span style="color: #0000BB">Pop</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}
<br />${EndIf}
<br />!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">;</span><span style="color: #0000BB">turnoffNSISwarnings
<br />Section</span><span style="color: #DD0000">"-JunctionRemoveWarnings"
<br /></span><span style="color: #007700">Return
<br /></span><span style="color: #0000BB">CallCreateJunction
<br />CallIsHardLink
<br />CallIsSoftLink
<br />SectionEnd
<br /><br /></span><span style="color: #007700">!endif
</span>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">David Pi</span><br />
      <span class="post-time small text-muted">8th September 2011 15:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you very much. It's very helpful to me.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">David Pi</span><br />
      <span class="post-time small text-muted">24th September 2011 11:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">!</span><span style="color: #0000BB">macroCreateHardLinkJunctionTargetoutVar<br /></span> <span style="color: #007700">${</span><span style="color: #0000BB">CreateParentFolder</span><span style="color: #007700">}</span><span style="color: #DD0000">"${Junction}"<br /></span> <span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"kernel32::CreateHardLinkW(w`${Junction}`,w`${Target}`,i0)i.s"<br />
      <br /></span> <span style="color: #0000BB">Pop</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}<br />
      <br />
      ${If}${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}==</span><span style="color: #0000BB">0<br />
      StrCpy</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}</span><span style="color: #DD0000">"1"<br /></span> <span style="color: #007700">${Else}<br /></span> <span style="color: #0000BB">StrCpy</span><span style="color: #007700">${</span><span style="color: #0000BB">outVar</span><span style="color: #007700">}</span><span style="color: #DD0000">"0"<br /></span> <span style="color: #007700">${EndIf}<br />
      !</span><span style="color: #0000BB">macroend<br /></span></span> <!-- php buffer end -->
      <hr />
      It seems the macro CreateHardLink has make a mistake.<br />
      The system call return "1" on success, return "0" on fail. But the ${ourVar} was transfered to the opposite... Finally it return "0" on sucess.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">PoRtAbLe_StEaLtH</span><br />
      <span class="post-time small text-muted">6th December 2012 10:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">very useful, thanks for sharing.<br />
      i was just thinking about this after SetEnvironment failed in results.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">majikaz</span><br />
      <span class="post-time small text-muted">18th February 2013 09:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Excellent resource.. I was stuck trying to figure out the problem of creating junctions from within my nsis installer. I only found this thread after kindly being pointed in the right direction.<br />
      <br />
      You should defo. make a wiki page for this one. ;)<br />
      <br />
      A BIG help,<br />
      <br />
      Thanks :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">PoRtAbLe_StEaLtH</span><br />
      <span class="post-time small text-muted">11th July 2013 16:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Error</strong><br />
      n/m.. error was with me..</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
