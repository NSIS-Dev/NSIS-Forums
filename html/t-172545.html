<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="A BIG problem during installation" />

  <title>A BIG problem during installation - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">A BIG problem during installation</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=172545">A BIG problem during installation</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">misha.cn.ua</span><br />
      <span class="post-time small text-muted">8th March 2004 12:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>A BIG problem during installation</strong><br />
      I created an installation with NSIS 2.0, and founded, that it works as follows:<br />
      1. Create a zero size file in the destination directory.<br />
      2. Decompress file to %TEMP%.<br />
      3. Copy (!) file from %TEMP% to file, created at step 1.<br />
      4. Delete file in %TEMP%<br />
      5. Jump to step 1 with next file.<br />
      <br />
      And now, imagine, I have 600Mb free on my drive C, and installing a single 500Mb file on it... The installer will allow to start installation, because there is enough free space, but then will give an error... and after this you say that NSIS does not suck...<br />
      <br />
      PS: I am using Windows 2000 SP3.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">8th March 2004 12:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That is the decompression cache for solid installers.<br />
      <br />
      See <a href="http://nsis.sourceforge.net/download/special_builds/" target="_blank">http://nsis.sourceforge.net/download/special_builds/</a> if you don't want to use solid compression.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">8th March 2004 12:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That is the decompression cache for solid installers.<br />
      <br />
      See <a href="http://nsis.sourceforge.net/download/special_builds/" target="_blank">http://nsis.sourceforge.net/download/special_builds/</a> if you don't want to use solid compression.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">misha.cn.ua</span><br />
      <span class="post-time small text-muted">8th March 2004 12:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks.<br />
      <br />
      But why not to decompress file directly to destination?<br />
      Why do you use temp? And why do you copy file, moving would be much faster.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">8th March 2004 15:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It stores the decompressed data in one temp file, otherwise it would have to decompress everything again once something should be retrieved from another location.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">misha.cn.ua</span><br />
      <span class="post-time small text-muted">10th March 2004 06:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, but how than such archivers, as WinRAR, 7-zip and others unpack solid archives?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">10th March 2004 14:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">They have no installer feature and only have to decompress things in one specific order.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">misha.cn.ua</span><br />
      <span class="post-time small text-muted">11th March 2004 11:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">But NSIS also decompress in one specific order. And if it needs to skip some files, it must do the same thing as WinRAR does when you want to decompress only one file from solid archive.<br />
      I can't understand you. Why file must be decompressed to %TEMP%? Why not to use destination file as "cache"???</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">eccles</span><br />
      <span class="post-time small text-muted">11th March 2004 13:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        But NSIS also decompress in one specific order
      </blockquote><i>Not necessarily so</i>.<br />
      <br />
      With Functions and conditional execution using StrCmp, etc. the order that files are decompressed can not be known at compile time.<br />
      <br />
      The trouble is, with solid compression, it is not possible to go "backwards" when decompressing out of sequence. When a file is required out of order, NSIS would have to start decompressing from the beginning to find it. For large installers this could take a long time.<br />
      <br />
      A cache of everything decompressed so far is kept in %temp% so that the installer never needs to decompress the same data more than once.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">misha.cn.ua</span><br />
      <span class="post-time small text-muted">11th March 2004 14:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for explanation.<br />
      <br />
      Than I think, the option to make non-solid installations *must* be in the main distribution of a NSIS. The compressors list must be something like "zlib, zlib solid, bzip2, bzip2 solid, lzma, lzma solid".</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">misha.cn.ua</span><br />
      <span class="post-time small text-muted">14th March 2004 07:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Please, tell me, if non-solid compression will be included in main NSIS distribution? Not everyone needs non-solid compression, but also not everyone wants solid compression.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">14th March 2004 11:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can download a build with non-solid compression from the website.<br />
      <br />
      Of course a compiler setting would be a nice feature, it's already on the feature request list. However, there are many features people request so it might take some time before something like this will be added.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">misha.cn.ua</span><br />
      <span class="post-time small text-muted">15th March 2004 13:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">lroathe</span><br />
      <span class="post-time small text-muted">4th June 2004 22:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>This is a hidden problem of larger magnitude</strong><br />
      All,<br />
      <br />
      I've finally tracked down problems reported to me about bad installations to this very issue; I used LZMA for my compression (solid, from 2.0) and while my installations are very small (100MB, 180MB uncompressed) people often run out of HD space and the installer crashes.<br />
      <br />
      I don't have the time to test for more info or put in a small HD and will just use the special build for LZMA non-solid for now, but this needs to be looked at further as it is an issue that negatively effects an otherwise solid install experience.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">lroathe</span><br />
      <span class="post-time small text-muted">5th June 2004 17:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Follow up: I took one of my largest projects, which is 180MB on disk with 5,654 files in 500 folders. Using solid lzma compression the resulting installer is 100MB in size. Using non-solid compression, the resulting installer is 102MB in size.<br />
      <br />
      As this project probably represents about the best case real-world example for solid compression yet only saves 2MB, I'd suggest that non-solid compression for lzma (not sure about bz2) be the default. I'd bet that at least 90% of the people creating installers would agree that a small increase in size is worth avoiding the problems the very large temporary file creates for customers... esp. when the customer runs out of disk space during the install; which can lead to a non-working hard drive and very (very) upset customers; I spent 3 hours on long distance with one walking him through recovering his HD after this happened.<br />
      <br />
      Actually; the installer _really_ should check for enough free HD space before attempting to install. And if a temp file will be created, the max size of that temp file should be taken into account. (ie, install size = 200MB, temp file == 180MB, total free HD required == at least 380MB).</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
