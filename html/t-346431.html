<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Compile with name/version from .ini file" />

  <title>Compile with name/version from .ini file - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Compile with name/version from .ini file</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=346431">Compile with name/version from .ini file</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mrjohn</span><br />
      <span class="post-time small text-muted">18th July 2012 08:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Compile with name/version from .ini file</strong><br />
      &nbsp; Hi !<br />
      We are using variables in our application to store application version number,so the same in NSI file.<br />
      When we build another version,we need to modify version into NSI file and also in our source code app.<br />
      Is there any way to store version in just on single place,just like .ini file ant read it also at compile time ?<br />
      <br />
      Thanks !</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">18th July 2012 10:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Write a program (it can be written in NSIS) which reads the INI file and generates an NSH file with !defines in it which you !include in your main script.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mrjohn</span><br />
      <span class="post-time small text-muted">18th July 2012 12:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks !<br />
      yes this is a way but if I understood you I must again do 2 things :<br />
      1. edit ini file<br />
      2. run exe to generate new NSH</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">18th July 2012 14:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You automate the execution of the exe using !system. On the next line in your script you !include the outputted file. You can then use !delfile to delete the outputted file if you wish (or use the del command via !system).<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mrjohn</span><br />
      <span class="post-time small text-muted">18th July 2012 16:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Afrow !<br />
      This my code and seems to work :up: :<br />
      genNSH.nsi:<br /></p>
      <pre>
<code>
SilentInstall silent
<br /><br />&gt;var v_major
<br />&gt;var v_minor
<br />&gt;var v_build
<br />&gt;var v_revis
<br /><br />Name "genNSH"
<br /><br />&gt;OutFile "genNSH.exe"
<br /><br />&gt;RequestExecutionLevel user
<br /><br /><br />Section ""
<br />  SetAutoClose true
<br />  SetOverwrite on
<br /><br /><br />SectionEnd 
<br /><br />&gt;Function .onInit
<br /> ReadINIStr $v_major "\AA\my.ini" "Versiuni" "major"
<br />&gt;ReadINIStr $v_minor "\AA\my.ini" "Versiuni" "minor"
<br />&gt;ReadINIStr $v_build "\AA\my.ini" "Versiuni" "build"
<br />&gt;ReadINIStr $v_revis "\AA\my.ini" "Versiuni" "revision"
<br /><br /><br />&gt;FileOpen  $R0 "version.nsh" w
<br />  FileWrite $R0 "!define v_major '$v_major'"
<br /> FileWrite $R0 "$\r$\n"
<br /> FileWrite $R0 "!define v_minor '$v_minor'"
<br /> FileWrite $R0 "$\r$\n"
<br /> FileWrite $R0 "!define v_build '$v_build'"
<br /> FileWrite $R0 "$\r$\n"
<br /> FileWrite $R0 "!define v_revis '$v_revis'"
<br /> FileClose $R0
<br />FunctionEnd 
<br />&gt;
</code>
</pre>usage :<br />
      <pre>
<code>
'\AA\genNSH.exe'
<br /><br />&gt;!include "version.nsh"
<br /><br />&gt;Name "Example1"
<br />&gt;OutFile "example_${v_major}_${v_minor}_${v_build}_${v_revis}.exe"
<br /><br />&gt;InstallDir $DESKTOPExample1
<br /><br />RequestExecutionLevel user
<br /><br />&gt;;--------------------------------
<br /><br /><br />&gt;Page directory
<br />Page instfiles
<br /><br />Section ""
<br /><br />  SetOutPath $INSTDIR
<br />  
<br />  SectionEnd 
<br />&gt;
</code>
</pre>my.ini:<br />
      [ Versiuni ]<br />
      major=1<br />
      minor=0<br />
      build=0<br />
      revision=6
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>