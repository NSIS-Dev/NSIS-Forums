<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="admin right to set up"><title>admin right to set up - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">admin right to set up</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=331115">admin right to set up</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">shazia.parveen</span><br><span class="post-time small text-muted">31st May 2011 13:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>admin right to set up</strong><br>How can I make sure the user installing my software has admin rights as i am making setup using Nsis scripting language, and should applicable for all OS (Windows,XP).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">31st May 2011 15:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">1) In .onInit, use the UserInfo plugin to verify admin access. If it's not admin, throw a messagebox error and quit.<br>2) To allow Vista/7 UAC to handle things more gracefully, you may also want to add 'requestexecutionlevel admin' to your script.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">shazia.parveen</span><br><span class="post-time small text-muted">31st May 2011 16:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks MSG for your reply<br>how can i use the userinfo plugin ,can you provide me any link or any code help where i can get all the details</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">31st May 2011 20:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hmm... Try googling for 'nsis userinfo plugin'. Also, the userinfo plugin comes shipped with NSIS, so check NSIS\Examples\UserInfo\UserInfo.nsi .<br><br>As you can see, all the information is out there. You just need to be brave enough to search for it, before asking others for the solution.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">31st May 2011 20:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><a href="http://pastebin.com/EvMkyLLt" target="_blank">http://pastebin.com/EvMkyLLt</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">31st May 2011 20:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Say Anders, does Windows automatically set an errorlevel if UAC elevation fails?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">31st May 2011 22:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by MSG</small><br>Say Anders, does Windows automatically set an errorlevel if UAC elevation fails?</blockquote>Errorlevel is really a DOS/batch thing, windows processes have exit codes.<br><br>Most of the elevation operation takes place in the parent process (ShellExecuteEx calls the UAC service, that service probably calls CreateProcessAsUser or something like that) If the error happens there, ShellExecuteEx would return false and you would call GetLastError to get the error code (No process was created so there is no process exit code) You can get ERROR_CANCELLED etc from GetLastError.<br><br>It is also possible to get a process that dies early (never really gets started, missing dll import etc) with a valid SHELLEXECUTEINFO.hProcess, you could call GetExitCodeProcess on that handle and get a process exit code. ShellExecuteEx would return true here since it did actually start the process, the problem is with the child process. What the exit code is would be up to the windows loader, c runtime or the code in WinMain depending on where the error happens or if the process runs as normal.<br><br>As far as NSIS goes, ExecShell will set the error _flag_ if it fails but there is no way to get the actual error code from ShellExecute without calling it directly with the system plugin...</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">1st June 2011 05:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Err yeah, exit code. Very informative, thank you!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">shazia.parveen</span><br><span class="post-time small text-muted">1st June 2011 12:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks Anders for your help<br>i made changes it and run on both XP and Vista system but only the difference is that in Xp message box is shown "Administrator rights required!" but in vista no message box is coming with the same code,as you have provided in the link waiting for the reply<br>============================================<br>Outfile "RequireAdmin.exe"<br><br>RequestExecutionLevel admin ;Require admin rights on NT6+ (When UAC is turned on)<br><br>!include LogicLib.nsh<br><br>Function .onInit<br>UserInfo::GetAccountType<br>pop $0<br>${If} $0 != "admin" ;Require admin rights on NT4+<br>MessageBox mb_iconstop "Administrator rights required!"<br>SetErrorLevel 740 ;ERROR_ELEVATION_REQUIRED<br>Quit<br>${EndIf}<br>FunctionEnd<br><br>Section<br>SectionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">shazia.parveen</span><br><span class="post-time small text-muted">1st June 2011 12:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by MSG</small><br>Hmm... Try googling for 'nsis userinfo plugin'. Also, the userinfo plugin comes shipped with NSIS, so check NSIS\Examples\UserInfo\UserInfo.nsi .<br><br>As you can see, all the information is out there. You just need to be brave enough to search for it, before asking others for the solution.</blockquote>Thanks MSG</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">1st June 2011 12:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by shazia.parveen</small><br>in Xp message box is shown "Administrator rights required!" but in vista no message box is coming</blockquote>Then that probably means that you're already an admin user, on your Vista PC.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">shazia.parveen</span><br><span class="post-time small text-muted">1st June 2011 12:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Msg actually after running the setup with no admin right account only it is showing the login page for administrator to login for administrative right it is not showing the message box "Administrator rights required!" in Vista as it was showing in Xp.<br><br>Actually when i turned off UAC in case of Vista then it is showing the message box "Administrator rights required!" but when UAC is turned on in case of Vista no message box is coming only it is showing the login page for administrator .</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">shazia.parveen</span><br><span class="post-time small text-muted">1st June 2011 14:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">In no admin right account when i turned off UAC in case of Vista then it is showing the message box "Administrator rights required!" but when UAC is turned on in case of Vista no message box is coming only it is showing the login page for administrator . waiting for the reply.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">1st June 2011 15:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It's doing exactly what it should - this is how UAC is designed to operate. There is nothing you can do about it.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">1st June 2011 21:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If you always want the messagebox, use "RequestExecutionLevel user" (There is no reason to do this, and the exe will not get the UAC icon overlay)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">2nd June 2011 06:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Not only is there no reason to do that, but it also makes things worse: Many users don't know how to 'Run as Admin', because they rely on UAC to do the elevation for them. If you request user, and then enforce admin, many people won't understand how to use the installer.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">shazia.parveen</span><br><span class="post-time small text-muted">2nd June 2011 11:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks so much for your support</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>