<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="404 error with Inetc corrupts the stack when /END is used"><title>404 error with Inetc corrupts the stack when /END is used - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">404 error with Inetc corrupts the stack when /END is used</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=263692">404 error with Inetc corrupts the stack when /END is used</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">pengyou</span><br><span class="post-time small text-muted">15th January 2007 01:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>404 error with Inetc corrupts the stack when /END is used</strong><br>I'm storing some registers on the stack and then using the Inetc plugin (in NSISdl mode) to download a file using an Inetc::get command which has /END at the end.<br><br>If the download is successful the plugin leaves one value on the stack (OK) but if the file is not found then the plugin leaves two values on the stack (on my Win98SE system):<br><br>File not found (404)<br>/END<br><br>My code checks the Inetc result by popping the result from the stack. Since my code did not expect this extra value (/END) some register corruption occurred when my code used the stack to restore the registers.<br><br>As a workaround I'm checking to see if /END is left on the stack when Inetc does not return "OK".</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Takhir</span><br><span class="post-time small text-muted">15th January 2007 14:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes, plug-in stops reading stack on error.. I'll add patch soon. Thanks, pengyou. May multi-download mode is excessive (not required in real life)? This case /end not required and it is easy to fix situation..</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pengyou</span><br><span class="post-time small text-muted">15th January 2007 14:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for the quick response.<br><br>Although my installer uses Inetc to download several files it only downloads one file at a time (I've never used the multi-download mode).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pengyou</span><br><span class="post-time small text-muted">18th January 2007 12:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The "1 January 2007" version of Inetc was leaving /END on the stack when it detected an error:<br><br>File Not Found (404)<br>/END<br>data-x<br>data-y<br>data-z<br><br>The "17 January 2007" version of the Inetc plugin leaves the stack with just one value on it if an error is detected:<br><br>File Not Found (404)<br><br>This means my installer is unable to restore the data-x, data-y and data-z values.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Takhir</span><br><span class="post-time small text-muted">18th January 2007 12:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sorry. Updated. Good news - popstring not crashes on null pointer ;)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pengyou</span><br><span class="post-time small text-muted">18th January 2007 13:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The new "18 January 2007" version of Inetc solves my problem.<br><br>Thanks for fixing it so quickly!</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>