<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Win7: Install a prog for user &quot;James&quot; correctly"><title>Win7: Install a prog for user "James" correctly - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Win7: Install a prog for user "James" correctly</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=340433">Win7: Install a prog for user "James" correctly</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">aRalf</span><br><span class="post-time small text-muted">11th January 2012 16:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Win7: Install a prog for user "James" correctly</strong><br>Hi, we want to install our software for a user James under Win7. Naturally we need admin rights to write into the program_files directory. NSIS first asks for authorization. Then we can only select an admin user and enter his password. From now on NSIS installs everything for this admin user and forgot that we wanted to install for user James at the beginning. After restarting as user James, the files reside in the admin's AppDataPath and James has no rights to write-access the files in AppDataPath.<br><br>How can we install a program for user James under Win7, giving him full access rights to the files in his AppDataPath?<br><br>Thanks for your help!<br><br>Best regards, aRalf</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">11th January 2012 18:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If it's a per user install then you shouldn't be writing to Program Files. Everything should be in $APPDATA.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aRalf</span><br><span class="post-time small text-muted">12th January 2012 15:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The Prog's Exe has to be written into "Program Files" during installation. The user afterwards has to be able to read/write in <b>his</b> $AppData during program run. Unfortunately, during installation the user changes from James to Admin so $AppData for Admin is used, but not for James.<br><br>That means any subdirectory in $AppData created during installation is for Admin. Can I switch back to user James during installation to create a subdir in James' $AppData?<br><br>Best regards, aRalf.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aRalf</span><br><span class="post-time small text-muted">15th January 2012 15:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I hope, my question is comprehensible. Is any information missing?<br><br>Best regards, aRalf</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">15th January 2012 19:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The proper way to do this (which is also the easiest way), is simply to let your program create the %APPDATA%\YourApp directory, instead of trying to do it from the installer. When the program is run (as the James user), the %APPDATA% variable will automatically point to the proper directory.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aRalf</span><br><span class="post-time small text-muted">16th January 2012 11:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This might be the solution. During install I copy everything I need into the <b>Programs</b> dir and later I copy it with the first start of the app into the respective user's <b>AppData</b> dir.<br><br>Several users can then reside on the same PC. I do not need to ask "one user or all users?" during install. Every time a new user starts the app, his appropriate data is copied anew into his AppData. For <b>deinstall</b> I write a hint into the registry each time?<br><br>Thank you AfrowUK and MSG for your help!<br><br>Best regards, aRalf</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aRalf</span><br><span class="post-time small text-muted">16th January 2012 11:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Good idea!</strong><br>Thanks for your help, Afrow UK and MSG.<br><br>I copy everything into the Programs dir during install. Later during first run, I copy it into the appropriate user's AppData dir :up:<br><br>I do not need to ask for "one user or all users?", as several users can get their own AppDatas. During every "first run" I write a hint into the registry for the uninstall?<br><br>Best regards, aRalf</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">16th January 2012 12:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes, writing a hint into the registry is probably the best solution for uninstall. In the uninstaller, you can use EnumUsersReg to go through every user's HKCU registry hive, to collect all the hints.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">16th January 2012 12:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You have three options that I can think of:<br>1. Enumerate all folders in the uninstaller under the value specified in the HKLM\Software\Microsoft\Windows NT\CurrentVersion\ProfileList\ProfilesDirectory value.<br>2. Enumerate all keys in the uninstaller under HKLM\Software\Microsoft\Windows NT\CurrentVersion\ProfileList and read each ProfileImagePath value.<br>3. Have your app write their uninstall path (under AppData) to each of the user's registry (HKCU) as you suggest and then enumerate the registry using EnumUsersReg in the uninstaller (bit more long-winded way).<br><br>You can't store a list of users in HKLM or Program Files because those locations are read-only for normal users.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aRalf</span><br><span class="post-time small text-muted">16th January 2012 14:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Thanks again!</strong><br>I will check all proposed uninstall ideas :)<br><br>Best regards, aRalf</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aRalf</span><br><span class="post-time small text-muted">18th January 2012 11:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi again,<br><br>unfortunately if I launch the program (with "Exec") directly at the end of the admin-install then the user is still admin. But I want to launch the program as the current user James! Now during direct launch the $Appdata path is the wrong one.<br><br>Do I have to drop the "direct launch" feature of NSIS?<br><br>Best regards, aRalf</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">18th January 2012 11:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">There are three solutions to this problem.<br><br>1) Disable the direct launch option. This is by far the easiest and most reliable solution. Recommended. The Run Now checkbox is a useless feature anyway.<br>2) Use the ShellExecAsUser plugin. Relatively simple solution, but will not always work. For more information, see this thread: <a href="http://forums.winamp.com/showthread.php?t=335435" target="_blank">http://forums.winamp.com/showthread.php?t=335435</a><br>3) Use the UAC plugin. Most complex solution. Should works in all cases, but only if you use it right.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aRalf</span><br><span class="post-time small text-muted">18th January 2012 12:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thank you MSG, we will use your method 1 ;-)</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>