<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Construct section id name during runtime" />

  <title>Construct section id name during runtime - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Construct section id name during runtime</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=344606">Construct section id name during runtime</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">BreezeUADN</span><br />
      <span class="post-time small text-muted">3rd May 2012 10:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Construct section id name during runtime</strong><br />
      Greetings<br />
      <br />
      <b>short version:</b><br />
      Section "sec" Sec1<br />
      SectionEnd<br />
      MessageBox MB_OK "${Sec1}" works<br />
      ("Sec1" in $2)<br />
      MessageBox MB_OK "${$2}" - want that to work<br />
      <br />
      <b>long version:</b><br />
      Well, I know it's illogical (even silly maybe) to do that sort of thing but maybe there is a workaround, or alternative solution for such a problem:<br />
      <br />
      0) I have several sections with id's like<br />
      Section "-Client" SECCLNT_Sec1<br />
      Section "-Client" SECCLNT_Sec2<br />
      ...<br />
      Section "-Server" SECSRVR_Sec1<br />
      Section "-Server" SECSRVR_Sec2<br />
      ...<br />
      Section "-Common" SECCMN_Sec1<br />
      ... and so on<br />
      so, after setup executable is compiled a section can be found either by it's displayable name (via SectionGetText + iteration through em all) or simply by id.<br />
      <br />
      1) I have an XML like<br />
      &lt;root&gt;<br />
      &lt;module&gt;Sec1&lt;/module&gt;<br />
      &lt;module&gt;Sec2&lt;/module&gt;<br />
      ...<br />
      &lt;/root&gt;<br />
      <br />
      The problem:<br />
      When a section is defined I could simply access it via id (int), like<br />
      SectionGetText ${Sec1} $R1 (gets displayable section text)<br />
      or MessageBox MB_OK ${Sec1} (prints int id)<br />
      but<br />
      Is there a way to somehow push (read from XML at runtime) "Sec1" name into ${}?<br />
      example:<br />
      ${xml::GetText} $2 $3 ... ("Sec1" in $2)<br />
      and then something like (SECCLNT_Sec1 is defined above)<br />
      SectionGetText "SECCLNT_$2" $R1 (compiles without warnings/errors but ofc. doesn't work since it requires a variable, not a text...)<br />
      <br />
      p.s. there is a few solutions I can think of but none are pretty, + I can't rely on section names since they all are the same, the only way to solve this is to store section id's inside of XML as an attributes, but then that XML becomes unreliable...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">3rd May 2012 11:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You could use names like Section "Client:C1" SECCLNT_Sec1 and parse and store these in a .ini in .onInit so you can get index from name. Then just set the display names to whatever you want before you get to the UI.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">BreezeUADN</span><br />
      <span class="post-time small text-muted">3rd May 2012 11:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ahhh, really - read a name from an xml, iterate through sections looking for that name, when found - do the work and then just rename... Thanks Anders that's a brilliant idea!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">3rd May 2012 12:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Reading from XML was not part of my plan, I would just write to a .ini in .onInit:<br />
      <br />
      [secmappings]<br />
      C1=2<br />
      C2=3<br />
      ...<br />
      <br />
      Then read the .ini when you need to know the index of C1...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">BreezeUADN</span><br />
      <span class="post-time small text-muted">3rd May 2012 14:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That would be more convenient yes, but (it's a bit complicated) unfortunately the script is flexible - most of it is generated dynamically: base nsi + generated nsh include with sections part and other stuff - that part changes all the time and could be transferred between PC's (uses sys. env. vars for paths) and because of that I should generate [secmappings] with that nsh part every time section tree changes. Then I'll have 2 files instead of one, and here comes the problem - someone could move only 1 file (i.e. mess up somehow) and my section indexes won't match section names anymore - so in this case indexes are unreliable as I mentioned in p.s. above... On top of that there comes the "license" (sort of) - XML file - that should contain this data anyways. Only "module" names inside, from which section names could be generated...<br />
      (err, prob my grammar skills is not good enough to make the phrases look "normal", sorry)</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
