<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="How to read version resource from the exe file" />

  <title>How to read version resource from the exe file - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">How to read version resource from the exe file</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=314555">How to read version resource from the exe file</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bubunia2000</span><br />
      <span class="post-time small text-muted">12th November 2009 17:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>How to read version resource from the exe file</strong><br />
      Hi all,<br />
      I read the NSIS documentation and found that we can add version tab to the generated EXE(VIAddVersionKey). If the installer wants to read the product version while installing to check whether that product version is already installed or not. Can it be possible in NSIS?<br />
      <br />
      Cheers<br />
      Pradeep</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">12th November 2009 18:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Easiest way is to write your version number to registry during install.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bubunia2000</span><br />
      <span class="post-time small text-muted">12th November 2009 19:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The reason Iam asking this way is I want when the exe is launched for installation I can query the registry whether the previous version exits or not in the registry. If it exists it will uninstall the earlier version and install the new instal else it will warn the user. So I need to know the "version info" prior the the launch of exe.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">12th November 2009 20:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I would suggest you make a !define at the top of your installer script. That way you can use the define everywhere (to compare to, and to write to the registry upon install), and when you compile a new version you only need to change the actual versionnumber once.<br />
      <br />
      Example:<br />
      <br />
      !define VERSIONNUM 3.1<br />
      <br />
      Section<br />
      WriteRegStr HKCU "Software\YourCompany\YourApp" "VersionNumber" ${VERSIONNUM}<br />
      SectionEnd<br />
      <br />
      <br />
      At the beginning of the first section, read the version number from registry and compare it to ${VERSIONNUM}. If it's different, uninstall the previous version.<br />
      <br />
      You can also use the VersionCompare function (see the wiki/google), to determine whether the previous install is a newer or an older version (in the .onInit function, for example).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sgiusto</span><br />
      <span class="post-time small text-muted">13th November 2009 16:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can read the version of an executable using GetDLLVersion (it works for exe files with version resource too)<br />
      <br />
      from the manual with some modifications:<br />
      GetDllVersion "$EXEPATH" $R0 $R1<br />
      IntOp $R2 $R0 / 0x00010000<br />
      IntOp $R3 $R0 &amp; 0x0000FFFF<br />
      IntOp $R4 $R1 / 0x00010000<br />
      IntOp $R5 $R1 &amp; 0x0000FFFF<br />
      StrCpy $0 "$R2.$R3.$R4.$R5"<br />
      <br />
      this should give in $0 the version of the installer<br />
      hope this helps<br />
      Stefano</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
