<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Assembler for NSIS" />

  <title>Assembler for NSIS - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Assembler for NSIS</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=328965">Assembler for NSIS</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">26th March 2011 22:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Assembler for NSIS</strong><br />
      &nbsp; <a href="https://sourceforge.net/projects/nslassembler/files/" target="_blank">https://sourceforge.net/projects/nslassembler/files/</a></p>

      <blockquote>
        nsL is a high-level language for NSIS (<a href="http://nsis.sourceforge.net" target="_blank">http://nsis.sourceforge.net</a>). The nsL assembler takes nsL code and translates it into NSIS script which can then be compiled into an NSIS installation wizard. nsL has a uniform syntax that is similar to familiar programming languages such as C and Java. Complex expressions can be written freely while being assembled into basic NSIS instructions. Functions are defined and called much like they are in C and Java with the additional syntax for multiple return values. nsL introduces assemble time scope checking of variables as well as automatic declaration and support for global variables declaration and initialization. nsL also provides more powerful pre-processor directives such as macros which can have multiple inputs and outputs, just like run-time functions.
      </blockquote>This is still work in progress but everything is there that allows one to write and build NSIS installers using the new language. Included is the source code, some example scripts and a first draft reference document. I am very interested in getting some feedback such as suggestions for changes, feature requests and bug reports.<br />
      <br />
      This project is part of my University degree but it's time for me to move on to other University related work before my exams in May/June. That does not mean I will be stopping work on nsL. I plan on adding support for arrays with the help of a small plug-in (among other things) but that will be done at a later stage. My demonstration for this project is on Tuesday (29th) so I would be grateful to get feedback tomorrow or Monday! I apologise for posting so close to the demonstration date but there was so many features that I wanted to add I got a little carried away.<br />
      <br />
      Anyway, run the executable file from the SourceForge page and then you will have a "Compile nsL Script" right-click option on ".nsl" files. You'll find some example scripts in NSIS\Examples\NSL.<br />
      <br />
      Edit: Attached an example script.<br />
      <br />
      Stu
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jiake</span><br />
      <span class="post-time small text-muted">27th March 2011 00:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It is very interesting, I like its style very much. :up:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">27th March 2011 04:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">(All of my comments are based on just reading the .pdf)<br />
      <br />
      "Before a variable can be used, it must<br />
      be assigned to" I don't really like this, I'm used to variables defaulting to "" if you never set them (And they don't need an initial value if you are going to be pop'ing into them)<br />
      <br />
      Using \ as escape is a bit painful in a installer since it usually contains a lot of paths, maybe you could add @"this\is\not\escaped" like C#? Or use ^ or something like that?<br />
      <br />
      Real functions (with overloading even) looks great!<br />
      <br />
      I'm not really a fan of the section syntax, what if we add another flag? Named arguments would also be better so you don't have to remember the order. What about something like<br />
      section MySection("hello world",/ReadOnly,"/newflag=space string",/Bold,1,2,...N), also, "optional" is not a good word for /o, IMHO you should call it unselected or unchecked. (I'm assuming /o is supposed to simulate [O] vs [X] )<br />
      <br />
      Did you forget about the /ENABLECANCEL flag for custom pages?<br />
      <br />
      Is there a way to tell how many parameters have been passed to a #macro? getmacroargcount() or something like that?<br />
      <br />
      There is an old bug in the nsis parser, MessageBox mb_ok "$${foo}" this should display "${foo}" and not "$" + the content of ${foo}, maybe you can either add a working escape for \$ ($\$ in nsis, but does not exist) or work around it in other ways in your string handling?<br />
      <br />
      Are functions merged? aka can you have more than one .onInit() assuming they have the same number of parameters? (You don't want this for normal functions, but it would be nice to have for the nsis callbacks)<br />
      <br />
      I assume the .docx is the same as the .pdf? I think .rtf has table support, all I know is, I can't (and will not try to) read .docx<br />
      <br />
      Not a big fan of java, but hey, the author gets to choose the language =)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">T.Slappy</span><br />
      <span class="post-time small text-muted">27th March 2011 07:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><b><font size="3">This looks totally awesome!</font></b><br />
      <br />
      Pluses:<br />
      I am very happy about C like syntax and case sensitivity.<br />
      Making own functions is fantastic, variable scope (finally!), arithmetic operators, code blocks, inlining NSIS code these all are great!<br />
      Using hash for defines is a little strange, but it reminds me a old-good C/C++ :)<br />
      <br />
      Minuses:<br />
      I am a little disappointed from function calls:<br />
      e.g<br /></p>
      <pre>
<code>CopyFiles("source", "dest", true, true, 99);<br />  CopyFiles /SILENT /FILESONLY "source" "dest" 99</code>
</pre><br />
      WTF is that <b>true, true, 99</b> ?<br />
      Althought I am skilled NSIS user on first signt I didn't have any idea what it means. I suggest to use <b>enums</b> for parameters [flags] - is this possible?<br />
      Maybe these flags should be ORed someone??<br />
      <pre>
<code>CopyFiles</code>("from", "to", CF_SILENT|CF_FILESONLY) 
</pre>Also sending some parameters as string is not good idea e.g<br />
      <pre>
<code>MessageBox("MB_OK|MB_ICONEXCLAMATION", "NSIS is not installed on this machine. Setup will now exit.");</code>
</pre><br />
      MB_OK|MB_ICONEXCLAMATION would fit perfectly for enums<br />
      <pre>
<code>enum MessageBox
<br />&gt;{
<br /> MB_OK,
<br /> MB_YES,
<br />...
<br />} 
</code>
</pre>I tried your .nsl with MUI2 and it does not work (as I assumed) :( so everything should be rewritten into .nsl which is enormus work.<br />
      I noticed that generated .nsi file requires a little of brushing.<br />
      <br />
      Anyway: nsL looks very promising and you made a really good job on it!<br />
      Thanks!!!<br />
      <br />
      Edit:<br />
      In this state I suggest using nsL in this style:<br />
      Create .nsl file where you create all logic, functions, etc because in nsL it is easier than in .nsi<br />
      and then generate .nsi file which you later include in your installer, you brush it a little and generate final installer.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">27th March 2011 12:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the feedback guys. Keep it coming! I will make note of everything.</p>

      <blockquote>
        Did you forget about the /ENABLECANCEL flag for custom pages?
      </blockquote>It is there; the last parameter after page callbacks can be a Boolean.<br />
      <br />

      <blockquote>
        "Before a variable can be used, it must<br />
        be assigned to" I don't really like this, I'm used to variables defaulting to "" if you never set them (And they don't need an initial value if you are going to be pop'ing into them)
      </blockquote>If you are popping into them then you are assigning to them, i.e. $0 = Pop();. You don't need to set them to an empty string. The point of having to assign to them before referring to variables is to avoid the problem of clobbering values. If you want to make a variable global, just stick an assignment to it outside functions and sections. I will add an optimisation that $R0 = ""; in global scope doesn't assemble anything (it will already be empty).<br />
      <br />
      getmacroargcount() is a good idea. There are probably plenty more that I could add really such as macrodef(name) and perhaps date() etc.<br />
      <br />

      <blockquote>
        Are functions merged?
      </blockquote>That's a nice idea. I could allow this for all functions by adding a partial keyword (C#) or just allow it for callbacks?<br />
      <br />
      The docx was included in the source code. The pdf is the Docs copy. The original plan was to write it in C++ but using Java of course allowed me to write code and debug much faster.<br />
      <br />
      Yes the \\ in strings is a real pain. I will add support for the C# @ prefix.<br />
      <br />

      <blockquote>
        MB_OK|MB_ICONEXCLAMATION would fit perfectly for enums
      </blockquote>I agree. This was something I wanted to change/add but again because of time constraints I had to leave as strings. If you want enums, would you prefer C style or C#. For example with C# you'd need "MessageBox." in front of each value; however I could have the assembler look for an enum with the same name as the current function and match those :). Either way you can use enums now (no constructor mind) as the | operator exists and you can define constants as numbers.<br />
      <br />
      As for MUI, I should include an example. It's actually very simple. Just add #nsis ... #nsisend sections with the MUI code in it. Maybe not very pretty but that's the best we can do probably. I need to add an #nsisdef or something similar to !define constants to nsL values (i.e. import values from nsL into NSIS) but maybe there is a nicer way. Any thoughts? (Defining all nsL constants as NSIS ones... no).<br />
      <br />
      Edit: New build uploaded which has the @ string prefix added. Also included a simple Modern UI 2 example script.<br />
      <br />
      Stu
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">27th March 2011 15:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I can't stand C# enums, and you should try to keep the amount of extra typing to a minimum and emulate the nsis constant names when possible...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">28th March 2011 00:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yeh I agree. I will keep it simple and predefine MB_* as constants (among others). Something else I need to add is to assemble MessageBox (and other jump instructions) specially in switch statements. Currently you can use them, sure, but it will first StrCpy IDOK for example to a register and use that register for the switch. This is not the case when used in if statements or while loops - e.g. the MessageBox or IfSilent go-to label arguments will be used instead, but you are limited to a true or false (i.e. IDOK or not).<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">29th March 2011 08:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">1.0.2 released.</p>

      <blockquote>
        1.0.2 - 28th March 2011<br />
        * Global assignments of "" to registers are no longer assembled<br />
        (registers are intialised to an empty string by NSIS).<br />
        * Fixed &lt; and &gt; operators using incorrect jump labels.<br />
        * Jump instructions when used in switch statements now receive similar<br />
        optimisations to their use in if statements. For example, MessageBox<br />
        can be used with cases "IDYES", "IDNO", "IDCANCEL" and so on. IfSilent<br />
        can be used with cases true or false. The go-to labels for each case<br />
        will be used directly on the jump instruction (i.e. IfSilent<br />
        label_case_true label_case_false) as is also done with if statements.<br />
        * Switch cases must have literal string, Boolean or integer values.<br />
        * Added missing 'default:' case for switch statements.<br />
        * Fixed Boolean values or instructions not being accepted as operands<br />
        for a Boolean operator.<br />
        * Fixed MessageBox being accepted as a Boolean value.<br />
        * Fixed MessageBox using 3 goto jumps on the end when only 2 are<br />
        allowed.<br />
        * Fixed If statements accepting a non-boolean expression.<br />
        * Fixed Boolean logic for || operator with left and right operands as<br />
        relative/equality comparisons.<br />
        * Added error on literal division by zero.<br />
        * More example scripts!
      </blockquote>Stu
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Zinthose</span><br />
      <span class="post-time small text-muted">29th March 2011 20:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Installation Issue</strong><br />
      &nbsp; I'm using a PortableApps version of NSIS so the install "Claims" that NSIS is not installed. I took a look at the SVN source and find that the installer get the install path from the registry, if the registry key is missing then kaboom. <a href="http://nslassembler.svn.sourceforge.net/viewvc/nslassembler/trunk/nsL/examples/Install.nsl?revision=1&amp;view=markup" target="_blank">Install.nsl --&gt; Line 18</a><br />
      <br />
      For a simple workaround, just add the portable apps path to the registry.. here is a VBScript that dose the trick:</p>
      <pre>
<code>
'## VBScript to provide a work around for installing nsL-Assembler
<br /><br /><br /><br />Dim NSISPath
<br /><br />Set fso = CreateObject("Scripting.FileSystemObject")
<br />Set objDialog = CreateObject("UserAccounts.CommonDialog")
<br />Set WshShell = CreateObject("Wscript.Shell")
<br /><br />'## Get the Current NSIS path if it exists in the registry
<br />   NSISPath = GetRegValue()
<br />    IfNot fso.FolderExists(NSISPath) Then NSISPath = WScript.Path
<br /><br />&gt;'## Define the "Open File" Dialog
<br />'## Prompt user to locate the makensis.exe file
<br />   objDialog.Filter = "makensis.exe|makensis.exe|All Files|*.*"
<br />   objDialog.FilterIndex = 1
<br />    objDialog</code>.InitialDir = NSISPath
<br />    intResult= objDialog.ShowOpen
<br /><br />&gt;If intResult = 0 Then
<br />   If GetRegValue() &lt;&gt; "" Then
<br />       If MsgBox("Do you want to delete the existing registry key?",36) = 6 Then
<br />            On Error Resume Next
<br />                WshShell.RegDelete("HKLM\SOFTWARE\NSIS")
<br />            On Error Goto 0
<br />       ElseIf MsgBox("Do you want to delete the existing registry value?",36) = 6 Then
<br />            On Error Resume Next
<br />                WshShell.RegDelete("HKLM\SOFTWARE\NSIS\")
<br />            On Error Goto 0
<br />        End If
<br />    Else
<br />        MsgBox "ABORT: Configuration Aborted by user."
<br />    End If
<br />    Wscript.Quit
<br />ElseIf fso.FileExists(objDialog.FileName) Then
<br />    '## Found it..  Setting the registry to match
<br />        NSISPath = fso.GetFile(objDialog.FileName).ParentFolder.Path
<br />        Wshshell.RegWrite "HKLMSOFTWARENSIS", NSISPath
<br />        
<br />    '## Validate
<br />        If GetRegValue() = NSISPath Then
<br />            MsgBox "Success: Registry Path was set to ***91;" &amp; NSISPath &amp; "***93;"
<br />        Else
<br />            MsgBox "FAILED: Unable to set registry setting. You might not have administrative access to edit the registry."
<br />        End If
<br />Else
<br />    Wscript.Quit
<br />    MsgBox "ERROR: File was not found!"
<br />End If
<br /><br />Function GetRegValue()
<br />    Dim Value
<br />    Value = ""
<br />    On Error Resume Next
<br />        Value = WshShell.RegRead("HKLMSOFTWARENSIS")
<br />    On Error Goto 0
<br />    GetRegValue = Value
<br />End Function 
<br />&gt;

</pre>↓ Your Welcome :D ↓
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">29th March 2011 21:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ah thanks. I may just remove that code as people can still use the assembler without NSIS installed anyway.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">16th April 2011 10:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If anyone else would like to play around with the language and post some more feedback I would be grateful.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>