<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Bug report (Rename on reboot)" />

  <title>Bug report (Rename on reboot) - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Bug report (Rename on reboot)</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=117349">Bug report (Rename on reboot)</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mottel</span><br />
      <span class="post-time small text-muted">10th December 2002 05:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Bug report (Rename on reboot)</strong><br />
      Rename on reboot doesnâ€™t seem to work properly (at least under Win98 SE and NSIS 2.0b0, CVS 2002-11-30).<br />
      <br />
      Under Win98, NSIS' Delete on reboot and Rename on reboot work by writing a string to $WINDIR\WININIT.INI. Upon boot-up, this file is read by Wininit.exe, which displays the boot-screen messages:<br />
      "Please wait while Setup updates your configuration files. This may take a few minutes," etc.<br />
      <br />
      (BTW, does anyone know how this is implemented under newer versions of Windows (e.g. XP) which don't boot to DOS initially? AFAIK, they don't use Wininit.exe, which is a DOS .exe.)<br />
      <br />
      The NSIS documentation on the Delete instruction warns that filename should be specified with a full path.<br />
      <br />
      (This ensures that when using Delete /REBOOTOK for a file that can't be overwritten, the entry in Wininit.ini, which takes the form:<br />
      <br />
      [Rename]<br />
      NUL=filename<br />
      <br />
      will correctly find the specified file.)<br />
      <br />
      The documentation on the Rename instruction says nothing about the need to specify filename with a full path. However, even when using:<br />
      Rename /REBOOTOK FullPath\SourceFile FullPath\DestinationFile,<br />
      if the source file is in use and cannot be overwritten, the entry written to Wininit.ini takes the form:<br />
      <br />
      [Rename]<br />
      =FullPath\SourceFile<br />
      (with nothing to the left of the equal sign.)<br />
      (and, note: the SOURCEfile appears to the RIGHT of the equal sign.)<br />
      <br />
      The result is that the Rename upon reboot does not work.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">10th December 2002 16:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It always makes me feel good when people find bugs from veresion previous to 2 because then I know more and more people are using NSIS to more and more things :D<br />
      <br />
      <b>This bug goes all the way back to NSIS 1.2f!!! That's a year and a half! :eek:</b><br />
      <br />
      To reproduce the bug all you need to do is rename an existing file that is in use to a name that does not exist. When doing this on Windows 9x NSIS can't find the short name of a non existing files so it puts nothing, an empty string, instead.<br />
      <br />
      In Windows NT (NT/2000/XP) NSIS uses the more powerful MoveFileEx that supports file names that are not 8.3 (DOS format) so there is no such problem.<br />
      <br />
      I will do my best to fix this ASAP, not that anyone but you will notice... Nobody have noticed it for a year and a half! ROFL :D<br />
      <br />
      BTW Mottel, like Joost said in another post, 2002-11-30 is an old version. Go download 2.0b0, some bugs were fixed prior to the release.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">10th December 2002 17:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK, fixed in latest CVS version. It now creats the file if it's not already there.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mottel</span><br />
      <span class="post-time small text-muted">11th December 2002 00:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        It always makes me feel good when people find bugs from veresion previous to 2 because then I know more and more people are using NSIS to more and more things
      </blockquote>(Glad to help.) I'm actually doing something rather interesting with NSIS that may be useful to others. I hope to post some preliminary results here in about 2-3 weeks.<br />
      <br />

      <blockquote>
        To reproduce the bug all you need to do is rename an existing file that is in use to a name that does not exist. When doing this on Windows 9x NSIS can't find the short name of a non existing files so it puts nothing, an empty string, instead.
      </blockquote>Some more info relevant to testing this sort of thing: A file can be "in use" and still be overwritten! It depends on what is using it. If you open a text file in Notepad, Windows will happily overwrite it. If you open it in Word, it won't. (I guess it depends on whether the individual program that is using the file locks it or not.)<br />
      <br />

      <blockquote>
        In Windows NT (NT/2000/XP) NSIS uses the more powerful MoveFileEx that supports file names that are not 8.3 (DOS format) so there is no such problem.
      </blockquote>I assume that while the PC is off, even Win2000/XP can't remember stuff to do upon reboot, so it would have to write it to a file that is read upon bootup. I've checked on a friend's XP machine, and I know it doesn't have a Wininit.exe. What file does it write, and what program reads the file upon bootup?<br />
      <br />

      <blockquote>
        BTW Mottel, like Joost said in another post, 2002-11-30 is an old version. Go download 2.0b0, some bugs were fixed prior to the release.
      </blockquote>Wow! Looks like a lot can happen in a week over there at CVS, when you're not looking! I take it that 2.0b0 is now an "official" (albeit Beta) release. :up:<br />
      <br />

      <blockquote>
        OK, fixed in latest CVS version. It now creates the file if it's not already there.
      </blockquote>Thanks. :up: I'm not a C programmer, so I don't have the tools to recompile NSIS, and I noticed on the CVS log-page that the latest Makensis.exe (1.120, Dec 7, 09:59 GMT) predates your bug fix (Dec 10) so could you please recompile it to incorporate this fix? :) I'll then download the release from the next nightly snapshot.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">11th December 2002 14:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Windows NT/2000/XP saves the information in the registry. You can find more information on it in the MSDN page about MoveFileEx: <a href="http://msdn.microsoft.com/library/en-us/fileio/base/movefileex.asp" target="_blank">http://msdn.microsoft.com/library/en...movefileex.asp</a><br />
      <br />
      Compiled version uploaded.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
