<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="InstallOptions as an extension DLL"><title>InstallOptions as an extension DLL - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">InstallOptions as an extension DLL</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=68756">InstallOptions as an extension DLL</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">justin</span><br><span class="post-time small text-muted">15th December 2001 06:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>InstallOptions as an extension DLL</strong><br>Anybody want to do it, or should I?<br><br>Benefits:<br>* better integration (can subclass and do things like use the normal cancel and next&gt; buttons -- see nsisdl.dll for some good examples)<br>* better script integration (don't have to write out the HWND, can have items go direct from/to variables)<br><br>Downsides:<br>* have to make sure the DLL frees all memory, since it is running in-process (looks like this can already be done with a #define in installoptions.exe :)<br><br>Thoughts, etc? :)<br><br>-Justin</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">justin</span><br><span class="post-time small text-muted">15th December 2001 10:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Went ahead and got bored and hacked it together.<br><br>From the iodll.cpp header:<br><br>* key changes<br>* - no longer need parentwnd ini writing shit<br>* - to call now, use:<br>* Push $TEMP\inst.ini<br>* CallInstDLL $TEMP\mydll.dll dialog<br>* Pop $0<br>* ($0 would be "success" "cancel" or some other value on error.<br>* - new INI entries: [settings]\cancelconfirm (text to confirm cancel on cancel button click)<br>* - fixed some flag related bugs (multiple of them at 0x100 etc)<br>* - made it so you can specify positions in negative, for distance from the right/bottom edges.<br>* - made it so that the file/dir requests automatically size the browse button in<br>* - removed a lot of code for the old style integration<br>* - removed support for silent installers (it seems the old version would bring up it's own dialog)<br><br><br>Attached is source and compiled version (in release/)<br><br>-Justin</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">petersa</span><br><span class="post-time small text-muted">15th December 2001 10:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This is a great idea, Justin! :D<br><br>Small problem, though. The compiled installer can't be cancelled. You <i>have</i> to choose Next. Why doesn't this work?<br><br>I really don't like that old Win3.1ish box you get when you click the Browse button either. Or the useless Read-Only checkbox on it.<br><br>Any chance of putting the [Settings]\Title option back in?<br><br>Hiding the disabled Back button?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Hando</span><br><span class="post-time small text-muted">15th December 2001 11:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Error with .nsi</strong><br>The example test.nsi has an error in it. Calls a non-existant label/function "Quit".</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Thor</span><br><span class="post-time small text-muted">15th December 2001 12:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Great idea<br>i was wondering before why install options needed to be a seperate exe, instead of beeing a plugin like nsisdl...<br><br>btw Justin, would it be a good idea to make splash.exe a plugin too?<br>prolly not really any more usefull i suppose...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">F. Heidenreich</span><br><span class="post-time small text-muted">15th December 2001 18:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by petersa</i><br><b><br>I really don't like that old Win3.1ish box you get when you click the Browse button either. Or the useless Read-Only checkbox on it.</b></blockquote>Simply add two new flags to the flag table at ReadSettings<br><pre>
<code><br>{ "FILE_EXPLORER",     OFN_EXPLORER      },<br>{ "FILE_HIDEREADONLY", OFN_HIDEREADONLY  },<br></code>
</pre><br>
      <br>
      With the FILE_EXPLORER flag you have the new-style dialog box, the FILE_HIDEREADONLY flag ... will hide the readonly checkbox :)<br>
      <br>
      Regards,<br>
      ~ Florian
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br>
      <span class="post-time small text-muted">15th December 2001 18:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">maybe a good idea (i hope so):<br>
      Maybe it's possible to allready have a window or something at .onInint to be able to use InstOpts there?<br>
      <br>
      But maybe that conflicts with the use of splash, but i don't know, I'm no c expert, sorry...<br>
      <br>
      The reason i'm asking: it would be a lot easier to ask for e.g. RegCodes or something. Right now, i'm using a second installer which has instopts in a section, in my .onInit to ask for RegCode.<br>
      <br>
      Hendri.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">justin</span><br>
      <span class="post-time small text-muted">15th December 2001 19:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here's an updated DLL+source:</p>

      <ul>
        <li>Return of [Settings]\Title support</li>

        <li>Keyboard shortcuts fix (elegant way :).</li>

        <li>Fixes for file open dialog (doesn't prompt you twice on cancel)</li>

        <li>Fixes of test.nsi</li>
      </ul><br>
      And to those who asks, cancel should work, the result will be "cancel" on the top of the stack (so you can act accordingly in your script).<br>
      <br>
      -Justin
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">justin</span><br>
      <span class="post-time small text-muted">15th December 2001 19:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Smile2Me</i><br>
        <b>maybe a good idea (i hope so):<br>
        Maybe it's possible to allready have a window or something at .onInint to be able to use InstOpts there?<br>
        <br>
        But maybe that conflicts with the use of splash, but i don't know, I'm no c expert, sorry...<br>
        <br>
        The reason i'm asking: it would be a lot easier to ask for e.g. RegCodes or something. Right now, i'm using a second installer which has instopts in a section, in my .onInit to ask for RegCode.<br>
        <br>
        Hendri.</b>
      </blockquote>There are issues with that currently, but that's not to say it couldn't happen soon. I'll work on a solution.<br>
      <br>
      <br>
      -Justin
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">justin</span><br>
      <span class="post-time small text-muted">15th December 2001 20:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK here's another update. Made the back button optional now, and started upgrading NSIS for better integration. I'll put up nsis 1.9b2 up later today that will really help (a couple of new callbacks and a new instruction). Included in the .zip is an example test-setup.exe, that shows how you can go backwards and forwards..<br>
      <br>
      Something I am thinking is, I want to store the results of a dialog in the ini in such a way so that when you read it back in, the changes you made are saved.<br>
      <br>
      That way, when you go back to a page you already editted, your changes will be preserved. and so on.<br>
      <br>
      The new callbacks I've added to NSIS aren't really right yet. It's a pain figuring out the most general but not painful way to do these things.<br>
      <br>
      -Justin</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">justin</span><br>
      <span class="post-time small text-muted">16th December 2001 01:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here's yet another version, that adds a few options, but the primary difference is that it reads control state information from State=, and writes out the results to the same place (this lets you do neat things like in the example I included). The example I included requires NSIS 1.9b2 which is on <a href="http://www.firehose.net/free/nsis/" target="_blank">www.firehose.net/free/nsis/</a> (I also included a compiled exe for you to try)<br>
      <br>
      Try this puppy out, let me know what you think.. I suppose I'll clean it up, update the documentation, and all that, unless Michael would rather do it. :)<br>
      <br>
      -Justin</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br>
      <span class="post-time small text-muted">16th December 2001 08:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hi justin,<br>
      <br>
      i noticed a little detail in test-setup.exe:<br>
      if instopts have been displayed and you continue to select a dir, but then again return to the instopts page, the Next button still says "install"<br>
      <br>
      Greetzzz, Hendri.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br>
      <span class="post-time small text-muted">16th December 2001 08:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hi justin,<br>
      <br>
      sorry, i found the necessary settings to change button text in test.ini...<br>
      <br>
      another thing, we can call instopts after license now. So including RegCode has become possible! Well done!!!<br>
      <br>
      Greetz, Hendri.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br>
      <span class="post-time small text-muted">16th December 2001 14:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Justin,<br>
      <br>
      i think i have found a little bug in InstOpts.dll (that's also in InstOpts.exe BTW):<br>
      <br>
      i use editboxes to get user name and regcode. if these are left blank, then instopts procudes a runtime error.<br>
      <br>
      (at least in my install...)<br>
      <br>
      good luck, greetz, Hendri.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br>
      <span class="post-time small text-muted">16th December 2001 15:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Justin,<br>
      <br>
      two more strange things i noticed using 1.9b2 and instoptsdll4:<br>
      <br>
      -if you use a splash screen, the installer moves to the background suddenly after finishing the splash (no problem in 1.81!)<br>
      <br>
      -if you use .onNextPage and .onPrevPage and program something in these functions (eg a Messagebox, eg after checking RegCode) than the first screen (lisence) appears again, then the message appears and after clicking ok, the page for dirselect appears...<br>
      <br>
      So my order of pages is: lisence agreement, RegCode, DirSelect,...<br>
      <br>
      and using 1.9b2 and instoptsdll4, the installer returns to lisence while checking the code and after that, moves on to DirSelect.<br>
      <br>
      Why is the installer returning to the lisence agreement between page changes?<br>
      <br>
      Greetz, Hendri.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Hando</span><br>
      <span class="post-time small text-muted">16th December 2001 17:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">.onNextPage and .onPrevPage work for next/previous screens but what if you wanted to do something on the inital screen?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">justin</span><br>
      <span class="post-time small text-muted">16th December 2001 20:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Hando</i><br>
        <b>.onNextPage and .onPrevPage work for next/previous screens but what if you wanted to do something on the inital screen?</b>
      </blockquote>In .onInit do:<br>
      <pre>
<code><br>BringToFront<br>CallInstDLL...<br></code>
</pre><br>
      <br>
      BringToFront is necessary because in .onInit the installer window is initially hidden.<br>
      <br>
      -Justin
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">justin</span><br>
      <span class="post-time small text-muted">17th December 2001 01:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Smile2Me</i><br>
        <b>Justin,<br>
        <br>
        i think i have found a little bug in InstOpts.dll (that's also in InstOpts.exe BTW):<br>
        <br>
        i use editboxes to get user name and regcode. if these are left blank, then instopts procudes a runtime error.<br>
        <br>
        (at least in my install...)<br>
        <br>
        good luck, greetz, Hendri.</b>
      </blockquote>Hmm, empty editboxes don't cause problems for me.. Anything in particular you are doing? Feel free to post your .nsi etc..<br>
      <br>
      -Justin
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br>
      <span class="post-time small text-muted">17th December 2001 07:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hi justin,<br>
      <br>
      sorry, nsi not available right now, because i'm not at home...<br>
      but this is what i'm doing:<br>
      <br>
      using .onNextPage and .onPrevPage to activate the ini with editboxes using instopts.dll dialog.<br>
      Then reading the output of the dll (Pop $R8).<br>
      using this to determine what to do (just as in your example...)<br>
      The if user has clicked "register", read the ini with readinistr $0 $TEMP\mtlis.ini "FIELD 5" State<br>
      <br>
      And this causes some problem, i think in instopts.dll but maybe it's in my install if you do not experience problems...<br>
      <br>
      Well what I do next:<br>
      pass regname and regcode to exe: execwait "check.exe n=$0 c=$1"<br>
      and in my exe there's a try environment, so this cannot cause any problem (i guess...)<br>
      <br>
      This exe pushes a 1 if name and code match, a 0 otherwise (eg on error). Then the install checks whether the exitcode of the exe is 1 or 0 and display a message...<br>
      <br>
      But I had some trouble before using this try in a dll (there it didn't do anything so maybe this is the case here, see the thread on RegCode). I will check the source code of my checker, thanks for you response!!<br>
      <br>
      And what about this returning to first page thing??? I want to display a message (eg: Code is ok, thx for registering) but this message appears on top of the lisence agreement (the prev page) and than (after clickin ok) the installer shift to dirselect. This message should be on top of the regname and regcode page, shouldn't it?<br>
      <br>
      Thx for your trouble, greetz, Hendri.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">justin</span><br>
      <span class="post-time small text-muted">17th December 2001 08:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Smile2Me</i><br>
        hi justin,<br>
        <br>
        sorry, nsi not available right now, because i'm not at home...<br>
        but this is what i'm doing:<br>
        <br>
        using .onNextPage and .onPrevPage to activate the ini with editboxes using instopts.dll dialog.<br>
        Then reading the output of the dll (Pop $R8).<br>
        using this to determine what to do (just as in your example...)<br>
        The if user has clicked "register", read the ini with readinistr $0 $TEMP\mtlis.ini "FIELD 5" State<br>
        <br>
        And this causes some problem, i think in instopts.dll but maybe it's in my install if you do not experience problems...<br>
        <br>
        Well what I do next:<br>
        pass regname and regcode to exe: execwait "check.exe n=$0 c=$1"<br>
        and in my exe there's a try environment, so this cannot cause any problem (i guess...)<br>
        <br>
        This exe pushes a 1 if name and code match, a 0 otherwise (eg on error). Then the install checks whether the exitcode of the exe is 1 or 0 and display a message...<br>
        <br>
        But I had some trouble before using this try in a dll (there it didn't do anything so maybe this is the case here, see the thread on RegCode). I will check the source code of my checker, thanks for you response!!
      </blockquote>Hmm, I'm not sure why this would cause a crash.. does your code properly handle where the command line has n= and c= (meaning no text after them)...<br>
      <br>

      <blockquote>
        And what about this returning to first page thing??? I want to display a message (eg: Code is ok, thx for registering) but this message appears on top of the lisence agreement (the prev page) and than (after clickin ok) the installer shift to dirselect. This message should be on top of the regname and regcode page, shouldn't it?<br>
        <br>
        Thx for your trouble, greetz, Hendri.
        <hr>
      </blockquote>
    </div>
    <hr>
    Ahh this is because you are calling the messagebox from within onNextPage, which is called before the license page is hidden. You could do one of the following:<br>

    <ul>
      <li>Use installoptions to make the thank-you dialog within the main window.</li>

      <li>Call HideWindow, then MessageBox, and then BringToFront at the end. (this will hide the main install window while it displays the messagebox).</li>
    </ul><br>
    Probably the first item is nicer looking :) And you can always dynamically generate the ini file using WriteINIStr (so you can include their name and regcode or something like that).<br>
    <br>
    -Justin<br>
    <br>
    -Justin<br>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br>
      <span class="post-time small text-muted">17th December 2001 08:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hi justin,<br>
      <br>
      Quote:</p>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br>
        <span class="post-time small text-muted">17th December 2001 08:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"></p>

        <blockquote>
          Use installoptions to make the thank-you dialog within the main window.
        </blockquote>well i copied the wrong one :)<br>
        <br>
        The above is a great idea!<br>
        <br>
        Greetz, Hendri.
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">eccles</span><br>
        <span class="post-time small text-muted">17th December 2001 17:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Hi Justin...<br>
        <br>
        I too was having problems with splash screens with NSIS 1.9x, and the new .onNextPage/.onPrevPage functions were /almost/ letting me do something I've wanted to do for ages, so I thought I'd dive in again... :)<br>
        <br>
        How about this..? I've moved .onInit back to where it was, but made .onNextPage triggered before the first page as well as the others. I've also made it possible to jump to any page you like from .onNextPage/.onPrevPage by doing e.g., Abort 2, to go forward 2 pages. Abort 1 in .onNextPage, and Abort -1 in .onPrevPage, would be the same as returning normally without an Abort.<br>
        <br>
        btw, using makensis-bz2.exe saves my installer a whole MB :cool: (down to 7.5MB from 8.5MB).<br>
        <br>
        Dave.</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">justin</span><br>
        <span class="post-time small text-muted">17th December 2001 19:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"></p>

        <blockquote>
          <i>Originally posted by eccles</i><br>
          I too was having problems with splash screens with NSIS 1.9x, and the new .onNextPage/.onPrevPage functions were /almost/ letting me do something I've wanted to do for ages, so I thought I'd dive in again... :)
        </blockquote>What exactly is the problem with splash screens in 1.90? They seem to work fine for me.<br>
        <br>

        <blockquote>
          How about this..? I've moved .onInit back to where it was, but made .onNextPage triggered before the first page as well as the others. I've also made it possible to jump to any page you like from .onNextPage/.onPrevPage by doing e.g., Abort 2, to go forward 2 pages. Abort 1 in .onNextPage, and Abort -1 in .onPrevPage, would be the same as returning normally without an Abort.
        </blockquote>Hmm, not sure how I feel about this... I guess being able to skip pages is nice, but it increases teh complexity.. Also, did you need to modify exec.c for Abort -1/1/2? :)<br>
        <br>
        -Justin
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Angry Weasel</span><br>
        <span class="post-time small text-muted">17th December 2001 20:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">I think NSIS needs this sort of functionality built in. The ability to create up to eight pages (it's a bit much but you never know), and you would (with my proposed method) specify the contents as follows:<br>
        <br>
        [code]<br>
        ; Instead of the SubCaption <i>page_num</i> function, you would just do this:<br>
        ; If the page name is one of the defaults, "License", "DirSelect", etc. then NSIS should look for the appropriate data here. A page name of "Init" would be the first page displayed in the installer.<br>
        <br>
        Page "License"<br>
        <br>
        PageIn 1 2 ; this is much like SectionIn, it specifies which install type(s) will display this page<br>
        <br>
        SubCaption ": License Agreement" ; Not changed from the default,<br>
        ; only used to illustrate my idea for a new SubCaption function.<br>
        <br>
        PutText 50,50 "You must agree to the following license before continuing:" ; This replaces the LicenseData function, and allows<br>
        ; the user to place any text on any page. Syntax: PutText x,y "text"<br>
        ; where x is the distance from the left and y is the distance from the top<br>
        <br>
        TextBox 50,75 "license.txt" /noedit ; Places a textbox on a page. By<br>
        ; default it would be editable, so the /noedit switch allows for it<br>
        ; to be grayed out like the current license agreement.<br>
        <br>
        CheckBox 50,300"I &amp;Agree" AgreeCBox /type=checkbox ; The /type switch<br>
        ; specifies whether it's a radio button (with radiobuttons, they<br>
        ; would all be part of the same set for a particular page, meaning<br>
        ; only one radiobutton could be selected per page.) or a checkbox,<br>
        ; AgreeCBox is the name which can be called by the VerifyCB function.<br>
        <br>
        PageEnd<br>
        Function .onVerifyPage License ; Nice callback. If Abort is called within this, then the Next button for the specified page is greyed out until the condition triggering the abort is no longer true.<br>
        <br>
        VerifyCB $0 AgreeCBox ; Stores the status ("true" for<br>
        ; checked, "false" for unchecked) of checkbox <i><b>AgreeCBox</b></i><br>
        ; in user variable <i><b>$0</b></i>.<br>
        StrCmp $0 "true" UserAgrees<br>
        Abort<br>
        UserAgrees:<br>
        CallPage "DirSelect" ; This would call whatever you want the next page to be.<br>
        FunctionEnd</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">eccles</span><br>
        <span class="post-time small text-muted">17th December 2001 21:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"></p>

        <blockquote>
          <i>Originally posted by justin</i><br>
          <b>What exactly is the problem with splash screens in 1.90? They seem to work fine for me.</b>
        </blockquote>First off, I'm working in XP at the mo, so maybe it's an XP only thing...<br>
        <br>
        I use a modified splash.exe which waits indefinitely. My installer Exec's it, waits for a short pause, brings up a message box, then sends a message to close it afterwards.

        <ul>
          <li>With NSIS 1.90 the splash screen doesn't become visible until the message box is shown.</li>

          <li>When it is shown, it appears in front of the message box.</li>

          <li>Admittedly, I could get around this by sending 0 instead of $HWNDPARENT (?)</li>
        </ul>

        <blockquote>
          <i>Originally posted by justin</i><br>
          <b>Hmm, not sure how I feel about this... I guess being able to skip pages is nice, but it increases teh complexity.. Also, did you need to modify exec.c for Abort -1/1/2? :)<br>
          <br>
          -Justin</b>
        </blockquote>Well, did you think I made those earlier savings for nothing? :D<br>
        <br>
        But no - didn't touch it. Only modified ui.c. In some ways it's simpler than before? (.onNextPage/.onPrevPage are only called from one place, for instance.) Have you cast a quick eye over the changes?<br>
        <br>
        Thanks anyway,<br>
        <br>
        Dave.
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">justin</span><br>
        <span class="post-time small text-muted">18th December 2001 01:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Fine fine. :)<br>
        Since 1.90 was never on nullsoft.com (only firehose.net) I updated it silently.<br>
        <br>
        -Justin</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">eccles</span><br>
        <span class="post-time small text-muted">18th December 2001 06:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Cheers Justin :)<br>
        <br>
        Dave.</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br>
        <span class="post-time small text-muted">18th December 2001 07:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Hi justin,<br>
        <br>
        this is my .onInit:<br>
        <br></p>
        <pre>
<code>  File /oname=spltmp.bmp "splash.bmp"<br>  File /oname=spltmp.exe "splash.exe"<br>  ExecWait '"$TEMP\spltmp.exe" 3000 $HWNDPARENT $TEMP\spltmp'<br>  BringToFront<br>  Delete "$TEMP\spltmp.exe"<br>  Delete "$TEMP\spltmp.bmp"</code>
</pre><br>
        <br>
        But still my installer moves to the background after finishing splash. So I have to click in the taskbar to activate it again...<br>
        <br>
        Greetz, Hendri.
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">eccles</span><br>
        <span class="post-time small text-muted">18th December 2001 07:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Hi Hendri...<br>
        <br>
        Have you tried the slightly-modified NSIS 1.90 from firehose.net? .onInit has been moved back to where it used to be (before NSIS creates any windows).<br>
        <br>
        Also, you shouldn't need the BringToFront now. (Actually, maybe this is what's doing the damage now)...<br>
        <br>
        --<br>
        Dave.</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br>
        <span class="post-time small text-muted">18th December 2001 10:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Dave, thx, i'll download it now.<br>
        I didn't realize there was a difference between 1.9 from Nullsoft and that from firehose...<br>
        <br>
        Greetz, Hendri.</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br>
        <span class="post-time small text-muted">18th December 2001 11:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"><strong>it works!!!</strong><br>
        hmmm,<br>
        <br>
        now the splash works and the installer doesn't move to the background anymore (I also removed BringToFront)<br>
        <br>
        But also the page numbers have changed!!! so I had to adapt onNextPage and onPrevPage commands...<br>
        <br>
        but it works fine now.<br>
        <br>
        The nice thing about onNextPage and onPrevPage is that it's possible to do something like .onVerifyInstDir but now only after clicking install. So much problems solved!<br>
        <br>
        Thx greetz, Hendri.</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">eccles</span><br>
        <span class="post-time small text-muted">18th December 2001 11:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"><strong>Re: it works!!!</strong><br></p>

        <blockquote>
          <i>Originally posted by Smile2Me</i><br>
          <b>But also the page numbers have changed!!! so I had to adapt onNextPage and onPrevPage commands...<br>
          <br>
          Thx greetz, Hendri.</b>
        </blockquote>Sorry about that.. my fault :) They shouldn't change again...<br>
        <br>
        --<br>
        Dave.
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br>
        <span class="post-time small text-muted">18th December 2001 12:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Dave, thx, it's ok...<br>
        the change of page numbers was due to the movement in .onInit,<br>
        but i saw the problem and what caused it, so no problems anymore :D.<br>
        <br>
        Now my installer does everything i always wanted it to do:<br>
        -Check dir at clicking install<br>
        -display splash<br>
        -ask for regcode<br>
        -create backup<br>
        -install the main program into another application<br>
        -automatic uninstall if previous version is detected<br>
        -and much more....<br>
        <br>
        so i'm happy :)<br>
        <br>
        Maybe, after the 4th of january, Justin will post new possibilities for NSIS and i will get back to work again, but for the moment:<br>
        <br>
        HOLIDAYS!!!<br>
        <br>
        Thx all and greetz, Hendri.</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Hando</span><br>
        <span class="post-time small text-muted">18th December 2001 15:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"><strong>1.90 changes schmanges</strong><br>
        Here's what I want to do:<br>
        I have a folio of work which I plan to distribute on CD. When the user runs the installer they are given a choice whether they wish to install the folio to their harddrive and run it as an application or run a "lite" (HTML version) from the CD. If the user selects the app version then the installer continues, otherwise I open the webpage and the installer aborts.<br>
        <br>
        Unfortunately the difference between 1.90 at firehose.net and the newer 1.90 has broken my script. With 1.90 from firehose.net I could call the InstallOptions dll with .onInit and the first screen the user saw was my InstallOptions choices page. Now when I compile and run it, it skips the InstallOptions screen and jumps right to the component page.<br>
        <br>
        While I could continue using the older 1.90 I will probably want to take advantage of improvements/features in later releases. So how can I implement this in the new version?</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">eccles</span><br>
        <span class="post-time small text-muted">18th December 2001 17:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Mmm, sorry about that, my fault again :(<br>
        <br>
        The last couple of 1.9 betas and the original 1.90 broke some installers' splash screens behaviour because they were changed so that .onInit was called after the NSIS window had been created. I submitted a modification which Justin kindly merged in which put the call to .onInit back to where it was (before the NSIS window is created). However, the .onNextPage callback was also changed so that it is also called before the first page (the same place .onInit was called in the original 1.90), so you can move your call to InstallOptions to the .onNextPage function to get the same behaviour as before. The only other change you'll need is to set a flag (in .onInit) and test for it before showing InstallOptions, as .onNextPage is called for every page change.</p>
        <pre>
<code>Function .onInit<br>  StrCpy $9 ""<br>FunctionEnd<br><br>Function .onNextPage<br>  StrCmp $9 "" isFirstPage<br>    Return<br>isFirstPage:<br>  StrCpy $9 "Y"<br>  ; Do InstallOptions stuff<br>FunctionEnd</code>
</pre><br>
        HTH<br>
        <br>
        --<br>
        Dave.
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Hando</span><br>
        <span class="post-time small text-muted">19th December 2001 15:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"><strong>thanx</strong><br>
        problem solvered!</p>
      </div>
      <hr>

      <div class="footer">
        <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
      </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
      hljs.initHighlightingOnLoad();
      //]]>
      </script>

      <table cellpadding="6" cellspacing="0" border="0" width="100%">
        <tr>
          <td class="alt2">
            <hr>
            Call HideWindow, then MessageBox, and then BringToFront at the end. (this will hide the main install window while it displays the messagebox).<br>
            <br>
            Probably the first item is nicer looking And you can always dynamically generate the ini file using WriteINIStr (so you can include their name and regcode or something like that). This is a great idea! I will implement it when i get home, after first completing my final exam of Applied Microeconomics :(<br>
            <br>
            I will also check whether my check.exe handles empty strings allright. I allready tested this a little bit and did not find problems. Maybe there is something I overlooked...<br>
            <br>
            But this should be caught by try (if it does work...) I'll test some more :)<br>
            <br>
            Thx, greetz, Hendri.</td></tr></table></div></div></body></html>