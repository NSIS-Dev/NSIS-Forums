<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Installing fonts script error with InstallTTFFont (FontReg)" />

  <title>Installing fonts script error with InstallTTFFont (FontReg) - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Installing fonts script error with InstallTTFFont (FontReg)</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=209326">Installing fonts script error with InstallTTFFont (FontReg)</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mattwilkinson</span><br />
      <span class="post-time small text-muted">2nd March 2005 12:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Installing fonts script error with InstallTTFFont (FontReg)</strong><br />
      &nbsp; I am having problems trying to use the FontReg macro. I have included the fontreg and fontname .nsh files and have put the !include at the top of my script.<br />
      <br />
      I am calling the code using this:<br />
      SetOutPath "$FONTS"<br />
      File "${SOURCEDIR}\FREE.ttf"<br />
      StrCpy $FONT_DIR $FONTS<br />
      !insertmacro InstallTTFFont 'FREE.TTF'<br />
      SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0 /TIMEOUT=5000<br />
      <br />
      <br />
      When compiling the script - I get this error:<br />
      StrCpy $FONT_DIR "$FONTS" () ()<br />
      !insertmacro: InstallTTFFont<br />
      Push: $R0<br />
      Push: $R1<br />
      Push: $R2<br />
      !define: "Index"="Line1183.5"<br />
      SetOutPath: "$FONT_DIR"<br />
      IfFileExists: "$FONT_DIR\FREE.TTF" ? Line1183.5 :<br />
      File: "FREE.TTF" -&gt; no files found.<br />
      Usage: File [/nonfatal] [/a] ([/r] [/x filespec [...]] filespec [...] |<br />
      /oname=outfile one_file_only)<br />
      Error in macro InstallTTFFont on macroline 9<br />
      <br />
      <br />
      <br />
      I think that I am not doing something simple but can't figure out what it is . Can anyone help????</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">2nd March 2005 14:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, what does it say? "File: "FREE.TTF" -&gt; no files found"<br />
      You are passing the path to FREE.TTF to the macro, but you haven't specified the proper path. Unless the font file is in the same folder as your script, you need to make sure you specify the full path, e.g C:\font.ttf<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mattwilkinson</span><br />
      <span class="post-time small text-muted">3rd March 2005 10:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That's it, thanks.<br />
      <br />
      The next headache is that I get an invalid file handle reported by the macro.<br />
      <br />
      StrCpy $FONT_DIR $FONTS<br />
      !insertmacro InstallTTFFont '${SOURCEDIR}\FREE.TTF'<br />
      SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0 /TIMEOUT=5000<br />
      <br />
      Any clues?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">3rd March 2005 14:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Firstly make sure you have HWND_BROADCAST defined as a variable, e.g.<br />
      Var $hwnd<br />
      !define HWND_BROADCAST $hwnd<br />
      and make sure you !include WinMessages.nsh.<br />
      Both need to be at the top of your script.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">3rd March 2005 19:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">HWND_BROADCAST is defined in WinMessages.nsh. You shouldn't define it as $hwnd, it's already defined as 0xFFFF.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Huette</span><br />
      <span class="post-time small text-muted">8th August 2005 16:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've got a similar problem and can't figure out what's wrong. The Error is:<br />
      <br />
      Section: "Systemfiles" -&gt;(SystemFiles)<br />
      StrCpy $FONT_DIR "$WINDIR\Fonts" () ()<br />
      SetOutPath: "$FONT_DIR"<br />
      File: "webdings.ttf" 118752 bytes<br />
      File: "ariblk.ttf" 117028 bytes<br />
      !insertmacro: InstallTTFFont<br />
      Push: $0<br />
      Push: $R0<br />
      Push: $R1<br />
      Push: $R2<br />
      !define: "Index"="Line221.6"<br />
      !insertmacro: GetFileNameCall<br />
      Push: webdings.TTF<br />
      Call "GetFileName"<br />
      Pop: $0<br />
      !insertmacro: end of GetFileNameCall<br />
      !define: "FontFileName"="$0"<br />
      SetOutPath: "$FONT_DIR"<br />
      IfFileExists: "$FONT_DIR\$0" ? Line221.6 :<br />
      File: "webdings.TTF" -&gt; no files found.<br />
      Usage: File [/nonfatal] [/a] ([/r] [/x filespec [...]] filespec [...] |<br />
      /oname=outfile one_file_only)<br />
      Error in macro InstallTTFFont on macroline 14<br />
      Error in script "D:\Updates\Ready4Risk\Update Ready4Risk.nsi" on line 221 -- aborting creation process<br />
      <br />
      <br />
      This is my section:<br />
      <br />
      Section "Systemfiles" SystemFiles<br />
      StrCpy $FONT_DIR "$WINDIR\Fonts"<br />
      SetOutPath "$FONT_DIR"<br />
      File "D:\Quellen\Fonts\webdings.ttf"<br />
      File "D:\Quellen\Fonts\ariblk.ttf"<br />
      !insertmacro InstallTTFFont 'webdings.TTF'<br />
      !insertmacro InstallTTFFont 'ariblk.ttf'<br />
      SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0 /TIMEOUT=5000<br />
      SectionEnd<br />
      <br />
      File "D:\Quellen\Fonts\webdings.ttf" -&gt; is definetly the correct path to the font</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">8th August 2005 17:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The InstallTTFFont macro already contains code to compress your font file,.so you don't need any File commands first.<br />
      Make sure webdings.TTF and ariblk.ttf is in the same folder as your installer script.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Huette</span><br />
      <span class="post-time small text-muted">9th August 2005 07:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks! Works fine.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Dark^Listner</span><br />
      <span class="post-time small text-muted">21st May 2008 00:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello, i have a problem looks very similar to threat intro<br />
      <br />
      When i compile my script this is my abortmessage:<br />
      <br />
      File: "gplatten.ace" -&gt; no files found.<br />
      Usage: File [/nonfatal] [/a] ([/r] [/x filespec [...]] filespec [...] |<br />
      /oname=outfile one_file_only)<br />
      Error in script "P:\installscript.nsi" on line 6742 -- aborting creation process<br />
      <br />
      <br />
      I trieed to replace this file with a new version, maybe why i get this message, but hey how can i replace some files which are in my script whithout writing a new one<br />
      <br />
      Maybe anyone of us can help me.<br />
      Thanks<br />
      DL</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pospec</span><br />
      <span class="post-time small text-muted">21st May 2008 08:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try to use your editor's Search&amp;Replace feature.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bazald</span><br />
      <span class="post-time small text-muted">18th July 2008 02:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by mattwilkinson</i> The next headache is that I get an invalid file handle reported by the macro.<br />
        <br />
        StrCpy $FONT_DIR $FONTS<br />
        !insertmacro InstallTTFFont '${SOURCEDIR}\FREE.TTF'<br />
        SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0 /TIMEOUT=5000
      </blockquote>I'm having the same problem as the above poster, with "invalid file handle 32" reported on the Windows XP system on which I'm trying to run the installer. On the other hand, my Vista (x64) system seems to run the installer fine.<br />
      <br />
      It didn't seem like he had any real resolution to this issue. If the solution is known, sorry for the thread resurection. In any case, thanks in advance.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">robertinventor</span><br />
      <span class="post-time small text-muted">12th March 2010 00:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I got an "invalid file handle 3" (3 for some reason instead of 32) but probably same problem.<br />
      <br />
      Here is my code that fixed it:<br />
      <br />
      FIXED VERSION<br /></p>
      <pre>
!include FontReg.nsh
<br />&gt;!include FontName.nsh
<br />&gt;!include WinMessages.nsh.
<br />&gt;Section "Install Bach 4.1 Musicological Font"
<br />&gt;SectionIn 1 2
<br /><br />  StrCpy $FONT_DIR $FONTS
<br /> !insertmacro InstallTTFFont 'BACH41.TTF'
<br /> SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0 /TIMEOUT=5000
<br />SectionEnd 
<br />&gt;

</pre>where I placed BACH41.TTF into the same folder as the script<br />
      <br />
      Before, it was something like this:<br />
      <br />
      VERSION WITH ERROR MESSAGE ON WINDOWS 7<br />
      <pre>
<code>
  !insertmacro InstallTTFFont '${SourceFolder}\\BACH41.TTF' 
</code>
</pre>which lead to the error message - so fixed by putting the ttf file in the same folder as the .nsi script.<br />
      <br />
      Got the file error message on Windows 7.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">robertinventor</span><br />
      <span class="post-time small text-muted">12th March 2010 00:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">btw formatted the script as php just to get the colour coding.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>