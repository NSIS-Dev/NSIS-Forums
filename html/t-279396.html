<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="install vs. upgrade" />

  <title>install vs. upgrade - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">install vs. upgrade</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=279396">install vs. upgrade</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">irun5k</span><br />
      <span class="post-time small text-muted">19th October 2007 11:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>install vs. upgrade</strong><br />
      So, I've been reviewing the faqs, user manual, and forums for a few hours now and am not finding the answer I was hoping for.<br />
      <br />
      My installer needs to do a detect to determine if the software is already installed, in which case we'll treat the install as an upgrade as opposed to a full install.<br />
      <br />
      If during init I determine that an older version is already installed, I'd like to<br />
      -show the license<br />
      -show a page saying we're ready to do an upgrade<br />
      -do the install with specific sections<br />
      <br />
      If no prior version exists, I want to<br />
      -show the license<br />
      -show the component selection page<br />
      -collect install location<br />
      -do the install<br />
      <br />
      So the trick is that in one case (new install) I want to render the component page with one set of available sections, and in the other case (upgrade) I want to skip just about everything and install a hidden section. I do not want to use InstType for this because the user isn't getting a choice in the matter. Skipping the pages, although a little messy, can be done with aborts.<br />
      <br />
      The question is, can I conditionally drive sections- i.e. only sections a, b, and c should be rendered as available choices on the component page, but if I don't show the component page, I should section d?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">20th October 2007 22:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">To hide/show sections use SectionSetText. A section with empty text is not displayed on the components page. You can also dynamically set sections to readonly by adding the SF_RO flag with Sections.nsh's SetSectionFlag.<br />
      <br />
      You can also completely skip the page:<br />
      <br />
      <a href="http://nsis.sourceforge.net/Skipping_Pages" target="_blank">http://nsis.sourceforge.net/Skipping_Pages</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">irun5k</span><br />
      <span class="post-time small text-muted">20th October 2007 23:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the reply-<br />
      <br />
      I've tried setting setting the section flags to deselect a hidden section during init, but it doesn't seem to work. Even if I deselect the hidden section using the flags, it still gets installed.<br />
      <br />
      Am I doing something wrong or is there no way at runtime to decide whether to install or skip a hidden section?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">20th October 2007 23:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You've probably put the .onSelChange function before the definition of the sections. The section index define is only set once the Section line is processed.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">irun5k</span><br />
      <span class="post-time small text-muted">21st October 2007 00:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">To be more clear, here is what I'm doing:<br />
      <br /></p>
      <pre>
<code><br />Section /o -Shortcut shortcut<br />    CreateShortCut "$DESKTOP\B-Gallery 3.lnk" "$INSTDIR\bgallery.exe" <br />SectionEnd<br /><br />Function .onInit<br />    SectionSetFlags ${shortcut} 0<br />FunctionEnd<br /></code>
</pre><br />
      <br />
      It seems to me like by clearing all the flags, the section should be deselected since that bit isn't set. However, this code always results in the shortcut being installed. My sole goal here is to skip this section based on setting something in .onInit. I think maybe I'm misunderstanding something but I'm not sure what :igor:<br />
      <br />
      P.S. using NSIS 2.31
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">21st October 2007 00:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You said earlier that you're using InstType. Hidden sections are marked as they belong to all installation types by default. You'd need to specify a certain installation type with SectionIn, set its flags after the components page, skip it in the section code itself or use SectionSetInstTypes to make belong to no installation type.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
