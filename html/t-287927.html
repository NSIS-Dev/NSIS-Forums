<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Control+Shift via GetAsyncKeyState() on Vista?"><title>Control+Shift via GetAsyncKeyState() on Vista? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Control+Shift via GetAsyncKeyState() on Vista?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=287927">Control+Shift via GetAsyncKeyState() on Vista?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">mtconleyuk</span><br><span class="post-time small text-muted">3rd March 2008 12:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Control+Shift via GetAsyncKeyState() on Vista?</strong><br>I have an installer that needs to detect whether both the Control and Shift keys are being pressed as it launches so as to enable certain advanced features. I use GetAsynchKeyState() under XP to do this, and it works fine.<br><br>However, I've just tried doing this under Vista and discovered that it doesn't work. GetAsynchKeyState() returns the expected result if one or the other key is held down, but if both are down, it returns 0 in both cases.<br><br>I tried substituting both GetKeyState() and GetKeyboardState() instead, but the result is the same.<br><br>Anyone seen this before?<br><br>The code is pretty straightforward:<br><br>System::Call "user32::GetAsyncKeyState(i 0x11) i .r0 ? !e"<br><br>IntOp $0 $0 &amp; 0x8000<br><br>${If} 0 &lt;&gt; $0<br>System::Call "user32::GetAsyncKeyState(i 0x10) i .r0 ? !e"<br><br>IntOp $0 $0 &amp; 0x8000<br><br>${If} 0 &lt;&gt; $0<br>IntOp $0 1 +<br>${EndIf}<br>${EndIf}</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">3rd March 2008 19:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Seems you're not the only one with this problem. A quick Google search didn't find any answers but it did find your post in the third spot.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">mtconleyuk</span><br><span class="post-time small text-muted">12th March 2008 10:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Did a little more testing, and found that if I run a test app that does the same thing on Vista as Administrator, it only saw one key or the other, but if I ran it normally, it worked fine. The obvious difference was the UAC dialog that popped up when I tried to run it as Admin; when I disabled UAC using MSCONFIG, and ran the app as Admin, it worked fine again.<br><br>So the UAC dialog screws up the results of ::GetAsyncKeyState() such that it only ever sees one of the two keys, never both. Now, *why* that happens is another question. Any ideas?</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>