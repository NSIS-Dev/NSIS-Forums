<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="AccessControl::IsUserTheAdministrator"><title>AccessControl::IsUserTheAdministrator - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">AccessControl::IsUserTheAdministrator</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=288106">AccessControl::IsUserTheAdministrator</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Daniel James</span><br><span class="post-time small text-muted">7th March 2008 16:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>AccessControl::IsUserTheAdministrator</strong><br>It seems that AccessControl::IsUserTheAdministrator returns "false" unless the named user is the actual Administrator user. That is: It does not return true for all members of the Administrators group.<br><br>It seems to me that testing for group membership would be more useful ... or perhaps there should be a new function called AccessControl::IsTheUserAnAdministrator to do that?<br><br>Actually, the interesting thing is not whether a user is <b>the</b> administrator, nor even that he is a member of the Administrators group, but that he has write access to the CSIDL_PROGRAM_FILES and the CSIDL_COMMON_STARTMENU directories ... so perhaps a different test altogether would be make mores sense?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">7th March 2008 17:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That is correct, it tests if the user is the Administrator user (has an SID ending with 500).<br><br>Use UserMgr plug-in for what you want.<br><br>Edit: Or yes you could try writing to those folders using FileOpen.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Daniel James</span><br><span class="post-time small text-muted">7th March 2008 18:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Afrow UK</i><br>That is correct, it tests if the user is the Administrator user (has an SID ending with 500).</blockquote>Yep, I see that. It's useful to be able to do that but -- you're right -- it's not what I want.<br><br><blockquote>Use UserMgr plug-in for what you want.</blockquote>ITYM UserInfo? I've been digging further and it looks like UserInfo is for getting info about users while UserMgr is for creating/changing user accounts.<br><br>What I'm trying to do, here, is to use the MutliUser plugin, but also to display a page at the start of the install if the user is NOT an admin to tell him that if he quits and reruns the setup from an admin account he will have more choices.<br><br>UserInfo::GetAccountType is what MultiUser uses, so that'll do fine.<br><br>Thanks for your help.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">7th March 2008 20:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sorry, UserInfo is the one.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">AaronLS</span><br><span class="post-time small text-muted">7th March 2008 21:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Just out of curiosity since I'm about to dig in to the same task. What is the functional difference, if any, between a user in the Administrators group as a opposed to the Administrator user?<br><br>One of the most frustrating reoccuring issues with our old installer(which I'm happily busting my butt to rewrite in NSIS) was permissions issues on folders or problems writing/reading to/from the registry. Since actions on the registry only give an error without giving any indication of what went wrong, I'm fearful of having to continue to deal with these issues.<br><br>Often times the user swore they are in the administrators group despite the problems.<br><br>Also, is there a way to distinguish between a user in the Administrators group of a domain, versus an Administrator on the local machine? This can be confusing because an Administrator on a domain can log into a computer joined to the domain, but not be a part of the local Administrators group of that machine, thus have these issues when installing but misbelieve that they have administrator rights to the machine.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">7th March 2008 22:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">IsUserTheAdministrator was written for a company that I work for that have machines that have accounts with administrator privileges as well as an Administrator account and I needed to determine which account the install was running on.<br><br>To check if a SID is a member of a particular domain, you can use the <a href="http://msdn2.microsoft.com/en-us/library/aa379166(VS.85).aspx" target="_blank">LookupAccountSid function</a>.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Daniel James</span><br><span class="post-time small text-muted">8th March 2008 11:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>About Admins</strong><br></p><blockquote><i>Originally posted by AaronLS</i><br>Just out of curiosity since I'm about to dig in to the same task. What is the functional difference, if any, between a user in the Administrators group as a opposed to the Administrator user?</blockquote>Good question ...<br><br>By default -- and these things can be changed -- write access to the "C:\Program Files" directory (or, more correctly, the directory returned by SHGetFolderPath with the CSIDL_PROGRAM_FILES flag) and to the HKLM registry hive is given to all members of the "Administrators" group <b>and</b> to the default administrator user (by default, because that user is their "CREATOR OWNER"). In XP and Win2k access is also granted to the "Power Users" group, but I think this group is not created (by default, at least) in Vista.<br><br>The access by the default administrator is really incidental -- the thing that should matter is the access given to members of the "Administrators" group ... but some administrators (and some setup programs and other software run by administrators) may incorrectly grant access to the default administrator (or the current administrator user) rather than to the group.<br><br><blockquote>One of the most frustrating reoccuring issues with our old installer(which I'm happily busting my butt to rewrite in NSIS) was permissions issues on folders or problems writing/reading to/from the registry. Since actions on the registry only give an error without giving any indication of what went wrong, I'm fearful of having to continue to deal with these issues.<br><br>Often times the user swore they are in the administrators group despite the problems.</blockquote>That sounds like what I was talking about, above. If some admin has foolishly given access to himself (default or otherwise) rather than to the administrators groups as a whole then other administrators won't have access.<br><br>They can <i>take</i> access by taking ownership of the object and granting access to themselves ... but that is an explicit action (two, actually) and not something that the system will quietly just do because they try to access the object.<br><br>So, the moral of the story is: if you want all administrators to be able to access something then you should give access to that object to the "Administrators" group, not to individual users. If there's someone you <i>don't</i> want to be able to access that object then don't make them an administrator, because administrators can always <i>take</i> access to anything (and sometimes mess up other permissions in doing so).<br><br><blockquote>Also, is there a way to distinguish between a user in the Administrators group of a domain, versus an Administrator on the local machine? This can be confusing because an Administrator on a domain can log into a computer joined to the domain, but not be a part of the local Administrators group of that machine, thus have these issues when installing but misbelieve that they have administrator rights to the machine.</blockquote>This is getting outside my experience ... I admin a small workgroup LAN but when I'm using a domain-controlled LAN I'm not an admin ...<br><br>I think what happens is that there is a "Domain Admins" group as well as an "Administrators" group, and that the "Domain Admins" group is automatically added to the local "Administrators" group when a PC logs into a domain. So, all admins - whether local or network - appear as members of the "Administrators" group but those that are only local admins do not appear as part of the "Domain Admins" group.<br><br>I assume you can do that with UserMgr::IsMemberOfGroup (but I've never tried).<br><br>See "Domain Admins" here:<br>support.microsoft.com/kb/243330<br>--<br>Daniel</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">AaronLS</span><br><span class="post-time small text-muted">9th March 2008 05:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Re: About Admins</strong><br></p><blockquote><i>Originally posted by Daniel James</i><br><br>This is getting outside my experience ... I admin a small workgroup LAN but when I'm using a domain-controlled LAN I'm not an admin ...<br><br>I think what happens is that there is a "Domain Admins" group as well as an "Administrators" group, and that the "Domain Admins" group is automatically added to the local "Administrators" group when a PC logs into a domain. So, all admins - whether local or network - appear as members of the "Administrators" group but those that are only local admins do not appear as part of the "Domain Admins" group.<br><br>I assume you can do that with UserMgr::IsMemberOfGroup (but I've never tried).<br><br>See "Domain Admins" here:<br>support.microsoft.com/kb/243330<br>--<br>Daniel [/B]</blockquote>What happens on my network, is I can join a computer to a domain, and then log on to the domain as one of the domain administrators, but when I look at the users on the machine, it shows the login that was added is in the Users group. So I didn't have administrator access to the machine by default.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Daniel James</span><br><span class="post-time small text-muted">10th March 2008 13:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Re: Re: About Admins</strong><br></p><blockquote><i>Originally posted by AaronLS</i><br>What happens on my network, is I can join a computer to a domain, and then log on to the domain as one of the domain administrators, but when I look at the users on the machine, it shows the login that was added is in the Users group. So I didn't have administrator access to the machine by default.</blockquote>Well ... that link I posted -- <a href="http://support.microsoft.com/kb/243330" target="_blank">http://support.microsoft.com/kb/243330</a> -- says this:<br><blockquote>â€¢ SID: S-1-5-domain-512<br>Name: Domain Admins<br>Description: A global group whose members are authorized to administer the domain. By default, the Domain Admins group is a member of the Administrators group on all computers that have joined a domain, including the domain controllers. Domain Admins is the default owner of any object that is created by any member of the group.</blockquote>I am not quite sure what it means by saying that the Domain Admins <i>Group</i> becomes a member of the local Admins group. Can one group be a member of another? I didn't think so.<br><br>When a user logs in the system constructs what is known as an "Access Token", which is basically a list of the SIDs that apply to that user -- the user's own SID and the SIDs of all/any groups of which that user is a member. What I think the above piece of verbiage is trying to say is that when a user who is a member of "Domain Admins" logs into a computer, and that computer connects to the domain, the system adds the SID for "Administrators" to the user's Access Token. That doesn't mean that the user is actually a member of "Administrators" on that machine (as shown by the "Local Users and Groups" administrative tool), just that he will have all the same rights.<br><br>Whether that's what actually happens is another matter, of course!<br><br>In short: The acid test is whether you can actually perform operations that require you to be a member of "Administrators", not simply whether the system reports that you are a member of that group.<br><br>Cheers,<br>Daniel.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">10th March 2008 13:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">About local groups: "Although they can't be nested inside each other as domain groups can, they can hold principals and domain groups from any domain in the forest." (from <a href="http://www.pluralsight.com/wiki/default.aspx/Keith.GuideBook/WhatIsAGroup.html" target="_blank">http://www.pluralsight.com/wiki/defa...tIsAGroup.html</a> )</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Daniel James</span><br><span class="post-time small text-muted">10th March 2008 13:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Anders</i><br>About local groups: "Although they can't be nested inside each other as domain groups can, they can hold principals and domain groups from any domain in the forest." (from <a href="http://www.pluralsight.com/wiki/default.aspx/Keith.GuideBook/WhatIsAGroup.html" target="_blank">http://www.pluralsight.com/wiki/defa...tIsAGroup.html</a> )</blockquote>That's a useful link -- explains Windows security better than any of the 'official' documentation than I've read. Thanks for that.<br><br>Yes, from that page:<br><blockquote>The rule of thumb is that a group can have as a member any other type of group that has already been expanded. For example, the local group is the most flexible because it's expanded last. Pretty much anything can be a member of a local group because by the time the server's authority expands it, all the other group memberships are known.</blockquote>OK, the reason I said I didn't think a group could be a member of another group is because I only admin weeny little workgroup networks and wasn't aware of the technicalities of domain-based groups.<br><br>OTOH, what I wrote about Access Tokens pretty-much agrees with the description given there.<br><br>Cheers,<br>Daniel.</div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>