<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="error at install time" />

  <title>error at install time - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">error at install time</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=232489">error at install time</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">HiranChaudhuri</span><br />
      <span class="post-time small text-muted">4th December 2005 08:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>error at install time</strong><br />
      Alright, I have a running installer.<br />
      It is supposed to write some settings to a file. After installation the file exists but is empty (zero length).<br />
      <br />
      Now I'd like to know what went wrong. The error flag is set, but why? Is there some way to get an error number or message for further information (not just for the user, it's also me...)?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">4th December 2005 11:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can use NSIS MessageBoxes to check file handle in write command is the same as was returned by file open command. File must have write permission. GetLastError() is available using System plug-in.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">HiranChaudhuri</span><br />
      <span class="post-time small text-muted">4th December 2005 11:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I thought to have opened the file with write access, and the handle should be the same. The hint to GetLastError is what I am after, but somehow I cannot find a header file containing GetLastError. Do I understand I have to define that myself? This is my first such attempt....<br />
      <br />
      My code looks like this:<br />
      <br />
      CreateDirectory "$INSTDIR\etc"<br />
      CopyFiles $LICFILE $INSTDIR\etc<br />
      ClearErrors<br />
      FileOpen ยง0 $INSTDIR\etc\config.properties w<br />
      IfErrors showerror<br />
      FileWrite $0 "home=$INSTDIR"<br />
      FileWrite $0 "license=$LICFILE"<br />
      FileWrite $0 "projects=$INSTDIR\Projects"<br />
      ifErrors showerror<br />
      FileClose $0<br />
      ifErrors showerror<br />
      Goto continue<br />
      showerror:<br />
      MessageBox MB_OK "ERROR: "<br />
      <br />
      continue:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">4th December 2005 11:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">My MSDN says GetLastError is in the kernel32.dll<br /></p>
      <pre>
<code><br />FileOpen ยง0 "$INSTDIR\etc\config.properties" w<br />...<br />FileWrite $0 "home=$INSTDIR$\n"<br />System::Call 'kernel32.dll::GetLastError() i .r0'</code>
</pre><br />
      should return error code to $0. Use it after write command. Use quotas if NSIS var or expression may have blank spaces (or this is implemented in NSIS already? :) ).
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">HiranChaudhuri</span><br />
      <span class="post-time small text-muted">4th December 2005 12:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you for that sample. Reading the System plugin documentation I found out that I was wrongly using registers as temporary variables. Your hint checking the file handle told me I have to declare my own variable. Now that one works.<br />
      <br />
      Will try your suggestion to still show errors when they occur. Thank you very much.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
