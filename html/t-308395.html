<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Vista - Check Box to Run File As Administrator"><title>Vista - Check Box to Run File As Administrator - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Vista - Check Box to Run File As Administrator</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=308395">Vista - Check Box to Run File As Administrator</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">jacare30</span><br><span class="post-time small text-muted">16th July 2009 00:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Vista - Check Box to Run File As Administrator</strong><br>This pertains to NSIS and Vista<br><br>I can use NSIS to make an .exe run with Admin privileges when I install and then launch.<br><br>However, if you right click the .exe (or file), the checkbox for "Run As Administrator" is not checked.<br><br>Thus, when you reboot, you cannot launch the .exe as a user, you need to be an administrator. This breaks my app.<br><br>Does anyone here have any ideas on how to make this work? Much thanks in advance.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">16th July 2009 01:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><a href="http://stackoverflow.com/questions/258728/request-admin-privileges-for-java-app-on-windows-vista" target="_blank">http://stackoverflow.com/questions/2...-windows-vista</a><br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sullivrp</span><br><span class="post-time small text-muted">24th July 2009 16:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Vista - Check Box to Run File As Administrator and Set Compatibility mode</strong><br>Thanks, Stu...this is part of the answer that I was looking for! I tested the suggested fix last night and it worked.<br><br>In case anyone else needs set the Compatibility mode as well, you can set it in the same registry subkey!<br><br>For those that write data to HKLM, I have verified that there does not need to be an entry in HKLM as this does not appear to do anything, it has to be in HKCU! I also do not see any problems with creating the subkey on non-Vista machines as everything appears to be working just fine on my XP machine with the registry subkey.<br><br>; Sets the Compatibility mode to "Windows XP (Service Pack 2)" and the Privilege level to "Run this program as an administrator"<br><br>WriteRegStr? HKCU "Software\Microsoft\Windows NT\CurrentVersion?\AppCompatFlags?\Layers" "$INSTDIR\HelloWorld.exe" "WINXPSP2 RUNASADMIN"<br><br>The following is for your uninstaller so that the registry subkeys are removed:<br><br>; Removes the subkey that sets the Compatibility mode to "Windows XP (Service Pack 2)" and the Privilege level to "Run this program as an administrator"<br><br>DeleteRegValue? HKCU "Software\Microsoft\Windows NT\CurrentVersion?\AppCompatFlags?\Layers" "$INSTDIR\HelloWorld.exe"<br><br>If you need to change the compatibility mode to something other than "Windows XP (Service Pack 2)", follow the steps below to find out what is being written to the registry and use that instead of "WINXPSP2"!<br><br>For the non-believers, before adding this code to your installer, you can test this by running regedit and verifying if the Software\Microsoft\Windows NT\CurrentVersion?\AppCompatFlags?\Layers key already exists in both the HKLM and HKCU. You will probably see the key under HKLM and no key under HKCU or at least that was what I experienced on my work and home laptops.<br><br>On a Vista machine, once you verify that the key \ subkeys are not there right click an executable and manually set the Compatibility mode and the Privilege level. Refresh the Registry Editor window and you will see that a subkey has been added for that application in HKCU! Delete the subkey in the Registry Editor window or manually uncheck the Compatibility mode and the Privilege level to remove the subkey. Add the code to your installer, compile and run the new installer. Once your program has finished installing you should notice that the Compatibility mode and the Privilege level are already set.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>