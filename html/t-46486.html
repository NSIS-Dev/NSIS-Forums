<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="NSIS Bug? justin help! :)" />

  <title>NSIS Bug? justin help! :) - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">NSIS Bug? justin help! :)</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=46486">NSIS Bug? justin help! :)</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rtg</span><br />
      <span class="post-time small text-muted">6th April 2001 15:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm trying to basically create a very simple installer, similar to a self extracting zip. The contents are the contents of a cdrom (subdirectories, installshield installers, cab files, .msi's, etc).<br />
      <br />
      I'm setting SetCompress to off, but during compile NSIS still says compressing for each file (using version 1.2c). When it reaches certain files like .cab or other highly compressed files, it chews up about 200mb of RAM and actually ends up increasing the file sizes. The source files were added doing a File /r.<br />
      <br />
      (Insert feature request here: I can't seem to add a root directory, like File /r F: or F:\.. It wants me to have a subdir like File /r F:\files, not even File /r F:\files\.<br />
      <br />
      Insert second feature request: When the source files aren't found, can you emit an error, rather than just saying compile completed?)<br />
      <br />
      <br />
      Thanks in advance for any help you guys can provide!!<br />
      Richard<br /></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">justin</span><br />
      <span class="post-time small text-muted">7th April 2001 23:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There is a current limitation in the installer compiler, in that it needs enough memory for about 1.5x what you are compiling. For example, if you need to make a 300mb installer, you really need at least 300-400mb of ram.<br />
      <br />
      This limitation could be fixed pretty easily, by making add_data_misc add to a temp file, as opposed to memory buffer (and so on). If there is enough demand for it, I<br />
      will add it.<br />
      <br />
      As far as the files growing, the most that they will grow is by 4 bytes/file.<br />
      <br />
      -Justin</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rtg</span><br />
      <span class="post-time small text-muted">8th April 2001 00:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Bear with me, I'm still a bit confused! It was my impression that it was still trying to compress, despite the fact that I had turned compression off. I thought the compression algorithm, when run against already compressed files, was what was chewing up the memory...<br />
      The only time the memory raises is in "spikes" when it hits those files, rather than just slowly growing over time. It results in the compile time for the 300mb running at about 2hrs so far. The server has 1GB physical ram.<br />
      <br />
      Is it a bug, something I'm doing, or am I in left field? And is it supposed to say compressing then adding, even when SetCompress is off?<br />
      <br />
      Several people at work have already switched from Installshield since I showed them NSIS, btw!<br />
      <br />
      Thanks!<br /></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">justin</span><br />
      <span class="post-time small text-muted">9th April 2001 09:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by rtg</i><br />
        <b>I'm trying to basically create a very simple installer, similar to a self extracting zip. The contents are the contents of a cdrom (subdirectories, installshield installers, cab files, .msi's, etc).<br />
        <br />
        I'm setting SetCompress to off, but during compile NSIS still says compressing for each file (using version 1.2c). When it reaches certain files like .cab or other highly compressed files, it chews up about 200mb of RAM and actually ends up increasing the file sizes. The source files were added doing a File /r.<br />
        <br />
        (Insert feature request here: I can't seem to add a root directory, like File /r F: or F:\.. It wants me to have a subdir like File /r F:\files, not even File /r F:\files\.<br />
        <br />
        Insert second feature request: When the source files aren't found, can you emit an error, rather than just saying compile completed?)<br />
        <br />
        <br />
        Thanks in advance for any help you guys can provide!!<br />
        Richard<br /></b>
      </blockquote>Just got home. A couple things. 1) 1.2d will do some simple things to reduce memory usage significantly (i.e. the memory usage for data at any point will be total_data_memory + this_file_memory -- right now it is total_data_memory + this_file_memory*2). 2) Right now you can do File /r F:\*.* :). I will put a quick fix in soon.<br />
      <br />
      It still says 'compressing' now, but it isn't actually bothering to try (if SetCompress is off).<br />
      <br />
      -Justin
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rtg</span><br />
      <span class="post-time small text-muted">11th April 2001 21:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Okay Justin, I swore I was gonna drop this, but I think there really is a bug..<br />
      <br />
      It still took a loooong time(overnight) to compile. The data size is approx 250mb or so.. here's my .nsi file:<br />
      --------------------------------------------<br />
      ; example1.nsi<br />
      ;<br />
      ; This script is perhaps one of the simplest NSIs you can make. All of the<br />
      ; optional settings are left to their default settings. The instalelr simply<br />
      ; prompts the user asking them where to install, and drops of notepad.exe<br />
      ; there. If your Windows directory is not C:\windows, change it below.<br />
      ;<br />
      <br />
      ; The name of the installer<br />
      Name "Package"<br />
      <br />
      LicenseText ""<br />
      <br />
      ; The file to write<br />
      OutFile "e:\idrive\output.exe"<br />
      <br />
      ; The default installation directory<br />
      InstallDir $EXEDIR<br />
      <br />
      ; The text to prompt the user to enter a directory<br />
      DirText ""<br />
      <br />
      ; The stuff to install<br />
      Section -Default<br />
      ; Set output path to the installation directory.<br />
      SetOutPath $INSTDIR<br />
      ; Put file there<br />
      SetCompress off<br />
      File /r e:\*.*<br />
      ; eof<br />
      -------------------------------------------------------------------------------------<br />
      <br />
      <br />
      <br />
      <br />
      <br />
      Here's the output of the compile:<br />
      -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-<br />
      Install: 1 section (1 required).<br />
      Install: 1020 instructions, 6770 byte string table.<br />
      Datablock optimizer saved a whopping 109952062 bytes.<br />
      <br />
      EXE header size: 32768 / 32768 bytes<br />
      Install code+strings: 35470 / 35470 bytes<br />
      Install data: 197490595 / 307442657 bytes<br />
      CRC (0x56E7A3C6): 4 / 4 bytes<br />
      -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-<br />
      Total size: 36868 / 307510899 bytes<br />
      <br />
      succeeded<br />
      MakeNSIS done - hit enter to close...<br />
      <br />
      <br />
      -----------------------------------------------------------<br />
      <br />
      Note the fact that it created a 37k file! Not a couple hundred megs....Also, the datablock optimizer saved over 100mbytes?! I checked the file, it is definitely 37k.. When run, it reports "installer too small". The only possibility is that i had too little disk space, but I don't believe this is true..In any case it reported complete successfully.<br />
      Your new version did seem to run a bit faster, but still slowed down on many of the same files as before, and ate up the same amount of memory..<br />
      <br />
      Should I give up?<br />
      Thanks in advance,<br />
      Richard<br />
      <br /></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rainwater</span><br />
      <span class="post-time small text-muted">12th April 2001 06:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I noticed you had e:\idrive. You aren't trying to create the installer using a network drive are you? If so, that could be your problem because it shouldnt take that long for 250 megs. I created an install of about 200 megs and it took about 15 minutes. And I have 64 megs of physical RAM.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rtg</span><br />
      <span class="post-time small text-muted">12th April 2001 14:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Idrive is a shortened form of installer drive, it's basically a blank drive that I was using for scratch work :-) But good call on the network, I tried it that way when I first tried NSIS and, sadly, it still takes just as long when doing it on a local drive.. Longer even...<br />
      <br />
      I'm still not sure about that 37k bug.. seems very weird... I'm going to run it yet again today and see what happens... I hate to bug people when they give you software for free!<br />
      <br />
      Richard<br /></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Bor</span><br />
      <span class="post-time small text-muted">12th April 2001 14:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Change the output Dir</strong><br />
      Try this, it may work.<br />
      change the outpath of the file from e:\idrive top say c:\idrive<br />
      as long as it is on another disk or partition.<br />
      I'm not sure if it will work and why I think it can solve the problem, but after your problem is solved then I will know the answer why it previously didn't work. (yes, it is wierd)<br />
      <br />
      Bor<br /></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rtg</span><br />
      <span class="post-time small text-muted">12th April 2001 14:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Okay, I forgot I had a compile running overnight.. Here are the new statistics:<br />
      <br />
      -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-<br />
      Install: 1 section (1 required).<br />
      Install: 1020 instructions, 6770 byte string table.<br />
      Datablock optimizer saved a whopping 109952062 bytes.<br />
      <br />
      EXE header size: 32768 / 32768 bytes<br />
      Install code+strings: 35470 / 35470 bytes<br />
      Install data: 197490595 / 307442657 bytes<br />
      CRC (0x56E7A3C6): 4 / 4 bytes<br />
      -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-<br />
      Total size: 197558837 / 307510899 bytes<br />
      <br />
      succeeded<br />
      MakeNSIS done - hit enter to close...<br />
      <br />
      <br />
      -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=--=-=-=-=-=--=-=--=-<br />
      <br />
      After I freed up some disk space, it seemed to work better ;-) (feature req: report error when out of diskspace, rather than "successful")<br />
      <br />
      It STILL took overnight, and as you can see it still compressed heavily, over 100mbytes, where I know the data on the CD was already fairly compressed as is.<br />
      <br />
      So, I guess I'm back to my original quandary, which is: why does it insist on compressing? And/or, is that datablock optimizer soooo good that it can save that much space? And if so, why does it take me 5 hours and rainwater far less?<br />
      <br />
      Thanks,<br />
      Richard<br /></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rtg</span><br />
      <span class="post-time small text-muted">12th April 2001 14:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Bor, thanks for the suggestion.. Just tried it, same result so far..</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rtg</span><br />
      <span class="post-time small text-muted">13th April 2001 02:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Okay, thanks to an email Bor sent, I tried to package it with compression set to auto.. It went FAAAST! Like 5 minutes! The only thing I noticed was that some files would read like 0/353434 after finished...I hope that means it just didn't try to compress them.<br />
      <br />
      So, tried it again, just changing compression to off, old problem returns! As Bor suggests to me, the memory management when compression is off is screwed up somehow..<br />
      <br />
      Hopefully this thread has been of some use to the Nullsoft guys!<br />
      <br />
      Richard<br /></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Bor</span><br />
      <span class="post-time small text-muted">13th April 2001 22:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, It is true.<br />
      <br />
      I tested it with the FreeDB database (http://www.freedb.org)<br />
      and with the install cd of Windows 2000 and with the install cd of Office 2000.<br />
      All three where majorly slow with compression turned off, and the memory usage went sky high.<br />
      But with compression set to auto it compressed fast, no problems at all.<br />
      <br />
      Bor<br /></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rtg</span><br />
      <span class="post-time small text-muted">14th April 2001 00:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm still curious about those 0/whatever numbers. If Bor didn't see them, I wonder if I'm seeing another bug..<br />
      <br />
      Guilty admission: I added a BGBG to my installer but quickly removed it ;) Thanks 1.2f!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
