<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Vista: having trouble spawning installers"><title>Vista: having trouble spawning installers - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Vista: having trouble spawning installers</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=270525">Vista: having trouble spawning installers</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">FrozenFire</span><br><span class="post-time small text-muted">2nd May 2007 22:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Vista: having trouble spawning installers</strong><br>I'm writing an installer to install symantec on windows xp, 2000, and windows vista, as well as configure them to use a hosted symantec antivirus server for my organization. I've gotten the xp and 2000 part of the code hammered out ok, but whenever i run the installer on vista, msiexec doesn't install the vista symantec msi package. The installer script is pretty long because of all the stuff i need to undo for the xp machines i will be installing on, but here's the relevant vista code:<br><br>Section "Install Symantec Antivirus" preSymantec<br><br>SetOutPath "$INSTDIR"<br>Clearerrors<br>;write avinstaller<br>File "Finish.exe"<br>Strcmp $WINVER "Vista" Vistafiles 0<br>File "savce1002clt\Symantec AntiVirus.msi"<br>File "savce1002clt\Data1.cab"<br>File "savce10.0.2.2020\SAV_10.0.2.2020_AllWin_EN.msp"<br>File "savce10.0.2.2021\SAVCE_10.0.2.2021_AllWin_EN.msp"<br>Goto afterfiles<br>Vistafiles:<br>File "SAVVISTA\Symantec AntiVirus.msi"<br>File "SAVVISTA\Data1.cab"<br><br>Afterfiles:<br>;check to see if reboot required. if so, postpone installation until after reboot<br>IntCmp $RebootReq 1 0 AVnoReboot AVnoReboot<br><br>;set rebootflag<br>SetRebootFlag True<br><br>;create regkey to installer to launch it on reboot<br>WriteRegStr HKEY_LOCAL_MACHINE "Software\Microsoft\Windows\CurrentVersion\Run" "JHU Finish" "$INSTDIR\Finish.exe"<br><br>;Store installation folder<br>WriteRegStr HKLM "Software\JHU" "Installation Directory" $INSTDIR<br><br>;Store windows version<br>WriteRegStr HKLM "Software\JHU" "Windows Version" $WINVER<br><br>;Set installation value to true<br>WriteRegDWORD HKLM "Software\JHU" "Inst AV" "1"<br><br>;skip install<br>Goto AVcontinue<br>;run av installer now<br>intop $0 0 + 0 ;loop variable<br>AVnoReboot:<br>InstAV:<br>ClearErrors<br>Detailprint "Windows Version: $WINVER"<br>;If vista, run the vista installer<br>Strcmp $WINVER "Vista" VistaAV 0<br>Win2k:<br>;putting in these sleep periods to try to stablize some erratic installer behavior thats been happening.<br>Execwait '"Msiexec.exe" /i "$INSTDIR\Symantec AntiVirus.msi" /passive Reboot=ReallySuppress'<br>sleep 5000<br>Execwait '"Msiexec.exe" /p SAV_10.0.2.2020_AllWin_EN.msp /passive REINSTALL=ALL REINSTALLMODE=omus /l*v c:\patchlog.txt'<br>sleep 1000<br>Execwait '"Msiexec.exe" /p SAVCE_10.0.2.2021_AllWin_EN.msp /passive REINSTALL=ALL REINSTALLMODE=omus /l*v c:\patchlog.txt'<br>IfErrors AVErrors AVNoErrors<br>VistaAV:<br>Execwait '"Msiexec.exe /i "$INSTDIR\Symnatec Antivirus.msi" /passive Reboot=ReallySuppress'<br>IfErrors AVErrors AVNoErrors<br>AVErrors:<br>;sometimes the installer doesn't work until the second time, so this loop just waits until the third time to bother the user.<br>intop $0 $0 + 1<br>intcmp $0 3 0 InstAV 0<br>MessageBox MB_YESNO|MB_DEFBUTTON1|MB_ICONQUESTION "Antivirus Installation Unsuccessful. Try Again?" \<br>IDYES InstAV IDNO AVNoErrors<br>AVNoErrors:<br>DeleteRegValue HKLM "Software\JHU" "Inst AV"<br>Delete "$INSTDIR\Finish.exe"<br>Delete "$INSTDIR\Data1.cab"<br>Delete "$INSTDIR\Symantec AntiVirus.msi"<br>Delete "$INSTDIR\SAV_10.0.2.2020_AllWin_EN.msp"<br>Delete "$INSTDIR\SAVCE_10.0.2.2021_AllWin_EN.msp"<br>RMDir "$INSTDIR"<br>AVcontinue:<br><br>SectionEnd<br><br>All the storing and reboot detecting is for xp and 2000, as the previous section uninstalls older versions of symantec if necissary, then reboots(i've dissabled that section in vista, as this will be the first vista distribution). Anyway, when i run it, it acts just like when i try to run msiexec.exe on the package from the command line without enough privilages. I've tried switching to exec or nsExec without any luck, and i've included "RequestExecutionLevel admin" at the beginning of the installer in hopes of getting it to work right, but no luck yet. I would apreciate any help anyone could give, as i've got to roll this out soon and haven't the foggiest as to how to fix it.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">helix400</span><br><span class="post-time small text-muted">2nd May 2007 22:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">When you run your installer on Vista, does it bring up the prompt to ask you to elevate the process as administrator?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">FrozenFire</span><br><span class="post-time small text-muted">3rd May 2007 00:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">When i start the main installer, it brings up a window asking for permission. the behavior doesn't change when i left click and select "Run as an administrator." When it calls msiexec, it doesn't say anything at all. the first time around msiexec returns an error(causing it to loop), the second time through the loop it doesn't, but both times it fails to install/do anything as far as i can tell.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">FrozenFire</span><br><span class="post-time small text-muted">3rd May 2007 19:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Have spent most of the day trying to get it to work and discovered that none of my exec calls are working in vista, despite running the program at admin level. Does anyone know why this isn't working(am i overlooking something obvious somewhere?)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">3rd May 2007 19:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You have a missing quote in the ExecWait line following the VistaAV label. If that's not the problem, create a minimal example that reproduces the problem on Vista and attach it.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">FrozenFire</span><br><span class="post-time small text-muted">4th May 2007 23:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for the pointer! That, several hours and other typos later, turned out to be the key hickup, and I'm happy to say I now have a final build! thanks for the help!</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>