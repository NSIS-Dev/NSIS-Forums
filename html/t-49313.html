<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Better compression" />

  <title>Better compression - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Better compression</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=49313">Better compression</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">nels</span><br />
      <span class="post-time small text-muted">8th May 2001 23:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi everybody,<br />
      <br />
      After many tests, it seemed that BZIP2 was much better than ZLIB (espacially for text files). Is it possible to include BZIP2 compression in NSIS? Are there any problems in doing this? If so, maybe I can help (a bit because I'm not a hardcore coder ;).<br />
      <br />
      Thanks for the great software ;)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br />
      <span class="post-time small text-muted">9th May 2001 19:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm not really an expert on this but you have to keep in mind:<br />
      - how big is the decompression routine? NSIS tries to be only 36 KB. Maybe the bzip2 routine is more complex?<br />
      - Is Bzip2 open-source/unpatented? It may be open-source, but the advantage of ZLib is that it doesn't contain any patented stuff, thus it can't infringe them or cause legal problems.<br />
      <br />
      Then again, only justin himself knows why he choose ZLib (I've been using it for about a year now and I like it - fast and nice compression).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">nels</span><br />
      <span class="post-time small text-muted">9th May 2001 20:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">-The man at <a href="http://sources.redhat.com/bzip2/" target="_blank">http://sources.redhat.com/bzip2/</a> (homepage of bzip2) says it's patent free "as far as [he] knows"...<br />
      -It's open source.<br />
      <br />
      For the routine size, I don't really know but I can make some tests.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br />
      <span class="post-time small text-muted">9th May 2001 21:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I said I was no expert ;)<br />
      Really, only Justin can answer this one. And my reasons were only suggestions of course.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Edgewize</span><br />
      <span class="post-time small text-muted">9th May 2001 21:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">From what I've known about bzip2 before (I haven't tried it recently) it is much slower at compression and decompression than zlib, though it does a better job.<br />
      <br />
      It is open-source but not GPL (exact same license as zlib), and I supposed it could be optimized for size to end up as small as or smaller than the current zlib implementation.<br />
      <br />
      I don't know how high the priority for this sort of thing is, since Justin keeps promising a reboot-flagging-and-prompting system (I'm still waiting :)). But it should be do-able.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">justin</span><br />
      <span class="post-time small text-muted">10th May 2001 01:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I actually made a bz2 using nsis 1.1 a while back. The exe header was marginally larger. bz2 appears to be patent free, and is open source (under a similar license to zlib, I believe), but here are the drawbacks:<br /></p>

      <ul>
        <li>bz2 requires more memory during the decompress phase. A lot more than zlib - it is also variable, so there is potential for half way through the install getting "out of memory"</li>

        <li>bz2 is really only good for large blocks. On small files (i.e. &lt; 1MB) zlib usually wins.

          <ul>
            <li>One option to make bz2 work better, would be to compress the entire datablock at once (instead of per-file etc). This would require considerable reworking of the exe header.</li>
          </ul>
        </li>
      </ul><br />
      <br />
      -Justin
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Uhop</span><br />
      <span class="post-time small text-muted">10th May 2001 17:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>zlib, bzip2?</strong><br />
      I like zlib/gzip and bzip2. But I think there is one option overlooked: MS compress/cabarc + standard Data Decompression library (LZInit/LZread/LZCopy/LZClose). It is preinstalled on all win32 platforms.<br />
      <br />
      Pros:<br />
      1) Virtually 0 (zero) overhead for installer. You don’t need to carry zlib or bzip2 library.<br />
      2) It compresses better than zlib.<br />
      <br />
      Cons:<br />
      1) There is no Data Compression library. You have to run "compress" or "cabarc" utilities from NSIS using command line.<br />
      2) These utilities are free but not part of any OS. Developer should download them from MS. (Is it possible to redistribute them?)<br />
      <br />
      More on Pro#2. In order to automatically distribute my stuff I use NSIS installer packed in .cab. Initially I created compressed installer with compressed header and cab it using no compression (it will not compress anyway). But I found that if I use _uncompressed_ installer and cab it with highest compression (LZX:21) it is 20% smaller. I run several tests on my files and “compress” was significantly better than zlib.<br />
      <br />
      I think this alternative is worth adding to NSIS. It reduces installer size on both fronts.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br />
      <span class="post-time small text-muted">10th May 2001 19:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I can say only 1 thing: It's a Microsoft compression Lib. Now, how come there aren't any compression libs for it? Because it isn't open-source and it contains loads of patents no doubt.<br />
      <br />
      If you really want the best compression, you'd have to use WinRAR to create self-extracting things, or maybe WinACE. But they add 32 KB of overhead themselves (minimum!).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Uhop</span><br />
      <span class="post-time small text-muted">10th May 2001 19:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Are we still talking about Win32 installer? ;)<br />
      <br />
      I don't advocate to use LZ* stuff for all-purpose apps. In my opinion it is smart choice for Win32 installer.<br />
      <br />
      We don't care about load of patents because installer will not carry any proprietary code but calls to standard Win32 API. It uses Win32 API now and nobody got sued. :)<br />
      <br />
      NSIS (compiler) will not have any proprietary code but calls to external utilities. It does it now to compress header. :)<br />
      <br />
      I don't see any problem in this particular case. Possibly WinRAR will compress better but we are concern with overall installer size, don't we? It means that if we are to make judgement on compressors, we have to take into account "compressed data" + "decompression library overhead". The latter is 0 (zero) for LZ* stuff. And it compresses better than currently used zlib. Anyway small decomp lib size will be crucial for small size components.<br /></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mcgarrah</span><br />
      <span class="post-time small text-muted">15th May 2001 03:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I know I've seen code floating around for doing<br />
      Microsoft LZ compression like the original COMPRESS.EXE<br />
      and EXPAND.EXE suite from Windows 3.x.<br />
      <br />
      LZEXPAND.DLL comes with every version of Windows at this<br />
      point so it could be used with almost zero overhead. I<br />
      wonder if the trade off is worth it.<br />
      How big is the zlib code? Would this really buy back<br />
      enough space to make it worthwhile?<br />
      <br />
      The new COMPRESS.EXE include a "mszip" compression that<br />
      is not backwards compatible with all versions of Windows.<br />
      I've not seen code for generating those yet and since<br />
      it don't exist everywhere is probably not useful.<br />
      <br />
      I'm not fond of CAB file format and the new MSI crap<br />
      but I'll probably have to learn it too.<br />
      <br />
      NSIS is going to continue getting a workout for my<br />
      installs at least for the near future.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
