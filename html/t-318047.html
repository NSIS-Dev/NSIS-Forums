<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="${__SECTION__} is not defined if section is hidden &quot;-&quot;" />

  <title>${__SECTION__} is not defined if section is hidden "-" - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">${__SECTION__} is not defined if section is hidden "-"</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=318047">${__SECTION__} is not defined if section is hidden "-"</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dbach</span><br />
      <span class="post-time small text-muted">29th March 2010 10:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>${__SECTION__} is not defined if section is hidden "-"</strong><br />
      Hi forum users,<br />
      <br />
      this seems like a bug to me. When I hide a section like this ...<br />
      <br />
      Section "-I am not shown" HIDDENSEC<br />
      SectionEnd<br />
      <br />
      the define/var ${__SECTION__} will not be set. This is a bug, right? If not how to get the sectionname?<br />
      <br />
      Kind regards,<br />
      dbach</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">29th March 2010 17:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hidden sections are nameless, even if you give them a name. I filed a report about this issue ages ago, but it hasn't been fixed yet...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">30th March 2010 04:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I don't think they're nameless - they're just textless. This can almost be explained by ways of the SectionSetText function, which details that setting a section's text to "" (an empty string) will hide it.<br />
      <br />
      So when you specify...<br />
      <br /></p>
      <pre>
<code><br />Section "-I am not shown" HIDDENSEC<br />SectionEnd<br /></code>
</pre><br />
      You're doing little more than making it easier for yourself, while browsing your source file, to identify sections. The section ID will still be stored in ${HIDDENSEC}, though. So you can do something like this...<br />
      <br />
      <pre>
<code><br />!include "MUI2.nsh"<br /><br />OutFile "test.exe"<br /><br />setCompress off<br /><br />!define MUI_PAGE_CUSTOMFUNCTION_PRE Pre<br />!insertmacro MUI_PAGE_COMPONENTS<br /><br />Section "I am not shown" HIDDENSEC<br />SectionEnd<br /><br />Function Pre<br />        SectionGetText ${HIDDENSEC} $0<br />        MessageBox MB_OK "[$0]"<br />        SectionSetText ${HIDDENSEC} ""<br />FunctionEnd<br /><br />!insertmacro MUI_LANGUAGE "English"<br /></code>
</pre><br />
      <br />
      Which will pop up the section's text, and then hide it on run-time. Not sure what the point of that (getting the section text of a section that's going to be hidden) would be, though - but if you have a use for it.. go for it.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dbach</span><br />
      <span class="post-time small text-muted">30th March 2010 09:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I want to use something like this:<br />
      <br /></p>
      <pre>
<span style="color: #007700">Var</span><span style="color: #0000BB">_day
<br /></span><span style="color: #007700">Var</span><span style="color: #0000BB">_month
<br /></span><span style="color: #007700">Var</span><span style="color: #0000BB">_year
<br /></span><span style="color: #007700">Var</span><span style="color: #0000BB">_dayname
<br /></span><span style="color: #007700">Var</span><span style="color: #0000BB">_hour
<br /></span><span style="color: #007700">Var</span><span style="color: #0000BB">_minute
<br /></span><span style="color: #007700">Var</span><span style="color: #0000BB">_second
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineSECTIONINFO</span><span style="color: #DD0000">'!insertmacroSECTIONINFO'
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroSECTIONINFO
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">GetTime</span><span style="color: #007700">}</span><span style="color: #DD0000">"""L"</span><span style="color: #0000BB">$_day$_month$_year$_dayname$_hour$_minute$_second</span><span style="color: #007700">;$</span><span style="color: #0000BB">0</span><span style="color: #007700">=</span><span style="color: #0000BB">DD</span><span style="color: #007700">,$</span><span style="color: #0000BB">1</span><span style="color: #007700">=</span><span style="color: #0000BB">MM</span><span style="color: #007700">,$</span><span style="color: #0000BB">2</span><span style="color: #007700">=</span><span style="color: #0000BB">YYYY</span><span style="color: #007700">,$</span><span style="color: #0000BB">3</span><span style="color: #007700">=</span><span style="color: #0000BB">dayname</span><span style="color: #007700">,$</span><span style="color: #0000BB">4</span><span style="color: #007700">=</span><span style="color: #0000BB">hh</span><span style="color: #007700">,$</span><span style="color: #0000BB">5</span><span style="color: #007700">=</span><span style="color: #0000BB">mm</span><span style="color: #007700">,$</span><span style="color: #0000BB">6</span><span style="color: #007700">=</span><span style="color: #0000BB">ss
<br />ClearErrors
<br />LogText</span><span style="color: #DD0000">""
<br /></span><span style="color: #0000BB">LogText</span><span style="color: #DD0000">"------------------------------------------------------------------------------"
<br /></span><span style="color: #0000BB">LogText</span><span style="color: #DD0000">"${__SECTION__}"
<br /></span><span style="color: #0000BB">LogText</span><span style="color: #DD0000">"($_day.$_month.$_year$_hour:$_minute:$_second)"
<br /></span><span style="color: #0000BB">Logtext</span><span style="color: #DD0000">"------------------------------------------------------------------------------"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroend
<br /><br /><br />Section</span><span style="color: #DD0000">"Iamvisible"</span><span style="color: #0000BB">VISIBLESEC
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">SECTIONINFO</span><span style="color: #007700">}
<br /></span><span style="color: #0000BB">SectionEnd
<br /><br />Section</span><span style="color: #DD0000">"-Iamhidden"</span><span style="color: #0000BB">HIDDENSEC
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">SECTIONINFO</span><span style="color: #007700">}
<br /></span><span style="color: #0000BB">SectionEnd
<br /></span>

<!-- php buffer end -->
                
                
                
</pre>
      <hr />
      <pre>
        
The first works, the second not. Is there a simple workaround so that I can contine use my macro without defining a pre?
                
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">30th March 2010 13:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">no super-simple transparent work-around that I can think of.<br />
      <br />
      With the Pre function you have to remember to make the appropriate sections invisible - that's some manual editing and tracking.<br />
      <br />
      One alternative would be to add a parameter to your SECTIONINFO macro and supply the information yourself, a la:<br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">!</span><span style="color: #0000BB">macroSECTIONINFOSectionText<br /></span><span style="color: #007700">...<br /></span><span style="color: #0000BB">LogText</span><span style="color: #DD0000">"${SectionText}"<br /></span><span style="color: #007700">...<br />
      !</span><span style="color: #0000BB">macroend<br /></span><span style="color: #007700">...<br /></span><span style="color: #0000BB">Section</span><span style="color: #DD0000">"Iamvisible"</span><span style="color: #0000BB">VISIBLESEC<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">SECTIONINFO</span><span style="color: #007700">}</span><span style="color: #DD0000">"Iamvisible"<br /></span><span style="color: #0000BB">SectionEnd<br />
      <br />
      Section</span><span style="color: #DD0000">""</span><span style="color: #0000BB">HIDDENSEC</span><span style="color: #007700">;</span><span style="color: #0000BB">Sectiontextnotstrictlyneededhere<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">SECTIONINFO</span><span style="color: #007700">}</span><span style="color: #DD0000">"Iamhidden"<br /></span><span style="color: #0000BB">SectionEnd<br /></span></span> <!-- php buffer end -->
      <hr />
      But then you have to adjust all of your SECTIONINFO invokes.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dbach</span><br />
      <span class="post-time small text-muted">30th March 2010 13:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Animaether,<br />
      <br />
      I guess I will change my SectionInfo Macro. :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">30th March 2010 14:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You could in addition only use __SECTION__ if it is defined:<br /></p>
      <pre>
<code>!ifdef __SECTION__<br />LogText "${__SECTION__}"<br />!else<br />LogText "${MacroParam}"<br />!endif</code>
</pre><br />
      Save you repeating section names twice.<br />
      <br />
      Stu
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dbach</span><br />
      <span class="post-time small text-muted">30th March 2010 14:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        You could in addition only use __SECTION__ if it is defined:<br />
        <pre>
<code>!ifdef __SECTION__<br />LogText "${__SECTION__}"<br />!else<br />LogText "${MacroParam}"<br />!endif</code>
</pre><br />
        Save you repeating section names twice.<br />
        <br />
        Stu
      </blockquote>Its doesn't work that way bcs. __SECTION__ is defined but empty. This works:<br />
      ${If} "${__SECTION__}" != ""<br />
      LogText "${__SECTION__}"<br />
      ${Else}<br />
      LogText "${MacroParam}"<br />
      ${EndIf}
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">30th March 2010 15:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">wouldn't you still have to specify -something-, even if an empty string, for the macro, though?<br />
      <br />
      e.g.<br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">!include</span><span style="color: #DD0000">"MUI2.nsh"<br />
      <br /></span> <span style="color: #0000BB">OutFile</span><span style="color: #DD0000">"test.exe"<br />
      <br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">macroSECTIONINFOSectionText<br />
      MessageBoxMB_OK</span><span style="color: #DD0000">"${SectionText}"<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroend<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineSECTIONINFO</span><span style="color: #007700">`</span><span style="color: #0000BB">!insertmacroSECTIONINFO</span><span style="color: #007700">`<br />
      <br /></span> <span style="color: #0000BB">Section</span><span style="color: #DD0000">"Iamnotshown"</span><span style="color: #0000BB">HIDDENSEC<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">SECTIONINFO</span><span style="color: #007700">}<br /></span><span style="color: #0000BB">SectionEnd<br />
      <br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_LANGUAGE</span><span style="color: #DD0000">"English"</span> fails with: !insertmacro: macro "SECTIONINFO" requires 1 parameter(s), passed 0!<br />
      <br /></span>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">30th March 2010 16:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes of course.<br />
      <br />
      Edit: dbach you could instead do:<br /></p>
      <pre>
<code>!if `${__SECTION__}` != ``<br />  LogText "${__SECTION__}"<br />!else<br />  LogText "${MacroParam}"<br />!endif</code>
</pre><br />
      <br />
      Stu
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
