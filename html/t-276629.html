<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="After call to function section code isn't executed" />

  <title>After call to function section code isn't executed - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">After call to function section code isn't executed</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=276629">After call to function section code isn't executed</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mergisius</span><br />
      <span class="post-time small text-muted">29th August 2007 11:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>After call to function section code isn't executed</strong><br />
      After I call the function which displays custom page, code after the fucniton call isn't executed and buttons are disabled.<br />
      <br />
      It means, that messagebox never appears. But the buttons aren't active, so it's imposible to press them. So how to leave the function code?<br />
      <br />
      Well, I got this:<br />
      [quote]<br />
      Section "DB paruoÅ¡imas" Server_Recreate<br />
      ; Call here!<br />
      Call SettingsPageDB<br />
      ; this MessageBox never appears<br />
      MessageBox MB_OK "SettingsPageDB done"<br />
      SetOutPath $INSTDIR<br />
      <br />
      !insertmacro MUI_INSTALLOPTIONS_READ $DBSERVER_NAME "ServerSettingsPageDB.ini" "Field 3" "State"<br />
      !insertmacro MUI_INSTALLOPTIONS_READ $DATABASE_NAME "ServerSettingsPageDB.ini" "Field 5" "State"<br />
      <br />
      SetOutPath "$TEMP\EMC"<br />
      <br />
      File ..\EMC.Setup\bin\C5.dll<br />
      File ..\EMC.Setup\bin\Castle.ActiveRecord.dll<br />
      File ..\EMC.Setup\bin\Castle.Components.Validator.dll<br />
      ....................<br />
      [quote]<br />
      <br />
      And the function:<br /></p>

      <blockquote>
        Function SettingsPageDB<br />
        !insertmacro MUI_INSTALLOPTIONS_DISPLAY "ServerSettingsPageDB.ini"<br />
        FunctionEnd
      </blockquote>And the ServerSettingsPageDB.ini:<br />

      <blockquote>
        [Settings]<br />
        NumFields=5<br />
        <br />
        [Field 1]<br />
        Type=groupBox<br />
        Text=Nurodykite Ä¯diegimo parametrus<br />
        Left=0<br />
        Right=-1<br />
        Top=5<br />
        Bottom=182<br />
        <br />
        [Field 2]<br />
        Type=label<br />
        Text=DuomenÅ³ bazÄ—s serverio vardas<br />
        Left=10<br />
        Right=-10<br />
        Top=20<br />
        Bottom=30<br />
        <br />
        [Field 3]<br />
        Type=text<br />
        Left=10<br />
        Right=-10<br />
        Top=30<br />
        Bottom=42<br />
        MinLen=1<br />
        ValidateText=Nurodykite duomenÅ³ bazÄ—s serverio vardÄ…<br />
        <br />
        [Field 4]<br />
        Type=label<br />
        Text=DuomenÅ³ bazÄ—<br />
        Left=10<br />
        Right=-10<br />
        Top=50<br />
        Bottom=60<br />
        <br />
        [Field 5]<br />
        Type=text<br />
        Left=10<br />
        Right=-10<br />
        Top=60<br />
        Bottom=72<br />
        MinLen=1<br />
        ValidateText=Nurodykite duomenÅ³ bazÄ—s pavadinimÄ…
      </blockquote>Also tried this:<br />

      <blockquote>
        Function FuncSettingsPageDB<br />
        ${If} ${SectionIsSelected} ${Server_Recreate}<br />
        MessageBox MB_OK "Server_Recreate is selected"<br />
        InstallOptions::dialog "ServerSettingsPageDB.ini"<br />
        ${EndUnless}<br />
        MessageBox MB_OK "Serve_Recreate isn't selected"<br />
        FunctionEnd
      </blockquote>In both ways the result is the same. I can't click any buttons on the window, but content of the window is what i want it to be.<br />
      <br />
      Here is the picture:<br />
      <a href="http://www.talpykla.com/files/1305/ServerDB.jpg" target="_blank">http://www.talpykla.com/files/1305/ServerDB.jpg</a><br />
      <br />
      So, how to make button "next" clickable? :)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Laslie</span><br />
      <span class="post-time small text-muted">29th August 2007 11:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Don't call the SettingsPageDB function in section. Use the Page command outside the sections.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mergisius</span><br />
      <span class="post-time small text-muted">29th August 2007 11:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Laslie</i><br />
        <b>Don't call the SettingsPageDB function in section. Use the Page command outside the sections.</b>
      </blockquote>I need to show this page ONLY if section is selected.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Laslie</span><br />
      <span class="post-time small text-muted">29th August 2007 12:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Use pre function for Page command and check in the section is selected or not. If section is not selected use abort command.<br />
      for example:<br />
      ...<br />
      !insertmacro MUI_PAGE_COMPONENTS<br />
      Page custom ServerSettingsPageDBShow ServerSettingsPageDBLeave ""<br />
      ;other pages<br />
      ...<br />
      <br />
      Function ServerSettingsPageDBShow<br />
      !insertmacro SectionFlagIsSet ${Server_Recreate} ${SF_SELECTED} +2<br />
      Abort<br />
      <br />
      !insertmacro MUI_INSTALLOPTIONS_DISPLAY "ServerSettingsPageDB.ini"<br />
      <br />
      FunctionEnd<br />
      <br />
      Function ServerSettingsPageDBLeave<br />
      ..<br />
      !insertmacro MUI_INSTALLOPTIONS_READ $DBSERVER_NAME "ServerSettingsPageDB.ini" "Field 3" "State"<br />
      !insertmacro MUI_INSTALLOPTIONS_READ $DATABASE_NAME "ServerSettingsPageDB.ini" "Field 5" "State"<br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mergisius</span><br />
      <span class="post-time small text-muted">29th August 2007 12:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Error: could not resolve label "Abort" in function "ServerSettingsPageDBShow"<br />
      Error - aborting creation process<br />
      <br />
      Well, i tried like this<br /></p>

      <blockquote>
        Function ServerSettingsPageDBShow<br />
        !insertmacro SectionFlagIsSet ${Server_Recreate} ${SF_SELECTED} +2 abort<br />
        !insertmacro MUI_INSTALLOPTIONS_DISPLAY "ServerSettingsPageDB.ini"<br />
        Goto end<br />
        abort:<br />
        Abort<br />
        end:<br />
        FunctionEnd
      </blockquote>And now the error is:<br />
      [quote]<br />
      Processed 1 file, writing output:<br />
      Adding plug-ins initializing function... Done!<br />
      Error: resolving create-page function "SettingsPageDBShow" in install pages<br />
      Note: uninstall functions must begin with "un.", and install functions must not<br />
      Error - aborting creation process<br />
      [/qoute]<br />
      <br />
      What it's trying to say?<br />
      <br />
      And "Abort" function will exit only the function or whole installation?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Laslie</span><br />
      <span class="post-time small text-muted">29th August 2007 12:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Oops, sorry! Miss 0.<br />
      <br />
      Correct script:<br />
      ...<br />
      Function ServerSettingsPageDBShow<br />
      !insertmacro SectionFlagIsSet ${Server_Recreate} ${SF_SELECTED} +2 0<br />
      Abort<br />
      ...<br />
      <br />
      Abort calling from Page Pre CallBack function mean: don't show the page, post Page CallBack function: don't leave the page. Other place exit installation.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mergisius</span><br />
      <span class="post-time small text-muted">29th August 2007 13:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, it works fine ;) thank you for your time ;)<br />
      <br />
      And i got one more question. What about this:<br /></p>

      <blockquote>
        Function PickDirectory<br />
        !insertmacro SectionFlagIsSet ${Server_Docs} ${SF_SELECTED} +2 0<br />
        Abort<br />
        !insertmacro MUI_PAGE_DIRECTORY<br />
        FunctionEnd
      </blockquote>Error:<br />

      <blockquote>
        !insertmacro: MUI_PAGE_DIRECTORY<br />
        Error: command PageEx not valid in Function<br />
        Error in macro MUI_PAGE_DIRECTORY on macroline 12<br />
        Error in script "Dlc_Install_server.nsi" on line 252 -- aborting creation proces<br />
        s
      </blockquote>So, I will need to make new macro "MUI_PAGE_DIRECTORY"? Or is there any way to pass this limitation, that I cannot use it in a function?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Laslie</span><br />
      <span class="post-time small text-muted">29th August 2007 13:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Don't mention it. :)<br />
      <br />
      Yes, you cannot use it in a function.<br />
      Rightly:<br />
      ...<br />
      !insertmacro MUI_PAGE_COMPONENTS<br />
      Page custom ServerSettingsPageDBShow ServerSettingsPageDBLeave ""<br />
      !define MUI_PAGE_CUSTOMFUNCTION_PRE PickDirectory<br />
      !insertmacro MUI_PAGE_DIRECTORY<br />
      ...<br />
      <br />
      You create PickDirectory function, and you put the check in this function.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Laslie</span><br />
      <span class="post-time small text-muted">29th August 2007 13:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The 3 functions together need using!<br />
      ...<br />
      !define MUI_PAGE_CUSTOMFUNCTION_PRE PickDirectoryPre<br />
      !define MUI_PAGE_CUSTOMFUNCTION_SHOW PickDirectoryShow<br />
      !define MUI_PAGE_CUSTOMFUNCTION_LEAVE PickDirectoryLeave<br />
      !insertmacro MUI_PAGE_DIRECTORY<br />
      ...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mergisius</span><br />
      <span class="post-time small text-muted">29th August 2007 13:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">As far as I know !define just makes some global variables like (it's from nsis help):<br /></p>

      <blockquote>
        !define USE_SOMETHING<br />
        !define VERSION 1.2<br />
        !define /date NOW "%H:%M:%S %d %b, %Y"<br />
        !define /math RESULT 3 + 10<br />
        !define /math REST 15 % ${RESULT}
      </blockquote>So, 3 defined variables does what? "!define" gives to variables PickDirectoryPre, PickDirectoryShow, PickDirectoryLeave value according if function "PickDirectory" was executed?<br />
      <br />
      So, this function should be called in the section which requires to pick directory.<br />
      <br />
      If yes, then what to write in the "PickDirectory" function to skip or run "!insertmacro MUI_PAGE_DIRECTORY" according to selected section?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Laslie</span><br />
      <span class="post-time small text-muted">29th August 2007 14:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">To create the global variable use Var command, not !define.<br />
      If you need show or not pick directory page check it in PickDirectoryPre function. Pages code running before section code running. Section code running after last page.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mergisius</span><br />
      <span class="post-time small text-muted">29th August 2007 14:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">But how to do it?<br /></p>

      <blockquote>
        Function PickDirectoryPre<br />
        !insertmacro SectionFlagIsSet ${Server_Recreate} ${SF_SELECTED} 0 end<br />
        ;what to write here?<br />
        end:<br />
        FunctionEnd
      </blockquote>I check it, and what to do if i don't need to show directory page? The part I don't get is, that i don't know how to make it not to appear in the screen.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Laslie</span><br />
      <span class="post-time small text-muted">29th August 2007 14:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The other way round.<br />
      Function PickDirectoryPre<br />
      !insertmacro SectionFlagIsSet ${Server_Recreate} ${SF_SELECTED} +2 0<br />
      Abort ; hide screen<br />
      <br />
      ; show screen<br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Laslie</span><br />
      <span class="post-time small text-muted">29th August 2007 14:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        So, 3 defined variables does what? "!define" gives to variables PickDirectoryPre, PickDirectoryShow, PickDirectoryLeave value according if function "PickDirectory" was executed?
      </blockquote>The MUI know this.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mergisius</span><br />
      <span class="post-time small text-muted">29th August 2007 14:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes it works, but this way only:<br /></p>

      <blockquote>
        Function PickDirectoryPre<br />
        !insertmacro SectionFlagIsSet ${Server_Docs} ${SF_SELECTED} end here<br />
        here:<br />
        Abort<br />
        end:<br />
        FunctionEnd
      </blockquote>It's something strange with that numbers.. I make it work corectly only with labels. I, also made other custom pages with labels, because numbers didn't work for me.<br />
      <br />
      Well, i thought, that "Abort" will only exits the function.<br />
      <br />
      Thank you very much :)*
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Laslie</span><br />
      <span class="post-time small text-muted">29th August 2007 14:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try this:<br />
      Function PickDirectoryPre<br />
      !insertmacro SectionFlagIsSet ${Server_Docs} ${SF_SELECTED} end ""<br />
      Abort<br />
      end:<br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">wraithdu</span><br />
      <span class="post-time small text-muted">29th August 2007 15:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I ran into that problem with relative jumps and macros too. It's because when the script is compiled the macro is expanded into all its lines of code. So a relative jump will jump somewhere into those lines.<br />
      <br />
      So you are correct to use labels.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
