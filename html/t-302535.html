<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Detecting XP vs Vista" />

  <title>Detecting XP vs Vista - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Detecting XP vs Vista</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=302535">Detecting XP vs Vista</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">abcdgoldfish</span><br />
      <span class="post-time small text-muted">28th January 2009 22:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Detecting XP vs Vista</strong><br />
      My installer needs to be able to detect if it is being executed on XP or on Vista so it can provide the appropriate default installation path which the user should be able to modify it.<br />
      <br />
      I can call getOS from within a Section but, by the time the Section code is executed, the MUI_PAGE_DIRECTORY page has already come and gone with the preassigned path. So, the path indicated on the directory page may be wrong (e.g., if it's "C:\Program Files\..." and being installed on a Vista machine) and, worse, any path the user enters is ignored by the Section code that follows.<br />
      <br />
      Is there a way that I can populate $INSTDIR with a value after the OS has been detected but before MUI_PAGE_DIRECTORY is displayed?<br />
      <br />
      I've tried reordering the OS detection section and the various !define MUI_PAGE_... statements and the InstallDir statement but have not been able to come up with a working solution. I have not been able to dig up anything on this topic in the forum or on the web.<br />
      <br />
      I'm using the following code to deal with the OS:<br />
      <br />
      Section "OsDetection"<br />
      call getOS<br />
      ${if} $R0 == "XP"<br />
      strcpy $INSTDIR "C:\Program Files\&lt;work&gt;\${PRODUCT_NAME}"<br />
      ${else}<br />
      strcpy $INSTDIR "C:\Users\Public\Public Documents\&lt;work&gt;\${PRODUCT_NAME}"<br />
      ${EndIf}<br />
      SectionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">28th January 2009 23:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can run that code in Function .onInit which is executed before anything else. You should also move to WinVer.nsh instead of GetOS.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
