<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="LangString question about ${Default} usage" />

  <title>LangString question about ${Default} usage - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">LangString question about ${Default} usage</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=270997">LangString question about ${Default} usage</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">billsh</span><br />
      <span class="post-time small text-muted">11th May 2007 16:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>LangString question about ${Default} usage</strong><br />
      I've inherited a few NSI scripts and have a question about a LangString feature. In these scripts they use something like:<br />
      <br />
      LangString FOO ${Default} "hello world"<br />
      <br />
      They have this in blocks where we may have translations for 4-5 langs. The theory being that if you're on an OS other than the 4-5 specifically called out, this string will display. However in practice this doesn't appear to work. A partner ran a setup on a Russian OS and one of the message boxes comes up with no text, despite having this default string. I'm getting some non-English systems setup to test this.<br />
      <br />
      I can't find any reference to it in the languages.nsi or on the forums. Was someone smokin' crack when they wrote this? :-) or is it supported in some version of NSIS? We're on v. 2.15.<br />
      <br />
      What is the best practice for the situation where you may end up on a uncommon OS, but don't want to localize everying into all possible langs?<br />
      <br />
      Cheers!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">11th May 2007 19:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Common practice is to set up english as default language.<br />
      Obviously the ${Default} you're referring is a definition which needs a value, you may want to take a look at NSIS manual about !define.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">billsh</span><br />
      <span class="post-time small text-muted">11th May 2007 19:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Right, the intention is to use English as the default and I know how to use !define - I may not know how the lang tables work however!<br />
      <br />
      I guess my question is on the functionality of LangString. Is 'Default' a magic term? If I define Default = LANG_ENGLISH, is there logic at run-time that chooses that LangString definition if I'm on a French OS (example below)?<br />
      <br />
      LangString FOO ${LANG_ENGLISH} "test"<br />
      LangString FOO ${LANG_GERMAN} "German test"<br />
      LangString FOO ${Default} "test"<br />
      <br />
      LangString BAR ${LANG_ENGLISH} "test2"<br />
      LangString BAR ${LANG_GERMAN} "German test2"<br />
      LangString BAR ${Default} "test2"<br />
      <br />
      The LangString docs say to set a string for every lang in your script, which implies (to me anyway) that there is no overriding 'default' string feature where if NSI can't find the defined OS string it will look for a default one to fall back on.<br />
      <br />
      Am I making any sense? :-)<br />
      <br />
      Thanks much....</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">12th May 2007 09:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Unable to have an opinion why somebody has used that ${Default} definition and what he was trying to manage unless there is the ability to review the script.<br />
      However requesting a multi lang installer all it needs is to follow the included examples I guess.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">billsh</span><br />
      <span class="post-time small text-muted">14th May 2007 23:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Red Wine. I've attached a very simplified script which hopefully illustrates the basics of what this script was intended to do.<br />
      <br />
      It appears the intent was that if it were run on a lang where a string wasn't specifically defined that the 'default' would take over for any string block. In the original scripts there are mutiple string blocks which all have a 'default' value (like my posted example). The attached script just has one block to illustrate the point.<br />
      <br />
      The behavior of the script is that say on a Russian OS, the message box contents are blank vs having an English default. This is based on screen shots from our parter who is running these tests.<br />
      <br />
      Am I correct in the assumption that this implied 'default' processing is not a feature in NSI?<br />
      <br />
      Thanks!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">15th May 2007 16:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">As already mentioned, you don't really need something like this.<br />
      Using the select language dialog as presented in the included examples is the right way to go, users are able to select installation's language from dropdown menu.<br />
      Even if for some reason you don't wish to add that dialog, by adding English language 1st in the sequence of the included languages preserves that on a target where the local settings do not much any of the included languages, NSIS chooses English automatically.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">datallah</span><br />
      <span class="post-time small text-muted">18th May 2007 15:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Red Wine</i><br />
        <b>As already mentioned, you don't really need something like this.<br />
        Using the select language dialog as presented in the included examples is the right way to go, users are able to select installation's language from dropdown menu.<br />
        Even if for some reason you don't wish to add that dialog, by adding English language 1st in the sequence of the included languages preserves that on a target where the local settings do not much any of the included languages, NSIS chooses English automatically.</b>
      </blockquote>I'm having similar problems as the OP is, but I'm not doing anything weird with a "Default" language or anything.<br />
      <br />
      I've modified the example script to simplify it and remove the default stuff. The basic problem is that $(TEST_STRING) is empty for the Spanish translation (where there is no explicit translation), when I'd like it to use the English default.<br />
      <br />
      Any ideas?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ecology2007</span><br />
      <span class="post-time small text-muted">22nd May 2007 19:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by datallah</i><br />
        <b>I'm having similar problems as the OP is, but I'm not doing anything weird with a "Default" language or anything.<br />
        <br />
        I've modified the example script to simplify it and remove the default stuff. The basic problem is that $(TEST_STRING) is empty for the Spanish translation (where there is no explicit translation), when I'd like it to use the English default.<br />
        <br />
        Any ideas?</b>
      </blockquote>I am having the exact same issue.<br />
      When the translation is incomplete the missing strings are replaced by empty strings.<br />
      <br />
      Instead of that i would like to use their english version.<br />
      <br />
      I store the langvars strings in seperate .nsh files. The compiler gives me a warning for every missing string.<br />
      <br />
      Is there a way to force the use of the default language strings when the translated version is missing ?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">22nd May 2007 19:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You'll just have to add the individual language strings but to avoid having repetitions of the string itself, use a define.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ecology2007</span><br />
      <span class="post-time small text-muted">22nd May 2007 22:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Can you elaborate a bit ?<br />
      I would like to use the english version of $(message) when it is missing in one language.<br />
      <br />
      What is the syntax to use define with a langvar ?<br />
      <br />
      Here is my problem :<br />
      1- I can not use LangVar inside of sections and functions.<br />
      2- I can not read the content of $(message) outside sections and functions.<br />
      3- $language is not set before the end of .oninit.<br />
      <br />
      So, once $language is set, i can test if $(message) is empty, but then it's too late to use LangVar and set the content of $(message).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ecology2007</span><br />
      <span class="post-time small text-muted">22nd May 2007 22:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here is a sample based on the sample.nsi three posts up :<br /></p>
      <pre>
<code><br />  LangString TEST_STRING ${LANG_ENGLISH} "English String"<br />  LangString TEST_STRING ${LANG_GERMAN} "German String"<br />  LangString TEST_STRING ${LANG_FRENCH} "French String"<br />  ###    Missing Spanish String here           #########<br /></code>
</pre><br />
      <br />
      The following does not work :<br />
      -outside sections and functions, $(TEST_STRING) is not yet initialised. That is quite normal since $language is not set.<br />
      -inside sections and functions, you can't use langstring.<br />
      <br />
      <pre>
<code><br />  !ifndef $(TEST_STRING)<br />  LangString TEST_STRING $language "English String"<br />  !endif<br /></code>
</pre><br />
      <br />
      Is there a macro to define $(TEST_STRING) without using LangString ?<br />
      Is there a macro to access the contents of the language table without using the $(...) syntax ?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">23rd May 2007 05:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">@ datallah + @ ecology2007,<br />
      <br />
      Sorry I can't get your point guys, setting every language string explicitly for every included language is a requirement in order for a proper functionality.<br />
      If for some reason one wants to skip a string for one or more included languages then a definition should take place e.g.<br />
      <br />
      !define MULTILANG_MSG "A message showing for a couple of languages"<br />
      <br />
      LangString TEST_STRING ${LANG_ENGLISH} "English String"<br />
      LangString TEST_STRING ${LANG_GERMAN} "German String"<br />
      LangString TEST_STRING ${LANG_FRENCH} "French String"<br />
      <br />
      <b>LangString TEST_STRING ${LANG_SPANISH} "${MULTILANG_MSG}"</b></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">datallah</span><br />
      <span class="post-time small text-muted">23rd May 2007 05:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Red Wine</i><br />
        <b>@ datallah + @ ecology2007,<br />
        <br />
        Sorry I can't get your point guys, setting every language string explicitly for every included language is a requirement in order for a proper functionality.<br />
        If for some reason one wants to skip a string for one or more included languages then a definition should take place e.g.<br />
        <br />
        !define MULTILANG_MSG "A message showing for a couple of languages"<br />
        <br />
        LangString TEST_STRING ${LANG_ENGLISH} "English String"<br />
        LangString TEST_STRING ${LANG_GERMAN} "German String"<br />
        LangString TEST_STRING ${LANG_FRENCH} "French String"<br />
        <br /></b> LangString TEST_STRING ${LANG_SPANISH} "${MULTILANG_MSG}"
      </blockquote>This really doesn't sound reasonable to me.<br />
      <br />
      If this really is the case, there should be a compile time error for missing translations because it effectively makes the installer unusable for these users.<br />
      <br />
      I'm sure I can hack together a macro to make it use the default language, but it seems crazy that this wouldn't be built in functionality.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">23rd May 2007 05:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Modifying your posted sample.nsi, does not produce any kind of compiler error,<br /></p>
      <pre>
<code><font color="red">!define MULTILANG_MSG "A message showing for a couple of languages"</font><br /><br />;--------------------------------<br />;Include Modern UI<br /><br />  !include "MUI.nsh"<br /><br />;--------------------------------<br />;General<br /><br />  Name "Test"<br />  OutFile "testinst.exe"<br />  InstallDir "C:\Program files\Test"<br /><br />  SetCompressor /SOLID lzma<br />  <br />;--------------------------------<br />;Pages<br /><br />  !define AppTitle "Test app"<br /><br />  !define MUI_HEADERIMAGE<br />  !define MUI_WELCOMEPAGE_TITLE_3LINES<br />  !define MUI_FINISHPAGE_TITLE_3LINES<br />  !define MUI_ABORTWARNING<br />  !insertmacro MUI_PAGE_DIRECTORY<br />  !insertmacro MUI_PAGE_INSTFILES<br />  !insertmacro MUI_PAGE_FINISH<br />  <br />  !insertmacro MUI_UNPAGE_CONFIRM<br />  !insertmacro MUI_UNPAGE_INSTFILES<br />  !insertmacro MUI_UNPAGE_FINISH<br />  <br />;--------------------------------<br />;Languages<br />  !insertmacro MUI_LANGUAGE "English"<br />  !insertmacro MUI_LANGUAGE "French"<br />  !insertmacro MUI_LANGUAGE "German"<br />  !insertmacro MUI_LANGUAGE "Spanish"<br /><br />;--------------------------------<br /><br /><br />  LangString TEST_STRING ${LANG_ENGLISH} "English String"<br />  LangString TEST_STRING ${LANG_GERMAN} "German String"<br />  LangString TEST_STRING ${LANG_FRENCH} "French String"<br /><br />  <font color="red">LangString TEST_STRING ${LANG_SPANISH} "${MULTILANG_MSG}"</font><br /><br />Function .onInit<br /><br />  !insertmacro MUI_LANGDLL_DISPLAY<br /><br />FunctionEnd<br /><br />;Installer Sections<br /><br />Section "${AppTitle}" SecStarted<br />  <br />  SetOutPath "$INSTDIR"<br />  File sample.nsi<br />   <br />  MessageBox MB_DEFBUTTON2|MB_YESNO $(TEST_STRING) /SD IDYES IDYES true  IDNO false<br />true:<br />false:<br />  ;Create uninstaller<br />  WriteUninstaller "$INSTDIR\Uninstall.exe"<br /><br />SectionEnd<br /><br />;--------------------------------<br />;Uninstaller Section<br /><br />Section "Uninstall"<br /><br />   Delete "$INSTDIR\sample.nsi"<br />   Delete "$INSTDIR\Uninstall.exe"<br />   RMDir "$INSTDIR"<br /><br />SectionEnd<br /></code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">23rd May 2007 11:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I see your point, datallah, there should be a compile time error or at least a warning if a language is included but no LangString is specified for that included language when used.<br />
      <br />
      However, it is up to the programmer to check that everything works. It'd be plain lazy not to hard code language strings for all included languages.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">datallah</span><br />
      <span class="post-time small text-muted">23rd May 2007 13:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Afrow UK</i><br />
        <b>I see your point, datallah, there should be a compile time error or at least a warning if a language is included but no LangString is specified for that included language when used.<br />
        <br />
        However, it is up to the programmer to check that everything works. It'd be plain lazy not to hard code language strings for all included languages.<br />
        <br />
        Stu</b>
      </blockquote>There is a warning about the missing translation, I just didn't realize that it meant that the text would be missing.<br />
      <br />
      I was mistakenly assuming that it'd work similar to how gettext works (where the default value is used if there is no available translation).<br />
      <br />
      Laziness isn't really the reason for my not adding the defaults - If I stifle the warning by adding the English text to the translations, I will no longer be able to use the warning to tell the translators which strings are missing (Unfortunately, I can't expect them to fix the translations in a timely manner (or sometimes at all)).<br />
      <br />
      Perhaps the docs should be clarified to indicate that an undefined LangString for a language will result in missing text - I suspect that I'm not the only person that was confused about how it works.
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
