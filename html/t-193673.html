<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Need a Wait statement...?" />

  <title>Need a Wait statement...? - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Need a Wait statement...?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=193673">Need a Wait statement...?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">michaelmross</span><br />
      <span class="post-time small text-muted">15th September 2004 21:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Need a Wait statement...?</strong><br />
      This must be a very common situation, so forgive me. I have a function that tests if the application being installed is already running:<br />
      <br />
      FindWindow $0 "ThunderRT6FormDC" "TaskTracker"<br />
      IsWindow $0 0 done<br />
      Messagebox MB_OK|MB_ICONSTOP "Please exit TaskTracker before proceeding."<br />
      Abort<br />
      <br />
      The problem is I don't want to Abort. I want to Wait till the user closes the running app. How can I do this?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">15th September 2004 21:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Will a loop help you?<br />
      <br />
      loop:<br />
      FindWindow $0 "ThunderRT6FormDC" "TaskTracker"<br />
      IsWindow $0 0 done<br />
      Messagebox MB_OK|MB_ICONSTOP "Please exit TaskTracker before proceeding."<br />
      Goto loop<br />
      done:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">michaelmross</span><br />
      <span class="post-time small text-muted">16th September 2004 12:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If that worked the way I expected, wouldn't it just show the message again the moment it was dismissed until the app was closed? (However, for some reason, it doesn't do that - it still terminates.) But anyway, what I would want to happen is to go back one page to Choose Install Location and not have the message reappear unless the user clicked Install again.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">16th September 2004 13:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can use NSIS Sleep in the loop.<br />
      <br />
      Another way - WaitForSingleObject and other Win API calls with System plugin - VB sample from <a href="http://support.microsoft.com/default.aspx?scid=kb;EN-US;176391" target="_blank">http://support.microsoft.com/default...b;EN-US;176391</a> below:<br />
      <br />
      hWindow = FindWindow(vbNullString, "Calculator")<br />
      hThread = GetWindowThreadProcessId(hWindow, lProcessId)<br />
      hProcess = OpenProcess(SYNCHRONIZE, 0&amp;, lProcessId)<br />
      lngReturnValue = PostMessage(hWindow, WM_CLOSE, 0&amp;, 0&amp;)<br />
      lngResult = WaitForSingleObject(hProcess, INFINITE)<br />
      <br />
      If you don't want to send wm_close - modify this code to NSIS script, add MessageBox, loop, change INFINITE and so on...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">16th September 2004 14:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Oh, I was thinking the MessageBox would tell them to close the other window. Then they would close it and click OK on the install message which would then retest and see that the window was closed and allow them to continue.<br />
      It sounds like what you should do now is make that function get hit when the user leaves that dialog and then stay on that dialog if the user still has that window open and display the message. Look up Page or Modern UI about leave functions. Abort is what you want in that case. Or attach your script and I can help you out.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">michaelmross</span><br />
      <span class="post-time small text-muted">17th September 2004 14:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK, I tried the following:<br />
      <br />
      !define MUI_DIRECTORYPAGE_VERIFYONLEAVE LeaveFunction<br />
      . . .<br />
      Function LeaveFunction<br />
      <br />
      FindWindow $0 "ThunderRT6FormDC" "TaskTracker"<br />
      IsWindow $0 0 done<br />
      Messagebox MB_OK|MB_ICONSTOP "Please exit TaskTracker before proceeding."<br />
      Abort<br />
      done:<br />
      <br />
      FunctionEnd<br />
      <br />
      ...and I get a compile warning:<br />
      1 warning:<br />
      install function "LeaveFunction" not referenced - zeroing code (306-311) out.<br />
      <br />
      Thanks for your offer... here is my attached script.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">17th September 2004 17:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Looks like it's not picking it up. Put the !define line just above the !insertmacro for the page you want to add the leave function for. I'm actually not sure where you wanted it so I just used MUI_PAGE_DIRECTORY in my example.<br />
      <br />
      !define MUI_PAGE_CUSTOMFUNCTION_LEAVE "LeaveFunction"<br />
      !insertmacro MUI_PAGE_DIRECTORY</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">michaelmross</span><br />
      <span class="post-time small text-muted">17th September 2004 21:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks. That does exactly what I wanted. When Install is clicked, the message comes up, and when it's dismissed the installer state is unchanged.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
