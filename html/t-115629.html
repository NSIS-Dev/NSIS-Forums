<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="!define and environment variable" />

  <title>!define and environment variable - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">!define and environment variable</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=115629">!define and environment variable</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">e-novative</span><br />
      <span class="post-time small text-muted">26th November 2002 09:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>!define and environment variable</strong><br />
      Hi all,<br />
      <br />
      My installation requires a version number that is !define'd in the NSIS script. Is it possible to read a value from an environment variable (or pass a value to the compiler via command line) *at compile time*?<br />
      <br />
      This would allow my "create release" batch to pass the version number to the NSIS script, thus freeing me from the need to set the version number there manually (which is rather error-prone).<br />
      <br />
      Or is it, by some way, possible the other way round? Can the compiler "return" the version number to the calling batch?<br />
      <br />
      I couldn't find anything useful when searching the forum and the net. Any idea or pointer would be greatly appreciated.<br />
      <br />
      Regards,<br />
      <br />
      Steve</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dbareis</span><br />
      <span class="post-time small text-muted">26th November 2002 09:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I don't know whether NSIS can do it or not, someone else may provide an answer, but there are other preprocessors. My free PPWIZARD will certainly allow you to do this.<br />
      <br />
      Bye<br />
      Dennis</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dselkirk</span><br />
      <span class="post-time small text-muted">26th November 2002 13:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Use the command line option /D to define you version.<br />
      <br />
      makensis.exe /DVERSION=2 file.nsi<br />
      <br />
      Make sure your script doesn't over right it though by doing the following.<br />
      <br />
      !ifndef VERSION<br />
      !define VERSION 1<br />
      !endif</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">26th November 2002 14:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        I couldn't find anything useful when searching the forum and the net. Any idea or pointer would be greatly appreciated.
      </blockquote>Well, you didn't search hard enough... It's in the FAQ on the top of the page ;)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">e-novative</span><br />
      <span class="post-time small text-muted">26th November 2002 14:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Works perfect, thanks a lot.<br />
      <br />
      I must have been blind, though ... shouldn't have worked so late last night!<br />
      <br />
      Steve</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dselkirk</span><br />
      <span class="post-time small text-muted">26th November 2002 15:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">no problem and i know the feeling, hehe</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">HelluvaEngineer</span><br />
      <span class="post-time small text-muted">11th December 2002 19:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by dselkirk</i><br />
        <b>Use the command line option /D to define you version.<br />
        <br />
        makensis.exe /DVERSION=2 file.nsi<br />
        <br />
        Make sure your script doesn't over right it though by doing the following.<br />
        <br />
        !ifndef VERSION<br />
        !define VERSION 1<br />
        !endif</b>
      </blockquote>Ok, you just lost me. I am using code similar to what you said above, and it's not working. It shouldn't enter the ifndef unless it's not defined, right?<br />
      <br />
      Lookie here:<br />
      <br />
      I call<br />
      <br />
      Makensis /V3 /NOCONFIG /HDRINFO /CD /DMAJORVER=2 /DMINORVER=2 /DMICROVER=0 TechDemo.nsi<br />
      <br />
      In the nsi, I have this code:<br />
      <br />
      !ifndef ${MAJORVER}<br />
      !warning "MAJORVER not defined."<br />
      !define MAJORVER 0<br />
      !endif<br />
      <br />
      !ifndef ${MINORVER}<br />
      !warning "MINORVER not defined."<br />
      !define MINORVER 0<br />
      !endif<br />
      <br />
      !ifndef ${MICROVER}<br />
      !warning "MICROVER not defined."<br />
      !define MICROVER 0<br />
      !endif<br />
      <br />
      But get this error!:<br />
      <br />
      warning: !warning: MAJORVER not defined. (TechDemo.nsi:35)<br />
      <br />
      !define: "MAJORVER" already defined!<br />
      Error in script "TechDemo.nsi" on line 36 -- aborting creation process<br />
      <br />
      Am I overlooking something?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">11th December 2002 19:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You should call the ifndef like this:<br />
      <br />
      !ifndef MAJORVER<br />
      <br />
      ${MAJORVER} translates to its value and because of that NSIS tries to see if 2 is not defined, which is of course true.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">HelluvaEngineer</span><br />
      <span class="post-time small text-muted">11th December 2002 19:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK, in retrospect that should have been obvious. Thank you!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
