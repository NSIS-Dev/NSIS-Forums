<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Calling a dll to encrypt a password"><title>Calling a dll to encrypt a password - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Calling a dll to encrypt a password</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=181324">Calling a dll to encrypt a password</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">rincewind</span><br><span class="post-time small text-muted">27th May 2004 12:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Calling a dll to encrypt a password</strong><br>I'm trying to get my script to take input from a password box and then pass it to a dll which contains a function that encrypts it. The prototype for the (Delphi) function is this: function IDPEncryptPassword(P: PChar; var MaxLen: integer): LongBool;<br><br>However, when the function returns it has not changed the original string, and the debug info prints this. The int I pass into the function has also not changed size (stays 1024). Could anyone please help me out with what I'm doing wrong? I'm an NSIS newbie and don't really have the skills to spot what I'm doing wrong (yet :). The relevant section is this:<br>;the relevant dll's have been loaded just before this<br>; read the entered value<br>ReadIniStr $4 "$PLUGINSDIR\userpass.ini" "Field 3" "State"<br>WriteINIStr "C:\Infront\IDP\IDP.ini" "Funccall" "Password before" $4<br>SetPluginUnload alwaysoff<br>StrCpy $5 ${NSIS_MAX_STRLEN}<br>; just print out debug info<br>WriteINIStr "C:\Infront\IDP\IDP.ini" "Funccall" "intsize before" $5<br><br>/* This is the problem area!!! */<br>System::Call 'IDPGenPwd::IDPEncryptPassword(t .r4, *i r5r5)i .r6'<br>; This is where it's supposed to write the encrypted password<br>WriteINIStr "C:\Infront\IDP\IDP.ini" "IAS" "Password" $4<br>; Debug info<br>WriteINIStr "C:\Infront\IDP\IDP.ini" "Funccall" "Error code" $6<br>WriteINIStr "C:\Infront\IDP\IDP.ini" "Funccall" "intsize" $5<br>SetPluginUnload manual<br>System::Free 0<br><br>Attached is the complete script.<br>Any help is highly appreciated!!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">deguix</span><br><span class="post-time small text-muted">28th May 2004 01:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The input will always be returned if an output part doesn't return or if you don't specify to output a value. In this case, you used $5 as input.<br><br>If you're expecting an output, you should put a "." before the variable r5 (on System plugin call).<br><br>Or if you're expecting an input and an output, you should put two variables (on System plugin call) with a "." before the second one. I'll show what is my point with the correct code (I think, as you explained):<br><br></p><pre>
<code>System::Call 'IDPGenPwd::IDPEncryptPassword(t .r4, *i r5 .r5)i .r6'</code>
</pre></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rincewind</span><br><span class="post-time small text-muted">28th May 2004 08:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by deguix</i><br><b>The input will always be returned if an output part doesn't return or if you don't specify to output a value. In this case, you used $5 as input.<br><br>If you're expecting an output, you should put a "." before the variable r5 (on System plugin call).<br><br>Or if you're expecting an input and an output, you should put two variables (on System plugin call) with a "." before the second one. I'll show what is my point with the correct code (I think, as you explained):<br><br></b><pre>
<b><code>System::Call 'IDPGenPwd::IDPEncryptPassword(t .r4, *i r5 .r5)i .r6'</code></b>
</pre></blockquote>No, it's still not working. When the function now returns the variable r4 which is supposed to contain the encrypted password is blank. What I'm trying to do (in case it was a bit confusing) is to pass in r4 (the string to be converted), and a buffer, r5. When the function returns r4 has been encrypted by the function and r5 contains the length of the new [encrypted] string. What r5 does or doesn't contain isn't really important, just that r4 is converted properly.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">28th May 2004 09:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That's not exact deguix. Please refer to the new System documentation:<br><br><a href="http://nsis.sf.net/System.html" target="_blank">http://nsis.sf.net/System.html</a></p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>