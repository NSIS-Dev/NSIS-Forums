<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="nsProcess plugin" />

  <title>nsProcess plugin - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content=" nsProcess plugin" />

  <title>nsProcess plugin - NSIS Forums</title>
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" />
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">nsProcess plugin</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=230998">nsProcess plugin</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">14th November 2005 19:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>nsProcess plugin</strong><br />
      <b>Features</b>:<br />
      - Find/kill a process by name<br />
      - Kill all processes with specified name (not only one)<br />
      - The process name is case-insensitive<br />
      - Win95/98/ME/NT/2000/XP support<br />
      - Small plugin size (4,5 Kb)<br />
      <br />
      Source function FIND_PROC_BY_NAME based upon the Ravi Kochhar <a href="http://www.physiology.wisc.edu/ravi/Software/" target="_blank">code</a><br />
      Thanks iceman_k (<a href="http://nsis.sourceforge.net/Find_Process_By_Name" target="_blank">FindProcDLL plugin</a>) and<br />
      DITMan (<a href="http://nsis.sourceforge.net/KillProcDLL_Manual" target="_blank">KillProcDLL plugin</a>) for direct me<br />
      <br />
      <br />
      "<b>nsProcess</b>" plugin v1.0</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br />
      <span class="post-time small text-muted">15th November 2005 00:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You just keep churning out the plugins. Good one.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">15th November 2005 16:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">you just rock, man.<br />
      this will revolutionize my installers :D<br />
      <br />
      maybe i should collect all the good plugins into a package on day, so everyone may download and setup them easily ...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">15th November 2005 17:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">16th November 2005 15:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Good to see "Win95/98/ME" support, thanks man!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">20th November 2005 14:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        you just rock, man.<br />
        this will revolutionize my installers<br />
        <br />
        maybe i should collect all the good plugins into a package on day, so everyone may download and setup them easily ...
      </blockquote>Another good idea would be making function standards and to include those in a global header for easier and pratical use.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">21st November 2005 17:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">... and include this header file together with the plugins into the package ...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">4th January 2006 16:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><b>Fixed</b>: removed CRT dependency (Windows 95 by default does not have msvcrt.dll)<br />
      <br />
      <br />
      "<b>nsProcess</b>" plugin v1.1</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">11th March 2006 07:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Changed: Now plugin used header "nsProcess.nsh" for custom user variables and<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;better compile errors check.<br />
      <br />
      <b>Update from previous versions:</b><br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;- Insert line in script:<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;!include "nsProcess.nsh"<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;- Replace:<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;nsProcess::FindProcess -&gt; ${nsProcess::FindProcess} ...<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;- Replace:<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.r0 -&gt; $0, .r1 -&gt; $1 ... .R0 -&gt; $R0, .R1 -&gt; $R1 ...<br />
      <br />
      "<b>nsProcess</b>" plugin v1.2</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br />
      <span class="post-time small text-muted">21st April 2006 14:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>About the code</strong><br />
      What is the benefit of using PSAPI for WinNT/2000/XP? Shouldn't the Win95/98/ME method work just as fine in this case?<br />
      <br />
      Edit: Never mind. It's the Toolhelp32.dll what Windows NT does not have.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br />
      <span class="post-time small text-muted">21st April 2006 15:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hmm in Win95/98/ME method the hSnapShot HANDLE leaves open if the process was found and bTerminate is FALSE.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">21st April 2006 16:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        Hmm in Win95/98/ME method the hSnapShot HANDLE leaves open if the process was found and bTerminate is FALSE.
      </blockquote>You are right, fixed.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">21st April 2006 16:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><b>Fixed</b>: removed memory leak.<br />
      <br />
      <br />
      "<b>nsProcess</b>" plugin v1.3</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rxs2k5</span><br />
      <span class="post-time small text-muted">21st April 2006 17:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hmm I do not understand, can this plugin kill current open notepad ???<br />
      <br />
      Is this able to find notepad that is currently running and kill it immediately ???</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br />
      <span class="post-time small text-muted">22nd April 2006 11:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by rxs2k5</i><br />
        <b>hmm I do not understand, can this plugin kill current open notepad ???<br />
        <br />
        Is this able to find notepad that is currently running and kill it immediately ???</b>
      </blockquote>Yes and yes.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rxs2k5</span><br />
      <span class="post-time small text-muted">23rd April 2006 18:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">How do I create the following thing<br />
      1. remove the loop<br />
      2. find the processes to find notepad , wordpad means in mutiple form and single finding<br />
      3. kill all the following process after finding it existence<br /></p>

      <blockquote>
        Section /o "Kill process" KillProcess<br />
        loop:<br />
        ${nsProcess::FindProcess} "NoTePad.exe" $R0<br />
        StrCmp $R0 0 0 +2<br />
        MessageBox MB_OKCANCEL|MB_ICONEXCLAMATION 'Close "notepad" before continue' IDOK loop IDCANCEL end<br />
        <br />
        ${nsProcess::KillProcess} "NoTePad.exe" $R0<br />
        MessageBox MB_OK "nsProcess::KillProcess$\n$\n\<br />
        Errorlevel: [$R0]"<br />
        Exec "notepad.exe"<br />
        Exec "notepad.exe"<br />
        Exec "notepad.exe"<br />
        BringToFront<br />
        MessageBox MB_OK "Press OK and 3 notepad's windows will be closed"<br />
        <br />
        ${nsProcess::KillProcess} "NoTePad.exe" $R0<br />
        MessageBox MB_OK "nsProcess::KillProcess$\n$\n\<br />
        Errorlevel: [$R0]"<br />
        <br />
        end:<br />
        ${nsProcess::Unload}<br />
        SectionEnd
      </blockquote>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">oleksa</span><br />
      <span class="post-time small text-muted">14th July 2006 15:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>error code 603</strong><br />
      I'd downloaded this plugin and had tested it. Test install script always returns Error level 603. If I run script single or with calc.exe<br />
      <br />
      Help me please! What does this error mean? Where I can find error code list?<br />
      <br />
      Thank you.<br />
      I have Windows XP prof x64.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">14th July 2006 17:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        Help me please! What does this error mean? Where I can find error code list?
      </blockquote>In the Readme.txt :) Unfortunatelly I can't test it on WinXP x64.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">oleksa</span><br />
      <span class="post-time small text-muted">17th July 2006 14:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've found that EnumProcessModules fails when is called for 64 bit applications (calc.exe is 64-bit application) on 64 bit OS with error<br />
      <br />
      299<br />
      ERROR_PARTIAL_COPY<br />
      Only part of a ReadProcessMemory or WriteProcessMemory request was completed.<br />
      <br />
      I will try to find solution for this problem.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">oleksa</span><br />
      <span class="post-time small text-muted">17th July 2006 15:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello <b>Instructor</b>.<br />
      It's me again.<br />
      <br />
      Have you tried CreateToolhelp32Snapshot, Process32First, Process32Next functions on NT platforms? It works fine at my comp (I'm administrator). This functions are located in kernel32.dll as MSDN says - no psapi is required and should work on Win95/98, WinNT, Win2000 and Windows XP.<br />
      <br />
      Why OpenProcess and EnumProcessModules are used for NT like OS now (Windows 2000, XP, 2003)? Only for Windows NT 4.0 support?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br />
      <span class="post-time small text-muted">17th July 2006 18:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">@oleksa<br />
      Could you try this. I removed the PSAPI and OS check and now it's using only the "Win95/98" method.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">oleksa</span><br />
      <span class="post-time small text-muted">18th July 2006 07:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello <b>{_trueparuex^}</b><br />
      <br />
      Yes - that sample code (based on CreateToolhelp32Snapshot, Process32First, Process32Next functions) works fine on my comp. To save Windows NT 4.0 compatibility I suggest rewrite OS check from<br /></p>
      <pre>
<code>if (osvi.dwPlatformId == VER_PLATFORM_WIN32_NT)</code>
</pre><br />
      to<br />
      <pre>
<code>if (osvi.dwPlatformId == VER_PLATFORM_WIN32_NT &amp;&amp; osvi.dwMajorVersion &lt;= 4)</code>
</pre><br />
      This check should be true only on Windows NT (as <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/sysinfo/base/getting_the_system_version.asp" target="_blank">MSDN says</a>). So on NT will work code that gets processes name with PSAPI.<br />
      Windows 95, 98, Me, 2000, 2003 and XP should support Tool help functions.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br />
      <span class="post-time small text-muted">18th July 2006 11:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Good. I have my own NSIS unrelated stuff based on the same code... But there is one major disadvantage in CreateToolhelp32Snapshot method. It doesn't work with file names longer than 15 characters. So trying to kill process with name like this "ThisIsPrettyLongName.exe" won't work. One solution would be simply to limit the file names to 15 characters, but that could cause kill of unintentional processes.<br />
      <br />
      So let's see what Instructor gets up to with. :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">19th July 2006 14:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><b>oleksa</b> can you test it on the x64<br />
      <br />
      <b>Fixed</b>: WinNT 4.0 by default doesn't have PSAPI.DLL. Code for WinNT/2000/XP has<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;been rewritten (using NTDLL.DLL). Note: on WinNT 4.0 process name limited<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;to 15 characters.<br />
      <b>Changed</b>: error codes.<br />
      <br />
      <br />
      "<b>nsProcess</b>" plugin v1.4</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">oleksa</span><br />
      <span class="post-time small text-muted">19th July 2006 14:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><b>Instructor</b> works fine, thank you.<br />
      looks for calc.exe (603 if process hasn't been started and 0 if process has been started)<br />
      checks does notepad.exe running and closes all three notepads succesfully.<br />
      <br />
      Thank you.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">oleksa</span><br />
      <span class="post-time small text-muted">24th July 2006 07:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        But there is one major disadvantage in CreateToolhelp32Snapshot method. It doesn't work with file names longer than 15 characters. So trying to kill process with name like this "ThisIsPrettyLongName.exe" won't work.
      </blockquote>2 <b>{_trueparuex^}</b><br />
      How could wou know that CreateToolhelp32Snapshot method won't work?<br />
      <br />
      I have test it and all works fine:<br />
      <pre>
<code>PROCESS NAME:  AcroRd32.exe<br />PROCESS NAME:  devenv.exe<br />PROCESS NAME:  mspdbsrv.exe<br />PROCESS NAME:  ThisIsPrettyLongName.exe</code>
</pre><br />
      I could post test code (from MSDN) here or send you e-mail as you wish.<br />
      <br />
      Good bye.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br />
      <span class="post-time small text-muted">24th July 2006 15:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by oleksa</i><br />
        <b>2</b> {_trueparuex^}<br />
        How could wou know that CreateToolhelp32Snapshot method won't work?<br />
        <br />
        I have test it and all works fine:<br />
        <pre>
<code>PROCESS NAME:  AcroRd32.exe<br />PROCESS NAME:  devenv.exe<br />PROCESS NAME:  mspdbsrv.exe<br />PROCESS NAME:  ThisIsPrettyLongName.exe</code>
</pre><br />
        I could post test code (from MSDN) here or send you e-mail as you wish.<br />
        <br />
        Good bye.
      </blockquote>I wasn't aware of this before, but that 15 characters name limitation is only in win2k or older. :)<br />
      <br />
      <br />
      <b>@Instructor</b><br />
      That 15 characters name limitation is also in Windows 2000 when using NTDLL.DLL :( PSAPI didn't have that limitation.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dienjd</span><br />
      <span class="post-time small text-muted">2nd August 2006 04:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Instructor,<br />
      There is a spyware app with a DLL that has the same name as this plug-in:<br />
      <a href="http://www3.ca.com/securityadvisor/pest/pest.aspx?id=453097507" target="_blank">http://www3.ca.com/securityadvisor/p...x?id=453097507</a><br />
      <br />
      This is too bad...I don't know of a way around having your plug-in associated with adware other than renaming it.<br />
      <br />
      Those of you who are already using it may want to rename it to avoid having your installer raise anti-virus/spy flags when running.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">31st August 2006 09:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><b>Fixed</b>: removed memory leak in WinNT/2000/XP method.<br />
      <br />
      <br />
      "<b>nsProcess</b>" plugin v1.5</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">CharlesB2</span><br />
      <span class="post-time small text-muted">3rd October 2006 14:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Instructor</i><br />
        <b>Fixed: removed memory leak in WinNT/2000/XP method.<br />
        <br />
        <br />
        "nsProcess" plugin v1.5</b>
      </blockquote>Hey,<br />
      <br />
      Since recent update of McAfee VirusScan, the use of a previous nsProcess version was detected as a Trojan (generic prockill.a)!! The last version (1.5) does not cause the problem. Thanks a lot!<br />
      <br />
      Cheers
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpodtbc</span><br />
      <span class="post-time small text-muted">27th October 2006 01:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">problem trying to kill a service process. i can find the process but when i try to kill it i get return code 601 (no permission to kill process). i am running the installer as an administrator and can kill the process manually.<br />
      <br />
      please help.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br />
      <span class="post-time small text-muted">27th October 2006 10:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Killing service like that is really not very smart. Rather try to stop it with some of these methods.<br />
      <a href="http://nsis.sourceforge.net/How_do_I_start/stop/create/remove/check_a_service" target="_blank">http://nsis.sourceforge.net/How_do_I...heck_a_service</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpodtbc</span><br />
      <span class="post-time small text-muted">27th October 2006 17:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">thanks but i already have service control implemented in the installer. the problem is when the service is unresponsive and cannot be shut down any other way. i think we can all agree that it is bad to have the installer hang indefinitely.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpodtbc</span><br />
      <span class="post-time small text-muted">27th October 2006 17:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">i found a solution by modifying the nsProcess source code and using code provided here:<br />
      <a href="http://www.alexfedotov.com/articles/killproc.asp?pane=0" target="_blank">http://www.alexfedotov.com/articles/killproc.asp?pane=0</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hbatista</span><br />
      <span class="post-time small text-muted">20th November 2006 18:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi jpodtbc, I'm having the exact same problem as you.<br />
      Could you be so kind to post your solution here?<br />
      Thanks a lot</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hbatista</span><br />
      <span class="post-time small text-muted">21st November 2006 12:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I ended up changing it myself. Here is the source code and dll if someone wants to use it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpodtbc</span><br />
      <span class="post-time small text-muted">22nd November 2006 17:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">thanks man...i was about to put up my modified source but you beat me to it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hbatista</span><br />
      <span class="post-time small text-muted">27th November 2006 15:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">No problem, I was facing a really tight deadline so I had to go for it. :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Whizz</span><br />
      <span class="post-time small text-muted">4th February 2007 12:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Trojan AV Trigger</strong><br /></p>

      <blockquote>
        <i>Originally posted by CharlesB2</i><br />
        <b>Hey,<br />
        <br />
        Since recent update of McAfee VirusScan, the use of a previous nsProcess version was detected as a Trojan (generic prockill.a)!! The last version (1.5) does not cause the problem. Thanks a lot!<br />
        <br />
        Cheers</b>
      </blockquote>This is still happening, even with 1.5 of nsProcess. It is being detected as HackTool.ProcKill.A by several AV packages.<br />
      <br />
      Is there any chance of a major change with this DLL to prevent this detection? The DLL itself is really useful, but it looks like someone has used it for less than honest purposes :down: .<br />
      <br />
      I have had to take it out of several of my installers for until this can be fixed.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Meefer</span><br />
      <span class="post-time small text-muted">4th February 2007 12:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://Jennifer-Lopez-Doing-A-Huge-Black-Man.info" target="_blank">http://Jennifer-Lopez-Doing-A-Huge-Black-Man.info</a></p>
    </div>
    <hr />
    <!-- Bootstrap core CSS -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <div class="container">
      <!-- Put navigation bar here -->

      <ol class="breadcrumb">
        <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

        <li><a href="f-65.html">NSIS Discussion</a></li>

        <li class="active">nsProcess plugin</li>
      </ol>

      <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=230998">nsProcess plugin</a></p><br />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">CharlesB2</span><br />
        <span class="post-time small text-muted">4th February 2007 23:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"><strong>Re: Trojan AV Trigger</strong><br /></p>

        <blockquote>
          <i>Originally posted by Whizz</i><br />
          <b>This is still happening, even with 1.5 of nsProcess. It is being detected as HackTool.ProcKill.A by several AV packages.<br />
          <br />
          Is there any chance of a major change with this DLL to prevent this detection? The DLL itself is really useful, but it looks like someone has used it for less than honest purposes :down: .</b>
        </blockquote>The best way to handle the problem is to recompile the DLL by removing the function that kills a process, since I believe it is the one that is used by trojans. I have done it myself, if you're interested I can put it on the wiki...<br />
        <br />
        Cheers
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Whizz</span><br />
        <span class="post-time small text-muted">5th February 2007 20:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"><strong>Re: Re: Trojan AV Trigger</strong><br /></p>

        <blockquote>
          <i>Originally posted by CharlesB2</i><br />
          <b>The best way to handle the problem is to recompile the DLL by removing the function that kills a process, since I believe it is the one that is used by trojans. I have done it myself, if you're interested I can put it on the wiki...<br />
          <br />
          Cheers</b>
        </blockquote>That sounds good, but actually I do need the kill a process function. So taking it out would be a bit of a pain.<br />
        <br />
        Do you have the full source (or anyone else out there) for a Micro$oft compiler and can provide a link?<br />
        <br />
        I presume its coded in C/++. I might try to obfuscate it and re-compile to see if that gets it through.
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">CharlesB2</span><br />
        <span class="post-time small text-muted">6th February 2007 08:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"><strong>Re: Re: Re: Trojan AV Trigger</strong><br /></p>

        <blockquote>
          <i>Originally posted by Whizz</i><br />
          <b>That sounds good, but actually I do need the kill a process function. So taking it out would be a bit of a pain.<br />
          <br />
          Do you have the full source (or anyone else out there) for a Micro$oft compiler and can provide a link?<br />
          <br />
          I presume its coded in C/++. I might try to obfuscate it and re-compile to see if that gets it through.</b>
        </blockquote>The source is in the archive, on the wiki page: <a href="http://nsis.sourceforge.net/NsProcess_plugin" target="_blank">http://nsis.sourceforge.net/NsProcess_plugin</a><br />
        <br />
        Cheers
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">JamesKiller</span><br />
        <span class="post-time small text-muted">3rd May 2007 23:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">when I am using this plugins, i have a problem which can not kill the old vesion of my application.<br />
        for example: i have version 1 : myservice<br />
        i make a new build, then install it, it can't kill verison 1 process?<br />
        I think it would a bug ???<br />
        Any thoughts?</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">goldy1064</span><br />
        <span class="post-time small text-muted">4th May 2007 02:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Well, if version 1 is a service, as the name you gave implies, you would need to ensure that it won't auto-recover when killed.</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Whizz</span><br />
        <span class="post-time small text-muted">4th May 2007 06:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"></p>

        <blockquote>
          <i>Originally posted by JamesKiller</i><br />
          <b>when I am using this plugins, i have a problem which can not kill the old vesion of my application.<br />
          for example: i have version 1 : myservice<br />
          i make a new build, then install it, it can't kill verison 1 process?<br />
          I think it would a bug ???<br />
          Any thoughts?</b>
        </blockquote>Services are not really like a normal program process. They are controlled by the 'Services Controller' (SC) which deals with both services and devices.<br />
        <br />
        You should 'stop' your service officially, advise the SC to remove it from the database, update it, reload into the database and then 'start' it again.<br />
        <br />
        If it is a protected service, then you have to advise the SC to make the changes at next boot up. Which is really quite difficult in the newer OS's of XP/Vista. And probably you shouldn't be touching anyway. :D<br />
        <br />
        NSProcess is probably not the plugin for you when dealing with services. :(
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">M-Force</span><br />
        <span class="post-time small text-muted">10th October 2007 18:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"><strong>What AV packages are triggered by nsProcess?</strong><br />
        Hi,<br />
        <br />
        is it still an issue that nsProcess is trigger AV packages as a trojan virus?<br />
        If so do you have a list of such AV packages?<br />
        I would like to check my installer for such problem.</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Whizz</span><br />
        <span class="post-time small text-muted">10th October 2007 21:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">I have not seen the problem since I re-compiled the source code myself, using my own compiler. Rather than using the distributed version from the download location. This is the distro version I use now.<br />
        <br />
        When I was experimenting, I found that the following AV systems did trigger a false detection:<br />
        <br />
        Panda<br />
        Macafee/NAI<br />
        BitDefender<br />
        F-Secure<br />
        Symantec/Norton<br />
        <br />
        I did not have access to any other AV engines to test further. Actually 1 detection was too many!!! :eek:<br />
        <br />
        Once I recompiled and the issue went away, then I did not test any further. Nor have I tried downloading to see if there was a newer version by the author.<br />
        <br />
        I guess the original was being compiled with an non-fully patched version of MS:C++. I did no changes, just compiled and used the resultant file.</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">99999999</span><br />
        <span class="post-time small text-muted">25th April 2008 00:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Is there source code available for the nsProcess plugn?</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Whizz</span><br />
        <span class="post-time small text-muted">25th April 2008 06:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">As stated by CharlesB2 earlier in the thread. It is in the Archive on the Wiki page.<br />
        <br />
        Did you read the <b>whole</b> of this thread?? I guess not.:rolleyes:</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">afisk</span><br />
        <span class="post-time small text-muted">12th May 2008 15:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Do you have a link to your re-compiled DLL by any chance, Whizz? Maybe you could add it to the wiki? I don't do much Windows programming and don't have everything set up to compile my own. You can also reach me at "a" at my domain --- littleshoot.org. Would be a huge help. I'd even paypal you $10 -- seriously.<br />
        <br />
        -Adam Fisk</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">arantius</span><br />
        <span class="post-time small text-muted">10th June 2008 16:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">I've patched this plugin to add a CloseProcess method, a nicer alternative to KillProcess.<br />
        <br />
        I offer no guarantees as to its quality, as C++ is not my primary skill. However, the updated nsProcess.c file is attached for anyone who might find it useful.</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Ivan Andreevich</span><br />
        <span class="post-time small text-muted">19th January 2009 17:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Any plans to make a version that could be used to kill processes by PID?</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">skuallpa</span><br />
        <span class="post-time small text-muted">1st February 2010 16:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Hello,<br />
        <br />
        the plugin works well for normal build of nsis under x64. However, it failed to find processes for nsis unicode build<br />
        <br />
        Do you have a solution for this?<br />
        <br />
        Thanks in advance</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">roderickm</span><br />
        <span class="post-time small text-muted">17th February 2011 13:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"><strong>Windows 7</strong><br />
        Hello,<br />
        <br />
        FYI, the FindProcess function works on Windows 7 - even when the process was started by a different user. Thanks! ;)</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
        <span class="post-time small text-muted">17th February 2011 13:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">It won't work on x64 Windows (unless it uses WMI).<br />
        <br />
        Stu</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">brainsucker</span><br />
        <span class="post-time small text-muted">28th June 2011 09:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"><strong>nsProcess 1.6 with NSIS UNICODE support</strong><br />
        It actually works for me on Win7 x64, but I have UAC prompts disabled, mb this is the reason.<br />
        <br />
        Please find NSIS UNICODE/ANSI version attached, I'm too lazy to rebuild installer so you'll have to rename nsProcessW.dll to nsProcess.dll manually.<br />
        <br />
        It also contains new function _CloseProcess, which tries to close all windows first, waits for 3 seconds for process to exit (so it can save all data), and then terminates it.</p>
      </div>
      <hr />

      <div class="footer">
        <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
      </div>
    </div><script src="../js/highlight.pack.js" type="text/javascript">
</script> <script type="text/javascript">
//<![CDATA[
    hljs.initHighlightingOnLoad();
    //]]>
    </script>
  </div>
</body>
</html>
