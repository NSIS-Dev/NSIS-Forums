<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="uninstall: how to check if the application is running"><title>uninstall: how to check if the application is running - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">uninstall: how to check if the application is running</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=128743">uninstall: how to check if the application is running</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">spiff_c99</span><br><span class="post-time small text-muted">17th March 2003 09:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>uninstall: how to check if the application is running</strong><br>&nbsp; Hi!<br><br>Does anyone know how I can check if the application is running (or kill the task) before I can start the installer/uninstaller?<br><br>(the application is only in the system tray viewable)<br><br>regards<br>spiff_c99</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">17th March 2003 13:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That depends on your application. Usually you'll use FindWindow with your window's class name and if you get a good handle (check with IsWindow) then you'll know the application is running. To close it you'll have to send the right message using SendMessage which is usually WM_CLOSE (!include WinMessages.nsh to get it defined).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">linuxfreak</span><br><span class="post-time small text-muted">17th March 2003 16:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">hy<br><br>I have almost the same problem, but i am realy a newbie in this matter:<br><br>I have running a process and i do not want to let the installer continue until the process was ended by the user.<br><br>I think FindWindow will not work, because the application has no Window.<br><br>The installer therefore has to check if the task is running and if so the installer has to abort!<br><br>Is this possible??<br><br>I would very much appreciate it if you could make me a example and tell me exactly where i have to insert it in the NSI-File.<br><br>Thank you very much for your help.<br>regards<br>linuxfreak</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">17th March 2003 19:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Not all windows are visible. Most application do have at least one window for processing messages. If the user must end this process on its own then there must be a window that receives messages. A tray icon requires a window. The best way to know how to close the application is to ask the author of the program or just sniff the window class with a program that shows you all of the available windows, which I can't find now. Maybe I'll write one of my own later ;)<br><br>Anyway, the best way is to just ask the author, or if open source look the window creation code and see what window class is used. If it is open source and you have no idea about what to look for give me a link and I'll have a look.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">linuxfreak</span><br><span class="post-time small text-muted">18th March 2003 07:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">hy kichik<br><br>I have the information:<br><br>ClassName: ThunderRT6FormDC<br>WindowText: Share Spy<br><br>I could get this information with <a href="http://www.gena01.com/win32spy/" target="_blank">Win32Spy 0.2</a>. Maybe this can help other users to find out their ClassNames.<br><br>Here's the code i think i need:<br></p><blockquote>FindWindow $0 "ThunderRT6FormDC"<br>IntCmp $0 0 done<br>IsWindow $0 0 done<br><br>done:<br>Abort "Installation aborted!"</blockquote>But still i don't know where to paste it in the nsi-File. Also i suppose i need to insert a second "goto" in case the application is not running...<br><br>Please help me! Thank you<br><br>PS: I coded this program in Visual Basic 6.0 and I don't know how to change its ClassName. Does anyone has an idea? :confused:</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">18th March 2003 11:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><pre>
<code>
onInit
<br>  again:
<br>   FindWindow $0 "ThunderRT6FormDC" "Share Spy"
<br>   IsWindow $0 0 done
<br>      MessageBox MB_ABORTRETRYIGNORE</code>|MB_ICONSTOP "Close Share Spy..." 
<br>      IDRETRY again IDIGNORE done
<br>        Abort
<br><br>  done:
<br>&gt;FunctionEnd 
<br>&gt;

</pre>This code will try to find the window when the installer starts (.onInit) and if it finds will ask the user if to abort, ignore or retry.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br>
      <span class="post-time small text-muted">18th March 2003 11:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I think ThunderRT6FormDC is a generic VB6 name. It will close other apps too.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">18th March 2003 12:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">But this one searches for the title too. It will be better of course to get your own class name, but I have no idea how to do that in VB6 ;)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">linuxfreak</span><br>
      <span class="post-time small text-muted">18th March 2003 12:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">@kichik<br>
      perfect!! Thank you very much. This is exactly what i was looking for!!<br>
      <br>
      @Joost Verburg<br>
      Altough the solution from kichik is perfect and nothing more must be done, i don't like this generic classname. I searched the whole web for a solution, but couln't find anything. So if you have any idea, i'd be very thankful for any hint!<br>
      <br>
      THX<br>
      linuxfreak</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Ippi</span><br>
      <span class="post-time small text-muted">18th March 2003 17:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can use a named mutex. CreateMutexA will return ERROR_ALREADY_EXISTS (which equals to decimal 183) if a mutex with the same name already exists anywhere in the system. So create a mutex with a certainly unique name in your application, and when your uninstaller can not create mutex with the same name, you can be sure - your application is running.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">spiff_c99</span><br>
      <span class="post-time small text-muted">18th March 2003 17:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you very much!<br>
      I could resolve my own problem with these answers.<br>
      :up:<br>
      <br>
      @linuxfreak<br>
      You can't edit the classname in Visualbasic.<br>
      Visualbasic set the classname "ThunderRT6FormDC"<br>
      during the compilation process.<br>
      <br>
      regards<br>
      spiff_c99</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">20th March 2003 15:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        ...or just sniff the window class with a program that shows you all of the available windows, which I can't find now. Maybe I'll write one of my own later ;)
      </blockquote>Later has come :)<br>
      <br>
      This one only works on Windows NT 4, 2000 and XP because it uses special API calls that are only available on those OSes to get the process EXE name. Maybe I'll create one that works with 9x too later... Comes with source code.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Ippi</span><br>
      <span class="post-time small text-muted">20th March 2003 20:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><font size="1"><br></font></p>

      <blockquote>
        <font size="1"><i>Originally posted by kichik</i><br>
        Quote:</font>Later has come... This one only works on Windows NT 4, 2000 and XP because it uses special API calls that are only available on those OSes to get the process EXE name. Maybe I'll create one that works with 9x too later...
        <hr>

        <table cellpadding="6" cellspacing="0" border="0" width="100%">
          <tr>
            <td class="alt2">
              <hr>
              ...or just sniff the window class with a program that shows you all of the available windows, which I can't find now. Maybe I'll write one of my own later...
            </td>
          </tr>
        </table><br>
        <br>
        What about the Spy++ or WinSight32, which come respectively with Microsoft and Borland software development tools? Both work under NT and 9x Windows families.
      </blockquote>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">20th March 2003 20:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Spy++ only comes with the commercial package afaik. I don't know about WinSight32, but if it's the replacement of Spy++ for Borland then I guess it's not free either. Spy++ doesn't do what my application does, and if WinSight32 is the same then that goes for it too. This tool is designed only for this job, it's small, fast, and doesn't crash every two minutes like Spy++ (could be it just doesn't like me though :p).</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Ippi</span><br>
      <span class="post-time small text-muted">20th March 2003 20:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        Spy++ doesn't do what my application does
      </blockquote>Not sure :p<br>
      <br>

      <blockquote>
        ...and doesn't crash every two minutes like Spy++
      </blockquote>I do not remember when Spy++ was crashing last time... Maybe past year.<br>
      <br>
      You right about the commercial packages, but I think most of this forum members have one of these.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">20th March 2003 20:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Spy++ doesn't list the windows on the system and categorizes them according to their process, module and class unless it has some secret switch I don't know of.<br>
      <br>
      You'll be surprised how many of NSIS users don't have a commercial package...</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Ippi</span><br>
      <span class="post-time small text-muted">20th March 2003 21:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        Spy++ doesn't list the windows on the system and categorizes them according to their process, module and class unless it has some secret switch I don't know of.
      </blockquote>From this point of view you probably right with the exception that Spy++ DOES list the windows on the system. At the same time it can do many other wonderful things :)<br>
      <br>
      Perhaps I should take a look on Spy++ supplied with Visual Studio .NET
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">20th March 2003 21:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, that is what this tool has been created for ;)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mrtech</span><br>
      <span class="post-time small text-muted">31st August 2003 02:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've found that using the "ThunderRT6FormDC" window handle also closed the VB IDE if I was still coding, making a minor change to "ThunderRT6Main"<br>
      <br>
      Change this:<br></p>
      <pre>
<code>FindWindow $0 "ThunderRT6FormDC" # Closes All VB Windows</code>
</pre><br>
      to this, where "MR Tech Systray" is the app title used:<br>
      <pre>
<code>FindWindow $0 "ThunderRT6Main" "MR Tech Systray"  # Only closes specific app instance</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ripcurlx</span><br>
      <span class="post-time small text-muted">14th May 2007 11:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi,<br>
      <br>
      I tried to use your code snippet to check a running application but got while compiling the script following error:<br>
      <br></p>
      <pre>
<code>Invalid command: IDRETRY</code>
</pre><br>
      <br>
      complete function<br>
      <br>
      <pre>
<code><br>Function un.onInit<br> !insertmacro MUI_UNGETLANGUAGE<br> again:<br>    FindWindow $0 "ApplicationClass" "WindowName"<br>    IsWindow $0 0 done<br>      MessageBox MB_ABORTRETRYIGNORE|MB_ICONSTOP "Close Application..."<br>      IDRETRY again IDIGNORE done<br>        Abort<br><br>  done: <br>FunctionEnd</code>
</pre><br>
      <br>
      Do I have to include a special library for this?<br>
      <br>
      cheers,<br>
      <br>
      Christoph
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">engine</span><br>
      <span class="post-time small text-muted">14th May 2007 12:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi,ripcurlx.<br>
      <br>
      Error is caused by line-breaking mistake. A inattantive error? :)<br>
      <br></p>

      <blockquote>
        MessageBox MB_ABORTRETRYIGNORE|MB_ICONSTOP "Close Application." \<br>
        IDRETRY again IDIGNORE done
      </blockquote>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ripcurlx</span><br>
      <span class="post-time small text-muted">15th May 2007 09:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">thx - itÂ´s always the same ;-)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">cnepveu</span><br>
      <span class="post-time small text-muted">6th November 2007 20:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi,<br>
      <br>
      Concerning the FindWindow function, I understand it takes a class name and/or dialog caption.<br>
      <br>
      When the application you're trying to find is available in many languages, it's just not possible to use the dialog caption, unless someone would iterate through possible strings and hope to get one translation correct.<br>
      <br>
      Then for the class name, .NET class names tend to be a bit descriptive; e.g.: WindowsForms10.Window.8.app.0.378734a<br>
      Now, I don't mean to suggest that I understand the representation of the .NET class name, but something makes me believe they're tightly coupled to all sort of version and build numbers from inside .NET. Heck, maybe rebuilding the application changes the said class name.<br>
      <br>
      Given my pessimistic view of FindWindow as a reliable way of finding if a said application is running, does anyone have an alternative ... better solution?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br>
      <span class="post-time small text-muted">6th November 2007 20:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">IMHO, the cleanest way to exit a running application while uninstalling is to send a DDE message to that application that tells it to Quit<br>
      (if you're the author of the application, you might need to implement a DDE server, which is not too hard if you're using MFC)<br>
      To send the DDE message in the uninstaller, you can use my <a href="http://wiz0u.free.fr/prog/nsisDDE" target="_blank">nsisDDE plugin</a></p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br>
      <span class="post-time small text-muted">6th November 2007 20:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">you can also use it in the installer during an upgrade, to exit the application<br>
      <br>
      if your application is limited to one instance, you can also use DDE messages to bring the currently running application to the foreground<br>
      <br>
      It works perfectly well with Microsoft applications (like WinWord) that implements a DDE server.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">cnepveu</span><br>
      <span class="post-time small text-muted">6th November 2007 21:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the info Wizou,<br>
      <br>
      I had tought DDE mechanism deprecated, but it seems still supported.<br>
      <br>
      I think I'll just create a dummy window in my app through WIN32 APIs RegisterClass and CreateWindow and then try to find THAT window from the NSIS script using ... FindWindow.<br>
      :)</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>