<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="calling NetGetJoinInformation with System::Call - parameter format?" />

  <title>calling NetGetJoinInformation with System::Call - parameter format? - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">calling NetGetJoinInformation with System::Call - parameter format?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=354642">calling NetGetJoinInformation with System::Call - parameter format?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">will49</span><br />
      <span class="post-time small text-muted">16th January 2013 21:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>calling NetGetJoinInformation with System::Call - parameter format?</strong><br />
      I need to use the Win32 API "NetGetJoinInformation()", and am having problems figuring out the right syntax when using "System::Call".<br />
      <br />
      The API format is as follows:<br />
      <br /></p>
      <pre>
<code>NET_API_STATUS NetGetJoinInformation(<br />  _In_   LPCWSTR lpServer,<br />  _Out_  LPWSTR *lpNameBuffer,<br />  _Out_  PNETSETUP_JOIN_STATUS BufferType<br />);<br /><br />typedef enum _NETSETUP_JOIN_STATUS {<br />    NetSetupUnknownStatus = 0,<br />    NetSetupUnjoined,<br />    NetSetupWorkgroupName,<br />    NetSetupDomainName<br />} NETSETUP_JOIN_STATUS, *PNETSETUP_JOIN_STATUS;<br /><br /></code>
</pre><br />

      <ol style="list-style-type: decimal">
        <li>NET_API_STATUS is a DWORD<br /></li>

        <li>The first parameter can be a NULL or ""<br /></li>

        <li>The second parameter is "A Pointer to the buffer that receives the NetBIOS name of the domain or workgroup to which the computer is joined. Is allocated by the system and must be freed using the NetApiBufferFree function."</li>
      </ol><br />
      So I'm using the following to call the API:<br />
      <br />
      <pre>
<code>System::Call 'Netapi32::NetGetJoinInformation(w "", *w.r0,*i.r1)i.r2'<br /></code>
</pre><br />
      <br />
      My project runs on Win7 but crashes on XP when I call that API (it works in an VC++ app, so I know it isn't an unsupported API in XP). So I'm assuming that my parameter format for System::Call isn't 100% correct and this is causing the crash.<br />
      <br />
      Any suggestions?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">16th January 2013 22:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">System::Call 'Netapi32::NetGetJoinInformation(w "", *i.r0,*i.r1)i.r2'<br />
      System::Call '*$0(&amp;w1024.r3)' ; $0 is the address of some memory where the string is stored<br />
      ...NetApiBufferFree(ir0)<br />
      or something like that (Did not test this code). * can usually not be combined with t/m/w.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">will49</span><br />
      <span class="post-time small text-muted">16th January 2013 22:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Excellent. That fixed it! Thanks!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
