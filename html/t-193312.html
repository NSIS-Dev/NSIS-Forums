<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Change DropDown listitems" />

  <title>Change DropDown listitems - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Change DropDown listitems</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=193312">Change DropDown listitems</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DiLDoG</span><br />
      <span class="post-time small text-muted">12th September 2004 14:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Change DropDown listitems</strong><br />
      I would like to change the content of a dropdown list when a user presses a refresh button or opens the list. I checked the WinMessages.nsh but I couldnt find anything that could change them.<br />
      <br />
      So how do I change it?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">12th September 2004 20:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This is possible (I think) but I'm unfamiliar on the way to do it.<br />
      It's a new method which I've never used.<br />
      <br />
      Sorry that I can't help you, but I'm sure somebody else can help you.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">12th September 2004 23:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can read the InstallOptions or InstallOptionsEx documentations for the "NOTIFY" flag (InstallOptions) or "Notify" INI value name (InstallOptionsEx).<br />
      <br /></p>

      <blockquote>
        opens the list
      </blockquote>Only IOEx has a notification for this.<br />
      <br />
      Could you explain what do you want to change on a DropList control? Maybe I can give you some codes based on what you say...
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DiLDoG</span><br />
      <span class="post-time small text-muted">12th September 2004 23:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well the dropdown shows the available cdrom drives and the label of the disk that's currently in it, and it would be nice to be able to refresh the labels if a user puts in a new cd.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">12th September 2004 23:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">1) (INI File) You need to use the flag "NOTIFY" for the Button control (InstallOptions) or use "Notify" INI value name with value "ONCLICK" for the Button control and "ONLISTOPEN" for the DropList control (InstallOptionsEx).<br />
      <br />
      2) You need a Leave Function for your custom page so the notifications can work correctly.<br />
      <br />
      3) Instead of showing the page normally, reserve it first, pop the result of the reservation (page handle) and then show the page.<br />
      <br />
      4) To get a control handle by knowing the ID, use the following code:[code]!define IOGetDlgItem '!insertmacro IOGetDlgItem'<br />
      <br />
      !macro IOGetDlgItem Var PageHWND FieldNumber<br />
      StrCpy '${Var}' '${FieldNumber}'<br />
      IntOp '${Var}' '${Var}' + 1199<br />
      GetDlgItem '${Var}' '${PageHWND}' '${Var}'<br />
      !macroend[/quote]To use it:</p>
      <pre>
<code>${IOGetDlgItem} $Var $PageHandleVar FieldNumber</code>
</pre>Example:
      <pre>
<code>${IOGetDlgItem} $0 $PH 2; "Field 2"</code>
</pre><br />
      <br />
      5) After, you can use <i>SendMessage</i> with NSIS or System plugin to the control so you can do wharever you want to the control at run-time.<br />
      <br />
      6)... I'm working on the code right now.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">13th September 2004 00:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">6) Done! You need <a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=331&amp;instances=0,11,211" target="_blank">Detect Drives</a> function in order to use the code below:<br />
      <br />
      (Needs adaption to your code - Not totally tested)</p>
      <pre>
<code>!define MAX_PATH 260<br />!define CB_ERR -1<br />!define CB_ADDSTRING 0x0143<br />!define CB_RESETCONTENT 0x014B<br />!define CB_SETCURSEL 0x014E<br /><br />Function YourCustomPageLeave<br /><br />  ;...Some code...<br /><br />  ;TODO: Detect if the control you want was notified, then execute code below<br /><br />  # $0 = Control handle (use GetDlgItem to get this)<br /><br />  Push $1<br /><br />  System::Call `user32::SendMessageA(i r0,i ${CB_GETCURSEL},,)i .r1`<br />  StrCmp $1 ${CB_ERR} 0 +2<br />    StrCpy $1 0<br /><br />  System::Call `user32::SendMessageA(i r0,i ${CB_RESETCONTENT},,)i`<br /><br />  Push "CDROM Drives"<br />  Push $0<br />  GetFunctionAddress $0 "DetectCDROMDrives"<br />  Exch $0<br />  Call DetectDrives<br /><br />  System::Call `user32::SendMessageA(i r0,i ${CB_SETCURSEL},i r1,)i`<br /><br />  Pop $1<br /><br />  ;...Some other code...<br /><br />FunctionEnd<br /><br />Function DetectCDROMDrives<br /><br />  Push $R1<br />  System::Call `Kernel32::GetVolumeInformation(t R0,t .R1,i ${MAX_PATH},,,,,)i`<br />  StrCpy $R0 $R0 2<br />  System::Call `user32::SendMessageA(i r0,i ${CB_ADDSTRING},,t "$R1 ($R0)")i`<br />  Pop $R1<br /><br />  Push "Go"<br /><br />FunctionEnd</code>
</pre><b>EDIT #1</b>: Fixed no selection when refreshing list<br />
      <b>EDIT #2</b>: Fixed no default selection when no items are selected
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DiLDoG</span><br />
      <span class="post-time small text-muted">13th September 2004 06:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hm thanx a lot for your code, but I had the drive detection already working, just the dropdown updating at runtime was the problem. School now :( I'll try this tonight.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
