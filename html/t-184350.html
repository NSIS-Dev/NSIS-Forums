<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="mysql query and return value reaction" />

  <title>mysql query and return value reaction - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">mysql query and return value reaction</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=184350">mysql query and return value reaction</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">23rd June 2004 22:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>mysql query and return value reaction</strong><br />
      Dear Friends:<br />
      <br />
      I started creating a plug-in to my application. It should install a webapplication into the local webspace. Like most webapplications this is based on PHP and MySQL.<br />
      <br />
      The webapplication should use its own database user, so I need to get the credentials for the root user (user with global rights on the database) and use this informations to create the new database and a new user with password.<br />
      <br />
      To solve this problem, I created a CustomPage where all these values must be filled by the user. I get all values back and pipe them into the following lines:<br />
      <br /></p>
      <pre>
<code>  nsExec::Exec '$INSTDIR\DB\MySQL4\bin\mysql -u $R0 -proot -e "CREATE DATABASE $R2"' </code>
</pre><br />
      <br />
      with $R0 = root username<br />
      and $R2 = name of the database<br />
      <br />
      As you can see in this line, <b>-proot</b> symbolises the parameter -p (switch for password entry) and a symbolic password <b>root</b>. And her I have my first problem:<br />
      <br />
      If a user has no password set for his root user, neither the password nor the switch -p must be set. The CustomPage (custom.ini) is already prepared to serve a variable $R1 which could be placed as <b>-p$R1</b>, but mysql would react with an error if you trigger it with -p and provide no password. So I think the -p must be copied into $R0. How can I achieve this?<br />
      <br />
      And another question. If the user enters a wrong password mysql will return an error. Can this error be used (or captured) to return e.g. a MessageBox and switch back to the CustomPage again...?<br />
      <br />
      I hope somebody has a solution for me.<br />
      <br />
      Chris
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">24th June 2004 00:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok meantime I solved problem one, to differ between an existing and a non-existent password with the following code:<br /></p>
      <pre>
<span style="color: #007700">;-----</span><span style="color: #0000BB">ask</span><span style="color: #007700">for</span><span style="color: #0000BB">MySQLrootcredentials
<br /></span><span style="color: #007700">;</span><span style="color: #0000BB">field2</span><span style="color: #007700">=</span><span style="color: #0000BB">rootuser
<br />ReadINIStr$R0</span><span style="color: #DD0000">"$PLUGINSDIR\\mysql.ini""Field2""State"
<br /></span><span style="color: #007700">;</span><span style="color: #0000BB">field3</span><span style="color: #007700">=</span><span style="color: #0000BB">password</span><span style="color: #007700">for</span><span style="color: #0000BB">rootuser
<br />ReadINIStr$R1</span><span style="color: #DD0000">"$PLUGINSDIR\\mysql.ini""Field3""State"
<br /></span><span style="color: #007700">;-----</span><span style="color: #0000BB">ask</span><span style="color: #007700">for</span><span style="color: #0000BB">creatinga</span><span style="color: #007700">new</span><span style="color: #0000BB">MySQLUser
<br /></span><span style="color: #007700">;</span><span style="color: #0000BB">field11</span><span style="color: #007700">=</span><span style="color: #0000BB">database
<br />ReadINIStr$R2</span><span style="color: #DD0000">"$PLUGINSDIR\\mysql.ini""Field11""State"
<br /></span><span style="color: #007700">;-----</span><span style="color: #0000BB">field12</span><span style="color: #007700">=new</span><span style="color: #0000BB">databaseuser
<br />ReadINIStr$R3</span><span style="color: #DD0000">"$PLUGINSDIR\\mysql.ini""Field12""State"
<br /></span><span style="color: #007700">;-----</span><span style="color: #0000BB">field13</span><span style="color: #007700">=</span><span style="color: #0000BB">password</span><span style="color: #007700">fornew</span><span style="color: #0000BB">databaseuser
<br />ReadINIStr$R4</span><span style="color: #DD0000">"$PLUGINSDIR\\mysql.ini""Field13""State"
<br /><br /><br /></span><span style="color: #007700">;-----use</span><span style="color: #0000BB">theinformationsabovetocreatethedatabase
<br />StrCmp$R1</span><span style="color: #DD0000">""</span><span style="color: #0000BB">EmptyPwdnotEmptyPwd
<br />EmptyPwd</span><span style="color: #007700">:
<br /><br />;-----if</span><span style="color: #0000BB">nopasswordisgiven
<br /></span><span style="color: #007700">;
<br /></span><span style="color: #0000BB">nsExec</span><span style="color: #007700">::</span><span style="color: #0000BB">ExecToLog</span><span style="color: #DD0000">'$INSTDIR\\DB\\MySQL4\\bin\\mysql-u$R0-e"CREATEDATABASE$R2"'
<br /></span><span style="color: #0000BB">nsExec</span><span style="color: #007700">::</span><span style="color: #0000BB">ExecToLog</span><span style="color: #DD0000">'$INSTDIR\\DB\\MySQL4\\bin\\mysql-u$R0-e"GRANTSELECT,INSERT,UPDATE,DELETE,CREATE,INDEX,ALTER,CREATETEMPORARYTABLESON$R2.*TO$\\'</span><span style="color: #0000BB">$R3</span><span style="color: #007700">$</span><span style="color: #DD0000">'@$\\'</span><span style="color: #0000BB">localhost</span><span style="color: #007700">$</span><span style="color: #DD0000">'IDENTIFIEDBY$\\'</span><span style="color: #0000BB">$R4</span><span style="color: #007700">$</span><span style="color: #DD0000">'"'
<br /><br /></span><span style="color: #0000BB">gotoPwdDone
<br /><br />notEmptyPwd</span><span style="color: #007700">:
<br />;-----if</span><span style="color: #0000BB">thepasswdfieldisfilled</span><span style="color: #007700">...
<br />;
<br /></span><span style="color: #0000BB">nsExec</span><span style="color: #007700">::</span><span style="color: #0000BB">ExecToLog</span><span style="color: #DD0000">'$INSTDIR\\DB\\MySQL4\\bin\\mysql-u$R0-p$R1-e"CREATEDATABASE$R2"'
<br /></span><span style="color: #0000BB">nsExec</span><span style="color: #007700">::</span><span style="color: #0000BB">ExecToLog</span><span style="color: #DD0000">'$INSTDIR\\DB\\MySQL4\\bin\\mysql-u$R0-p$R1-e"GRANTSELECT,INSERT,UPDATE,DELETE,CREATE,INDEX,ALTER,CREATETEMPORARYTABLESON$R2.*TO$\\'</span><span style="color: #0000BB">$R3</span><span style="color: #007700">$</span><span style="color: #DD0000">'@$\\'</span><span style="color: #0000BB">localhost</span><span style="color: #007700">$</span><span style="color: #DD0000">'IDENTIFIEDBY$\\'</span><span style="color: #0000BB">$R4</span><span style="color: #007700">$</span><span style="color: #DD0000">'"'
<br /><br /></span><span style="color: #0000BB">PwdDone</span><span style="color: #007700">:
</span>
</pre>But there is still the problem, that the installer will finish even if the mysql database returns an error.<br />
      <br />
      Any idea to solve this?<br />
      Chris
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">24th June 2004 08:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What about mysql stdout parsing?<br />
      nsExec:<br />
      if (log &amp; 2) pushstring(szUnusedBuf);<br />
      if (log &amp; 1 &amp;&amp; *szUnusedBuf) LogMessage(szUnusedBuf);<br />
      pushstring(szRet);<br />
      <br />
      And BTW it is possible to prepare and use stdin string for DOS processes <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=181442&amp;highlight=dos+plugin" target="_blank">http://forums.winamp.com/showthread....ght=dos+plugin</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">24th June 2004 19:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thx for your reply Takhir -<br />
      <br />
      How do I use this? After the part I posted, there has to be this "see what mysql gives back" part. but I am a non-programmer living from snippets and manuals to achieve my goals ;-)<br />
      <br />
      Thx<br />
      Chris</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
