<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Vista detect installation unsuccessful" />

  <title>Vista detect installation unsuccessful - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Vista detect installation unsuccessful</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=250937">Vista detect installation unsuccessful</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Voseldop</span><br />
      <span class="post-time small text-muted">12th July 2006 12:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Vista detect installation unsuccessful</strong><br />
      After install i have Vista dialog, asking me about installation result. How can i supress this dialog?<br />
      <br />
      Do you have any solutions? What should i do in my installer?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">13th July 2006 16:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Since I managed to create a NSIS installer without dialog on Vista, are your sure you installer is working correctly and adheres to installer best practices?<br />
      <br />
      Best is just to compile a NSIS example and install and test this on Vista.<br />
      <br />
      Make sure you understand elevated rights on Vista.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">15th July 2006 22:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">In your case you need probabbly to ad a manifest for setting privileges in Vista see below:<br />
      <br />
      Creating an Application Manifest<br />
      An application manifest is an eXtensible markup language (XML) file that contains the attributes that describe the application's requirements to the operating system. The following sample shows how to use the requestedExecutionLevel element in the application manifest to ensure that the application runs with elevated privilege.<br />
      The terms in italic type should include application specific data. The version, name, and type attributes are mandatory. Otherwise, this sample is complete.<br />
      <br />
      &lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;<br />
      &lt;assembly xmlns="urn:schemas-microsoft-com:asm.v1"<br />
      manifestVersion="1.0"&gt;<br />
      &lt;assemblyIdentity version="1.0.0.0"<br />
      processorArchitecture="x86"<br />
      name="OEM.Division.Model"<br />
      type="win32"/&gt;<br />
      <br />
      &lt;description&gt;Description of your application&lt;/description&gt;<br />
      <br />
      &lt;!-- Identify the application security requirements. --&gt;<br />
      &lt;trustInfo xmlns="urn:schemas-microsoft-com:asm.v3"&gt;<br />
      &lt;security&gt;<br />
      &lt;requestedPrivileges&gt;<br />
      &lt;requestedExecutionLevel<br />
      level="requireAdministrator"<br />
      uiAccess="false"/&gt;<br />
      &lt;/requestedPrivileges&gt;<br />
      &lt;/security&gt;<br />
      &lt;/trustInfo&gt;<br />
      &lt;/assembly&gt;<br />
      <br />
      When the level of the requestedExecutionLevel element is requireAdministrator, Windows Vista asks the user to elevate the privilege level before it runs the application. The uiAccess attribute should be false, as shown in the previous example, for a printer Setup application.<br />
      For more information, see the paper titled Developer Best Practices and Guidelines for Applications in a Least Privileged Environment. The schema in the application manifest is described in the Platform SDK.<br />
      Marking the Application with the Manifest<br />
      Mark the application by using the mt.exe tool. Mt.exe is part of the platform SDK, which can be downloaded from MSDN.<br />
      For example, if the application manifest file name is oem.manifest and the application is called setup123.exe, you would use the following command to mark the application with the manifest.<br />
      mt -manifest oem.manifest -outputresource:setup123.exe;#1<br />
      <br />
      After running this mt command, Setup123.exe automatically requests permission from Windows to run with elevated rights when it is run on a Windows Vista computer.<br />
      Verifying the Change<br />
      Verify that the application was successfully marked by running the application. If the application has been marked correctly, Windows automatically displays the User Account Control dialog box to request that the application run with administrator privileges.<br />
      Marking the application also modifies the application icon by overlaying the Windows Vista shield icon on the application icon.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Clammerz</span><br />
      <span class="post-time small text-muted">27th July 2006 15:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">onad, thank you for the great information.<br />
      How do we go about doing this for the uninstaller too?<br />
      Or will modifying the setup manifest apply for the uninstaller too?<br />
      <br />
      Thank you very much for your time.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">27th July 2006 16:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Vista OS is "smart" in a way if it detects *SETUP* or *INSTALL* in a filename it expect that it needs elevated rights anyhow,<br />
      <br />
      (* is a wildcard)<br />
      <br />
      Have not tested myself by calling your un-installer<br />
      <br />
      unsetup.exe or uninstall.exe could do the trick also.<br />
      <br />
      For the rest put a request in the defect(bug) tracker where you request that this resource is added by default.<br />
      <br />
      ( Someone might complain that the (un)install will get about 500 Bytes bigger by default ;)<br />
      <br />
      Else take the NSIS source, modify by adding the resource and recompile.<br />
      <br />
      Since I have not much time (Vista Vista Work :( I can not do this for you.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">27th July 2006 17:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Oh and adding the file that is attatched here in the unins.exe folder might help.<br />
      <br />
      TIP Search the Web for info about .manifest files on XP</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">27th July 2006 18:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">for understanding Windows Vista UAC to improve your NSIS installers:<br />
      <br />
      <a href="http://www.microsoft.com/technet/windowsvista/evaluate/feat/uaprot.mspx" target="_blank">http://www.microsoft.com/technet/win...at/uaprot.mspx</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ckm</span><br />
      <span class="post-time small text-muted">8th September 2006 08:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Onad,<br />
      I followed your suggestion but could not make my unstaller work on Vista. I am not able to write the manifest file into the isntaller using MT.exe so i am shipping the manifest file also along with uninstaller.<br />
      <br />
      I renamed the unisntaller in the NSI to generate MainUni.exe (Just for testing) and used the same manifest file with one change (requestLevlel set to highestAvailable) and when i click on Mainunit.exe (unisntaller) it gives NSIS error and in the tempp file i see A~NSIS.exe to Z~NSIS.exe files. Could you please share the sample with use. Note my installer doesn't require any admin rights and i am testing mine using Standard USers.<br />
      <br />
      Thanks for any help /hints<br />
      -Chetan</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ckm</span><br />
      <span class="post-time small text-muted">8th September 2006 08:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">sorry i forgot to mention my installation works fine without any issues.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">davhunt</span><br />
      <span class="post-time small text-muted">9th October 2006 19:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I think one of the reasons the dialogue might come up saying it thinks something went wrong with the installation might be that it didn't see any changes in (HKLM or HKCU)\Software\Microsoft\Windows\CurrentVersion\Uninstall\<br />
      <br />
      As for the manifestation solution, there are some tricky things about tweaking resources. Many resource editors will obliterate any 'end of file' data - which is where your actual installation information is probably living inside your setup file.<br />
      <br />
      I think you might have more luck with CVS. Try playing with the RequestExecutionLevel option. In this case, I think:<br />
      RequestExecutionLevel user<br />
      might do the trick. [none and admin are the other two options I see in that tokens.cpp file].</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">15th October 2006 18:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        As for the manifestation solution, there are some tricky things about tweaking resources. Many resource editors will obliterate any 'end of file' data - which is where your actual installation information is probably living inside your setup file.
      </blockquote>For that you have !packhdr which is executed before the "end of file" data is written.<br />
      <br />
      The latest CVS version indeed supports embedding the manifest using RequestExecutionLevel.
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
