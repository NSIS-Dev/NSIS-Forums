<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Mb_okcancel"><title>Mb_okcancel - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Mb_okcancel</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=253356">Mb_okcancel</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Potz</span><br><span class="post-time small text-muted">15th August 2006 20:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Mb_okcancel</strong><br>is there a way to click cancel and go back to the same GUI. I thought it would do that with the code I have but it seems to be going to the next step regardless.<br><br>here is my code<br><br>MessageBox MB_OKCANCEL "If $0 is the correct IP Address click Ok, if not click Cancel and correct it." IDOK OK IDCANCEL CANCEL<br>OK:<br>DetailPrint "$0 is right"<br><br>CANCEL:<br>DetailPrint "$0 needs to be corrected"<br>Abort</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">15th August 2006 20:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">See <b>Page</b> &amp; <i>leave</i> with <b>Abort</b> instruction</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">flizebogen</span><br><span class="post-time small text-muted">15th August 2006 20:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Try to rename the labels. Maybe NSIS gets confused by using the words "OK" / "Cancel"<br><br>In your code your missing a label after Detailprint "$0 is right". This way the code after the label cancel is executed too.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comperio</span><br><span class="post-time small text-muted">16th August 2006 02:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The name of the lables should have no bearing on the outcome.<br><br>From your code, it sounds like you are asking this question after you are already installing files. (I say this because DetailPrint only works during the page instfiles.)<br><br>The better approach is to have all the required information BEFORE you start the install.<br><br>Take a look at the attached script for an example of one way you might deal with this.<br><br>Another option might be to insert a custom "confirmation page" in which you summarize all the user's choices right before they click "next" to start the install.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Potz</span><br><span class="post-time small text-muted">16th August 2006 12:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">thanks for the example, it is working for what I want it to do other than going back to my custom page if it is wrong so it is able to be changed to the correct IP address. I'll put in the code for my page so you can see what it is doing exactly.<br><br>Function ServerIP<br><br>!insertmacro MUI_HEADER_TEXT "Server IP Address Change" "This \<br>is for Clients only, if this is a server you are \<br>installing on then place localhost in the text area."<br><br>!insertmacro MUI_INSTALLOPTIONS_EXTRACT "ServerIP.ini"<br>!insertmacro MUI_INSTALLOPTIONS_DISPLAY "ServerIP.ini"<br><br>ReadINIStr $3 "$PLUGINSDIR\ServerIP.ini" "Field 5" "State"<br><br>${If} $3 == 0<br>ReadINIStr $0 "$PLUGINSDIR\ServerIP.ini" "Field 2" "State"<br><br>Push $0<br>MessageBox MB_OKCANCEL "If $0 is the correct IP address, click 'OK', otherwise, click 'Cancel'" IDOK OK IDCANCEL CANCEL<br><br>OK:<br>MessageBox MB_OK "IP OK!"<br>pop $0<br>Return<br><br>CANCEL:<br>MessageBox MB_OK "IP BAADDD!"<br>pop $0<br>abort<br><br>Push localhost #text to be replaced<br>Push $0 #replace with<br>Push all #replace all occurrences<br>Push all #replace all occurrences<br>Push "$INSTDIR\WARN\Dashboard\dashboard.properties" #file to replace in<br>Call AdvReplaceInFile<br><br>Push localhost #text to be replaced<br>Push $0 #replace with<br>Push all #replace all occurrences<br>Push all #replace all occurrences<br>Push "$INSTDIR\WARN\Dashboard\dashboard.properties_RDR_SIM" #file to replace in<br>Call AdvReplaceInFile<br><br><br>${EndIf}<br><br>FunctionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comperio</span><br><span class="post-time small text-muted">16th August 2006 16:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Couple things:<br>1) You should do your file extraction outside of your page's show function. (Probably best to do it in .onInit). Otherwise, you could slow down screen refreshes plus each time you extract, you would be replacing the page with a new copy (meaning that anything the user entered would be gone when they return to the page.)<br><br>2) Second, the verifications should be done in the page's leave function. If you then want to return back, you simply call the "abort" command in the leave function. Or if you need to go back more than one page, you might check this out:<br><a href="http://nsis.sourceforge.net/Go_to_a_NSIS_page" target="_blank">http://nsis.sourceforge.net/Go_to_a_NSIS_page</a><br><br>My example was written without MUI, but the concepts are the same--you should take a closer look to see how it's done. You might also want to review the InstallOptions documentation and check out the InstallOptions examples in the ${NSISDIR}\Examples\Modern UI</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Potz</span><br><span class="post-time small text-muted">16th August 2006 16:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">ok all I need to do is use abort. Which I thought I am doing but it dosen't seem to be working. Here is my code<br><br>Function ServerIP<br><br>!insertmacro MUI_HEADER_TEXT "Server IP Address Change" "This \<br>is for Clients only, if this is a server you are \<br>installing on then place localhost in the text area."<br><br>!insertmacro MUI_INSTALLOPTIONS_EXTRACT "ServerIP.ini"<br>!insertmacro MUI_INSTALLOPTIONS_DISPLAY "ServerIP.ini"<br><br>ReadINIStr $3 "$PLUGINSDIR\ServerIP.ini" "Field 5" "State"<br><br>${If} $3 == 0<br>ReadINIStr $0 "$PLUGINSDIR\ServerIP.ini" "Field 2" "State"<br><br>Push $0<br>MessageBox MB_OKCANCEL "If $0 is the correct IP address, click 'OK', otherwise, click 'Cancel'" IDOK OK IDCANCEL CANCEL<br><br>OK:<br>StrCpy $9 "0"<br>MessageBox MB_OK "IP OK!"<br>pop $0<br>Push localhost #text to be replaced<br>Push $0 #replace with<br>Push all #replace all occurrences<br>Push all #replace all occurrences<br>Push "$INSTDIR\WARN\Dashboard\dashboard.properties" #file to replace in<br>Call AdvReplaceInFile<br><br>Push localhost #text to be replaced<br>Push $0 #replace with<br>Push all #replace all occurrences<br>Push all #replace all occurrences<br>Push "$INSTDIR\WARN\Dashboard\dashboard.properties_RDR_SIM" #file to replace in<br>Call AdvReplaceInFile<br>Return<br><br>CANCEL:<br>StrCpy $9 "1"<br>MessageBox MB_OK "IP BAADDD!"<br>pop $0<br>abort<br><br>${EndIf}<br>${if} $9 == "1"<br><br>${endif}<br><br>FunctionEnd<br><br>I changed it to where if they click ok then the text file is changed.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">16th August 2006 16:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can't read from the INI file in the Show function.<br>You must do it in the Leave function.<br><br>Page Custom ShowFunc LeaveFunc.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Potz</span><br><span class="post-time small text-muted">16th August 2006 18:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Awesome it works now thanks everyone.<br><br>here is the working code for those who may be interested.<br><br><br>;show IP address change gui---------------------------<br>Function ServerIP<br><br>!insertmacro MUI_HEADER_TEXT "Server IP Address Change" "This \<br>is for Clients only, if this is a server you are \<br>installing on then place localhost in the text area."<br><br>!insertmacro MUI_INSTALLOPTIONS_EXTRACT "ServerIP.ini"<br>!insertmacro MUI_INSTALLOPTIONS_DISPLAY "ServerIP.ini"<br><br><br><br>FunctionEnd<br>;-----------------------------------------------------<br><br>;Change IP address------------------------------------<br>Function LeaveServerIP<br><br>ReadINIStr $3 "$PLUGINSDIR\ServerIP.ini" "Field 5" "State"<br><br>${If} $3 == 0<br>ReadINIStr $0 "$PLUGINSDIR\ServerIP.ini" "Field 2" "State"<br><br>Push $0<br>MessageBox MB_OKCANCEL "If $0 is the correct IP address, click 'OK', otherwise, click 'Cancel'" IDOK OK IDCANCEL CANCEL<br><br>OK:<br>StrCpy $9 "0"<br>pop $0<br>Push localhost #text to be replaced<br>Push $0 #replace with<br>Push all #replace all occurrences<br>Push all #replace all occurrences<br>Push "$INSTDIR\WARN\Dashboard\dashboard.properties" #file to replace in<br>Call AdvReplaceInFile<br><br>Push localhost #text to be replaced<br>Push $0 #replace with<br>Push all #replace all occurrences<br>Push all #replace all occurrences<br>Push "$INSTDIR\WARN\Dashboard\dashboard.properties_RDR_SIM" #file to replace in<br>Call AdvReplaceInFile<br>Return<br><br>CANCEL:<br>StrCpy $9 "1"<br>pop $0<br>abort<br><br>${EndIf}<br><br>FunctionEnd<br>;------------------------------------------------------</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>