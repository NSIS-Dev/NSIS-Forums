<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="AddToPath doesn't always update"><title>AddToPath doesn't always update - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">AddToPath doesn't always update</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=293663">AddToPath doesn't always update</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">jweinraub</span><br><span class="post-time small text-muted">26th June 2008 20:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>AddToPath doesn't always update</strong><br>I have customers who complain of certain errors during the post installation experience. The reason is the $INSTDIR did not get added to the path at the time of installation.<br><br>I can have them manually add it by the control panel but the installation won't. Usually they will need to reboot, reinstall, then the process works.<br><br>Any ideas to why, because I can't think of any that make sense. This happens to 1-4% of our users and all of them are solved the same way, but I can not think of a cause to WHY the path didn't add itself during the installation process.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">vc6</span><br><span class="post-time small text-muted">1st July 2008 23:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I see that no one replied, which IMHO means that this is not realy an NSIS problem but an end-user system configuration issue.<br><br>I vaguely remember a similar problem in the past, a problem that drove me crazy because nothing in the NSIS documentation could explain what I was seeing. At the end, I discovered that it was simply a matter of correctly identifying the home (install) <b>DRIVE</b>.<br><br>The typical Windows system has C: as the home drive. But that's typical, not guaranteed. In your script make sure that you are not hardcoding C: but rather using $%HOMEDRIVE%.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jimpark</span><br><span class="post-time small text-muted">2nd July 2008 14:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">We've had similar issues with AddToPath and discovered two different problems:<br><br>1. The PATH variable can be very long which may exceed the 1024 characters allotted by NSIS for a string. There is a BIG string version of NSIS which can handle up to 8192 characters which is enough to handle the PATH variable.<br><br>2. The second problem is that the AddToPath function uses two different methods to get the PATH value. The first method is via ReadEnvStr which reads the PATH variable from the current copy of the environment held by the running process. This may not accurately reflect what's in the registry. So the function may fail believing that the path already exists when in reality it only exists in the current copy of the environment held onto by the process. It could be that the uninstall that was run moments before had actually removed the path from the registry but was not able to update the path variable of an existing process like a cmd.exe window. The second read of the environment variable in the IsNT branch of the function uses the ReadRegStr to get the PATH, which only works on NT machines. Our solution was to use the ReadRegStr always and remove the call to ReadEnvStr because we knew our users had machines that ran Windows 2000 and higher.<br><br>I hope this helps.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jweinraub</span><br><span class="post-time small text-muted">26th March 2009 14:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I will have to look into #2 since my path is about 400 chars, but again it works on my PC, but sometimes it doesn't and not 100% sure why. When that happens I have to reboot, reinstall, then it works.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>