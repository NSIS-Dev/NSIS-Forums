<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Windows CE / Pocket PC Installer" />

  <title>Windows CE / Pocket PC Installer - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Windows CE / Pocket PC Installer</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=218882">Windows CE / Pocket PC Installer</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JakeChance</span><br />
      <span class="post-time small text-muted">14th June 2005 14:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Windows CE / Pocket PC Installer</strong><br />
      I was wondering if anyone had any examples of a Windows CE or Pocket PC installer. Basically a Win32 program (runs on a desktop computer) and copies its CAB files through ActiveSync to the handheld device where they are unpacked and installed. Any help on this topic would be greatly appreciated.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">14th June 2005 15:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well I only can give you a clue how I (that is me) would do it:<br />
      <br />
      1) I use Delphi <a href="http://www.borland.com/delphi/" target="_blank">http://www.borland.com/delphi/</a> to create a plugin<br />
      2) I already have created CAB compress/decompres libraries myself<br />
      3) I buy the <a href="http://www.tmssoftware.com/cecompidx.htm" target="_blank">http://www.tmssoftware.com/cecompidx.htm</a> Ssource library version TMS CETools to speed up my work...<br />
      4) Then program the rest that is left into the plugin...<br />
      <br />
      But indeed if I do this I did not need NSIS anyhow...<br />
      <br />
      NOTE: This is not the only way, only MY way.<br />
      <br />
      Success in your quest.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JakeChance</span><br />
      <span class="post-time small text-muted">14th June 2005 16:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This doesn't really help me out. Is there a way to just get NSIS to copy the file through activesync and also for it to make it unpack over there or call another exe on the CE device?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">15th June 2005 12:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you look into the source of TMS CSTools you will see all the neeed OS calls, and that will be a lot of them sadly...<br />
      <br />
      In these tools the Delphi function:<br />
      <br />
      TCEFileOperations.CopyFileWinToCE(WinFilename,CEFilename: string): Bool;<br />
      <br />
      will do what you want to do.<br />
      <br />
      Or follow this path...<br />
      <br />
      With Win32AS there is this thing called the Remote Application Programming Interface, or, RAPI. See MSDN site for some buggy documentation.<br />
      <br />
      RAPI encapsulates the old file function functionality:<br />
      <br />
      Old C function RAPI Function<br />
      CreateFile() CeCreateFile()<br />
      WriteFile() CeWriteFile()<br />
      ReadFile() CeReadFile()<br />
      etc...<br />
      <br />
      How to I call these RAPI functions..<br />
      <br />
      1. download the source files: RencherRAPI.cpp and RencherRAPI.h<br />
      2. And you could start off with converting them to NSIS via the system::whatevercall $R0 $R1 etc. etc.<br />
      3. To transfer a file from the PC to the Pocket PC, call the CopyFiletoWinCE() function.<br />
      <br />
      Whatever way, it's will be a lot of work for you to do.<br />
      <br />
      Success</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">15th June 2005 12:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The include file must get you started, or someone else for that mather. You could start to convert it to a NSIS plugin to be use by others.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JakeChance</span><br />
      <span class="post-time small text-muted">15th June 2005 20:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Thanks</strong><br />
      Hey onad,<br />
      <br />
      Thanks so much for your help but I actually figured out a way to do it without going outside of NSIS. I'll post it here so other people can read it but also on NSIS's page where I would think to look for it.<br />
      <br />
      //Make a desktop installer that only installs its contense to a Windows CE device<br />
      //You can add what ever you like to the rest of the program but these are the only steps you need to pass the CAB to ActiveSync and let it do the rest.<br />
      //Obviously fill in where it makes sense<br />
      <br />
      ;This is just a place to hold your files, it can be anything but your program name works best as the folder shouldn't already exist<br />
      InstallDir "$TEMP\YourProgram'sName"<br />
      <br />
      ;Var to hold the location of CeAppMgr.exe<br />
      var CeAppMgrLocation<br />
      <br />
      Section PathObtain<br />
      ;It can be obtained from the registry at this location always<br />
      ReadRegStr $CeAppMgrLocation HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\CEAPPMGR.EXE" ""<br />
      SectionEnd<br />
      <br />
      Section CEInstallAndDelete<br />
      ;This calls the program and passes to it the program's ini file which tells it which CAB file(s) it needs and sets it up to install<br />
      ExecWait '"$CeAppMgrLocation" "$INSTDIR\YourProgram'sINIfile.ini"' $0<br />
      ;Changes the output path so the temporary folder can be deleted<br />
      SetOutPath $TEMP<br />
      ;Remove the directory and all the files put into it<br />
      RMDir /r /REBOOTOK $INSTDIR<br />
      SectionEnd<br />
      <br />
      //Thats all you need for it to be a very clean install process<br />
      //Feel free to post any questions<br />
      //The only two things in my install are a CAB file that is referenced in the ini file I pass to CeAppMgr</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">16th June 2005 09:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Wow, have't thought of that since I'm an API geek ;), this info will be helpfull for others too, Thanks!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Kieren</span><br />
      <span class="post-time small text-muted">20th June 2005 15:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The scary thing is:<br /></p>

      <blockquote>
        var CeAppMgrLocation
      </blockquote>Is *exactly* letter for letter, capitalisation for capitalisation, the variable name I use :)<br />
      <br />
      Could I possibly ask why you've added the "$0" to the end of the ExecWait line? In my own installers, I've always used the syntax:<br />

      <blockquote>
        ExecWait '${CeAppMgrLocation} "$INSTDIR\${APPFILENAME}.ini"'
      </blockquote>(The odd variable name for the ini file is because I have to build so many PPC/Smartphone scripts that I ended up turning it into a template based on a few defines at the start :) )<br />
      <br />
      There are a few other registry keys that hold some useful information about the last/currently connected device which you might also find handy:<br />
      "HKCU\Software\Microsoft\Windows CE Services"<br />
      <br />
      "DeviceProcessorType" (DWORD value containing numeric processor ID, e.g. 2577 for ARM based devices)<br />
      "DeviceType" = "PocketPC" or "Smartphone" (String value, used in the UnsupportedPlatforms/PlatformString of the .inf file)<br />
      "DeviceVersion" = DWORD value, seems to be a mangle of the OS version and build number, but you might be able to use it to identify the OS version with a little finagling.<br />
      <br />
      These get updated whenever a Windows Mobile device connects and Activesync fires up, so it's a reasonable record of the last connected or currently connected Pocket PC.<br />
      <br />
      Kieren
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JakeChance</span><br />
      <span class="post-time small text-muted">20th June 2005 16:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Crazy coincidence on the var name but it makes sense as it holds the location of the file CeAppMgr.exe.<br />
      <br />
      I have the $0 at the end because that was in the help files and I didn't think to take it out. It actually doesn't do anything as long as the $0 var is never used.<br />
      <br />
      I kinda just jumped into the companies install project so I wasn't looking at all the possibilities of using variables but we basically have many CAB files, each one specific to the device its being installed on and ini that all have the same name. I just copied and pasted the nsi file into each device's directory and changed the device name so it makes the correct exe file. Then to make things easier I wrote a batch file to call makensis.exe with each one of these nsi files. Just a tip, if you're thinking of doing this, definitely take advantage of the fact that in a bat file you can use a replace all to change something used many times. Our example would be that I have makensis.exe /DPRODUCT_VERSION = "1.75" bla/bla/something.nsi for each nsi file so I can use the same bat file if I just replace 1.75 when we go to 2.0. In the nsi file it is just safe to put<br />
      !ifndef PRODUCT_VERSION<br />
      !define PRODUCT_VERSION = "2.0"<br />
      !endif<br />
      just so you don't have a missing variable.<br />
      <br />
      This way I just run my bat file and it does all the work of making the cabs, the exes, and moving them to our server. Isn't DOS great?</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
