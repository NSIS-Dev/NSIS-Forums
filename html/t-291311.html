<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Handling a variable number of sections?" />

  <title>Handling a variable number of sections? - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Handling a variable number of sections?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=291311">Handling a variable number of sections?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Lone Shepherd</span><br />
      <span class="post-time small text-muted">5th May 2008 15:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Handling a variable number of sections?</strong><br />
      The installer I am working on has the primary function of copying over some library files and creating a couple of scripts based on user input during the install.<br />
      <br />
      The installer will:</p>

      <ul>
        <li>Install the new version in folder <b>My App\Version 1.4</b></li>

        <li>Optionally install common library in <b>My App\Common</b></li>

        <li>Optionally remove older versions (<b>My App\Version 1.3</b>, <b>My App\Version 1.2</b>, etc).</li>
      </ul><br />
      I have the first couple down. For the second, I understand that I need to use locate in the install directory to find all the versions that are currently installed, and then put those on the components page, and then during the install do an RMDir on the Version (whatever) folder if the user wants to remove the old version.<br />
      <br />
      But I'm not quite sure how to set up displaying a variable number of sections and then handling those sections during install.<br />
      <br />
      Can anyone help walk me through this?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">5th May 2008 15:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">the number of sections is hardcoded at compile time, you could probably add x number of hidden sections and use those, or you could use something other than a components page; a custom page with checkboxes or a listview</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Lone Shepherd</span><br />
      <span class="post-time small text-muted">5th May 2008 15:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the quick reply; that seems like it would be fine. So I would have say, 5 hidden sections with a tag for each so I can address it in a function to show it?<br />
      <br />
      I'm not clear on how I would iterate on a list of X old versions to enable these sections, though.<br />
      <br />
      I'll play with it, but some sample code would be great if anyone feels the inclination.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Lone Shepherd</span><br />
      <span class="post-time small text-muted">12th May 2008 20:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Any thoughts? What I need to do:<br />
      <br />
      Create 5 hidden sections.<br />
      Search the directory <b>My App</b> for subdirs starting with "Version"<br />
      <br />
      Populate a components page with each of those found folder names (ie, the hidden sections)<br />
      <br />
      Version 1.3<br />
      Version 1.2<br />
      <br />
      etc. where checking the section / component will remove that subdir during the install.<br />
      <br />
      Any pointers, the more specific the better, appreciated.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">12th May 2008 21:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I guess you mean something like this, change the plugins with a folder name which does not exist and see the difference.<br />
      <br /></p>
      <pre>
<code>outfile test.exe<br />showinstdetails show<br />InstallDir "$PROGRAMFILES\My app"<br /><br />!include logiclib.nsh<br /><br />page components func_pre<br />page directory<br />page instfiles<br /><br />section "Main App" sec1<br /><br /> sectionin ro<br /> detailprint "now installing"<br /><br />sectionend<br /><br /><br /><br />section /o "" sec2<br /><br /> detailprint "now removing plugins directory"<br /><br />sectionend<br /><br /><br /><br />Function .oninit<br /><br />Readregstr $0 HKLM "Software\NSIS" ""<br />${Unless} ${Errors}<br />${If} ${FileExists} "$0\plugins\*.*"<br />  SectionSetText ${sec2} "Remove plugins directory"<br />  SectionGetFlags ${sec2} $0<br />  Intop $0 $0 | 1<br />  SectionSetflags ${sec2} $0<br />  Strcpy $R0 "Showpage"<br />${Endif}<br />${Endunless}<br /><br />FunctionEnd<br /><br />Function func_pre<br /><br />${IfThen} $R0 != "Showpage" ${|} Abort ${|}<br /><br />Functionend</code>
</pre>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
