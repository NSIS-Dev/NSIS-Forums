<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="[Win7] Registry data writing - no rights" />

  <title>[Win7] Registry data writing - no rights - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">[Win7] Registry data writing - no rights</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=321178">[Win7] Registry data writing - no rights</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pawel</span><br />
      <span class="post-time small text-muted">26th July 2010 21:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>[Win7] Registry data writing - no rights</strong><br />
      Hello,<br />
      I have problems with Registry and Win7 rights...<br />
      <br />
      I want to run special Windows folders by Total Commander (for example: Recycle Bin, Control Panel). To do this, I am writing proper data to registry. When user click the folder (for example: Recycle Bin) it will be open in my program - not in Windows Explorer.<br />
      The problem is, I don't have rights to write in registry key:<br />
      For example:<br />
      Recycle Bin:<br />
      Run Command:<br />
      C:\TC.exe /O /S ::{645FF040-5081-101B-9F08-00AA002F954E}<br />
      Want to add below command to this key (not exists):<br />
      HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID\{645FF040-5081-101B-9F08-00AA002F954E}\shell\open\command<br />
      <br />
      How can I set rights to this and write my data?<br />
      I tried with this command, using Accesss Plugin (no effect):<br />
      AccessControl::GrantOnRegKey "HKLM" "SOFTWARE\Classes\CLSID\{645FF040-5081-101B-9F08-00AA002F954E}" "(S-1-5-32-545)" "FullAccess"<br />
      <br />
      Is it possible to write data here? Why I cant write in this location?<br />
      (Tested on admin account with UAC enabled, with installer with admin elevation)<br />
      Thanks for any help...<br />
      -Pawel</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">26th July 2010 22:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you check the permissions you'll find only TrustedInstaller has read/write access and is the owner. To set yourself as owner you need to enable the SeTakeOwnershipPrivilege privilege for the current process user token. You should then be able to set access control. This page has a complete macro (which enables SeRestorePrivilege):<br />
      <a href="http://nsis.sourceforge.net/EnumUsersReg" target="_blank">http://nsis.sourceforge.net/EnumUsersReg</a><br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pawel</span><br />
      <span class="post-time small text-muted">27th July 2010 17:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Stu,<br />
      Sounds complicated, but I hope I can make it work.<br />
      I am sure, I will ask yet about something related to this :P<br />
      -Pawel</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
