<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="In need of help creating a custom page."><title>In need of help creating a custom page. - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">In need of help creating a custom page.</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=291952">In need of help creating a custom page.</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">JayGunter</span><br><span class="post-time small text-muted">18th May 2008 03:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>In need of help creating a custom page.</strong><br>I have written a program specifically for Windows XP. This program requires the Hibernate function in XP to be enabled. After some research on how to check if the Hibernate function is enabled there will be a "hiberfil.sys" file marked as system, hidden on the root drive.<br><br>In the installer I want to make a page where if "hiberfil.sys" does not exist it will display a page with a checkbox ensuring the user knows they are enabling Hibernate. The "Next &gt;" button can not be clickable unless the checkbox is checked. Once "Next &gt;" is clicked it will tell the installer to execute "powercfg.exe /hibernate on" during the install portion. But, if "hiberfil.sys" DOES exist, it will not display the page and will not run the command.<br><br>Here are my questions: Is this possible to create and preform the way I would like it to?<br><br>And if so, how would my script look and what would the checkbox field look like in my custom page file?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">18th May 2008 10:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><pre>
<code>!include nsDialogs.nsh<br>!include LogicLib.nsh<br><br>Name nsDialogs<br>OutFile nsDialogs.exe<br>ShowInstDetails show<br><br>XPStyle on<br><br>Var CreateDialog<br>Var Dialog<br>Var checkbox<br>Var Checkbox_State<br><br><br>Page custom nsDialogsPage nsDialogsPageLeave<br>page license<br>Page instfiles<br><br><br><br>Function nsDialogsPage<br><br>    ${If} $CreateDialog = 1<br><br>        GetDlgItem $0 $HWNDPARENT 1<br>        EnableWindow $0 $Checkbox_State<br><br>        nsDialogs::Create /NOUNLOAD 1018<br>        Pop $Dialog<br><br>        ${IfThen} $Dialog == error ${|} Abort ${|}<br><br>        ${NSD_CreateCheckbox} 60 60u 100% 10u "Enable Hibernate"<br>        Pop $Checkbox<br><br>        ${If} $Checkbox_State == ${BST_CHECKED}<br>              ${NSD_SetState} $Checkbox $Checkbox_State<br>        ${EndIf}<br><br>        ${NSD_OnClick} $Checkbox nsDialogsPageCheckboxChange<br><br>        nsDialogs::Show<br>        <br>    ${Else}<br>     <br>        Abort<br>       <br>    ${EndIf}<br><br>FunctionEnd<br><br><br>Function nsDialogsPageLeave<br><br>        ${NSD_GetState} $Checkbox $Checkbox_State<br>        MessageBox MB_OK "CheckBox State:$\n$\n[$Checkbox_State]"<br><br>FunctionEnd<br><br><br>Function nsDialogsPageCheckboxChange<br><br>        Pop $0<br><br>        ${NSD_GetState} $Checkbox $Checkbox_State<br><br>        GetDlgItem $0 $HWNDPARENT 1<br>        EnableWindow $0 $Checkbox_State<br><br>FunctionEnd<br><br><br>Function .onInit<br><br>       ReadEnvStr $0 SYSTEMDRIVE<br><br>       ${Unless} ${FileExists} "$0\hiberfil.sys"<br><br>             StrCpy $CreateDialog 1<br><br>       ${EndUnless}<br><br>       StrCpy $Checkbox_State 0<br><br>FunctionEnd<br><br><br><br><br>Section -<br><br>        ${If} $Checkbox_State = 1<br><br>             DetailPrint "Condition is true to execute powercfg.exe /hibernate"<br>        <br>        ${EndIf}<br><br>       DetailPrint "hello world"<br><br>SectionEnd</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JayGunter</span><br>
      <span class="post-time small text-muted">18th May 2008 16:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I forgot to state I am using the Modern UI and I wanting to use a custom page. Assuming you can do this with the standard UI, I believe you would be able to do this in the Modern UI, correct?<br>
      <br>
      However, the script works great with the standard UI.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br>
      <span class="post-time small text-muted">19th May 2008 00:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry, my fault...<br></p>
      <pre>
<code>!include nsDialogs.nsh<br>!include LogicLib.nsh<br><br>!include MUI2.nsh<br><br>Name nsDialogs<br>OutFile nsDialogs.exe<br>ShowInstDetails show<br><br>XPStyle on<br><br>Var CreateDialog<br>Var Dialog<br>Var checkbox<br>Var Checkbox_State<br><br><br>Page custom nsDialogsPage nsDialogsPageLeave<br>!insertmacro MUI_PAGE_LICENSE "${NSISDIR}\COPYING"<br>!insertmacro MUI_PAGE_INSTFILES<br><br>!insertmacro MUI_LANGUAGE "English"<br><br>Function nsDialogsPage<br><br>  !insertmacro MUI_HEADER_TEXT "nsDialogs custom page" "Enable Hibernate to continue"<br><br>    ${If} $CreateDialog = 1<br><br>        GetDlgItem $0 $HWNDPARENT 1<br>        EnableWindow $0 $Checkbox_State<br><br>        nsDialogs::Create /NOUNLOAD 1018<br>        Pop $Dialog<br><br>        ${IfThen} $Dialog == error ${|} Abort ${|}<br><br>        ${NSD_CreateCheckbox} 60 60u 100% 10u "Enable Hibernate"<br>        Pop $Checkbox<br><br>        ${If} $Checkbox_State == ${BST_CHECKED}<br>              ${NSD_SetState} $Checkbox $Checkbox_State<br>        ${EndIf}<br><br>        ${NSD_OnClick} $Checkbox nsDialogsPageCheckboxChange<br><br>        nsDialogs::Show<br>        <br>    ${Else}<br>     <br>        Abort<br>       <br>    ${EndIf}<br><br>FunctionEnd<br><br><br>Function nsDialogsPageLeave<br><br>        ${NSD_GetState} $Checkbox $Checkbox_State<br>        MessageBox MB_OK "CheckBox State:$\n$\n[$Checkbox_State]"<br><br>FunctionEnd<br><br><br>Function nsDialogsPageCheckboxChange<br><br>        Pop $0<br><br>        ${NSD_GetState} $Checkbox $Checkbox_State<br><br>        GetDlgItem $0 $HWNDPARENT 1<br>        EnableWindow $0 $Checkbox_State<br><br>FunctionEnd<br><br><br>Function .onInit<br><br>       ReadEnvStr $0 SYSTEMDRIVE<br><br>       ${Unless} ${FileExists} "$0\hiberfil.sys"<br><br>             StrCpy $CreateDialog 1<br><br>       ${EndUnless}<br><br>       StrCpy $Checkbox_State 0<br><br>FunctionEnd<br><br><br><br><br>Section -<br><br>        ${If} $Checkbox_State = 1<br><br>             DetailPrint "Condition is true to execute powercfg.exe /hibernate"<br>        <br>        ${EndIf}<br><br>       DetailPrint "hello world"<br><br>SectionEnd</code>
</pre>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script type="text/javascript" src="../js/highlight.pack.js" async>
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>