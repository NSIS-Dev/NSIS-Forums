<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Preserving local dates when unpacking files" />

  <title>Preserving local dates when unpacking files - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Preserving local dates when unpacking files</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=302803">Preserving local dates when unpacking files</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">daveb</span><br />
      <span class="post-time small text-muted">5th February 2009 10:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Preserving local dates when unpacking files</strong><br />
      In 2003 we patched v2.0b3 of NSIS to fix a problem we were having when unpacking files in different timezones.<br />
      Our software uses filetimes to determine if imported data is up to date, storing the filetime as data whenever a file contains information read and cached from another file.<br />
      So it is particularly important that we maintain consistency in a set of files packaged up in one timezone then unpacked in another. We do not want the system time to be converted due to timezone changes.<br />
      We made a relatively simple change, which I carefully documented and we have been using this old version successfully for the last 5 years.<br />
      <br />
      This behaviour may not be what everyone wants, but if put into NSIS as an option, it would be a potentially useful thing for others.<br />
      So I was looking at the latest version 2.43 and thought it might be a good idea to make the change in the new version, and contribute this to the project for the benefit of others. It has been working flawlessly for us for many years.<br />
      <br />
      Now trying to make the change to the new version, things are done slightly differently, and I was hoping some expert with current knowledge might be able to help with this, and perhaps put it into the project properly. I am not familiar enough with the SourceForge protocol to take this on properly and try to edit the project source myself. So I have made a start by trying to put the changes in as best I can, and zipped up the files before and after for comparison, and also included the original notes and differences.<br />
      <br />
      I have not attempted to make it optional behaviour, and one of the four changes is not done at all, but this is just the NSIS_VERSION change. This would happen anyhow if merged into the current SourceForge development properly.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th February 2009 14:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm not sure I understand the purpose of this code change. You get the file time in UTC, convert it to the current timezone and then convert it back to UTC on the client's side, assuming you two have the same timezone.<br />
      <br />
      Or were you using FAT back then? FAT returns times in local timezone, unlike NTFS which returns them in UTC. I do see now on MSDN that there's a method to always get UTC time. Open a bug report or submit a patch for it and I'll include it for the next version.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">daveb</span><br />
      <span class="post-time small text-muted">5th February 2009 23:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The problem we have is that the person packing the files is in a different timezone to the person unpacking. We were using both FAT and NTFS, but these days mostly NTFS.<br />
      <br />
      In more detail... here's an example of the problem:<br />
      Distribute files A,B,...<br />
      Because A contains some data imported from B, data in A also contains the timestamp of B internally.<br />
      eg A contains data for B and timestamp B at say "1Feb09,1300"<br />
      Pack it all up and distribute.<br />
      Now end user unpacks files and tries to use them, but NSIS when unpacking notes timezone change and creates A and B files with adjusted times. So perhaps timestamp of B is now "1Feb09,1800". This now fails to match recorded timestamp in A and application decides incorrectly that imported data needs updating.<br />
      <br />
      We used to pack and unpack files using WinZip. It saves and restores local time, so we devised a timezone invariant C++ class which serialized so that restored data for these timestamps was the same value regardless of timezone. Everything then worked fine as files got shipped across timezones in zips. But for real installs as opposed to little zip updates, we began to use NSIS, and that's when we struck this problem. As I said, we fixed it in the little customization of 2.0b3 that I attached above.<br />
      <br />
      Could be that WinZip is not doing "the right thing", but it is hard to argue the rights and wrongs here. Should the filetimes be adjusted or not? Since WinZip is so all pervasive, it would seem to me a good idea to make this behaviour optional, but if compulsory, I would rather stay in line with WinZip behaviour where if the file says time=1500 when you pack it up, it will still say 1500 when you unpack it, regardless of timezone.<br />
      <br />
      Hope this clarifies the problem anyhow... thanks.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">daveb</span><br />
      <span class="post-time small text-muted">9th February 2009 12:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Submitted as bug report as suggested above, see here:<br />
      <br />
      <a href="https://sourceforge.net/tracker/index.php?func=detail&amp;aid=2581469&amp;group_id=22049&amp;atid=373085" target="_blank">https://sourceforge.net/tracker/inde...49&amp;atid=373085</a><br />
      <br />
      (SourceForge id = 2581469)</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
