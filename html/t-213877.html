<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Using SHCTX"><title>Using SHCTX - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Using SHCTX</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=213877">Using SHCTX</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">BillTanner</span><br><span class="post-time small text-muted">22nd April 2005 18:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Using SHCTX</strong><br>Hi, I am new to NSIS. I am building some installs for some programs and found out about this, and using the HM NIS Editor. It looks great.<br><br>One thing I do not know how to do is mimic the behavior of the Windows Installer on the Directory page that presents the user with two radio buttons labeled "Everyone" and "Just Me". I can see from using the wizard that the root key is being set to default as "HKLM". I have searched through these forums and seen a description of using "SHCTX" and "SetShellVarContext", but I don't really understand how I am supposed to get that input from the user.<br><br>So my questions are:<br>1. Are there any new examples that show exactly how to get the user to input whether he or she wants to install in HKCU or HKLM, and then to set that variable?<br><br>2. Is there a way to add those two radio buttons to the MUI_PAGE_DIRECTORY dialog for the user to make that decision?<br><br>Thanks in advance for any answers or pointers to samples!<br>Bill</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">22nd April 2005 19:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You would have to add the radio buttons with Resource Hacker, and then you need to find out which one is checked in the page's Leave function using SendMessage.<br><br>You could create a variable with Var and store say 0 or 1 in it (the state from the radio buttons would be easiest) and then in the sections use StrCmp to call WriteRegStr's on HKLM or HKCU.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">BillTanner</span><br><span class="post-time small text-muted">22nd April 2005 21:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hmm, that sounds more complicated than I thought it would be. I will try to do what you suggested, thanks. Are there any samples of someone doing this? I would have to make a custom form, no? I can't just add to the MUI_PAGE_DIRECTORY form that comes with NSIS?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">22nd April 2005 21:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes you can add radio buttons with Resource Hacker like I said. Just search for the name on Google. You'd need to make a copy of Contrib\UIs\modern.exe and place the copy in the same folder as your script.<br>Then use !define MUI_UI modern.exe to use the new copy.<br><br>Open modern.exe in Resource Hacker and you need to open up dialog ID 103. Add the radio buttons, then click Compile and then Save. Make sure you give them both a unique control number. 8 and 9 haven't been used yet.<br><br>To find out if one of them is checked or not, you need to use SendMessage with the appropriate windows message. This works for check boxes, but I doubt the same message (0x00F2) will work for radio buttons as well:<br><br>FindWindow $R0 "#32770" "" $HWNDPARENT<br>GetDlgItem $R0 $R0 8<br>SendMessage $R0 0x00F2 0 0 $R0<br>StrCmp $R0 1 0 +2<br>MessageBox MB_OK "Checked!"<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br><span class="post-time small text-muted">23rd April 2005 18:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">would be much easier to add a custom page with install options.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">BillTanner</span><br><span class="post-time small text-muted">28th April 2005 22:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for the replies!<br><br>Unfortunately, this, and a couple of other little cutomizations were too difficult for me to do (I'm a newb). It seems like this should be an attribute added to the form like the other things. It was taking me a while to figure out, and because of the delay my boss ORDERED me to drop this NSIS 'stuff' and use the <a href="http://sourceforge.net/projects/wix/" target="_blank">'WiX' Windows Installer XML toolset</a> instead.<br><br>Cheers!<br>Bill</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>