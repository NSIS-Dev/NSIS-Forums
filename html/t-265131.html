<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Please help me with command reboot" />

  <title>Please help me with command reboot - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Please help me with command reboot</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=265131">Please help me with command reboot</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sunlight112</span><br />
      <span class="post-time small text-muted">5th February 2007 04:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Please help me with command reboot</strong><br />
      Hi all,<br />
      I create installer with page finish which requires user to reboot.<br />
      I also set reboot flag in section or function or .onInit. My problem is:<br />
      Sometimes, my installer reboot.<br />
      I also read many information on forum about reboot. I aslo use reboot command in my installer like this<br /></p>

      <blockquote>
        !define MUI_FINISHPAGE_RUN<br />
        !define MUI_FINISHPAGE_RUN_FUNCTION FinishShow<br />
        !insertmacro MUI_PAGE_FINISH<br />
        <br />
        Section -<br />
        SetOutPath $INSTDIR<br />
        SetRebootFlag true<br />
        SectionEnd<br />
        <br />
        Function FinishShow<br />
        IfRebootFlag 0 noreboot<br />
        Reboot<br />
        noreboot:<br />
        FunctionEnd<br />
      </blockquote>I do not understand why sometimes it reboot and sometimes it is not.<br />
      If it works, it only close some windows which I is opening<br />
      Please help me!<br />
      I try my best to find a solution but I can not.<br />
      My word is too bad if you do not understand, please tell me!<br />
      Thank a lot,
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sunlight112</span><br />
      <span class="post-time small text-muted">5th February 2007 12:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am sorry for reply myself,<br />
      I only want to make clear my ideas,<br />
      Eg:<br />
      My installer which requires user to reboot ===&gt; the first installer.<br />
      I add it in another installer====&gt;the second installer (in this case, it has the first installer)<br />
      Firstly, I run with the first installer, it reboot well.<br />
      However, I run the second installer (it has included the first), I click "REBOOT NOW", It does not work.<br />
      I only want to know how can I force my installer reboot if user check "REBOOT NOW" on finish page.<br />
      Actually, I has read carefully these information on our forum but this is not anything about my mistake<br />
      If you use to see this problem, please help me!<br />
      Your help is very useful for me!<br />
      Thank a lot,</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">5th February 2007 14:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Actually you do not need these:</p>

      <blockquote>
        <font size="1">!define MUI_FINISHPAGE_RUN<br />
        !define MUI_FINISHPAGE_RUN_FUNCTION FinishShow<br />
        !insertmacro MUI_PAGE_FINISH</font>
      </blockquote>The MUI system is intelligent enough to know when reboot is needed ;)<br />
      example:
      <pre>
<code>;NSIS Modern User Interface<br />;Welcome/Finish Page Example Script<br />;Written by Joost Verburg<br />;--------------------------------<br />;Include Modern UI<br /><br />  !include "MUI.nsh"<br /><br />;--------------------------------<br />;General<br /><br />  ;Name and file<br />  Name "Modern UI Test"<br />  OutFile "WelcomeFinish.exe"<br /><br />  ;Default installation folder<br />  InstallDir "$PROGRAMFILES\Modern UI Test"<br /><br />  ;Get installation folder from registry if available<br />  InstallDirRegKey HKCU "Software\Modern UI Test" ""<br /><br />;--------------------------------<br />;Interface Settings<br /><br />  !define MUI_ABORTWARNING<br /><br />;--------------------------------<br />;Pages<br />  !insertmacro MUI_PAGE_WELCOME<br />  !insertmacro MUI_PAGE_LICENSE "${NSISDIR}\Docs\Modern UI\License.txt"<br />  !insertmacro MUI_PAGE_COMPONENTS<br />  !insertmacro MUI_PAGE_DIRECTORY<br />  !insertmacro MUI_PAGE_INSTFILES<br />  !insertmacro MUI_PAGE_FINISH<br /><br />  !insertmacro MUI_UNPAGE_WELCOME<br />  !insertmacro MUI_UNPAGE_CONFIRM<br />  !insertmacro MUI_UNPAGE_INSTFILES<br />  !insertmacro MUI_UNPAGE_FINISH<br /><br />;--------------------------------<br />;Languages<br /><br />  !insertmacro MUI_LANGUAGE "English"<br /><br />;--------------------------------<br />;Installer Sections<br /><br />Section "Dummy Section" SecDummy<br /><br />  SetOutPath "$INSTDIR"<br /><br />  ;ADD YOUR OWN FILES HERE...<br /><br />  ;Store installation folder<br />  WriteRegStr HKCU "Software\Modern UI Test" "" $INSTDIR<br /><br />  ;Create uninstaller<br />  WriteUninstaller "$INSTDIR\Uninstall.exe"<br />  <br />  FileOpen $0 "$INSTDIR\Uninstall.exe" w<br />  Rename /REBOOTOK "$INSTDIR\Uninstall.exe" "$INSTDIR\Uninst.exe"<br />  FileClose $0<br /><br />SectionEnd<br /><br />Function .onRebootFailed<br />  MessageBox MB_OK "Reboot Failed"<br />FunctionEnd<br /><br />;--------------------------------<br />;Descriptions<br /><br />  ;Language strings<br />  LangString DESC_SecDummy ${LANG_ENGLISH} "A test section."<br /><br />  ;Assign language strings to sections<br />  !insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br />    !insertmacro MUI_DESCRIPTION_TEXT ${SecDummy} $(DESC_SecDummy)<br />  !insertmacro MUI_FUNCTION_DESCRIPTION_END<br /><br />;--------------------------------<br />;Uninstaller Section<br /><br />Section "Uninstall"<br /><br />  ;ADD YOUR OWN FILES HERE...<br /><br />  Delete "$INSTDIR\Uninstall.exe"<br /><br />  RMDir "$INSTDIR"<br /><br />  DeleteRegKey /ifempty HKCU "Software\Modern UI Test"<br /><br />SectionEnd<br /></code>
</pre><br />
      Executing this example from a wrapper you'll see that the reboot command does not actually failed, it is the wrapper which remains open thus prevents the system from reboot.<br />
      <br />
      In your case the second installer as you call it which executes the 1st installer and remains open and waiting, does not allow the system to reboot.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sunlight112</span><br />
      <span class="post-time small text-muted">6th February 2007 01:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank Red Wine a lot,<br />
      I understand your idea.<br />
      I still have one question "how can I catch the handle of radio button on the finish page if user click on "REBOOT NOW" or "REBOOT LATER"?<br />
      I am trying to require user reboot the system before using my application.<br />
      Can I find another solution to reboot system???<br />
      <br />
      Please help me!!!!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">6th February 2007 05:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        I still have one question "how can I catch the handle of radio button on the finish page if user click on "REBOOT NOW" or "REBOOT LATER"?
      </blockquote>You may try to catch if the windows shoutdown service is activated.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dandaman32</span><br />
      <span class="post-time small text-muted">6th February 2007 05:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I assume that what you mean is add code to your application that checks for the reboot and if it hasn't been performed then ask to do a reboot. I think the best way to do this would be to create a flag-file in the installation and have this file deleted on reboot:<br /></p>
      <pre>
<code>Section<br />  FileOpen $0 $INSTDIR\rebootflag w<br />    Delete /rebootok $INSTDIR\rebootflag ; this will not be deleted until the reboot because it is currently opened<br />  FileClose $0<br />SectionEnd</code>
</pre><br />
      In your application just check for the file rebootflag, and prompt for a reboot if it exists.<br />
      <br />
      -dandaman32
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">6th February 2007 12:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just discovered a plugin at wiki that might be useful for your case,<br />
      <br />
      <a href="http://nsis.sourceforge.net/ShutdownAllow_plug-in" target="_blank">http://nsis.sourceforge.net/ShutdownAllow_plug-in</a></p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
