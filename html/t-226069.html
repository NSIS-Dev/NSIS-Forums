<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Run script during uninstall"><title>Run script during uninstall - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Run script during uninstall</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=226069">Run script during uninstall</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">ewallig</span><br><span class="post-time small text-muted">15th September 2005 15:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Run script during uninstall</strong><br>Hi,<br>Using NSIS to package a home-grown app. This app allows users to add different "profiles" after the initial installation. The process of creating the profiles is not NSIS-related (homespun, HTA-based "profile creator" that can be run at any time) and creates a different desktop icon for each profile.<br><br>During an uninstall, I need to be able to remove all of the desktop icons that are created by the use of the profile creator but since the icons are not referenced in the uninstaller, the NSIS uninstall process leaves them behind (as expected).<br><br>I'd like to run a script during uninstall that searches for and deletes the desktop icons for this app - looking for some guidance on this idea...<br><br>Thanks, killer product by the way!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">15th September 2005 18:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Use Exec if you already have a script.<br>You can only delete the shortcuts if they have a fixed prefix or name style. There are no API's that I am aware of that allow you to read the target path for shortcuts.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">iceman_k</span><br><span class="post-time small text-muted">15th September 2005 18:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can probably do it using the System dll.<br><a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/programmersguide/shell_int/shell_int_programming/shortcuts/shortcut.asp" target="_blank">Here</a> is a MSDN example for working with shortcuts.<br>If you known in which directory the shortcuts are being created, you can use the FindFirst and FindNext functions to find all files with the .lnk extension. Then you can use the API to check the path of the shortcut target.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pengyou</span><br><span class="post-time small text-muted">15th September 2005 23:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>read the target path for shortcuts</blockquote>This plugin might help:<br><br><a href="http://nsis.sourceforge.net/wiki/ShellLink_plugin" target="_blank">http://nsis.sourceforge.net/wiki/ShellLink_plugin</a></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ewallig</span><br><span class="post-time small text-muted">16th September 2005 12:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for all of the responses -<br><br>I have a simple script to remove the desktop shortcuts (vbs) as they follow a standard naming pattern. I just need an example on how to run the script during an uninstall.<br><br><br>Thanks...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">16th September 2005 14:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You will probably need to use ExecShell open "file.vb"<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ewallig</span><br><span class="post-time small text-muted">16th September 2005 14:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Would I put the ExecShell command within the uninstaller section or elsewhere?<br><br><br>Thanks...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">16th September 2005 16:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, yes.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ewallig</span><br><span class="post-time small text-muted">16th September 2005 16:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">ok, I guess that was a stupid question - I'll give it a try and get back if I have problems.<br><br>Thanks again....</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ewallig</span><br><span class="post-time small text-muted">16th September 2005 20:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi again,<br><br>Ok, I tried to run the script using ExecShell - didn't have any luck running a .vbs file. I tried both directly running the file:<br><br>ExecShell open "$INSTDIR\killDesktopIcons.vbs"<br>- nothing happens<br><br>...and tried calling the scripting host like this...<br><br>ExecShell open "$SYSDIR\wscript.exe" "$INSTDIR\killDesktopIcons.vbs"<br>- nothing happens<br><br>...and this..<br><br>ExecShell open "$SYSDIR\wscript.exe" """$INSTDIR\killDesktopIcons.vbs"""<br>- error during compliation.<br><br>It's not a real big problem at the moment as I was able to wrap the script in an .exe file (runs fine now) but I may have to run scripts in the future so if you have some insight on this it would be helpful.<br><br>Thanks again....</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">17th September 2005 10:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Exec '"$SYSDIR\wscript.exe" "$INSTDIR\killDesktopIcons.vbs"'<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ewallig</span><br><span class="post-time small text-muted">17th September 2005 19:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks Stu, I'll give that a try.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>