<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="ReplaceBetween: Replace text between two markers in a file &quot;Including Markers&quot;" />

  <title>ReplaceBetween: Replace text between two markers in a file "Including Markers" - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">ReplaceBetween: Replace text between two markers in a file "Including Markers"</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=330573">ReplaceBetween: Replace text between two markers in a file "Including Markers"</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">lancelhoff</span><br />
      <span class="post-time small text-muted">13th May 2011 12:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>ReplaceBetween: Replace text between two markers in a file "Including Markers"</strong><br />
      I seem to be stumped on what should be an easy to resolve...<br />
      <br />
      Does anyone know how to manipulate Stuarts <a href="http://nsis.sourceforge.net/ReplaceBetween:_Replace_text_between_two_markers_in_a_file" target="_blank">ReplaceBetween function</a><br />
      to replace text from starting marker to ending marker "including the markers", instead of Between?<br />
      <br /></p>
      <pre>
<code>Function ReplaceBetween<br /> Exch $R0 ; file<br /> Exch<br /> Exch $R1 ; replace with<br /> Exch 2<br /> Exch $R2 ; before this (marker 2)<br /> Exch 2<br /> Exch 3<br /> Exch $R3 ; after this  (marker 1)<br /> Exch 3<br /> Push $R4 ; marker 1 len<br /> Push $R5 ; marker pos<br /> Push $R6 ; file handle<br /> Push $R7 ; temp file handle<br /> Push $R8 ; temp file name<br /> Push $R9 ; current line string<br /> Push $0 ; current chop<br /> Push $1 ; marker 1 + text<br /> Push $2 ; marker 2 + text<br /> Push $3 ; marker 2 len<br /> <br /> GetTempFileName $R8<br /> FileOpen $R7 $R8 w<br /> FileOpen $R6 $R0 r<br /> <br /> StrLen $3 $R3<br /> StrLen $R4 $R2<br /> <br /> Read1:<br />  ClearErrors<br />  FileRead $R6 $R9<br />  IfErrors Done<br />  StrCpy $R5 -1<br /> <br /> FindMarker1:<br />  IntOp $R5 $R5 + 1<br />  StrCpy $0 $R9 $3 $R5<br />  StrCmp $0 "" Write<br />  StrCmp $0 $R3 0 FindMarker1<br />   IntOp $R5 $R5 + $3<br />   StrCpy $1 $R9 $R5<br /> <br />  StrCpy $R9 $R9 "" $R5<br />  StrCpy $R5 0<br />  Goto FindMarker2<br /> <br /> Read2:<br />  ClearErrors<br />  FileRead $R6 $R9<br />  IfErrors Done<br />  StrCpy $R5 0<br /> <br /> FindMarker2:<br />  IntOp $R5 $R5 - 1<br />  StrCpy $0 $R9 $R4 $R5<br />  StrCmp $0 "" Read2<br />  StrCmp $0 $R2 0 FindMarker2<br />   StrCpy $2 $R9 "" $R5<br /> <br />   FileWrite $R7 $1$R1$2<br />   Goto Read1<br /> <br /> Write:<br />  FileWrite $R7 $R9<br />  Goto Read1<br /> <br /> Done:<br />  FileClose $R6<br />  FileClose $R7<br /> <br />  SetDetailsPrint none<br />  Delete $R0<br />  Rename $R8 $R0<br />  SetDetailsPrint both<br /> <br /> Pop $3<br /> Pop $2<br /> Pop $1<br /> Pop $0<br /> Pop $R9<br /> Pop $R8<br /> Pop $R7<br /> Pop $R6<br /> Pop $R5<br /> Pop $R4<br /> Pop $R3<br /> Pop $R2<br /> Pop $R1<br /> Pop $R0<br />FunctionEnd</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">lancelhoff</span><br />
      <span class="post-time small text-muted">13th May 2011 14:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Nevermind, I found that the Macro and function Linefind that exists in the included TextFunc.nsh, works just fine for this purpose.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">14th May 2011 07:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Please don't post large amounts of code. Use either <a href="http://pastebin.com" target="_blank">http://pastebin.com</a> or add your code as an attachment.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
