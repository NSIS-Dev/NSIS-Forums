<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Uninstaller not deleting start menu shortcuts" />

  <title>Uninstaller not deleting start menu shortcuts - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Uninstaller not deleting start menu shortcuts</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=296935">Uninstaller not deleting start menu shortcuts</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bubustoober</span><br />
      <span class="post-time small text-muted">5th September 2008 06:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Uninstaller not deleting start menu shortcuts</strong><br />
      Using NSIS 2.37, target machines experiencing the problem are running Win XP SP2 and Win Server 2003 R2 SP2. My uninstaller is not deleting the start menu shortcuts, let alone the start menu folders that were created upon installation. It does delete all the other files it originally installed - the only problem is with the start menu folders and shortcuts. I'm new to NSIS - any help would be appreciated. Thanks!<br />
      <br />
      This is my NSIS code to install the start menu shortcuts and folders (works fine):<br /></p>
      <pre>
<code>;Create start menu shortcuts in the start menu programs directory, pointing each shortcut to the appropriate executable, assigning each the RM Dash icon                <br />CreateDirectory "$SMPROGRAMS\RM Dashboard"            <br />CreateDirectory "$SMPROGRAMS\RM Dashboard\$Project_name"<br />createShortCut "$SMPROGRAMS\RM Dashboard\$Project_name\Run Administrator Console.lnk" "$SYSDIR\wscript.exe" '/B "$INSTDIR\Run Administrator Console.vbs"' "$INSTDIR\RMDash-Icon-V2.ico"<br />createShortCut "$SMPROGRAMS\RM Dashboard\$Project_name\Run Company Configuration Console.lnk" "$SYSDIR\wscript.exe" '/B "$INSTDIR\Run Company Configuration Console.vbs"' "$INSTDIR\RMDash-Icon-V2.ico"<br />createShortCut "$SMPROGRAMS\RM Dashboard\$Project_name\Run Requirement Metrics Dashboard.lnk" "$SYSDIR\wscript.exe" '/B "$INSTDIR\Run RMD.vbs"' "$INSTDIR\RMDash-Icon-V2.ico"<br />createShortCut "$SMPROGRAMS\RM Dashboard\$Project_name\Product Training Presentation.lnk" "$INSTDIR\Requirement Metrics Dashboard Training 0.52.ppt" <br />createShortCut "$SMPROGRAMS\RM Dashboard\$Project_name\Uninstall.lnk" "$INSTDIR\Uninstall.exe" </code>
</pre><br />
      <br />
      <br />
      This is my NSIS uninstaller code to remove the start menu shortcuts and folders (compiles but does not remove anything):<br />
      <pre>
<code>;Remove start menu shortcuts and folders                 <br />delete "$SMPROGRAMS\RM Dashboard\$Project_name\Run Administrator Console.lnk" <br />delete "$SMPROGRAMS\RM Dashboard\$Project_name\Run Company Configuration Console.lnk" <br />delete "$SMPROGRAMS\RM Dashboard\$Project_name\Run Requirement Metrics Dashboard.lnk" <br />delete "$SMPROGRAMS\RM Dashboard\$Project_name\Product Training Presentation.lnk" <br />delete "$SMPROGRAMS\RM Dashboard\$Project_name\Uninstall.lnk" <br />RMDir "$SMPROGRAMS\RM Dashboard\$Project_name"</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">5th September 2008 07:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">why is $Project_name a variable and not a define? Are you setting it to the same value in the uninstaller AND the installer? Try MessageBox mb_ok "$SMPROGRAMS\RM Dashboard\$Project_name\" in the uninstaller and make sure the path is correct</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bubustoober</span><br />
      <span class="post-time small text-muted">5th September 2008 22:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The message box revealed that the uninstaller is trying to delete the start menu shortcuts and folders from the *username's* start menu (e.g. C:\Documents and Settings\username\Start Menu\Programs\RM Dashboard\). However, the start menu shortcuts and folders are installed to *all users* start menu (C:\Documents and Settings\All Users\Start Menu\Programs\RM Dashboard\). I want the shortcuts and folders to be installed to all users' start menu, so how do I direct the uninstaller to delete those?<br />
      Thanks!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">6th September 2008 08:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">SetShellVarContext all</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bubustoober</span><br />
      <span class="post-time small text-muted">7th September 2008 06:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I think I'm getting bitten by having my $Project_name in a var instead of a define. I have it as a var right now because user input during the install process sets this var. However my Uninstall section needs to know this var too. How can I get my Uninstall section to know about the $Project_name var set by the user during installation? Upon closer inspection, the MessageBox was showing the path with a missing folder (note "\\" between "Dashboard" and "Run"):<br />
      <br />
      C:\Documents and Settings\All Users\Start Menu\Programs\RM Dashboard\\Run Administrator Console.lnk<br />
      <br />
      There should be a project folder between the two backslashes. That message box was driven by this code:<br />
      <br />
      MessageBox mb_ok "$SMPROGRAMS\RM Dashboard\$Project_name\Run Administrator Console.lnk"<br />
      <br />
      The $Project_name variable works in all the other sections but the Uninstall section does not appear to be able to read it. Any ideas?<br />
      <br />
      Thanks for your help!!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">7th September 2008 09:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">save it in the registry or a ini file during install and restore it in the uninstaller (it is also possible to save stuff inside the uninstaller at the end of the exe)</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
