<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Prerequisites page? [With mockup]" />

  <title>Prerequisites page? [With mockup] - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Prerequisites page? [With mockup]</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=331627">Prerequisites page? [With mockup]</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vitalyb</span><br />
      <span class="post-time small text-muted">16th June 2011 22:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Prerequisites page? [With mockup]</strong><br />
      Hi everyone,<br />
      <br />
      I'm creating a setup for an application that requires multiple prerequisites. I've seen several samples in which the installer checks for a prerequisite, but in the samples I saw, it is either a simple messagebox or installation abort in case of missing prerequisite.<br />
      <br />
      I am hoping to do something like described in the mockup above:<br />
      <br />
      <a href="http://dl.dropbox.com/u/34935/Setup.png" target="_blank">http://dl.dropbox.com/u/34935/Setup.png</a><br />
      <br />
      The user can see what prerequisites he has, he can be directed to install them via a link and he can use the refresh button to verify the state of the prerequisites after an installation and after all the prerequisites are ready, the "Refresh" buttons turns to regular "Next" button (or "Next" is always there but disabled until a certain point).<br />
      <br />
      Is there any page like that I can use? If not, how hard would be to write one that behaves that way?<br />
      <br />
      I'm open to other suggestions too, anyone has a better idea on how I can do it with regular Modern UI pages?<br />
      <br />
      Thanks!<br />
      Vitaly</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">16th June 2011 23:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        !include nsDialogs.nsh<br />
        page custom ChkPrqCreate ChkPrqLeave<br />
        <br />
        !define PRQCOUNT 2<br />
        Var Prq1<br />
        Var Prq2<br />
        <br />
        Function ChkPrqHelper<br />
        <br />
        StrCpy $0 0<br />
        <br />
        ${NSD_UnCheck} $Prq1<br />
        ${If} ${FileExists} "$temp\foo.txt"<br />
        IntOp $0 $0 + 1<br />
        ${NSD_Check} $Prq1<br />
        ${EndIf}<br />
        <br />
        ${NSD_UnCheck} $Prq2<br />
        ${If} ${FileExists} "$temp\foo2.txt"<br />
        IntOp $0 $0 + 1<br />
        ${NSD_Check} $Prq2<br />
        ${EndIf}<br />
        <br />
        GetDlgItem $1 $hwndparent 1<br />
        ${NSD_SetText} $1 "$(^NextBtn)"<br />
        ${If} $0 &lt; ${PRQCOUNT}<br />
        ${NSD_SetText} $1 "&amp;Refresh"<br />
        ${EndIf}<br />
        FunctionEnd<br />
        <br />
        Function ChkPrqLeave<br />
        ${If} $0 &lt; ${PRQCOUNT}<br />
        call ChkPrqHelper<br />
        Abort<br />
        ${EndIf}<br />
        FunctionEnd<br />
        <br />
        Function ChkPrqCreate<br />
        nsDialogs::Create 1018<br />
        Pop $0<br />
        <br />
        ${NSD_CreateCheckBox} 0 13u 100% 13u "Thing #1 ($temp\foo.txt)"<br />
        Pop $Prq1<br />
        EnableWindow $Prq1 0<br />
        <br />
        ${NSD_CreateCheckBox} 0 30u 100% 13u "Thing #2 ($temp\foo2.txt)"<br />
        Pop $Prq2<br />
        EnableWindow $Prq2 0<br />
        <br />
        <br />
        Call ChkPrqHelper<br />
        nsDialogs::Show<br />
        FunctionEnd
      </blockquote>...
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">T.Slappy</span><br />
      <span class="post-time small text-muted">17th June 2011 08:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Anders's script is fine but there should be some more components like Links.<br />
      But I am curious: what software you use to create such design?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vitalyb</span><br />
      <span class="post-time small text-muted">17th June 2011 08:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Anders' script helped me a lot. I'm rewriting it now to include links and bitmaps instead of checkboxes. I will post the result once I am done.<br />
      <br /></p>

      <blockquote>
        But I am curious: what software you use to create such design?
      </blockquote>I've used <a href="http://balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a>. It is really awesome for the task.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vitalyb</span><br />
      <span class="post-time small text-muted">19th June 2011 10:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here is a solution what for I needed with images and clickable link. Hope it helps to someone:<br />
      <br /></p>
      <pre>
<code>Function .onInit<br /><br />        InitPluginsDir<br />        File /oname=$PLUGINSDIR\x.gif "C:\Graphics\x.gif"<br />        File /oname=$PLUGINSDIR\y.gif "C:\Graphics\y.gif"<br /><br />FunctionEnd<br /><br />!define PRQCOUNT 2      <br />Var Prq1<br />Var Prq1Image<br />Var Prq2<br />Var Prq2Image<br /><br />Function ChkPrqHelper<br />        StrCpy $0 0<br /><br />        ${NSD_UnCheck} $Prq1<br />        ${If} ${FileExists} "$temp\foo.txt"<br />                IntOp $0 $0 + 1<br />                ${NSD_SetImageOLE} $Prq1 $PLUGINSDIR\y.gif $Prq1Image<br />        ${Else}<br />                ${NSD_SetImageOLE} $Prq1 $PLUGINSDIR\x.gif $Prq1Image<br />        ${EndIf}<br /><br />        ${NSD_UnCheck} $Prq2<br />        ${If} ${FileExists} "$temp\foo2.txt"<br />                IntOp $0 $0 + 1<br />                ${NSD_SetImageOLE} $Prq2 $PLUGINSDIR\y.gif $Prq2Image<br />        ${Else}<br />                ${NSD_SetImageOLE} $Prq2 $PLUGINSDIR\x.gif $Prq2Image<br />        ${EndIf}<br /><br />        GetDlgItem $1 $hwndparent 1<br />        ${NSD_SetText} $1 "$(^NextBtn)"<br />        ${If} $0 &lt; ${PRQCOUNT}<br />                ${NSD_SetText} $1 "&amp;Refresh"<br />        ${EndIf}<br />FunctionEnd<br /><br />Function ChkPrqLeave<br /><br />        ${NSD_FreeImageOLE} $Prq1Image<br />        ${NSD_FreeImageOLE} $Prq2Image  <br /><br />        ${If} $0 &lt; ${PRQCOUNT}<br />        call ChkPrqHelper<br />        Abort<br />        ${EndIf}<br />FunctionEnd<br /><br />!define CreatePrq "!insertmacro CreatePrq"<br /> <br />!macro CreatePrq Top Text LinkText LinkClickHandler PrqBitmap<br /><br />        ; Bitmap top<br />        StrCpy $1 ${Top}<br />        IntOp $1 $1 + 1<br /><br />        ${NSD_CreateBitmap} 0u $1u 100% 100% ""<br />        Pop ${PrqBitmap}<br /><br />        ${NSD_CreateLabel} 15u ${Top} 100% 10u  "${Text}"<br />        Pop $0<br />        <br />        ; LinkText Top<br />        StrCpy $1 ${Top}<br />        IntOp $1 $1 + 10<br /><br />        ${NSD_CreateLink} 15u $1u 100% 10u "${LinkText}"<br />        Pop $0<br />        ${NSD_OnClick} $0 ${LinkClickHandler}<br />        <br />!macroend<br /><br />Function OnPrq1LinkClick<br /><br />        Pop $0 ; don't forget to pop HWND of the stack<br />        ExecShell "open" "http://nsis.sf.net/1"<br /><br />FunctionEnd<br /><br />Function OnPrq2LinkClick<br /><br />        Pop $0 ; don't forget to pop HWND of the stack<br />        ExecShell "open" "http://nsis.sf.net/2"<br /><br />FunctionEnd<br /><br /><br />Function ChkPrqCreate<br />        nsDialogs::Create 1018<br />        Pop $0<br />        <br />        ${If} $0 == error<br />                Abort<br />        ${EndIf}<br />        <br />        ${CreatePrq} 15u "Thing #1 ($temp\foo.txt)" "Bla Install it from here." OnPrq1LinkClick $Prq1<br />        ${CreatePrq} 45u "Thing #1 ($temp\foo.txt)" "Bla Install it from here." OnPrq2LinkClick $Prq2<br /><br />        Call ChkPrqHelper<br />        nsDialogs::Show<br />        <br />FunctionEnd </code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TrifonovS</span><br />
      <span class="post-time small text-muted">22nd June 2011 14:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I made such dialog, based on your code. Thank you very much that you share it. Additionaly I want to skip this dialog completely if all prerequisites are ok. In that case there is no useful information for the user. So I changed the code a little bit like this:<br />
      ${If} $0 &lt; ${PRQCOUNT}<br />
      ${NSD_SetText} $1 "&amp;Refresh"<br />
      ${Else}<br />
      Abort<br />
      ${EndIf}<br />
      <br />
      Now this dialog is skipped and on a first look everything seems to be ok, but if I go back from the next dialog, the installer crashes. Why it is so? What is the correct way to reach my goal?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">22nd June 2011 17:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You need to call Abort before nsDialogs::Create or anything else.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
