<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Uninstall Only Installed Files with excluded files"><title>Uninstall Only Installed Files with excluded files - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Uninstall Only Installed Files with excluded files</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=253949">Uninstall Only Installed Files with excluded files</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Gambler</span><br><span class="post-time small text-muted">23rd August 2006 20:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Uninstall Only Installed Files with excluded files</strong><br>Hey guys,<br><br>I'm trying to uninstall only installed files, I read the examples page already, and that code seems to work fine with one exception, you can't exclude files... The wildcards work fine as they are recorded and included in the install. Then when the uninstall happens the wild card is read back in again and the files are deleted. However, you can't excude files. It is very important that I exclude certain files from being installed.<br><br>Can anybody think of an easy way to edit this code so that it will write out all the files I want excluding files I don't?<br><br><br>!macro File FilePath FileName<br>IfFileExists "$OUTDIR\${FileName}" +2<br>FileWrite $UninstLog "$OUTDIR\${FileName}$\r$\n"<br>File "${FilePath}${FileName}"<br>!macroend<br>!define File "!insertmacro File"<br><br><br>I need to use this macro with something like the following:<br>${File} /x CVS /x foo.bar "C:\myfiles\" "*.exe"<br><br>TIA -Greg</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">25th August 2006 13:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can generate the code to add the files and delete the files outside of the installer using a scripting language or even a NSIS installer. Have it search for the files using wildcards, write down a File instruction for the installation and a Delete instruction for the uninstallation and then include the results in your script using !include.<br><br>This way, you could implement whichever logic you want, including file exclusion by name.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Gambler</span><br><span class="post-time small text-muted">25th August 2006 13:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hey, thanks for the reply.<br><br>That is actually the way I decided to implement it last night, and it works great, so...good suggestion!<br><br>Thanks<br>-Greg</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">krisbg</span><br><span class="post-time small text-muted">12th March 2007 17:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi! I am trying to do uninstall only of installed files too. Here is the code in my main install section. Note that I have copied the code from the File macro directly here.<br><br>FindFirst $0 $1 "..\image\*.*"<br>loop:<br>StrCmp $1 "" done<br>IfFileExists "$OUTDIR\$1" +2<br>FileWrite $UninstLog "$OUTDIR\$1$\r$\n"<br>File "..\image\$1"<br>FindNext $0 $1<br>Goto loop<br>done:<br><br>So I get a compile-time error on the File instruction and it comes from the usage of $1 variable. If I put the name of a real file instead of it, it works. So I wonder is the problem that the File instruction is executed on compile time while all the other code like FindFirst and FindNext is executed on run time and that's why File instruction doesn't accept variables? If this is the problem how could I list all the files from a wildcard search in the uninstall log?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">12th March 2007 19:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You may want to take a look at <a href="http://nsis.sourceforge.net/Advanced_Uninstall_Log_NSIS_Header" target="_blank">Advanced Uninstall Log</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">krisbg</span><br><span class="post-time small text-muted">16th March 2007 12:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks a lot! This is what I needed. I wonder only what is the "Install.exe" for and can I live without it?:)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">16th March 2007 12:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Of course you can live without it!<br>It is there only to automate the procedure of adding the header into NSIS\include directory, the examples into NSIS\examples directory and the readme into NSIS\Docs directory ;)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">krisbg</span><br><span class="post-time small text-muted">16th March 2007 15:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks again!:)</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>