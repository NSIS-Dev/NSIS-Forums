<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Creating a Shortcut using an Environment Variable in the Target field - possible bug?"><title>Creating a Shortcut using an Environment Variable in the Target field - possible bug? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Creating a Shortcut using an Environment Variable in the Target field - possible bug?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=202074">Creating a Shortcut using an Environment Variable in the Target field - possible bug?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">EricVogl</span><br><span class="post-time small text-muted">14th December 2004 17:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Creating a Shortcut using an Environment Variable in the Target field - possible bug?</strong><br>Hi all,<br><br>I'm using an environment variable in the CreateShortCut function's second argument (target.file) as the path for the target file. The function succeeds; however, when I examine the shortcut it appends "C:\" to the beginning of the target field string.<br><br>For example, define the environment variable FOO to be "C:\some_path"<br><br>Create a script:<br>CreateShortCut "$DESKTOP\foo.lnk" "%FOO%\some_exe.exe"<br><br>This will create a shortcut on the desktop with a target field defined as<br>"C:\%FOO%\some_exe.exe"<br><br>which resolves to "C:\C:\some_path\some_exe.exe"<br><br>If I were to remove the extra "C:\", the shortcut will work fine.<br><br>To create the environment variables, I'm using the sample code found on the NSIS website. This code is working fine. The environment variables are properly being created and deleted on uninstall. I've also tried this with manually created environment variables.<br><br>I've tried to work around this problem by setting the "Start In" folder (ie. the working directory) to the directory defined in %FOO%.<br><br>SetOutPath "%FOO%"<br>CreateShortCut "$DESKTOP\foo.lnk" "some_exe.exe"<br><br>However, the shortcut fails to create at run time, presumably because it is not a fully qualified path name (even though the working directory is defined to the directory where the program resides).<br><br>Any idea why the extra "C:\" is being appended? I looked quickly through the NSIS source code and I can't see where NSIS is possibly appending this. I assume it must be Windows doing this when the ShellLink object is passed parameters in exec.c line 990 (NSIS v2.01). Maybe the code should be setting the working directory before it is setting the path (then maybe the workaround would work)?<br><br>Thanks for any help,<br>Eric</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">14th December 2004 19:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It seems to do it when it the environment variable can't be found. Make sure you set the variable for the current process too. There is an Archive page with such an example.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">EricVogl</span><br><span class="post-time small text-muted">14th December 2004 19:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks kichik. That did the trick. Strange behavior for the failure case though.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>