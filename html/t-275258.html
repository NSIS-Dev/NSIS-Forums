<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="General Query for all - Removing Files on Uninstall - What method do you use?"><title>General Query for all - Removing Files on Uninstall - What method do you use? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">General Query for all - Removing Files on Uninstall - What method do you use?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=275258">General Query for all - Removing Files on Uninstall - What method do you use?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Sheik</span><br><span class="post-time small text-muted">2nd August 2007 02:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>General Query for all - Removing Files on Uninstall - What method do you use?</strong><br>Hi all,<br><br>I am just curious, what method do people here use for removing their installed files during the uninstaller?<br><br>Especially for very LARGE installers where there are too many files to manually type in each file name in the uninstall method.<br><br>As I see it, there are 3 different options.<br><br>1) No special "logging" makensis.exe build.<br>Just "RMDIR /r" and run with it.<br><br>2) No special "logging" makensis.exe build.<br>Instead use the "Advanced Uninstall Log NSIS Header" and have it log during install, and uninstall based on that.<br><a href="http://nsis.sourceforge.net/Advanced_Uninstall_Log_NSIS_Header" target="_blank">http://nsis.sourceforge.net/Advanced...og_NSIS_Header</a><br><br>3) Use the special "logging" makensis.exe build.<br>Parse the log to do the file removal on uninstall.<br><a href="http://nsis.sourceforge.net/Uninstall_from_NSIS_log" target="_blank">http://nsis.sourceforge.net/Uninstall_from_NSIS_log</a><br><br><br>What leads me to ask this question, is I came from the WISE world, where the install log is fundamental to the uninstall procedure.<br><br>I actually started to get liking the NSIS method of not logging the install, but just go ahead and blow away your created directories as you see fit, and have released a few of my Installers with this.<br><br>But I have gotten a complaint that this is a HORRIBLE idea, in that if your customer has created important files underneath your directory, we are indiscriminately blowing away things that shouldn't be blown away.<br><br>They have a point.<br><br>So this leads me to asking the rest of the NSIS world...<br><br>Has anyone else ran into the same problem?<br>What did you decide to do?<br>Did I miss any options?<br><br>Thanks!<br>Scott</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">2nd August 2007 06:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Obviously, RmDir /r should be used with caution.<br>Recently discussed here in forum a case where accidentally removed the entire Start Menu on a system where the instruction implemented improperly.<br><br>My choice (that's obvious too) is advanced uninstall log, because I wrote it ;)<br><br>BTW if someone of you programmers could somehow fix that issue in which throws the list several times, I believe advanced uninstall log will become more useful tool.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">2nd August 2007 11:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can still use RMDir /r but you should do some strenuous validation on the uninstall path first:<br><br><a href="http://nsis.sourceforge.net/Validating_%24INSTDIR_before_uninstall" target="_blank">http://nsis.sourceforge.net/Validati...fore_uninstall</a><br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sheik</span><br><span class="post-time small text-muted">2nd August 2007 16:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Red Wine,<br><br>The Installer that I am concerned with has a HUGE amount of files and directories that get installed.<br><br>We are talking 13,000+ files, and 800+ directories.<br><br>rmdir /r (with validation of the top level directory) is very fast and efficient.<br><br>But wow, is it dangerous, if someone uses anything under that top level directory for their own purposes.<br><br>I was thinking about trying the "Advanced Uninstall Log", but I really worry about the time/efficiency of it...<br><br>Throwing the list of 13000+ files multiple times seems like a very time consuming task...<br><br>The "special" logging build of makensis.exe is interesting, but I do not like the fact that it is "special"...<br><br>I would hate to invest time/energy into writing code to it, only to have the feature "go away" in the future.<br><br>I wonder if anyone has ever written a plugin to NSIS that does what the "special" build does...<br><br>Or maybe the "special" logging feature could move from a compile time option to be a run time option?<br><br>Or maybe there is a better, yet undiscovered way to do this?<br><br>Thanks!<br>Scott</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">2nd August 2007 16:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">All the special build does it generate a log file at run time. The reason it is 'special' is because the majority of people do not need logging support and the overheard that it induces. The script that uninstalls from the log simply parses it for File instructions, so that may be your best route. Otherwise, use RMDir /r and check the link that I provided. As long as you check a prominent file is located in $INSTDIR (among other checks) before you call RMDir /r then everything should be ok.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sheik</span><br><span class="post-time small text-muted">2nd August 2007 16:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Afrow UK,<br><br>Thanks for your responses.<br><br>What about the problem where the user might have added their own files or directories inside of $INSTDIR after the Installer was run?<br><br>RMDir /r on uninstall would blow away these extra files by mistake!<br><br>Scott</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">2nd August 2007 16:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes it would.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">2nd August 2007 17:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If you don't want to delete files using one of these scripts then you can instead write an NSIS installer which loops through all your files (i.e. using RecFind or Locate) and writes your NSIS code for you.<br><a href="http://nsis.sourceforge.net/Invoking_NSIS_run-time_commands_on_compile-time" target="_blank">http://nsis.sourceforge.net/Invoking...n_compile-time</a><br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">2nd August 2007 17:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>Throwing the list of 13000+ files multiple times seems like a very time consuming task...</blockquote>Using advanced uninstall log when installing/uninstalling such a huge amount of files/directories it is NOT a very time consuming task because it does not need to throw the list more than once.<br>Time consuming task might be noticed depending on target machine, and only in the case where the target installation directory contains such a huge amount of files/directories, either prior the installation, or added later by the users.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">helix400</span><br><span class="post-time small text-muted">2nd August 2007 20:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I do the RMDIR /r option.<br><br>I do this because of our auto updates. If we add new files during an update, I don't want to get into the hairy details of adding to the log to keep it perfect. I find it much simpler to simply uninstall an entire folder.<br><br>I also don't yet validate to make sure the folder I'm deleting isn't, say, the Program Files folder. :O One of these days, I'm going to have to put that in.<br><br>As for user added files, those should generally happen under an individual user profile or all users profile. And it's generally fine to not touch those files during the uninstall.<br><br>For example, long ago, we used to store user setting files in a Program Files folder. I did this because i thought it was normal practice, and because it let me delete every trace of our app on the users computer. But with user permissions and especially Windows Vista enforcing it, storing settings and such in Program Files is a very bad idea.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>