<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Particular JRE version"><title>Particular JRE version - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Particular JRE version</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=275829">Particular JRE version</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">James4563</span><br><span class="post-time small text-muted">13th August 2007 10:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Particular JRE version</strong><br>Hello all,<br><br>I have just recenlty found this example of checking if JRE is installed and then if it is out of date with the included version to update it or just install the JRE.<br><br>Now, im not very good with NSIS (yet) still learning. I was just wondering how difficult it would be to modify this script so that it will check for a particular version of java. (j2re-1_4_2_01-windows-i586.exe is the exact JRE installer we use)<br><br>Could someone lead me in the right direction with this...<br><br>Here is the script:<br><br></p><pre>
<code><br>; Taken from <a href="http://nsis.sourceforge.net/Simple_installer_with_JRE_check" target="_blank">http://nsis.sourceforge.net/Simple_i...with_JRE_check</a> by weebib<br>; Use it as you desire.<br> <br>; Credit given to so many people of the NSIS forum.<br> <br>!define AppName "Your Application"<br>!define AppVersion "1.0"<br>!define ShortName "YourApp"<br>!define JRE_VERSION "1.4.1"<br>!define Vendor "YourCompany"<br> <br>!include "MUI.nsh"<br>!include "Sections.nsh"<br> <br>Var InstallJRE<br>Var JREPath<br> <br> <br>;--------------------------------<br>;Configuration<br> <br>  ;General<br>  Name "${AppName}"<br>  OutFile "setup.exe"<br> <br>  ;Folder selection page<br>  InstallDir "$PROGRAMFILES\${SHORTNAME}"<br>  <br>  ;Get install folder from registry if available<br>  InstallDirRegKey HKLM "SOFTWARE\${Vendor}\${ShortName}" ""<br> <br>; Installation types<br>;InstType "full"    ; Uncomment if you want Installation types<br> <br>;--------------------------------<br>;Pages<br> <br>  ; License page<br>  ;!insertmacro MUI_PAGE_LICENSE "${NSISDIR}\Contrib\Modern UI\License.txt"<br>  ; This page checks for JRE. It displays a dialog based on JRE.ini if it needs to install JRE<br>  ; Otherwise you won't see it.<br>  Page custom CheckInstalledJRE<br> <br>  ; Define headers for the 'Java installation successfully' page<br>  !define MUI_INSTFILESPAGE_FINISHHEADER_TEXT "Java installation complete"<br>  !define MUI_PAGE_HEADER_TEXT "Installing Java runtime"<br>  !define MUI_PAGE_HEADER_SUBTEXT "Please wait while we install the Java runtime"<br>  !define MUI_INSTFILESPAGE_FINISHHEADER_SUBTEXT "Java runtime installed successfully."<br>  !insertmacro MUI_PAGE_INSTFILES<br>  !define MUI_INSTFILESPAGE_FINISHHEADER_TEXT "Installation complete"<br>  !define MUI_PAGE_HEADER_TEXT "Installing"<br>  !define MUI_PAGE_HEADER_SUBTEXT "Please wait while ${AppName} is being installed."<br>; Uncomment the next line if you want optional components to be selectable<br>;  !insertmacro MUI_PAGE_COMPONENTS<br>  !define MUI_PAGE_CUSTOMFUNCTION_PRE myPreInstfiles<br>  !define MUI_PAGE_CUSTOMFUNCTION_LEAVE RestoreSections<br>  !insertmacro MUI_PAGE_DIRECTORY<br>  !insertmacro MUI_PAGE_INSTFILES<br>  !insertmacro MUI_PAGE_FINISH<br>  !insertmacro MUI_UNPAGE_CONFIRM<br>  !insertmacro MUI_UNPAGE_INSTFILES<br> <br>;--------------------------------<br>;Modern UI Configuration<br> <br>  !define MUI_ABORTWARNING<br> <br>;--------------------------------<br>;Languages<br> <br>  !insertmacro MUI_LANGUAGE "English"<br> <br>;--------------------------------<br>;Language Strings<br> <br>  ;Description<br>  LangString DESC_SecAppFiles ${LANG_ENGLISH} "Application files copy"<br> <br>  ;Header<br>  LangString TEXT_JRE_TITLE ${LANG_ENGLISH} "Java Runtime Environment"<br>  LangString TEXT_JRE_SUBTITLE ${LANG_ENGLISH} "Installation"<br>  LangString TEXT_PRODVER_TITLE ${LANG_ENGLISH} "Installed version of ${AppName}"<br>  LangString TEXT_PRODVER_SUBTITLE ${LANG_ENGLISH} "Installation cancelled"<br> <br>;--------------------------------<br>;Reserve Files<br> <br>  ;Only useful for BZIP2 compression<br> <br> <br>  ReserveFile "jre.ini"<br>  !insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br> <br>;--------------------------------<br>;Installer Sections<br> <br>Section -installjre jre<br>  Push $0<br>  Push $1<br> <br>;  MessageBox MB_OK "Inside JRE Section"<br>  Strcmp $InstallJRE "yes" InstallJRE JREPathStorage<br>  DetailPrint "Starting the JRE installation"<br>InstallJRE:<br>  File /oname=$TEMP\jre_setup.exe j2re-setup.exe<br>  MessageBox MB_OK "Installing JRE"<br>  DetailPrint "Launching JRE setup"<br>  ;ExecWait "$TEMP\jre_setup.exe /S" $0<br>  ; The silent install /S does not work for installing the JRE, sun has documentation on the <br>  ; parameters needed.  I spent about 2 hours hammering my head against the table until it worked<br>  ExecWait '"$TEMP\jre_setup.exe" /s /v\"/qn REBOOT=Suppress JAVAUPDATE=0 WEBSTARTICON=0\"' $0<br>  DetailPrint "Setup finished"<br>  Delete "$TEMP\jre_setup.exe"<br>  StrCmp $0 "0" InstallVerif 0<br>  Push "The JRE setup has been abnormally interrupted."<br>  Goto ExitInstallJRE<br> <br>InstallVerif:<br>  DetailPrint "Checking the JRE Setup's outcome"<br>;  MessageBox MB_OK "Checking JRE outcome"<br>  Push "${JRE_VERSION}"<br>  Call DetectJRE  <br>  Pop $0      ; DetectJRE's return value<br>  StrCmp $0 "0" ExitInstallJRE 0<br>  StrCmp $0 "-1" ExitInstallJRE 0<br>  Goto JavaExeVerif<br>  Push "The JRE setup failed"<br>  Goto ExitInstallJRE<br> <br>JavaExeVerif:<br>  IfFileExists $0 JREPathStorage 0<br>  Push "The following file : $0, cannot be found."<br>  Goto ExitInstallJRE<br>  <br>JREPathStorage:<br>;  MessageBox MB_OK "Path Storage"<br>  !insertmacro MUI_INSTALLOPTIONS_WRITE "jre.ini" "UserDefinedSection" "JREPath" $1<br>  StrCpy $JREPath $0<br>  Goto End<br>  <br>ExitInstallJRE:<br>  Pop $1<br>  MessageBox MB_OK "The setup is about to be interrupted for the following reason : $1"<br>  Pop $1    ; Restore $1<br>  Pop $0    ; Restore $0<br>  Abort<br>End:<br>  Pop $1    ; Restore $1<br>  Pop $0    ; Restore $0<br>SectionEnd<br> <br>Section "Installation of ${AppName}" SecAppFiles<br>  SectionIn 1 RO    ; Full install, cannot be unselected<br>            ; If you add more sections be sure to add them here as well<br>  ;SetOutPath $INSTDIR<br>  ;File /r "stream\"<br>  ; If you need the path to JRE, you can either get it here for from $JREPath<br>  ;  !insertmacro MUI_INSTALLOPTIONS_READ $0 "jre.ini" "UserDefinedSection" "JREPath"<br>  ;  MessageBox MB_OK "JRE Read: $0"<br>  ;Store install folder<br>  WriteRegStr HKLM "SOFTWARE\${Vendor}\${ShortName}" "" $INSTDIR<br> <br>  WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${ShortName}" "DisplayName" "${AppName}"<br>  WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${ShortName}" "UninstallString" '"$INSTDIR\uninstall.exe"'<br>  WriteRegDWORD HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${ShortName}" "NoModify" "1"<br>  WriteRegDWORD HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${ShortName}" "NoRepair" "1"<br>  <br>  ;Create uninstaller<br>  WriteUninstaller "$INSTDIR\Uninstall.exe"<br> <br>SectionEnd<br> <br> <br>Section "Start menu shortcuts" SecCreateShortcut<br>  SectionIn 1   ; Can be unselected<br>  CreateDirectory "$SMPROGRAMS\${AppName}"<br>  CreateShortCut "$SMPROGRAMS\${AppName}\Uninstall.lnk" "$INSTDIR\uninstall.exe" "" "$INSTDIR\uninstall.exe" 0<br>;  CreateShortCut "$SMPROGRAMS\${AppName}\${AppName}.lnk" "$INSTDIR\${AppName}.exe" "" "$INSTDIR\${AppName}.exe" 0<br>; Etc<br>SectionEnd<br> <br>;--------------------------------<br>;Descriptions<br> <br>!insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br>  !insertmacro MUI_DESCRIPTION_TEXT ${SecAppFiles} $(DESC_SecAppFiles)<br>!insertmacro MUI_FUNCTION_DESCRIPTION_END<br> <br>;--------------------------------<br>;Installer Functions<br> <br>Function .onInit<br> <br>  ;Extract InstallOptions INI Files<br>  !insertmacro MUI_INSTALLOPTIONS_EXTRACT "jre.ini"<br>  Call SetupSections<br> <br>FunctionEnd<br> <br>Function myPreInstfiles<br> <br>  Call RestoreSections<br>  SetAutoClose true<br>  <br>FunctionEnd<br> <br>Function CheckInstalledJRE<br>  MessageBox MB_OK "Checking Installed JRE Version"<br>  Push "${JRE_VERSION}"<br>  Call DetectJRE<br>  Messagebox MB_OK "Done checking JRE version"<br>  Exch $0   ; Get return value from stack<br>  StrCmp $0 "0" NoFound<br>  StrCmp $0 "-1" FoundOld<br>  Goto JREAlreadyInstalled<br>  <br>FoundOld:<br>  MessageBox MB_OK "Old JRE found"<br>  !insertmacro MUI_INSTALLOPTIONS_WRITE "jre.ini" "Field 1" "Text" "${AppName} requires a more recent version of the Java Runtime Environment than the one found on your computer. The installation of JRE ${JRE_VERSION} will start."<br>  !insertmacro MUI_HEADER_TEXT "$(TEXT_JRE_TITLE)" "$(TEXT_JRE_SUBTITLE)"<br>  !insertmacro MUI_INSTALLOPTIONS_DISPLAY_RETURN "jre.ini"<br>  Goto MustInstallJRE<br> <br>NoFound:<br>  MessageBox MB_OK "JRE not found"<br>  !insertmacro MUI_INSTALLOPTIONS_WRITE "jre.ini" "Field 1" "Text" "No Java Runtime Environment could be found on your computer. The installation of JRE v${JRE_VERSION} will start."<br>  !insertmacro MUI_HEADER_TEXT "$(TEXT_JRE_TITLE)" "$(TEXT_JRE_SUBTITLE)"<br>  !insertmacro MUI_INSTALLOPTIONS_DISPLAY_RETURN "jre.ini"<br>  Goto MustInstallJRE<br> <br>MustInstallJRE:<br>  Exch $0   ; $0 now has the installoptions page return value<br>  ; Do something with return value here<br>  Pop $0    ; Restore $0<br>  StrCpy $InstallJRE "yes"<br>  Return<br>  <br>JREAlreadyInstalled:<br>;  MessageBox MB_OK "No download: ${TEMP2}"<br>  MessageBox MB_OK "JRE already installed"<br>  StrCpy $InstallJRE "no"<br>  !insertmacro MUI_INSTALLOPTIONS_WRITE "jre.ini" "UserDefinedSection" "JREPath" $JREPATH<br>  Pop $0        ; Restore $0<br>  Return<br> <br>FunctionEnd<br> <br>; Returns: 0 - JRE not found. -1 - JRE found but too old. Otherwise - Path to JAVA EXE<br> <br>; DetectJRE. Version requested is on the stack.<br>; Returns (on stack)    "0" on failure (java too old or not installed), otherwise path to java interpreter<br>; Stack value will be overwritten!<br> <br>Function DetectJRE<br>  Exch $0   ; Get version requested  <br>        ; Now the previous value of $0 is on the stack, and the asked for version of JDK is in $0<br>  Push $1   ; $1 = Java version string (ie 1.5.0)<br>  Push $2   ; $2 = Javahome<br>  Push $3   ; $3 and $4 are used for checking the major/minor version of java<br>  Push $4<br>  MessageBox MB_OK "Detecting JRE"<br>  ReadRegStr $1 HKLM "SOFTWARE\JavaSoft\Java Runtime Environment" "CurrentVersion"<br>  MessageBox MB_OK "Read : $1"<br>  StrCmp $1 "" DetectTry2<br>  ReadRegStr $2 HKLM "SOFTWARE\JavaSoft\Java Runtime Environment\$1" "JavaHome"<br>  MessageBox MB_OK "Read 3: $2"<br>  StrCmp $2 "" DetectTry2<br>  Goto GetJRE<br> <br>DetectTry2:<br>  ReadRegStr $1 HKLM "SOFTWARE\JavaSoft\Java Development Kit" "CurrentVersion"<br>  MessageBox MB_OK "Detect Read : $1"<br>  StrCmp $1 "" NoFound<br>  ReadRegStr $2 HKLM "SOFTWARE\JavaSoft\Java Development Kit\$1" "JavaHome"<br>  MessageBox MB_OK "Detect Read 3: $2"<br>  StrCmp $2 "" NoFound<br> <br>GetJRE:<br>; $0 = version requested. $1 = version found. $2 = javaHome<br>  MessageBox MB_OK "Getting JRE"<br>  IfFileExists "$2\bin\java.exe" 0 NoFound<br>  StrCpy $3 $0 1            ; Get major version. Example: $1 = 1.5.0, now $3 = 1<br>  StrCpy $4 $1 1            ; $3 = major version requested, $4 = major version found<br>  MessageBox MB_OK "Want $3 , found $4"<br>  IntCmp $4 $3 0 FoundOld FoundNew<br>  StrCpy $3 $0 1 2<br>  StrCpy $4 $1 1 2          ; Same as above. $3 is minor version requested, $4 is minor version installed<br>  MessageBox MB_OK "Want $3 , found $4" <br>  IntCmp $4 $3 FoundNew FoundOld FoundNew<br> <br>NoFound:<br>  MessageBox MB_OK "JRE not found"<br>  Push "0"<br>  Goto DetectJREEnd<br> <br>FoundOld:<br>  MessageBox MB_OK "JRE too old: $3 is older than $4"<br>;  Push ${TEMP2}<br>  Push "-1"<br>  Goto DetectJREEnd  <br>FoundNew:<br>  MessageBox MB_OK "JRE is new: $3 is newer than $4"<br> <br>  Push "$2\bin\java.exe"<br>;  Push "OK"<br>;  Return<br>   Goto DetectJREEnd<br>DetectJREEnd:<br>    ; Top of stack is return value, then r4,r3,r2,r1<br>    Exch    ; =&gt; r4,rv,r3,r2,r1,r0<br>    Pop $4  ; =&gt; rv,r3,r2,r1r,r0<br>    Exch    ; =&gt; r3,rv,r2,r1,r0<br>    Pop $3  ; =&gt; rv,r2,r1,r0<br>    Exch    ; =&gt; r2,rv,r1,r0<br>    Pop $2  ; =&gt; rv,r1,r0<br>    Exch    ; =&gt; r1,rv,r0<br>    Pop $1  ; =&gt; rv,r0<br>    Exch    ; =&gt; r0,rv<br>    Pop $0  ; =&gt; rv <br>FunctionEnd<br> <br>Function RestoreSections<br>  !insertmacro UnselectSection ${jre}<br>  !insertmacro SelectSection ${SecAppFiles}<br>  !insertmacro SelectSection ${SecCreateShortcut}<br>  <br>FunctionEnd<br> <br>Function SetupSections<br>  !insertmacro SelectSection ${jre}<br>  !insertmacro UnselectSection ${SecAppFiles}<br>  !insertmacro UnselectSection ${SecCreateShortcut}<br>FunctionEnd<br> <br>;--------------------------------<br>;Uninstaller Section<br> <br>Section "Uninstall"<br> <br>  ; remove registry keys<br>  DeleteRegKey HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${ShortName}"<br>  DeleteRegKey HKLM  "SOFTWARE\${Vendor}\${AppName}"<br>  ; remove shortcuts, if any.<br>  Delete "$SMPROGRAMS\${AppName}\*.*"<br>  ; remove files<br>  RMDir /r "$INSTDIR"<br> <br>SectionEnd<br></code>
</pre><br>
      <br>
      Thanks in advance for any help at all :)
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Backland</span><br>
      <span class="post-time small text-muted">13th August 2007 18:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Looking over the script, it seems the minimum required version is set at the top of the script with:<br>
      <br>
      !define JRE_VERSION "1.4.1"<br>
      <br>
      so you may try changing that to 1.4.2 to force that as the required minimum.<br>
      <br>
      As for the JRE that will be installed, you should be able to swap the 'j2re-setup.exe' file with your own one.<br>
      <br>
      PS. please include long scripts as an attachment next time.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>