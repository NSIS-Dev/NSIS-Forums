<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Help please" />

  <title>Help please - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Help please</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=273607">Help please</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">trust11</span><br />
      <span class="post-time small text-muted">29th June 2007 15:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Help please</strong><br />
      Hi all<br />
      I have a lot of things that i dont know how to do. Can you help me please?<br />
      <br />
      1.- I have to install SQL Server Express 2005 SP2 (ive done it) but only if there isnt any version of SQL Server installed.<br />
      <br />
      This is how i install SQL Server:<br />
      <br />
      File "SQLEXPR.EXE"<br />
      <br />
      ExecWait '$INSTDIR\SQLEXPR_ESN.EXE /qb ADDLOCAL=SQL_Engine INSTANCENAME=MSSQLSERVER SECURITYMODE=SQL SAPWD=onix SQLCOLLATION="Modern_Spanish_CI_AS" SQLAUTOSTART=1 DISABLENETWORKPROTOCOLS=0'<br />
      <br />
      2.- When the user uninstalls the program i should uninstall SQL Server and the framework. How can i do it ?<br />
      <br />
      This is the code of the uninstall section:<br />
      <br />
      Section "Uninstall"<br />
      <br />
      RMDir "$INSTDIR"<br />
      Delete "$DESKTOP\PymesON.lnk"<br />
      !insertmacro MUI_STARTMENU_GETFOLDER Application $MUI_TEMP<br />
      Delete "$SMPROGRAMS\$MUI_TEMP\Uninstall.lnk"<br />
      Delete "$SMPROGRAMS\$MUI_TEMP\${APPNAME}.lnk"<br />
      StrCpy $MUI_TEMP "$SMPROGRAMS\$MUI_TEMP"<br />
      startMenuDeleteLoop:<br />
      ClearErrors<br />
      RMDir $MUI_TEMP<br />
      GetFullPathName $MUI_TEMP "$MUI_TEMP\.."<br />
      IfErrors startMenuDeleteLoopDone<br />
      StrCmp $MUI_TEMP $SMPROGRAMS startMenuDeleteLoopDone startMenuDeleteLoop<br />
      startMenuDeleteLoopDone:<br />
      DeleteRegKey HKCR ".mcr"<br />
      DeleteRegKey HKCR "mcrfile"<br />
      DeleteRegKey HKCR "mcrfile"<br />
      DeleteRegKey HKCU "SOFTWARE\microsoft\Internet Explorer\Extensions\{8491AFCD-14CE-449B-A4F8-0AA5AF2B66DB}"<br />
      DeleteRegKey /ifempty HKCU "Software\${APPNAME}"<br />
      <br />
      SectionEnd<br />
      <br />
      Can you help me please?? Please...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">29th June 2007 15:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Can you not check the registry for an existing version?<br />
      Also, you should have quotes around your path for ExecWait.<br />
      <br />
      ExecWait '"$INSTDIR\SQLEXPR_ESN.EXE" /qb ... '<br />
      <br />
      If you don't and the path contains spaces then ExecWait will fail.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">trust11</span><br />
      <span class="post-time small text-muted">29th June 2007 16:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">How can i check the registry for an existing version?<br />
      Im new in all this .. i dont know how and where can i do it....</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">29th June 2007 16:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">See ReadRegStr in the manual. VersionCompare will also be necessary if you want to check for a certain version. Use RegEdit to find a suitable registry key to use for your install, or use Google.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">trust11</span><br />
      <span class="post-time small text-muted">2nd July 2007 08:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Afrow UK.<br />
      I have done it with this code:<br />
      <br />
      ReadRegStr $R0 HKLM \"SOFTWARE\Microsoft\MSSQLServer\Setup" SQLPath ;ProductCode<br />
      ${If} $R0 == ""<br />
      File "SQLEXPR_ESN.EXE" ExecWait '$INSTDIR\SQLEXPR_ESN.EXE /qb ADDLOCAL=SQL_Engine INSTANCENAME=MSSQLSERVER SECURITYMODE=SQL SAPWD=onix SQLCOLLATION="Modern_Spanish_CI_AS" SQLAUTOSTART=1 DISABLENETWORKPROTOCOLS=0'<br />
      ${Else}<br />
      ;MessageBox MB_ICONEXCLAMATION|MB_OK "SQL Server/MSDE already installed!$\nSQL Path:$R0$\nSetup is terminating the installation process."<br />
      ;Quit<br />
      ${EndIf}<br />
      <br />
      <br />
      About the other question.. How can i uninstall SQL Server? Can you help me please?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">trust11</span><br />
      <span class="post-time small text-muted">2nd July 2007 10:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">And i only should uninstall it if i have installed it...<br />
      Ufff... Can someone help me please?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">CancerFace</span><br />
      <span class="post-time small text-muted">2nd July 2007 10:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">From what I can see, SQL is an MSI package. To uninstall it you can look at <i>HKLM\Software\Microsoft\Windows\CurrentVersion\Uninstall\[some key for SQL]</i> for its uninstall entry and call from your script the value given in the <i>UninstallString</i> found in the registry.<br />
      <br />
      As for uninstalling it only if you have installed it, you could add to your installer a registry value (for example under HKLM\Software\YourCompanyName or something similar), then look for that value from your uninstaller and if it is there then call the uninstall string for the MSI pack ...<br />
      <br />
      Hope this helps<br />
      <br />
      CF</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">trust11</span><br />
      <span class="post-time small text-muted">2nd July 2007 11:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi CancerFace:<br />
      Im trying to dot this.<br />
      This is the code when i add a registry value on install:<br />
      <br />
      WriteRegStr HKLM "SOFTWARE\MyAPP\MyAPP" "1" "1"<br />
      <br />
      On uninstall im trying with this:<br />
      <br />
      ReadRegStr $R0 HKLM \<br />
      "SOFTWARE\MyAPP\MyAPP" 1<br />
      ${If} $R0 &lt;&gt; ""<br />
      ReadRegStr $R1 HKLM \ "SOFTWARE\Microsoft\MSSQLServer\UninstallPath" SQLPath ;ProductCode<br />
      ${If} $R1 &lt;&gt; ""<br />
      ExecWait '$R1'<br />
      ${EndIf}<br />
      ${EndIf}<br />
      <br />
      But this isnt working.<br />
      What im doing bad??</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">CancerFace</span><br />
      <span class="post-time small text-muted">2nd July 2007 15:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This is what I had in mind:<br />
      <br />
      Installer:<br /></p>
      <pre>
<code>WriteRegStr HKLM "SOFTWARE\MyAPP" "Installed" "1"</code>
</pre>Uninstaller:<br />
      <pre>
<code>ReadRegStr $R0 HKLM "SOFTWARE\MyAPP" "Installed"<br />${If} $R0 == 1<br /># add here the actual uninstall string for the MSI pack<br />${EndIf}</code>
</pre><br />
      The uninstall string you will find, as I already pointed out, under
      <pre>
<code>HKLM\Software\Microsoft\Windows\CurrentVersion\Uninstall\[some key for SQL]</code>
</pre><br />
      For example, the Intel Alert Agent on the Dell machine I use at work has its uninstaller found in
      <pre>
<code>HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{3C50A915-DD33-4802-B83B-9EA997D3337B}</code>
</pre>and specifically the uninstall string is at the key called <i>UninstallString</i> with a value of
      <pre>
<code>MsiExec.exe /I{3C50A915-DD33-4802-B83B-9EA997D3337B}</code>
</pre><br />
      So if I wanted to start this uninstaller for the Intel Alert Agent I would call (within my uninstaller):<br />
      <pre>
<code>ReadRegStr $R0 HKLM "SOFTWARE\MyAPP" "Installed"<br />${If} $R0 == 1<br />  ReadRegStr $R1 HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{3C50A915-DD33-4802-B83B-9EA997D3337B}"  "UninstallString"<br />  ${If} $R1 != ""<br />    ExecWait '$R1'<br />  ${EndIf}<br />${EndIf}</code>
</pre><br />
      <br />
      CF
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">2nd July 2007 20:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just to head off another possible problem, some install packages put the /I parameter into the uninstall string, but actually need /X to do the uninstall (this is from Crystal Reports):<br /></p>
      <pre>
<code>!define UNINSTALL_KEY "Software\Microsoft\Windows\CurrentVersion\Uninstall"<br />ReadRegStr $R0 HKLM "${UNINSTALL_KEY}\{2F8728F9-F239-46A0-9DE2-8AD7302E4B33}" "UninstallString"<br />; modify the command (/I becomes /x)<br />${un.WordReplace} "$R0" "/I{" "/x{" "+" "$R0"<br />ExecWait "$R0 /qn /norestart"<br /></code>
</pre><br />
      Don
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">3rd July 2007 09:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'll say it again for everyone. You have to use quotes around the executable path, otherwise it will not execute if you have a space in the path.<br />
      <br />
      E.g.<br />
      $R0 = "C:\Program Files\MyApp\file.exe"<br />
      ExecWait "$R0 /args"<br />
      This will become:<br />
      ExecWait "C:\Program Files\MyApp\file.exe /args"<br />
      <br />
      As you can seem C:\Program is not the executable!<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
