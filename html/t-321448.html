<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="space required"><title>space required - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">space required</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=321448">space required</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">orecchionebruno</span><br><span class="post-time small text-muted">6th August 2010 12:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>space required</strong><br>Hello everyone,<br><br>any one can suggest me how get space required by installer?<br><br>The standard installer directory page of NSIS shows the Space required and the Space avaible. I would recreate that infos in a custom page.<br><br>For the avaible space I've used the function "UpdateFreeSpace" included in Starting from "NSIS\Examples\nsDialogs\welcome.nsi", but the for the Space required i din't found a solution. So can I retrieve this info or I should calculate it?<br><br>Thankss<br>Bruno</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br><span class="post-time small text-muted">6th August 2010 13:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Get the size of every selected section using:<br><a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.13.8" target="_blank">http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.13.8</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">orecchionebruno</span><br><span class="post-time small text-muted">6th August 2010 13:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">sorry but I've not understood<br><br>SectionGetSize can retrieve the amount size (in byte or Mb) of files and folder that NSIS will compress on the exe of the installer?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">orecchionebruno</span><br><span class="post-time small text-muted">6th August 2010 13:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanksss I've followed your suggestion and I'v solved my question:<br><br>SectionGetSize ${MySectionFileToExtract} $0<br>IntOp $0 $0 + 100<br>SectionSetSize ${MySectionFileToExtract} $0<br><br>Thanksss</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Animaether</span><br><span class="post-time small text-muted">6th August 2010 13:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by orecchionebruno</small><br>SectionGetSize can retrieve the amount size (in byte or Mb) of files and folder that NSIS will compress on the exe of the installer?</blockquote>It retrieves the size in kilobytes of a given section when -uncompressed-. Note that this does not take into account things like filesystem overhead or NTFS compression, etc. But if drive space available is tight enough for such things to matter, the drive is definitely too full ;)<br><br>As MSG would say... search the forum;<br><a href="http://forums.winamp.com/showthread.php?t=320859&amp;highlight=space+required" target="_blank">http://forums.winamp.com/showthread....space+required</a></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">orecchionebruno</span><br><span class="post-time small text-muted">6th August 2010 14:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok thankss and thanks for the thread that you post me</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">orecchionebruno</span><br><span class="post-time small text-muted">6th August 2010 16:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by Animaether</small><br>It retrieves the size in kilobytes of a given section when -uncompressed-. Note that this does not take into account things like filesystem overhead or NTFS compression, etc. But if drive space available is tight enough for such things to matter, the drive is definitely too full ;)</blockquote>Thanksss I'm not sure to had understood. If SectionGetSize retrieves uncompressed size, I should not have any problems on any filesystem compresions or not?<br><br><blockquote><small>Originally posted by Animaether</small><br>As MSG would say... search the forum;<br><a href="http://forums.winamp.com/showthread.php?t=320859&amp;highlight=space+required" target="_blank">http://forums.winamp.com/showthread....space+required</a></blockquote>I read your suggestion about "${DriveSpace} "$0\" "/D=F /S=G" $spaceAvailable ; G = GiB"<br>What the difference beetween ${DriveSpace} and GetDiskFreeSpaceEx?<br><br>This what I've used:<br><br>StrCpy $1 " byte"<br>System::Call kernel32::GetDiskFreeSpaceEx(tr0,*l,*l,*l.r0)<br><br>${If} $0 &gt; 1024<br>${OrIf} $0 &lt; 0<br>System::Int64Op $0 / 1024<br>Pop $0<br>StrCpy $1 "kb"<br>${If} $0 &gt; 1024<br>${OrIf} $0 &lt; 0<br>System::Int64Op $0 / 1024<br>Pop $0<br>StrCpy $1 "mb"<br>${If} $0 &gt; 1024<br>${OrIf} $0 &lt; 0<br>System::Int64Op $0 / 1024<br>Pop $0<br>StrCpy $1 "gb"<br>${EndIf}<br>${EndIf}<br>${EndIf}<br>SendMessage $FREESPACE ${WM_SETTEXT} 0 "STR:Space available: $0 $1"<br><br>Ciao<br>Bruno</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Animaether</span><br><span class="post-time small text-muted">6th August 2010 20:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by orecchionebruno</small><br>Thanksss I'm not sure to had understood. If SectionGetSize retrieves uncompressed size, I should not have any problems on any filesystem compresions or not?</blockquote>Well, filesystem compression compresses the file when it's written away or as it's written away (depending on the FS). Let's say your application needs 13MB of space when not compressed, and the system only shows 12MB free. Your installer would then claim it can't be installed; but if you were to attempt install anyway, the filesystem might compress the files down to 8MB and it does fit.<br>Again, though, in any such situation I'd err on the side of caution and just tell the user that you don't care if they use compression, it's time for them to delete some stuff if they want your app installed :)<br><br><br><blockquote><small>Originally posted by orecchionebruno</small><br>I read your suggestion about "${DriveSpace} "$0\" "/D=F /S=G" $spaceAvailable ; G = GiB"<br>What the difference beetween ${DriveSpace} and GetDiskFreeSpaceEx?</blockquote>No real difference. DriveSpace uses the same API (GetDiskFreeSpaceEx) to get the free space. It just does some of the math bits for you and has some flags for getting total space/used space/free space.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">7th August 2010 06:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by orecchionebruno</small><br>If SectionGetSize retrieves uncompressed size, I should not have any problems on any filesystem compresions or not?</blockquote>Animaether, I think he meant to say: "I should not have any problems on any filesystem, regardless of the installer's compression." orecchionebruno, the answer to that question would be: Yes. SectionSetSize gets the harddrive space required for *installing* the section. It doesn't have anything to do with the size of the installer.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">orecchionebruno</span><br><span class="post-time small text-muted">7th August 2010 09:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">thanks Animaether and MSS<br><br>I'll consider any Animaether suggestions but for this specific situatation I'll consider only uncopress size because my data are only some mbytes and it's very hard that user has not some mb free. If not user will delete something.<br><br>thankss again</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">orecchionebruno</span><br><span class="post-time small text-muted">10th August 2010 10:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by Animaether</small><br>No real difference. DriveSpace uses the same API (GetDiskFreeSpaceEx) to get the free space. It just does some of the math bits for you and has some flags for getting total space/used space/free space.</blockquote>Hi Animaether and hi to everyone,<br><br>I've followed Animaether suggestions because when I use the API as follow I'm not able to retrieve correct values:<br>System::Call kernel32::GetDiskFreeSpaceEx(tr0,*l,*l,*l.r0)<br><br>If I try to get free space on C:\ everything is correct, but if try in other drive the values are not correct. I'm sure that happens because I don't know wich parameter I should change so I had started using ${DriveSpace} but it happens something that I don't understand.<br><br>Using ${DriveSpace} I can get any value of any drives.<br><br>The problem happens when I try to compare some values. If I compare free space of C:\ or D:\ or H:\ (this is a USB pen) everything works but when I compare with my E:\ (it's a recovery partition) the conditions commands give me wrong value.<br><br>For example:<br>${GetRoot} $MYPATH1 $1<br>${DriveSpace} "$1\" "/D=F /S=B" $1<br><br>${GetRoot} $MYPATH2 $2<br>${DriveSpace} $MYPATH2<br><br>${If} "$MYPATH1 " U&gt;= "$MYPATH2"<br>MessageBox MB_OK "PATH1 &gt;= PATH2"<br>${Else}<br>MessageBox MB_OK "PATH1 &lt; PATH2"<br>${EndIf}<br><br>If MYPATH1 and MYPATH2 is C:\, F:\ D:\, I obtain correct results but when is E:\ (the partition recovery) the value is apparently correct but the condition script doesn't work.<br><br>The problem should be on the variable format so I tried to see what happens if I do this but I get a negative value:<br>System::Int64Op $MYPATH1 * 1<br>Pop $MYPATH1<br><br>Any one have a suggestion to solve this problem?</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Animaether</span><br><span class="post-time small text-muted">10th August 2010 20:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Looks like you had posted this to a separate thread as well - see there :)<br><a href="http://forums.winamp.com/showthread.php?t=321543" target="_blank">http://forums.winamp.com/showthread.php?t=321543</a> - "${DriveSpace} and some strange values "</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">orecchionebruno</span><br><span class="post-time small text-muted">11th August 2010 10:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Animaether, I'm sorry upper I made a mistake translating my variables. I correct the script, but the problem that I wrote is that happens.<br><br>${GetRoot} $MYPATH1 $1<br>${DriveSpace} "$1\" "/D=F /S=B" $FreeSpace1<br><br>${GetRoot} $MYPATH2 $2<br>${DriveSpace} "$2\" "/D=F /S=B" $FreeSpace2<br><br>${If} "$FreeSpace1" U&gt;= "$FreeSpace2"<br>MessageBox MB_OK "PATH1 &gt;= PATH2"<br>${Else}<br>MessageBox MB_OK "PATH1 &lt; PATH2"<br>${EndIf}<br><br>_____<br>As Animaether wrote, this discussion continue here:<br><a href="http://forums.winamp.com/showthread.php?t=321543" target="_blank">http://forums.winamp.com/showthread.php?t=321543</a><br><br>Thanksss</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">11th August 2010 10:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">orecchionebruno, please stop posting in two threads at once. Use the other thread, not this one.<br><br>(And please don't reply to this post, either.)</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>