<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Problem avoiding setup to run more than once at the same time" />

  <title>Problem avoiding setup to run more than once at the same time - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.2/readable/bootstrap.min.css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Problem avoiding setup to run more than once at the same time</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=221272">Problem avoiding setup to run more than once at the same time</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Lightning20</span><br />
      <span class="post-time small text-muted">12th July 2005 10:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Problem avoiding setup to run more than once at the same time</strong><br />
      &nbsp; Hi !<br />
      <br />
      I want to avoid my setup running more than once at the same time. I have tried to use both Findproc and kernel32 to find if my setup is already running or not. I have placed the code in my .oninit function. The problem is that when the setup is launched, it detects itself as running, and so it says me "I'm already running!" Is there a way to make it work? Thx !<br /></p>
      <pre>
<code><br />System::Call 'kernel32::CreateMutexA(i 0, i 0, t '$(^Name)') i .r1 ?e'<br />Pop $R0 <br />StrCmp $R0 0 +3 <br />MessageBox MB_OK "The installer is already running." <br />Abort<br /></code>
</pre><br />
      or<br />
      <pre>
<code><br />FindProcDLL::FindProc "myinstall.exe"<br />StrCmp $R0 1 RunningInst_found RunningInst_notfound<br />RunningInst_found:<br />MessageBox MB_OK "The installer is already running." <br />Abort<br />RunningInst_notfound:<br /></code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">12th July 2005 11:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Language strings are not yet set in .onInit. I recommend you to replace $(^Name) by a unique string that contains a GUID.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Lightning20</span><br />
      <span class="post-time small text-muted">12th July 2005 13:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok thank you for the information. I gave it a try but it still doesn't work. It says that install is running everytime. What can be wrong?<br /></p>
      <pre>
<code>
I have defined a unique string
<br /> LangString unique_string${LANG_FRENCH} "French"
<br /><br />&gt;;here is the code in .oninit
<br />&gt;Function .oninit
<br />System</code>::Call 'kernel32::CreateMutexA(i 0, i 0, t '$(^unique_string)') i .r0 ?e'
<br />&gt;Pop $R0 
<br />StrCmp $R0 0+3 
<br />MessageBox MB_OK "The installer is already running." 
<br />&gt;Abort
<br />FunctionEnd 
<br />&gt;

</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">12th July 2005 13:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">When we mean a unique string, we mean a string that is the same for all languages (e.g. NOT a language string).<br />
      <br /></p>
      <pre>
<code>;I have defined a unique string<br />!define MutexString "blah blah"<br /><br />;here is the code in .oninit<br />Function .oninit<br />System::Call 'kernel32::CreateMutexA(i 0, i 0, t '${MutexString}') i .r0 ?e'<br />Pop $R0<br />StrCmp $R0 0 +3<br />MessageBox MB_OK "The installer is already running."<br />Abort<br />FunctionEnd</code>
</pre><br />
      <br />
      -Stu
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Lightning20</span><br />
      <span class="post-time small text-muted">12th July 2005 14:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you again for your rapidity and for the accuracy of your answers ;)</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>