<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Making an Installer from an existing Installer and a Configuration file" />

  <title>Making an Installer from an existing Installer and a Configuration file - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Making an Installer from an existing Installer and a Configuration file</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=349842">Making an Installer from an existing Installer and a Configuration file</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scythe</span><br />
      <span class="post-time small text-muted">9th October 2012 12:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Making an Installer from an existing Installer and a Configuration file</strong><br />
      Hi,<br />
      <br />
      I have an Installer A.exe, created by NSIS, which is the same for all customers. Furthermore a have a dynamically created config file B.ini which differs for each customer. Given A.exe and the customer-specific config file B.ini, I would like to bundle these two files into an NSIS installer C.exe which installs A.exe and copies B.ini to the install dir.<br />
      <br />
      What is the simples way to do so?<br />
      <br />
      I'm new to NSIS and would appreciate any help or source code. Thank you!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">9th October 2012 13:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm assuming you're asking how to automate the process of creating all the C.exes for all your customers.<br />
      <br />
      The easiest way I can think of is putting all the config.ini files in subfolders (or renaming them (customerID).ini or something), then enumerate all the ini paths/filenames in a vbs/bat/NSISexe and executing makensisw for each filename with the filename supplied as a commandline parameter. You can use makensisw's /D parameter to specificy a !define during compilation, so that in the nsi script you'd do something like:<br />
      File "/oname=$INSTDIR\config.ini" "${TheFilenameDefine}"<br />
      <br />
      Of course you'll also need to change the filename of each generated C.exe. Simply do: name ${TheFilenameDefine}.exe</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scythe</span><br />
      <span class="post-time small text-muted">9th October 2012 16:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you very much for your reply. This already helps a lot. However, I'm wondering if there is a possibility to write the config file B.ini without creating a C.exe for every customer.<br />
      <br />
      In other words: Is there a possibility to just append the config file B.ini of a specific customer (that is the raw bytes) to the installer A.exe without invoking makensis and specify a command in the script for A.exe which looks for this config data and if it exists writes it to the file B.ini during installation?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">9th October 2012 16:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, there is. NSIS installers only do a CRC check on their own data. If you append bytes to the exe, it will not interfere with the installer. If you want to use an NSIS exe to do this, you can use FileWriteByte. You'll have to make sure that the correct bytes are read during installation (FileReadByte). Perhaps using a fixed filelength for each ini would be the simplest way.<br />
      <br />
      Note however that if the ini contents are already known during compilation of A.exe, you can simply use the ini instructions to create the config.ini file at runtime: <a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.2.13" target="_blank">http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.2.13</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scythe</span><br />
      <span class="post-time small text-muted">11th October 2012 16:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for your reply. I was able to solve the problem by writing a function based on ReadCustomerData <a href="http://nsis.sourceforge.net/ReadCustomerData" target="_blank">http://nsis.sourceforge.net/ReadCustomerData</a>. However I'm running into trouble if the appended data contains linebreaks, so I had to escape \r and \n and remove the escaping when writing the appended data back to aconfig file.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
