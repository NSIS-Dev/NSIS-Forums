<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="state all local drives" />

  <title>state all local drives - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">state all local drives</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=121574">state all local drives</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Benoni</span><br />
      <span class="post-time small text-muted">15th January 2003 20:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>state all local drives</strong><br />
      Does anyone know how I can find out the root dir of all local drives on a machine. It would be best if it returned one at a time in the format (c:\) in a variable and then you add 1 to another variable send it to the top again and it would do the second one - or something like that.<br />
      Any ideas?<br />
      Thanks</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">15th January 2003 22:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Download the latest NSIS 2 snapshot at <a href="http://nsis.sf.net" target="_blank">http://nsis.sf.net</a> and check out the System plugin example.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br />
      <span class="post-time small text-muted">16th January 2003 02:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The DriveInfo plugin by KiCHiK might be of interest to you, get it on this page: <a href="http://nsis.sourceforge.net/archive/download.php" target="_blank">http://nsis.sourceforge.net/archive/download.php</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Benoni</span><br />
      <span class="post-time small text-muted">1st February 2003 11:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        Download the latest NSIS 2 snapshot at <a href="http://nsis.sf.net" target="_blank">http://nsis.sf.net</a> and check out the System plugin example.
      </blockquote>I can't find anything in the system DLL that would work - which bit of it were you meaning.<br />
      <br />
      <br />

      <blockquote>
        The DriveInfo plugin by KiCHiK might be of interest to you, get it on this page: <a href="http://nsis.sourceforge.net/archive/download.php" target="_blank">http://nsis.sourceforge.net/archive/download.php</a>
      </blockquote>That works the other way around - or am I wrong. I thought you gave it a drive letter and it gave you info about it.<br />
      <br />
      I was looking for something like the 'Enumerate cd drives' polugin which worked for F.D.Ds. H.D.Ds. C.Ds. D.V.Ds. Zip Drives etc.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">1st February 2003 12:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Joost was talking about &lt;NSIS directory&gt;\Contrib\System\System.nsi lines 28 - 68. It gets the free space for all drives on the system. You can remove the free space part and you'll have a normal enumeration.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Benoni</span><br />
      <span class="post-time small text-muted">1st February 2003 15:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>problem,</strong><br />
      I get an illegal operation error whenever I run a program using the systemDLL. Any ideas what is wrong?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">1st February 2003 15:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Are you running the original example or have you changed it?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Benoni</span><br />
      <span class="post-time small text-muted">1st February 2003 16:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>problem,</strong><br />
      I get an illegal operation error whenever I run a program using the systemDLL. Any ideas what is wrong?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">1st February 2003 17:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What OS are you using? Which version of NSIS? What examples have you tried? What's the exact error you get?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Benoni</span><br />
      <span class="post-time small text-muted">1st February 2003 18:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The system example which comes with NSIS gives me one blue screen after another. With my own ones:<br />
      <br />
      System::Call '${sysGetLogicalDriveStrings}(1024, r1)'<br />
      <br />
      System::Call '${sysGetDiskFreeSpaceEx}(i r1, .r3, .r4, .r5)'<br />
      <br />
      System::Call '${syswsprintf} (.r7, "%s%20s %20s mb %20s mb %20s mb$\n", tr7, tr6, ts, ts, ts)'<br />
      <br />
      <br />
      gives me an illegal operation however:<br />
      <br />
      System::Call '*$R0${stSYSTEMTIME} (.r1, .r2, .r3, .r4, .r5, .r6, .r7, .r8)'<br />
      <br />
      System::Call "*$1(i .r2, &amp;t10 .r3, &amp;i1 .r4, &amp;i2 .r5, &amp;l0 .r6)"<br />
      <br />
      System::Call 'user32::MessageBoxA(i $HWNDPARENT, t "Just direct MessageBoxA specification demo ;)", t "System Example 3", i 33) i.s'<br />
      <br />
      are all fine.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Benoni</span><br />
      <span class="post-time small text-muted">1st February 2003 20:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry about the second post of the same message. I was in my history looking for this post, and clicked the link for newreply.php instead of showthread.php, and so posted my message again.<br />
      <br />
      I am using Win95 4.00.950.a<br />
      NSIS 1.9<br />
      I posted examples before I saw your last post.<br />
      The error mesage is:<br />
      <br />
      This program has performed an illegal opperation and will be shut down.<br />
      <br />
      If the problem persists, contact the program vendor.<br />
      <br />
      <u>D</u>etails&gt;&gt;<br />
      <br />
      DRIVES caused an invalid page fault in module SYSTEM.DLL at 0137:1000laca<br />
      Registers:<br />
      EAX=00001310 CS=1037 EIP=1000laca EFLGS=00010246<br />
      EBX=bff76dfl SS=013f ESP=0065f3c0 EBP=0065f3fc<br />
      ECX=0065ff68 DS=013f ESI=00000000 FS=3d07<br />
      EDX=00000000 ES=013f EDI=00430888 GS=3a76<br />
      Bytes at CS:EIP:<br />
      39 10 59 74 14 8b ce 8b 30 8d 86 10 13 00 00 39<br />
      Stack dump:<br />
      00000000 1000267f 00425360 0040ac58 0043047c<br />
      00000000 00430078 00000000 00530b8f 00000001<br />
      00530b80 00000000 00000001 0043048b 00000000<br />
      0065f428</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">virtlink</span><br />
      <span class="post-time small text-muted">2nd February 2003 09:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sounds to me like another bug.<br />
      Anyway, it shouldn't be possible to crash someone's PC with wrong scripting.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br />
      <span class="post-time small text-muted">2nd February 2003 10:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by virtlink</i> <b>Sounds to me like another bug.</b>
      </blockquote>You always seem to enjoy pointing them out, I can't help but wonder why? The CVS and other recent versions of NSIS are development versions which *will* contain bugs, that's exactly why they are not proper release versions. Instead of jumping up and down when you spot a bug why don't you join the team of people who try to make NSIS better so that a proper release can be more quickly achieved?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">virtlink</span><br />
      <span class="post-time small text-muted">2nd February 2003 10:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Sunjammer</i><br />
        <b>You always seem to enjoy pointing them out, I can't help but wonder why?</b>
      </blockquote>My former nickname was: Debugger.<br />

      <blockquote>
        <i>Also originally posted by Sunjammer</i><br />
        <b>The CVS and other recent versions of NSIS are development versions which *will* contain bugs, that's exactly why they are not proper release versions.</b>
      </blockquote>I know.<br />

      <blockquote>
        <i>Also originally posted by Sunjammer</i><br />
        <b>Instead of jumping up and down when you spot a bug</b>
      </blockquote>I don't!:mad: (at least, I think I don't ;))<br />
      <br />

      <blockquote>
        <i>Also originally posted by Sunjammer</i><br />
        <b>why don't you join the team of people who try to make NSIS better so that a proper release can be more quickly achieved?</b>
      </blockquote>I can't. I don't know C or C++.:cry:<br />
      But I could be a good beta-tester. (At least, I think so ;))
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">2nd February 2003 15:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK... After our nice speculations about bugs, lets move on to actually work this out...<br />
      <br />
      Benoni, the script you have provided can't possibly work on NSIS 1.9. I think you are talking about MakeNSIS<b>w</b> 1.9. Open up MakeNSISw again and look at the bottom left corner of the screen. Are you using NSIS 2.0b0 or the latest CVS version (2.0b1)?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Benoni</span><br />
      <span class="post-time small text-muted">2nd February 2003 16:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Oops</strong><br />
      I guess I should upgrade:winamp:? :( :confused: :down: :igor:<br />
      Is there a newsletter which informs about new versions? I have been a bad boy:(</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">2nd February 2003 17:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I don't know yet. First tell me what version you are using. The version you provided earlier was of MakeNSIS<b>w</b>. It is another program that comes with NSIS, but it's not the compiler itself. The scripts you've tried won't even compile on NSIS 1.9. Open MakeNSISw.exe again and look in the bottom left corner. What does it say? What version are you using?<br />
      <br />
      To keep updated about releases sign up to SourceForge, go to <a href="http://sourceforge.net/projects/nsis/" target="_blank">the project page</a> and click the little envlope icon in the NSIS 2 Pre-release line (or click <a href="http://sourceforge.net/project/filemodule_monitor.php?filemodule_id=58746" target="_blank">here</a>). It will send you an e-mail whenever a pre-release version is released. To be updated as possible use the CVS version (see the FAQ for that).<br />
      <br />
      I have looked at it again and it seems the problem is with your Windows version. I don't know a lot about 95 versions so I can't tell anything from the version number you gave us, so I'll have to ask you. Are you using a Windows 95 version that came before OSR2? MSDN says GetDiskFreeSpaceEx (which is used in System.nsi) only works on Windows 95 OSR2 and above.<br />
      <br />
      This shouldn't matter to you much because you don't need the free space count anyway so you can just remove this line and all the calculations that come after it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Benoni</span><br />
      <span class="post-time small text-muted">2nd February 2003 17:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">2.0b0<br />
      I thought I had put that!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">2nd February 2003 17:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Nope, you put 1.9... Never mind :)<br />
      <br />
      You also said earlier that:<br />
      System::Call '${sysGetDiskFreeSpaceEx}(i r1, .r3, .r4, .r5)'<br />
      <br />
      Worked for you, so you must be using post OSR2. I don't know a lot about System.dll. I will message the creator (brainsucker) and see if he can help you.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">brainsucker</span><br />
      <span class="post-time small text-muted">3rd February 2003 10:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello. Take this example from system.nsi without some parts and with some additional comments. Hope it will help you.<br />
      <br />
      p.s. works fine for me at win98 &amp; winxp. no memory leaks or other problems found :)<br />
      <br />
      ; just an output string<br />
      StrCpy $7 ''<br />
      <br />
      ; Memory for paths<br />
      System::Alloc 1024<br />
      Pop $1<br />
      ; Get drives<br />
      System::Call '${sysGetLogicalDriveStrings}(1024, r1)'<br />
      enumok:<br />
      ; One more drive?<br />
      System::Call '${syslstrlen}(i r1) .r2'<br />
      IntCmp $2 0 enumex<br />
      <br />
      ; You can remove or change this part according to the types of drives you need to enumerate<br />
      ; Is it DRIVE_FIXED?<br />
      System::Call '${sysGetDriveType} (i r1) .r3'<br />
      IntCmp $3 ${DRIVE_FIXED} 0 enumnext<br />
      <br />
      ; Get pretty drive path string<br />
      System::Call '*$1(&amp;t1024 .r6)'<br />
      <br />
      ; At this moment $6 contains the drive root path.<br />
      StrCpy $7 "$7 $6$\n" ; Just an example of how to use it<br />
      <br />
      enumnext:<br />
      ; Next drive path<br />
      IntOp $1 $1 + $2<br />
      IntOp $1 $1 + 1<br />
      goto enumok<br />
      enumex: ; End of drives or user cancel<br />
      ; Free memory used for paths<br />
      System::Free $1<br />
      <br />
      ; Something to do<br />
      MessageBox MB_OK "Cool: $\n$7"</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Benoni</span><br />
      <span class="post-time small text-muted">5th February 2003 14:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Section ""<br />
      <br />
      ; just an output string<br />
      StrCpy $7 ''<br />
      <br />
      ; Memory for paths<br />
      System::Alloc 1024<br />
      Pop $1<br />
      ; Get drives<br />
      #System::Call '${sysGetLogicalDriveStrings}(1024, r1)'<br />
      enumok:<br />
      ; One more drive?<br />
      #System::Call '${syslstrlen}(i r1) .r2'<br />
      IntCmp $2 0 enumex<br />
      <br />
      ; You can remove or change this part according to the types of drives you need to enumerate<br />
      ; Is it DRIVE_FIXED?<br />
      System::Call '${sysGetDriveType} (i r1) .r3'<br />
      IntCmp $3 ${DRIVE_FIXED} 0 enumnext<br />
      <br />
      ; Get pretty drive path string<br />
      System::Call '*$1(&amp;t1024 .r6)'<br />
      <br />
      ; At this moment $6 contains the drive root path.<br />
      StrCpy $7 "$7 $6$\n" ; Just an example of how to use it<br />
      <br />
      enumnext:<br />
      ; Next drive path<br />
      IntOp $1 $1 + $2<br />
      IntOp $1 $1 + 1<br />
      goto enumok<br />
      enumex: ; End of drives or user cancel<br />
      ; Free memory used for paths<br />
      System::Free $1<br />
      <br />
      ; Something to do<br />
      MessageBox MB_OK "Cool: $\n$7"<br />
      SectionEnd<br />
      <br />
      <br />
      <br />
      It worked ok, except when I included one or both of the lines with the # before them. Then I would get the same 'This program has performed an illegal opperation and will be shut down.' error message</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
