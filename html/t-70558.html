<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="WriteIniStr wont work completely on NT"><title>WriteIniStr wont work completely on NT - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">WriteIniStr wont work completely on NT</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=70558">WriteIniStr wont work completely on NT</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">les_stockton</span><br><span class="post-time small text-muted">2nd January 2002 23:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>WriteIniStr wont work completely on NT</strong><br>I've tested this on several systems, XP, Windows 2000, 98, ME and even 95. WriteIniStr will allow me to write to the drivers32 section of the system.ini file, but not on NT. I can write to a new section, but not to an existing section such as mci. drivers32 section doesn't exist under NT4 and WriteIniStr wont create one. If I create one, it still wont write to it.<br>The only thing I've been able to do is to write a dummy section just for testing.<br>Does anyone know how to solve this problem?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dbareis</span><br><span class="post-time small text-muted">3rd January 2002 08:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Re: WriteIniStr wont work completely on NT</strong><br>Have you tried manually creating these in regedit to prove it is not a security issue?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">les_stockton</span><br><span class="post-time small text-muted">3rd January 2002 14:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>why?</strong><br>I'm not sure I understand. Why would I use regedit to write to the system.ini file?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Repzilon</span><br><span class="post-time small text-muted">3rd January 2002 14:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">system.ini and win.ini are legacy from Windows 3.x and are used only on "crashy" Windows Kernels (9x, Me). On NT Kernels (NT4, 2000, XP all editions), their settings are mapped to registry.<br><br>And for one of these 2 files (I do not remember which one), there are special versions of API fonctions:<br><br>Normal / Special<br>GetPrivateProfileString / GetProfileString<br>GetPrivateProfileInt / GetProfileInt<br>GetPrivateProfileSection / GetProfileSection</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">les_stockton</span><br><span class="post-time small text-muted">3rd January 2002 15:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>understood</strong><br>Understood. However, I'm hoping to write to system.ini because I'm using MCI for video, and I'm stuck using it because of the software I have, which I can't replace just yet. As it is, MCI uses system.ini unless they've updated it, which I doubt.<br>If it has been mapped to the registry, where does the mci section and the driver32 section get mapped?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Repzilon</span><br><span class="post-time small text-muted">3rd January 2002 15:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Form Visual C++ 5.0 Help :<br><br>The GetProfileString function retrieves the string associated with the specified key in the given section of the WIN.INI file. This function is provided for compatibility with 16-bit Windows-based applications. Win32-based applications should store initialization information in the registry.<br><br>DWORD GetProfileString( LPCTSTR lpAppName,<br>// address of section name<br><br>LPCTSTR lpKeyName,<br>// address of key name<br><br>LPCTSTR lpDefault,<br>// address of default string<br><br>LPTSTR lpReturnedString,<br>// address of destination buffer<br><br>DWORD nSize<br>// size of destination buffer<br><br>);<br><br><br><br>Parameters<br>lpAppName<br><br>Pointer to a null-terminated string that specifies the section containing the key. If this parameter is NULL, the function copies all section names in the file to the supplied buffer.<br><br>lpKeyName<br><br>Pointer to a null-terminated string containing the key name whose associated string is to be retrieved. If this parameter is NULL, the function copies all keys in the given section to the supplied buffer. Each string is followed by a null character, and the final string is followed by a second null character.<br><br>lpDefault<br><br>Pointer to a null-terminated default string. If the lpKeyName key cannot be found in the initialization file, GetPrivateProfileString copies the default string to the lpReturnedString buffer. This parameter cannot be NULL.<br><br>Avoid specifying a default string with trailing blank characters. The function inserts a null character in the lpReturnedString buffer to strip any trailing blanks.<br><br>Windows 95: Although lpDefault is declared as a constant parameter, Windows 95 strips any trailing blanks by inserting a null character into the lpDefault string before copying it to the lpReturnedString buffer.<br><br>Windows NT: Windows NT does not modify the lpDefault string. This means that if the default string contains trailing blanks, the lpReturnedString and lpDefault strings will not match when compared using the lstrcmp function.<br><br>lpReturnedString<br><br>Pointer to a buffer that receives the character string.<br><br>nSize<br><br>Specifies the size, in characters, of the buffer pointed to by the lpReturnedString parameter.<br><br>Return Values<br>If the function succeeds, the return value is the number of characters copied to the buffer, not including the null-terminating character.<br><br>If neither lpAppName nor lpKeyName is NULL and the supplied destination buffer is too small to hold the requested string, the string is truncated and followed by a null character, and the return value is equal to nSize minus one.<br><br>If either lpAppName or lpKeyName is NULL and the supplied destination buffer is too small to hold all the strings, the last string is truncated and followed by two null characters. In this case, the return value is equal to nSize minus two.<br><br>Remarks<br>If the string associated with the lpKeyName parameter is enclosed in single or double quotation marks, the marks are discarded when the GetProfileString function returns the string.<br><br>The GetProfileString function is not case-sensitive; the strings can contain a combination of uppercase and lowercase letters.<br><br>A section in the WIN.INI file must have the following form:<br><br>[section]<br>key=string<br>.<br>.<br>.<br><br>An application can use the GetPrivateProfileString function to retrieve a string from a specified initialization file.<br><br>The lpDefault parameter must point to a valid string, even if the string is empty (that is, even if its first character is a null character).<br><br>Windows NT:<br><br>Calls to profile functions may be mapped to the registry instead of to the initialization files. This mapping occurs when the initialization file and section are specified in the registry under the following keys:<br><br>HKEY_LOCAL_MACHINE\Software\Microsoft\<br>Windows NT\CurrentVersion\IniFileMapping<br><br>When the operation has been mapped, the GetProfileString function retrieves information from the registry, not from the initialization file; the change in the storage location has no effect on the functionâ€™s behavior.<br><br>The Win32 Profile functions (Get/WriteProfile*, Get/WritePrivateProfile*) use the following steps to locate initialization information:<br><br>1. Look in the registry for the name of the initialization file, say myfile.ini, under IniFileMapping:<br><br>HKEY_LOCAL_MACHINE\Software\Microsoft\<br>Windows NT\CurrentVersion\IniFileMapping\myfile.ini<br><br>2. Look for the section name specified by lpAppName. This will be a named value under myfile.ini, or a subkey of myfile.ini, or will not exist.<br><br>3. If the section name specified by lpAppName is a named value under myfile.ini, then that value specifies where in the registry you will find the keys for the section.<br><br>4. If the section name specified by lpAppName is a subkey of myfile.ini, then named values under that subkey specify where in the registry you will find the keys for the section. If the key you are looking for does not exist as a named value, then there will be an unnamed value (shown as "&lt;No Name&gt;") that specifies the default location in the registry where you will find the key.<br><br>5. If the section name specified by lpAppName does not exist as a named value or as a subkey under myfile.ini, then there will be an unnamed value (shown as "&lt;No Name&gt;") under myfile.ini that specifies the default location in the registry where you will find the keys for the section.<br><br>6. If there is no subkey for myfile.ini, or if there is no entry for the section name, then look for the actual myfile.ini on the disk and read its contents.<br><br>When looking at values in the registry that specify other registry locations, there are several prefixes that change the behavior of the ini file mapping:<br><br>! - this character forces all writes to go both to the registry and to the .INI file on disk.<br><br># - this character causes the registry value to be set to the value in the Windows 3.1 .INI file when a new user logs in for the first time after setup.<br><br>@ - this character prevents any reads from going to the .INI file on disk if the requested data is not found in the registry.<br><br>USR: - this prefix stands for HKEY_CURRENT_USER, and the text after the prefix is relative to that key.<br><br>SYS: - this prefix stands for HKEY_LOCAL_MACHINE\SOFTWARE, and the text after the prefix is relative to that key.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>