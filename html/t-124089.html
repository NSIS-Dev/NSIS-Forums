<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Environment Variables:: Write/Change Them?" />

  <title>Environment Variables:: Write/Change Them? - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.2/readable/bootstrap.min.css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Environment Variables:: Write/Change Them?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=124089">Environment Variables:: Write/Change Them?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kikolo</span><br />
      <span class="post-time small text-muted">6th February 2003 10:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Environment Variables:: Write/Change Them?</strong><br />
      &nbsp; I have read some posts about how to write Environment Variables Permantently, but i need to write/set them on install running to test the DB Connection.<br />
      The program that connects with DataBase reads Settings from Environment Variables like DBDATE, DBTEMP, DBSERVER and others that the installer sets into installoptions 'forms'/'pages', but i need them on the environment to test the connection on the next page, but i only read about reading env. vars. and write them on the registry or the autoexec, but this option needs to reboot.<br />
      Resume: How Can I write/change Env. Vars. on installer execution?<br />
      Thanks</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th February 2003 11:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=91" target="_blank">http://nsis.sourceforge.net/archive/....php?pageid=91</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mark_Ive</span><br />
      <span class="post-time small text-muted">6th February 2003 11:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi there, this is how i would write an environment variable<br />
      <br />
      WriteRegStr HKEY_LOCAL_MACHINE "SYSTEM\CurrentControlSet\Control\Session Manager\Environment" "Env Name" "Env Value"</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th February 2003 11:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That only works on Windows NT. The functions I have posted above work with Windows 9x too.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kikolo</span><br />
      <span class="post-time small text-muted">6th February 2003 13:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">RePlay: sorry about my english, but maybe i said something different that i thonk (thonk? thinked? what is the past of to think?)<br />
      Example:<br />
      One Install Script<br />
      PAge 1 Welcome<br />
      Page 2 License<br />
      Page 3 Components<br />
      Page 4 Custom Page With Input Text Boxes<br />
      Page 5 Custom Page With DB connection test<br />
      Page 6 Custon Page that shows information about connection<br />
      Page 7 Install Rest of Components<br />
      Page 8 Bye Bye<br />
      <br />
      In The Page 6 i read a file written by Program on Page 5<br />
      In The Page 5 i call an executable that read the Environment Variables to Test an DataBase Connection.<br />
      In the Page 4 i do an input of the variables that i need in the Page 5.<br />
      In The solutions that you give me, i need to install,reboot and test de connection,<br />
      if the connection dont work the user must repeat the install!?!?!<br />
      <br />
      Resume: How Can I Change/SetUp/Write Variables to Environment Directly during execution, not to registry, not to autoexec.bat?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br />
      <span class="post-time small text-muted">6th February 2003 13:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">past of think is thought</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th February 2003 17:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am sorry. I haven't read your question to the end. :(<br />
      <br />
      Here is how you do it without the need to create a plug-in:<br /></p>
      <pre>
<code>System</code>::Call 'Kernel32::SetEnvironmentVariableA(t, t) i("name", "value").r0'
<br />&gt;StrCmp $0 0 error
<br />    Exec "other proggie.exe" 
</pre>Replace "name" with the name of the environment variable and "value" with it's value. Repeat this line (System::Call...) for every variable you need to set.<br />
      <br />
      If you don't want to include System.dll in your installer (9KB) then you'll have to write a nice little plug-in that calls SetEnvironmentVariable.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kikolo</span><br />
      <span class="post-time small text-muted">7th February 2003 08:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">thank you! :up:<br />
      it works fine,<br />
      at the moment i will use the system.dll, in future... maybe a new little dll.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">iceman_k</span><br />
      <span class="post-time small text-muted">21st February 2003 16:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Does this work with nsExec as well?<br />
      Or just for the Exec functions?<br />
      ---<br />
      Thanks</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">21st February 2003 16:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, it works for nsExec as well as both use CreateProcess.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kikolo</span><br />
      <span class="post-time small text-muted">10th March 2003 09:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">--- La Función - The Function ---<br /></p>
      <pre>
<code>System::Call 'Kernel32::SetEnvironmentVariableA(t, t) i("name", "value").r0'</code>
</pre><br />
      --- La Función - The Function ---<br />
      <br />
      --- Post in Spanish ---<br />
      Hola<br />
      La función <b>System::Call</b> funcionó bien, hasta que empecé a realizar debug y control de errores, fue entonces cuando descubri que cada vez que se utiliza la función, el flag de error se activa, y pierdo el control de los errores, y se me escapa por algun lado.<br />
      ¿tengo alguna otra manera de hacer lo mismo con otro dll ya existente?<br />
      Muchas Gracias y Saludos Totales :P<br />
      KiKoLo<br />
      --- Post in Spanish ---<br />
      --- Post in ... Spanglish? ---<br />
      Hi<br />
      The Function <b>System::Call</b> worked fine, but when i started to do debug and error hadler control, i discover that when i use the function, the error flag activates, and i miss the control of the error handles and it scapes anywhere.<br />
      ¿Can i do the same with an existent dll?<br />
      Lots of Thanks and SALUDOS TOTALES :P<br />
      KiKoLo<br />
      --- Post in ... Spanglish? ---<br />
      <br />
      --- Ejemplo - Example ---<br />
      <pre>
<code>Name "Tester"
<br />&gt;OutFile "..\bin\testing.exe"
<br />  Section "Testing"
<br />      Push $R0
<br />      StrCpy $R0 "I"
<br />     DetailPrint "DEBUG_TRACE***91;$0***93;: (REG) INFODB = ***91;$R0***93;"
<br />     System::Call 'Kernel32::SetEnvironmentVariableA(t, t) i("INFODB", "$R0").r0'
<br />     DetailPrint "DEBUG_TRACE***91;$0***93;: (ENV) INFODB = ***91;$R0***93;"
<br />      Pop $R0
<br />   SectionEnd 
<br />&gt;
</code>
</pre>--- Ejemplo - Example ---<br />
      <br />
      Thank you for all darkboy ;)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br />
      <span class="post-time small text-muted">10th March 2003 20:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">!define Spanish_Post :p<br />
      <br />
      KiKoLo: Tu mensaje en el foro está bien redactado, les explicas que<br />
      tienes un error al usar el plugin System al usar Debug, y que este<br />
      error no lo puedes controlar.<br />
      Ayuda el hecho de que hayas puesto parte de tu código.<br />
      <br />
      <br />
      !define English_Post ;)<br />
      <br />
      KiKoLo: you post in english is ok. When you use the System plugin with<br />
      the debug and error handlers, you starting to recived error that you<br />
      can't handle...<br />
      It helps that you put part of your code.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kikolo</span><br />
      <span class="post-time small text-muted">11th March 2003 08:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I made a plugin dll (SetEnv.dll) to do this.<br />
      And Works when the other way doesnot<br />
      explanation...<br /></p>
      <pre>
<code>
Name "Tester"
<br />&gt;OutFile "..\bin\testing.exe"
<br /><br />  Section "Testing"
<br />      Push $R0
<br />      Push $R1
<br />      StrCpy $R0 "PATH"
<br /><br />     ReadEnvStr $R1 "$R0"
<br />     MessageBox MB_OK "Before Modify Var: PATH = $R1"
<br /><br />     StrCpy $R1 "C:\MYAPP;$R1"
<br />     MessageBox MB_OK "Before Set Env Var: PATH = $R1"
<br /><br />     System::Call 'Kernel32::SetEnvironmentVariableA(t, t) i("$R0", "$R1").r0'
<br /><br />     ReadEnvStr $R1 "$R0"
<br />     MessageBox MB_OK "After Set and Get: PATH = $R1"
<br /><br />      Pop $R1
<br />      Pop $R0
<br />   SectionEnd 
<br />&gt;
</code>
</pre>
      <pre>
<code>Messages:<br />Before Modify Var: PATH = C:\Archivos de Programa\TextPad 4;P:\Bin_Unstable;D:\UTILES\MKSNT;C:\WINNT\System32;C:\WINNT;C:\WINNT\System32\WBem;"C:\Archivos de Programa\Norton\Ghost\";"C:\Archivos de programa\NullSoft\NSIS";D:\UTILES\COMP<br />---<br />Before Set Env Var: PATH = C:\MYAPP;C:\Archivos de Programa\TextPad 4;P:\Bin_Unstable;D:\UTILES\MKSNT;C:\WINNT\System32;C:\WINNT;C:\WINNT\System32\WBem;"C:\Archivos de Programa\Norton\Ghost\";"C:\Archivos de programa\NullSoft\NSIS";D:\UTILES\COMP<br />---<br />After Set and Get : PATH = </code>
</pre><br />
      <br />
      If I replace the system call with<br />
      <pre>
<code>
SetEnv:SetEnvVar "$R0" "$R1" 
</code>
</pre>It Works and the last message shows like<br />
      <pre>
<code>After Set and Get : PATH = C:\MYAPP;C:\Archivos de Programa\TextPad 4;P:\Bin_Unstable;D:\UTILES\MKSNT;C:\WINNT\System32;C:\WINNT;C:\WINNT\System32\WBem;"C:\Archivos de Programa\Norton\Ghost\";"C:\Archivos de programa\NullSoft\NSIS";D:\UTILES\COMP</code>
</pre><br />
      <br />
      <br />
      The file is the SetEnv Plugin, anybody knows how can i upload it to downloads section in the official page?<br />
      Thanks for everybody and...<br />
      ¡¡¡Saludos Totales!!!!<br />
      yeah!<br />
      <br />
      KiKoLo<br />
      NOTAS<br />
      NOTA 1: No tengo ni puta idea de C, pero con los ejemplos que tenian, y el msdn, no fue dificil hacerlo.<br />
      NOTA 2: Mi inglés es pésimo, está oxidado asi que si alguien no lo entiende, lo siento, es hasta donde puedo llegar<br />
      NOTA 3: Descomprimir quedando SenEnv como un directorio mas del Contrib debajo del NSIS (NSIS\Contrib\SetEnv) porque coge el ..\exdll\exdll.h y despues mover el setenv.dll a NSIS\Plugins<br />
      <br />
      NOTES<br />
      NOTE 1: I have no idea about C, but with the examples anda with the MSDN it does not be dificult to do.<br />
      NOTE 2: Sorry about my english :D<br />
      NOTE 3: Extract It on a Dir behind Contrib 'cause it take the ..\exdll\exdll.h and then move the setenv.dll to NSIS\Plugins
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">11th March 2003 08:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Please attach in .zip, because someone could not have the WinRAR program. (I don't have!)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kikolo</span><br />
      <span class="post-time small text-muted">11th March 2003 08:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">jeje, i don't have winzip :D<br />
      but a serious app like winrar give you the posibility to compress to an uneficient algorithm like winzip xDDDD (dont worry, is a joke)<br />
      I only have winrar 'cause it give me more flexibility and better ratios, but winzip is more... more... marketizing XD<br />
      Saludos Totales</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">11th March 2003 15:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The problem is that you have quotes inside that environment variable. You can use it this way:<br />
      <br /></p>
      <pre>
<code>StrCpy $R0 "name"
<br />&gt;StrCpy $R1 "value"
<br />&gt;System::Call 'Kernel32::SetEnvironmentVariableA(t, t) i(R0, R1).r0'
<br />&gt;StrCmp $0 0 error
<br />    Exec "other proggie.exe" 
</code>
</pre>Replace StrCpy with whatever function you need and it should work. If it doesn't try putting a dot before R0 and R1 in the System::Call line. Try one of them, and try both, not sure which one should work.
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
