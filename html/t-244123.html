<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Custom Page - Not displaying" />

  <title>Custom Page - Not displaying - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Custom Page - Not displaying</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=244123">Custom Page - Not displaying</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MrEyes</span><br />
      <span class="post-time small text-muted">21st April 2006 12:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Custom Page - Not displaying</strong><br />
      I am attempting to display a custom page in my installer but for some reason I cannot seem to get this to work. Interestingly this has worked using earlier versions of NSIS but since upgrade to the latest version it no longer works.<br />
      <br />
      The custom page asks the user for various details and then calls a custom function that uses these details. The reason for this seperation is that the installer also supports a silent install mode where the necessary values are passed as command line parameters.<br />
      <br />
      The following is an edited (but compilable) version of the script in question.<br />
      <br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">;</span><span style="color: #FF8000">########################################################<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">Includes<br /></span> <span style="color: #007700">;</span><span style="color: #FF8000">########################################################<br /></span> <span style="color: #007700">!include</span><span style="color: #DD0000">"Sections.nsh"<br /></span> <span style="color: #007700">!include</span><span style="color: #DD0000">"MUI.nsh"<br /></span> <span style="color: #007700">;-------------------------------------------------------<br />
      <br />
      ;</span><span style="color: #FF8000">########################################################<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">GeneralSettings<br /></span> <span style="color: #007700">;</span><span style="color: #FF8000">########################################################<br /></span> <span style="color: #0000BB">Name</span><span style="color: #DD0000">"${APPNAMEANDVERSION}"<br /></span> <span style="color: #0000BB">InstallDir</span><span style="color: #DD0000">"C:\TestCustomPage\"<br />
      OutFile"</span><span style="color: #0000BB">TestCustomPage</span><span style="color: #007700">.</span><span style="color: #0000BB">exe</span><span style="color: #DD0000">"<br />
      <br />
      ;vars<br />
      !defineAPPNAME"</span><span style="color: #0000BB">TestCustomPageApp</span><span style="color: #DD0000">"<br />
      !defineAPPNAMEANDVERSION"</span><span style="color: #0000BB">TestCustomPageApp1.0</span><span style="color: #DD0000">"<br />
      varSQL_DB_SERVERNAME<br />
      varSQL_DB_PASSWORD<br />
      varSQL_DB_USER<br />
      ;-------------------------------------------------------<br />
      <br />
      ;########################################################<br />
      ;Pages<br />
      ;########################################################<br />
      !defineMUI_ABORTWARNING<br />
      !insertmacroMUI_PAGE_WELCOME<br />
      !insertmacroMUI_PAGE_COMPONENTS<br />
      !insertmacroMUI_PAGE_INSTFILES<br />
      PagecustomGetDbDetails<br />
      !insertmacroMUI_PAGE_FINISH<br />
      ;-------------------------------------------------------<br />
      <br />
      ;########################################################<br />
      ;Setlanguages<br />
      ;########################################################<br />
      !insertmacroMUI_LANGUAGE"</span><span style="color: #0000BB">English</span><span style="color: #DD0000">"<br />
      !insertmacroMUI_RESERVEFILE_LANGDLL<br />
      ;-------------------------------------------------------<br />
      <br />
      ;########################################################<br />
      ;Section-ExecuteSQLScripts<br />
      ;########################################################<br />
      Section"</span><span style="color: #0000BB">InstallDatabaseData</span><span style="color: #DD0000">"sec_db_data<br />
      LogSeton<br />
      DetailPrint'Start-InstallingSQLScripts'<br />
      <br />
      MessageBoxMB_OK"</span><span style="color: #0000BB">InSectionsec_db_data</span><span style="color: #DD0000">"<br />
      <br />
      IfSilentsilentInstallationend<br />
      silentInstallation:<br />
      StrCpy$SQL_DB_SERVERNAME"</span><span style="color: #0000BB">127.0.0.1</span><span style="color: #DD0000">"<br />
      StrCpy$SQL_DB_PASSWORD"</span><span style="color: #0000BB">sa</span><span style="color: #DD0000">"<br />
      StrCpy$SQL_DB_USER"</span><span style="color: #0000BB">xxxxxxxxxxx</span><span style="color: #DD0000">";<br />
      CallInstallDb<br />
      gotoend<br />
      end:<br />
      DetailPrint'End-InstallingSQLScripts'<br />
      SectionEnd<br />
      ;--------------------------------------------------------<br />
      <br />
      <br />
      ;########################################################<br />
      ;Moderninstallsectiondescriptions<br />
      ;########################################################<br />
      !insertmacroMUI_FUNCTION_DESCRIPTION_BEGIN<br />
      !insertmacroMUI_DESCRIPTION_TEXT${sec_db_data}"</span><span style="color: #0000BB">InstallDatabase</span><span style="color: #007700">.</span><span style="color: #DD0000">"<br />
      !insertmacroMUI_FUNCTION_DESCRIPTION_END<br />
      ;--------------------------------------------------------<br />
      <br />
      ;########################################################<br />
      ;CUSTOMGUIPAGEFUNCTION(DBServerDetails)<br />
      ;########################################################<br />
      FunctionGetDbDetails<br />
      <br />
      MessageBoxMB_OK"</span><span style="color: #0000BB">In</span><span style="color: #007700">Function</span><span style="color: #0000BB">GetDbDetails</span><span style="color: #DD0000">"<br />
      <br />
      SectionGetFlags${sec_db_data}$R0<br />
      IntOp$R0$R0&amp;${SF_SELECTED}<br />
      IntCmp$R0${SF_SELECTED}show<br />
      Abort<br />
      <br />
      MessageBoxMB_OK"</span><span style="color: #0000BB">ShowingDBselection</span><span style="color: #DD0000">"<br />
      <br />
      ;;showthecustompage<br />
      show:<br />
      !insertmacroMUI_INSTALLOPTIONS_EXTRACT"</span><span style="color: #0000BB">DBSelection</span><span style="color: #007700">.</span><span style="color: #0000BB">ini</span><span style="color: #DD0000">"<br />
      !insertmacroMUI_HEADER_TEXT"</span><span style="color: #0000BB">DatabaseDetails</span><span style="color: #DD0000">""</span><span style="color: #0000BB">Enterdatabaseaccessdetailsbelow</span><span style="color: #007700">.</span><span style="color: #DD0000">"<br />
      !insertmacroMUI_INSTALLOPTIONS_DISPLAY"</span><span style="color: #0000BB">DBSelection</span><span style="color: #007700">.</span><span style="color: #0000BB">ini</span><span style="color: #DD0000">"<br />
      <br />
      ;;Gettheenteredvaluesintovars<br />
      !insertmacroMUI_INSTALLOPTIONS_READ$SQL_DB_SERVERNAME"</span><span style="color: #0000BB">DBSelection</span><span style="color: #007700">.</span><span style="color: #0000BB">ini</span><span style="color: #DD0000">""</span><span style="color: #0000BB">Field2</span><span style="color: #DD0000">""</span><span style="color: #0000BB">State</span><span style="color: #DD0000">"<br />
      !insertmacroMUI_INSTALLOPTIONS_READ$SQL_DB_USER"</span><span style="color: #0000BB">DBSelection</span><span style="color: #007700">.</span><span style="color: #0000BB">ini</span><span style="color: #DD0000">""</span><span style="color: #0000BB">Field4</span><span style="color: #DD0000">""</span><span style="color: #0000BB">State</span><span style="color: #DD0000">"<br />
      !insertmacroMUI_INSTALLOPTIONS_READ$SQL_DB_PASSWORD"</span><span style="color: #0000BB">DBSelection</span><span style="color: #007700">.</span><span style="color: #0000BB">ini</span><span style="color: #DD0000">""</span><span style="color: #0000BB">Field6</span><span style="color: #DD0000">""</span><span style="color: #0000BB">State</span><span style="color: #DD0000">"<br />
      <br />
      ;;calltheinstallDBfunction<br />
      CallInstallDb<br />
      FunctionEnd<br />
      ;--------------------------------------------------------<br />
      <br />
      <br />
      ;########################################################<br />
      ;FUNCTIONInstallDB<br />
      ;########################################################<br />
      FunctionInstallDb<br />
      DetailPrint'CheckingforthepresenceofworkingSQLusinggivenuserdetails'<br />
      <br />
      nsExec::ExecToStack'osql.exe-S$SQL_DB_SERVERNAME-P$SQL_DB_PASSWORD-U$SQL_DB_USER-dmaster-Q"</span><span style="color: #007700">print</span><span style="color: #0000BB">1</span><span style="color: #DD0000">"'<br />
      pop$R0<br />
      <br />
      StrCmp$R0"</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"0sqlNotFound<br />
      <br />
      DetailPrint'SQLinstancefoundlauchingDBinstallationscripts'<br />
      nsExec::ExecToLog/TIMEOUT=5000'$INSTDIR\SQLScripts\script_installer.bat$SQL_DB_SERVERNAME$SQL_DB_PASSWORD$SQL_DB_USER$INSTDIR\SqlScripts\$INSTDIR\logs\SqlInstallLogs\&gt;$INSTDIR\Logs\SqlInstallLogs\ScriptInstaller.log'<br />
      gotoend<br />
      <br />
      sqlNotFound:<br />
      DetailPrint"</span><span style="color: #0000BB">SQLinstancenotfoundusinggivendetails</span><span style="color: #007700">,</span><span style="color: #0000BB">abortingSQLinstallprocess</span><span style="color: #DD0000">";<br />
      <br />
      end:<br />
      FunctionEnd<br />
      ;--------------------------------------------------------<br /></span></span> <!-- php buffer end -->
      <hr />
      This is what I have in the DBSelection.ini file<br />
      <br />
      <pre>
<code><br />[Settings]<br />NumFields=6<br /><br />[Field 1]<br />Type=Label<br />Text=Database Server Name / IP<br />Left=0<br />Right=300<br />Top=10<br />Bottom=23<br /><br />[Field 2]<br />Type=Text<br />State=127.0.0.1<br />Left=0<br />Right=300<br />Top=23<br />Bottom=36<br /><br />[Field 3]<br />Type=Label<br />Text=SA Username<br />Left=0<br />Right=300<br />Top=54<br />Bottom=68<br /><br />[Field 4]<br />Type=Text<br />State=SA<br />Left=0<br />Right=300<br />Top=68<br />Bottom=82<br /><br />[Field 5]<br />Type=Label<br />Text=SA Password<br />Left=0<br />Right=300<br />Top=101<br />Bottom=115<br /><br />[Field 6]<br />Type=Text<br />State=xxxxxxxxxxx<br />Left=0<br />Right=300<br />Top=116<br />Bottom=130<br /></code>
</pre><br />
      For testing purposes I threw a few message boxes in, and these all display with the exception of the one after the SectionGetFlags code in GetDbDetails function.<br />
      <br />
      Can anybody tell me where I am going wrong here
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">21st April 2006 13:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">maybe I miss something here but I think you must place the installDb function as custom page leave function, don't call it from custom page create function. moreover you should try to init the dialog first and then load it (see InstallOptions examples)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">galil</span><br />
      <span class="post-time small text-muted">21st April 2006 16:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Re: Custom Page - Not displaying</strong><br /></p>

      <blockquote>
        <i>Originally posted by MrEyes</i><br />
        For testing purposes I threw a few message boxes in, and these all display with the exception of the one after the SectionGetFlags code in GetDbDetails function.
      </blockquote>That message box isn't going to be displayed ever, since it is in deadzone between Abort command and label "show".<br />
      <br />
      As for the problem itself, I don't know, script compiles (with 2.16) and works fine (as far as custom page is concerned) for me :weird:
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MrEyes</span><br />
      <span class="post-time small text-muted">21st April 2006 16:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The mystery deepens...<br />
      <br />
      I was using the logging special build of NSIS 2.15 and this wasnt working. I have just downloaded NSIS 2.16 and the logging version of makensis.exe and this doesnt work either.<br />
      <br />
      However, if I use the default no logging version of makensis.exe it works fine (after removing the logger calls).<br />
      <br />
      It seems that the logging special build is doing something it shouldnt, although it could just be me :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br />
      <span class="post-time small text-muted">22nd April 2006 23:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You are using wrong Stubs! Only using the log version of makensis.exe isn't enough. When you are using special makensis build you have to use the Stubs files what comes with the build.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
