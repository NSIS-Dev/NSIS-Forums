<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Working Installation CompletionTime function (uses NSISdt)"><title>Working Installation CompletionTime function (uses NSISdt) - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Working Installation CompletionTime function (uses NSISdt)</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=140427">Working Installation CompletionTime function (uses NSISdt)</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">28th June 2003 19:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Working Installation CompletionTime function (uses NSISdt)</strong><br>This is a new script to show the start and finish (completion) time for the installation process.<br>I was wondering if somone could help test it for me, just to be sure that there's nothing naff!<br><br><a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=11&amp;instances=0" target="_blank">http://nsis.sourceforge.net/archive/...11&amp;instances=0</a><br><br>Also, could the old "Report Installation Time at End" script on the Archive be removed, or blocked out, because that one does not work correctly (sometimes outputs minus values!)<br><br>Thanks<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">deguix</span><br><span class="post-time small text-muted">28th June 2003 19:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Is better use System.dll, because have an old bug in it (it adds +1 hour when is winter here - Brazil).<br><br>[EDIT]It works, but is not better to give user the chance to customize the result string, using more pops to pop the hour, minute and second?[/EDIT]</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">28th June 2003 19:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by deguix</i><br><b>Is better use System.dll, because have an old bug in it (it adds +1 hour when is winter here - Brazil).<br><br>[EDIT]It works, but is not better to give user the chance to customize the result string, using more pops to pop the hour, minute and second? [/EDIT]</b></blockquote>Yes that's a good idea! Will get onto that now.<br>About the 1 hour thing...<br>I was getting that too!<br>Is that my script or NSISdt?<br><br>Edit:<br>Added extra "output mode"<br>So, how would I get the 3 times (hours,mins,secs) using System, just like I have done with NSISdt (if that fixes the hour problem?)<br><br>-Stu</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">deguix</span><br><span class="post-time small text-muted">28th June 2003 19:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">NSISdt! Use this code to get all you need to use with System Plugin:<br><br>System::Call '*(&amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2) i .r1'<br>System::Call 'kernel32::GetLocalTime(i) i(r1)'<br>System::Call '*$1(&amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2)(.r6, .r5, .r4,, .r3, .r2, .r1,)'<br><br>;$1 = seconds<br>;$2 = minutes<br>;$3 = hours<br>;$4 = day<br>;$5 = month<br>;$6 = year<br><br>(Based on "Get Local Time" function, see my signature)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">28th June 2003 19:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks!<br>Is there a way to chop it down to just 3 variables (hours,mins,secs)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">deguix</span><br><span class="post-time small text-muted">28th June 2003 19:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">More one: the function have to calculate the days, months and years too, i.e. when I start the installation at 11:59 PM and end at 12:00 AM, will show negative numbers. So you have to remove the week day and miliseconds. I edited my previous post to it.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">28th June 2003 20:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This will make things a lot harder.<br>I think I know how to fix it though...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">28th June 2003 20:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Try now: <a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=339&amp;instances=0,11" target="_blank">http://nsis.sourceforge.net/archive/...instances=0,11</a><br>Notice the new Push.<br><br>I've added a few lines in to notice the change in hours/mins/secs etc.<br>I cannot test it right now (on a PC without NSIS)<br><br>I have a feeling there's something else that needs changing...<br><br>Also, I'm stall using NSISdt until I can use System to get just hours (in 24 hour format), mins and seconds.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">deguix</span><br><span class="post-time small text-muted">28th June 2003 20:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">To remove temporary the days, months and years remove .r4, .r5 and .r6 to don't use the variables $4, $5 and $6 (and preserve commas)! The hours using the code above are in 24h format too.<br><br>[EDIT]Have something wrong now with your function, are giving "24 hours, 60 mins, 60 secs". And is better to use the first version, not use anymore that additional push, because I forgot that can use "StrCpy" to customize the strings...[/EDIT]</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">28th June 2003 20:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok.<br>I will attempt to repair the function any minute now (when the other pc is free!)<br>Is it possible to get the day of the year usung System too?<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">28th June 2003 20:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok.<br>System::Call '*(&amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2) i .r1'<br>System::Call 'kernel32::GetLocalTime(i) i(r1)'<br>System::Call '*$1(&amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2) (, .r1, .r2, .r3,,,,,)'<br>detailprint "&gt;&gt;$3:$2:$1"<br>Output is: "&gt;&gt;28:6:6"<br><br>What's wrong?<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">deguix</span><br><span class="post-time small text-muted">28th June 2003 20:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Not. Have only to use milisecond, second, minute, hour, day, day of week (in number), month, year. But can make a function for it!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">28th June 2003 20:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I don't understand :(</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">deguix</span><br><span class="post-time small text-muted">28th June 2003 21:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I said no, and the only things that you can use with GetLocalTime API are: milisecond, second, minute, hour, day, day of week (in number), month and year. But you can make a function that does it.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">28th June 2003 21:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by deguix</i><br><b>I said no, and the only things that you can use with GetLocalTime are: milisecond, second, minute, hour, day, day of week (in number), month, year. But you can make a function that does it.</b></blockquote>Oh, I see!<br>So, whats up with the strange output I am getting?<br><br>With System I get 6 seconds, 6 minutes, and 28 hours for the current time!<br><br>-Stu</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">deguix</span><br><span class="post-time small text-muted">28th June 2003 21:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Wow, I'm blind, I do not saw that post. This is the right one code:<br><br>System::Call '*(&amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2) i .r1'<br>System::Call 'kernel32::GetLocalTime(i) i(r1)'<br>System::Call '*$1(&amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2)(,,,, .r3, .r2, .r1,)'<br><br>(I only inverted the position)<br><br>[EDIT]I fixed the code above, now is the RIGHT one! Tested and retested...:up:[/EDIT]</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">28th June 2003 22:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Works great now!<br>I ended up removing the option to only display seconds or minutes and seconds.<br>The reason is because;<br>if the installation took 1 min, 1 sec, then the completion time would be "1 sec."!<br><br>I could repair this, but it starts to get messy...<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">n0On3</span><br><span class="post-time small text-muted">29th June 2003 00:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>mmm...</strong><br>I read this thread quickly, but doesn't <a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=109&amp;instances=0,11" target="_blank">this</a> do the completion time?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">29th June 2003 09:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok, I will check this out a bit more.<br>When I tested, I was getting negative results.<br><br>Now, however, it seems to be working...<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">29th June 2003 09:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'll remove mine, because your's is better!<br>Would you like me to transfer your's to my function, with added functionality like "Output Options" where it simply displays Hours, Mins, or Seconds (3|2|1).<br><br>I will write the value ($R9) to the temp file and read it at the end so that $R9 does not get messed around with during the installation (like had happened to me)<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">29th June 2003 09:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This new function is good - it only uses 3 variables!<br>Here's what I ended up with...<br><br><b>Usage 1:</b><br># place this at the start of the first section<br>Push start ;signifies to start counting.<br>Push 0 ;output mode (for finish only)<br>Call CompletionTime<br>Pop $0 ;output (0 at start)<br><br><b>Usage 2:</b><br># place this at the end of the last section<br>Push finish ;signifies to finish &amp; output completion time<br>Push 1 ;output mode (1=secs|2=mins|3=hours)<br>Call CompletionTime<br>Pop $0 ;output (depends on output mode)<br><br><b>The Function:</b><br></p><pre>
<code>Function CompletionTime<br># // Original script by n0On3.<br># \\ Added Output Options, and Function style by Afrow UK.<br>Exch $R0 ;output mode<br>Exch<br>Exch $R1 ;start|finish<br>Push $R2<br><br>     WriteINIStr "$TEMP\completion_time.tmp" "Mode" "Value" "$R0"<br><br>  StrCpy $R2 0<br><br>StrCmp $R1 start 0 finish<br>  SetDetailsPrint "none"<br>   GetTempFileName $R0<br>    GetFileTime $R0 $R1 $R2<br>     Delete $R0<br><br>     WriteINIStr "$TEMP\completion_time.tmp" "Time" "Value" "$R2"<br><br>  SetDetailsPrint "both"<br>Goto exit<br><br>finish:<br>  SetDetailsPrint "none"<br>   GetTempFileName $R0<br>    GetFileTime $R0 $R1 $R2<br>     Delete $R0<br><br>     ReadINIStr $R0 "$TEMP\completion_time.tmp" "Time" "Value"<br><br>  IntOp $R2 $R2 - $R0<br>  IntOp $R2 $R2 / 10000000<br><br>     ReadINIStr $R0 "$TEMP\completion_time.tmp" "Mode" "Value"<br><br>      StrCmp $R0 1 +6 ;time in secs<br>      StrCmp $R0 2 0 +3<br>       IntOp $R2 $R2 / 60 ;time in mins<br>       Goto +3<br>      StrCmp $R0 3 0 +2<br>       IntOp $R2 $R2 / 60 ;time in mins<br><br>     Delete "$TEMP\completion_time.tmp"<br>  SetDetailsPrint "both"<br><br>exit:<br>  StrCpy $R0 $R2<br><br>Pop $R2<br>Pop $R1<br>Exch $R0<br>FunctionEnd</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">29th June 2003 13:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just found a small problem, fixed it.<br>
      Would you put this with your script or shall I put it over mine (on archive)?<br>
      <b>The Function:</b><br></p>
      <pre>
<code>Function CompletionTime<br># // Original script by n0On3.<br># \\ Added Output Options, and Function style by Afrow UK.<br>Exch $R0 ;output mode<br>Exch<br>Exch $R1 ;start|finish<br>Push $R2<br><br>     WriteINIStr "$TEMP\completion_time.tmp" "Mode" "Value" "$R0"<br><br>  StrCpy $R2 0<br><br>StrCmp $R1 start 0 finish<br>  SetDetailsPrint "none"<br>   GetTempFileName $R0<br>    GetFileTime $R0 $R1 $R2<br>     Delete $R0<br><br>     WriteINIStr "$TEMP\completion_time.tmp" "Time" "Value" "$R2"<br><br>  SetDetailsPrint "both"<br>Goto exit<br><br>finish:<br>  SetDetailsPrint "none"<br>   GetTempFileName $R0<br>    GetFileTime $R0 $R1 $R2<br>     Delete $R0<br><br>     ReadINIStr $R0 "$TEMP\completion_time.tmp" "Time" "Value"<br><br>  IntOp $R2 $R2 - $R0<br>  IntOp $R2 $R2 / 10000000<br><br>     ReadINIStr $R0 "$TEMP\completion_time.tmp" "Mode" "Value"<br><br>      StrCmp $R0 1 +6 ;time in secs<br>      StrCmp $R0 2 0 +3<br>       IntOp $R2 $R2 / 60 ;time in mins<br>       Goto +4<br>      StrCmp $R0 3 0 +3<br>       IntOp $R2 $R2 / 60 ;time in mins<br>       IntOp $R2 $R2 / 60 ;time in hours<br><br>     Delete "$TEMP\completion_time.tmp"<br>  SetDetailsPrint "both"<br><br>exit:<br>  StrCpy $R0 $R2<br><br>Pop $R2<br>Pop $R1<br>Exch $R0<br>FunctionEnd<br></code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">29th June 2003 14:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, the "Report Installation Time At The End" script only works on installation processes that take less than 60 seconds.<br>
      My process (map compile) took around 3345 seconds, and the script (above) reported the installation time as -87 seconds!<br>
      <br>
      I will keep my script, and add extra functionality for use in long processes.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">29th June 2003 20:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I think the final release is out now...<br>
      I re-wrote the script, to make it tidier (and it is too!)<br>
      <br>
      The Output Options is back too, and works perfectly.<br>
      The script still only works up to 24 hours (or before the next day)<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br>
      <span class="post-time small text-muted">30th June 2003 02:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">mmmm... I'll try to make it work for more than 60 seconds...</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">1st July 2003 14:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by n0On3</i><br>
        <b>mmmm... I'll try to make it work for more than 60 seconds...</b>
      </blockquote>I think it's 60 seconds...<br>
      Just put Sleep 61000 to see what happens.<br>
      <br>
      -Stu
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>