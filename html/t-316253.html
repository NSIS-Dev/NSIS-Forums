<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="nsDialogs and control Z-order" />

  <title>nsDialogs and control Z-order - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">nsDialogs and control Z-order</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=316253">nsDialogs and control Z-order</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">CrushBug</span><br />
      <span class="post-time small text-muted">14th January 2010 23:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>nsDialogs and control Z-order</strong><br />
      Greetings. I am trying to add an "Installation Help" link on the MUI 2 Welcome page.<br />
      <br />
      The first problem I had was the Link not showing up as blue and underlined. I fixed that and got the link appearing and functioning with the following code:<br />
      <br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">Function</span><span style="color: #0000BB">PageFunction_WelcomeShow<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">modifytheMUI2Welcomepageto</span><span style="color: #007700">include</span><span style="color: #0000BB">aninstallationhelplink<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">createtheinstallationhelplink<br /></span> <span style="color: #007700">${</span><span style="color: #0000BB">NSD_CreateLink</span><span style="color: #007700">}</span><span style="color: #0000BB">120u183u135u14u</span><span style="color: #DD0000">"$(Page_Welcome_Link)"<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">popthelabelHWNDoffofthestack<br />
      Pop$Link_InstallHelp<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">welcomepagefonts</span><span style="color: #007700">/</span><span style="color: #0000BB">colorsaredifferentfromotherpages</span><span style="color: #007700">,</span><span style="color: #0000BB">soforcethehelplinktoBlue</span><span style="color: #007700">and</span><span style="color: #0000BB">thecurrentMUIbackgroundcolor<br />
      SetCtlColors$Link_InstallHelp</span><span style="color: #DD0000">"0x000080""${MUI_BGCOLOR}"<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">fontshouldbeBluenow</span><span style="color: #007700">,</span><span style="color: #0000BB">butitwontbeunderlined</span><span style="color: #007700">,</span><span style="color: #0000BB">soweneedtofixit</span><span style="color: #007700">.<br /></span> <span style="color: #0000BB">CreateFont$Link_InstallHelp_font</span><span style="color: #DD0000">"$(^Font)""$(^FontSize)"</span><span style="color: #007700">/</span><span style="color: #0000BB">UNDERLINE<br />
      SendMessage$Link_InstallHelp</span><span style="color: #007700">${</span><span style="color: #0000BB">WM_SETFONT</span><span style="color: #007700">}</span><span style="color: #0000BB">$Link_InstallHelp_font0<br />
      <br />
      GetFunctionAddress$R0PageFunction_Welcome_LinkClick<br />
      nsDialogs</span><span style="color: #007700">::</span><span style="color: #0000BB">OnClick$Link_InstallHelp$R0<br />
      <br />
      FunctionEnd</span><span style="color: #007700">;</span><span style="color: #0000BB">PageFunction_WelcomeShow<br /></span></span> <!-- php buffer end -->
      <hr />
      The only problem I have is that it seems that the MUI Welcome label control extends down and slightly overlaps the link control that I have created.<br />
      <br />
      In other programming languages, I can use a .SendToFront command on a control to fix this, but after much searching and source code dumpster-diving, I haven't been able to figure it out in NSIS and MUI and nsDialogs.<br />
      <br />
      How does one send a control to the front on the MUI2 Welcome page via nsDialogs or with SendMessage? Is there some other solution I can use?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">15th January 2010 09:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Re: nsDialogs and control Z-order</strong><br /></p>

      <blockquote>
        How does one send a control to the front on the MUI2 Welcome page via nsDialogs or with SendMessage? Is there some other solution I can use?
      </blockquote>You can call any API command by calling the appropriate DLL function through the system plugin. But it is generally a bad idea to mess with window order, you're much better off calling the getwindowrect and setwindowpos functions to decrease the label size.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">CrushBug</span><br />
      <span class="post-time small text-muted">15th January 2010 17:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the reply. I will see what I can pull off with that.<br />
      <br />
      I still wish there was a SendToFront thing I could pull off, because I know it would solve the problem.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">15th January 2010 18:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">user32::SetWindowPos</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">CrushBug</span><br />
      <span class="post-time small text-muted">15th January 2010 20:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have tried this, but I can still see that the top of my Link text is being cut off<br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">Function</span><span style="color: #0000BB">PageFunction_WelcomeShow<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">modifytheMUI2Welcomepageto</span><span style="color: #007700">include</span><span style="color: #0000BB">aninstallationhelplink<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">createtheinstallationhelplink<br /></span> <span style="color: #007700">${</span><span style="color: #0000BB">NSD_CreateLink</span><span style="color: #007700">}</span><span style="color: #0000BB">120u183u135u14u</span><span style="color: #DD0000">"$(Page_Welcome_Link)"<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">popthelabelHWNDoffofthestack<br />
      Pop$Link_InstallHelp<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">welcomepagefonts</span><span style="color: #007700">/</span><span style="color: #0000BB">colorsaredifferentfromotherpages</span><span style="color: #007700">,</span><span style="color: #0000BB">soforcethehelplinktoBlue</span><span style="color: #007700">and</span><span style="color: #0000BB">thecurrentMUIbackgroundcolor<br />
      SetCtlColors$Link_InstallHelp</span><span style="color: #DD0000">"0x000080""${MUI_BGCOLOR}"<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">fontshouldbeBluenow</span><span style="color: #007700">,</span><span style="color: #0000BB">butitwontbeunderlined</span><span style="color: #007700">,</span><span style="color: #0000BB">soweneedtofixit</span><span style="color: #007700">.<br /></span> <span style="color: #0000BB">CreateFont$Link_InstallHelp_font</span><span style="color: #DD0000">"$(^Font)""$(^FontSize)"</span><span style="color: #007700">/</span><span style="color: #0000BB">UNDERLINE<br />
      SendMessage$Link_InstallHelp</span><span style="color: #007700">${</span><span style="color: #0000BB">WM_SETFONT</span><span style="color: #007700">}</span><span style="color: #0000BB">$Link_InstallHelp_font0<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">HACK</span><span style="color: #007700">!-try</span><span style="color: #0000BB">tosettheLinkcontroltothetop<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineSWP_NOSIZE0x0001<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineSWP_NOMOVE0x0002<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineHWND_TOPMOST</span><span style="color: #007700">-</span><span style="color: #0000BB">1<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"User32::SetWindowPos(i,i,i,i,i,i,i)b($Link_InstallHelp,${HWND_TOPMOST},0,0,0,0,${SWP_NOSIZE}|${SWP_NOMOVE})"<br />
      <br /></span> <span style="color: #0000BB">GetFunctionAddress$R0PageFunction_Welcome_LinkClick<br />
      nsDialogs</span><span style="color: #007700">::</span><span style="color: #0000BB">OnClick$Link_InstallHelp$R0<br />
      <br />
      FunctionEnd</span><span style="color: #007700">;</span><span style="color: #0000BB">PageFunction_WelcomeShow<br /></span></span> <!-- php buffer end -->
      <hr />
      I have also tried replacing ${SWP_NOSIZE}|${SWP_NOMOVE} with 3 and it still shows as cut off.<br />
      <br />
      I must still be missing something. I will try again later this afternoon.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">16th January 2010 18:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">you can't use topmost on a child window, try just hwnd_top</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">CrushBug</span><br />
      <span class="post-time small text-muted">17th January 2010 22:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you so much Anders; that was it. Here is the final working code. Maybe, once the project is shipped I will write this up for the wiki<br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">Function</span><span style="color: #0000BB">PageFunction_WelcomeShow<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">modifytheMUI2Welcomepageto</span><span style="color: #007700">include</span><span style="color: #0000BB">aninstallationhelplink<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">createtheinstallationhelplink<br /></span> <span style="color: #007700">${</span><span style="color: #0000BB">NSD_CreateLink</span><span style="color: #007700">}</span><span style="color: #0000BB">120u182u135u14u</span><span style="color: #DD0000">"$(Page_Welcome_Link)"<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">popthelabelHWNDoffofthestack<br />
      Pop$Link_InstallHelp<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">welcomepagefonts</span><span style="color: #007700">/</span><span style="color: #0000BB">colorsaredifferentfromotherpages</span><span style="color: #007700">,</span><span style="color: #0000BB">soforcethehelplinktoBlue</span><span style="color: #007700">and</span><span style="color: #0000BB">thecurrentMUIbackgroundcolor<br />
      SetCtlColors$Link_InstallHelp</span><span style="color: #DD0000">"0x000080""${MUI_BGCOLOR}"<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">fontshouldbeBluenow</span><span style="color: #007700">,</span><span style="color: #0000BB">butitwontbeunderlined</span><span style="color: #007700">,</span><span style="color: #0000BB">soweneedtofixit</span><span style="color: #007700">.<br /></span> <span style="color: #0000BB">CreateFont$Link_InstallHelp_font</span><span style="color: #DD0000">"$(^Font)""$(^FontSize)"</span><span style="color: #007700">/</span><span style="color: #0000BB">UNDERLINE<br />
      SendMessage$Link_InstallHelp</span><span style="color: #007700">${</span><span style="color: #0000BB">WM_SETFONT</span><span style="color: #007700">}</span><span style="color: #0000BB">$Link_InstallHelp_font0<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">movethesedefinestosomeplacebetterinyourcode<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineSWP_NOSIZE0x0001<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineSWP_NOMOVE0x0002<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineHWND_TOP0x0000<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">settheLinkcontrolontopoftheWelcomelabeltext<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"User32::SetWindowPos(i,i,i,i,i,i,i)b($Link_InstallHelp,${HWND_TOP},0,0,0,0,${SWP_NOSIZE}|${SWP_NOMOVE})"<br />
      <br /></span> <span style="color: #0000BB">GetFunctionAddress$R0PageFunction_Welcome_LinkClick<br />
      nsDialogs</span><span style="color: #007700">::</span><span style="color: #0000BB">OnClick$Link_InstallHelp$R0<br />
      <br />
      FunctionEnd</span><span style="color: #007700">;</span><span style="color: #0000BB">PageFunction_WelcomeShow<br /></span></span> <!-- php buffer end -->
      <hr />
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
