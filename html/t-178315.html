<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="RegisterTlb Function (for those who need this)"><title>RegisterTlb Function (for those who need this) - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">RegisterTlb Function (for those who need this)</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=178315">RegisterTlb Function (for those who need this)</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">stb</span><br><span class="post-time small text-muted">28th April 2004 21:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>RegisterTlb Function (for those who need this)</strong><br>It took me some time to learn System.dll and make this working, so I post it for anyone who may need this.<br><br>My motivation was to register stdole2.tlb as I install VB6 runtimes. Microsoft's installers (PDW and VSI) seem to register this, too. The NSIS archive tipp (how to install vb6 runtime) does not register this file, supplied version of UpgradeDll isn't able to do this.<br><br>It seems that on my PC (Windows XP) running this causes stdole2.tlb to be registered for the first time. But VB6 apps (and VB6 and Office) are installed already so I don't know whether it really is necessary or a "should do". Nevertheless: Here's the function including call example. I didn't test it widely yet but regarding to MSDN it should work on Win95 and newer.<br><br><font face="courier new"><br>...<br>Push "C:\WINDOWS\System32\stdole2.tlb"<br>Call RegisterTlb<br>...<br><br><br>Function RegisterTlb<br>Exch $R0 ; save old R0 and get filename as R0<br>Push $R1 ; save R1<br>Push $R2 ; save R2<br>; now register TLB file R0<br>StrCpy $R1 0 ; init R1 with 0 (maybe not neccessary)<br>System::Call "Oleaut32::LoadTypeLib(w, *i) i (R0, R1R1) .R2"<br>; R2 contains result, 0 if ok<br>IntCmp $R2 0 cont<br>LogText "LoadTypeLib returned $R2 with $R0"<br>; debug MessageBox MB_OK "LoadTypeLib returned $R2 with $R0"<br>Goto exit<br>cont:<br>; now R1 contains pointer to typelib<br>System::Call "Oleaut32::RegisterTypeLib(i, w, i) i (R1, R0, 0) .R2"<br>; R2 contains result, 0 if ok<br>IntCmp $R2 0 exit<br>LogText "RegisterTypeLib returned $R2 with $R1, $R0"<br>; debug MessageBox MB_OK "RegisterTypeLib returned $R2 with $R1, $R0"<br>exit:<br>;; debug MessageBox MB_OK "RegisterTlb: all ok"<br>Pop $R2 ; R2 restore<br>Pop $R1 ; R1 restore<br>Pop $R0 ; R0 restore<br>FunctionEnd<br></font></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">1st May 2004 20:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Please create an <a href="http://nsis.sf.net/archive" target="_blank">archive</a> page for it.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>