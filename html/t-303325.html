<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Timing issue using ExecWait in Uninstall section"><title>Timing issue using ExecWait in Uninstall section - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Timing issue using ExecWait in Uninstall section</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=303325">Timing issue using ExecWait in Uninstall section</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">zoomzoom</span><br><span class="post-time small text-muted">21st February 2009 00:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Timing issue using ExecWait in Uninstall section</strong><br>hi all,<br><br>i'm having a timing issue with ExecWait in the uninstall section.<br><br>the first ExecWait calls the Apache Tomcat uninstaller. The second calls MSI to uninstall java.<br><br>PROBLEM 1): ExecWait doesn't wait. Both the tomcat uninstaller and java uninstaller launches at the same time. I want tomcat to uninstall and when complete, then have the java uninstaller called, then RMDir the java directory.<br><br>PROBLEM 2): Since both uninstallers are called at the same time, if i click 'ok' for both uninstallers, they complete successfully and then the ExecWait for java is called again!? it's as if ExecWait completed and then looped back ran the java uninstaller again...<br><br>Thanks again in advance for your help!<br><br><br>----The following is in the 'Section Uninstall'----<br><br>;---CALL TOMCAT UNINSTALLER<br>ExecWait 'C:\Apache\Tomcat50\Uninstall.exe'<br><br>;---CALL JAVA UNINSTALLER<br>ExecWait 'MsiExec.exe /X{26A24AE4-039D-4CA4-87B4-2F83216011FF}'<br>RMDir "C:\Convio\Java"</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">zoomzoom</span><br><span class="post-time small text-muted">21st February 2009 00:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">So this might not be the best solution:<br>but for removing the directories after the two (apache and java) uninstallers are complete, i placed my 'RMDir' lines within the 'Function un.onUninstSuccess' and used a messagebox (which displays behind the two uninstaller windows) as a delay. So, the Apache uninstaller/ Java uninstallers are running, when they finish user hits 'done' and then sees the messagebox they hit 'ok' and then the 'Apache' and 'Java' dir. are removed.<br><br>Although RMDir "$INSTDIR" doesn't work (it's empty)...<br><br>And i can't seem to figure out why the apache and tomcat installers get called simultaneously and twice?<br><br><br>----<br>Function un.onUninstSuccess<br>MessageBox MB_OK "$(^Name) was successfully removed from your computer."<br>RMDir "C:\Apache"<br>RMDir "C:\Java"<br>RMDir "$INSTDIR"<br>FunctionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br><span class="post-time small text-muted">21st February 2009 01:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>PROBLEM 1): ExecWait doesn't wait.</blockquote>If ExecWait doesn't wait, then this probably means:<br>The executable you run (e.g. the Tomcat uninstaller) runs another executable and exits.<br>NSIS only waits for the first process to terminate, it does NOT wait for any child processes!<br><br>Also this is a common behavior of uninstallers:<br>When you run "uninstall.exe" it will copy itself to %TEMP% and execute that copy.<br>The copy will perform the actual uninstall, so the original "uninstall.exe" can be deleted.<br>NSIS uninstallers work that way too!</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">zoomzoom</span><br><span class="post-time small text-muted">21st February 2009 01:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">right. why the "double call"? so both ExecWait's get called (the tomcat uninstall is built with NSIS!), after they complete and i hit 'ok', the second ExecWait command is called again, prompting me if i want to uninstall java, then it fails if i hit 'ok' since java isn't present anymore...<br><br>thanks!<br><br><br>ExecWait 'C:\Apache\Tomcat50\Uninstall.exe'<br>ExecWait 'MsiExec.exe /X{26A24AE4-039D-4CA4-87B4-2F83216011FF}'</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">zoomzoom</span><br><span class="post-time small text-muted">21st February 2009 01:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">what about this:<br><br>since 'Function un.onUninstSuccess; gets called after 'Uninstall section', i could call the tomcat uninstaller in the 'Uninstall section' then call the java uninstall in the 'Function un.onUninstSuccess'.... do you foresee any problems or a better way to do the above?<br><br>thanks so much for the quick replies!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br><span class="post-time small text-muted">21st February 2009 02:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by zoomzoom</i><br><b>right. why the "double call"?</b></blockquote>As explained before: When you run the Uninstaller executable, it may launch another executable and then terminate immediately. Then only the child process is still running. But the process created by NSIS has terminated. Hence ExecWait will return! Many uninstallers work like that: As "Uninstall.exe" is usually located in the install folder, the uninstaller cannot remove the install folder, as long as "Uninstall.exe" is still running. Or in other words: The uninstaller cannot delete itself. To solve the problem: The uninstaller will copy itself (or some helper application) to %TEMP% and then exit. Now the second process (located in %TEMP%) will perform the actual uninstall. This way the entire install folder can be removed, including the "Uninstaller.exe" file, as that file isn't running any longer...<br><br>I assume that Tomcat's uninstaller works exactly like that ;)<br><br><br><blockquote><i>Originally posted by zoomzoom</i><br><b>what about this:<br><br>since 'Function un.onUninstSuccess; gets called after 'Uninstall section', i could call the tomcat uninstaller in the 'Uninstall section' then call the java uninstall in the 'Function un.onUninstSuccess'.... do you foresee any problems or a better way to do the above?<br><br>thanks so much for the quick replies!</b></blockquote>I don't see the sense in this. Sounds like an ugly workaround.<br><br>Better analyze the Tomcat uninstaller and find a method to call it in a proper way...</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">zoomzoom</span><br><span class="post-time small text-muted">22nd February 2009 06:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">is it possible to do the equivalent of 'ExecWait' on a function call.<br><br>for example: ExecWait FunctionBlah<br><br>thanks!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">22nd February 2009 07:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Call already does this. You actually can't do the opposite. There's no "Exec FunctionBlah".</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">zoomzoom</span><br><span class="post-time small text-muted">23rd February 2009 19:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">so the Tomcat uninstaller called 'nsexec' a couple times, thus the reason why 'execwait tomcatUninstaller' didn't wait.<br><br>i ended up adding a function to uninstall tomcat (instead of calling the tomcat uninstaller). this was easy because apache makes their nsis script available, so i could see how they wrote the uninstall script and adapt it as needed.<br><br>however, if i didn't have access to the tomcat script, i'm not sure how one would get around 'execwait' not working in this type of parent/child process scenario...<br><br>thanks all for your help!!</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>