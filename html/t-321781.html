<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Show MessageBox during ExecWait and close when finished?" />

  <title>Show MessageBox during ExecWait and close when finished? - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Show MessageBox during ExecWait and close when finished?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=321781">Show MessageBox during ExecWait and close when finished?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Netsurfer24</span><br />
      <span class="post-time small text-muted">18th August 2010 15:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Show MessageBox during ExecWait and close when finished?</strong><br />
      Hi,<br />
      <br />
      I am thinking about an option of which I am not certain if it is possible?<br />
      <br />
      I would like to show up a (top-most) messagebox (with a progressbar if possible) while there are several operations being executed via ExecWait.<br />
      <br />
      When they are finished the messagebox should be closed and the user may proceed with the "normal" installer page.<br />
      <br />
      Is it possible?<br />
      If so, how?<br />
      <br />
      Thanks,<br />
      <br />
      Gunther</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">18th August 2010 15:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Look at the banner plugins. NXS has a progress bar, for example.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Netsurfer24</span><br />
      <span class="post-time small text-muted">18th August 2010 22:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">MSG,<br /></p>

      <blockquote>
        <small>Originally posted by MSG</small><br />
        Look at the banner ...
      </blockquote>thanks for the right keyword.<br />
      <br />
      But as I do not want to use any additional files, I wonder if it would be possible to achieve the goal by another way?<br />
      <br />
      Maybe my idea wasn't the best.<br />
      <br />
      So here is what I want to achieve:<br />
      On a custom page of my installer the user has the option to scan his whole HDD. And as this may take up to several minutes without showing any progress on the page (frozen) I would like to indicate the user that the installer is still working (and not crashed).<br />
      <br />
      Also the page does not get updated until the locate function finished.<br />
      Therefor I thought of some kind of "splashscreen" or messagebox. And as a maximum of comfort including a progressbar to indicate the activity.<br />
      <br />
      Any ideas how to do this best, or the easiest way?<br />
      <br />
      Thanks,<br />
      <br />
      Gunther
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">19th August 2010 00:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What do you mean by additional files... third party? Use the Banner plug-in included with NSIS?<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Netsurfer24</span><br />
      <span class="post-time small text-muted">19th August 2010 00:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Stu,<br /></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        Use the Banner plug-in included with NSIS?
      </blockquote>thanks for the hint.<br />
      <br />
      I guess I should go to bed ..., if I can't find out myself that there is a plugin included in the NSIS package.<br />
      <br />
      I was somehow "irritated" by the tip to use the NXS plugin - sorry.<br />
      <br />
      Thanks,<br />
      <br />
      Gunther
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Netsurfer24</span><br />
      <span class="post-time small text-muted">19th August 2010 11:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">New day - new question(s) ... :p<br />
      <br />
      I now use the included Banner plug-in with this code:<br /></p>
      <pre>
<code>Banner</code><span style="color: #007700">::</span><span style="color: #0000BB">show</span><span style="color: #007700">/</span><span style="color: #0000BB">NOUNLOAD</span><span style="color: #007700">/</span><span style="color: #0000BB">set76</span><span style="color: #DD0000">"ScanningHDD..."""
<br /></span><span style="color: #0000BB">Banner</span><span style="color: #007700">::</span><span style="color: #0000BB">getWindow</span><span style="color: #007700">/</span><span style="color: #0000BB">NOUNLOAD
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br />GetDlgItem</span><span style="color: #007700">$</span><span style="color: #0000BB">2</span><span style="color: #007700">$</span><span style="color: #0000BB">11030
<br /><br /></span><span style="color: #007700">...
<br /><br /></span><span style="color: #0000BB">Banner</span><span style="color: #007700">::</span><span style="color: #0000BB">destroy
<br /></span>

<!-- php buffer end -->
                
                
                
</pre>
      <hr />
      <pre>
        
So far so good.<br /><br />Tha bad thing at the moment is, that if you click somewhere outside of the banner, it disappears (and can't be shown again).<br /><br />Therefor I would like to
</pre>

      <ol style="list-style-type: decimal">
        <li>hide the "normal" installer window</li>

        <li>show only the banner</li>
      </ol>
      <pre>
<br />I tried things like<br />        PHP Code:
        
                
</pre>
      <hr />
      <pre>
                <code style="white-space:nowrap">
                
                        <!-- php buffer start --></code><span style="color: #000000">
<span style="color: #0000BB">Banner</span><span style="color: #007700">::</span><span style="color: #0000BB">getWindow</span><span style="color: #007700">/</span><span style="color: #0000BB">NOUNLOAD
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br />GetDlgItem</span><span style="color: #007700">$</span><span style="color: #0000BB">2</span><span style="color: #007700">$</span><span style="color: #0000BB">11030
<br />BringToFront
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"User32::SetWindowPos(i,i,i,i,i,i,i)b($1,-1,0,0,0,0,${SWP_NOMOVE}|${SWP_NOSIZE})"
</span></span>
</pre>to make the banner a top-most window, but with no success.<br />
      <br />
      Just to check if I got it right:<br />
      The banner (window) is a second window, which is independent from the "normal" installer window, right?<br />
      If so, what do I have to do to hide (or lock at least) the normal installer window and just show the banner window (as top-most)?<br />
      <br />
      Thanks for any help,<br />
      <br />
      Gunther
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">19th August 2010 11:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Netsurfer24</small><br />
        Tha bad thing at the moment is, that if you click somewhere outside of the banner, it disappears (and can't be shown again).
      </blockquote>This is not supposed to happen. Can you show a minimal script that demonstrates this effect?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Netsurfer24</span><br />
      <span class="post-time small text-muted">19th August 2010 11:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by MSG</small><br />
        This is not supposed to happen. Can you show a minimal script that demonstrates this effect?
      </blockquote>Take the code I posted in #6 (<a href="http://forums.winamp.com/showpost.php?p=2689685&amp;postcount=6" target="_blank">http://forums.winamp.com/showpost.ph...85&amp;postcount=6</a>) in the first box and use it on any custom page. Add i.e. a function call to a locate function inbetween.<br />
      <br />
      The banner is shown, but if you click outside the banner it disappears.<br />
      <br />
      Addition 1:<br />
      The problem seems to be that when clicking inside the installer window it does not response. So after a second click in the window title the system message "(no response)" (sorry, don't know how it is called in English as I use German locale. But it is the system message when a program hangs or does not respond) appears and the banner disappears.<br />
      <br />
      Gunther<br />
      <br />
      PS: Is there any other documentation of the Banner plug-in than <a href="http://nsis.sourceforge.net/Docs/Banner/Readme.txt" target="_blank">http://nsis.sourceforge.net/Docs/Banner/Readme.txt</a>?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">19th August 2010 12:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Netsurfer24</small><br />
        Take the code I posted in #6
      </blockquote>I doubt that very much. Have you tried a minimal installer with only that code?<br />
      <br />

      <blockquote>
        <small>Originally posted by Netsurfer24</small><br />
        Is there any other documentation of the Banner plug-in than <a href="http://nsis.sourceforge.net/Docs/Banner/Readme.txt" target="_blank">http://nsis.sourceforge.net/Docs/Banner/Readme.txt</a>?
      </blockquote>There are examples in your Examples directory.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Netsurfer24</span><br />
      <span class="post-time small text-muted">19th August 2010 13:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Update ...<br />
      <br />
      I came a little further ...<br />
      <br />
      I simplified the code to:<br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #0000BB">Banner</span><span style="color: #007700">::</span><span style="color: #0000BB">show</span><span style="color: #007700">/</span><span style="color: #0000BB">NOUNLOAD</span><span style="color: #007700">/</span><span style="color: #0000BB">set76</span><span style="color: #DD0000">"ScanningHDD...""Scaninprogress"<br /></span> <span style="color: #0000BB">Banner</span><span style="color: #007700">::</span><span style="color: #0000BB">getWindow</span><span style="color: #007700">/</span><span style="color: #0000BB">NOUNLOAD<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">1<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"User32::SetWindowPos(i$1,i-1,i0,i0,i0,i0,i83)"<br /></span> <span style="color: #0000BB">HideWindow<br /></span> <span style="color: #007700">...<br /></span> <span style="color: #0000BB">ShowWindow$HWNDPARENT</span><span style="color: #007700">${</span><span style="color: #0000BB">SW_SHOW</span><span style="color: #007700">}<br /></span> <span style="color: #0000BB">BringToFront<br />
      Banner</span><span style="color: #007700">::</span><span style="color: #0000BB">destroy<br /></span></span> <!-- php buffer end -->
      <hr />
      This is (mainly) what I wanted to achieve! :)<br />
      <br />
      When the function is called the<br />
      - installer window is hidden<br />
      - the banner is shown up and set to topmost (by the second parameter set to -1) and window is deactivated (last parameter set to to 83 which is<br />
      SWP_NOSIZE 0x0001<br />
      SWP_NOMOVE 0x0002<br />
      SWP_NOACTIVATE 0x0010<br />
      SWP_SHOWWINDOW 0x0040<br />
      <br />
      When the subfunction has finished the installer window is shown again and the banner is destroyed.<br />
      <br />
      BringToFront at least brings the installer window back to front :p just in case the user has clicked in the meanwhile because then the focus got lost.<br />
      <br />

      <blockquote>
        There are examples in your Examples directory.
      </blockquote>Yes I know. This example shows "nothing" - not even a sample for the things mentioned in the Readme like<br />

      <blockquote>
        Some More Tricks<br />
        ----------------<br />
        <br />
        If you use /set to set the main string (IDC_STR, 1030) you can specify a different string for the window's caption and for the main string.<br />
        <br />
        If you use an empty string as the main string (Banner::show "") the banner window will not show on the taskbar.
      </blockquote>I have the opposite question: How will the banner window be shown on the taskbar?<br />
      <br />
      At the moment it is not shown. So during the banner is shown there is no entry on the taskbar, just in the task manager (ALT + Tab).<br />
      <br />
      Thanks,<br />
      <br />
      Gunther
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">19th August 2010 13:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You should be setting the WS_EX_TOPMOST style instead. You can use the nsDialogs macro to do this. The banner will show in the task bar when used in a silent install.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Netsurfer24</span><br />
      <span class="post-time small text-muted">19th August 2010 13:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Stu,<br /></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        You should be setting the WS_EX_TOPMOST style instead. You can use the nsDialogs macro to do this.
      </blockquote>What's the difference to my method?<br />
      MS says

      <blockquote>
        WS_EX_TOPMOST Specifies that a window created with this style should be placed above all nontopmost windows and stay above them even when the window is deactivated. An application can use the SetWindowPos member function to add or remove this attribute.
      </blockquote>Sounds to me equal to my setting, or not?<br />
      <br />

      <blockquote>
        The banner will show in the task bar when used in a silent install.
      </blockquote>Only in a silent install, or is there a way to also show it up when the installer window is hidden?<br />
      <br />
      Gunther
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">19th August 2010 14:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Setting the flag is more elegant in my opinion. As for showing the application in the task bar you need to set the WS_EX_APPWINDOW style before showing the window (if the window is already shown you need to hide it, set WS_EX_APPWINDOW and show it again).<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Netsurfer24</span><br />
      <span class="post-time small text-muted">19th August 2010 17:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Stu,<br />
      <br />
      thanks for your helpful reply (as always).<br /></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        Setting the flag is more elegant in my opinion.
      </blockquote>Ah, OK. Thought I understood something wrong ...<br />
      <br />

      <blockquote>
        As for showing the application in the task bar you need to set the WS_EX_APPWINDOW style before showing the window (if the window is already shown you need to hide it, set WS_EX_APPWINDOW and show it again).
      </blockquote>Hmmm ..., I have read on the MSDN site, googled and found another thread here in the forum (<a href="http://forums.winamp.com/showpost.php?p=1047774&amp;postcount=11" target="_blank">http://forums.winamp.com/showpost.ph...4&amp;postcount=11</a>), but I still have not figured out how to this with the banner window - sorry.<br />
      <br />
      The banner window is created by Banner::show and if I got you right, I have to add the

      <blockquote>
        style before showing the window
      </blockquote>. But how to do this? If the window does not exist yet, I can't get it's handle (because there is none). And without the handle where to set the style to? :confused:<br />
      <br />
      Would be very kind of you (or somebody else) if could just explain this a little more :) - thanks!<br />
      <br />
      Gunther
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">19th August 2010 19:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've already explained you can set the (extended) styles using nsDialogs. I have looked it up for you and you want ${NSD_AddExStyle}. You already have a handle to the window as you used it for the SetWindowPos alternative. As for your last question, did you miss the last part of my post? You need to hide the window (ShowWindow with ${SW_HIDE}), set the extended style, and then show it again (${SW_SHOW}) if the window is already visible.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Netsurfer24</span><br />
      <span class="post-time small text-muted">19th August 2010 20:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Stu,<br />
      <br />
      thanks a lot - it works!<br />
      Please keep in mind that I am totally new to NSIS. It's the first time I get in touch with it. And as I am more a webdeveloper I also have little to no knowledge of any kind of Windows programming (VB, C#, C++). Therefor some things take a little longer ...!<br />
      <br />
      But with the great help of this forum and its users I managed every problem up to now.<br />
      <br />
      There is only one small blemish left.<br />
      As the banner window now shows on the taskbar, the shown name is handle ID. How can I change this i.e. to the name of the installer?<br />
      <br />
      Thanks,<br />
      <br />
      Gunther<br />
      <br />
      PS: Do I also have (or is it possible) to use the nsDialogs macros if I want to (ex)change the icon (ID 103) of the banner?<br />
      Is it ${NSD_ClearIcon} and ${NSD_SetIcon}? Has the icon to be cleared first?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">19th August 2010 21:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try setting the caption of the banner using NSD_SetText.<br />
      <br />
      You don't need to clear the image first. That is just if you don't want to show it anymore. You should use NSD_FreeIcon on the icon handle though in .onGUIEnd but this isn't entirely necessary.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
