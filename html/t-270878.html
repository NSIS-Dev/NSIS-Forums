<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Vista Games Explorer and Media Center" />

  <title>Vista Games Explorer and Media Center - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Vista Games Explorer and Media Center</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=270878">Vista Games Explorer and Media Center</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Skrapion</span><br />
      <span class="post-time small text-muted">9th May 2007 02:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Vista Games Explorer and Media Center</strong><br />
      Hello all!<br />
      <br />
      I've written a plug-in to aid in registering a game with Vista's new Games explorer as well as the Games section of Windows Media Center. I've already uploaded and documented it on the <a href="http://nsis.sourceforge.net/Games_plug-in" target="_blank">wiki</a>, so now I'm just letting you guys know about it.<br />
      <br />
      If anybody wants to help me out, the one thing I can't test is whether the game gets registered properly with Media Center on a 64-bit version of Windows with a 32-bit installer. Any reports are appreciated!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">9th May 2007 02:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Working url: <a href="http://nsis.sourceforge.net/Games_plug-in" target="_blank">http://nsis.sourceforge.net/Games_plug-in</a><br />
      <br />
      Looks good, there was a thread about the game explorer already, but it was using the system dll. A plugin for something is always helpful<br />
      <br />
      One little thing, I thought the official way to restore mediacenter was to run %systemroot%\eHome\ehShell.exe and not looking for its window</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Skrapion</span><br />
      <span class="post-time small text-muted">9th May 2007 03:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yep, I know about the other thread you're talking about. I originally started working with that code, but I wanted it to load the information directly from the embedded GDF instead of having to specify it twice, and after a while of trying to do that with the system dll I realized that it was getting ridiculous and made much more sense to do it as a plug-in.<br />
      <br />
      I've also read the ehShell.exe approach you're talking about. For reference, it's documented here: <a href="http://msdn2.microsoft.com/en-us/library/ms977646.aspx" target="_blank">http://msdn2.microsoft.com/en-us/library/ms977646.aspx</a><br />
      <br />
      Note to anybody reading that code: IsMediaCenter() doesn't actually exist. They don't actually say this, but they want you to write that function yourself and use your own method for figuring out whether or not the game was launched from Media Center.<br />
      <br />
      I could have gotten away with launching ehShell.exe at exit when I wrote MCEWrapper, but originally I tested my code directly in one of our games, and the advantage with the method I used is that it works even when you don't know when your game was launched from Media Center, so that's what I would suggest if you were building it directly into your game.<br />
      <br />
      I found that approach from this blog post by Aaron Stebner, the Program Manager of Windows Media Center: <a href="http://blogs.msdn.com/astebner/archive/2007/01/07/mailbag-how-to-launch-an-exe-from-within-windows-media-center.aspx" target="_blank">http://blogs.msdn.com/astebner/archi...ia-center.aspx</a><br />
      <br />
      Hopefully he knows what he's talking about. (Not that I have the greatest opinion about how Media Center was written...)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">9th May 2007 03:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The findwindow approach is only slightly better, media center could be running but that doesnt mean your game was started from MCE. Putting MCE code in your app is silly anyway, but if you had to do it, you could pass some argument to the game to tell if it was started from MCE. For MCEWrapper it doesnt really matter what you do I guess. And I agree about MCE, it could be so much better than it is now</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Skrapion</span><br />
      <span class="post-time small text-muted">9th May 2007 03:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I agree with everything you said &gt;:)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Skrapion</span><br />
      <span class="post-time small text-muted">10th May 2007 08:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">After some testing on Windows XP, it seems the FindWindow method doesn't return Media Center to fullscreen mode.<br />
      <br />
      I've uploaded and new version that fixes that as well as other XP-related bugs, and reduced the footprint a little. I've also updated the Wiki page accordingly.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">10th May 2007 09:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">In my MCE controller app, I do SNDMSG(hMCE,WM_SYSCOMMAND,SC_MAXIMIZE,0); seems to work on XP, not really tested on Vista</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Skrapion</span><br />
      <span class="post-time small text-muted">10th May 2007 09:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That looks like it would work, but wouldn't it maximize Media Center after you've exited your game, even if you had it in window mode beforehand?<br />
      <br />
      Granted, that would be a relatively minor gripe, since Media Center is intended to be used in fullscreen mode.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">10th May 2007 16:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yeah, I don't have the code in front of me right now, Im probably checking for WS_MAXIMIZE style or something like that to decide what message to send</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">3rd June 2007 20:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">the dll failes loading on my vista business installation while it just exits with error code 0, like documented, on xp pro sp2.<br />
      <br />
      what's wrong with it?<br />
      <br />
      nsis can't load the dll on runtime on vista, it says.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">4th June 2007 06:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The DLL posted on the Wiki depends on MSVCR80.dll. It should be recompiled statically, or better yet, without the CRT.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">4th June 2007 15:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">static recompilation gave me a 120kb file.<br />
      <br />
      thats ok for me, because it doesn't really matter in an 13mb game installer.<br />
      <br />
      yet it should of course not waste that much space if unnecessary.<br />
      <br />
      i would appreciate any optimization on this one.<br />
      <br />
      <br />
      <br />
      also, though i now got it running, it failes on registering my game.<br />
      <br />
      i have a valid GDF file, but the error message is "could not add or update game"<br />
      <br />
      skrapion, you got any hint on what may be wrong?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Skrapion</span><br />
      <span class="post-time small text-muted">4th June 2007 17:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Most likely it means you already registered the game on that machine, and then changed the GUID in your GDF. Use regedit to delete any old and invalid keys from this location:<br />
      <br />
      HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\GameUX\Games\{Whatever your GUIDs are}<br />
      <br />
      I'll look into the dependency. I thought I'd got them all sorted out, but you know how it is.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Navarr</span><br />
      <span class="post-time small text-muted">3rd August 2007 00:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Can't seem to get it to work!</strong><br />
      I just can't seem to get it to work. I know the GDF is embedded (I checked using a resource editor) and I know the GDF is properly formatted (made using the GDF maker) and it seems to be all well and good.<br />
      <br />
      The only thing in the exe is the GDF file, so, I don't know if there is a way to check for errors; so I only added an ${Else} to echo out if it doesn't register; and the game just won't register.<br />
      <br />
      Using this code...<br />
      <br /></p>
      <pre>
<code>        Games::registerGame "$INSTDIR\pokequest.exe"<br />        pop $0<br />        ${If} $0 != "0"<br />        ${AndIf} $0 != ""<br />                MessageBox MB_OK "Game Registered!!!"<br />                CreateDirectory "$0\PlayTasks\0"<br />                CreateShortCut "$0\PlayTasks\0\Play.lnk" "$INSTDIR\pokequest.exe"<br />                CreateDirectory "$0\SupportTasks\0"<br />                CreateShortCut "$0\SupportTasks\0\Home Page.lnk" "http://pokequest.gtaero.net/"<br />                CreateDirectory "$0\SupportTasks\1"<br />                CreateShortCut "$0\SupportTasks\1\Forums.lnk" "http://pokequest.gtaero.net/forum"<br />        ${Else}<br />                MessageBox MB_OK "Game Not Registered! @.@;;"<br />        ${EndIf}</code>
</pre><br />
      <br />
      and I get back "Game Not Registered! @.@;;" every time! I checked using regedit and found that there is no data in the registry for my game.<br />
      <br />
      What is the problem? Does anyone know, can anyone help me?<br />
      <br />
      [pokequest [dot] gtaero [dot] net/pokequest.exe] for reference. (It literally does nothing and wont even run without cygwin1.dll, all it has is the GDF embedded)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Skrapion</span><br />
      <span class="post-time small text-muted">3rd August 2007 02:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What is the value in $0? Is it "0" (indicating that there was an error) or "" (indicating that the target machine isn't Windows Vista)?<br />
      <br />
      If it's "", and your machine is Windows Vista, then there's probably a bug in the plugin.<br />
      <br />
      If it's "0", then check your log messages, because it should give you a better error message there.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Navarr</span><br />
      <span class="post-time small text-muted">3rd August 2007 02:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Skrapion</i><br />
        <b>What is the value in $0? Is it "0" (indicating that there was an error) or "" (indicating that the target machine isn't Windows Vista)?<br />
        <br />
        If it's "", and your machine is Windows Vista, then there's probably a bug in the plugin.<br />
        <br />
        If it's "0", then check your log messages, because it should give you a better error message there.</b>
      </blockquote>Okay; EDIT; I checked the log; and it seems that its failing to find the GDF embedded. As far as I know; the GDF is embedded, and it seems to be embedded correctly in the EXE file. I'll run a check installing the "bejewled.exe" file using NSIS to see if it does the same or if it works...<br />
      <br />
      <b>FOLLOWUP:</b> I used the Bejeweled.exe from PopCap Games, and it gives a problem. "The following error occurred while parsing the GDF data embedded in 'C:\Program Files\pokequest\pokequest.exe'<br />
      Error document empty."<br />
      <br />
      <b>FOLLOWUP:</b> I found a problem in the EXE, not having the resource named correctly; I fixed that problem up right quick and its giving me the same error it did with Bejeweled, That the Error Document Empty. They're set to the Neutral Language. So I believe its a problem with the plugin?<br />
      <br />
      <b>FOLLOWUP:</b> The Same problem happens with it set to English (United States). ???
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Skrapion</span><br />
      <span class="post-time small text-muted">3rd August 2007 05:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It seems the plugin doesn't like UTF-16. Convert the xml file to UTF-8 (including the &lt;?xml?&gt; statement) and try again.<br />
      <br />
      I'll put that on my TODO list, but I'm too busy to fix it until next month.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Navarr</span><br />
      <span class="post-time small text-muted">3rd August 2007 05:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Skrapion</i><br />
        <b>It seems the plugin doesn't like UTF-16. Convert the xml file to UTF-8 (including the &lt;?xml?&gt; statement) and try again.<br />
        <br />
        I'll put that on my TODO list, but I'm too busy to fix it until next month.</b>
      </blockquote>Thanks; yeah, it was because it was using UTF-16. You really need to build in some support for that for the poor chinese users :-p<br />
      <br />
      Thanks a whole bunch man, you're the greatest :3
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Skrapion</span><br />
      <span class="post-time small text-muted">3rd August 2007 05:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">No problem. Let me know if you find more bugs!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
