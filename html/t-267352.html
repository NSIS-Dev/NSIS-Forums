<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Deleting Dynamic Registry key" />

  <title>Deleting Dynamic Registry key - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Deleting Dynamic Registry key</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=267352">Deleting Dynamic Registry key</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jparker</span><br />
      <span class="post-time small text-muted">8th March 2007 01:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Deleting Dynamic Registry key</strong><br />
      I am trying to delete a registry key. The problem is the name of the key is dependent on how many apps you have installed on your palm pilot. Here is the key :<br />
      <br />
      [HKEY_CURRENT_USER\Software\U.S. Robotics\Pilot Desktop\Application6]<br />
      "Creator"=dword:53704e6f<br />
      "Conduit"="TFCnd.dll"<br />
      "Name"="MyApp"<br />
      "Priority"=dword:00000002<br />
      "Directory"="MyApp"<br />
      "Integrate"=dword:00000001<br />
      "Module"="C:\\Program Files\\MyApp.exe"<br />
      <br />
      the Application6 could be any number. Here is the NSIS code I use to try and delete it :<br />
      <br />
      loop:<br />
      EnumRegKey $1 HKCU "\Software\U.S. Robotics\Pilot Desktop" $0<br />
      StrCmp $1 "" done<br />
      IntOp $0 $0 + 1<br />
      ReadRegStr $1 HKCU "\Software\U.S. Robotics\Pilot Desktop\Application$1" "Name"<br />
      StrCmp $1 "MyApp" removeKey loop<br />
      <br />
      removeKey:<br />
      DeleteRegKey HKCU "\Software\U.S. Robotics\Pilot Desktop\Application$1"<br />
      <br />
      done:<br />
      <br />
      SetAutoClose true<br />
      <br />
      The code doesn't work, any ideas how to remove this key ?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">8th March 2007 05:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>
      <pre>
<code>OutFile "test.exe"<br /><br />Section "boo"<br />StrCpy $0 0<br /><br />loop:<br />EnumRegKey $1 HKCU "Software\U.S. Robotics\Pilot Desktop" $0<br />StrCmp $1 "" done<br />IntOp $0 $0 + 1<br />MessageBox MB_OK "$$1 == [$1]"<br /><br />ReadRegStr $2 HKCU "Software\U.S. Robotics\Pilot Desktop\$1" "Name"<br />MessageBox MB_OK "$$2 == [$2]"<br />StrCmp $2 "MyApp" removeKey loop<br /><br />removeKey:<br />DeleteRegKey HKCU "Software\U.S. Robotics\Pilot Desktop\$1"<br /><br />done:<br />SectionEnd</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comperio</span><br />
      <span class="post-time small text-muted">8th March 2007 05:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">well, a couple issues:[list=1][*]First, ReadRegStr does not need the leading backslash.<br />
      Example: ReadRegStr $1 HKCU "Software\U.S. Robotics\Pilot Desktop\Application$0" "Name"<br />
      [*]Second, in this line:<br /></p>
      <pre>
<code><br />ReadRegStr $1 HKCU "\Software\U.S. Robotics\Pilot Desktop\Application$1" "Name"<br /></code>
</pre><br />
      You are reading a completely bogus key becuase of what $1 is set to at that part of the code.[/list=1]<br />
      <br />
      I assume that the "application#" part of the example would be where "#" is a number counted up, starting at one, and continuing for however many application are installed. If so, then something like this might work better. (I'm using LogicLib here just to make it easier to code. And this is un-tested, so you may have to tweak it a bit, but shoudl at least get you started:<br />
      <pre>
<code><br />!include LogicLib.nsh<br />...<br /><br />StrCpy $0 0<br />ClearErrors<br />${Do}<br />  IntOp $0 $0 + 1<br />  ReadRegStr $1 HKCU "Software\U.S. Robotics\Pilot Desktop\Application$0" "Name"<br />  ${If} ${Errors}<br />    ${ExitDo}<br />  ${EndIf}<br />  ${If} "$1" == "MyApp"<br />    DeleteRegKey HKCU "Software\U.S. Robotics\Pilot Desktop\Application$0" "Name"<br />    ${ExitDo}<br />  ${EndIf}<br />${Loop}<br />SetAutoClose true<br /></code>
</pre><br />
      <br />
      <b>edit:</b><br />
      I just hit submit as RedWine posted his... I guess now you have 2 options! :D
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
