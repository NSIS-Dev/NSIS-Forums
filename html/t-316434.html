<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="System variable for system AppData"><title>System variable for system AppData - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">System variable for system AppData</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=316434">System variable for system AppData</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">jdt2oo7</span><br><span class="post-time small text-muted">21st January 2010 02:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>System variable for system AppData</strong><br>Hi all,<br><br>I am wondering if NSIS installer has a system variable to point to this location:<br><br>$SYSDIR\config\systemprofile\AppData\Roaming\<br><br>or at least variable for "AppData". This is system not user's AppData.<br><br>Many thanks!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">21st January 2010 02:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">When running as system (In a service or whatever), $APPDATA should point there (I have never tried)<br><br>But I'm guessing you are really asking how to get that folder when running as admin so you can put data there for your service/driver/whatever. I don't think you are really supposed to do that. There are several hacky ways to get that path, but unless you have a very specific need for something microsoft specific stored there, I would suggest you just store $instdir (or whatever files you need access to) somewhere in the HKLM part of the registry (If it is for a service, your service key will have a parameters subkey etc)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jdt2oo7</span><br><span class="post-time small text-muted">21st January 2010 03:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks Anders!<br>Yep, I want to remove service log at that location. Our application stores service log there, so I need to remove it when uninstall.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">21st January 2010 04:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, there are many ways to skin this cat:<br><br>A) Store the log somewhere else (Why the hell would you store it there? No user is ever going to check it)<br><br>B) Use the system even log, that's what it is there for (Unless you are logging lots of stuff)<br><br>C) Use ControlServiceEx and send custom control codes to the service so the service can perform the action for you<br><br>D) The service could store the AppData path somewhere in the registry when it starts so you can read it in any app (If you can't change the service itself, create a helper service or taskscheduler app that can)<br><br>E) Hack#1: Get path to profile from HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList\S-1-5-18 and hardcode the rest or search the subfolders for your log<br><br>F) Hack#2: Somehow ;) get a copy of the system token and call ShGet*() functions with it<br><br>---<br><br>This is just off the top of my head, I'm sure there are more (and possibly) better ways to go about this</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jdt2oo7</span><br><span class="post-time small text-muted">21st January 2010 19:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks Anders! I am asking the client to update a HKLM entry "LogDirectory" that installer will create when run installation. Upon un-installation, I'll read that entry then remove the log. Will that work?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">21st January 2010 21:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It'll work, assuming that the directory has not been changed since the regkey was last updated. But you don't need to create the regkey during installation, you can let the service create it.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>