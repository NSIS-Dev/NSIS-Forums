<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Structure definition" />

  <title>Structure definition - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Structure definition</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=172120">Structure definition</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mantty</span><br />
      <span class="post-time small text-muted">5th March 2004 09:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Structure definition</strong><br />
      Hi all!<br />
      <br />
      I want to make change of a description of a service. And to do this i must call:<br />
      <br />
      C++ code<br />
      SERVICE_DESCRIPTION sd;<br />
      sd.lpDescription = (char*)SvcDescription.c_str();<br />
      ChangeServiceConfig2( hService, SERVICE_CONFIG_DESCRIPTION, &amp;sd)<br />
      <br />
      NSIS:<br />
      System::Call 'advapi32::ChangeServiceConfig2( hService, SERVICE_CONFIG_DESCRIPTION, &amp;sd)'<br />
      <br />
      The problem that i have is how do i declare in NSIS sd structure?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th March 2004 11:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">See <a href="http://nsis.sourceforge.net/index.php?id=19&amp;backPID=15&amp;tx_faq_faq=35" target="_blank">http://nsis.sourceforge.net/index.ph...&amp;tx_faq_faq=35</a><br />
      <br />
      One of the links on this page is for the Service Library which uses System and some structures.<br />
      <br />
      Other System.dll structure examples can be found in Contrib\System.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">KirillKr</span><br />
      <span class="post-time small text-muted">5th March 2004 12:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">When I can download nopey now?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th March 2004 12:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Contact the author. If you can get a copy, I or another archive admin will upload it so it won't get lost again.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">KirillKr</span><br />
      <span class="post-time small text-muted">5th March 2004 13:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Who is author?<br />
      <br />
      Nopey - system setting tool | | |<br />
      <br />
      --------------------------------------------------------------------------------<br />
      Written by doberlec 2003-03-21 07:37:41 Last updated by joost 2003-10-08 13:03:52</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th March 2004 13:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">doberlec. I think he also has a forum user so you can use that to PM or e-mail.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">evilO</span><br />
      <span class="post-time small text-muted">5th March 2004 13:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi :) !<br />
      <br />
      I've got what you're looking for, altough I'm not the author...<br />
      <br />
      I downloaded it a couple of months ago, and it is still on my HD.. :D<br />
      <br />
      evilO/Olive</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">KirillKr</span><br />
      <span class="post-time small text-muted">5th March 2004 13:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">evilO, thank you very much.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mantty</span><br />
      <span class="post-time small text-muted">5th March 2004 13:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks guys for information.<br />
      I tried to make my own job, but i have some difficulties. Can some of you tell me what i did wrong?<br />
      <br />
      this is what i have to do from c++:<br />
      <br />
      typedef struct _SERVICE_DESCRIPTION {<br />
      LPTSTR lpDescription;<br />
      } SERVICE_DESCRIPTION, *LPSERVICE_DESCRIPTION;<br />
      <br />
      BOOL ChangeServiceConfig2(<br />
      SC_HANDLE hService, // handle to service<br />
      DWORD dwInfoLevel, // information level<br />
      LPVOID lpInfo // new data<br />
      );<br />
      <br />
      and i did this in script:<br />
      <br />
      !define SERVICE_ALL_ACCESS 0xF01FF<br />
      !define SC_MANAGER_ALL_ACCESS 0x3F<br />
      !define stSERVICE_DESCRIPTION "(t)i"<br />
      System::Call 'advapi32::OpenSCManagerA(n, n, i ${SC_MANAGER_ALL_ACCESS}) i'<br />
      IntCmp $1 0 lbl_done<br />
      StrCpy $2 "0x10"<br />
      StrCpy $3 "0x3"<br />
      StrCpy $4 $ServiceName<br />
      StrCpy $5 $ProjectName<br />
      StrCpy $6 $MyPath<br />
      System::Call `advapi32::CreateServiceA(i r1, t r4, t r5, i ${SERVICE_ALL_ACCESS}, i r2, i r3, i 0, t r6, n, n, n, n, n) i.r7`<br />
      StrCmp $7 0 lbl_done lbl_good<br />
      lbl_good:<br />
      System::Call '${stSERVICE_DESCRIPTION}("My Description") .r8'<br />
      System::Call 'advapi32::ChangeServiceConfig2( i r7, i 1, i r8) i.r9'<br />
      StrCmp $9 0 0 +1<br />
      lbl_done:<br />
      System::Call 'advapi32::CloseServiceHandle(i r1) n'<br />
      <br />
      The service it is installing ok, but the description it is not working.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th March 2004 13:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">See this recent thread:<br />
      <br />
      <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=171553" target="_blank">http://forums.winamp.com/showthread....hreadid=171553</a><br />
      <br />
      You have the exact same problem in your code.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mantty</span><br />
      <span class="post-time small text-muted">5th March 2004 14:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">kichik,<br />
      <br />
      thank you very much for the info. I saw that post but i still don't get it working. Can you help me with the right code :-( ... thanks</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">6th March 2004 01:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try this (NOT TESTED), probably at least it will be closer to work correctly:<br />
      <br /></p>
      <pre>
<span style="color: #007700">!</span><span style="color: #0000BB">defineSERVICE_ALL_ACCESS0xF01FF
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineSC_MANAGER_ALL_ACCESS0x3F
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineSERVICE_CONFIG_DESCRIPTION1
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">definestSERVICE_DESCRIPTION</span><span style="color: #DD0000">"(i)i"
<br /><br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">'advapi32::OpenSCManagerA(n,n,\\
<br />i${SC_MANAGER_ALL_ACCESS})i'
<br /><br /></span><span style="color: #0000BB">IntCmp</span><span style="color: #007700">$</span><span style="color: #0000BB">10lbl_done
<br />StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">2</span><span style="color: #DD0000">"0x10"
<br /></span><span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">3</span><span style="color: #DD0000">"0x3"
<br /></span><span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">4$ServiceName
<br />StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">5$ProjectName
<br />StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">6$MyPath
<br /><br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #007700">`</span><span style="color: #0000BB">advapi32::CreateServiceA(ir1,tr4,tr5,\\
<br />i</span><span style="color: #007700">${</span><span style="color: #0000BB">SERVICE_ALL_ACCESS</span><span style="color: #007700">}</span><span style="color: #0000BB">,ir2,ir3,i0,tr6,n,n,n,\\
<br />n,n)i.r7</span><span style="color: #007700">`
<br /><br /></span><span style="color: #0000BB">StrCmp</span><span style="color: #007700">$</span><span style="color: #0000BB">7</span><span style="color: #DD0000">""</span><span style="color: #0000BB">0lbl_good
<br />SetErrors
<br />Gotolbl_end
<br /><br />lbl_good</span><span style="color: #007700">:
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">'*${stSERVICE_DESCRIPTION}.r8'
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">'advapi32::ChangeServiceConfig2(ir7,\\
<br />i${SERVICE_CONFIG_DESCRIPTION},ir8)i.r9'
<br /></span><span style="color: #0000BB">StrCmp</span><span style="color: #007700">$</span><span style="color: #0000BB">900</span><span style="color: #007700">+</span><span style="color: #0000BB">2
<br />SetErrors
<br /><br />lbl_done</span><span style="color: #007700">:
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">'advapi32::CloseServiceHandle(ir1)n'
<br /><br /></span><span style="color: #0000BB">lbl_end</span><span style="color: #007700">:
</span>
</pre>It will set errors if the description wasn't put correctly or if it didn't found the service handle.<br />
      <br />
      (I read all about these APIs, I think it's really gonna work now)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">6th March 2004 10:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Uploaded noepy.zip to archive:<br />
      <br />
      <a href="http://nsis.sourceforge.net/archive/download.php?file=nopey.zip" target="_blank">http://nsis.sourceforge.net/archive/...file=nopey.zip</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mantty</span><br />
      <span class="post-time small text-muted">8th March 2004 09:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">thanks deguix for the code. I works almost perfect, but i still don't know how to set the value for the description in structure:<br />
      <br />
      !define stSERVICE_DESCRIPTION "(i)i"<br />
      System::Call '*${stSERVICE_DESCRIPTION} .r8'<br />
      <br />
      I want to have somethig like "My descripton there"<br />
      <br />
      Thnaks</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">8th March 2004 10:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try this:<br />
      <br /></p>
      <pre>
<span style="color: #007700">!</span><span style="color: #0000BB">defineDESCRIPTION</span><span style="color: #DD0000">"MyDescription"
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineSERVICE_ALL_ACCESS0xF01FF
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineSC_MANAGER_ALL_ACCESS0x3F
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineSERVICE_CONFIG_DESCRIPTION1
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">definestSERVICE_DESCRIPTION</span><span style="color: #DD0000">"(t)i"
<br /><br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">'advapi32::OpenSCManagerA(n,n,\\
<br />i${SC_MANAGER_ALL_ACCESS})i'
<br /><br /></span><span style="color: #0000BB">IntCmp</span><span style="color: #007700">$</span><span style="color: #0000BB">10lbl_done
<br />StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">2</span><span style="color: #DD0000">"0x10"
<br /></span><span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">3</span><span style="color: #DD0000">"0x3"
<br /></span><span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">4$ServiceName
<br />StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">5$ProjectName
<br />StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">6$MyPath
<br /><br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #007700">`</span><span style="color: #0000BB">advapi32::CreateServiceA(ir1,tr4,tr5,\\
<br />i</span><span style="color: #007700">${</span><span style="color: #0000BB">SERVICE_ALL_ACCESS</span><span style="color: #007700">}</span><span style="color: #0000BB">,ir2,ir3,i0,tr6,n,n,n,\\
<br />n,n)i.r7</span><span style="color: #007700">`
<br /><br /></span><span style="color: #0000BB">StrCmp</span><span style="color: #007700">$</span><span style="color: #0000BB">7</span><span style="color: #DD0000">""</span><span style="color: #0000BB">0lbl_good
<br />SetErrors
<br />Gotolbl_end
<br /><br />lbl_good</span><span style="color: #007700">:
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">'*${stSERVICE_DESCRIPTION}("${DESCRIPTION}").r8'
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">'advapi32::ChangeServiceConfig2(ir7,\\
<br />i${SERVICE_CONFIG_DESCRIPTION},ir8)i.r9'
<br /></span><span style="color: #0000BB">StrCmp</span><span style="color: #007700">$</span><span style="color: #0000BB">900</span><span style="color: #007700">+</span><span style="color: #0000BB">2
<br />SetErrors
<br /><br />lbl_done</span><span style="color: #007700">:
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">'advapi32::CloseServiceHandle(ir1)n'
<br /><br /></span><span style="color: #0000BB">lbl_end</span><span style="color: #007700">:
</span>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mantty</span><br />
      <span class="post-time small text-muted">8th March 2004 10:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">thank you very, very much deguix.<br />
      <br />
      evrything is working perfert!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
