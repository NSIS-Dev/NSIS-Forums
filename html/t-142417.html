<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Maximum size of stack items."><title>Maximum size of stack items. - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Maximum size of stack items.</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=142417">Maximum size of stack items.</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">mgillespie</span><br><span class="post-time small text-muted">16th July 2003 17:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Maximum size of stack items.</strong><br>I have a plugin DLL I wrote in C++, and it works a treat. It's quite a complex dll, and I want it to keep a log of it's actions, and any problems, and pass that back to the install script to log (I am using the optional enhanced logging).<br><br>The my DLL logfile does get quite large (a few KB).<br><br>This kinda works, but the log gets truncated. I have checked my code, and it seems to be putting it onto the stack OK, but the install engine is not retrieving it all, and truncates it.<br><br>Is this a known limitatation? Are they any other ways of doing this?<br><br>Thanks.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">16th July 2003 18:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Are you trying to put it all in one line? If so, then that must be the problem because NSIS uses wsprintf to format the log string. But wsprintf is limited to 1024. NSIS strings are also limited to 1024 bytes by default and so are stack items.<br><br>Try splitting it to a few lines, that should probably do the trick.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">mgillespie</span><br><span class="post-time small text-muted">16th July 2003 18:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I build the string up as 1 big logfile with \n newline chars to seperate eash log item, when the function finished, I stick the complete log onto the stack and pop it back off from within the script.<br><br>Is this correct?<br><br>Or are you suggesting that I stick each log item on the stack indivudually and keep track of how many items there are, pass that back and then pop them off 1 by 1? (could be hairy)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">16th July 2003 18:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It's not correct. What you've said is your only option, unless you want to increase the stack item size. But it's not recommended because it would just waste memory and to ensure it's enough you'd have to waste a lot.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">16th July 2003 18:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It's the only way, because if you're string is longer than 1024 chars, then when you pop it off the stack into NSIS (as a variable) then it will be chopped down to 1024 strlen.<br>You will have to write each line to the stack one by one.<br><br>A good thing to do is to write ":end:" to the stack as the last string.<br>Then you can keep popping off the stack in NSIS, until the Popped string is :end: to signify to stop popping.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">16th July 2003 18:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It's actually chopped when pushed. Stack items have constant size.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">mgillespie</span><br><span class="post-time small text-muted">16th July 2003 21:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well I kinda got things working now. I modified my plugin source to add all the log items to the stack, at the start of the DLL code (after popping off any passed in params), I add my ENDLOG flag. My problem is now, is that the log is in reverse order. Is there a simple way to reverse it, should I do it script side, or plugin cpp side?<br><br>Thanks.<br><br>;/////////////////////////////////////////////////////////////////////<br>;//<br>;// Section - WritePluginLog<br>;//<br>;// Description - pulls all the entries backwards off the stack<br>;// until it finds the end (start) of the Plugin log.<br>;//<br>;/////////////////////////////////////////////////////////////////////<br>Function "WritePluginLog"<br>StartPopping:<br>Pop $R6<br>StrCmp $R6 "ENDLOG:" NoMore OutputDebug<br>OutputDebug:<br>LogText $R6<br>Goto StartPopping<br>NoMore:<br><br>FunctionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">16th July 2003 21:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Doing it on the plug-in side would probably be easier because you can simply change pushstring to make the stack act as a queue. The source of pushstring is in ExDLL.h.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>