<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Help with System::call"><title>Help with System::call - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Help with System::call</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=281033">Help with System::call</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">tigereye</span><br><span class="post-time small text-muted">8th November 2007 20:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Help with System::call</strong><br>Trying to figure out system::call to get to an external .dll that I've written.<br><br>The DLL's function declaration is pretty simple. It takes a string to search for, and returns a boolean whether it's installed:<br><br>__declspec(dllexport) int __cdecl CheckProductInstalled(LPTSTR)<br><br>I've tried various versions of the system::call string, but I think this is correct, based on what I can get from the readme.<br><br>System::Call 'EnumProductsDLL.dll::CheckProductInstalled(t r0) i.r2?e'<br><br>Where $0 contains the string to search for.<br><br>However, I keep getting 'error' back in $2. If I pop the stack to get the lastdllerror I always get 0.<br><br>I don't think I'm actually getting to the .dll because there is some debug logic in the .dll that doesn't appear to be happening.<br><br>Anything obvious where I might have messed up?<br><br>Thanks,<br><br>Mike</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">8th November 2007 20:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You are using cdecl. The default is stdcall. Use ?c.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">8th November 2007 23:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Seems to me like System can't find the DLL. Have you extracted it somewhere it can be found?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tigereye</span><br><span class="post-time small text-muted">9th November 2007 19:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for the help.<br><br>Afrow,<br><br>I tried with both ?c and removing the cdecl from the declaration, same results.<br><br>Kickik<br><br>I am extracting the file immediately before this call. The logic from my test program is below:<br>INSTDIR is set to C:\temp<br><br>SetOutPath $INSTDIR<br>file "enumproductsdll.dll"<br>strcpy $0 'Symantec Antivirus'<br>System::Call 'EnumProductsDLL.dll::CheckProductInstalled(t r0) i.r2?e'<br>messagebox mb_ok $2<br>pop $5<br>messagebox mb_ok $5<br><br>Thanks,<br><br>Mike</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">9th November 2007 19:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Are you sure all of its dependencies can also be loaded? Open it from that directory with <a href="http://www.dependencywalker.com/" target="_blank">Dependency Walker</a> to make sure.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tigereye</span><br><span class="post-time small text-muted">9th November 2007 20:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i><br><b>Are you sure all of its dependencies can also be loaded? Open it from that directory with <a href="http://www.dependencywalker.com/" target="_blank">Dependency Walker</a> to make sure.</b></blockquote>Hmmm... well, that was at least part of the problem (hadn't statically linked it to msvcrt8). However, after doing that, am still having issues.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">9th November 2007 20:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, that's about it. Either the DLL can not be found due to a typo or wrong search path or it can't be loaded due to missing dependencies. Unless you're trying to load x86 DLL on x64, which is quite impossible considering NSIS doesn't build on x64, it's those two.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>