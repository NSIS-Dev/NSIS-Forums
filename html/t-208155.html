<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Can't obtain control under guest account"><title>Can't obtain control under guest account - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Can't obtain control under guest account</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=208155">Can't obtain control under guest account</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Yurik</span><br><span class="post-time small text-muted">18th February 2005 11:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Can't obtain control under guest account</strong><br>I've implemented admin rights checking in .onInit function with the UserInfo plugin. But I don't get control if I run the installation under very restricted Guest account. I've got a message "Access to the specified device, path or file is denied". So it seems that NSIS tries to access something implicitly (windows temp? appdata?). What minimum rights should user have to allow installer script to get control in .onInit to successfully perform rights thereafter?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">18th February 2005 11:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">NSIS tries to find a place to place temporary files. But it never shows such an error message. I wonder which of the tests causes Windows to show such an annoying and uncalled for message. Are you running it in a simple Guest user or does it have more restrictions than the default?<br><br>BTW, it does start after the annoying error message, right?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yurik</span><br><span class="post-time small text-muted">18th February 2005 12:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">kickik,<br><br>it seems that the matter is really caused with lack of rights to windows temp. On my desktop computer guest has rights by default, but as I've discovered, it has no rights to win temp. Having this, only the message mentioned appeared after running installation under guest. Nothing else, installation don't start after this message.<br>I've made some experiments and I've got control in .onInit after I grant guest with RW rights to win temp.<br><br>So it seems I need to specify in docs that for installed to work correctly, RW rights are required for temporary windows folder for an account under which one runs the installation.<br><br>BTW I think it could be of great conveniency if checking user rights is incorporated into NSIS itself. E.g. hooks like functions .adminInit, .guestInit, .powerUserInit, or maybe variable like $RIGHTS which is initialized internally and available in .onInit.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">18th February 2005 12:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I've created a guest user and removed its access to its own temporary directory. NSIS then used C:\Windows\Temp and was able to write there. It was not able to create the plug-ins directory because guests can't even delete their own files from that directory. That caused NSIS to show the "unable to initialize plug-ins..." message. I then tried to remove access from C:\Windows\Temp too. That caused NSIS to show the "unable to write to temporary directory message...", as should. I was not able to reproduce the Windows message and couldn't get NSIS to just exit without any message. Is there anything else you've done that I haven't?<br><br>The UserInfo plug-ins is there for checking user rights in the script. I don't see a need to implement it in the installer itself. Simple installers don't need it.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">18th February 2005 13:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">OK, I have fixed plug-ins directory initialization for extremely restricted guest users with no directory listing access to the temporary directory.<br><br>I still can't reproduce your issue. Any more details that might help? Would you be able to provide me with remote access with a guest user having the same restrictions?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yurik</span><br><span class="post-time small text-muted">18th February 2005 13:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">kichik,<br><br>it seems that the matter is not with NSIS, just simply foolish lack of rights to _run_ setup script (so it is Win message). Trying to reproduce (taking out the rights from guest right now), will write in some minutes.<br><br>Dealing rights in installer - simple installations also don't need PRINTHOOD and INTERNET_CACHE variables, but they are introduced. So maybe atleast $USER?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yurik</span><br><span class="post-time small text-muted">18th February 2005 13:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">OK, I've got plugins message, so it's OK now. The only question that remains is can I (and how) customize this message (and other NSIS messages which issuing I can't control) in case I have a need?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">18th February 2005 13:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Even if it is just a Windows issue, I don't want Windows to spit off messages during an installation. It's possible to disable them, I just need to know what exactly triggers them. It'd also be for the best if NSIS gave its own message. There already is such a message, but it doesn't show on your guest user for some reason.<br><br>All of those weird directory variables came for free with the normal directory variables. Adding access control, which is usually unrequired, will bloat the basic exehead. I prefer keeping it as a plug-in.<br><br>The plug-ins message comes from build.cpp:3181 - add_plugins_dir_initializer(). You can not costumize it without changing the source code.<br><br>I'd still want to know how you've managed to get that Windows error message so I can get rid of it.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">18th February 2005 14:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">From information provided by Yurik, it turns out the Windows error message was not NSIS related.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>