<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="substitute stings in files"><title>substitute stings in files - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">substitute stings in files</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=109670">substitute stings in files</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">n0On3</span><br><span class="post-time small text-muted">13th October 2002 18:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>substitute stings in files</strong><br>&nbsp; I want to make nsis open a file, look for a string, and substitute that for another one of different lenth. I am trying to work with those file commands but I can't make them do what I want, could anyone help me? thanks:)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">13th October 2002 18:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Have a look at this example:<br><a href="http://www.clantpa.co.uk/nsis/wiki/index.php/FileRead" target="_blank">http://www.clantpa.co.uk/nsis/wiki/index.php/FileRead</a><br><br>Instead of:<br></p><pre>
<code>
StrCmp $2 "line to replace$\r$\n" 0 +2
<br>FileWrite$1 "replacement of line$\r$\n"
<br>&gt;Goto loop 
<br>&gt;
</code>
</pre>use StrReplace and place the result in the new file.<br>
      <br>
      <font size="1">[edit]StrStr -&gt; StrReplace. Sorry, mixed those two up.[/edit]</font>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Freeman II</span><br>
      <span class="post-time small text-muted">15th October 2002 03:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Invalid command: ReadFile<br>
      Error in script "C:\Program Files\NSIS\Test\test1.nsi" on line 72 -- aborting creation process<br>
      <br>
      <br>
      I tested your example but got this error message? any idea?<br>
      <font color="orangered">line 72: ReadFile $0 $2</font></p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">15th October 2002 15:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Please attach large scripts next time. Script attached here.<br>
      <br>
      ReadFile should be FileRead.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br>
      <span class="post-time small text-muted">15th October 2002 16:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">kichik, it worked nicely for me.<br>
      <br>
      It's nice piece of code.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Freeman II</span><br>
      <span class="post-time small text-muted">16th October 2002 06:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">kichik, I changed it to FileRead and it worked. However it not only replaced that line but the whole file.<br>
      ---original----file.txt---<br>
      <font color="skyblue">asdfjskdfja<br>
      line to replace<br>
      asdfsadf</font><br>
      -------eof------------<br>
      <br>
      ---result----file.txt<br>
      <font color="skyblue"><br>
      replaced line</font><br>
      -------eof------------<br>
      <br>
      ----what is should be---<br>
      <font color="skyblue">asdfjskdfja<br>
      replaced line<br>
      asdfsadf</font><br>
      -------------------------<br>
      <br>
      any idea what was wrong here?<br>
      <br>
      Also, if you have some spare time;) could you give me an example of how to replace multiple strings.<br>
      ex:<br>
      <br>
      find: x123 replace:y123<br>
      find: zsdf replace:1232<br>
      <br>
      Thanks for the help!</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br>
      <span class="post-time small text-muted">16th October 2002 15:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>I can help you</strong><br>
      &nbsp; This is the script I finally use.<br>
      <br>
      I can assure you that it works with NSIS v1.98.<br>
      <br>
      It can replace two strings in a file. As you can see is as simple as adding a nested StrCmp.<br>
      <br>
      Another change is that instead of telling NSIS to jump two lines I added two new Labels. The original script didn't work.<br>
      <br>
      I put a dash in the name of the section to make it a hidden section.<br>
      <br>
      <br>
      Here's the Section I use:<br>
      <br>
      <br></p>
      <pre>
<code>
Section "-Change File"
<br> !define ENCINI "$INSTDIR\file2change.txt"
<br> FileOpen $0 "${ENCINI}" r
<br>  GetTempFileName $R0
<br>  FileOpen$1 $R0 w
<br>  loop: 
<br> FileRead $0 $2
<br>  IfErrors done
<br>  StrCmp$2 "first line to replace$\r$\n" igual dife
<br>    igual:
<br>   FileWrite $1 "replacement of first line$\r$\n"
<br>    Goto loop
<br>    dife:
<br>   StrCmp $2 "second line to replace$\r$\n" igual2 dife2
<br>    igual2:
<br>   FileWrite $1 "replacement of second line$\r$\n"
<br>    Goto loop
<br>    dife2:
<br> FileWrite $1 $2
<br>  Goto loop
<br>  done: 
<br> FileClose $0
<br>  FileClose$1
<br>  Delete "${ENCINI}"
<br> CopyFiles /SILENT $R0 "${ENCINI}"
<br>&gt;SectionEnd 
<br>&gt;
</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">16th October 2002 16:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">StrCmp $2 "line to replace$\r$\n" 0 +2<br>
      <br>
      should be:<br>
      <br>
      StrCmp $2 "line to replace$\r$\n" 0 +3<br>
      <br>
      I think I fixed that once... =/<br>
      I will reupload the script in <a href="http://forums.winamp.com/showthread.php?s=&amp;postid=630801" target="_blank">that thread</a> so it will work if anyone else tries it ;)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Freeman II</span><br>
      <span class="post-time small text-muted">17th October 2002 00:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the help, the code works great. Last question, do you know why the script generates a tmp file in the tmp dir?<br>
      ex: nst37.tmp<br>
      <br>
      <br>
      done:<br>
      FileClose $0<br>
      FileClose $1<br>
      <font color="red">Delete "file.txt"</font><br>
      CopyFiles /SILENT $R0 "$INSTDIR\file.txt"<br>
      <br>
      isn't it suppose to be deleted?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">17th October 2002 13:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Add Delete $R0 after CopyFiles. I have updated the thread again.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br>
      <span class="post-time small text-muted">19th October 2002 14:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">For the benefit of other users, I suggest to add an exemple of this in the nsis package.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pviton</span><br>
      <span class="post-time small text-muted">19th October 2002 19:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">(Completely new to nsis, so please bear with me)<br>
      <br>
      I notice that the answers here seem to deal with replacing a whole line of text with another. Is it possible to replace a portion of a line with some specified text? eg read a line from a file, and if it contains the string XXXX replace XXXX by YY?<br>
      <br>
      (Reason: I have an application that needs to create lots of batch files. These files have placeholders for user information (the replace strings), which would be supplied by the user when she installs. Is this a reasonable/possible thing to do using nsis?)<br>
      <br>
      Thanks!</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">19th October 2002 20:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://www.clantpa.co.uk/nsis/wiki/index.php/SubstringReplacementScript" target="_blank">http://www.clantpa.co.uk/nsis/wiki/i...lacementScript</a><br>
      <br>
      This script should do the trick. Just go line by line like the ReadFile script does and instead of comparing the line to a string, use this function on it.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pinku41</span><br>
      <span class="post-time small text-muted">19th October 2002 20:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ignore the post plz... by the time i posted my ques...it was already answered above.. :(</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br>
      <span class="post-time small text-muted">20th October 2002 12:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Is there a way to use wildcards in the StrCmp instruction? because sometimes the line is not exactly the same but nsis has to replace it.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">20th October 2002 18:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I doubt this can be done easily using NSIS scripting. If it is not always the same you will have to search for the parts that are the same using StrStr from functions.htm.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>