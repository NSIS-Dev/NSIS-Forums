<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="!system call during compile time"><title>!system call during compile time - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">!system call during compile time</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=212240">!system call during compile time</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">PatrickFraley</span><br><span class="post-time small text-muted">4th April 2005 10:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>!system call during compile time</strong><br>Hi All,<br><br>I am making a !system call during compile time to start a batch file. In this batch file I have 2 commands, the first synchronises the source directory agains a given release using a tool called directory compare. this part works perfect. the sekond step is to copy in any customer specific files using xcopy and this command gets ignored. if i open a command shell in windows and call the batch file all works great. if i call it from nsis the xcopy command does not seem to execute (even though the interpreter says it is executing it).<br><br>please help<br><br>tia<br>patrick</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">flizebogen</span><br><span class="post-time small text-muted">4th April 2005 11:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">how do you call it?<br><br>As xcopy is an internal command of cmd you need to start cmd and give the xcopy as a parameter<br><br>Maybe you can share your code</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">PatrickFraley</span><br><span class="post-time small text-muted">4th April 2005 12:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>code</strong><br>Hi,<br><br>actually I do not call xcopy directly, I call the following batch file, which in turn calls xcopy. xcopy is cmd internal? I have it laying under: C:\WINDOWS\SYSTEM32\xcopy.exe<br><br>NSIS call:<br><br>!system '..\common\scripte\copyRelease.bat'<br><br>oder:<br><br>!system 'cmd /c ..\common\scripte\copyRelease.bat'<br><br>beides l√§sst den xcopy befehl aus :(<br><br><br>tia<br>patrick<br><br><br>copyRelease.bat:<br><br>rem @echo off<br><br><br><br>"M:\mM4Setups\current\NSIS Source\common\programme\DIRCMP" /s M:\mediMACH\Releases\mediMACH4-%1 /t M:\mM4Setups\current\mM4Source\%2\mediMACH4 /m /q /w<br><br><br><br>xcopy.exe "M:\mediMACH\Kundenversionen\mediMACH4\*.*" "M:\mM4Setups\current\mM4Source\mediMACH4\" /E /Y</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">flizebogen</span><br><span class="post-time small text-muted">4th April 2005 13:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">oops... i always thought xcopy is an internal command<br><br>i tested the following and i worked:<br><br>!system 'xcopy /s /e c:\test_ordner d:\3'</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">PatrickFraley</span><br><span class="post-time small text-muted">4th April 2005 14:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I tried calling it the way you did, but no luck.<br><br>do the files realy get copied? the compiler output say's !system returned 0, but actually nothing happened.<br><br>this is really odd. like I said when I call the batchfile from hand everything works fine, but when I call it from nsis during compiletime it never executes the xcopy command.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">flizebogen</span><br><span class="post-time small text-muted">4th April 2005 14:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">yes i see a list of files being copied. Is M:\ a drive mapping? If yes test a xcopy with local paths</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">PatrickFraley</span><br><span class="post-time small text-muted">4th April 2005 14:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">yes m: is a drive mapping. i tried using just c: and it did not work either. it must have something to do with the way nsis executes shell commands. maybe it sees the xcopy command and then does not execute it, since it is a special command for nsis (doesn't it use xcopy to copy files onto a target system?)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br><span class="post-time small text-muted">4th April 2005 15:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">try to run your batch file manually, i don't think, your xcopy-syntax is correct.<br><br>as first argument, u used a file specification:<br>"M:\mediMACH\Kundenversionen\mediMACH4\*.*"<br>but as second one just a directory:<br>"M:\mM4Setups\current\mM4Source\mediMACH4\"<br><br>use a directory OR a file specification in BOTH arguments, like this:<br>xcopy.exe "M:\mediMACH\Kundenversionen\mediMACH4" "M:\mM4Setups\current\mM4Source\mediMACH4" /E /Y</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">PatrickFraley</span><br><span class="post-time small text-muted">4th April 2005 15:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi,<br><br>thanks for the reply, but the syntax is correct and the batchFile when I start it from a command (cmd) shell works fine (as I stated in my first post ;), just calling it from NSIS it does not work. I also tried your syntax, with no difference.<br><br>thanks<br>patrick</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Gabriel Sieben</span><br><span class="post-time small text-muted">4th May 2005 14:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Solution...</strong><br>Use the robust copy command out of the windows resource kit.<br><br>!system '${InstallScriptInput}\robocopy /NFL /E "${ProductInput}\cd-Root" "${Output}" '</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">5th May 2005 17:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">NSIS simply calls <a href="http://msdn.microsoft.com/library/en-us/vccore98/HTML/_crt_system.2c_._wsystem.asp" target="_blank">system()</a> which calls %COMSPEC% /c &lt;your command here&gt;. Your problem might be that the COMSPEC environment variable is not defined correctly.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">mynab</span><br><span class="post-time small text-muted">19th October 2005 09:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hello,<br><br>I am facing the exact same problem. If you write a simple .bat file that does:<br><br>echo %COMSPEC%<br>xcopy /?<br><br>and execute it from your script with a !system call you'll notice that it does output the right COMSPEC but that the call to xcopy is simply bypassed and does not output anthing. I replaced xcopy by "c:\windows\system32\xcopy.exe" and got the same result. Of course, running this from anywhere displays the help message of xcopy...<br><br>Thanks,<br>mynab<br><br>PS: copy /? does work (but does not perform recursive file copy) so this seems to be xcopy related...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">20th October 2005 20:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">xcopy requires stdin which MakeNSISw doesn't provide. This problem was already fixed for <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=172311&amp;highlight=nsexec+pipe" target="_blank">nsExec</a>, so fixing it again for MakeNSISw wasn't hard. Until 2.11, or the next nightly build, you can use makensis.exe directly.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">mynab</span><br><span class="post-time small text-muted">21st October 2005 16:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks you very much kichik!<br><br>Another almost related question: when I run makensis.exe using the /O flag all my output is nicely redirected to a file except the output of commands run with !system. Is there a may to make this output go to the /O specified log file the same way it merges in the makensisw.exe window?<br><br>Thanks<br>mynab</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">21st October 2005 16:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Use output redirection:</p><pre>
<code>makensis.exe script.nsi &gt; output.txt</code>
</pre>To redirect errors to the file as well:<pre>
<code>makensis.exe script.nsi &gt; output.txt 2&gt;&amp;1</code>
</pre>For more information:<br><a href="http://www.robvanderwoude.com/redirection.html" target="_blank">http://www.robvanderwoude.com/redirection.html</a></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">mynab</span><br><span class="post-time small text-muted">21st October 2005 16:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks I know redirections but in that case why did you put a /O switch to makensis? :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">21st October 2005 16:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I don't know, I didn't add it. It might be for easy redirection outside of a command prompt.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>