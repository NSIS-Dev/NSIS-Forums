<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Screenshot Plugin?"><title>Screenshot Plugin? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Screenshot Plugin?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=149561">Screenshot Plugin?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Yathosho</span><br><span class="post-time small text-muted">17th September 2003 22:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Screenshot Plugin?</strong><br>is there a plugin that lets nsis create a screenshot?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">lzandman</span><br><span class="post-time small text-muted">18th September 2003 07:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'm pretty sure there isn't one... But why would you want to do that?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">lzandman</span><br><span class="post-time small text-muted">18th September 2003 08:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, now there is... :)<br><br>I've just created a NSIS plugin that can save screenshots. It supports taking full-screen screenshots and screenshots of the NSIS window (but I think it has to be visible for this). Check it out:<br><br><a href="http://home.studenten.net/~wowleon/nsScreenshot.zip" target="_blank">http://home.studenten.net/~wowleon/nsScreenshot.zip</a><br><br>I've included an NSI-file that should explain how it works.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">n0On3</span><br><span class="post-time small text-muted">18th September 2003 14:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Great!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">lzandman</span><br><span class="post-time small text-muted">18th September 2003 14:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">But even though I created it, why would anyone want to use it? Why take a screenshot during install? :igor:<br><br>For me it was just practicing writing NSIS plugins, but I'm really interested in why anyone would use it...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">lzandman</span><br><span class="post-time small text-muted">19th September 2003 06:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Doesn't anybody like it? No response from official NSIS developers?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yathosho</span><br><span class="post-time small text-muted">19th September 2003 19:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">can this plugin also detect the size of the made screenshot?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yathosho</span><br><span class="post-time small text-muted">19th September 2003 20:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">can one capture any other windows but the installer window?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">19th September 2003 20:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">killahbite: You can get the size of the file.<br><br>lzandman: I've added your plug-in to the archive download section (<a href="http://nsis.sourceforge.net/archive/download.php" target="_blank">http://nsis.sourceforge.net/archive/download.php</a>). Please create an archive page for your plug-in. If possible, also try reduce the size of your plug-in.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yathosho</span><br><span class="post-time small text-muted">19th September 2003 20:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">i'm asking cause i don't see it in this plugins notexistent documentation :P<br><br>i'd like to capture the avs window (avswnd), but this plugin seems only to capture fullscreen or nsis installer window.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">19th September 2003 20:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I don't think this plug-in supports it. You can ask the author to add this feature.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">lzandman</span><br><span class="post-time small text-muted">22nd September 2003 13:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanx for all the comments. I've read them and changed <a href="http://home.studenten.net/~wowleon/nsScreenshot.zip" target="_blank">nsScreenshot</a> a little. I've removed the NSIS-window-capture function and replaced it by a more generic function that takes a window handle and captures that window. Just use the FindWindow function to get the window handle of a window and supply it to my plugin. To capture the NSIS window you can use $HWNDPARENT.<br><br>I've also reduced the plugin's size by removing some unused resources that Delphi stuffed in the DLL. And I've also compressed it using UPX. It's now 65 kB, which is still large but not as much as it used to be. Creating small code using Delphi is still a big problem...<br><br>For more information about nsScreenshot look at the <a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=409&amp;instances=0" target="_blank">archive page</a> that I've just created :)<br><br>Killahbite: I don't think it is necessary for me to add support for file size to the plugin. There are other ways to determine this. Just search the forums for a way to get the file size.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">22nd September 2003 14:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Please link to <a href="http://nsis.sourceforge.net/archive/download.php?file=Screenshot.zip" target="_blank">http://nsis.sourceforge.net/archive/...Screenshot.zip</a><br><br>I will update that file today.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">lzandman</span><br><span class="post-time small text-muted">22nd September 2003 15:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Joost Verburg</i><br><b>Please link to <a href="http://nsis.sourceforge.net/archive/download.php?file=Screenshot.zip" target="_blank">http://nsis.sourceforge.net/archive/...Screenshot.zip</a><br><br>I will update that file today.</b></blockquote>I've added that URL as a alternative to my own server, because it currently still holds the previous version.<br><br>By the way: I've named my plugin "<b>ns</b>Screenshot". You named the ZIP-file "Screenshot.zip" (without the 'ns'-prefix). Was that a mistake or don't you like the prefix? I'd rather you name it "nsScreenshot.zip", because that's more consistent. So could you please change it? :D<br><br>P.S. Joost, ben jij een Nederlander?</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yathosho</span><br><span class="post-time small text-muted">22nd September 2003 19:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by lzandman</i><br><b>I don't think it is necessary for me to add support for file size to the plugin. There are other ways to determine this. Just search the forums for a way to get the file size.</b></blockquote>i was speaking of the image size (width x height), not filesize.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yathosho</span><br><span class="post-time small text-muted">22nd September 2003 19:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">i tried capturing the window of the winamp plugin avs (handle is avswnd). i get an error when i do so.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">lzandman</span><br><span class="post-time small text-muted">23rd September 2003 09:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by killahbite</i><br><b>i tried capturing the window of the winamp plugin avs (handle is avswnd). i get an error when i do so.</b></blockquote>I can't test the AVS plugin here myself, but there are two things that might explain the error:<ul><li>The window you want to capture isn't a top-level window. So you have to use the FindWindow function multiple times. You first have to get the handle to the top-level window and from there descent to the window you want to capture.<br><br>For example, to capture the tray windows contents: The tray window is a child of the taskbar. See this picture:<br><br><a href="http://home.studenten.net/~wowleon/WindowTree.jpg" target="_blank">http://home.studenten.net/~wowleon/WindowTree.jpg</a><br><br>First we have to get the handle of the "Shell_TrayWnd" window and then we have to get the handle of the "TrayNotifyWnd" window. We can use the following code for this:<br><pre>
<code><br>FindWindow $R0 "Shell_TrayWnd"<br>FindWindow $R0 "TrayNotifyWnd" "" $R0<br></code>
</pre>The first line returns a handle to the taskbar. The second line uses this handle to get the handle of the tray area. You can use programs like Spy++ or Winsight32 to determine window classes and parent-child relations.<br>
        </li>

        <li>AVS uses hardware acceleration (DirectX, OpenGL) to create the graphics. This way all graphic data is sent directly to the screen hardware without using Windows. This is much faster, but it also means that nsScreenshot can't capture it, because Windows doesn't know anything about it. When capturing such graphics you usually end up with a window containing nothing but blackness. But in this case nsScreenshot will not return "error" though...</li>
      </ul>I hope this helps you solve your problem :)<br>
      <br>
      BTW.: I could put the image dimensions onto the stack, but unfortunately I can't FTP from here. So you have to wait a couple of hours for a new version of nsScreenshot to arrive :rolleyes:
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">lzandman</span><br>
      <span class="post-time small text-muted">23rd September 2003 21:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've put the updated version online. It now includes support for returning image dimensions (width and height). When nsScreenshot returns "ok" (only then!) it has put two additional values onto the stack. Those values are the width and height of the captured image.<br>
      <br>
      Currently you can only download it <a href="http://home.studenten.net/~wowleon/nsScreenshot.zip" target="_blank">here</a>, because the ZIP-file on the NSIS server isn't updated.<br>
      <br>
      Question for Joost or Kichik: can I upload the latest version of my plugin to the NSIS archive server myself or do I have to signal you to update it?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">23rd September 2003 21:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by lzandman</i><br>
        <b>Question for Joost or Kichik: can I upload the latest version of my plugin to the NSIS archive server myself or do I have to signal you to update it?</b>
      </blockquote>Not yet I'm afraid. We do want to enable it eventually but can't find the time to update the Archive.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br>
      <span class="post-time small text-muted">23rd September 2003 21:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Updated file on NSIS archive server.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">lzandman</span><br>
      <span class="post-time small text-muted">23rd September 2003 21:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Joost Verburg</i><br>
        <b>Updated file on NSIS archive server.</b>
      </blockquote>Thanx :)
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>