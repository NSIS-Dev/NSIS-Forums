<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="MUI and .onGUIEnd"><title>MUI and .onGUIEnd - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">MUI and .onGUIEnd</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=222000">MUI and .onGUIEnd</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">ddod</span><br><span class="post-time small text-muted">20th July 2005 19:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>MUI and .onGUIEnd</strong><br>It would seem that if I use the MUI I cannot add to the .onGUIEnd callback. Is this true? I tried to create my own and was told that it was already defined. I assume this is becasue MUI needs to do quite a bit of clean up using this callback.<br><br>However, I have some cleanup of my own that needs to be run regardless of what happens during the install (success, failure, cancel, etc.)<br><br>Is there another way to do this or do I have to define my cleanup commands in multiple locations to cover myself?<br><br>Thanks again.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">scully13</span><br><span class="post-time small text-muted">20th July 2005 19:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Are you possibly running your installer silently? If so those GUI callback functions won't be called.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ddod</span><br><span class="post-time small text-muted">20th July 2005 19:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">No it is a full graphical install. I am sure that the .onGUIEnd is being run by the MUI, I just don't seem to have access to add my own code to that particular function.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Dead_Overlord</span><br><span class="post-time small text-muted">21st July 2005 06:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>I have the same question!</strong><br>I have this same question!<br><br>For the ".onGUIInit" callback function i use the command:<br><br>!define MUI_CUSTOMFUNCTION_GUIINIT myguinitfunction<br><br>But for the ".onGUIEnd" callback function i have no idea about how to add my own commands.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">21st July 2005 16:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The MUI does not set the .onGUIEnd function. It must be another library.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ddod</span><br><span class="post-time small text-muted">21st July 2005 19:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I am not loading any other libraries. But I am still getting hte error when I try to create the .onGUIEnd function that it is already defined. MUI.nsh is the only thing I am loading.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">21st July 2005 20:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Can you attach a minimal example that reproduces the problem?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ddod</span><br><span class="post-time small text-muted">21st July 2005 21:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well I tried to create a simple script that caused the problem but couldn't. SO I moved the .onGUIEnd function to the start of my script to see where the error would happen. As I thought my function was defined first so I got an error when it tried to load it again. Here is the error I got.<br><br>Error: Function named ".onGUIEnd" already exists.<br>Error in macro MUI_FUNCTION_GUIINIT on macroline 20<br>Error in macro MUI_INSERT on macroline 11<br>Error in macro MUI_LANGUAGEFILE_BEGIN on macroline 4<br>!include: error in script: "C:\Program Files\NSIS\Contrib\Modern UI\Language files\English.nsh" on line 9<br>Error in macro MUI_LANGUAGE on macroline 9<br><br>So it is trying to define it again in the MUI when I run the following command<br><br>!insertmacro MUI_LANGUAGE "English"<br><br>Is there a way around this?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ddod</span><br><span class="post-time small text-muted">21st July 2005 21:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well I just noticed that it is the UltraModernUI that is causing the problems. I just switched it back to the MUI instead od UMUI and it works great.<br><br>So the next question is, since it looks like the UMUI is already implenting the .onGUIEnd function, is there any way to add my own code to his? (Unless anyone else has any suggestions for a place to run my cleanup code)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Dead_Overlord</span><br><span class="post-time small text-muted">22nd July 2005 05:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>I have your answer!</strong><br>To resolve it is simple!<br><br>See the code in the file "UMUI.nsh" (use the Search or Find tool of your editor).<br><br>Find the function ".onGUIInit", you see the following code:<br><br>!ifdef MUI_CUSTOMFUNCTION_GUIINIT<br>Call "${MUI_CUSTOMFUNCTION_GUIINIT}"<br>!endif<br><br>It accept the comand for a custom .onGUIInit function:<br><br>!define MUI_CUSTOMFUNCTION_GUIINIT myguiinit<br><br>To create the command that point to your own code you need to write the file "UMUI.nsh". Add the following lines inside the ".onGUIEnd" function that was already defined inside this file:<br><br>!ifdef MUI_CUSTOMFUNCTION_GUIEND<br>Call "${MUI_CUSTOMFUNCTION_GUIEND}"<br>!endif<br><br>Inside the script that you want to use a custom .onGUIEnd, insert the following line:<br><br>!define MUI_CUSTOMFUNCTION_GUIEND myguiend<br><br>And create the function:<br><br>Function myguiend<br>...my own code...<br>functionend</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ddod</span><br><span class="post-time small text-muted">22nd July 2005 15:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for th input. I made the changes and everything compiled just fine. However the function never seems to run. MUI does not have a MUI_CUSTOMFUNCTION_GUIEND built into their program, could that be the problem?<br><br>I get the following warning:<br><br>install function "myguiend" not referenced - zeroing code (286-288) out</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">nsnb</span><br><span class="post-time small text-muted">7th August 2008 00:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by ddod</i><br><b>I get the following warning:<br><br>install function "myguiend" not referenced - zeroing code (286-288) out</b></blockquote>I am having the same exact problem with myGuiInit, which doesn't seem to be invoked at all (although the script compiles OK).<br><br>I followed the instruction in C:\Program Files\NSIS\Docs\Modern UI 2\Readme.html:<br><br><blockquote>Interface functions provided by NSIS, like the .onGUIInit function and the page functions are automatically included by the Modern UI and filled with code to support new interface features. If you want to add additional code to these function, create a function with the custom script code in the script use the Modern UI functions call them.<br><br>Example:<br><br>!define MUI_CUSTOMFUNCTION_GUIINIT myGuiInit<br><br>Function myGUIInit<br>...<br>FunctionEnd</blockquote>What am I doing wrong?<br><br>Is the location of !define MUI_CUSTOMFUNCTION_GUIINIT important?</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">typhoon_bg</span><br><span class="post-time small text-muted">25th August 2009 18:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes, define it before<br><br>!include "MUI.nsh"<br><br>I had the same problem and it is now fixed.<br><br>Cheers,<br>Georgi</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>