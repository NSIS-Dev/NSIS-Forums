<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Reading registry from HKLM for any user"><title>Reading registry from HKLM for any user - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Reading registry from HKLM for any user</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=357148">Reading registry from HKLM for any user</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">winman2004</span><br><span class="post-time small text-muted">11th March 2013 15:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Reading registry from HKLM for any user</strong><br>I am developing a software which has demo for limited days of 30 days.So my s/w on installation writes a registry to HKLM which is used by me to handle the demo version. Now the problem is in windows 7 and 8 user(without admin permission) cannot access HKLM.so my code in s/w fails to check registry in HKLM. In NSIS website i saw about access control plugin.Can it be used in my case so that in all users i can read registry from HKLM? (Note:My s/w is 32 bit)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">11th March 2013 17:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You should be able to read from HKLM with no problems. Only writing will be an issue if you do not have administrator privileges. Are you sure it's not reading from the wrong key (e.g. being redirected to Wow6432Node on 64-bit Windows)?<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">winman2004</span><br><span class="post-time small text-muted">12th March 2013 14:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes.Sorry for confusing question. I also want to write to that registry in HKLM for users also. Can i do it by using access control plugin? Or is there any option by which user can write to a particular registry in HKLM?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">12th March 2013 14:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes, you can grant all or specific users write access to a key in HKLM, using the accesscontrol plugin. This is however not the way you should do it. If an application is designed to be run by users, it should store its info in userlevel storage (registry or harddisk). This is how Windows is designed to work. If you're doing it differently, you're doing it wrong.<br><br>Possible solution:<br>Upon installation (admin level), write default settings to HKLM.<br>Upon running the application, make your application copy the defaults to HKCU. Then use that registry hive from that point on.<br>Upon uninstallation, either enumerate all HKU hives (using enumusersreg.nsh) to remove stray HKCU entries, or leave them behind.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">winman2004</span><br><span class="post-time small text-muted">12th March 2013 15:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">My software has limited demo version for 30 days. And also there are some other conditions as some fetures can be used only 100 times etc. So in this case for the user also i want to update the registry of demo(a single registry) of my software in HKLM every time he uses it. I think doing this is not wrong. Also if i write this registry in HKCU separately then user can use my software with different users in his PC so he may cross the limit of using certain features of s/w. So i need to write it in HKLM.( I also know that the user may delete or change the registry and user has got full control of the s/w , but it is a different issue.).So i need to write registry to a HKLM (only a single registry which tracks demo limitation). Can i do it in NSIS using access control plugin or is there any other good methods to do the same?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">12th March 2013 17:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It is wrong to give all users write access to protected registry hives or protected folders. It is up to you to decide whether you're willing to break the rules, but your software IS badly written if it needs HKLM access for all users. There are plenty of other ways to accomplish what you want. You should probably be writing to a world-writable file in allusers appdata.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>