<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Skip deleting Modified/Added files and folders duirng Uninstall"><title>Skip deleting Modified/Added files and folders duirng Uninstall - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Skip deleting Modified/Added files and folders duirng Uninstall</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=335867">Skip deleting Modified/Added files and folders duirng Uninstall</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">balu.g12</span><br><span class="post-time small text-muted">12th October 2011 08:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Skip deleting Modified/Added files and folders duirng Uninstall</strong><br>Hi,<br><br>Presently i am deleting the Installed files/folders in uninstall section by using RMDIR /r $INSTDIR<br><br><br>But user may modify some installed files or he may add some directoires/files anywhere under $INSTDIR after installation.<br><br>I wanted to know,<br>During uninstallation, if there is any way to skip the deletion of some folder and its contents, if that folder has a modified files in it..<br><br>Can some body suggest me the solution with small example please?<br><br>Appreciate your help!<br><br>Regards,<br>Balaji.G</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">12th October 2011 12:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You should never rmdir /r $instdir, exactly because of the reason you mention: The user might have added files of his/her own. (Also, the $INSTDIR variable in the uninstaller only contains the directory where uninstall.exe is stored. So if the user moves uninstall.exe, you'll end up deleting files not belonging to your app at all!)<br><br>The solution is however not to 'exclude' some files. The solution is to include only those files that you KNOW you want to delete. To do this, you must simply add a delete command for every single file that you install.<br><br>If you think that's ugly, keep in mind that the user will never see the code to begin with. They will however notice what you end up deleting from their system. And deleting the entire Program Files folder just because the user installed there instead of in a subdir, now THAT is ugly.<br><br><br>(Note: to circumvent the problem with $instdir in the uninstaller, you need to verify that the folder is the correct one: Load the install path from registry, and/or check for some marker files specific to your application.)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">balu.g12</span><br><span class="post-time small text-muted">12th October 2011 13:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi,<br>Just before posting my question, i read about consequences of using rmdir /r $instdir and i have planned to load the install path from registry instead of using rmdir /r $instdir.<br>Thanks for the suggestion.<br><br>##simply add a delete command for every single file that you install##<br>some of the problems, why i have left this idea is :<br>1) I have Thousands of files which i i will copy during installation.<br>2) I don't have any/proper idea on how to checkfor/getthelist of modified/New files.<br><br>{{My thinking is as follows:<br>while copying the files(File /r dir\*.*) during installation - redirect the each filename with path and time stamp to a file_timestamp.log file<br>while uninstallation - from the file_timestamp.log read every filename and verify if the time stamp is matching or not.<br>If the file timestamp is changed donot delete the parent folder and its contents.<br>Else Delete the file and empty directories.<br><br>?? but i am not sure how to get the file timestamp of a file and verify it??<br>}}<br><br>I am new to NSIS, Can you please suggest me how to proceed on this.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">12th October 2011 14:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">To do that, you'll need to create an exe/vbs/bat file that creates a filelist at compiletime, and saves it as NSIS code such as "File dir\subdir\file1.ext", with the appropriate SetOutPath commands for the subdirs. Then !include that nsh code so that that the compiler can add them to the installer exe. You can create a textfile with timestamps at the same time, and parse that in the uninstaller (use File "dir\timestamps.txt" in the uninstaller section, and then some parsing functions from for example wordfunc.nsh). Tricky, but possible.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>