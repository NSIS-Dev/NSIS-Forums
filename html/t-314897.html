<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="InstallLib does not register any dll or ocx" />

  <title>InstallLib does not register any dll or ocx - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">InstallLib does not register any dll or ocx</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=314897">InstallLib does not register any dll or ocx</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pssns</span><br />
      <span class="post-time small text-muted">27th November 2009 18:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>InstallLib does not register any dll or ocx</strong><br />
      New to NSIS. My first project is for trying to convert an old VB6 setup to NSIS, and testing it in Windows 7. To make things easier, I am testing with UAC disabled.<br />
      <br />
      When installing, it installs all the normal files, links and uninstall program, but it does not install any of the dlls and ocx.<br />
      <br />
      I am testing it with the logging version of the installer, and in the install.log file does not apear any comment or error about the dlls and ocx.<br />
      <br />
      Sure it will be something forgotten, so, any help will be appreciated.<br />
      <br />
      Here is a partial code of what I am using<br />
      <br />
      ; MUI end ------<br />
      <br />
      !include "Library.nsh"<br />
      <br />
      Var ALREADY_INSTALLED<br />
      Var Version<br />
      <br />
      Name "${PRODUCT_NAME} ${PRODUCT_VERSION}"<br />
      OutFile "ProtonSetup.exe"<br />
      InstallDir "C:\PROTON"<br />
      InstallDirRegKey HKLM "${PRODUCT_DIR_REGKEY}" ""<br />
      ShowInstDetails show<br />
      ShowUnInstDetails show<br />
      <br />
      RequestExecutionLevel admin<br />
      <br />
      Section "ProtonInstall"<br />
      LogSet on<br />
      ReadRegDWord $Version HKLM "${PRODUCT_DIR_REGKEY}" Version<br />
      IfErrors new_installation<br />
      StrCpy $ALREADY_INSTALLED 1<br />
      new_installation:<br />
      SetOverwrite ifnewer<br />
      !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_PROTECTED "Support\dbgrid32.ocx" "$SysDir\dbgrid32.ocx" "$SysDir"<br />
      !insertmacro InstallLib DLL $ALREADY_INSTALLED REBOOT_PROTECTED "Support\ADODCES.DLL" "$SysDir\ADODCES.DLL" "$SysDir"<br />
      !insertmacro InstallLib DLL $ALREADY_INSTALLED REBOOT_PROTECTED "Support\STDFTES.DLL" "$SysDir\STDFTES.DLL" "$SysDir"<br />
      !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_PROTECTED "Support\MSSTDFMT.DLL" "$SysDir\MSSTDFMT.DLL" "$SysDir"<br />
      !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_PROTECTED "Support\MSADODC.OCX" "$SysDir\MSADODC.OCX" "$SysDir"<br />
      !insertmacro InstallLib DLL $ALREADY_INSTALLED REBOOT_PROTECTED "Support\MSMPIES.DLL" "$SysDir\MSMPIES.DLL" "$SysDir"<br />
      !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_PROTECTED "Support\MSMAPI32.OCX" "$SysDir\MSMAPI32.OCX" "$SysDir"<br />
      !insertmacro InstallLib DLL $ALREADY_INSTALLED REBOOT_PROTECTED "Support\FLXGDES.DLL" "$SysDir\FLXGDES.DLL" "$SysDir"</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">27th November 2009 22:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Perhaps you're not running the installer as admin. When UAC is disabled, windows ignores the requested execution level. To work around this, use the userinfo plugin to manually test for actual admin access in .onInit.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pssns</span><br />
      <span class="post-time small text-muted">28th November 2009 18:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It was easier than supposed. I tested in an XP machine, and it happened the same, so, after investigating, I added SetOutPath before registering dlls in the SysDir and InstDir folders, and now it works.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">1st December 2009 07:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">SetOutPath sets the working directory which is also used in the search path for dependencies. If you have dependencies outside of the system folder and the search path, you have to set the working folder to that.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pssns</span><br />
      <span class="post-time small text-muted">1st December 2009 08:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for your interest kichik.<br />
      <br />
      The sample script inserted does not completely illustrate the situation because are only some partial lines of about 100 files to copy, and the ocx and dlls that did not copied where those in the InstDir folder, those in SysDir copied correctly.<br />
      <br />
      After using the log version of the installer, I saw that SetOutPat $InstDir also creates the folder if it does not exists, so putting it at the beginning of the files to copy to $InstDir solved my problem.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
