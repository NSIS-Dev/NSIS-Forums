<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="CreateShortcut to run as administrator"><title>CreateShortcut to run as administrator - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">CreateShortcut to run as administrator</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=319628">CreateShortcut to run as administrator</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">akatik</span><br><span class="post-time small text-muted">2nd June 2010 19:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>CreateShortcut to run as administrator</strong><br>Good day.<br>I need to create shortcut with advanced property "Run as administrator" set. Help needed.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">3rd June 2010 05:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by akatik</small><br>Good day.<br>I need to create shortcut with advanced property "Run as administrator" set. Help needed.</blockquote>I don't know if this is possible in a shortcut, but I think you could add a manifest to the exe with admin as requested execution level.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br><span class="post-time small text-muted">3rd June 2010 07:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, it is possible, but a pain to write in a script.<br>Maybe a plugin is easier:<br><a href="http://social.msdn.microsoft.com/Forums/en-US/windowssecurity/thread/a55aa70e-ae4d-4bf6-b179-2e3df3668989" target="_blank">http://social.msdn.microsoft.com/For...9-2e3df3668989</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br><span class="post-time small text-muted">3rd June 2010 07:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can also try to add a REG_SZ key named &lt;Full_Path _To_My_Application.exe&gt; with a value of "RUNASADMIN" to the registry at HKCU\SOFTWARE\Microsoft\Windows_NT\CurrentVersion\AppCompatFlags\Layers.<br>(Source: <a href="http://www.techtalkz.com/windows-deployment/193291-howto-force-run-adminstrator-vista-all-users.html" target="_blank">http://www.techtalkz.com/windows-dep...all-users.html</a>)<br>I don't have Vista, so I can't test this for you.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">3rd June 2010 12:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">One could update this plug-in (it would probably have to be me though):<br><a href="http://nsis.sourceforge.net/ShellLink_plug-in" target="_blank">http://nsis.sourceforge.net/ShellLink_plug-in</a><br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">3rd June 2010 16:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">People keep asking this over and over, but it seems to me that you probably have other problems if you need this property set on your shortcuts (What if the user runs the app directly?) Anyways, here is some code: <a href="http://nsis.sourceforge.net/IShellLink_Set_RunAs_flag" target="_blank">http://nsis.sourceforge.net/IShellLink_Set_RunAs_flag</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">3rd June 2010 19:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I've updated the ShellLink plug-in but currently the Wiki is down.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">akatik</span><br><span class="post-time small text-muted">4th June 2010 15:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><b>MSG</b> Elevating application is not the decision I need. Simple users should have the ability to run it.<br><b>Anders</b>, I understand, that writing programs that require administrative rights is not good. But my program is meant for system administrators. There will be two shortcuts - for simple users with restricted possibilities - and for admins, full functioning.<br>Thank you, <b>Afrow UK</b>, it works fine.<br>Thanks for you all a lot. There are several topics on this issue on the forum. But only here is the helpful solution.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Mikesch</span><br><span class="post-time small text-muted">4th October 2010 13:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hello Afrow UK!<br><br>Many thanks for your great solution. This works fine for my application.<br><br>Because of the many threads about this problem perhaps it could become part of the next NSIS setup.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">akatik</span><br><span class="post-time small text-muted">11th February 2011 11:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I have a problem - I set flag "Run as Administrator" using this code: <a href="http://nsis.sourceforge.net/IShellLink_Set_RunAs_flag" target="_blank">http://nsis.sourceforge.net/IShellLink_Set_RunAs_flag</a><br>If my shortcut is placed in All users Start menu, then it works great.<br>But in Start menu of current user - no flag is set.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">11th February 2011 15:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Is the path correct? (SetShellVarContext).<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">akatik</span><br><span class="post-time small text-muted">11th February 2011 15:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes, path is correct. The code is:<br><br>CreateShortcut "$SMPROGRAMS\wtc\${wtcTxt}-Administrator.lnk" "$INSTDIR\Bin\win32.exe"<br>push "$SMPROGRAMS\wtc\${wtcTxt}-Administrator.lnk"<br>call ShellLinkSetRunAs<br>pop $0<br><br>As far as I understood this function returned not 0:<br>System::Call "$2-&gt;5(w '$9',i 0)i.r0" ;Load</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">akatik</span><br><span class="post-time small text-muted">11th February 2011 16:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Afrow UK, you were right.<br>"Windows Vista and Windows 7 automatically identifies installer executables, including NSIS installers, and asks the user permission to run them with elevated privileges. Automatic detection, however, comes with the price of automatic backward compatibility tricks. One of which is automatic relocation of shortcuts created in the Start Menu to All Users' Start Menu."<br><br>I hate Microsoft :( It placeв my shortcut to All users start menu and even didn't say "Meow".</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">akatik</span><br><span class="post-time small text-muted">11th February 2011 16:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Afrow UK, you were right.<br>"Windows Vista and Windows 7 automatically identifies installer executables, including NSIS installers, and asks the user permission to run them with elevated privileges. Automatic detection, however, comes with the price of automatic backward compatibility tricks. One of which is automatic relocation of shortcuts created in the Start Menu to All Users' Start Menu."<br><br>I hate Microsoft :( It placeв my shortcut to All users start menu and even didn't say "Meow".</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>