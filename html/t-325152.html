<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="UMUI Maintenance Page Remove error"><title>UMUI Maintenance Page Remove error - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">UMUI Maintenance Page Remove error</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=325152">UMUI Maintenance Page Remove error</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">blh83</span><br><span class="post-time small text-muted">22nd December 2010 23:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>UMUI Maintenance Page Remove error</strong><br>In order to have a Maintenance Page using UMUI you must '!define' (among other things) UMUI_UNINSTALL_FULLPATH. The problem is, this may be declared before the install directory is finalized (and therefore the uninstall directory) which causes the 'Remove' option on the maintenance page to not be selectable.<br><br>I attempted to '!define' it to a default and then change the created registry key (in my case "UninstallString") once I knew the appropriate location, but this also causes the error of 'Remove' not being selectable on the Maintenance page. This seems like a pretty big flaw considering that any installer that allows the user to change the install directory would have a broken 'Remove' option on the Maintenance Page. This is of course assuming that the '!define' uses something like "$INSTDIR\uninstall.exe" (which all the examples show).<br><br>Therefore, I am wondering if there is a way around this because I feel like I am missing something. Any thoughts?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">blh83</span><br><span class="post-time small text-muted">28th December 2010 20:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It appears to be yet another issue with Windows User Account Control. Thank you Windows.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">blh83</span><br><span class="post-time small text-muted">30th December 2010 21:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">shoot, it doesn't appear to be a UAC issue. Things are still broken. You simply can not change the value of the Registry key created by '!define UNINSTALLER_FULL_PATH'. This is a problem since the path is not know until after the user defines the installation directory (unfortunately this happens after defining the above registry key). Therefore, the Remove option on the Maintenance page doesn't work and can't even be selected...bummer.<br><br>Does anyone have any ideas on this? I may just have to write my own Modify/Repair/Remove page but would like to avoid it as I am up against a tight deadline. Thanks.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">31st December 2010 08:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by blh83</small><br>You simply can not change the value of the Registry key created by '!define UNINSTALLER_FULL_PATH'.</blockquote>Why not? Just define it as "$INSTDIR\Uninstall.exe".</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">blh83</span><br><span class="post-time small text-muted">3rd January 2011 18:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks MSG, but the crux of the problem is the "$INSTDIR" portion. The installation directory may change if the user is given the option to do so. This choice is not made until AFTER the registry key has been written (in my case, the key is "UninstallString"). If you then go in and change the registry key once you know the correct location, it breaks everything. The act of changing the key breaks the Remove option on the Maintenance page. I don't know why it exhibits this behavior, but I have verified it. If I write the registry key and don't change the install path, everything works swimmingly. If I change the install path and then change the registry key, the Remove option is broken.<br><br>I am not sure if this is making any sense. Here is some basic code to show what I mean:<br><br>!define UMUI_UNINSTALL_FULLPATH "$INSTDIR\uninstall.exe" //lets say this is C:\uninstall.exe<br><br>If I do nothing more and don't give the user the option to change the install directory, then everything is great. But now I do this:<br><br>!define UMUI_UNINSTALL_FULLPATH "$INSTDIR\uninstall.exe"<br><br>//the installer runs and the user chooses a directory and the uninstaller ends up in "C:\SomeProgram\uninstall.exe"<br><br>Therefore I go in and change the registry key (I have done this multiple ways but lets say I delete then add):<br><br>DeleteRegValue ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "UninstallString"<br>WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "UninstallString" "C:\SomeProgram\uninstall.exe" //pretend this was not hard-coded but retrieved from the appropriate place. This just makes it easier to see.<br><br>Now when the user receives the Maintenance page, if they re-run the installer, the Remove option is not selectable: Why?. Hopefully this makes more sense.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">3rd January 2011 19:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok, I see the problem. No idea why it'd disable the remove function... Guess you can either wait for SuperPat to show up, or modify the UMUI header files to write the uninstall regkey at a later time. (BTW, you could also check whether maybe changing the page order is an option.)</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>