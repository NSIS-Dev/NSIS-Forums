<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Patch technology in NSIS"><title>Patch technology in NSIS - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Patch technology in NSIS</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=47383">Patch technology in NSIS</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">17th April 2001 20:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi everyone,<br><br>I'm currently working on a 'patch' program which allows you to update files from 1 version to another.<br>It'll calculate the CRC of the source file, check if the patch is designed for this purpose, patch it, and then check to see if the CRC of the target file is correct.<br><br>However, I'm currently still working on the patch generator - though I have a (very) slow VB version which works.<br><br>Does anyone have any suggestions for a patcher?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">18th April 2001 19:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Working on it</strong><br>Hello everyone,<br><br>I'm still working on it, but I'm currently tracking down some bugs in the patch generator.<br>Once I got those ironed out, I have a basic patch generator. If you have a 1 MB file which is 90% identical to file #2, the patch will be about 20% - not very good, but it's a start.<br><br>After I get some bugs out, I can start on optimizing.<br><br>Is anyone interested in a patcher anyway?<br><br>Estimated size for the patch program executable itself is 32-64 KB. (Haven't finished it yet).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rm'</span><br><span class="post-time small text-muted">19th April 2001 02:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Re: Working on it</strong><br></p><blockquote><i>Originally posted by Koen van de Sande</i><br><b>Is anyone interested in a patcher anyway?</b></blockquote>Yes. Clickteam has a nice patch proggie, but then again, it's Clickteam. I'd prefer something that's adless.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">polaughlin</span><br><span class="post-time small text-muted">19th April 2001 03:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I am very much interested.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">19th April 2001 18:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I fixed tons of bugs in my patcher, but there still appears to be one left, there is a problem with files larger than 1 MB and/or non-text characters. I'll just have to keep looking...<br><br>Still, the patcher is coming along quite nicely, it can at least generate patches now, and I have a "Patcher" which applies it to a file. Current size of the Patcher is 62 KB (or 28 KB after UPX), which is quite big. However, I'm using Delphi, so you do not need any extra other files. It's 62 KB plus the patch file size and nothing more.<br><br>After I get all bugs out, I can start to improve performance (and efficiency) of the patch generator. I'm not using any compression, because the compression inside NSIS is much better than anything I can add.<br><br>I'll post any progress I make here.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">20th April 2001 20:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>It works!</strong><br>I fixed a copy-paste bug (which took me 2 days).<br><br>It works very well now, very fast compared to my VB version. I'm going to try and add variable-block size searching next, which'll improve both speed and patch size.<br><br>Is anyone else interested besides polaughin and Radioactive Man?<br><br>I could use a C(++) programmer who can translate the actual runtime program into C and make it smaller, because it's 61 KB because of the Delphi stuff.<br><br>It's a really simple program, less than 200 lines (haven't looked).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Edgewize</span><br><span class="post-time small text-muted">21st April 2001 00:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'd be glad to create a very small compiled C version! You can keep all the credit for the program as long as I get to use it in my installer :)<br><br>Send me an email - wiked_edge@yahoo.com<br><br></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">21st April 2001 13:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That'd be great edgewize! I'm currently brushing up things a bit and making some last changes to the file format. And I just rewrote the CRC code a little which saves 1 kb.<br><br>Runtime size is now 61 KB, or 30 KB after UPX. Patch files can be (must be) linked to the exe in order to work. The file format supports multiple patches inside one patch file, but only one patch can be executed at a time.<br>All this is possible, but I haven't written support for it in the generator.<br><br>I'll send you the source code for the patcher tonight (including some test patches/files).<br><br>Should I release a first version which works, or should I wait until I've improved compression and speed in the generator?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">22nd April 2001 20:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>First release is here!</strong><br>I've just uploaded VPatch v1.0 (yes, it has a name now) to: <a href="http://www.tibed.net/vpatch/vp100.exe" target="_blank">http://www.tibed.net/vpatch/vp100.exe</a><br><br>What can it do?<br>- Create a small patch from an old version to a new version.<br>- Attach patches for multiple files to the patcher (so you only need to include this 30 KB once)<br>- Configure compression through genpat.ini (make sure you do this in order to have acceptable creation times).<br>- On my test files, it makes Clickteam Patch Maker look like crap: I have smaller patches (but it takes much longer than in Patch Maker).<br><br>E-mail koen@tibed.net or post here with suggestions/bug reports!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Edgewize</span><br><span class="post-time small text-muted">23rd April 2001 02:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Replacement vpatch.bin for smaller patches</strong><br><br>This is a replacement vpatch.bin with full source code, and a project file for MSVC++ 6.0 (sp4). Only 4k, much smaller for less overhead on the patch EXE file.<br><br><a href="http://edgewize.cjb.net/vpatch_c.zip" target="_blank">http://edgewize.cjb.net/vpatch_c.zip</a><br></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">polaughlin</span><br><span class="post-time small text-muted">24th April 2001 04:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>GUI</strong><br>Are you planning on implementing a GUI for this patch program?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">24th April 2001 18:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes, a GUI is planned, but I haven't started yet. If someone makes a good GUI for NSIS, perhaps the patcher could be integrated.<br>But I can probably make an application where you can select original/new versions, create patches, save projects, etc. Then you'd no longer have to use any of the commandline utilities.<br><br>But I'm going to work on the Patch Generator itself first, I'm hoping to make it a little faster.<br><br>Question: v1.0 uses very little memory, but read the file the whole time from disk. Does anyone mind if the program is going to use SourceSize+TargetSize MB of RAM? Adding this will make patch creation of large files slower, but other things will be faster.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Bor</span><br><span class="post-time small text-muted">24th April 2001 18:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>maybe as an option</strong><br>Maybe you could make it an option so you can choose to use more RAM or read the file from disk.<br><br>Bor</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">30th April 2001 21:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I just made it use memory instead of disk - this causes a major speed increase :) - my new version works 80% faster. I'll be releasing this new version soon.<br>(now that it's faster, I can increase the default compression to be better).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">2nd May 2001 14:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">80% faster is not a correct measure.<br>I mean 5 times faster.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>