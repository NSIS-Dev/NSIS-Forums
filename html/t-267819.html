<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="write in the middle of text file"><title>write in the middle of text file - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">write in the middle of text file</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=267819">write in the middle of text file</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">andreinho</span><br><span class="post-time small text-muted">15th March 2007 09:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>write in the middle of text file</strong><br>i would like to know how is possible to write in the middle of text file; for example i suppose to have a text file with 5 line<br><br>row1<br>row2<br>row3<br>row4<br>row5<br><br>i would like to have a output file as:<br><br>row1<br>row2<br>rowx<br>row3<br>row4<br>row5<br><br>with a new line inserted in the middle, i would like to know if i have to use fileseek command and how use it. thanks so much for help. bye. Andre</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">15th March 2007 10:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can do it using Text Functions Header, there is an example in documentation tailored for your case.<br><br><a href="http://nsis.sourceforge.net/Docs/AppendixE.html#E.2" target="_blank">http://nsis.sourceforge.net/Docs/AppendixE.html#E.2</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">andreinho</span><br><span class="post-time small text-muted">15th March 2007 10:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>see above</strong><br>i've however some problem beacuse i have to use a tmp file i suppose, have i cut the line below my line, copy it to another tmp file, insert my line and copy lines from tmp to my file? are there other ways? thanks so much, bye. Andre</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">15th March 2007 10:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The example4 on LineFind does all the job.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">andreinho</span><br><span class="post-time small text-muted">15th March 2007 12:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>see above</strong><br>i have the text below, i don't understand why don't work, i've prova.txt file with line of text and i would like to write something 2 lines up the last row but don't write, nothing, why? thanks so much<br><br>!define PRODUCT_NAME "a"<br>!define PRODUCT_VERSION "1.0"<br>!define PRODUCT_PUBLISHER "La mia compagnia, Inc."<br>!define PRODUCT_WEB_SITE "http://www.lamiacompagnia.com"<br>!define PRODUCT_DIR_REGKEY "Software\Microsoft\Windows\CurrentVersion\App Paths\nsis-2.24-setup.exe"<br>!define PRODUCT_UNINST_KEY "Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}"<br>!define PRODUCT_UNINST_ROOT_KEY "HKLM"<br><br>!include "MUI.nsh"<br>!include "TextFunc.nsh"<br><br><br>!define MUI_ABORTWARNING<br>!define MUI_ICON "${NSISDIR}\Contrib\Graphics\Icons\modern-install.ico"<br>!define MUI_UNICON "${NSISDIR}\Contrib\Graphics\Icons\modern-uninstall.ico"<br><br>; Welcome page<br>!insertmacro MUI_PAGE_WELCOME<br>; License page<br>!insertmacro MUI_PAGE_LICENSE "lic.txt"<br>; Directory page<br>!insertmacro MUI_PAGE_DIRECTORY<br><br>!insertmacro linefind<br><br>; Instfiles page<br>!insertmacro MUI_PAGE_INSTFILES<br><br>; Finish page<br>!define MUI_FINISHPAGE_RUN "$INSTDIR\nsis-2.24-setup.exe"<br>!insertmacro MUI_PAGE_FINISH<br><br>; Uninstaller pages<br>!insertmacro MUI_UNPAGE_INSTFILES<br><br>; Language files<br>!insertmacro MUI_LANGUAGE "English"<br><br>; MUI end ------<br><br>Name "${PRODUCT_NAME} ${PRODUCT_VERSION}"<br>OutFile "Setup.exe"<br>InstallDir "$PROGRAMFILES\a"<br>InstallDirRegKey HKLM "${PRODUCT_DIR_REGKEY}" ""<br>ShowInstDetails show<br>ShowUnInstDetails show<br><br>Section "SezionePrincipale" SEC01<br>SetOutPath "$INSTDIR"<br>SetOverwrite ifnewer<br>File "nsis-2.24-setup.exe"<br>CreateDirectory "$SMPROGRAMS\a"<br>CreateShortCut "$SMPROGRAMS\a\a.lnk" "$INSTDIR\nsis-2.24-setup.exe"<br>CreateShortCut "$DESKTOP\a.lnk" "$INSTDIR\nsis-2.24-setup.exe"<br><br><br>iffileexists "$INSTDIR\prova.txt" occhio<br>File "prova.txt"<br>occhio:<br><br>${LineFind} "$INSTDIR\prova.txt" "" "-2" "Example4"<br>IfErrors 0 +2<br>MessageBox MB_OK "Error"<br><br>SectionEnd<br><br>Section -AdditionalIcons<br>CreateShortCut "$SMPROGRAMS\a\Uninstall.lnk" "$INSTDIR\uninst.exe"<br>SectionEnd<br><br>Section -Post<br>WriteUninstaller "$INSTDIR\uninst.exe"<br>WriteRegStr HKLM "${PRODUCT_DIR_REGKEY}" "" "$INSTDIR\nsis-2.24-setup.exe"<br>WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "DisplayName" "$(^Name)"<br>WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "UninstallString" "$INSTDIR\uninst.exe"<br>WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "DisplayIcon" "$INSTDIR\nsis-2.24-setup.exe"<br>WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "DisplayVersion" "${PRODUCT_VERSION}"<br>WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "URLInfoAbout" "${PRODUCT_WEB_SITE}"<br>WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "Publisher" "${PRODUCT_PUBLISHER}"<br>SectionEnd<br><br>Function Example4<br>FileOpen $R4 "$INSTDIR\prova.txt" a<br>FileWrite $R4 "---First Line---$\r$\n"<br>FileClose $R4<br>FunctionEnd<br><br>Function un.onInit<br>MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 "Sei sicuro di voler completamente rimuovere $(^Name) e tutti i suoi componenti?" IDYES +2<br>Abort<br>FunctionEnd<br><br>Function un.onUninstSuccess<br>HideWindow<br>MessageBox MB_ICONINFORMATION|MB_OK "$(^Name) Ã¨ stato completamente rimosso dal tuo computer."<br>FunctionEnd<br><br>Section Uninstall<br>Delete "$INSTDIR\uninst.exe"<br>Delete "$INSTDIR\prova.txt"<br>Delete "$INSTDIR\nsis-2.24-setup.exe"<br><br>Delete "$SMPROGRAMS\a\Uninstall.lnk"<br>Delete "$DESKTOP\a.lnk"<br>Delete "$SMPROGRAMS\a\a.lnk"<br><br>RMDir "$SMPROGRAMS\a"<br>RMDir "$INSTDIR"<br><br>DeleteRegKey ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}"<br>DeleteRegKey HKLM "${PRODUCT_DIR_REGKEY}"<br>SetAutoClose true<br>SectionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">andreinho</span><br><span class="post-time small text-muted">15th March 2007 12:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>see above</strong><br>ok, i've solved tha problem, work properly, seeing another example on forum, thanks so much however.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">15th March 2007 12:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think you're using the example incorrectly,<br></p><pre>
<code>Section<br>        ${LineFind} "$INSTDIR\prova.txt" "" "-2" Example4<br>        IfErrors 0 +2<br>        MessageBox MB_OK "Error"<br>SectionEnd<br><br>Function Example4<br>        FileWrite $R4 "---First Line---$\r$\n"<br>        FileWrite $R4 "---Second Line ...---$\r$\n"<br><br>        Push $0<br>FunctionEnd</code>
</pre><br>
      Also looking your code, (IfFileExists "$INSTDIR\prova.txt"), I think you're writing to the file in both cases, either exists or extract it, is this what you want?
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">andreinho</span><br>
      <span class="post-time small text-muted">15th March 2007 17:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>see above</strong><br>
      yes red wine, i've understand your suggest, and also i've understood error for differentiate the 2 ways. thanks so much.bye. Andre</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>