<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Code Architecture" />

  <title>Code Architecture - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Code Architecture</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=330989">Code Architecture</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jai123</span><br />
      <span class="post-time small text-muted">27th May 2011 20:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Code Architecture</strong><br />
      Hello everyone,<br />
      <br />
      I am starting to reorganize some code, and I want to structure it in a clean way. I am trying to get rid of repeated code, as well as modularize my code. So, I would like to see if you could guide me in two things I am trying to structure better.<br />
      <br />
      1) There are two functions that do exactly the same, but one is for the installer, and the other is for the uninstaller. I have tried to create a subfunction for both, but the compiler yells at me. How do you usually avoid duplicating code that is in the installer and uninstaller?<br />
      <br />
      2) My main script mixes the GUI and installation code (driver installation) into a single script. In order to organize it, I would like to pass the driver installation functions into its own file. I am looking something like compiling and linking, or something similar. Does that concept exist in NSIS? what people usually do to organize their scripts?<br />
      <br />
      Thanks,</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">27th May 2011 22:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">1) Use macros or CallArtificialFunction (util.nsh)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">27th May 2011 22:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">!macro and !include. To include the same function in the installer and uninstaller, put it in a macro that takes one argument like so:<br />
      <br />
      !macro MyFunction Un<br />
      Function ${Un}MyFunction<br />
      ...<br />
      FunctionEnd<br />
      !macroend<br />
      <br />
      !insertmacro MyFunction `` # for installer<br />
      !insertmacro MyFunction `un.` # for uninstaller<br />
      <br />
      Edit: Or what Anders said :)<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jai123</span><br />
      <span class="post-time small text-muted">29th May 2011 21:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Great Anders and Afrow UK. I will see which approach to take.<br />
      <br />
      About question 2), does people usually link compiled code; or they just drop functions into headers files. What usually people do to break apart (architect) their main script?<br />
      <br />
      Thanks,</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">30th May 2011 05:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can't link compiled code. You can only !include .nsh and .nsi files. If you must, you could however do File YourFolder\YourCompiledExe.exe and then ExecWait that exe. But... It kind of makes zero sense to do that with an NSIS executable.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jai123</span><br />
      <span class="post-time small text-muted">30th May 2011 15:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">MSG, thank you very much for the clarification.<br />
      <br />
      So I am just wondering what is the whole purpose of including nsi files. I could dump all my implementation details into an nsh file and include it. Or, do people separate implementation from interface using nsh and nsi files and then include both into their main script? how do you usually organize your installer architecture?<br />
      <br />
      Thanks</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jai123</span><br />
      <span class="post-time small text-muted">30th May 2011 17:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Afrow UK, I followed your example. For some reason when compiling the macro, the compiler yells at me. I have attached the code and error below.<br />
      <br />
      When I get rid of the Function... and FunctionEnd lines. It just compiles fine. Am I missing something?<br />
      <br />
      Thanks,<br />
      <br />
      Code:<br />
      !macro cleanFileSystem Un<br />
      Function ${Un}cleanFiles<br />
      ....<br />
      ....<br />
      FunctionEnd<br />
      !macroend<br />
      <br />
      Error:<br />
      Error in macro cleanFileSystem on macroline 1</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
