<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Search for text in file?"><title>Search for text in file? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Search for text in file?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=346638">Search for text in file?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">v47</span><br><span class="post-time small text-muted">29th July 2012 11:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Search for text in file?</strong><br>hello.<br><br>just started to use NSIS, and I would like to do following:<br><br>open "settings.cfg" in the $INSTDIR<br>look for "german", if found, copy german.cfg to $INSTDIR<br>look for "french", if found, copy french.cfg to $INSTDIR<br><br>tried to play with this <a href="http://nsis.sourceforge.net/Search_for_text_in_file" target="_blank">http://nsis.sourceforge.net/Search_for_text_in_file</a> for a bit, but I'm totally lost (on the look for/if found part). help?<br><br>thank you.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">29th July 2012 12:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can probably use LineFind from filefunc.nsh. <a href="http://nsis.sourceforge.net/Docs/AppendixE.html#E.2.2" target="_blank">http://nsis.sourceforge.net/Docs/AppendixE.html#E.2.2</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">v47</span><br><span class="post-time small text-muted">29th July 2012 19:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">any chance of an example?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">29th July 2012 19:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">There are many usage examples in the documentation I linked.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">T.Slappy</span><br><span class="post-time small text-muted">30th July 2012 06:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Is your config file INI based?<br>ReadINIStr - <a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.2.10" target="_blank">http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.2.10</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">v47</span><br><span class="post-time small text-muted">31st July 2012 10:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">no, it's a cfg, but it's just a renamed txt file. tried to look at those examples, but it's way too complicated for me - until now, all I had to do was check for files and move them accordingly, and this is the first time I have to do something more complicated.. I was hoping for something I could just copy &amp; paste, no luck I guess.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">31st July 2012 12:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">T.Slappy wanted to know the format of the file. 'cfg' is just a generic extension for a configuration file, whereas an INI file has a very specific format. What does the actual format/contents look like?<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">v47</span><br><span class="post-time small text-muted">31st July 2012 14:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">no, it's just a text file with variables. no specific format.<br><br>the plan I had was doing a text/string lookup in the file, and then using some <i>if text/string exists</i> function, just like I have been using IfFileExists for all the previous tasks, but I see no such thing here (with my very unskilled eye, anyway).<br><br>maybe I should just make this user selectable and forget about it..</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">31st July 2012 14:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>no, it's just a text file with variables</blockquote>What do you mean exactly?<br><br>If there is no specific format, how can you look up a string? We cannot help you if we do not know what the format is.<br><br>Stu</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">v47</span><br><span class="post-time small text-muted">31st July 2012 14:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">inst.cfg, contents:<br></p><pre>
<code>install_path .\<br>language english<br></code>
</pre><br>
      the problem is, the user can have either english, german or french in the language line, and some files that have to be copied over are language specific, and the installer needs to know when german or french is used as some extra files need to be copied over (english is not a problem, it's the default language so no extra files are needed).
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">31st July 2012 14:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You should be able to use ConfigRead for this (it's in the manual).<br>
      <br>
      Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">v47</span><br>
      <span class="post-time small text-muted">31st July 2012 14:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'll try, thanks.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">31st July 2012 14:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Or you can use this code:</p>
      <pre>
<code>FileOpen $R0 path\to\inst.cfg r<br>${Do}<br><br>  FileRead $R0 $R1<br>  ${If} ${Errors}<br>    ${Break}<br>  ${EndIf}<br><br>  StrCpy $R2 $R1 13<br>  ${If} $R2 == `install_path `<br>    StrCpy $CfgInstallPath $R1 `` 13<br>    ${TrimNewLines} $CfgInstallPath $CfgInstallPath<br>    ${Continue}<br>  ${EndIf}<br><br>  StrCpy $R2 $R1 9<br>  ${If} $R2 == `language `<br>    StrCpy $CfgLanguage $R1 `` 9<br>    ${TrimNewLines} $CfgLanguage $CfgLanguage<br>    ${Continue}<br>  ${EndIf}<br><br>${Loop}<br>FileClose $R0</code>
</pre>Stu
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">v47</span><br>
      <span class="post-time small text-muted">31st July 2012 15:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ugh, I'm totally lost on this - can't figure your out your piece of code or what is the $var in ConfigRead supposed to do.<br>
      <br>
      guess I bit off more than I can chew.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">31st July 2012 16:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">$var is what it says - a variable which receives the output/value. It can be one of NSIS's built in ones ($0-$9, $R0-$R9) or one you define yourself using the Var instruction. My code uses two variables $CfgInstallPath and $CfgLanguage which would need to be defined with the Var instruction.<br>
      <br>
      Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br>
      <span class="post-time small text-muted">31st July 2012 17:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br>
        two variables $CfgInstallPath and $CfgLanguage which would need to be defined with the Var instruction.
      </blockquote>Correction to avoid confusion: "Need to be <i>declared</i> with the Var instruction." Defining is done with !define, which is completely different.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">v47</span><br>
      <span class="post-time small text-muted">1st August 2012 12:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">received help from a fellow forum member. adding the function he made, should anyone need something similar in the future:<br>
      <br>
      Function CheckLanguage<br>
      FileOpen $R0 "$INSTDIR\install.cfg" r<br>
      Var /GLOBAL CfgLanguage<br>
      ${DO}<br>
      FileRead $R0 $R1<br>
      ${If} ${Errors}<br>
      ${Break}<br>
      ${EndIf}<br>
      <br>
      StrCpy $R2 $R1 9<br>
      ${If} $R2 == `language `<br>
      StrCpy $CfgLanguage $R1 `` 9<br>
      ${Break}<br>
      ${EndIf}<br>
      ${Loop}<br>
      <br>
      ${Switch} $CfgLanguage<br>
      ${Case} 'english'<br>
      File /oname=install.cfg files\English_install.cfg<br>
      ${Break}<br>
      <br>
      ${Case} 'german'<br>
      File /oname=install.cfg files\German_install.cfg<br>
      ${Break}<br>
      <br>
      ${Default}<br>
      File /oname=install.cfg files\English_install.cfg<br>
      ${Break}<br>
      ${EndSwitch}<br>
      FunctionEnd<br>
      <br>
      thanks to everybody who helped. :)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">PoRtAbLe_StEaLtH</span><br>
      <span class="post-time small text-muted">28th October 2012 06:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Thank You</strong><br>
      Quote:</p>
      <hr>
      How hard would it be to also get line number of found string?

      <table cellpadding="6" cellspacing="0" border="0" width="100%">
        <tr>
          <td class="alt2">
            <hr>
            Originally Posted by <strong>Afrow UK</strong> (Post 2874562) Or you can use this code:
            <pre>
<code>FileOpen $R0 path\to\inst.cfg r<br>${Do}<br><br>  FileRead $R0 $R1<br>  ${If} ${Errors}<br>    ${Break}<br>  ${EndIf}<br><br>  StrCpy $R2 $R1 13<br>  ${If} $R2 == `install_path `<br>    StrCpy $CfgInstallPath $R1 `` 13<br>    ${TrimNewLines} $CfgInstallPath $CfgInstallPath<br>    ${Continue}<br>  ${EndIf}<br><br>  StrCpy $R2 $R1 9<br>  ${If} $R2 == `language `<br>    StrCpy $CfgLanguage $R1 `` 9<br>    ${TrimNewLines} $CfgLanguage $CfgLanguage<br>    ${Continue}<br>  ${EndIf}<br><br>${Loop}<br>FileClose $R0</code>
</pre>Stu
            <hr>
          </td>
        </tr>
      </table><br>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">MSG</span><br>
        <span class="post-time small text-muted">28th October 2012 07:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Simply add a counter to the loop. Start at zero before ${Do}, then +1 just before you ${Loop}</p>
      </div>
      <hr>

      <div class="footer">
        <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
      </div>
    </div><script src="../js/highlight.pack.js" type="text/javascript">
</script> <script type="text/javascript">
//<![CDATA[
    hljs.initHighlightingOnLoad();
    //]]></script></div></body></html>