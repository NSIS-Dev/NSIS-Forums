<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Need to get URL from all open Browser Windows" />

  <title>Need to get URL from all open Browser Windows - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Need to get URL from all open Browser Windows</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=169240">Need to get URL from all open Browser Windows</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">delmardale</span><br />
      <span class="post-time small text-muted">13th February 2004 18:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Need to get URL from all open Browser Windows</strong><br />
      I am trying to configure a setup that will figured out where it was downloaded from, so it can then go out and download files based on your setup selections. This will be installed at various servers around the world, so URL's can't be hardcoded. The webpage automatically downloads and launches the setup when you go to the page. So I plan to look at URL's of open browser windows to get the server. Anyway I've got the code so far using the System plugin to get the URL from an IE window. However I need a way to loop through all open IE windows. It appears there is a windows API function called EnumWindows which should then callback to the application function. However I can't figure out how to do this in NSIS. Below is code go get the URL from an IE window.<br />
      <br />
      Could someone show me or point me to some examples of how to perform this callback. Or tell me another way I can get the window handles of open IE windows.<br />
      <br />
      Once I tackle IE, then I'll work on Mozilla/Netscape.<br />
      <br />
      FindWindow $hWndIE "IEFrame"<br />
      IntCmp $hWndIE 0 done<br />
      MessageBox MB_OK "found IE window"<br />
      FindWindow $hWndIEChild "WorkerW" "" $hWndIE<br />
      FindWindow $hWndIEChild "ReBarWindow32" "" $hWndIEChild<br />
      FindWindow $hWndIEChild "ComboBoxEx32" "" $hWndIEChild<br />
      System::Call 'user32::SendMessage(i,i,i,t) i($hWndIEChild, ${WM_GETTEXT},255,.r0)'<br />
      StrCpy $URLString "$0"<br />
      MessageBox MB_OK "$URLString"</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">13th February 2004 18:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This is really an unreliable method. I recommend you to let it send a command line parameter.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">delmardale</span><br />
      <span class="post-time small text-muted">13th February 2004 18:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Can not do command line, because somehow the URL to download from must be passed. End user can not be expected to know it. Also this setup launches automatically when downloaded from the site. So it's a pretty safe bet that the browser window is still open to the URL. My plan is if it can't find it, it will then prompt the end user for URL</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">13th February 2004 18:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can never be sure what is open and what is not open. You can also not be sure Internet Explorer will be used. I sugggest you append the URL to the installer on the server side, read it from the end of the file on the client side and use it or prompt if not found.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">delmardale</span><br />
      <span class="post-time small text-muted">13th February 2004 18:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Not a bad idea. That will just require appending the server name to the end of the file at each of our 130 sites, annoying but doable. Won't the exe get corrupted though. also have any sample code?<br />
      <br />
      Regarding the browser issue. As of right now we only support IE.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">13th February 2004 18:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You don't have to manually append the URL. Use a PHP script which will output the EXE and then the server's address. It won't corrupt the installer as long as you don't use NSIS_CONFIG_CRC_ANAL.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rainwater</span><br />
      <span class="post-time small text-muted">14th February 2004 04:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you want the open browser windows in Internet Explorer you will have to use DDE. If you don't know what DDE is, then I wouldn't even try it. Its not too bad, but would probably require a plugin. It works on any browsers that support the DDE calls. Probably IE and Opera and maybe a few others.<br />
      <br />
      You would make these DDE requests:<br />
      WWW_ListWindows (to get the window)<br />
      WWW_GetWindowInfo (to get the window url)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">delmardale</span><br />
      <span class="post-time small text-muted">18th February 2004 21:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Appending data to end of setup and reading it</strong><br />
      I've decided to go with kichik's approach of appending server information to the end of the setup dynamically with some sort of CGI script. Anybody got a code sample of how to get my NSIS setup to read this data off the end of the file?</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
