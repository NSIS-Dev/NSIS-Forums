<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="SimpleSC::RemoveService returns 1052 instead of 0."><title>SimpleSC::RemoveService returns 1052 instead of 0. - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">SimpleSC::RemoveService returns 1052 instead of 0.</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=328019">SimpleSC::RemoveService returns 1052 instead of 0.</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">sentromed</span><br><span class="post-time small text-muted">2nd March 2011 14:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>SimpleSC::RemoveService does not work.</strong><br>Hello,<br><br>I am changing my script to use SimpleSC instead of nsSCM.<br>All seems work except RemoveService.<br><br>SimpleSC::RemoveService always returns 1052 (ERROR_INVALID_SERVICE_CONTROL) and it is not removed.<br><br>nsSCM::Remove returns "success" and it is removed.<br><br>Any ideas?<br><br>PS. I am installing by 'SimpleSC::InstallService "MyDrv" "My Driver" "1" "1" "$SYSDIR\Drivers\mydrv.sys" "" "" ""'<br><br>Thanks,<br>Valery.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">blh83</span><br><span class="post-time small text-muted">3rd March 2011 17:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This is sort of a stab in the dark. First the obvious, make sure you are calling RemoveService with the name of your service. In your case you should be calling 'SimpleSC::RemoveService "MyDrv"'.<br><br>Assuming you are doing this and it is not working, then my guess is that the service is not properly stopped. According to MSDN, that error means "The requested control code is not valid, or it is unacceptable to the service." The code should be valid so it likely means the service is not accepting the control (most likely because it is not stopped). Make sure you have code that is checking for the state of the service before trying to remove it. If it says it is running or stopping then you can't call RemoveService and need to either try and resolve this in the installer or notify the user. For example, in one of my installers I check for the existence of a service, get its status, try and stop it, if stop fails I try and kill its process and then stop it again, finally if it was successfully stopped I remove the service. Here is example code with your service name put in (it is a little ugly and there are undoubtedly cleaner ways to do this but this was the first installer I wrote):<br><br>!macro SERVICEUNINST un<br>Function ${un}uninstallService<br>SimpleSC::ExistsService "myDrv"<br>Pop $0 ;check the error code<br>${IF} $0 == 0 ;the service exists<br>SimpleSC::GetServiceStatus "myDrv"<br>Pop $0 ;error code<br>Pop $1 ;service status<br>${IF} $0 == 0 ;0 indicates success<br>${ANDIF} $1 == 4 ;4 = service is running<br>SimpleSC::StopService "myDrv"<br>Pop $0<br>${IF} $0 != 0 ;service could not be stopped, try killing the process<br>Processes::FindProcess "My Driver"<br>${IF} $R0 != 1 ;process not found<br>MessageBox MB_ICONSTOP "Error stopping the service. Please stop the service manually and then restart the uninstall process."<br>Abort<br>${ELSE}<br>Processes::KillProcess "My Driver"<br>${IF} $R0 != 1 ;process not killed<br>MessageBox MB_ICONSTOP "Error stopping the service. Please stop the service manually and then restart the uninstall process."<br>Abort<br>${ELSE} ;killed the process, now try stopping the service again<br>SimpleSC::StopService "myDrv"<br>Pop $0<br>${IF} $0 != 0 ;service could not be stopped<br>MessageBox MB_ICONSTOP "Error stopping the service. Please stop the service manually and then restart the uninstall process."<br>Abort<br>${ENDIF}<br>${ENDIF}<br>${ENDIF}<br>${ENDIF} ;if stop service<br>${ENDIF} ;if service running<br>SimpleSC::GetServiceStatus "myDrv"<br>Pop $0 ;error code<br>Pop $1 ;service status<br>${IF} $0 == 0 ;0 indicates success<br>${ANDIF} $1 == 1 ;1 = service is stopped<br>SimpleSC::RemoveService "MyDrv" ;delete the service<br>${ELSE}<br>MessageBox MB_OK "Service not removed from the system. Please remove it manually using 'sc delete MyDrv' from a command line."<br>${ENDIF} ;if service exists<br>FunctionEnd<br>!macroend</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>