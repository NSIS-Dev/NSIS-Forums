<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="only accept install directory if empty?" />

  <title>only accept install directory if empty? - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">only accept install directory if empty?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=327733">only accept install directory if empty?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">o___O</span><br />
      <span class="post-time small text-muted">23rd February 2011 01:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>only accept install directory if empty?</strong><br />
      I'm working on creating an installation package for a program in a community I'm in, first time working with NSIS in awhile. I came across the issue that I have a lot of files and so thus I'm using recursive method for File to install the files, but this creates the problem that I can't single out just the installation files during uninstallation. I've looked at a couple of solutions like Advanced Uninstall Log and it might work, but it does have the problem of some performance problems especially if there's a lot of files in the selected installation directory. I was trying to think of something that would be easy to implement primarily to avoid things like if the user decided to install directly to Programs Files or something as the documentation suggests that if a user did so and your script just used RMDir /r to remove it, it could wipe out all their files. So my idea outside of the logging scripts would be to simply check if a directory was empty before installation, and I'd prefer this method anyway, and prevent installation otherwise. I'm just getting into reviewing if something like this was possible but it doesn't appear to be easily done, anyone have any good examples or solutions for doing this? Any tips for how I can manage to safely handle the uninstallation process in my situation?<br />
      <br />
      BTW, current steps I'm at are trying to find a way to verify if a directory is empty, and finding a way to prevent the installer from advancing passed the directory page (using MUI2) if it's not. I also wonder why NSIS just doesn't have some more stringent safety checks or way of monitoring this built in, it would be extremely useful..<br />
      <br />
      <br />
      Thank you...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">23rd February 2011 07:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Many ways to do this. A short selection:<br />
      1. There shouldn't be much of a performance penalty for using advanced log headers. Just use them.<br />
      2. Create a leave function for the DIRECTORY page and do ${IfExists} "$INSTDIR\*.*" abort ${EndIf}<br />
      3. Create an (NSIS) exe that lists all filenames in the build directories, then adds 'File ' in front of it etc, at the same time creating the same list with the Delete command. Use !system or !execute to launch that exe during build process. Then !include that exe's output, once in Section, once in unSection.<br />
      4. Probably could do the same with a batch file that calls the compiler after building its include lists.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">o___O</span><br />
      <span class="post-time small text-muted">24th February 2011 22:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I ended up using ${DirState} which is included in FileFunc.nsh - doing a simply Leave function to check if it's "Full" or not, if so it Aborts.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
