<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Prompting for a destination folder for shortcuts"><title>Prompting for a destination folder for shortcuts - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Prompting for a destination folder for shortcuts</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=90218">Prompting for a destination folder for shortcuts</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Zaraza</span><br><span class="post-time small text-muted">6th June 2002 22:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Prompting for a destination folder for shortcuts</strong><br>In most installers, the user has the option to override the default folder where the shortcuts get placed by displaying a list of all the available folders under Start-&gt;Programs.<br><br>is there any way to accomplish this in NSIS? I can't find any code for this, are there maybe some DLL extensions for this?<br><br>It's not a critical feature, but one of those "nice to have" things...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br><span class="post-time small text-muted">7th June 2002 07:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You could try to build this with InstallOptions. The problem: we cannot retrieve the directory structure of the StartMenu using NSIS. You would need to build a DLL for that. The output of this DLL should be the argument of a "DropList" or "ListBox" in InstOpts.<br><br>It's possible, but not with standard NSIS code.<br><br>Good luck,<br>-Hendri.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">7th June 2002 14:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Couldn't the folder listing be accomplished using FindFirst, FindNext and FindClose using some kind of recursive function. To identify folders you should use IfFileExists. Write all the folders you find into the ini file and it is ready to be displayed.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br><span class="post-time small text-muted">7th June 2002 14:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hmmm, yes, could be used of course, but there will be an additional problem (as we also encounter with InstallShield and Wise). Since for example in Win2K every user has its own path for the startmenu. Some users (like me :)) just collect all shortcuts into their own startmenu and clearing the "All user" startmenu. So this is empty, no folders found. So we need some additional programming first to ask the user which folder ("User" or "All users") to use and then we can search that path and display the ini.<br><br>Concluding, possible (contrary to my first belief, please do not punish me, I cannot be almighty or all-knowing).<br><br>Good luck,<br>-Hendri.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Zaraza</span><br><span class="post-time small text-muted">7th June 2002 15:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I am fighting enough with InstallOptions :)<br><br>Let me skip this functionality altogether then...the users can move it wherever they want later...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br><span class="post-time small text-muted">7th June 2002 16:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Zaraza,<br><br>I'll post an example script tomorrow. Check this thread again then.<br><br>-Hendri.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pjw62</span><br><span class="post-time small text-muted">7th June 2002 19:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">hmmm... here is something I wrote a while ago before InstallOptions came out I think (or at least before it was made into a dll). As it is, it isn't particularly impressive (but now works, I think the last time I posted a link, I forgot to include the actuall DLL :)), but someone could use the code and hack it up a bit.<br><br>I can't remember what it does for WinNT start menus..<br><br>(attached).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pjw62</span><br><span class="post-time small text-muted">7th June 2002 19:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Actually, looking over the source code for it, it is extremely ugly. I cant believe I ever wrote that!<br><br>A couple of notes;<br>Check the dll was loaded (I haven't had time to check, but I presume the error flag is set)<br>** request; can dll plugins get a ptr to the error flag/<br>Check the dlg was created (by popping, checking [and pushing, if it does not equal 0]).<br>And no, it is not necessary to extract and delete the dll and resource script everytime it is used.. only at the onInit, abort etc.<br>If the dlg was created, make sure you dealloc.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br><span class="post-time small text-muted">8th June 2002 09:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Here's the script I promised to upload. It uses MultIni4 by Dave Laundon (and a bit by me). See <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=85673" target="_blank">this</a> thread. The pity is that the components of a CustomPage cannot interact. Now people need to retype a selected dir if they want to create a subdir. But it works.<br><br>Good luck, greetz,<br>-Hendri.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br><span class="post-time small text-muted">8th June 2002 09:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sorry, forgot the actual script...<br><br>Here's the attachment.<br><br>[edit #1]<br>I found a bug in the script: forgot to Pop $0 before returning if the user did not type or select a dir. Solved now.<br>[/edit]<br><br>[edit #2]<br>The code by pjw62 solves the problem of non-interacting components and can be implemented in multini4, but to be honest, the setting up the .res file might be a problem.<br>[/edit]<br><br>-Hendri.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pjw62</span><br><span class="post-time small text-muted">8th June 2002 13:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If creating resource files is a problem for people with out the MS Dev studio/resource compiler etc, I think Borland has a free 'resource workshop' available.<br><br>ALso, I was thinking that a better way to implement additional pages etc would be to still use resource files (they are nice and easy to layout and design) would be to have it is as an optional #define on compiling makensis, then we could do things like going backwards and forwards, checking etc more cleanly with callbacks.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br><span class="post-time small text-muted">10th June 2002 07:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">PJW62,<br><br>I searched the Borland site, I couldn't find a free resource workshop. Please post a hyperlink to it so everyone can start using your nice utility.<br><br>Thanks, greetz,<br>-Hendri.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Lion King</span><br><span class="post-time small text-muted">11th June 2002 16:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><a href="http://linux20368.dn.net/protools/utilities.htm" target="_blank">http://linux20368.dn.net/protools/utilities.htm</a><br><br>or <a href="http://protools.cjb.net/" target="_blank">http://protools.cjb.net/</a> if the link above doesn't work<br><br>resource workshop is a 16 bit app, wouldn't resource hacker work also?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br><span class="post-time small text-muted">12th June 2002 09:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, I tested the construction with .res files, but I'm not happy with the results. It seems that the control loads the startmenu of the current user only, so we cannot choose to install shortcuts for all users with this control.<br>To install for all users, we cannot ask to choose a dir. So we're back where we started. In that case, use my solution in NSIS. It has a minor drawback, but it is compatible to multiple users.<br><br>Another drawback is that it doesn't work properly from functions (so implementation in MultIni4 becomes impossible). I couldn't yet figure out why, but when clicking cancel in the ExDlg, .onUserAbort isn't even called. So 'dealloc' and deletion of the dll becomes impossible. (So files remain on harddisk, installer remains resistent as a process...) It works from a section quit well, but then we cannot integrate it in the 'first part of the installer', where user input is requested.<br><br>Maybe pjw62 can solve these bugs for us?<br><br>Check my code, but <b>be warned</b>! Do not compile and run the script!<br><br>Good luck with it, greetz,<br>-Hendri.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pjw62</span><br><span class="post-time small text-muted">12th June 2002 18:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes, thanks for pointing that out Smile2Me.. I think I need to sort out this bug before anyone uses this.<br><br>I've got a Nuclear Physics and Cosmology exam tomorrow, so I dont think I'll be looking at it tonight ;)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br><span class="post-time small text-muted">12th June 2002 20:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok, we'll wait for it. If this bug is solved, it would be a great contribution! Please try your new version with my script and you will easily see if it works.<br><br>Good luck with your exam.<br><br>Greetz,<br>-Hendri.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Smile2Me</span><br><span class="post-time small text-muted">21st June 2002 11:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sunjammer has created a modified InstOpts which allows for communication of components. It is called targetting. So, the problem described above has been solved and this is now a fully working demo. Please remind (as you can find in the zip too) that the modified IO is a beta version!<br><br>Please refer to the <a href="http://www.clantpa.co.uk/nsis/wiki" target="_blank">NSIS Database</a> to keep your script up to date, since we expect some nice modifications of IO to come in the near future.<br><br>Have fun, greetz,<br>-Hendri.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>