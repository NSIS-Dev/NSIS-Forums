<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="$INSTDIR confusing on localized Win7" />

  <title>$INSTDIR confusing on localized Win7 - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">$INSTDIR confusing on localized Win7</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=327521">$INSTDIR confusing on localized Win7</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">knahrvorn</span><br />
      <span class="post-time small text-muted">18th February 2011 07:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>$INSTDIR confusing on localized Win7</strong><br />
      I have a script which uses<br />
      InstallDir "$PROGRAMFILES\MyProgramName"<br />
      and<br />
      Page instfiles<br />
      and is thereafter refers to $INSTDIR for installation and creating a start menu shortcut. So far no problems; my program (in Java) is packed into an installer and is being installed and runs with no problems.<br />
      <br />
      However, today I tried the installer on a Windows 7 system, which was originally installed in English, but now has been set to Danish. This means that "C:\Program Files" is now "C:\Programmer" instead, and apparently that confuses the installer made by my script.<br />
      <br />
      During the install, the installer suggests installation to "C:\Program Files\MyProgramName", and if I just select Next, my program is installed without errors. However, the installed shortcut in the start menu refers to "C:\Program Files\MyProgramName", which makes Java complain that the path is not found.<br />
      <br />
      If, in the installer, I choose to "Browse" my way into "C:\Programmer" (which IS shown in the directory list), I still get "C:\Program Files" as the destination folder in the main install window. If I manually type in "C:\Programmer\MyProgramName", the program is (again) installed without errors, and this time it starts.<br />
      <br />
      What is REALLY weird, I think, is that if I open a command prompt in Win7, it reports that only "C:\Program Files" exists, and the Win7 GUI detects only "C:\Programmer".<br />
      <br />
      So, since I'm not very used to the Windows environment, my question is: Is this normal behaviour from Windows? If so, how do I refer to "C:\Programmer" from an NSIS script?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jiake</span><br />
      <span class="post-time small text-muted">18th February 2011 08:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">C:\Programmer is a diaplay name but not the folder name. You would understand it clearly if you are using a Chinese, Japanese or Korean Windows OS. On Windows XP, some folder names has translated to system's language. The desktop folder path is "C:\Documents and Settings\Adminstrator\桌面" on Simplified Chinese Edition and "C:\Documents and Settings\Adminstrator\Desktop" on English one. But on Windows 7, the desktop folder names of all languanges are the same one: C:\Users\Adminstrator\Desktop, you can only see different display names among OSes of different languages. For example, the Favorites folder of Winows XP is shown as "收藏夹" but the folder name is Favorites, and the Desktop folder on Windows 7 is shown as "桌面" and the folder name is still Desktop, etc. The value of $PROGRAMFILES in NSIS is get from Windows API such as <a href="http://msdn.microsoft.com/en-us/library/bb762204.aspx" target="_blank">SHGetSpecialFolderPath</a>, so on the same system, the path is always the same. I thought that the problem is not the path being incorrect, maybe other reasons.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">knahrvorn</span><br />
      <span class="post-time small text-muted">18th February 2011 09:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">jiake, thank you for the explanation. So it IS expected behaviour from Windows, and as "Program Files" is still the actual directory name, I am indeed receiving the correct path through $INSTDIR. So far, so good.<br />
      <br />
      The strange thing, for me, is now why a shortcut that I create with the following command:<br />
      <br />
      CreateShortCut "$SMPROGRAMS\${PROGRAMNAME}.lnk" "java" "main.MyProgramName" "" "" SW_SHOWNORMAL "" "Program description"<br />
      <br />
      which results in a shortcut like the one on the attached screenshot, is triggering a file not found exception in Java (though the file does exist)...<br />
      <br />
      java.io.FileNotFoundException: C:\Program%20Files\MyProgramName\filename.ext (Den angivne sti blev ikke fundet)<br />
      <br />
      Perhaps because Windows seems to translate "Program Files" into "Program%20Files"? Nah, that shouldn't matter, should it? Besides, I had this working on an English language system where both actual directory name and display name was "Program Files", with no changes.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">18th February 2011 12:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Things like %20 do not work for folder names, they're only used for internet URLs.<br />
      <br />
      Your problem isn't very clear, but it seems to be related to java, not NSIS. You may have to supply a proper path to java, with quote marks. Otherwise, ask java support?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">knahrvorn</span><br />
      <span class="post-time small text-muted">18th February 2011 15:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">MSG, thank you for your reply. I am trying to figure out if this *is* related to Java or to NSIS (or to Windows, for what I knew).<br />
      <br />
      It does indeed seem as if this is an issue with Java instead of NSIS. As far as I understand NSIS, I am already supplying properly quoted path to the java executable. But perhaps I don't understand it correctly? So in order to rule out NSIS, here's what I do when I create the start menu item:<br />
      <br />
      SetOutPath "$INSTDIR"<br />
      in order to set a "current path" from which to run the java executable.<br />
      (I even tried with SetOutPath "$\"$INSTDIR$\"" which didn't seem to make any difference)<br />
      <br />
      then:<br />
      CreateShortCut "$SMPROGRAMS\${PROGRAMNAME}.lnk" "java" "main.MyProgramName" "" "" SW_SHOWNORMAL "" "Program description"<br />
      <br />
      where the first argument is, of course, the name of the shortcut. The next one is the name of the java executable. The next one, the arguments sent to the java exec, is the name of my program with a path relative to the current path as set by SetOutPath.<br />
      <br />
      So, in other words, if I'm not making anything wrong here(?), I know the issue is with Java instead.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">18th February 2011 15:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">How about:<br />
      <br />
      CreateShortCut "$SMPROGRAMS\${PROGRAMNAME}.lnk" "java" `"$INSTDIR\main.MyProgramName"` "" "" SW_SHOWNORMAL "" "Program description"<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
