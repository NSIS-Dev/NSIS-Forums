<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="How to detect a file is locked when deleting a file"><title>How to detect a file is locked when deleting a file - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">How to detect a file is locked when deleting a file</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=268664">How to detect a file is locked when deleting a file</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">JamesKiller</span><br><span class="post-time small text-muted">30th March 2007 19:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>How to detect a file is locked when deleting a file</strong><br>Hi All,<br><br>When I try to delete a file during the uninstallation, just like some .dll, .exe files. If they are still in use or rights issues, I couldn't delete them.<br>When trying to overwrite the files, i couldn't overwrite them?<br>how can I detect them? and how to solve?<br>Any thoughts?<br><br><br>James</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">30th March 2007 20:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Use the Library macros.<br><br><a href="http://nsis.sourceforge.net/Docs/AppendixB.html" target="_blank">http://nsis.sourceforge.net/Docs/AppendixB.html</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JamesKiller</span><br><span class="post-time small text-muted">30th March 2007 22:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">coulde you give me an example????<br>Thank you.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">30th March 2007 22:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That page contains examples.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JamesKiller</span><br><span class="post-time small text-muted">30th March 2007 22:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">IfFileExists "$INSTDIR\MyApp.exe" 0 new_installation ;Replace MyApp.exe with your application filename<br>StrCpy $ALREADY_INSTALLED 1<br>new_installation:<br><br>!insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_NOTPROTECTED dllname.dll $SYSDIR\dllname.dll $SYSDIR<br>hmmmm<br>if i have 20 files, i should write them like above 20 times?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">30th March 2007 22:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If your DLL files are not shared, there is no need for anything but the InstallLib macro. Instead of $ALREADY_INSTALLED, use NOTSHARED. If they are shared, do the test just once, keep the value in $ALREADY_INSTALLED and just add more InstallLib lines.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JamesKiller</span><br><span class="post-time small text-muted">30th March 2007 23:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If a file is locked, how can i get the error message?<br>If the istaller has error, how can I display error message, I mean NSIS error message..<br>Iferrors 0<br>MessageBox MB_OK error_message(NSIS message,not my own message)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JamesKiller</span><br><span class="post-time small text-muted">30th March 2007 23:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">-------------------<br>on the link you gave to me, it says it can:<br>***<br>Windows File Protection checks<br>***<br>How to checks, if file protected, how can show message?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">30th March 2007 23:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If a file is locked the error flag will be set and, if you've enabled reboot, the reboot flag will also be set. There's no message, just a state of failure to delete or replace the file.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">30th March 2007 23:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Files installed by your application are most probably not protected. Only system files are protected by WFP.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JamesKiller</span><br><span class="post-time small text-muted">30th March 2007 23:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">when I run in windows mode (not silent mode, it will show the file is in use. However, run in silent mode . it won't show the error message.....<br>I am expecting the error message in the silent mode.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">30th March 2007 23:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">What error message? The Library macros show no error message. if you're talking about the normal error message for when a file can't be overwritten, then on silent mode it takes the default action of skipping the file or aborting if AllowSkipFiles is set to off.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JamesKiller</span><br><span class="post-time small text-muted">31st March 2007 00:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yeah. You are right.<br>The error message is like " Error opening file for writing:<br>c:\myapp.dll ....."<br>Can I get this error message in silent mode. If I can't, can I set an error flag for this copying file error?<br><br>Thank you for your help.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JamesKiller</span><br><span class="post-time small text-muted">31st March 2007 00:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Or before getting this error message, can I pop up an message like "myApp.dll is in use, can't copy this file!", then I can exit the installer.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">31st March 2007 10:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The error flag is already set when this message appears. You can try deleting the file and checking the error flag to avoid this message on non-silent mode.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JamesKiller</span><br><span class="post-time small text-muted">31st March 2007 18:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">How can set the error flag? which error flag?<br><br>Thank you....</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br><span class="post-time small text-muted">31st March 2007 19:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">clearerrors<br>delete "file.bla"<br>iferrors error_routine<br>;no errors<br><br>;error<br>error_routine:</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">31st March 2007 19:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Regarding to the uninstaller, if you're using MUI, you may add the MUI_UNPAGE_FINISH and for every suspected delete instruction, add the switch /REBOOTOK.<br>If file(s) failed to delete, the finish page should appear with reboot checkboxes.<br>Without MUI_UNPAGE_FINISH you may check in function un.onUninstSuccess the reboot flag (IfRebootFlag), and if is set pop up a message about.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br><span class="post-time small text-muted">31st March 2007 21:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">From experience - reboots are not necessary in most cases.<br>it only need some brain and an idea to replace/rename<br>files. the reboot only do the cleanup.<br>- push the filename<br>- call replacing routine:<br><br>-- delete file -&gt; on success return<br>-- unregister file<br>-- delete file -&gt; on success return<br>-- rename file<br>-- delete renamed file -&gt; on success return<br>-- delete renamed file on reboot<br>-- return<br><br>- copy new file<br>- reset reboot flag (we dont really need it)<br><br>normally user dont work on windows system files so that a reboot is a must</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JamesKiller</span><br><span class="post-time small text-muted">1st April 2007 03:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thank you all for help. I will test it up. Hopefully, i can fix the bug we have.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">onad</span><br><span class="post-time small text-muted">3rd April 2007 10:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Wrote: "Can I get this error message in silent mode."??<br><br>"silent" = no UI interaction nothing displayed only error(result codes)<br><br>"un-attended"= Display of progress but no UI interaction<br><br>"regular"= UI interaction and Display of progress</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>