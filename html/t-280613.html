<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="nsisStartMenu Plugin : ensure your shortcuts order !"><title>nsisStartMenu Plugin : ensure your shortcuts order ! - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">nsisStartMenu Plugin : ensure your shortcuts order !</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=280613">nsisStartMenu Plugin : ensure your shortcuts order !</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Wizou</span><br><span class="post-time small text-muted">3rd November 2007 03:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>nsisStartMenu Plugin : ensure your shortcuts order !</strong><br><a href="http://wiz0u.free.fr/prog/nsisStartMenu" target="_blank">nsisStartMenu Plugin Homepage</a><br><br><u><b><font size="3">Presentation</font></b></u><br><br><b>nsisStartMenu</b> is a small NSIS plugin that that will help you ensure a given order of shortcuts in Start Menu<br><br>You can typically use to ensure that the shortcut for your main program executable appears first and the shortcut for the uninstaller appears last, in the folder you're creating under Windows' Start Menu<br><br><u><b><font size="3">Usage</font></b></u><br>The following is taken from the readme file in the downloadable zip file:<br><br></p><pre>
<code><br>nsisStartMenu::RegenerateFolder "&lt;folder name&gt;"<br><br>&lt;folder name&gt; is the name of your folder under the $SMPROGRAMS folder<br>        It should not contain the prefix $SMPROGRAMS\, but it can contain backslashes if<br>you're working on a subfolder<br><br>This will force an update of the state of the corresponding shell menu (just as if<br>the user has displayed the menu)<br>=&gt; All deleted entries (since the last state of the menu) will be pruned from the<br>menu<br>=&gt; All new entries (since the last state of the menu) will be added at the end of<br>the menu in alphabetical order<br><br>Return Value<br>------------<br><br>nsisStartMenu returns an integer status on the top of the stack<br>Possible status are:<br>        0:  Failure<br>        1:  Success<br></code>
</pre><br>
      <br>
      <u><b><font size="3">Download</font></b></u><br>
      <a href="http://wiz0u.free.fr/prog/nsisStartMenu" target="_blank">nsisStartMenu Plugin Homepage</a><br>
      <br>
      ZIP archive contains the plug-in DLL, as well as documentation, sample script and a LIB file for C++ programmers
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br>
      <span class="post-time small text-muted">15th November 2007 20:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I wonder why my plugin doesn't have much success ?<br>
      I spent so many hours trying to understand how Windows works things out regarding the start menu shortcuts.<br>
      I was proud to have found a clean solution to a problem that seems so common to most installers..<br>
      <br>
      So please tell me :<br>
      - don't you register start menu shortcuts in your installers ?<br>
      - don't you care about the order of these shortcuts ? like it doesn't bother you having "Uninstall" appearing first sometimes ? (especially in language like French "dÃ©sinstaller" is likely to be often first)<br>
      - or maybe you don't add the "uninstall" shortcut to the start menu and let the user go through "add/remove program" ?<br>
      - does your installer registers several shortcuts in the Start Menu ? like help files or secondary programs ?<br>
      <br>
      For those who tried my plugin, don't hesitate to give me some feedback<br>
      <br>
      Thanks !</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br>
      <span class="post-time small text-muted">1st May 2008 23:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just released version 1.1 which supports Unicode-NSIS<br>
      through nsisStartMenu::RegenerateFolderW "&lt;folder name&gt;"<br>
      <br>
      <a href="http://wiz0u.free.fr/prog/nsisStartMenu/" target="_blank">http://wiz0u.free.fr/prog/nsisStartMenu/</a></p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rixor</span><br>
      <span class="post-time small text-muted">13th June 2008 22:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am just about to try your plugin now.<br>
      <br>
      In the meantime I will say THANK YOU! I was getting so frustrated with my shortcuts showing up in what seemed like a totally random order. If this works, you are my hero!</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rixor</span><br>
      <span class="post-time small text-muted">13th June 2008 23:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Didn't seem to work. It always errors.<br>
      <br>
      Here is the code:<br>
      <br></p>
      <pre>
<code><br>CreateDirectory "$SMPROGRAMS\$STARTMENU_FOLDER"<br>SetOutPath "$INSTDIR\path"<br>CreateShortCut "$SMPROGRAMS\$STARTMENU_FOLDER\link.lnk" "$INSTDIR\path\file.exe"<br>nsisStartMenu::RegenerateFolder "$STARTMENU_FOLDER"<br>Pop $0<br>IntCmp $0 0 0 noError noError<br>MessageBox MB_OK "Foiled."<br>noError:<br></code>
</pre><br>
      <br>
      Don't know if this would affect it, but currently (while testing) that link points to nothing. The file doesn't exist. Also, all the shortcut commands are wrapped by the MUI macros:<br>
      <pre>
<code><br>!insertmacro MUI_STARTMENU_WRITE_BEGIN Application<br>!insertmacro MUI_STARTMENU_WRITE_END<br></code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br>
      <span class="post-time small text-muted">16th June 2008 09:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">are you using Unicode-NSIS ?<br>
      what does $STARTMENU_FOLDER contain ?<br>
      are you using SetShellVarContext current or all ?<br>
      does it fail if the shortcut points to an existing file ?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rixor</span><br>
      <span class="post-time small text-muted">16th June 2008 17:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes its Unicode-NSIS<br>
      $STARTMENU_FOLDER contains a string defining the start menu folder name. In this case it was "Product Version".<br>
      I am doing nothing with SetShellVarContext.<br>
      Haven't tried it with a valid link yet.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br>
      <span class="post-time small text-muted">16th June 2008 17:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">for Unicode-NSIS, you should use<br>
      nsisStartMenu::RegenerateFolderW<br>
      instead of<br>
      nsisStartMenu::RegenerateFolder</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rixor</span><br>
      <span class="post-time small text-muted">16th June 2008 18:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Works like a hot damn! Thank you, sir!</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Yathosho</span><br>
      <span class="post-time small text-muted">16th June 2008 18:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Wizou</i><br>
        <b>I wonder why my plugin doesn't have much success ?<br>
        I spent so many hours trying to understand how Windows works things out regarding the start menu shortcuts.<br>
        I was proud to have found a clean solution to a problem that seems so common to most installers..</b>
      </blockquote>i'm often annoyed by unsorted startmenus, so i wrote a script that just orders it on every startup. however, i wouldn't force a setting on a different user, just because i prefer it. i'm thinking of adding it, if it doesn't add to much size.. but only with a dialog, which asks for confirmation first. otherwise people might skip your product just because of that installer behaviour.<br>
      <br>
      just wanted to point this out, of course a lot of commands alone can do damage, it's all about the right combination of commands :)
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br>
      <span class="post-time small text-muted">17th June 2008 00:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I just gave your plugin a try and it seems to work fine.<br>
      Guess I'll keep it in my installer. Thanks!<br>
      <br>
      One question though:<br>
      Which OS does it support? Will it work on Vista too?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br>
      <span class="post-time small text-muted">17th June 2008 08:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">@Yathosho: My plug-in only orders the start menu subdirectory of your choice (typically the one your installer is creating), not the whole start menu. And it <b>can't</b> place new shortcuts <b>in front of</b> existing ones.<br>
      So it can only be useful for building up your application's submenu so that your shortcuts appears in a useful order.<br>
      <br>
      @LoRd_MuldeR: As noted in the ReadMe file, I've tested it under Windows XP but it should be compatible with Windows 2000, XP and more recent. However, on Vista, the new start menu doesn't allow the user (or an installer) to choose a customized order for shortcuts. So I can't do anything for it. In any case, you can still call the plug-in, it won't do any harm and gracefully return an error code if it didn't work.<br>
      <br>
      PS: I just realized that you could choose the old start menu behaviour in Vista, and it seems like nsisStartMenu doesn't work with it. I will check that out and release a compatible version of nsisStartMenu soon.<br>
      <br>
      Thanks for your feedback :)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br>
      <span class="post-time small text-muted">17th June 2008 15:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Wizou</i><br>
        However, on Vista, the new start menu doesn't allow the user (or an installer) to choose a customized order for shortcuts. So I can't do anything for it. In any case, you can still call the plug-in, it won't do any harm and gracefully return an error code if it didn't work.
      </blockquote>Thx, that's what I needed to know!
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">zdenek_martinek</span><br>
      <span class="post-time small text-muted">18th July 2008 15:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">First, thanks a lot for this plugin, I could not find any documentation in MSDN about this matter, so I am happy I have found this plugin.<br>
      <br>
      Positioning one item as first or as last functions fine, but I want to have *all* menu items positioned in the order they were created. It is not much clear what the RegenerateFolder actually does, so I do not know whether calling it after each inserted item would bring the desired effect (I will test it anyway).</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br>
      <span class="post-time small text-muted">18th July 2008 17:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by zdenek_martinek</i><br>
        <b>First, thanks a lot for this plugin, I could not find any documentation in MSDN about this matter, so I am happy I have found this plugin.<br>
        <br>
        Positioning one item as first or as last functions fine, but I want to have *all* menu items positioned in the order they were created. It is not much clear what the RegenerateFolder actually does, so I do not know whether calling it after each inserted item would bring the desired effect (I will test it anyway).</b>
      </blockquote>1. Delete the folder (if existing)<br>
      2. Create a new folder<br>
      3a. Create new Shortcut in that folder<br>
      3b. Run "RegenerateFolder" on the folder<br>
      3c. If more shortcuts then goto 3a, else skip<br>
      4. You are done!
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">zdenek_martinek</span><br>
      <span class="post-time small text-muted">18th July 2008 18:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks, now it works much better! Anyway, I still have a partial problem: the shortcuts are now placed as I need, but when there are subdirectories (=submenus), they are still sorted alphabetically, even if after each directory creation I call RegenerateFolder for its parent.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br>
      <span class="post-time small text-muted">19th July 2008 13:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by zdenek_martinek</i><br>
        <b>Thanks, now it works much better! Anyway, I still have a partial problem: the shortcuts are now placed as I need, but when there are subdirectories (=submenus), they are still sorted alphabetically, even if after each directory creation I call RegenerateFolder for its parent.</b>
      </blockquote>Make sure you RegenerateFolder also *before* creating the *first* subfolder.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br>
      <span class="post-time small text-muted">21st July 2008 08:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for helping people out, LoRd_MuldeR :)<br>
      <br>
      Just to let you know my findings: On Vista, the new start menu *does* in fact allow for a custom order if the user has uncheck the "sort Programs menu by name" in the Start menu Properties dialog.<br>
      This is not a well-known option so I doubt many users have changed it (checked by default), but I'm working on having nsisStartMenu also function properly with it.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">zdenek_martinek</span><br>
      <span class="post-time small text-muted">21st July 2008 10:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by LoRd_MuldeR</i><br>
        <b>Make sure you RegenerateFolder also *before* creating the *first* subfolder.</b>
      </blockquote>Now it works, I also had a small bug in my code. Thanks again for this valuable plugin! :up:
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br>
      <span class="post-time small text-muted">21st July 2008 10:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by zdenek_martinek</i><br>
        <b>Thanks again for this valuable plugin! :up:</b>
      </blockquote>You're welcome :)
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>