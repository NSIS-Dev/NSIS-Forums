<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="nub needs help adding text"><title>nub needs help adding text - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">nub needs help adding text</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=179716">nub needs help adding text</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">docp</span><br><span class="post-time small text-muted">12th May 2004 09:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>nub needs help adding text</strong><br>I'm totally ignorant of this type of scripting from scratch. The closest thing I can claim is the DOS from 15 yrs ago ('mid 80's?), so please bear with me.<br>I'm trying to find out if I can add (and erase) text inside of a text document. I write scripts for Half-Life, not engine or mod scripts, just plain old alias scripts, and I need to find a way to add text so that the game will automatically execute them.<br>I'm going to give an example for ease of understanding:<br>I have a basic script pack and want to be able to offer "addons" to be downloaded seperately. To have them executed in the game, a text line has to be added to a file.<br>Example: valve.rc<br>exec script.cfg<br>exec buy.cfg<br>If 2 "addons" were downloaded seperately, I'd have to add an exec line into that file for each script.<br>I have a .nsi script that I use for the Pack install, which might be able to be modified further to suit my needs, but I don't know the commands to make it happen.<br>Here's the .nsi I'm using for the pack install (I only modified it to suit my specific files):<br># DocPak3 NSIS Source Code<br># Rev. 5/5/04 9:20pm cst<br># Originally written by esky<br># Modified by !Doc<br># You may use this code for your own reference<br># If you copy any of my functions, please give proper credit<br><br>Name "DocPak3"<br>OutFile "DocPak3.exe"<br>ShowInstDetails hide<br><br># These are custom icons for the installer<br># Delete the two lines to use default icons, or point to your own<br>Icon "C:\Program Files\Scripts\DP3\doc.ico"<br>UninstallIcon "C:\Program Files\Scripts\DP3\undoc.ico"<br><br># Aux function to delete elements at the end of a path<br># This function is taken from NSIS documentation<br>Function getParent<br>Push $8<br>Exch $0<br>Push $1<br>Push $2<br>StrCpy $1 -1<br>loop:<br>StrCpy $2 $0 1 $1<br>StrCmp $2 "" exit<br>StrCmp $2 "\" exit<br>IntOp $1 $1 - 1<br>Goto loop<br>exit:<br>StrCpy $0 $0 $1<br>Pop $2<br>Pop $1<br>Exch $0<br>FunctionEnd<br><br># Find Steam via RegKey, then delete the half-life part, add Counter-Strike<br>Function findSteam<br>ReadRegStr $8 HKCU \<br>"Software\Valve\Steam" \<br>"ModInstallPath" ;These three lines find the key<br>Push $8<br>Call getParent ;delete 'half-life' from the end<br>Pop $8<br>StrCmp $8 "" skip addcs ;make sure a path was indeed copied from the registry<br>addcs:<br>StrCpy $INSTDIR "$8\Counter-Strike" ;add Counter-Strike on the end<br>GoTo skip2<br>skip:<br>StrCpy $INSTDIR "" ;this only happens if the path read from registry is empty or non-existant<br>skip2:<br>FunctionEnd<br><br># Using path found in registry, make sure hl.exe exists in the counter-strike folder<br># This is to verify that extracting giles to the *path*\cstrike will place script in correct place<br>Function doubleCheck<br>IfFileExists $INSTDIR\hl.exe skip notify<br>notify:<br>StrCpy $INSTDIR "Unable to find CS. Please browse manually..."<br>skip:<br>FunctionEnd<br><br># Stuff to do when installer is started, before actual Install takes place<br>Function .onInit<br>Call findSteam ;attempt to find counter-strike path from registry<br>Call doubleCheck ;double check path is correct<br>FunctionEnd<br><br># Make sure install path is correct<br># This checks both the path auto-detected, and anything the user inputs<br># Installer will not continue until the path has hl.exe<br>Function .onVerifyInstDir<br>IfFileExists $INSTDIR\hl.exe PathGood<br>Abort<br>PathGood:<br>FunctionEnd<br><br>DirText "Enter your Counter-Strike account location. Setup will try to detect the correct path. However, if path cannot be verified (hl.exe is not found), setup cannot continue."" "<br><br># This section actually extracts all my stuff, also deletes previous installation if found<br>Section<br>Delete "$INSTDIR\cstrike\DocPak\*.*"<br>RMDir "$INSTDIR\cstrike\DocPak"<br>Rename $INSTDIR\cstrike\valve.rc $INSTDIR\cstrike\valve.rc.old<br>Rename $INSTDIR\cstrike\titles.txt $INSTDIR\cstrike\titles.txt.old<br>Rename $INSTDIR\cstrike\commandmenu.txt $INSTDIR\cstrike\commandmenu.txt.old<br>Rename $INSTDIR\cstrike\gfx\shell\kb_act.lst $INSTDIR\cstrike\gfx\shell\kb_act.lst.old<br>Rename $INSTDIR\cstrike\gfx\shell\kb_def.lst $INSTDIR\cstrike\gfx\shell\kb_def.lst.old<br>SetOutPath $INSTDIR\cstrike\DocPak<br>File "C:\Program Files\Scripts\DP3\cstrike\DocPak\buy.cfg"<br>File "C:\Program Files\Scripts\DP3\cstrike\DocPak\common.cfg"<br>File "C:\Program Files\Scripts\DP3\cstrike\DocPak\default.cfg"<br>File "C:\Program Files\Scripts\DP3\cstrike\DocPak\names.cfg"<br>File "C:\Program Files\Scripts\DP3\cstrike\DocPak\says.cfg"<br>File "C:\Program Files\Scripts\DP3\cstrike\DocPak\scripts.cfg"<br>File "C:\Program Files\Scripts\DP3\cstrike\DocPak\DP3.readme.rtf"<br>SetOutPath $INSTDIR\cstrike\gfx\shell<br>File "C:\Program Files\Scripts\DP3\cstrike\gfx\shell\kb_act.lst"<br>File "C:\Program Files\Scripts\DP3\cstrike\gfx\shell\kb_def.lst"<br>SetOutPath $INSTDIR\cstrike<br>File "C:\Program Files\Scripts\DP3\cstrike\valve.rc"<br>File "C:\Program Files\Scripts\DP3\cstrike\titles.txt"<br>File "C:\Program Files\Scripts\DP3\cstrike\commandmenu.txt"<br>WriteUninstaller "$INSTDIR\UninstallDocPak3.exe"<br>SetOutPath $SMPROGRAMS\DocPak3<br>CreateShortCut "$SMPROGRAMS\DocPak3\DP3.readme.lnk" "$INSTDIR\cstrike\DocPak\DP3.readme.rtf"<br>CreateShortCut "$SMPROGRAMS\DocPak3\Uninstall.lnk" "$INSTDIR\UninstallDocPak3.exe"<br>SectionEnd<br><br>UninstallText "This will uninstall DocPak3. Hit next to continue."<br><br># Restore the valve.rc and commandmenu.txt the person had before installing<br>Function un.Rename<br>Rename $INSTDIR\cstrike\valve.rc.old $INSTDIR\cstrike\valve.rc<br>Rename $INSTDIR\cstrike\titles.txt.old $INSTDIR\cstrike\titles.txt<br>Rename $INSTDIR\cstrike\commandmenu.txt.old $INSTDIR\cstrike\commandmenu.txt<br>Rename $INSTDIR\cstrike\gfx\shell\kb_act.lst.old $INSTDIR\cstrike\gfx\shell\kb_act.lst<br>Rename $INSTDIR\cstrike\gfx\shell\kb_def.lst.old $INSTDIR\cstrike\gfx\shell\kb_def.lst<br>FunctionEnd<br><br>Section "Uninstall"<br>Delete "$INSTDIR\cstrike\valve.rc"<br>Delete "$INSTDIR\cstrike\titles.txt"<br>Delete "$INSTDIR\cstrike\commandmenu.txt"<br>Delete "$INSTDIR\UninstallDocPak3.exe"<br>Delete "$INSTDIR\cstrike\gfx\shell\kb_act.lst"<br>Delete "$INSTDIR\cstrike\gfx\shell\kb_def.lst"<br>Delete "$INSTDIR\cstrike\DocPak\*.*"<br>RMDir "$INSTDIR\cstrike\DocPak"<br>Delete "$SMPROGRAMS\DocPak3\*.*"<br>RMDir "$SMPROGRAMS\DocPak3"<br>Call un.Rename<br>SectionEnd<br><br># If install is success, it will ask the user to show the readme.html<br>Function .onInstSuccess<br>MessageBox MB_YESNO|MB_ICONQUESTION \<br>"All Done! You can bind controls in Options. View ReadMe now?" \<br>IDNO NoReadme<br>ExecShell "open" $INSTDIR\cstrike\DocPak\DP3.readme.rtf<br>NoReadme:<br>FunctionEnd<br>;eof<br><br>I am curious about adding text into a text document from the installer. The reason I'm not putting all the scripts into one installer is that there are about 30-40 of them, and putting in a components option would be a bit much (to be honest, I wouldn't know how to start that anyway).<br>Thanks for any help you can give me.<br><br>ps. the adding text would be for installing and deleting text would be for uninstalling, wasn't sure if that was clear. Thanx again.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">12th May 2004 10:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">NSIS has build-in commands for text file modification. There are several examples available in the archive.<br><br>The easiest way is to read the text file, append or remove the data and write everything back.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>