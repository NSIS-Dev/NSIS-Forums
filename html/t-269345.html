<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Dialog refresh/redraw problem with UMUI"><title>Dialog refresh/redraw problem with UMUI - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Dialog refresh/redraw problem with UMUI</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=269345">Dialog refresh/redraw problem with UMUI</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">thek</span><br><span class="post-time small text-muted">11th April 2007 12:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Dialog refresh/redraw problem with UMUI</strong><br>I'm using the UMUI for the Installer<br><br>But sometimes I have a problem in the section selection page<br>It looks like the TreeContorl in this Page didn't get refreshed properly<br>See Screenshot:<br><a href="http://www.thek.org/tikiwiki/show_image.php?id=193" target="_blank">http://www.thek.org/tikiwiki/show_image.php?id=193</a><br><br>somebody knows a quick hack to solve this problem?<br><br>Simple moving the Dialog helps (because it forces the Dialog to redraw, is there some way to do this automaticly?<br><br><br>regards<br>nobs</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">11th April 2007 15:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Did you contact to the developer of UMUI?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">thek</span><br><span class="post-time small text-muted">11th April 2007 15:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Indirectly: Yes<br><br>Normaly he is reading this forum too!<br>;-)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sheik</span><br><span class="post-time small text-muted">11th April 2007 15:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi nobs, all.<br><br>I get this once and awhile too with UMUI.<br><br>I normally see it on the "Files" progress bar<br>while files are being copied/installed.<br><br>If I "hide" the window under Windows, and bring it back up, it is "refreshed" correctly, so I know it has something to do with UMUI not capturing its redraw events correctly.<br><br>Another annoyance I have found, I wonder if you see it too...<br>When I move from Page to Page with UMUI, there is a "blink" refresh problem.<br><br>You can see the "box" where UMUI is drawn in blue, but it turns to "grey" box, and then moves to the next page.<br>This "flickering" is very annoying.<br><br>I have found a workaround for this problem in my own scripts, by having a "post" function for each page, and calling this routine:<br><br>/* This is needed to stop "flickering" when using UMUI */<br>Function RefreshPageKludge<br>!ifdef UMUI_INCLUDED<br>/* This is needed to stop "flickering" when using UMUI */<br>SetCtlColors $HWNDPARENT ${MUI_BGCOLOR} ${MUI_BGCOLOR}<br>!endif<br>FunctionEnd<br><br>Kinda lame, but it works.<br><br><br>I was kinda letting these problems "slide", mainly because I am hoping SuperPat will release his "beta2" of UMUI, which might already have these problems fixed.<br><br>Scott</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">SuperPat</span><br><span class="post-time small text-muted">14th April 2007 11:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hello,<br><br></p><blockquote><i>Originally posted by Sheik</i><br>I normally see it on the "Files" progress bar<br>while files are being copied/installed.<br><br>Another annoyance I have found, I wonder if you see it too...<br>When I move from Page to Page with UMUI, there is a "blink" refresh problem.<br><br>You can see the "box" where UMUI is drawn in blue, but it turns to "grey" box, and then moves to the next page.<br>This "flickering" is very annoying.<br>[/B]</blockquote>Somtimes, With beta 2, I have these problems...<br><br>I will test the workaround of Sheik in the beta 2 shortly.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sheik</span><br><span class="post-time small text-muted">15th April 2007 01:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi SuperPat.<br><br>My "fix" only addresses the "flickering" problem when switching pages.<br><br>It does NOT fix the problem where UMUI doesn't refresh the page correctly, either right away, or while things are being displayed, say while the "Install Files" page is up and running.<br><br>Scott</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sheik</span><br><span class="post-time small text-muted">20th April 2007 19:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi all,<br><br>Just an update on this.<br><br>I found a "sledgehammer" approach to fixing this problem,<br>at least for the ProgressBar on the InstPage section.<br><br>Here is what I did.<br><br>In my first Install files "section"<br>I do the following:<br><br>FindWindow $0 "#32770" "" $HWNDPARENT<br>GetDlgItem $8 $0 1004<br>System::Call "user32::InvalidateRect(i,i,i)i (r8, 0, 1).r4"<br><br>This forces a complete redraw of the ProgressBar.<br><br>It should be noted that the above does NOT fix the problem, if I add this code to a MUI_PAGE_CUSTOMFUNCTION_SHOW function for INSTFILES page.<br><br>It *has* to be used in your "files" section stuff to have it fix the problem.<br><br>My best guess? is that there is some sort of race going on, where the problem can only be fixed AFTER the "SHOW" function gets called, but before any files actually start to get installed.<br><br>Just as an added "hint", I am surprised you see the problem with the components page, I see there is this "hack" already in the C++ for the components page/tree.<br><br>// workaround for bug #1397031<br>&lt;snip&gt;<br>InvalidateRect(hwTree, NULL, TRUE);<br><br>(Which is where I really got the idea from) =)<br><br>Scott</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">DrDan</span><br><span class="post-time small text-muted">9th May 2007 10:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Has the refresh bug been fixed yet?</strong><br>If not, I will have to use the MUI rather than the UMUI.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">thek</span><br><span class="post-time small text-muted">2nd July 2007 14:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Workaround</strong><br>Hello guys<br><br>is there a way to get the on_click or a on_notify message from the Userinterface?<br><br>I tried to fix the redraw problem in the UMUI componentspage<br>but the only thing I was able to achieve was adding this lines .onmousemove Function<br></p><pre>
<code>!insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br>    push $1<br>    push $4<br>    push $8<br>    FindWindow $1 "#32770" "" $HWNDPARENT<br>    GetDlgItem $8 $1 1032<br>    System::Call "user32::InvalidateRect(i,i,i)i (r8, 0, 1).r4"<br>#    System::Call "user32::SetWindowPos(i,i,i,i,i,i,i)i (r8, 0, 0, 0, 0, 0, 67).r4"<br>    pop $8<br>    pop $4<br>    pop $1<br>    !insertmacro MUI_DESCRIPTION_TEXT ${SECGRP0000} $(DESC_SECTIONGRP_00)<br># other insertmacro blablabla<br>    !insertmacro MUI_DESCRIPTION_TEXT ${SEC0016}    $(DESC_SECTION_16)<br>!insertmacro MUI_FUNCTION_DESCRIPTION_END<br></code>
</pre><br>
      <br>
      But the update problem still exists (it only redraws after moving the mouse)<br>
      also it doesn't update the Scrollbar of the window.<br>
      <br>
      Can somebody give me hint?<br>
      regards Norbert<br>
      <br>
      @SuperPat:<br>
      is UMUI already dead, or you are still developing it?
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sheik</span><br>
      <span class="post-time small text-muted">2nd July 2007 16:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I haven't heard from SuperPat in awhile...<br>
      Not sure if he is still working on UMUI or not.<br>
      <br>
      I am hoping if he isn't, that he at least puts out what he has of the "beta 2" of UMUI.<br>
      <br>
      Even if its broken in places, I like some of the new things he has done, and could help clean up/fix them.<br>
      <br>
      I don't want to invest any time in "fixing" the existing UMUI when I know he has a new version out there that will replace the existing one.<br>
      <br>
      Scott</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SuperPat</span><br>
      <span class="post-time small text-muted">6th July 2007 11:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I always work on it in my free time but It remain unfinished.<br>
      <br>
      <b>This is the latest TODO List:</b><br>
      <b>- Maintenance Page:</b> coding of the function of Modification of an existing installation.<br>
      <b>- Serial Number page:</b> support of the safeguard of the parameters in the register, addition of the TOLOWER, TOUPPER and NUMBERS flags, To pass from an input to another during striking on the keyboard of the serial.<br>
      - Rewriting one of the macros managing UMUI Flags (They allow, amongst other things, to know which options were chooses in various pages...)<br>
      - Second reading and cleaning of all the code<br>
      - Complete the documentation<br>
      <b>Corrections for InstallOptionEx:</b><br>
      * Transparent Icons are not transparent in the page...<br>
      * Button are not drawn if I use my SkinnedButton plugin... whereas that work very well with InstallOptions.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>