<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Shortcut icons seem corrupted" />

  <title>Shortcut icons seem corrupted - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Shortcut icons seem corrupted</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=286312">Shortcut icons seem corrupted</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MidnightJava</span><br />
      <span class="post-time small text-muted">5th February 2008 03:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Shortcut icons seem corrupted</strong><br />
      I must be missing something basic, because it seems very straightforward to make icons work, but I can't get them to work for shortcuts.<br />
      <br />
      I have an icon file, ec_icon.ico, which I created with an icon editor. It was made from a 16 x 16 .gif file, and the icon for the icon file looks as expected in Windows Explorer. Also, I use this icon for the installer icon, via<br />
      <br /></p>
      <pre>
<code>Icon ec_icon.ico</code>
</pre><br />
      <br />
      and it looks fine in the installer window.<br />
      <br />
      But then I try to use the same icon file as the QuickLaunch icon, with the following NSIS commands in the installer Section<br />
      <br />
      <pre>
<code>SetOutPath $INSTDIR<br /> File "ec_icon.ico"<br /> CreateShortcut "$QUICKLAUNCH\$(^Name).lnk" "$INSTDIR\ec.exe" "" "$INSTDIR\ec_icon.ico"</code>
</pre><br />
      <br />
      An icon shows up in the QuickLaunch tray, but it's pretty much just garbage. It's not a default icon, it's just a corrupted image. I tried setting an icon index of 0 or 1 in the CreateShortcut command (there is only one image in the.ico file), but then I get a default icon in the QuickLaunch tray.<br />
      <br />
      Can someone please tell me what I'm missing?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pospec</span><br />
      <span class="post-time small text-muted">5th February 2008 05:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What is the .ICO filesize?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MidnightJava</span><br />
      <span class="post-time small text-muted">5th February 2008 06:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">1 KB</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pospec</span><br />
      <span class="post-time small text-muted">5th February 2008 06:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Icons for installer have to be 766 B. Maybe you'll need two icons - one for installer and one for that quicklaunch shortcut.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MidnightJava</span><br />
      <span class="post-time small text-muted">5th February 2008 06:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Do you mean put two image sin one .ico file? I put one 16 x 16 andone 32 x 32 .gif in the .ico file, and now the size is 766 B. (Previously it was half this value. 1 KB was the rounded value in Explorer; I didn't know you wanted the precise value.)<br />
      <br />
      Anyway I still have the problem. Only now the "good" icon is displaying in gray scale, where it used to display in color. By "good" icon, I mean the one that displays in th Installer window, the icon for the .ico file itself, and also the uninstaller icon (both in the start menu shortcut and on the uninstaller.exe file).<br />
      <br />
      All the other icons (Quicklaunch and in the start menu) are displayed in gray scale and also distorted to the point of being unrecognizable.<br />
      <br />
      edit: I also should mention, the color depth when I created the .ico file was 8 bit. But I bumped it to 32 bit, and still the icon displays in gray scale.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pospec</span><br />
      <span class="post-time small text-muted">5th February 2008 06:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I mean two .ico files in your installer - one file for the shortcut and one embeded in installer.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MidnightJava</span><br />
      <span class="post-time small text-muted">5th February 2008 06:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm not sure I understand the distinction you;re making. So the one .ico is included in the installer via the File command. And then I reference it in the dir $INSTDIR via the CreateShortcut command. Now what it does it mean in distinction from this to have one ,ico file "emebedded in installer"?<br />
      <br />
      I deleted my icon cache file and rebooted. Now all icons are behaving the same-- gray scale, but no longer distorted. But all other icons, for other programs, are displaying in color.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pospec</span><br />
      <span class="post-time small text-muted">5th February 2008 07:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That quicklaunch icon has nothing to do with installer icon (via Icon instruction - that's why I write embeded). Choose such quicklaunch icon, that looks well, pack it with File instruction, extract somewhere (e.g. $INSTDIR) and you're done.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MidnightJava</span><br />
      <span class="post-time small text-muted">5th February 2008 12:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK I see what you were saying, and that's what I did. I embedded the icon file, and extracted it into $INSTDIR. This is the file I point to with the QL shortcut.<br />
      <br />
      I used a separate copy of the same icon file as the installer icon. I was doing this originally just to verify that the icon was built properly, especially when the icon was looking right in the installer and uninstaller shortcut, but looking wring in other locations.<br />
      <br />
      Now the icons are gray scale in every case relating to NSIS, but if I edit them with a resource editor, they're in color. So I remain baffled.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pospec</span><br />
      <span class="post-time small text-muted">5th February 2008 12:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What if you create that QL shortcut MANUALLY and set it's icon to that 766 B .ico? I mean that you could use two DIFFERENT files, one which fit in installer and one which fit in QL shortcut. I can't help you further.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">5th February 2008 14:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Explorer can show icons if they are just bitmaps renamed to .ico. My bet is you haven't converted your gif images over to ico properly.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MidnightJava</span><br />
      <span class="post-time small text-muted">6th February 2008 04:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, the icon file became invalid at some point. That was causing the gray scale effect. Also icon caching was apparently causing confusion. I no longer see an icon cache file to delete as I did once, but still have to reboot every time I change the icon.<br />
      <br />
      Now I have a .ico file with 16, 32, and 48 bit .bmp images, each at 4, 8, and 24 bit color depths, and with colors from the MS icon color palette. The behavior with this file is consistent, but still bad. The color shows up, but the image is all jumbled up.<br />
      <br />
      I display the same image directly as an icon, using Java to place it in the system tray or the Window title bar or the task bar, and it looks fine. But when I display it as a .ico file, created to MS specs for resolution and color depth, it's unrecognizable. This is not an NSIS problem. Apparently MS icons are very hard to get right. I did this in about 30 seconds on the Mac.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">6th February 2008 07:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">could you post this icon so we can take a look at it, might be a problem with your editor</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MidnightJava</span><br />
      <span class="post-time small text-muted">6th February 2008 15:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">icon file uploads are not permitted for the site, so I posted it <a href="http://mysite.verizon.net/midnightjava/icon.html" target="_blank">here</a><br />
      <br />
      I posted a link to the icon file and to the bmp file as well, so you can see what the image is supposed to look like.<br />
      <br />
      I used "XN Resource Editor" to create the icon from bmp files. I put 9 different bmp files into the icon file. I provided 16x16, 32x32, and 48x48 resolution images, each with 4-bit, 8-bit, and 32-bit color depth. The bmp files have only two colors in them, with RGB values from the MS color palette for icons. This is in accordance with what I read <a href="http://www.aha-soft.com/faq/q5.htm" target="_blank">here</a><br />
      <br />
      It does look like the bmp files are not being extracted properly from the .ico file, but I don't know why.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">6th February 2008 16:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There has to be a problem with the way you create the icon, there are several free icon editors out there, give one of them a try,<br />
      <br />
      <a href="http://icofx.*********/" target="_blank">http://icofx.*********/</a><br />
      or<br />
      <a href="http://greenfish.extra.hu/downloads.php" target="_blank">http://greenfish.extra.hu/downloads.php</a><br />
      to name just two</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MidnightJava</span><br />
      <span class="post-time small text-muted">6th February 2008 22:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the icon editor suggestions. I wasn't able to find anything with Google except XN Resource Editor, which seems to fail completely, at least wrt creating icons.<br />
      <br />
      I downloaded both editors you recommended, and they seem to do the job properly. At least the icon for the icon file itself looks right, and I can open the icon file with both editors and see all 9 images with the proper resolutions and color depths.<br />
      <br />
      But the icon still doesn't look right after creating with NSIS. The old gray scale icon shows up instead of the color one. For example, I create the QuickLaunch icon with<br />
      <br /></p>
      <pre>
<code> CreateShortcut $QUICKLAUNCH\$(^Name).lnk "$INSTDIR\ec.exe" "" "$INSTDIR\ec_icon.ico"</code>
</pre><br />
      <br />
      after having put the icon file in the install dir via<br />
      <br />
      <pre>
<code> SetOutPath $INSTDIR<br />File "ec_icon.ico"</code>
</pre><br />
      <br />
      <br />
      But then the QL icon is gray scale. This happens with start menu icons as well.<br />
      <br />
      I thought perhaps I need to supply an icon index number in the CreateShortcut command, but I don't see any index numbers identifying the icon images with either editor. I tried using 1, 2,3...9 for icon indices, but when I do that NSIS fails to find the icon altogether.<br />
      <br />
      For some reason NSIS seems to be causing the icon to be rendered with 1-bit color depth. I followed prospec's suggestion and manually configured a QuickLaunch item to point to the same icon file, and then it's rendered properly in the QuickLaunch tray. I also tried the following for creating the QL shortcut<br />
      <br />
      <pre>
<code>CreateShortcut "$SMPrograms\$StartMenuGroup\$(^Name).lnk" "$INSTDIR\ec.exe" "" "ec_icon.ico"</code>
</pre><br />
      <br />
      so I point directly to the icon file instead of extracting it from the installer executable. In this case I get the gray scale icon image as well. So I seem to be close, but I remain flummoxed.<br />
      <br />
      BTW, I posted the new version of the icon file, created with IcoFX, <a href="http://mysite.verizon.net/midnightjava/icon.html" target="_blank">here</a>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MidnightJava</span><br />
      <span class="post-time small text-muted">7th February 2008 21:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It looks like icon caching was responsible for the remaining problem. I had deleted $APPDATA\IconCache.db earlier to remove cached icons, but it never re-appeared and yet icons are being cached somewhere. Renaming the icon made it display properly, and then after a reboot I could use the old name again.<br />
      <br />
      Thanks for all the help, especially the pointer to icon editors that actually work. XN Resource Editor really caused a lot of problems, and the Windows mysterious icon caching scheme made a bad situation worse.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">GregL</span><br />
      <span class="post-time small text-muted">26th February 2008 16:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try adding RefreshShellIcons?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">meaningoflights</span><br />
      <span class="post-time small text-muted">5th August 2008 11:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Desktop Icon Remains</strong><br />
      I experienced a similar issue where the desktop icon and StartMenu folder remained after uninstall.<br />
      <br />
      I implemented http://nsis.sourceforge.net/Refresh_Desktop and that didn't make a difference.<br />
      <br />
      The problem was that I had installed the app under different users, hence putting:<br />
      <br />
      SetShellVarContext all<br />
      <br />
      in the uninstall section resolved my issue:)<br />
      <br />
      HTH someone else</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comperio</span><br />
      <span class="post-time small text-muted">5th August 2008 15:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Speaking of icon editors... For a very quick slap-it-together type of icon editor, I have not found any better than <a href="http://www.towofu.net/soft/e-aicon.php" target="_blank">Icon Susuhi</a><br />
      <br />
      I know the name sounds real cheesy, but it works great and it's free.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
