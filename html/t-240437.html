<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="printer driver installation"><title>printer driver installation - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">printer driver installation</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=240437">printer driver installation</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">hanspaul</span><br><span class="post-time small text-muted">10th March 2006 14:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>printer driver installation</strong><br>Hello,<br><br>could someone post me an example on how I would install a printer with NSIS? I expierence to use the necessery functions in NSIS: GetPrinterDriverDirectory, AddPrinter and AddPrinterDriver.<br><br>a c++ Way for GetPrinterDriverDirectory would be:<br><br>char *pDirInfo = NULL;<br>DWORD cbBuf = 0;<br>DWORD pcbNeeded;<br>GetPrinterDriverDirectory(NULL,NULL,1,(LPBYTE)pDirInfo,0,&amp;pcbNeeded);<br>pDirInfo = new char[1+pcbNeeded/sizeof(char)+50];<br>cbBuf = sizeof(char)*(1+pcbNeeded/sizeof(char)+50);<br><br><br>GetPrinterDriverDirectory(NULL,NULL,1,(LPBYTE)pDirInfo,cbBuf,&amp;pcbNeeded);<br><br><br>thanks a lot for help<br><br>hans</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">10th March 2006 14:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can write a plug-in that'd call those API functions, or you can call them from the script using the <a href="http://nsis.sourceforge.net/Docs/System/System.html" target="_blank">System plug-in</a>.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">hanspaul</span><br><span class="post-time small text-muted">10th March 2006 14:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">yes this is actually what I tried, but I don't know how I actually call it correctly.<br><br>System::Call 'winspool.drv::GetPrinterDriverDirectory(0,0,i 1, t .r1, i ${NSIS_MAX_STRLEN,i ${NSIS_MAX_STRLEN)'<br><br>for example won't work for me :(<br><br>so my questions does someone have NSIS examples on how to use GetPrinterDriverDirectory, AddPrinterDriver and AddPrinter?<br><br>thanks a lot<br><br>hans</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">10th March 2006 14:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">There are a few errors in that System call. You didn't specify a type for the first two arguments and you forgot to close both NSIS_MAX_STRLEN uses. You also set the wrong type for the last argument. It should be a pointer to an integer, not an integer. The call should be:</p><pre>
<code>System::Call 'winspool.drv::GetPrinterDriverDirectory(i 0, i 0, i 1, t .r1, i ${NSIS_MAX_STRLEN}, *i)'</code>
</pre></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">hanspaul</span><br><span class="post-time small text-muted">10th March 2006 14:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">thanks a lot, it worked perfect, my last problem, I am still stuck with these data-types. DRIVER_INFO_4<br>would you be so kind to please tell me how I could perform something like that with NSIS?:<br><br>DRIVER_INFO_4 DriverInfo;<br>// fill the memory with zeros<br>memset(&amp;DriverInfo, 0, sizeof(DriverInfo));<br><br>// default info<br>DriverInfo.cVersion = 3;<br>DriverInfo.pName = "my printer";<br><br>etc....<br><br>AddPrinterDriver(NULL, 2, (BYTE*)&amp;DriverInfo);<br><br><br>thanks very much<br><br>hans</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">10th March 2006 14:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">There's a detailed explanation about working with structures with the System plug-in at the bottom of its <a href="http://nsis.sourceforge.net/Docs/System/System.html" target="_blank">documentation page</a>.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">hanspaul</span><br><span class="post-time small text-muted">10th March 2006 14:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">ok I will read into it, I was searching inside the forum but could not find anything. Thanks a lot for the link and the example above, kichik.<br><br>greetings<br>hans</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">theInstaller</span><br><span class="post-time small text-muted">14th March 2006 07:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>a option</strong><br>maybe you could need that?<br><br>try this command in the shell<br><br>rundll32 printui.dll,PrintUIEntry /?<br><br>as example you can use the full command<br>rundll32 printui.dll,PrintUIEntry /in /n \\printserver\DeskJet /q<br>to install a printer.<br><br>So you can easy add and remove network printers.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">hanspaul</span><br><span class="post-time small text-muted">14th March 2006 13:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">yea but the prob is that this method doesn't allow you to add a custom printer with a custom printer driver. I finally decided to keep the code in c++ and just call the dll externally from nsis.<br><br>thanks for all your replies,<br><br>hans</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>