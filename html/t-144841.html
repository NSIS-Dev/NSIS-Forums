<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Backup Files at install if file exsits..?"><title>Backup Files at install if file exsits..? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Backup Files at install if file exsits..?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=144841">Backup Files at install if file exsits..?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">tatsudoshi</span><br><span class="post-time small text-muted">5th August 2003 22:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Backup Files at install if file exsits..?</strong><br>When installing stuff, some files might get overwritten on the end user's pc. Is there a way to make the installer move files to be overwritten to a backup folder, so at uninstall, all is as if the installer never was installed?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">5th August 2003 23:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It can be hard to do this.<br><br>Example:<br>CreateDirectory "$INSTDIR\backup"<br>IfFileExists "$INSTDIR\file.txt" 0 +2<br>Rename "$INSTDIR\file.txt" "$INSTDIR\backup\file.txt"<br><br>SetOutPath $INSTDIR<br>File "file.txt"<br><br>Then for uninstall, just do<br>CopyFiles "$INSTDIR\backup\*.*" "$INSTDIR\*.*"<br>RMDir /r "$INSTDIR\backup"<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tatsudoshi</span><br><span class="post-time small text-muted">5th August 2003 23:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok I get the idea.. thx m8.. u r a plain old dude of knowleg ;)<br><br>This is my file as it is of now, but I can't get it to uninstall right. All it sais is "Copy failed". Anyone how can see what's wrong?<br><br>UninstallText "This will uninstall xes ${version}${build}. Hit next to continue."<br>Section "Uninstall"<br>SetAutoClose false<br>ReadRegStr $R0 HKLM Software\x-systems\xes InstallDir<br>CopyFiles $R0\cstrike\xes_backup\*.* $R0\cstrike\*.*<br>RMDir /r $R0\cstrike\xes_backup<br>RMDir /r $R0\cstrike\xes<br>RMDir /r $SMPROGRAMS\x-systems\xes<br>RMDir $SMPROGRAMS\x-systems<br>DeleteRegKey HKLM Software\Microsoft\Windows\CurrentVersion\Uninstall\x-systems\xes<br>DeleteRegKey /ifempty HKLM Software\Microsoft\Windows\CurrentVersion\Uninstall\x-systems<br>DeleteRegKey HKLM Software\x-systems\xes<br>DeleteRegKey /ifempty HKLM Software\x-systems<br>SectionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tatsudoshi</span><br><span class="post-time small text-muted">6th August 2003 08:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'v tryed to make the uninstaller reinstall the overwritten files by doing this:<br><br>UninstallText "This will uninstall xes ${version}${build}. Hit next to continue."<br>Section "Uninstall"<br>SetAutoClose false<br><b>ReadRegStr $INSTDIR HKLM Software\x-systems\xes InstallDir<br>IfFileExists "$INSTDIR\cstrike\xes_backup\autoexec.cfg" +1 +2<br>Rename "$INSTDIR\cstrike\xes_backup\autoexec.cfg" "$INSTDIR\cstrike\autoexec.cfg"</b><br>RMDir /r $INSTDIR\cstrike\xes_backup<br>RMDir /r $INSTDIR\cstrike\xes<br>RMDir /r $SMPROGRAMS\x-systems\xes<br>RMDir $SMPROGRAMS\x-systems<br>DeleteRegKey HKLM Software\Microsoft\Windows\CurrentVersion\Uninstall\x-systems\xes<br>DeleteRegKey /ifempty HKLM Software\Microsoft\Windows\CurrentVersion\Uninstall\x-systems<br>DeleteRegKey HKLM Software\x-systems\xes<br>DeleteRegKey /ifempty HKLM Software\x-systems<br>SectionEnd<br><br>But in the details window this is all that is shown:<br><br>Remove folder: D:\Half-Life\cstrike\xes_backup<br>Remove folder: D:\Half-Life\cstrike\xes<br>Remove folder: C:\Documents and Settings\Administrator\Start Menu\Programs\x-systems\xes<br>Remove folder: C:\Documents and Settings\Administrator\Start Menu\Programs\x-systems<br>Completed<br><br>Any ideas folks?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">6th August 2003 10:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Whats wrong?<br><br>Write/ReadRegStr's or any form of INI/Reg management in NSIS is not shown in the LogWindow.<br>Why would the user want to see that kind of stuff - the LogWindow is to show management of file movement/extraction.<br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tatsudoshi</span><br><span class="post-time small text-muted">6th August 2003 11:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Your first examble didn't work, it just wrote "Copy files from ?:\blah\more blah\*.* to ?:\new blah -&gt; Copy failed.<br><br></p><blockquote><i>Originally posted by Afrow UK</i><br><b>Then for uninstall, just do<br>CopyFiles "$INSTDIR\backup\*.*" "$INSTDIR\*.*"<br>RMDir /r "$INSTDIR\backup"<br><br>-Stu</b></blockquote>So I tryed to make it like this:<br><br><b>IfFileExists "$INSTDIR\cstrike\xes_backup\autoexec.cfg" +1 +2<br>Rename "$INSTDIR\cstrike\xes_backup\autoexec.cfg" "$INSTDIR\cstrike\autoexec.cfg"</b><br><br>But it still doesn't work. The files that are backed up, are not reinstalled at uninstall.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">6th August 2003 11:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Try using my code with:<br><br>CopyFiles "$INSTDIR\backup\*.*" "$INSTDIR"</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tatsudoshi</span><br><span class="post-time small text-muted">6th August 2003 12:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sorry Afrow but I think you need to do some more sleeping ;P<br><br>Your first examble didn't work, it just wrote "Copy files from ?:\blah\more blah\*.* to ?:\new blah -&gt; Copy failed.<br><br><br><br><b>Originally posted by Afrow UK<br>Then for uninstall, just do<br>CopyFiles "$INSTDIR\backup\*.*" "$INSTDIR\*.*"<br>RMDir /r "$INSTDIR\backup"<br><br>-Stu</b></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">6th August 2003 12:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">My method is far better than the method you are trying to achieve.<br>Firstly, you are backing up the files - thats fine, but on uninstall, why copy a single file back when you can copy them all back in one go.<br><br>E.g.<br>#Install<br>Rename "C:\blah1.txt" "C:\backup\blah1.txt"<br>Rename "C:\blah2.txt" "C:\backup\blah2.txt"<br>Rename "C:\blah3.txt" "C:\backup\blah3.txt"<br><br>#Uninstall<br>CopyFiles "C:\backup\blah1.txt" "C:\blah1.txt"<br>CopyFiles "C:\backup\blah2.txt" "C:\blah2.txt"<br>CopyFiles "C:\backup\blah3.txt" "C:\blah3.txt"<br><br>The uninstall bit is pointless and a waste of code.<br>A simple<br>CopyFiles "C:\backup\*.*" "C:\"<br>Will do them all in one go.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">6th August 2003 12:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>It can be hard to do this.<br><br>Example:<br>CreateDirectory "$INSTDIR\backup"<br>IfFileExists "$INSTDIR\file.txt" 0 +2<br>Rename "$INSTDIR\file.txt" "$INSTDIR\backup\file.txt"<br><br>SetOutPath $INSTDIR<br>File "file.txt"<br><br>Then for uninstall, just do<br>CopyFiles "$INSTDIR\backup\*.*" <b>"$INSTDIR"</b><br>RMDir /r "$INSTDIR\backup"<br><br>-Stu</blockquote></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tatsudoshi</span><br><span class="post-time small text-muted">6th August 2003 12:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This is what happens when I try your method:<br><br>Copy to D:\Half-Life\cstrike\xes\*.*<br>Copy failed<br>Remove folder: D:\Half-Life\cstrike\xes_backup<br>Remove folder: D:\Half-Life\cstrike\xes<br>Remove folder: C:\Documents and Settings\Administrator\Start Menu\Programs\x-systems\xes<br>Remove folder: C:\Documents and Settings\Administrator\Start Menu\Programs\x-systems<br>Completed<br><br>And the problem is this: Copy to D:\Half-Life\cstrike<b>\xes\</b>*.*. For some reason it puts a \xes\ folder in the $INSTDIR or where ever, I don't know. This is the code I have in the script:<br>CopyFiles "$INSTDIR\xes_backup\*.*" "$INSTDIR\*.*"<br><br>I might add that it delets the folders and removes the reg's and shortcuts and so on..</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">6th August 2003 12:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I've already told you twice:<br>CopyFiles "$INSTDIR\xes_backup\*.*" "$INSTDIR\*.*"<br>should be<br>CopyFiles "$INSTDIR\xes_backup\*.*" "$INSTDIR"<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tatsudoshi</span><br><span class="post-time small text-muted">6th August 2003 12:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes I know.. it still makes no difference :(<br><br>Copy to D:\Half-Life<br>Copy failed<br>Remove folder: D:\Half-Life\cstrike\xes_backup<br>Remove folder: D:\Half-Life\cstrike\xes<br>Remove folder: C:\Documents and Settings\Administrator\Start Menu\Programs\x-systems\xes<br>Remove folder: C:\Documents and Settings\Administrator\Start Menu\Programs\x-systems<br>Completed</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">6th August 2003 12:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Can you show the exact script like it is now?<br><br>Btw, how many files are you backing up?<br><br>Thanks<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tatsudoshi</span><br><span class="post-time small text-muted">6th August 2003 12:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I don't know how to attach..? About 10-13 files plus the folder tree they are in.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">6th August 2003 12:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I mean the uninstall code.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tatsudoshi</span><br><span class="post-time small text-muted">6th August 2003 12:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">UninstallText "This will uninstall xes ${version}${build}. Hit next to continue."<br>Section "Uninstall"<br>SetAutoClose false<br>ReadRegStr "$INSTDIR" HKLM Software\x-systems\xes InstallDir<br>CopyFiles "$INSTDIR\xes_backup\" "$INSTDIR\cstrike\"<br>RMDir /r "$INSTDIR\cstrike\xes_backup"<br>RMDir /r "$INSTDIR\cstrike\xes"<br>RMDir /r $SMPROGRAMS\x-systems\xes<br>RMDir $SMPROGRAMS\x-systems<br>DeleteRegKey HKLM Software\Microsoft\Windows\CurrentVersion\Uninstall\x-systems\xes<br>DeleteRegKey /ifempty HKLM Software\Microsoft\Windows\CurrentVersion\Uninstall\x-systems<br>DeleteRegKey HKLM Software\x-systems\xes<br>DeleteRegKey /ifempty HKLM Software\x-systems<br>SectionEnd<br><br>The "$INSTDIR\cstrike\" was just an atempt to find the error.. I'v tryed "$INSTDIR", "$INSTDIR\", "$INSTDIR\*.*" and so on and on....<br>It just returns "Copy faild" :(</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">6th August 2003 12:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">CopyFiles "$INSTDIR\xes_backup\*.*" "$INSTDIR" should work fine.<br><br>If you are only backing up 1 file then you could use your code:<br><br>IfFileExists "$INSTDIR\xes_backup\autoexec.cfg" 0 +3<br>Delete "$INSTDIR\autoexec.cfg"<br>Rename "$INSTDIR\xes_backup\autoexec.cfg" "$INSTDIR\autoexec.cfg"<br>RMDir "$INSTDIR\xes_backup"<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">6th August 2003 12:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">How about this:<br>CopyFiles "$INSTDIR\xes_backup\*.*" "$INSTDIR\*"<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tatsudoshi</span><br><span class="post-time small text-muted">6th August 2003 12:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If the file is already there, does CopyFiles not overwritte it?<br><br>How about this:<br>CopyFiles "$INSTDIR\xes_backup\*.*" "$INSTDIR\*"<br><br>Nop didn't change a thing.. damn one should think that the NSIS team would have made a better uninstall function.. or some more up-2-date documentation ;P</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">6th August 2003 12:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes, unless the file is open or being used.<br><br>You could do a<br>Delete "$INSTDIR\autoexec.cfg"<br>before hand.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">6th August 2003 13:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think this now is a better method.<br>It allows more control over the files...<br><br>IfFileExists "$INSTDIR\xes_backup\autoexec.cfg" 0 +3<br>Delete "$INSTDIR\autoexec.cfg"<br>Rename "$INSTDIR\xes_backup\autoexec.cfg" "$INSTDIR\autoexec.cfg"<br><br>IfFileExists "$INSTDIR\xes_backup\blah.txt" 0 +3<br>Delete "$INSTDIR\blah.txt"<br>Rename "$INSTDIR\xes_backup\blah.txt" "$INSTDIR\blah.txt"<br><br>RMDir "$INSTDIR\xes_backup"<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tatsudoshi</span><br><span class="post-time small text-muted">6th August 2003 13:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">YES! If there is a file with the same name as the target file as in the Rename label is doesn't move it! *hint* put in documentation *hint* :)<br><br>Thx Afrow.. now it does what I want it to.. thx alot m8 :)</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>