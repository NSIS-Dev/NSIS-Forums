<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="how to get Add/Remove to not wait on ExecShell?"><title>how to get Add/Remove to not wait on ExecShell? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">how to get Add/Remove to not wait on ExecShell?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=272793">how to get Add/Remove to not wait on ExecShell?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">bobics</span><br><span class="post-time small text-muted">13th June 2007 22:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>how to get Add/Remove to not wait on ExecShell?</strong><br>I have the following code to open an web page when uninstall has finished:<br><br>Function un.onUninstSuccess<br>ExecShell "open" "http://www.google.com/"<br>FunctionEnd<br><br>When running from the Add/Remove applet, I'll see the default browser open as expected. I cannot, however, close the Add/Remove applet until the browser (either IE and Firefox) has also been closed. I think this is because the browser is launched as a child process which causes the applet to wait. When I look in the Task Manager the uninstaller process (Au_.exe) is no longer running.<br><br>Does anyone know how to have the Add/Remove applet not wait?<br><br>Thanks,<br>bobics</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">13th June 2007 22:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">!include 'WinMessages.nsh'<br><br>Function un.onUninstSuccess<br>FindWindow $0 '' 'Add or Remove Programs'<br>SendMessage $0 ${WM_CLOSE} 0 0<br>ExecShell "open" "http://www.google.com/"<br>FunctionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bobics</span><br><span class="post-time small text-muted">13th June 2007 23:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks a bunch, it works for me.<br><br>That's definitely much better than having the Add/Remove applet hang, although the most ideal behavior would be to leave the applet alone. Looks like a problem with the Exec/ExecShell implementation.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">14th June 2007 01:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Looking for "Add or Remove Programs" window title is a bad solution unless your software only runs on english versions of windows.<br><br>There is nothing wrong with the Exec/ExecShell implementation in nsis. The ARP applet works like this by design, on windows 2000 it will only wait for the initial process, on xp it creates a job object and waits for every process created.<br><br>Doing Exec '"explorer.exe" <a href="http://example.com" target="_blank">http://example.com</a>' might work but will probably not use the default browser but IE</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bobics</span><br><span class="post-time small text-muted">14th June 2007 02:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for the info, previously I did try:<br><br>http://nsis.sourceforge.net/Open_link_in_new_browser_window<br><br>which comes out to the equivalent Exec '"C:\Program Files\Internet Explorer" http://example.com' but that also hung.<br><br>How do I work around this "problem"? I tried a similar test with InstallShield (LaunchApp("C:\\Program Files\\Internet Explorer\\iexplore.exe", "http://www.google.com")) and it does *not* hang the Add/Remove applet.<br><br>I can surmise a few reasons for waiting on the job on XP (e.g. a possible separate child uninstall process, setups that spawn a temporary cloned instance so the uninstall exe can be deleted, etc.). I do not believe, however, that this fits the most commmon *expected behavior* for Exec... since if I did want it to wait, I would have used ExecWait. It seems InstallShield figured this out...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bobics</span><br><span class="post-time small text-muted">14th June 2007 02:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Actually, my apologies, it looks like InstallShield has the same behavior as NSIS. (I was dumb and launched it from the wrong location in my test.)<br><br>Might not be any way around this.<br><br>Also I think using the close window signal still leaves an instance of rundll32 even though there's no UI, which is pretty bad.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">14th June 2007 03:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The reason I used explorer.exe (Not IE) in my example is that explorer is already running so it will not start a new process (Well it will start and then end right away)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bobics</span><br><span class="post-time small text-muted">14th June 2007 19:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks, you're a genius!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jdt2oo7</span><br><span class="post-time small text-muted">18th January 2010 18:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I tried Exec '"explorer.exe" <a href="http://example.com" target="_blank">http://example.com</a>', it works on XP and Windows 7, but not Vista. Any idea?<br><br>Thanks!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">18th January 2010 19:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by jdt2oo7</i><br><b>I tried Exec '"explorer.exe" <a href="http://example.com" target="_blank">http://example.com</a>', it works on XP and Windows 7, but not Vista. Any idea?<br></b></blockquote>Well, it is a hack...</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">demiller9</span><br><span class="post-time small text-muted">18th January 2010 22:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You might try creating a scheduled task to open the url. Set the delay very short - it only needs to be a couple of seconds ahead of the current clock. The ARP process will not see it as a child or part of the job, so they should close (or be closeable) when your uninstaller ends.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Zinthose</span><br><span class="post-time small text-muted">18th January 2010 22:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Why not just execute as a new process?<br><br><a href="http://nsis.sourceforge.net/Escape_ARP_Job_With_New_Process" target="_blank">http://nsis.sourceforge.net/Escape_A...th_New_Process</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">18th January 2010 23:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Zinthose</i><br><b>Why not just execute as a new process?<br><br><a href="http://nsis.sourceforge.net/Escape_ARP_Job_With_New_Process" target="_blank">http://nsis.sourceforge.net/Escape_A...th_New_Process</a></b></blockquote>I have not updated that code for Vista/7, so I'm not sure if it still works<br><br>The ONLY way to launch a URL in a non hacky way is to use a out of process custom COM object (parent process of the COM host .exe would not be in the same process tree as the uninstaller) (You would register the COM dll, use it, unregister, so, it is also a ugly workaround)</div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>