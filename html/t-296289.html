<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Can't abstract all variables in Registry Edit/Delete Call...HKLM must be clear text?"><title>Can't abstract all variables in Registry Edit/Delete Call...HKLM must be clear text? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Can't abstract all variables in Registry Edit/Delete Call...HKLM must be clear text?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=296289">Can't abstract all variables in Registry Edit/Delete Call...HKLM must be clear text?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Andrew Wallo</span><br><span class="post-time small text-muted">21st August 2008 20:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Can't abstract all variables in Registry Edit/Delete Call...HKLM must be clear text?</strong><br>[ Preface, I realize that I now have three distinct discussions on abstracting variables out of compile time and into runtime.... I'll stop posting threads now until I get them resolved, but they ARE all different issues....]<br><br>Evidentially I am pushing the boundaries of the programming language a bit here in desiring a greater abstraction than exists..... but why does an enumerated string ( HKLM/HKCU etc ) not get resolved at runtime if the remaining parameters that are getting passed to it can be? Seems to be an oversight in the kernal's handling of those parameters.... should just have a case statement resolve the variable... just like it does for the keys...<br><br>This is a limitation that makes the alter registry calls much less flexible....<br><br><br>; $R1 is set to "HKLM"<br>; $R2 is set to "SomeRegistryKey\SomeCustomProgram"<br>; $R3 is set to "SomeEntryName"<br>; $R4 is set to "13523" ( a value )<br><br># THIS PASSES COMPILE<br>DeleteRegValue HKLM $R2 $R3<br><br># THIS DOES NOT<br>DeleteRegValue $R1 $R2 $R3<br><br>#SAME WITH THIS:<br>WriteRegStr HKLM $R2 $R3 $R4<br># VERSUS THIS:<br>WriteRegStr $R1 $R2 $R3 $R4<br><br><br>So it becomes impossible to keep a pure log entry of the registry items that were edited. You'd have to group them by HKLM etc... or $SWITCH handle the parameter when you called the DeleteRegValue, WriteRegStr, ReadRegStr etc...<br><br>$Switch $R1<br>$Case "HKLM"<br>DeleteRegValue HKLM $R2 $R3<br>$Case "HKCU"<br>DeleteRegValue HKCU $R2 $R3<br>$Case "HKCU"<br>DeleteRegValue HKCC $R2 $R3<br><br>....Etc. Etc. Etc.<br><br>I feel like I'm at the point where I need to start pushing on the ceiling a bit. How do I learn to change/edit expand the part of the programming that controls these functions? Or is the base NSIS kernal only edited by submission and conseses?<br><br>_Thanks...[ going silent now till I get some answers.]</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">21st August 2008 21:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It is so that the hkey can be verified at compiletime (I don't agree with this design, but it is the way it works ATM) you can use the registry plugin as a workaround</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Andrew Wallo</span><br><span class="post-time small text-muted">21st August 2008 21:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Example of the curren workaround.....</strong><br>Example of the handling I need to do to get my abstraction to compile. It seems unnecessary.... but if I understood why the compiler required the Enumeration I probably would understand the languages limitations a bit better. This compiled:<br><br>[CODE; Because GetBetween only uses files as sources.... ( stupid, that I'm using that here, but I am.... )<br>${GetBetween} "&lt;NEW&gt;" "&lt;/NEW&gt;" "$1\SRS_TempFile.txt" $4 ; Get the file name between the file tags of the read_line_in-&gt;$2 and stick it in $4<br>${GetBetween} "&lt;ROOT&gt;" "&lt;/ROOT&gt;" "$R1\SRS_TempFile.txt" $R1 ; Get the file name between the file tags of the read_line_in-&gt;$2 and stick it in $R2<br>${GetBetween} "&lt;KEY&gt;" "&lt;/KEY&gt;" "$1\SRS_TempFile.txt" $R2 ; Get the file name between the file tags of the read_line_in-&gt;$2 and stick it in $4<br>${GetBetween} "&lt;SUBKEY&gt;" "&lt;/SUBKEY&gt;" "$1\SRS_TempFile.txt" $R3 ; Get the file name between the file tags of the read_line_in-&gt;$2 and stick it in $R3<br>${GetBetween} "&lt;VALUE&gt;" "&lt;/VALUE&gt;" "$1\SRS_TempFile.txt" $R4 ; Get the file name between the file tags of the read_line_in-&gt;$2 and stick it in $R4<br><br><br>StrCmp $4 "1" 0 SRS_RESTORE_WRITE ; if the new marker is set to 1 then a rollback means remove it entirely.....<br>${Switch} $R1<br>${Case} "HKLM"<br>DeleteRegValue HKLM $R2 $R3<br>${Case} "HKCR"<br>DeleteRegValue HKCR $R2 $R3<br>${Case} "HKCU"<br>DeleteRegValue HKCU $R2 $R3<br>${Case} "HKU"<br>DeleteRegValue HKU $R2 $R3<br>${Case} "HKCC"<br>DeleteRegValue HKCC $R2 $R3<br>${Case} "HKDD"<br>DeleteRegValue HKDD $R2 $R3<br>${Case} "HKPD"<br>DeleteRegValue HKPD $R2 $R3<br>${Case} "SHCTX"<br>DeleteRegValue SHCTX $R2 $R3<br>${EndSwitch}<br>Goto SRS_RESTORE_ReadLine[/CODE]</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Andrew Wallo</span><br><span class="post-time small text-muted">21st August 2008 21:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>But THIS works?</strong><br>!macro SetRegistry_with_RollbackControl _RootKey _RegistryKey _SubKey _Value<br><br>WriteRegStr ${_RootKey} ${_RegistryKey} ${_SubKey} ${_Value}<br><br>!macroend</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">21st August 2008 22:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The root key cannot be a variable.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">21st August 2008 22:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">But it can be SHCTX.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Andrew Wallo</span><br><span class="post-time small text-muted">21st August 2008 22:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Grrrrrr.</strong><br>It IS a variable. Its just an enumerated, restricted pre-defined set of acceptable values and it should beable to say, OH... variable... that resolves to... and if it can't resolve at runtime it throws an error the same as if the KEY didn't exist.....<br><br>The system compiler call SHOULD take runtime resolution of that variable, just like it can for the REST of the variables.<br><br>If this annoyed me enough.... What do I need to read to learn how I go about changing it?... more as an exercise of becoming a god-like NSIS designer....than anything else. A few cumbersome casestatements aren't really worth it... but just SAY I wanted to......<br><br>_Andrew</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>