<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Problem with uninstall REGKEYS and startmenu files" />

  <title>Problem with uninstall REGKEYS and startmenu files - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Problem with uninstall REGKEYS and startmenu files</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=326809">Problem with uninstall REGKEYS and startmenu files</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">steph0815</span><br />
      <span class="post-time small text-muted">3rd February 2011 10:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>[solved] Problem with uninstall REGKEYS and startmenu files</strong><br />
      Hello,<br />
      <br />
      I'm new in using NSIS to create a installer. I started with some tutorials and it worked fine. So I decided to use NSIS for my further projects to create a installer. The first projects where plain projects, just copy some files and thats it.<br />
      <br />
      Now I have a project with a client and a server application. Only one application should be installed. Therefore I created a "components page" with 2 insttypes. Afterwards I defined the sections for each. That works fine.<br />
      My problem is in the uninstall section. Here I try to delete the regkeys and startmenu files. The uninstall regkeys are deleted also the files on the harddrive. The problem is the regkey in the "run" environment of the registry and all startmenu files.<br />
      After looking through the search I found the solution with "RequestExecutionLevel user". I tried it but it didn't worked.<br />
      <br />
      I attached the complete file, so if someone can help me I will appreciate this!<br />
      <br />
      greetz<br />
      steph0815</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">3rd February 2011 10:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">RequestExecutionLevel admin.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">steph0815</span><br />
      <span class="post-time small text-muted">3rd February 2011 10:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">THX for the quick help.<br />
      This solves half of my problem. Now it deletes all startmenu entries. But the registry entry for autorun is still not deleted. Mayb there is some other problem.<br />
      Beside the "RequestExecutionLevel admin" I added a part to check if the user is really a admin in the .onInit function. I added the enhanced code here.<br />
      <br />
      greetz<br />
      Steph0815</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">steph0815</span><br />
      <span class="post-time small text-muted">3rd February 2011 11:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Oh i forgott the file, sorry!<br />
      <br />
      greetz<br />
      Steph0815</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">3rd February 2011 12:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by steph0815</small><br />
        Beside the "RequestExecutionLevel admin" I added a part to check if the user is really a admin in the .onInit function. I added the enhanced code here.
      </blockquote>Very good, that's indeed a necessary step.<br />
      <br />
      As for your problem, you write a regstr and try to delete a regkey. You should use DeleteRegValue, not DeleteRegKey.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">steph0815</span><br />
      <span class="post-time small text-muted">3rd February 2011 12:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello,<br />
      <br />
      THX that was the reason why it didnt worked. Now its working fine!<br />
      <br />
      greetz</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
