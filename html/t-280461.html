<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="NT Authority and Scheduler Code"><title>NT Authority and Scheduler Code - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">NT Authority and Scheduler Code</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=280461">NT Authority and Scheduler Code</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">bulgin</span><br><span class="post-time small text-muted">31st October 2007 23:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>NT Authority and Scheduler Code</strong><br>Thanks for everyone's help when I had problems with the code for the scheduler -- I can get it to work now. One thing that confuses me, though, is I can get a scheduled task to run using AUTHORITY\System without a password if I'm creating the task with the Windows Task Scheduler GUI. If I use Authority\System as the user without password in the NSIS script, it fails to run. Me no understand. No Cabish! Is this standard behavoir? Can I make it so that the NSIS script can run with Authority\System and no password? Thanks in advance and I apologize for my lack of knowledge at this point in time.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">1st November 2007 19:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I don't understand. Are you running a NSIS installer from a scheduled task and get nothing or are you trying to schedule task with NSIS and fail?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bulgin</span><br><span class="post-time small text-muted">2nd November 2007 00:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Kichik thanks for your reply.<br><br>I am successful running a scheduled task from the NSIS generated executable as per the code. I need to input the current user and their password for it to work -- that I believe is normal behavior. However, I would like to run it as NT Authority\System and I am unable to do so when I do this to the code:<br><br>Section "SiteSecureBackup"<br>push "My Task"<br>push "My Task Comment"<br>push "c:\Working Dir\My Task Program.exe"<br>push "c:\Working Dir"<br>push ""<br>push "*(&amp;l2, &amp;i2 0, &amp;i2 2007, &amp;i2 11, &amp;i2 1, &amp;i2 0, &amp;i2 0, &amp;i2 0, &amp;i2 9, &amp;i2 0, i 0, i 0, i 0, i 2, &amp;i2 1, &amp;i2 0x2, &amp;i2 0, i 0, &amp;i2 0) i.s"<br>push "NT Authority\System"<br>push ""<br>Call CreateTask<br>Pop $0<br>MessageBox MB_OK "CreateTask result: $0"<br><br><br>HOWEVER I am able to run a task with the NT Authority\System user and no password when I create the task using the Windows scheduler wizard built into Windows XP (I just input "NT Authority\System" into the "Enter the user name" box and leave password blank). So why does it work with the wizard but not the script? I would like to be able to run a task using the NSIS Script using NT Authority\System just like wizard does. Can this be done? Thank you.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">2nd November 2007 09:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You need to update the script to pass NULL instead of an empty password. In the SetAccountInformation call, replace <i>r8</i> with <i>n</i>.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bulgin</span><br><span class="post-time small text-muted">3rd November 2007 05:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">thank you, and in following part did I do it correctly? Or should those "pushes" both be blank?<br><br>Thanks<br><br>Section "SiteSecureBackup"<br>push "My Task"<br>push "My Task Comment"<br>push "c:\Working Dir\My Task Program.exe"<br>push "c:\Working Dir"<br>push ""<br>push "*(&amp;l2, &amp;i2 0, &amp;i2 2007, &amp;i2 11, &amp;i2 1, &amp;i2 0, &amp;i2 0, &amp;i2 0, &amp;i2 9, &amp;i2 0, i 0, i 0, i 0, i 2, &amp;i2 1, &amp;i2 0x2, &amp;i2 0, i 0, &amp;i2 0) i.s"<br>push "NT Authority\System"<br>push ""<br>Call CreateTask<br>Pop $0<br>MessageBox MB_OK "CreateTask result: $0"</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">3rd November 2007 10:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You need to update CreateTask itself, not your code that calls CreateTask.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bulgin</span><br><span class="post-time small text-muted">3rd November 2007 16:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes, I replaced SetAccountInformation r8 with n higher up in the script. My question is: is that replacement higher up in the script, plus the changes I made in the code that calls CreateTask sufficient? I'm a newbie (I'm sure you can tell that by now) so I'm unclear when you say "you need to update CreateTask itself". I thought I did that.<br><br>Thank you for your expertise and help. Peace.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">3rd November 2007 16:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The section code seems fine at first look. Doesn't it work now with the CreateTask modification?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bulgin</span><br><span class="post-time small text-muted">3rd November 2007 16:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Kickik -- I'm going to have to get back later today. Office computers under trojan attacks and I must go in to repair. But I can say that yesterday when I tried it with the modifications we are speaking of, the Windows Scheduler still showed it as being created by the local user and not "NT Authority\System", but I didn't have the time to troubleshoot then. Will later.<br><br>Talk later.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>