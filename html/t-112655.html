<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="New plugin - Priviliges"><title>New plugin - Priviliges - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">New plugin - Priviliges</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=112655">New plugin - Priviliges</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">rpetges</span><br><span class="post-time small text-muted">3rd November 2002 18:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>New plugin - Priviliges</strong><br>I wrote a plugin for NSIS that allows you to retrieve the current account type for the logged user.<br><br>It checks for the following rights: Administrator, Users, Guests and Power users.<br><br>I needed it for myself and think it may be usable for others as well :D<br><br>The package includes the DLL, a sample script and the Delphi source code.<br><br>The latest versions can be downloaded from the Download section on my homepage at <a href="http://www.petges.com" target="_blank">www.petges.com</a><br><br>Romain</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">3rd November 2002 21:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sounds great! I'll have a look at it later this week.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">4th November 2002 15:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Correct if I am wrong but if the user is in both Power Users and the Users group wouldn't your DLL decide that he is in the Users group? It breaks the loop before it make sure... You have also freed only the last SID created.<br><br>I have created another extension DLL named UserInfo, inspired by your DLL that doesn't have those bugs. It is written in C, so it's smaller. I have also added a function to get the user name.<br><br>I have added this DLL to the latest CVS version, because people ask about it all the time.<br><br>Thank you for your idea. If you wish I can add a readme saying the original idea was yours.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rpetges</span><br><span class="post-time small text-muted">4th November 2002 17:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i><br><b>Correct if I am wrong but if the user is in both Power Users and the Users group wouldn't your DLL decide that he is in the Users group? It breaks the loop before it make sure... You have also freed only the last SID created.</b><br><br>Sorry for the SID resource release bug ... :(<br><br>I'm aware of the problem when a user is member of several groups and I want to change this using the following solution:<br><br>Instead of returning a string with a single group I look forward to build a string with all groups, separated by comma:<br><br>Example: User, Power.<br><br>But how can I check for a substring in NSIS ? For example, it would be great to have a call like StrCmp str1 str2 [jump_if_found] [jump_if_not_found] .... where $0 = User, Power and it jumps to [jump_if_found] if the substring str1 is found in str2.<br><br><b><br>I have created another extension DLL named UserInfo, inspired by your DLL that doesn't have those bugs. It is written in C, so it's smaller. I have also added a function to get the user name.<br><br>I have added this DLL to the latest CVS version, because people ask about it all the time.</b><br><br>Great ! :up:<br><br><b>Thank you for your idea. If you wish I can add a readme saying the original idea was yours.</b><br><br>Not really necessary, but why not ? :)<br></blockquote></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">4th November 2002 18:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, what I did with UserInfo, is return only the highest type of the user. If the user belongs to the Users and Administrators groups it will return only Admin, same goes for Power Users. AFAIK any user that is not guest belongs to Users anyway so it will be useless to return them all together.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rpetges</span><br><span class="post-time small text-muted">4th November 2002 18:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">OK, I agree !<br><br>Thanks for the rewrote of the plugin in C... it's indeed smaller.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rpetges</span><br><span class="post-time small text-muted">6th November 2002 19:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Kickik,<br><br>could you please add the UserInfo plugin to the CVS snapshot ZIP's ?<br><br>Many thanks !</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">6th November 2002 19:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The snapshot automatically updates at least once a day.<br>The current snapshot already has the plugin.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rpetges</span><br><span class="post-time small text-muted">6th November 2002 21:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, Yes and No ;)<br><br>In fact, I compile the extracted ZIP file into an installer (using !InstallNSIS.bat) and this one doesn't install the UserInfo plugin DLL and source... I think you forgot to update the makensis.nsi file.<br><br>I didn't even check the ZIP archive for the plugin, but it's indeed included.<br><br>Romain</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">hermanator</span><br><span class="post-time small text-muted">2nd May 2003 01:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It seems this plugin never returns Guests. Windows help says that all Guests users are also members of the Users group, which according to the above explanation may be why Users is returned for Guests users. If this is the case why doesn't the Guest User's properities list Users as one of the groups it is a member of?<br><br>To get to my point :).. I need to know if a user is a member of Guests, since any HKCU reg settings are not kept from one session to the next.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">2nd May 2003 11:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Do you reckon it's safe to assume that a user that exists in the Guests group is always a guest or should I compare to DOMAIN_USER_RID_GUEST too?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">hermanator</span><br><span class="post-time small text-muted">2nd May 2003 15:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">MSDN states the following:<br><br>DOMAIN_GROUP_RID_USERS: A group containing all user accounts in a domain. All users are automatically added to this group.<br><br>Probably it would make sense only to to return the "Users" group if this is the only group a user is a member of. For all other cases the logic you have stated above would make sense.. So in the case of a user being member of Guests (and Users by default), "Guests" should be returned.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">2nd May 2003 16:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">What I am asking is if a normal user can be in the guests group too. I don't see anything saying that this is impossible. And does a user have to be DOMAIN_USER_RID_GUEST to be a guest or being in the guests group is enough?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">hermanator</span><br><span class="post-time small text-muted">2nd May 2003 17:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">From what I understand..<br><br>ALL users are members of the Users group by default (including Guests members). So when you say "normal user", I assume you mean a member of the Users group, but not a member of the Guests group. So what I was trying to say above.. A user is only a "normal user" if he is only in the "Users" group and no other. The Guest account is a member of the Guests group (and by default Users).<br><br>So I would say a Guest is anyone in the Guests group (and by default Users group), who is not also a member of a group with better than Guests privillages (i.e. only Groups and Users).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">2nd May 2003 17:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">By a normal user I mean a user who is not the guest user and according to a little test I have just made a normal user can be in the guests group and not be a guest. Accoring to you:<br><br></p><blockquote>I need to know if a user is a member of Guests, since any HKCU reg settings are not kept from one session to the next.</blockquote>The user that belonged to the Guests group did keep HKCU changes from one session to the next.<br><br>I'll check for DOMAIN_USER_RID_GUEST, not the group.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">hermanator</span><br><span class="post-time small text-muted">2nd May 2003 17:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This is my experience on Win2k Pro:<br><br>Create User<br>-----------<br>From Admin account:<br>- Control Panel -&gt; Users and Passwords -&gt; Users Tab -&gt; Add<br>- User Name: User2<br>- Full Name:<br>- Description<br>Next<br>- Password:<br>- Confirm Password:<br>Next (Access level)<br>- Other -&gt; Guests<br>Finish<br><br>Check that User2 is only member of Guests group<br>-----------------------------------------------<br>- Control Panel -&gt; Users and Passwords -&gt; Advanced Tab -&gt; Advanced Button<br>- Click Users in left column<br>- Click "User2" in right column<br>- In User2 Properties window click "Member of" tab<br><br>"Guests" should be the only group in the list.<br><br>Login as User2<br>--------------<br>Use regedit to create "MyTestKey" under HKCU\SOFTWARE<br><br>Logout<br>------<br><br>Log back in as User2<br>--------------------<br>HKCU/SOFTWARE/MyTestKey is gone.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">hermanator</span><br><span class="post-time small text-muted">2nd May 2003 18:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i><br><b>By a normal user I mean a user who is not the guest user and according to a little test I have just made a normal user can be in the guests group and not be a guest.</b></blockquote>So what would be the point of having a Guests group (or any group for that matter), if members of this group are only ever recognized as just Users?</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">2nd May 2003 19:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I am talking about an existing user that has been created as one, that is added to the guests gruop. According to my tests he is not really a guest and so checking the group will not work. Don't ask me why it works this way, I didn't create Windows ;)<br><br>I am currently testing and trying to figure out how to really check if the user is the guest user.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">hermanator</span><br><span class="post-time small text-muted">2nd May 2003 19:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i><br><b>I am talking about an existing user that has been created as one, that is added to the guests gruop. According to my tests he is not really a guest and so checking the group will not work. Don't ask me why it works this way, I didn't create Windows ;)<br><br>I am currently testing and trying to figure out how to really check if the user is the guest user.</b></blockquote>A User that was created as part of the "Users" group and then later added to the "Guests" group is equivalent to a user that was created as part of the "Guests" group from the beginning.. so we are talking about the same thing.<br><br>Perhaps Guests groups have different restrictions on different versions of windows (NT 4.0 may not have the HKCU restriction), but I think you are looking at this wrong. All users start off with the base permissions set by the "Users" group, any assignment of a member to another group is either adding permissions, or adding restrictions (as is the case for the Guests group).</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">2nd May 2003 20:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes, you are right. There are different restrictions on XP. My guest user can write to HKCU and it stays there. So, how can I make sure that a user that's in the guests group is really a guest? I am still a bit sceptic about this because Microsoft documentation says:<br><br></p><blockquote>DOMAIN_USER_RID_GUEST - <b>The</b> guest-user account in a domain. Users who do not have an account can automatically log on to this account.</blockquote>Looking at this line one can understand there is only one guest user.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">hermanator</span><br><span class="post-time small text-muted">2nd May 2003 20:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Probably for a member of Guests you need to check the windows version to determine whether to return "Guest" or "User", since apparantly on some platforms there is not difference between Guests and Users..<br><br>Again, I think you should not be concirned with DOMAIN_USER_RID_GUEST, because this user's permissions are determined by the Guests group. As far as I can tell, the only thing that makes this account unique from other Guests accounts is that it ships with Windows.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">2nd May 2003 20:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, I am going to have to trust you on this one because I can't find much on Microsoft documentation and some message boxes that I seemed to have nothing to do with my test user being guest disappeared when I removed him from the guest account.<br><br>New version of UserInfo.dll uploaded. Thank you for your help.<br><br></p><blockquote>Probably for a member of Guests you need to check the windows version to determine whether to return "Guest" or "User", since apparantly on some platforms there is not difference between Guests and Users..</blockquote>Well, a guest is a guest and some weird message boxes disappeared for me so they must have had something with guest user restrictions.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">hermanator</span><br><span class="post-time small text-muted">2nd May 2003 22:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok.. I found something at MSDN about this:<br><br>Changes to the way Guest profiles are handled<br><br>Windows 2000 and Windows NT 4.0 always delete the user profile of users belonging to the local Guests security group when users log off. Windows XP and Windows Server 2003, continue to delete the profile of guest users, only when the computer is joined to a domain. When the computer is part of a workgroup, the user profile of users belonging to the local Guests group is not deleted at logoff.<br><br>The exception is when the user is a member of the local Guests group AND a member of local Administrators, in this case the profile is NOT deleted when in a domain.<br><br>Here is the link:<br><br><a href="http://www.microsoft.com/technet/treeview/default.asp?url=/technet/prodtechnol/windowsserver2003/maintain/operate/User01.asp" target="_blank">http://www.microsoft.com/technet/tre...ate/User01.asp</a></p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>