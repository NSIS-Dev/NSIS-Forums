<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Service Control Library shows &quot;Skipped: System.dll&quot; in details... how to prevent?" />

  <title>Service Control Library shows "Skipped: System.dll" in details... how to prevent? - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Service Control Library shows "Skipped: System.dll" in details... how to prevent?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=171415">Service Control Library shows "Skipped: System.dll" in details... how to prevent?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Ythan</span><br />
      <span class="post-time small text-muted">28th February 2004 20:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Service Control Library shows "Skipped: System.dll" in details... how to prevent?</strong><br />
      Hi everyone -<br />
      <br />
      This forum has been a great resource for me as I learn the NSIS and I think it's terrific how everyone is so generous with their assistance. Hopefully somebody will be willing to spend a few minutes reading my question and helping this newbie out. :)<br />
      <br />
      In my installer, I use dselkirk's <a href="http://forums.winamp.com/attachment.php?postid=1107661" target="_blank">Service Control Library v1.2</a>. It really works great and does just what I need it to do, but I have a question about its operation.<br />
      <br />
      I've noticed that the service lib causes the system plugin to DetailPrint a lot of messages like this in my install log:<br />
      <br />
      <b>Skipped: D:\Temp\nsk920.tmp\System.dll</b><br />
      <br />
      I don't like these messages and want to get rid of them, so I tried to track down their source. It turns out that they're generated when I use the service lib to reference a nonexistent service. For instance, the following code calls the SERVICE macro to check if the service "myservice" is installed and delete it if it is.<br />
      <br />
      !insertmacro SERVICE "installed" "myservice" "action=delete;"<br />
      <br />
      The code works great so long as "myservice" exists. However, if there's no service with that name, it prints one of those "Skipped" messages.<br />
      <br />
      I don't know much about how the system plugin works, but I <i>believe</i> the messages may be caused by the way the service lib checks if a service exists. Basically, it tries to open a handle to the service using the system plugin and assumes the service doesn't exist if it's unsuccessful. This works fine, except the system plugin basically sees:<br />
      <br />
      "Open handle to service control manager"<br />
      "Open handle to service 'myservice'" <i>; Returns an error</i><br />
      "Close handle to service control manager"<br />
      <br />
      I <i>assume</i> the "Skipped" messages are generated because there are no ControlService instructions being passed to the DLL, just OpenSCManagerA, OpenServiceA and CloseServiceHandle. It seems logical to me that the system plugin might realize it's just opening and closing a couple handles, and return the message so the user knows it's skipping that step.<br />
      <br />
      Ultimately, however, my knowledge of Windows programming is severely limited and these are just educated guesses about what's going on behind the scenes. All I know for a fact is that the messages are generated when I call the SERVICE macro with a nonexistent service name, regardless of the action or parameters specified.<br />
      <br />
      It's my hope that someone can offer advice as to how I can prevent/suppress/remove these messages from the install details window. Even if it's not possible without modifying and recompiling the system plugin, I'd still like to know so I can relax :). I'd be really grateful for any assistance. Thanks a lot!<br />
      <br />
      -Y</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Ythan</span><br />
      <span class="post-time small text-muted">2nd March 2004 16:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry to bump my thread - this is the only time I'll do it - but I'd really love to get an answer to my question. Anyone...?<br />
      <br />
      Thanks,<br />
      <br />
      -Y</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">heXor</span><br />
      <span class="post-time small text-muted">4th March 2004 20:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi,<br />
      <br />
      About your problem...I can understand that it's a “little bit” annoying to get all the text in the log window. I don’t know how to suppress it.<br />
      <br />
      But I have an idea on how to bypass this problem. Maybe you should use a plugin, i.e. a dll that does the same as the NSI script does. The plugin name I’m talking about is the nsSCM.dll - see the link below.<br />
      <br />
      <a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=385" target="_blank">nsSCM</a><br />
      <br />
      I use this plugin myself in an installation and I didn’t experienced any problems in using it. You get the source code for it too, so if you need to change it you’re able to do that.<br />
      As mentioned above, the plugin have the same functionality as your nsi script. The difference is that you can control the output in another way – less annoying than the other one.<br />
      <br />
      I hope this helps<br />
      Regards<br />
      /Paul</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">4th March 2004 20:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You should be able to prevent these messages from being displayed using the SetDetailsPrint setting.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">heXor</span><br />
      <span class="post-time small text-muted">4th March 2004 21:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ofcourse <b>SetDetailsPrint</b> can be used in this case to avoid the log messages from being shown in the log window.<br />
      <br />
      But in this case, this is not what we really want to do - we only want to suppress the log messages from being shown when the service is not installed or when there are problems installing it. In all other cases we want to see the messages, or don't we? This is what I understod - anyway.<br />
      <br />
      But ok, maybe you should do as Joost suggests - do not show the messages in the log window while trying to install the service.<br />
      <br />
      You can look in the NSIS help file, see section <b>4.9.14.13 SetDetailsPrint</b>. You can use this built in function to disable and then to enable back the log messages.<br />
      <br />
      /Paul</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th March 2004 11:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That message is not coming from the Service Library itself nor does it come from the System plug-in. It looks like NSIS tries to extract System.dll but fails because it's already there. It should never show that because right before the internal File command there an internal SetDetailsPrint command to supress that message. It is even weirder that it shows just in certain cases.<br />
      <br />
      Please provide some more information such as an example script, the exact version of NSIS you are using and anything else that might help.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Ythan</span><br />
      <span class="post-time small text-muted">5th March 2004 18:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks everybody for your assistance! I'm currently working around the problem by using SetDetailsPrint and it works okay.<br />
      <br />
      kichik - I am running the release version of NSIS 2.0. The attached script reproduces the problem on my machine. Please remember it also requires the <a href="http://forums.winamp.com/attachment.php?postid=1107661" target="_blank">Service Control Library v1.2</a>.<br />
      <br />
      Thanks again to everyone offering advice. I hope this example script helps shed some light on the nature of the problem.<br />
      <br />
      Best regards,<br />
      <br />
      -Y</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JoeAcunzo</span><br />
      <span class="post-time small text-muted">29th March 2004 23:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I too am getting this error in the details window of "Skipped ...\system.dll" when using ServiceLib.nsi when calling to get the "status" on a service that I know exists, but is not running. I put some debugging code in and discovered that the second call into the System plugin, calling OpenServiceA, is returning a zero value (failure). Calling GetLastError, I get back a value of 80, which is "The file exists."??? I tried using /NOUNLOAD on all calls, but that didn't make a difference.<br />
      <br />
      Anyone have a solution to this problem?<br />
      <br />
      Joe A.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pengyou</span><br />
      <span class="post-time small text-muted">30th March 2004 00:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">In the ServiceControlLibrary (servicelib.nsh) try changing the two IntCmp instructions after the "lbl_done" label from relative jumps to ones which use a label:<br /></p>
      <pre>
<code><br />lbl_done:<br />     IntCmp $5 0 <font color="red"><b>lbl_done_a</b></font><br />     System::Call 'advapi32::CloseServiceHandle(i r5) n'<br /><font color="red"><b>lbl_done_a:</b></font><br />     IntCmp $4 0 <font color="red"><b>lbl_done_b</b></font><br />     System::Call 'advapi32::CloseServiceHandle(i r4) n'<br /><font color="red"><b>lbl_done_b:</b></font><br /></code>
</pre><br />
      <br />
      From Section 4.4 (Relative Jumps) in the NSIS manual:<br />
      "Note: relative jumps don't work with ... plug-ins (Plugin::Function)... Do not try to jump over them using relative jumps, you will not get the result you were expecting."
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JoeAcunzo</span><br />
      <span class="post-time small text-muted">30th March 2004 00:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I tried your suggested change and have the same error. The problem is occuring well before the CloseServiceHandle() calls you suggested changing. The error is near the top of the function. The code from ServiceLib.nsi reads as follows:<br />
      <br />
      [code]<br />
      StrCpy $0 "false"<br />
      System::Call 'advapi32::OpenSCManagerA(n, n, i ${SC_MANAGER_ALL_ACCESS}) i.r4'<br />
      IntCmp $4 0 lbl_done<br />
      StrCmp $3 "create" lbl_create<br />
      System::Call 'advapi32::OpenServiceA(i r4, t r2, i ${SERVICE_ALL_ACCESS}) i.r5'<br />
      IntCmp $5 0 lbl_done<br />
      [code]<br />
      <br />
      The call to OpenServiceA fails, returning a zero value in $5. I put a MessageBox in and the values being passed to it seem okay. I'm not sure the message in the details window (about "Skipping ...\system.dll") is significant or not.<br />
      <br />
      Any other suggestions?<br />
      <br />
      Joe A.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JoeAcunzo</span><br />
      <span class="post-time small text-muted">30th March 2004 01:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I found my problem, actually two problems.<br />
      <br />
      First, I was using the "Display Name" of the service, not the "Service Name" as I should have done (and they are different in the case of this service).<br />
      <br />
      Second, I moved the location of my Section down in the script and, for some unexplained reason, the detail window message "Skipping ...\system.dll" has now disappeared.<br />
      <br />
      Thanks to all who replied.<br />
      <br />
      Joe A.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
