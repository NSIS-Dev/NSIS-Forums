<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Setup doesn't work properly"><title>Setup doesn't work properly - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Setup doesn't work properly</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=222146">Setup doesn't work properly</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">aps</span><br><span class="post-time small text-muted">22nd July 2005 08:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Setup doesn't work properly</strong><br>I create the following simple script, that (in silent mode, as you can see) update some file while they are working, so that they would be ready to use on the next reboot.<br>I have compiled the script, so that I obtained the setup correctly.<br>I tried to launch the setup on my PC (with Win XP pro) and it works fine (create the installation directory with the file as listed). It also makes the Install.log, which I previously set to ON, boot on the code (NSIS_CONFIG_LOG) and on the script.<br>I have 50 machine with XPembedded Operating System (they have all the same image inside, so they are identical), on which I have my application to be upgraded with this setup,<br>and I noticed a strange behaviour: in fact ONLY ON SOME OF THEM, if I double click on the setup icon, it does not do nothing! Also the Install.log is not created!<br>If I rename the directory containing the file to be updated, and launch the setup, it will create the new dir with the new files inside (and the install.log too), but if I relaunch the same setup, it doesn't work any more, and it doesn't create (update) the install.log file too!<br><br>Has someone any ideas or suggestion for this strange case?<br>Thanks in advance!<br>Aps<br><br><br>!define PRODUCT_NAME "MySetup"<br>!define PRODUCT_VERSION "1.0"<br>!define PRODUCT_PUBLISHER "bla"<br>!define PRODUCT_WEB_SITE "http://www.bla.com"<br>!define PRODUCT_DIR_REGKEY "Software\Microsoft\Windows\CurrentVersion\App Paths\MyProj.exe"<br><br>SetCompressor lzma<br><br>Name "${PRODUCT_NAME} ${PRODUCT_VERSION}"<br>OutFile "MySetup.exe"<br>InstallDir "C:\Dir1\Dir2\MySetup"<br>Icon "${NSISDIR}\Contrib\Graphics\Icons\modern-install.ico"<br>SilentInstall silent<br>InstallDirRegKey HKLM "${PRODUCT_DIR_REGKEY}" ""<br><br>Section "MyProj" SEC01<br>Logset on<br>SetOutPath "C:\Dir1\Dir2"<br>Rename $INSTDIR\MyProj.exe $INSTDIR\MyProj_old.exe<br>Delete /REBOOTOK $INSTDIR\MyProj_old.exe<br>Rename $INSTDIR\Pippo.dll $INSTDIR\Pippo_old.dll<br>Delete /REBOOTOK $INSTDIR\Pippo_old.dll<br>SetOverwrite ifdiff<br>File "..\MyProj.exe"<br>File "..\Pippo.dll"<br>File "..\Pluto.dll"<br>SectionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">22nd July 2005 18:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Maybe something writes to the registry value in ${PRODUCT_DIR_REGKEY} and changes the installation directory. Try running it with <a href="http://www.sysinternals.com/Utilities/Filemon.html" target="_blank">Filemon</a> to see which files it's working with.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">aps</span><br><span class="post-time small text-muted">25th July 2005 10:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks a lot for the suggestion! Now I'm going to use FileMon...<br><br>If I use the wizard to make the setup, it introduces the following lines in the script created:<br><br>Section -Post<br>WriteRegStr HKLM "${PRODUCT_DIR_REGKEY}" "" "C:\dir1\dir2\MyProj.exe"<br>SectionEnd<br><br>What does it mean?<br>I didn't use it in my previous script...is it necessary?<br><br>Thanks for the help!<br>Aps</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">26th July 2005 21:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It writes the installation directory into the registry so InstallDirRegKey will use it the next time the user runs the installer. However, it should write $INSTDIR and not an hard-coded path.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>