<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Could not find symbol... (Creating a .DLL Plug-In)"><title>Could not find symbol... (Creating a .DLL Plug-In) - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Could not find symbol... (Creating a .DLL Plug-In)</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=137997">Could not find symbol... (Creating a .DLL Plug-In)</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">DITMan</span><br><span class="post-time small text-muted">5th June 2003 20:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Could not find symbol... (Creating a .DLL Plug-In)</strong><br>Hi, reading some posts in the forum, and with the answers I got in the other thread I started, I'm still wondering how to close MSN Messenger... well, I've found this piece of code, and I'm TRYING to turn it into a NSIS .DLL Plug-In, but whenever I try to load it, I get this messages:<br><br>Output folder: C:\DOCUME~1\DITMan\CONFIG~1\Temp<br>Extract: C:\DOCUME~1\DITMan\CONFIG~1\Temp\nst624.tmp<br>Could not find symbol: KillProc<br>Completed<br><br>I'll attach the source code for the .DLL, and my .NSI (I know, everything is UGLY, but it should work)<br><br>BTW, I think I'm exporting the KillProc function right, but I have NO idea in windows programming, so every feedback will be VERY VERY appreciated, and I think this plug-in is quite useful for NSIS :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">5th June 2003 20:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The problem is that your DLL is written in C++ but the export must be C style. Take a look at the InstallOptions code (written in C++ too) and you'll see that every exported function declaration starts with extern "C".<br><br>Looking at your DLLs code I see that it tries to terminate the messenger process. This is not a good idea. Terminating a process must be the last resort and only when the process is frozen or misbehaving. It would be better to only find out if the process is running and cancel the installation.<br><br>It's also not a good idea to kill a process by name because you can't be sure the user haven't changed the name of the EXE file or maybe even ran another process with the same name that has nothing to do with your installation.<br><br>BTW, If you're using NSIS 2 it would be simpler to put your compiled DLL in the plugins directory and call it using DLLName::Function</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">5th June 2003 20:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Oh, and WM_DESTROY means nothing in the script, it's just a text. When converting to a number NSIS will think it's 0. You shuold use ${WM_DESTROY}, it's a define. You should also include WinMessages.nsh that defines this, or else, again, it will be treated as 0.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">DITMan</span><br><span class="post-time small text-muted">6th June 2003 16:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks... i need to terminate the process because many people I distributed the .DLL as a separate installer didn't know how to fully close MSN Messenger, and my previous install method (a simple .ZIP Self Extractor) didn't do its job. I send the raw DLL to those people who know what are they doing (and who can rename programs, etc...) but for my John Users ;P I need to kill the process :)<br><br>Thanks a lot, I'll have a look at that code :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">DITMan</span><br><span class="post-time small text-muted">6th June 2003 16:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">OMG! I just had to add <b>extern "C"</b> to the function I was exporting... I thought it would be more difficult :P<br><br>Now I'll investigate how to get a string out from the stack :P<br><br>popstring(string_where_i_want_to_keep_the_parameter) will do ???:P</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">DITMan</span><br><span class="post-time small text-muted">6th June 2003 17:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Okey... I think my DLL works but when scripting, if I use the 'summarized' form for calling the function in the DLL, I get a compilation error :(<br><br></p><blockquote>Invalid command: KillProcDLL::KillProc<br>Error in script "C:\Archivos de programa\NSIS\Examples\kaka.nsi" on line 23 -- aborting creation process</blockquote>I've also tried using KillProcDLL.dll::KillProc :(<br><br>I'm using NSIS 2.0b3 (I think so :P)</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">DITMan</span><br><span class="post-time small text-muted">6th June 2003 17:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Okaaaay solved too... :P I should try more things before posting... My dll works now like a charm and does what it is expected to do :D<br><br>How would you all DLL programmers return values from the DLL? with pushstring or storing it in another variable?? It's to keep the current DLL Plug-In style :) thanks.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">6th June 2003 18:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">When you're dll is done, make sure to put it on the archive!!!<br>A nice thing to add would be a...<br><br>KillProcDLL::KillProc "App Name"<br><br>Where App Name could be some common Windows programs, which you would list in the readme.<br><br><br>Good work!<br><br>-Stu :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">DITMan</span><br><span class="post-time small text-muted">6th June 2003 19:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Okay, that's easy... but it's quite easy by now... you can erase any process by its name, like msnmsgr.exe or notepad.exe...<br><br>It's almost done, it returns the error code in $R0, so push it before calling this function...<br><br>It needs some more testing, but it's close to 'final release' :P, i've got tu put up the documentation and give credits to the real author (and remove the pre-generated comments by VC++ :P)<br><br>C ya!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">7th June 2003 11:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'd choose reboot over termination every time possible. As stated in the MSDN documentation for TerminateProcess:<br><br></p><blockquote>The TerminateProcess function is used to unconditionally cause a process to exit. Use it only in <b>extreme circumstances</b>. The state of global data maintained by dynamic-link libraries (DLLs) may be <b>compromised</b> if TerminateProcess is used rather than ExitProcess.</blockquote></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">8th June 2003 18:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by DITMan</i><br><b>How would you all DLL programmers return values from the DLL? with pushstring or storing it in another variable?? It's to keep the current DLL Plug-In style :) thanks.</b></blockquote>The convention is to push the return value on the stack.</div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>