<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="remote installer - using signed/encrypted packages" />

  <title>remote installer - using signed/encrypted packages - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">remote installer - using signed/encrypted packages</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=308388">remote installer - using signed/encrypted packages</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">romca</span><br />
      <span class="post-time small text-muted">15th July 2009 22:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>remote installer - using signed/encrypted packages</strong><br />
      Hi,<br />
      someone might find this useful - it is a automatic, remote installer. It downloads packages from some locations, verifies and install them. If you have comments on how to improve it, make it suck less, please share them. Thanx!<br />
      <br />
      roman<br />
      <br />
      <br />
      here from readme:<br />
      <br />
      Remote installer components:<br />
      ----------------------------<br />
      <br />
      installer: installs the two components in their place<br />
      checker: run in the background, periodically starts updater as a background process<br />
      updater: when started, checks urls as given in the updater.ini file<br />
      <br />
      What it does:<br />
      1. updater has a configuration file installer.ini which lives in the same directory<br />
      - it holds section "Download locations"<br />
      - there up to 50 url links (http, ftp (not tested) and file:///)<br />
      - file:/// can be relative or absolute path<br />
      - e.g. file:///components.txt.asc<br />
      <br />
      2. updater consults installer.ini<br />
      - downloads the "manifest" from the first valid url into a temporary location<br />
      - it should be signed with a private key of a TRUSTED_SIGNATORY (see source)<br />
      - the downloaded file is verified, if the signature is not recognized, downloader tries next url(s)<br />
      - if no valid manifest is downloaded, program aborts<br />
      <br />
      3. the downloaded manifest contains "changesets" in the ini structure<br />
      - name of the section is the name of the feature<br />
      - eg. [001 - Silent changes]<br />
      - it is a good idea to put numbers, sections are sorted alphabetically<br />
      - each section should contain: url, md5, args, onfailure keys<br />
      - url: where to download the new/changed feature<br />
      - md5: checksum of the downloaded file<br />
      - args: instructions how to execute the downloaded file, in case of 7z, it is a directory where it will be unpacked<br />
      - onfailure: continue|stop|retry<br />
      4. updater first sorts sections alphabetically and starts from the first<br />
      - if already installed (it will be skipped)<br />
      - records of the installed features are kept in a separate ini: updated.ini<br />
      - if not installed:<br />
      - url is downloaded into temporary location<br />
      - downloaded file is checked against the md5 checksum<br />
      - if the file has .gpg suffix, it is decrypted<br />
      - e.g. "program.exe.gpg" will become "program.exe"<br />
      - decryption uses gpg and a private key of the program<br />
      - package should be encrypted for ID of the installer<br />
      - installer also checks if the file was encrypted by TRUSTED_SIGNATORY<br />
      - "args" are expanded (ie. args=%(DOWNLOADED_FILE)s /S becomes "some_path\ns6984.exe /S")<br />
      - file is in a temporary location is executed (based on the suffix)<br />
      - exe files: run using ExecTimeout<br />
      - 7z files: output dir is set to the path in "args" and run Extract<br />
      - more actions could be added later<br />
      - if everything goes fine, package name is added into the updated.ini<br />
      - ID = date (eg. 001 - Silent changes=07.07.2009 22:41:28)<br />
      - if anything went wrong:<br />
      - package installation is ended<br />
      - no records is written in the updated.ini<br />
      - based on the onfailure value, installation stops or continuew with a next package<br />
      - it is up to you to solve the failure states<br />
      <br />
      <br />
      How to make a distribution:<br />
      ---------------------------<br />
      <br />
      1. prepare a manifest:<br />
      - e.g. .\tests\components.0.01.txt<br />
      2. sign the manifest with gpg<br />
      - e.g. .\gpg\gpg.exe --homedir .\gpg_local_side --clearsign .\tests\components.0.01.txt<br />
      3. check the updater.ini file<br />
      - it must contain valid future URL locations of the manifest<br />
      4. check the installer.ini file<br />
      - it must have a valid args in the section [Checker]<br />
      - this tells installer what to put in the Run section of the registry<br />
      - and also how to start checker after the installation<br />
      5. compile the scripts, in this order:<br />
      a) checker.nsi --&gt; semanchk.exe<br />
      b) updater.nsi --&gt; updater.win32.0.01.exe<br />
      c) installer.nsi --&gt; installer.win32.0.01.exe<br />
      <br />
      <br />
      To encrypt a file:<br />
      ------------------<br />
      - you have to encrypt and sign it<br />
      - the SIGNATORY must be known to the updater<br />
      - see updater.nsi, search for TRUSTED_SIGNATORY<br />
      - the file must be addressed to the updater<br />
      - you must have the public key of the recipient in the keyring<br />
      <br />
      example:<br />
      .\gpg\gpg.exe --homedir .\gpg_local_side -r "John the Recipient" -se .\tests\program.exe</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">romca</span><br />
      <span class="post-time small text-muted">15th July 2009 22:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">yeaahh, i forgot... big thanks to you nsis developers! nsis is great</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">romca</span><br />
      <span class="post-time small text-muted">16th July 2009 22:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">probably tired, i didnt attach the files. sorry</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">18th July 2009 14:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for your contribution. You should create a page for it on the Wiki so it lives forever.<br />
      <br />
      <a href="http://nsis.sourceforge.net/Starting_a_new_page" target="_blank">http://nsis.sourceforge.net/Starting_a_new_page</a><br />
      <a href="http://nsis.sourceforge.net/Uploading_files" target="_blank">http://nsis.sourceforge.net/Uploading_files</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">romca</span><br />
      <span class="post-time small text-muted">22nd July 2009 19:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi, added here: <a href="http://nsis.sourceforge.net/Remote_Secure_Installer" target="_blank">http://nsis.sourceforge.net/Remote_Secure_Installer</a><br />
      <br />
      (nsis at sourceforge dot net /Remote_Secure_Installer)<br />
      <br />
      I dont have an account for the wiki (and reluctant to create another one), but I hope somebody with editors' rights can put the page into the category "Real world examples"<br />
      Best,</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">logue</span><br />
      <span class="post-time small text-muted">29th July 2009 03:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It is a tool which seems to be mutch useful. However, it is rather unclear.<br />
      Isn't there any example which can be compiled immediately?</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
