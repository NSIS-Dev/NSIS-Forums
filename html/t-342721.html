<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Installer that use the regsvr32.exe to register a dll" />

  <title>Installer that use the regsvr32.exe to register a dll - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Installer that use the regsvr32.exe to register a dll</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=342721">Installer that use the regsvr32.exe to register a dll</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">noemig</span><br />
      <span class="post-time small text-muted">29th February 2012 04:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Installer that use the regsvr32.exe to register a dll</strong><br />
      Hello,<br />
      <br />
      I am creating an nsi file to install some dlls but I need also to register them using regsvr32.exe<br />
      <br />
      How can I do this?<br />
      <br />
      Thanks<br />
      <br />
      noemig</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">29th February 2012 07:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try doing a google search for 'nsis regsvr32.exe' . If you had tried, you would've found your answer in a matter of seconds.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">29th February 2012 10:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Or just use RegDll.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">noemig</span><br />
      <span class="post-time small text-muted">29th February 2012 13:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>thanks</strong><br />
      Thank you Stu,<br />
      <br />
      I have found the answer already.<br />
      <br />
      Have a nice day.<br />
      <br />
      noemig</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">anderci</span><br />
      <span class="post-time small text-muted">26th January 2013 19:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have created several VB6 Applications that I make available on my website as 'FreeWare'.<br />
      I recently started using NSIS to create install packages. I copy all of the support files into the $INSTDIR , that, for WinVistaAndBeyond, has its own subfolder in the folder structure: C:Users\Public\... This is to reduce the chance that my applications would have minimal effect on and be minimally effected by other applications on the PC.<br />
      <br />
      For each application I have been using RegDLL "$INSTDIR\RICHTX32.OCX" to register each .OCX file used by that application. This seems to work fine when I have installed several of my applications, each in their own $INSTDIR.<br />
      <br />
      The problem arises when I uninstall any of the applications using UnRegDLL "$INSTDIR\RICHTX32.OCX" . This causes all of the applications to have their own copies of the .OCX files to be UnRegistered.<br />
      <br />
      I have not noticed a difference running in a PowerUser Login or 'RunAsAdministrator'.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">27th January 2013 00:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://nsis.sourceforge.net/Docs/AppendixB.html#B.2" target="_blank">http://nsis.sourceforge.net/Docs/AppendixB.html#B.2</a><br />
      allows you to install it shared but then it has to be in a shared location.<br />
      <br />
      Other options:<br />
      A) Use reg free COM (XP+, not sure if it works in VB6)<br />
      B) Fake reg free COM by calling the Co* functions from VB</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">PoRtAbLe_StEaLtH</span><br />
      <span class="post-time small text-muted">27th January 2013 08:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        Or just use RegDll.<br />
        <br />
        Stu
      </blockquote>Just becareful under x64bit.<br />
      <br />
      ie. registering shell / unreg shell with RegDLL would leave behind trash in the registry, and leave libraries loaded.<br />
      <br />
      Using `regsvr32.exe` worked correctly.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">anderci</span><br />
      <span class="post-time small text-muted">4th February 2013 16:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you for your responses.<br />
      <br />
      I have been trying to absorb them. I am definitely using VB6 and so far the only error messages from a fresh install of my freeware applications refer to unregistered .OCX files.<br />
      <br />
      My understanding of the terminology in AppendixB faltered with the mention of Libraries. I do want my 'support files' to be NOTSHARED . That is why I copy (File...) them into each application's $INSTDIR . I am trying to continue with this approach to avoid application entanglements.<br />
      <br />
      I do not know what reg free COM is.<br />
      <br />
      I started with regsvr32.exe and am happy to return to it. On some forum I was warned away from it because some PCs may not support it. I do not see a NOTSHARED option with it. e.g.:<br />
      ExecWait 'regsvr32.exe "$INSTDIR\RICHTX32.OCX" /S'<br />
      <br />
      Thank you for your help.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">4th February 2013 17:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">regsvr32 will normally register the file globally (In HKLM) and a shared install is usually not possible.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">anderci</span><br />
      <span class="post-time small text-muted">4th February 2013 19:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Do you mean "a shared install is usually not possible. " or<br />
      " a <b>NOT</b>shared install is usually not possible. "</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">anderci</span><br />
      <span class="post-time small text-muted">4th February 2013 19:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Is reg free COM also known as 'Visual Studio 6 Installer' ? The website indicates that it, as of 4 July 2012, works with VB6 Pro.<br />
      <br />
      Is it a separate alternative to NSIS ?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">5th February 2013 07:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Reg free COM means you don't register the dll/ocx in the registry at all, you put the information in the .exe manifest</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">anderci</span><br />
      <span class="post-time small text-muted">5th February 2013 14:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you for your response. It is a relief not to have to go into 'Visual Studio 6 Installer'.<br />
      <br />
      I googled .exe manifest Reg free COM vb6 and was somewhat overwhelmed. I may understand some of it. I think the information in the QueryMgr.vbp file e.g.:<br />
      <br />
      Object={831FDD16-0C5C-11D2-A9FC-0000F8754DA1}#2.0#0; MSCOMCTL.OCX<br />
      Object={38911DA0-E448-11D0-84A3-00DD01104159}#1.2#0; RICHTX32.OCX<br />
      <br />
      ExeName32="QueryMgr.exe"<br />
      <br />
      MajorVer=2<br />
      MinorVer=4<br />
      RevisionVer=12<br />
      <br />
      must be copied into a QueryMgr.exe.manifest file in XML format to look like:<br />
      &lt;?xml version="1.0" encoding="utf-8" standalone="yes"?&gt;<br />
      &lt;assembly manifestVersion="1.0" xmlns="urn:schemas-microsoft-com:asm.v1"&gt;<br />
      &lt;assemblyIdentity type="win32" name="QueryMgr.exe" version="2.4.12" /&gt;<br />
      &lt;dependency&gt;<br />
      &lt;dependentAssembly&gt;<br />
      &lt;assemblyIdentity type="win32" name="MSCOMCTL.OCX" version="2.0" /&gt;<br />
      &lt;assemblyIdentity type="win32" name="RICHTX32.OCX" version="1.2" /&gt;<br />
      &lt;/dependentAssembly&gt;<br />
      &lt;/dependency&gt;<br />
      &lt;/assembly&gt;<br />
      <br />
      And this XML file QueryMgr.exe.manifest incorporated in the NSIS installation into the $INSTDIR with the required support files (MSCOMCTL.OCX, ...)<br />
      <br />
      I saw mention of several tools to create the manifest file, but could not track them down with certainty. The most significant maintenance task, once created, would be the executable application version.<br />
      <br />
      Your guidance is appreciated.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">5th February 2013 17:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">"&lt;assemblyIdentity type="win32" name="QueryMgr.exe" version="2.4.12" /&gt;" I bet the version here does not have to match anything...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">anderci</span><br />
      <span class="post-time small text-muted">5th February 2013 19:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">My first try did not work:<br />
      E:\Program FiIes\Clark_Anderson\QueryMgr\QueryMgr.exe<br />
      (X) E:\Program Files\Clark_Anderson\QueryMgr\QueryMgr.exe<br />
      This application has failed to start because the application configuration is incorrect. Reinstalling the application may fix this problem.<br />
      [ OK ]<br />
      Here is the content of my QueryMgr.exe.manifest file:<br />
      &lt;?xml version="1.0" encoding="utf-8" standalone="yes"?&gt;<br />
      &lt;assembly manifestVersion="1.0" xmlns="urn:schemas-microsoft-com:asm.v1"&gt;<br />
      &lt;assemblyIdentity type="win32" name="QueryMgr.exe" version="2.04" /&gt;<br />
      &lt;dependency&gt;<br />
      &lt;dependentAssembly&gt;<br />
      &lt;assemblyIdentity type="win32" name="MSCOMCTL.OCX" version="2.0" /&gt;<br />
      &lt;assemblyIdentity type="win32" name="MSCOMCT2.OCX" version="2.0" /&gt;<br />
      &lt;assemblyIdentity type="win32" name="COMCT332.OCX" version="1.1" /&gt;<br />
      &lt;assemblyIdentity type="win32" name="RICHTX32.OCX" version="1.2" /&gt;<br />
      &lt;assemblyIdentity type="win32" name="COMDLG32.OCX" version="1.2" /&gt;<br />
      &lt;/dependentAssembly&gt;<br />
      &lt;/dependency&gt;<br />
      &lt;/assembly&gt;<br />
      <br />
      I have tried to attach my Query_Manager.nsi file.<br />
      Here is that section:<br />
      Section "System Files - WinSysDir"<br />
      SectionIn 1 2<br />
      SetOutPath "$INSTDIR"<br />
      File "C:\WINDOWS\system32\stdole2.tlb"<br />
      File "D:\Program Files\Microsoft Office\Office\MSACC9.OLB"<br />
      File "C:\Program Files\Common Files\Microsoft Shared\DAO\dao360.dll"<br />
      File "D:\Program Files\Microsoft Office\Office\EXCEL9.OLB"<br />
      File "d:\Program Files\Microsoft Visual Studio\VB98\VB6EXT.OLB"<br />
      File "C:\WINDOWS\system32\msstdfmt.dll"<br />
      File "C:\WINDOWS\system32\MSCOMCTL.OCX"<br />
      File "C:\WINDOWS\system32\MSCOMCT2.OCX"<br />
      File "C:\WINDOWS\system32\RICHTX32.OCX"<br />
      File "C:\WINDOWS\system32\COMDLG32.OCX"<br />
      File "D:\Program Files\InstallShield\InstallShield Express 2.12\redist\MSVCRT40.DLL"<br />
      File "D:\Program Files\InstallShield\InstallShield Express 2.12\redist\COMCAT.DLL"<br />
      File "D:\Program Files\InstallShield\InstallShield Express 2.12\redist\RICHED32.DLL"<br />
      File "D:\Devlpmnt\LANG\VB6\QueryMgr\QueryMgr.exe.manifest"<br />
      <br />
      ; File "C:\WINDOWS\system32\threed32.ocx"<br />
      ; ;Register RICHTX32.OCX<br />
      ; ExecWait 'regsvr32.exe "$INSTDIR\RICHTX32.OCX" /S'<br />
      ; ;Register COMDLG32.OCX<br />
      ; ExecWait 'regsvr32.exe "$INSTDIR\COMDLG32.OCX" /S'<br />
      <br />
      SectionEnd<br />
      <br />
      <br />
      I do not know where I have gone wrong.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">5th February 2013 22:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There is a tool that will give you more information about manifest errors, "sxstrace" or something like that? I'm sure you can find it if you look on the MSDN blogs...<br />
      <br />
      <i>Edit:</i><br />
      <a href="http://blogs.msdn.com/b/junfeng/archive/2006/04/14/576314.aspx" target="_blank">http://blogs.msdn.com/b/junfeng/arch...14/576314.aspx</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">anderci</span><br />
      <span class="post-time small text-muted">6th February 2013 04:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">SxStrace is not on my developement WinXP PC. After reading over the link you provided, I modified the manifest file:<br />
      <br />
      &lt;?xml version="1.0" encoding="utf-8" standalone="yes"?&gt;<br />
      &lt;assembly manifestVersion="1.0" xmlns="urn:schemas-microsoft-com:asm.v1"&gt;<br />
      &lt;assemblyIdentity type="win32" name="QueryMgr.exe" version="2.04" /&gt;<br />
      &lt;dependency&gt;<br />
      &lt;dependentAssembly&gt;<br />
      &lt;assemblyIdentity type="win32" name="MSCOMCTL.OCX" version="6.1.97.82" /&gt;<br />
      &lt;assemblyIdentity type="win32" name="MSCOMCT2.OCX" version="6.1.97.82" /&gt;<br />
      &lt;!-- &lt;assemblyIdentity type="win32" name="COMCT332.OCX" version="1.1" /&gt; --&gt;<br />
      &lt;assemblyIdentity type="win32" name="RICHTX32.OCX" version="6.1.97.82" /&gt;<br />
      &lt;assemblyIdentity type="win32" name="COMDLG32.OCX" version="6.1.97.82" /&gt;<br />
      &lt;assemblyIdentity type="win32" name="stdole2.tlb" version="5.1.2600.5512" /&gt;<br />
      &lt;assemblyIdentity type="win32" name="MSACC9.OLB" version="9.0.0.2719" /&gt;<br />
      &lt;assemblyIdentity type="win32" name="EXCEL9.OLB" version="9.0.0.2719" /&gt;<br />
      &lt;assemblyIdentity type="win32" name="VB6EXT.OLB" version="5.0.81.69" /&gt;<br />
      &lt;assemblyIdentity type="win32" name="Comcat.dll" version="4.71.1441.1" /&gt;<br />
      &lt;assemblyIdentity type="win32" name="dao360.dll" version="3.60.9512.0" /&gt;<br />
      &lt;assemblyIdentity type="win32" name="MSVCRT40.DLL" version="4.10.0.6038" /&gt;<br />
      &lt;assemblyIdentity type="win32" name="Riched32.dll" version="4.0.993.4" /&gt;<br />
      &lt;assemblyIdentity type="win32" name="MSSTDFMT.DLL" version="6.1.97.82" /&gt;<br />
      &lt;/dependentAssembly&gt;<br />
      &lt;/dependency&gt;<br />
      &lt;/assembly&gt;<br />
      <br />
      I listed all of the support files included in the install .nis file. I also used the version numbers displayed by Windows Explorer file properties for each support file.<br />
      <br />
      After installing with the updated manifest on a borrowed WinVista laptop PC, I tried starting the program from its Desktop shortcut. It failed (RICHTX32.OCX not registered).<br />
      <br />
      1) I opened cmd window as Administrator and changed directory to $INSTDIR<br />
      2) I attempted to start sxstrace trace -logfile:sxstrace.etl (it displayed usage information?)<br />
      3) I ran querymgr from this command line: It worked! querymgr started up and ran<br />
      4) I attempted to parse: sxstrace parse -logfile:sxstrace.etl -outfile:sxstrace.txt (it, again, displayed usage information)<br />
      5) I successfully started querymgr from its desktop shortcut: Success!<br />
      <br />
      This behavior is puzzling. The sxstrace program seemed not to be working. Usually when a command line program displays usage information, it is because it failed to start. I could find none of the 'log' files.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">6th February 2013 06:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I think sxstrace works better on Vista+ but this is not really a NSIS issue, maybe you could ask on the MSDN forums or Stackoverflow?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">anderci</span><br />
      <span class="post-time small text-muted">11th February 2013 17:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Reporting back in:<br />
      In the manifest &lt;assemblyIdentity ... version=... /&gt; version accuracy is important!<br />
      Also in the manifest, each dependent file must have the<br />
      &lt;dependency&gt;<br />
      &lt;dependentAssembly&gt;<br />
      &lt;assemblyIdentity ... /&gt;<br />
      &lt;/dependentAssembly&gt;<br />
      &lt;/dependency&gt;<br />
      for each dependent file (.dll, ...) All of the examples I saw involved a single dependency.<br />
      <br />
      More later. I still have not had 100% success with at least one WinVista PC.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">anderci</span><br />
      <span class="post-time small text-muted">17th February 2013 12:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Also, a manifest must be provided for each dependency file listed in the primary manifest.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">anderci</span><br />
      <span class="post-time small text-muted">21st February 2013 15:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">To Wrap Up:<br />
      I finally had success with all 4 Apps in the WinVista PC!<br />
      <br />
      The last program to succeed uses the DTPicker control.<br />
      <br />
      The NSIS script needed to copy both the MSCOMCT2.OCX and MSCAL.OCX from C:\WINDOWS\system32 . I had initially tried copying MSCAL.OCX from D:\Program Files\Microsoft Office\Office: --&gt; That small mistake ~worked by first RunAsAdministrator, then Run as anybody. (The Mysterious Trick I have seen mentioned). Maybe this 'Trick' causes a 'self-registration' of MSCAL.OCX ?<br />
      <br />
      The _.exe.manifest needed MSCAL.OCX as well as MSCOMCT2.OCX...<br />
      <br />
      I also added the MS Windows Calendar... to the components for my Application.<br />
      <br />
      I have not found any clear 'requirement' for MSCAL.OCX. Mysterious?<br />
      <br />
      Thank you for your help!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
