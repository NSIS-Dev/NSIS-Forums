<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Mixed-Mode Installation Issue"><title>Mixed-Mode Installation Issue - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Mixed-Mode Installation Issue</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=289578">Mixed-Mode Installation Issue</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">rooma</span><br><span class="post-time small text-muted">3rd April 2008 17:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Mixed-Mode Installation Issue</strong><br>Hi all,<br><br>I'd want to create an installer that allows mixed-mode installation with the new MultiUser.nsh header but I'm stuck with a problematic scenario:<br><br>(The installer would use HKLM if launched with Admin priviledge, and use HKCU if launched with User priviledge.)<br><br>1. an Admin installs the app to $PROGRAM_FILES\$INSTDIR<br>=&gt; this creates keys in HKLM<br>2. a User installs the same app to the same dir<br>=&gt; this creates keys in HKCU<br><br>Then if either of these two user uninstall the app, it will remove it for the other, and leave keys polluting the reg.<br><br>How could I prevent the second installation to reuse the path used in the 2nd installation ?<br><br>I'm really stuck here, this is a real show stopper for the mixed install mode case...<br><br>Thanks,<br>Rom.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">fabian.rap.more</span><br><span class="post-time small text-muted">8th April 2008 22:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">why dont you check and see if the HKCU keys have been created? if they have then you can remove them</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rooma</span><br><span class="post-time small text-muted">8th April 2008 22:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, yes in case you're an admin you can always check the HKCU.<br><br>However if you're a user you can't check and delete the HKLM, so there's still a problem... unless I'm missing something ;)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">fabian.rap.more</span><br><span class="post-time small text-muted">8th April 2008 22:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">then you will have to run it as an admin............either ask the user to do it manually or use a function. i believe there is a plugin but i may be wrong<br><br>edit:: here is the link<br><br><a href="http://nsis.sourceforge.net/NSIS-RunAs" target="_blank">http://nsis.sourceforge.net/NSIS-RunAs</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rooma</span><br><span class="post-time small text-muted">8th April 2008 22:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Do you mean restrict the installer to be admin only ?<br><br>That's what I currently do, but I was actually trying to have a multi-user enabled installer that would work in both admin and user cases.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">fabian.rap.more</span><br><span class="post-time small text-muted">9th April 2008 00:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">so since the user can't modify anything in HKLM then u r stuck.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Daniel James</span><br><span class="post-time small text-muted">10th April 2008 23:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Re: Mixed-Mode Installation Issue</strong><br></p><blockquote><i>Originally posted by rooma</i><br>(The installer would use HKLM if launched with Admin priviledge, and use HKCU if launched with User priviledge.)<br><br>1. an Admin installs the app to $PROGRAM_FILES\$INSTDIR<br>=&gt; this creates keys in HKLM<br>2. a User installs the same app to the same dir<br>=&gt; this creates keys in HKCU<br><br>Then if either of these two user uninstall the app, it will remove it for the other, and leave keys polluting the reg.<br><br>How could I prevent the second installation to reuse the path used in the 2nd installation ?</blockquote>I would imagine that in most cases the Admin will ensure that the user doesn't have write access to to $PROGRAMFILES so he won't be able to install his copy there. The situation can be avoided by the Admin ensuring that the PC is set up securely.<br><br>OK, it's not a perfect world, though. You can't rely on the Admin user knowing what he's doing. ;)<br><br>Two different users from the Administrators (or Power Users) group can, of course, ALWAYS screw the system up by installing to the same directory. There's not much you can do about that!</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rooma</span><br><span class="post-time small text-muted">11th April 2008 07:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">OK I'll assume the admin/power users are smart guys and I'll allow the problematic case above.<br><br>The installer can always try to do it's best to uninstall everything in a clean way (if the uninstaller user is an admin): clean the user reg + the machine reg, clean user shortcuts + all shortcuts.<br><br>Thank you all for your replies.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>