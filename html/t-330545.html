<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="MUI Invalid Languge File English"><title>MUI Invalid Languge File English - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">MUI Invalid Languge File English</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=330545">MUI Invalid Languge File English</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">texaspapa</span><br><span class="post-time small text-muted">12th May 2011 00:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>MUI Invalid Languge File English</strong><br>I am trying to get a test installer to work and get an error telling me that the language file is invalid. See below for details.<br><br><br>I get this error if I include either of these lines in the test program:<br><br><br>1) LoadLanguageFile "${NSISDIR}\Contrib\Language files\English.nlf"<br><br>2) !insertmacro MUI_LANGUAGE English<br><br>Code is including mui2.nsh.<br><br>I do not get this when I remove the line. This occurs with the build from Jan 26, 2011 available on the developers page. Does anyone know if there are issues with the language files? Has something changed related to language file formats since NSIS 2.46?<br><br>Test program works with the released version 2.46.<br><br><br>Compile output:<br><br>Exch($3,0)<br>FunctionEnd<br>!insertmacro: end of FUNCTION_STRING_StrTok<br>!define: "MUI_ABORTWARNING"=""<br>!define: "MUI_ICON"="\\h02264-pc\e$\Downloads\Programs\nsis\nsis-26-Jan-2011.cvs\Contrib\Graphics\T-System\TSystemEV.ico"<br>!define: "MUI_UNICON"="\\h02264-pc\e$\Downloads\Programs\nsis\nsis-26-Jan-2011.cvs\Contrib\Graphics\T-System\TSystemEV.ico"<br>!define: "MUI_COMPONENTSPAGE_NODESC"=""<br>!define: "MUI_WELCOMEFINISHPAGE_BITMAP"="\\h02264-pc\e$\Downloads\Programs\nsis\nsis-26-Jan-2011.cvs\Contrib\Graphics\T-System\T_Logo_Dialog2.bmp"<br>!define: "MUI_FINISHPAGE_NOAUTOCLOSE"=""<br>!insertmacro: MUI_PAGE_WELCOME<br>!insertmacro: end of MUI_PAGE_WELCOME<br>!insertmacro: MUI_PAGE_INSTFILES<br>!insertmacro: end of MUI_PAGE_INSTFILES<br>!insertmacro: MUI_PAGE_FINISH<br>!insertmacro: end of MUI_PAGE_FINISH<br>!insertmacro: MUI_UNPAGE_INSTFILES<br>!insertmacro: end of MUI_UNPAGE_INSTFILES<br>!insertmacro: MUI_LANGUAGE<br>Error: Invalid language file.<br>Error in macro MUI_LANGUAGE on macroline 9<br>Error in script "D:\dev\v40_work\Installer\testing\Test.nsi" on line 118 -- aborting creation process</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">T.Slappy</span><br><span class="post-time small text-muted">12th May 2011 05:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Did you include MUI2 before !insertmacro MUI_LANGUAGE English ??<br>Sometimes the right order is needed.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">texaspapa</span><br><span class="post-time small text-muted">12th May 2011 17:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Language File Version 5 or 6?</strong><br>Yes msi2 is included before any mui statements. msi2.nsh is the first file included.<br><br>This is strange as the same nsi file builds using the 2.46 version of nsis.<br><br>From what I can tell the current code Lang.cpp is checking for version 5 and language files all have version 6. Even the English NSIS 2.46 Language file is version 6.<br><br><br><br>// NSIS Language File parser<br>LanguageTable * CEXEBuild::LoadLangFile(char *filename) {<br>FILE *f = FOPEN(filename, "r");<br>if (!f) {<br>ERROR_MSG("Error: Can't open language file - \"%s\"!\n",filename);<br>return 0;<br>}<br><br>// Check header<br>char buf[NSIS_MAX_STRLEN];<br>buf[0] = SkipComments(f);<br>fgets(buf+1, NSIS_MAX_STRLEN, f);<br><br>if (strncmp(buf, "NLF v", 5)) {<br>ERROR_MSG("Error: Invalid language file.\n");<br>return 0;<br>}</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">12th May 2011 17:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">No it's not checking for version 5. That is just telling it to only check the first 5 characters of buf (strncmp). Just use NSIS 2.46.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">texaspapa</span><br><span class="post-time small text-muted">12th May 2011 18:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You are correct. Code is only comparing 5 bytes. I still get the "Invalid Language File " error with the build from Jan 26th.<br><br>The 2.46 build is not working for me. I am trying to install on Windows 2008 (64-bit). Installer works on Windows Server 2003 (32-bit). When I run my installer it exits about half way through. I then ran my installer under Application Verifier and windbg. Application Verifier caught and aborted the installer the first time nsexec is invoked. This error occurs immediately when running the installer with Application Verifier. Turns out that nsexec.c ExecScript code corrupts memory on 64-bit system. This problem is fixed with current version of nsexec.c. This is why I am trying to get an updated nsis build!<br><br>I first checked out the latest NSIS source from SVN. After building NSIS I am not able to build any nsi file. So I thought that I would try the build from January 26 since it was available on the NSIS download page. With the Jan 26th build I get "Invalid Language File" when I build ANY nsi file including the languages.nsi file under examples.<br><br>Once I get past this issue, I will be able to resume debugging my installer.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">12th May 2011 18:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You could use ExecDos instead? I have tested and modified that to work correctly on x64.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">texaspapa</span><br><span class="post-time small text-muted">12th May 2011 19:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">thanks! I will look into ExecDos. Did you use the 2.46 build on a 64 bit OS when you used ExecDos?<br><br>I am now able to build the languages.nsi file using the build from January 26. It turns out that that build is built without UNICODE but that language files are saved as UTC-8 files. I saved the language files as ASCII files and can now build with no Invalid Language File errors.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">12th May 2011 20:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The new NSIS version is meant to handle ANSI/Unicode duality but it's probably still work in progress. For that reason I would stick to 2.46 which has been tried and tested. You should always use stable releases in general, unless you are seeking for bad customer feedback ;). Yes we use 2.46.<br><br>Stu</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>