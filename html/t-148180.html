<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="WriteUninstaller and BZIP2 - bad combo"><title>WriteUninstaller and BZIP2 - bad combo - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">WriteUninstaller and BZIP2 - bad combo</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=148180">WriteUninstaller and BZIP2 - bad combo</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Mad Doggie</span><br><span class="post-time small text-muted">5th September 2003 03:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>WriteUninstaller and BZIP2 - bad combo</strong><br>I have created a number of NSIS installers in the 15-20MB range, compressed using BZIP2. The "raw" install data is in the 220MB range.<br><br>I've found that the WriteUninstaller instruction forces the installer to extract all of the data, which takes a while to do since there's 200MB+ to write. I've used ReserveFile judiciously as early in the installer as I can, and it only seems to want to do this when the WriteUninstaller instruction is executed.<br><br>I tried making the Uninstall section the 1st or 2nd section before all of the data, but no difference. Why is this?<br><br>Cheers!<br><br>Luke</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Mad Doggie</span><br><span class="post-time small text-muted">5th September 2003 03:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">One other note - it only started doing this when I ported my installer to the Modern UI.<br><br>Luke</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">5th September 2003 07:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Did you check the reserve file info in the Modern UI Readme and used these macros?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">5th September 2003 11:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It happens because the uninstaller data is written after processing the script. It can't predict ahead how big the uninstaller block will be, so it can't allocate enough space in the installer block before compilation starts.<br><br>Why not just put the WriteUninstaller command in the last section?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Mad Doggie</span><br><span class="post-time small text-muted">5th September 2003 14:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">OK, I'll make the section that writes the uninstaller the last one and we'll see what happens. FWIW, I'm using the following MUI reserve file macros:<br><br>MUI_RESERVEFILE_SPECIALINI<br>MUI_RESERVEFILE_INSTALLOPTIONS<br>MUI_RESERVEFILE_SPECIALBITMAP<br><br>I'm not sure if it's the reservefiles because I don't get an issue until the WriteInstaller command....<br><br>Cheers!<br><br>Luke</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">5th September 2003 15:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Those only reserve files, if you'd really want to put the WriteUninstaller on top you should have reserved the uninstaller datablock. But you can't know its size ahead, so it can't be done.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Mad Doggie</span><br><span class="post-time small text-muted">5th September 2003 15:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I tried putting the WriteUninstaller in the last section, but no luck either. I started a build before I left for the office, and the difference was that I <b>didn't</b> use the MUI for the uninstaller pages, just the installer part.<br><br>I noticed that when I switched to MUI, the uninstaller block was reported to grow from ~4K to ~50K. I'm not sure why, but I don't really care too much since the UI of the uninstall doesn't concern me. I never had this pre-MUI, so maybe the uninstaller size makes a difference.<br><br>Gawd, it's a royal pain compressing 220MB each time. :(<br><br>Cheers!<br><br>Luke</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">5th September 2003 15:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Can you attach the script?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Mad Doggie</span><br><span class="post-time small text-muted">5th September 2003 16:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i><br><b>Can you attach the script?</b></blockquote>Sure, when I get home around 6 ET. It's got the basic sections, with three or four includes of common functions and installer attributes.<br><br>Thanks for your prompt reponse!<br><br>Luke</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Mad Doggie</span><br><span class="post-time small text-muted">5th September 2003 22:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>OK... here's the basic cript</strong><br></p><blockquote><i>Originally posted by kichik</i><br><b>Can you attach the script?</b></blockquote>OK - here it is.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">5th September 2003 23:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">What do checkComponent, checkFSSound, checkFSUIPC and checkURL do? Do they add any files?<br><br>Just to clarify, you're saying that WriteUninstaller re-reads the entire installer data block, re-extracting your 200MB of files even after all of the files were extracted during installation. Is that right?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Mad Doggie</span><br><span class="post-time small text-muted">6th September 2003 03:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i><br><b>Just to clarify, you're saying that WriteUninstaller re-reads the entire installer data block, re-extracting your 200MB of files even after all of the files were extracted during installation. Is that right?</b></blockquote>The Macros check for a file on disk or a registry entry, and selectively disable/enable some sections. They don't write any files. All they do are ReadRegStr, IfFileExists and GetDLLVersion.<br><br>Actually, here's an interesting bit - the installer doesn't actually extract itself on load. It takes a touch longer to load than before, but it doesn't have the "checking installer...." little dialog box when it CRC checks itsself, and doesn't extract itself on load.<br><br>I don't understand the innards of MUI, but I can say that the installer behaves differently than it did before MUI was added in areas I didn't expect. (Of course, it could just be that I'm not using b3 anymore, too.)<br><br>Thanks again for your help. Do you have anyone else that's cramming 220+ MB into an installer?<br><br>Cheers!<br><br>Luke</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">6th September 2003 09:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The checking installer window for the CRC check was broken in a certain CVS veresion. Which version (or from which date) of makensis.exe are you using?<br><br>MUI adds some files to the installer. It adds InstallOptions.dll, some bitmaps, some INI files and StartMenu.dll if you're using it. If the script is not ordered right or the reserve macros are not used some of those files may be tacked to the end of the data block forcing the installer to run through the entire data block to get them which takes time. In case of whole compression (used by default with bzip2) it needs to decompress the data as it goes too which makes it even slower.<br><br>If you encouter more UI or script delays because of decompression please tell us and we'll see what can be improved.<br><br>As for other people with large installers, try some from <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=123323" target="_blank">this</a> thread. That issue hasn't been resolved yet, but I do have the plans ready for the next version.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>