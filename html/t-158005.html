<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Path Manipulation" />

  <title>Path Manipulation - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Path Manipulation</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=158005">Path Manipulation</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">cosmic66</span><br />
      <span class="post-time small text-muted">29th November 2003 13:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Path Manipulation</strong><br />
      I'm using <a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=91" target="_blank">these functions</a> for path manipulation<br />
      (thanks, KiCHiK :-)):<br />
      <br />
      I would like to add a function that will first check if a specific<br />
      string is already defined in PATH, so it wouldn't add it again<br />
      (the string I add is always: "%FOO%\bin").<br />
      <br />
      Can anyone help me on how to do that?<br />
      <br />
      <br />
      And when I use un.RemoveFromPath to remove a string from PATH, it<br />
      leaves the semi-colon that it added in front of it in the PATH string.<br />
      Is that done on purpose and is it not such a good idea to remove<br />
      that one?<br />
      <br />
      Thanks!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">29th November 2003 14:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The function checks if the directory is already there and doesn't add it if it is. If you want to check yourself anyway, simply read %PATH% using ReadEnvStr and only call the function if it's not there.<br />
      <br />
      The semicolon is not on purpose, but it doesn't really hurt. It's just an empty path that will be ignored. There is also <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=139857" target="_blank">this issue</a> which I should finally fix sometime...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">29th November 2003 17:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Fixed.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">cosmic66</span><br />
      <span class="post-time small text-muted">30th November 2003 14:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for your fix!<br />
      <br />
      <br />
      One more question regarding the path manipulation:<br />
      <br />
      I add my path to PATH like so:<br />
      <font face="courier new"><br />
      Push "$INSTDIR\bin"<br />
      Call AddToPath<br /></font><br />
      <br />
      And I remove it in the uninstaller like so:<br />
      <br />
      <font face="courier new"><br />
      Push "$INSTDIR\bin"<br />
      Call un.RemoveFromPath<br /></font><br />
      <br />
      If I run the installer twice (with the same INSTDIR) it will add<br />
      the same path to PATH twice.<br />
      From how I understood your answer it shouldn't do that, should it?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">30th November 2003 16:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I was wrong, it doesn't check if the path is already there. You should check for it yourself using ReadEnvStr and the StrStr function.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">cosmic66</span><br />
      <span class="post-time small text-muted">30th November 2003 21:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">How do I get the PATH string for Windows 9x?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">30th November 2003 21:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Use ReadEnvStr.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">cosmic66</span><br />
      <span class="post-time small text-muted">11th December 2003 11:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi,<br />
      <br />
      I'm having problems with checking PATH for a string.<br />
      I just can't find the mistake, maybe someone can<br />
      help me?<br />
      <br />
      The problem is when adding the string to PATH (AddToPath),<br />
      I first would like to check if the string is already there.<br />
      But the string is never found (StrStr always returns<br />
      -1), although in there.<br />
      <br />
      I have attached my modified PathManipulation script.<br />
      <br />
      <br />
      Thanks,<br />
      <br />
      Barbara</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">11th December 2003 13:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There is an example of checking on the archive page now. Try it and let me know if it works for you.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">cosmic66</span><br />
      <span class="post-time small text-muted">11th December 2003 16:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the example, with your code I got it to work!<br />
      <br />
      I had another problem then which was that I'm writing and testing<br />
      the installer without the actually data (those commands are added<br />
      through scripts that I don't have access to yet) and thus<br />
      $INSTDIR\bin was not created through my test installation.<br />
      <br />
      If you then call:<br />
      GetFullPathName /SHORT $1 $1<br />
      <br />
      (where $1 is "$INSTDIR\bin" and the path doesn't exist, the error<br />
      flag is set and $1 is empty.<br />
      <br />
      For completenes, this is the code that works for me now:<br />
      <br />
      <br />
      <br />
      <font face="courier new"><br />
      ReadEnvStr $0 path<br />
      Push "$0;"<br />
      Push "$INSTDIR\bin;"<br />
      Call StrStr<br />
      Pop $2<br />
      IntCmp $2 -1 addPath addPath<br />
      StrCpy $1 "$INSTDIR\bin"<br />
      GetFullPathName /SHORT $1 $1<br />
      MessageBox MB_OK $1<br />
      ReadEnvStr $0 path<br />
      Push "$0;"<br />
      Push "$1;"<br />
      Call StrStr<br />
      Pop $2<br />
      IntCmp $2 -1 addPath addPath dontAdd<br /></font></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">cosmic66</span><br />
      <span class="post-time small text-muted">16th December 2003 12:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have one remaining problem:<br />
      <br />
      I'm testing for a string in PATH as posted abough.<br />
      <br />
      If INSTDIR consists of spaces (such as "MyApp 2"), the<br />
      string is not detected and added to PATH again.<br />
      <br />
      What can I do to solve this?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">16th December 2003 12:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Use the updated functions, they check it for, spaces or no spaces.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">cosmic66</span><br />
      <span class="post-time small text-muted">16th December 2003 13:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have now updated the functions (from your archive page).<br />
      <br />
      If the installdir has spaces it works OK now.<br />
      <br />
      <br />
      On uninstallation it messes up the PATH string though:<br />
      <br />
      The first entry on my box was:<br />
      C:\Program Files\Microsoft Visual ...<br />
      and after I uninstalled my SW my path was still in there but<br />
      the start of the string was shortened to:<br />
      \Microsoft Visual ...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">16th December 2003 15:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Fixed, thanks.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Thalion77</span><br />
      <span class="post-time small text-muted">6th April 2006 09:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Where is the archive page? I would like to download the functions to manipulate the path variable.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pengyou</span><br />
      <span class="post-time small text-muted">6th April 2006 11:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The archive has been replaced by the wiki:<br />
      <br />
      <a href="http://nsis.sourceforge.net/Developer_Center" target="_blank">http://nsis.sourceforge.net/Developer_Center</a><br />
      <br />
      Here are some links that might answer your question:<br />
      <br />
      <a href="http://nsis.sourceforge.net/Path_Manipulation" target="_blank">http://nsis.sourceforge.net/Path_Manipulation</a><br />
      <br />
      <a href="http://nsis.sourceforge.net/Path_manipulation_with_all_users/current_user_selection_in_run-time" target="_blank">http://nsis.sourceforge.net/Path_man...on_in_run-time</a></p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
