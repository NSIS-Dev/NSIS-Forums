<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Delete a specific registry data" />

  <title>Delete a specific registry data - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Delete a specific registry data</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=341386">Delete a specific registry data</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Acid_Attack</span><br />
      <span class="post-time small text-muted">29th January 2012 14:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Delete a specific registry data</strong><br />
      Hi,<br />
      <br />
      I need to delete a specific registry data inside a value, but not the whole value.<br />
      The problem is this:<br />
      When the user uninstall there are files that can't be deleted, and therefore we use /REBOOTOK<br />
      but if the user re-installed the program before he restarted the machine and then he did the restart, the pending-to-be-deleted-files will be deleted and the program won't work.<br />
      <br />
      For this reason, we want on installation to look inside:<br />
      HKLM\SYSTEM\ControlSet\Control\Session Manager "PendingFileRenameOperations"<br />
      <br />
      This key contains the value-data ​​to be deleted after reboot.<br />
      But we need to look for the specific value-data and to delete only it and not the whole value (the value contains other files to be deleted)!<br />
      <br />
      Any idea how to do this ?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">2nd February 2012 16:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I believe that is a REG_MULTI_SZ which you can read and write using the Registry plug-in.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">2nd February 2012 17:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you rename the file(s) that the uninstaller was unable to delete, then the new files added by the installer won't get deleted by the reboot. (Renaming the files might or might not work, depending upon why you are unable to delete them).<br />
      <br />
      You can try moving the files to a temporary directory if you want to make the install folder look like they were deleted.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br />
      <span class="post-time small text-muted">2nd February 2012 17:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        You can try moving the files
      </blockquote>you cant move them while they are marked for delete on reboot.<br />
      thats one reason they are marked for - in use!<br />
      <br />

      <blockquote>
        "PendingFileRenameOperations"
      </blockquote>is a long string sometimes &gt;1024 - so you need the long string special build from nsis.<br />
      oh, my watcher limits outout to 730 token, afair this is due the line breaks inbetween that value
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">2nd February 2012 18:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'll have to accept your statement that files listed in PendingFileRenameOperations are locked from being moved, but the code in my installer does it like this:</p>
      <pre>
<code>${If} ${FileExists} C:\Ipls\dlls\*.*<br />        SetOutPath C:\IPLS              ; set current dir to prevent deleting C:\Ipls<br />        RMDir /r C:\Ipls                ; don't keep any old files or folders<br />        ${If} ${FileExists} C:\Ipls\dlls\*.*<br />                ; something has held up the folder: rename it to allow fresh files<br />                Rename C:\Ipls\dlls C:\Ipls\dlls.prev<br />                RMDir /r /REBOOTOK C:\Ipls\dlls.prev<br />                ${If} ${FileExists} C:\Ipls\dlls.prev\*.*<br />                        Push "C:\Ipls\dlls.prev will be deleted after reboot."<br />                        Call ErrorLog<br />                ${EndIf}<br />        ${EndIf}<br />        ClearErrors<br />${EndIf}</code>
</pre>Notice that I don't use the /REBOOTOK switch until after I've tried to remove the files once. Before that logic was added there were always a couple of dlls that wouldn't get deleted. The code above works for us. Now those stubborn files are in a different directory and are safe from the reboot delete.<br />
      <br />
      Here's a second place I do the same thing:
      <pre>
<code>Rename C:\Lockit $Temp\Lockit<br />RMDir /r /REBOOTOK $Temp\Lockit<br />${If} ${FileExists} $Temp\Lockit\*.*<br />        Push "$Temp\Lockit will be deleted after reboot."<br />        Call ErrorLog<br />${EndIf}<br /></code>
</pre>There are always a couple of files in that folder that can't get deleted (dlls used by Windows Explorer and the Logon process). The code above works.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br />
      <span class="post-time small text-muted">2nd February 2012 21:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">similar to mine<br />
      <a href="http://forums.winamp.com/showthread.php?t=340940" target="_blank">http://forums.winamp.com/showthread.php?t=340940</a></p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
