<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="How can I execute a batch file?"><title>How can I execute a batch file? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">How can I execute a batch file?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=272843">How can I execute a batch file?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">MidnightJava</span><br><span class="post-time small text-muted">15th June 2007 06:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>How can I execute a batch file?</strong><br>I'm trying to execute a .bat file in a function. I used<br><br>Exec $INSTDIR\installRCB.bat<br><br>But the file is not executed. I see a command window pop up very briefly, but nothing more. Is Exec supposed to work only with .exe files? Is there a way to execute the .bat file?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">demiller9</span><br><span class="post-time small text-muted">15th June 2007 06:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">There are several ways to execute a batch file. Check this <a href="http://forums.winamp.com/showthread.php?postid=2054461#post2054461" target="_blank">forum thread</a> for several ways. It depends whether you want the script to wait, if you want the command window to be visible, if you need to capture or redirect the batch output.<br><br>Don</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MidnightJava</span><br><span class="post-time small text-muted">15th June 2007 06:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I've seen other examples where batch files are executed with Exec, so I must be doing something wrong. Here's how I invoke the function<br><br>!define MUI_PAGE_CUSTOMFUNCTION_LEAVE installServices<br>!insertmacro MUI_PAGE_FINISH<br><br>and here's the function:<br><br>Function installServices<br>Exec '$INSTDIR\installRCB.bat'<br>FunctionEnd<br><br>The file installRCB.bat is verified to be in $INSTDIR, and if I execute it manually it runs properly. But when executed from the installer, nothing happens. I've tried ExecWait also, and every permutation of single and double quotes, to no avail.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MidnightJava</span><br><span class="post-time small text-muted">15th June 2007 07:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Looks like I had more of a scripting problem than an NSIS issue. I had relative path references in my batch file, which were not working when the script was executed from the installer. The script was written assuming it would be executed from the directory that equates to $INSTDIR in the installer. But apparently .bat files run from within the installer do not execute from $INSTDIR. Thanks for your help.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Takhir</span><br><span class="post-time small text-muted">15th June 2007 07:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">NSIS Exec can start binary file only, bat files managed by shell. First way is to use ExecShell, but this flashes black console window. So find something sutable for you in the forum 'search' on ComSpec keyword <a href="http://forums.winamp.com/search.php?s=&amp;action=showresults&amp;searchid=8848027&amp;sortby=lastpost&amp;sortorder=descending" target="_blank">http://forums.winamp.com/search.php?...der=descending</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MidnightJava</span><br><span class="post-time small text-muted">15th June 2007 13:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Actually it's working now. I was trying to say that in my last post, but I wasn't very clear. I was executing a .bat file that had two lines in it. Each line was calling another .bat script, identifying them using relative path references whose base path is the path location where the first .bat file was executing (the directory that the NSIS installer knows as $INSTDIR).<br><br>Since the NSIS installer was executing from the location where the setup file was located, which is not $INSTDIR, it was unable to resolve the two relative path references in the .bat file I was calling from the installer. That's why I was seeing the cmd window pop up momentarily. It was executing the .bat file, but it was unable to find any command that was meaningful.<br><br>To resolve the problem I eliminated the .bat file that was calling the other two .bat files. Instead I just call each of those .bat files directly from the installer, using two successive Exec commands.<br><br>Because of this, and several other examples I saw by searching the forum, it seems clear that Exec does indeed support execution of .bat files.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">15th June 2007 13:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I would recommend that you use COMSPEC /C (as suggested) to execute the batch files just in case.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MidnightJava</span><br><span class="post-time small text-muted">15th June 2007 22:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">OK I see what COMSPEC is about, and I'll use that if you think it's a more universal solution. But what about using nsExec instead of the /C switch with COMSPEC? I imagine COMSPEC /C will still flash the cmd window momentarily, while nsExec won't? And should i still use COMSPEC with nsExec?<br><br>But more to the point, how do I get info on how to use nsExec? I went to the NSIS plug-in page and it's not listed. I have the .dll file in my NSIS plug-ins directory, but the only info I can gather is a list of nsExec functions at the top of my compiler output.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">15th June 2007 23:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by MidnightJava</i><br><b>OK I see what COMSPEC is about, and I'll use that if you think it's a more universal solution. But what about using nsExec instead of the /C switch with COMSPEC? I imagine COMSPEC /C will still flash the cmd window momentarily, while nsExec won't? And should i still use COMSPEC with nsExec?<br><br>But more to the point, how do I get info on how to use nsExec? I went to the NSIS plug-in page and it's not listed. I have the .dll file in my NSIS plug-ins directory, but the only info I can gather is a list of nsExec functions at the top of my compiler output.</b></blockquote>I think you have point here, probably nsExec would do the job as you mentioned.<br><br>See under your local nsis installation into folders documents and examples for info about nsExec.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">16th June 2007 12:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">nsExec with COMSPEC will work fine.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MidnightJava</span><br><span class="post-time small text-muted">17th June 2007 05:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Just to close the loop here:<br><br>Both Exec and nsExec worked fine and did what I needed. I implemented as follows:<br><br></p><pre>
<code>Function installServices<br>    ReadEnvStr $0 COMSPEC<br>    nsExec::Exec  '$0 /c "$INSTDIR\RCBClient\bin\InstallRCBClient-NT.bat"'<br>    nsExec::Exec  '$0 /c "$INSTDIR\RCBServer\bin\InstallRCBServer-NT.bat"'<br>FunctionEnd</code>
</pre><br>
      <br>
      Using Exec /c instead of nsExec::Exec worked similarly. In the former case, the cmd window shows up briefly and then disappears after the .bat file completes execution. With nsExec, the cmd window never shows up. Interestingly, the /C is needed with nsExec; otherwise the services are not installed.<br>
      <br>
      Since it worked without COMSPEC, I believe the rationale for adding COMSPEC was to ensure compatibility with W2K and XP. However, I'm still having trouble reconciling what I've seen with Takhir's statement that NSIS Exec only works with binary files, and that ExecShell is needed for .bat files. I've read the documentation on Exec and ExecShell, and I'm still not clear on what the distinction is and when to use either of them. The documentation supports Takhir's statement, but my experience seems to bely what the documentation says.<br>
      <br>
      But it is working, and I'm grateful for all the helpful comments.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br>
      <span class="post-time small text-muted">17th June 2007 06:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Exec uses CreateProcess and ExecShell uses ShellExecute (ExecShell can launch anything, a url, a text file, a pdf)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">17th June 2007 09:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You might want to put quotes around $0 in the execution line in case the path contains spaces.<br>
      <br>
      Stu</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script type="text/javascript" src="../js/highlight.pack.js" async>
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>