<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="SetShellVarContext user"><title>SetShellVarContext user - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">SetShellVarContext user</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=306000">SetShellVarContext user</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">OmidH</span><br><span class="post-time small text-muted">3rd May 2009 21:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>SetShellVarContext user</strong><br>Hi all,<br><br>I'd like to know if it is possible to set : "SetShellVarContext current" when I need to execute the installer with admin rights (but from an "normal" useraccount).<br>The Problem is, when setting "SetShellVarContext current" and executing with admin privilegs the $SMSTARTUP (for example) is the Startup dir of the admin and not the one of the user, who executes the installer with admin rights.<br><br>Is there a sollution for this Problem?<br><br>Thanks in advance,<br><br>Omid</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Animaether</span><br><span class="post-time small text-muted">3rd May 2009 22:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">check out the UserInfo plugin (comes with NSIS). With it you can get the original user account credentials as well as the current user account credentials. That way you can detect that a User has 'Run As' your installer as admin (or elevated via UAC in Vista).<br><br>How to go from there, though... not sure.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">3rd May 2009 23:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Animaether</i><br><b>check out the UserInfo plugin (comes with NSIS). With it you can get the original user account credentials as well as the current user account credentials. That way you can detect that a User has 'Run As' your installer as admin (or elevated via UAC in Vista).<br></b></blockquote>that is not true, UserInfo does not give you that info. UserInfo can tell you if the current PROCESS or current USER is a member of the admin group or whatever, but its not related to UAC at all, its related to Deny Group SID on a Token (talking about GetAccountType vs GetOriginalAccountType here)<br><br>anyways, you can use the UAC plugin to pull this off, but you should understand that doing this is not "correct". If your script contains RequestExecutionLevel admin, then you are doing a "all users" install and you should only use SetShellVarContext all</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Animaether</span><br><span class="post-time small text-muted">4th May 2009 12:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">hurr.. so that only works the other way around; admin with the installer requesting level 'user'?<br>(<br># On Vista with UAC, for example, this is not the same value when running<br># with `RequestExecutionLevel user`. GetOriginalAccountType will return<br># "admin" while GetAccountType will return "user".<br>)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">4th May 2009 14:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">@Animaether: It has NOTHING to do with UAC, forget about it. You will see it on XP if you right-click and choose run-as, then check the protect my computer option (NSIS does not even run with it checked IIRC, but thats another story) The protect my computer option uses the SaferAPI behind the scenes, so it applies to others using that API also, or if they are building a token by hand and adding deny SID's on their own<br><br>Try using my SaferAPI plugin and check the security tab of a process in Process Explorer, run the nsis app as admin, look at its child spawned by the safer api, it will have a DENY Admin SID in its process token (or <a href="http://www.devdebug.members.winisp.net/images/msdnblog/ProcessonVistaAdministratororuser_B834/1038917470_c1dd9e97b9_o.png" target="_blank">http://www.devdebug.members.winisp.n...dd9e97b9_o.png</a> if you are lazy)<br><br>Older versions of the UserInfo plugin will report someone with a deny admin SID as admin, that function now has Original in the name and the other function calls the correct api on 2000 and later and is able to handle deny SID's<br><br>For more info:<br><a href="http://blogs.msdn.com/aaron_margosis/archive/2004/09/10/227727.aspx" target="_blank">http://blogs.msdn.com/aaron_margosis...10/227727.aspx</a><br><a href="http://msdn.microsoft.com/en-us/library/aa446583.aspx" target="_blank">http://msdn.microsoft.com/en-us/library/aa446583.aspx</a><br><a href="http://blogs.msdn.com/larryosterman/archive/2004/09/01/224051.aspx#225519" target="_blank">http://blogs.msdn.com/larryosterman/...51.aspx#225519</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Animaether</span><br><span class="post-time small text-muted">4th May 2009 22:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">slightly misleading in the user info example, then - thanks for the info, Anders - will peruse :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">OmidH</span><br><span class="post-time small text-muted">9th May 2009 09:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">thanks guys for your responds.<br>I will do the installation for all users.<br><br>regards,<br><br>Omid</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>