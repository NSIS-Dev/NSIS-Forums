<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="vpatch-&gt;how to generate new files in dest dir"><title>vpatch-&gt;how to generate new files in dest dir - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">vpatch-&gt;how to generate new files in dest dir</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=240903">vpatch-&gt;how to generate new files in dest dir</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">DarkUniverse</span><br><span class="post-time small text-muted">15th March 2006 08:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>vpatch-&gt;how to generate new files in dest dir</strong><br>Hi@all,<br>I need a patch that generates new files in the dest dir. Background: I have to patch several files from old to new version and I also have to add some new files. One member of the forum did it in 2005 but did not post the solution. So, how is it possible? I have tried to do it since hours and days and also had a look in this forum and google...<br>Thanx,<br>Christian</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">16th March 2006 17:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'd create a macro that first checks if the file exists and only then patches. If it doesn't exist, it'll just extract the newest version.<br><br>If you want to have in a patch file, try creating a patch from an empty file to the file you want.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">DarkUniverse</span><br><span class="post-time small text-muted">16th March 2006 18:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi kichik!<br>Thanx for your suggestion which is pretty cool.<br>At the moment I only update the files in the dest dir (so there is no need to check if the file exists). Next step is to create the new (empty) files and update them. But this means that I have to know the new files which should be in the dest dir. Since I don't know the name of the new file, I have to create a list and send the list with the patch and a macro to the user and compare the list with the files. Is it possible to get the information solely from the patch file without comparison?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">17th March 2006 11:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Don't you have to know the name of the files you want to patch anyway? The VPatch plug-in needs to know the name of the file it should patch. It takes its path as the second argument.<br><br>By the way, I've tested a patch from an empty file to another file and the VPatch plug-in wouldn't apply the patch unless the file already exists. This made me think of a simpler way than checking for the existence of the file. You can simply open the file using append mode. This way, if the file doesn't exist, it'll be created. If it does exist, nothing will happen.</p><pre>
<code>FileOpen $0 "$INSTDIR\file" "a"<br>FileClose $0</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DarkUniverse</span><br>
      <span class="post-time small text-muted">19th March 2006 10:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I only take the files in the destdir. If there is a patch in patchfile, then it will be patched. It will do nothing on the file if there is no patch. Thus, I have patched all files, that exists in the dest dir without problems. But now, the files that I have to create new...<br>
      <br>
      The procedure should then be something like this:<br>
      1. create the patch file with all patches (also the new files)<br>
      2. create a list of all patched/new files<br>
      3. send the installer along with the list of files and the patch to the user<br>
      4. The user starts the intsaller/patch<br>
      5. the installer does:<br>
      - patch all existing files<br>
      - compares the list with files in dest dir and creates the new files with:<br>
      FileOpen $0 "$INSTDIR\file" "a"<br>
      FileClose $0<br>
      and patch these files.<br>
      - and maybe deletes files not used anymore<br>
      6. done :-)<br>
      <br>
      Does this looks like a good solution?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">21st March 2006 18:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">But in order to patch the file, you must know the patched file name. The VPatch plug-in requires the output file path. You can not patch without the file name. There's no need for a list in this case. Before you patch the file, check if it exists.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DarkUniverse</span><br>
      <span class="post-time small text-muted">22nd March 2006 09:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by DarkUniverse</i><br>
        <b>I only take the files in the destdir. If there is a patch in patchfile, then it will be patched. It will do nothing on the file if there is no patch. Thus, I have patched all files, that exists in the dest dir without problems. But now, the files that I have to create new...<br></b>
      </blockquote>Ok. I guess you mean this part.<br>
      <br>
      I generate the patch file as usual: I take the files of a directory recursive and write the patches into the patch file. This is done by the developer.<br>
      Result is a patch file which includes all patches of the files.<br>
      <br>
      I recursive take the files of the client, where I know the basedir. The I use vpatch on every file. If there is one patch available, it will be executed. If not, nothing is done on the file.<br>
      <br>
      So far, I do not need any list. A list is only used on new or deleted files.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DarkUniverse</span><br>
      <span class="post-time small text-muted">22nd March 2006 09:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'll check the solution by implementing it today. Hope it works! :-)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DarkUniverse</span><br>
      <span class="post-time small text-muted">22nd March 2006 10:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Another possibility is to compress the whole dir in a zip or jar file and then doing the patch just on one file. Then, uncompress it on the client. The patch file will be bigger, but this solution is maybe more stable and easier.<br>
      <br>
      Hm, I am not sure... has someone tried this?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DarkUniverse</span><br>
      <span class="post-time small text-muted">22nd March 2006 12:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hm, I had a second thought on it. I think that it is not possible, because he MD5/CRC of the copmpressed file on the client(which consists of the whole files in the dest dir) is not the same. Thus, the patch vcan not find the file with the right checksum.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DarkUniverse</span><br>
      <span class="post-time small text-muted">28th March 2006 12:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I had not much time since I wrote the last messages... but I'm still on this topic.<br>
      <br>
      Regards,<br>
      Christian</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>