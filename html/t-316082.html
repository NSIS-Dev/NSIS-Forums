<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="File/path last character evaluation, concatenation"><title>File/path last character evaluation, concatenation - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">File/path last character evaluation, concatenation</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=316082">File/path last character evaluation, concatenation</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Lodester</span><br><span class="post-time small text-muted">7th January 2010 20:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>File/path last character evaluation, concatenation</strong><br>Learning lots every day about NSIS, so far I've got to say I'm pretty impressed. Especially very happy to see the divestment from .ini files (InstallOptions) in deference to native scripting (nsDialogs and in general).<br><br>Anyway, I know I'm doing some things inefficiently, as all beginnners do, but I have what I think is a simple question and I've not seen the magic header command or custom function/macro that makes this more 'elegant' , but its gotta be out there (?)<br><br>I have to evaluate a path from a text control to normalize it for use, in two ways:<br>1) If the path supplied did not have a trailing slash, append one.<br>2) In either case, append a subdirectory to the string<br>So there are two outputs I'm looking for, shown here as $1 and $5, respectively<br><br></p><blockquote><font face="courier new">StrCpy $1 "C:\somepath\" ;from input may or may not have trailing backslash<br>StrLen $2 $1<br>IntOp $3 $2 - 1<br>StrCpy $4 $1 "" $3 ; now i know the last char in $4<br>${If} $4 != "\"<br>StrCpy $5 "$1\SubDir\" ;Append Dir (case 2) "C:\somepath\Subdir\"<br>StrCpy $1 "$1\" ;normalize input (case 1) "C:\somepath\"<br>${Else}<br>StrCpy $0 "SubDir\" ;workaround(?) for concat of strings to avoid C:\somepath\\SubDir\<br>StrCpy $5 "$bkuppath_state$0" ;C:\somepath\Subdir\<br></font></blockquote><br><br>This works, but it seems a bit...verbose. And looking ahead i see needing to evaluate this condition a lot.<br><br>Is there a better way? Teach me, i am in the throes of NSIS scripting consumption, and i need nourishment.<br><br>Thanks in advance for help!</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">meaningoflights</span><br><span class="post-time small text-muted">8th January 2010 11:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Just put your code in a function so it accepts a path and return it with just one trailing slash.<br><br>Reading your Q is inspiring and written in a such a friendly colloquial tone that I think you'll get a better response from some major dude or forum king. Be sure to check back when others get a chance to see it and think it thru...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">11th January 2010 08:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Your best bet is either a function or a macro. Functions cannot accept parameters, however. Macros accept parameters, but every call is saved separately in your installer, so the overall exe size would increase (very) slightly.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>