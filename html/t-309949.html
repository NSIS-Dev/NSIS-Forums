<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="WMI via System plugin - query BIOS serial number" />

  <title>WMI via System plugin - query BIOS serial number - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">WMI via System plugin - query BIOS serial number</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=309949">WMI via System plugin - query BIOS serial number</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">f0rt</span><br />
      <span class="post-time small text-muted">13th August 2009 19:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>WMI via System plugin - query BIOS serial number</strong><br />
      The following code demonstrates the usage of the Windows Management Instrumentation (WMI) only via the System plugin.<br />
      The sample code displays the BIOS serial number in a message box.<br />
      <br />
      I have not yet tried to remotely access computers via this script. Furthermore I left out a call to the CoSetProxyBlanket function because it seems that is is not needed for querying the BIOS serial number.<br />
      <br /></p>
      <pre>
<span style="color: #007700">;</span><span style="color: #0000BB">Copyright</span><span style="color: #007700">(</span><span style="color: #0000BB">c</span><span style="color: #007700">)</span><span style="color: #0000BB">2009f0rt
<br /></span><span style="color: #007700">;</span><span style="color: #0000BB">Licensedunderthezlib</span><span style="color: #007700">/</span><span style="color: #0000BB">libpnglicense</span><span style="color: #007700">(</span><span style="color: #0000BB">same</span><span style="color: #007700">as</span><span style="color: #0000BB">NSIS</span><span style="color: #007700">)
<br />;
<br />;</span><span style="color: #0000BB">UsageofWindowsManagementInstrumentation</span><span style="color: #007700">(</span><span style="color: #0000BB">WMI</span><span style="color: #007700">)</span><span style="color: #0000BB">onlyviatheSystemplugin
<br /></span><span style="color: #007700">;</span><span style="color: #0000BB">DisplayBIOSserialnumber
<br /><br />OutFile</span><span style="color: #DD0000">"bios_sn.exe"
<br /><br /></span><span style="color: #007700">!include</span><span style="color: #DD0000">"LogicLib.nsh"
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineCLSCTX_INPROC_SERVER1
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineCLSID_WbemLocator</span><span style="color: #007700">{</span><span style="color: #0000BB">4590f811</span><span style="color: #007700">-</span><span style="color: #0000BB">1d3a</span><span style="color: #007700">-</span><span style="color: #0000BB">11d0</span><span style="color: #007700">-</span><span style="color: #0000BB">891f</span><span style="color: #007700">-</span><span style="color: #0000BB">00aa004b2e24</span><span style="color: #007700">}
<br />!</span><span style="color: #0000BB">defineIID_IWbemLocator</span><span style="color: #007700">{</span><span style="color: #0000BB">dc12a687</span><span style="color: #007700">-</span><span style="color: #0000BB">737f</span><span style="color: #007700">-</span><span style="color: #0000BB">11cf</span><span style="color: #007700">-</span><span style="color: #0000BB">884d</span><span style="color: #007700">-</span><span style="color: #0000BB">00aa004b2e24</span><span style="color: #007700">}
<br /><br />!</span><span style="color: #0000BB">defineRPC_C_AUTHN_LEVEL_DEFAULT0
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineRPC_C_IMP_LEVEL_IMPERSONATE3
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineEOAC_NONE0
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineWBEM_FLAG_FORWARD_ONLY0x20
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineWBEM_FLAG_RETURN_IMMEDIATELY0x10
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineWBEM_INFINITE0xffffffff
<br /><br /></span><span style="color: #007700">;</span><span style="color: #0000BB">QueryBIOSserialnumberviaWMI</span><span style="color: #007700">andreturn</span><span style="color: #0000BB">itin</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br /></span><span style="color: #007700">Function</span><span style="color: #0000BB">bios_sn
<br /></span><span style="color: #007700">;</span><span style="color: #0000BB">Saveregisters
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">2
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">3
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">4
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">5
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">6
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">7
<br /><br /></span><span style="color: #007700">;</span><span style="color: #0000BB">InitializationofCOMisdoneviaOleInitializeinNSISinstallercode
<br /></span><span style="color: #007700">;</span><span style="color: #0000BB">SetgeneralCOMsecuritylevel
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"ole32::CoInitializeSecurity(\\
<br />i0,i-1,i0,i0,i${RPC_C_AUTHN_LEVEL_DEFAULT},\\
<br />i${RPC_C_IMP_LEVEL_IMPERSONATE},i0,i${EOAC_NONE},i0)i.r1"
<br /></span><span style="color: #007700">${If}$</span><span style="color: #0000BB">1</span><span style="color: #007700">!=</span><span style="color: #0000BB">0
<br />StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"failedtoinitializesecurity:$1"
<br /></span><span style="color: #0000BB">Gotobios_sn_end
<br /></span><span style="color: #007700">${EndIf}
<br /><br />;</span><span style="color: #0000BB">CreateIWbemLocator</span><span style="color: #007700">interface
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"ole32::CoCreateInstance(\\
<br />g'${CLSID_WbemLocator}',i0,\\
<br />i${CLSCTX_INPROC_SERVER},\\
<br />g'${IID_IWbemLocator}',*i.r2)i.r1"
<br /></span><span style="color: #007700">${If}$</span><span style="color: #0000BB">1</span><span style="color: #007700">!=</span><span style="color: #0000BB">0
<br />StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"failedtocreateIWebmLocatorobject:$1"
<br /></span><span style="color: #0000BB">Gotobios_sn_end
<br /></span><span style="color: #007700">${EndIf}
<br /><br />;</span><span style="color: #0000BB">CallIWbemLocator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">ConnectServer
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"$2-&gt;3(w'ROOT\CIMV2',i0,i0,i0,i0,i0,i0,*i.r3)i.r1"
<br /><br /></span><span style="color: #007700">${If}$</span><span style="color: #0000BB">1</span><span style="color: #007700">!=</span><span style="color: #0000BB">0
<br />StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"failedtoconnect:$1"
<br /></span><span style="color: #007700">${Else}
<br />;</span><span style="color: #0000BB">CallIWbemServices</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">ExecQuery
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"$3-&gt;20(w'WQL',w'SelectSerialNumberfromWin32_BIOS',\\
<br />${WBEM_FLAG_FORWARD_ONLY}|${WBEM_FLAG_RETURN_IMMEDIATELY},\\
<br />i0,*i.r4)i.r1"
<br /><br /></span><span style="color: #007700">${If}$</span><span style="color: #0000BB">1</span><span style="color: #007700">!=</span><span style="color: #0000BB">0
<br />StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"failedtoquery:$1$3"
<br /></span><span style="color: #007700">${Else}
<br />;</span><span style="color: #0000BB">CallIEnumWbemClassObject</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Next
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"$4-&gt;4(i${WBEM_INFINITE},i1,*i.r5,*i.r6)i.r1"
<br /></span><span style="color: #007700">${If}$</span><span style="color: #0000BB">1</span><span style="color: #007700">!=</span><span style="color: #0000BB">0
<br />StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"failedtoiterate:$1"
<br /></span><span style="color: #007700">${Else}
<br />${If}$</span><span style="color: #0000BB">6</span><span style="color: #007700">&gt;</span><span style="color: #0000BB">0
<br /></span><span style="color: #007700">;</span><span style="color: #0000BB">Variant
<br /></span><span style="color: #007700">;(</span><span style="color: #0000BB">unsignedshortvt</span><span style="color: #007700">,</span><span style="color: #0000BB">WORDwReserved1</span><span style="color: #007700">,
<br />;</span><span style="color: #0000BB">WORDwReserved2</span><span style="color: #007700">,</span><span style="color: #0000BB">WORDwReserved3</span><span style="color: #007700">,</span><span style="color: #0000BB">BSTRbstrVal</span><span style="color: #007700">)
<br />;</span><span style="color: #0000BB">Allocatememory</span><span style="color: #007700">for</span><span style="color: #0000BB">Variant
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"*(i0,i0,i0)i.r7"
<br /></span><span style="color: #007700">;</span><span style="color: #0000BB">CallIWbemClassObject</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Get
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"$5-&gt;4(w'SerialNumber',i0,ir7,i0,i0)i.r1"
<br /></span><span style="color: #007700">${If}$</span><span style="color: #0000BB">1</span><span style="color: #007700">&lt;</span><span style="color: #0000BB">0
<br />StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"failedtoget:$1"
<br /></span><span style="color: #007700">${Else}
<br />;</span><span style="color: #0000BB">AccessbstrValfromVariant
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"*$7(i,i,w.r0)"
<br /></span><span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"ole32::VariantClear(ir7)"
<br /></span><span style="color: #007700">${EndIf}
<br />;</span><span style="color: #0000BB">FreememoryassociatedwithVariant
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Free</span><span style="color: #007700">$</span><span style="color: #0000BB">7
<br /></span><span style="color: #007700">${Else}
<br /></span><span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"failed:noitems***91;$6***93;"
<br /></span><span style="color: #007700">${EndIf}
<br />;</span><span style="color: #0000BB">CallIWbemClassObject</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Release
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"$5-&gt;2()"
<br /></span><span style="color: #007700">${EndIf}
<br />;</span><span style="color: #0000BB">CallIEnumWbemClassObject</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Release
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"$4-&gt;2()"
<br /></span><span style="color: #007700">${EndIf}
<br /><br />;</span><span style="color: #0000BB">CallIWbemService</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Release
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"$3-&gt;2()"
<br /></span><span style="color: #007700">${EndIf}
<br /><br />;</span><span style="color: #0000BB">CallIWbemLocator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Release
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"$2-&gt;2()"
<br /><br /></span><span style="color: #0000BB">bios_sn_end</span><span style="color: #007700">:
<br />;</span><span style="color: #0000BB">Restoreregisters
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">7
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">6
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">5
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">4
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">3
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">2
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br />FunctionEnd
<br /><br /></span><span style="color: #007700">Function.</span><span style="color: #0000BB">onInit
<br />InitPluginsDir
<br />Callbios_sn
<br />MessageBoxMB_OK</span><span style="color: #DD0000">"BIOSSerialNumber=$0"
<br /></span><span style="color: #0000BB">Quit
<br />FunctionEnd
<br /><br />Section
<br />SectionEnd
<br /></span>

<!-- php buffer end -->
                
                
                
</pre>
      <hr />
      <pre>
        

                
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br />
      <span class="post-time small text-muted">13th August 2009 21:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Wow, this is a very good example of how to use the System plugin.<br />
      <br />
      Anyhow, you could have used the WMIInspector plugin to get the same result</p>
      <pre>
<code>WmiInspector::Request "CIMV2" "Win32_BIOS" "SerialNumber"<br />Pop $0 <br />Pop $1<br />MessageBox MB_OK "Result call: $0$\r$\n$\r$\nValue: $1"    <br /></code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">f0rt</span><br />
      <span class="post-time small text-muted">14th August 2009 20:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The WMIInspector plugin is fine as well.<br />
      <br />
      The advantage of the System plugin is that it is shipped with NSIS.<br />
      <br />
      Somehow a backslash (\) got lost in the call to IWbemLocator-&gt;ConnectServer. It should be:<br />
      <br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">;</span><span style="color: #0000BB">CallIWbemLocator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">ConnectServer<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"$2-&gt;3(w'ROOT\\CIMV2',i0,i0,i0,i0,i0,i0,*i.r3)i.r1"</span> I could no longer edit my previous post. So I just replied to the thread.<br />
      <br /></span>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">f0rt</span><br />
      <span class="post-time small text-muted">18th August 2009 23:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The disadvantage of the System plugin is that you need to be very careful with allocating and freeing memory.<br />
      <br />
      So here comes a new version which frees the previously allocated memory for the variant.<br />
      <br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #0000BB">OutFile</span><span style="color: #DD0000">"bios_sn.exe"<br />
      <br /></span> <span style="color: #007700">!include</span><span style="color: #DD0000">"LogicLib.nsh"<br />
      <br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineCLSCTX_INPROC_SERVER1<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineCLSID_WbemLocator</span><span style="color: #007700">{</span><span style="color: #0000BB">4590f811</span><span style="color: #007700">-</span><span style="color: #0000BB">1d3a</span><span style="color: #007700">-</span><span style="color: #0000BB">11d0</span><span style="color: #007700">-</span><span style="color: #0000BB">891f</span><span style="color: #007700">-</span><span style="color: #0000BB">00aa004b2e24</span><span style="color: #007700">}<br />
      !</span><span style="color: #0000BB">defineIID_IWbemLocator</span><span style="color: #007700">{</span><span style="color: #0000BB">dc12a687</span><span style="color: #007700">-</span><span style="color: #0000BB">737f</span><span style="color: #007700">-</span><span style="color: #0000BB">11cf</span><span style="color: #007700">-</span><span style="color: #0000BB">884d</span><span style="color: #007700">-</span><span style="color: #0000BB">00aa004b2e24</span><span style="color: #007700">}<br />
      <br />
      !</span><span style="color: #0000BB">defineRPC_C_AUTHN_LEVEL_DEFAULT0<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineRPC_C_IMP_LEVEL_IMPERSONATE3<br />
      <br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineEOAC_NONE0<br />
      <br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineWBEM_FLAG_FORWARD_ONLY0x20<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineWBEM_FLAG_RETURN_IMMEDIATELY0x10<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineWBEM_INFINITE0xffffffff<br />
      <br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineVT_BSTR8<br />
      <br /></span> <span style="color: #007700">Function</span><span style="color: #0000BB">bios_sn<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">Saveregisters<br />
      Push</span><span style="color: #007700">$</span><span style="color: #0000BB">1<br />
      Push</span><span style="color: #007700">$</span><span style="color: #0000BB">2<br />
      Push</span><span style="color: #007700">$</span><span style="color: #0000BB">3<br />
      Push</span><span style="color: #007700">$</span><span style="color: #0000BB">4<br />
      Push</span><span style="color: #007700">$</span><span style="color: #0000BB">5<br />
      Push</span><span style="color: #007700">$</span><span style="color: #0000BB">6<br />
      Push</span><span style="color: #007700">$</span><span style="color: #0000BB">7<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">InitializationofCOMisdoneviaOleInitializeinNSISinstallercode<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">SetgeneralCOMsecuritylevel<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"ole32::CoInitializeSecurity(\\<br />
      i0,i-1,i0,i0,i${RPC_C_AUTHN_LEVEL_DEFAULT},\\<br />
      i${RPC_C_IMP_LEVEL_IMPERSONATE},i0,i${EOAC_NONE},i0)i.r1"<br /></span> <span style="color: #007700">${If}$</span><span style="color: #0000BB">1</span><span style="color: #007700">!=</span><span style="color: #0000BB">0<br />
      StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"failedtoinitializesecurity:$1"<br /></span> <span style="color: #0000BB">Gotobios_sn_end<br /></span> <span style="color: #007700">${EndIf}<br />
      <br />
      ;</span><span style="color: #0000BB">CreateIWbemLocator</span><span style="color: #007700">interface<br /></span> <span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"ole32::CoCreateInstance(\\<br />
      g'${CLSID_WbemLocator}',i0,\\<br />
      i${CLSCTX_INPROC_SERVER},\\<br />
      g'${IID_IWbemLocator}',*i.r2)i.r1"<br /></span> <span style="color: #007700">${If}$</span><span style="color: #0000BB">1</span><span style="color: #007700">!=</span><span style="color: #0000BB">0<br />
      StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"failedtocreateIWebmLocatorobject:$1"<br /></span> <span style="color: #0000BB">Gotobios_sn_end<br /></span> <span style="color: #007700">${EndIf}<br />
      <br />
      ;</span><span style="color: #0000BB">CallIWbemLocator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">ConnectServer<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"$2-&gt;3(w'ROOT\\CIMV2',i0,i0,i0,i0,i0,i0,*i.r3)i.r1"<br />
      <br /></span> <span style="color: #007700">${If}$</span><span style="color: #0000BB">1</span><span style="color: #007700">!=</span><span style="color: #0000BB">0<br />
      StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"failedtoconnect:$1"<br /></span> <span style="color: #007700">${Else}<br />
      ;</span><span style="color: #0000BB">CallIWbemServices</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">ExecQuery<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"$3-&gt;20(w'WQL',w'SelectSerialNumberfromWin32_BIOS',\\<br />
      ${WBEM_FLAG_FORWARD_ONLY}|${WBEM_FLAG_RETURN_IMMEDIATELY},\\<br />
      i0,*i.r4)i.r1"<br /></span> <span style="color: #007700">${If}$</span><span style="color: #0000BB">1</span><span style="color: #007700">!=</span><span style="color: #0000BB">0<br />
      StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"failedtoquery:$1$3"<br /></span> <span style="color: #007700">${Else}<br />
      ;</span><span style="color: #0000BB">CallIEnumWbemClassObject</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Next<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"$4-&gt;4(i${WBEM_INFINITE},i1,*i.r5,*i.r6)i.r1"<br /></span> <span style="color: #007700">${If}$</span><span style="color: #0000BB">6</span><span style="color: #007700">!=</span><span style="color: #0000BB">0<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">Variant<br /></span> <span style="color: #007700">;(</span><span style="color: #0000BB">unsignedshortvt</span><span style="color: #007700">,</span><span style="color: #0000BB">WORDwReserved1</span><span style="color: #007700">,</span><span style="color: #0000BB">WORDwReserved2</span><span style="color: #007700">,</span><span style="color: #0000BB">WORDwReserved3</span><span style="color: #007700">,</span><span style="color: #0000BB">BSTRbstrVal</span><span style="color: #007700">)<br /></span> <span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"*(i0,i0,i0)i.r7"<br /></span> <span style="color: #007700">${If}$</span><span style="color: #0000BB">7</span><span style="color: #007700">!=</span><span style="color: #0000BB">0<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">CallIWbemClassObject</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Get<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"$5-&gt;4(w'SerialNumber',i0,ir7,i0,i0)i.r1"<br /></span> <span style="color: #007700">${If}$</span><span style="color: #0000BB">1</span><span style="color: #007700">!=</span><span style="color: #0000BB">0<br />
      StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"failedtoget:$1"<br /></span> <span style="color: #007700">${Else}<br />
      ;</span><span style="color: #0000BB">Checktypeofvariant<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"*$7(i.r1)"<br /></span> <span style="color: #0000BB">IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">1</span><span style="color: #007700">$</span><span style="color: #0000BB">1</span><span style="color: #007700">&amp;</span><span style="color: #0000BB">0xFFFF<br /></span> <span style="color: #007700">${If}$</span><span style="color: #0000BB">1</span><span style="color: #007700">==${</span><span style="color: #0000BB">VT_BSTR</span><span style="color: #007700">}<br />
      ;</span><span style="color: #0000BB">AccessbstrValfromVariant<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"*$7(i,i,w.r0)"<br /></span> <span style="color: #007700">${Else}<br /></span> <span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"failedtoaccessdata:wrongtype***91;$1***93;"<br /></span> <span style="color: #007700">${EndIf}<br /></span> <span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"ole32::VariantClear(ir7)"<br /></span> <span style="color: #007700">${EndIf}<br />
      ;</span><span style="color: #0000BB">Deallocatememoryofvariant<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Free</span><span style="color: #007700">$</span><span style="color: #0000BB">7<br /></span> <span style="color: #007700">${Else}<br /></span> <span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"failedtoallocatememoryforvariant"<br /></span> <span style="color: #007700">${EndIf}<br />
      ;</span><span style="color: #0000BB">CallIWbemClassObject</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Release<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"$5-&gt;2()"<br /></span> <span style="color: #007700">${Else}<br /></span> <span style="color: #0000BB">StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"failedtoiterate***91;$6***93;:$1"<br /></span> <span style="color: #007700">${EndIf}<br />
      ;</span><span style="color: #0000BB">CallIEnumWbemClassObject</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Release<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"$4-&gt;2()"<br /></span> <span style="color: #007700">${EndIf}<br />
      <br />
      ;</span><span style="color: #0000BB">CallIWbemService</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Release<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"$3-&gt;2()"<br /></span> <span style="color: #007700">${EndIf}<br />
      <br />
      ;</span><span style="color: #0000BB">CallIWbemLocator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Release<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">"$2-&gt;2()"<br />
      <br /></span> <span style="color: #0000BB">bios_sn_end</span><span style="color: #007700">:<br />
      ;</span><span style="color: #0000BB">Restoreregisters<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">7<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">6<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">5<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">4<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">3<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">2<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">1<br />
      FunctionEnd<br />
      <br /></span> <span style="color: #007700">Function.</span><span style="color: #0000BB">onInit<br />
      InitPluginsDir<br />
      Callbios_sn<br />
      MessageBoxMB_OK</span><span style="color: #DD0000">"BiosSerialNumber=$0"<br /></span> <span style="color: #0000BB">Quit<br />
      FunctionEnd<br />
      <br />
      Section<br />
      SectionEnd<br /></span></span> <!-- php buffer end -->
      <hr />
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
