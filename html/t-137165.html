<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="suggestions for translations/scripting"><title>suggestions for translations/scripting - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">suggestions for translations/scripting</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=137165">suggestions for translations/scripting</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">mjs</span><br><span class="post-time small text-muted">30th May 2003 16:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>suggestions for translations/scripting</strong><br>Hi,<br><br>I just downloaded NSIS and when I took a look at the scripting language it almost looked to me like FORTH (except that NSIS doesn't use RPN). Why not just using FORTH or LISP (or something similar) instead of something new?<br><br>However, it also seems that Providing translations for the installer is quite difficult. What about a solution similar to GNU gettext.<br><br>Example (FORTH notation):<br>"This is the text to translate" gettext MB_OK MessageBox<br><br>Example with "domain":<br>"This is a text used inside the MUI package" "MUI" dgettext MB_OK MessageBox<br><br>The "gettext" / "dgettext" functions automatically try to translate the text on the stack to the current system/user language.<br><br>You can get the current user language ID with the following snippet:<br><br>// --- snip ------------------------------------<br>#include &lt;windows.h&gt;<br><br>std::string GetLanguageId(void)<br>{<br>std::string LanguageId = GetLocaleStr(LOCALE_USER_DEFAULT, LOCALE_SABBREVLANGNAME, "");<br>std::string GnuBasicLanguageId = ((LanguageId.size()==0) ? std::string() : LanguageId.substr(0, 2));<br>return GnuBasicLanguageId;<br>}<br>// --- snip ------------------------------------<br><br>Regards,<br>mjs</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">30th May 2003 16:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">What's wrong with the current system with language files and language strings?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">mjs</span><br><span class="post-time small text-muted">30th May 2003 17:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">For GNU gettext you also need language files, but the great advantage is its ease of use. Instead of having something like:<br><br>if (language=="de") {<br>ShowText("Alles OK");<br>} else {<br>ShowText("Everything's OK");<br>}<br><br>You can simply use:<br><br>ShowText(gettext("Everything's OK"));<br><br>gettext knows the current language ID and searches for a translation for this string in the current domain - or in another domain when you use dgettext instead.<br><br>There is no need for different include files that define texts in a different way depending on the wanted target language. Instead you have a single source file and just deploy several translation files containing the translations for all texts needed in the application.<br><br>GNU gettext automatically chooses the correct language file depending on the contents of the environment variable LANGUAGE. When it cannot find a translation, it simply returns the string that was passed to the gettext or dgettext function.<br><br>I use this library in many applications (even though Borland C++ builder supports ressource DLLs for translations but they don't work well when the GUI changes constantly) and it is very easy to use.<br><br>However, it might be fine to have a similar (not the same, because it doesn't fit into the current scripting language because it doesn't support function calls in arguments) mechanism in NSIS.<br><br>The advantages are - in short terms:<br>1. ease of use<br>2. it's easy to add new translations</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">30th May 2003 17:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This is the way it's working now. I don't see why this library can be of any use. You are talking about NSIS 2, right?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">31st May 2003 10:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think you are talking about NSIS 1.x. NSIS 2 (<a href="http://nsis.sf.net" target="_blank">http://nsis.sf.net</a>) has language files that can be translated and language strings that can be used in multilingual scripts.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">mjs</span><br><span class="post-time small text-muted">31st May 2003 18:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">In the documentation of NSIS2, I found the following section:<br><br>--- snip ---<br>LangString message ${LANG_ENGLISH} "English message"<br>LangString message ${LANG_FRENCH} "French message"<br>LangString message ${LANG_KOREAN} "Korean message"<br><br>MessageBox MB_OK $(message)<br>--- snip ---<br><br>which is just a shortcut for something similar to<br><br>--- snip ---<br>StrCmp $LANGUAGE ${LANG_ENGLISH} 0 +2<br>StrCpy $R0 "English message"<br>StrCmp $LANGUAGE ${LANG_FRENCH} 0 +2<br>StrCpy $R0 "French message"<br>StrCmp $LANGUAGE ${LANG_KOREAN} 0 +2<br>StrCpy $R0 "Korean message"<br><br>MessageBox MB_OK $R0<br>--- snip ---<br><br>What I meant was:<br><br>--- snip ---<br>MessageBox(MB_OK , gettext("English message"))<br>--- snip ---<br><br>where the "English message" will be used as a look-up key for the wanted translated message or - if none was found - the unchanged english message.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">31st May 2003 19:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It's not a shortcut for a big switch, it really does get the local language (unless the user chose another one or changed by the script), and according to it chooses the right language table and then uses an offset to get the real string. There are no huge switches here. The only difference I can see is that gettext have a default string.<br><br>Creating language files for your installer isn't really that hard. Have a look at the <a href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/miranda-icq/Tools/installer/" target="_blank">Miranda installer</a> for example.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">31st May 2003 19:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">OK, I think I see where you're getting at. The current translation method looks good enough for me. Optional external language files for the installer will not be added before NSIS 2 final.<br><br>And the Miranda installer shows you how to use external (non-optional or runtime) language files.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">mjs</span><br><span class="post-time small text-muted">1st June 2003 09:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hmmm ... maybe I am not able to express what I mean.<br><br>The current multilanguage support has several drawbacks:<br><br>1. What about different character sets (kanji, turkish, ...)? It doesn't look like you're using UTF8 in the NSIS sources.<br>2. You have to change the script file if you want to add another language.<br>3. The user has to use IDs in his scripts and this is IMHO not intuitive.<br>4. No automatic extraction of the texts that have to be translated.<br>5. No default text if the user forgot to translate a message.<br><br>As I previously wrote, it's much more comfortable to just write something like gettext("text to translate") instead of defining an ID and assigning a correct translation to this ID.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">1st June 2003 11:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">NSIS supports MBCS for languages with another character set (there are Chinese, Korean, Japanese etc. translations). It does not support Unicode because that is not supported on Windows 95/98/ME.<br><br>You can keep your translations separate from the script, just use header files for the translations.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">1st June 2003 15:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">With your method you have to change the script too, you have to add gettext, which doesn't really fit well into the current script language structure. I'd even say it breaks it.<br><br>With your method the user will have to create a file named or with a header containg the language name. The same goes for the current method, just include the name of the language (${LANG_ENGLISH}), or if you want you can define a value at the top of the included file and use a macro that automatically appends that language ID (Miranda and MUI for example).<br><br>The texts are automatically translated, all the user needs to know is the name of the language string.<br><br>Again, the only difference I see is the default string.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sealite</span><br><span class="post-time small text-muted">6th January 2006 12:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Interesting that I discorered this thread. Using gettext suite of tools it by far the best translation method I ever used. Now I'm forced to create import/export scripts for the conversion like nsi2po and po2nsi.<br><br>If someone wonders why is seams that it doesn't have real like experience with this kind of job and how can be managed well. Is't so easy to work with po files and there are a lot of editors - plus when the strings are added/modified/removed you don't have to deal with manual file sincronization.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>