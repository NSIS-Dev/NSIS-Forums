<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="nsDialogs, NSD_CreateBitmap, NSD_SetImage - JPEG support?"><title>nsDialogs, NSD_CreateBitmap, NSD_SetImage - JPEG support? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">nsDialogs, NSD_CreateBitmap, NSD_SetImage - JPEG support?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=302838">nsDialogs, NSD_CreateBitmap, NSD_SetImage - JPEG support?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Animaether</span><br><span class="post-time small text-muted">6th February 2009 10:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>nsDialogs, NSD_CreateBitmap, NSD_SetImage - JPEG support?</strong><br>Okay, I just ran into a bit of a stumbling block upgrading to the latest-and-greatest NSIS; using InstallOptionsEx has a drop-in no longer works when using MUI. I can work around it by using an older MUI header file, but I realize that eventually I'll have to move even this mammoth script over to nsDialogs.<br><br>However, that presents the next stumbling block.. I tried setting a JPG as a bitmap's image in the past and just again now and... I don't get any image. If I specify a BMP, things are fine.<br>What am I missing? Is there any way - no matter how contrived - to use a JPG directly for an nsDialogs bitmap control?<br><br>We're using JPEG files not just within the installer to cut down on size, but also for downloaded content.<br><br>I did think this was covered in the forums before, but I couldn't find anything among the noise in a search for the two rather common keywords.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">6th February 2009 14:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You could probably replace the LoadImage call in nsDialogs.nsh with a call to OleLoadPicturePath and then get the image handle from the interface this function returns.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Animaether</span><br><span class="post-time small text-muted">6th February 2009 15:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">hehe.. well the "you" part in there is putting a lot of (misplaced) confidence in me - but I'll have a peek through MSDN and the System docs :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Takhir</span><br><span class="post-time small text-muted">6th February 2009 16:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This may help <a href="http://nsis.sourceforge.net/Embedded_Banner" target="_blank">http://nsis.sourceforge.net/Embedded_Banner</a><br>You can also search for jpeg on NSIS main page <a href="http://nsis.sourceforge.net/Main_Page" target="_blank">http://nsis.sourceforge.net/Main_Page</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Animaether</span><br><span class="post-time small text-muted">6th February 2009 16:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">yeah, unfortunately the various banner/etc. plugins all have their sets of limitations.. e.g.<br>- not within a dialog<br>- fixed place within a dialog<br>- not clickable<br><br>All I really need is basically what kichik wrote... which I *think* I can figure out... except I'm stuck (at least) at...<br></p><pre>
<code>riid (in parameter) Reference to the identifier of the interface describing the type of interface pointer to return in ppvRet.</code>
</pre><br>...which I mostly see as using 'IID_IPicture' in examples - but where on earth that particular ID is coming from.. *puzzles*</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">6th February 2009 17:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">IID_IPicture is a guid, {7BF80980-BF32-101A-8BBB-00AA00300CAB} i think, so:<br><br>g "{7BF80980-BF32-101A-8BBB-00AA00300CAB}", and the pointer to the COM object param should look something like: *i .r0<br><br>Remember when working with COM objects, you need to figure out the correct offset in the vtable when calling methods on COM objects</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">6th February 2009 17:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">see <a href="http://source.winehq.org/source/include/stdole2.idl#L303" target="_blank">http://source.winehq.org/source/incl...dole2.idl#L303</a> ...and remember, 0,1 and 2 are IUnknown, so the first method in IPicture is 3 (The system.dll readme has example code for calling COM objects)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Animaether</span><br><span class="post-time small text-muted">6th February 2009 19:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">whhooooo... blimey. Nope, in way over my head - will give it another stab after the weekend :)<br>( getting an error 128 from the output of the 'e' option... of course finding the user-friendly message for code 128 is another circle of hell altogether )</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">6th February 2009 19:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">128=ERROR_WAIT_NO_CHILDREN and that makes no sense, maybe you should post some of your code</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">6th February 2009 19:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can use <a href="http://kernelmustard.com/2007/10/09/the-return-of-errexe/" target="_blank">err.exe</a> to get information on pretty much every error code in Windows.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">6th February 2009 19:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i><br><b>You can use <a href="http://kernelmustard.com/2007/10/09/the-return-of-errexe/" target="_blank">err.exe</a> to get information on pretty much every error code in Windows.</b></blockquote>except its 404</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Animaether</span><br><span class="post-time small text-muted">6th February 2009 19:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">got off the vpn, but if I recall correctly - and yes, I know it's utterly wrong... even if I'm remembering and piecing this together right...<br><br></p><pre>
<code><br>System::Call 'oleaut32::OleLoadPicturePath("path to bmp file", , , ,g "long guid thing", *i .r0) i.r1 ? e'<br></code>
</pre><br>
      <br>
      which I think means...<br>
      using the System plugin's Call routine,<br>
      make a call to from oleaut32.dll's OleLoadPicturePath procedure<br>
      with the arguments...<br>
      - path or URL to the file<br>
      - null<br>
      - null<br>
      - null<br>
      - the guid<br>
      - create a new 'pointer' which will hold the result, stick the pointer in $0<br>
      - stick the result of the call itself in $1<br>
      - get any error message, stick that on the stack<br>
      <br>
      ====<br>
      <br>
      As for that err.exe thing - sounds useful, so I googled...<br>
      <a href="http://www.microsoft.com/downloads/details.aspx?familyid=be596899-7bb8-4208-b7fc-09e02a13696c&amp;displaylang=en" target="_blank">http://www.microsoft.com/downloads/d...displaylang=en</a><br>
      <br>
      ( says Exchange but a MSDN blog noted that it'll do the Win32 errors as well )
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br>
      <span class="post-time small text-muted">6th February 2009 19:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">you need the types for every param, t for text (or w for wide strings) and i for DWORD/pointers</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br>
      <span class="post-time small text-muted">7th February 2009 08:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">cool, thanks - I'll review and try again monday :)<br>
      I guess that means I have to explicitly use 'n' for null (instead of just leaving the parameter blank) as well</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br>
      <span class="post-time small text-muted">7th February 2009 14:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">no, you can do "i,i,i" without specifying the actual value, or "i0,i0,i0" to show intent</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br>
      <span class="post-time small text-muted">7th February 2009 15:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">alright, just poking at this offline a bit more...<br>
      <br>
      I *think* I've got the picture interface bit working, then...<br></p>
      <pre>
<code><br>System::Call 'oleaut32::OleLoadPicturePath(w "&lt;path&gt;", i 0, i 0, i 0, g "{7BF80980-BF32-101A-8BBB-00AA00300CAB}", *i .r0) i .r1 ? e'<br></code>
</pre><br>
      It returns a pointer/reference/thing to the interface, the result is zero (which I think means 'ok') and no error code is returned (well, also zero).<br>
      <br>
      So now would come the time to get some data out of that interface. Instead of jumping straight into the deep that is the image handle, I figured I'd get the width of the bitmap first.<br>
      <br>
      However, I then of course get stuck again :)<br>
      <pre>
<code><br>System::Call '$0-&gt;6(i .r0) i .r1 ? e'<br></code>
</pre><br>
      6 = getWidth, as far as the VTable is concerned;<br>
      <a href="http://msdn.microsoft.com/en-us/library/ms680761" target="_blank">http://msdn.microsoft.com/en-us/library/ms680761</a>(VS.85).aspx<br>
      At first I thought I was supposed to just call it as '-&gt;6()' and thus have the result in $1 . That crashes, though. However, specifying an out variable (i.r3) as a parameter doesn't do much either;<br>
      <pre>
<code><br>System::Call '$0-&gt;6(i .r3) i .r1 ? e' ; 6 = getWidth<br>Pop $2<br>; [$3][$1][$2] = [0][-2147467261][80]<br></code>
</pre><br>
      Of course, that error code ($2 - 80) doesn't make sense.. again. But I might be reading err.exe's output wrong.<br>
      <br>
      Anyway, I tried ::Get as well, but that got me an error DMLERRsomethingorother ..<br>
      <br>
      I'll poke at it some more later -_-
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br>
      <span class="post-time small text-muted">7th February 2009 15:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">the argument is a pointer to a OLE_XSIZE_HIMETRIC (whatever that is, lets hope its 4 bytes) so:<br>
      <br>
      System::Call '$0-&gt;6(*i.r3)i.r1'<br>
      <br>
      also, you can't use ?e with COM, you must check the return value, 0 = ok (in most cases, could be 1 (S_FALSE) also, negative numbers are errors, when you see them in the output from err.exe, they are the codes starting with S_ or E_ )</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br>
      <span class="post-time small text-muted">7th February 2009 15:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>
      <pre>
<code>Function pre<br>nsDialogs::Create 1018<br>Pop $0<br>${NSD_CreateBitmap} 0 0 100% 100% ""<br>pop $9<br><br>!define IID_IPicture {7BF80980-BF32-101A-8BBB-00AA00300CAB}<br>!define ImagePath "$PICTURES\BuddyJesus.jpg"<br>var /GLOBAL pIPicture1 ;lets save it in a var so some other code does not overwrite it (I'm assuming you have a complicated page with lots of code)<br>System::Call 'oleaut32::OleLoadPicturePath(w "${ImagePath}", i 0, i 0, i 0, g "${IID_IPicture}", *i .r0)i.r1'<br>${If} $1 == 0<br>        StrCpy $pIPicture1 $0 ;save pointer for later, we can't release it now because the image handle needs to stay valid<br>        System::Call "$0-&gt;3(*i.r0)i.r1" ;IPicture-&gt;get_Handle<br>        ;might want to check $1 here before setting image<br>        SendMessage $9 ${STM_SETIMAGE} ${IMAGE_BITMAP} $0<br>${EndIf}<br><br>nsDialogs::Show<br>${IfThen} $pIPicture1 &lt;&gt; 0 ${|} System::Call "$pIPicture1-&gt;2()"  ${|} ;Release<br><br>FunctionEnd<br><br>page custom pre<br></code>
</pre><br>
      <br>
      if you need to resize the actual image control to fit the image, you need to call width and height and convert from himetric to pixels, I'm sure google can help out
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br>
      <span class="post-time small text-muted">8th February 2009 11:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks!<br>
      <br>
      Nope - don't think I would've gotten that far on monday - maybe on wednesday. I did get to the 'oh, dur, it's not a number' point *pats self on back*. I'll be going through your changes and try to grok it.. gotta get a handle on the belly of this (powerful) beast.<br>
      <br>
      Thanks again!</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br>
      <span class="post-time small text-muted">9th February 2009 10:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Alright - spent some time sunday to turn it into a header file, it's in the wiki (along with a new nsDialogs category), stuck it in the production script and voila... works beautifully - thanks again!</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">10th February 2009 20:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for creating the nsDialogs category. It was really long due. All those other examples are really useful too.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br>
      <span class="post-time small text-muted">14th February 2009 00:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by kichik</i><br>
        <b>Thanks for creating the nsDialogs category. It was really long due. All those other examples are really useful too.</b>
      </blockquote>No problem - we've been using NSIS for our installer for several years now and I like to contribute back wherever I can.<br>
      <br>
      I just added a new page with some more minor snippets and created a some topics for a few other bits, that I hope will be helpful to other (budding) nsDialogs users;<br>
      <a href="http://nsis.sourceforge.net/NsDialogs_FAQ" target="_blank">http://nsis.sourceforge.net/NsDialogs_FAQ</a><br>
      <br>
      I don't know for sure these are FAQ items per se, but they were things that I ran into or simply wondered about while moving over to nsDialogs.<br>
      <br>
      Have to move on to some file-finding bits and pieces now, though, but part of that will involve nsDialogs again - will post the result of that as well.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">zirnevis</span><br>
      <span class="post-time small text-muted">11th July 2010 07:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Animaether</small><br>
        got off the vpn, but if I recall correctly - and yes, I know it's utterly wrong... even if I'm remembering and piecing this together right...<br>
        <br>
        <pre>
<code><br>System::Call 'oleaut32::OleLoadPicturePath("path to bmp file", , , ,g "long guid thing", *i .r0) i.r1 ? e'<br></code>
</pre><br>
        <br>
        which I think means...<br>
        using the System plugin's Call routine,<br>
        make a call to from oleaut32.dll's OleLoadPicturePath procedure<br>
        with the arguments...<br>
        - path or URL to the file<br>
        - null<br>
        - null<br>
        - null<br>
        - the guid<br>
        - create a new 'pointer' which will hold the result, stick the pointer in $0<br>
        - stick the result of the call itself in $1<br>
        - get any error message, stick that on the stack<br>
        <br>
        ====<br>
        <hr>
      </blockquote>
    </div>
    <hr>
    Thanks a lot for the nice piece of code, it helped me a lot<br>
    <br>
    however I was wondering how do I add border to the image?<br>
    <br>
    Regards<br>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br>
      <span class="post-time small text-muted">11th July 2010 12:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Quote:</p>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
        <span class="post-time small text-muted">11th July 2010 16:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">You could also just add SS_BLACKFRAME, SS_WHITEFRAME or SS_GRAYFRAME to the style.<br>
        <br>
        Stu</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Wizou</span><br>
        <span class="post-time small text-muted">11th July 2010 18:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"></p>

        <blockquote>
          <small>Originally posted by Afrow UK</small><br>
          You could also just add SS_BLACKFRAME, SS_WHITEFRAME or SS_GRAYFRAME to the style.
        </blockquote>No, I think these will replace the content of the static/ control with a simple (filled) rectangle.<br>
        <br>
        You should rather add the WS_BORDER style
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">baby123</span><br>
        <span class="post-time small text-muted">6th January 2013 14:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Here is the solution published special for this THREAD.<br>
        <br>
        <a href="http://nsis.sourceforge.net/NsDialogs_SetImageOLE" target="_blank">http://nsis.sourceforge.net/NsDialogs_SetImageOLE</a></p>
      </div>
      <hr>

      <div class="footer">
        <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
      </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
      hljs.initHighlightingOnLoad();
      //]]>
      </script>

      <table cellpadding="6" cellspacing="0" border="0" width="100%">
        <tr>
          <td class="alt2">
            <hr>
            Originally Posted by <strong>zirnevis</strong> (Post 2679252) however I was wondering how do I add border to the image? Using an image editor such as Paint?</td></tr></table></div></div></body></html>