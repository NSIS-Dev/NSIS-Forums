<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Pre-populate an INI" />

  <title>Pre-populate an INI - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Pre-populate an INI</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=255004">Pre-populate an INI</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">GarBear</span><br />
      <span class="post-time small text-muted">7th September 2006 00:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Pre-populate an INI</strong><br />
      Description:<br />
      Using a custom page - i.e. somepage.ini - with a text box that is pre-populate with information from an INI or registry key string var. I have not yet found an example of how to do this.<br />
      <br />
      Eventually it would be nice to populate the Field with an array of strings. If someone has an example of this it would be usefull.<br />
      <br />
      What I am looking for is an example of a function that will push the text string var into a custom page during the install - i.e. post compile time.<br />
      <br />
      Expectation:<br />
      I would expect that the user will not need to type in the required data.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dandaman32</span><br />
      <span class="post-time small text-muted">7th September 2006 07:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Use ReadINIStr to get the values you need, then use the macro MUI_INSTALLOPTIONS_WRITE to write in the values.<br />
      <br />
      Very offtopic: how many people do you guys know that hang out in this forum that would actually click <a href="http://twx.2mdn.net/viewad/1252729/ParentsC_728x90_disc_b_EXT_fries3.gif" target="_blank">this ad</a>? lol<br />
      <br />
      -dandaman32</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">GarBear</span><br />
      <span class="post-time small text-muted">8th September 2006 19:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Dan;<br />
      <br />
      I ended up doing just that. I created a var and associated it with the registry key. I have provided a copy of my source code to show anyone who sees this later how to do the same thing. I am using XPUI (Experience UI) but you can use MUI or any other one that supports the write function.<br />
      <br />
      ;Create an .onInit function that checks to see if populated and if not interjects CompanyData as the default ODBC instance.<br />
      <br />
      <br />
      Function .onInit<br />
      ReadRegStr $TSWODBCData HKEY_LOCAL_MACHINE "Software\Company\General" "ODBCConnection"<br />
      ReadRegStr $CommonDesktop HKEY_LOCAL_MACHINE "SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders" "Common Desktop"<br />
      StrCmp $CompanyODBCData "" NoODBC ODBCExists<br />
      NoODBC:<br />
      StrCpy $CompanyODBCData "CompanyData"<br />
      ODBCExists:<br />
      FunctionEnd<br />
      <br />
      <br />
      ; Add a new custom page below "!insertmacro XPUI_PAGE_COMPONENTS"<br />
      <br />
      <br />
      Page custom "ODBC_Connection" "GatherODBC"<br />
      <br />
      ; Add a function to extract, then populate(write) my custom field from the var above and then display the CompanyDataODBC.ini file.<br />
      <br />
      <br />
      Function ODBC_Connection<br />
      <br />
      !insertmacro XPUI_INSTALLOPTIONS_EXTRACT "CompanyDataODBC.ini"<br />
      !insertmacro XPUI_INSTALLOPTIONS_WRITE "CompanyDataODBC.ini" "Field 3" "State" "$CompanyODBCData"<br />
      !insertmacro XPUI_INSTALLOPTIONS_DISPLAY "CompanyDataODBC.ini"<br />
      <br />
      FunctionEnd<br />
      <br />
      ; Finally I capture the input with another function and update the registry key for future use.<br />
      <br />
      <br />
      Function GatherODBC<br />
      !insertmacro XPUI_INSTALLOPTIONS_READ $0 "CompanyDataODBC.ini" "Field 3" "State"<br />
      StrCpy $ODBCName "$0"<br />
      WriteRegStr HKEY_LOCAL_MACHINE "Software\Company\General" "ODBCConnection" "$ODBCName"<br />
      FunctionEnd<br />
      <br />
      ; OH and here is a copy of the CompanyDataODBC.ini file.<br />
      <br />
      <br />
      [Settings]<br />
      NumFields=3<br />
      <br />
      [Field 1]<br />
      Type=Label<br />
      Text=This is the ODBC Name used locally on this computer. It links directly to the Database on the Microsoft SQL Server. If you have not already created an ODBC connection, please do so before continuing the installation.<br />
      Left=27<br />
      Right=231<br />
      Top=22<br />
      Bottom=57<br />
      <br />
      [Field 2]<br />
      Type=Label<br />
      Text=Open Database Connectivity (ODBC) Name:<br />
      Left=9<br />
      Right=157<br />
      Top=6<br />
      Bottom=14<br />
      <br />
      [Field 3]<br />
      Type=Text<br />
      State=TSWData<br />
      Left=43<br />
      Right=167<br />
      Top=68<br />
      Bottom=81</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
