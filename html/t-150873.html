<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Create Service"><title>Create Service - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Create Service</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=150873">Create Service</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">29th September 2003 20:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Create Service</strong><br>Is it possible to create a service with Sunjammers Service Plugin?<br><br>Maybe:<br><br>Services::SendServiceCommand 'create' 'myServiceName'</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">29th September 2003 20:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">dselkirk's service library can create services. Find it in the following link:<br><br><a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=345" target="_blank">http://nsis.sourceforge.net/archive/...php?pageid=345</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">29th September 2003 22:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Great! For this guy, I just place it in the NSIS\Include folder and do a "!include servicelib.nsh" prior to using it? Sorry, another newbie question...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">29th September 2003 23:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">OK, yep, that worked. Now having trouble using multiple parameters. In the comments, it looks like the parameters should be separated by semicolons, but that would comment out those parameters. Any help?<br><br>Thanks</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">29th September 2003 23:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Guess I'm having a conversation with myself. It doesn't seem to be multiple paramaters. I'm trying to tell it to run by a domain account using:<br><br>!insertmacro SERVICE "create" "myService" \<br>"path=D:\pathToExe\Service.exe;autostart=0; \<br>user=DOMAIN\user;password=userPassword"<br><br>Changing autostart on and off works; thus multiple params works. However, I can't get it to create the service with a domain account. Is there a trick?<br><br>Thanks,</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">29th September 2003 23:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">; doesn't start a comment if within quotes. dselkirk would have to answer the domain question.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dselkirk</span><br><span class="post-time small text-muted">30th September 2003 14:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'm looking at the problem right now. I'll release it with version 1.2 which I'm hoping will be done today or tomorrow. It will have some extra features as well.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">30th September 2003 15:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks dselkirk, you're OK!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dselkirk</span><br><span class="post-time small text-muted">1st October 2003 18:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Please excuse the delay, I haven't had as much time as I wanted on updating the servicelib. I've attached the new version, it still needs to be tested but it gives you something to try.<br><br>New in version 1.2<br>- fixed domain name (from what info I found) use: domain\user<br>- add desc paramater<br>- changed autostart to type with more options<br>- added dispplay for settings the service displayname<br>- added log for setting the eventlog<br>- added quick macro for the service macro<br><br>Let me know if you find any problems. I'll do my best to try and finish it up.<br><br>Don</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">1st October 2003 20:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I got an error with the new servicelib.nsh:<br><br>"Install corrupted: invalid opcode"<br><br>Any clue dselkirk?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">1st October 2003 21:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That's probably a wrong relative jump.<br><br>There are also some relative jumps used to jump over plug-in calls, which will result in unexpected behavior, because plug-in calls are being converted by the compiler (see documentation for details).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">1st October 2003 21:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I don't have any relative jumps in my script, and the only places where dselkirk possibly (is System:: a plug-in?) breaks the rules in the doc is:<br><br>IntCmp $5 0 +2<br>System::Call 'advapi32::CloseServiceHandle(i r5) n'<br>IntCmp $4 0 +2<br>System::Call 'advapi32::CloseServiceHandle(i r4) n'<br>Pop $4<br><br>But I changed the relative jumps to labels and still got the error.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">1st October 2003 21:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">There is probably somewhere else a wrong jump. Please check where you get this error.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">1st October 2003 22:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I stuck a bunch of debug statements in there (message boxes) and the last command it executes is:<br><br>!macro CALL_GETPARAM VAR NAME DEFAULT LABEL<br>Push $1<br>Push ${NAME}<br>Call ${UN}GETPARAM<br>Pop $6<br>StrCpy ${VAR} "${DEFAULT}"<br><br>&lt;!--this one below--&gt;<br>StrCmp $6 "" "${LABEL}" 0<br>&lt;!--this one above--&gt;<br><br>StrCpy ${VAR} $6<br>!macroend<br><br>Unfortunately, I don't have much of a grip on this scripting language yet. Sorry I can't be of more help.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">1st October 2003 22:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">No, that was wrong. I stuck a TON more debug statements in there (is there a better way to debug than with message boxes?) and found the actual last line to compile as follows:<br><br>lbl_good:<br>StrCpy $0 "true"<br>lbl_done:<br>IntCmp $5 0 +2<br>System::Call 'advapi32::CloseServiceHandle(i r5) n'<br>IntCmp $4 0 +2<br>System::Call 'advapi32::CloseServiceHandle(i r4) n'<br>Pop $4<br>Pop $3<br>Pop $2<br>Pop $1<br>&lt;!--Right after here--&gt;<br>Exch 3<br>&lt;!--Right before here--&gt;<br>Pop $5<br>Pop $6<br>Pop $7<br>Exch $0<br>!macroend<br><br>So by the doc, it looks like this means the stack is too low to perform this command???</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">1st October 2003 23:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I don't know if my debugging is valid here:<br><br>lbl_good:<br>StrCpy $0 "true"<br>lbl_done:<br>IntCmp $5 0 mylabel1<br>MessageBox MB_OK "using first system call"<br>System::Call 'advapi32::CloseServiceHandle(i r5) n'<br>mylabel1:<br>IntCmp $4 0 mylabel2<br>MessageBox MB_OK "using second system call"<br>System::Call 'advapi32::CloseServiceHandle(i r4) n'<br>mylabel2:<br>Pop $4<br>MessageBox MB_OK "$4"<br>Pop $3<br>MessageBox MB_OK "$3"<br>Pop $2<br>MessageBox MB_OK "$2"<br>Pop $1<br>MessageBox MB_OK "$1"<br><br>Exch 3<br><br>Pop $5<br>Pop $6<br>Pop $7<br>Exch $0<br>!macroend<br><br>but if so, the problem is that the system call doesn't put anything on the stack for this guy. It went into the second system call and each Pop put nothing into $?.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">deguix</span><br><span class="post-time small text-muted">2nd October 2003 01:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hmmmm.... This code is not wrong to give that error.... Attach the WHOLE script used to compile the program.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">fraefel</span><br><span class="post-time small text-muted">2nd October 2003 06:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by stonkers</i><br><b>No, that was wrong. I stuck a TON more debug statements in there (is there a better way to debug than with message boxes?) and found the actual last line to compile as follows:<br></b></blockquote>Have a look at <a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=140" target="_blank">DumpState on NSIS Archive</a> :up:</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">2nd October 2003 14:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I have the servicelib.nsh file in the includes folder. Running the beta version of NSIS. Here's the script. Pretty straight-forward:<br><br>;----------------------------------<br><br>;NSIS Script For Doc<br><br>;Included file(s)<br><br>!include servicelib.nsh<br><br>;Backgound Colors<br>BGGradient 800080 000000 FFFFFF<br>BrandingText " "<br><br>;Title Of Your Application<br>Name "MyApp"<br><br>;Do A CRC Check<br>CRCCheck On<br><br>;Output File Name<br>OutFile "CreateService.exe"<br><br>;The Default Installation Directory<br>InstallDir "$PROGRAMFILES\MyApp"<br><br>;The text to prompt the user to enter a directory<br>DirText "Stick it in here"<br><br>Section 1<br><br>!insertmacro SERVICE "create" "MyService" \<br>"path=$INSTDIR\MyApp\bin\Service.exe;user=DOMAIN\MyUser;password=psswd"<br><br>SectionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">2nd October 2003 14:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Exch can cause Invalid Op errors too if not used properly. According to your test it is Exch that causes it and that indicates something is wrong with the stack operations in the macros.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dselkirk</span><br><span class="post-time small text-muted">2nd October 2003 15:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Found the problem. You forgot an extra ";" at the end of your parameter list. It should look like this:<br><br>!insertmacro SERVICE "create" "MyService" \<br>"path=$INSTDIR\MyApp\bin\Service.exe;user=DOMAIN\MyUser;password=psswd;"</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dselkirk</span><br><span class="post-time small text-muted">2nd October 2003 15:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">sorry, thats not it.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">2nd October 2003 15:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I've got dumpstate fired up now, I'll be able to give you more info. I'll put that ";" in there also.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dselkirk</span><br><span class="post-time small text-muted">2nd October 2003 15:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Found the problem. Quick fix. In the library, goto "lbl_create:". There are serveral Push statements. After "Push $R8 ;desc", add "Push $R9 ;log". Let me know</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">2nd October 2003 15:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">So here's the code that's being executed:<br><br>System::Call 'advapi32::CloseServiceHandle(i r4) n'<br>Dumpstate::debug ;1<br>Pop $4<br>Dumpstate::debug ;2<br>Pop $3<br>Dumpstate::debug ;3<br>Pop $2<br>Dumpstate::debug ;4<br>Pop $1<br>Dumpstate::debug ;5<br>Exch 3<br><br>At each of the dumpstate commands:<br><br>1) $0 = true<br>$1 = the path to my executable<br>$2 = my app name<br>$3 = create<br>$4 = 1315648<br>$5 = empty<br>$6 = 1322456<br>$7-&gt; empty<br>2) $0 = true<br>$1 = the path to my executable<br>$2 = my app name<br>$3 = create<br>$4 = empty<br>$5 = empty<br>$6 = 1322456<br>$7-&gt; empty<br>3) $0 = true<br>$1 = the path to my executable<br>$2 = my app name<br>$3 = empty<br>$4 = empty<br>$5 = empty<br>$6 = 1322456<br>$7-&gt; empty<br>4) $0 = true<br>$1 = the path to my executable<br>$2 = empty<br>$3 = empty<br>$4 = empty<br>$5 = empty<br>$6 = 1322456<br>$7-&gt; empty<br>5) $0 = true<br>$1 = empty<br>$2 = empty<br>$3 = empty<br>$4 = empty<br>$5 = empty<br>$6 = 1322456<br>$7-&gt; empty<br><br>Install corrupted: invalid opcode<br><br>How can I see the stack? It's obviously empty. What should be there?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dselkirk</span><br><span class="post-time small text-muted">2nd October 2003 15:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Try the fix I posted. As for the stack, at that point of the library its cleaning up my variables. The only things in the stack would be values set in those variables before running the service command.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">2nd October 2003 15:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, I don't get the error anymore! But:<br><br>;----------------------------------<br><br>;NSIS Script For Doc<br><br>;Included file(s)<br><br>!include servicelib.nsh<br><br>;Backgound Colors<br>BGGradient 800080 000000 FFFFFF<br>BrandingText " "<br><br>;Title Of Your Application<br>Name "MyApp"<br><br>;Do A CRC Check<br>CRCCheck On<br><br>;Output File Name<br>OutFile "CreateService.exe"<br><br>;The Default Installation Directory<br>InstallDir "$PROGRAMFILES\MyApp"<br><br>;The text to prompt the user to enter a directory<br>DirText "Stick it in here"<br><br>Section 1<br><br>!insertmacro SERVICE "create" "MyService" \<br>"path=$INSTDIR\MyApp\bin\Service.exe;user=DOMAIN\MyUser;password=psswd;type=3;"<br><br>SectionEnd<br><br>;---------------------<br><br>gives me a service run by localhost that is of type "manual startup".</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">2nd October 2003 23:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I've monkeyed around a bit more, and it looks like there is a misprint in the comments. type=2 creates automatic startup and 3 manual. I can't figure out for the life of me how to make it run by domain user though.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">2nd October 2003 23:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, I have a theory. The user tag is being used to create the service but not determine who to run it by. If I use my userID without the domain name (because I'm not a true user without the domain), the service will be created in "disabled" state.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jeff_hanna</span><br><span class="post-time small text-muted">5th August 2005 15:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I realize this reply is almost 2 years after the last post in the thread. But, I'm having the exact same problem. Was a solution to starting a network service with a user/password ever found?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">vitoco</span><br><span class="post-time small text-muted">11th July 2006 20:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Did someone try the <a href="http://forums.winamp.com/showthread.php?threadid=204726" target="_blank">patch</a> for <a href="http://nsis.sourceforge.net/NSIS_Service_Lib" target="_blank">ServiceLib</a>? I think it might solve the network user problem.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">5of0</span><br><span class="post-time small text-muted">23rd December 2006 04:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">For future reference and those looking for solution to opcode errors:<br>The above problem was most likely caused by the Exch, because if Exch is called when the stack is empty, it throws an opcode error. See this thread:<br><a href="http://forums.winamp.com/showthread.php?postid=1836225" target="_blank">http://forums.winamp.com/showthread.php?postid=1836225</a><br>For more info.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MidnightJava</span><br><span class="post-time small text-muted">17th February 2007 00:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'd like to follow some of the links in this thread, but foir all except the first one, the hyperlink code is replaced with non-hyperlink text that says "url submitted by user". I looked at the page source and the the target url is simply not there.<br><br>ANyone know what's going on and how I Can follow some of the links in this discussion?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">17th February 2007 01:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This is to prevent spam, not sure why it blocked these old urls<br><br>Press the quote button on the post that has the url you want(Atleast this works for me, if not, i posted the source @ <a href="http://rafb.net/p/HVycee19.txt" target="_blank">http://rafb.net/p/HVycee19.txt</a> (thread reversed))</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>