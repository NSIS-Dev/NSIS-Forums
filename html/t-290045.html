<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="search users for folder and delete it"><title>search users for folder and delete it - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">search users for folder and delete it</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=290045">search users for folder and delete it</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Dogfundays</span><br><span class="post-time small text-muted">11th April 2008 16:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>search users for folder and delete it</strong><br>Hi, I have a folder that may be under any user in c:\Documents and Settings. I am looking for a way that searches for this folder and then deletes it.<br><br>I have searched the web and found oneway that you need VB but I can't use VB here. Any ideas?<br><br>Thanks for your time,</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Daniel James</span><br><span class="post-time small text-muted">11th April 2008 17:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Re: search users for folder and delete it</strong><br></p><blockquote><i>Originally posted by Dogfundays</i><br>Hi, I have a folder that may be under any user in c:\Documents and Settings. I am looking for a way that searches for this folder and then deletes it.</blockquote>Have you looked at the <b>Locate</b> function in FileFuncs.nsh? You can use that to search for the directory, and then delete it with RmDir in the callback.<br><br>There's also a 'Locate' plug-in, which you may or may not prefer.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Dogfundays</span><br><span class="post-time small text-muted">11th April 2008 18:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks I'm looking into it now.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">11th April 2008 19:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Might be easier to use EnumRegKey to look at users in HKLM\Software\Microsoft\Windows NT\CurrentVersion\ProfileList<br><br>Also, I would not hard code C:\Documents and Settings as it may be different. Read from HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList ProfilesDirectory to get the path set for the machine.<br><br>Use ExpandEnvStrings on results.<br><br>You could also get the Documents and Settings path and locate the directories using FindFirst, FindNext, FindClose (IMO using Locate is a little bit much if you just want to locate a sub-directory under these folders).<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Daniel James</span><br><span class="post-time small text-muted">13th April 2008 18:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Afrow UK</i><br>Might be easier to use EnumRegKey to look at users in HKLM\Software\Microsoft\Windows NT\CurrentVersion\ProfileList</blockquote>You're right :o I misread the question (as "a folder that may be under any <i>folder</i> in c:\Documents and Settings").<br><br><blockquote>Also, I would not hard code C:\Documents and Settings as it may be different. Read from HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList ProfilesDirectory to get the path set for the machine.</blockquote>Yes. $PROFILE will get the right directory name for the machine, but your way is still probably easier.<br><br><blockquote>You could also get the Documents and Settings path and locate the directories using FindFirst, FindNext, FindClose (IMO using Locate is a little bit much if you just want to locate a sub-directory under these folders).</blockquote>I'm not so sure about that ... You need to find each user's home directory and then look inside it for the named directory that you want to delete. Locate does it in one hit, but requires a callback. Not much to choose between them, I'd say (though using the registry is easier).<br><br>Locate is certainly the easiest way if you're looking for a directory with a given name that you know is at some arbitrary location in the tree but you don't know where or at what depth (which is how I misread the question).</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Dogfundays</span><br><span class="post-time small text-muted">14th April 2008 14:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This is the path that we are trying to locate.<br><br>C:\Documents and Settings\%Users%\Dir<br><br>Once we find the directory we would like to delete it the problem is the searching for the directory I have tried locate but I do not have a good handle on it.<br>One problem is I'm new to NISI and the learning curve is getting in the way.<br><br>Thanks for the help,</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Dogfundays</span><br><span class="post-time small text-muted">14th April 2008 19:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Here is what I have so far. The problem is that it will not find the directory but will find everything inside the dir that has an extension (${Locate} "C:\" "D=1 /L=F /M=AutoShutdown.* /S=1K") The AutoShutdown I have tried with and with out the .*<br><br>Does anyone see the problem?<br><br>Name "Output"<br>OutFile "Output.exe"<br><br>!include "FileFunc.nsh"<br>!insertmacro Locate<br><br>Section<br>${Locate} "C:\" "D=1 /L=F /M=AutoShutdown.* /S=1K" "remove"<br><br><br>IfErrors 0 +2<br>MessageBox MB_OK "Error" IDOK +2<br>MessageBox MB_OK "$$R0=$R0"<br>SectionEnd<br><br>Function remove<br># $R9="C:\Documents and Settings\%Users%\AutoShutdown"<br># $R8="C:\"<br># $R7="c:\AutoShutdown"<br># $R6="5"<br>StrCpy $R0 $R9<br><br>Delete '$R0$\n$\nFind next' +2<br>;MessageBox MB_YESNO '$R0$\n$\nFind next?' IDYES +2<br>StrCpy $0 StopLocate<br><br>Push $0<br>FunctionEnd</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>