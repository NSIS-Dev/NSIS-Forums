<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="CopyFiles problem with Windows 2008 Server" />

  <title>CopyFiles problem with Windows 2008 Server - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">CopyFiles problem with Windows 2008 Server</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=316896">CopyFiles problem with Windows 2008 Server</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsvargas</span><br />
      <span class="post-time small text-muted">8th February 2010 20:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>CopyFiles problem with Windows 2008 Server</strong><br />
      &nbsp; I have a script that worked fine for Windows 2000 and Windows XP and 2003 Server, I haven't tested it on vista, but on 2008 Server the CopyFiles command is always failing.<br />
      <br />
      this is my script:<br /></p>
      <pre>
<code>  ClearErrors
<br />  CopyFiles "$INSTDIR\\Server\\myLib.dll" "$INSTDIR\\Server\\myLib-w.dll"
<br /> IfErrors 0 +2
<br />    Abort "Error copying Server Library" 
</code>
</pre>And it always fall in the IfErrors clause<br />
      <br />
      <br />
      Any ideas on what to do?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">8th February 2010 21:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Check if the file even exists in the first place. And check if you have sufficient access privileges to write to that subdir. The directory might also need to exist before you start copying.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsvargas</span><br />
      <span class="post-time small text-muted">9th February 2010 00:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The directory exists, and i'm running the installer as administrator (the original file was created with another installer which as run as the administrator as well), if I run these commands:<br />
      <br /></p>
      <pre>
<code>  Rename    "$INSTDIR\Server\myLib.pdb" "$INSTDIR\Server\myLib-w.pdb"
<br /> IfErrors 0 +2
<br />    Abort "Error copying DLL's PDB"
<br />  ClearErrors
<br />  File "files\myLib-wrapper.dll" "$INSTDIR\Server\myLib.dll"
<br /> IfErrors 0 +2
<br />    Abort "Error installing wrapper" 
</code>
</pre>then it runs OK...
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">9th February 2010 08:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm noticing a distinct lack of backslashes in that code... o__O</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsvargas</span><br />
      <span class="post-time small text-muted">9th February 2010 10:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The first one i've reviewed and scaped the backslashes, this one I didn't notice before it was too late (I can't edit it anymore). But the backslashes are there...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">9th February 2010 16:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You possibly have the installer set to not overwrite existing files?<br />
      <a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.2.8" target="_blank">http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.2.8</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsvargas</span><br />
      <span class="post-time small text-muted">9th February 2010 16:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The destination file does not exist (but the origin file exists, as well as the destination folder)<br />
      <br />
      Anyway, the overwrite was set with<br />
      <br /></p>
      <pre>
<code>  SetOverwrite try 
</code>
</pre>in a previous (not optional) section.<br />
      <br />
      Is there any register with the error cause? Or any other ideas?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">9th February 2010 22:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Eh? If the file doesn't already exist, why does renaming the existing file have any influence?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsvargas</span><br />
      <span class="post-time small text-muted">10th February 2010 00:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It doesn't, I just said that renaming works to demonstrate that I have permissions on the folder.<br />
      <br />
      I'm curious to know why it worked fine on XP, 2K and 2003 Server and doesn't work on 2008 Server...<br />
      <br />
      CopyFiles uses a superseeded Windows API, but I don't think that's the reason...<br />
      <br />
      When it fails it just log that's failed, it doesn't log why...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">10th February 2010 08:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I suppose you could dive into the code, see which API call is made for CopyFiles, and then call it yourself using the system plugin. You might just be able to get a more detailed returncode from that.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>