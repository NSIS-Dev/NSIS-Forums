<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="using CDrom plugin for DVD"><title>using CDrom plugin for DVD - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">using CDrom plugin for DVD</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=289027">using CDrom plugin for DVD</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">ChrisMorton75</span><br><span class="post-time small text-muted">25th March 2008 14:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>using CDrom plugin for DVD</strong><br>I have an external dvd rom reader/burner which I can use to burn an installer to span unzipping files across two DVD's. I get the "ready" status when I put in the 2nd DVD and it works. In QA, the status never changes from 0. Should the CDrom module be able to get the DVD status the way it gets CD status ?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">25th March 2008 19:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">What is this plug-in? I have never heard of it. The only CD-ROM plug-in I know ejects the tray.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ChrisMorton75</span><br><span class="post-time small text-muted">25th March 2008 19:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">CDRom-plugin gets the CD reader's status. It does more than just eject the tray.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">25th March 2008 19:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The API is the same so it should work. Try looking into its source code for the key API it uses and search the web to see if someone else hit your problem with DVDs as well.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">25th March 2008 20:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Same problem here - the CD-ROM plugin does not work with DVDs.<br>I just wrote my own set of functions to replace it.<br><br></p><pre>
<code><br>;check if drive type is CD/DVD drive. Push parameter X:\ to stack<br>; before calling, pop return value after. (note: should probably<br>; be GetDriveType, not GetDriveTypeA. I can't remember why I use<br>; the ansi version here.)<br>Function DVD_CheckDrive<br>  Exch $R0<br>  System::Call 'kernel32::GetDriveTypeA(t "$R0") i .r10'<br>  StrCmp $R0 5 0 +2<br>  StrCpy $R0 "CDROM"<br>  Exch $R0<br>FunctionEnd<br><br>;get the label of the disc in the drive X:\ (on stack, returns to stack)<br>Function DVD_GetLabel<br>  Exch $R0<br>  Push $R1<br>  Push $R2<br><br>  ;may need some code here to check if any paremeter was passed at all<br><br>  ;get the label of the drive (return to $R1)<br>  #System::Call 'kernel32::SetErrorMode(i 0) i .r11'<br>  System::Call 'Kernel32::GetVolumeInformation(t r10,t.r11,i ${NSIS_MAX_STRLEN},*i,*i,*i,t.r12,i ${NSIS_MAX_STRLEN})i.r10'<br>  StrCmp $R0 0 0 +3<br>    StrCpy $R0 "DVDGetLabel_error"<br>    goto +2<br>  StrCpy $R0 $R1<br>  #System::Call 'kernel32::SetErrorMode(i 1) i .r11'<br>  break:<br><br>  Pop $R2<br>  Pop $R1<br>  Exch $R0<br>FunctionEnd<br><br>;A replacement for the enumerate command of the CD-ROM plugin.<br>; Call with an emtpy string on stack to find the first CD/DVD-rom<br>; drive. Call with a parameter X:\ on stack to find the first<br>; drive after X:\ (alphabetical order). Returns found drive to stack.<br>Function DVD_GetNextDrive<br>  Exch $R1<br>  Push $R0<br>  Push $R2<br>  Push $R3<br>  Push $R4<br><br>  StrCpy $R4 $R1<br>  <br>  ;get all drives (return to $R0, bitwise)<br>  System::Call 'kernel32::GetLogicalDrives() i .r10'<br>  StrCmp $R0 "0" 0 +3   ;if no drives found, error<br>    StrCpy $R1 ""<br>    goto break<br><br>  ;If no parameter was supplied at all, assume we're starting at A:\.<br>  StrCmp $R4 "" 0 +2<br>    StrCpy $R4 "A"<br>  <br>  ;get ascii-number of first char in function parameter<br>  System::Call "*(&amp;t1 r14)i.r12"<br>  System::Call "*$R2(&amp;i1 .r14)"<br>  System::Free $R2<br>  IntOp $R4 $R4 - 65<br><br>  ;check if parameter driveletter is between A and Z<br>  IntCmp $R4 0 0 +2<br>  IntCmp $R4 25 +3 +3<br>    StrCpy $R1 ""<br>    goto break<br>  <br>  ;If a valid parameter was supplied (ie we survived so far),<br>  ; skip the supplied driveletter before beginning scan<br>  StrCmp $R1 "" +2<br>    IntOp $R4 $R4 + 1<br><br>  ;backup the (asciiconverted) starting driveletter, for detecting<br>  ; when we've cycled the entire alphabet<br>  StrCpy $R1 $R4<br><br>  loop:<br>    IntOp $R2 0x01 &lt;&lt; $R1<br>    IntOp $R3 $R2 &amp; $R0<br>    ;if (0x01&lt;&lt;driveletter &amp; drivesfound) == 0x01&lt;&lt;driveletter<br>    ; (in other words, if there is a drive mounted at this driveletter)<br>    StrCmp $R3 $R2 0 NoDriveHere<br>      ;convert asciinumber of driveletter to character<br>      IntOp $R2 $R1 + 65<br>      IntFmt $R2 %c $R2<br>      ;get type of drive<br>      System::Call 'kernel32::GetDriveType(t "$R2:\") i .r13'<br>      StrCmp $R3 5 0 NoDriveHere<br>        ;if type is CDROM, end<br>        StrCpy $R1 "$R2:\"<br>        goto break<br>    NoDriveHere:<br>    ;increment driveletter<br>    IntOp $R1 $R1 + 1<br>    StrCmp $R1 $R4 break     ;if we've cycled the entire alphabet, end<br>    StrCmp $R1 26 0 +2       ;if &gt;Z, return to A<br>      StrCpy $R1 0<br>    goto loop<br>  break:<br><br>  Pop $R4<br>  Pop $R3<br>  Pop $R2<br>  Pop $R0<br>  Exch $R1<br>FunctionEnd<br></code>
</pre><br>
      <br>
      Edit: Spacing fixed. Also, find the CD-ROM plugin here: hxxp://nsis.sourceforge.net/CDRom_plug-in
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ChrisMorton75</span><br>
      <span class="post-time small text-muted">25th March 2008 21:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks - I'll keep this for the future. I'm not experienced at the windows internals, but I'll try your status call, since I know which drive I'm installing from.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>