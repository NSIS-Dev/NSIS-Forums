<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="The installer installs nothing after a uninstall"><title>The installer installs nothing after a uninstall - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">The installer installs nothing after a uninstall</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=323312">The installer installs nothing after a uninstall</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Romuuu</span><br><span class="post-time small text-muted">21st October 2010 10:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>The installer installs nothing after a uninstall</strong><br>&nbsp; Hello everyone,<br><br>I created an installer which check if a version of my program is already installed before the installation.<br>If true, the installer launch the uninstaller (if the user agrees), and after the uninstall, the installation is launch.<br><br>When nothing is installed, the installer copies all the files in the right place. But if a version is already installed, and if the user clicks ok, the unsinstall is ok, but when the installer finish his job, nothing is copied (the unsinstall.exe is the only thing which is copied).<br><br>Someone knows this problem?<br><br>Thanks in advance for your answers.<br><br>Regards,<br>Romuuu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">21st October 2010 12:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Can't help much without the code.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Animaether</span><br><span class="post-time small text-muted">21st October 2010 12:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">would need more information / script code. Typically the pseudocode would be...<br><br></p><pre>
if previous installation detected (<br>  run that installations uninstaller<br>)<br>install 
<br>&gt;

</pre>There's very little that can go wrong with that in principle.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">21st October 2010 12:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Are you running the uninstall using ExecWait with _?=[old_install_dir]? If you omit the _?= switch the uninstaller will spawn a new process and ExecWait will not wait. That sounds like it could be your problem.<br>
      <br>
      Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Romuuu</span><br>
      <span class="post-time small text-muted">21st October 2010 13:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi, and thanks for the answers.<br>
      <br>
      I forgot to specify that I am using NSIS with CMake (CPack).<br>
      Here is the code :<br>
      <br></p>
      <pre>
<code>
ReadRegStr $0 ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "DisplayVersion"
<br> StrCmp $0 "" no_other_version 0
<br>  StrCmp$0 ${PRODUCT_VERSION} 0 other_version
<br>    MessageBox MB_YESNO"$delete_already_installed" IDYES 0 IDNO keep_previous_installation
<br>      ReadRegStr$1 ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "UninstallString"
<br>     ExecWait '"$1" _?=$INSTDIR' $0
<br>      IntCmp$0 0 no_other_version keep_previous_installation
<br>    keep_previous_installation:
<br>     MessageBox MB_OK "$cannot_be_installed" IDOK 0
<br>      Quit
<br>  other_version:
<br>   MessageBox MB_YESNO "$delete_deprecated" IDYES 0 IDNO no_other_version
<br>      ReadRegStr$1 ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "UninstallString"
<br>     ExecWait '"$1" _?=$INSTDIR'
<br> no_other_version: 
</code>
</pre>The installer waits the uninstaller to do his job.<br>
      <br>
      Thanks in advance.<br>
      <br>
      <br>
      Regards,<br>
      Romu
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Romuuu</span><br>
      <span class="post-time small text-muted">21st October 2010 13:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I found the problem.<br>
      The registry was checked before running the uninstaller.<br>
      Now it is checked after.<br>
      <br>
      Thanks for your answers, this ppost can be closed.<br>
      <br>
      Regards,<br>
      Romu</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>