<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="User Input via interface and Command Line" />

  <title>User Input via interface and Command Line - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">User Input via interface and Command Line</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=212091">User Input via interface and Command Line</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MrEyes</span><br />
      <span class="post-time small text-muted">2nd April 2005 20:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>User Input via interface and Command Line</strong><br />
      Hello all,<br />
      <br />
      I am new to the nullsoft installer so there is a distinct possibility that what I am about to ask is a typical "noob" question. That being said I cant find any specific information in the docs<br />
      <br />
      I need to create an installer that has a custom page in it that asks the user for an ip address. My current project has 10 sections in it and this page should only be displayed if the user select the component that needs the information.<br />
      <br />
      The second problem is that this installer will also have the ability to run silently (which installs all components). So I need to know how to pass this value into the installer. For example<br />
      <br />
      MyInstaller.exe /silent /ip:"127.0.0.1"<br />
      <br />
      Any help of guidance on this one would be greatly appreciated<br />
      <br />
      EDIT :<br />
      I have been looking at this<br />
      <a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=378&amp;instances=0,64" target="_blank">http://nsis.sourceforge.net/archive/...instances=0,64</a><br />
      <br />
      But dont fully instand whats going on. I have added the following to my script<br />
      <br /></p>
      <pre>
<span style="color: #007700">!</span><span style="color: #0000BB">defineMUI_ABORTWARNING
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_PAGE_WELCOME
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_PAGE_LICENSE</span><span style="color: #DD0000">"FileArchive\license.txt"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_PAGE_COMPONENTS
<br />PagecustomGetServerIp
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_PAGE_INSTFILES
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_PAGE_FINISH
<br /></span><span style="color: #007700">....
<br />....
<br />....
<br />Function</span><span style="color: #0000BB">GetServerIp
<br /><br />SectionGetFlags</span><span style="color: #007700">${</span><span style="color: #0000BB">sec_</span><span style="color: #007700">}</span><span style="color: #0000BB">$R0
<br />IntOp$R0$R0</span><span style="color: #007700">&amp;${</span><span style="color: #0000BB">SF_SELECTED</span><span style="color: #007700">}
<br /></span><span style="color: #0000BB">IntCmp$R0</span><span style="color: #007700">${</span><span style="color: #0000BB">SF_SELECTED</span><span style="color: #007700">}</span><span style="color: #0000BB">show
<br /><br />Abort
<br /><br />show</span><span style="color: #007700">:
<br /><br />;If</span><span style="color: #0000BB">notusingModernUI</span><span style="color: #007700">use</span><span style="color: #0000BB">InstallOptions</span><span style="color: #007700">::</span><span style="color: #0000BB">dialog</span><span style="color: #DD0000">"iofile.ini"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_HEADER_TEXT</span><span style="color: #DD0000">"ServerAddress""Enteryourserversipaddressorname"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_DISPLAY</span><span style="color: #DD0000">"serverip.ini"
<br /><br /></span><span style="color: #0000BB">FunctionEnd
<br /></span>

<!-- php buffer end -->
                
                
                
</pre>
      <hr />
      <pre>
        
I have copied a custom page ini file from here :<br /><br /><a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=479&amp;instances=0,48" target="_blank">http://nsis.sourceforge.net/archive/...instances=0,48</a><br /><br />(the showUserList.ini which is now my serverip.ini)<br /><br />But it doesnt seem to do anything, for testing purposes I added a MessageBox MB_OK to the section after the show: and it is displayed, so the code is being hit.<br /><br />EDIT 2:<br /><br />It looks like the first example I was looking at missed the following line :<br /><br />!insertmacro MUI_INSTALLOPTIONS_EXTRACT "serverip.ini"<br /><br />The custom page now works, now I need to work out how to put a input box on there and save the value into a variable
                
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jnuw</span><br />
      <span class="post-time small text-muted">2nd April 2005 22:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">For your custom page, put it in in the order that you would want it displayed if the user checks the section that needs it (SEC04 in this example). Probably after the components page, but before you InstFiles page. In the top of the "SetPage" function that will display the custom page, add the commands:<br />
      <br />
      SectionGetFlags $R0 ${SEC04}<br />
      StrCmp $R0 0 End<br />
      <br />
      Just make sure you have the End: label at the very end of the SetPage function, and if section 4 is not selected, the custom page will not be displayed, and the installer will skip to the next page.<br />
      <br />
      As for passing a parameter to a silent install, check out the help file, specifically 4.12 Silent Installers/Uninstallers. You will need to add GetParameters and StrStr functions, these can be found in appendix C.<br />
      <br />
      Hope this helps.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MrEyes</span><br />
      <span class="post-time small text-muted">3rd April 2005 14:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Findings so far</strong><br />
      Well for the sake of anybody searching the forum in the future this is what I have so far (although I still have a few small problems)<br />
      <br />
      <b>Custom Page</b><br />
      I needed a custom page with a few labels and an input box, this page was only to be displayed if a specific section was selected.<br />
      <br />
      Add the following function<br />
      <br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">Function</span><span style="color: #0000BB">GetServerIp<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">sec_MySpecficSectionisthenameofthesection<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">thatmustbeselected</span><span style="color: #007700">,if</span><span style="color: #0000BB">itisntthenthe</span><span style="color: #007700">function<br />
      ;</span><span style="color: #0000BB">aborts<br />
      SectionGetFlags</span><span style="color: #007700">${</span><span style="color: #0000BB">sec_MySpecficSection</span><span style="color: #007700">}</span><span style="color: #0000BB">$R0<br />
      IntOp$R0$R0</span><span style="color: #007700">&amp;${</span><span style="color: #0000BB">SF_SELECTED</span><span style="color: #007700">}<br /></span> <span style="color: #0000BB">IntCmp$R0</span><span style="color: #007700">${</span><span style="color: #0000BB">SF_SELECTED</span><span style="color: #007700">}</span><span style="color: #0000BB">show<br />
      Abort<br />
      <br />
      show</span><span style="color: #007700">:<br />
      !</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_EXTRACT</span><span style="color: #DD0000">"serverip.ini"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_HEADER_TEXT</span><span style="color: #DD0000">"ServerAddress""Enteryourserversipaddressorname"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_INSTALLOPTIONS_DISPLAY</span><span style="color: #DD0000">"serverip.ini"<br /></span> <span style="color: #0000BB">FunctionEnd<br /></span></span> <!-- php buffer end -->
      <hr />
      I also added the following to the page definitions<br />
      <br />
      PHP Code:
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">!</span><span style="color: #0000BB">defineMUI_ABORTWARNING<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_PAGE_WELCOME<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_PAGE_LICENSE</span><span style="color: #DD0000">"license.txt"<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_PAGE_COMPONENTS<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">THISNEXTLINEWASADDED<br />
      PagecustomGetServerIp<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_PAGE_INSTFILES<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_PAGE_FINISH<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_UNPAGE_CONFIRM<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_UNPAGE_INSTFILES<br /></span></span> <!-- php buffer end -->
      <hr />
      The serverip.ini file looks like this :<br />
      <br />
      PHP Code:
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">***91;</span><span style="color: #0000BB">Settings</span><span style="color: #007700">***93;<br /></span> <span style="color: #0000BB">NumFields</span><span style="color: #007700">=</span><span style="color: #0000BB">4<br />
      <br /></span> <span style="color: #007700">***91;</span><span style="color: #0000BB">Field1</span><span style="color: #007700">***93;<br /></span> <span style="color: #0000BB">Type</span><span style="color: #007700">=</span><span style="color: #0000BB">Label<br />
      Text</span><span style="color: #007700">=</span><span style="color: #0000BB">ServerAddress<br />
      Left</span><span style="color: #007700">=</span><span style="color: #0000BB">0<br />
      Right</span><span style="color: #007700">=</span><span style="color: #0000BB">171<br />
      Top</span><span style="color: #007700">=</span><span style="color: #0000BB">0<br />
      Bottom</span><span style="color: #007700">=</span><span style="color: #0000BB">15<br />
      <br /></span> <span style="color: #007700">***91;</span><span style="color: #0000BB">Field2</span><span style="color: #007700">***93;<br /></span> <span style="color: #0000BB">Type</span><span style="color: #007700">=</span><span style="color: #0000BB">Text<br />
      State</span><span style="color: #007700">=</span><span style="color: #0000BB">192.168.0.1<br />
      Left</span><span style="color: #007700">=</span><span style="color: #0000BB">85<br />
      Right</span><span style="color: #007700">=</span><span style="color: #0000BB">226<br />
      Top</span><span style="color: #007700">=</span><span style="color: #0000BB">16<br />
      Bottom</span><span style="color: #007700">=</span><span style="color: #0000BB">29<br />
      <br /></span> <span style="color: #007700">***91;</span><span style="color: #0000BB">Field3</span><span style="color: #007700">***93;<br /></span> <span style="color: #0000BB">Type</span><span style="color: #007700">=</span><span style="color: #0000BB">Label<br />
      Text</span><span style="color: #007700">=</span><span style="color: #0000BB">Howtoobtainyourserveraddress<br />
      Left</span><span style="color: #007700">=</span><span style="color: #0000BB">0<br />
      Right</span><span style="color: #007700">=</span><span style="color: #0000BB">171<br />
      Top</span><span style="color: #007700">=</span><span style="color: #0000BB">35<br />
      Bottom</span><span style="color: #007700">=</span><span style="color: #0000BB">45<br />
      <br /></span> <span style="color: #007700">***91;</span><span style="color: #0000BB">Field4</span><span style="color: #007700">***93;<br /></span> <span style="color: #0000BB">Type</span><span style="color: #007700">=</span><span style="color: #0000BB">Label<br />
      Text</span><span style="color: #007700">=</span><span style="color: #0000BB">DescriptiontextexplaininghowtogettheIPaddress<br />
      Left</span><span style="color: #007700">=</span><span style="color: #0000BB">0<br />
      Right</span><span style="color: #007700">=</span><span style="color: #0000BB">300<br />
      Top</span><span style="color: #007700">=</span><span style="color: #0000BB">50<br />
      Bottom</span><span style="color: #007700">=</span><span style="color: #0000BB">300<br /></span></span> <!-- php buffer end -->
      <hr />
      <b>Command Line Params</b><br />
      To parse a command line parameter<br />
      1) Add the "StrStr" function from the NSIS docs<br />
      2) Add the "GetParameters" function from the NSIS docs<br />
      3) Add the "GetParameterValue" function from here :<br />
      <br />
      <a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=832&amp;instances=0,11,804" target="_blank">http://nsis.sourceforge.net/archive/...ances=0,11,804</a><br />
      <br />
      This is then called like this :<br />
      PHP Code:
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #0000BB">Push</span><span style="color: #DD0000">"PSN"</span><span style="color: #007700">;</span><span style="color: #0000BB">paramname<br />
      Push</span><span style="color: #DD0000">"ERR_NO_PSN"</span><span style="color: #007700">;default</span><span style="color: #0000BB">value<br />
      CallGetParameterValue<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">2<br />
      MessageBoxMB_OK</span><span style="color: #DD0000">"ValueofOUTPUTis'$2'"</span> So if you pass /PSN=127.0.0.1 $2 will contain the value 127.0.0.1. If you dont pass the command line parameters $2 will contain ERR_NO_PSN<br />
      <br />
      The example on the website above copys the $2 param into another called $OUTPUT using the following line :<br />
      <br />
      PHP Code:</span>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #0000BB">StrCpy$OUTPUT</span><span style="color: #007700">$</span><span style="color: #0000BB">2<br /></span></span> <!-- php buffer end -->
      <hr />
      But this doesnt compile for me, not sure why.<br />
      <br />
      <b>A couple of questions</b><br />
      <br />
      1) How do I get the value the user entered into the Server IP text box on the custom page?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">3rd April 2005 18:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Read it using MUI_INSTALLOPTIONS_READ from your first custom page INI file, then write it straight into your second custom page INI file using MUI_INSTALLOPTIONS_WRITE.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
