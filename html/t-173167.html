<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Find the directory in registry to install to?"><title>Find the directory in registry to install to? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Find the directory in registry to install to?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=173167">Find the directory in registry to install to?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">kukomamasan</span><br><span class="post-time small text-muted">13th March 2004 16:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Find the directory in registry to install to?</strong><br>&nbsp; Hi im an absolute new to make installers by scripting, what i would like to know is how do you make a section that tells to read i the registry for a location to install too. remember im new, i dont understand any scripting language :-( , though i can read hehe, so found out i need to use readregstr somewhere, how should the line look like, and how do i make the installdir to point to that directory? plz give me an example from the real life :-) , cant translate any of the var_set x+y and thing like that.<br>would be great if you could even write the whole command on how to read from registry place HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\GhostRecon.exe and under there is a string called path, thats where i would like to make NSIS look and somehow make the string to installdir.<br>Hope anyone see my problem :-)<br>Another little thing, how do you add a whole directory containing of several 1000 files and folders? im not gonna add them individualy lol, so far im repacking my stuff to zip and use zip2exe.<br>thx in advance kuko.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Yathosho</span><br><span class="post-time small text-muted">13th March 2004 16:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">the <a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=321" target="_blank">StripPath</a> function should help you here</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kukomamasan</span><br><span class="post-time small text-muted">13th March 2004 16:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">ty for the quick reply, but im new lol cant understand any of the thing that script do, cant even see where it would look for the uninstall reg entry to look for winamp, i need a step by step guide :-( sorry.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">atsuk</span><br><span class="post-time small text-muted">13th March 2004 17:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">this reads directory from registry, and returns it inot variable $RegInstDir. later in sections you can use $RegInstDir just like $INSTDIR.<br><br></p><pre>
<code>
RegInstDir
<br>&gt;Function .oninit
<br> ReadRegStr $RegInstDir HKCU "Software\MyProgram" "Directory"
<br>&gt;FunctionEnd
<br><br>Section
<br> SetOutPath $RegInstDir
<br>  File "c:\\myfile.txt"
<br>&gt;SectionEnd 
<br>&gt;
</code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Yathosho</span><br>
      <span class="post-time small text-muted">13th March 2004 17:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ah, i read something else. depending on the registry entry, either <a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.1.21" target="_blank">InstallDirRegKey</a> or the above mentioned StripPath should bring you further. i recommend you check the example-scripts in the NSIS directory or in the <a href="http://nsis.sourceforge.net/archive/nsisweb.php" target="_blank">archive</a>.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kukomamasan</span><br>
      <span class="post-time small text-muted">13th March 2004 19:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ok thx for the answers, well i found something similar though required alot of testing, but i got it working somehow, looks like this<br>
      <br>
      Function .onInit<br>
      Push $INSTDIR ;save compile-time value<br>
      ReadRegStr $INSTDIR HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\GhostRecon.exe" path<br>
      StrCmp $INSTDIR "" 0 +2<br>
      Pop $INSTDIR ;return compile-time value<br>
      FunctionEnd<br>
      <br>
      so thats the first part :-) i got it to show d:\ghost recon , now i need to add \mods\ to the $instdir</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br>
      <span class="post-time small text-muted">13th March 2004 19:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">InstallDirRegKey does exactly the same thing.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kukomamasan</span><br>
      <span class="post-time small text-muted">13th March 2004 19:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Amasing how simpel it can be done :-) jep InstallDirRegKey worked fine for this installer, thx, though i still need to find out how to add \mods\ to the install dir then?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br>
      <span class="post-time small text-muted">13th March 2004 19:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Function .onInit<br>
      StrCpy $INSTDIR $INSTDIR\mods<br>
      FunctionEnd</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kukomamasan</span><br>
      <span class="post-time small text-muted">13th March 2004 19:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thx now im ready to make some installations :-)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kukomamasan</span><br>
      <span class="post-time small text-muted">14th March 2004 00:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">oh wasent so easy at all :-( i got this so far : Name "${PRODUCT_NAME}"<br>
      OutFile "C:\Documents and Settings\admin\Skrivebord\SotoPlasterV4.exe"<br>
      InstallDir "$PROGRAMFILES\Red Storm Entertaintment\Ghost Recon\Mods\SotoPlasterv4"<br>
      ShowInstDetails show<br>
      ShowUnInstDetails show<br>
      <br>
      InstallDirRegKey HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\GhostRecon.exe" path<br>
      <br>
      Function .onInit<br>
      StrCpy $INSTDIR $INSTDIR\MODS\SotoPlasterV4<br>
      FunctionEnd<br>
      <br>
      Section "MainSection" SEC01<br>
      SetOutPath "$INSTDIR"<br>
      SetOverwrite ifnewer<br>
      File /r "E:\Ghost Recon\mods\SOTOPlasterV4\*.*"<br>
      SectionEnd problem is if there is no reference to the path in the registry, the path would look like this C:\Programmer\Red Storm Entertaintment\Ghost Recon\Mods\SotoPlasterv4\MODS\SotoPlasterV4 i guess i should add some check to see if it found a valid directory in the registry, what should that be?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br>
      <span class="post-time small text-muted">14th March 2004 11:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That's because you have added<br>
      <br>
      InstallDir "$PROGRAMFILES\Red Storm Entertaintment\Ghost<br>
      <br>
      If you remove that line $INSTDIR will be empty in .onInit if there is no valid path.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kukomamasan</span><br>
      <span class="post-time small text-muted">15th March 2004 01:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thx though i have found another solution, and its working, again somehow :-)<br>
      <br>
      Function .onInit<br>
      ReadRegStr $R0 HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\GhostRecon.exe" "path"<br>
      StrCmp $R0 "" NotPresent Present<br>
      <br>
      notpresent:<br>
      StrCpy $INSTDIR "$programfiles\Red Storm Entertainment\Ghost Recon\Mods\SotoPlasterV4"<br>
      goto done<br>
      <br>
      present:<br>
      strcpy $instdir $R0\mods\SotoPlasterV4<br>
      done:<br>
      functionend<br>
      installdir \SotoPlasterV4<br>
      Section "MainSection" SEC01<br>
      SetOutPath "$INSTDIR"<br>
      SetOverwrite ifnewer<br>
      File /r "E:\Ghost Recon\mods\SOTOPlasterV4\*.*"<br>
      SectionEnd</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>