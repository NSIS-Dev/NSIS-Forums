<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="read/write registry version &amp; $INSTDIR" />

  <title>read/write registry version &amp; $INSTDIR - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">read/write registry version &amp; $INSTDIR</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=274959">read/write registry version &amp; $INSTDIR</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bl4d3</span><br />
      <span class="post-time small text-muted">26th July 2007 18:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>read/write in registry the version &amp; $INSTDIR</strong><br />
      hello,<br />
      i've created my own nsis installer for my program. but i don't know how to set a registry value with the corresponding version number and installation path.<br />
      <br />
      i plan to add in future for my program an extension. the installer for the extension should check in the registry the path i have set with the main program installer.<br />
      <br />
      <font color="blue">The main installer should set these entries:<br />
      <br />
      [HKEY_LOCAL_MACHINE\Software\${APPNAME}\]<br />
      "Path"="C:\Program Files\APPNAME"<br />
      "Version"="1.0"</font> ;for future patches e.g.<br />
      <br />
      <font color="green">And the installer for the extension should read:<br />
      [HKEY_LOCAL_MACHINE\Software\${APPNAME}\]<br />
      "Path"="C:\Program Files\APPNAME"<br />
      <br />
      and set automatically on installation the path he found in the registry, to avoid mistakes in choosing the correct installation directory.</font><br />
      <br />
      cause the customer could choose another install directory in the main installer.<br />
      <br />
      i think i must use <b>"ReadREGDWORD"</b> and <b>"WriteRegDWORD"</b>, but i'm not very sure about this. the solution shouldn't be very complex. something easier will do it for myself.<br />
      <br />
      thank you</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">26th July 2007 18:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That's too short, could you provide some details about your query?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bl4d3</span><br />
      <span class="post-time small text-muted">26th July 2007 18:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Red Wine</i><br />
        <b>That's too short, could you provide some details about your query?</b>
      </blockquote>ups, sorry for that. when i wrote my text i accidentally press the <b>"enter"</b>-key.<br />
      sorry.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bl4d3</span><br />
      <span class="post-time small text-muted">26th July 2007 19:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hm,<br />
      <font color="blue">i think in the main installer i should use:<br />
      <br />
      WriteRegStr HKLM "Software\APPNAME" "Path" "$INSTDIR"<br />
      WriteRegStr HKLM "Software\APPNAME" "Version" "${VERSION}"</font><br />
      <br />
      <font color="green">and the extension installer should use:<br />
      <br />
      ReadRegDWORD $0 HKLM Software\APPNAME Path</font><br />
      <br />
      <i>this was copied from the nsis user manual</i><br />
      <br />
      but if this is correct, how to lock and change in the extension installer the installation directory?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">26th July 2007 19:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Function .onInit<br />
      ReadRegStr $0 HKLM "Software\APPNAME" "Path"<br />
      StrCpy $INSTDIR "$0"<br />
      ........<br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">26th July 2007 20:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">No need for using ReadRegStr, you can just use InstallDirRegKey.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bl4d3</span><br />
      <span class="post-time small text-muted">28th July 2007 05:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hi,<br />
      sorry guys, but i do some bugfixing stuff on my program first, before i get time for testing the code posted here.<br />
      <br />
      the code you guys have written is perfect for me.<br />
      <br />
      this is how i do it and it is 100% working. i've decided to post the hole code again as i used it, to make it more understandable for others.<br />
      <br />
      In the main installer write:<br />
      <br />
      <font color="blue">!define</font> VERSION "1.0"<br />
      <font color="blue">!define</font> APPNAME "Your Programs Name"<br />
      <br />
      <font color="blue">Function</font> .onInstSuccess <font color="green">;After installation success the installer writes some values to registry</font><br />
      <br />
      <font color="blue">WriteRegStr</font> <font color="orange">HKLM</font> "Software\<font color="red">${APPNAME}</font>" "Path" "<font color="red">$INSTDIR</font>"<br />
      <font color="blue">WriteRegStr</font> <font color="orange">HKLM</font> "Software\<font color="red">${APPNAME}</font>" "Version" "<font color="red">${VERSION}</font>"<br />
      <br />
      <font color="blue">FunctionEnd</font><br />
      <br />
      and in the extension installer:<br />
      <br />
      <font color="blue">Function</font> .onInit<br />
      <br />
      <font color="blue">ReadRegStr</font> <font color="red">$0</font> <font color="orange">HKLM</font> "Software\<font color="red">${APPNAME}</font>" "Path"<br />
      <font color="blue">StrCpy</font> <font color="red">$INSTDIR</font> "<font color="red">$0</font>"<br />
      <br />
      <font color="blue">FunctionEnd</font><br />
      <br />
      <br />
      big thanks goes out to all genius guys!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bl4d3</span><br />
      <span class="post-time small text-muted">28th July 2007 20:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hi,<br />
      there's another problem. i want to compare the version, which is stored in registry, for future patches. i've experiment with some possibilities, but ther is always an error on compiling.<br />
      <br />
      patch installer:<br />
      <font color="blue">!define</font> NEWVERSION "v1.2"<br />
      <font color="blue">!define</font> CURRENTVERSION ""<br />
      ...<br />
      ...<br />
      <font color="blue">!include</font> "WordFunc.nsh"<br />
      <font color="blue">!include</font> "StrFunc.nsh"<br />
      <font color="red">${StrStr}</font> <font color="green">;Activate the StrStr Function</font><br />
      <font color="blue">!insertmacro</font> VersionCompare<br />
      <br />
      <font color="blue">Section</font><br />
      <font color="blue">ReadRegStr</font> <font color="red">$0</font> <font color="orange">HKLM</font> "Software\<font color="red">${APPNAME}</font>" "Version"<br />
      <font color="blue">StrCpy</font> <font color="red">$CURENTVERSION</font> "<font color="red">$0</font>"<br />
      <font color="red">${VersionCompare}</font> "<font color="red">${CURENTVERSION}</font>" "<font color="red">${NEWVERSION}</font>" <font color="red">$R0<br />
      ${If} $R0</font> = 0<br />
      <font color="blue">MessageBox</font> MB_VER "equal"<br />
      <font color="blue">Abort</font><br />
      <font color="red">${If} $R0</font> = 1<br />
      <font color="blue">MessageBox</font> MB_VER "newer"<br />
      <font color="blue">Abort</font><br />
      <font color="red">${If} $R0</font> = 2<br />
      <font color="blue">MessageBox</font> MB_VER "newer"<br />
      <font color="blue">Abort</font><br />
      <font color="blue">SectionEnd</font><br />
      <br />
      (Example: <a href="http://nsis.sourceforge.net/Docs/AppendixE.html#E.3.16" target="_blank">E.3.16 VersionCompare</a>)<br />
      <br />
      <u>With those code the compiler says:</u><br />
      !insertmacro: end of FUNCTION_STRING_StrStr<br />
      !insertmacro: VersionCompare<br />
      !insertmacro: end of VersionCompare<br />
      Section: ""<br />
      ReadRegStr $0 HKLM\Software\APPNAME\Version<br />
      Usage: StrCpy $(user_var: output) str [maxlen] [startoffset]<br />
      Error in script "stdin" on line 85 -- aborting creation process<br />
      <br />
      <u>without those lines</u><br />
      ReadRegStr $0 HKLM "Software\${APPNAME}" "Version"<br />
      StrCpy $CURENTVERSION "$0"<br />
      <u>the compiler says:</u><br />
      !insertmacro: end of FUNCTION_STRING_StrStr<br />
      !insertmacro: VersionCompare<br />
      !insertmacro: end of VersionCompare<br />
      Section: ""<br />
      !insertmacro: VersionCompareCall<br />
      !insertmacro: end of VersionCompareCall<br />
      !insertmacro: _If<br />
      !insertmacro: end of _If<br />
      Usage: MessageBox mode messagebox_text [/SD return] [return_check label_to_goto_if_equal [return_check2 label2]]<br />
      mode=modeflag[|modeflag[|modeflag[...]]]<br />
      modeflag=(MB_ABORTRETRYIGNORE|MB_OK|MB_OKCANCEL|MB_RETRYCANCEL|MB_YESNO|MB_YESNOCANCEL|MB_ICONEXCLAMATION|MB_ICONINFORMATION|MB_ICONQUESTION|MB_ICONSTOP|MB_USERICON|MB_TOPMOST|MB_SETFOREGROUND|MB_RIGHT<br />
      Error in script "stdin" on line 88 -- aborting creation process<br />
      <br />
      you see there are some bugs, but i don't know how to fix it. i'm not really fit in nsis.<br />
      <br />
      thanks for help</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">28th July 2007 23:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You missed the distinction between variables (and how they are referenced) and defined constants (and their usage).<br /></p>
      <pre>
<code><br />Var something<br />StrCpy $something "any text"<br /><br />!define something "different text"<br />StrCmp $something ${something} equal<br />...<br />equal:<br /></code>
</pre><br />
      <br />
      !define sets a compile time value and replaces the ${} entry with the defined value during the compilation.<br />
      <br />
      Var creates a variable which only has a value after the compile, during the execution.<br />
      <br />
      In addition, I think VersionCompare won't like the "v" you put in ${NEWVERSION}.<br />
      <br />
      Don
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
