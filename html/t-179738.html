<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Changing $TEMP path" />

  <title>Changing $TEMP path - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Changing $TEMP path</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=179738">Changing $TEMP path</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">12th May 2004 15:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Changing $TEMP path</strong><br />
      I have a customer who has most of their user accounts set up as Restricted. On top of that they don't allow the users to write to the Temp folder under $WINDIR\temp or $TEMP. So, I'm wondering if there is a way for me to modify the $TEMP path. I'm figuring I'll set up a command line parameter for him to set the temp path. However, I tried setting $TEMP using -- StrCpy $TEMP "C:\newtemp" --and it won't compile. Is this not possible?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">12th May 2004 15:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Use StrCpy in the .onInit function.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">12th May 2004 16:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, so what am I doing wrong? That's what I've been trying. I took the Basic.nsi script from the Modern UI folder and added:<br />
      <br />
      Function .onInit<br />
      <br />
      StrCpy $TEMP "C:\newtemp"<br />
      <br />
      FunctionEnd<br />
      <br />
      and it won't compile.<br />
      Function: ".onInit"<br />
      Usage: StrCpy $(user_var: output) str [maxlen] [startoffset]<br />
      Error in script "C:\Temp\Basic.nsi" on line 46 -- aborting creation process</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">12th May 2004 20:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can't modify this variable, you should declare your own.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">thelliez</span><br />
      <span class="post-time small text-muted">17th May 2004 21:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I would like to second this feature request. I am in a similar situation where I am not allowed to write to the C drive.<br />
      <br />
      Right now, I am using my own directory but I then have to remember to delete these tmp files.<br />
      <br />
      Is there a way that I can delete these files even if the user aborts the installation?<br />
      <br />
      <br />
      Thanks,<br />
      Thierry</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">17th May 2004 22:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">See the documentation about callback functions.<br />
      <br />
      But why not use the plug-ins directory ($PLUGINSDIR after calling InitPluginsDir)?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">17th May 2004 22:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Modifying the $PLUGINSDIR doesn't really seem to solve the problem either. If I put a MessageBox as the very first thing in .onInit and then check the temp directory it has already written a file there (C:\Documents and Settings\andyg\Local Settings\Temp\nskC0.tmp). So, unless that temp file is there because I did a MessageBox it seems too late to change the plugins directory and use it as the temp folder. Is there a function before .onInit?<br />
      My client is claiming that my installs just won't work in his environment unless he can specify where the temp path is.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">17th May 2004 22:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That isn't a file, it's a folder. Use it and it will be removed automatically (but don't forget to call InitPluginsDir).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">17th May 2004 22:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's actually a file for me. It's locked though, it won't even let me open it in Notepad. If I then click Ok on the MessageBox I get a folder after that with all my IO pages, bitmaps etc. I realize it renames itself everytime but in this instance I have a TMP file named nsbD3.tmp and then I get a nscD4.tmp folder after I click past the message box. I get the same result if I run the nsis20.exe install file. Both the temp file and folder do go away after the install is cancelled or completed. I'm running XP Pro SP1 if that matters.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">20th May 2004 19:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That's probably the solid compression buffer. Don't use solid comression if you don't want it to be created.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">21st May 2004 16:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, I switched to using non-solid compression and the .tmp file did go away so that must have been what was causing that. I had to change things using MUI_INSTALLOPTIONS_EXTRACT_AS to File so that I could copy them into the user defined temp folder and that worked ok. However, plugins (like InstallOptions.dll), ioSpecial.ini and the header and wizard bitmap still go to the temp folder under profiles for that user. How can I get it so that these files will go into the usr defined temp folder? I'm thinking something like "InitPluginsDir c:\usertemp" would be great. I realize I may have to delete the files myself once the install is finished. Thanks,</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">21st May 2004 16:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can call plug-ins the old fashioned way, with CallInstDLL. To avoid having to do that for every plug-in, you can get your first plug-in to change $PLUGINSDIR. $PLUGINSDIR is not changable from the script.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">21st May 2004 20:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Are you saying that CallInstDLL will set the $PLUGINSDIR path or that my first plugin can somehow set the $PLUGINSDIR path? If the second is true is there an example of that somewhere? I've attached a modified version of Basic.nsi to illustrate what I'm trying. It ends up that the $PLUGINSDIR never gets set even after the call to CallInstDLL. The exdll.dll does get called though from the usertemp folder. The install runs but I have no idea where ioSpecial.ini and InstallOptions.dll are going.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">22nd May 2004 00:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The plug-in can change $PLUGINSDIR using the variables argument passed to its function. I suggest you simply examine what is passed in variables and see where the change is needed. The utility functions in exdll.h might help.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">22nd May 2004 23:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Awesome, I got the plug-in built and working. Here's what I did if anybody else is curious: I extract my DLL to whatever folder the user specifies on the command line and then call my DLL to change the PLUGINSDIR. Then I call InitPluginsDir from my script so that I can use the path and it also creates a unique folder under the user path, which is nice. Then I delete my DLL used to change the PLUGINSDIR and NSIS takes care of deleting the temp path it created and all the junk in it when the install finishes. I had to add a little code in .onInit but the rest of my script appears to work as is. If anybody wants more detail please ask. Thanks again kichik!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">thelliez</span><br />
      <span class="post-time small text-muted">24th May 2004 05:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Do you mind posting a little bit more details about you made it happen? What does your dll like?<br />
      <br />
      Thanks,<br />
      Thierry</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">24th May 2004 14:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The DLL didn't take much. I just took exdll and added this code to myFunction:<br />
      <br />
      char buf[1024];<br />
      int e=-1;<br />
      popstring(buf);<br />
      e = myatoi(buf);<br />
      popstring(buf);<br />
      setuservariable(e, buf);<br />
      <br />
      I ultimately ended up renaming the function and the DLL but that's about it besides adding the PLUGINSDIR to the enum in the header file. PLUGINSDIR then became #25 so when I call the DLL I used 25 to let it know which variable to change. Oh, I also had to grab the myatoi function from another example DLL.<br />
      <br />
      SetOutPath $TEMPDIR<br />
      File /oname=$TEMPDIR\chngvrbl.dll "${NSISDIR} \Plugins\chngvrbl.dll"<br />
      Push $TEMPDIR<br />
      Push 25<br />
      CallInstDLL "$TEMPDIR\chngvrbl.dll" changeVariable</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">16th July 2004 20:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Several of my customers have been using this plugin in my installs with no problems. It was being used to change the $PLUGINSDIR. So, I thought that I would post the plugin to the <a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=593&amp;instances=0" target="_blank">Archive</a> just in case anyone else could use it.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
