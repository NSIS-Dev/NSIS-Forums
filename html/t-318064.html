<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Infinite ProgressBar" />

  <title>Infinite ProgressBar - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Infinite ProgressBar</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=318064">Infinite ProgressBar</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bltomov</span><br />
      <span class="post-time small text-muted">30th March 2010 14:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Infinite ProgressBar</strong><br />
      Hi,<br />
      <br />
      I'm a nsis newbie, and have created a script to install a program, and uninstall the existing version, before installing a new one. I run the uninstaller in silent mode, so there is no progressbar during uninstallation, but maybe a infinite for a long time job?<br />
      Is it possible, to show a infinite progress bar during uninstalling of the old version?<br />
      Thank you in advance.<br />
      <br />
      Regards,<br />
      Boian</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">30th March 2010 16:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You could play with one of the banner plugins or the LoadingBAR UI for your uninstaller:<br />
      <a href="http://nsis.sourceforge.net/LoadingBar_UI" target="_blank">http://nsis.sourceforge.net/LoadingBar_UI</a><br />
      <br />
      <a href="http://nsis.sourceforge.net/MSIBanner_plug-in" target="_blank">http://nsis.sourceforge.net/MSIBanner_plug-in</a> (old)<br />
      <a href="http://nsis.sourceforge.net/NxSMSILoaderDlg_plug-in" target="_blank">http://nsis.sourceforge.net/NxSMSILoaderDlg_plug-in</a> (slightly less old)<br />
      <a href="http://nsis.sourceforge.net/Nxs_plug-in" target="_blank">http://nsis.sourceforge.net/Nxs_plug-in</a> (least old)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bltomov</span><br />
      <span class="post-time small text-muted">31st March 2010 16:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you for the response. I have downloaded the plugins, and have already a solution to show a dialog with the progress bar, during execution of the longtime process. Is it possible, to integrate the progressBar into a NSIS installer page?<br />
      <br />
      I have found that the NSdialog, already contains a ProgressBar (NSD_CreateProgressBar), but there is no documentation, how i can use it, and set a value.<br />
      <br />
      Regards,<br />
      Boian</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">31st March 2010 17:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">well if you want it inside a dialog, then your uninstaller isn't very 'silent' anymore, is it? ;)<br />
      <br />
      The nsDialogs progressbar you'd probably have to alter using windows messaging. See also this thread:<br />
      <a href="http://forums.winamp.com/showthread.php?postid=2575941" target="_blank">http://forums.winamp.com/showthread.php?postid=2575941</a><br />
      <br />
      Just in short, you'd want to set up a range...<br />
      sendMessage ProgressControl_hwnd ${PBM_SETRANGE32} start end ; e.g. 0 100 for a standard 0%-100% progressbar<br />
      <br />
      And then set the value in your script where appropriate...<br />
      sendMessage ProgressControl_hwnd ${PBM_SETPOS} value 0 ; e.g. 33 0 for 33%<br />
      <br />
      ProressControl_hwnd is what you get in the Pop after creating the item with nsDialogs.<br />
      PBM_SETRANGE and PBM_SETPOS are defined in WinMessages.nsh (ships with NSIS) - so be sure to include that if you aren't already.<br />
      <br />
      If you want it to be one of those marquee progressbars that just continually loop from left to right, you probably have to set up some manner of style on the thing.. haven't looked into that :)<br />
      Edit: This page is informative, though: <a href="http://msdn.microsoft.com/en-us/library/bb760816%28VS.85%29.aspx#Marquee_Style" target="_blank">http://msdn.microsoft.com/en-us/libr...#Marquee_Style</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">31st March 2010 17:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">complete example...<br /></p>
      <pre>
<span style="color: #007700">!include</span><span style="color: #DD0000">"WinMessages.nsh"
<br /></span><span style="color: #007700">!include</span><span style="color: #DD0000">"MUI2.nsh"
<br /></span><span style="color: #007700">!include</span><span style="color: #DD0000">"nsDialogs.nsh"
<br /><br /></span><span style="color: #0000BB">OutFile</span><span style="color: #DD0000">"test.exe"
<br /><br /></span><span style="color: #0000BB">Section
<br />SectionEnd
<br /><br /></span><span style="color: #007700">Var</span><span style="color: #0000BB">dialog
<br /></span><span style="color: #007700">Var</span><span style="color: #0000BB">hwnd
<br /></span><span style="color: #007700">Var</span><span style="color: #0000BB">null
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">definePB_EXSTYLE</span><span style="color: #007700">${</span><span style="color: #0000BB">WS_EX_WINDOWEDGE</span><span style="color: #007700">}|${</span><span style="color: #0000BB">WS_EX_CLIENTEDGE</span><span style="color: #007700">}
<br />!</span><span style="color: #0000BB">definePBS_MARQUEE0x08
<br /><br />PageCustompage</span><span style="color: #007700">.</span><span style="color: #0000BB">custom
<br /></span><span style="color: #007700">Function</span><span style="color: #0000BB">page</span><span style="color: #007700">.</span><span style="color: #0000BB">custom
<br />nsDialogs</span><span style="color: #007700">::</span><span style="color: #0000BB">Create1018
<br />Pop$dialog
<br /><br />nsDialogs</span><span style="color: #007700">::</span><span style="color: #0000BB">CreateControl</span><span style="color: #DD0000">"msctls_progress32"
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">DEFAULT_STYLES</span><span style="color: #007700">}|${</span><span style="color: #0000BB">PBS_MARQUEE</span><span style="color: #007700">}
<br />${</span><span style="color: #0000BB">PB_EXSTYLE</span><span style="color: #007700">}
<br /></span><span style="color: #0000BB">00100</span><span style="color: #007700">%</span><span style="color: #0000BB">10</span><span style="color: #007700">%
<br /></span><span style="color: #DD0000">"Test"
<br /></span><span style="color: #0000BB">Pop$hwnd
<br /><br /></span><span style="color: #007700">${</span><span style="color: #0000BB">NSD_CreateTimer</span><span style="color: #007700">}</span><span style="color: #0000BB">NSD_Timer</span><span style="color: #007700">.</span><span style="color: #0000BB">Callback10</span><span style="color: #007700">;</span><span style="color: #0000BB">Needatimertokickstartthemarqueeprogressbar
<br />nsDialogs</span><span style="color: #007700">::</span><span style="color: #0000BB">Show
<br />FunctionEnd
<br /><br /></span><span style="color: #007700">Function</span><span style="color: #0000BB">NSD_Timer</span><span style="color: #007700">.</span><span style="color: #0000BB">Callback
<br />SendMessage$hwnd</span><span style="color: #007700">${</span><span style="color: #0000BB">PBM_SETMARQUEE</span><span style="color: #007700">}</span><span style="color: #0000BB">150</span><span style="color: #007700">;</span><span style="color: #0000BB">start</span><span style="color: #007700">=</span><span style="color: #0000BB">1</span><span style="color: #007700">|</span><span style="color: #0000BB">stop</span><span style="color: #007700">=</span><span style="color: #0000BB">0interval</span><span style="color: #007700">(</span><span style="color: #0000BB">ms</span><span style="color: #007700">)=+</span><span style="color: #0000BB">N
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">NSD_KillTimer</span><span style="color: #007700">}</span><span style="color: #0000BB">NSD_Timer</span><span style="color: #007700">.</span><span style="color: #0000BB">Callback</span><span style="color: #007700">;</span><span style="color: #0000BB">Killthetimer
<br />MessageBoxMB_YESNO</span><span style="color: #DD0000">"Stopthemarquee?"</span><span style="color: #0000BB">IDNO</span><span style="color: #007700">+</span><span style="color: #0000BB">2
<br />SendMessage$hwnd</span><span style="color: #007700">${</span><span style="color: #0000BB">PBM_SETMARQUEE</span><span style="color: #007700">}</span><span style="color: #0000BB">00
<br />FunctionEnd
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">insertmacroMUI_LANGUAGE</span><span style="color: #DD0000">"English"
</span>
</pre>Essentially you would put all of your actions inside the function that is being called, and start/stop/slow-down/speed-up the progressbar from there.<br />
      <br />
      Edit: The Marquee-style progressbar is not available with all visual themes, though. If you comment out the MUI2 lines, you'll see that in the non-MUI visual theme, there is no marquee effect. Something to keep in mind :)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">31st March 2010 17:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">And one more reply.... This is a plugin we actually use for our uninstaller to set the progress of the built-in un.InstFiles page to a correct amount (we use a stored list to delete only installed files, and the built-in progress handling only goes by the number of commands it knows about, so direct control to show a correct progress was needed):<br />
      <a href="http://nsis.sourceforge.net/RealProgress_plug-in" target="_blank">http://nsis.sourceforge.net/RealProgress_plug-in</a><br />
      <br />
      Note that this plugin does -not- do any marquee style handling - that's not what it's for :D</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">2nd April 2010 21:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have updated the nsDialogs FAQ wiki topic with some more progress bar examples:<br />
      <a href="http://nsis.sourceforge.net/NsDialogs_FAQ" target="_blank">http://nsis.sourceforge.net/NsDialogs_FAQ</a></p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
