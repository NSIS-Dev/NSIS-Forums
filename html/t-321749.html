<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Required Working Space Warning"><title>Required Working Space Warning - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Required Working Space Warning</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=321749">Required Working Space Warning</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">NSISNUB</span><br><span class="post-time small text-muted">17th August 2010 18:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Required Working Space Warning</strong><br>I looked around quite a bit but couldn't really find what I was looking for, I am also pretty new at NSIS.<br><br>In the directory page I have noticed that it will not allow you to install to a drive that does not have enough space the next button will not be enabled. This is good.<br><br>However what I am looking to do is warn the user that they might not have enough space after an install to work with the piece of software.<br><br>ie. 3.4 GB install on a 4GB drive, I would like to show a popup or warning that says something along the lines of "The free space on chosen location may not be enough to use the software correctly"<br><br>I was thinking of something along the lines of doing this:<br><br><br>!define MUI_PAGE_CUSTOMFUNCTION_LEAVE "checkSpaceInstDir"<br>!insertmacro MUI_PAGE_DIRECTORY<br><br>Function checkSpaceInstDir<br>//Calculating the free drive space here if it is less than a certain threshold ie. 2GB<br>//Popup a message, with the option of continuing or to Cancel the install<br>FunctionEnd<br><br><br>Am I way out in left field or will something like this work?<br><br><br>cheers,</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">17th August 2010 18:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This will work, but I wouldn't cancel the install. I'd just call abort so the user stays in the directory page to select a different drive.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NSISNUB</span><br><span class="post-time small text-muted">17th August 2010 18:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">OK sounds good, I am not sure how to compute the remaining drive space though how do I know what directory was selected from the directory page, I am assuming I could use ${DriveSpace} somehow after that????</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Animaether</span><br><span class="post-time small text-muted">17th August 2010 21:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">by default, the selected directory will be copied into the $INSTDIR variable. So you can just get get drive letter from that (See the ${GetRoot} function from the File Functions Header), then pass that on to ${DriveSpace}</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">18th August 2010 05:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Keep in mind that you have to use the IntOp64 function of the system plugin, as drive spaces are almost always &gt;4GB.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NSISNUB</span><br><span class="post-time small text-muted">18th August 2010 15:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok I have computed the drive space from the chosen $INSTDIR, but it's giving me the total drive space from the chosen $INSTDIR, where does the software size value come from in this directory page? If I can get that then I can just subtract it from the $INSTDIR number I am getting and I will have found my solution.<br><br>Can I simply just use this for the continue?<br><br>MessageBox MB_YESNO "You only have $R1 GB Free of Disk Space do you want to continue?"<br><br>Noob question but how do I implement the Abort? so it simply goes back to the directory page?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">18th August 2010 15:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">SectionGetSize. Abort goes back to a page when called in the page's leave function.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NSISNUB</span><br><span class="post-time small text-muted">18th August 2010 16:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">SectionGetSize of what though?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br><span class="post-time small text-muted">18th August 2010 16:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sorry, but this was discussed a week ago already<br><a href="http://forums.winamp.com/showthread.php?t=321448" target="_blank">http://forums.winamp.com/showthread.php?t=321448</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NSISNUB</span><br><span class="post-time small text-muted">18th August 2010 17:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes I read that but I think my problem is a little different. Here is the code snippet.<br><br>!define MUI_PAGE_CUSTOMFUNCTION_LEAVE "checkSpaceInstDir"<br>!insertmacro MUI_PAGE_DIRECTORY<br><br>Function checkSpaceInstDir<br>${GetRoot} $INSTDIR $R0<br>${DriveSpace} $R0 "/D=F /S=G" $R1<br>SectionGetSize ${INSTALLER_SPACE} $R2<br>#$R3 = $R1-$R2 do something like this.<br>MessageBox MB_YESNO "Free disk space after Install will be $R3 do you want to continue with the Install?"<br>FunctionEnd<br><br>My question is what would the "INSTALLER_SPACE" variable be? the Directory Page knows that size because it doesn't enable the next button until the $INSTDIR is greater than it.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">18th August 2010 17:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Getting the required space is EXACTLY what is discussed in the thread linked by jp. Your problem is not different.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">18th August 2010 17:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The first parameter for SectionGetSize is the zero-based index of the section to get the size of. Rather than specify the index yourself, you can specify a constant of which the Section instruction can define itself (see the docs on Section).<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NSISNUB</span><br><span class="post-time small text-muted">18th August 2010 17:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I took the function from the referenced thread, My space required is coming up with 0????<br><br>StrCpy $spaceNeeded 0<br>StrCpy $counter 0<br>${Do}<br>${If} ${SectionIsSelected} $counter<br>SectionGetSize $counter $0<br>IntOp $spaceNeeded $spaceNeeded + $0<br>IntOp $counter $counter + 1<br>${EndIf}<br>${LoopUntil} ${Errors}<br>System::Int64Op $spaceNeeded / 1048576 ; GiB<br>Pop $spaceNeeded<br>${GetRoot} "$INSTDIR" $0<br>${DriveSpace} "$0\" "/D=F /S=G" $spaceAvailable ; G = GiB<br><br>MessageBox MB_OK "Install dir: $INSTDIR$\r$\nSpace required: $spaceNeeded$\r$\nSpace available: $spaceAvailable"<br><br><br><br>Is there a way to simply parse what the Directory Page shows? or is there a reason I am getting 0, BTW the Directory Page shows my Space Req being 7.9GB</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">18th August 2010 18:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Try putting ClearErrors at the top. Also the IntOp $counter $counter + 1 should be moved to after the ${EndIf} otherwise as soon as it hits an unselected section it will loop infinitely.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NSISNUB</span><br><span class="post-time small text-muted">18th August 2010 18:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks, that worked.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Animaether</span><br><span class="post-time small text-muted">18th August 2010 18:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by Afrow UK</small><br>Also the IntOp $counter $counter + 1 should be moved to after the ${EndIf} otherwise as soon as it hits an unselected section it will loop infinitely.</blockquote>Whoops - that was an error in the other thread's post (mine); added an addendum there as well.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">NSISNUB</span><br><span class="post-time small text-muted">19th August 2010 20:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">One more question, why doesn't this work?<br><br>${If} $result &lt; X<br>MessageBox MB_YESNO|MB_ICONQUESTION "The amount of free space after install will be: $result GB$\r$\n \<br>It is less than what is recommended.$\r$\n \<br>Do you still want to install to this location?" \<br>IDNO Abort<br>${Endif}<br><br><br>It doesn't compile, If yes I want to continue to the next page of the installer, and no I want to abort so it stays at the current page which should work, what is missing?<br><br>thanks,</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">19th August 2010 20:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If you read the manual on MessageBox it needs labels to jump to, not instructions.<br><br>Edit: And you can also do this:<br></p><pre>
<code>${If} ${Cmd} `MessageBox MB_YESNO|MB_ICONQUESTION 'Call Abort?' IDYES`<br>  Abort<br>${EndIf}</code>
</pre><br>
      Stu
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>