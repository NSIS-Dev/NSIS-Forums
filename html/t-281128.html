<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="My Uninstall Runs Twice" />

  <title>My Uninstall Runs Twice - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">My Uninstall Runs Twice</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=281128">My Uninstall Runs Twice</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Boneyhead</span><br />
      <span class="post-time small text-muted">9th November 2007 22:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>My Uninstall Runs Twice</strong><br />
      Every time that I run my uninstaller from Add/Remove appet it runs twice. I load the uninstaller, go through the uninstall (which works fine), get the Finish page, select the finish button and wham, the uninstall dialog just starts over again. After the second time it closes as it should. I can't figure out why this happens. Any idea? My script is:<br />
      <br />
      ;NSIS Modern User Interface<br />
      ;Welcome/Finish Page Example Script<br />
      ;Written by Joost Verburg<br />
      <br />
      ;--------------------------------<br />
      ;Include Modern UI<br />
      <br />
      !include "MUI.nsh"<br />
      <br />
      SetCompressor BZIP2<br />
      <br />
      ;--------------------------------<br />
      ;General<br />
      <br />
      ;Name and file<br />
      Name "MyApp"<br />
      OutFile "\\c343267-a\C\Software\Projects\Gord Corp\ndi_de Projects\Premium\ndi_de\NSIS\ndi_de2.exe"<br />
      XPStyle on<br />
      RequestExecutionLevel admin<br />
      <br />
      !define MUI_ICON "\\c343267-a\C\Software\Projects\Gord Corp\ndi_de Projects\Premium\ndi_de\NSIS\ndi_de.ico"<br />
      !define MUI_UNICON "\\c343267-a\C\Software\Projects\Gord Corp\ndi_de Projects\Premium\ndi_de\NSIS\ndi_de.ico"<br />
      <br />
      ;Default installation folder<br />
      InstallDir "$PROGRAMFILES\MyApp"<br />
      <br />
      ;Get installation folder from registry if available<br />
      InstallDirRegKey HKCU "Software\MyApp" ""<br />
      <br />
      VIAddVersionKey /LANG=${LANG_ENGLISH} "ProductName" "MyApp"<br />
      VIAddVersionKey /LANG=${LANG_ENGLISH} "Comments" "Inventory, backup, restore and locate system drivers."<br />
      VIAddVersionKey /LANG=${LANG_ENGLISH} "CompanyName" "Gord Corp."<br />
      VIAddVersionKey /LANG=${LANG_ENGLISH} "LegalTrademarks" "MyApp is a trademark of Gord Corp."<br />
      VIAddVersionKey /LANG=${LANG_ENGLISH} "LegalCopyright" "Â© Gord Corp. 2003 - 2007"<br />
      VIAddVersionKey /LANG=${LANG_ENGLISH} "FileDescription" "Inventory, backup, restore and locate system drivers."<br />
      VIAddVersionKey /LANG=${LANG_ENGLISH} "FileVersion" "2.1.26"<br />
      <br />
      VIProductVersion "2.1.26.0"<br />
      <br />
      <br />
      ;--------------------------------<br />
      ;Interface Settings<br />
      <br />
      !define MUI_ABORTWARNING<br />
      <br />
      ;--------------------------------<br />
      ;Pages<br />
      <br />
      !insertmacro MUI_PAGE_WELCOME<br />
      !insertmacro MUI_PAGE_LICENSE "\\c343267-a\C\Software\Projects\Gord Corp\ndi_de Projects\Premium\ndi_de\NSIS\Install Path\License.txt"<br />
      !insertmacro MUI_PAGE_DIRECTORY<br />
      !insertmacro MUI_PAGE_INSTFILES<br />
      ;!insertmacro MUI_PAGE_FINISH<br />
      <br />
      !insertmacro MUI_UNPAGE_WELCOME<br />
      !insertmacro MUI_UNPAGE_CONFIRM<br />
      !insertmacro MUI_UNPAGE_INSTFILES<br />
      !insertmacro MUI_UNPAGE_FINISH<br />
      <br />
      ;--------------------------------<br />
      ;Modified Finish Page<br />
      <br />
      !define MUI_PAGE_CUSTOMFUNCTION_PRE fin_pre<br />
      !define MUI_PAGE_CUSTOMFUNCTION_SHOW fin_show<br />
      !define MUI_PAGE_CUSTOMFUNCTION_LEAVE fin_leave<br />
      <br />
      !define MUI_FINISHPAGE_RUN<br />
      !define MUI_FINISHPAGE_RUN_FUNCTION Desc_ShortCut<br />
      !define MUI_FINISHPAGE_RUN_TEXT "Create Desktop Shortcut"<br />
      !insertmacro MUI_PAGE_FINISH<br />
      <br />
      !insertmacro MUI_UNPAGE_WELCOME<br />
      !insertmacro MUI_UNPAGE_CONFIRM<br />
      !insertmacro MUI_UNPAGE_INSTFILES<br />
      !insertmacro MUI_UNPAGE_FINISH<br />
      <br />
      ;--------------------------------<br />
      ;Languages<br />
      <br />
      !insertmacro MUI_LANGUAGE "English"<br />
      <br />
      ;--------------------------------<br />
      ;Installer Functions<br />
      <br />
      Function Desc_Shortcut<br />
      SetOutPath "$INSTDIR"<br />
      CreateShortCut "$DESKTOP\MyApp.lnk" "$INSTDIR\myappexe.exe"<br />
      FunctionEnd<br />
      <br />
      Function fin_show<br />
      ReadINIStr $0 "$PLUGINSDIR\iospecial.ini" "Field 6" "HWND"<br />
      SetCtlColors $0 0x000000 0xFFFFFF<br />
      ReadINIStr $0 "$PLUGINSDIR\iospecial.ini" "Field 7" "HWND"<br />
      SetCtlColors $0 0x000000 0xFFFFFF<br />
      FunctionEnd<br />
      <br />
      Function fin_pre<br />
      WriteINIStr "$PLUGINSDIR\iospecial.ini" "Settings" "NumFields" "6"<br />
      WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 6" "Type" "CheckBox"<br />
      WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 6" "Text" "&amp;Create Quicklaunch Shortcut"<br />
      WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 6" "Left" "120"<br />
      WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 6" "Right" "315"<br />
      WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 6" "Top" "110"<br />
      WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 6" "Bottom" "120"<br />
      WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 6" "State" "1"<br />
      <br />
      WriteINIStr "$PLUGINSDIR\iospecial.ini" "Settings" "NumFields" "7"<br />
      WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 7" "Type" "CheckBox"<br />
      WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 7" "Text" "&amp;Launch MyApp"<br />
      WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 7" "Left" "120"<br />
      WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 7" "Right" "315"<br />
      WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 7" "Top" "130"<br />
      WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 7" "Bottom" "140"<br />
      WriteINIStr "$PLUGINSDIR\iospecial.ini" "Field 7" "State" "1"<br />
      <br />
      FunctionEnd<br />
      <br />
      Function fin_leave<br />
      ReadINIStr $0 "$PLUGINSDIR\iospecial.ini" "Field 6" "State"<br />
      StrCmp $0 "0" end<br />
      SetOutPath "$INSTDIR"<br />
      CreateShortCut "$QUICKLAUNCH\MyApp.lnk" "$INSTDIR\myappexe.exe"<br />
      <br />
      ReadINIStr $0 "$PLUGINSDIR\iospecial.ini" "Field 7" "State"<br />
      StrCmp $0 "0" end<br />
      SetOutPath "$INSTDIR"<br />
      Exec "$INSTDIR\myappexe.exe"<br />
      <br />
      end:<br />
      FunctionEnd<br />
      <br />
      ;--------------------------------<br />
      ;Installer Sections<br />
      <br />
      Section "Dummy Section" SecDummy<br />
      <br />
      SetOutPath "$INSTDIR"<br />
      <br />
      ;ADD YOUR OWN FILES HERE...<br />
      <br />
      File "\\c343267-a\C\Software\Projects\Gord Corp\ndi_de Projects\Premium\ndi_de\myappexe.exe"<br />
      <br />
      File "\\c343267-a\C\Software\Projects\Gord Corp\ndi_de Projects\Premium\ndi_de\Help\myappexe.chm"<br />
      <br />
      File "\\c343267-a\C\Software\Projects\Gord Corp\ndi_de Projects\Premium\ndi_de\NSIS\Install Path\*.*"<br />
      <br />
      SetOutPath "$INSTDIR\bin"<br />
      <br />
      File "\\c343267-a\C\Software\Projects\Gord Corp\ndi_de Projects\Premium\ndi_de\NSIS\bin\*.*"<br />
      <br />
      SetOutPath "$SYSDIR"<br />
      SetOverwrite try<br />
      <br />
      File "\\c343267-a\C\Software\Projects\Gord Corp\ndi_de Projects\Premium\ndi_de\NSIS\System Path\*.*"<br />
      <br />
      SetOutPath "$SYSDIR\wbem"<br />
      SetOverwrite off<br />
      <br />
      File "\\c343267-a\C\Software\Projects\Gord Corp\ndi_de Projects\Premium\ndi_de\NSIS\wbem\*.*"<br />
      <br />
      ;Store installation folder<br />
      WriteRegStr HKCU "Software\MyApp" "" $INSTDIR<br />
      <br />
      ;Create uninstaller<br />
      WriteUninstaller "$INSTDIR\Uninstall.exe"<br />
      <br />
      RegDLL "$INSTDIR\bin\Codejock.CommandBars.v10.4.0.ocx"<br />
      RegDLL "$INSTDIR\bin\Codejock.DockingPane.v10.4.0.ocx"<br />
      RegDLL "$INSTDIR\bin\Codejock.PropertyGrid.v10.4.0.ocx"<br />
      RegDLL "$INSTDIR\bin\Codejock.ReportControl.v10.4.0.ocx"<br />
      RegDLL "$INSTDIR\bin\Codejock.TaskPanel.v10.4.0.ocx"<br />
      <br />
      RegDLL "$SYSDIR\MSCOMCTL.OCX"<br />
      RegDLL "$SYSDIR\msvbvm60.dll"<br />
      RegDLL "$SYSDIR\scrrun.dll"<br />
      RegDLL "$SYSDIR\shfolder.dll"<br />
      <br />
      WriteRegExpandStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp" "UninstallString" '"$INSTDIR\uninstall.exe"'<br />
      WriteRegExpandStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp" "InstallLocation" "$INSTDIR"<br />
      WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp" "DisplayName" "MyApp"<br />
      WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp" "DisplayIcon" "$INSTDIR\myappexe.exe,0"<br />
      WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp" "DisplayVersion" "${VERSION}"<br />
      <br />
      WriteRegDWORD HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp" "NoModify" "1"<br />
      WriteRegDWORD HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp" "NoRepair" "1"<br />
      <br />
      SectionEnd<br />
      <br />
      ;--------------------------------<br />
      ;Descriptions<br />
      <br />
      ;Language strings<br />
      ;LangString DESC_SecDummy ${LANG_ENGLISH} "A test section."<br />
      <br />
      ;Assign language strings to sections<br />
      ;!insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br />
      ;!insertmacro MUI_DESCRIPTION_TEXT ${SecDummy} $(DESC_SecDummy)<br />
      ;!insertmacro MUI_FUNCTION_DESCRIPTION_END<br />
      <br />
      ;--------------------------------<br />
      ;Uninstaller Section<br />
      <br />
      Section "Uninstall"<br />
      <br />
      ;ADD YOUR OWN FILES HERE...<br />
      <br />
      RMDir /r /REBOOTOK "$INSTDIR"<br />
      <br />
      Delete "$DESKTOP\MyApp.lnk"<br />
      Delete "$QUICKLAUNCH\MyApp.lnk"<br />
      <br />
      DeleteRegKey HKCU "Software\MyApp"<br />
      DeleteRegKey HKCU "Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp"<br />
      <br />
      Delete "$INSTDIR\Uninstall.exe"<br />
      <br />
      SectionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">9th November 2007 23:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It doesn't help having the uninstall page macros inserted twice in the same script.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
