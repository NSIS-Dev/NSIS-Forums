<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="abort in leave function should force to reload the page"><title>abort in leave function should force to reload the page - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">abort in leave function should force to reload the page</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=317354">abort in leave function should force to reload the page</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">vogliadicane</span><br><span class="post-time small text-muted">27th February 2010 16:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>abort in leave function should force to reload the page</strong><br>I have one page where the user is requested to download some files by links given on the page.<br><br>In the leave function of this page I check if all files are present, if not Abort.<br>What happens (as expected is) that the page is only NOT LEFT, which means stays as it was before.<br>But I would like to have it reloaded, because some parameters for dinamically creating the page have changed so far, e.g. the user has downloaded some of the files so the links still present on the page are not needed anymore.<br><br>So is it possible to force the page to reload when abort is executed in the leave function?<br><br>(IÂ´ve tried to call the show function of this page but that makes the installer crash)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pengyou</span><br><span class="post-time small text-muted">27th February 2010 20:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You don't need to use a leave function to do this. Just use a loop in your custom page function and generate the page again if some files are missing.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">vogliadicane</span><br><span class="post-time small text-muted">28th February 2010 09:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">not shure, if I get you right. For the "show" function of this cusom page I HAVE a loop, checking for every file if present, and if not an entry for link and text is generated in the ini fields. This works right.<br>The thing is, I donÂ´t know how to invoke this show function again, if the user did not download some files, when he wants to leave the page (so the page should be shown again updated to the new situation).<br>To your post, I donÂ´t know how to generate the page AGAIN.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">28th February 2010 10:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think he means jumping back to the beginning of the page creation function after nsDialogs::Show finishes.<br><br>Unrelated question: Why don't you use a download plugin to download the missing files automatically?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">vogliadicane</span><br><span class="post-time small text-muted">28th February 2010 12:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">these must be downloaded manually (for legal reasons), ad clicks and so... all others are downloaded automatically :)<br><br>btw IÂ´m using InstallOptions..<br>hereÂ´s my code (truncated):<br><br>Function ShowCustomMan<br>StrCpy $MaxField 1<br><br>${ForEach} $R1 1 8 + 1<br>StrCmp $FileXPresent 0 +1 +6<br>WriteIniStr "$PLUGINSDIR\man.ini" "Field $R1" "State" "${FileX_URL}"<br>WriteIniStr "$PLUGINSDIR\man.ini" "Field $R1" "Text" "FileX"<br>StrCpy $FileXPresent 2<br>IntOp $MaxField $R1 + 1<br>Goto End<br><br>... other file exitence checks and writeinistr...<br><br>End:<br>${Next}<br><br>StrCmp $MaxField 9 Skip +1<br>${ForEach} $R1 $MaxField 8 + 1<br>WriteIniStr "$PLUGINSDIR\man.ini" "Field $R1" "State" ""<br>WriteIniStr "$PLUGINSDIR\man.ini" "Field $R1" "Text" ""<br>${Next}<br>Skip:<br><br>StrCmp $MaxField 1 +1 +2<br>Abort<br>InstallOptions::dialog "$PLUGINSDIR\man.ini"<br>Pop $0<br>InstallOptions::show<br>Pop $0<br>FunctionEnd<br><br>edit: for information $FileXPresent is the variable that is updated to 1 in the leave function, if the file now exists.<br><br>I donÂ´t get, how to jump back to this function, when leaving the page and some files are still missing, sorry, if IÂ´m repeating myself, but I think thereÂ´s something basic I donÂ´t get here...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pengyou</span><br><span class="post-time small text-muted">28th February 2010 14:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You should have mentioned you were using InstallOptions earlier. Here is a simple example of the idea I suggested you try:</p><pre>
<code>Function ShowFileList<br><br>loop:<br>  StrCpy $0 0<br><br>  IfFileExists "$PLUGINSDIR\file-1.exe" check_2<br>  IntOp $0 $0 + 1<br>  WriteIniStr "$PLUGINSDIR\sfl.ini" "Field $0" "Text" "Download file-1.exe"<br><br>check_2:<br>  IfFileExists "$PLUGINSDIR\file-2.exe" check_3<br>  IntOp $0 $0 + 1<br>  WriteIniStr "$PLUGINSDIR\sfl.ini" "Field $0" "Text" "Download file-2.exe"<br><br>check_3:<br>  IfFileExists "$PLUGINSDIR\file-3.exe" check_4<br>  IntOp $0 $0 + 1<br>  WriteIniStr "$PLUGINSDIR\sfl.ini" "Field $0" "Text" "Download file-3.exe"<br>  <br>check_4:<br>  IfFileExists "$PLUGINSDIR\file-4.exe" show_page<br>  IntOp $0 $0 + 1<br>  WriteIniStr "$PLUGINSDIR\sfl.ini" "Field $0" "Text" "Download file-4.exe"<br>  <br>show_page:<br>  StrCmp $0 0 all_done<br>  WriteIniStr "$PLUGINSDIR\sfl.ini" "Settings" "NumFields" "$0"<br>  !insertmacro INSTALLOPTIONS_DISPLAY "sfl.ini"<br>  Goto loop<br>  <br>all_done:<br>FunctionEnd<br></code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vogliadicane</span><br>
      <span class="post-time small text-muted">28th February 2010 15:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hmm more elegant than my way. But isnÂ´t it creating an infinite loop I mean one which hangs up the machine, if some file is missing?<br>
      Anyway thanks IÂ´ll give it a try!<br>
      <br>
      edit: No loop! Integrated the "Loop .... Goto Loop" into my script and it works! Seems the INSTALLOPTIONS_DISPLAY macro stops until some notify event happens!<br>
      <br>
      So this was exactly, what I was looking for, Thanks! :D</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pengyou</span><br>
      <span class="post-time small text-muted">1st March 2010 12:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Glad to hear that you have managed to solve your problem.<br>
      <br>
      Sorry my first reply did not go into much detail. INSTALLOPTIONS_DISPLAY and its companion macro INSTALLOPTIONS_DISPLAY_RETURN are documented in the InstallOptions2 Readme installed with NSIS. The Readme is also available online:<br>
      <a href="http://nsis.sourceforge.net/Docs/InstallOptions/Readme.html" target="_blank">http://nsis.sourceforge.net/Docs/Ins...ns/Readme.html</a></p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vogliadicane</span><br>
      <span class="post-time small text-muted">1st March 2010 21:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">no prob, actually itÂ´s me who is to blame I have the readme but obviously didnÂ´t read accurately. And I really beleived, a code like that would hang up the machine. next time IÂ´ll just try. (IÂ´m just beginning to script NSIS)<br>
      <br>
      Anyway thanks for help again :)</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>