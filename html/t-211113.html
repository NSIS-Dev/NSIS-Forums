<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="VersionCheckNew testing"><title>VersionCheckNew testing - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">VersionCheckNew testing</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=211113">VersionCheckNew testing</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">22nd March 2005 19:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>VersionCheckNew testing</strong><br>I've tried and tested the function so many times, but there's always one version string comparison kind that gets through with false results.<br><br>The last update to the function was to compare each digit of the numbers between the dots one by one. However, recently Daijoubu reported that it would fail on 7 &amp; 10. This is because it would compare 7 with 1 and immediately think the 1st one was larger! I've fixed the problem now (which has made the function even bigger!)<br><br>I was wondering if anyone could test the function more for me, which is here:<br><a href="http://nsis.sourceforge.net/archive/edit.php?pageid=533&amp;instances=0,757" target="_blank">http://nsis.sourceforge.net/archive/...nstances=0,757</a><br><br>If you find one that fails, post it here so I can see it.<br><br>Cheers<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Instructor</span><br><span class="post-time small text-muted">23rd March 2005 09:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Probably Afrow UK mean:<br><a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=757&amp;instances=0,11,122,754" target="_blank">http://nsis.sourceforge.net/archive/...s=0,11,122,754</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Instructor</span><br><span class="post-time small text-muted">23rd March 2005 09:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>(which has made the function even bigger!)</blockquote>It's because there is check per digit per number and many exceptions. I choose other way - digits capacity in VersionCompare. I don't found any false results in VersionCheckNew (v4).</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">23rd March 2005 12:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ah yeh, sorry I posted link to edit :)<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Instructor</span><br><span class="post-time small text-muted">28th March 2005 10:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><pre>
<code>${VersionCheckNew} "91.1.1.1" "101.1.1.1" $R0</code>
</pre>$R0="1"</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">28th March 2005 20:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks Instructor. I found that problem a few days ago too and I think it's fixed now. It took me a few hours, but I thought of a new solution which should fix all the problems.<br>Uploaded as v5<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Instructor</span><br><span class="post-time small text-muted">29th March 2005 09:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Very bad that you don't trying to see what do others :(<br><br><br>P.S.</p><pre>
<code>${VersionCheckV5} "1.001" "1.0" $R0</code>
</pre>$R0="2"</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">29th March 2005 11:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks fixed.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">glory_man</span><br><span class="post-time small text-muted">7th June 2005 13:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Version "1.00" is newer than "1.0". Is it supposed to be?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">7th June 2005 13:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'd just use Instructors VersionCompare :p<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">glory_man</span><br><span class="post-time small text-muted">7th June 2005 13:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Another question (general).<br>Why "1.1.1.1" not equal to "1.1.1.01"?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">7th June 2005 13:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Because 01 is older than 1, as we go up in 01, 02, 03, to 1. 1 would be counted as "10".<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">glory_man</span><br><span class="post-time small text-muted">7th June 2005 14:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Than, if I include in script<br></p><pre>
<code>VIProductVersion "1.1.0.001"<br>VIAddVersionKey "LegalCopyright" 'Ltd.'<br>VIAddVersionKey "FileDescription" "Test file"<br>VIAddVersionKey "FileVersion" "1.1.0.001"<br></code>
</pre><br>
      And use GetDllVersion - version will be 1.1.0.<b>1</b>. Why?
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">7th June 2005 14:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">NSIS treats 001 in a variable as 1 (when using IntOp)<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br>
      <span class="post-time small text-muted">7th June 2005 20:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        Because 01 is older than 1, as we go up in 01, 02, 03, to 1. 1 would be counted as "10".
      </blockquote>My opinion is that, the extra zeros in versions are just to show how the author organizes his versions. I think, zeros should be ignored if they are on the left of the number. Example: 1.01 = 1.00001. By this reasoning, I think Afrow UK is wrong in saying that 1.01 is older than 1.1, because it's like giving the extra digit a separation mark, like the ".". With Afrow's idea, what would be newer: 1.00, 1.0 or 1?<br>
      <br>
      To make a version comparasion with only numbers, it's a matter of comparing the numbers inside the four groups w/ IntCmp, nothing more (and logically converting those numbers to be supported as decimal by NSIS, because 001 is considered as an octal number).
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br>
      <span class="post-time small text-muted">8th June 2005 08:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        I think, zeros should be ignored if they are on the left of the number. Example: 1.01 = 1.00001. By this reasoning, I think Afrow UK is wrong in saying that 1.01 is older than 1.1, because it's like giving the extra digit a separation mark, like the ".".
      </blockquote>Afrow UK isn't wrong:<br>
      1.01 != 1.00001, because 1.01 != 1.10<br>
      In your words NSIS 2.01 = NSIS 2.1 (it will be I hope :) )
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">glory_man</span><br>
      <span class="post-time small text-muted">8th June 2005 11:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        My opinion is that, the extra zeros in versions are just to show how the author organizes his versions. I think, zeros should be ignored if they are on the left of the number. Example: 1.01 = 1.00001. By this reasoning, I think Afrow UK is wrong in saying that 1.01 is older than 1.1, because it's like giving the extra digit a separation mark, like the ".".
      </blockquote>I am subscribe to this opinion.<br>
      <br>
      2Instructor<br>

      <blockquote>
        Afrow UK isn't wrong:<br>
        1.01 != 1.00001, because 1.01 != 1.10<br>
        In your words NSIS 2.01 = NSIS 2.1 (it will be I hope :))
      </blockquote>I don't agree. NSIS 2.01 has full version number 2.<b>0.</b>1, NSIS 2.1 wil be - 2.<b>1.</b>0.<br>
      In your words 1 kg 1000 times greater than 0001 kg.:):D
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br>
      <span class="post-time small text-muted">8th June 2005 12:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What sense give to the program version 1.01, if the same is 1.1? I saw only one reason: if number 1.01 compared with 1.1 it will be older :)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br>
      <span class="post-time small text-muted">8th June 2005 12:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>TIP: Versioning scheme as I see it...</strong><br>
      I agree there is IMHO no sense in versioning 1.02<br>
      This is for me v1.0.2.x<br>
      Versioning scheme as I see it...<br>
      <br>
      A.B.C.D<br>
      <br>
      A = Product Major Version<br>
      B = Product Feature Release<br>
      C = Product Release incrementeal ID<br>
      D = Fix/Test/Debug/ for short the Build number<br>
      <br>
      Example for a e.g. wordprocessor:<br>
      <br>
      0.x = Initial development<br>
      1.0.0.0 = Initial Debug Release<br>
      1.0.0.57 = 57th testing build<br>
      1.0.1.1 = Initial "official" build<br>
      1.0.1.33 = 33rd fix for the official build<br>
      1.0.2.1 = Second "official" build including all bug fixes<br>
      1.1.1.278 = Now we have a spell checker<br>
      1.2.1.45 = And a thesaurus.<br>
      2.0.1.352 = And we introduced Linux compatibility because we built it with Kylix :)<br>
      <br>
      Use this structure internally, it works very well. A customer needs to know A.B for features, A.B.C for fixes to features, and we use D internally for testing/debugging and emergency fixes for when taxes don't add up.<br>
      <br>
      Success to everyone to streamline the versioning of your releases.<br>
      <br>
      Emin</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br>
      <span class="post-time small text-muted">10th June 2005 16:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">normally its used this way:<br>
      major.minor.release.build<br>
      <br>
      for most open source projects:<br>
      1.0.0.xxx - first public release<br>
      1.1.0.1 - first beta for 1.2 release<br>
      1.2.0.xxx - second public release<br>
      1.9.xx.xxx - beta releases for 2.0 RC<br>
      2.0.0.xxx - second major version, means bigger changes.<br>
      <br>
      and so on ...<br>
      the last number ("build") is increased everytime a new beta/release is build and reset everytime the releasenumber changes.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">NHOCSUNG</span><br>
      <span class="post-time small text-muted">10th June 2005 23:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">you try this ... i didn't find any problem<br>
      <br>
      !insertmacro STRFUNC_DEFFUNC VersionCheck<br>
      !define VersionCheck_List `ResultVar|CurVersion|CmpVersion`<br>
      !define VersionCheck_TypeList `Output 0 1 2|Text|Text`<br>
      !macro `FUNCTION_STRING_UnVersionCheck`<br>
      !undef UnVersionCheck<br>
      !insertmacro FUNCTION_STRING_VersionCheck<br>
      !macroend<br>
      <br>
      !macro FUNCTION_STRING_VersionCheck<br>
      !insertmacro STRFUNC_FUNC `VersionCheck` `2004 - 2005 Tu Tong - Based on functions by Tu Tong`<br>
      <br>
      Exch $R0<br>
      Exch<br>
      Exch $R1<br>
      Exch<br>
      Push $R2<br>
      Push $R3<br>
      Push $R4<br>
      Push $R5<br>
      Push $R6<br>
      Push $R7<br>
      <br>
      StrCmp $R0 "" error 0<br>
      StrCmp $R1 "" error 0<br>
      <br>
      StrCmp $R0 $R1 sameversion 0<br>
      <br>
      ClearErrors<br>
      loop:<br>
      IfErrors sameversion<br>
      StrCmp $R0 "" sameversion<br>
      StrCmp $R1 "" sameversion<br>
      <br>
      StrCpy $R4 $R0<br>
      GetLabelAddress $R7 return<br>
      Goto parse<br>
      return:<br>
      StrCpy $R6 $R3<br>
      StrCpy $R0 $R4<br>
      <br>
      StrCpy $R4 $R1<br>
      GetLabelAddress $R7 return1<br>
      Goto parse<br>
      return1:<br>
      StrCpy $R5 $R3<br>
      StrCpy $R1 $R4<br>
      <br>
      IntCmp $R6 $R5 0 olderversion newerversion<br>
      Goto loop<br>
      <br>
      parse:<br>
      StrCpy $R2 0<br>
      StrLen $R5 $R4<br>
      parseloop:<br>
      StrCpy $R3 $R4 1 $R2<br>
      StrCmp $R3 "." parsecpy 0<br>
      IntCmp $R5 $R2 parsecpy parsecpy 0<br>
      IntOp $R2 $R2 + 1<br>
      Goto parseloop<br>
      <br>
      parsecpy:<br>
      StrCpy $R3 $R4 $R2<br>
      <br>
      IntOp $R5 $R5 - $R2<br>
      IntOp $R2 $R2 + 1<br>
      StrCpy $R4 $R4 $R5 $R2<br>
      Goto $R7<br>
      <br>
      newerversion:<br>
      StrCpy $R0 "2"<br>
      Goto checkdone<br>
      <br>
      sameversion:<br>
      StrCpy $R0 "0"<br>
      Goto checkdone<br>
      <br>
      olderversion:<br>
      StrCpy $R0 "1"<br>
      Goto checkdone<br>
      <br>
      error:<br>
      StrCpy $R0 ""<br>
      <br>
      checkdone:<br>
      ClearErrors<br>
      <br>
      <br>
      Pop $R7<br>
      Pop $R6<br>
      Pop $R5<br>
      Pop $R4<br>
      Pop $R3<br>
      Pop $R2<br>
      Pop $R1<br>
      Exch $R0<br>
      <br>
      ;------------------------<br>
      ;End<br>
      <br>
      FunctionEnd<br>
      <br>
      !macro FUNCTION_STRING_VersionCheck_Call ResultVar CurVersion CmpVersion<br>
      !verbose push<br>
      !verbose 4<br>
      !echo `$ {VersionCheck} "${ResultVar}" "${CurVersion}" "${CmpVersion}"`<br>
      !verbose pop<br>
      <br>
      Push `${CurVersion}`<br>
      Push `${CmpVersion}`<br>
      Call VersionCheck<br>
      Pop `${ResultVar}`<br>
      !macroend<br>
      !macro FUNCTION_STRING_UnVersionCheck_Call ResultVar CurVersion CmpVersion<br>
      !verbose push<br>
      !verbose 4<br>
      !echo `$ {UnVersionCheck} "${ResultVar}" "${CurVersion}" "${CmpVersion}"`<br>
      !verbose pop<br>
      <br>
      Push `${CurVersion}`<br>
      Push `${CmpVersion}`<br>
      Call un.VersionCheck<br>
      Pop `${ResultVar}`<br>
      !macroend<br>
      <br>
      !macroend</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br>
      <span class="post-time small text-muted">11th June 2005 04:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's better for you to post a normal function, because UseFunc (old StrFunc) is being developed, so this function would need to be changed to adapt to future newer versions.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">NHOCSUNG</span><br>
      <span class="post-time small text-muted">24th August 2005 21:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">okay deguix i'll post normal function<br>
      <br>
      here my update<br>
      <br>
      Function VersionCheck<br>
      Exch $R1<br>
      Exch<br>
      Exch $R0<br>
      Exch<br>
      Push $R2<br>
      Push $R3<br>
      Push $R4<br>
      Push $R5<br>
      Push $R6<br>
      <br>
      ${If} $R0 == ""<br>
      ${OrIf} $R1 == ""<br>
      Goto Error<br>
      ${EndIf}<br>
      <br>
      StrCmp $R0 $R1 sameversion<br>
      <br>
      StrCpy $R4 $R0<br>
      Call :complete<br>
      StrCpy $R0 $R4<br>
      <br>
      StrCpy $R4 $R1<br>
      Call :complete<br>
      StrCpy $R1 $R4<br>
      <br>
      Goto compare<br>
      <br>
      complete:<br>
      StrCpy $R6 0<br>
      StrCpy $R2 0<br>
      StrLen $R5 $R4<br>
      ${Do}<br>
      StrCpy $R3 $R4 1 $R2<br>
      ${If} $R3 == "."<br>
      IntOp $R6 $R6 + 1<br>
      ${EndIf}<br>
      ${IfThen} $R2 &gt;= $R5 ${|} ${ExitDo} ${|}<br>
      IntOp $R2 $R2 + 1<br>
      ${Loop}<br>
      <br>
      ${Select} $R6<br>
      ${Case} 0<br>
      StrCpy $R4 "$R4.0.0.0"<br>
      ${Case} 1<br>
      StrCpy $R4 "$R4.0.0"<br>
      ${Case} 2<br>
      StrCpy $R4 "$R4.0"<br>
      ${CaseElse}<br>
      StrCpy $R4 "$R4"<br>
      ${EndSelect}<br>
      Return<br>
      <br>
      compare:<br>
      ClearErrors<br>
      Loop:<br>
      IfErrors sameversion<br>
      StrCmp $R0 "" sameversion<br>
      StrCmp $R1 "" sameversion<br>
      <br>
      StrCpy $R4 $R0<br>
      Call :parse<br>
      StrCpy $R6 $R3<br>
      StrCpy $R0 $R4<br>
      <br>
      StrCpy $R4 $R1<br>
      Call :parse<br>
      StrCpy $R5 $R3<br>
      StrCpy $R1 $R4<br>
      <br>
      IntCmp $R6 $R5 0 olderversion newerversion<br>
      Goto Loop<br>
      <br>
      parse:<br>
      StrCpy $R2 0<br>
      StrLen $R5 $R4<br>
      ${Do}<br>
      StrCpy $R3 $R4 1 $R2<br>
      ${IfThen} $R3 == "." ${|} ${ExitDo} ${|}<br>
      ${IfThen} $R2 &gt;= $R5 ${|} ${ExitDo} ${|}<br>
      IntOp $R2 $R2 + 1<br>
      ${Loop}<br>
      <br>
      StrCpy $R3 $R4 $R2<br>
      <br>
      IntOp $R5 $R5 - $R2<br>
      IntOp $R2 $R2 + 1<br>
      StrCpy $R4 $R4 $R5 $R2<br>
      Return<br>
      <br>
      olderversion:<br>
      StrCpy $R0 "2"<br>
      Goto checkdone<br>
      <br>
      newerversion:<br>
      StrCpy $R0 "1"<br>
      Goto checkdone<br>
      <br>
      sameversion:<br>
      StrCpy $R0 "0"<br>
      Goto checkdone<br>
      <br>
      error:<br>
      StrCpy $R0 ""<br>
      <br>
      checkdone:<br>
      ClearErrors<br>
      <br>
      Pop $R6<br>
      Pop $R5<br>
      Pop $R4<br>
      Pop $R3<br>
      Pop $R2<br>
      Pop $R1<br>
      Exch $R0<br>
      <br>
      FunctionEnd</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>