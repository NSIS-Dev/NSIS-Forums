<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Interface UserInfo with another installer" />

  <title>Interface UserInfo with another installer - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Interface UserInfo with another installer</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=204218">Interface UserInfo with another installer</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SoundScape_2910</span><br />
      <span class="post-time small text-muted">8th January 2005 00:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Interface UserInfo with another installer</strong><br />
      Hello evrybody,<br />
      <br />
      I have some programming questions about the NSIS plugin UserInfo. I am trying to interface this DLL with Installer VISE so that when the installer initialises, the type of user (Admin,User,Power User, e.t.c.) can be determined. Does anyone know who wrote UserInfo plugin and how I can contact him? Thanks in advance!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">8th January 2005 01:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I wrote it. Take a look at Source\exehead\exec.c line 909 (case EW_REGISTERDLL: ) to see how it's called. The source code to the plug-in itself is available in Contrib\UserInfo.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">8th January 2005 02:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">this should get you started: <a href="http://www.elists.org/pipermail/delphi/2002-December/022392.html" target="_blank">http://www.elists.org/pipermail/delp...er/022392.html</a><br />
      <br />
      edit: hah, the browser window was open for more than an hour, forgot to click submit, guess this is useless now...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SoundScape_2910</span><br />
      <span class="post-time small text-muted">10th January 2005 00:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">kichik,<br />
      <br />
      I didn't quite understand the part "Take a look at Source\exehead\exec.c line 909 (case EW_REGISTERDLL to see how it's called". Sorry! Where can I find it? Also, I am aware about the source code of UserInfo, I studied it. The problem is this: The help file of Installer VISE says the following about interfacing an external DLL:<br />
      <br />
      To build an external code dll follow these steps.<br />
      <br />
      An external code .dll file is a Windows dynamic library with at least one procedure exported. That procedure must look like this:<br />
      <br />
      extern "C" LONG CALLBACK ViseEntry(LONG lParam1, LPCSTR lpParam2, DWORD dwReserved)<br />
      <br />
      This is the entry procedure that will be called by the setup program. (See "Creating External Code for Installer VISE Installers" below for more details.)<br />
      <br />
      Your external code file must be 32-bit. You can copy the skeleton project in the ExtCodes folder and use it as a starting point. This example code displays a simple message box to the user.<br />
      <br />
      Creating External Code for Installer VISE Installers<br />
      <br />
      In order to interface with an Installer VISE installer, your external code must have a main entry point as follows:<br />
      <br />
      extern "C" LONG CALLBACK ViseEntry(LONG lParam1, LPCSTR lpParam2, DWORD dwReserved)<br />
      <br />
      If you need access to information returned by calling the external code (beyond simple success or failure), your code source must also include the following class definition:<br />
      <br />
      class CViseEntryData<br />
      <br />
      {<br />
      <br />
      public:<br />
      <br />
      HWND m_hwndMain; // Main window handle<br />
      HWND m_hwndProgress; // Progress dialog window handle<br />
      BOOL m_bUninstall; // Uninstaller flag<br />
      LPCSTR m_lpszUninstallLogFile; // Uninstall log file path<br />
      LPCSTR m_lpszTempDir; // Installer VISEâ€™s temp directory path<br />
      HINSTANCE m_hinst; // Instance handle of the VISE dll<br />
      char m_szInstallerName[_MAX_PATH]; // Name of the installer<br />
      // eSellerate shopping cart data<br />
      LONG m_nShoppingCartCount; // Number of items in the shopping cart<br />
      <br />
      LPCSTR m_lpShoppingCartSKU[64]; // Array to list SKU IDs corresponding to<br />
      // items in the shopping cart<br />
      LPCSTR m_lpShoppingCartID[64]; // Array to list Product IDs corresponding<br />
      // to items in the shopping cart<br />
      // eSellerate serial number data<br />
      LONG m_nSerialNumberCount; // Number of serial numbers issued<br />
      LPCSTR m_lpSerialNumberID[64]; // Array to list Product IDs corresponding<br />
      // to listed serial numbers<br />
      LPCSTR m_lpSerialNumber[64]; // Array to list serial numbers<br />
      <br />
      LPCSTR m_lpSerialNumberKey[64]; // Array to list Name-based Keys<br />
      // corresponding to listed serial numbers<br />
      // eSellerate file location data<br />
      LONG m_nFileLocationCount; // Number of files downloaded<br />
      LPCSTR m_lpFileLocationID[64]; // Array to list Product IDs corresponding<br />
      // to downloaded files<br />
      <br />
      LPCSTR m_lpFileLocation[64]; // Array to list locations of downloaded<br />
      // files<br />
      <br />
      };<br />
      <br />
      In order to correctly format the information defined in the CViseEntryData class, your external code must include the following line:<br />
      <br />
      CViseEntryData* pViseEntryData = (CViseEntryData*)dwReserved;<br />
      <br />
      You may then access the CViseEntryData class information in your external code using the following convention:<br />
      <br />
      pViseEntryData-&gt;m_lpszTempDir;<br />
      <br />
      <br />
      Now, how can I use the above code in UserInfo? Which function should I call in the "extern "C" LONG CALLBACK ViseEntry(LONG lParam1, LPCSTR lpParam2, DWORD dwReserved)" function?<br />
      <br />
      Thanks in advance!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">10th January 2005 10:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The file Source\exehead\exec.c can be found in the folder where you've installed NSIS.<br />
      <br />
      I suggest you copy the code in GetAccountType from UserInfo.c into your ViseEntry and adjust it to fit. Calling GetAccountType from ViseEntry is a mess not worth getting into.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
