<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="REG_MULTI_SZ reader problem"><title>REG_MULTI_SZ reader problem - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">REG_MULTI_SZ reader problem</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=204100">REG_MULTI_SZ reader problem</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">jfellis</span><br><span class="post-time small text-muted">6th January 2005 23:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>REG_MULTI_SZ reader problem</strong><br>Hi,<br><br>I am trying to use the REG_MULTI_SZ reader posted in the Archives and am failing to get it to run for me.<br><br>I would like to read the PagingFiles memory setting -- and then set them if they are not correct. After I get the read method to work, I will try the writer.<br><br>I only edited the three lines between the "Edited this" and "Stop editing" AND I took out the 'bla' and put in the ${Value} about line 86:<br>System::Call "${RegQueryValueEx}(r4, ${VALUE}, 0, 0, r1, r2) .r3"<br><br>I keep getting: "Can't query registry value (2)[2]"<br><br>Also, where can I read about the meaning of a system call function like: System::Call "*(i) i (0) .r0"<br>I am having trouble understanding that call and similar ones.<br><br>Thanks to all.<br><br><br>Here is the code:<br><br>OutFile "REG_MULTI_SZ Reader.exe"<br><br>Name "REG_MULTI_SZ Reader"<br><br>ShowInstDetails show<br><br>!define HKEY_CLASSES_ROOT 0x80000000<br>!define HKEY_CURRENT_USER 0x80000001<br>!define HKEY_LOCAL_MACHINE 0x80000002<br>!define HKEY_USERS 0x80000003<br>!define HKEY_PERFORMANCE_DATA 0x80000004<br>!define HKEY_PERFORMANCE_TEXT 0x80000050<br>!define HKEY_PERFORMANCE_NLSTEXT 0x80000060<br>!define HKEY_CURRENT_CONFIG 0x80000005<br>!define HKEY_DYN_DATA 0x80000006<br><br>!define KEY_QUERY_VALUE 0x0001<br>!define KEY_ENUMERATE_SUB_KEYS 0x0008<br><br>!define REG_MULTI_SZ 7<br><br>!define RegOpenKeyEx "Advapi32::RegOpenKeyExA(i, t, i, i, i) i"<br>!define RegQueryValueEx "Advapi32::RegQueryValueExA(i, t, i, i, i, i) i"<br>!define RegCloseKey "Advapi32::RegCloseKeyA(i) i"<br><br>####### Edited this!<br><br>!define ROOT_KEY ${HKEY_LOCAL_MACHINE}<br>!define SUB_KEY "SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management"<br>!define VALUE "PagingFiles"<br><br>####### Stop editing<br><br>Section "Read"<br>StrCpy $0 ""<br>StrCpy $1 ""<br>StrCpy $2 ""<br>StrCpy $3 ""<br>SetPluginUnload alwaysoff<br>System::Call "*(i) i (0) .r0"<br>System::Call "*(i) i (0) .r1"<br>System::Call "*(i) i (0) .r2"<br>System::Call "${RegOpenKeyEx}(${ROOT_KEY}, '${SUB_KEY}', \<br>0, ${KEY_QUERY_VALUE}|${KEY_ENUMERATE_SUB_KEYS}, r0) .r3"<br><br>StrCmp $3 0 goon<br>MessageBox MB_OK|MB_ICONSTOP "Can't open registry key! ($3)"<br>Goto done<br>goon:<br><br>System::Call "*$0(&amp;i4 .r4)"<br>System::Call "${RegQueryValueEx}(r4, '${VALUE}', 0, r1, 0, r2) .r3"<br><br>StrCmp $3 0 read<br>MessageBox MB_OK|MB_ICONSTOP "Can't query registry value! ($3)"<br>Goto done<br><br>read:<br><br>System::Call "*$1(&amp;i4 .r3)"<br><br>StrCmp $3 ${REG_MULTI_SZ} multisz<br>MessageBox MB_OK|MB_ICONSTOP "Registry value no SZ_MULTI_SZ! ($3)"<br>Goto done<br><br>multisz:<br><br>System::Call "*$2(&amp;i4 .r3)"<br><br>StrCmp $3 0 0 multiszalloc<br>MessageBox MB_OK|MB_ICONSTOP "Registry value empty! ($3)"<br>Goto done<br><br>multiszalloc:<br><br>System::Free $1<br>System::Alloc $3<br>Pop $1<br><br>StrCmp $1 0 0 multiszget<br>MessageBox MB_OK|MB_ICONSTOP "Can't allocate enough memory! ($3)"<br>Goto done<br><br>multiszget:<br><br>System::Call "${RegQueryValueEx}(r4, ${VALUE}, 0, 0, r1, r2) .r3"<br><br>StrCmp $3 0 multiszprocess<br>MessageBox MB_OK|MB_ICONSTOP "Can't query registry value! ($3)[2]"<br>Goto done<br><br>multiszprocess:<br><br>StrCpy $4 $1<br><br>loop:<br><br>System::Call "*$4(&amp;t${NSIS_MAX_STRLEN} .r3)"<br>StrCmp $3 "" done<br>DetailPrint $3<br>StrLen $5 $3<br>IntOp $4 $4 + $5<br>IntOp $4 $4 + 1<br>Goto loop<br><br>done:<br><br>System::Free $2<br>System::Free $1<br><br>StrCmp $0 0 noClose<br>System::Call "${RegCloseKey}(r0)"<br><br>noClose:<br><br>SetPluginUnload manual<br>System::Free $0<br>SectionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">7th January 2005 11:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I have removed 'bla' from Archive page. I have already fixed the script in the Useful Information section of the documentation, but apparently I forgot to fix it in the Archive.<br><br>As for your error, try quoting ${VALUE}. It should work then.<br><br>System::Call "*(i) i (0) .r0" creates a structure with one integer in it. It actually just allocates four bytes for an integer. You should be able to find information about that at the end of the System plug-in documentation.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jfellis</span><br><span class="post-time small text-muted">7th January 2005 17:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks!!!<br><br>You guys are a great help and NSIS is amazing.<br><br>John</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>