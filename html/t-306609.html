<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Call::DLL ???" />

  <title>Call::DLL ??? - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Call::DLL ???</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=306609">Call::DLL ???</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Inazad</span><br />
      <span class="post-time small text-muted">21st May 2009 18:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Call::DLL ???</strong><br />
      HI there,<br />
      <br />
      I really need help for this section :<br />
      <br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #0000BB">Section</span><span style="color: #007700">-</span><span style="color: #0000BB">BD<br />
      CallCreateDatabaseAndBasicData<br />
      <br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">'Crypto::GeneratePWDSecutityString(v).EncryptionKey'<br /></span> <span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">'Crypto::EncodePWDEx(t,t)t(.BdUser,.EncryptionKey)'<br /></span> <span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">'Crypto::EncodePWDEx(t,t)t(.BdPass,.EncryptionKey)'<br />
      <br /></span> <span style="color: #0000BB">WriteINIStr</span><span style="color: #DD0000">"$PathIniFile\${IniFile}.INI""sql""Nom_Database"</span><span style="color: #0000BB">$BdName<br />
      WriteINIStr</span><span style="color: #DD0000">"$PathIniFile\${IniFile}.INI""sql""IP"</span><span style="color: #0000BB">$BdHost<br />
      WriteINIStr</span><span style="color: #DD0000">"$PathIniFile\${IniFile}.INI""sql""g"</span><span style="color: #0000BB">$BdUser<br />
      WriteINIStr</span><span style="color: #DD0000">"$PathIniFile\${IniFile}.INI""sql""e"</span><span style="color: #0000BB">$BdPass<br />
      WriteINIStr</span><span style="color: #DD0000">"$PathIniFile\${IniFile}.INI""sql""f"</span><span style="color: #0000BB">$EncryptionKey<br />
      WriteINIStr</span><span style="color: #DD0000">"$PathIniFile\${IniFile}.INI""sql""Type""15632"<br /></span> <span style="color: #0000BB">SectionEnd<br /></span></span> <!-- php buffer end -->
      <hr />
      My installer crashes and do not compile with these error log :<br />
      <br />
      PHP Code:
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #0000BB">Processed1file</span><span style="color: #007700">,</span><span style="color: #0000BB">writingoutput</span><span style="color: #007700">:<br /></span> <span style="color: #0000BB">Addingplug</span><span style="color: #007700">-</span><span style="color: #0000BB">insinitializing</span><span style="color: #007700">function...</span><span style="color: #0000BB">Done</span><span style="color: #007700">!<br /></span> <span style="color: #0000BB">Error</span><span style="color: #007700">:</span><span style="color: #0000BB">resolvinginstall</span><span style="color: #007700">function</span><span style="color: #DD0000">"Crypto::GeneratePWDSecutityString(v).EncryptionKey"</span><span style="color: #0000BB">inunnamedinstallsection</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">)<br /></span> <span style="color: #0000BB">Note</span><span style="color: #007700">:</span><span style="color: #0000BB">uninstallfunctionsmustbeginwith</span><span style="color: #DD0000">"un."</span><span style="color: #007700">,and</span><span style="color: #0000BB">installfunctionsmustnot<br />
      Error</span><span style="color: #007700">-</span><span style="color: #0000BB">abortingcreationprocess<br /></span></span> <!-- php buffer end -->
      <hr />
      I'm waiting your answers!<br />
      <br />
      Thanks!
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Inazad</span><br />
      <span class="post-time small text-muted">21st May 2009 19:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Call DLL ??</strong><br />
      Section -BD<br />
      Call CreateDatabaseAndBasicData<br />
      <br />
      File Crypto.dll<br />
      System::Call 'Crypto::GeneratePWDSecurityString(v) (v).EncryptionKey'<br />
      System::Call 'Crypto::EncodePWDEx(t, t) t(.BdUser, .EncryptionKey).BdUser'<br />
      System::Call 'Crypto::EncodePWDEx(t, t) t(.BdPass, .EncryptionKey).BdPass'<br />
      <br />
      SectionEnd<br />
      <br />
      There is the declaration of my dll' functions :<br />
      <br />
      string GeneratePWDSecurityString();<br />
      string EncodePWDEx(string, string);<br />
      <br />
      My installers is crashing... Don't know why :( Do I have the good syntax because my code compiles well...<br />
      <br />
      Thanks</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DrO</span><br />
      <span class="post-time small text-muted">21st May 2009 20:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">[moderation]<br />
      threads merged due to posting in the translation sub-forum as well.<br />
      [/moderation]<br />
      <br />
      -daz</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">22nd May 2009 10:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You have to quote that BdUser and EncryptionKey strings if they are strings. If those are actually variables, then replace them with one of the regular variables because that's all System supports.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Inazad</span><br />
      <span class="post-time small text-muted">22nd May 2009 12:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Do you have an example ??<br />
      <br />
      Because I'm new in this and I want that section works..<br />
      <br />
      I wrote this line of code and my installer crashes :<br />
      <br />
      System::Call 'Crypto::EncodePWDEx(t, t) t(.BdUser, .EncryptionKey).BdUser'<br />
      <br />
      This line takes my var BdUser and EncryptionKey and encode it. I want the result back into BdUser.<br />
      <br />
      There is a way to check if our DLL is correctly builded ?<br />
      <br />
      Thanks,</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">22nd May 2009 14:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Like this:<br />
      System::Call 'Crypto::EncodePWDEx(t, t) t("$BdUser", "$EncryptionKey").s'<br />
      Pop $BdUser<br />
      <br />
      But if that's a .NET dll then you have to call it using the <a href="http://nsis.sourceforge.net/Call_.NET_DLL_methods_plug-in" target="_blank">CLR</a> plugin.<br />
      <br />
      For the System plugin you can't just use .BdUser in there for the input/output - you can only use what is specified in the System plugin readme (like r0, R0 etc).<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Inazad</span><br />
      <span class="post-time small text-muted">22nd May 2009 14:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I wrote my dll in delphi with the Crypto' functions to encrypt data.<br />
      <br />
      Maybe its the code or maybe its the dll... how to know ? :cry:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">22nd May 2009 15:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have edited my post above.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Inazad</span><br />
      <span class="post-time small text-muted">22nd May 2009 15:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have these lines in my code :<br />
      Section -BD<br />
      Call CreateDatabaseAndBasicData<br />
      <br />
      File "Crypto.dll"<br />
      <br />
      ;System::Call 'Crypto::GeneratePWDSecutityString() .s'<br />
      <br />
      StrCpy $EncryptionKey "oKQ2N0mLjxEX8WT4"<br />
      ;StrCpy $EncryptionKey ""<br />
      <br />
      System::Call 'Crypto::EncodePWDEx(t, t) t("$BdUser", "$EncryptionKey").s'<br />
      Pop $BdUser<br />
      ;System::Call 'Crypto::EncodePWDEx(t.BdPass, t.EncryptionKey) .BdPass's<br />
      ;System::Call 'Crypto::EncodePWDEx(t.BdUser,t.EncryptionKey).r0'<br />
      <br />
      WriteINIStr "$PathIniFile\${IniFile}.INI" "sql" "Nom_Database" $BdName<br />
      WriteINIStr "$PathIniFile\${IniFile}.INI" "sql" "IP" $BdHost<br />
      WriteINIStr "$PathIniFile\${IniFile}.INI" "sql" "g" $BdUser<br />
      WriteINIStr "$PathIniFile\${IniFile}.INI" "sql" "e" $BdPass<br />
      WriteINIStr "$PathIniFile\${IniFile}.INI" "sql" "f" $EncryptionKey<br />
      WriteINIStr "$PathIniFile\${IniFile}.INI" "sql" "Type" "15632"<br />
      SectionEnd<br />
      <br />
      Don't know if its the DLL or the code :mad:<br />
      <br />
      Do you have IM like MSN or Gaim ?<br />
      <br />
      THanks</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">22nd May 2009 15:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Where is the dll being extracted to?<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Inazad</span><br />
      <span class="post-time small text-muted">22nd May 2009 15:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">it in the same directory of the .nsi file...<br />
      <br />
      THere is a another place to put it ?<br />
      <br />
      Thanks</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">22nd May 2009 15:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">No, I said where are you extracting to on the user's machine? You have no SetOutPath instruction in that code which is why I ask. You may be extracting it to a location that the System plugin doesn't look in.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Inazad</span><br />
      <span class="post-time small text-muted">22nd May 2009 16:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There ??<br />
      <br />
      Section -Main<br />
      SetOverwrite try<br />
      SetShellVarContext all # Pour tous les utilisateurs<br />
      StrCpy $PathIniFile "$AppData\${Company}\${ProjectGroup}\Instances\$TxtInstanceValue"<br />
      SetOutPath "$INSTDIR" # Pour copier l'exÃ©cutable du service<br />
      File "Z:\Application\PRD\${IniFile}.exe"<br />
      <br />
      SetOutPath "$INSTDIR\..\" # Pour copier l'exÃ©cutable de configuration du service<br />
      File "Z:\Application\PRD\${ConfFile}.exe"<br />
      <br />
      SetOutPath $PathIniFile # Pour copier les fichiers ini<br />
      File "${IniFile}.INI"<br />
      <br />
      SetOutPath "$AppData\${Company}\"<br />
      File /r "..\..\_Commun\Traduction\*.mo"<br />
      <br />
      CreateShortCut "$DESKTOP\${AppName}.lnk" "$INSTDIR\..\${ConfFile}.exe" "-s$TxtInstanceValue"<br />
      SectionEnd<br />
      <br />
      Thanks</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Inazad</span><br />
      <span class="post-time small text-muted">22nd May 2009 16:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This is the top of my code, maybe you'll find what you're searching for ???<br />
      <br />
      !define AppName "Blf Agent Unistim"<br />
      !define ProjectGroup "BlfAgent"<br />
      !define Company "Komutel"<br />
      !define IniFile "BlfAgent_Unistim"<br />
      !define ConfFile "BlfAgent_Configuration"<br />
      <br />
      !define ServiceName "BlfAgentUnistim"<br />
      !define ServiceDescription "Busy Lamp Field Service"<br />
      !define ServiceRegSearch "BlfAgent"<br />
      <br />
      # Variables<br />
      Var StartMenuGroup<br />
      Var PathIniFile<br />
      Var InstanceCount<br />
      <br />
      # General Symbol Definitions<br />
      !define REGKEY "SOFTWARE\${AppName}"<br />
      <br />
      # MUI Symbol Definitions<br />
      !define MUI_ICON "${NSISDIR}\Contrib\Graphics\Icons\orange-install.ico"<br />
      !define MUI_FINISHPAGE_NOAUTOCLOSE<br />
      !define MUI_STARTMENUPAGE_REGISTRY_ROOT HKLM<br />
      !define MUI_STARTMENUPAGE_NODISABLE<br />
      !define MUI_STARTMENUPAGE_REGISTRY_KEY "${REGKEY}"<br />
      !define MUI_STARTMENUPAGE_REGISTRY_VALUENAME StartMenuGroup<br />
      !define MUI_STARTMENUPAGE_DEFAULTFOLDER "${AppName}"<br />
      !define MUI_UNICON "..\Commun\App_Icons\sit-final.ico"<br />
      !define MUI_UNFINISHPAGE_NOAUTOCLOSE<br />
      !define MUI_LANGDLL_REGISTRY_ROOT HKLM<br />
      !define MUI_LANGDLL_REGISTRY_KEY "${REGKEY}"<br />
      !define MUI_LANGDLL_REGISTRY_VALUENAME InstallerLanguage<br />
      <br />
      # Included files<br />
      !include Sections.nsh<br />
      !include MUI2.nsh<br />
      !include LogicLib.nsh<br />
      !include nsDialogs.nsh<br />
      ;!include ..\Commun\Crypto.nsh<br />
      !include ..\Commun\ServiceLib.nsh<br />
      !include ..\Commun\frmInstance.nsh<br />
      !include ..\Commun\frmUnInstance.nsh<br />
      !include ..\Commun\frmMsde.nsh<br />
      !include ..\Commun\frmConfigBd.nsh<br />
      !include ..\Commun\frmUnistimConfig.nsh<br />
      !include ..\Commun\SqlServerScriptBd.nsh<br />
      <br />
      #________Pages d'installation____________________________________________________________________________________________________<br />
      !insertmacro MUI_PAGE_WELCOME<br />
      Page custom FrmInstanceShow FrmInstanceClose<br />
      Page Custom frmMsdeShow frmMsdeClose<br />
      Page Custom frmConfigBdShow frmConfigBdClose<br />
      !define MUI_PAGE_CUSTOMFUNCTION_PRE JumpThisPage ;Fonction qui me permet de valider si j'exÃ©cute la page suivante<br />
      !insertmacro MUI_PAGE_DIRECTORY<br />
      !define MUI_PAGE_CUSTOMFUNCTION_PRE JumpThisPage ;Fonction qui me permet de valider si j'exÃ©cute la page suivante<br />
      !insertmacro MUI_PAGE_STARTMENU Application $StartMenuGroup<br />
      !insertmacro MUI_PAGE_INSTFILES<br />
      Page custom frmUnistimConfigServiceShow frmUnistimConfigServiceClose<br />
      !insertmacro MUI_PAGE_FINISH<br />
      #___________________________________________________________________________________________________________________________<br />
      <br />
      #________Pages de dÃ©sinstallation__________________________________________________________________________________________________<br />
      !insertmacro MUI_UNPAGE_CONFIRM<br />
      UninstPage custom un.FrmUnInstanceShow un.FrmUnInstanceClose<br />
      !insertmacro MUI_UNPAGE_INSTFILES<br />
      #___________________________________________________________________________________________________________________________<br />
      <br />
      # Macro pour les langues<br />
      !insertmacro MUI_RESERVEFILE_LANGDLL<br />
      !insertmacro MUI_LANGUAGE English<br />
      !insertmacro MUI_LANGUAGE French<br />
      <br />
      # Installer attributes<br />
      Name "${AppName}"<br />
      OutFile "${AppName} Setup.exe"<br />
      InstallDir "$PROGRAMFILES\${Company}\${ProjectGroup}\${AppName}\"<br />
      CRCCheck on<br />
      XPStyle on<br />
      ShowInstDetails show<br />
      InstallDirRegKey HKLM "${REGKEY}" "Path"<br />
      ShowUninstDetails show<br />
      RequestExecutionLevel admin<br />
      <br />
      <br />
      <br />
      PS: Sorry for the post in double..</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">22nd May 2009 19:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Assuming SetOutPath "$AppData\${Company}\" was the last SetOutPath instruction then you're extracting Crypto.dll there too.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Inazad</span><br />
      <span class="post-time small text-muted">22nd May 2009 20:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">So if the Installer Create a Directory into C:\Program Files\ and the company name is Hello, I have to put my dll into :<br />
      <br />
      C:\Program Files\Hello ?<br />
      <br />
      Thanks,</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">23rd May 2009 12:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Extract to $PLUGINSDIR. That's where the System plugin is so it'll find your dll when it's in the same folder.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Inazad</span><br />
      <span class="post-time small text-muted">23rd May 2009 18:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK I'll test it Monday, at my office.<br />
      <br />
      Can we specify an absolute path like :<br />
      <br />
      File "Z:\Dev\Commun\Crypto.dll" ?<br />
      <br />
      Thanks for your support!<br />
      <br />
      JS</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Inazad</span><br />
      <span class="post-time small text-muted">25th May 2009 14:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've put the DLL into the $PLUGINSDIR of NSIS.<br />
      <br />
      I don't get error while installing but my DLL do not do his job correctly because I'm getting the string "error" in my INI file ....<br />
      <br />
      There is a way to track or debug a NSIS installer ???<br />
      <br />
      Thanks,</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">25th May 2009 16:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">$PLUGINSDIR has nothing to do with the NSIS plugins folder.<br />
      <br />
      Try this:<br />
      SetOutPath $PLUGINSDIR<br />
      File Crypto.dll<br />
      <br />
      When you use the NSIS plugin call syntax such as System::Call or nsDialogs::Create NSIS actually includes the plugin DLL and extracts it at run-time to $PLUGINSDIR. If you look in your %TEMP% folder you will find a ns*.tmp folder with the DLL files in it. Having said that, for the System plugin to find the DLL you want to call, it either needs to be in PATH (i.e. $SYSDIR) or in the same folder as System.dll ($PLUGINSDIR). Hopefully that makes sense as I don't think you get it!<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Inazad</span><br />
      <span class="post-time small text-muted">25th May 2009 16:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've made an executable in Delphi who do the same as my dll...<br />
      <br />
      Now I just want to call the executable with this following string :<br />
      <br />
      $PathIniFile\${IniFile}.INI<br />
      <br />
      My executable name is : Cypher.exe<br />
      <br />
      Thanks to you.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
