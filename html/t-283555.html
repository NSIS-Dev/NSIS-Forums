<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Exclude folders at install" />

  <title>Exclude folders at install - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Exclude folders at install</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=283555">Exclude folders at install</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Socrate</span><br />
      <span class="post-time small text-muted">21st December 2007 17:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Exclude folders at install</strong><br />
      Hello<br />
      <br />
      I have made my installer with NSIS and the client doesn't want to the user can install my application on the Desktop (for example).<br />
      <br />
      I'm a newbie with NSIS.<br />
      <br />
      I create a MUI_PAGE_DIRECTORY where the user can select the installation path. But I want to show him a message box whihc tell him that he doesn't allow to install the application on the Desktop if he has decided to do it.<br />
      <br />
      Which method can I use to solve this problem ?<br />
      Thanks for all your replies</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">21st December 2007 19:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here's some clue to start over,<br /></p>
      <pre>
<code>outfile test.exe<br />InstallDir `$PROGRAMFILES\My Application`<br /><br />page directory `` `` dirleave<br />page instfiles<br /><br />section<br /><br />sectionend<br /><br />Function dirleave<br />    Push "$INSTDIR"<br />    Push "$DESKTOP"<br />    Call StrOutOfStr<br />    Pop $R0<br />    StrCmp "$R0" "error" proceed<br />    MessageBox MB_ICONSTOP|MB_OK \<br />    "Installation on DESKTOP is not allowed, choose another directory"<br />    Abort<br />   proceed:<br />FunctionEnd<br /><br />Function StrOutOfStr<br />   Exch $0 <br />   Exch<br />   Exch $1 <br />   Push $2<br />   Push $3<br />   Push $4<br />   Push $5<br /><br />        StrCpy $3 "0"<br />        StrLen $4 "$0"<br />        StrLen $5 "$1"<br />        IntCmp $4 $5 0 0 _err<br />        Intop $5 $5 - $4<br /><br />  _start:<br />        StrCpy $2 "$1" $4 $3<br />        StrCmp "$2" "$0" _done<br />        IntCmp "$3" "$5" _err<br />        Intop $3 $3 + 1<br />        Goto _start<br /><br />   _err:<br />        StrCpy $2 "error"<br /><br />  _done:<br />        StrCpy $0 "$2"<br /><br />   Pop $5<br />   Pop $4<br />   Pop $3<br />   Pop $2<br />   Pop $1<br />   Exch $0<br />FunctionEnd</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br />
      <span class="post-time small text-muted">21st December 2007 21:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">And here's a different approach...<br />
      <br /></p>
      <pre>
<code>...<br />!define MUI_PAGE_CUSTOMFUNCTION_LEAVE MyDirLeave<br />!insertmacro MUI_PAGE_DIRECTORY<br />...<br /><br />Function MyDirLeave<br /> Push $0<br /><br />  StrLen $0 $DESKTOP<br />  StrCpy $0 $INSTDIR $0<br />  StrCmp $0 $DESKTOP 0 proceed<br />    MessageBox MB_ICONSTOP|MB_OK \<br />        "Installation on DESKTOP is not allowed, choose another directory"<br />    Abort<br />  proceed:<br /><br /> Pop $0<br />FunctionEnd<br /></code>
</pre>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
