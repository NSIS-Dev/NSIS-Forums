<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="trouble with StrCmp and labels" />

  <title>trouble with StrCmp and labels - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">trouble with StrCmp and labels</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=252656">trouble with StrCmp and labels</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">cjones</span><br />
      <span class="post-time small text-muted">4th August 2006 20:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>trouble with StrCmp and labels</strong><br />
      I'm trying to detect if Windows Media Encoder is installed and if not I want to kick it off.<br />
      <br />
      Here's the code I put together and the error I'm getting. I'm at a loss why it doesn't work, then again, I've only playing with this for a few hours.<br />
      <br />
      StrCmp "$0" "1" equal=installWME, nonequal=<br />
      Invalid command: :installWME<br />
      <br />
      Section "WME"<br />
      Call IsWMEInstalled<br />
      Pop $0<br />
      StrCmp $0 1 installWME<br />
      <br />
      :installWME<br />
      ExecWait '"$INSTDIR\WMEncoder.exe"'<br />
      <br />
      SectionEnd<br />
      <br />
      Function IsWMEInstalled<br />
      Push $0<br />
      Push $1<br />
      <br />
      ReadRegStr $1 HKLM SOFTWARE\Classes\CLSID\{632B606B-BBC6-11D2-A329-006097C4E476} ""<br />
      Push $1<br />
      Exch $1<br />
      Pop $1<br />
      IfFileExists $1 0 noWME<br />
      StrCpy $0 0<br />
      <br />
      noWME:<br />
      StrCpy $0 0<br />
      Goto done<br />
      <br />
      done:<br />
      Pop $1<br />
      Exch $0<br />
      <br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">4th August 2006 20:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's the other way around. It's `installWME:`, not `:installWME:`. Use the <a href="http://nsis.sourceforge.net/Docs/Chapter2.html#2.3.5.1" target="_blank">LogicLib</a> instead, it's much simpler.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">cjones</span><br />
      <span class="post-time small text-muted">6th August 2006 19:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks, that fixed it. Here's the next problem. I'm using the standard .NET detection script that is in the help file. When I call it in the following section it runs both found.NETFramework: and no.NETFramework. Any idea what I'm doing wrong?<br />
      <br />
      I'm also checking to see if Windows Media Encoder is installed and it doesn't matter if it's installed or not, it fires off the label to start the install.<br />
      <br />
      Section "DotNet"<br />
      Call IsDotNETInstalled<br />
      Pop $0<br />
      StrCmp $0 1 found.NETFramework no.NETFramework<br />
      <br />
      found.NETFramework:<br />
      MessageBox MB_OK ".NET is already installed"<br />
      Pop $0<br />
      <br />
      no.NETFramework:<br />
      MessageBox MB_OK "Microsoft .NET 1.1 is required. Taking you there to download it."<br />
      ExecShell "open" "http://www.microsoft.com/downloads/details.aspx?displaylang=en&amp;FamilyID=262D25E3-F589-4842-8157-034D1E7CF3A3"<br />
      <br />
      SectionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">6th August 2006 19:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Follow the code through... What happens when you reach the label "no.NETFramework"... it shows the MessageBox, Pop's $0 (why?) and then what? Continues to run the code after the label "no.NETFramework". You need to jump over the code with a Goto instruction.<br />
      <br />
      Or, like kichik has already said, use LogicLib. It really is much easier.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">cjones</span><br />
      <span class="post-time small text-muted">7th August 2006 21:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Gotcha, that fixed it.<br />
      The thing that is really killing me is this Push, Pop thing. I'm use to setting variables and then pulling the values.<br />
      <br />
      Now I'm getting an error when I run the installer that says Installer corrupted, invalid opcode.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">8th August 2006 11:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That happens if you try and Pop or Shift when there's nothing on the stack. The code you've posted above will cause that error if there's only one stack item because you've got two Pop's. You don't even need the second one. Why is it there?<br />
      Have you removed it?<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">8th August 2006 16:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Pop doesn't do that. Only a bad Exch or an invalid Reboot opcode trigger that message.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">8th August 2006 16:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Not sure why I said them. Getting confused with my array plugin :S<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
