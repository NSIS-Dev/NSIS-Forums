<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Mui problem" />

  <title>Mui problem - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Mui problem</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=278169">Mui problem</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">l0k1</span><br />
      <span class="post-time small text-muted">1st October 2007 11:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Mui problem</strong><br />
      Hi, can you help me with this one :<br />
      <br />
      When i use MUI_PAGE_FINISH i get<br />
      <br />
      resolving install function "Nsis2Io" in function "mui.FinishPre_159.5.9"<br />
      Note: uninstall functions must begin with "un.", and install functions must not<br />
      Error - aborting creation process<br />
      <br />
      on compilation<br />
      <br />
      Here's the code :<br />
      <br />
      ;<br />
      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
      ;Languages selection<br />
      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
      ;<br />
      !ifdef LANG_EN<br />
      !include "lang_en.nsh"<br />
      !InsertMacro MUI_LANGUAGE "English"<br />
      LicenseLangString license ${LANG_ENGLISH} "..\..\lic\license_en.txt"<br />
      !EndIf<br />
      !ifdef LANG_FR<br />
      !include "lang_fr.nsh"<br />
      !InsertMacro MUI_LANGUAGE "French"<br />
      LicenseLangString license ${LANG_FRENCH} "..\..\lic\license_fr.txt"<br />
      !EndIf<br />
      !ifdef LANG_ES<br />
      !include "lang_es.nsh"<br />
      !InsertMacro MUI_LANGUAGE "Spanish"<br />
      LicenseLangString license ${LANG_SPANISH} "..\..\lic\license_sp.txt"<br />
      !EndIf<br />
      ;<br />
      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
      ;Interface Configuration for pages and executables<br />
      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
      ;<br />
      ; UAC Vista<br />
      RequestExecutionLevel Admin<br />
      ;The icon for the installer.<br />
      !IfDef MUI_ICON<br />
      !UnDef MUI_ICON<br />
      !EndIf<br />
      !Define MUI_ICON "..\..\bmp\icon_16x16.ico"<br />
      ;The icon for the uninstaller.<br />
      !IfDef MUI_UNICON<br />
      !UnDef MUI_UNICON<br />
      !EndIf<br />
      !Define MUI_UNICON "..\..\bmp\icon_16x16.ico"<br />
      ;Display settings<br />
      ;!Define MUI_HEADERIMAGE<br />
      ;Bitmap image to display on the header of installers pages.<br />
      !Define MUI_HEADERIMAGE_BITMAP "..\..\bmp\install_haut_nsis.bmp"<br />
      ;Do not stretch the installer header bitmap to fit the size of the field.<br />
      !Define MUI_HEADERIMAGE_BITMAP_NOSTRETCH<br />
      ;Bitmap image to display on the header of uninstaller pages.<br />
      !Define MUI_HEADERIMAGE_UNBITMAP "..\..\bmp\install_haut_nsis.bmp"<br />
      ;Do not stretch the uninstaller header bitmap to fit the size of the field.<br />
      !Define MUI_HEADERIMAGE_UNBITMAP_NOSTRETCH<br />
      ;Show a message box with a warning when the user wants to close the installer.<br />
      !Define MUI_ABORTWARNING<br />
      ;Set the Cancel button as the default button on the message box.<br />
      !Define MUI_ABORTWARNING_CANCEL_DEFAULT<br />
      ;Show a message box with a warning when the user wants to close the uninstaller.<br />
      !Define MUI_UNABORTWARNING<br />
      ;Set the Cancel button as the default button on the message box.<br />
      !Define MUI_UNABORTWARNING_CANCEL_DEFAULT<br />
      ;<br />
      !Define MUI_LANGDLL_REGISTRY_ROOT "HKCU"<br />
      !Define MUI_LANGDLL_REGISTRY_KEY "Software\${EDITOR_NAME}\${PRODUCT_NAME}"<br />
      !Define MUI_LANGDLL_REGISTRY_VALUENAME "Language"<br />
      ;<br />
      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
      ;Install Pages<br />
      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
      ;<br />
      ;Welcome Page<br />
      !Include "WelcomePage.nsh"<br />
      !Define MUI_PAGE_CUSTOMFUNCTION_PRE GetPreRequisites<br />
      !IfDef MUI_WELCOMEFINISHPAGE_BITMAP<br />
      !UnDef MUI_WELCOMEFINISHPAGE_BITMAP<br />
      !EndIf<br />
      !Define MUI_WELCOMEFINISHPAGE_BITMAP "..\..\bmp\install_gauche_nsis.bmp"<br />
      !Define MUI_WELCOMEFINISHPAGE_BITMAP_NOSTRETCH<br />
      !InsertMacro MUI_PAGE_WELCOME<br />
      ;License Page<br />
      !InsertMacro MUI_PAGE_LICENSE $(license)<br />
      ;Detect Page<br />
      !Include "DetectPage.nsh"<br />
      Page custom CreatorDetectPage LeaveDetectPage<br />
      ;Authenticate Page<br />
      !ifdef AuthenticateUser<br />
      ;!Define MUI_PAGE_CUSTOMFUNCTION_LEAVE SaveEMail<br />
      !Include "AuthenticateUserPage.nsh"<br />
      Page custom AuthenticateUser SaveEMail<br />
      !EndIf<br />
      ;!InsertMacro MUI_PAGE_DIRECTORY<br />
      ;Start menu Page<br />
      !Include "StartMenuPage.nsh"<br />
      ;The default Start Menu Folder.<br />
      !Define MUI_STARTMENUPAGE_DEFAULTFOLDER "${PRODUCT_NAME}"<br />
      ;The registry keys to store the Start Menu folder<br />
      !Define MUI_STARTMENUPAGE_REGISTRY_ROOT HKCU<br />
      !Define MUI_STARTMENUPAGE_REGISTRY_KEY "Software\${EDITOR_NAME}\${PRODUCT_NAME}"<br />
      !Define MUI_STARTMENUPAGE_REGISTRY_VALUENAME "Start Menu Folder"<br />
      !Define MUI_PAGE_CUSTOMFUNCTION_PRE DeletePreviousShortcuts<br />
      !InsertMacro MUI_PAGE_STARTMENU "Application" $STARTMENU_FOLDER<br />
      ;Install Files Page<br />
      !InsertMacro MUI_PAGE_INSTFILES<br />
      ;Finish Page<br />
      !Include "FinishPage.nsh"<br />
      !Define MUI_PAGE_CUSTOMFUNCTION_PRE PreFinish<br />
      !Define MUI_PAGE_CUSTOMFUNCTION_SHOW ShowFinish<br />
      !Define MUI_PAGE_CUSTOMFUNCTION_LEAVE LeaveFinish<br />
      !Define MUI_FINISHPAGE_RUN "$INSTDIR\${PRODUCT_NAME}.exe"<br />
      !InsertMacro MUI_PAGE_FINISH<br />
      <br />
      Here's the code of the customized finish page :<br />
      <br />
      ################################################################################<br />
      # FINISHPAGE #<br />
      ################################################################################<br />
      ;<br />
      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
      ;install Finish Page functions<br />
      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
      ;<br />
      Function PreFinish<br />
      ; Description : load et show interface<br />
      ; Parameters : none<br />
      !InsertMacro MUI_INSTALLOPTIONS_READ $R0 "ioSpecial.ini" "Settings" "NumFields"<br />
      IntOp $R0 $R0 + 1<br />
      ;update fields count<br />
      !InsertMacro MUI_INSTALLOPTIONS_WRITE "ioSpecial.ini" "Settings" "NumFields" "$R0"<br />
      ;Add Desktop Shortcut checkbox<br />
      !InsertMacro MUI_INSTALLOPTIONS_WRITE "ioSpecial.ini" "Field $R0" "Type" "CheckBox"<br />
      !InsertMacro MUI_INSTALLOPTIONS_WRITE "ioSpecial.ini" "Field $R0" "Text" "$(txtCreateDesktopShortcut)"<br />
      !InsertMacro MUI_INSTALLOPTIONS_WRITE "ioSpecial.ini" "Field $R0" "Left" "120"<br />
      !InsertMacro MUI_INSTALLOPTIONS_WRITE "ioSpecial.ini" "Field $R0" "Right" "315"<br />
      !InsertMacro MUI_INSTALLOPTIONS_WRITE "ioSpecial.ini" "Field $R0" "Top" "150"<br />
      !InsertMacro MUI_INSTALLOPTIONS_WRITE "ioSpecial.ini" "Field $R0" "Bottom" "160"<br />
      !InsertMacro MUI_INSTALLOPTIONS_WRITE "ioSpecial.ini" "Field $R0" "State" "1"<br />
      FunctionEnd<br />
      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
      Function ShowFinish<br />
      ; Description : Checks if Windows version is Vista and hide checkbox Launch EXE<br />
      ; Parameters : none<br />
      xtInfoPlugin::GetWindowsVersion<br />
      Push "5.99999"<br />
      xtInfoPlugin::CompareVersion<br />
      Pop $0<br />
      ${If} $0 == "-1"<br />
      ;Get windows<br />
      ;FindWindow $0 "#32770" "" $HWNDPARENT<br />
      ;Get start program checbox control<br />
      GetDlgItem $2 $MUI_HWND "1203"<br />
      ;Uncheck it<br />
      SendMessage $2 ${WM_LBUTTONDOWN} 0 0<br />
      SendMessage $2 ${WM_LBUTTONUP} 0 0<br />
      ;Hide it<br />
      ShowWindow $2 ${SW_HIDE}<br />
      ${EndIf}<br />
      FunctionEnd<br />
      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
      Function LeaveFinish<br />
      ; Description : Read checkboxes and execute (or not)<br />
      ; - Shortcut creation<br />
      ; - launch .Exe<br />
      ; Send message to Server (end install)<br />
      ; Parameters : none<br />
      !InsertMacro MUI_INSTALLOPTIONS_READ $R0 "ioSpecial.ini" "Settings" "NumFields"<br />
      !InsertMacro MUI_INSTALLOPTIONS_READ $R0 "ioSpecial.ini" "Field $R0" "State"<br />
      StrCmp $R0 "0" ENDCREATESHORTCUT CREATESHORTCUT<br />
      CREATESHORTCUT:<br />
      CreateShortCut "$DESKTOP\${PRODUCT_NAME}.lnk" "$INSTDIR\${PRODUCT_NAME}.exe" "" "$INSTDIR\${PRODUCT_NAME}.exe" 0<br />
      WriteRegDWORD HKCU "Software\${EDITOR_NAME}\${PRODUCT_NAME}" "desktopshortcut" "1"<br />
      ENDCREATESHORTCUT:<br />
      WriteRegDWORD HKCU "Software\${EDITOR_NAME}\${PRODUCT_NAME}" "desktopshortcut" "0"<br />
      SENDFINISHTOSERVER: ;Send request to server<br />
      !InsertMacro MUI_INSTALLOPTIONS_READ $R0 "ioSpecial.ini" "Field 4" "State"<br />
      IntOp $R0 2 - $R0<br />
      Push "URL_ENDINSTALL"<br />
      !InsertMacro SetUrlMessage $R0<br />
      Pop $0<br />
      inetc::get "$0" "$TEMP\End.txt"<br />
      Pop $0<br />
      StrCmp $0 "OK" SENDFINISHOK<br />
      SENDFINISHERR:<br />
      SENDFINISHOK:<br />
      DELETE "$TEMP\End.txt"<br />
      FunctionEnd<br />
      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
      <br />
      I've seen one recent previous post with similar error but the guy changes his code and doesn't reproduce it. I wonder what i'm doing wrong or if there's a bug in MUI ?<br />
      <br />
      thx.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">l0k1</span><br />
      <span class="post-time small text-muted">1st October 2007 16:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've found the solution. It's just that i miss the right order of includes (Languages selection after Install Pages and not before)</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
