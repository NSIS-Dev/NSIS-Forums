<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Load .reg in registry after variables replacement" />

  <title>Load .reg in registry after variables replacement - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Load .reg in registry after variables replacement</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=170188">Load .reg in registry after variables replacement</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pgpatron</span><br />
      <span class="post-time small text-muted">20th February 2004 09:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Load .reg in registry after variables replacement</strong><br />
      Hi all,<br />
      <br />
      I am trying to develop a template that allows to customize each software installation process I have.<br />
      <br />
      The keys values I have to insert into the registry depend on the variables I have defined in the custom project file and the user settings (NSIS variables)<br />
      <br />
      I have been thinking about the creation of a .reg file with variables and to do a search and replace before the regedit call:<br />
      ExecWait 'Regedit.exe /S "$INSTDIR\myreg.reg"'<br />
      <br />
      What I don't know is If the searching an replacing step is going to run. I have been taking a look to the diferents solutions in the NSIS Archive and I don't think they are going to resolve what I need.<br />
      <br />
      Following my custom project file I !define all variables I need at the beginning of the install process.<br />
      <br />
      Questions:<br />
      <br />
      - Do you know if it's possible to write the variables inside the .reg file to achieve an automatic sustitution? I mean, the way that, if I read a line of the .reg and I write it into another temp file (following the search &amp; replace method), a variable substitution inside the string tooks place automatically.<br />
      - Do you think is a good solution what I am trying to do?<br />
      - Do you know an easy way to achieve the solution?<br />
      <br />
      Thank you very much,<br />
      <br />
      Ptr</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pgpatron</span><br />
      <span class="post-time small text-muted">20th February 2004 17:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi again,<br />
      <br />
      I've almost got it.<br />
      <br />
      It is possible to replace a !defined value in a line read from a file automatically?<br />
      <br />
      <br />
      Example (briefly):<br />
      <br />
      <br />
      ex myfile.reg----------------------<br />
      Windows Registry Editor Version 5.00<br />
      [HKEY_LOCAL_MACHINE\SOFTWARE\<b>${MyVar}</b>]<br />
      [HKEY_LOCAL_MACHINE\SOFTWARE\<b>${MyVar}\${My2nd}</b>]<br />
      "DwordTest_0xDEADBEEF"=dword:deadbeef<br />
      "BinTest_deadbeef01f00dbeef"=hex:de,ad,be,ef,01,f0,0d,be,e<br />
      --------------------------------<br />
      <br /></p>
      <pre>
<span style="color: #007700">!</span><span style="color: #0000BB">defineMyVar</span><span style="color: #DD0000">"ThevalueIwant"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineMy2nd</span><span style="color: #DD0000">"The2ndvalue"
<br /></span><span style="color: #007700">...
<br /></span><span style="color: #0000BB">FileOpen</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"myfile.reg""r"
<br /></span><span style="color: #0000BB">GetTempFileName$R0$INSTDIR
<br />FileOpen</span><span style="color: #007700">$</span><span style="color: #0000BB">1$R0</span><span style="color: #DD0000">"w"
<br /></span><span style="color: #0000BB">loop</span><span style="color: #007700">:
<br /></span><span style="color: #0000BB">FileRead</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">$</span><span style="color: #0000BB">2
<br />IfErrorsdone
<br />Strcpy</span><span style="color: #007700">$</span><span style="color: #0000BB">3</span><span style="color: #DD0000">"$2"
<br /></span><span style="color: #0000BB">FileWrite</span><span style="color: #007700">$</span><span style="color: #0000BB">1</span><span style="color: #007700">$</span><span style="color: #0000BB">2
<br />Gotoloop
<br />done</span><span style="color: #007700">:
<br /></span><span style="color: #0000BB">FileClose</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br />FileClose</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br />Delete</span><span style="color: #DD0000">"myfile.txt"
<br /></span><span style="color: #0000BB">Rename$R0</span><span style="color: #DD0000">"myfile.txt"
<br /></span><span style="color: #0000BB">ExecWait</span><span style="color: #DD0000">'Regedit.exe/S"myfile.reg"'
<br /></span><span style="color: #0000BB">Delete</span><span style="color: #DD0000">"myfile.reg"
</span>
</pre>How should I write the entries in the file for a right and authomatic replacement of variables in the StrCpy call?<br />
      <br />
      Thank you,
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">20th February 2004 17:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">why cant you use the registry functions in nsis?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pgpatron</span><br />
      <span class="post-time small text-muted">20th February 2004 18:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello Anders,<br />
      <br />
      The problem is that I want to do a template. I have to be able to customize it for each software only by reading project files.<br />
      <br />
      It must be able to customize its parameters without needed touching script, only by reading a file(s) project with the custom variable values for each new software.<br />
      <br />
      Brief:<br />
      I will not be able to touch script once the template will be finished.<br />
      <br />
      <br />
      That's why I've thought that .reg file could be a good option for the different values I need to insert into the registry. But I am open mind to any other ideas... :D Have you got one?<br />
      <br />
      Thanks.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MarcoDeGroot</span><br />
      <span class="post-time small text-muted">27th February 2004 16:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by pgpatron</i><br />
        <b>Hello Anders,<br />
        <br />
        The problem...... Have you got one?<br />
        <br />
        Thanks.</b>
      </blockquote>Hi, I have a script that's maybe usefull for you.<br />
      It uses Reg.exe (from the MS resource kit)<br />
      <br />
      First I check if it's in the system32 folder:<br />
      <br />
      <pre>
<code>  <br />IfFileExists $SYSDIR\reg.exe skipRegExe                         <br />  SetOutPath $SYSDIR                    <br />  File include\reg.exe<br />skipRegExe:                      </code>
</pre><br />
      <br />
      To add or update a key.<br />
      <br />
      <pre>
<code><br />nsExec::Exec "REG ADD $\"Software\&lt;APPNAME&gt;\&lt;KEY&gt;$\"=$\"&lt;VALUE&gt;$\""<br />nsExec::Exec "REG UPDATE $\"Software\&lt;APPNAME&gt;\&lt;KEY&gt;$\"=$\"&lt;VALUE&gt;$\""<br /></code>
</pre><br />
      <br />
      with reg.exe /? you can find all the options.<br />
      <br />
      Hope this helpes.<br />
      <br />
      marco
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">27th February 2004 16:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Does it have to be the .reg format? If not, you can create your own format (one registry value on each line) that would be much easier to read.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
