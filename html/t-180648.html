<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Excel Add-ins"><title>Excel Add-ins - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Excel Add-ins</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=180648">Excel Add-ins</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">jbaylor</span><br><span class="post-time small text-muted">20th May 2004 18:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Excel Add-ins</strong><br>I used NSIS a few years ago to distribute an application and it worked very well. Now I am working on a small Excel add-in for a customer to distribute to their clients. I have become reacquainted with the scripting language and have learned about the modern UI (it looks great!). The only thing I am having trouble with is on the Microsoft end, registering the add-in. Has anyone done this with NSIS before?<br><br>Thanks,<br>Jeff</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">20th May 2004 19:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think you'll have to write to HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\Excel\Addins</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jbaylor</span><br><span class="post-time small text-muted">20th May 2004 20:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thank you for your suggestion. I will give it a try and let you know how it goes.<br><br>Jeff</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">routing</span><br><span class="post-time small text-muted">26th October 2004 15:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Jbaylor,<br><br>would you email me your script about excel add-in?<br>I have the same question.<br>I appreciate it very much.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jbaylor</span><br><span class="post-time small text-muted">26th October 2004 21:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>sorry</strong><br>I spent a few hours working on it and decided that I was spending more money than it was worth. I decided to just popup a CHM file with step-by-step instructions and images to guide the user through the final steps by hand (go to [Tools][Add-Ins], etc.). I investigated other add-ins and could not find a better way. If your add-in is COM based you should be able to use a registry approach, but I needed to keep the macros in VBA.<br><br>If anyone else has a solution, I am still very interested. I ran out of patience with it though.<br><br>Best of luck.<br><br>Regards,<br><br>Jeff Baylor<br>bConverged.com</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">routing</span><br><span class="post-time small text-muted">29th October 2004 19:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">My Add-ins works with .msi. But if I use nullsoft, it doesn't work. The registry shows that there is no different (the key is same) of both packages. I spent a week working on it and did not get solution. Who can help me?<br>I appreciate it very much.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jbaylor</span><br><span class="post-time small text-muted">29th October 2004 20:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Unless your add-in is COM-based, I do not think there is a registry solution. I spent a lot of time adding VBA add-ins and then diffing my registry and was not finding an answer. I am sure there is a way to do it, there are installation products that claim to, but I have not managed it yet. The path I started down which seemed to have the most potential was to write a COM app that would start an Excel process in the background and register it programmatically. I only allotted a fixed number of hours to the project and installing the add-in was taking up more time than writing it, so I stopped. If it is important to have the install done programmatically, I would write a C++ app that does it for you and call it from NSIS.<br><br>Good luck,<br><br>Jeff Baylor<br>bConverged.com</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">routing</span><br><span class="post-time small text-muted">29th October 2004 20:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Jeff,<br>Yes. My add-in is COM-based. I also want to have the install done programmatically.<br>Thank you very much for your quickly response.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jbaylor</span><br><span class="post-time small text-muted">29th October 2004 21:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Check out these MS help pages. They may point you in the right direction.<br><br><a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/modcore/html/deovrLoadingExcelAddin.asp" target="_blank">http://msdn.microsoft.com/library/de...ExcelAddin.asp</a><br><a href="http://support.microsoft.com/default.aspx?scid=kb;EN-US;q280290" target="_blank">http://support.microsoft.com/default...;EN-US;q280290</a><br><br>There is also a registry key which MS claims will have the add-ins listed. I suspect that this is only used for COM add-ins. I currently have three VBA add-ins loaded and this is empty.<br><br>HKEY_CURRENT_USER\Software\Microsoft\Office\10.0\Excel\Add-in Manager<br><br>Regards,<br>Jeff Baylor<br>bConverged.com</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">routing</span><br><span class="post-time small text-muted">2nd November 2004 15:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Jeff, Thank you so much for your help.<br><br>I still have trouble in NSIS.<br>I wrote my Add-In in .NET 2003 with C#.<br>It works well with .msi installer created by .NET 2003.<br>I want to use NSIS to create an installer of it.<br>However, the NSIS installer does not work ( there is no tool bar of my Add-In in Office application. I could see the tool bar if I used .msi installer.).<br>I'm wondering if I miss something in building NSIS installer. I added the key in NSIS script. I checked the registry. The key existed in registry. Could anyone give me some suggestions?<br><br>I appreciate it very much.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kc311man</span><br><span class="post-time small text-muted">9th March 2005 20:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think I got it. There's like 5 different places where UIDs are used to identify your plugin. My registry entries in NSIS ended up looking like this:<br>-----------------------------------------------------<br>WriteRegStr HKCU "Software\Microsoft\Office\Outlook\Addins\COMAddin.Connect" "FriendlyName" "COMAddin.Connect"<br>WriteRegStr HKCU "Software\Microsoft\Office\Outlook\Addins\COMAddin.Connect" "Description" "COMAddin.Connect"<br>WriteRegDWORD HKCU "Software\Microsoft\Office\Outlook\Addins\COMAddin.Connect" "LoadBehavior" "00000003"<br>WriteRegDWORD HKCU "Software\Microsoft\Office\Outlook\Addins\COMAddin.Connect" "CommandLineSafe" "00000000"<br><br>WriteRegStr HKCR "CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}" "" "COMAddin.Connect"<br>WriteRegStr HKCR "CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\Implemented Categories\{40FC6ED5-2438-11CF-A3DB-080036F12502}" "" ""<br>WriteRegStr HKCR "CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\InprocServer32" "" "$INSTDIR\COMAddin.dll"<br>WriteRegStr HKCR "CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\InprocServer32" "ThreadingModel" "Apartment"<br>WriteRegStr HKCR "CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\ProgID" "" "COMAddin.Connect"<br>WriteRegStr HKCR "CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\Programmable" "" ""<br>WriteRegStr HKCR "CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\TypeLib" "" "{CDC4D4CA-F710-42B3-A53E-4139A271AE24}"<br>WriteRegStr HKCR "CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\VERSION" "" "1.0"<br>WriteRegStr HKCR "COMAddin.Connect" "@" "COMAddin.Connect"<br>WriteRegStr HKCR "COMAddin.Connect\Clsid" "@" "{44408B38-B310-4BC9-9275-084BE741D1E5}"<br>WriteRegStr HKCR "TypeLib\{CDC4D4CA-F710-42B3-A53E-4139A271AE24}\1.0" "" "COMAddin"<br>WriteRegStr HKCR "TypeLib\{CDC4D4CA-F710-42B3-A53E-4139A271AE24}\1.0\0\win32" "" "$INSTDIR\COMAddin.dll"<br>WriteRegStr HKCR "TypeLib\{CDC4D4CA-F710-42B3-A53E-4139A271AE24}\1.0\FLAGS" "" "0"<br>WriteRegStr HKCR "TypeLib\{CDC4D4CA-F710-42B3-A53E-4139A271AE24}\1.0\HELPDIR" "" "$INSTDIR"<br><br>WriteRegStr HKLM "CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}" "" "COMAddin.Connect"<br>WriteRegStr HKLM "CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\Implemented Categories\{40FC6ED5-2438-11CF-A3DB-080036F12502}" "" ""<br>WriteRegStr HKLM "CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\InprocServer32" "" "$INSTDIR\COMAddin.dll"<br>WriteRegStr HKLM "CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\InprocServer32" "ThreadingModel" "Apartment"<br>WriteRegStr HKLM "CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\ProgID" "" "COMAddin.Connect"<br>WriteRegStr HKLM "CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\Programmable" "" ""<br>WriteRegStr HKLM "CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\TypeLib" "" "{CDC4D4CA-F710-42B3-A53E-4139A271AE24}"<br>WriteRegStr HKLM "CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\VERSION" "" "1.0"<br>WriteRegStr HKLM "SOFTWARE\Classes\COMAddin.Connect" "" "COMAddin.Connect"<br>WriteRegStr HKLM "SOFTWARE\Classes\COMAddin.Connect\Clsid" "" "{44408B38-B310-4BC9-9275-084BE741D1E5}"<br>WriteRegStr HKLM "TypeLib\{CDC4D4CA-F710-42B3-A53E-4139A271AE24}\1.0" "" "COMAddin"<br>WriteRegStr HKLM "TypeLib\{CDC4D4CA-F710-42B3-A53E-4139A271AE24}\1.0\0\win32" "" "$INSTDIR\COMAddin.dll"<br>WriteRegStr HKLM "TypeLib\{CDC4D4CA-F710-42B3-A53E-4139A271AE24}\1.0\FLAGS" "" "0"<br>WriteRegStr HKLM "TypeLib\{CDC4D4CA-F710-42B3-A53E-4139A271AE24}\1.0\HELPDIR" "" "$INSTDIR"<br>-----------------------------------------------------<br>Hope This Helps - Ryan</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kc311man</span><br><span class="post-time small text-muted">23rd June 2005 21:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The previous post is wrong but I figured it out finally! Basically, you just register the dll and then you add a few registry entries under HKCU\Software\Microsoft\Office\Outlook\Addins\<br><br>The code looks like this:<br>-------------------------------------------------------<br>Exec 'regsvr32.exe /s "$INSTDIR\MyCOMAddIn.dll"'<br><br>WriteRegStr HKCU "Software\Microsoft\Office\Outlook\Addins\MyCOMAddIn.Connect" "FriendlyName" "MyCOMAddIn.Connect"<br>WriteRegStr HKCU "Software\Microsoft\Office\Outlook\Addins\MyCOMAddIn.Connect" "Description" "MyCOMAddIn"<br>WriteRegDWORD HKCU "Software\Microsoft\Office\Outlook\Addins\MyCOMAddIn.Connect" "LoadBehavior" "00000003"<br>WriteRegDWORD HKCU "Software\Microsoft\Office\Outlook\Addins\MyCOMAddIn.Connect" "CommandLineSafe" "00000000"<br>-----------------------------------------------<br>You would replace MyCOMAddIn with whatever you set your PROGID to be in your dll.<br><br>Sorry about the confusion - Ryan</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jsierra</span><br><span class="post-time small text-muted">17th March 2006 01:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>A Simple Solution Using VBS</strong><br>I also spent <b>a lot</b> of time looking for a solution. I was finally able to piece something together using a couple of simple VBS scripts and the nsExec plugin. I wrote one VB script to enable the plugin and another to disable the plugin. Here are the basic lines of VBS that enable the AddIn:<br></p><pre>
<code>  Set objXL = WScript.CreateObject("Excel.Application")<br>  objXL.AddIns("Addin Name").Installed = True<br>  objXL.Quit<br></code>
</pre><br>
      The .NSI has something like this:<br>
      <pre>
<code>  ;Copy the XLA Installer<br>  File "${XLA_INSTALLER}"<br><br>  ;Execute the installer<br>  nsExec::Exec '"$SYSDIR\wscript.exe" "$INSTDIR\${XLA_INSTALLER}"'<br><br>  ;Delete the installer<br>  Delete "$INSTDIR\${XLA_INSTALLER}"<br></code>
</pre><br>
      I've attached a zip with the .NSI script and the two VB scripts. To use it just modify the constants at the top of the .NSI file. I hope this helps someone some day. :) I know I was having the hardest time finding any help on it, so I wanted to be sure to document my solution somewhere.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dgp</span><br>
      <span class="post-time small text-muted">26th April 2006 19:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I also recently tackled this problem. I looked into using a VBA installer to avoid having to tackle the Excel Add-in Manager registry mess. However, I was concerned that the VBA solution would not be robust. Default Office 2003 security settings will not even ask the user if they want to enable macros (VBA) so there's a good chance that the VBA code would not run.<br>
      <br>
      I came up with the attached script to work with the registry and install the Add-in (I hope attaching scripts is acceptable in this forum?). This is my first installer script - it's not pretty but it seems to do the job. Any advice on improving the script is appreciated. I should mention that this is for installing a VBA Add-in, the registry keys are different for installing a COM Add-in.<br>
      <br>
      PS: Also posting to microsoft.public.excel.programming newsgroup since I've seen this question asked several times without an adequate answer.<br>
      <br>
      Dave</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jsierra</span><br>
      <span class="post-time small text-muted">20th June 2006 16:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Thanks ggp!</strong><br>
      dgp's solution works great! A much more elegant solution than what I did, by creating some vbs files to do the installation. Thanks for posting your .nsi!</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jsinnreich</span><br>
      <span class="post-time small text-muted">26th February 2009 13:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>additional Add-in info</strong><br>
      Thanks <b>dgp</b> for the registration code.<br>
      <br>
      One follow-up question, does anyone have any good suggestions on how to determine the Add-ins folder, where to extract the VBA add-in I'm installing? On XP and 2000 machines, it's <b>C:\Documents &amp; Settings\<i>user</i>\Application Data\Microsoft\Addins\</b>, on Vista machines it's <b>C:\Users\<i>user</i>\AppData\Roaming\Microsoft\Addins\</b>. Is there anything like a "$ADDINDIR" system-defined directory, or do I have to code it manually?<br>
      <br>
      Thanks,<br>
      Jon</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>