<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Add User Without non-stock Plugin" />

  <title>Add User Without non-stock Plugin - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Add User Without non-stock Plugin</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=242517">Add User Without non-stock Plugin</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ffletch2</span><br />
      <span class="post-time small text-muted">3rd April 2006 20:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Add User Without non-stock Plugin</strong><br />
      &nbsp; Anyone know of a way to add an OS user (assume 2k or xp) without using a "non-stock" plugin (i.e. a plugin that doesn't come with the default distribution)? Seems like there would be something I could use with the system plugin but I can't find anything in MSDN.<br />
      <br />
      TIA for any ideas.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">3rd April 2006 20:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You could take a look at the source code of one of the plug-ins that do allow creating users and implement that code with the System plug-in. A quick MSDN search turned up NetUserAdd.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ffletch2</span><br />
      <span class="post-time small text-muted">3rd April 2006 20:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This looks promising - thanks.<br />
      <br />
      The reason I'm asking about this is that I want to keep our overall build process to a minimum. I don't want to have to worry about a version of a plugin not working with a future version of NSIS. Not to mention that I don't want to have to worry about tracking the version of something other than NSIS.<br />
      <br />
      Right now I have it such that I just say grab the most recent version of NSIS and click the build button.<br />
      <br />
      For this reason I have generally avoided "non-stock" plugins. Anyone have any comments on how to best handle these type of issues?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">3rd April 2006 20:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I usually add the plug-ins to the source control along with the source code. This, however, mostly solves the problem of finding the right version of the plug-in and not having it work with every version of NSIS. But backwards compatibility is very important in NSIS and the user management plug-ins are usually simple and don't depend on anything internal, so they should not suddenly stop working. If they do, it'll probably be a bug with NSIS.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ffletch2</span><br />
      <span class="post-time small text-muted">3rd April 2006 21:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That makes sense. There are bugs in NSIS? ;)<br />
      <br />
      Thinking this the original problem through, it seems like this would be somewhat easy to just call an external program or script to do this (like something that just says uses the "net" command) as referenced in <a href="http://forums.winamp.com/showthread.php?postid=1659094#post1659094" target="_blank">this post</a>.<br />
      <br />
      Hmm, looks like I have some trial an error ahead of me....</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">4th April 2006 02:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This code works just fine on XP. I have used it several times.<br /></p>
      <pre>
<code>
outfile "testuser.exe"
<br />&gt;name "accounts"
<br /><br />&gt;section -
<br />&gt;nsexec::exec 'net user "test_user" "" /add'
<br />&gt;nsexec::exec 'net localgroup "Power Users" "test_user" /delete'
<br />&gt;nsexec::exec 'net localgroup "Users" "test_user" /delete'
<br />&gt;nsexec::exec 'net localgroup "Guests" "test_user" /delete'
<br />&gt;nsexec::exec 'net localgroup "HelpServicesGroup" "test_user" /delete'
<br />&gt;nsexec::exec 'net localgroup "Network Configuration Operators" "test_user" /delete'
<br />&gt;nsexec::exec 'net localgroup "Remote Desktop Users" "test_user" /delete'
<br />&gt;nsexec::exec 'net localgroup "Replicator" "test_user" /delete'
<br />&gt;nsexec::exec 'net localgroup "Backup Operators" "test_user" /delete'
<br />&gt;nsexec::exec 'net localgroup "Administrators" "test_user" /add'
<br />&gt;nsexec::exec 'net accounts /maxpwage:unlimited'
<br />&gt;sectionend 
<br />&gt;
</code>
</pre>Though, the users who they run the installer must be administrators.<br />
      The account behaves normally in control panel once has been made.<br />
      I use it always in a small silent exe by adding it to HKLM..../RunOnce, setting the rebootflag etc, so once the machine is rebooted the account is ready for use.<br />
      *Originally used in (full) unattended xp installations under the setup paramaters section, (may be used in cmdlines as well) to create the first account.
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>