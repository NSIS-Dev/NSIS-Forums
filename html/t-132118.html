<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="EnumCDs with Adapter and ID"><title>EnumCDs with Adapter and ID - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">EnumCDs with Adapter and ID</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=132118">EnumCDs with Adapter and ID</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">n0On3</span><br><span class="post-time small text-muted">17th April 2003 17:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>EnumCDs with Adapter and ID</strong><br>&nbsp; Making an installation for another program I found the need of knowing how many cd drives are in the system, and which Adapter and ID use. Can this be known in some way?<br><br>Thanks</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">17th April 2003 17:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This one enumerates all CDs on the system:<br><a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=82" target="_blank">http://nsis.sourceforge.net/archive/....php?pageid=82</a><br><br>I know how to get the serial number of the drive but have no idea how to get the adapater. If you find something about it in the internet I can help you write the plug-in.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">n0On3</span><br><span class="post-time small text-muted">18th April 2003 01:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">ok, I'll search a bit.<br><br>Thanks</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">n0On3</span><br><span class="post-time small text-muted">24th June 2003 14:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">In a ASPI document I found this example.</p><blockquote>This example scans the system for all CD-ROM drives (all targets must be at LUN #0). Please note that MAX_HA_ID and MAX_TARGET_ID should be replaced with a host adapter count returned by etASPI32SupportInfo and a target count retrieved from a SC_HA_INQUIRY SRB performed within the host adapter loop.</blockquote>I also found that I could check all host/adapter pairs with the command SC_GET_DEV_TYPE and check if the device type is DTYPE_CDROM.<br><br>I asked kichik and he doesn't know how to deal with ASPI, can anybody else help me?<br><br>Thanks</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ramon18</span><br><span class="post-time small text-muted">24th June 2003 16:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Check this site:<br><br><a href="http://www.hochfeiler.it/alvise/ASPI_1.HTM" target="_blank">http://www.hochfeiler.it/alvise/ASPI_1.HTM</a><br><br>If you need help with programming, PM me<br><br>good luck<br>Ramon</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ramon18</span><br><span class="post-time small text-muted">25th June 2003 12:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Dear n0On3,<br><br>Check attachment application I made and let me know if you think it is what you need,<br><br>If yes I can make the plugin using the code code, to return how many CD-ROMs found, which SCSI IDs and adapters Numbers<br><br>bye<br>Ramon</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">n0On3</span><br><span class="post-time small text-muted">25th June 2003 18:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for your help.<br><br>I need the "100" string in the stack when the Adapter is 1 and the ID 0. I don't know what the last zero means.<br><br>I have the idea to pop in a loop until "NoMoreCDRoms" is found.<br><br>so the stack would be:<br><br>100<br>010<br>020<br>NoMoreCDRoms<br>...<br>...<br>[whatever there was in the stack before the plugin]<br><br>I attach a snapshot that shows differences with your program numbers and what I need.<br><br>I don't know how this program writes a cdrom in the ID = 200. But if the dll works with low numbers it's enough for me. At least, I always seen CDRoms in low numbers.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ramon18</span><br><span class="post-time small text-muted">25th June 2003 19:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi,<br><br>you can forget the "lun X" numbers, this was just for debug, coze it was my first tests with ASPI.<br><br>My idea was the following:<br><br>you call something like:<br><br>ASPIInfo::GetCDRoms /CDROM<br><br>then the stack would be (eg: for 3 CDRoms):<br><br>"3" -&gt; number of CDRoms found<br>"1" -&gt; 1º CDRom Adapter ID<br>"0" -&gt; 1º CDRom ID<br>"1" -&gt; 2º CDRom Adapter ID<br>"1" -&gt; 2º CDRom ID<br>"1" -&gt; 3º CDRom Adapter ID<br>"2" -&gt; 3º CDRom ID<br><br>what do you think?<br><br><br>PS: What do you mean by : "...writes a cdrom in the ID = 200..."<br><br>cyas<br>Ramon</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">n0On3</span><br><span class="post-time small text-muted">25th June 2003 22:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">yes, this format is ok. But I suggest adding some dummy string to know when there are no more cdroms numbers in the stack.<br><br>PS: What do you mean by : "...writes a cdrom in the ID = 200..." &lt;- You asked me in a pm which limits has that ID number. And I wanted that I don't know. Just do what you think is ok, because all IDs I've seen are one digit.<br><br><br>Thanks for you help</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ramon18</span><br><span class="post-time small text-muted">26th June 2003 00:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi,<br><br>You must detect if there are more CDRoms or no using the top of stack, this way<br><br></p><pre>
<code>...
<br> push $2
<br>  push$1
<br>  push$0
<br>  ASPIInfo</code>::GetCDRoms /CDROM
<br>  pop$0 ; -&gt; retrieve how many CDRoms
<br>DO_LOOP:
<br> IntCmp $0 0 END_LOOP
<br>  pop$1 ; -&gt; retrieve Adapter
<br>  pop$2 ; -&gt; retrieve ID
<br>  DetailPrint "Adapter = $1, ID = $2"
<br> IntOp $0 $0 - 1
<br>  goto DO_LOOP
<br>END_LOOP:
<br> pop $0
<br>  pop$1
<br>  pop$2
<br>&gt;... 
</pre>btw, do you need the CDRom/Hardware String Identifier (eg. my DVD combo string is : "TOSHIBA DVD-ROM SD-C2402")?<br>
      <br>
      br,<br>
      Ramon:p
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br>
      <span class="post-time small text-muted">26th June 2003 15:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, this format is ok.<br>
      <br>
      I don't particularly need the String Identifier as much as I need the adapter/host, but it would be nice to have it :)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ramon18</span><br>
      <span class="post-time small text-muted">26th June 2003 17:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi,<br>
      <br>
      So the new code in your script with support for "CDRom/Hardware String Identifier" would be:<br>
      <br></p>
      <pre>
<code>...
<br> push $3
<br>  push$2
<br>  push$1
<br>  push$0
<br>  ASPIInfo</code>::GetCDRoms /CDROM
<br>  pop$0 ; -&gt; retrieve how many CDRoms
<br>DO_LOOP:
<br> IntCmp $0 0 END_LOOP
<br>  pop$1 ; -&gt; retrieve Adapter
<br>  pop$2 ; -&gt; retrieve ID
<br>  pop$3 ; -&gt; retrieve CDRom/Hardware String
<br>  DetailPrint "Adapter = $1, ID = $2, CD-ROM Name = $3"
<br> IntOp $0 $0 - 1
<br>  goto DO_LOOP
<br>END_LOOP:
<br> pop $0
<br>  pop$1
<br>  pop$2
<br>  pop$3
<br>&gt;... 
</pre>When I have this completed I will reply again,<br>
      <br>
      Good bye<br>
      Ramon
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br>
      <span class="post-time small text-muted">26th June 2003 21:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ok, I'll be waiting ;)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ramon18</span><br>
      <span class="post-time small text-muted">1st July 2003 08:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi,<br>
      <br>
      I found some problems under win9X, you have to wait a little more, sorry<br>
      <br>
      WinNT/2000/XP is working good :)<br>
      <br>
      cyas<br>
      Ramon</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n0On3</span><br>
      <span class="post-time small text-muted">1st July 2003 19:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Don't worry, I can wait. It's great seeing that your are testing with win9x aswell:up:</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>