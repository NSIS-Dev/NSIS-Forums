<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Installation issue on win7 with standard user and UAC off"><title>Installation issue on win7 with standard user and UAC off - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Installation issue on win7 with standard user and UAC off</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=346429">Installation issue on win7 with standard user and UAC off</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">air_circle</span><br><span class="post-time small text-muted">18th July 2012 08:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Installation issue on win7 with standard user and UAC off</strong><br>Hello, dear friends<br><br>We have one XP application, Now need to support win7(for all users: admin, standard)<br>I meet some issues in standard user with UAC off:<br>1. Can not create new sub registry in ${HKEY_LOCAL_MACHINE} SOFTWARE, and can not write any registry value.Code example:<br>!insertmacro CreateRegKey ${HKEY_LOCAL_MACHINE} SOFTWARE\MyApp<br>WriteRegStr HKEY_LOCAL_MACHINE SOFTWARE\MyApp Version 1.14.83<br>2. Can not create the uninstall shortcut in the add/remove control panel<br>User need to install the APP in standard user level.<br><br>Anyone know how to fix it? Hope someone can help me! Thanks!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">18th July 2012 10:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You cannot write to HKLM as a limited user. If your application does this also then it must be modified to write to HKCU instead.<br><br>Edit: You can also create the Add/Remove registry under HKCU.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">18th July 2012 21:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The exact same issue exists on XP (and every version of NT before that), you just forgot to test as non-admin on XP...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">air_circle</span><br><span class="post-time small text-muted">19th July 2012 03:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Our APP need to do a per-machine installation. The request is that one user install it in the same pc, other users shall be able use it.<br>If write to HKCU instead, then comes one issue:<br>After user A install the APP, the user B can see the APP, but will not be able use the APP since the registry value is not available for B.<br><br>And Our APP works well on XP, since user will always have admin permission on XP and we don't want to re-implement the APP.<br><br>So, NSIS can not finish the per-machine installation on standard user level?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">19th July 2012 06:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by air_circle</small><br>And Our APP works well on XP, since user will always have admin permission on XP and we don't want to re-implement the APP.</blockquote>Users on XP are not always admins. New users may be admin by default, but that's not a reason to assume that nobody ever creates a userlevel user. Any smart system administrator would make his company's pcs use userlevel users, not admins.<br><br><blockquote><small>Originally posted by air_circle</small><br>So, NSIS can not finish the per-machine installation on standard user level?</blockquote>It's not that NSIS cannot do it - It's that Windows will not allow it. If you want to do something for all users, you MUST have administrative access. Once you're admin there are many ways to accomplish what you want to do, but it involves either making some ugly hacks OR fixing your application to follow Microsoft Windows standards. If you want some location where your application can write data for all users, you need to use alluser Appdata. That's what it was designed for.<br><br>More hack-job solutions (please don't do this):<br>- Create a service that automatically runs at admin level to handle all the admin-level tasks your app needs. This solution is used for example by the Steam client, because it must be able to install games which sometimes (but not always) requires admin.<br>- Enumerate all userhives in HKU and create reg info for each user, plus the default user hive.<br>- Make your HKLM regkey world-writable.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">air_circle</span><br><span class="post-time small text-muted">19th July 2012 08:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">MSG,<br><br>Thanks for your detailed info.<br><br>Do you know any info about following?<br>1.What's the alluser Appdata folder on win7? is it %public%?<br>2.Do you know any alluser registry location with write/read permission?<br><br>Thanks</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">19th July 2012 10:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If you are doing an all users install then you must install with administrator privileges. You can then write to HKLM, $PROGRAMFILES and you can write shortcuts for all users (SetShellVarContext all).<br><br>Add RequestExecutionLevel admin to your script and then in .onInit check the user has administrator privileges using UserInfo::GetAccountType.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">19th July 2012 17:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by air_circle</small><br>1.What's the alluser Appdata folder on win7? is it %public%?<br>2.Do you know any alluser registry location with write/read permission?</blockquote>1. It's %APPDATA% after you do <i>setshellvarcontext all</i><br>2. World-writable alluser registry does not exist as far as I know.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">20th July 2012 07:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by air_circle</small><br>1.What's the alluser Appdata folder on win7? is it %public%?</blockquote>No, public is for documents etc. CommonAppdata=Programdata on NT6.<br><br>See also:<br><a href="http://blogs.msdn.com/b/oldnewthing/archive/2012/07/06/10327322.aspx" target="_blank">http://blogs.msdn.com/b/oldnewthing/.../10327322.aspx</a><br><a href="http://blogs.msdn.com/b/aaron_margosis/archive/2011/09/25/faq-where-do-i-save-files-and-how-exactly-do-i-do-that.aspx" target="_blank">http://blogs.msdn.com/b/aaron_margos...i-do-that.aspx</a></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">air_circle</span><br><span class="post-time small text-muted">23rd July 2012 11:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">But Programdata folder is limited access for such cas:<br>usera:admin<br>userb:stand<br>In the same pc, if usera create the common user data file, then the userb will have no pemission to write.How to handle this case?<br><br>Can install app into c:\users\public?<br>I just found all users(admin/standard) have permission to write/create new file/folder in this folder.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">23rd July 2012 15:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If I understand Anders's links correctly, %PUBLIC% is simply the new allusers startmenu/desktop/etc. These folders were not world-writable in WinXP, so I would guess they are also not world-writable on Vista/7.<br>In contrast, Program Data is the new allusers Application Data. This folder IS world-writable in XP/etc. Therefore I would expect it to be world-writable in Vista/7 as well.<br><br>I don't have a Vista/7 virtual machine at hand right now, so I can't test the above assumptions. But I do remember testing it in the past without trouble. Are you sure you cannot write to your programdata folder as user?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">air_circle</span><br><span class="post-time small text-muted">25th July 2012 07:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes, I do some test on my win7.<br><br>First, log in with admin, and launch my app, then it create the common configure file configure.ini in the Program Data\myapp.<br><br>Second, log in with standard user, launch my app, it can not change the configuration file configure.ini, there is no write permission since the file is created by amin.<br><br>Third, i tried to install the app into %public%, i repeat the step 1 and step 2, it is passed, all user can add new configuration in the configure.ini file.<br><br>On win7, the %public% is c:\users\public, this is new folder from vista, there is no this folder on XP.<br><br>From my test result, I plan to install the new app into %public% on win7, but on XP, will keep installing the app into C:\Program Files.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>