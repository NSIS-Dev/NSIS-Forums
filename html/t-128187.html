<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="UpgradeDLL question"><title>UpgradeDLL question - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">UpgradeDLL question</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=128187">UpgradeDLL question</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">o_owd</span><br><span class="post-time small text-muted">12th March 2003 14:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>UpgradeDLL question</strong><br>hello again !<br><br>actualy i have 2 questions:<br><br>1. i am using the UpgradeDLL and ShareDLL (as explained on NSIS Dev Site in "how to install vb6 runtime files"). it's very strange, on diferent operating sistems i have diferent errors. ex. i have ususaly 2-3 errors for the "oleaut32.dll", "olepro32.dll" and sometimes for "stdole2.tlb" and always for "msjet35.dll". i don't know if the name of the files are important... i saw that the files are installed and registered corectly after reboot (the problem files), so everything is ok except for the error message (abort, retry, ignore)... so my question is : how NOT to show that message??? something to bypass this message ??? eventualy to display it in the install log, but not to stop the install process ??? some ideas ?<br><br>2. i am using multiple languages. i set the default language to english, but i saw that the installer detects the system regional settings and in concluzion the default language is NOT english... how can i set the default language, and to stay that way ?<br><br>thanks.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">12th March 2003 14:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">1. Which error message do you get? File in use? UpgradeDLL inserts SetOverwrite try, so you should not get the error? Did you remove that line?<br><br>2. StrCpy $LANGUAGE ${LANG_ENGLISH}<br>before the language selection dialog.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">o_owd</span><br><span class="post-time small text-muted">12th March 2003 15:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">the language is ok. thank you.<br><br>i'm ataching a bitmap with the error messages.<br><br>thanks.<br><br>ps: i modified "SetOverwrite Try" to "SetOverwrite IfNewer". no programs are opened, none in taskbar, and i tried also to reboot the system before the installation - same result.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">12th March 2003 15:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The macro handles the version check, you should never modify SetOverwrite.<br><br>Set SetOverwrite to whatever you like for your script after inserting the macro.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">o_owd</span><br><span class="post-time small text-muted">12th March 2003 16:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">ok. i tested on 3 pc's - WinXP, Win2000 and Win98 and it seems to work fine. thanks.<br><br>sorry for all this questions...:(<br><br>thanks again.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">o_owd</span><br><span class="post-time small text-muted">13th March 2003 06:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">well... it does not work !<br><br>in a clean, just installed Win98SE (interesesting - the 3rd system with 98 that i tested) the installer does not copy not a sigle dll.<br><br>and in WinXP i still have the error for "msjet35.dll" as in the JPG i atached.<br><br>any ideas ?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">13th March 2003 13:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">NSIS doesn't show that message box if the overwrite flag is set to try. Are you sure you didn't try with an old installer?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">13th March 2003 15:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Please try again with the original macro.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">o_owd</span><br><span class="post-time small text-muted">13th March 2003 16:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">now it is the original macro.<br><br>the "abort, retry, ignore" messages are gone, but i still have the "the application failed to start ... msjet35.dll...".<br><br>and there is the other problem: on win9x (the installer except for this message, does not show any errors, and this error only on NT systems - W 2K, W XP) the installer does not show any errors, but some dll files does not register and/or oinstall corectly (i think) because my program (vb) does not start. "class not registered".<br><br>i'm very confused.<br>help!<br><br>thanks.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">13th March 2003 16:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Do you know that you have to reboot before most of the DLL's will be installed? You should add a Finish page, which will automatically ask for a reboot.<br><br>If you want the installer to start apps that need the new DLL, you should add the filename to the registry to let Windows start it after the reboot.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">o_owd</span><br><span class="post-time small text-muted">13th March 2003 16:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">i have a finish page and i do reboot...<br><br>any ideas?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">13th March 2003 16:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">[edit]heh, never mind :)[/edit]<br><br>Are you checking for the reboot flag or using the MUI's finish page? If the reboot flag is set after this macro you <i>must</i> reboot for the registration to complete.<br><br>The MUI's finish page shows a "Are you sure you want to reboot?" message for you if the reboot flag is set.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">o_owd</span><br><span class="post-time small text-muted">14th March 2003 07:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">it's very strange. on a new win98 works corectly, my program works. on another it does not. i will try to figure it out.!?<br><br>thanks again.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">14th March 2003 08:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">So you still get the 'File in use' error? And you are absolutely sure that there is 'SetOverwrite try' in the macro?<br><br>NSIS never complains about a file in use when overwrite is set to try.<br><br>Can you attach the complete script?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">o_owd</span><br><span class="post-time small text-muted">14th March 2003 08:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">here is my script.<br><br>one question:<br><br>can i log in a file everything that UpgradeDLL and ShareDLL are trying to copy/upgrade/register ?<br><br>ex: x1.dll -&gt; skiped.<br>x2.dll -&gt; registering on reboot.<br>x3.dll -&gt; registered.<br><br>is it posible? it would be usefull for the uninstall process. if one dll was on the system - the uninstaller will not remove it...<br><br>thanks.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">14th March 2003 09:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You should never remove VB6 runtime files, even if you have installed them. They are used by many applications and may be used my applications in the future.<br><br>The shared DLL registration does not always work correctly. If an application does not install the DLL's but only asks the user to install the MS runtimes, the application will not be registered as a user of the DLL.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">14th March 2003 09:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">About your script:<br><br>SetOverwrite try should be inside the macro.<br><br>Please get the complete orignal macro from <a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=21" target="_blank">http://nsis.sourceforge.net/archive/nsisweb.php?page=21</a>. That should work.<br><br>This macro automatically sets overwrite to on after it has been inserted, so you do not have to add 'SetOverwrite on' after inserting the macro. If you want another SetOverwrite value, you still have to set it again.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">o_owd</span><br><span class="post-time small text-muted">14th March 2003 09:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">ok. i will try i a few minutes and i'll tell you how it works. thanks for the quick reply.<br><br>thanks again.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">o_owd</span><br><span class="post-time small text-muted">14th March 2003 10:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I FOUND THE ERROR !!! it was ME ...<br><br>well, first i observed that i was getting the error message about a dll when the installer was copying another dll. :weird:<br><br>so, i finaly read the error message. :igor: and the error mesage was not telling me that some dll was not copied/registered corectly, was telling me that the dll was not found! :up:<br>i have 5 dll files that are linked. changed the order of the files at instalation... and ... DONE!<br><br>i am testing it now. thanks everyone.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>