<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Changing the location of install.log" />

  <title>Changing the location of install.log - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Changing the location of install.log</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=207636">Changing the location of install.log</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Chilli24</span><br />
      <span class="post-time small text-muted">13th February 2005 09:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Changing the location of install.log</strong><br />
      Hi. I'm using the special build with logging enabled to compile my script. All is ok except the fact that everytime the install.log file is created in the $INSTDIR. Is it possible to change that location? I want the install.log to be created in a specific folder that I will create.<br />
      I've tried<br />
      SetOutPath "$INSTDIR\$backupFolder"<br />
      Rename "$INSTDIR\install.log" '$INSTDIR\$backupFolder\install.log'<br />
      but it doesn't work.<br />
      Also is it possible to change the name of the file? I want it to be MyFile.log.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">13th February 2005 13:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">While your installer is running, the log file will obviously be locked for writing. This is why Rename isn't working. Just use<br />
      Rename /REBOOTOK "$INSTDIR\install.log" "$INSTDIR\$backupFolder\install.log"<br />
      so that it's moved on restart.<br />
      <br />
      Also, are you using a variable $backupFolder to store the backup folder name? Does the user have the option to change that folder name, or does it stay the same throughout the script.<br />
      If it stays the same, then you'd be waisting memory on run-time. Not that it matters much, but it's good practice for programs to use as little memory on run-time as possible.<br />
      You should use a !define backupFolder "Backup". Then use ${backupFolder} in your script.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Chilli24</span><br />
      <span class="post-time small text-muted">13th February 2005 13:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I don't yhink that the log file is locked for writing because previous to that command I inserted LogSet off. So the install.log file should be free to handle now. Also to move the file after reboot doesn't help me. Because if the isntaller runs twice before reboot, all the actions are logged in the same install.log file. That's why I don't want to use /REBOOTOK. So taking into consideration that LogSet is off, how can I :<br />
      - rename the file install.log to, let's say MyProgram.log<br />
      - how can I moved it into a folder without rebooting?<br />
      P.S. Thanks hor the hint with $backupFolder</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">13th February 2005 15:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">How about making a test script which has LogSet on, then off, and then display a MessageBox (just to pause install).<br />
      Then you could try and delete install.log to see if it's still locked or not.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">15th February 2005 18:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The log file is only closed when the installer closes.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Chilli24</span><br />
      <span class="post-time small text-muted">16th February 2005 07:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK. But how can I tell the installer to put the log file in another location, different form $INSTDIR like it is by default ?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">16th February 2005 07:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can't without changing the source.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Chilli24</span><br />
      <span class="post-time small text-muted">16th February 2005 07:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok. Thanks.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mr.hanky</span><br />
      <span class="post-time small text-muted">9th February 2006 17:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here is the last thing I do.<br />
      <br />
      CopyFiles /silent "$INSTDIR\install.log" "${MYLOGDIR}\N-2.log"<br />
      Delete /REBOOTOK "$INSTDIR\install.log"<br />
      <br />
      <br />
      *** EDIT ***<br />
      Just noticed how old this was.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mtconleyuk</span><br />
      <span class="post-time small text-muted">20th September 2012 09:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by kichik</small><br />
        The log file is only closed when the installer closes.
      </blockquote>Is this really true? From the 2.46 code, it looks like handling of a LogSet Off will cause ExecuteEntry() to call log_write(1), which will call CloseHandle(fp) and set &lt;fp&gt; to INVALID_HANDLE_VALUE. That seems as though it should close the file. Is this not right?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">20th September 2012 10:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You are right. They probably changed it at some point. After LogSet off, the handle is closed and the file can be renamed even with the installer still running.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mtconleyuk</span><br />
      <span class="post-time small text-muted">20th September 2012 16:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Is there some condition under which LogSet On would fail to open the file in the specified location? I have code that looks basically like the following:<br />
      <br />
      LogSet Off<br />
      Push $INSTDIR<br />
      StrCpy $INSTDIR "$myLogDir"<br />
      LogSet On<br />
      LogText "Hi there."<br />
      Pop $INSTDIR<br />
      <br />
      and on some occasions this will wind up writing the install.log file into the original $INSTDIR folder, not the one I specified! I've stared at the source code, but I can't see any reason why this would happen.<br />
      <br />
      One possible clue is that when this happens, the installer is running with elevated permissions, using UAC::RunElevated. Again, though, I don't see why this should be a problem.<br />
      <br />
      Any thoughts?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">20th September 2012 17:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Once you have used LogSet the path is now set for the log. Your LogSet off needs to be removed.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
