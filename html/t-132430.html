<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Is this right ?? (NSISdl &amp; ZipDLL usage)"><title>Is this right ?? (NSISdl &amp; ZipDLL usage) - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Is this right ?? (NSISdl &amp; ZipDLL usage)</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=132430">Is this right ?? (NSISdl &amp; ZipDLL usage)</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">tcalp</span><br><span class="post-time small text-muted">20th April 2003 08:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Is this right ?? (NSISdl &amp; ZipDLL usage)</strong><br>I'm using Modern UI and I'm just curious if this will end up working properly once the installer is all done.<br>I'm downloading DLL's using NSISdl, and then unziping them to windows temp dir (I think), and then using Upgrade DLL macro to install and register the dll. If there is a problem with my code please let me know.<br><br>;----------------------- ASYCFILT.DLL ----------------------------------------------------------------------<br>IfFileExists $SYSDIR\Comcat.dll skipDLL2<br>NSISdl::download /TIMEOUT=30000 <a href="http://www.mdb-project.com/Downloads/dll/asycfilt.zip" target="_blank">http://www.mdb-project.com/Downloads/dll/asycfilt.zip</a> $TEMP\asycfilt.zip<br>Pop $R0 ;Get the return value<br>StrCmp $R0 "success" +3<br>MessageBox MB_OK "Download failed: $R0"<br>Quit<br>ZipDLL::extractall "$TEMP\asycfilt.zip" "$TEMP"<br>!insertmacro UpgradeDLL $TEMP\asycfilt.dll $SYSDIR\asycfilt.dll<br>skipDLL2:</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tcalp</span><br><span class="post-time small text-muted">20th April 2003 11:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">as per the above example, this is the error I end up with (attempting to compile the script when the DLL doesn't exist I guess)<br><br>I guess the problem is that it's running the script (attempting to getdllversion) on a file that will only exist during runtime ? .. how do I get around this ?<br><br><br>IfFileExists: "$SYSDIR\Comcat.dll" ? skipDLL1 :<br>File: "nsisdl.dll"-&gt;"$PLUGINSDIR\nsisdl.dll" 13312 bytes<br>Plugin Command: download /TIMEOUT=30000 <a href="http://www.mdb-project.com/Downloads/dll/Comcat.zip" target="_blank">http://www.mdb-project.com/Downloads/dll/Comcat.zip</a> $TEMP\Comcat.zip<br>Pop: $R0<br>StrCmp "$R0" "success" equal=+3, nonequal=<br>MessageBox: 0: "Download failed: $R0"<br>Quit<br>Plugin Command: extractall $TEMP\Comcat.zip $TEMP<br>!insertmacro: UpgradeDLL<br>Push: $R0<br>Push: $R1<br>Push: $R2<br>Push: $R3<br>IfFileExists: "$SYSDIR\Comcat.dll" ? : copy_$TEMP\Comcat.dll<br>ClearErrors<br>GetDLLVersionLocal: error reading version info from "$TEMP\Comcat.dll"<br>Error in macro UpgradeDLL on macroline 13</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">20th April 2003 11:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The first parameter of UpgradeDLL is the location of the file on your computer (the creator of the installer).<br><br>UpgradeDLL included the DLL file in your installer, if you want to download a DLL, you will have to modify the macro.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tcalp</span><br><span class="post-time small text-muted">21st April 2003 07:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for your reply Joost. I have no created a small macro to download the DLL's I need and the NSISdl will ALWAYS error. in the Detail view it shows "Error: (3 unledgible characters)mission denied"<br>and in the msgbox it says "Error: Online". There should be no permission problem, I say this because I've given pretty much every possible account read access to the files located on the server, all users can access the files through IE. Is there something I'm missing ? (I'm using the Dailer to verify internet connection long before the downloads happen). Also it is trying to download asycfilt.dll which is already in my "C:\Winnt\System32" folder, so shouldn't it be skipped alltogether ? ...<br><br>Here is how I'm Calling DLL d/l's:<br>!insertmacro DoDllWork "asycfilt" "dll"<br>!insertmacro DoDllWork "Comcat" "dll"<br>!insertmacro DoDllWork "comdlg32" "ocx"<br><br>And The Macro:<br>!macro DoDllWork FILENAME EXT<br>DetailPrint "${FILENAME}.${EXT}"<br>DetailPrint "URL: <a href="http://www.mdb-project.com/Downloads/dll/" target="_blank">http://www.mdb-project.com/Downloads/dll/</a>${FILENAME}.zip"<br>DetailPrint "$SYSDIR\${FILENAME}.${EXT}"<br>IfFileExists "$SYSDIR\${FILENAME}.${EXT}" +8<br>NSISdl::download "http://www.mdb-project.com/Downloads/dll/${FILENAME}.zip" "C:\${FILENAME}.zip"<br>Pop $R0 ;Get the return value<br>StrCmp $R0 "success" +3<br>MessageBox MB_OK "Download failed: $R0"<br>Quit<br>ZipDLL::extractall "$TEMP\${FILENAME}.zip" "$SYSDIR"<br>Delete "$TEMP\${FILENAME}.zip"<br>RegDLL "${FILENAME}.${EXT}"<br><br>!macroend<br><br>I've put in a few extra DetailPrints in there to verify paths are correct, and all seems good. If anyone could please shed some light on this matter it would be greatly appriciated.<br><br>Thanks,</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tcalp</span><br><span class="post-time small text-muted">21st April 2003 08:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">All fixed :) ... looked in docs and discovered IfFileExists only supports labels, not +N ... still not sure why that made NSISdl crap out but it works so I'm happy. And for anyone else this is a great little macro for D/L'ing and Reg'in DLL's :) ...<br><br><br>!macro DoDllWork FILENAME EXT<br>IfFileExists "$SYSDIR\${FILENAME}.${EXT}" skip${FILENAME}<br>NSISdl::download <a href="http://www.mdb-project.com/Downloads/dll/" target="_blank">http://www.mdb-project.com/Downloads/dll/</a>${FILENAME}.zip $TEMP\${FILENAME}.zip<br>Pop $R0 ;Get the return value<br>StrCmp $R0 "success" +3<br>MessageBox MB_OK "Download failed: $R0"<br>Quit<br>ZipDLL::extractall "$TEMP\${FILENAME}.zip" "$SYSDIR"<br>Delete "$TEMP\${FILENAME}.zip"<br>RegDLL "${FILENAME}.${EXT}"<br>skip${FILENAME}:<br>!macroend</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">21st April 2003 12:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">IfFileExists does support jumps, but the problem is the plug-ins call. Certain commands are being processed to multiple commands internally, so you can't use relative jumps.<br><br>From the docs:<br><br>Note: relative jumps don't work with Exch, File, plug-ins (Plugin::Function), InitPluginsDir, GetFileTimeLocal or GetDLLVersionLocal. Do not try to jump over them using relative jumps, you will not get the result you were expecting.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">virtlink</span><br><span class="post-time small text-muted">21st April 2003 13:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think that the compiler should throw a warning when an instruction is trying to jump over those instructions. It is often not seen as an error, since the compiler still compiles the installer correctly.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">21st April 2003 13:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Adding such a check is not easy. This limitation will be gone soon, so there is no need to work on that now.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>