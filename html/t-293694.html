<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Window and Control" />

  <title>Window and Control - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Window and Control</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=293694">Window and Control</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Corpio</span><br />
      <span class="post-time small text-muted">27th June 2008 15:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Window and Control</strong><br />
      Hello everybody,<br />
      <br />
      I create a topic about <b>Windows</b> and <b>Controls</b> because I think it's an important part that is <u>not enough documented</u>.<br />
      For exemple, I had difficulties to found information about functions (and their parameters) allowing windows and controls handling (<i>EnableWindow, FindWindow, GetDlgItem, IsWindow, SendMessage, SetCtlColors, ShowWindow</i>).<br />
      <br />
      So I will have many questions about this topic.<br />
      <br />
      ________________________________________________________________________________<br />
      <br />
      My first question is :<br />
      - Where can I found the id list of the different controls ??<br /></p>
      <pre>
<code>GetDlgItem $0 $HWNDPARENT &lt;id_control&gt;</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br />
      <span class="post-time small text-muted">27th June 2008 15:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here is a macro I use to enable/disable the "next" button:<br />
      <br /></p>
      <pre>
<code>!macro SetNextButtonEnabled flag<br />  Push $0<br />  GetDlgItem $0 $HWNDPARENT 1<br />  !if ${flag} == 0<br />    EnableWindow $0 0<br />  !else<br />    EnableWindow $0 1<br />  !endif<br />  Pop $0<br />!macroend</code>
</pre><br />
      <br />
      This shows how to use GetDlgItem and EnableWindow, but I can't tell you where you can get the &lt;id_control&gt; from. I just copied it from some example code myself...<br />
      <br />
      <br />
      Also the docs say that you can get the handle of the "inner" dialog this way:<br />
      <br />
      <pre>
<code>FindWindow $0 "#32770" "" $HWNDPARENT</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Corpio</span><br />
      <span class="post-time small text-muted">27th June 2008 16:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you LoRd_MuldeR, I found also different examples on the forum or with the NSIS install.<br />
      <br />
      But I would like to understand at what control correspond the different ids (1028, 1037, 1256, ...). So a complete list, if it exists, will be perfect !!!!!<br />
      <br />
      I have read that there are a list in <i>NSIS/Contrib/UIs/resource.h</i> but I haven't this file in my NSIS install.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">27th June 2008 16:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Use Resource Hacker and open the UI executable file.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br />
      <span class="post-time small text-muted">27th June 2008 16:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Corpio</i><br />
        I have read that there are a list in <i>NSIS/Contrib/UIs/resource.h</i> but I haven't this file in my NSIS install. [/B]
      </blockquote>That is a source code file. It's a C Header file to be precise. You won't find it in your install, you need to get source codes...<br />
      <br />
      You can also view the file via SVN:<br />
      <a href="http://nsis.svn.sourceforge.net/viewvc/nsis/NSIS/trunk/Contrib/UIs/resource.h?revision=4124&amp;view=markup" target="_blank">http://nsis.svn.sourceforge.net/view...24&amp;view=markup</a>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Corpio</span><br />
      <span class="post-time small text-muted">27th June 2008 17:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you Afrow UK,<br />
      <br />
      I have look this software quickly, I think it can help me.<br />
      <br />
      <br />
      <font size="1">PS : I may come back on this topic to ask another question about Windows and Controls so see you soon.</font></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Corpio</span><br />
      <span class="post-time small text-muted">1st July 2008 15:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello,<br />
      <br />
      I have a problem with a <i>STATIC</i> control on a <i>components</i> page allowing me to write the description of the section flied by the user thanks to the <i>.onMouseOverSection</i> callback.<br />
      <br />
      When I want to change the control text, I run this code:<br /></p>
      <pre>
<code>SendMessage $hWndControl ${WM_SETTEXT} 0 "STR:${DESCRIPTION}"</code>
</pre><br />
      with <i>$hWndControl</i>, the handle to the good destination control<br />
      <br />
      <br />
      It writes the good text at the good place on the good time but it doesn't erase the previous text. So I have texts overlayed and unreadabled.<br />
      <br />
      Any idea !!!<br />
      <br />
      Thanks.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">1st July 2008 15:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">for a quick hack, hide then show the window, for a real solution; call InvalidateRect or RedrawWindow with the system plugin</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Corpio</span><br />
      <span class="post-time small text-muted">1st July 2008 16:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm sorry Anders but I tested different solution to hide and show the window without results.<br />
      <br />
      Maybe I don't use the good solution !!!!!<br />
      <br />
      Can you help me with little code ??<br />
      <br />
      Thanks.<br />
      <br />
      <br />
      <br />
      <b>PS :</b> I tried this code<br /></p>
      <pre>
<code>SendMessage $HWNDPARENT ${MSG} 0 0<br />SendMessage $HWNDPARENT ${MSG} 1 0</code>
</pre><br />
      with :<br />
      - <i>MSG</i> = <i>WM_ENABLE</i><br />
      - <i>MSG</i> = <i>WM_SHOWWINDOW</i>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">1st July 2008 17:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm not sure if I understand what are you trying to manage,<br />
      <br />
      <a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.14.1" target="_blank">http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.14.1</a><br />
      <br />
      <a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.14.7" target="_blank">http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.14.7</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">1st July 2008 21:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Use ShowWindow with ${SW_HIDE} and again with ${SW_SHOW}.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Corpio</span><br />
      <span class="post-time small text-muted">2nd July 2008 08:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello,<br />
      <br />
      We were concentrated on the Anders' solution.<br /></p>

      <blockquote>
        for a quick hack, hide then show the window, for a real solution; call InvalidateRect or RedrawWindow with the system plugin
      </blockquote>Actually, the solution is to use the <b><i>LockWindow</i></b> function :<br />
      <pre>
<code>Function .onMouseOverSection<br />    LockWindow on<br />    ...<br />    LockWindow off<br />FunctionEnd</code>
</pre><br />
      <br />
      <br />
      PS :<br />
      I think I already tried this solution because I had the same problem with an other <i>STATIC</i> control that I have resolved with this. But I tried it in this case without results. I don't insisted because there is a difference between the two cases. And when I retried, it worked, so ...
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Corpio</span><br />
      <span class="post-time small text-muted">2nd July 2008 11:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello,<br />
      <br />
      I have also the problem with the static control on the <i>instfiles</i> page allowing NSIS to write the details of the installation.<br />
      I bring back the problem is : when we change the text of a static control, it overlays the previous text that is not removed.<br />
      But now I can't use the <i>LockWindow</i> function around the <i>SendMessage</i> calls - allowing to change the static control text - because it's not me who controls this, it's NSIS.<br />
      <br />
      The problem happens if I use a <i>SetCtlColors</i> to have the static control background transparent. If I take off the <i>SetCtlColors</i>, the problem not produces.<br />
      <br />
      So I don't know how to resolve this problem in this context !!!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Corpio</span><br />
      <span class="post-time small text-muted">3rd July 2008 11:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello I tried to reproduce the problem in a simple installer to illustrate it.<br /></p>
      <pre>
<code>Name "Test"<br />OutFile "Test.exe"<br /><br />Page instfiles "" InstFilesPageShow<br /><br />Function InstFilesPageShow<br />        FindWindow $R0 "#32770" "" $HWNDPARENT<br />        GetDlgItem $R0 $R0 1006<br />        SetCtlColors $R0 0xFF0000 Transparent<br />FunctionEnd<br /><br />Section ""<br />        CreateDirectory "$DESKTOP\Dir_1"<br />        CreateDirectory "$DESKTOP\Dir_1\Dir_1_1"<br />        CreateDirectory "$DESKTOP\Dir_1\Dir_1_2"<br />SectionEnd<br /></code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">3rd July 2008 11:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try using LockWindow around the SetCtlColors.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Corpio</span><br />
      <span class="post-time small text-muted">3rd July 2008 13:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Afrow UK for your suggestion but it doesn't work.<br />
      <br />
      <br />
      PS :<br />
      The code given before works so - if you want - you can just copy/paste it in a .nsi file and test it to see the problem and - if you want - try to help me.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">3rd July 2008 15:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">not sure if this is a bug in nsis or the windows static control, but not all controls can handle transparent backgrounds<br />
      <br />
      if you really need transparent background, you can use a ugly hack like:<br />
      <br /></p>
      <pre>
<code>Section <br /><br /><br />FindWindow $R0 "#32770" "" $HWNDPARENT<br />GetDlgItem $R0 $R0 1006<br />SetCtlColors $R0 0xFF0000 Transparent<br /><br />!macro uglyprinthack x<br />LockWindow on<br />detailprint "${x}"<br />LockWindow off<br />!macroend<br /><br />!insertmacro uglyprinthack aaaaa<br />sleep 1234 ;do something<br />!insertmacro uglyprinthack BBBBB<br />sleep 2222 ;do something<br />!insertmacro uglyprinthack ""<br />SectionEnd</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Corpio</span><br />
      <span class="post-time small text-muted">3rd July 2008 15:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Anders but I repeat, it's not me that change the static control text, it's a default action of the <i>instfiles</i> page.<br />
      I take inspiration from your suggestion and I put <i>LockWindow on</i> before and <i>LockWindow off</i> after each line code leading to a display in the control.</p>
      <pre>
<code>Name "Test"<br />OutFile "Test.exe"<br /><br />Page instfiles "" InstFilesPageShow<br /><br />Function InstFilesPageShow<br />        FindWindow $R0 "#32770" "" $HWNDPARENT<br />        GetDlgItem $R0 $R0 1006<br />        SetCtlColors $R0 0xFF0000 Transparent<br />FunctionEnd<br /><br />Section ""<br />        LockWindow on<br />        CreateDirectory "$DESKTOP\Dir_1"<br />        LockWindow off<br />        LockWindow on<br />        CreateDirectory "$DESKTOP\Dir_1\Dir_1_1"<br />        LockWindow off<br />        LockWindow on<br />        CreateDirectory "$DESKTOP\Dir_1\Dir_1_2"<br />        LockWindow off<br />SectionEnd</code>
</pre>It works but it stay really ugly and impossible to use with bigger sections (I remind this code is just an illustration of the problem, my real code is more important !!!).
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Corpio</span><br />
      <span class="post-time small text-muted">3rd July 2008 16:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I think this bug can't be resolved simply and neatly on the script. Maybe the solution is to change something in the NSIS source but I think it's not so easy.<br />
      Now, I content oneself with a uniform background (whithout image) for this window part.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Corpio</span><br />
      <span class="post-time small text-muted">3rd July 2008 16:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">And I have an other question on this topic !!!!!!!!!<br />
      <br />
      It's possible to modify controls of the predefined pages as <i>directory</i>, <i>components</i> or <i>instfiles</i> thanks to the modification of the executable containing the resources with <i>Resource Hacker</i> and its reloading with the <i>ChangeUI</i> function.<br />
      <br />
      Is it possible to use resources contained on this executable on a <i>custom</i> page ????????????????<br />
      <br />
      In fact, I can add in this executable new dialog resources allowing me to customized the interface of new pages without using a plugin as <i>InstallOption</i> or <i>nsDialog</i>.<br />
      But how can I load these new resources ????????<br />
      <br />
      Thanks. :D</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">BuilderBob</span><br />
      <span class="post-time small text-muted">16th September 2008 10:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">So, anything new with instfile's static transparent background? I'm having the exact same problem now.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
