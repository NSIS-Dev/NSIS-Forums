<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Multiple install directories" />

  <title>Multiple install directories - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Multiple install directories</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=47907">Multiple install directories</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Dave Carter</span><br />
      <span class="post-time small text-muted">23rd April 2001 15:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi all, my first post here so I hope I haven't missed a previous post about this.<br />
      <br />
      I've just started using NSIS, and I'm trying to make an installer that can default to installing to two different locations. I've added a new function to the source (IfRegKeyExists) that will check if a registry key exists (to see if a product is installed). This works like IfFileExists and jumps a certain distance depending on if the key is found or not.<br />
      <br />
      So, for testing I have a structure in the script like this:<br />
      <br />
      IfRegKeyExists HKEY_LOCAL_MACHINE "key" "value" 0 2<br />
      SetOutPath '$PROGRAMFILES\Dave Exp Reg Found'<br />
      Jump 1<br />
      SetOutPath '$PROGRAMFILES\Dave Exp Reg Not Found'<br />
      <br />
      If the key isn't found, the first SetOP and Jump are successfully jumped and only the not found directory is created. However, if the key is found, I get both the directories made :( It seems the second SetOP isn't jumped properly.<br />
      <br />
      I've tried experiments just using the Jump command and a list of SetOutPath's and it looks like you can jump over all but the last one, so:<br />
      Jump 1<br />
      SetOutPath '$PROGRAMFILES\Dave Exp1'<br />
      SetOutPath '$PROGRAMFILES\Dave Exp2'<br />
      SetOutPath '$PROGRAMFILES\Dave Exp3'<br />
      <br />
      makes the last two directories but:<br />
      <br />
      Jump 3<br />
      SetOutPath '$PROGRAMFILES\Dave Exp1'<br />
      SetOutPath '$PROGRAMFILES\Dave Exp2'<br />
      SetOutPath '$PROGRAMFILES\Dave Exp3'<br />
      <br />
      Still makes the third directory :(<br />
      Any info or suggestions on this?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">webspider84</span><br />
      <span class="post-time small text-muted">23rd April 2001 21:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am not sure if this is much help but why do you not just use one of the 4 default sections in the installer and with the InstallDir tag get the user to select which directioy structure the want</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Edgewize</span><br />
      <span class="post-time small text-muted">23rd April 2001 21:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try using a Nop (no-op) command and then jumping to beyond that. So instead of<br />
      Jump 1<br />
      SetOutputPath "Directory"<br />
      try<br />
      Jump 2<br />
      SetOutputPath "Directory"<br />
      Nop<br />
      <br />
      Regardless if that works, Justin will be interested in this to see if its his code or not...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Dave Carter</span><br />
      <span class="post-time small text-muted">24th April 2001 11:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Man, this is getting complicated!<br />
      <br />
      OK, I tried some experiments which boil down to the following code:<br />
      <br />
      Section ""<br />
      SetOutPath c:\temp2\DaveBeforeJumps<br />
      <br />
      Jump 2<br />
      SetOutPath c:\temp2\DaveExp1<br />
      SetOutPath c:\temp2\DaveExp2<br />
      <br />
      File "C:\Temp3\File1.txt"<br />
      File "C:\Temp3\File2.txt"<br />
      <br />
      ;File "C:\Temp3\*.*"<br />
      <br />
      ;File /r "C:\Temp3\*.*"<br />
      <br />
      SectionEnd<br />
      <br />
      I compiled this into three .exe's, first as it is with the two files, then I commented out the first two and tried with the *.* wildcard instead, and lastly tried it with wildcards and recursion into a subdirectory.<br />
      The first and second installers worked as you'd expect, with the files being installed to c:\temp2\DaveBeforeJumps.<br />
      The third installer doesn't work properly. File1 and File 2 are installed to DaveBeforeJumps correctly, but when the installer creates the subdirectory, it somehow picks up on the last SetOutPath c:\temp2\DaveExp2, despite the fact it has been jumped over.<br />
      <br />
      It's a bit hard to explain, but if anyone's interested they should be able to recreate it!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Dave Carter</span><br />
      <span class="post-time small text-muted">24th April 2001 12:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the suggestion WebSpider, if there's an easier way of doing what I'm trying to do, that's great!<br />
      <br />
      The problem is I'm trying to distribute an add on that can work in two products. It needs to cope with either one or both being installed. If both are installed, the file only needs to be copied to product 1. The directory to be installed to is stored in the registry. The pseudo-code for what I'm trying to do is something like:<br />
      <br />
      if (prod1 installed)<br />
      Get prod1 dir from reg<br />
      else if (prod2 installed)<br />
      Get prod2 dir from reg<br />
      Show the user that the directory has been found<br />
      install file there<br />
      <br />
      I may be able to use your suggestion to do this, but it's a real shame the InstallDir and InstallDirRegKey commands are done outside of the "sections". I'll carry on fiddling and see how I get on. :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">webspider84</span><br />
      <span class="post-time small text-muted">25th April 2001 20:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I know the InstallDir commant is outside the section tag but the SetOutPath command is not. Its seems, from my test anyway, overrides the InstallDir command. Have a look at the .nsi scripting notes in the NSIS documentation. I do not know what to do about the reg key but perhaps this is of some help to you. I still maintain if you get the user the select if they own one, the other or both products from the 4 default sections will work especially with this SetOutPath command. I am not sure that this is any good but good luck anyway. In case you are intrested someone has created a patcher for UO in this forum, perhaps contacting them would be of use.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Dave Carter</span><br />
      <span class="post-time small text-muted">27th April 2001 10:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK, my solution was to write two new functions into the source :)<br />
      <br />
      IfRegKeyExists rootkey subkey goto_found goto_not_found<br />
      SetOutPathToReg rootkey subkey value<br />
      <br />
      My script ended up like this: (edited for size)<br />
      &lt;snip&gt;<br />
      ComponentText "Welcome! Choose the products you have."<br />
      <br />
      Section ""<br />
      Nop ; Nothing installed by default<br />
      SectionEnd<br />
      <br />
      Section "Product 1"<br />
      <br />
      IfRegKeyExists H_L_M "software\product1" LabFound LabNotFound<br />
      <br />
      LabFound:<br />
      SetOutPathToReg H_L_M "Software\product1" "maindir"<br />
      File "Source\MyFileToInstall"<br />
      Goto LabEnd<br />
      <br />
      LabNotFound:<br />
      MessageBox MB_OK "Program not found."<br />
      Goto LabEnd<br />
      <br />
      LabEnd:<br />
      SectionEnd<br />
      <br />
      Section "Product 2"<br />
      ; Similar to product 1 but checking a different reg key<br />
      ; for if it's installed and getting a different install<br />
      ; dir from a different reg key<br />
      SectionEnd<br />
      <br />
      Questions: A) Does anyone else want these functions? Obviously I found them pretty useful, but I don't know how often people are going to want to do so many registry related things in their installers.<br />
      B) If people do want them, how do I go about submitting the code for a release?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">justin</span><br />
      <span class="post-time small text-muted">27th April 2001 16:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Dave Carter</i><br />
        <b>OK, my solution was to write two new functions into the source :)<br />
        <br />
        IfRegKeyExists rootkey subkey goto_found goto_not_found<br />
        SetOutPathToReg rootkey subkey value<br />
        <br /></b>
      </blockquote><b><br />
      You know, with NSIS 1.4 you don't need these functions to accomplish what you want...<br />
      <br /></b>

      <blockquote>
        <b>My script ended up like this: (edited for size)<br />
        &lt;snip&gt;<br />
        ComponentText "Welcome! Choose the products you have."<br />
        <br />
        Section ""<br />
        Nop ; Nothing installed by default<br />
        SectionEnd<br />
        <br />
        Section "Product 1"<br /></b>
      </blockquote><b>ReadRegStr $0 HKLM "software\product1" "maindir"<br />
      StrCmp $0 "" LabNotFound LabFound<br />
      LabFound:<br />
      StrCpy $INSTDIR $0 ; optional, if you want to use $INSTDIR later.<br />
      SetOutPath $0<br />
      File "Source\MyFileToInstall"<br />
      Goto LabEnd<br />
      LabNotFound:<br />
      MessageBox MB_OK "Program not found."<br />
      Goto LabEnd<br />
      LabEnd:<br />
      SectionEnd<br />
      <br />
      Section "Product 2"<br />
      ; Similar to product 1 but checking a different reg key<br />
      ; for if it's installed and getting a different install<br />
      ; dir from a different reg key<br />
      SectionEnd<br />
      <br />
      And that's it.<br />
      <br /></b>

      <blockquote>
        <b><br />
        Questions: A) Does anyone else want these functions? Obviously I found them pretty useful, but I don't know how often people are going to want to do so many registry related things in their installers.<br />
        B) If people do want them, how do I go about submitting the code for a release?</b>
      </blockquote>:)<br />
      <br />
      -Justin
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Dave Carter</span><br />
      <span class="post-time small text-muted">27th April 2001 16:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Doh!<br />
      <br />
      And I was feeling so clever as well :) Thanks Justin, I'll update my script to use the standard functions, and stick with the release version of NSIS.<br />
      <br />
      Dave.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
