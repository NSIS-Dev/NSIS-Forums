<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="NSIS Get System Memory" />

  <title>NSIS Get System Memory - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">NSIS Get System Memory</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=242501">NSIS Get System Memory</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vinnietran</span><br />
      <span class="post-time small text-muted">3rd April 2006 17:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>NSIS Get System Memory</strong><br />
      I am using this to get the system memory:<br />
      <br />
      # allocate<br />
      System::Alloc 32<br />
      Pop $1<br />
      # call<br />
      System::Call "Kernel32::GlobalMemoryStatus(i r1)"<br />
      # get<br />
      System::Call "*$1(i.r2, i.r3, i.r4, i.r5, i.r6, i.r7, i.r8, i.r9)"<br />
      # free<br />
      System::Free $1<br />
      # print<br />
      DetailPrint "Structure size: $2 bytes"<br />
      DetailPrint "Memory load: $3%"<br />
      DetailPrint "Total physical memory: $4 bytes"<br />
      DetailPrint "Free physical memory: $5 bytes"<br />
      DetailPrint "Total page file: $6 bytes"<br />
      DetailPrint "Free page file: $7 bytes"<br />
      DetailPrint "Total virtual: $8 bytes"<br />
      DetailPrint "Free virtual: $9 bytes"<br />
      <br />
      But for some reason, it is not showing the correct memory information. Example, I have a system with 4GB memory. I ran the code above to get the memory information and I am only getting about 2GB. Can anyone help me please?<br />
      <br />
      Thanks.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">3rd April 2006 18:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Probably a stupid question, but does Windows say that you have 4GB under My Computer?<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vinnietran</span><br />
      <span class="post-time small text-muted">3rd April 2006 18:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Afrow. That is not a stupid question.<br />
      <br />
      Yes. The system say 4GB. I am running this on Windows 2003.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">3rd April 2006 18:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">System plug-in vars looks like signed int (or I not found DWORD | unsigned mentioned in it's Readme), so I always have in mind that problems may occure with handles and other unsigned. So may be good to update data types set (or docs if there are some tricks for DWORD)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vinnietran</span><br />
      <span class="post-time small text-muted">3rd April 2006 21:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">When I ran the sample codes above from any Windows 2000, 2003, and XP with memory between 3GB-4GB of memory, I am getting the same number:<br />
      <br />
      Here is the output for physical memory: 2147483647 bytes (this is about 2GB right - :) if my calculation is correct).<br />
      <br />
      Is there a limitation with calling this Kernel32::GlobalMemoryStatus?<br />
      <br />
      The system shows 4GB, but I am getting only 2GB, any other way to get the correct system physical memory information?<br />
      <br />
      Thanks in advance.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">3rd April 2006 21:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Use GlobalMemoryStatusEx instead of GlobalMemoryStatus.<br />
      <a href="http://www.cygwin.com/ml/cygwin/2004-12/msg00156.html" target="_blank">http://www.cygwin.com/ml/cygwin/2004-12/msg00156.html</a><br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vinnietran</span><br />
      <span class="post-time small text-muted">3rd April 2006 21:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Stu<br />
      <br />
      Any sample, what parameters do I need to pass in.<br />
      <br />
      I tried it but it returns with 0s.<br />
      <br />
      Thanks.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vinnietran</span><br />
      <span class="post-time small text-muted">4th April 2006 00:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello Everyone. Does anyone have the example for GlobalMemoryStatusEx which Stu mentioned above. I tried it but it gave me whole bunch of zeros. I think I have problem with the output<br />
      <br />
      System::Call "Kernel32::GlobalMemoryStatus(i r1)"<br />
      # get<br />
      System::Call "*$1(i.r2, i.r3, i.r4, i.r5, i.r6, i.r7, i.r8, i.r9)"<br />
      <br />
      Thanks in advance.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vinnietran</span><br />
      <span class="post-time small text-muted">4th April 2006 00:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ooops sorry correction<br />
      <br />
      System::Call "Kernel32::GlobalMemoryStatusEx(i r1)"<br />
      # get<br />
      System::Call "*$1(i.r2, i.r3, i.r4, i.r5, i.r6, i.r7, i.r8, i.r9)"</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">4th April 2006 08:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">GlobalMemoryStatusEx uses the MEMORYSTATUSEX structure which has another parameter that specifies the extended memory (ullAvailExtendedVirtual).<br />
      <br />
      Try:<br />
      System::Call "*$1(i.r2, i.r3, i.r4, i.r5, i.r6, i.r7, i.r8, i.r9, i.r10)"<br />
      # $R0 = ullAvailExtendedVirtual<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vinnietran</span><br />
      <span class="post-time small text-muted">4th April 2006 15:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Stu,<br />
      <br />
      That's what I thought too. This is the code I executed.<br />
      <br />
      # allocate<br />
      System::Alloc 32<br />
      Pop $1<br />
      # call<br />
      System::Call "Kernel32::GlobalMemoryStatusEx(i r1)"<br />
      # get<br />
      System::Call "*$1(i.r2, i.r3, i.r4, i.r5, i.r6, i.r7, i.r8, i.r9, i.r10)"<br />
      # free<br />
      System::Free $1<br />
      # print<br />
      DetailPrint "Structure size: $2 bytes"<br />
      DetailPrint "Memory load: $3%"<br />
      DetailPrint "Total physical memory: $4 bytes"<br />
      DetailPrint "Free physical memory: $5 bytes"<br />
      DetailPrint "Total page file: $6 bytes"<br />
      DetailPrint "Free page file: $7 bytes"<br />
      DetailPrint "Total virtual: $8 bytes"<br />
      DetailPrint "Free virtual: $9 bytes"<br />
      <br />
      And this is what I get for returned:<br />
      <br />
      Structure size: 0 bytes<br />
      Memory load: 0%<br />
      Total physical memory: 0 bytes<br />
      Free physical memory: 0 bytes<br />
      Total page file: 0 bytes<br />
      Free page file: 0 bytes<br />
      Total virtual: 0 bytes<br />
      Free virtual: 0 bytes<br />
      Completed<br />
      <br />
      Is it might have to do what datatypes it is? I'd tried with different datatypes such as l-large int, t-string, etc.<br />
      <br />
      --Vinnie</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">4th April 2006 15:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Most of the values in MEMORYSTATUSEX are 64-bit unsigned integers. You should use 'l' instead of 'i' in the System plug-in call. You should also allocate more space as the structure is bigger and initialize the first member of the structure with its size.</p>
      <pre>
<code># allocate<br />System::Alloc 64<br />Pop $1<br /># init<br />System::Call "*$1(i64)"<br /># call<br />System::Call "Kernel32::GlobalMemoryStatusEx(i r1)"<br /># get<br />System::Call "*$1(i.r2, i.r3, l.r4, l.r5, l.r6, l.r7, l.r8, l.r9, l.r10)"<br /># free<br />System::Free $1<br /># print<br />DetailPrint "Structure size: $2 bytes"<br />DetailPrint "Memory load: $3%"<br />DetailPrint "Total physical memory: $4 bytes"<br />DetailPrint "Free physical memory: $5 bytes"<br />DetailPrint "Total page file: $6 bytes"<br />DetailPrint "Free page file: $7 bytes"<br />DetailPrint "Total virtual: $8 bytes"<br />DetailPrint "Free virtual: $9 bytes"</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vinnietran</span><br />
      <span class="post-time small text-muted">4th April 2006 15:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank You Very Much Kichik. You are the GOD. This worksssssss (well, at least on my box :) ). Let me go try it on the other system.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vinnietran</span><br />
      <span class="post-time small text-muted">4th April 2006 19:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">How can I convert the Total Physical Memory which is in bytes to Mbytes?<br />
      <br />
      I tried "IntOp $4 $4 / 1048576 but it is returning 0.<br />
      <br />
      I guess IntOp can only handle so much. Is there another way to convert?<br />
      <br />
      Thanks.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">4th April 2006 19:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>
      <pre>
<code>System::Int64Op $4 / 1048576<br />Pop $4</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vinnietran</span><br />
      <span class="post-time small text-muted">4th April 2006 19:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
