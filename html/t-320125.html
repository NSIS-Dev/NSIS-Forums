<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Register a BHO through an NSIS installer" />

  <title>Register a BHO through an NSIS installer - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Register a BHO through an NSIS installer</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=320125">Register a BHO through an NSIS installer</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kumar.kapil</span><br />
      <span class="post-time small text-muted">21st June 2010 17:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Register a BHO through an NSIS installer</strong><br />
      I have an IE BHO which I was packaging through the Visual Studio setup and deployment project. I now want to the package it through an NSIS installer.<br />
      <br />
      My BHO was registering in the following way:<br />
      <br />
      [ComRegisterFunctionAttribute]<br />
      public static void Register(Type t)<br />
      {<br />
      string guid = t.GUID.ToString("B");<br />
      <br />
      RegistryKey rkClass = Registry.ClassesRoot.CreateSubKey(@"CLSID\"+guid );<br />
      RegistryKey rkCat = rkClass.CreateSubKey("Implemented Categories");<br />
      <br />
      string name = toolbarName;<br />
      string help = toolbarHelpText;<br />
      <br />
      rkClass.SetValue(null, name );<br />
      rkClass.SetValue("MenuText", name );<br />
      rkClass.SetValue("HelpText", help );<br />
      <br />
      if( 0 != (style &amp; BandObjectStyle.Vertical) )<br />
      rkCat.CreateSubKey("{00021493-0000-0000-C000-000000000046}");<br />
      <br />
      if( 0 != (style &amp; BandObjectStyle.Horizontal) )<br />
      rkCat.CreateSubKey("{00021494-0000-0000-C000-000000000046}");<br />
      <br />
      if( 0 != (style &amp; BandObjectStyle.TaskbarToolBar) )<br />
      rkCat.CreateSubKey("{00021492-0000-0000-C000-000000000046}");<br />
      <br />
      if( 0 != (style &amp; BandObjectStyle.ExplorerToolbar) )<br />
      Registry.LocalMachine.CreateSubKey(@"SOFTWARE\Microsoft\Internet Explorer\Toolbar").SetValue(guid,name);<br />
      <br />
      }<br />
      <br />
      While this is taken care of by the msi installer that is made by VS, I want to know how can I do the same using NSIS?<br />
      <br />
      Any help would be appreciated!<br />
      <br />
      Kapil</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">22nd June 2010 16:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If it's just a matter of writing those registry values then you've got all the registry functions in the NSIS documentation. You'll just have to get the GUID and pass it to NSIS. You could do this via a .NET DLL (invoked using the <a href="http://nsis.sourceforge.net/Call_.NET_DLL_methods_plug-in" target="_blank">CLR plug-in</a>) or via a .NET console app which you execute with <a href="http://nsis.sourceforge.net/ExecDos_plug-in" target="_blank">ExecDos</a>/nsExec.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">th_mi</span><br />
      <span class="post-time small text-muted">23rd June 2010 09:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by kumar.kapil</small><br />
        RegistryKey rkClass = Registry.ClassesRoot.CreateSubKey(@"CLSID\"+guid );<br />
        RegistryKey rkCat = rkClass.CreateSubKey("Implemented Categories");<br />
        <br />
        string name = toolbarName;<br />
        string help = toolbarHelpText;<br />
        <br />
        rkClass.SetValue(null, name );<br />
        rkClass.SetValue("MenuText", name );<br />
        rkClass.SetValue("HelpText", help );<br />
        <br />
        if( 0 != (style &amp; BandObjectStyle.Vertical) )<br />
        rkCat.CreateSubKey("{00021493-0000-0000-C000-000000000046}");<br />
        <br />
        if( 0 != (style &amp; BandObjectStyle.Horizontal) )<br />
        rkCat.CreateSubKey("{00021494-0000-0000-C000-000000000046}");<br />
        <br />
        if( 0 != (style &amp; BandObjectStyle.TaskbarToolBar) )<br />
        rkCat.CreateSubKey("{00021492-0000-0000-C000-000000000046}");<br />
        <br />
        if( 0 != (style &amp; BandObjectStyle.ExplorerToolbar) )<br />
        Registry.LocalMachine.CreateSubKey(@"SOFTWARE\Microsoft\Internet Explorer\Toolbar").SetValue(guid,name);
      </blockquote>Your GUID should be known, than you can do it all by yourself using the Registry functions WriteRegXXX of NSIS.<br />
      <br />
      If your shell extension DLL (hopefully) meets the Microsoft design guidlines there is also an much more easier way:<br />
      <br />
      You can use the exported function DllRegisterServer (and for uninstalling DllUnregisterServer). This can easyly done using "RegSvr32.exe". This would be in NSIS like this command:<br />
      <br />
      Install:
      <pre>
<code>ExecWait "$SYSDIR\regsvr32.exe /s $\"$INSTDIR\YourDLLName.dll$\""</code>
</pre><br />
      Uninstall:
      <pre>
<code>ExecWait "$SYSDIR\regsvr32.exe /s /u $\"$INSTDIR\YourDLLName.dll$\""</code>
</pre><br />
      <br />
      It is important tu use quotation marks in the command argument of RegSvr32 since the setup directory may contain spaces. If the quotation marks are missing the command argument will be cut at the first space in the argument by RegSvr32!<br />
      <br />
      <b><font color="red">In case your shell extension DLL does not support the registering and unregistering process completely I advice you to implement this in you DLL. This may be needed in case a re-registering or a manual unregistering is nesessary. This makes life much much easier for your customer support!</font></b><br />
      <br />
      hope this helped a little!?<br />
      <br />
      Best regards<br />
      <br />
      th_mi
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">23rd June 2010 10:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Do you have to use regsvr32? What about NSIS's RegDLL?<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">th_mi</span><br />
      <span class="post-time small text-muted">24th June 2010 09:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        Do you have to use regsvr32?
      </blockquote>No, if you know RegDLL :)<br />
      <br />

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        What about NSIS's RegDLL?
      </blockquote>Now I can use it, since I know it ;)
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
