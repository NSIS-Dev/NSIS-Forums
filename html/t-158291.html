<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Detect Multiple Language's Bug"><title>Detect Multiple Language's Bug - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Detect Multiple Language's Bug</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=158291">Detect Multiple Language's Bug</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">s793016</span><br><span class="post-time small text-muted">2nd December 2003 09:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Detect Multiple Language's Bug</strong><br>Sorry, my English is very very poor.<br><br>I found that "Regional Option" will make NSIS's to choose wrong Language during callback Function .onInit.<br><br>This will happened at all windows platform.<br><br>Screen Capture Enviroment:<br>OS - WinXP SP1 English Version<br><b>Languages for non-unicode programs - Always set to "Chinese(Taiwan)"</b><br>NSIS Version - 2.0 B4 (final)<br><br>Let me show you an example:<br><br>1.The good one ... almost ...<br><a href="http://cpatch.org/witchfive/pastepic/l1.jpg" target="_blank">http://cpatch.org/witchfive/pastepic/l1.jpg</a><br><br>2.Just change "Regional Option" to "English"<br><a href="http://cpatch.org/witchfive/pastepic/l2.jpg" target="_blank">http://cpatch.org/witchfive/pastepic/l2.jpg</a><br><br>3.Just change "Regional Option" to "Japanese"<br><a href="http://cpatch.org/witchfive/pastepic/l3.jpg" target="_blank">http://cpatch.org/witchfive/pastepic/l3.jpg</a><br><br>4.Just change "Regional Option" to "Chinese (PRC)"<br><a href="http://cpatch.org/witchfive/pastepic/l4.jpg" target="_blank">http://cpatch.org/witchfive/pastepic/l4.jpg</a><br><br>== LangTest.nsi ==<br>OutFile LangTest.exe<br>Name LangBugTests<br>XPStyle on<br><br>LoadLanguageFile "${NSISDIR}\Contrib\Language files\English.nlf"<br>LoadLanguageFile "${NSISDIR}\Contrib\Language files\TradChinese.nlf"<br>LoadLanguageFile "${NSISDIR}\Contrib\Language files\SimpChinese.nlf"<br>LoadLanguageFile "${NSISDIR}\Contrib\Language files\Japanese.nlf"<br><br>LangString IL ${LANG_ENGLISH} "EN Installer Language"<br>LangString IL ${LANG_TRADCHINESE} "TW Installer Language"<br>LangString IL ${LANG_SIMPCHINESE} "CN Installer Language"<br>LangString IL ${LANG_JAPANESE} "JP Installer Language"<br><br>LangString CL ${LANG_ENGLISH} "EN Please select a language."<br>LangString CL ${LANG_TRADCHINESE} "TW Please select a language."<br>LangString CL ${LANG_SIMPCHINESE} "CN Please select a language."<br>LangString CL ${LANG_JAPANESE} "JP Please select a language."<br><br>LangString PM ${LANG_ENGLISH} "EN"<br>LangString PM ${LANG_TRADCHINESE} "TW"<br>LangString PM ${LANG_SIMPCHINESE} "CN"<br>LangString PM ${LANG_JAPANESE} "JP"<br><br>Section Sec1Name sec1<br>SectionEnd<br><br>Function .onInit<br>LangDLL::LangDialog "$(IL)" "$(CL)" 4 $(PM)Eng 1033 $(PM)TW 1028 $(PM)CN 2052 $(PM)JP 1041<br>quit<br>FunctionEnd<br>==</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">2nd December 2003 12:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, the only method I know of getting the user's setting of `Languages for non-Unicode programs' is GetACP(). Essentially, that's the only thing it needs to change. It just needs to change the code page for the conversion from/to Unicode. The only problem is that not all languages have a different code page. For example, ANSI - Central European (1250) is used for Polish, Czech, Romanian, Slovak and many more. ANSI - Latin I (1252) is used by even more languages. Given this situation, getting the user's default language is the best method I have found.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">s793016</span><br><span class="post-time small text-muted">2nd December 2003 14:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sorry, my English is very very poor.<br><br>OK, I found this at NSIS Archie, and tested OK to get user's setting of "Languages for non-Unicode programs" exactly correct at all windows platform.<br><br>== code ==<br>System::Call 'kernel32::GetSystemDefaultLangID() i .r0'<br>IntOp $0 $0 &amp; 0xFFFF<br>IntFMT $0 "%04X" $0<br>==<br><br>Unfortunally, I still can't change the Language detected by NSIS during callback function .onInit.<br><br>And after callback function .onInit finished, the Language could be correct by some tricker.<br><br>Besides, this bug make us getting wrong Language at those "Messages" proceed durning callback function .onInit, like LANGDLL, MessageBox, and something else.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">2nd December 2003 19:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The user might have selected a different language for himself, automatically selecting the system's language will not be wise. But if you really want to do it use:<br><br>System::Call 'kernel32::GetSystemDefaultLangID() i .a'<br><br>in .onInit before the call to LangDLL.<br><br>As for the messages in .onInit, the language selected in .onInit, if different than the one chosen by NSIS, only takes affect after .onInit.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>