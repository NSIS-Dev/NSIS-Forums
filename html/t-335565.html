<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="NSIS installer causes APPDATA variable to disappear from environment" />

  <title>NSIS installer causes APPDATA variable to disappear from environment - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">NSIS installer causes APPDATA variable to disappear from environment</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=335565">NSIS installer causes APPDATA variable to disappear from environment</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">forest_gump</span><br />
      <span class="post-time small text-muted">4th October 2011 06:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>NSIS installer causes APPDATA variable to disappear from environment</strong><br />
      I'm facing a very unusual problem that occurs on a few PCs only, and don't have a clue on where to begin. I have an NSIS based installer which uses the following plugins and runs in admin mode.<br />
      <br />
      !include MUI2.nsh<br />
      !include LogicLib.nsh<br />
      !include Library.nsh<br />
      !include EnvVarUpdate.nsh<br />
      !include "winmessages.nsh"<br />
      <br />
      On some PCs, the windows APPDATA environment variable "goes away" from explorer.exe's environment space when my installer has completed running i.e. we cannot echo it anymore on a new cmd shell started after the installer is complete. The only way to get it back is to kill explorer.exe and restart it or reboot the PC. Note, my installer does not use APPDATA directly at all.<br />
      This is reproducible every time on certain PCs. so far I've observed this on XP PCs only. We think some shell extension is corrupting environment space but can't figure out which one. Clearly NSIS or one of it's extensions seems to be playing a role in corrupting the environment space. What could be going on behind the scenes that could cause such a behavior ? Can anyone please help ?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">forest_gump</span><br />
      <span class="post-time small text-muted">4th October 2011 06:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Oh, I forgot to say that I'm using NSIS 2.46 (large).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">forest_gump</span><br />
      <span class="post-time small text-muted">6th October 2011 00:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">can anyone please help give a clue ? is this a known issue ?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">6th October 2011 12:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If it's a known issue then you will find it by searching. Otherwise, it must be something in your script.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">6th October 2011 20:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well it's not that it MUST be something in the script, but it probably is. Please supply us with a minimal script that reproducibly shows this problem.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">7th October 2011 08:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm guessing !include EnvVarUpdate.nsh and its code is the problem, generally the env. scripts on the wiki are unsafe</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
