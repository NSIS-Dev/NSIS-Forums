<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="strcmp problem"><title>strcmp problem - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">strcmp problem</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=194875">strcmp problem</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">sirloin</span><br><span class="post-time small text-muted">27th September 2004 19:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>strcmp problem</strong><br>I run this function(writenewvars) to check for a string on a line number in a some text files...strcmp seems to not funtion correctly,can some one point out my error?<br><br>this function(writenewvars) faults at strcmp.<br><br>hmm cant upload an attachment so i have to do this way...<br><br>Function ReadFileLine<br>Exch $0 ;file<br>Exch<br>Exch $1 ;line number<br>Push $2<br>Push $3<br><br>FileOpen $2 $0 r<br>StrCpy $3 0<br><br>Loop:<br>IntOp $3 $3 + 1<br>ClearErrors<br>FileRead $2 $0<br>IfErrors +2<br>StrCmp $3 $1 0 loop<br>FileClose $2<br><br>Pop $3<br>Pop $2<br>Pop $1<br>Exch $0<br>FunctionEnd<br>(by AfrowUK)<br><br>Function WriteToFileLine<br>Exch $0 ;file<br>Exch<br>Exch $1 ;line number<br>Exch 2<br>Exch $2 ;string to write<br>Exch 2<br>Push $3<br>Push $4<br>Push $5<br>Push $6<br>Push $7<br><br>GetTempFileName $7<br>FileOpen $4 $0 r<br>FileOpen $5 $7 w<br>StrCpy $3 0<br><br>Loop:<br>ClearErrors<br>FileRead $4 $6<br>IfErrors Exit<br>IntOp $3 $3 + 1<br>StrCmp $3 $1 0 +3<br>FileWrite $5 "$2$\r$\n$6"<br>Goto Loop<br>FileWrite $5 $6<br>Goto Loop<br>Exit:<br><br>FileClose $5<br>FileClose $4<br><br>SetDetailsPrint none<br>Delete $0<br>Rename $7 $0<br>SetDetailsPrint both<br><br>Pop $7<br>Pop $6<br>Pop $5<br>Pop $4<br>Pop $3<br>Pop $2<br>Pop $1<br>Pop $0<br>FunctionEnd<br>(by AfrowUK)<br><br>(my Function)<br>Function writenewvars<br><br>IfFileExists "$INSTDIR\myfile.txt" go next<br>go:<br>Push 25 ;line number to read from<br>Push "$INSTDIR\myfile.txt" ;text file to read<br>Call ReadFileLine<br>Pop $0 ;output string (read from file.txt)<br>strcmp $0 "" write next<br>write:<br>Push "my string"<br>Push 25<br>Push "$INSTDIR\myfile.txt"<br>Call WriteToFileLine<br>goto next<br>next:<br>IfFileExists "$INSTDIR\myfile2.txt" go1 next1<br>go1:<br>Push 25 ;line number to read from<br>Push "$INSTDIR\myfile2.txt" ;text file to read<br>Call ReadFileLine<br>Pop $0 ;output string (read from file.txt)<br>strcmp $0 "" write1 next1<br>write1:<br>Push "my string"<br>Push 25<br>Push "$INSTDIR\myfile2.txt"<br>Call WriteToFileLine<br>goto next1<br>next1:<br>IfFileExists "$INSTDIR\myfile3.txt" go2 next2<br>go2:<br>Push 25 ;line number to read from<br>Push "$INSTDIR\myfile3.txt" ;text file to read<br>Call ReadFileLine<br>Pop $0 ;output string (read from file.txt)<br>strcmp $0 "" write2 next2<br>write2:<br>Push "my string"<br>Push 25<br>Push "$INSTDIR\myfile3.txt"<br>Call WriteToFileLine<br>goto next2<br>next2:<br>IfFileExists "$INSTDIR\myfile4.txt" go3 next3<br>go3:<br>Push 25 ;line number to read from<br>Push "$INSTDIR\myfile4.txt" ;text file to read<br>Call ReadFileLine<br>Pop $0 ;output string (read from file.txt)<br>strcmp $0 "" write3 next3<br>write3:<br>Push "my string"<br>Push 25<br>Push "$INSTDIR\myfile4.txt"<br>Call WriteToFileLine<br>next3:<br><br>functionend<br><br>what happens is that the code fails to run after the strcmp line ,it continues to the next function regardless of labels...even though dumpstate reports $0 as expected "my string" is read but the labels are ignored.As a matter of fact as long as there is a [is not equal] label the code after strcmp does not run at all(i can test this by running dumpstate or messagebox command)is equal code is ran regardless...relative jumps perform the same way...it writes "my string" regardless what is stored in $0.I think my code is correct and this is a strcmp problem.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">27th September 2004 21:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Nope. Code problem.<br><br>Your code is rather long too, you could cut it down greatly:</p><pre>
<code><br>!macro WriteNewVars String File Number<br> IfFileExists "${File}" 0 Next_${Number}<br>  Push 25 ;line number to read from<br>  Push "${File}" ;text file to read<br>   Call ReadFileLine<br>  Pop $0 ;output string (read from file.txt)<br>  Push $0<br>   Call TrimNewLines<br>  Pop $0<br>  StrCmp $0 "" 0 Next_${Number}<br>  Push "${String}"<br>  Push 25<br>  Push "${File}"<br>   Call WriteToFileLine<br> Next_${Number}:<br>!macroend<br><br>Function WriteNewVars<br> !insertmacro WriteNewVars "my string" "$INSTDIR\myfile1.txt" "1"<br> !insertmacro WriteNewVars "my string" "$INSTDIR\myfile2.txt" "2"<br> !insertmacro WriteNewVars "my string" "$INSTDIR\myfile3.txt" "3"<br> !insertmacro WriteNewVars "my string" "$INSTDIR\myfile4.txt" "4"<br>FunctionEnd<br></code>
</pre><br>
      <br>
      Notice the new function call: TrimNewLines.<br>
      You were comparing $0 to "" when $0 would have been $\r$\n (= a blank line). TrimNewLines will remove $\r$\n so $0 becomes "". You can get the extra function from the archive.<br>
      <br>
      -Stu
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sirloin</span><br>
      <span class="post-time small text-muted">28th September 2004 16:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">wow I R TEH NEWB :) thxz alot afrow for your time to help,works great,and I learned some things.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>