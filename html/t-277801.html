<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Uninstaller + UAC plugin + Vista = confusion"><title>Uninstaller + UAC plugin + Vista = confusion - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Uninstaller + UAC plugin + Vista = confusion</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=277801">Uninstaller + UAC plugin + Vista = confusion</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">pengyou</span><br><span class="post-time small text-muted">23rd September 2007 16:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Uninstaller + UAC plugin + Vista = confusion</strong><br>After using the UAC plugin to make my installer work properly when run on Vista, I updated the uninstaller to also use the UAC plugin. But the uninstaller did not work properly when it was started by a "standard" user on Vista.<br><br>The problem is that when a "standard" user runs the uninstaller via the Vista equivalent of "Add/Remove Programs" Vista runs it as an administrator right from the start (i.e. it ignores the RequestExecutionLevel setting). This means the UAC plugin does not start the second process.<br><br>I have found that if I create a Start Menu shortcut to my uninstaller and use that from a "standard" account then the UAC plugin will create the second process because Vista pays attention to the RequestExecutionLevel setting in this case.<br><br>Am I doing something wrong or will I just have to tell my users to use the Start Menu to uninstall the program?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">23rd September 2007 18:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If you write the uninstall entry in HKCU it does not elevate, when you write to HKLM, it is a all-users type install and you should probably be prepared to handle any user uninstalling it.<br><br>If you add two dwords to your uninstall entry in HKLM:<br>NoElevateOnModify=1<br>NoRemove=1<br><br>you sort of get the desired effect, only problem is that the UI now calls it change instead of uninstall<br><br>Unless MS provides another dword for uninstall to disable elevation, there is probably nothing you can do (too late for RTM)<br><br>The UAC plugin was mostly designed for install use, not the uninstaller (Solve the run checkbox problem on the finish page)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pengyou</span><br><span class="post-time small text-muted">23rd September 2007 18:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thank you for the helpful reply. I'll try your suggestion.<br><br>I have found the UAC plugin very useful, thanks for creating it!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">29th March 2010 19:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I tried to use Anders' trick, only to find that clicking 'Change' in Add/Remove Programs wouldn't launch the uninstaller at all. Instead it displayed some generic error. Together with Anders I've found the solution:<br><br>You need to add a ModifyPath regstring to the HKLM uninstall key. You can probably skip the usual UninstallString, in this case. So it'd look something like:<br><br>NoElevateOnModify=1<br>NoRemove=1<br>ModifyPath="$INSTDIR\uninstall.exe"<br><br><br>Hope this helps someone someday.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">323846</span><br><span class="post-time small text-muted">30th April 2010 10:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Yes</strong><br>YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES<br><br><br>Thanks! Thats it!<br><br>Note: You'll need UninstallString, otherwise your program won't show up in the Add/Remove programs dialog of the control panel ...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">DolphinSandwich</span><br><span class="post-time small text-muted">12th November 2010 06:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by MSG</small><br>You need to add a ModifyPath regstring to the HKLM uninstall key. You can probably skip the usual UninstallString, in this case. So it'd look something like:<br>NoElevateOnModify=1<br>NoRemove=1<br>ModifyPath="$INSTDIR\uninstall.exe"<br>Hope this helps someone someday.</blockquote>Almost, though much of the help is in some sort of imprecise pseudocode, so I have to admit, I can't really see a practical way around this.<br><br>When I write the uninstaller, I don't have easy access to the uninstall key.<br>I write something like this: WriteUninstaller $INSTDIR\Uninstaller.exe<br><br>Is this suggestion, then, meant to say that we determine what the key is (with no help from any apis or existing libraries), write some code to write to that registry, taking care to set NoRemove/ModifyPath.<br><br>ie are you suggesting the answer you've given, translates to something like this:<br>WriteRegStr HKLM $0 "NoElevateOnModify" 1<br>...</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">12th November 2010 06:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><small>Originally posted by DolphinSandwich</small><br>Is this suggestion, then, meant to say that we determine what the key is (with no help from any apis or existing libraries), write some code to write to that registry, taking care to set NoRemove/ModifyPath.<br><br>ie are you suggesting the answer you've given, translates to something like this:<br>WriteRegStr HKLM $0 "NoElevateOnModify" 1<br>...</blockquote>No, the solution is to write those regstrings during installation, not in the uninstaller. When you add your uninstaller to the Add/Remove Programs list, you write an UninstallString, DisplayName and DisplayIcon entry to "Software\Microsoft\Windows\CurrentVersion\Uninstall\YouAppName", right? That's when you also add the NoElevateOnModify and NoRemove entries.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">DolphinSandwich</span><br><span class="post-time small text-muted">15th November 2010 00:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Right I see.<br>Something like this:<br><br>WriteRegStr HKLM ${ControlPanelKey} "NoElevateOnModify" 1<br>WriteRegStr HKLM ${ControlPanelKey} "NoRemove" 1</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>