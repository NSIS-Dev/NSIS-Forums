<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Function and section" />

  <title>Function and section - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Function and section</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=265779">Function and section</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rxs2k5</span><br />
      <span class="post-time small text-muted">14th February 2007 12:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Function and section</strong><br />
      Hi all pros,<br />
      <br />
      I have a question.<br />
      <br />
      example I have a function page<br /></p>

      <blockquote>
        Function PageLeave<br />
        <br />
        ## Pop password &amp; username from stack<br />
        Pop $R0<br />
        Pop $R1<br />
        <br />
        ## Get MD5 string for username<br />
        MD5DLL::GetMD5String $R0<br />
        Pop $R0<br />
        <br />
        ## Get MD5 string for password<br />
        MD5DLL::GetMD5String $R1<br />
        Pop $R1<br />
        <br />
        ## A bit of validation<br />
        StrCmp $R0 '${Username1MD5}' 0 +2<br />
        StrCmp $R1 '${Password1MD5}' Good Bad<br />
        StrCmp $R0 '${Username3MD5}' 0 +2<br />
        StrCmp $R1 '${Password3MD5}' Die Bad<br />
        <br />
        Bad:<br />
        IntOp $R3 $R3 + 1<br />
        MessageBox MB_OK|MB_ICONEXCLAMATION "blah blah blah"<br />
        StrCmp $R3 2 +2<br />
        Abort<br />
        Quit<br />
        Good:<br />
        Goto Test<br />
        Die:<br />
        Goto Destroy<br />
        FunctionEnd
      </blockquote>Here's how it goes<br />
      <br />
      Die:<br />
      Goto Destroy<br />
      <br />
      The Destroy is actually in another sections which means I have a main and a secondary.<br />
      <br />
      In the main section, I have Test:<br />
      <br />
      In the secondary section, I have Destory:<br />
      <br />
      How can I make the Function to obey or recongise my label ?<br />
      <br />
      Die:<br />
      Goto Destroy<br />
      <br />
      Which will actually know that I have a secondary section, and have Destory: in it ??<br />
      <br />
      I asking this because I got this error<br />
      <br />

      <blockquote>
        Error: could not resolve label "Destroy" in function "passwordPageLeave"<br />
        Error - aborting creation process
      </blockquote>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">14th February 2007 17:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Generally you can't jump from a function to a section's label, but why you're making things such complicated, is there any particular reason?<br />
      I guess would be easier and accurate as well, if the destroy condition resides into the passwordPageLeave function.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rxs2k5</span><br />
      <span class="post-time small text-muted">15th February 2007 00:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I trying to make these because I was thinking is it possible, coz example I have an master access and client access rights in these password, it will work separate ways.<br />
      <br />
      So what solution do u recommend for making such complicated access rights</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">15th February 2007 08:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What I'm able to understand from your code is that label destroy pops up a message and terminates the installer.<br />
      You don't need to add it in a section while sections executed in order within InstFiles page.<br />
      You could make a separate function named destroy which performs specific actions and terminates the installer, that you may call when die condition is true, e.g.<br />
      Die:<br />
      Call Destroy</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rxs2k5</span><br />
      <span class="post-time small text-muted">15th February 2007 12:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hmm...<br />
      <br />
      Just need to know more about Function, If you do not mind Redwine.<br />
      <br />
      I been playing around with sections for some times but never got a chance to understand Function.<br />
      <br />
      Maybe you have some little example of what can function can do or may do to allow a task like another installer to install sliently or maybe a priorty access rights...<br />
      <br />
      Just anything you can think of a solution to my case because I dun quite understand Function , creating a new Page Custom Destroy so and so can help me fufill my task</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">15th February 2007 22:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That it might need to be said more than the NSIS documentation, is that taking a tour to wiki where there are tons of examples, would help you understand everything much better than any possible example I could provide here.<br />
      <br />
      <a href="http://nsis.sourceforge.net/Developer_Center" target="_blank">http://nsis.sourceforge.net/Developer_Center</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rxs2k5</span><br />
      <span class="post-time small text-muted">16th February 2007 08:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Redwine,<br />
      <br />
      I want to know more about this script u made during runtime<br />
      <br />
      "Managing Sections on Runtime"<br />
      <a href="http://nsis.sourceforge.net/Managing_Sections_on_Runtime" target="_blank">http://nsis.sourceforge.net/Managing...ons_on_Runtime</a><br />
      <br />
      Is it possible to make function to change the sections?<br />
      <br />
      example.<br /></p>

      <blockquote>
        <br />
        !include Sections.nsh<br />
        !include "myheader.nsh"<br />
        <br />
        <br />
        Function passwordPageLeave<br />
        1............ good bad<br />
        2............ die bad<br />
        <br />
        bad:<br />
        .....<br />
        good:<br />
        Goto exit<br />
        die:<br />
        Call Destroy<br />
        exit:<br />
        FunctionEnd<br />
        <br />
        Function Destroy<br />
        ${UnSelectSection} ${SEC0000}<br />
        ${SelectSection} ${SEC001}<br />
        FunctionEnd<br />
        <br />
        Section main SEC0000<br />
        .........<br />
        ........<br />
        ........<br />
        SectionEnd<br />
        <br />
        Section Destory SEC001<br />
        ........<br />
        .......<br />
        .......<br />
        SectionEnd<br />
      </blockquote>This is the problem when I key in username and password for 1, it goes to <b>good</b> then it jump directly into Function Destroy. I do not want it to jump to Function Destroy. Because it is for <b>die</b>. When I key in username and password for 2, it work.<br />
      <br />
      Do you know how can I good and die work separately and obey to activate the selected or unselected sections to use ?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">16th February 2007 18:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Provided that 1 and 2 comparisons both jump to the right label as expected, it is the section destroy which executed not the function destroy.<br />
      The section destroy is executed because it is selected by default, actually the function destroy when called removes the selection of section main.<br />
      You could solve it either by adding the code that section destroy contains into function destroy and remove the mentioned section from the script, or by making this section optional so could select it within the function destroy. e.g.<br />
      Section /o Destory SEC001</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rxs2k5</span><br />
      <span class="post-time small text-muted">17th February 2007 04:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Red Wine,<br />
      <br />
      I followed ur instructions but its seems the same<br />
      <br />
      when I input username and password on 1 in the previous Quoted script, it will run Section main , when I input username and password on 2, it didn't call Destroy even though the Function Destroy is being set, it runs Section main.<br />
      <br />
      I think the Function Destroy<br />
      <br />
      ${UnSelectSection} ${SEC0000}<br />
      ${SelectSection} ${SEC001}<br />
      <br />
      is not even working....<br />
      <br />
      by the way I changed the Section Destroy SEC001 to Section /o Destroy SEC001.<br />
      <br />
      Plus I am getting this warnings<br /></p>

      <blockquote>
        4 warnings:<br />
        unknown variable/constant "{SEC0000}" detected, ignoring (macro:SecUnSelect:3)<br />
        unknown variable/constant "{SEC0000}" detected, ignoring (macro:SecUnSelect:4)<br />
        unknown variable/constant "{SEC001}" detected, ignoring (macro:SecSelect:3)<br />
        unknown variable/constant "{SEC001}" detected, ignoring (macro:SecSelect:4)
      </blockquote>I think its gotta do with the modified header that I had modified.<br />
      <br />

      <blockquote>
        ## HEADER PART BEGINS HERE<br />
        !define SF_USELECTED1 0<br />
        !define SF_SELECTED1 1<br />
        ###############################<br />
        <br />
        !macro SecSelect SecId<br />
        Push $0<br />
        IntOp $0 ${SF_SELECTED1} | ${SF_RO}<br />
        SectionSetFlags ${SecId} $0<br />
        SectionSetInstTypes ${SecId} 1<br />
        Pop $0<br />
        !macroend<br />
        <br />
        !define SelectSection '!insertmacro SecSelect'<br />
        #################################<br />
        <br />
        !macro SecUnSelect SecId<br />
        Push $0<br />
        IntOp $0 ${SF_USELECTED1} | ${SF_RO}<br />
        SectionSetFlags ${SecId} $0<br />
        SectionSetText ${SecId} ""<br />
        Pop $0<br />
        !macroend<br />
        <br />
        !define UnSelectSection '!insertmacro SecUnSelect'<br />
        ###################################<br />
        <br />
        ## HEADER PART ENDS HERE
      </blockquote>one last thing do I have to include this<br />
      Function .onSelChange ???
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">17th February 2007 08:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Not knowing what exactly you're trying to achieve is hard to help, but I don't think the header you're using could be helpful for your case.<br />
      <br />
      I hope following example would offer some direction.<br /></p>
      <pre>
<code>!define CUSTINI "$PLUGINSDIR\custom.ini"<br /><br />!include Sections.nsh<br /><br />outfile test.exe<br />InstallDir "$PROGRAMFILES\test"<br />ShowInstDetails show<br /><br />Page Custom CreateCustom LeaveCustom<br />Page InstFIles<br /><br />Section "main" sec1<br />MessageBox MB_OK "Simulating Case GOOD"<br />SetOutPath "$INSTDIR"<br />DetailPrint "Simulating Case GOOD"<br />SectionEnd<br /><br />Section /o "destroy" sec2<br />MessageBox MB_OK "Simulating Case DESTROY"<br />SetOutPath "$INSTDIR"<br />DetailPrint "Simulating Case DESTROY"<br />SectionEnd <br /><br />Function CreateCustom<br />push $0<br />InstallOptions::Dialog "${CUSTINI}"<br />pop $0<br />pop $0<br />FunctionEnd<br /><br />Function LeaveCustom<br />ReadINIStr $0 "${CUSTINI}" "field 1" "state"<br />StrCmp $0 1 end<br />!insertmacro ReverseSection ${sec1}<br />!insertmacro ReverseSection ${sec2}<br /><br />end:<br />FunctionEnd<br /><br />Function .onInit<br />InitPluginsDir<br />WriteINIStr "${CUSTINI}" "Settings" "NumFields" "2"<br /><br />WriteINIStr "${CUSTINI}" "field 1" "type" "radiobutton"<br />WriteINIStr "${CUSTINI}" "field 1" "text" "simulate case good"<br />WriteINIStr "${CUSTINI}" "field 1" "left" "10"<br />WriteINIStr "${CUSTINI}" "field 1" "right" "-10"<br />WriteINIStr "${CUSTINI}" "field 1" "top" "10"<br />WriteINIStr "${CUSTINI}" "field 1" "bottom" "22"<br />WriteINIStr "${CUSTINI}" "field 1" "state" "1"<br />WriteINIStr "${CUSTINI}" "field 1" "flags" "GROUP"<br /><br />WriteINIStr "${CUSTINI}" "field 2" "type" "radiobutton"<br />WriteINIStr "${CUSTINI}" "field 2" "text" "simulate case destroy"<br />WriteINIStr "${CUSTINI}" "field 2" "left" "10"<br />WriteINIStr "${CUSTINI}" "field 2" "right" "-10"<br />WriteINIStr "${CUSTINI}" "field 2" "top" "26"<br />WriteINIStr "${CUSTINI}" "field 2" "bottom" "38"<br />WriteINIStr "${CUSTINI}" "field 2" "state" "0"<br />FunctionEnd</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rxs2k5</span><br />
      <span class="post-time small text-muted">17th February 2007 16:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Red Wine<br />
      <br />
      You almost hit the solution I needed, I need a little more help.<br />
      <br />
      Function LeaveCustom<br />
      ReadINIStr $0 "${CUSTINI}" "field 1" "state"<br />
      StrCmp $0 1 end<br />
      !insertmacro ReverseSection ${sec1}<br />
      !insertmacro ReverseSection ${sec2}<br />
      <br />
      1.How can I make this implementation without using CUSTINI ?<br />
      <br />
      Can you implement the above to select only 1 section in this code<br />
      <br />
      Function passwordPageLeave<br />
      1............ good bad<br />
      2............ die bad<br />
      <br />
      bad:<br />
      .....<br />
      good:<br />
      Goto exit<br />
      die:<br />
      [ insert an implementation in here, I only want Section Destroy to be selected and not Section Main ]<br />
      exit:<br />
      FunctionEnd<br />
      <br />
      I know there's a way but its seems I cannot get the idea.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">17th February 2007 22:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm afraid I can't help it furthermore, sorry...</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
