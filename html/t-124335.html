<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Need to edit two files after installation (search &amp; replace)" />

  <title>Need to edit two files after installation (search &amp; replace) - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Need to edit two files after installation (search &amp; replace)</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=124335">Need to edit two files after installation (search &amp; replace)</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">8th February 2003 14:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Need to edit two files after installation (search &amp; replace)</strong><br />
      Dear Community,<br />
      <br />
      I have started a project for installing a complete WAMP (webserver with PHP and MySQL). After successfully copying the files to their destination, two files have to be edited. The first is the webservers-configfile, the other one is the php-configurationfile. In these two files I have some directives which correspond to the installation-path. So I want to deliver a modified conf-file with one variable called (e.g.) @@SERVERROOT@@. After installation is completed, I need to search for that string and replace it with "$INSTDIR\path\to\program".<br />
      <br />
      How can this be achieved/solved?<br />
      <br />
      Another question:<br />
      Does anybody know how to search for an existing service and if this exists to make the installer stop (better open a pre-definied textfile with a solution to solve this problem "and go on with the installation after solving")?<br />
      <br />
      Cheers<br />
      Mosestycoon</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">8th February 2003 14:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">To edit files use FileOpen, FileWrite, FileRead, FileSeek and FileClose. Go to <a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=73&amp;instances=0,44" target="_blank">this</a> for a good example. It replaces certain line in a text file with another line. You can set in the config file you are installing a certain line and then have this little script replace it with whatever you want.<br />
      <br />
      To find and stop services use services.dll by Sunjammer from:<br />
      <a href="http://nsis.sourceforge.net/archive/download.php" target="_blank">http://nsis.sourceforge.net/archive/download.php</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">virtlink</span><br />
      <span class="post-time small text-muted">8th February 2003 15:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am really surprised. For even the most complicated things (at least to me) is something to solve it. The answer is even shorter than the question!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">8th February 2003 15:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thx, I will give it a try :-)<br />
      <br />
      Mosestycoon<br />
      <br />
      P.S. Where do I have to place it?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">8th February 2003 15:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's not really commended well, so as I'm a really bad programmer, this is not simple for me ;-(</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">8th February 2003 15:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Put that code after the file extraction code. Maybe it a section of its own called "edit config files", maybe right after the config extraction, that's up to you.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">8th February 2003 20:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I tried it with this function:<br /></p>
      <pre>
<code><br />  FileOpen $0 "$INSTDIR\Apache2\conf\httpd.pre.conf" "r" <br />  GetTempFileName $R0 <br />  FileOpen $1 $R0 "w" <br />  loop:  <br />    FileRead $0 $2  <br />  IfErrors done <br />  StrCmp $2 "ServerRoot @@SERVERROOT@@/Apache2$\r$\n" 0 +3  <br />     FileWrite $1 "ServerRoot $INSTDIR/Apache2$\r$\n"  <br />         Goto loop <br />;  StrCmp $2 "line to replace" 0 +3  <br />;    FileWrite $1 "replacement of line"  <br />;        Goto loop <br />  FileWrite $1 $2  <br />     Goto loop <br /> done:  <br />  FileClose $0  <br />  FileClose $1  <br />  Delete "$INSTDIR\Apache2\conf\httpd.pre.conf"  <br />  Rename $R0 "$INSTDIR\Apache2\conf\httpd.conf"<br /></code>
</pre><br />
      <br />
      BUT the compiler said:<br />
      <br />
      Processed 1 file, writing output:<br />
      Adding plug-ins initializing function... Done!<br />
      warning: install function ".ReplaceString" not referenced - zeroing code (4182-4196) out<br />
      <br />
      So this is a bit suspect, because the installer should "search &amp; replace", not the compiler...<br />
      <br />
      Am I wrong?<br />
      <br />
      I need this to be parsed on clients, after installation.<br />
      <br />
      A possibility would be to parse this through sed.exe (streaming-editor), but I have no idea where to get the installation-path from so that this could be taken as parameter for sed.exe
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">8th February 2003 20:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The problem with your code is that regular functions are called if you don't call them. Sections are called according to the user's choice in the components page, but functions have to be called from sections by you. For example:<br />
      <br /></p>
      <pre>
<span style="color: #007700">Function</span><span style="color: #0000BB">myFunc
<br /></span><span style="color: #FF8000">#dostuff....
<br /></span><span style="color: #0000BB">FunctionEnd
<br /><br />Section</span><span style="color: #DD0000">"Dostuff"
<br /></span><span style="color: #FF8000">#extractsomefiles...
<br />#writedotheregistry...
<br /></span><span style="color: #0000BB">CallmyFunc
<br />SectionEnd
<br /></span>
</pre>There is another type of functions, call-back function, that are called by the installer, but you shouldn't care about those now.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">9th February 2003 00:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, after a good movie and some tests I think I got it.<br />
      <br />
      Thx 4 help</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
