<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Automatically Expire software" />

  <title>Automatically Expire software - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Automatically Expire software</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=226706">Automatically Expire software</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tudza</span><br />
      <span class="post-time small text-muted">23rd September 2005 02:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Automatically Expire software</strong><br />
      I would have thought this was the job of the software being installed, but I was asked whether NSIS supported a mechanism by which a piece of software could be disabled after a certain amount of time has passed since installation.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">23rd September 2005 03:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, there is one thing you could try. You can create an "extractor" that extracts the original file to somewhere in the computer disguised as the original program. Then, you can use NSIS codes to retrieve information for the installation and expiration date, and to stop the execution of the program if it's desired. This wouldn't need any changes to the original application.<br />
      <br />
      The only problem with this simple method is that you need to extract it to somewhere in the users computer. I just don't know if there is a way to extract the application directly to the RAM so that there would be rarely a way of copying the extracted file and removing the expiration time. This area is quite unknown for me, though...<br />
      <br />
      Thus, I recommend changing the program's source for this or to use other tools. NSIS is not used for tough security, you know. NSIS is in continuous development and it is open-source.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">finx</span><br />
      <span class="post-time small text-muted">1st March 2006 02:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Re: Automatically Expire software</strong><br /></p>

      <blockquote>
        <i>Originally posted by tudza</i><br />
        <b>I would have thought this was the job of the software being installed, but I was asked whether NSIS supported a mechanism by which a piece of software could be disabled after a certain amount of time has passed since installation.</b>
        <hr />
      </blockquote>
    </div>
    <hr />
    What I would like to have is an expiration date lock _in_ the installation program. I mean if the the date has expired, the installation program will not work anymore. It just gives a message "The installation program has expired"<br />
    How to script this in NSIS?<br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">1st March 2006 07:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Use Manual, 5.2 Predefines {__DATE__} for compillation date, E.1.6 GetTime sample for installation time, show message box if difference is bigger then your limit.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dandaman32</span><br />
      <span class="post-time small text-muted">1st March 2006 07:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I wrote a library to do this with NSIS, including an activation key system that allows for expiring keys. If I can modify it enough to post it here without giving away the original algorithm at all I can post it here.<br />
      <br />
      You can do some cool stuff with this. What I do is I code installers for people, and I protect the installer with a 30-day trial period (what you're looking for) but I also use DcryptDll to encrypt the installer's source code and package it into the installer. When my client buys a license to use the installer commercially, I send them an activation key (which expires after a set number of days) and a decryption key, which unlocks the installer's source code. When the activation and decryption keys have been validated, the installer decrypts/extracts the installer's source code, spawns an NSIS compiler (about 500kb packed with LZMA compression) and rebuilds an installer without the protection, encryption, or 500 extra kb of overhead.<br />
      <br />
      If all that sounded a little complicated, don't worry. The secure clock library (affectionately called "ClockLock") is relatively easy to implement and can allow for custom code upon validation success/failure. It also protects against clock set-backs (an old cheat) and fraud keys. It even confuses registry-monitoring programs like SysInternals Regmon.<br />
      <br />
      Again, I cannot post it here unless I drastically change it, because then my clients can steal the installer sort of. I can privately license it to you for a negotiable price (it took me a long time to develop) and provide tech support, examples, a keygen, and several other tools or I can just post the thing here but I can't provide any considerable help for it.<br />
      <br />
      One major bug: Nothing works across years. Of course this is March, so this isn't a problem for now.<br />
      <br />
      Here's a working example: <a href="http://www.freewebtown.com/dandaman32/clocklock/SecureNotepad.exe" target="_blank">http://www.freewebtown.com/dandaman3...ureNotepad.exe</a><br />
      <br />
      This example only has one big vulnerability: it extracts the program file and runs it. User can copy it to another folder and rename it, voila no time limit. But everything else seems to work fine.<br />
      <br />
      Unlock key: 635433-955166-776584-010880-182012 (expires 90 days from this post)<br />
      <br />
      To do some cool stuff with registration: run SecureNotepad.exe /RegInfo.<br />
      <br />
      I have a sample encrypted installer too, if anyone wants to see that...<br />
      <br />
      -dandaman32<br />
      <br />
      Contains windows notepad, (c) micros0ft</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dandaman32</span><br />
      <span class="post-time small text-muted">1st March 2006 08:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK all, here is an encrypted installer.<br />
      <br />
      Activation key:<br />
      635448-027515-102882-028320-224000<br />
      (expires 120 days from this post)<br />
      <br />
      Decryption key:<br />
      7F12DBEA-8C6DA3D3-863AD317-9D11EB85<br />
      <br />
      Importable key package attached, unzip before using.<br />
      <br />
      Download binary: <a href="http://www.freewebtown.com/dandaman32/clocklock/EncryptedInstaller.exe" target="_blank">http://www.freewebtown.com/dandaman3...dInstaller.exe</a><br />
      <br />
      BTW, do NOT use the ExperienceUI version included with this. I realize that I am giving an unofficial beta of XPUI 1.11, but be warned: this is undocumented and I had to modify it just to get this script to compile properly.<br />
      <br />
      Disclaimer: while this installer does not contain any malcious code, it does contain unreleased, pre-alpha builds of certain tools, including ExperienceUI 1.11 and Component Manager 0.3. If this shreds your system, I am not responsible for it. Period.<br />
      <br />
      The source for the installer (minus the trial library) is included. To compile, you will NEED to move the ExperienceUI language file insert (!insertmacro XPUI_LANGUAGE English) up before pages unless you use the pre-alpha version of the XPUI included with this package. (edit: Well, sort of included. You have to decrypt the thing first :) )<br />
      <br />
      -dandaman32<br />
      <br />
      Contains windows notepad, (c) micros0ft</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dandaman32</span><br />
      <span class="post-time small text-muted">1st March 2006 08:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry, forgot to attach...<br />
      <br />
      -dandaman32</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">finx</span><br />
      <span class="post-time small text-muted">2nd March 2006 22:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Expiration date checking</strong><br />
      Thanks for your hints!<br />
      <br />
      After reading the manual I tried to write the most simple expiration checking code there can be, I think... What I'm looking for just now is just a very simple static expiration date checking.<br />
      This seem to work for me. What do you say?<br />
      By the way, what's the difference between "Local time" (getTime option 'L') and "System time" (getTime option 'LS')really?<br />
      <br />
      <br />
      SAMPLE CODE **************************<br />
      <br />
      ;for getTime function:<br />
      !include "FileFunc.nsh"<br />
      !insertmacro GetTime<br />
      <br />
      ;for StrCpy function:<br />
      !include "StrFunc.nsh"<br />
      <br />
      ;greate variable for installation day<br />
      VAR /GLOBAL MYINSTALLDAY<br />
      <br />
      ;greate variable for static expiration day<br />
      VAR /GLOBAL MYEXPIRATIONDAY<br />
      <br />
      ;=== get date =====================<br />
      Section<br />
      ${GetTime} "" "L" $0 $1 $2 $3 $4 $5 $6<br />
      ; $0="01" day<br />
      ; $1="04" month<br />
      ; $2="2006" year<br />
      ; $3="Friday" day of week name<br />
      ; $4="16" hour<br />
      ; $5="05" minute<br />
      ; $6="50" seconds<br />
      <br />
      ;The day when user executes the installer.<br />
      ;It's "20060401" in this sample.<br />
      strCpy $MYINSTALLDAY "$2$1$0"<br />
      <br />
      ;my static expiration day 31th of march 2006<br />
      strCpy $MYEXPIRATIONDAY "20060331"<br />
      <br />
      <br />
      ;expiration checking.<br />
      ;If the installing date is<br />
      ;bigger than expiration date<br />
      ;installer quits. Otherwise it goes on normally.<br />
      <br />
      ${if} $MYINSTALLDAY &gt; $MYEXPIRATIONDAY<br />
      MessageBox MB_OK "Sorry! Installer expired. Please update the program"<br />
      ;quit installer<br />
      Abort<br />
      ${EndIf}<br />
      <br />
      SectionEnd<br />
      ;==================================<br />
      <br />
      <br />
      END OF SAMPLE CODE ************************<br />
      <br />
      <br />
      Thanks for your feedback!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dandaman32</span><br />
      <span class="post-time small text-muted">3rd March 2006 06:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you really want go go secure, make the program check the time on the Internet. In NSIS:<br />
      <br /></p>
      <pre>
<code><br />; User should be connected to the 'net at this point.<br />; Use Dialer plugin and ConnectInternet function<br />; (function is in Dialer docs I believe) to connect.<br />nsisDl::download_quiet "http://www.mysite.com/time.php" "$TEMP\timecheck.ini"<br />StrCpy $MYEXPIRATIONDAY "20060331"<br />ReadINIStr $0 $TEMP\timecheck.ini "Time" "CurrentTime"<br />Delete $TEMP\timecheck.ini<br />IntCmp $0 $MYEXPIRATIONDAY good good bad<br />bad:<br />  ; Time expired<br />  MessageBox MB_OK "Expired!"<br />  Return<br />good:<br />; continue installer<br /></code>
</pre><br />
      <br />
      And in <a href="http://www.mysite.com/time.php:" target="_blank">http://www.mysite.com/time.php:</a><br />
      <pre>
<code><br />&lt;?php<br />$date=date("omd");<br />echo "[Time]\nCurrentTime=".$date."\n";<br />?&gt;<br /></code>
</pre><br />
      <br />
      I just realized how buggy the encrypted installer is. It's fixed now. <a href="http://www.freewebtown.com/dandaman32/clocklock/EncryptedInstaller.exe" target="_blank">http://www.freewebtown.com/dandaman3...dInstaller.exe</a><br />
      <br />
      New decryption key: AD378091-0952C988-340E0CF3-D2BC7201<br />
      Activation key (same as before): 635448-027515-102882-028320-224000<br />
      <br />
      Updated key import file attached (hopefully).<br />
      <br />
      -dandaman32
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">3rd March 2006 07:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Local time includes _timezone and _daylight (summer) shifts. "The /GLOBAL flag is not required (if var declared) outside of sections and functions."<br />
      By default, internet connection request from new program first displays Windows Firewall window, a bit disturbing for user, so it might be better to use internet if this is really need only.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">sissy</span><br />
      <span class="post-time small text-muted">3rd March 2006 08:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">this thread is quite interesting :)<br />
      <br />
      dandaman32 - id certainly like to see some source if you can change enough not to effect your algorithm from being exploited, thats is if your willing to share of course.<br />
      <br />
      Quote:</p>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">dandaman32</span><br />
        <span class="post-time small text-muted">11th March 2006 06:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">@sissy: The library I used for that is not open source because I use it for my installer development services. If you're interested in privately licensing it you can contact me.<br />
        <br />
        I have a lot of projects going on right now, so it will be awhile before I have the time to rewrite that library. Essentially what you would get by privately licensing it (assuming you're interested) is priority.<br />
        <br />
        And I see the key package still isn't attached on the last post. Forum admins, if you're reading this, vB 3.5 is out, maybe you should upgrade...<br />
        <br />
        -dandaman32</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">karabey</span><br />
        <span class="post-time small text-muted">18th May 2006 02:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">@dandaman<br />
        <br />
        I have downloaded the DcryptDll Script and its looking a little bit hard for me with NCrypts (i am a beginner with NSIS). I need myself also a Protection with Serial or 30-Days Evaluation. The NOTEPAD.exe you have created is really wonderfull. Is there a way to get written Script for it?<br />
        <br />
        Hope to hear from you. Thx</p>
      </div>
      <hr />

      <div class="footer">
        <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
      </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
      hljs.initHighlightingOnLoad();
      //]]>
      </script>

      <table cellpadding="6" cellspacing="0" border="0" width="100%">
        <tr>
          <td class="alt2">
            <hr />
            <i>Originally posted by Takhir</i><br />
            <b>By default, internet connection request from new program first displays Windows Firewall window, a bit disturbing for user, so it might be better to use internet if this is really need only.</b> dont you mean local time, since the windows FW popup is going to scare the user?<br />
            <br />
            i can certainly see the internet one will be secure as system time fiddling will have no effect :)<br />
            <br />
            all in all learnt a couple of new tricks thanks to you guys.
          </td>
        </tr>
      </table>
    </div>
  </div>
</body>
</html>
