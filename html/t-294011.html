<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Read / Output Entire File" />

  <title>Read / Output Entire File - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Read / Output Entire File</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=294011">Read / Output Entire File</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">parasoul</span><br />
      <span class="post-time small text-muted">5th July 2008 11:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Read / Output Entire File</strong><br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #0000BB">Section<br />
      FileOpen</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"$TEMP\test.txt""r"<br /></span> <span style="color: #0000BB">FileRead</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">$</span><span style="color: #0000BB">1<br />
      loop</span><span style="color: #007700">:<br /></span> <span style="color: #0000BB">StrCmp</span><span style="color: #007700">$</span><span style="color: #0000BB">1</span><span style="color: #DD0000">"$\r"</span><span style="color: #0000BB">loop<br />
      StrCmp</span><span style="color: #007700">$</span><span style="color: #0000BB">1</span><span style="color: #DD0000">"$\n"</span><span style="color: #0000BB">loop<br />
      FileClose</span><span style="color: #007700">$</span><span style="color: #0000BB">0<br />
      MessageBoxMB_OK</span><span style="color: #DD0000">"Contentsofthatfile:$1"<br /></span> <span style="color: #0000BB">SectionEnd<br /></span></span> <!-- php buffer end -->
      <hr />
      is what I have -- but it's only outputting up to where there's a new line<br />
      <br />
      is there a way to make it read the entire file regardless of returns/newlines?<br />
      <br />
      any help would be great, thanks
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br />
      <span class="post-time small text-muted">5th July 2008 15:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try it like this:<br />
      <br /></p>
      <pre>
<code>Name "FileReadTest"<br />OutFile "FileReadTest.exe"<br /><br />ShowInstDetails show<br /><br />Section<br />  ClearErrors<br />  FileOpen $0 "$INSTDIR\Foobar.dat" r ; open file<br />  IfErrors done<br /><br />  StrCpy $3 0 ; initialize counter<br /><br />  Loop:<br />  ClearErrors<br />  FileReadByte $0 $1 ; read next byte<br />  IfErrors eof ; end of file ?<br />  IntFmt $2 "0x%02X" $1<br />  IntFmt $4 "0x%08X" $3<br />  DetailPrint "$4 -&gt; $2" ; print: &lt;Address&gt; -&gt; &lt;Byte&gt;<br />  IntOp $3 $3 + 1 ; increase counter<br />  Goto Loop<br /><br />  eof:<br />  FileClose $0 ; close file<br /><br />  done:<br />SectionEnd</code>
</pre><br />
      <br />
      This code will read the entire file byte-by-byte.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comperio</span><br />
      <span class="post-time small text-muted">5th July 2008 17:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">parasoul,<br />
      Your original function would never work. It's always going to just read one line. The loop is bad too because if you ever just got a single carriage return or a single line feed, you'd be caught in an endless loop. (What's the purpose?)<br />
      <br />
      Assuming that the file is text and not binary, the code below should also work. However, keep in mind that the file can only be 1024 characters (or 8192 if you use the NSIS <a href="http://nsis.sourceforge.net/Special_Builds" target="_blank">long strings</a> version.)<br /></p>
      <pre>
<code><br />!include LogicLib.nsh<br />...<br /><br />Section<br />   ClearErrors<br />   FileOpen $0 "$TEMP\text.txt" r<br />   ${Do}<br />      FileRead $0 $1 <br />      ${If} ${Errors}<br />         ${ExitDo}<br />      ${EndIf}<br />      StrCpy $2 "$2$1"<br />   ${Loop}<br />   FileClose $0<br />   ; contents should now be in $2:<br />   MessageBox MB_OK "Contents: $\r$2"<br />SectionEnd<br /></code>
</pre>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
