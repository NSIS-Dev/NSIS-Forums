<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="XML plugin" />

  <title>XML plugin - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">XML plugin</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=227162">XML plugin</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">28th September 2005 19:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>XML plugin</strong><br />
      &nbsp; XML plugin parses an XML document, and builds from that a Document Object Model (DOM) that can be read, modified and saved. XML plugin is based on <a href="http://www.sourceforge.net/projects/tinyxml" target="_blank">TinyXml</a> (2.4.0 RC).<br />
      <br />
      <b>Features</b>:<br />
      - Read and/or modified xml files<br />
      - Code is fast and lightweight<br />
      - Unicode UTF-8 support<br />
      - "MSXML.DLL" independent<br />
      - Support for condense and non-condense white spaces<br />
      - Row and Column tracking<br />
      <br />
      <br />
      "<b>XML</b>" plugin v1.0</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kike_velez</span><br />
      <span class="post-time small text-muted">29th September 2005 09:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">:up: :up: :up: for<br />
      <br /></p>
      <pre>
"MSXML.DLL" independent 
<br />&gt;

</pre>Best Regards and Good Job
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">20th October 2005 17:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><b>Changes</b>:<br />
      - TinyXml updated to v2.4.1<br />
      - Fixed: output variable in xml::NoChildren<br />
      - New: xml::GetText<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;Convenience function for easy access to the text inside current element.<br />
      - New: xml::SetCDATA<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;Turns on or off a CDATA representation of the current element text.<br />
      - New: xml::IsCDATA<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;Queries whether this represents text using a CDATA section.<br />
      <br />
      <br />
      "<b>XML</b>" plugin v1.1</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">20th October 2005 19:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">next plugin i repack for correct usage of nsis file structure :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">25th October 2005 05:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">-TinyXml updated to v2.4.2<br />
      -Fixed: "CreateNode" appearance of the "\r\n" at the end (thanks <b>Lee Thomason</b>)<br />
      -Fixed: Now error appears if current node is TEXT and uses "InsertEndChild"<br />
      -Changed: "AttributeByName" -&gt; "GetAttribute" now not only returns value of the attribute, but also goes to it<br />
      -New: "GetNodeValue" can be useful in some cases<br />
      <br />
      <br />
      "<b>XML</b>" plugin v1.2</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">false</span><br />
      <span class="post-time small text-muted">7th November 2005 18:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">How would I go about selecting a particular node by it's name? Like how Olivier Marcoux's NSIS XML uses...<br />
      <br />
      nsisXML::select &lt;XPath expression&gt;<br />
      <br />
      Thx!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">7th November 2005 19:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you want to "select" the node you need go to it (FirstChildElement, NextSiblingElement ...). Easy for me, when you ask the concrete example, what you trying to do.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">false</span><br />
      <span class="post-time small text-muted">7th November 2005 21:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Somewhere nested in my XML, I have a set of child nodes who have the same name and share the same parent. The child nodes differ by having different attributes values.<br />
      <br />
      I would like to test if a particular node exists in an XML without having to drill down using FirstChildElement and NextSiblingElement. If the node with the target node name exists, I would make it the current node.<br />
      <br />
      I thought GotoHandle would do this for me but I am wrong in thinking it takes in a node name for a parameter.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">7th November 2005 22:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'll think about recursive node search</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">9th November 2005 16:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><b>New</b>: [xml::FindNextElement /NOUNLOAD "[name]" .r0 .r1]<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;-Search for element (recursive), returns the element name and goes to it.<br />
      <b>New</b>: [xml::FindCloseElement /NOUNLOAD]<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;-Closes search opened by xml::FindNextElement.<br />
      <b>New</b>: [xml::ElementPath /NOUNLOAD .r0]<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;-Returns the current element path.<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;(e.g. "/a/b/c[3]/d")<br />
      <b>New</b>: [xml::GotoPath /NOUNLOAD "[path]" .r0]<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;-Goes to the specified path.<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;(e.g. from root "/a/b[2]/c/d", from current element "a/b[2]/c/d",<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;using last element 'b' "a/b[-1]/c/d")<br />
      <br />
      <br />
      "<b>XML</b>" plugin v1.3</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">false</span><br />
      <span class="post-time small text-muted">9th November 2005 16:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You da man! That was a fast. I'll give this a shot. Thx</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
      <span class="post-time small text-muted">9th November 2005 19:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hey Instructor any plans for UTF-16 support? I could really use that.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">9th November 2005 20:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">DOM builds by TinyXML parser, so UTF-16 is depend on this project. BTW: Where is already have <a href="http://sourceforge.net/tracker/index.php?func=detail&amp;aid=1111690&amp;group_id=13559&amp;atid=363559" target="_blank">feature request</a> about it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
      <span class="post-time small text-muted">9th November 2005 21:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ah excellent. Good to know it's on the queue.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">10th November 2005 15:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><b>Added</b>: now "GotoPath" can accept elements without name (e.g. using any last element "a/[-1]/c/d")<br />
      <br />
      <br />
      "<b>XML</b>" plugin v1.4</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">10th December 2005 17:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><b>Fixed</b>: Now "ElementPath" and "GotoPath" correctly working with the document beginning. If "ElementPath" returns "" - the current element is the beginning of the document. [xml::GotoPath /NOUNLOAD "" .r0] - go to the document beginning.<br />
      <br />
      <br />
      "<b>XML</b>" plugin v1.5</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Kiggie</span><br />
      <span class="post-time small text-muted">13th January 2006 11:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Bug in GetAttribute</strong><br />
      &nbsp; Hi,<br />
      <br />
      there seems to be a bug in the GetAttribute Method, it returns<br />
      always -1 for the first attribute of a node.<br />
      <br />
      A possible workaround is to check if the FirstAttribute differs from the desired attribute.<br />
      <br />
      Kind Regards,<br />
      <br />
      Rob</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">chagam</span><br />
      <span class="post-time small text-muted">13th January 2006 11:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi,<br />
      <br />
      May be I'm missing something but I don't understand how to replace a text value.<br />
      <br />
      There's a xml::GetText function. How do I do a xml::SetText ?<br />
      <br />
      Thanks in advance<br />
      <br />
      Chag</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Kiggie</span><br />
      <span class="post-time small text-muted">13th January 2006 11:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by chagam</i><br />
        <b>Hi,<br />
        <br />
        May be I'm missing something but I don't understand how to replace a text value.<br />
        <br />
        There's a xml::GetText function. How do I do a xml::SetText ?<br />
        <br />
        Thanks in advance<br />
        <br />
        Chag</b>
      </blockquote>Did you try the xml::SetNodeValue method ?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">chagam</span><br />
      <span class="post-time small text-muted">13th January 2006 12:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi,<br />
      <br />
      Yes, I tried. May be a did something wrong.<br />
      <br />
      My xml file looks like this :<br />
      &lt;config&gt;<br />
      &lt;local&gt;<br />
      &lt;host&gt;test&lt;/host&gt;<br />
      &lt;/local&gt;<br />
      &lt;/config&gt;<br />
      <br />
      I tried :<br />
      xml::GotoPath /NOUNLOAD "/config/local/host" .r0<br />
      xml::SetNodeValue /NOUNLOAD "1234" .r0<br />
      <br />
      and my new xml file looks like this :<br />
      &lt;config&gt;<br />
      &lt;local&gt;1234<br />
      &lt;/local&gt;<br />
      &lt;/config&gt;<br />
      <br />
      Chag</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">13th January 2006 13:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>
      <pre>
<code>Name "XMLTest"<br />OutFile "XMLTest.exe"<br /><br />Section<br />        xml::LoadFile /NOUNLOAD "test.xml" .r0<br />        MessageBox MB_OK "xml::LoadFile$\n$$0=$0"<br /><br />        xml::GotoPath /NOUNLOAD "/config/local/host" .r0<br />        MessageBox MB_OK "xml::GotoPath$\n$$0=$0"<br /><br />        xml::FirstChild /NOUNLOAD "" .r0 .r1<br />        MessageBox MB_OK "xml::FirstChild$\n$$0=$0$\n$$1=$1"<br /><br />        xml::SetNodeValue /NOUNLOAD "1234"<br />        MessageBox MB_OK "xml::SetNodeValue"<br /><br />        xml::SaveFile "test_saved.xml" .r0<br />        MessageBox MB_OK "xml::SaveFile$\n$$0=$0"<br />SectionEnd</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">13th January 2006 13:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        there seems to be a bug in the GetAttribute Method, it returns<br />
        always -1 for the first attribute of a node.
      </blockquote>Fixed, thanks.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">13th January 2006 14:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><b>Fixed</b>: GetAttribute returns -1 for the first attribute.<br />
      <b>New</b>: "SetText" -convenience function for easy set the text of the current element.<br />
      <br />
      <br />
      "<b>XML</b>" plugin v1.6</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">xilay</span><br />
      <span class="post-time small text-muted">3rd March 2006 13:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello,<br />
      <br />
      I need to create a new element without text.<br />
      I use this code :<br /></p>
      <pre>
<code>
xml::LoadFile /NOUNLOAD "test.xml" .r0
<br />xml</code>::GotoPath /NOUNLOAD "/root" .r0
<br />xml::CreateNode /NOUNLOAD "&lt;histo&gt;&lt;/histo&gt;" .r0
<br />xml::InsertEndChild /NOUNLOAD "$0" .r0
<br />xml::SaveFile /NOUNLOAD "test.xml" .r0 
<br />&gt;

</pre>But the new element is with a blank at the end, like this :<br />
      <pre>
<code>
&gt;
<br />    &lt;</code>histo /&gt;
<br />&lt;/root&gt; 
</pre>If I create the element with text, it's ok.<br />
      Have you got an idea?<br />
      <br />
      Thanks<br />
      <br />
      (sorry if my english is not very good)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">3rd March 2006 15:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">this is correct xml behaviour.<br />
      empty elements have to be &lt;element /&gt;, not &lt;element&gt;&lt;/element&gt;.<br />
      <br />
      last one is no valid xml!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">xilay</span><br />
      <span class="post-time small text-muted">3rd March 2006 16:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, I know, the problem is the blank after 'histo'.<br />
      I have this &lt;histo /&gt; (you see, the blank between 'histo' and '/') and not this &lt;histo/&gt;.<br />
      <br />
      Sorry for my bad explanation :(</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comperio</span><br />
      <span class="post-time small text-muted">3rd March 2006 20:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">W3.org (which pretty much has the final word on markup languages like XML) recommends that a space should be used when declaring empty tags.<br />
      <br />
      So this would be proper XML:<br />
      &lt;histo /&gt;<br />
      <br />
      NOT this:<br />
      &lt;histo/&gt;<br />
      <br />
      See the section <i><b>tags for empty elements</b></i> at <a href="http://www.w3.org/TR/REC-xml/#sec-starttags" target="_blank">http://www.w3.org/TR/REC-xml/#sec-starttags</a> for more info.<br />
      <br />
      [edit]<br />
      And FWIW, I've always seen empty tags written using a space between the element name and the '/' character...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">xilay</span><br />
      <span class="post-time small text-muted">6th March 2006 08:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, I use xmlspy and it deletes the blank, so, I thought it was not normal.<br />
      Thanks a lot (and thanks for this perfect plugin)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">6th March 2006 13:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Updated: TinyXml to v2.4.3<br />
      Changed: Now plugin used header "XML.nsh" for custom user variables and<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;better compile errors check.<br />
      <br />
      <b>Update from previous versions:</b><br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;- Insert line in script:<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;!include "XML.nsh"<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;- Replace:<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;xml::LoadFile -&gt; ${xml::LoadFile} ...<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;- Replace:<br />
      &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.r0 -&gt; $0, .r1 -&gt; $1 ... .R0 -&gt; $R0, .R1 -&gt; $R1 ...<br />
      <br />
      "<b>XML</b>" plugin v1.7</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">stwhit</span><br />
      <span class="post-time small text-muted">3rd May 2006 14:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I need to be able to parse two XML documents at the same time (because I'm merging them during an upgrade process).<br />
      <br />
      From looking at the API and the source code, it looks like this XML plugin only supports working on a single XML document at a time, because there is no concept of a file handle being returned by ${xml::LoadFile} and being passed to the other functions. It looks like there is a single, global XML document being edited (TiXmlDocument doc).<br />
      <br />
      So, two questions:<br />
      <br />
      1. Is it possible to edit two XML documents at the same time using this plugin?<br />
      2. If not, would you consider enhancing the plugin to use file handles to support editing multiple XML documents at once?<br />
      <br />
      Thanks!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">3rd May 2006 15:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">1. Not.<br />
      2. I'm not plaining this.<br />
      <br />
      But you can use ${xml::CloneNode}<br />
      <br /></p>
      <pre>
<code><br />Section<br />        ${xml::LoadFile} "file.xml" $0<br />        MessageBox MB_OK "xml::LoadFile$\n$$0=$0"<br /><br />        ${xml::GotoPath} "/" $0<br />        MessageBox MB_OK "xml::GotoPath$\n$$0=$0"<br /><br />        ${xml::CloneNode} $R0<br />        MessageBox MB_OK "xml::CloneNode$\n$$R0=$R0"<br /><br />        ${xml::Unload}<br /><br /><br />        ${xml::LoadFile} "file2.xml" $0<br />        MessageBox MB_OK "xml::LoadFile$\n$$0=$0"<br /><br />        ${xml::GotoPath} "/" $0<br />        MessageBox MB_OK "xml::GotoPath$\n$$0=$0"<br /><br />        ${xml::InsertBeforeNode} "$R0" $0<br />        MessageBox MB_OK "xml::InsertBeforeNode$\n$$0=$0"<br /><br />        ${xml::FreeNode} "$R0" $0<br />        MessageBox MB_OK "xml::FreeNode$\n$$0=$0"<br /><br />        ${xml::SaveFile} "file2.xml" $0<br />        MessageBox MB_OK "xml::SaveFile$\n$$0=$0"<br /><br />        ${xml::Unload}<br />SectionEnd<br /></code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comperio</span><br />
      <span class="post-time small text-muted">31st July 2006 03:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm trying to create an XML file from scratch using this plugin. Is this possible? If so, can someone post an example of how I might accomplish this?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">31st July 2006 15:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">FileWrite</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comperio</span><br />
      <span class="post-time small text-muted">1st August 2006 00:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">darn...<br />
      I was hoping that I could build an XML file in memory using the plugin and then output the whole thing to a file. (It would be a cool enhancement for sure.)<br />
      <br />
      I guess for now, I'll just write my own FileWrite functions to get me by for now.<br />
      <br />
      Thanks for the feedback!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">emmett_m</span><br />
      <span class="post-time small text-muted">16th August 2006 07:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi, I am hoping you can help me, I tried some of the code examples found in \NSIS\Examples\XMLXMLTest.nsi. And tried to apply these examples with what I want with little success, here is what I am trying to achieve.<br />
      <br />
      I have the following xml file (VS.Net config file):<br />
      <font color="blue">&lt;?xml version="1.0" encoding="utf-8" ?&gt;<br />
      &lt;configuration&gt;<br />
      &lt;configSections&gt;<br />
      &lt;/configSections&gt;<br />
      <br />
      &lt;appSettings&gt;<br />
      &lt;add key="somekey" value="some value"/&gt;<br />
      &lt;/appSettings&gt;<br />
      <br />
      &lt;connectionStrings&gt;<br />
      &lt;add name="ConnString" connectionString="TRYING TO MODIFY THIS TEXT"<br />
      providerName="System.Data.SqlClient" /&gt;<br />
      &lt;/connectionStrings&gt;<br />
      &lt;/configuration&gt;</font><br />
      <br />
      When the installer runs, I am trying to change the text in the connectionString attribute of the &lt;add&gt; element. I have placed the file in the same directory as my install script, and the script includes the following code:<br />
      <font color="blue"><br />
      !include "XML.nsh"<br />
      <br />
      var /global ReplacementString<br />
      var /global fhandle<br />
      <br />
      ${xml::LoadFile} "appname.exe.config" $fhandle<br />
      MessageBox MB_OK "$fhandle" <font color="silver">; always returns -1</font><br />
      <br />
      ${xml::GotoPath} "/configuration/connectionStrings/add" $fhandle<br />
      ${xml::SetAttribute} "connectionString" "$ReplacementString" $fhandle<br />
      ${xml::SaveFile} "$INSTDIR\appname.exe.config" $fhandle<br />
      ${xml::Unload} <font color="silver">; unload plugin</font><br /></font><br />
      When attempting to open the file it always returns -1, can anybody tell me what the obvious mistake that I am making, and yes the file is in UTF8 format, I have however tried saving the format of the file from Notepad, into different formats in desperation, with no help (as I expected).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">16th August 2006 08:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have no problem. Make sure that the file exist and try to specify full path to it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">emmett_m</span><br />
      <span class="post-time small text-muted">16th August 2006 09:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That is interesting, I tried as you suggested to supply the full path to the file, which is the same location as the setup program, and it works. However I thought when you specified a file like:<br />
      <br />
      ${xml::LoadFile} "appname.exe.config" $fhandle<br />
      <br />
      That it would use the file from the same directory as the installer, it would seem not. Also I tried the following:<br />
      <br />
      ${xml::LoadFile} "$EXEDIR\appname.exe.config" $fhandle<br />
      <br />
      Which seems to be what I should have done. Thanks for your time ;-)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">17th August 2006 18:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">as the plugin is extracted to $PLUGINSDIR i guess it searches the file there, not in $EXEDIR.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">emmett_m</span><br />
      <span class="post-time small text-muted">18th August 2006 00:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just in case somebody else comes across this problem, what I really wanted to do was have the .config file wrapped up into the installer, and manipulate that version, to do this I did the following:<br />
      <br />
      <font color="blue">Section "MainSection" SEC01<br />
      SetOutPath "$INSTDIR"<br />
      SetOverwrite ifnewer<br />
      File "appname.exe.config" <font color="silver">; reads file into memory and wraps(compresses) into installer</font><br />
      Section<br />
      <br />
      ${xml::LoadFile} "appname.exe.config" $fhandle <font color="silver">; modify the config file compressed in installer</font><br /></font><br />
      <br />
      This seems to work great.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JDaniels13</span><br />
      <span class="post-time small text-muted">24th August 2006 22:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I recently needed to edit existing .NET (Framework 1.1) config files within an NSIS install. Using some of the info here and the XML plugin docs, I was able to put something together that actually appears to work for changing keys in .NET 1.1 config files. Below is what I came up with. (There are some extra message boxes for debugging that should be removed prior to using.) Is there an easier way??!! I was truly surprised at the lack of discussion of this topic. I didn't want to write a .NET program in C# or VB.NET because I wanted it all to be in the NSIS setup, for simplicity's sake.<br />
      <br />
      <br />
      !include "XML.nsh"<br />
      <br />
      var /global IOResult<br />
      var /global NewNodeHandle<br />
      var /global CurrentValue<br />
      var /global ElementName<br />
      <br />
      !macro EditDotNETConfigFile ConfigFile KeyPath KeyName KeyValue<br />
      ${xml::LoadFile} ${ConfigFile} $IOResult<br />
      ${xml::GotoPath} ${KeyPath} $IOResult<br />
      IntCmp $IOResult 0 pathLookupSucceeded noAppSettings<br />
      pathLookupSucceeded:<br />
      MessageBox MB_OK "pathLookupSucceeded for ${KeyPath}"<br />
      checkAttributeExistence:<br />
      ${xml::GetAttribute} "key" $CurrentValue $IOResult<br />
      ; Did we find an existing instance of our config setting?<br />
      IntCmp $IOResult 0 checkKeyAttributeValue toNextElement<br />
      checkKeyAttributeValue:<br />
      MessageBox MB_OK "checkKeyAttributeValue current value is $CurrentValue vs desired key ${KeyName}"<br />
      ; OK, found one, is it our desired key? Case-sensitive compare.<br />
      StrCmpS $CurrentValue ${KeyName} foundKeyAttribute toNextElement<br />
      toNextElement:<br />
      MessageBox MB_OK "checkKeyAttributeValue $CurrentValue didn't match ${KeyName}"<br />
      ; Didn't find the &lt;add key= " attribute name we wanted, check next "&lt;add " element<br />
      ${xml::NextSiblingElement} "add" $ElementName $IOResult<br />
      MessageBox MB_OK "toNextElement name is $ElementName IOResult is $IOResult"<br />
      IntCmp $IOResult 0 checkAttributeExistence noExistingEntry<br />
      <br />
      foundKeyAttribute:<br />
      ${xml::GetAttribute} "value" $CurrentValue $IOResult<br />
      MessageBox MB_OK "foundKeyAttribute check value attribute $CurrentValue vs desired key ${KeyValue}"<br />
      ; Did we find an existing instance of our config setting?<br />
      StrCmp $CurrentValue ${KeyValue} valueUnchanged valueChanged<br />
      valueChanged:<br />
      ${xml::SetAttribute} "value" "${KeyValue}" $IOResult<br />
      IntCmp $IOResult 0 setAttributeWorked setAttributeFailed<br />
      setAttributeWorked:<br />
      goto saveConfigFile<br />
      <br />
      noExistingEntry:<br />
      MessageBox MB_OK "GetAttribute could not find existing value for ${KeyName}"<br />
      ${xml::CreateNode} '&lt;add key="${KeyName}" value="${KeyValue}" /&gt;' $NewNodeHandle<br />
      ${xml::InsertAfterNode} $NewNodeHandle $IOResult<br />
      goto saveConfigFile<br />
      setAttributeFailed:<br />
      MessageBox MB_OK "SetAtribute failed for ${KeyName}"<br />
      goto cleanUp<br />
      noAppSettings:<br />
      MessageBox MB_OK "XPath not resolved for ${KeyPath}"<br />
      goto cleanUp<br />
      saveConfigFile:<br />
      ${xml::SaveFile} ${ConfigFile} $IOResult<br />
      valueUnchanged:<br />
      ; Just fall thru and unload<br />
      cleanUp:<br />
      ${xml::Unload} ; unload plugin<br />
      !macroend<br />
      <br />
      ; Called as follows:<br />
      <br />
      !insertmacro EditDotNETConfigFile "c:\InetPub\wwwroot\MyWebSite\Web.config" "configuration/appSettings/add" "connectionString" "MyTestConnString1a"<br />
      <br />
      <br />
      P.S. I tried the nsisXML plugin but it wanted to do "extra" things to the tags in the .NET config files, so I came back to this XML plugin and it's what I got to work first.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>