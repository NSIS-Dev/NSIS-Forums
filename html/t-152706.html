<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Uninstall Problem"><title>Uninstall Problem - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Uninstall Problem</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=152706">Uninstall Problem</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">15th October 2003 15:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Uninstall Problem</strong><br>I'm having the same problem as:<br><br><a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=152400&amp;highlight=Uninstall" target="_blank">This Dude</a><br><br>When my uninstall runs, it gets rid of the registry entries and the uninstall file itself, but not the files or directory. I'm not entirely positive I'm doing it right (I created these files originally with NSIS Workbench and have modified them from there. Here's the basic gist:<br><br>;NSIS Script For Centre Web<br><br>;Backgound Colors<br>BGGradient 800080 000000 FFFFFF<br>BrandingText " "<br><br>;Title Of Your Application<br>Name "MyApp"<br><br>;Do A CRC Check<br>CRCCheck On<br><br>;Output File Name<br>OutFile "Install.exe"<br><br>;The Default Installation Directory<br>InstallDir "$PROGRAMFILES\MyApp"<br><br>;The text to prompt the user to enter a directory<br>DirText "Please select the folder below"<br><br>Section "Install"<br>;Install Files<br>SetOutPath $INSTDIR<br>SetCompress Auto<br>SetOverwrite IfNewer<br>File /r "D:\MyStageDir\*.*"<br><br>; Write the uninstall keys for Windows<br>WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp" "DisplayName" "MyApp (remove only)"<br>WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp" "UninstallString" "$INSTDIR\Uninst.exe"<br>WriteUninstaller "Uninst.exe"<br>SectionEnd<br><br>Section "Shortcuts"<br>;Add Shortcuts<br>SectionEnd<br><br>UninstallText "This will uninstall MyApp from your system"<br><br>Section Uninstall<br>;Delete Files<br>Delete "$INSTDIR\*.*"<br><br>;Delete Uninstaller And Unistall Registry Entries<br>Delete "$INSTDIR\Uninst.exe"<br>DeleteRegKey HKEY_LOCAL_MACHINE "SOFTWARE\MyApp"<br>DeleteRegKey HKEY_LOCAL_MACHINE "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\MyApp"<br>RMDir "$INSTDIR"<br>SectionEnd<br><br>;--------------------------------<br>;Installer Functions<br><br>Function .onInit<br><br>ReadRegStr $R0 HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp" "UninstallString"<br>StrCmp $R0 "" done<br><br>MessageBox MB_OKCANCEL|MB_ICONEXCLAMATION \<br>"MyApp is already installed. $\n$\nClick `OK` to remove the \<br>previous version or `Cancel` to cancel this upgrade." \<br>IDOK uninst<br>Abort<br><br>;Run the uninstaller<br>uninst:<br>ClearErrors<br>ExecWait '"$R0" _?=$INSTDIR' ;Do not copy the uninstaller to a temp file<br><br><br>done:<br><br>FunctionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">15th October 2003 16:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Actually my problem is a bit simpler than his. The delete isn't recursive. The command:<br><br>Delete "$INSTDIR\*.*"<br><br>Only gets the files directly under $INSTDIR and when it does the:<br><br>RMDir "$INSTDIR"<br><br>It fails because there are files and directories underneath. Any help?<br><br>Thanks</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">15th October 2003 16:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If you wish to remove $INSTDIR and all of its contents, then use:<br><br>RMDir /r "$INSTDIR"</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">stonkers</span><br><span class="post-time small text-muted">16th October 2003 21:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Doesn't seem to be working afro-dude. I just changed the uninstall section line from<br><br>RMDir "$INSTDIR"<br><br>to<br><br>RMDir /r "$INSTDIR"<br><br>The $INSTDIR doesn't go away and a lot of folders and files stick around underneath that. Any clue?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">deguix</span><br><span class="post-time small text-muted">16th October 2003 21:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Maybe the $INSTDIR is not correct here, you have to detect it in the Uninstall Functions or Sections. The value of $INSTDIR variable in installation, is not detected automatically in Uninstall! [EDIT] To detect it, try reading the installation string in registry or INI files.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">16th October 2003 21:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Are you sure these files are not in use? Can you delete them manually?</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>