<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="A little help would be appriciated" />

  <title>A little help would be appriciated - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">A little help would be appriciated</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=144817">A little help would be appriciated</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TonyDS</span><br />
      <span class="post-time small text-muted">5th August 2003 18:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>A little help would be appriciated</strong><br />
      &nbsp; Before installation of My NSIS program is it possible to check the version of an exisiting exe to see if its the correct version?<br />
      <br />
      I don't really mean by checking it through the Reg though, as this does not show the correct version info.<br />
      <br />
      The original game is version 1.0.0.0, there are two updates for this game which will change the version to 2.0.0.1 or 2.0.0.2<br />
      <br />
      I only want my NSIS program to install if the version is 2.0.0.2 otherwize you will get a message saying that you will need to update the game before you can install my NSIS program then quit<br />
      <br />
      If it is the correct version it will install normally<br />
      <br />
      At the momment My NSIS program checks the reg to see if the game is the correct version then installs<br />
      <br />
      using this bit of script<br />
      <br /></p>
      <pre>
<code>
onInit
<br />ReadRegStr$0 HKLM "SOFTWARE\\Game software\\v1.0" "Version"
<br />&gt;IntCmp $0 1 +1 +1 +3
<br />MessageBox MB_ICONINFORMATION</code>|MB_OK "WARNING: GAME needs to be updated to version 2.02."
<br />&gt;Abort
<br />FunctionEnd 
<br />&gt;

</pre>This is fine, but my NSIS program will install if the Games 2.01 update has been installed, which will bugger up the entire installation and make the game unplayable<br />
      <br />
      See in the Reg the "version" is either 1 for the original or 2 if either update has been added.<br />
      <br />
      Which makes checking the reg pointless<br />
      <br />
      Like I said the only real way to check this would be from the Games EXE as this shows the true version.<br />
      <br />
      Any help would be greatly appriciated plus showing me how the script should look<br />
      <br />
      Thanks in advance<br />
      <br />
      -Tony
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">5th August 2003 18:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">So you need to check the version information resource? It could be possible using the System plug-in or you can write your own plug-in.<br />
      <br />
      Is there no registry key / configuration file available with the version number?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TonyDS</span><br />
      <span class="post-time small text-muted">5th August 2003 19:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes it shows the version number<br />
      <br />
      HKLM "SOFTWARE\Game software\v1.0" "Version" 1.0<br />
      <br />
      but if the game updates are applied it only shows to 2.0<br />
      <br />
      so even if the 2.01 patch is install my program will still install, which I don't want it to do<br />
      <br />
      Thats why I would like to check the exe which shows the exact version.<br />
      <br />
      As I'm new to all this I have no way of knowing how to write a plug-in or which commands to use if any<br />
      <br />
      sorry, just a thick noobie</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">5th August 2003 21:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">NSIS plugins are usually written in C++/Delphi.<br />
      If you do not know about creating you're own plugin, then the System plugin will do your job.<br />
      <br />
      You should also try using the SysInfo plugin (get on NSIS Archive) which can get the version of specified files.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TonyDS</span><br />
      <span class="post-time small text-muted">5th August 2003 22:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I don't know how to use it though :(<br />
      <br />
      This is the reason, I'm asking for help<br />
      <br />
      Its not too much to ask</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">5th August 2003 22:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://nsis.sourceforge.net/archive/download.php?file=sysinfo.dll.zip" target="_blank">http://nsis.sourceforge.net/archive/...ysinfo.dll.zip</a><br />
      <br />
      Extract just the dll to your Plugins dir.<br />
      <br />
      Now, in your script use:<br />
      sysinfo::GetFileVersion "x:\path\to\exe"<br />
      Pop $0 ;file version<br />
      <br />
      If $0 is empty ("") then try:<br />
      sysinfo::GetFileVersionValue "FileVersion" "x:\path\to\exe"<br />
      Pop $0 ;file version<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TonyDS</span><br />
      <span class="post-time small text-muted">6th August 2003 03:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for pointing me in the right direction Afrow UK :)<br />
      <br />
      I figured out how to use the script you provided<br />
      <br />
      but the next bit was a liitle harder<br />
      <br /></p>
      <pre>
<code>
onInit
<br />sysinfo</code>::GetFileVersion "x:\\path\to\\exe"
<br />&gt;Pop $0
<br />StrCmp$0 "2.0.0.2" +3
<br />MessageBox MB_ICONINFORMATION|MB_OK "The Game has not yet been updated to version 2.02."
<br />&gt;Abort
<br />FunctionEnd 
<br />&gt;

</pre>It was this bit <font color="red">StrCmp $0 "2.0.0.2" +3</font> that had me a little perplexed, it's taken me around 3 hrs just to figure that line out.<br />
      <br />
      Tried god knows how many differrent combinations of IntCmp, IntCmpU, StrCpy plus a few others, I was about to give up on it, when I came upon the combination above which works.<br />
      <br />
      So once again thanks :D
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">6th August 2003 10:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just a thought, what happens if 2.0.0.3 comes out.<br />
      You're installer will think that the user has an older version.<br />
      <br />
      You should remove the dot (.) from the version, and use IntCmp instead.<br />
      To remove the dots, use the <a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=124&amp;instances=0,11,122" target="_blank">StrReplace</a> function:<br /></p>
      <pre>
<code>Push $0 ;input<br />Push "." ;to replace<br />Push "" ;replace with nothing (remove)<br /> Call StrReplace<br />Pop $0<br />IntCmp $0 2002 +3 0 +3<br />MessageBox MB_ICONINFORMATION|MB_OK "The Game has not yet been updated to version 2.02."<br />Abort</code>
</pre><br />
      <br />
      IntCmp works like this:<br />
      IntCmp $0 2002 [goto if $0=2002] [goto if $0&lt;2002] [goto if $0&gt;2002]<br />
      <br />
      -Stu
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br />
      <span class="post-time small text-muted">6th August 2003 13:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">How about using the code Smile2Me created ages ago to compare dotted versions?<br />
      <br />
      <a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=57" target="_blank">http://nsis.sourceforge.net/archive/....php?pageid=57</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SteelCoder</span><br />
      <span class="post-time small text-muted">6th August 2003 13:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If the executable has an actual 'version' resource in it (and it's maintained correctly), Couldn't you use GetDLLVersion?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ramon18</span><br />
      <span class="post-time small text-muted">6th August 2003 15:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, you can use GetDLLVersion, for example you can use the previous uninstall.exe version info, by detecting the file location through the registry and than decide if the update can run or not.<br />
      <br />
      good luck</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SteelCoder</span><br />
      <span class="post-time small text-muted">6th August 2003 18:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Why not just compare the version of the file you are going to install verses the file that is installed? Just like upgrading a DLL.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TonyDS</span><br />
      <span class="post-time small text-muted">6th August 2003 20:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">No chance of a update to 2.0.0.3 unless a miricale happens<br />
      <br />
      It's a oldish game<br />
      <br />
      The code know looks like this<br />
      <br /></p>
      <pre>
<code>Function .onInit<br />sysinfo::GetFileVersion "x:\path\to\exe" <br />Pop $0<br />Push $0 ;input<br />Push "." ;to replace<br />Push "" ;replace with nothing (remove)<br />Call StrReplace<br />Pop $0<br />IntCmp $0 2002 +3 0 +3<br />MessageBox MB_ICONINFORMATION|MB_OK "The Game has not yet been updated to version 2.02."<br />Abort<br />FunctionEnd</code>
</pre><br />
      <br />
      With the StrReplace script underneath it<br />
      <br />
      Hope this is what you meant, it works anyhow thanks again :)<br />
      <br />
      Thanks again Afrow<br />
      <br />
      Sunjammer I looked at the code you suggested, thanks, but Afrow's code is fine.
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>