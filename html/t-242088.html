<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="dll permissions" />

  <title>dll permissions - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">dll permissions</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=242088">dll permissions</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tlalit</span><br />
      <span class="post-time small text-muted">29th March 2006 16:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>dll permissions</strong><br />
      I have a problem:<br />
      when reboot is needed after admin reinstalls the plugin to a restricted user (update), NSIS leaves registry keys (NSIS.RegTool etc.) to know what DLL's need to be registered and replaced after the reboot. my problem is that after the reboot is done and NSIS finished with it's stuff the restricted user does not have permissions on the replaced dll's and the result is that the plugin does not load.<br />
      I'm using the InstallLib macro and because the dll is occupied - reboot is needed, but the restricted user does not have the permissions while the plugin is working just fine to the admin that installed through the RunAs command.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tlalit</span><br />
      <span class="post-time small text-muted">30th March 2006 15:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">can anybody help me???<br />
      Is it not clear enough?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">30th March 2006 17:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Searched forum for 'permissions' and came across this:<br />
      <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=240277&amp;highlight=permissions" target="_blank">http://forums.winamp.com/showthread....ht=permissions</a><br />
      I have no experience in this area so I don't know if this is what you are after.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">31st March 2006 13:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">When installing DLLs that require an update after reboot, the user must be an administrator. This is required for both the registration which uses the HKLM\...\RunOnce key and for the replacement itself using MoveFileEx, which eventually needs to write to HKLM\...\PendingFileRenameOperations.<br />
      <br />
      To check if a user is part of the administrators group, you can use the <a href="http://nsis.sourceforge.net/Examples/UserInfo/UserInfo.nsi" target="_blank">UserInfo plug-in</a>, which is packaged with NSIS.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tlalit</span><br />
      <span class="post-time small text-muted">2nd April 2006 08:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, I know that the user have to be admin - and this is not the problem... even if admin runs the installation (with the RunAs) and after the Required Reboot the admin is the one that logging on - the restricted user still has problem of permissions on the replaces dll's.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">2nd April 2006 18:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What permission exactly is the restricted user missing? Can you provide a simple example so I can understand what you're after?<br />
      <br />
      Do you mean the restricted user doesn't have access to read the DLL files? The file permissions should be inherited from the folder where the DLL is installed. Normally, that'd be either the system directory or the program directory. Both should be readable even to a restricted user. Is the DLL installed to such a directory and is still unreadable?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tlalit</span><br />
      <span class="post-time small text-muted">3rd April 2006 14:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The restricted user has no permission at all, (right clicking the dll show no security tab). so it means that also the restricted user doesn't have access to read the DLL files. the premissions on the folder are good and only the replaces dll's after reboot (the one needed updates) have this problem.<br />
      FYI, dll's that were not replaced in the same folder - looks OK, so, I'm guessing its not a folder permission problem. and again, the admin user that made the update can work with these dll's with no problems.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">3rd April 2006 20:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If it only happens in this specific folder, it is probably a problem with the folder permissions. In the Advanced dialog of the security tab for that DLL and its folder, is the "Inherit from parent..." check box marked?<br />
      <br />
      Does it happen with every DLL you install? Do I understand correctly and it happens only with one specific folder? Does it still happen if it's only replaced after reboot and not registered? What exactly are the permissions for the DLL when this happens? Does it happen just on one computer or can you reproduce it on others? As I can't reproduce this with my examples, can you attach a minimal example?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tlalit</span><br />
      <span class="post-time small text-muted">4th April 2006 14:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The scenario is to run an installer for restricted user with the RunAs command but when InstallLib is trying to replaced dll's and registered them, they have to be in use - so they will be replaced and registered only after the reboot. and after the reboot be sure to login as the admin - so that the replacemant and registration can be done (this is another problem...)<br />
      <br />
      It look like the problem is that the "Inherit from parent..." checkbox unchecked for all dll's that were replaced after the reboot with the admin, the question is why is it happenning and how can this be fix?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">4th April 2006 16:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It works fine for me with or without runas. Please answer the other quetsions as well, I need more details.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comperio</span><br />
      <span class="post-time small text-muted">4th April 2006 17:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">While you are gathering the answers to Kichik's questions, here's something else to consider:<br />
      <br />
      If you are using Windows XP Pro, it defaults to having "Simple File Sharing" enabled. With this feature, user's don't see the "Security" tab on a file/folder's properties screen.<br />
      <br />
      To disable simple file sharing, go into explorer, click tools-&gt;folder options, click the View tab and scroll down to the very bottom. (Windows XP Home does not allow you disable simple file sharing.)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tlalit</span><br />
      <span class="post-time small text-muted">5th April 2006 17:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK I'll try to answer your questions:<br />
      it doesn't happen in a specific folder - it happend to dll's (and not folders) that were replaced after reboot by RunAs admin user to a restricted user(I tried not register - and it still happen)<br />
      The "Inherit from parent..." check box is checked.<br />
      It still happen if it's only replaced after reboot and not registered.<br />
      The Permissions for the DLL's are good (read/write etc.) only for admins, but the "Users" group is not include - and I'm guessing this is the problem - when adding this group - it looks like the problem is solved...<br />
      Was this information helpfull?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th April 2006 20:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Is the inherit check box checked on the folder as well? Does this happen on every computer? Can you attach an example? The easiest way for me to solve it is to be able to reproduce it.<br />
      <br />
      BTW, as a workaround, you can use <a href="http://nsis.sourceforge.net/AccessControl_plug-in" target="_blank">AccessControl</a> to grant access to the replaced DLL. Use it on the temporary file created in Library.nsh just before the Rename /REBOOTOK line.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tlalit</span><br />
      <span class="post-time small text-muted">6th April 2006 10:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I think the problem is that the "inherit from parent..." check box for the replaced dll's is checked when no reboot is needed (after admin installed for restricted with RunAs), but when dll's needed to ne replaced after reboot the "inherit from parent..." (after admin installed for restricted with RunAs) check box is unchecked...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">7th April 2006 10:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">How does the check box change for the folder depending on the reboot?<br />
      <br />
      Can't you attach an example script? Is it confidential?<br />
      <br />
      Try creating a simple script which only installs one DLL which will be replaced on reboot and nothing else. Keep as minimal as possible with only one section that installs the DLL, no MUI and no callback functions.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tlalit</span><br />
      <span class="post-time small text-muted">10th April 2006 16:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK, I made 2 installers, the dfference between the instrallers is the dll version, how can I submit these 2 installers?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">14th April 2006 10:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Zip them, click on Post a Reply and use the attachment box on the bottom. If they're too big, you'll have to upload them somewhere like <a href="http://stashbox.org" target="_blank">stashbox</a>.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tlalit</span><br />
      <span class="post-time small text-muted">23rd April 2006 17:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I sent two the 2 installers:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tlalit</span><br />
      <span class="post-time small text-muted">23rd April 2006 18:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I sent two the 2 installers:<br />
      1. first install example1 with admin user (close outlook before doing that), now look at file permission of the dll installed under "program files/Test1"<br />
      2.log in to computer as restricted user, open outlook and run example2 with the RunAs command with admin user. you'll ask to reboot the computer ...<br />
      3. reboot the computer and login as the admin user you used with the RunAs command.<br />
      now look at the file permission again - you'll see the difference.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">28th April 2006 11:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Your temporary directory for extraction is $TEMP. That's not good. You should use $INSTDIR as the temporary directory for extraction (the last parameter). $TEMP can be on a different drive than $INSTDIR, in which case moving the file after reboot will not work. It can also have different permissions as it probably is in your case.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">tlalit</span><br />
      <span class="post-time small text-muted">30th April 2006 10:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">well, it looks like you were right :-)<br />
      thanks... problem solved!!!<br />
      have a great independence day...</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
