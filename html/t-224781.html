<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="VPatch 3.0 release"><title>VPatch 3.0 release - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content=" VPatch 3.0 release"><title>VPatch 3.0 release - NSIS Forums</title><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">VPatch 3.0 release</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=224781">VPatch 3.0 release</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">29th August 2005 12:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>VPatch 3.0 release</strong><br>VPatch is a binary patch generator, to be used in conjunction with NSIS for example. After 9 months of development and 8 release candidates (and a few beta's) there is now a stable version: 3.0.<br><br>For those of you who haven't used any release candidates:</p><ul><li>Date/time is preserved on the file patched</li><li>MD5 is now used for checksums instead of CRC</li><li>Patch generator completely rewritten (faster and lower memory usage). Now handles 500MB files as well, for example.</li><li>Patch generator flags replacement of a patch inside a patch file (same checksum) as an error</li><li>Bugfixes in the runtimes, now share a single codebase</li></ul>Compared to release candidate 8 the GUI has seen a bugfix and received a new icon. The whole package now has an installer again; the last time there was an installer was in 2.0.<br><br>You can find VPatch on <a href="http://www.tibed.net/vpatch" target="_blank">TibEd.net</a>.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br><span class="post-time small text-muted">29th August 2005 15:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">great work, man!<br>thanx in advance!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pabs</span><br><span class="post-time small text-muted">30th August 2005 03:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Cool! Do the important parts of it compile on Linux/POSIX?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rsegal</span><br><span class="post-time small text-muted">30th August 2005 04:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Koen you industrious Hollander. Fantastic work!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pabs</span><br><span class="post-time small text-muted">30th August 2005 10:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>posix portability stuff</strong><br>Genpat3 and Linux/Unix:<br><br>* including windows.h<br>* TRUE/FALSE/BOOL/DWORD/BYTE/etc<br>* Win32 file functions<br>* FILETIME<br>* MAX_PATH<br>* GetTempFileName<br>* no makefile/build system<br>* the following errors occur a lot:<br><br></p><blockquote>PatchGenerator.cpp:203: error: invalid conversion from â€˜unsigned char*â€™ to â€˜char*â€™<br>PatchGenerator.cpp:203: error: initializing argument 1 of â€˜std::basic_istream&lt;_CharT, _Traits&gt;&amp; std::basic_istream&lt;_CharT, _Traits&gt;::read(_CharT*, std::streamsize) [with _CharT = char, _Traits = std::char_traits&lt;char&gt;]â€™</blockquote>All these are probably easily fixed. If you don't mind depending on msvcrt, then the posix equivalents can be used instead otherwise you would have to use some wrapper class or something.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">2nd September 2005 12:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It is a longterm goal to compile on POSIX. The actual patch generator was written with cross-platform in mind, but things like GetTempFilename... well I just did not know how to do them the POSIX way. The same goes for a function to obtain file size.<br>The compiler used is Borland C++. Kichik said he'd look into compiling GenPat with MSVC++ which should increase cross-platformness (I hope).<br>I welcome change suggestions to compile on POSIX, just show me before/after for pieces of code. :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">3rd September 2005 16:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I've just redone my entire website. The link has not changed, which I think is pretty neat. Primary difference for VPatch: changelog has its own page now, and there is a Paypal donation button. You never know who might me feeling generous :D</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">3rd September 2005 17:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Whoops. Distribution updated:<br>- one of the shortcuts to readme didn't work<br>- Genpat was still branded RC8<br>- added (as a comment) a way to do GetTempFileName the POSIX way</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pabs</span><br><span class="post-time small text-muted">4th September 2005 12:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">In the manual page for tmpnam, it says the following:<br><br></p><pre>
<code><br>BUGS<br>       Never use this function. Use tmpfile(3) instead.<br></code>
</pre><br>
      <br>
      IIRC, that is because using it causes security issues through the race conditions created by using it. I imagine the same issues occur GetTempFileName as well.<br>
      <br>
      Here is the manual page for tmpfile:<br>
      <br>
      <a href="http://www.google.com/url?sa=t&amp;ct=res&amp;cd=2&amp;url=http%3A//man.he.net/man3/tmpfile&amp;ei=OH0gQ-PDF6qaafWO-acP" target="_blank">tmpfile man</a>.<br>
      <br>
      I think you should use the way that NSIS works to compile different functions for different platforms. Myself and perhaps kichik can help you create replacement functions if you do not know how to do certain things in POSIX.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br>
      <span class="post-time small text-muted">7th September 2005 09:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">So now I know why I only put it in as a comment :D and not as replacement code. My POSIX/cross-platform question:<br>
      - how do I get a file date, and because I want to convert it to a FILETIME, how do I multiply two 32-bit integers and get a 64-bit integer as a result?<br>
      - what is a 64-bit integer type name?<br>
      - IIRC the read function of C++ streams returns char instead of unsigned char. Is it safe to cast it to unsigned char?<br>
      <br>
      For those of you looking for a compiled version of the new NSIS plugin: you can now find it on the <a href="http://www.tibed.net/vpatch" target="_blank">VPatch website</a>.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pabs</span><br>
      <span class="post-time small text-muted">7th September 2005 15:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">1.</p>
      <pre>
<code>#include &lt;sys/types.h&gt;<br>#include &lt;sys/stat.h&gt;<br>#include &lt;unistd.h&gt;<br><br>int stat(const char *file_name, struct stat *buf);<br>int lstat(const char *file_name, struct stat *buf);</code>
</pre>Pick one of the statstruct members st_atime (last access), st_mtime (last modification), st_ctime (creation time). All of these are of type time_t. On some platforms, this is 64-bit, on some it is 32. See this MSDN url for how to convert to FILETIME:<br>
      <br>
      <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/sysinfo/base/converting_a_time_t_value_to_a_file_time.asp" target="_blank">http://msdn.microsoft.com/library/de..._file_time.asp</a><br>
      <br>
      As for multiplying 2 32 bit integers and getting a 64 bit one, just cast to 64 bit and multiply normally.<br>
      <br>
      So, the time_t -&gt; FILETIME conversion would look something like this:
      <pre>
<code>void TimetToFileTime( time_t t, LPFILETIME pft )<br>{<br>    uint64_t ll = ((uint64_t)t) *10000000L) + 116444736000000000L;<br>    pft-&gt;dwLowDateTime = (DWORD)(ll &amp; 0xFFFFFFFF);<br>    pft-&gt;dwHighDateTime = (DWORD)((ll&gt;&gt;32)&amp;0xFFFFFFFF);<br>}</code>
</pre>2.
      <pre>
<code>#include &lt;stdint.h&gt;<br>int64_t intwith64ormorebits;<br>uint64_t unsignedintwith64ormorebits;</code>
</pre>3. I'm not hugely familiar with C++, but I think that would be safe. In C, I'd just use (unsigned char)somechar, I think C++ uses reinterpret_cast or something (the C version would probably work though).
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br>
      <span class="post-time small text-muted">7th September 2005 18:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Wish I'd known about these integer types before. I've removed the windows.h dependency of VPatch by replacing the getFileTime function with a POSIX version.<br>
      <br>
      The temporary file is a bit of a problem though. Basically I need a C++ ofstream to write out bits and pieces of the new patch. When it's done, it needs to be copied back into the filename specified by the user. I cannot use the user specified file right away, because sometimes I need to 'update' it and then I copy it to the temporary file first (with some changes). Ideas on this?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br>
      <span class="post-time small text-muted">8th September 2005 00:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here is my go at a POSIX version. Notes:<br>
      - includes a MinGW makefile<br>
      - <b>will not link with MinGW 3.3.1</b><br>
      - works fine with Borland C++ compiler<br>
      - <b>still has Windows platform dependency for temporary files</b><br>
      <br>
      I don't see why this won't link right now... something with multiple definitions. My MinGW is really old (3.3.1) but I can't upgrade right now. I've included updated code.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pabs</span><br>
      <span class="post-time small text-muted">8th September 2005 05:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">With the attached patch, I can build genpat3posix on linux (I assume on mingw32 too). I haven't tested if it works yet though. It gives the following warnings/errors during building:</p>

      <blockquote>
        pabs@chianamo:~/devel/debian/misc/nsis/genpat3posix$ make<br>
        g++ -Wall -c -o Checksums.o Checksums.cpp<br>
        g++ -Wall -c -o adler32.o adler32.cpp<br>
        g++ -Wall -c -o ChunkedFile.o ChunkedFile.cpp<br>
        g++ -Wall -c -o GlobalTypes.o GlobalTypes.cpp<br>
        g++ -Wall -c -o FileFormat1.o FileFormat1.cpp<br>
        g++ -Wall -c -o main.o main.cpp<br>
        PatchGenerator.h: In constructor â€˜PatchGenerator::PatchGenerator(bistream&amp;, TFileOffset, bistream&amp;, TFileOffset, bostream&amp;)â€™:<br>
        PatchGenerator.h:60: warning: â€˜PatchGenerator::blockSizeâ€™ will be initialized after<br>
        PatchGenerator.h:51: warning: â€˜unsigned char* PatchGenerator::targetCDataâ€™<br>
        PatchGenerator.cpp:34: warning: when initialized here<br>
        cc -c -o md5.o md5.c<br>
        md5.c:56: warning: conflicting types for built-in function â€˜memcpyâ€™<br>
        g++ -Wall -c -o POSIXUtil.o POSIXUtil.cpp<br>
        g++ -o genpat Checksums.o adler32.o ChunkedFile.o GlobalTypes.o FileFormat1.o main.o md5.o POSIXUtil.o<br>
        main.o: In function `getTempFile()':<br>
        main.cpp:(.text+0x1c7): warning: the use of `tmpnam' is dangerous, better use `mkstemp'
      </blockquote>here is the manpage of mkstemp: <a href="http://www.opengroup.org/onlinepubs/009695399/functions/mkstemp.html" target="_blank">http://www.opengroup.org/onlinepubs/...s/mkstemp.html</a><br>
      <br>
      The mkstemp manpage on linux also mentions that tmpfile should be used instead, but in your case its better to use mkstemp I think.<br>
      <br>
      <a href="http://www.opengroup.org/onlinepubs/009695399/functions/tmpfile.html" target="_blank">http://www.opengroup.org/onlinepubs/...s/tmpfile.html</a>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pabs</span><br>
      <span class="post-time small text-muted">8th September 2005 14:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Did a quick test of my compiled version of genpat3posix, I had to change all the char* exceptions in main.cpp to const char* exceptions. I ran it like so:</p>
      <pre>
<code>genpat oldfile.txt newfile.txt posix.pat</code>
</pre>After that I got a problem where patch.good() returns 0 at this statement in main.cpp:
      <pre>
<code>  if(source.good() &amp;&amp; target.good() &amp;&amp; patch.good()) {</code>
</pre>The cause of this is the call to removeExistingPatch in the preceeding loop. As far as I can tell, it enters this if, and returns from it:
      <pre>
<code>TFileOffset removeExistingPatch(bistream&amp; in, TFileOffset inSize,<br>                                bostream&amp; out, TChecksum* removeCRC, <br>                                bool existanceIsError) {<br>  // MD5 mode<br>  TFileOffset fileCount = 0x80000000;<br>  // empty file/does not yet exist<br>  if(in.bad() || in.eof() || (inSize == 0)) {<br>    writeDword(out,MAGIC_VPAT);<br>    writeDword(out,fileCount); // noFiles<br>    return fileCount;<br>  }<br></code>
</pre>After that point, patch.good() returns false. Not sure how that breaks things, I don't know enuf C++.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br>
      <span class="post-time small text-muted">8th September 2005 18:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've been including your patch. Except for the checksums part, which I'm reimplementing using C++ streams. Note that if you break the checksum implementation, you might get these kinds of errors. At least, I'm happy with my test cases for VPatch know, because I was falling into the <i>readsome trap</i> of C++.<br>
      <br>
      Can you maybe remove the manpage for tmpfile from this topic? The layout does not like it very much.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">8th September 2005 19:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Koen van de Sande</i><br>
        <b>Can you maybe remove the manpage for tmpfile from this topic? The layout does not like it very much.</b>
      </blockquote>All posts edited to fit in one screen.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br>
      <span class="post-time small text-muted">8th September 2005 19:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Kichik :)<br>
      <br>
      Here's an updated version of the (work-in-progress) GenPat-POSIX. Notes:<br>
      - compiles all files on Borland C++, MinGW 3.3.1, GCC 3.3.5pre (SuSE)<br>
      - Needs more testcases. Not for production use, since checksum code has been rewritten and not all boundary cases have been checked.<br>
      - <b>WILL NOT LINK. Only Borland C++ can link its object files into an executable. MinGW and GCC spit out a huge list of undefined references. I need help with this :confused:</b><br>
      - check out secure temp file creation<br>
      <br>
      I'm quite curious how you got your code to link in the first place, 'cause I can't :D</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br>
      <span class="post-time small text-muted">9th September 2005 00:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This link error is freakin' brilliant. :(<br>
      <br>
      Basically, my bifstream/bofstream implicitly construct a<br>
      <b>std::char_traits&lt;unsigned char&gt;</b>. And this does not exist for <b>unsigned char</b>, it's actually documented for <a href="http://gcc.gnu.org/onlinedocs/libstdc++/21_strings/howto.html#5" target="_blank">GCC</a>.<br>
      And the same for <a href="http://www.codeguru.com/forum/showthread.php?t=344446" target="_blank">MSVC7</a>.<br>
      <br>
      This is turning into a huge problem. By design all my functions read in bytes from a stream... and this just works in Borland C++. But apparantly the route I chose with change the input/output stream to use the <b>unsigned char</b> type does not work, in fact. So I should revert back to casting <i>everywhere</i>!?<br>
      <br>
      <a href="http://coding.derkeiler.com/Archive/C_CPP/comp.lang.cpp/2003-12/0172.html" target="_blank">Well, at least I am not alone in this.</a> Defining your own char_traits is considered bad style... so I guess I'll have to cast. :hang: :eek:</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br>
      <span class="post-time small text-muted">9th September 2005 00:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">So I changed it all to casting. But still need to clean up code in places (ifstream and bifstream are the same now, but I changed it everywhere before). This one compiles on Linux. And I guess it should work, but I haven't tested if the patches are valid. But it runs at least :D</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pabs</span><br>
      <span class="post-time small text-muted">10th September 2005 03:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Compiled fine here too - no warnings either :) - posix.pat (created from genpat compiled from genpat3posix3.zip) and patch.pat created from oldfile.txt and newfile.txt are exactly the same, apart from 8 bytes at byte 93. I'm guessing this is the timestamp field. Might be a good idea to run it over heaps of different combinations of files, hexdump all the .pat files and diff them just to be sure it works in lots of cases. I haven't tested if the decoder plugin understands posix.pat, but I assume it would.<br>
      <br>
      Anyways, I think that once a new VPatch release is out with these changes included, then the next NSIS version should include the new VPatch. Yay, finally genpat can be included in the debian package :)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">10th September 2005 08:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by pabs</i><br>
        <b>Anyways, I think that once a new VPatch release is out with these changes included, then the next NSIS version should include the new VPatch.</b>
      </blockquote>Yep.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br>
      <span class="post-time small text-muted">10th September 2005 14:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm currently spending some time on the test suite. Something came to mind: what if the source and target file for GenPat are the same? Right now it will create a patch which just copies the entire file. Applying the patch will then work just fine with no errors. Is this the right semantic? I think it is, but I thought I'd check :D</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br>
      <span class="post-time small text-muted">10th September 2005 14:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here's an updated version to make it compile with MinGW also. Currently putting it through my test cases.<br>
      <br>
      [edit]<br>
      The POSIX version uses a different function to retrieve timestamps from files. And the results are different: one of them does not respect time zones. VPatch 3.0 uses some Windows function, and retrieves: <b>(2002, 2, 2, 4, 58, 22)</b>, while the POSIX stat function returns <b>(2002, 2, 2, 5, 58, 22)</b> which is off by one hour. Windows explorer shows 4:58 for the target file. Now what should I do about this :rolleyes:<br>
      This regression was caught by my new test suite, by the way :D<br>
      [/edit]</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br>
      <span class="post-time small text-muted">11th September 2005 01:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Now that I've reverted back to the Windows date/time extraction on the Win32 platform, I've encountered something in my test cases: a <i>different</i> patch. Visual C++ and MinGW generate different patches than the Borland C++ one... though they do work fine and have the exact same size. I feel I need to get to the bottom of this first before putting out a new version. It might just be a subtlety in the way the patch is generated, but better safe than sorry. At least, Visual C++ and MinGW do agree either on the patch :)<br>
      <br>
      [edit]It's a subtle thing indeed: when multiple blocks can be used for a copy from the source file (with the same contents), they pick a different one[/edit].</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br>
      <span class="post-time small text-muted">11th September 2005 12:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here's another new version. This one:<br>
      - complies to my tests (though MinGW/VC++6 have a different interpretation of patch making than BC++, they are the same size and give the correct result)<br>
      - compiles on Visual C++ 6, MinGW, GCC and Borland C++<br>
      - is considered a release candidate. If more people check if it compiles for them, then it's ready. It compiles for me everywhere :D<br>
      <br>
      Note to MinGW people trying to compile: I don't know if __WIN32__ is defined automatically in MinGW. If you want to use the Windows GetTempFilename/GetFileTime functions (which are slightly better than the POSIX ones), then you should verify that it is defined, otherwise it will use POSIX functions.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pabs</span><br>
      <span class="post-time small text-muted">13th September 2005 04:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Compiles and works on Linux fine. You might consider using - instead of / as a command-line option delimiter on Linux, because on Linux / is part of filenames, and - is the commonly used option delimiter.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">17th September 2005 10:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">VPatch 3.0 was committed into CVS. Currently, GenPat is not compiled natively but only cross-compiled. I need to make some changes to the build system to make it compile natively.<br>
      <br>
      Thanks!</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br>
      <span class="post-time small text-muted">17th September 2005 18:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've put out the GenPat POSIX version as VPatch 3.1. Compared to the version in CVS (which is based on the genpat3posix5.zip) the notable changes (files attached):<br>
      - main.cpp was changed to use "-" as a switch option character on non-Win32 instead of "/"<br>
      - Readme.html was changed to include changelog of 3.1 (POSIX compatibility)<br>
      <br>
      Remarks on the current CVS version:<br>
      - VAppend was in with 2.1, only it's now been moved to a "VAppend" folder for 3.0, and it's no longer in CVS. However, this might not be such a bad thing because the NSIS version does not need it, it's only for all non-NSIS runtimes. So I think it is best to leave this out. :)<br>
      - VPatch_tests.py runs several functionality tests on GenPat (Windows only), perhaps this can be included. One of the tests will not work because of missing files (only I have the datafiles on my PC), but all others are self-contained and quite useful. I'll leave the decision on this up to Kichik :D<br>
      - VPatchLib.nsh makes more sense in the NSIS include folder (?) Or can it be included from where it is now as well?<br>
      <br>
      You can find the ZIP/Installer distro of 3.1 on TibEd.net: <a href="http://www.tibed.net/vpatch" target="_blank">http://www.tibed.net/vpatch</a>.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">17th September 2005 18:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks, uploaded.<br>
      <br>
      The tests script fails without VAppend so I didn't include it yet.<br>
      <br>
      The header file is located in the Contrib directory in CVS, but it's installed into the Include directory.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pabs</span><br>
      <span class="post-time small text-muted">18th September 2005 09:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Not sure if this is related to the conversion to native rather than cross-compiled, but I get this failure with g++ 4.0:</p>

      <blockquote>
        g++ -o build/release/VPatch/Source/GenPat/GenPat -s -Wl,--file-alignment,512 -Wl,-Map,build/release/VPatch/Source/GenPat/GenPat.map build/release/VPatch/Source/GenPat/adler32.o build/release/VPatch/Source/GenPat/Checksums.o build/release/VPatch/Source/GenPat/ChunkedFile.o build/release/VPatch/Source/GenPat/FileFormat1.o build/release/VPatch/Source/GenPat/GlobalTypes.o build/release/VPatch/Source/GenPat/main.o build/release/VPatch/Source/GenPat/md5.o build/release/VPatch/Source/GenPat/PatchGenerator.o build/release/VPatch/Source/GenPat/POSIXUtil.o<br>
        /usr/bin/ld: unrecognized option '--file-alignment'<br>
        /usr/bin/ld: use the --help option for usage information<br>
        collect2: ld returned 1 exit status<br>
        scons: *** [build/release/VPatch/Source/GenPat/GenPat] Error 1
      </blockquote>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br>
      <span class="post-time small text-muted">18th September 2005 09:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ah yes, the tests are useless without VAppend. So they do not need to be included with NSIS.<br>
      <br>
      The GCC 4 error looks very much like an option to the compiler is not recognized. This might be a SCons thing.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pabs</span><br>
      <span class="post-time small text-muted">18th September 2005 18:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If I ignore that error using SKIPUTILS, I get some more build errors on the plugin and elsewhere, which can be fixed by the attached patch against CVS.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">20th September 2005 18:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks, all fixed.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br>
      <span class="post-time small text-muted">26th September 2005 20:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">These changes will be added to the 'full' VPatch as well, but it will have to wait a while 'cause it's not that an important an update for the default distribution. It will be bundled as soon as there is also something else new that warrants a new version. :)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">T.Slappy</span><br>
      <span class="post-time small text-muted">28th June 2006 18:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Vpatch use problem</strong><br>
      Hi<br>
      I would like to use Vpatch for installing my mod.<br>
      Mod consist from 6 files (aprox 30 MB each)<br>
      This files should be inserted to archives (each file to separate archive, apr 600 MB), but I do not want the user to insert each file manually<br>
      <br>
      I want to patch file with vpatch plugin.<br>
      I tried it in this way:<br>
      <br>
      !insertmacro VPatchFile "m12_main.pat" "$INSTDIR\M12_main.zip"<br>
      (I think it means: patch "$INSTDIR\M12_main.zip" with file "m12_main.pat")<br>
      <br>
      (before patching I unpacked m12_main.pat file to instdir)<br>
      <br>
      The problem is, that I want the smallest installer and I can not extract those 600 MB archives to patch them (readme example says that I have to extract new file)<br>
      <br>
      Out-dated game archives are present at target system and I want to patch them with patch files generated with genpat, so the installer size should be aprx 6x30MB (uncompressed)<br>
      Is there any way to do it?<br>
      thx</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br>
      <span class="post-time small text-muted">28th June 2006 18:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Zip files have no solid compression, so you can patch them directly. You have to create a new zip file and create a patch from the old to the new archive.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">T.Slappy</span><br>
      <span class="post-time small text-muted">28th June 2006 19:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>vpatch</strong><br>
      I used this script:<br>
      vpatch::vpatchfile $PLUGINSDIR\patch.pat" "$INSTDIR\M12_main.zip" "$INSTDIR\M12_main_new.zip"<br>
      <br>
      (from vpach example)<br>
      <br>
      M12_main.zip is present on target system, M12_main_new.zip no (I used it to generate patch with genpat.exe), so I got this error::<br>
      Result: Unable to open source file<br>
      <br>
      So what to do?<br>
      (I do not want to extract whole M12_main.zip to target system, because it is 600MB big)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">JasonFriday13</span><br>
      <span class="post-time small text-muted">29th June 2006 00:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You forgot a quote mark:<br>
      <br>
      vpatch::vpatchfile "$PLUGINSDIR\patch.pat" "$INSTDIR\M12_main.zip" "$INSTDIR\M12_main_new.zip"</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">T.Slappy</span><br>
      <span class="post-time small text-muted">30th June 2006 16:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>vpatch</strong><br>
      JasonFriday13: Thanks, but it did not help<br>
      <br>
      I always have error: cannot open output file<br>
      I tried<br>
      vpatch::vpatchfile "$PLUGINSDIR\patch.pat" "$INSTDIR\M12_main.zip" "$INSTDIR\M12_main.zip",<br>
      <br>
      vpatch::vpatchfile "$INSTDIR\patch.pat" "$INSTDIR\M12_main.zip" "$INSTDIR\M12_main.zip",<br>
      <br>
      vpatch::vpatchfile "$INSTDIR\patch.pat" "$INSTDIR\M12_main.zip"<br>
      <br>
      too, but still the same error<br>
      <br>
      I used the example to make it, but there are 3 files (new txt, old txt and patch) and I have only two (old and patch)<br>
      and it still does not work....</p>
    </div>
    <hr>
    
    
    

    <div class="container">
      

      <ol class="breadcrumb">
        <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

        <li><a href="f-65.html">NSIS Discussion</a></li>

        <li class="active">VPatch 3.0 release</li>
      </ol>

      <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=224781">VPatch 3.0 release</a></p><br>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">T.Slappy</span><br>
        <span class="post-time small text-muted">30th June 2006 20:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"><strong>vpatch</strong><br>
        I mean the same as this guy:<br>
        <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=215701&amp;highlight=vpatch" target="_blank">http://forums.winamp.com/showthread....ghlight=vpatch</a><br>
        <br>
        I mean: Vpatch is useless...<br>
        <br>
        I just want to really PATCH file, it means that I HAVE old file and I will physicall rewritten it with patch (patch should be some manual for dll/installer how to change the target file: like "write 0xFFAHBD on offset position 145585, then write...")<br>
        <br>
        This is not the PATCH...it just better copy function...<br>
        <br>
        I mean it like Profesional Patch System - EA use it for their games - it changes only few bytes of file...<br>
        I am really dissapointed from it, because I tried to "patch" my file for hours and I found out that it is not possible with this tool.</p>
      </div>
      <hr>

      <div class="footer">
        <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
      </div>
    </div><script src="../js/highlight.pack.js" type="text/javascript">
</script> <script type="text/javascript">
//<![CDATA[
    hljs.initHighlightingOnLoad();
    //]]></script></div></body></html>