<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="exDll with MFC Support"><title>exDll with MFC Support - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">exDll with MFC Support</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=245706">exDll with MFC Support</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Netdiver030</span><br><span class="post-time small text-muted">8th May 2006 18:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>exDll with MFC Support</strong><br>Has anyone a template that can be linked? (XP &amp; VC7)<br>I stumbled around for a long time and read a lot of threads.<br>C++ is not the issue, but using normal Mfc functions like registry and other bumpf behind it would be a nice feature.<br><br>NetDiver030</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">8th May 2006 20:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Doesn't creating MFC DLL with the VC wizards work? That should be enough, I think. If not, probably some MFC initialization functions must be called.<br><br>But I'd highly recommend you don't create plug-ins using MFC. Using MFC to create plug-ins would require any installer using them to install the MFC runtimes before it could even start running.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">8th May 2006 20:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">unless you linked statically the runtimes :\</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Netdiver030</span><br><span class="post-time small text-muted">9th May 2006 06:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Unfortunately the normal VC wizard MFC Dll as a PlugIn Dll does not work.<br>Only the calling of my MfcStuffDll functions via System::Call works fine. But as far as I get it this requires that my MfcStuffDll is installed first.<br><br>Or is there a way to use my dll from within the installer archive? - I haven't look too closely at the usage of temporary files. Maybe that way.<br>Or has anyone an exDll example with mfc support?<br><br>(static linking. Currently there is enough discspace to waste for this project :-) )</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">9th May 2006 13:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">How do you pass the stack pointer and the variables pointer using System::Call? Have you used the correct function parameters for the functions you wish the export? What about the calling convention?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Netdiver030</span><br><span class="post-time small text-muted">9th May 2006 14:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for your support so far.<br><br>Your hint with the system::call function was very helpful.<br>I found a workaround which is fine for me because my software requires administrator priviliges anyway.<br><br>I just stuffed all my MFC code in an ordinary MFC Dll.<br>And in the init part of my installer script I install this dll in the system32 folder. Than I call my mfc functions and retrieve my system analysis and after that I remove the temporarly installed Dll from system32 and continue with the installation of the software.<br>Works fine - but like I mentioned only for installations with administrator prviliges.<br><br>Btw. I tried the normal calling convention from the exDll example:<br>MyDll:MyFunction ...<br>on the MFC Dll.<br><br>Now I use the<br>System::Call "MyDll::MyCheck()i().r0"<br>to find out if some things.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">9th May 2006 14:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That's not the calling convention I'm talking about. I'm talking about __stdcall and __cdecl. I'm talking about how you define the function in your DLL. Its header should look exactly like the functions in exdll.c, except the name. If not, you won't be able to call them the script like a normal plug-in and you'll have to use the System plug-in. Judging by the System call that does work for you, you've got the wrong function header.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>