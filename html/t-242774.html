<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Problems adding Path variable"><title>Problems adding Path variable - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Problems adding Path variable</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=242774">Problems adding Path variable</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Thalion77</span><br><span class="post-time small text-muted">6th April 2006 12:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Problems adding Path variable</strong><br>Hello!<br><br>I want to add a path to the path environment variable in order to call executables without defining the whole path.<br><br>I use the code sample at:<br><br><a href="http://nsis.sourceforge.net/Path_Manipulation" target="_blank">http://nsis.sourceforge.net/Path_Manipulation</a><br><br>But those lines don't really work as I would like to have. Indeed, the path variable is going to be added. BUT: If I again call ReadEnvStr $1 PATH, my set path variable is not found in $1. If I call my installer several times without rebooting the computer, the path variable is added several times due to ReadEnvStr $1 PATH. I have to reboot the machine to get the right path informations. It seems, that SendMessage ${HWND_BROADCAST} ${WM_WININICHANGE} 0 "STR:Environment" /TIMEOUT=5000 does not refresh the system correctly. What can be done to refresh the system without rebooting? I use NSIS 2.14.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Thalion77</span><br><span class="post-time small text-muted">6th April 2006 12:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Re:</strong><br>I found out that the following lines<br><br>WriteRegExpandStr ${WriteEnvStr_RegKey} "PATH" $3<br>SendMessage ${HWND_BROADCAST} ${WM_WININICHANGE} 0 "STR:Environment" /TIMEOUT=5000<br><br>do not immediately activate the new set path.<br><br>So if you set a path and then execute an executable without path, that will not work.<br><br>e.g.<br>SendMessage ${HWND_BROADCAST} ${WM_WININICHANGE} 0 "STR:Environment" /TIMEOUT=5000<br>Exec 'InstallAppCmd.exe' # FAILES!!!<br>but<br>Exec 'C:\Program Files\InstallAppCmd.exe' # works!!!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">7th April 2006 10:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The SendMessage line only updates explorer.exe. If you execute your installer from an application that doesn't update itself due to that broadcast message, like another installer, your installer will not see the updated environment variable. To set the environment variables of the current process, you can use the first method described in <a href="http://nsis.sourceforge.net/Setting_Environment_Variables" target="_blank">Setting Environment Variables</a>. When setting the variables for the current process, every process executed from it will inherit the new variables. However, they will not be set on the entire system and will be forgotten when the process exits.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>