<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="backup macro?" />

  <title>backup macro? - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">backup macro?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=117747">backup macro?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Bizzy</span><br />
      <span class="post-time small text-muted">13th December 2002 17:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>backup macro?</strong><br />
      How to script a backup? I did a search in this forum and found a few examples, but I couldn't fit them to my case (I'm not a programmer :( ).<br />
      <br />
      I'm trying to make an installer for a game modification. It includes loadsa files (~1000) that goes to various subdirectories in gamedir\data\ .End-user possibly has other mods installed, so my installer must backup files that will be replaced. Problem is, I don't know exactly which files user already has. What macro could do the trick (before overwriting any file, copy/move the original to gamedir\modbckup\ )?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">13th December 2002 19:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What's wrong with this one:<br />
      <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=113987&amp;highlight=backup" target="_blank">http://forums.winamp.com/showthread....ghlight=backup</a><br />
      ?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Bizzy</span><br />
      <span class="post-time small text-muted">13th December 2002 22:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You mean dis one?<br />
      <br /></p>

      <blockquote>
        !macro BackupAndExtract DIR FILE<br />
        SetOutPath "$INSTDIR\${DIR}"<br />
        IfFileExists "$OUTDIR\${FILE}" 0 +3<br />
        CreateDirectory "$INSTDIR\backup\${DIR}"<br />
        Rename "$OUTDIR\${FILE}" "$INSTDIR\backup\${DIR}\${FILE}"<br />
        File "&lt;insert app dir here&gt;\${DIR}\${FILE}"<br />
        !macroend<br />
        <br />
        !insertmacro BackupAndExtract "" "Core.dll"<br />
        !insertmacro BackupAndExtract "subfolder" "AnotherDLL.dll"
      </blockquote>So I'll have to add manually<br />
      !insertmacro BackupAndExtract "subfolder" "file.xxx"<br />
      for each of 1000 files? That's nuts!<br />
      Or is there some other way?<br />
      <br />
      PS: I'm sorry for being so n00bish, but well, I am n00bie :rolleyes: . Started to use NSIS yesterday. :)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">13th December 2002 22:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, you will, in some way or another, have to tell NSIS to check all the files and backup them if needed. If you don't mind backing up files that might not get overwritten you can just use CopyFiles to copy the entire directory somewhere else. If you want to backup just files that are to be overwritten you will have to write a script that will create another script with all of the File commands in it. You should do this using FindFirst, FindNext, FindClose, FileOpen and FileWrite. You will have to loop through all the files you want to add and write !insertmacro to the new script file for each and every one of them (about 10 lines of a loop, not so hard).<br />
      <br /></p>

      <blockquote>
        PS: I'm sorry for being so n00bish, but well, I am n00bie. Started to use NSIS yesterday.
      </blockquote>That's OK, keep asking until you understand.
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
