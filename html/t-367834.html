<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Restoring window focus after Banner::destroy" />

  <title>Restoring window focus after Banner::destroy - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Restoring window focus after Banner::destroy</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=367834">Restoring window focus after Banner::destroy</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hanky</span><br />
      <span class="post-time small text-muted">1st August 2013 15:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Restoring window focus after Banner::destroy</strong><br />
      Hi!<br />
      <br />
      I want to use Banner::show function to replace the standard "Please wait while Setup..." string.<br />
      But how do I properly close that banner?<br />
      After I call Banner::destroy my installer window loses it's focus. How can I fix that?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aerDNA</span><br />
      <span class="post-time small text-muted">1st August 2013 17:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">BringToFront. Note however that Banner utilizes that dialog but it's not a replacement. Using Banner will not change the string displayed on installer start. If that's what you're trying to do, you'll have to reshack dialog 111.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hanky</span><br />
      <span class="post-time small text-muted">1st August 2013 20:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by aerDNA</small><br />
        BringToFront. Note however that Banner utilizes that dialog but it's not a replacement. Using Banner will not change the string displayed on installer start. If that's what you're trying to do, you'll have to reshack dialog 111.
      </blockquote>I've managed to replace standard text on the banner, but my goal is to keep the installer on top after it.<br />
      BringToFront doesn't help. When I call it, the installer just begin to blink in the task bar. It doesn't move to front.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aerDNA</span><br />
      <span class="post-time small text-muted">1st August 2013 22:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's the "prevent applications from stealing focus" Windows feature; I tend to forget about it since I always have it disabled. You should be able to beat it with this:<br />
      System::Call "User32::SetWindowPos(i $HWNDPARENT, i -1, i 0, i 0, i 0, i 0, i 3) i."</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hanky</span><br />
      <span class="post-time small text-muted">2nd August 2013 08:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by aerDNA</small><br />
        BringToFront. Note however that Banner utilizes that dialog but it's not a replacement. Using Banner will not change the string displayed on installer start. If that's what you're trying to do, you'll have to reshack dialog 111.
      </blockquote>And what about using reshack?<br />
      I've found and replaced the "Please wait while Setup..." string in the Contrib\UIs\modern.exe.<br />
      But where can I found the "verifying installer" string? Is recompiling NSIS the only way to change it?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aerDNA</span><br />
      <span class="post-time small text-muted">2nd August 2013 09:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That one is in Stubs\zlib (or whichever you're using); you can hex edit it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hanky</span><br />
      <span class="post-time small text-muted">2nd August 2013 09:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by aerDNA</small><br />
        That one is in Stubs\zlib (or whichever you're using); you can hex edit it.
      </blockquote>Thank you, I've found the string I need. But is it possible to insert cyrillic symbols into that file? When I patch it, I see symbols in wrong encoding during installation.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aerDNA</span><br />
      <span class="post-time small text-muted">2nd August 2013 22:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I would guess that proper locale isn't set for non-unicode programs on your test system, but in that case the whole installer would fail to display cyrillic symbols. You could replace the string with spaces, or turn crc checking off; not very beautiful solutions, I know.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aerDNA</span><br />
      <span class="post-time small text-muted">2nd August 2013 23:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I tried and succeeded in getting a Russian Cyrillic string to display properly (проверка установки = verifying installer if google translate is correct). I attached the edited zlib - if it doesn't work for you, then it's the system locale; if it does, then you didn't edit right.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hanky</span><br />
      <span class="post-time small text-muted">5th August 2013 12:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It seems that we use different NSIS version.<br />
      I've tried your file, it displays proper string, but after it the installer crashes.<br />
      <br />
      Also I've tried to copy your string into my file but it didn't help. In my file one letter takes two bytes and in yours it takes one byte.<br />
      <a href="http://forums.winamp.com/attachment.php?attachmentid=50735" target="_blank" title="Name: Views: Size: ">Attachment 50735</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aerDNA</span><br />
      <span class="post-time small text-muted">5th August 2013 17:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I just assumed it was 2.46. Which version is it? It's obviously unicode but I can't match it with any build. Anyway, I edited your zlib, see if it makes a difference.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aerDNA</span><br />
      <span class="post-time small text-muted">5th August 2013 23:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The above will not work, but this one will.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hanky</span><br />
      <span class="post-time small text-muted">6th August 2013 09:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by aerDNA</small><br />
        The above will not work, but this one will.
      </blockquote>Thank you very much. This file works.<br />
      But could you explain which encoding did you use?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">aerDNA</span><br />
      <span class="post-time small text-muted">6th August 2013 15:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Unicode (UTF-16LE). The latin subset of unicode has the same codes as ansi, except they're 2 bytes, so when seen in hex editor, it looks like a 'regular' string interlaced with zeros. This gave you and me the wrong idea that you can just replace the latin ascii with cyrillic, but it doesn't work that way. The easiest way I guess to get the properly encoded string is to write it in notepad, save as unicode and open in hex editor; discard the first 2 bytes and the rest is your string.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hanky</span><br />
      <span class="post-time small text-muted">9th August 2013 09:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you!<br />
      Now I can edit those files myself :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">9th August 2013 15:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by aerDNA</small><br />
        The latin subset of unicode has the same codes as ansi, except they're 2 bytes, so when seen in hex editor, it looks like a 'regular' string interlaced with zeros.
      </blockquote>Only the first 127 codepage entries (old school ASCII) are the same...
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
