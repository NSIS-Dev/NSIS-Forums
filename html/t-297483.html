<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="UI dead when button click event execute long time function"><title>UI dead when button click event execute long time function - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">UI dead when button click event execute long time function</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=297483">UI dead when button click event execute long time function</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">oscargee1</span><br><span class="post-time small text-muted">16th September 2008 20:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>UI dead when button click event execute long time function</strong><br>Hi, My problem is very easy to be reproduced.<br><br>I have a background running function which will be launched when a button was clicked. But it will cause all UI be locked and looks urgly. Please help me out of the problem.<br><br>The code could be like below. It's example code under NSIS example folder. I just inserted "Sleep 10000" in button function. And it will lock the UI.<br><br>!include nsDialogs.nsh<br>!include LogicLib.nsh<br><br>Name "nsDialogs Example"<br>OutFile "nsDialogs Example.exe"<br><br>XPStyle on<br><br>Page license<br>Page custom nsDialogsPage<br><br>Var BUTTON<br>Var EDIT<br>Var CHECKBOX<br><br>Function nsDialogsPage<br><br>nsDialogs::Create /NOUNLOAD 1018<br>Pop $0<br><br>GetFunctionAddress $0 OnBack<br>nsDialogs::OnBack /NOUNLOAD $0<br><br>${NSD_CreateButton} 0 0 100% 12u Test<br>Pop $BUTTON<br>GetFunctionAddress $0 OnClick<br>nsDialogs::OnClick /NOUNLOAD $BUTTON $0<br><br>${NSD_CreateText} 0 35 100% 12u hello<br>Pop $EDIT<br>GetFunctionAddress $0 OnChange<br>nsDialogs::OnChange /NOUNLOAD $EDIT $0<br><br>${NSD_CreateCheckbox} 0 -50 100% 8u Test<br>Pop $CHECKBOX<br>GetFunctionAddress $0 OnCheckbox<br>nsDialogs::OnClick /NOUNLOAD $CHECKBOX $0<br><br>${NSD_CreateLabel} 0 40u 75% 40u "* Type `hello there` above.$\n* Click the button.$\n* Check the checkbox.$\n* Hit the Back button."<br>Pop $0<br><br>nsDialogs::Show<br><br>FunctionEnd<br><br>Function OnClick<br><br>Pop $0 # HWND<br>Sleep 10000<br>MessageBox MB_OK clicky<br><br>FunctionEnd<br><br>Function OnChange<br><br>Pop $0 # HWND<br><br>System::Call user32::GetWindowText(i$EDIT,t.r0,i${NSIS_MAX_STRLEN})<br><br>${If} $0 == "hello there"<br>MessageBox MB_OK "right back at ya"<br>${EndIf}<br><br>FunctionEnd<br><br>Function OnBack<br><br>MessageBox MB_YESNO "are you sure?" IDYES +2<br>Abort<br><br>FunctionEnd<br><br>Function OnCheckbox<br><br>Pop $0 # HWND<br><br>MessageBox MB_OK "checkbox clicked"<br><br>FunctionEnd<br><br>Section<br>SectionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">demiller9</span><br><span class="post-time small text-muted">16th September 2008 22:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Right before you sleep (or whatever the button is really going to do) you could disable the other controls/buttons to indicate that they are not currently listening to the user. Then when the sleep/task completes, you reenable the controls again.<br></p><pre>
<code>EnableWindow $Edit 0<br>GetDlgItem $0 $HWNDPARENT 1 'next button<br>EnableWindow $0 0<br>EnableWindow $CHECKBOX 0<br><br>Sleep 10000<br><br>EnableWindow $Edit 1<br>GetDlgItem $0 $HWNDPARENT 1 'next button<br>EnableWindow $0 1<br>EnableWindow $CHECKBOX 1</code>
</pre><br>
      Don
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">oscargee1</span><br>
      <span class="post-time small text-muted">16th September 2008 23:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry, it doesn't help. You can see the window isn't refresh when you click the button. Well, other controls are disabled but it doesn't mean the UI can response any mouse command like move window or minimize the window. I hope the UI is still alive after user click button.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ZmAn3</span><br>
      <span class="post-time small text-muted">28th September 2008 01:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">i think thats a issue with nsdialogs ,kichik has said<br>
      "nsDialogs doesn't support asynchronous operations so you can't keep on doing something, updating the GUI while you do it and still have user interaction."<br>
      ive kinda ran into that my self with a extracting a big file</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script type="text/javascript" src="../js/highlight.pack.js" async>
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>