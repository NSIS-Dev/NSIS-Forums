<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="IE doesn't load after install on Vista"><title>IE doesn't load after install on Vista - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">IE doesn't load after install on Vista</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=314836">IE doesn't load after install on Vista</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">amoneriot</span><br><span class="post-time small text-muted">24th November 2009 19:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>IE doesn't load after install on Vista</strong><br>Hello All,<br>I'm a relative newbie to NSIS but I love it already and have dabbled in it enough to fix all the UAC and signing issues I was having. But now, this one issue is eating up my time and I can't get any direction on what to look out for. The following code snippet works fine on XP and Win7 but doesn't work on Vista. It's supposed to load IE with a website but it doesn't work on Vista only. I went through the forum and it doesn't look like it's been discussed before. I tried using exec instead of execshell as well. What could I be doing wrong here ? Is there anything I can try ? Really appreciate some pointers at this point.<br><br>Function .onInstSuccess<br>Push $0<br>ReadRegStr $0 HKCR "InternetExplorer.Application\CLSID" ""<br>ReadRegStr $0 HKCR "CLSID\$0\LocalServer32" ""<br>ExecShell "open" "$0" "http://www.google.com/" SW_SHOWNORMAL<br>UAC::Unload<br>Pop $0<br>FunctionEnd<br><br>Thanks.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">24th November 2009 19:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Why is there a call to the UAC plugin there? If you are using that, ExecShell is not the correct ting to use. Also, you probably don't want to use the open verb, try a empty string</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">amoneriot</span><br><span class="post-time small text-muted">24th November 2009 19:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The example tutorial on UAC talked about releasing the UAC plugin on successful installation, which is why there's a cleanup call there.<br>This same code works fine for XP and win7. why wouldn't it work for Vista ? Anyways, I took your suggestion and tried calling ExecShell with an empty string and that didn't make a difference. Previously, I had tried using exec as well but that didn't work as well. If execshell isn't the correct thing to work and exec doesn't work, what else should I be trying ?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">24th November 2009 20:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">well, for one thing, if you are using the uac plugin, you should call the uac version of execshell. But why would you want to force IE on your users, just specify the url as the command, no need to hunt for the .exe</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">amoneriot</span><br><span class="post-time small text-muted">24th November 2009 22:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'm installing a toolbar for IE, which is why I need to have IE load up. I tried using UAC::exec as well as nsexec::exec but it didn't make any difference. Details in the new sample code below. I hope I got the arguments right. The worst part of all this is that the errorlevel isn't set, which tells me that the function should have worked. Could this be a real bug for which we need a bugfix ? I can't think of trying anything else. Does exec, execshell, etc. work with IE 7.0 on Vista ?<br><br>Function .onInstSuccess<br>Push $0<br>ReadRegStr $0 HKCR "InternetExplorer.Application\CLSID" ""<br>ReadRegStr $0 HKCR "CLSID\$0\LocalServer32" ""<br>;ExecShell "open" "$0" "http://www.msn.com/" SW_SHOWNORMAL<br>;UAC::Exec '' '"$0 <a href="http://www.msn.com/" target="_blank">http://www.msn.com/</a>"' '' ''<br>nsExec::Exec '"$0" <a href="http://www.msn.com/" target="_blank">http://www.msn.com/</a>'<br>UAC::Unload<br>Pop $0<br>FunctionEnd</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">demiller9</span><br><span class="post-time small text-muted">25th November 2009 01:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">On my system (Vista Home Premium x64) the reg value for LocalServer32 has "%ProgramFiles%\Internet Explorer\iexplore.exe". You probably need to <a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.2.7" target="_blank">ExpandEnvStrings</a> before the nsExec::Exec call.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">25th November 2009 07:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">well, if you want to force IE, you could use the supported COM interface for automating IE</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">amoneriot</span><br><span class="post-time small text-muted">25th November 2009 18:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks a lot for your suggestions. I made some progress finally. nsexec::exec seems to work, but with the side effect that when my installer doesn't quit until IE quits. Is there a way to fix that ? Also note the syntax with which nsexec worked. There are no double quotes around the variable.<br><br>ExpandEnvStrings $1 "$0"<br>nsExec::Exec '$1 <a href="http://www.oneriot.com/install_failed" target="_blank">http://www.oneriot.com/install_failed</a>'<br><br>If I do the following, nsexec will not work.<br><br>ExpandEnvStrings $1 "$0"<br>nsExec::Exec '"$1" <a href="http://www.oneriot.com/install_failed" target="_blank">http://www.oneriot.com/install_failed</a>'<br><br>why is that so ? that's what the examples say I should be doing, but that doesn't work. Also, why did nsexec work on Vista, but not exec or uac::exec or execshell which worked just as I wanted on XP and win7 ? I could use some learning here.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">demiller9</span><br><span class="post-time small text-muted">25th November 2009 19:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The Exec command fails with the quotes because the reg value already has quotes around it and you end up with two sets of quotes.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">amoneriot</span><br><span class="post-time small text-muted">25th November 2009 19:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks a lot for your help. I think all this time my real issue was that I didn't understand well how variables were supposed to be used. Not that I understand them fully now, but I'm learning a lot. Sorry for getting you thinking about something completely different than where the problem was. Maybe my execshell will now work as I had planned.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">25th November 2009 20:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I just created <a href="http://nsis.sourceforge.net/Open_URL_in_Internet_Explorer_using_COM_automation" target="_blank">http://nsis.sourceforge.net/Open_URL...COM_automation</a> , you could try that for a non hacky solution</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">amoneriot</span><br><span class="post-time small text-muted">8th December 2009 20:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I tried this on Win7 IE8 and it didn't work. I cut-pasted the code there as it is and then tried to call it using uac::execcodesegment but didn't work.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">9th December 2009 15:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><pre>
<code><br>var ie = new ActiveXObject("InternetExplorer.Application");<br>ie.Navigate("http://www.msn.com");<br>ie.visible = true;<br></code>
</pre><br>
      put that in a .js file and execute it with wscript.exe (code taken from <a href="http://msdn.microsoft.com/en-us/library/bb250462%28VS.85%29.aspx" target="_blank">http://msdn.microsoft.com/en-us/libr...8VS.85%29.aspx</a>) If that does not work, blame MS
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">podnuh</span><br>
      <span class="post-time small text-muted">10th December 2009 14:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Presumably your installer is running with elevated privileges (because you are using the UAC plug-in). That means that when you start IE (using the methods you have been describing) it is also running with elevated privileges (because it inherits the privileges of the process that start it). This is something that you probably don't want to do, and which may be contributing to your problems with Vista.<br>
      <br>
      Since you are using the UAC plug-in, you should use the UAC::Exec function to start IE with the same privileges as the user who originally invoked your installer. In order to satisfy yourself that the UAC::Exec function works, as a start I would suggest calling UAC::Exec with exactly the same syntax described in the instructions and with the path for IE hard coded as follows (Notice the use of both single and double quotes in the command):<br>
      <br>
      UAC::Exec '' '" C:\Program Files\Internet Explorer\iexplore.exe "' '' ''<br>
      <br>
      You are correct to dynamically look up the correct path for IE. But your first step should be to verify that the UAC:Exec function works (and it should). After that, you can add additional layers of complexity to find where the breakdown is occurring.<br>
      <br>
      I hope this helps.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>