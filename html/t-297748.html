<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Copying files to the JRE install directory on windows" />

  <title>Copying files to the JRE install directory on windows - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Copying files to the JRE install directory on windows</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=297748">Copying files to the JRE install directory on windows</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">acidjazz</span><br />
      <span class="post-time small text-muted">23rd September 2008 10:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Copying files to the JRE install directory on windows</strong><br />
      Morning!<br />
      <br />
      I have been working on an installer for a java application that a friend of mine wrote which requires some extra files to be copied into the current java install folder (the application makes use of the serial port which requires extra libraries to be installed).<br />
      <br />
      More specifically i would like my application to be installed to C:/program files/my app/application.jar (no problem) and then the extra library files to be copied to<br />
      <br />
      ..\JavaInstallDirectory/MostCurrentVersion/lib/comm.java<br />
      ..\JavaInstallDirectory/MostCurrentVersion/lib/comm.properties.java<br />
      ..\JavaInstallDirectory/MostCurrentVersion/bin/wincom32.dll<br />
      <br />
      on my machine the folder is<br />
      C:\Program Files\Java\jre1.6.0_07<br />
      <br />
      but i know it will differ from machine to machine and user to user.<br />
      <br />
      I did some reading around and found the Slightly Better Java Launcher script on the NSIS wiki (and its variants) and have been trying to use it get the current java install directory and then copy in the files that I want.<br />
      <br />
      The script complies ok but the function call doesn't seem to be working properly or my variable declarations are not right (I inserted a line to show the "found" java path in a msgbox but it comes up blank.<br />
      <br />
      Alas my inexperience of using NSIS has lead me to failure.<br />
      The script file is attached; if I could have a little guidance as to where I am going wrong then I would be most appreciative.<br />
      <br />
      <br />
      Many thanks<br />
      A</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pbingel</span><br />
      <span class="post-time small text-muted">23rd September 2008 14:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Your error is in the label JreFound. Up until then everything is correct and works fine. However you echange $R0 with the top of the stack which is empty. Hence the empty string. I'm not even sure what you are trying to do there. But before that label $R0 is exactly what you want it to be. Read up more on push/pop/exch<br />
      <br />
      This works<br /></p>
      <pre>
<code><br />Function GetJRE<br />;<br />;  Find JRE (javaw.exe)<br />;  1 - in .\jre directory (JRE Installed with application)<br />;  2 - in JAVA_HOME environment variable<br />;  3 - in the registry<br />;  4 - assume javaw.exe in current dir or PATH<br /><br />  ;Push $R0<br />  ;Push $R1<br /><br />  ClearErrors<br />  StrCpy $R0 "$INSTDIR\jre\bin\javaw.exe"<br />  IfFileExists $R0 JreFound<br />  StrCpy $R0 ""<br /><br />  ClearErrors<br />  ReadEnvStr $R0 "JAVA_HOME"<br />  StrCpy $R0 "$R0\bin\javaw.exe"<br />  IfErrors 0 JreFound<br /><br />  ClearErrors<br />  ReadRegStr $R1 HKLM "SOFTWARE\JavaSoft\Java Runtime Environment" "CurrentVersion"<br />  MessageBox MB_OK $R1<br />  ReadRegStr $R0 HKLM "SOFTWARE\JavaSoft\Java Runtime Environment\$R1" "JavaHome"<br />  StrCpy $R0 "$R0\bin\javaw.exe"<br />  <br />  IfErrors 0 JreFound<br />  StrCpy $R0 "javaw.exe"<br /><br /> JreFound:<br />  ;Pop $R1<br />  ;Exch $R0<br />  Push $R0<br />  messageBox MB_OK "$R0"<br />FunctionEnd<br /></code>
</pre><br />
      <br />
      When GetJRE returns and you pop $R0 you get what you expect
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">acidjazz</span><br />
      <span class="post-time small text-muted">23rd September 2008 15:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ah i think I see what has gone wrong here - i'm a design engineer by trade so this programming lark is not in my comfort zone. Thanks for the tip - i found the push pop tutorial on the wiki; i'll give it a proper going over.<br />
      <br />
      Thanks again<br />
      A</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
