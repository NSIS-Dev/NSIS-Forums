<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="File Request Return Value in nsdialogs" />

  <title>File Request Return Value in nsdialogs - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">File Request Return Value in nsdialogs</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=291050">File Request Return Value in nsdialogs</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">canute</span><br />
      <span class="post-time small text-muted">30th April 2008 03:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>File Request Return Value in nsdialogs</strong><br />
      I'm using a custom dialog with nsdialogs to get the user to select a file. Im using a file request text box with a browse button for this. Im also using a variable to hold and remember the state of the text box with the user selects a file using the browse button. My problem occurs when the user cancels browsing for the file instead of selecting it. In this case it's supposed to return a blank value "". But instead it returns a random number sometimes. Here are the relevant parts of the script ...<br />
      <br />
      <br />
      Function InstallSelect<br />
      nsDialogs::Create /NOUNLOAD 1018<br />
      Pop $PathForInstallDialog<br />
      <br />
      ${If} $PathForInstallDialog == error<br />
      MessageBox MB_ICONSTOP|MB_OK "Error drawing dialog. Please try Setup again." /SD IDOK<br />
      Quit<br />
      ${EndIf}<br />
      <br />
      ; Create Controls<br />
      ${NSD_CreateGroupBox} 0 0 100% 100% ""<br />
      Pop $PathForInstallGroupBox<br />
      <br />
      ${NSD_CreateLabel} 10u 17u 280u 24u "Please select the install file, and click next to continue"<br />
      Pop $PathForInstallLabel<br />
      <br />
      ${NSD_CreateFileRequest} 10u 86u 260u 12u $PathForInstallFileRequestState<br />
      Pop $PathForInstallFileRequest<br />
      <br />
      ${NSD_CreateBrowseButton} 275u 86u 15u 12u "..."<br />
      Pop $PathForInstallFileBrowse<br />
      GetFunctionAddress $0 OnBrowseForFile<br />
      nsDialogs::OnClick /NOUNLOAD $PathForInstallFileBrowse $0<br />
      <br />
      nsDialogs::Show ;Display the dialog<br />
      FunctionEnd<br />
      <br />
      <br />
      Function OnBrowseForFile<br />
      <br />
      nsDialogs::SelectFileDialog /NOUNLOAD "open" "" "All files (*.*)|*.*"<br />
      Pop $0<br />
      StrCpy $PathForInstallFileRequestState $0<br />
      ${NSD_SetText} $PathForInstallFileRequest $PathForInstallFileRequestState<br />
      <br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br />
      <span class="post-time small text-muted">30th April 2008 13:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes the problem is that when the file request is canceled nsDialogs doesn't push anything on the stack. The random numbers you get is the next value from the stack (probably a HWND of some control).<br />
      <br />
      You can workaround this problem by using something like this...<br />
      <br />
      Function OnBrowseForFile<br />
      <br />
      ; Push something on the stack.<br />
      Push ?<br />
      nsDialogs::SelectFileDialog /NOUNLOAD "open" "" "All files (*.*)|*.*"<br />
      Pop $0<br />
      ; if "?" is still on the top of the stack file request was canceled and we skip the rest of the code.<br />
      StrCmp $0 ? canceled<br />
      StrCpy $PathForInstallFileRequestState $0<br />
      ${NSD_SetText} $PathForInstallFileRequest $PathForInstallFileRequestState<br />
      ; nsDialogs pushed something on the stack so we still need to pop the "?" of the stack.<br />
      Pop $0<br />
      canceled:<br />
      <br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">canute</span><br />
      <span class="post-time small text-muted">30th April 2008 15:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ah, silly of me not to realize that. Thanks!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">2nd May 2008 00:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That'd be a bug and should be properly reported.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
