<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Need Help on Buttons in custom pages" />

  <title>Need Help on Buttons in custom pages - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Need Help on Buttons in custom pages</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=180643">Need Help on Buttons in custom pages</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">gugo46</span><br />
      <span class="post-time small text-muted">20th May 2004 18:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Need Help on Buttons in custom pages</strong><br />
      Hi all,<br />
      <br />
      I am as new as you can get to NSIS, so excuse my ignorance.<br />
      <br />
      I have created a custom page with a button. I want to call a function when that button is clicked. The function, in turn, will run some commands based on selections made on the custom page.<br />
      <br />
      What works:<br />
      1. got a page with 2 radio buttons, text field and Add button<br />
      2. i read the values of the fields in my custom page function<br />
      <br />
      Need help:<br />
      1. how to call a function from my button, yet remain on the same page<br />
      2. the function being called needs to use values read in the custom page function<br />
      <br />
      Is this possible? and if yes, how would I do it?<br />
      <br />
      Any help is GREATLY appreciated.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">20th May 2004 18:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Use Abort to stay on the current page.<br />
      <br />
      You can store values in variables or on the stack.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">gugo46</span><br />
      <span class="post-time small text-muted">20th May 2004 19:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for a quick response....<br />
      <br />
      But how do I call a function from my button?<br />
      <br />
      I have searched the forum and the docs, all I could find was that I can put a command that can be executed with Exec in the state of the button, and clicking the button will Exec that code.<br />
      <br />
      What I need is to click the button and call a method in my script.<br />
      <br />
      Thanks again.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">20th May 2004 19:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">See the InstallOptions documentation and examples about the NOTIFY flag.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">gugo46</span><br />
      <span class="post-time small text-muted">20th May 2004 19:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Let me check that out....</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">gugo46</span><br />
      <span class="post-time small text-muted">20th May 2004 21:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Great !!!! Thanks, it works, BUT I am encountering another issue: can't get out of the window even if I click close. Here is my code:<br />
      <br />
      Page custom AddUserPage test<br />
      .<br />
      .<br />
      Function AddUserPage ;FunctionName defined with Page command<br />
      !insertmacro MUI_HEADER_TEXT "$(TEXT_IO_TITLE)" "$(TEXT_IO_SUBTITLE)"<br />
      !insertmacro MUI_INSTALLOPTIONS_DISPLAY "sshUser.ini"<br />
      <br />
      !insertmacro MUI_INSTALLOPTIONS_READ $domain_radio "sshUser.ini" "Field 2" "State"<br />
      !insertmacro MUI_INSTALLOPTIONS_READ $local_radio "sshUser.ini" "Field 3" "State"<br />
      !insertmacro MUI_INSTALLOPTIONS_READ $user_text "sshUser.ini" "Field 4" "State"<br />
      <br />
      FunctionEnd<br />
      <br />
      <br />
      Function test<br />
      MessageBox MB_OK "add clicked"<br />
      Abort<br />
      FunctionEnd<br />
      <br />
      I know there has to be a way to close this, my guess would be an error/completion code in the stack?!?! But how would I get it, what do I compare it too? Just need close button to close without calling test again.<br />
      <br />
      Can't thank enough the people responding...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">20th May 2004 22:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You should read the status from the INI file, see docs.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">gugo46</span><br />
      <span class="post-time small text-muted">20th May 2004 22:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I appologize if it sounds like I don't want to do searching myself, its definetly not the case. I just can not find it in docs or the forum post related to my question.<br />
      <br />
      Dear Joost, after reading the forum for about 5 continous hours I see that your contribution to both the forum and development is quite large.<br />
      <br />
      I would greatly appreciate a pointer to an example or maybe the section in the docs (a link) to solve my problem<br />
      <br />
      Again, thanks for taking the time to answer my questions</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">21st May 2004 03:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you put only the <i>Abort</i> command inside a leave_function, you won't ever close the program by normal ways. You have to give it some conditions to don't execute the <i>Abort</i> command. You can use <i>StrCmp</i> for comparing strings.<br />
      <br />
      Ok, this is the first step, now you have to have a string to compare with. This can be:<br />
      <br />
      !insertmacro MUI_INSTALLOPTIONS_READ $0 "sshUser.ini" "Settings" "State"<br />
      <br />
      Where the result will be a control number if you selected one, or an empty string if not.<br />
      <br />
      The result code will be as this below:<br />
      <br /></p>
      <pre>
<code>Function test<br /><br />  !insertmacro MUI_INSTALLOPTIONS_READ $0 "sshUser.ini" "Settings" "State"<br />  StrCmp $0 2 +3<br />  StrCmp $0 3 +2<br />  StrCmp $0 4 0 +2<br />    Abort<br /><br />FunctionEnd</code>
</pre><br />
      <br />
      Try it and say if it worked.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">gugo46</span><br />
      <span class="post-time small text-muted">24th May 2004 17:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi all,<br />
      <br />
      1. Thanks a whole lot for the response. REALLY REALLY appreciate it.<br />
      2. What you are suggesting is very clear to me. Here is my problem:<br />
      I have 3 buttons on the screen, Cancel, Close, Add User (custom page button). Cancel works fine, does what is expected. Add User also behaves normally. Close calls the same method as Add User (I am using notify flag), but in the method I would like to be able to know that the method was called as a result of Close button being clicked not Add User. Is there a way to do that?<br />
      <br />
      So I still have a problem.....<br />
      <br />
      Thanks for your responses.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">24th May 2004 22:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Instead of using <i>!insertmacro MUI_INSTALLOPTIONS_DISPLAY</i> you can use <i>!insertmacro MUI_INSTALLOPTIONS_DISPLAY_RETURN</i> and pop the return value. The value can be one of these:<br />
      <br />
      <i>success</i> - The user has pressed the Next button<br />
      <br />
      <i>back</i> - The user has pressed the Back button<br />
      <br />
      <i>cancel</i> - The user has pressed the Cancel button<br />
      <br />
      <i>error</i> - An error has occurred, the dialog cannot be displayed.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">gugo46</span><br />
      <span class="post-time small text-muted">24th May 2004 22:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for the info, I have tried it with interesting results...still does not work.<br />
      <br />
      How can I attach my file? I appologize in advance for pasting the code...<br />
      <br />
      Please take a look, maybe I am doing something exceptionally stupid.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">gugo46</span><br />
      <span class="post-time small text-muted">24th May 2004 22:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"># NOTE: this .NSI script is designed for NSIS v1.8+<br />
      !define ALL_USERS<br />
      !include MUI.nsh<br />
      <br />
      Name "SSH Users"<br />
      OutFile "configureUsers.exe"<br />
      <br />
      <br />
      InstallDir "C:\CP_WORK\TEST_AREA\test"<br />
      <br />
      LangString TEXT_IO_TITLE ${LANG_ENGLISH} "SSH User configuration"<br />
      LangString TEXT_IO_SUBTITLE ${LANG_ENGLISH} "Configure users"<br />
      <br />
      BrandingText /TRIMRIGHT "SSH User Configurator"<br />
      <br />
      Page custom AddUserPage addUser<br />
      <br />
      # declare variables<br />
      Var domain_radio<br />
      Var local_radio<br />
      Var user_text<br />
      var path_to_ssh<br />
      var clean_path<br />
      <br />
      # begin install settings/section<br />
      Section "install" # (default section)<br />
      SetOutPath "$INSTDIR"<br />
      <br />
      # write out uninstaller<br />
      WriteUninstaller "$INSTDIR\uninst.exe"<br />
      SectionEnd ; end of default section<br />
      <br />
      <br />
      # begin uninstall settings/section<br />
      UninstallText "This will uninstall SiteAlive from your system"<br />
      <br />
      Section Uninstall<br />
      #Set the context to all users<br />
      SetShellVarContext all<br />
      <br />
      SectionEnd # end of uninstall section<br />
      <br />
      # FUNCTIONS<br />
      Function .onInit<br />
      Call findOpenSSHInstallDir<br />
      !insertmacro MUI_INSTALLOPTIONS_EXTRACT "sshUser.ini"<br />
      FunctionEnd<br />
      <br />
      Function AddUserPage ;FunctionName defined with Page command<br />
      <br />
      !insertmacro MUI_HEADER_TEXT "$(TEXT_IO_TITLE)" "$(TEXT_IO_SUBTITLE)"<br />
      !insertmacro MUI_INSTALLOPTIONS_DISPLAY_RETURN "sshUser.ini"<br />
      <br />
      FunctionEnd<br />
      .<br />
      .<br />
      .<br />
      Function addUser ;FunctionName defined with Page command<br />
      Pop $R1<br />
      StrCmp $R1 cancel c1<br />
      StrCmp $R1 success c2<br />
      goto process<br />
      <br />
      c1:<br />
      MessageBox MB_OK "Canceled"<br />
      goto done<br />
      <br />
      c2:<br />
      MessageBox MB_OK "Closed"<br />
      goto done<br />
      <br />
      process:<br />
      !insertmacro MUI_INSTALLOPTIONS_READ $domain_radio "sshUser.ini" "Field 2" "State"<br />
      !insertmacro MUI_INSTALLOPTIONS_READ $local_radio "sshUser.ini" "Field 3" "State"<br />
      !insertmacro MUI_INSTALLOPTIONS_READ $user_text "sshUser.ini" "Field 4" "State"<br />
      <br />
      StrCmp $domain_radio "1" domainuser localuser<br />
      <br />
      domainuser:<br />
      StrLen $4 $user_text<br />
      StrCmp $4 "0" samePage<br />
      Exec '"$clean_path\bin\configDomainUser.bat" $path_to_ssh $user_text'<br />
      MessageBox MB_OK "User Added $clean_path\bin\configDomainUser.bat $\r$\n $path_to_ssh $\r$\n $user_text"<br />
      goto samePage<br />
      <br />
      localuser:<br />
      StrLen $4 $user_text<br />
      StrCmp $4 "0" samePage<br />
      Exec '"$clean_path\bin\configLocalUser.bat" $path_to_ssh $user_text'<br />
      MessageBox MB_OK "User Added $clean_path\bin\configLocalUser.bat $\r$\n $path_to_ssh $\r$\n $user_text"<br />
      goto samePage<br />
      <br />
      samePage:<br />
      Abort<br />
      <br />
      done:<br />
      FunctionEnd<br />
      <br />
      # eof</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">25th May 2004 00:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ahh, so "Close" button is the "Next" button...<br />
      <br />
      Replace <i>(Field number of "Add User" button)</i> as it says.<br />
      <br /></p>
      <pre>
<code>c2:<br />MessageBox MB_OK "Closed"<br />goto done<br /><br />!insertmacro MUI_INSTALLOPTIONS_READ $0 "sshUser.ini" "Settings" "State"<br /><br />StrCmp $0 '(Field number of "Add User" button)' 0 EndAddUser<br /><br />  MessageBox MB_OK '"Add User" button executed!'<br /><br />EndAddUser:<br /><br />process:</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">gugo46</span><br />
      <span class="post-time small text-muted">25th May 2004 01:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">TADA!!!!<br />
      <br />
      Cannot thank you enough!!!!<br />
      <br />
      Worked like a charm. Thanks again deguix and everybody.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
