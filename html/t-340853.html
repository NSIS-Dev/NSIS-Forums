<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Loading dump file to MySQL"><title>Loading dump file to MySQL - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Loading dump file to MySQL</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=340853">Loading dump file to MySQL</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Merlinovich</span><br><span class="post-time small text-muted">18th January 2012 23:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Loading dump file to MySQL</strong><br>I have been going around in circles to get a dump file uploaded in MySQL. I suppose the problem is redirecting or a delimiter problem in the command to run mysql.exe, but all the same I havenÂ´t been able to nail down a solution. Basically all my different tries at calling mysql.exe are commented in this snippet of code:<br></p><blockquote>SETOUTPATH "$PROGRAMFILES\MySQL\MySQL Server 5.1\bin"<br>File "C:\ICIS5\Database\MySQL_Dump\dump.sql"<br>; nsExec::Exec `"$PROGRAMFILES\MySQL\MySQL Server 5.1\bin\mysql.exe" --user=root --password="$rootPassword" -e<br>"LOAD DATA INFILE 'IWIS_CENTRAL_DMS.CSV' INTO TABLE mysql.proc FIELDS TERMINATED BY ';' LINES TERMINATED BY '\r\n' SET db = 'iwis_central_dms';"`<br>;nsExec::Exec `"$PROGRAMFILES\MySQL\MySQL Server 5.1\bin\mysql.exe" --user=root --password="$rootPassword" &lt; "dump.sql" &gt; "$DESKTOP\MySQL.log"`<br>;Pop $0<br>ExpandEnvStrings $0 %COMSPEC%<br>;GetFullPathName /SHORT $1 $PROGRAMFILES\MySQL\MySQL Server 5.1\bin\dump.sql<br>;Exec '"$0" /C "$PROGRAMFILES\MySQL\MySQL Server 5.1\bin\mysql.exe" &lt; $1'<br>ExecWait `"$0" /C "$PROGRAMFILES\MySQL\MySQL Server 5.1\bin\mysql.exe" --user=root --password="$rootPassword" &lt; "dump.sql"`<br>;nsExec::ExecToStack /OEM `"$0" /C "$PROGRAMFILES\MySQL\MySQL Server 5.1\bin\mysql.exe" --user=root --password="$rootPassword" &lt; "dump.sql"`<br>;ExecDos::Exec /DETAILED `"$0" /C "$PROGRAMFILES\MySQL\MySQL Server 5.1\bin\mysql.exe" --user=root --password="$rootPassword" &lt; "dump.sql"`<br>;ExecDos::Exec /DETAILED `"$PROGRAMFILES\MySQL\MySQL Server 5.1\bin\mysql.exe" --user=root --password="$rootPassword" &lt; "dump.sql"`<br>Pop $0<br>${If} $BoolShowInfoMessages == "True"<br>MessageBox MB_OK 'Passing the stored procedures and functions to iwis_central_dms.* with return code (should be zero) {$0}'<br>${EndIf}<br>StrCpy $0 "$INSTDIR\SP_install.log"<br>Push $0<br>Call DumpLog</blockquote>Also I have not been successful in getting the return string from the call, which perhaps could reveal something. The DumpLog routine just returns "O" in the first line and "E" in the second line of SP_install.log, so I cant see either what error the mysql call is returning.<br><br>Could anybody orient me what might be the problem, please?</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Merlinovich</span><br><span class="post-time small text-muted">20th January 2012 00:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think that perhaps my last post was not so easy to comment on.<br><br>I will try to be more concise this time.<br>The following commands work well when opening mysql as a console application:<br>cmd&gt;<br>C:\&gt;cd program files<br>C:\Program Files&gt;cd mysql<br>C:\Program Files\MySQL&gt;cd mysql server 5.1<br>C:\Program Files\MySQL\MySQL Server 5.1&gt;cd bin<br>C:\Program Files\MySQL\MySQL Server 5.1\bin&gt;dir dump.sql<br>Volume in drive C has no label.<br>Volume Serial Number is C023-00CE<br><br>Directory of C:\Program Files\MySQL\MySQL Server 5.1\bin<br><br>2012/01/17 15:04 26,066 dump.sql<br>1 File(s) 26,066 bytes<br>0 Dir(s) 206,608,224,256 bytes free<br><br>C:\Program Files\MySQL\MySQL Server 5.1\bin&gt;mysql --user=root --password="&lt;pass&gt;" &lt; dump.sql<br><br>This command terminates without errors, and the dump is present in the database.<br>However, my attempts to run it in the installer is like this:<br><br></p><pre>
<code>nsExec</code><span style="color: #007700">::</span><span style="color: #0000BB">Exec</span><span style="color: #007700">`</span><span style="color: #0000BB">"$PROGRAMFILES\MySQL\MySQLServer5.1\bin\mysql.exe"--user=root--password="$rootPassword"&lt;dump.sql</span><span style="color: #007700">`
</span>
</pre>This command when running the installer returns $0 as 1, meaning an error. However I don't know what the error is,<br>and I have not been successful in logging this. Of course the whole idea of using nsExec is hiding the console from<br>the user, but I don't know how to get the errors logged so I can see them. Using ExecWait instead of nsExec::Exec a console<br>is opened, but closes immediately, so that is no clue either.<br>Can someone help me?</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">msroboto</span><br><span class="post-time small text-muted">20th January 2012 16:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Just as a test have you hardcoded the password just to see if that works?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Merlinovich</span><br><span class="post-time small text-muted">20th January 2012 16:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi msroboto,<br><br>The password is taken from an input screen where the user types it in. The &lt;pass&gt; just means "the password which I will not reveal to NSIS forum" ;)<br><br>Answering your question, no I hadn't tried to hardcode the password, but on your suggestion I just did, and it didn't work (as I would have expected). The passing of the password from the screen to this area of the program, running mysql commands, had already been confirmed with other calls to mysql that did what they were supposed to.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Merlinovich</span><br><span class="post-time small text-muted">23rd January 2012 02:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Running the command mentioned above with ExecWait as this:<br><br>ExecWait `"$PROGRAMFILES\MySQL\MySQL Server 5.1\bin\mysql.exe" --user=root --password="&lt;pass&gt;" &lt; dump.sql`<br>Pop $0<br>MessageBox MB_OK "Dump file loaded with ExecWait error info {$0}"<br><br>The below is a fraction of the output to the console window, however I wasn't able to capture all the output because of stopping it with the "Pause" key, and the window disappears immediately when stopping execution:<br><br>C:\Program Files\MySQL\MySQL Server 5.1\bin\mysql.exe Ver 14.14 Distrib 5.1.45,<br>for Win32 (ia32)<br>Copyright 2000-2008 MySQL AB, 2008 Sun Microsystems, Inc.<br>This software comes with ABSOLUTELY NO WARRANTY. This is free software,<br>and you are welcome to modify and redistribute it under the GPL license<br>Usage: C:\Program Files\MySQL\MySQL Server 5.1\bin\mysql.exe [OPTIONS] [database<br>]<br>-?, --help Display this help and exit.<br>-I, --help Synonym for -?<br>--auto-rehash Enable automatic rehashing. One doesn't need to use<br>'rehash' to get table and field completion, but startup<br>and reconnecting may take a longer time. Disable with<br>--disable-auto-rehash.<br>etc.<br><br>That the options are displayed perhaps does indicate that mysql.exe does not understand one of the parameters.<br><br>Any help on to how I can get the full output logged from the console command mysql.exe would be greatly appreciated. Someone must have had the same problem as me, to not know what errors a console application was reporting?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">demiller9</span><br><span class="post-time small text-muted">23rd January 2012 05:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You could try nsExec::ExecToLog or nsExec::ExecToStack. ExecToLog will put the output into the installer log window, ExecToStack puts each line of output onto the stack for you to pop and process one by one.<br><br>I suspect your problem is the input redirection "&lt; dump.sql". You should execute a command shell (cmd.exe, but don't hardcode that, use the environment variable %COMSPEC%)</p><blockquote>ReadEnvStr $0 COMSPEC<br>ExecWait '"$0" /c "$PROGRAMFILES\MySQL\MySQL Server 5.1\bin\mysql.exe" --user=root --password="&lt;pass&gt;" &lt; dump.sql'</blockquote></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Merlinovich</span><br><span class="post-time small text-muted">23rd January 2012 08:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks demiller9<br><br>I reckon you are right that it is the redirection &lt;dump.sql that is the problem, since other similar calls to mysql.exe have worked. The suggestion you gave however, did not solve the problem.<br><br>The following commands<br><br>ReadEnvStr $0 COMSPEC<br>ExecWait '"$0" /c "$PROGRAMFILES\MySQL\MySQL Server 5.1\bin\mysql.exe" --user=root --password="&lt;pass&gt;" &lt; dump.sql'<br>Pop $0<br>MessageBox MB_OK "Dump file loaded with ExecWait error info {$0}"<br><br>... reveals that reading the environment string returned $0 as C:\windows\system32\cmd.exe which is hardly a surprise. But not getting closer to a solution.<br><br>I have tried different things with dump.sql, for instance it was a longer file name, and I shortened it to below 8.3 standard. I also experimented with full path inlcuded, or " " delimiters etc. All to no avail. The real solution would probably be either to find another way to specify the input file (dump.sql) to mysql, or to get the specific error message from mysql.exe.<br><br>Instead I tried nsExec::ExecToLog and now realize that the output does go to the installer log window, so it is useful. I didn't notice before because in one instance gave only a single error. It then complained about not being able to find a file. Later it said it couldn't find the command "C:\Program" so I tried to get file names with the 8.3 standard. Then I came up with this version:<br><br>ReadEnvStr $0 COMSPEC<br>GetFullPathName /SHORT $1 "$PROGRAMFILES\MySQL\MySQL Server 5.1\bin\mysql.exe"<br>GetFullPathName /SHORT $2 "$PROGRAMFILES\MySQL\MySQL Server 5.1\bin\dump.sql"<br>nsExec::ExecToLog '"$1" --user=root --password="&lt;pass&gt;" &lt; "$2"'<br><br>In this case the mysql.exe is run, but showing all the options. It apparently still does not process the dump.sql file. In the following version where there is no space after "&lt;"<br><br>nsExec::ExecToLog '"$1" --user=root --password="&lt;pass&gt;" &lt;"$2"'<br><br>the output is peculiar:<br><br>Output folder: C:\PROGRA~1\MySQL\MYSQLS~1.1\bin<br>ERROR 1049 (42000): Unknown database '&lt;c:\progra~1\mysql\mysqls~1.1\bin\dump.sql'<br>Completed<br><br>However the database name is already part of the dump.sql file itself, so there should be no need to specify it.<br><br>I'm getting closer, but not quite there.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">demiller9</span><br><span class="post-time small text-muted">23rd January 2012 14:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">What is the current working directory when you run mysql? If you are not specifying a full path for the dump.sql, it may not be able to find it. (Set the cwd with SetOutPath).<br><br>Perhaps the quotes on the executable and the redirected sql file are being mangled by cmd.exe. Try putting "IF 1==1" in front of the executable program name:<br></p><blockquote>ExecWait '"$0" /c IF 1==1 "$ProgramFiles\...\mysql.exe" --blah --blah &lt; "$ProgramFiles\...\dump.sql"'</blockquote>Because the ExecToLog showed the redirection symbol in that error 1049 message, I think it doesn't understand redirection. You might try ExecToLog with the 'cmd.exe /c if 1==1 ' prefix to the mysql.exe.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Merlinovich</span><br><span class="post-time small text-muted">23rd January 2012 21:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks a million, demiller9!<br><br>I would not have coped without you to crunch this hard nut. The redirection and passing of parameter is somewhat an occult magical thing that only goes well if you have experience and luck on your side. Thank you very much for the input. :up: :)<br><br>Paying attention to your comments and also trying to do my own thing, the "final product" looks like this:<br><br></p><blockquote>SETOUTPATH "$PROGRAMFILES\MySQL\MySQL Server 5.1\bin"<br>File "C:\ICIS5\Database\MySQL_Dump\iwis_central_dms_SP_dump_2012-01-17.sql"<br>ExpandEnvStrings $0 %COMSPEC%<br>GetFullPathName /SHORT $1 "$PROGRAMFILES\MySQL\MySQL Server 5.1\bin\mysql.exe"<br>GetFullPathName /SHORT $2 "$PROGRAMFILES\MySQL\MySQL Server 5.1\bin\iwis_central_dms_SP_dump_2012-01-17.sql"<br>nsExec::Exec `"$0" /c IF 1==1 "$1" --user=root --password="$rootPassword" &lt; "$2"`<br>Pop $0<br>${If} $BoolShowInfoMessages == "True"<br>MessageBox MB_OK 'Passing the stored procedures and functions to iwis_central_dms.* with return code (should be zero) {$0}'<br>${EndIf}</blockquote>The $1 and $2 variables contain the full path of mysql.exe and the dump file, but in 8.3 format after getting the short file name. $rootPassword is a declared variable that gets initialized elsewhere from the input screen from the user.<br><br>If anybody is interested in using this solution, let me just give a little more background information. I am using MySQL with MyISAM tables so in a new installation I can copy the tables as any other files without worrying about any stuff in other databases, neither indices etc. that just gets copied along. However, the stored procedures are never stored in the database itself, but in the mysql database. This means that after copying the bulk of data, these must be deployed separately, which is essentially what I'm doing here. I can't distribute the mysql database because the user might have one already, with SPs from other databases, hence this step above that deploys the SPs.<br><br>The dump file is obtained from SQLYog asking for a dump from this specific database of only SPs and functions, and that the database name is put implicit in the dump. The dump file is just text file and can be edited without problems if needed. For instance I changed the username within each SP because that was convenient in my situation (others might have other needs).</div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>