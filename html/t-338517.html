<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Getting to know if a process is running or not using the application name" />

  <title>Getting to know if a process is running or not using the application name - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Getting to know if a process is running or not using the application name</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=338517">Getting to know if a process is running or not using the application name</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">prakashjv</span><br />
      <span class="post-time small text-muted">30th November 2011 14:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Getting to know if a process is running or not using the application name</strong><br />
      &nbsp; Hello,<br />
      <br />
      I have a case where I am running some exe in silent mode so basically I do not have a UI but it will show up under Applications tab in Task manager. Is there a way to know if that process is running or is it completed using this Application name.<br />
      <br />
      I found so many answers reagrding using Process name to check if it is still running or not. But in my case the process name is not unique and I may end up checking any other process with the same name, which is not correct.<br />
      <br />
      I know the application what I will be running, hence wanted to use the same to check if it is running.<br />
      <br />
      P.S: Here application name is nothing but the executable exe name.<br />
      <br />
      How this can be accomplished?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">30th November 2011 15:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Easy solution: Rename your exe to something unique, before you execute it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">30th November 2011 15:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">A unique name is not such an easy thing to create - what if the user runs the setup two times (back to back or simultaneously)?<br />
      <br />
      Maybe prakashjv can get the process id since he says he is running the process. That will be unique, and can be checked later to see if it is still running.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Yathosho</span><br />
      <span class="post-time small text-muted">30th November 2011 15:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by demiller9</small><br />
        A unique name is not such an easy thing to create - what if the user runs the setup two times (back to back or simultaneously)?
      </blockquote>what's wrong with <a href="http://nsis.sf.net/Reference/GetTempFileName" target="_blank">GetTempFileName</a> or even <a href="http://nsis.sourceforge.net/Create_a_GUID,_a_Globally_Unique_Identifier" target="_blank">CreateGUID</a>?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">30th November 2011 16:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Tempfilenames are unique within a particular directory, not necessarily unique on the whole system. Running the installer twice might be done from different directories, and could theoretically result in identical filenames.<br />
      <br />
      GUIDs are system unique, but won't necessarily give a unique process name; on Windows 2000 the process names are 15 characters or shorter. Longer names (like a GUID) are truncated.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Lloigor</span><br />
      <span class="post-time small text-muted">1st December 2011 03:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I made some functions for that..<br />
      <br />
      If the exe in question is made with nsis, you can use the mutex method to prevent multiple instances, by puting this in it:<br /></p>
      <pre>
;; return: 0=succes, 183=failed to create handle (mutex already exists)
<br />!define CreateMutex "!insertmacro _CreateMutex" 
<br />&gt;!macro _CreateMutex _RetVal_ _MutexName_
<br />   System::Call /nounload 'kernel32::CreateMutexA(i 0, i 0, t "${_MutexName_}") ?e'
<br />  Pop ${_RetVal_}
<br />!macroend 
<br />&gt;

</pre>Example:<br />
      <pre>
<code>
OnInit
<br />  ${CreateMutex} $0 "SomeUniqueMutexName"
<br />  IntCmp $0 0 +2
<br />      Quit
<br /><br />&gt;/* some code... */
<br /><br />&gt;FunctionEnd 
<br />&gt;
</code>
</pre><br />
      ...Or, if you execute the exe file from a nsis script, and you need to keep track of it, you can use this:<br />
      <pre>
<code>
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
<br />;; Gets the parent folder
<br />&gt;;; P1 :out: Folder containing file or dir (parent folder)
<br />;;P2 :in:  File/Dir
<br />&gt;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
<br />!</code>define PathPath "!insertmacro _PathPath"
<br />&gt;!macro _PathPath _RetVal_ _Path_
<br />   Push "${_Path_}"
<br />   Call PathPath
<br />   Pop "${_RetVal_}"
<br />&gt;!macroend
<br />&gt;Function PathPath
<br />   Exch$0  ;; Path
<br />   Push$1  ;; Strlen / Counter
<br />   Push$2  ;; Curchar
<br /><br />   StrLen$1 '$0'
<br />  IntCmp $1 0 +6
<br />      IntOp$1 $1 - 1
<br />      StrCpy$2 "$0" 1 $1
<br />      StrCmp "$2" "\" +3
<br />      StrCmp "$2" ":" 0 -4
<br />         IntOp $1 $1 + 1
<br /><br />   StrCpy $0 "$0" $1 0
<br /><br />   Pop $2
<br />   Pop $1
<br />   Exch $0
<br />FunctionEnd
<br /><br />;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
<br />;; Executes files with ShellExecuteEx Api
<br />;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
<br />;; P1 :out: Return value, depends on the mode (P5)
<br />;; P2 :in:  Verb. if="" then open with default associated app 
<br />;; P3 :in:  File
<br />;; P4 :in:  File parameters
<br />;; P5 :in:  Working directory. if="" then its set to the same dir as the file
<br />;; P6 :in:  Show flag. if="" then SH_SHOW is used (see http://msdn.microsoft.com/en-us/library/bb762153(v=VS.85).aspx )
<br />;; P7 :in:  Mode: 1=Nowait, Returns Process Id
<br />;;                2=Nowait, Returns Process Handle (must close the handle yourself)
<br />;;                3=Wait, Returns Process Exit Code
<br />;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
<br />!define ShellExecEx "!insertmacro _ShellExecEx"
<br />!macro _ShellExecEx _RetVal_ _Verb_ _File_ _Params_ _WorkDir_ _Show_ _Mode_  
<br />   Push `${_Mode_}`
<br />   Push `${_Show_}`
<br />   Push `${_WorkDir_}`
<br />   Push `${_Params_}`
<br />   Push `${_File_}`
<br />   Push `${_Verb_}`
<br />   Call ShellExecEx
<br />   Pop ${_RetVal_}
<br />!macroend
<br />Function ShellExecEx
<br />   Exch $0
<br />   Exch
<br />   Exch $1
<br />   Exch 2
<br />   Exch $2
<br />   Exch 3
<br />   Exch $3
<br />   Exch 4
<br />   Exch $4
<br />   Exch 5
<br />   Exch $5
<br />   Push "$9"
<br />   
<br />   StrCmpS "" "$3" 0 wdok
<br />      ${PathPath} $3 "$3"
<br />   wdok:
<br />   StrCmpS "" "$4" 0 +2  ;; if show mode is undefined, then
<br />      StrCpy $4 0x05    ; = SH_SHOW
<br />   System::Call /nounload '*(&amp;i60) i .r9' ;; allocate the structure
<br />   System::Call /nounload '*$9(i 60, i 0x140, i $HWNDPARENT, t r0, t r1, t r2, t r3, i r4) i .r9'  ;; assign the values to the struct
<br />   System::Call /nounload 'Shell32::ShellExecuteEx(i r9) i .r1'  ;; execute the file
<br />   StrCmpS 0 $1 0 +4  ;; if there was errors, then
<br />      StrCpy $3 0  ; set return value to 0 and set the error flag
<br />      SetErrors
<br />      Goto end
<br />      
<br />   System::Call /nounload '*$9(i, i, i, i, i, i, i, i, i, i, i, i, i, i, i .r2)'
<br /><br />   IntCmp $5 2 +4 0 +6  ;; 1:nowait-pid, 2:nowait-handle, 3:wait-exitcode
<br />      System::Call /nounload 'kernel32::GetProcessId(i r2) i .r4'
<br />      System::Call /nounload 'kernel32::CloseHandle(i r2)'
<br />      Goto end
<br />;   hmode:
<br />      StrCpy $4 "$2"
<br />      Goto end
<br />;   wmode:
<br />      System::Call /nounload 'kernel32::WaitForSingleObject(i r2, i -1)'
<br />      System::Call /nounload 'kernel32::GetExitCodeProcess(i r2,*i .r4)'
<br />      System::Call /nounload 'kernel32::CloseHandle(i r2)'
<br /><br />   end:
<br />   System::Free /nounload $9
<br />   Pop $9
<br />   Pop $5
<br />   Pop $0
<br />   Pop $1
<br />   Pop $2
<br />   Pop $3
<br />   Exch $4
<br />FunctionEnd 
<br />&gt;

</pre>and use a macro like this to determine if a specific instance of an executable is still running (with ShellExecEx mode 2):<br />
      <pre>
<code>
still exists
<br />&gt;!define IfProcExistsH "!insertmacro _IfProcExistsH"
<br />&gt;!macro _IfProcExistsH _ProcHandle_ _GotoIfTrue_ _GotoIfFalse_
<br />   Push "$0"
<br />   ClearErrors
<br />   System</code>::Call /nounload 'kernel32::WaitForSingleObject(i ${_ProcHandle_}, i 0) i .r0'
<br />  IntCmp $0 0 +3
<br />      System::Call /nounload 'kernel32::CloseHandle(i ${_ProcHandle_})'
<br />      SetErrors
<br />   Pop$0
<br />   IfErrors${_GotoIfTrue_} ${_GotoIfFalse_}
<br />!macroend 
<br />&gt;

</pre>Example:<br />
      <pre>
<code>
2
<br />loop:
<br />&gt;/* some code here.. */
<br />&gt;${IfProcExistsH} $0 0 +3
<br />   MessageBox MB_OK "The process still exists."
<br />   Goto loop
<br />MessageBox MB_OK "The process doesn't exists anymore!" 
</code>
</pre>And ShellExecEx is usefull for so much more than checking the presence of a process..<br />
      <br />
      Have a good day. ;)
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>