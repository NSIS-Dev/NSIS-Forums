<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Getting to know if a process is running or not using the application name" />

  <title>Getting to know if a process is running or not using the application name - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Getting to know if a process is running or not using the application name</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=338517">Getting to know if a process is running or not using the application name</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">prakashjv</span><br />
      <span class="post-time small text-muted">30th November 2011 14:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Getting to know if a process is running or not using the application name</strong><br />
      Hello,<br />
      <br />
      I have a case where I am running some exe in silent mode so basically I do not have a UI but it will show up under Applications tab in Task manager. Is there a way to know if that process is running or is it completed using this Application name.<br />
      <br />
      I found so many answers reagrding using Process name to check if it is still running or not. But in my case the process name is not unique and I may end up checking any other process with the same name, which is not correct.<br />
      <br />
      I know the application what I will be running, hence wanted to use the same to check if it is running.<br />
      <br />
      P.S: Here application name is nothing but the executable exe name.<br />
      <br />
      How this can be accomplished?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">30th November 2011 15:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Easy solution: Rename your exe to something unique, before you execute it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">30th November 2011 15:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">A unique name is not such an easy thing to create - what if the user runs the setup two times (back to back or simultaneously)?<br />
      <br />
      Maybe prakashjv can get the process id since he says he is running the process. That will be unique, and can be checked later to see if it is still running.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Yathosho</span><br />
      <span class="post-time small text-muted">30th November 2011 15:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by demiller9</small><br />
        A unique name is not such an easy thing to create - what if the user runs the setup two times (back to back or simultaneously)?
      </blockquote>what's wrong with <a href="http://nsis.sf.net/Reference/GetTempFileName" target="_blank">GetTempFileName</a> or even <a href="http://nsis.sourceforge.net/Create_a_GUID,_a_Globally_Unique_Identifier" target="_blank">CreateGUID</a>?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">30th November 2011 16:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Tempfilenames are unique within a particular directory, not necessarily unique on the whole system. Running the installer twice might be done from different directories, and could theoretically result in identical filenames.<br />
      <br />
      GUIDs are system unique, but won't necessarily give a unique process name; on Windows 2000 the process names are 15 characters or shorter. Longer names (like a GUID) are truncated.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Lloigor</span><br />
      <span class="post-time small text-muted">1st December 2011 03:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I made some functions for that..<br />
      <br />
      If the exe in question is made with nsis, you can use the mutex method to prevent multiple instances, by puting this in it:<br /></p>
      <pre>
<span style="color: #007700">;;return:</span><span style="color: #0000BB">0</span><span style="color: #007700">=</span><span style="color: #0000BB">succes</span><span style="color: #007700">,</span><span style="color: #0000BB">183</span><span style="color: #007700">=</span><span style="color: #0000BB">failedtocreatehandle</span><span style="color: #007700">(</span><span style="color: #0000BB">mutexalreadyexists</span><span style="color: #007700">)
<br />!</span><span style="color: #0000BB">defineCreateMutex</span><span style="color: #DD0000">"!insertmacro_CreateMutex"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macro_CreateMutex_RetVal__MutexName_
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #007700">/</span><span style="color: #0000BB">nounload</span><span style="color: #DD0000">'kernel32::CreateMutexA(i0,i0,t"${_MutexName_}")?e'
<br /></span><span style="color: #0000BB">Pop</span><span style="color: #007700">${</span><span style="color: #0000BB">_RetVal_</span><span style="color: #007700">}
<br />!</span><span style="color: #0000BB">macroend
<br /></span>

<!-- php buffer end -->
                
                
                
</pre>
      <hr />
      <pre>
        
Example:<br />        PHP Code:
        
                
</pre>
      <hr />
      <pre>
                <code style="white-space:nowrap">
                
                        <!-- php buffer start --></code><span style="color: #000000">
<span style="color: #007700">Function.</span><span style="color: #0000BB">OnInit
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">CreateMutex</span><span style="color: #007700">}$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"SomeUniqueMutexName"
<br /></span><span style="color: #0000BB">IntCmp</span><span style="color: #007700">$</span><span style="color: #0000BB">00</span><span style="color: #007700">+</span><span style="color: #0000BB">2
<br />Quit
<br /><br /></span><span style="color: #FF8000">/*somecode...*/
<br /><br /></span><span style="color: #0000BB">FunctionEnd
<br /></span>
</span>
<!-- php buffer end -->
                
                
                
</pre>
      <hr />
      <pre>
        
<br />...Or, if you execute the exe file from a nsis script, and you need to keep track of it, you can use this:<br />        PHP Code:
        
                
</pre>
      <hr />
      <pre>
                <code style="white-space:nowrap">
                
                        <!-- php buffer start --></code><span style="color: #000000">
<span style="color: #007700">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
<br />;;</span><span style="color: #0000BB">Getstheparentfolder
<br /></span><span style="color: #007700">;;</span><span style="color: #0000BB">P1</span><span style="color: #007700">:</span><span style="color: #0000BB">out</span><span style="color: #007700">:</span><span style="color: #0000BB">Foldercontainingfile</span><span style="color: #007700">or</span><span style="color: #0000BB">dir</span><span style="color: #007700">(</span><span style="color: #0000BB">parentfolder</span><span style="color: #007700">)
<br />;;</span><span style="color: #0000BB">P2</span><span style="color: #007700">:</span><span style="color: #0000BB">in</span><span style="color: #007700">:</span><span style="color: #0000BB">File</span><span style="color: #007700">/</span><span style="color: #0000BB">Dir
<br /></span><span style="color: #007700">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
<br />!</span><span style="color: #0000BB">definePathPath</span><span style="color: #DD0000">"!insertmacro_PathPath"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macro_PathPath_RetVal__Path_
<br />Push</span><span style="color: #DD0000">"${_Path_}"
<br /></span><span style="color: #0000BB">CallPathPath
<br />Pop</span><span style="color: #DD0000">"${_RetVal_}"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroend
<br /></span><span style="color: #007700">Function</span><span style="color: #0000BB">PathPath
<br />Exch</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">;;</span><span style="color: #0000BB">Path
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">1</span><span style="color: #007700">;;</span><span style="color: #0000BB">Strlen</span><span style="color: #007700">/</span><span style="color: #0000BB">Counter
<br />Push</span><span style="color: #007700">$</span><span style="color: #0000BB">2</span><span style="color: #007700">;;</span><span style="color: #0000BB">Curchar
<br /><br />StrLen</span><span style="color: #007700">$</span><span style="color: #0000BB">1</span><span style="color: #DD0000">'$0'
<br /></span><span style="color: #0000BB">IntCmp</span><span style="color: #007700">$</span><span style="color: #0000BB">10</span><span style="color: #007700">+</span><span style="color: #0000BB">6
<br />IntOp</span><span style="color: #007700">$</span><span style="color: #0000BB">1</span><span style="color: #007700">$</span><span style="color: #0000BB">1</span><span style="color: #007700">-</span><span style="color: #0000BB">1
<br />StrCpy</span><span style="color: #007700">$</span><span style="color: #0000BB">2</span><span style="color: #DD0000">"$0"</span><span style="color: #0000BB">1</span><span style="color: #007700">$</span><span style="color: #0000BB">1
<br />StrCmp</span><span style="color: #DD0000">"$2""\"+3
<br />StrCmp"</span><span style="color: #007700">$</span><span style="color: #0000BB">2</span><span style="color: #DD0000">""</span><span style="color: #007700">:</span><span style="color: #DD0000">"0-4
<br />IntOp$1$1+1
<br /><br />StrCpy$0"</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"$10
<br /><br />Pop$2
<br />Pop$1
<br />Exch$0
<br />FunctionEnd
<br /><br />;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
<br />;;ExecutesfileswithShellExecuteExApi
<br />;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
<br />;;P1:out:Returnvalue,dependsonthemode(P5)
<br />;;P2:in:Verb.if=""thenopenwithdefaultassociatedapp
<br />;;P3:in:File
<br />;;P4:in:Fileparameters
<br />;;P5:in:Workingdirectory.if=""thenitssettothesamedirasthefile
<br />;;P6:in:Showflag.if=""thenSH_SHOWisused(seehttp://msdn.microsoft.com/en-us/library/bb762153(v=VS.85).aspx)
<br />;;P7:in:Mode:1=Nowait,ReturnsProcessId
<br />;;2=Nowait,ReturnsProcessHandle(mustclosethehandleyourself)
<br />;;3=Wait,ReturnsProcessExitCode
<br />;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
<br />!defineShellExecEx"</span><span style="color: #007700">!</span><span style="color: #0000BB">insertmacro_ShellExecEx</span><span style="color: #DD0000">"
<br />!macro_ShellExecEx_RetVal__Verb__File__Params__WorkDir__Show__Mode_
<br />Push`${_Mode_}`
<br />Push`${_Show_}`
<br />Push`${_WorkDir_}`
<br />Push`${_Params_}`
<br />Push`${_File_}`
<br />Push`${_Verb_}`
<br />CallShellExecEx
<br />Pop${_RetVal_}
<br />!macroend
<br />FunctionShellExecEx
<br />Exch$0
<br />Exch
<br />Exch$1
<br />Exch2
<br />Exch$2
<br />Exch3
<br />Exch$3
<br />Exch4
<br />Exch$4
<br />Exch5
<br />Exch$5
<br />Push"</span><span style="color: #007700">$</span><span style="color: #0000BB">9</span><span style="color: #DD0000">"
<br /><br />StrCmpS"""</span><span style="color: #007700">$</span><span style="color: #0000BB">3</span><span style="color: #DD0000">"0wdok
<br />${PathPath}$3"</span><span style="color: #007700">$</span><span style="color: #0000BB">3</span><span style="color: #DD0000">"
<br />wdok:
<br />StrCmpS"""</span><span style="color: #007700">$</span><span style="color: #0000BB">4</span><span style="color: #DD0000">"0+2;;ifshowmodeisundefined,then
<br />StrCpy$40x05;=SH_SHOW
<br />System::Call/nounload'*(&amp;i60)i.r9';;allocatethestructure
<br />System::Call/nounload'*$9(i60,i0x140,i$HWNDPARENT,tr0,tr1,tr2,tr3,ir4)i.r9';;assignthevaluestothestruct
<br />System::Call/nounload'Shell32::ShellExecuteEx(ir9)i.r1';;executethefile
<br />StrCmpS0$10+4;;iftherewaserrors,then
<br />StrCpy$30;setreturnvalueto0andsettheerrorflag
<br />SetErrors
<br />Gotoend
<br /><br />System::Call/nounload'*$9(i,i,i,i,i,i,i,i,i,i,i,i,i,i,i.r2)'
<br /><br />IntCmp$52+40+6;;1:nowait-pid,2:nowait-handle,3:wait-exitcode
<br />System::Call/nounload'kernel32::GetProcessId(ir2)i.r4'
<br />System::Call/nounload'kernel32::CloseHandle(ir2)'
<br />Gotoend
<br />;hmode:
<br />StrCpy$4"</span><span style="color: #007700">$</span><span style="color: #0000BB">2</span><span style="color: #DD0000">"
<br />Gotoend
<br />;wmode:
<br />System::Call/nounload'kernel32::WaitForSingleObject(ir2,i-1)'
<br />System::Call/nounload'kernel32::GetExitCodeProcess(ir2,*i.r4)'
<br />System::Call/nounload'kernel32::CloseHandle(ir2)'
<br /><br />end:
<br />System::Free/nounload$9
<br />Pop$9
<br />Pop$5
<br />Pop$0
<br />Pop$1
<br />Pop$2
<br />Pop$3
<br />Exch$4
<br />FunctionEnd
<br /></span>
</span>
<!-- php buffer end -->
                
                
                
</pre>
      <hr />
      <pre>
        
and use a macro like this to determine if a specific instance of an executable is still running (with ShellExecEx mode 2):<br />        PHP Code:
        
                
</pre>
      <hr />
      <pre>
                <code style="white-space:nowrap">
                
                        <!-- php buffer start --></code><span style="color: #000000">
<span style="color: #007700">;;</span><span style="color: #0000BB">Tests</span><span style="color: #007700">if</span><span style="color: #0000BB">aprocess</span><span style="color: #007700">,</span><span style="color: #0000BB">identifiedbyahandle</span><span style="color: #007700">,</span><span style="color: #0000BB">stillexists
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">defineIfProcExistsH</span><span style="color: #DD0000">"!insertmacro_IfProcExistsH"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macro_IfProcExistsH_ProcHandle__GotoIfTrue__GotoIfFalse_
<br />Push</span><span style="color: #DD0000">"$0"
<br /></span><span style="color: #0000BB">ClearErrors
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #007700">/</span><span style="color: #0000BB">nounload</span><span style="color: #DD0000">'kernel32::WaitForSingleObject(i${_ProcHandle_},i0)i.r0'
<br /></span><span style="color: #0000BB">IntCmp</span><span style="color: #007700">$</span><span style="color: #0000BB">00</span><span style="color: #007700">+</span><span style="color: #0000BB">3
<br />System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #007700">/</span><span style="color: #0000BB">nounload</span><span style="color: #DD0000">'kernel32::CloseHandle(i${_ProcHandle_})'
<br /></span><span style="color: #0000BB">SetErrors
<br />Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">0
<br />IfErrors</span><span style="color: #007700">${</span><span style="color: #0000BB">_GotoIfTrue_</span><span style="color: #007700">}${</span><span style="color: #0000BB">_GotoIfFalse_</span><span style="color: #007700">}
<br />!</span><span style="color: #0000BB">macroend
<br /></span>
</span>
<!-- php buffer end -->
                
                
                
</pre>
      <hr />
      <pre>
        
Example:<br />        PHP Code:
        
                
</pre>
      <hr />
      <pre>
                <code style="white-space:nowrap">
                
                        <!-- php buffer start --></code><span style="color: #000000">
<span style="color: #007700">${</span><span style="color: #0000BB">ShellExecEx</span><span style="color: #007700">}$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">'''"$EXEDIR\test2.exe"'''''''</span><span style="color: #0000BB">2
<br />loop</span><span style="color: #007700">:
<br /></span><span style="color: #FF8000">/*somecodehere..*/
<br /></span><span style="color: #007700">${</span><span style="color: #0000BB">IfProcExistsH</span><span style="color: #007700">}$</span><span style="color: #0000BB">00</span><span style="color: #007700">+</span><span style="color: #0000BB">3
<br />MessageBoxMB_OK</span><span style="color: #DD0000">"Theprocessstillexists."
<br /></span><span style="color: #0000BB">Gotoloop
<br />MessageBoxMB_OK</span><span style="color: #DD0000">"Theprocessdoesn'texistsanymore!"
</span></span>
</pre>And ShellExecEx is usefull for so much more than checking the presence of a process..<br />
      <br />
      Have a good day. ;)
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
