<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="ExecShell with normal rights from within an elevated installer?"><title>ExecShell with normal rights from within an elevated installer? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">ExecShell with normal rights from within an elevated installer?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=294617">ExecShell with normal rights from within an elevated installer?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">psyki</span><br><span class="post-time small text-muted">16th July 2008 15:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>ExecShell with normal rights from within an elevated installer?</strong><br>Hi,<br><br>I have the following problem:<br>My installer needs to run with administrator rights in Vista (elevated) because it needs to write file in the program files directory.<br><br>I did that by adding the following line:<br><br></p><pre>
<code>RequestExecutionLevelhighest
<br></code>


                
                
                
</pre>
      <hr>
      <pre>
        
However.<br>At the end of my installer, I'd like to run an executable as a normal, non-elevated user.<br><br>I start a process as follows:<br><br>        PHP Code:
        
                
</pre>
      <hr>
      <pre>
                <code style="white-space:nowrap">
                
                        </code><span style="color: #000000">
<span style="color: #0000BB">ExecShell</span><span style="color: #DD0000">"""explorer.exe"
</span></span>
</pre>Why do I want this?<br>
      Well.<br>
      If you run explorer in elevated mode, you won't be able to drag and drop files to it from non-elevated explorer windows.<br>
      <br>
      Very annoying.<br>
      <br>
      So, is there a simple way to run a process unelevated from within an elevated installer?
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">psyki</span><br>
      <span class="post-time small text-muted">16th July 2008 16:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hmmmz.<br>
      I suspect I could do this with the UAC plugin, but it seems like a whole workaround for just the one line of code, no?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br>
      <span class="post-time small text-muted">16th July 2008 19:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">yeah, the UAC plugin was created to solve this problem, but it is a pain in the ass to use. Did you try ExecShell "explore" "$instdir" (Should open a new explorer window as non admin, atleast that works on pre Vista)?</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">psyki</span><br>
      <span class="post-time small text-muted">17th July 2008 08:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The code I put above, was an example.<br>
      <br>
      I don't want to open explorer.<br>
      I want to open my own application (and that one needs to open explorer, which is giving me the dragdrop issues)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">psyki</span><br>
      <span class="post-time small text-muted">17th July 2008 10:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Found a working, easy solution, using a 3d party dll, but hey.<br>
      <br>
      If anyone else should come across this problem:<br>
      <br>
      The 3d party dll, with source and a good explanation can be found here:<br>
      <br>
      <a href="http://www.codeproject.com/KB/vista-security/RunNonElevated.aspx" target="_blank">CodeProject source files</a><br>
      <br>
      Since regular links don't seem to work:<br></p>
      <pre>
<code>http</code><span style="color: #007700">:</span><span style="color: #FF8000">//www.codeproject.com/KB/vista-security/RunNonElevated.aspx
</span>
</pre>In NSIS, it's easy to use as well.<br>
      I've attached a sample NSIS installer, that does nothing but start explorer, non-elevated, from withing an elevated installer.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br>
      <span class="post-time small text-muted">17th July 2008 14:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by psyki</i><br>
        <b><br>
        <a href="http://www.codeproject.com/KB/vista-security/RunNonElevated.aspx" target="_blank">CodeProject source files</a><br></b>
      </blockquote>That dll injects code into another process that MIGHT be there to do its dirty stuff, not exactly clean. The UAC plugin supports elevation on 2000 and later, not just Vista unlike that code
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">psyki</span><br>
      <span class="post-time small text-muted">17th July 2008 15:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">On non-vista machins, it will just do shell execute, as expected.<br>
      <br>
      My only worry with it, is that a servicepack might block it.<br>
      <br>
      And i don't see the UAC plugin as clean either.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br>
      <span class="post-time small text-muted">17th July 2008 20:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by psyki</i><br>
        <b>On non-vista machins, it will just do shell execute, as expected.<br></b>
      </blockquote>How is that as expected, you can run into the same sort of trouble on 2000/XP as with Vista(Not D&amp;D tho, but other issues)<br>
      <br>

      <blockquote>
        <i>Originally posted by psyki</i><br>
        <b><br>
        And i don't see the UAC plugin as clean either.</b>
      </blockquote>No, its not exactly clean, but at least it follows the MS guideline on how to do this with a inner and outer process
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">psyki</span><br>
      <span class="post-time small text-muted">18th July 2008 10:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The only issue I have with the administrator permissions is that explorer doesn't allow me to dragdrop.<br>
      <br>
      And that only happens on Vista.<br>
      So I don't need to catch it specifically for 2000, xp, ...</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br>
      <span class="post-time small text-muted">18th July 2008 11:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">then you are missing the whole point, the problem on older systems (and on vista with non admin elevation with another account) is that any process you start runs as the admin, and not the "logged in" user. Granted, with explorer, this is unlikely since its probably already running (and in the default config) but if its not, or its set up to use one process per cabinet window, explorer will end up running as the wrong user</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script type="text/javascript" src="../js/highlight.pack.js" async>
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>