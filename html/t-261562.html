<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="HELP! Next a most complex control"><title>HELP! Next a most complex control - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">HELP! Next a most complex control</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=261562">HELP! Next a most complex control</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">n_baua</span><br><span class="post-time small text-muted">11th December 2006 14:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>HELP! Next a most complex control</strong><br>Hello,<br><br>I am not sure, weather this is possible,<br>Please see the attached file for custom page.<br><br>I need to check the space availability on the user's PC and want to show the custom page.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">11th December 2006 14:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Assume that you know how to deal with InstallOptions to create custom pages, for this you'd need to implement at least E.1.4 DriveSpace and E.1.5 GetDrives.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">n_baua</span><br><span class="post-time small text-muted">12th December 2006 05:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi Red Wine,<br>I know how to create the custom pages but do not know which control needs to be used with InstallOptions to get the functionality.<br>The control you see in the attached image in first post, is just a Photoshop imagination, I am open to any other control(s) too, but need to show drive space availability to users like most of the popular installers does. (For e.g. Visual Studio 2005)<br><br>We have around 12GB of movies and illustrations to be copied to user's PC.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bholliger</span><br><span class="post-time small text-muted">12th December 2006 06:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi NBaua!<br><br>I think you should have a look at InstallOptionsEx. This plugin offers a ListView control. It might be a solution for you.<br><br><a href="http://nsis.sourceforge.net/InstallOption****plug-in" target="_blank">http://nsis.sourceforge.net/InstallOption****plug-in</a><br><br>Have a nice day!<br><br>Cheers<br><br>Bruno</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">n_baua</span><br><span class="post-time small text-muted">12th December 2006 08:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">thanks bholliger,<br>I will look in to it.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">12th December 2006 10:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I hope the following minimal example would help you begin.<br>You may use the notify flag on the custom page leave function to get the selected drive.<br><br>The script:</p><pre>
<code>outfile 'customtest.exe'<br><br>!define REQUIRED '60000'<br><br>!include 'FileFunc.nsh'<br>!Include 'MUI.nsh'<br><br>!insertmacro GetDrives<br>!insertmacro DriveSpace<br><br>!insertmacro MUI_PAGE_WELCOME<br>page custom CustomCreate<br>!insertmacro MUI_PAGE_INSTFILES<br><br>!insertmacro MUI_LANGUAGE "English"<br><br>Section -<br>#######<br>SectionEnd<br><br>Function CustomCreate<br>   Push $1<br>   InstallOptions::initDialog /NOUNLOAD '$PLUGINSDIR\custom.ini'<br>   Pop $1<br>   ReadINIStr $2 "$PLUGINSDIR\custom.ini" "Field 1" "HWND"<br>   SetCtlColors $2 0x0000FF 0xFFFFFF<br>   CreateFont $3 "Tahoma" 7 800<br>   SendMessage $2 ${WM_SETFONT} $3 0<br>   InstallOptions::show<br>   Pop $1<br>FunctionEnd <br><br>Function GetDrivesCallBack<br>   ${DriveSpace} "$9" "/D=F /S=M" $R0<br>   StrCpy $9 $9 1<br>   IntCmp '$R0' '${REQUIRED}' +4 +4 0<br>   StrCmp '$R2' 'state_ok' +3<br>   WriteIniStr '$PLUGINSDIR\custom.ini' 'Field 1' 'State' 'Drive:  $9     \<br>   Required Space =  ${REQUIRED} Mbytes      Free Space =  $R0 Mbytes'<br>   StrCpy '$R2' 'state_ok'<br>   ReadIniStr '$R1' '$PLUGINSDIR\custom.ini' 'Field 1' 'ListItems'<br>   StrCmp '$R1' '' 0 addlist<br>   WriteIniStr '$PLUGINSDIR\custom.ini' 'Field 1' 'ListItems' 'Drive:  $9     \<br>   Required Space =  ${REQUIRED} Mbytes      Free Space =  $R0 Mbytes'<br>   goto end<br>  addlist:<br>   WriteIniStr '$PLUGINSDIR\custom.ini' 'Field 1' 'ListItems' '$R1|Drive:  $9     \<br>   Required Space =  ${REQUIRED} Mbytes      Free Space =  $R0 Mbytes'<br>  end:<br>   Push $0<br>FunctionEnd<br><br>Function .onInit<br>   initpluginsdir<br>   file /oname=$PLUGINSDIR\custom.ini custom.ini<br>   ${GetDrives} "HDD" GetDrivesCallBack<br>FunctionEnd</code>
</pre><br>
      The custom.ini
      <pre>
<code>[Settings]<br>NumFields=1<br><br>[Field 1]<br>Type=Listbox<br>State=<br>Left=12<br>Right=-11<br>Top=12<br>Bottom=36<br>Flags=</code>
</pre><br>
      <br>
      EDIT:<br>
      Added a defined required space and control colors.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">n_baua</span><br>
      <span class="post-time small text-muted">13th December 2006 03:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello Red Wine,<br>
      <br>
      Thanks a lot for such a gr8 HEADSTART for me.<br>
      I was looking almost this.<br>
      Thanks a milllllllllion.<br>
      :up:</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br>
      <span class="post-time small text-muted">13th December 2006 09:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You welcome :-)</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>