<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Can NSISdl read from www page?" />

  <title>Can NSISdl read from www page? - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Can NSISdl read from www page?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=170638">Can NSISdl read from www page?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">janedoe2003</span><br />
      <span class="post-time small text-muted">23rd February 2004 19:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Can NSISdl read from www page?</strong><br />
      Hi,<br />
      <br />
      I'm back at trying to use NSIS to build an over-the-web installer after spending some time building full EXE's. It doesn't look like NSISdl is able to just download the contents of a web page into a file eg.:<br />
      <br />
      1. PHP script over on the www server<br />
      &lt;?php<br />
      //GET /check.php HTTP/1.0<br />
      echo "myapp.exe\t1.0.0.0";<br />
      ?&gt;<br />
      <br />
      2. NSIS installer<br />
      Section ""<br />
      Call ConnectInternet<br />
      <br />
      StrCpy $2 "$INSTDIR\check.txt"<br />
      NSISdl::download <a href="http://srv/check.php" target="_blank">http://srv/check.php</a> $2<br />
      Pop $R0<br />
      #"Server did not specify content length"<br />
      MessageBox MB_OK|MB_ICONSTOP $R0<br />
      SectionEnd<br />
      <br />
      Besides creating a file on the www server (eg. list.ini), is there a way?<br />
      <br />
      Thank you<br />
      JD.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">23rd February 2004 20:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you have a dynamic page you should send the content length header.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">janedoe2003</span><br />
      <span class="post-time small text-muted">23rd February 2004 20:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thx Joost :-) This is the first time I'm sending raw data. Do you know what I'm doing wrong?<br />
      <br />
      &lt;?php<br />
      echo "Content-type: text/plain\r\n";<br />
      echo "Content-length: 17\r\n\r\n";<br />
      echo "myapp.exe\t1.0.0.0";<br />
      ?&gt;<br />
      <br />
      Thx<br />
      JD.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">janedoe2003</span><br />
      <span class="post-time small text-muted">23rd February 2004 21:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ha! :-)<br />
      <br />
      &lt;?php<br />
      ob_start();<br />
      header('Content-Type: text/plain');<br />
      ?&gt;<br />
      &lt;html&gt;<br />
      &lt;head&gt;<br />
      &lt;/head&gt;<br />
      &lt;body&gt;<br />
      <br />
      &lt;?php<br />
      $dir = opendir(".");<br />
      <br />
      while ($item = readdir($dir)) {<br />
      if(strstr($item,".exe")) {<br />
      print "$item\n";<br />
      }<br />
      }<br />
      ?&gt;<br />
      <br />
      &lt;/body&gt;<br />
      &lt;/html&gt;<br />
      &lt;?php<br />
      header('Content-Length: ' . ob_get_length());<br />
      ob_end_flush();<br />
      ?&gt;</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">janedoe2003</span><br />
      <span class="post-time small text-muted">24th February 2004 08:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">For those interested, this is how you can generate an INI file dynamically, listing all the binary files in the current directory.<br />
      <br />
      Since I haven't found whether PHP supports the PE file format (maybe through the Win32 package, but no idea if available in the Unix port of the language), the version number for each file is currently forced to 1.0.0.0. The output will look like a standard INI file, eg.<br />
      <br />
      [myapp]<br />
      myfile.exe=1.0.0.0<br />
      myocx.ocx=1.0.0.0<br />
      <br />
      You can then download this file from an NSIS EXE, and access it using the ReadINIStr() function.<br />
      <br />
      =&gt; Does someone know of to go about, and build a hashed table in NSIS, inserting all the key/value tuples from a section?<br />
      I need to do this so I can browse through eg. the [myapp] section, checking whether each file is available and in the right version, and download it otherwise.<br />
      <br />
      Hope that helps<br />
      JD.<br />
      <br />
      -----------------<br />
      <br />
      &lt;?php<br />
      ob_start();<br />
      header('Content-Type: text/plain');<br />
      <br />
      print "[myapp]\r\n";<br />
      $dir = opendir(".");<br />
      <br />
      while ($item = readdir($dir)) {<br />
      if (eregi("(.exe|.dll|.ocx)", $item)) {<br />
      print "$item=1.0.0.0\r\n";<br />
      }<br />
      }<br />
      <br />
      header('Content-Length: ' . ob_get_length());<br />
      ob_end_flush();<br />
      ?&gt;</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
