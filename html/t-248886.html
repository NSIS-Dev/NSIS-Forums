<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Device Driver Installation/Uninstallation"><title>Device Driver Installation/Uninstallation - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Device Driver Installation/Uninstallation</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=248886">Device Driver Installation/Uninstallation</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Theresias</span><br><span class="post-time small text-muted">16th June 2006 14:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Device Driver Installation/Uninstallation</strong><br>As described in the topic I need to install and uninstall a device driver with a software package. I did check wiki entries and other forum topics on that but none of these really helped to solve my problem.<br><br>So let's get more detailed...<br><br>We do have a software-first situation, which means the end-user needs to install the software before using the device, the device only works with the software. There are different hardware versions supported by our driver, but this also means more than one pair of VID/PID's. Due to the differences between 32-bit and 64-bit windows versions, we do have seperate drivers, so the installer needs to seperate here. There is no need to support old windows versions, 2000, 2003 and XP are fine, but it would be good to be ready for Vista.<br><br>I am quite familiar with NSIS, using it for quite some time now, but user installing the driver or actually not being ablt to install it cause more support than necessary - so this needs to be solved.<br><br>Looking forward to all your replies, thanks in advance.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">CancerFace</span><br><span class="post-time small text-muted">16th June 2006 15:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Could you provide more info on the driver itself? Do you have just a SYS or DRV file or is there an INF file as well? As for installing the driver, does the end user need to have admin rights?<br><br>The version checking is easy... Check <a href="http://nsis.sourceforge.net/Get_Windows_version" target="_blank">this</a> wiki page out for example.<br>CF<br><br>[Edit] You may also want to check <a href="http://www.microsoft.com/whdc/system/pnppwr/pnp/no_reboot.mspx" target="_blank">this</a> and <a href="http://www.microsoft.com/whdc/driver/install/app_drv.mspx" target="_blank">this</a> pages from MS ...<br>[Edit2] Or just browse <a href="http://www.microsoft.com/whdc/driver/install/default.mspx" target="_blank">this</a> page :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Theresias</span><br><span class="post-time small text-muted">16th June 2006 15:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by CancerFace</i><br><b>Could you provide more info on the driver itself? Do you have just a SYS or DRV file or is there an INF file as well?</b></blockquote>It's a driver consisting of INF and SYS, which is a modfied version of the FTDIChip USB&lt;&gt;RS232 driver.<br><br><blockquote><i>Originally posted by CancerFace</i><br><b>As for installing the driver, does the end user need to have admin rights?</b></blockquote>Should not be necessary.<br><br><blockquote><i>Originally posted by CancerFace</i><br><b>The version checking is easy... Check <a href="http://nsis.sourceforge.net/Get_Windows_version" target="_blank">this</a> wiki page out for example.</b></blockquote>Allready been through this example, problem with this version check is, it doesn't determine if it's a 32-bit or 64-bit operating system - so doesn't help in this case.<br><br><blockquote><i>Originally posted by CancerFace</i><br><b>[Edit] You may also want to check <a href="http://www.microsoft.com/whdc/system/pnppwr/pnp/no_reboot.mspx" target="_blank">this</a> and <a href="http://www.microsoft.com/whdc/driver/install/app_drv.mspx" target="_blank">this</a> pages from MS ...<br>[Edit2] Or just browse <a href="http://www.microsoft.com/whdc/driver/install/default.mspx" target="_blank">this</a> page :)</b></blockquote>Thanks, also been partly through these - my hope is that others already dealt with a similar situation instead of digging through all of this by myself.:(<br><br>I'm currently looking more detailed into the <a href="http://nsis.sourceforge.net/InstDrv_plug-in" target="_blank">InstDrv plug-in</a>, but the 32/64-bit issue is still unsolved.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">CancerFace</span><br><span class="post-time small text-muted">16th June 2006 15:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Check <a href="http://blogs.msdn.com/kstanton/archive/2004/04/20/116923.aspx" target="_blank">this</a> for an easy way to see if you are on a 64bit platform ... (or ask kichik who is probably around today :))<br><br>I was under the impression that if you have an INF/SYS combination then all you have to do in order to install the driver (if the hardware is PnP) is to copy the INF file over to $WINDIR\Inf and the SYS file to $SYSDIR\Drivers ...<br>Uninstalling may be a bit trickier because you would have to check if the SYS file is loaded first and then delete it.<br>I think I have seen something similar, I'll try to find more info.<br>CF</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">CancerFace</span><br><span class="post-time small text-muted">16th June 2006 16:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Are you referring to <a href="http://www.ftdichip.com/FTDrivers.htm" target="_blank">these</a> drivers? If yes, you can download the VCP/D2XX drivers provided on that site and use the DPInst.exe file (it is packed) which takes command line parameters. Invoke it with DPInst.exe /? to get an idea ... It looks like it supports loads of options, including silent install/uninstall of the driver<br><br>CF<br><br>[Edit] ... or get it directly from <a href="http://www.microsoft.com/whdc/driver/install/DPInst.mspx" target="_blank">Microsoft</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Theresias</span><br><span class="post-time small text-muted">16th June 2006 16:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes, these FTDI drivers are the base of the drivers in question, but they have been modified, so just downloading does not work here.<br><br>The way using DPInst is IMHO not suitable. One would need different versions (x86, x64, IA64) for the different processor types, also there are "English" and "all languages/localized" versions available.<br><br>As usual with Microsoft applications, this would blow up our distribution to a size which is not acceptable. Some size examples...<br><br>DPInst.exe (x86, English) = 509 kB<br>DPInst.exe (x64, English) = 826 kB<br>DPInst.exe (IA64, English) = 1391 kB<br><br>So if you have an english only verson you end up with 2726 kB of addtional installer size.<br><br>DPInst.exe (x86, Localized) = 2848 kB<br>DPInst.exe (x64, Localized) = 3165 kB<br>DPInst.exe (IA64, Localized) = 3730 kB<br><br>For a localized (all languages) version you end up with 9743kB of addtional installer size.<br><br>For comparison reasons, our original distribution is below 2MB at the koment, which is still Ok for modem users. So blowing this up to 5 MB or even 12 MB is not acceptable.<br><br>Still, I apreciate your help you did help me quite a lot understanding the processes behind, but there must be a way to have a slim "NSIS" solution for this.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">CancerFace</span><br><span class="post-time small text-muted">16th June 2006 16:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Why would you need localized versions of DPInst.exe? If you plan to have your NSIS installer performing the (un)installation of the driver you can do it without showing a GUI. If you use the /S or /Q switch when you call DPInst then there is no reason to show anything to your user and you end up using just one version. I can see the problem though with the different architectures.<br><br>My suggestion would be to call API functions using the system plugin in order to install/uninstall the driver. Check the source code of the <a href="http://nsis.sourceforge.net/InstDrv_plug-in" target="_blank">InstDrv</a> plugin that you mentioned before for the appropriate API calls and write your code taking into account the different architectures that you are targeting ...<br>CF</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Theresias</span><br><span class="post-time small text-muted">16th June 2006 16:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by CancerFace</i><br><b>Why would you need localized versions of DPInst.exe? If you plan to have your NSIS installer performing the (un)installation of the driver you can do it without showing a GUI. If you use the /S or /Q switch when you call DPInst then there is no reason to show anything to your user and you end up using just one version. I can see the problem though with the different architectures.</b></blockquote>Yep, that way the english files would be enough, still 3 MB more. :down:<br><br><blockquote><i>Originally posted by CancerFace</i><br><b>My suggestion would be to call API functions using the system plugin in order to install/uninstall the driver. Check the source code of the <a href="http://nsis.sourceforge.net/InstDrv_plug-in" target="_blank">InstDrv</a> plugin that you mentioned before for the appropriate API calls and write your code taking into account the different architectures that you are targeting ...</b></blockquote>Yep, that seems to be the way to go - sadly nobody seems to have done something similar yet my hope was to find a ready-to-use solution here. :(</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">CancerFace</span><br><span class="post-time small text-muted">16th June 2006 17:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">... or you could start from the InstDrv plugin and add to it support for the architectures that you are after :)<br>CF</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Theresias</span><br><span class="post-time small text-muted">16th June 2006 17:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by CancerFace</i><br><b>... or you could start from the InstDrv plugin and add to it support for the architectures that you are after :)</b></blockquote>Yup, that's what I had in mind. Question is of course if this is possible without actually destroying the original architecture. We'll see...<br><br>Thanks for your help!</div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>