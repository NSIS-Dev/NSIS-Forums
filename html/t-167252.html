<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="How to write Multiple INI String" />

  <title>How to write Multiple INI String - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">How to write Multiple INI String</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=167252">How to write Multiple INI String</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">playwin</span><br />
      <span class="post-time small text-muted">29th January 2004 23:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>How to write Multiple INI String</strong><br />
      Hello,<br />
      I'm having trouble to write multiple INI Strings in a single INI file and in same INI_SECTION, for examp...<br />
      <br />
      WriteINIStr "$INSTDIR\somename.ini" "MySec" "val1" "data1"<br />
      WriteINIStr "$INSTDIR\somename.ini" "MySec" "val2" "data2"<br />
      ....and so on<br />
      <br />
      In this case only the last line actually copied to the INI file. But I need atleast 6 lines to go there.<br />
      <br />
      I allready tried INIFlush filename between lines, but it's not working.<br />
      <br />
      So if you guys know anything about it, please share...<br />
      Thanks!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rainmanp7</span><br />
      <span class="post-time small text-muted">30th January 2004 01:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Make sure you check the data and Varialbes your sending<br />
      through<br />
      Nsis may pick them up as a Function or Ect ?<br />
      I would check what changed and the data being sent<br />
      That's my best guess.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">playwin</span><br />
      <span class="post-time small text-muted">30th January 2004 08:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry I don't understand what you mean,<br />
      What I intend to know is how I could insert more than one line in a particular INI file in the same INI section:<br />
      For example below is a sample INI file...<br />
      <br />
      [MYSECTION]<br />
      val1=C:\Windows\temp\t.bmp<br />
      val2=C:\Windows\temp\t2.bmp<br />
      <br />
      and so on...<br />
      <br />
      How to create that sort of INI from NSIS.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">30th January 2004 11:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Is it a label? If it is you can use "\r\n" to create a new line. Example:<br />
      <br />
      "Test\r\nTest2"<br />
      <br />
      But just for Install Options INI Files.<br />
      <br />
      Read more the Install Options Readme...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">30th January 2004 14:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The code in the first post should work fine. If it doesn't, attach the entire script so we can take a look and see what's wrong.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">playwin</span><br />
      <span class="post-time small text-muted">30th January 2004 15:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Script is attached.<br />
      <br />
      Goto the end of Uninstall Section....<br />
      <br />
      Here is sample of the INI in question:<br />
      <br />
      [Rename]<br />
      NUL=C:\WINDOWS\TEMP\nst4245.TMP\modern-header.bmp<br />
      NUL=C:\WINDOWS\TEMP\NST4245.TMP<br />
      <br />
      ---As you see there is only 2 lines, but it should have 5 lines.<br />
      <br />
      Note: Data would varry on every run...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">30th January 2004 15:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can't assign more than one value to a certain entry in an INI section. If that was possible you couldn't have changed entries.<br />
      <br />
      Use Delete /REBOOTOK.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">playwin</span><br />
      <span class="post-time small text-muted">30th January 2004 15:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ahha! Well I got it.<br />
      <br />
      But delete /REBOOTOK won't do here<br />
      If I use that it will delete the file imdt. so user cann't see the FINISH page at all.<br />
      <br />
      OHHH! this is getting into my previous post....(BUG $PLUGINS FOLDER)<br />
      Well now the only way to solve both problem is,,,,<br />
      <br />
      IS THERE ANY WAY TO REMOVE CERTAIN FILES/DIRS AFTER REBOOT?<br />
      NSIS WILL NEVER ATTEPT DELETE THOSE IN CURRENT RUN. BUT ONLY AFTER REBOOT!!?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">30th January 2004 15:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Lose the caps, no need to shout.<br />
      <br />
      You can lock the file manually so Delete won't be able to delete and will therefore use delete on reboot. To lock a file, simply open it using FileOpen. Don't forget to close it using FileClose after you don't need it locked.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">playwin</span><br />
      <span class="post-time small text-muted">30th January 2004 15:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Allright then there is a way!<br />
      <br />
      Okay, one request, as you allready downloaded my script,<br />
      so if you please modify the script to avail this functonality and attach it back, I'll be verry verry grateful.<br />
      <br />
      PLEASE!<br />
      <br />
      If that not possible, then , a short sample perhaps...<br />
      Don't deny this....<br />
      <br />
      please please....</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">30th January 2004 15:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Too busy.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">playwin</span><br />
      <span class="post-time small text-muted">30th January 2004 15:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hey Come on<br />
      Don't do this to me...<br />
      <br />
      Okay, tell you what take your time, I'm in no hurry.<br />
      So when you are free please do this small work for me and mail it to me at <a href="mailto:auddy@gawab.com">auddy@gawab.com</a> or <a href="mailto:dipak@myrealbox.com">dipak@myrealbox.com</a><br />
      <br />
      Okay! I hope this suits you...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">30th January 2004 16:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You are not paying anything for this service. It's doesn't work like "this is my script" and "please add 1 and 2 and 3".<br />
      <br />
      We have explained you how you get the things you want.<br />
      <br />
      Now you should read the manual and integrate this in your script.<br />
      <br />
      If you have written the code and still have problems, we will be happy to give you some advice.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rainmanp7</span><br />
      <span class="post-time small text-muted">30th January 2004 19:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here is a Example that I use for my ini file<br />
      at Install time and I can do it at uninstall time<br />
      <br />
      ; this writes a new section and creates a cetion under it<br />
      WriteINIStr $WINDIR\my.ini Blip "#Cracker" "$INSTDIR\fido\language$\r$\n"<br />
      <br />
      ;This takes the same section and writes 6 Difern't Entries in Same section<br />
      ;By adding the $\r$\n at the End it Writes the LINE ! :)<br />
      ;without the line your would editing the entrie that was already there in the ini section.<br />
      <br />
      WriteINIStr "$WINDIR\my.ini Blip "#Cracker" "Flipper1$\r$\n"<br />
      WriteINIStr "$WINDIR\my.ini Blip "#Cracker" "Flipper2$\r$\n"<br />
      WriteINIStr "$WINDIR\my.ini Blip "#Cracker" "Flipper3$\r$\n"<br />
      WriteINIStr "$WINDIR\my.ini Blip "#Cracker" "Flipper4$\r$\n"<br />
      WriteINIStr "$WINDIR\my.ini Blip "#Cracker" "Flipper5$\r$\n"<br />
      WriteINIStr "$WINDIR\my.ini Blip "#Cracker" "Flipper6$\r$\n"<br />
      <br />
      From what I have noticed is without the $\r$\n<br />
      it rewrites the same lines but with it will modify the current line being targeted ,or create a new line with the $\r$\n if the line isn't already there if ya know what I mean.<br />
      <br />
      I hope this helps :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">playwin</span><br />
      <span class="post-time small text-muted">30th January 2004 21:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you rainmanp7, I don't yet test your code but i will now.<br />
      <br />
      And to Kichik and Joost, you guys are absolutely right.<br />
      I'm verry sorry for my behaviour.<br />
      <br />
      However, acording to Kichik's suggestion I studied the manual again, and tried to write my own version(FileOpen)<br />
      ,but it's not working again...<br />
      The revised script I'll about to attach, But in short this is happenning...<br />
      <br />
      If I use FileOpen with append access the fies removed instantly, same, user cann't see the FinishPage.<br />
      <br />
      If I use FileOpen with read only access user cann't see the FinishPage. Surprisngly after the (Un)InstallPage the WelcomePage(un) pops-up with a close button.<br />
      <br />
      I have no idea what is going on</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">playwin</span><br />
      <span class="post-time small text-muted">30th January 2004 21:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The revised script...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">30th January 2004 21:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have no idea why you are trying to find a workaround for the plug-ins folder bug. It has already been fixed in the latest CVS version. You can get the development snapshot for the fix.<br />
      <br />
      If the compilation is a problem, I'll upload a new binary.<br />
      <br />
      The weird behavior is normal, because your are locking files the finish page needs (if you would really want to delete them on reboot, it should be done after the finish page).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">playwin</span><br />
      <span class="post-time small text-muted">30th January 2004 21:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I allready visited NSIS home page to download CVS version.<br />
      But I could not manage how to get it.<br />
      If you just give me a link or expain how to download and install CVS pack.., that will be great.<br />
      <br />
      Please forgive my foolishness, I am just a verry new user for Internet too.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">30th January 2004 22:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Under development snapshot:<br />
      <br />
      <a href="http://nsis.sourceforge.net/development" target="_blank">http://nsis.sourceforge.net/development</a><br />
      <br />
      As for FileOpen and FileClose, you should open the file just before you delete and close it just after you delete it. You don't want to lock it for other things, just the delete line. For example:<br />
      <br />
      FileOpen $0 C:\bla w<br />
      Delete C:\bla<br />
      FileClose $0</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">playwin</span><br />
      <span class="post-time small text-muted">31st January 2004 16:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks to everyone, now it's working.<br />
      <br />
      I'm now using RunOnce(registry), to do the cleanup for me.<br />
      Using INI (which I'm trying so far) is also possible with the FileWrite function.<br />
      <br />
      But, for the both cases, I have to switch-back to zLib comp.<br />
      <br />
      When I tried to use LZMA comp.(it's result in smaller file size, you know..), the TEMP-FILES($PLUGINS) do clear, but an another temp file, yes file not folder, with a name like..nsn????.tmp (84kb) appears in the machine's temp folder.<br />
      <br />
      Verry verry strange!Isn't it?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">mrsdonovan</span><br />
      <span class="post-time small text-muted">27th July 2004 06:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by rainmanp7</i><br />
        ;This takes the same section and writes 6 Difern't Entries in Same section<br />
        ;By adding the $\r$\n at the End it Writes the LINE ! :)<br />
        ;without the line your would editing the entrie that was already there in the ini section.<br />
        <br />
        WriteINIStr "$WINDIR\my.ini Blip "#Cracker" "Flipper1$\r$\n"<br />
        WriteINIStr "$WINDIR\my.ini Blip "#Cracker" "Flipper2$\r$\n"<br />
        WriteINIStr "$WINDIR\my.ini Blip "#Cracker" "Flipper3$\r$\n"
      </blockquote>In the event anyone else finds this thread looking to do something like the above, I figured out another way to do it:<br />
      <br />
      My case is a bit different because the ini file I am editing, UT2004.ini, already has existing "Paths" in the "[Core.System]" section. The problem is that writeINIstr over-writes the first instance of "Paths" repeatly. The fix was to do the following:<br />
      <br />
      <pre>
<code><font size="3"><font color="crimson">  WriteINIStr "$INSTDIR\UT2004.ini" "Core.System" "Paths" "../mymod/*.utx$\r$\nPaths=../mymod/*.uax$\r$\nPaths=../mymod/*.umx$\r$\nPaths=../System/*.u"</font></font></code>
</pre><br />
      <br />
      In other words, it replaces what happens to be the first "Path=../System/*.u" with a bunch of "Paths=../mymod/&lt;etc&gt;" and appends the "System" path back onto the end.<br />
      <br />
      The great thing is that in the uninstaller, you can just pop the top paths off (like a stack) with multiple:<br />
      <pre>
<code><font color="crimson"><font size="3">   DeleteINIStr "$INSTDIR\UT2004.ini" "Core.System" "Paths"</font></font></code>
</pre><br />
      <br />
      Before the install the section looks like:<br />
      <pre>
<code><font size="3"><br />  [Core.System]<br />  blah here<br />  Paths=../System/*.u<br />  Paths=etc<br />  Paths=etc</font></code>
</pre><br />
      <br />
      After the install the section then looks like:<br />
      <pre>
<code><font size="3"><br />  [Core.System]<br />  blah here<br />  Paths=../mymod/etc<br />  Paths=../mymod/etc<br />  Paths=../System/*.u<br />  Paths=etc<br />  Paths=etc</font></code>
</pre><br />
      <br />
      Of course, <b>before you overwrite the first "Paths" you should read it to make sure you are writing the same value back. Also, to do the uninstall right, it should check if the first "Paths" has not been modified and only then delete them.</b>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
