<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="WinVer.nsh - having a problem" />

  <title>WinVer.nsh - having a problem - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">WinVer.nsh - having a problem</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=327778">WinVer.nsh - having a problem</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Ron.Stordahl</span><br />
      <span class="post-time small text-muted">24th February 2011 02:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>WinVer.nsh - having a problem</strong><br />
      WinVer.nsh provides a method to detect the OS Version and take certain actions thus:<br />
      <br />
      ${If} ${AtLeastWinVista}<br />
      --take certain action--<br />
      ${Endif}<br />
      <br />
      The above works nicely. But if I substitute a variable for "AtLeastWinVista" it doesn't work:<br />
      <br />
      Var Min_OS_Ver<br />
      StrCpy $Min_OS_Ver "AtLeastWinVista"<br />
      ${If} ${$Min_OS_Ver}<br />
      --take certain action--<br />
      ${Endif}<br />
      <br />
      Doesn't compile. I am using the OS Version testing at several places in my install source and want to define the test parameter at just one place.<br />
      <br />
      Am I making a mistake or doesn't WinVer.nsh support this?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">msroboto</span><br />
      <span class="post-time small text-muted">24th February 2011 05:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I don't know what you're trying to do.<br />
      I think something like this??<br />
      <br />
      Var Min_OS_Ver<br />
      StrCpy $Min_OS_Ver ${AtLeastWinVista}<br />
      ${If} $Min_OS_Ver<br />
      --take certain action--<br />
      ${Endif}<br />
      <br />
      I'm not even sure if that will work but it might.<br />
      ${AtLeastWinVista} as ${If} are macros I think.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">24th February 2011 06:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Why would you want to use a variable instead of ${AtLeastWinVista}? You can use ${AtLeastWinVista} more than once, you know. Just use it every time you need to know if the OS is Vista or higher.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Ron.Stordahl</span><br />
      <span class="post-time small text-muted">24th February 2011 15:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">MSG: The reason is I like to define all constants wherever possible in one place at the beginning in a group. I believe it is good practice rather than smearing them all around the place. This particular expression occurs in 3 different sections.<br />
      <br />
      msroboto: Ill try what you suggest when I get back.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">24th February 2011 15:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You <b>do not</b> use variables and StrCpy to define constants. Use !define, which will work here.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Ron.Stordahl</span><br />
      <span class="post-time small text-muted">24th February 2011 16:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">msroboto: What you suggested didn't work. The error message was: "_If" required 4 parameter(s), passed 2!<br />
      <br />
      Afro UK: I have tried:<br />
      <br />
      !define Min_OS "AtLeastWinXP"<br />
      ..<br />
      ..<br />
      ${If} ${Min_OS} as well as ${If} ${"Min_OS"} and get exactly the same error.<br />
      <br />
      Of course ${If} ${AtLeastWinXP} works so I know I am using that correctly.<br />
      <br />
      I would like to get this working so that I can define the second parameter once at the beginning of the installer. I use it in several sections including the uninstaller. So it is desirable to define it just once if possible.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jiake</span><br />
      <span class="post-time small text-muted">24th February 2011 16:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Both "${If}" &amp; "${AtLeastWinVista}" are macros, they will be replcce with the pre-defined string when compiling. But the value of $Min_OS_Ver only would be known when running.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">24th February 2011 16:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">!define Min_OS ${AtLeastWinXP}<br />
      ${If} ${Min_OS}<br />
      <br />
      should work.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Ron.Stordahl</span><br />
      <span class="post-time small text-muted">24th February 2011 17:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Stu:<br />
      <br />
      !define Min_OS ${AtLeastWinXP}<br />
      ${If} ${Min_OS}<br />
      <br />
      Worked! Thank you! I will be using AtLeastVista to put user data in $APPDATA as needed for Vista and W7. Up to this point user data has gone in $INSTDIR, too late to change that for XP without causing user confusion.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">24th February 2011 17:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You mean, too late for Win95+IE4 ? ;)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hedrox</span><br />
      <span class="post-time small text-muted">15th January 2013 13:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">can anyone plz help me out, i found WinVer.nsh with windows 8 detection, or at least i think so :)<br />
      <a href="http://nsis.svn.sourceforge.net/viewvc/nsis/NSIS/trunk/Include/WinVer.nsh?revision=6249&amp;view=markup&amp;pathrev=6249" target="_blank">http://nsis.svn.sourceforge.net/view...p&amp;pathrev=6249</a><br />
      but don't know how to use it in my code for example:<br />
      <br />
      !include LogicLib.nsh<br />
      !include UAC.nsh<br />
      !include WinVer.nsh<br />
      <br />
      Function .onInit<br />
      ${WinVerGetMajor} $1<br />
      DetailPrint "Major version = $1"<br />
      ${WinVerGetMinor} $2<br />
      DetailPrint "Minor version = $2"<br />
      ${WinVerGetBuild} $3<br />
      DetailPrint "Build number = $3"<br />
      <br />
      FunctionEnd<br />
      <br />
      This one does not work.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br />
      <span class="post-time small text-muted">15th January 2013 23:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Should work as usual:<br />
      <br /></p>
      <pre>
<code>${If} ${IsNT}<br />    ${If} ${AtLeastWin8}<br />        MessageBox MB_OK "You have Windows 8 or a future version!"<br />    ${EndIf}<br /><br />    ${If} ${IsWin8}<br />        MessageBox MB_OK "Your system is Windows 8!"<br />    ${EndIf}<br /><br />    ${If} ${IsAtMostWin8}<br />        MessageBox MB_OK "You have Windows 8 or an older version!"<br />    ${EndIf}<br />${EndIf}</code>
</pre><br />
      <br />
      And don't let yourself get confused by Microsoft's marketing department!<br />
      The so-called "Windows 8" in fact is Windows NT <b><font color="DarkRed">6.2</font></b>, so that's probably what you get when you read the "raw" version numbers ;)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">15th January 2013 23:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by hedrox</small><br />
        can anyone plz help me out, i found WinVer.nsh with windows 8 detection, or at least i think so :)<br />
        <a href="http://nsis.svn.sourceforge.net/viewvc/nsis/NSIS/trunk/Include/WinVer.nsh?revision=6249&amp;view=markup&amp;pathrev=6249" target="_blank">http://nsis.svn.sourceforge.net/view...p&amp;pathrev=6249</a><br />
        but don't know how to use it in my code for example:
      </blockquote>The .nsh in SVN is not compatible with 2.46 but you can grab the version number from there and modify your local .nsh...
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
