<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="How NSIS handles OS language?"><title>How NSIS handles OS language? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">How NSIS handles OS language?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=244530">How NSIS handles OS language?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">LRaiz</span><br><span class="post-time small text-muted">25th April 2006 01:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>How NSIS handles OS language?</strong><br>Hello,<br><br>I am a NSIS newbie and would like some guidance regarding handling of OS language. My installer is written using MUI and at the moment works only in English. It checks and if necessary installs .NET 2.0 but since I handle only English version of .NET I would like to make sure and abort the installer on in case of non-English OS. Do I need to code this logic by hand (and detect OS Language in .onInit) or NSIS engine would do me a favor and automatically abort installation on non-English OS?<br><br>Thanks</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">25th April 2006 17:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=187878&amp;highlight=get+operating+system+language" target="_blank">http://forums.winamp.com/showthread....ystem+language</a><br>Edit: Ok that is wrong information.<br><br>Use the MoreInfo plugin:<br><a href="http://nsis.sourceforge.net/MoreInfo_plug-in" target="_blank">http://nsis.sourceforge.net/MoreInfo_plug-in</a><br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">LRaiz</span><br><span class="post-time small text-muted">25th April 2006 18:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for the suggestion but I am not sure if MoreInfo::GetOSUserinterfaceLanguage answers my question.<br><br>According to plug-in documentation this function returns GUI Language suitable for NSIS that is determined by the algorithm -<br></p><blockquote>When the installer starts up it goes through these steps to select the interface language:<br><br>1. Get user's default Windows OS GUI language<br>2. Find a perfect match for the langauge<br>3. If there is no perfect match, find a primary language match<br>4. If there is no match, use the first language defined in the script (make sure your first language is a common one like English)<br>5. If the langauge variable $LANGUAGE has changed during .onInit, NSIS goes through steps 2 to 4 again, as in the case of this plugin.<br><br>As you can see the outcome of a chosen language is never un-expected.</blockquote>But in reality I don't want steps 4-5. My installer has only one language - "English", so step 4 will always guarantee that I will get it. However I don't want to install English .NET 2.0 on non-English computer. That would seriously mess up user machine. Is there an easy way to force installer to abort on non-English machine or do I have to implement it from scratch?</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">25th April 2006 21:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><pre>
<code><br> System::Call `kernel32::GetUserDefaultUILanguage() i.s`<br> Pop $R0 # $R0 == 1033<br></code>
</pre><br>
      Either use GetUserDefaultUILanguage (as shown) or GetSystemDefaultUILanguage.<br>
      <br>
      Edit: Note that this function does not exist on Windows 95 or NT. <a href="http://support.microsoft.com/default.aspx?scid=http://support.microsoft.com:80/support/kb/articles/q181/6/04.asp&amp;NoWebContent=1" target="_blank">http://support.microsoft.com/default...NoWebContent=1</a><br>
      <br>
      -Stu
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">LRaiz</span><br>
      <span class="post-time small text-muted">25th April 2006 21:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vpupkin</span><br>
      <span class="post-time small text-muted">15th November 2012 17:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Why don't NSIS use GetSystemDefaultLCID for language selection? Most software does that to detect correct language for systems with English UI and non-English locale. NSIS fails here.<br>
      <br>
      Nevermind, found an easy way to achieve this:<br>
      <br></p>
      <pre>
<code>Function .onInit<br>  ; Language detection<br>  System::Call 'kernel32::GetSystemDefaultLangID() i.a'<br>FunctionEnd</code>
</pre>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>