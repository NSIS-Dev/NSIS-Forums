<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Re: Windows Command Prompt Access from installer script" />

  <title>Re: Windows Command Prompt Access from installer script - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Re: Windows Command Prompt Access from installer script</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=314241">Re: Windows Command Prompt Access from installer script</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpo</span><br />
      <span class="post-time small text-muted">29th October 2009 18:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Re: Windows Command Prompt Access from installer script</strong><br />
      Is it possible to access the windows command prompt from an NSIS installer script file? In my installer script, I'd like to perform the following actions:<br />
      <br />
      1. ping a server X<br />
      1a. if the ping is successful, place the server name X in a registry value<br />
      1b. if the ping is unsuccessful, place the server name Y in a registry value<br />
      <br />
      I know how to write registry values (WriteRegStr). Unfortunately, I don't see how I could access and interpret a Windows command prompt "dialogue". While accessing the command prompt would be more intuitive to me, just being able to ping and interpret the results would be sufficient for my project.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">29th October 2009 20:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ping may be filtered in customer' network. IMHO better way is a short HTTP request. For example requesting HTTP headers only (or some short file from server). NSISdl included to distribution, but <a href="http://nsis.sourceforge.net/Inetc_plug-in" target="_blank">http://nsis.sourceforge.net/Inetc_plug-in</a> has more features.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpo</span><br />
      <span class="post-time small text-muted">29th October 2009 21:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Takhir,<br />
      <br />
      Are you suggesting an FTP request instead of a ping to the desired server? The "server X" is just a file server, so I don't know if it could do web requests, etc.<br />
      <br />
      Assuming that you mean an FTP request, my only concern would be that the installer script would not know the appropriate user name/password to access the server. If the script doesn't know that information, will your suggestion still work?<br />
      <br />
      Thanks again for your help.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">30th October 2009 09:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by jpo</i><br />
        <b>Takhir,<br />
        <br />
        Are you suggesting an FTP request instead of a ping to the desired server? The "server X" is just a file server, so I don't know if it could do web requests, etc.<br />
        <br />
        Assuming that you mean an FTP request, my only concern would be that the installer script would not know the appropriate user name/password to access the server. If the script doesn't know that information, will your suggestion still work?<br />
        <br />
        Thanks again for your help.</b>
      </blockquote>Well you could of course just make a guest account on the FTP server, one without any priviledges so that even if someone hacked the login from your installer it shouldn't cause any problems. Theoretically.<br />
      <br />
      To answer your ping question, take a look at the nsExec plugin (ExecToLog function).
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpo</span><br />
      <span class="post-time small text-muted">30th October 2009 15:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">MSG,<br />
      <br />
      Thanks for the info. Here's what I ended up doing:<br />
      <br />
      Name "Test"<br />
      OutFile "Test.exe"<br />
      <br />
      Section ""<br />
      <br />
      ; returns 1 (error) if ping returned "could not find host" or "request timed out"<br />
      nsExec::ExecToLog 'ping 192.0.0.1 -n 2 -w 200'<br />
      Pop $0 ;return value<br />
      IntCmp $0 0 PingDone<br />
      <br />
      MessageBox MB_OK "Defaulting to external address"<br />
      goto Done<br />
      <br />
      PingDone:<br />
      MessageBox MB_OK "Defaulting to internal address"<br />
      <br />
      <br />
      Done:<br />
      SectionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">30th October 2009 15:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Err... You're supposed to supply a path to write to, when you use the ExecToLog function. Because it, you know, outputs to a log file. If you just want to pop the return value from ping, use nsExec::Exec.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jpo</span><br />
      <span class="post-time small text-muted">30th October 2009 15:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK, thanks for the clarification.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">31st October 2009 07:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">jpo, I had in mind http access. But Inetc supports ftp as well. If login/password is not set in URL, you will get answer from server "530" (Anonymous access not allowed)... Or "550" (File not found). "Connection error" if no access to server. But ftp port may be closed as well.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
