<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Reag Registry and then Execute a file" />

  <title>Reag Registry and then Execute a file - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Reag Registry and then Execute a file</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=253810">Reag Registry and then Execute a file</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">OsmanY22</span><br />
      <span class="post-time small text-muted">22nd August 2006 09:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Reag Registry and then Execute a file</strong><br />
      Hi...<br />
      <br />
      i want to choose to setup java and/or OpenOffice. with "!insertmacro MUI_PAGE_COMPONENTS" i can show the sections.<br />
      <br />
      But i want to read from the registry at first if its allready ,example Java, installed. And when its installen, then continue with the other installation, example OpenOffice.<br />
      But if java is not installed, then make the installation.<br />
      <br />
      Can someone helps me????<br />
      <br />
      This is a shortly version of my installer code:<br />
      <br />
      ;--------------------------------<br />
      ;Include Ultra Modern UI<br />
      <br />
      !include "UMUI.nsh"<br />
      !include "zipdll.nsh"<br />
      <br />
      ;--------------------------------<br />
      ;General<br />
      <br />
      ;Name and File<br />
      Name "mediamid MediaServer"<br />
      OutFile "MediaServer-Setup_OC4J.exe"<br />
      <br />
      ;Default installation folder<br />
      InstallDir "$PROGRAMFILES\mediamid_MediaServer"<br />
      <br />
      XPStyle on<br />
      CRCCheck on<br />
      <br />
      ;--------------------------------<br />
      ;Functions<br />
      <br />
      ;--------------------------------<br />
      ;Interface Settings<br />
      !define MUI_ABORTWARNING<br />
      <br />
      ;--------------------------------<br />
      ;Pages<br />
      !insertmacro MUI_UNPAGE_CONFIRM<br />
      !insertmacro MUI_UNPAGE_COMPONENTS<br />
      !insertmacro MUI_UNPAGE_INSTFILES<br />
      !define MUI_WELCOMEPAGE_TITLE_3LINES<br />
      !define MUI_PAGE_CUSTOMFUNCTION_SHOW WelSetTime<br />
      !insertmacro MUI_PAGE_WELCOME<br />
      !insertmacro MUI_PAGE_LICENSE "license.txt"<br />
      !insertmacro MUI_PAGE_COMPONENTS<br />
      !insertmacro MUI_PAGE_DIRECTORY<br />
      !define MUI_PAGE_CUSTOMFUNCTION_SHOW IFSetTime<br />
      !insertmacro MUI_PAGE_INSTFILES<br />
      !define MUI_PAGE_CUSTOMFUNCTION_SHOW ISSetTime<br />
      !define MUI_PAGE_CUSTOMFUNCTION_PRE SetCheckbox<br />
      !insertmacro MUI_PAGE_FINISH<br />
      !define MUI_PAGE_CUSTOMFUNCTION_SHOW ISSetTime<br />
      !insertmacro UMUI_PAGE_ABORT<br />
      <br />
      ;--------------------<br />
      ;Nach der Installation wird WIndows-Dienst installiert<br />
      Function SetCheckbox<br />
      !define MUI_FINISHPAGE_RUN "$INSTDIR\wrapper\bin\Install_MediaServer.bat"<br />
      !insertmacro MUI_INSTALLOPTIONS_WRITE "ioSpecial.ini" "Field 1" "Type" "Label"<br />
      !insertmacro MUI_INSTALLOPTIONS_WRITE "ioSpecial.ini" "Field 1" "Text" "MediaServer wurde erfolgreich installiert!"<br />
      <br />
      !insertmacro MUI_INSTALLOPTIONS_WRITE "ioSpecial.ini" "Field 2" "Type" "Label"<br />
      !insertmacro MUI_INSTALLOPTIONS_WRITE "ioSpecial.ini" "Field 2" "Text" "Bitte wÃ¤hlen Sie aus, ob MediaServer als Windows-Dienst installiert werden soll."<br />
      ExecWait "$INSTDIR\wrapper\bin\Install_MediaServer.bat"<br />
      MessageBox MB_OK "MediaServer wurde als Windows-Dienst installiert!"<br />
      <br />
      <br />
      FunctionEnd<br />
      <br />
      ;--------------------------------<br />
      ;Ein Button beim license-Page<br />
      LicenseForceSelection radiobuttons<br />
      <br />
      <br />
      ;--------------------------------<br />
      ;Installer Sections<br />
      <br />
      Icon "setup.ico"<br />
      UninstallIcon "uninstall.ico"<br />
      WindowIcon off<br />
      <br />
      <br />
      <br />
      ;Variablendefinition um aus der Registry zu lesen<br />
      Var /GLOBAL OOHOME<br />
      Var /GLOBAL JAVAJDK<br />
      Var /GLOBAL JAVAJRE<br />
      <br />
      ;Pfade aus der Registry herauslesen<br />
      ReadRegStr $OOHOME HKLM "SOFTWARE\OpenOffice.org\OpenOffice.org\2.0\{7C35B9AB-2CE3-4C18-BE7C-5B97EA089EB3}" "INSTALLLOCATION"<br />
      ReadRegStr $JAVAJDK HKLM "SOFTWARE\JavaSoft\Java Development Kit\1.5.0_02" "JavaHome"<br />
      ReadRegStr $JAVAJRE HKLM "SOFTWARE\JavaSoft\Java Runtime Environment\1.5.0_02" "JavaHome"<br />
      # ReadRegStr $WASHOME HKLM '"SOFTWARE\IBM\Application Client for WebSphere Application Server\6.0\FJ2ee\Install"' "InstallLocation"<br />
      <br />
      <br />
      ;--------------------------------<br />
      ;Installer OpenOffice<br />
      Section "OpenOffice" SecOpenOffice<br />
      !insertmacro UMUI_LEFT_SETTIME 9<br />
      SetOverwrite on<br />
      SetOutPath "$INSTDIR"<br />
      File "OOo_2.0.3_Win32Intel_install_de.exe"<br />
      ExecWait '"$INSTDIR\OOo_2.0.3_Win32Intel_install_de.exe" "/Q"'<br />
      Delete "$INSTDIR\OOo_2.0.3_Win32Intel_install_de.exe"<br />
      MessageBox MB_OK "Die Installation von Open Office wurde beendet!"<br />
      Sleep 2000<br />
      goto next<br />
      next:<br />
      <br />
      SectionEnd<br />
      <br />
      ;--------------------------------<br />
      ;Installer Java<br />
      Section "Java 1.5.0_02" SecJava<br />
      !insertmacro UMUI_LEFT_SETTIME 5<br />
      <br />
      SetOverwrite on<br />
      SetOutPath "$INSTDIR"<br />
      <br />
      File "jdk-1_5_0_02-windows-i586-p.exe"<br />
      ExecWait '"$INSTDIR\jdk-1_5_0_02-windows-i586-p.exe" "/Q"'<br />
      Delete "$INSTDIR\jdk-1_5_0_02-windows-i586-p.exe"<br />
      MessageBox MB_OK "Die Installation von Java wurde beendet!"<br />
      Sleep 1000<br />
      goto next2<br />
      next2:<br />
      SectionEnd<br />
      <br />
      <br />
      <br />
      <br />
      ;--------------------------------<br />
      ;Installer MediaServer<br />
      Section "Programmdateien" SecMediaServer<br />
      ;Noch 2 Minuten<br />
      !insertmacro UMUI_LEFT_SETTIME 2<br />
      <br />
      <br />
      ;Muss ausgewÃ¤hlt sein<br />
      SectionIn RO<br />
      <br />
      ;Installation<br />
      SetOverwrite on<br />
      SetOutPath $INSTDIR<br />
      <br />
      File mediaserver.jar<br />
      File ms.properties<br />
      File ms_oc4j.bat<br />
      # File ms_was.bat<br />
      File log4j.xml<br />
      File build.xml<br />
      Sectionend</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">25th August 2006 13:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Put the registry reading code in the section, compare the values to the expected values and jump to the end of the section, if Java shouldn't be installed.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
