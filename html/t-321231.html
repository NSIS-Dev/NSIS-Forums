<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Request execution level at runtime"><title>Request execution level at runtime - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Request execution level at runtime</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=321231">Request execution level at runtime</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">aerDNA</span><br><span class="post-time small text-muted">28th July 2010 20:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Request execution level at runtime</strong><br>The LUA principle enforced by UAC may be fine in theory but in practice it may be difficult to predetermine the set of privileges a program will need because it can depend on specific external factors which can only be detected at runtime. Since a program can only state required privileges passively, through a manifest, it must request admin rights if there's even a single possible scenario in which it might need them. A typical installer will actually need admin rights so this is not a big issue but I tend to create atypical ones. There's the UAC plugin, which is great but not exactly what I needed so I put some code together that allows for the installer to run restricted, examine the target system and then elevate if needed. Elevation is achieved by reexecuting the installer using the runas verb with ShellExecute, which overrides the manifest. This method is also used for limited accounts, in which case it pops up the account selection dialog (RunAs.exe GUI) instead of UAC prompt - same behavior as using RequestExecutionLevel Admin but better because account selection will also be available in XP/2k. We can also deny the possibility to run as a different user if there's a reason for it. Another plus is that it might be considered a nice thing if the installer first explains to the user that it needs admin rights and why, instead of pesky UAC prompt being the first thing he sees.<br>The script may seem more complex than it should be but that's because I tried to cover all the angles; I think I succeeded and it tested ok (xp/win7) but it's possible there are faults in it and/or my reasoning, so feedback is more than welcome.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>