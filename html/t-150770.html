<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Possibility to ignore files within &quot;File /r option&quot;" />

  <title>Possibility to ignore files within "File /r option" - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content=" Possibility to ignore files within &quot;File /r option&quot;" />

  <title>Possibility to ignore files within "File /r option" - NSIS Forums</title>
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" />
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Possibility to ignore files within "File /r option"</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=150770">Possibility to ignore files within "File /r option"</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">28th September 2003 22:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Possibility to ignore files within "File /r option"</strong><br />
      Dear Folks -<br />
      <br />
      is there a way to integrate some directives in the compiler-script to exclude folders and/or files which are in the potential path the compiler integrates files?<br />
      <br />
      The reason is that the application I do is in a CVS. So I don't want to go through the whole structure and delete CVS-directories and included files everytime I actualized the working dir...<br />
      <br />
      Thx Mo</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">29th September 2003 07:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Maybe you can create a batch file that removes the CVS data.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">29th September 2003 07:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">So there isn't one (a solution)?<br />
      <br />
      It's not the problem to delete the directories and included files, but copying the whole CVS everytime again.<br />
      <br />
      I have the (application) structure underneath the NSIS-Directory to be able to work with</p>
      <pre>
<code>FILE</code><span style="color: #007700">/</span><span style="color: #0000BB">r</span><span style="color: #DD0000">"${NSISDIR}\\path\\to\\my\\raw\\applikation..."
</span>
</pre>. So it would be very nice to make CVS/...-dirs "invisible" for the installer. It is anoying to copy the CVS workingdir every time again to ths NSISDIR even for the smallest changes.<br />
      <br />
      The simple deletion is no problem "Search in Explorer; [CTRL]+[A]; [DEL]"<br />
      <br />
      Any further ideas?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">7th October 2003 08:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Isn't there another possibility to exclude directories within the compilerrun? It would't be very comfortable to list everysingle dir but not the ones to be excluded.<br />
      <br />
      Wouldn't this be an feature worth to be integrated, as possible many others could use it to compile there prog out of CVS?<br />
      <br />
      Mo!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">7th October 2003 13:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can have another program create a list of File commands that will exclude CVS directories. You can call this program using !system and then !include its output. This program can even be a simple installer using FindFirst, FindNext and FindClose.<br />
      <br />
      This feature request is already in the feature request list and will hopefully be implemented for version 2.1.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">10th October 2003 14:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">My late answer, sorry :D<br />
      <br />
      Thx for your answer! But I think I do it the oldfashioned way and am going to synchronize manually my CVS-repository. The one downloaded and the one without CVS-dirs (to be compiled) until this version 2.1 is released....<br />
      <br />
      Thx<br />
      Mo</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
      <span class="post-time small text-muted">10th October 2003 22:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am actually working on a program to do this. Anyone interested in helping out feel free to contact me or post a reply here.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Vytautas</span><br />
      <span class="post-time small text-muted">11th October 2003 10:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I would be instrested to help, although I'm not sure of how much help I would be. Assuming you are going to use c/c++ cos I'm only learning those languages. :o<br />
      <br />
      Vytautas</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
      <span class="post-time small text-muted">11th October 2003 22:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yeh I'll be using C/C++, if you have any design thoughts pass them along. Not doing any actual programming just yet.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
      <span class="post-time small text-muted">13th October 2003 01:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Really the biggest question I can think of anyone has any preference for the command line paramters for the program. I'm thinking of something like,<br />
      <br />
      DIRECTORY /r "c:\Program Files\*.*" "Folder1\*.exe,Folder2\*.*"<br />
      <br />
      The first parameter would take the folder to look through, the second would be the list of files/folders to ignore delimited by commas. Wildcards would be allowed for the both the directory to look through of files to install as well as the files/folders to ignore.<br />
      <br />
      In the example above "Folder1" and "Folder2" would be subdirectories under the main inclusion folder of "c:\program files".<br />
      <br />
      There would be an optional command line paramter of "/r" to do a recursive inclusion of files like in the NSIS "File" command.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
      <span class="post-time small text-muted">16th October 2003 22:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've run into a nice problem setting up this program. I can call the program I've made within a script to generate a list of files as follows,<br /></p>
      <pre>
<span style="color: #007700">!</span><span style="color: #0000BB">system</span><span style="color: #DD0000">"FolderList.exe$\"c:\Temp\*.*$\"
<br />$\"*.exe,*.ico$\""
</span>
</pre>In this case all the files within the c:\temp folder would be included except for files with the extension exe and ico.<br />
      <br />
      A text file will be created called "FolderList.txt" containg the file list which I want to include like so<br />
      <pre>
<span style="color: #007700">!include</span><span style="color: #DD0000">"FolderList.txt"
</span>
</pre>Unfortunately by the time this text file is created makensis is already done! So none of the files actually get included in the final executable. Is there any way to get the compiler to wait until this text file is created?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">16th October 2003 23:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It should wait. Is it a normal application? Does ExecWait work if you are calling it from an installer (just to test)?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
      <span class="post-time small text-muted">16th October 2003 23:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes it's a normal console application and yes ExecWait does seem to work when calling it from an installer.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
      <span class="post-time small text-muted">16th October 2003 23:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, my mistake Joost. It is working. I was getting confused because it was taking longer for the file to actually appear within Windows explorer. So with that in mind here is the first version,<br />
      <br />
      The program is called FolderList and used within a script as follows,<br /></p>
      <pre>
<span style="color: #007700">!</span><span style="color: #0000BB">system</span><span style="color: #DD0000">"FolderList.exe$\"c:\Temp\*.*$\"$\"*.exe,*.ico$\""
<br /></span><span style="color: #007700">!include</span><span style="color: #DD0000">"FolderList.exe.txt"
</span>
</pre>Note the quotation marks on the call to "!system" I think this is what messed me up the first few time.<br />
      <br />
      You currently cannot recurse a file structure like you can with the NSIS "File /r" command. I will be adding this soon. Breakdown of the paramters are as follows,<br />
      <br />
      1st paramter - The file/folder of files to include. Wildcards are<br />
      allowed.<br />
      2nd paramter - List of files to exclude from the inclusion list.<br />
      Wildcards are allowed.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
      <span class="post-time small text-muted">17th October 2003 21:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here's an updated version of FolderList. You can now use /r to recurse a folder structure. I have also created two macros which can be used insted of the !system and !include commands.<br /></p>
      <pre>
<span style="color: #007700">!</span><span style="color: #0000BB">macroFOLDER_LISTINCLUDE_DIREXCLUDE_FILES
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">system</span><span style="color: #DD0000">"FolderList.exe$\"${INCLUDE_DIR}$\"$\"${EXCLUDE_FILES}$\""
<br /></span><span style="color: #007700">!include</span><span style="color: #DD0000">"FolderList.exe.txt"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroend
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroFOLDER_LIST_RECURSIVEINCLUDE_DIREXCLUDE_FILES
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">system</span><span style="color: #DD0000">"FolderList.exe/r$\"${INCLUDE_DIR}$\"$\"${EXCLUDE_FILES}$\""
<br /></span><span style="color: #007700">!include</span><span style="color: #DD0000">"FolderList.exe.txt"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">macroend
<br /></span>

<!-- php buffer end -->
                
                
                
</pre>
      <hr />
      <pre>
        
Some example usages are,<br />
        PHP Code:
        
                
</pre>
      <hr />
      <pre>
                <code style="white-space:nowrap">
                
                        <!-- php buffer start --></code><span style="color: #000000">
<span style="color: #007700">!</span><span style="color: #0000BB">insertmacroFOLDER_LIST</span><span style="color: #DD0000">"c:\Temp\*.*""*.exe,*.com"
<br /></span><span style="color: #007700">!</span><span style="color: #0000BB">insertmacroFOLDER_LIST_RECURSIVE</span><span style="color: #DD0000">"c:\Temp\*.*""folder1\*.txt,folder2\*.com"
</span></span>
</pre>The first example I have explained in previous posts. The second example will include all files in c:\Temp and it's subfolders. It will cut out txt files in c:\Temp\folder1 and com files from c:\Temp\folder2<br />
      <br />
      FolderList can be used in replace of any "File" script command.<br />
      <br />
      A note on how files/folders are ignored. If you choose to recurse a file structure the ignore file list must mirror this structure.<br />
      <br />
      If for example Temp has sub directories of folder1, folder2, etc. and I want to ignore all exe files in both folder1 and folder2 I have to do the following,<br />
      <br />
      FolderList.exe /r "c:\Temp\*.*" "folder1\*.exe,folder2\*.exe"<br />
      <br />
      You cannot ignore all exe files in folder1 and folder2 using one command. You currently have to specify them as separate ignore filters.<br />
      <br />
      I am working on a way to get around this now. Vytautas (or anyone else), if you've got any suggestions I could definitely use them now.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
      <span class="post-time small text-muted">17th October 2003 22:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">A note from the previous post, this line,<br /></p>
      <pre>
<span style="color: #007700">!</span><span style="color: #0000BB">insertmacro
<br />FOLDER_LIST_RECURSIVE</span><span style="color: #DD0000">"c:Temp*.*""folder1*.txt,folder2*.com"
</span>
</pre>should be<br />
      <pre>
<code>FOLDER_LIST_RECURSIVE</code><span style="color: #DD0000">"c:Temp*.*""folder1\\*.txt,folder2\\*.com"
</span>
</pre>Forgot to add the backslashes
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">18th October 2003 13:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I think that's because [php ] [/php ] removes them.<br />
      <br /></p>
      <pre>
<code>!insertmacro FOLDER_LIST_RECURSIVE "c:\Temp\*.*" "folder1\*.txt,folder2\*.com"</code>
</pre><br />
      <br />
      -Stu
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">18th October 2003 17:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Dear rsegal -<br />
      <br />
      Thx for your work, I will give it a try, if it fits my needs. You will get the feedback immediatley when integrated and tested...<br />
      <br />
      So long<br />
      <br />
      Chris aka Mo</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
      <span class="post-time small text-muted">19th October 2003 06:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yeh, I noticed that after I posted Afrow. I didn't think the php code tags would take that into account.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">19th October 2003 23:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have a question on the usage:<br />
      <br />
      What exactly does this program? Does it remove the folders, or does it make them "invisible" for the compiler. If so, where do we have to include the lines you've provided with your examples?<br />
      <br />
      As in my case there are about 15-20 sections, so I get a little confused. Is it possible to include it within a section, and again if yes, how is it placed? All these sections include this *funky* CVS-dirs with the normal device-files. They should not exist in the compiled application...<br />
      <br />
      Thx Mo</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Vytautas</span><br />
      <span class="post-time small text-muted">20th October 2003 00:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have noticed that if a subdirectory is empty the compiler generates an error, otherwise its a great program.<br />
      <br />
      Vytautas :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Vytautas</span><br />
      <span class="post-time small text-muted">20th October 2003 01:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">After more testing I found that my previous post was not quite correct. The complier error was generated when it hit the subdirectory name and as it is not a file the error occurs.<br />
      <br />
      Also this program does not seem to take into account the directory structure as it does not modify the $OUTDIR variable thus all of the files are copied into the root directory.<br />
      <br />
      As a sugestion is an inclusion of the posibility to exclude all of thefiles except those that match a certain criteria.</p>
      <pre>
<code>!insertmacro FOLDER_LIST_RECURSIVE "c:\Temp\*.*" "+folder1\*.txt"</code>
</pre>This command would exclude all of the files in folder1 except for those with a '*.txt' extention.<br />
      <br />
      Vytautas<br />
      <br />
      PS. Keep up the good work. :cool:
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
      <span class="post-time small text-muted">20th October 2003 02:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Mosestycoon</i><br />
        <br />
        What exactly does this program? Does it remove the folders, or does it make them "invisible" for the compiler. If so, where do we have to include the lines you've provided with your examples?<br />
        <br />
        As in my case there are about 15-20 sections, so I get a little confused. Is it possible to include it within a section, and again if yes, how is it placed? All these sections include this *funky* CVS-dirs with the normal device-files. They should not exist in the compiled application...
      </blockquote>This program makes the the files/folders that you specify invisible to the compiler. Just take a look at the text file it creates. It's just a bunch of "File" commands. You can include the lines I specified anywhere the "File" command is valid because it's doing the same thing.<br />
      <br />
      I know the CVS dir's your talking about as I've run into the same problem. If you have alot of files/folders to include it will be tedious to ignore each "CVS" named folder within all the folders you are including. This is why I'm working on a way to ignore a file or folder that exists in multiple folders. I mentioned this in a previous post.<br />
      <br />
      To ignore a CVS folder just use<br />
      <pre>
<span style="color: #007700">!</span><span style="color: #0000BB">insertmacroFOLDER_LIST_RECURSIVE</span><span style="color: #DD0000">"c:\\YourFolder\\*.*""CVS\\*.*"
</span>
</pre>This will ignore the folder c:\YourFolder\CVS and all files/folders within it.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
      <span class="post-time small text-muted">20th October 2003 03:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Vytautas</i><br />
        <br />
        After more testing I found that my previous post was not quite correct. The complier error was generated when it hit the subdirectory name and as it is not a file the error occurs.
      </blockquote>That's very bizarre. What is the error you get? Subdirectories should not be a problem at all.<br />

      <blockquote>
        <i>Originally posted by Vytautas</i><br />
        <br />
        Also this program does not seem to take into account the directory structure as it does not modify the $OUTDIR variable thus all of the files are copied into the root directory.
      </blockquote>This is true. The $OUTDIR variable is not modified although this would be the case as well if you were to use the "File" command. It doesn't modify the $OUTDIR variable. My program works the same way. You need to set $OUTDIR before you call my program. I probably should've mentioned that initally, sorry about that.<br />
      <br />

      <blockquote>
        <i>Originally posted by Vytautas</i><br />
        <br />
        As a sugestion is an inclusion of the posibility to exclude all of thefiles except those that match a certain criteria.<br />
        code:<br />
        <br />
        !insertmacro FOLDER_LIST_RECURSIVE "c:\Temp\*.*" "+folder1\*.txt"<br />
        <br />
        This command would exclude all of the files in folder1 except for those with a '*.txt' extention.
      </blockquote>I was thinking of doing what you just said however you could do the same thing in a different way.<br />
      <pre>
<span style="color: #007700">!</span><span style="color: #0000BB">insertmacroFOLDER_LIST_RECURSIVE</span><span style="color: #DD0000">"c:\\Temp\\folder1\\*.txt"
</span>
</pre>Obviously this doesn't include any of the other folders under Temp but it does work. Provided you don't have a large number of folders in the Temp folder that may work for you. Just add the other folders separately. Obviously if it worked the way you're suggesting then all of the other subfolders under "Temp" would work. So there is a benfit to it. I'll put it on my list of features to add.<br />
      <br />
      <pre>
<span style="color: #007700">!</span><span style="color: #0000BB">insertmacroFOLDER_LIST_RECURSIVE</span><span style="color: #DD0000">"c:\\Temp\\*.*""folder1\\*.txt"
</span>
</pre>

      <blockquote>
        <i>Originally posted by Vytautas</i><br />
        <br />
        PS. Keep up the good work.
      </blockquote>Thanks!:)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Vytautas</span><br />
      <span class="post-time small text-muted">20th October 2003 04:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The first error only seems to happen when you compile in Win2k as when I tested with Win98 it worked fine but when I tried to compile the same script in Win2k I got an error that said that the file was not found listing the name of the subdirectory.<br />
      <br />
      The second problem is that if you use a single file command to recurse a directory tree it also recreates the whole tree so that the files in the subfolders on the local machine are placed in the same subdirectories on the target machine. However you program produces a list of file commands that copy files from their subdirectories into the $OUTDIR set by the installer before the call but it does not recreate the directory tree. For example: If you have two directories one containing exe files and another containing help files using your program both the exe and help files would end up in the root directory rather that the 'bin' and 'help' directories.<br />
      <br />
      As for the last suggestion I was thinking of a case where the whole program directory could be recursed but one of several directories only needed to copy one type of file. It would make this sort of senario a lot easier to manage.<br />
      <br />
      Vytautas</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">20th October 2003 21:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        To ignore a CVS folder just use<br />
        <br />
        PHP:<br />
        <br />
        !insertmacro FOLDER_LIST_RECURSIVE "c:\YourFolder\*.*" "CVS\*.*"<br />
        <br />
        <br />
        <br />
        This will ignore the folder c:\YourFolder\CVS and all files/folders within it.
      </blockquote>I gave that a try, but it didn't work for me. I included the following lines:<br />
      <br />
      <pre>
<code>!macro FOLDER_LIST_RECURSIVE INCLUDE_DIR EXCLUDE_FILES<br />  !system "FolderList.exe /r $\"${INCLUDE_DIR} $\" $\"${EXCLUDE_FILES}$\""<br />  !include "FolderList.exe.txt"<br />!macroend<br />!insertmacro FOLDER_LIST_RECURSIVE "${NSISDIR}\FILEDIR\*.*" "CVS\*.*"</code>
</pre><br />
      <br />
      where ${NSISDIR}\ is of course the directory I administer my project in. The following error occurs at MakeNSISW:<br />
      <br />
      <pre>
<code>!insertmacro: FOLDER_LIST_RECURSIVE<br />!system: "FolderList.exe /r "C:\Programme\NSIS\TSW\*.* " "CVS\*.*""<br />!system: returned 0<br />!include: "FolderList.exe.txt"<br />File: "C:\Programme\NSIS\TSW\DATENBANK" -&gt; no files found.<br />Usage: File [/nonfatal] [/a] ([/r] filespec [...]|/oname=outfile one_file_only)<br />!include: error in script: "FolderList.exe.txt" on line 1<br />Error in macro FOLDER_LIST_RECURSIVE on macroline 2</code>
</pre><br />
      <br />
      Any idea?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">20th October 2003 21:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ah: and of course: Keep on!<br />
      :D</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Vytautas</span><br />
      <span class="post-time small text-muted">21st October 2003 01:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The last error Mosestycoon described is the error I get when I try to compile on Win2k.<br />
      <br />
      Vytautas</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
      <span class="post-time small text-muted">21st October 2003 02:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Vytautas</i><br />
        <br />
        The second problem is that if you use a single file command to recurse a directory tree it also recreates the whole tree so that the files in the subfolders on the local machine are placed in the same subdirectories on the target machine. However you program produces a list of file commands that copy files from their subdirectories into the $OUTDIR set by the installer before the call but it does not recreate the directory tree. For example: If you have two directories one containing exe files and another containing help files using your program both the exe and help files would end up in the root directory rather that the 'bin' and 'help' directories.
      </blockquote>I see what your saying now. Yes you're right I didn't take this into account originally. I recently fixed this problem and will probably post a new version tomorrow.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">21st October 2003 09:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ah, ok...<br />
      One more info: I have tested it on WinXP. So this is not limited to W2K...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
      <span class="post-time small text-muted">21st October 2003 21:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok this version should solve the directory recreation issue in the installing folder. Given a folder "c:\temp" that has many subfolders say, folder1, folder2, folder3, ..., folderN these folders will be created in the installtion directory as $OUTDIR\folder1, $OUTDIR\folder2 rather than dumping everything into $OUTDIR as it was doing before.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">21st October 2003 22:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Dear rsegal -<br />
      <br />
      I gave your latest FolderList a try, but still without success. Ok perhaps I am doing it wrong, so here is what I did:<br /></p>
      <pre>
<code>!macro FOLDER_LIST_RECURSIVE INCLUDE_DIR EXCLUDE_FILES<br />  !system "FolderList.exe /r $\"${INCLUDE_DIR} $\" $\"${EXCLUDE_FILES}$\""<br />  !include "FolderList.exe.txt"<br />!macroend<br /><br />!insertmacro FOLDER_LIST_RECURSIVE "${NSISDIR}\TSW\*.*" "CVS\*.*"</code>
</pre><br />
      (Still the part I've mentioned above)<br />
      <br />
      This time, I get another compilererror:<br />
      <pre>
<code>!insertmacro: FOLDER_LIST_RECURSIVE<br />!system: "FolderList.exe /r "C:\Programme\NSIS\TSW\*.* " "CVS\*.*""<br />!system: returned 0<br />!include: "FolderList.exe.txt"<br />Push: $OUTDIR<br />Error: Can't add entry, no section or function is open!<br />!include: error in script: "FolderList.exe.txt" on line 1<br />Error in macro FOLDER_LIST_RECURSIVE on macroline 2</code>
</pre><br />
      <br />
      If I take a closer look to the generated file FolderList.exe.txt (Line 1-11 which are mentioned to be the faulty line), it is showing the following lines:<br />
      <pre>
<code>Push $OUTDIR<br />CreateDirectory "$OUTDIR\DB"<br />SetOutPath "$OUTDIR\DB"<br />Pop $OUTDIR<br />Push $OUTDIR<br />CreateDirectory "$OUTDIR\DB\CVS"<br />SetOutPath "$OUTDIR\DATENBANK\CVS"<br />File "C:\Path\to\NSIS\TSW\DB\CVS\Entries"<br />File "C:\Path\to\NSIS\TSW\DB\CVS\Entries.Extra"<br />File "C:\Path\to\NSIS\TSW\DB\CVS\Repository"<br />File "C:\Path\to\NSIS\TSW\DB\CVS\Root"</code>
</pre><br />
      <br />
      Any ideas?<br />
      Mo
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
      <span class="post-time small text-muted">21st October 2003 22:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sounds like you are calling my program outside of a section or function. As it mentioned from your error you cannot call "Push $OUTDIR" outside a section. You also cannot make a call to "File" outside of a section or function.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">22nd October 2003 01:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I not tested this plugin yet, but have "maybe" a simpler way to do these things with some useful NSIS commands... (remembering...)<br />
      <br /></p>

      <blockquote>
        <b>Quote from Kichik</b><br />
        This program can even be a simple installer using FindFirst, FindNext and FindClose.
      </blockquote>Isn't? (Kichik and your really useful tips...)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Vytautas</span><br />
      <span class="post-time small text-muted">22nd October 2003 01:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">A new bug in the latest version of your program. It is a little difficult to describe so I will attach directory tree snapshots the dir.txt file contains the source directory and dir1.txt contains the target directory produced by the installer. {NOTE: No files were actually excluded in this script.}<br />
      <br />
      Because the files in your program are sorted in alphabetical order files in the root directories get placed in subdirectories is they come after a folder in the sorting order.<br />
      <br />
      Vytautas :eek:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Vytautas</span><br />
      <span class="post-time small text-muted">22nd October 2003 01:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have noticed that you include a CreateDirectory command before SetOutPath, this is not needed as SetOutPath creates the path if it does not exist.<br />
      <br />
      Vytautas ;)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
      <span class="post-time small text-muted">22nd October 2003 03:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by deguix</i><br />
        <b>I not tested this plugin yet, but have "maybe" a simpler way to do these things with some useful NSIS commands... (remembering...)<br />
        <br />
        Quote from Kichik<br />
        This program can even be a simple installer using FindFirst, FindNext and FindClose.<br />
        <br />
        Isn't? (Kichik and your really useful tips...)</b>
      </blockquote>Sure you could probably do the same thing with those script calls. I'm doing it with the same Win32 calls in C++. NSIS is definitely nice but I've been using C/C++ alot longer than I've been working with NSIS. It's what I'm most proficient and comfortable with. That's why I chose it.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
      <span class="post-time small text-muted">22nd October 2003 04:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Vytautas</i><br />
        <b>I have noticed that you include a CreateDirectory command before SetOutPath, this is not needed as SetOutPath creates the path if it does not exist.<br /></b>
      </blockquote>Well therer you are, you learn something everyday.<br />
      <br />

      <blockquote>
        <i>Originally posted by Vyatautas</i><br />
        <b>Because the files in your program are sorted in alphabetical order files in the root directories get placed in subdirectories is they come after a folder in the sorting order.</b>
      </blockquote>I don't recall having that problem however I'll be sure to check it out. Thanks again for the feedback, it helps alot!
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mosestycoon</span><br />
      <span class="post-time small text-muted">22nd October 2003 09:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by rsegal</i><br />
        <b>Sounds like you are calling my program outside of a section or function. As it mentioned from your error you cannot call "Push $OUTDIR" outside a section. You also cannot make a call to "File" outside of a section or function.</b>
      </blockquote>Okay, so I have to call it in every section like:<br />
      <pre>
<code>Section "1" sec1<br />!insertmacro FOLDER_LIST_RECURSIVE "${NSISDIR}\Path\to\Section1\Dir\*.*" "CVS\*.*"<br />...<br />SectionEnd<br /><br />Section "2" Sec2<br />!insertmacro FOLDER_LIST_RECURSIVE "${NSISDIR}\Path\to\Section2\Dir\*.*" "CVS\*.*"<br />...<br />SectionEnd</code>
</pre><br />
      <br />
      Is that correct rsegal?<br />
      Thx for your great engagement and support :up: (That's why the community lives...)<br />
      <br />
      Mo
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
      <span class="post-time small text-muted">22nd October 2003 15:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Mosestycoon</i><br />
        <b>Okay, so I have to call it in every section like:<br /></b>
        <pre>
<b><code>Section "1" sec1<br />!insertmacro FOLDER_LIST_RECURSIVE "${NSISDIR}\Path\to\Section1\Dir\*.*" "CVS\*.*"<br />...<br />SectionEnd<br /><br />Section "2" Sec2<br />!insertmacro FOLDER_LIST_RECURSIVE "${NSISDIR}\Path\to\Section2\Dir\*.*" "CVS\*.*"<br />...<br />SectionEnd</code></b>
</pre><b><br />
        <br />
        Is that correct rsegal?<br />
        <br />
        Mo</b>
      </blockquote>Yep, that's right. You can make both calls in the same section or in separate sections like you've got.<br />
      <br />

      <blockquote>
        <b><i>Originally posted by Mosestycoon</i><br />
        Thx for your great engagement and support :up: (That's why the community lives...)<br /></b>
      </blockquote>Your welcome
    </div>
    <hr />
    <!-- Bootstrap core CSS -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <div class="container">
      <!-- Put navigation bar here -->

      <ol class="breadcrumb">
        <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

        <li><a href="f-65.html">NSIS Discussion</a></li>

        <li class="active">Possibility to ignore files within "File /r option"</li>
      </ol>

      <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=150770">Possibility to ignore files within "File /r option"</a></p><br />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
        <span class="post-time small text-muted">23rd October 2003 21:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"></p>

        <blockquote>
          <b>rsegal</b><br />
          Sure you could probably do the same thing with those script calls. I'm doing it with the same Win32 calls in C++. NSIS is definitely nice but I've been using C/C++ alot longer than I've been working with NSIS. It's what I'm most proficient and comfortable with. That's why I chose it.
        </blockquote>Hmmmm... I was examining it and forgot something: "Compile Time is different than Run Time" if was a code for it, has to be in Run Time (File command is in Run Time). Yeah, now I realize, have to use it with plugins...<br />
        <br />
        This DLL have an installation? I tried it and I could't use it. Maybe putting only the DLL and the readme in the Zip.<br />
        <br />
        (Out of subject, I tried to download instdrv.zip from Archive, and give an error saying:<br />
        <br />
        Error: The file you requested could not be found!)
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
        <span class="post-time small text-muted">23rd October 2003 21:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"></p>

        <blockquote>
          <b><i>Originally posted by deguix</i><br />
          This DLL have an installation? I tried it and I could't use it. Maybe putting only the DLL and the readme in the Zip.<br /></b>
        </blockquote>I'm not sure you could do it with plugins. Pugin calls are run at run-time not at compile time. My program is a standalone executble called using the "!system" command. See messages posted further back in the discussion for examples of it's use and where to download it.
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
        <span class="post-time small text-muted">24th October 2003 14:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"></p>

        <blockquote>
          <i>Originally posted by deguix</i><br />
          <b>Error: The file you requested could not be found!)</b>
        </blockquote>Thanks, fixed.
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
        <span class="post-time small text-muted">24th October 2003 21:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"></p>

        <blockquote>
          Hmmmm... ... have to use it with plugins...
        </blockquote>I said about the command "File" here. Inclusion inside program package compiling is not possible. (since will give a error that a variable (example) don't exist, when doing the code)<br />
        <br />

        <blockquote>
          I'm not sure you could do it with plugins. Pugin calls are run at run-time not at compile time. My program is a standalone executble called using the "!system" command. ...
        </blockquote>I tried the program inside the .zip file. Give error about Kernel32.dll, laking a function. I'm using Win95, without latest updates (fear of giving problems, NOW). And it's only a comment, don't worry much about it.
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
        <span class="post-time small text-muted">29th October 2003 17:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Should have an updated version sometime by the end of this week. Sorry for the delay you guys have been giving some good feedback, just want to make sure I get all the errors I can out of the program before I send it out.</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
        <span class="post-time small text-muted">30th October 2003 22:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Ok I've got a new version to try out. A few notes on its use. Empty directories are not included when recursing. If this is an issue for anyone let me know and I will look for solution. Any files, folders you want to ignore will be ignored in all folders. So for example<br /></p>
        <pre>
<span style="color: #007700">!</span><span style="color: #0000BB">insertmacroFOLDER_LIST_RECURSIVE</span><span style="color: #DD0000">"C:\\MyFolder\\*.*""\\CVS\\,"
</span>
</pre>will ignore all CVS folders under "c:\MyFolder" and it's subfolders. Notice in the example you must prefix the folder to ignore with a "\" character. If you are ignoring a folder a the last item in your ignore list it will require a comma after the prefixed backslash as in the example. If you do not have a folder as your last ignore item this is not a problem.<br />
        <pre>
<span style="color: #007700">!</span><span style="color: #0000BB">insertmacroFOLDER_LIST_RECURSIVE</span><span style="color: #DD0000">"C:\\MyFolder\\*.*""\\CVS\\,*.txt"
</span>
</pre>Sorry about the being specific about the backslashes and commas, I will be fixing this eventually.
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Vytautas</span><br />
        <span class="post-time small text-muted">31st October 2003 04:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Great, :D it worked like a dream. I noticed one little problem however.<br />
        <br />
        This command did not exclude all of the zip files from the updates directory.</p>
        <pre>
<code>!insertmacro FOLDER_LIST_RECURSIVE "C:\Program Files\Spybot - Search &amp; Destroy\*.*" "SDHelper.dll,Updates\*.zip"</code>
</pre>I'm not sure if its just the wildcards in subdirectories or wildcard full stop that don't work.<br />
        <br />
        Vytautas
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">rsegal</span><br />
        <span class="post-time small text-muted">31st October 2003 15:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content"></p>

        <blockquote>
          <b><i>Originially posted by Vytautas</i></b><br />
          Great, it worked like a dream.
        </blockquote>Always nice to hear. Thanks!<br />
        <br />

        <blockquote>
          <b><i>Originally posted by Vytautas</i></b><br />
          <br />
          This command did not exclude all of the zip files from the updates directory.<br />
          <br />
          code:<br />
          <br />
          !insertmacro FOLDER_LIST_RECURSIVE "C:\Program Files\Spybot - Search &amp; Destroy\*.*" "SDHelper.dll,Updates\*.zip"
        </blockquote>Yeh it's not setup to properly deal with the format "Updates\*.zip" as a parameter right now. I took that feature out temporarily. To exclude zip files from the updates subfolder right now you will need to use,<br />
        <pre>
<span style="color: #007700">!</span><span style="color: #0000BB">insertmacroFOLDER_LIST_RECURSIVE</span><span style="color: #DD0000">"C:\\ProgramFiles\\Spybot-Search&amp;Destroy\\*.*""\\Updates\\,SDHelper.dll"
<br /><br /></span><span style="color: #007700">!</span><span style="color: #0000BB">insertmacroFOLDER_LIST_RECURSIVE</span><span style="color: #DD0000">"C:\\ProgramFiles\\Spybot-Search&amp;Destroy\\Updates\\*.*""*.zip"
</span>
</pre>This will ignore the "Updates" folder on the first call and then it can be included with zip files filtered out in the next call. The next big thing I'll be looking at is how to distinguish between ignoring a single folder over ignoring all folders in a recursive structure. Suggestions for a syntax are always welcome.
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">tieum</span><br />
        <span class="post-time small text-muted">2nd April 2004 13:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Hello,<br />
        <br />
        I tried FolderList and it is efficient. Thank you for your job.<br />
        <br />
        Is it still to be integrated in NSIS for 2.1 version ?<br />
        When is 2.1 version planned ?<br />
        <br />
        Thank you,<br />
        <br />
        Tieum</p>
      </div>
      <hr />

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
        <span class="post-time small text-muted">2nd April 2004 14:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">There is no release date set for NSIS 2.1</p>
      </div>
      <hr />

      <div class="footer">
        <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
      </div>
    </div><script src="../js/highlight.pack.js" type="text/javascript">
</script> <script type="text/javascript">
//<![CDATA[
    hljs.initHighlightingOnLoad();
    //]]>
    </script>
  </div>
</body>
</html>
