<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Change images in nsDialogs"><title>Change images in nsDialogs - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Change images in nsDialogs</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=341466">Change images in nsDialogs</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">bennaloz</span><br><span class="post-time small text-muted">30th January 2012 15:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Change images in nsDialogs</strong><br>I state that I tried to look for some solutions about it in all the afternoon but I failed.<br>I have to change an image of a nsDialog in runtime. I have a dialog like this:<br><br>[ImageNo] IE8 [ProgressBar]<br>[ImageNo] Microsoft Visual C++ [ProgressBar]<br>[ImageNo] Adobe [ProgressBar]<br><br>If they are not installed in the OS I will show an image and I will install them. After installing IE8 for example I want show another image but I am not able to do it. Can someone help me?<br>After installing IE8 my dialog should be:<br><br>[ImageYes] IE8 [ProgressBar]<br>[ImageNo] Microsoft Visual C++ [ProgressBar]<br>[ImageNo] Adobe [ProgressBar]<br><br>I hope you understand what I mean.<br>Thanks in advance</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">30th January 2012 16:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Just use the set image commands from the nsDialogs readme</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bennaloz</span><br><span class="post-time small text-muted">31st January 2012 07:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I tried but I can't get it. Ok I will try. I can't modify a dialog from a section without calling the function. Should I call the function with parameters to show what I want or is there an easiest way? Maybe passing handlers from the stack and then I can set images like I want.<br><br>Edit: I tried without success I am not able to understand where I am wrong. I made my creator function showing my dialog. Then I have a section where I install some components but I am not able to update the dialog that I showed and modifying progress bars or images.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">31st January 2012 07:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Why are you talking about sections? nsDialogs are on custom pages.<br><br>You should post the code you already have so we can see what the problem is...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bennaloz</span><br><span class="post-time small text-muted">31st January 2012 08:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">My code is like this <a href="http://nsis.sourceforge.net/Docs/nsDialogs/Readme.html#step-add" target="_blank">http://nsis.sourceforge.net/Docs/nsD....html#step-add</a> nothing more I only made the creator function. I have never used custom pages. Annnd here I attached an example code of what I want to do.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">31st January 2012 08:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You cannot modify pages in sections. All sections are executed on the instfiles page, so the previous page is gone. You need to create a new page after instfiles.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bennaloz</span><br><span class="post-time small text-muted">31st January 2012 08:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">mmm ok. I will manage the function in a way that shows what I want to spend less parameters as possible. and are dialogs shown the same in silent mode?<br><br>Edit: ok they are not shown</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bennaloz</span><br><span class="post-time small text-muted">31st January 2012 10:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I can't find "delete post" -.-''</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bennaloz</span><br><span class="post-time small text-muted">31st January 2012 10:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>new question</strong><br>Is there a way to hide instfiles page and show only nsDialogs to make the user know what is happening?<br>I mean substitute the instfiles page with a nsDialog practically</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">31st January 2012 11:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hmm... You could move all the Sections code to functions, then call those in your custom instfiles page.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bennaloz</span><br><span class="post-time small text-muted">31st January 2012 12:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I tried this<br></p><pre>
<code><br> Page custom nsDialogs<br>Var counter<br>Var message<br>Function nsDialogs<br> nsDialogs::Create 1018<br> Pop $1<br>    IntOp $counter 0 + 0<br>    start:<br>    Pop $0<br>    ${If} $0 == "done"<br>        StrCpy $message "message$counter"<br>    ${ElseIf} $0 == ""<br>         StrCpy $message "starting"<br>    ${EndIf}<br>    ${NSD_CreateLabel} 20 0 25% 12u "$message"<br>    Pop $Label<br>    nsDialogs::Show<br>    IntOp $counter $counter + 1<br>    Push "done"<br>    Goto start<br>FunctionEnd<br></code>
</pre><br>
      <br>
      This code should be a loop and it is. But to make show different messages I have to press always close button.<br>
      <br>
      Edit: this code should change always the same label with a new one but it seems to have a sintax mistake. This code exit when create for the second time a label I don't know why anyway the meaning I think it's clear. Can it work? Anyway I have to solve the problem to close always the window manually to make a new one appear
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br>
      <span class="post-time small text-muted">31st January 2012 12:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can only show a page once. Because of this, you can only create it once, too. To update a label, use SendMessage with the ${WM_SETTEXT} message.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bennaloz</span><br>
      <span class="post-time small text-muted">31st January 2012 12:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yeah you are right and to update an image? As I understood I can't reload an entire dialog. But I can't make ${NSD_SetImage} $Image "path" $ImageHandler to set a new one because I need to close the last one. .-. any "sendImage" command? T.T<br>
      <br>
      Edit: I trawled the .nsh file and I found this:<br>
      SendMessage $R0 ${STM_SETIMAGE} ${_IMGTYPE} $0<br>
      <br>
      Could be useful? If yes can you explain me those parameters?<br>
      <br>
      <br>
      Edit2: ok I made a simple and ignorant copy/paste of this<br></p>
      <pre>
<code><br>StrCpy $0 "MyImage.bmp"<br>                System::Call 'user32::LoadImage(i 0, t r0, i ${IMAGE_BITMAP}, i 0, i 0, i ${LR_LOADFROMFILE}) i.s'<br>                Pop $IMAGE<br>                SendMessage $Image ${STM_SETIMAGE} ${IMAGE_BITMAP} $IMAGE<br></code>
</pre><br>
      And it work but remain the problem that I have to press close button to show the next dialog. How can I do to solve this problem?
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bennaloz</span><br>
      <span class="post-time small text-muted">31st January 2012 13:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Nothing I have always to close the last dialog to open another one. I have to open a dialog. Execute a program and show another dialog with a modify image. I have to do this process many times. But it seems that when I make nsDialogs::Show the function stop also if I have other code after. &gt;.&lt; I am made I must take a break. Someone has time to make a little example code on how to open a dialog set some images and then change them with some conditions? It will be really helpful</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br>
      <span class="post-time small text-muted">31st January 2012 14:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Indeed nsDialogs::Show halts execution of the script until Next or Back is clicked. You need to use a callback function, such as nsD_OnClick.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bennaloz</span><br>
      <span class="post-time small text-muted">31st January 2012 14:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I think I don't follow you. How can I use a callback function in this case? I don't want to stress but I can't understand. I am working with nsis since one month but it's a really big "world". Anyway if you are so patient to explain me I am grateful to you. Anyway I will try to do it by myself.... ^^</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br>
      <span class="post-time small text-muted">31st January 2012 14:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Callback functions are NSIS functions that get called when something special happens. nsDialogs can call callbacks for specific events, for example the onclick event. The only way to execute NSIS code while nsDialogs is waiting for the Next or Back button to be clicked, is to use a callback function.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bennaloz</span><br>
      <span class="post-time small text-muted">31st January 2012 15:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ok... You say to set on .OnClick function (when I press install) my nsis code and then refresh my dialog when I need it?:|</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">31st January 2012 16:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This will not work. NSIS code (except in Sections) runs under the same thread as the UI. Therefore the UI will not update until your callback function has returned (i.e. it will become unresponsive). The only thing you can do is add an image on the InstFiles page with Resource Hacker.<br>
      <br>
      Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bennaloz</span><br>
      <span class="post-time small text-muted">31st January 2012 17:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok stu. Tomorrow morning I will look for an "escamotage". Maybe a little patch. Or something else. Anyway thanks for the patience again =P.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bennaloz</span><br>
      <span class="post-time small text-muted">1st February 2012 07:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>mmmmm...</strong><br></p>

      <blockquote>
        <small>Originally posted by bennaloz</small><br>
        Ok stu. Tomorrow morning I will look for an "escamotage". Maybe a little patch. Or something else. Anyway thanks for the patience again =P
      </blockquote>I was thinking about what I can do to solve this issue. Is there a way to say to a dialog to close itself so I can open another one? Any idea to achieve my goal. The perfect thing is to eliminate the wait after nsDialogs::show I think. But I have no idea how to do it.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bennaloz</span><br>
      <span class="post-time small text-muted">1st February 2012 10:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I solved my problem. I make the main setup run in silent mode comunicate with a secondary setup that only shows Dialogs according to parameters that I send. Every time I need a new dialog I will kill the last process and will execute a new one with new parameters. It seems to work. Maybe it's not the best solution but it's better than nothing</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script type="text/javascript" src="../js/highlight.pack.js" async>
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>