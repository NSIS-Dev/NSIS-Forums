<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="how to check a specfied user whether in administrators group" />

  <title>how to check a specfied user whether in administrators group - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">how to check a specfied user whether in administrators group</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=217773">how to check a specfied user whether in administrators group</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RexHsu</span><br />
      <span class="post-time small text-muted">2nd June 2005 14:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>how to check a specfied user whether in administrators group</strong><br />
      It seems UserInfo:GetAccountType can only check current loggon user. But I want to check any user.How to make that?<br />
      <br />
      thx</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MrWhammy</span><br />
      <span class="post-time small text-muted">9th June 2005 09:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I added a function to UserMgr.c (in <a href="http://nsis.sourceforge.net/archive/download.php?file=UserMgr.zip" target="_blank">http://nsis.sourceforge.net/archive/...le=UserMgr.zip</a> )<br />
      I'm not a C/C++ programmer, so there might be quite some errors in it (not deleting and stuff like that), but it works for me right now.<br />
      <br /></p>
      <pre>
<code>int __declspec(dllexport) GetUserGroups(HWND hwndParent, int string_size, <br />                                      char *variables, stack_t **stacktop,<br />                                      extra_parameters *extra)<br />{<br />   LPGROUP_USERS_INFO_0 ui = NULL;<br />   DWORD dwLevel = 0;<br />   DWORD dwError = 0;<br />   NET_API_STATUS nStatus;<br /><br />   DWORD entriesRead = 0;<br />   DWORD totalEntries = 0;<br />   <br />   static char userid[256];<br />   static char response[1024];<br /><br />   static WCHAR u_userid[256];<br /><br />   memset( u_userid, 0, sizeof( u_userid ) );<br /><br />   g_hwndParent=hwndParent;<br /><br />  EXDLL_INIT();<br /><br />  popstring(userid);<br />  swprintf(u_userid, L"%S", userid);<br />   <br />   nStatus = NetUserGetLocalGroups(NULL, <br />                                                        u_userid, <br />                                                        dwLevel, <br />                                                        LG_INCLUDE_INDIRECT,<br />                                                        (LPBYTE *)&amp;ui,<br />                                                        MAX_PREFERRED_LENGTH,<br />                                                        &amp;entriesRead,<br />                                                        &amp;totalEntries);<br /><br />   if (nStatus != NERR_Success)<br />   {<br />           sprintf(userid, "ERROR %d", nStatus);<br />           pushstring(userid);<br />           NetApiBufferFree(ui);<br />           return nStatus;<br />   }<br />   else<br />   {<br /><br />   LPGROUP_USERS_INFO_0 pTmpBuf;<br />      DWORD i;<br />      DWORD dwTotalCount = 0;<br /><br />          if ((pTmpBuf = ui) != NULL)<br />      {<br />         //<br />         // Loop through the entries; <br />         //  print the name of the global groups <br />         //  to which the user belongs.<br />         //<br />         for (i = 0; i &lt; entriesRead; i++)<br />         {<br /><br />            if (pTmpBuf == NULL)<br />            {<br />                                sprintf(userid, "ERROR An access violation has occurred: %d", nStatus);<br />                                pushstring(userid);<br />                                 NetApiBufferFree(ui);<br />                                return nStatus;<br />            }<br /><br />            sprintf(response, "%S", pTmpBuf-&gt;grui0_name);     <br />                        pushstring(response);<br /><br />            pTmpBuf++;<br />            dwTotalCount++;<br />         }<br />      }<br /><br />          sprintf(response, "%d", dwTotalCount);<br />           pushstring(response);<br />           NetApiBufferFree(ui);<br />           return STATUS_SUCCESS;<br />   }<br />}</code>
</pre><br />
      <br />
      This pushes "ERROR&lt;space&gt;&lt;errormessage&gt;" on the stack in case of an error, or all groups the user belongs to on the local machine, with the number of groups on top.<br />
      <br />
      Example usage:<br />
      <pre>
<code>InitPluginsDir<br /><br />        UserMgr::GetUserGroups "SQLDebugger"<br />        Pop $0<br /><br />        Push "$0" <br />        Push "ERROR"<br />        Call StrStr<br />        Pop $1<br /><br />        StrCmp $1 "" +1 error<br /><br /><br />        MessageBox MB_OK "Nr. results: $0"<br /><br />        loop:<br />        StrCmp $0 "0" end<br /><br />        Pop $1<br />        MessageBox MB_OK "Group: $1"<br />        IntOp $0 $0 - 1<br />        Goto loop<br /><br />        error:<br />        MessageBox MB_OK "Error: $1"<br />        end:</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">RexHsu</span><br />
      <span class="post-time small text-muted">9th June 2005 17:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">you guys good!ยฃยก</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
