<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="makensis scons build failing on linux"><title>makensis scons build failing on linux - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">makensis scons build failing on linux</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=254343">makensis scons build failing on linux</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">carlosc</span><br><span class="post-time small text-muted">28th August 2006 20:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>makensis scons build failing on linux</strong><br>Can someone please advise me how to get around the following build issue on linux:<br><br>nsis-2.19-src]$ scons SKIPSTUBS=all SKIPPLUGINS=all SKIPUTILS=all SKIPMISC=all NSIS_CONFIG_CONST_DATA_PATH=no<br>scons: Reading SConscript files ...<br>Delete("nsis-28-Aug-2006.cvs")<br>Delete(".instdist")<br>Delete(".test")<br>Using GNU tools configuration<br>Checking for linker flag $MAP_FLAG... (cached) no<br>Checking for linker flag -s... (cached) no<br>Checking for linker flag $MAP_FLAG... (cached) no<br>Checking for linker flag -s... (cached) no<br>Checking for memcpy requirement... (cached) yes<br>Checking for memset requirement... (cached) yes<br>Checking for linker flag -pthread... (cached) no<br>Checking for __BIG_ENDIAN__... (cached) yes<br>Checking for main() in C library gdi32... (cached) no<br>Checking for main() in C library user32... (cached) no<br>Checking for main() in C library pthread... (cached) no<br>Checking for main() in C library stdc++... (cached) no<br>Checking for main() in C library iconv... (cached) no<br>Checking for main() in C library dl... (cached) no<br>Checking for main() in C library gdi32... (cached) no<br>Checking for main() in C library iconv... (cached) no<br>Checking for main() in C library user32... (cached) no<br>Checking for main() in C++ library cppunit... (cached) no<br>scons: done reading SConscript files.<br>scons: Building targets ...<br>g++ -o build/release/makensis/build.o -c -O2 -Wall -D__BIG_ENDIAN__ -D_WIN32_IE=0x0500 Source/build.cpp<br>g++ -o build/release/makensis/lang.o -c -O2 -Wall -D__BIG_ENDIAN__ -D_WIN32_IE=0x0500 Source/lang.cpp<br>g++ -o build/release/makensis/makenssi.o -c -O2 -Wall -D__BIG_ENDIAN__ -D_WIN32_IE=0x0500 Source/makenssi.cpp<br>g++ -o build/release/makensis/script.o -c -O2 -Wall -D__BIG_ENDIAN__ -D_WIN32_IE=0x0500 Source/script.cpp<br>g++ -o build/release/makensis/makensis build/release/makensis/build.o build/release/makensis/clzma.o build/release/makensis/crc32.o build/release/makensis/DialogTemplate.o build/release/makensis/dirreader.o build/release/makensis/fileform.o build/release/makensis/growbuf.o build/release/makensis/lang.o build/release/makensis/lineparse.o build/release/makensis/makenssi.o build/release/makensis/mmap.o build/release/makensis/Plugins.o build/release/makensis/ResourceEditor.o build/release/makensis/ResourceVersionInfo.o build/release/makensis/script.o build/release/makensis/ShConstants.o build/release/makensis/strlist.o build/release/makensis/tokens.o build/release/makensis/util.o build/release/makensis/writer.o build/release/makensis/bzip2/blocksort.o build/release/makensis/bzip2/bzlib.o build/release/makensis/bzip2/compress.o build/release/makensis/bzip2/huffman.o build/release/makensis/7zip/7zGuids.o build/release/makensis/7zip/Common/CRC.o build/release/makensis/7zip/7zip/Compress/LZ/LZInWindow.o build/release/makensis/7zip/7zip/Compress/LZMA/LZMAEncoder.o build/release/makensis/7zip/7zip/Common/OutBuffer.o build/release/makensis/7zip/7zip/Compress/RangeCoder/RangeCoderBit.o build/release/makensis/7zip/Common/Alloc.o build/release/makensis/zlib/deflate.o build/release/makensis/zlib/trees.o<br>build/release/makensis/clzma.o(.text+0x67d): In function `CLZMA::End()':<br>: undefined reference to `pthread_detach'<br>build/release/makensis/clzma.o(.text+0x6b8): In function `CLZMA::End()':<br>: undefined reference to `pthread_join'<br>collect2: ld returned 1 exit status<br>scons: *** [build/release/makensis/makensis] Error 1<br>scons: building terminated because of errors.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">29th August 2006 00:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The tests are cached, so I'll take a wild guess and say you've moved the entire directory from another machine which has pthreads in glibc to a machine that has a separate pthread library. Try building from a clean source tree.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">carlosc</span><br><span class="post-time small text-muted">29th August 2006 02:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'm guessing (not knowing much about scons) that the reason they are cached is because I reran the scons build script. But I got the same result when I built initially after downloading the sources. BTW, if I add "-pthread" to the linker line makensis is linked successfully. What does that say about what scons is (or is not) doing with regards to setting pthread linking correctly?<br><br>Thanks<br>Carlos</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">29th August 2006 08:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It means the -pthread test failed incorrectly. Could you attach the config.log file generated for a clean build?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">carlosc</span><br><span class="post-time small text-muted">29th August 2006 13:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Attached is the confg.log file that was generated when I reran the scons build. If this is not what you wanted please send me the exact build line you want me to run to generate the config.log you need.<br><br>Note: to make it work I copied/pasted the g++ as follows:<br><br>[nsis-2.19-src] $&gt;g++ -pthread -o build/release/makensis/makensis build/release/makensis/build.o build/release/makensis/clzma.o build/release/makensis/crc32.o build/release/makensis/DialogTemplate.o build/release/makensis/dirreader.o build/release/makensis/fileform.o build/release/makensis/growbuf.o build/release/makensis/lang.o build/release/makensis/lineparse.o build/release/makensis/makenssi.o build/release/makensis/mmap.o build/release/makensis/Plugins.o build/release/makensis/ResourceEditor.o build/release/makensis/ResourceVersionInfo.o build/release/makensis/script.o build/release/makensis/ShConstants.o build/release/makensis/strlist.o build/release/makensis/tokens.o build/release/makensis/util.o build/release/makensis/writer.o build/release/makensis/bzip2/blocksort.o build/release/makensis/bzip2/bzlib.o build/release/makensis/bzip2/compress.o build/release/makensis/bzip2/huffman.o build/release/makensis/7zip/7zGuids.o build/release/makensis/7zip/Common/CRC.o build/release/makensis/7zip/7zip/Compress/LZ/LZInWindow.o build/release/makensis/7zip/7zip/Compress/LZMA/LZMAEncoder.o build/release/makensis/7zip/7zip/Common/OutBuffer.o build/release/makensis/7zip/7zip/Compress/RangeCoder/RangeCoderBit.o build/release/makensis/7zip/Common/Alloc.o build/release/makensis/zlib/deflate.o build/release/makensis/zlib/trees.o</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">29th August 2006 13:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That's the file and the command line doesn't matter in this case, but I need it after a clean build. SCons must run only once after the source tree is completely cleaned so config.log won't be overwritten. In the log you've attached, it doesn't show the results of the real configuration test because it's cached.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">carlosc</span><br><span class="post-time small text-muted">29th August 2006 14:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Can you please tell me which command I should run to generate the config.log file you need? I've ran "scons --clean" but it still shows cached. Which configuration should I delete that keeps this cache information?<br><br>Thanks<br>Carlos</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">29th August 2006 14:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">scons doesn't have a clean command for that, you need to clean it yourself. The easiest method is simply to delete the folder and extract the files again.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">carlosc</span><br><span class="post-time small text-muted">29th August 2006 16:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hmm, it built OK this time. So if I'm to guess at what happened, originally when I first built the thing I didn't use any arguments in the scons command line. I then read that I should only build makensis (not the plugins) and I then used the arguments per the doc. Perhaps the first attempt cached some invalid options.<br><br>Thanks<br>Carlos</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">moenk</span><br><span class="post-time small text-muted">8th November 2006 14:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by kichik</i> <b>It means the -pthread test failed incorrectly. (...)</b></blockquote>Hi there! I have a very similar problem trying to build nsis 2.21 on Solaris.<pre>
<code>scons SKIPSTUBS=all SKIPPLUGINS=all SKIPUTILS=all SKIPMISC=all NSIS_CONFIG_CONST_DATA_PATH=no</code>
</pre><br>ends up somewhere with:<ul><li>g++ -o build/release/makensis/makensis -pthread build/release/makensis/build.o (...)<br>g++: unrecognized option `-pthread'<br>scons: done building targets.</li></ul>I modified SConstruct as follows:<pre>
<code>#defenv = Environment()<br>defenv = Environment(CXX = 'g++')<br>defenv.Replace(CXXVERSION = '3.3.2')</code>
</pre><br>
      One more error is:

      <ul>
        <li>Checking for linker flag -s... ld.so.1: conftest_2: fatal: libstdc++.so.5: open failed: No such file or directory<br>
        Killed<br>
        no<br>
        Checking for linker flag -s... ld.so.1: conftest_5: fatal: libstdc++.so.5: open failed: No such file or directory<br>
        Killed<br>
        no</li>
      </ul><br>
      And in the conf.log it reads:

      <ul>
        <li>file /user/moe/src/nsis-2.21-src/SCons/utils.py,line 72:<br>
        Configure(confdir = .sconf_temp)<br>
        scons: Configure: Checking for linker flag -pthread...<br>
        .sconf_temp/conftest_8.c &lt;-<br>
        |<br>
        | int main() {<br>
        | return 0;<br>
        | }<br>
        |<br>
        gcc -o .sconf_temp/conftest_8.o -c -O2 -Wall .sconf_temp/conftest_8.c<br>
        .sconf_temp/conftest_8.c:5:1: warning: no newline at end of file<br>
        gcc -o .sconf_temp/conftest_8 -pthread .sconf_temp/conftest_8.o<br>
        gcc: unrecognized option `-pthread'<br>
        scons: Configure: yes</li>
      </ul>Do you have any idea what's wrong here?<br>
      <br>
      TIA,<br>
      MOENK
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">moenk</span><br>
      <span class="post-time small text-muted">8th November 2006 15:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">One more thing:<br>
      Do I definately need a XCompiler?<br>
      I cannot imagine, that putting "my" new makensis into a precompiled zip for win32 will work on SAPRC? At the moment, when running ./makensis nothing happens at all :rolleyes:<br>
      Sorry, but the <a href="http://nsis.sourceforge.net/Docs/AppendixG.html#G.3" target="_blank">documentation</a> is not very detailled for building on POSIX ...<br>
      <br>
      Again, Thanks,<br>
      MOENK<br>
      <br>
      PS: I got rid of the "-pthread" - message after changing conf/gnu<br></p>
      <pre>
<code>#conf.CheckLinkFlag('-pthread')</code>
</pre><br>
      Is that ok ?
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">8th November 2006 19:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">In your case, the -pthread actually succeeded on accident. But that's OK as it's ignored by gcc if it's not supported.<br>
      <br>
      The config.log part you took and the output piece do not match. You've pasted the output of the -s test and the log for the -pthread test.<br>
      <br>
      As the documentation says, you don't need a cross-compiler. You can just drop makensis into the precompiled zip for win32. The fact that ./makensis fails is probably because of <a href="http://sourceforge.net/tracker/index.php?func=detail&amp;aid=1470826&amp;group_id=22049&amp;atid=373085" target="_blank">unaligned memory access</a> because you're trying to run on SPARC. If the wrong files are present, it'll tell you, so that's not the problem.</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script type="text/javascript" src="../js/highlight.pack.js" async>
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>