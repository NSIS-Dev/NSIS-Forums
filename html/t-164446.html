<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Locked file handling?" />

  <title>Locked file handling? - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Locked file handling?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=164446">Locked file handling?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">gbeardsl</span><br />
      <span class="post-time small text-muted">12th January 2004 03:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Locked file handling?</strong><br />
      Kind folk,<br />
      During any installation, it's best to assume that the files you're installing may already be present on the target system, and may be locked.<br />
      <br />
      To properly handle this condition, I'm using the "Rename" function with the "/REBOOTOK" option. This appears to be the only method within NSIS for handling locked file conditions. Using this method will set the reboot flag if the target file is currently locked.<br />
      <br />
      The error that I'm experiencing is that if the file is present on the user system at all, then the reboot flag get's set, even if the file is not locked.<br />
      <br />
      I've put many days into using the NSIS installer, and so hate to revert to InstallShield. However, if locked files can't be properly handled, I may have no choice.<br />
      <br />
      This is a really common need; does anybody know of this bug, how to work around, or what is considered proper protocol in NSIS for handling locked files?<br />
      <br />
      I'm using version 1.98 for a variety of reasons.<br />
      <br />
      Thanks so much!<br />
      I'm desperate,<br />
      Gary</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">12th January 2004 07:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There are many known bugs in the old 1.98 version you are using, it has not been updated for two years.<br />
      <br />
      Upgrade to NSIS 2 and it should work fine.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">gbeardsl</span><br />
      <span class="post-time small text-muted">12th January 2004 07:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Joost. After reading some of the other related topics, I may choose to be lazy for the moment and simply delete it first with /REBOOTOK. If it's locked, the reboot flag will be set. If it's not locked, then Rename will do the deed without the failure.<br />
      <br />
      But again, Thanks!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">12th January 2004 15:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Almost all NSIS 2 features are backwards compatible, upgrading is highly recommended because it will fix several issues.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">gbeardsl</span><br />
      <span class="post-time small text-muted">12th January 2004 17:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Point taken. However, I must ship today, and QA time is insufficient to gamble on any other failures. The delete fix works, so it's going out the door. Will use new version next build.<br />
      <br />
      Thanks,<br />
      Gary</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">gbeardsl</span><br />
      <span class="post-time small text-muted">26th January 2004 20:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Joost,<br />
      Thanks for your communications and work on this codebase! Per your suggestion, I did of course update to the latest version of NSIS.<br />
      <br />
      I need to ask about the current methodology for handling locked files. The support for this is still pretty convoluted if I understand it correctly. There's a high percentage of the files that I install which could potentially be locked, and realistically, I always assume any file could be locked when building an InstallShield installer. It's simply good practice and eliminates error.<br />
      <br />
      For installing potentially locked files with NSIS, I cannot merely use the 'File' command. I must first unpack the files in a temp folder, then use 'Rename' to move it to the target, then check the error flag and manually set the reboot flag which I will check at the end of install to see if I should reboot.<br />
      <br />
      This seems to be the only current approach; is this correct? It would certainly be nice if this functionality was all contained in the 'File' command with a 'Locked' flag. I've considered adding this myself, but am new to NSIS and don't want to start screwing with source if this effort is already underway by somebody and until I'm hooked for sure.<br />
      <br />
      Any comments you have would be appreciated.<br />
      <br />
      Thanks!<br />
      Gary</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">26th January 2004 22:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There is no other method. InstallShield will have to do the same thing.<br />
      <br />
      You can put the code in a macro it you need to use it multiple times.<br />
      <br />
      The included UpgradeDLL macro handles version checks and upgrades.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">gbeardsl</span><br />
      <span class="post-time small text-muted">26th January 2004 22:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Joost! I will check the "included UpgradeDLL macro".<br />
      <br />
      FYI - InstallShield must do this also of course, but all the user does is click a checkbox for "potentially locked".<br />
      <br />
      gb</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
