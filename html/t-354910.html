<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Repeating fails"><title>Repeating fails - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Repeating fails</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=354910">Repeating fails</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Niharika1588</span><br><span class="post-time small text-muted">22nd January 2013 18:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Repeating fails</strong><br>Hi, I want the files to be downloaded only if the user selects the file name by marking the checkbox (File name : Something). If the user doesn't select the checkbox it prompts for a message sayng "Do you want to quit?" If the user enters NO, then it should take to the same screen where the user will be asked to to enter his choice again.<br><br>The problem is , if the user marks the checkbox first time itself everything works fine. If not the user doesn't mark the checkbox initially, later comes back and marks the checkbox. The program isn't able to identify it.<br><br>I don't know the exact reason but I assume it is due the flow of program i..e initially it is done sequentially but later we are using call function to execute them.<br><br>Here is my code, please let me know if you have any suggestions.<br><font color="DarkOrange"><br>/*To reduce the complexity I commented/removed the files 2 download n uninstall */</font><br><br><font color="DarkRed">!include MUI.nsh<br>!include LogicLib.nsh<br>!include WinMessages.nsh<br>!include FileFunc.nsh<br>!include nsDialogs.nsh<br><br>!insertmacro MUI_LANGUAGE English<br><br>DirText "Please choose a directory to which you'd like to install this application."<br><br>Name "HUD Systems"<br>OutFile "Rewrite.exe"<br><br>installDir "C:\work\H"<br><br><br>Page custom nsDialogsWelcome<br>Page custom nsDialogsWelcome1 nsDialogsWelcome1Leave<br>!insertmacro MUI_PAGE_DIRECTORY<br>Page custom show<br>!insertmacro MUI_PAGE_INSTFILES<br><br>XPStyle on<br><br>Var Dialog<br>Var Label<br>Var Text<br>Var Text_State<br>Var Checkbox<br>Var Checkbox_State<br>Var one<br><br>Function .onInit<br>${NSD_SetState} $Checkbox_State ${BST_UNCHECKED}<br>FunctionEnd<br><br>Function nsDialogsWelcome<br><br>nsDialogs::Create 1044<br>Pop $DIALOG<br><br>${If} $Dialog == error<br>Abort<br>${EndIf}<br><br>${NSD_CreateLabel} 7u 7u 100% 100% "Welcome "<br>Pop $Label<br><br>${NSD_CreateLabel} 11u 14u 95% 100% "Creating a label"<br>Pop $Label<br><br>nsDialogs::Show<br>FunctionEnd<br><br><br>Function nsDialogsWelcome1<br><br>${NSD_SetState} $Checkbox_State ${BST_UNCHECKED}<br><br><br>nsDialogs::Create 1018<br>Pop $Dialog<br><br>${If} $Dialog == error<br>Abort<br>${EndIf}<br><br>${NSD_CreateLabel} 0 0 100% 12u "Hello, welcome to nsDialogs!"<br>Pop $Label<br><br>${NSD_CreateCheckbox} 0 30u 100% 10u "Something"<br>Pop $Checkbox<br><br>; ${NSD_SetState} $Checkbox_State $Checkbox<br>${If} $Checkbox_State == ${BST_CHECKED}<br>${NSD_Check} $Checkbox<br>${EndIf}<br><br>nsDialogs::Show<br><br>FunctionEnd<br><br>Function nsDialogsWelcome1Leave<br><br>${NSD_GetState} $Checkbox $Checkbox_State<br>MessageBox MB_OK "The values is $Checkbox_State"<br>FunctionEnd<br><br>Function show ; "All zip files"<br>show1:<br>${If} $Checkbox_State == ${BST_CHECKED}<br><br>IfFileExists "$INSTDIR\*.*" 0 Createdir<br>MessageBox MB_YESNO "Do you want to override this file??" IDNO no<br>SetOutPath "$INSTDIR\deliverables"<br>; File client_9_6_0_0.zip<br>;WriteUninstaller $INSTDIR\Uninstall.exe<br>;ZipDLL::extractall "$INSTDIR\deliverables"\deploy_9_6_0_0.zip" "$INSTDIR"<br>Goto End<br><br>no:<br>MessageBox MB_YESNO "You do not want to override the files, so quitting??" IDNO no1<br>Quit<br><br>no1:<br>Goto show1<br><br>CreateDir:<br>MessageBox MB_OK "Folder does not exists, sorry we cannot copy the files."<br>Quit<br>${Else}<br>MessageBox MB_YESNO "You didn't select any files. Do you want to quit??" IDNO no2<br>Quit<br><br>no2:<br>MessageBox MB_YESNO "You want to go back and select files?" IDNO Q<br>Call nsDialogsWelcome1<br>Call nsDialogsWelcome1Leave<br>Call show<br>${EndIf}<br><br>Q:<br>Quit<br><br>End:<br>FunctionEnd<br><br>Section "ABC"<br>Strcpy $one 0<br>SectionEnd<br><br>Section "Uninstall"<br>RMDir $INSTDIR<br>SectionEnd</font></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">22nd January 2013 20:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You cannot call a page function manually. You can only page creation functions with the page custom command.<br><br>To get back to the page, call 'abort' in the page's leave function. So in your case, move your messageboxes to the leave function, and call abort if the user wants to go back to the page.<br><br>(Notice that your second messagebox is kind of stupid. You first ask 'quit yes/no', then if the user selects no twice, you still quit anyway. You should simply say 'please select some files', then call abort immediately. If the user wants to quit, he/she can click the Cancel button.)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Niharika1588</span><br><span class="post-time small text-muted">23rd January 2013 16:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yeah I tried. But it's just quitting the program.<br><br>What I had done is modified the lines as shown below (just adding Abort and commenting the rest) :<br><font color="red"><br>no2:<br>Abort</font><br><font color="green">;MessageBox MB_YESNO "You want to go back and select files?" IDNO Q<br>;Call nsDialogsWelcome1<br>;Call nsDialogsWelcome1Leave<br>;Call show</font><br><br>I want the program to go back to the screen with checkbox and if checkbox is marked it should update it's value to 1, indicating that the user needs to download the file</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">23rd January 2013 18:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I already told you, you need to call abort in the leave function, not in the show function.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Niharika1588</span><br><span class="post-time small text-muted">23rd January 2013 20:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Oh sorry I didn't go through it properly.<br>That worked thank you.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">MSG</span><br><span class="post-time small text-muted">24th January 2013 09:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">No problem. :)</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>