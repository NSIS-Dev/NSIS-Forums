<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Cannot overwrite dll files in system32"><title>Cannot overwrite dll files in system32 - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Cannot overwrite dll files in system32</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=306597">Cannot overwrite dll files in system32</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">danielbcn</span><br><span class="post-time small text-muted">21st May 2009 13:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Cannot overwrite dll files in system32</strong><br>Hi,<br><br>I am pretty new to NSIS. I am facing a problem that I'm sure must have a simple solution.<br><br>Everything works fine when I install my application for the first time in a PC.<br><br>Then, I unistall it and then I want to reinstall it back. I get no errors from the setup program, but the DLL's I had copied to windows\system32 folder are never overwritten. For some reason, the only way to get the new version installed is to delete manually the old dlls first.<br><br>This happens either in Windows XP or Windows Vista, no matter if the user has administrator rights or not.<br><br>Do you know if there is any instruction that can overcome this limitation?<br><br>I'm sending the whole script so you can see what I'm doing.<br><br>Thanks in advance,<br><br>Dani Carbonell</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">danielbcn</span><br><span class="post-time small text-muted">3rd June 2009 12:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Things I've tried</strong><br>In UpgradeDLL.nsh, I tried to change<br><br>SetOverwrite try<br><br>to<br><br>SetOverwrite on<br><br>... thinking that was going to be it... but it still won't overwrite the files...<br><br>Any other ideas?<br><br>Thanks!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br><span class="post-time small text-muted">3rd June 2009 17:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Why don't you delete the DLL files when uninstalling?<br>Or are these DLL's shared?<br><br>You can try the InstallLib macro which is included in NSIS.<br>Search the NSIS manual for InstallLib for more info.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">3rd June 2009 17:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It may be that the files have attributes set. Try SetFileAttributes dll_file.dll NORMAL<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">redxii</span><br><span class="post-time small text-muted">3rd June 2009 21:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Are you trying to overwrite Windows system files? It looks like it. If the files need to be updated you should bundle a redistributable setup from Microsoft with the updated DLLs and have your script execute it, or put the files in the same folder as your program. You should not be replacing system files with your own, Microsoft prevents it and developers replacing system file with their own was the reason users experience instability with Windows or other applications.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Simon Brown</span><br><span class="post-time small text-muted">3rd June 2009 21:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Re: Cannot overwrite dll files in system32</strong><br></p><blockquote>I get no errors from the setup program, but the DLL's I had copied to windows\system32 folder are never overwritten. For some reason, the only way to get the new version installed is to delete manually the old dlls first.</blockquote><a href="http://blogs.msdn.com/oldnewthing/archive/2006/03/21/556505.aspx" target="_blank">http://blogs.msdn.com/oldnewthing/ar...21/556505.aspx</a><br><br><blockquote>Programs expect to be able to overwrite the files. A program's setup would run and it decided that it needed to "update" some system file and attempt to overwrite it. If the system tried to stop the file from being overwritten, the setup program would halt and report that it was unable to install the file. Even if the operating system detected that somebody was trying to overwrite a system file and instead gave them a handle to NUL, those programs would nevertheless notice that they had been hoodwinked because as a "verification" step, they would open the file they had just copied and compare it against the "master copy" on the installation CD. The solution was to let the program think it had won, and then, when it wasn't looking, put the original back.</blockquote>;)</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">redxii</span><br><span class="post-time small text-muted">3rd June 2009 21:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Since you're updating VB6 runtimes you should use this setup instead, either indicate it needs to be installed first or extract it to $TEMP or $PLUGINSDIR run it from your setup: www.microsoft.com/downloads/details.aspx?FamilyId=7B9BA261-7A9C-43E7-9117-F673077FFB3C&amp;displaylang=en but you shouldn't install it for XP and later. Although it wouldn't hurt because Windows should make sure newer versions aren't overwritten with older ones.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">danielbcn</span><br><span class="post-time small text-muted">4th June 2009 06:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">In response to some of the comments:<br><br>- Why don't you delete the DLL files when uninstalling?<br>Or are these DLL's shared?<br><br>They are (potentially) shared among a few aplications.<br><br>- It may be that the files have attributes set.<br><br>Do you mean they are marked as read-only? If so, they are not (I just checked).<br><br>- Are you trying to overwrite Windows system files?<br><br>I'm not overwriting the system files, but some dlls I developed which are shared among some applications I have developed.<br><br>- Programs expect to be able to overwrite the files.<br><br>You mean Windows makes the setup program think it has been able to overwrite the files and then, when it is not looking, goes back to the old version? Do you think there is a way to avoid this to happen?<br><br>- Since you're updating VB6 runtimes you should use another setup instead.<br><br>The problem I get os with my custom DLLs, not with the system ones.<br><br>Thanks everyone for your replies.<br><br>Dani</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">4th June 2009 11:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Files with SYSTEM set are not always overwriteable in my experience.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">danielbcn</span><br><span class="post-time small text-muted">4th June 2009 13:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hi, Afrow UK,<br><br>Thanks for your comment.<br><br>The files I need to overwrite do not have the SYSTEM attribute, they are regular dlls.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>