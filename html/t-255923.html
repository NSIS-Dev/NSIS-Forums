<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Delete empty dirs/subdirs from directory file - strange behaviour" />

  <title>Delete empty dirs/subdirs from directory file - strange behaviour - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Delete empty dirs/subdirs from directory file - strange behaviour</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=255923">Delete empty dirs/subdirs from directory file - strange behaviour</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">saschagottfried</span><br />
      <span class="post-time small text-muted">21st September 2006 16:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Delete empty dirs/subdirs from directory file - strange behaviour</strong><br />
      I report a strange behaviour for the combination of instructions: Locate, RMDir<br />
      <br />
      I use filelists to install and for uninstallation. Installation works well, but I have to remove empty dirs after deleting every file read from the filelist.<br />
      <br />
      I tried Recfind, Locate with Callbackfunction, read a lot in the forum. After generating the DirList with Locate or RecFind, I process it from the end to start to delete empty dirs/subdirs. But RMDir can not delete anything.<br />
      <br />
      *Manual deletion of those directories works.<br />
      *I know that current directory can't be deleted - I switch before deletion.<br />
      *I test whether the directory are recognized as dirs and if they are empty or not.<br />
      * I already tried /REBOOTOK, that deleted the subdirs after Reboot. This would just be a lazy fix. I KNOW that no Reboot is necessary.<br />
      <br />
      Strange Behaviour:<br />
      I splitted the code into two sections. One creates the directorylist. The other one reads it and invokes RMDir on those paths.<br />
      <br />
      If I execute both section afterwards, RMDir can not delete dirs. Thus I used "/o" on second section to skip it in first run of "installer". The list got created. Installer exits without trying to read and delete the dirs. Second Run: I edited my source code to unselect the first section. After execution the dirlist got read and deleted without any problems. "Strange, huh" as Guybrush Threepwood would comment in this case.<br />
      <br />
      I would like to have first some explanation of this behaviour and in second place suggestions for existing "solutions" for this task.<br />
      <br />
      I added the code as attachment. You have to create "C:\testdir" with some subdirs hierarchy in it.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">22nd September 2006 12:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The problem is with GetSize. It doesn't properly close the search handles it opens. Locate seems a little problematic on the subject as well. When its callback passes stop it and in another case I still haven't figured out, it doesn't close the last opened handle.<br />
      <br />
      If Locate or RecFind is giving you problems, you can use <a href="http://nsis.sourceforge.net/Search_For_a_File" target="_blank">my old function</a>. As for GetSize, either wait for Instructor to fix it, or implement your own solution using Locate.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">saschagottfried</span><br />
      <span class="post-time small text-muted">22nd September 2006 14:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I am really happy that you cared about my problem. Great work.<br />
      I started to use GetSize to prove that Locate writes the same number of dirs in my dirlist-file as GetSize reports. I kept GetSize in my code and thus switching from Locate to RecFind did not helped. Now I know the reason. Well done. I really appreciate your work for all forum members.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DrDan</span><br />
      <span class="post-time small text-muted">8th June 2007 14:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Still seems to happen...</strong><br />
      I simply can't get the example "Example (Delete empty directories):" in "Appendix E.1.2 Locate" to work.<br />
      <br />
      Any idea if this has been or will be fixed?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">saschagottfried</span><br />
      <span class="post-time small text-muted">13th June 2007 17:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Please provide more information! What is your problem, what code you used to solve this and so on. Please append your code and describe its purpose.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DrDan</span><br />
      <span class="post-time small text-muted">14th June 2007 09:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">One of my colleagues helped me to work out another algorithm to do this without using Locate.<br />
      <br />
      The problems I was experiencing with the Locate example were directories not being deleted.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">saschagottfried</span><br />
      <span class="post-time small text-muted">14th June 2007 15:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Fine. But the idea of a installation tool could be that you just use built in function without the need to develop a special workaround for simple task.<br />
      <br />
      If you do not mind, share your example with us. Imagine the next example you can not get to run. Develop the next algorithm or ask the community? Anyways, I think if there is a problem with Locate you should tell us. Cheers!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DrDan</span><br />
      <span class="post-time small text-muted">15th June 2007 10:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>All my fault!!!!</strong><br />
      Luckily, I have finally had some time to look into this carefully, and I am completely wrong. :D :D :D The example does work correctly. :D :D :D :D :D :D :D<br />
      <br />
      I withdraw my previous comment that the example did not work.<br />
      <br />
      Apologies for the confusion.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DrDan</span><br />
      <span class="post-time small text-muted">15th June 2007 10:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Attached example</strong><br />
      And here's an example that works.<br />
      <br />
      If you wish to run it, change the</p>
      <pre>
<code>!define MY_FILE</code>
</pre>on line 18 to any dummy file you have lying around.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DrDan</span><br />
      <span class="post-time small text-muted">15th June 2007 10:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Oops</strong><br />
      Missed the attachment.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Instructor</span><br />
      <span class="post-time small text-muted">15th June 2007 10:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://nsis.sourceforge.net/Locate_plugin" target="_blank">${locate::RMDirEmpty}</a> fast algorithm</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">saschagottfried</span><br />
      <span class="post-time small text-muted">15th June 2007 12:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">@Instructor:<br />
      <br />
      Is your Plugin the code base for FileFunc.nsh? What about your special RMDirEmpty function. Will it find its way into main NSIS? Anyways, I will check this function next time.<br />
      <br />
      @DrDan:<br />
      <br />
      Thanks a lot. Its always like this: as soon as you do it right, it works. Great stuff! *g*</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
