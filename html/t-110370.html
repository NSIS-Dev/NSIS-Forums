<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Global variables scope when !define is used"><title>Global variables scope when !define is used - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Global variables scope when !define is used</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=110370">Global variables scope when !define is used</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">neomaniakov</span><br><span class="post-time small text-muted">18th October 2002 13:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Global variables scope when !define is used</strong><br>Hi all<br><br>I try to use Gloval variables with !define statement<br>when i receive values from extended DLL. I dont wanted to call<br>DLL twice or 5 time when i need some global value<br><br>When i use<br><font color="blue">CODE:--------------------------------------------<br>pluginDllName::Fill_S0<br>Pop $0<br>!define GLOBAL1 $0<br>CODE:END --------------------------------------------</font><br><br>if after that on some place in NSIS script<br><font color="blue">CODE:--------------------------------------------<br>StrCpy $0 "test2"<br>CODE:END --------------------------------------------</font><br>${GLOBAL1} value changes to "test2" too ?!?!? ...<br>I thought that statement "!define GLOBAL1 $0"<br>can be used for init ${GLOBAL1} with value of $0<br>not to Link with $0<br>What I suppose to do if I want to keep variable GLOBAL1<br>with global scope not to change when $0 changes ?<br>Some kind of:<br><font color="blue">CODE:--------------------------------------------<br>pluginDllName::Fill_S0<br>Pop $0<br>!define GLOBAL1<br>StrCpy ${GLOBAL1} $0<br>CODE:END --------------------------------------------</font><br><br>But in this case I receive Error when compile:<br><font color="blue">ERR: ---------------------------------------<br>StrCpy expects 2-2 parameters, got 1.<br>Usage: StrCpy $(user_var: output) str [maxlen] [startoffset]<br>ERR:END ---------------------------------------</font></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">18th October 2002 13:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">!define is a compile time command. It defines a symbol as a certain string at compile time, not runtime. If you define GLOBAL as $0 everytime the compiler will encouter ${GLOBAL} it will replce it with the string $0, which later, at runtime, will be translated to whatever value it holds.<br><br>You can't create more variables than what you already have in NSIS ($0...$9, $R0...$R9). Those variables are already global, you can use them everywhere in the script, and they will maintain the same value all over it.<br><br>If you want to keep a certain value in some variable you will have to reserve a variable from the existing variables for it. $R8 for example.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">neomaniakov</span><br><span class="post-time small text-muted">18th October 2002 14:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><b>10ks kichik,</b><br><br>it helps me a lot, I'll fix my scripts</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">vtsaran</span><br><span class="post-time small text-muted">13th June 2003 19:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Sorry. Do you mean to say that all variables in NSIS scripting language are global? If I used $R1 in function1, the $R1 in function2 will overwrite the first one? O gee, I hope this is not the case.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Lilla</span><br><span class="post-time small text-muted">13th June 2003 21:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I am doing something similar and it is working fine so far.<br>I had problems until I finally figured out that the variable I used<br>($0) could not be used by any function, or else it would be overwritten. I need to test on WIN_VER in several different sections<br>and I didn't want to use $0, I wanted a meaningful name, like WIN_VER.<br><br>The way I see it now, it's like ${WIN_VER} is a friendly name for $0.<br>I'm new to NSIS, so if this is not a good way, please advise.<br><br>Call GetWindowsVersion<br>Pop $0 ; at this point $0 is "NT 4.0" or whatnot<br>!define WIN_VER $0 ; create a global variable<br>; MessageBox MB_OK "GetWindowsVersion ${WIN_VER}"<br>StrCmp ${WIN_VER} '98' ContinueAsk<br>StrCmp ${WIN_VER} '98 SE' Continue2<br>StrCmp ${WIN_VER} 'XP' Continue2<br><br>; Usage:<br>; Call GetWindowsVersion<br>; Pop $R0 ; at this point $R0 is "NT 4.0" or whatnot<br>Function GetWindowsVersion<br>Push $R0<br>Push $R1<br>... snip...<br><br>Lilla</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">13th June 2003 21:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That's right. ${WINVER} will be replaced by $0. Maybe you'd better use a variable that is not so common, like $9.<br><br>Support for real user variables ($USER) will be added very soon (it's already in the development snapshot, but not enabled by default).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">13th June 2003 22:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by vtsaran</i><br><b>Sorry. Do you mean to say that all variables in NSIS scripting language are global? If I used $R1 in function1, the $R1 in function2 will overwrite the first one? O gee, I hope this is not the case.</b></blockquote>Yep that's how it works, like a set of registers you can manipulate.</div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>