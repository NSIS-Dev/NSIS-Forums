<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Looking for a smaller way for this..."><title>Looking for a smaller way for this... - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Looking for a smaller way for this...</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=151280">Looking for a smaller way for this...</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">2nd October 2003 23:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Looking for a smaller way for this...</strong><br>Is there a smaller way to create a NSIS plugin?<br>Ok. Since I'm learning C++ with Dev-C++, I'd like to try to<br>make some of them.<br>Thanks :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">3rd October 2003 11:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">What do you mean? Please give more details.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">3rd October 2003 13:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Try searching for ways to avoid inclusion of MSVCRT from MinGW's compiled DLL. I have searched Google a bit but couldn't find anything useful on the first result page ;)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dselkirk</span><br><span class="post-time small text-muted">3rd October 2003 18:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hey, a quick way to get started is to import the exdll project and modify it. Just make sure to change the project type to win32dll before compiling. Dev-cpp doesn't import the fact that its a dll.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">DrO</span><br><span class="post-time small text-muted">3rd October 2003 18:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">not using the standard c functions helps as well - like with most of the example dlls by including your own atoi functions, etc and that (usually saves around 30k from what i remember).<br><br>other options are eliminating duplicate strings (not sure how/if Dev-C++ has that option - know how to with vc++ 6 and borland c++ 5)<br><br>if you were using vc++ 6 i would also say to try <a href="http://www.codeproject.com/tips/aggressiveoptimize.asp?target=aggressive" target="_blank">this</a> which kicks in certain optimisations to help cut compiled sizes down (if the code and all that allows for it ;))<br><br>-daz</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">dselkirk</span><br><span class="post-time small text-muted">3rd October 2003 19:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Here is an example project. Simply extra and drop into the NSIS Contrib folder (so it can find the ExDll.h). I hope this helps.<br><br>Don</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">3rd October 2003 20:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks to everyone :).<br>@KichiK: According to Dev-C++'s site, the MSVCRT dependecy come with Windows 95 or higher... since NSIS run only in Win95 and up, I'll be don't problem, right?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">RDaneel</span><br><span class="post-time small text-muted">3rd October 2003 22:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, in VC-land, I use ATL/WTL.<br><br>ATL (Active Template Library) was created to build *small* DLL/COM objects which could be downloaded on the net (even using dialup)... it has wizard project support under VC, and once you have created the empty DLL, you just don't add any COM interfaces/objects. :)<br><br>WTL (Windows Template Library) is more of an [unofficial] statement of what MFC could (should?) have been... template-based class wrappers around many of the Windows controls and objects actually handle a great deal of what most people use MFC for - without the incredible bloat!<br><br>With care, either or both may be used to construct *small* (4k-8k) libraries/executables without runtime library (or exception handling) support.<br><br>The downside (for some) is probably that these are Microsoft-based tools... ATL comes with VC, while WTL is available as a free download (with very little documentation).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">4th October 2003 01:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">ok, with the fuction that come with the above zip:<br></p><pre>
<code><br>void __declspec(dllexport) myFunction(HWND hwndParent, int string_size, char *variables, stack_t **stacktop)<br>{<br>  EXDLL_INIT();<br>  {<br>    char buf[1024];<br>    popstring(buf);<br>    MessageBox(hwndParent,buf,0,MB_OK);<br>  }<br>}<br></code>
</pre><br>
      How can I input or output values?
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">4th October 2003 13:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">With popstring and pushstring. They work on the NSIS stack which is controlled by Push, Pop and Exch in the script.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br>
      <span class="post-time small text-muted">4th October 2003 20:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks I'll give it a try :)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br>
      <span class="post-time small text-muted">4th October 2003 21:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok. I almost got it. I have this:<br></p>
      <pre>
<code><br>char buf[1024];<br>char buf2[1024];<br>popstring(buf);<br>popstring(buf2);<br>MessageBox(hwndParent,buf,0,MB_OK);<br>MessageBox(hwndParent,buf2,0,MB_OK);<br></code>
</pre><br>
      Works great. It display the Two MessageBoxes with MB_YESNO and the MB_ICONINFORMATION.<br>
      These are my questions:<br>
      1. How can I input numeric (int or double) values, since the popstring is char?<br>
      2. How can I output values? Since Button "Yes" is 6 and Button "No" is 7.<br>
      Thanks. :)
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dselkirk</span><br>
      <span class="post-time small text-muted">4th October 2003 23:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Here is an example:<br>
      <br></p>
      <pre>
<code><br>static buf[1024];<br>int num;<br>popstring(buf); //get number string<br>num = my_atoi(buf); //convert to number<br>wsprintf(buf,"%d",num); //convert number back to string<br>pushstring; //output number string<br></code>
</pre><br>
      <br>
      The my_atoi function is available from the nsexec plugin.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br>
      <span class="post-time small text-muted">5th October 2003 16:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok. One more time. :) I have this:<br></p>
      <pre>
<code><br>int num1;<br>int num2;<br>int ret;<br>char *ok;<br>int decimal, sign;<br><br>/* .... */<br><br>char buf1[1024];<br>char buf2[1024];<br>num1 = atoi(buf1);<br>num2 = atoi(buf2);<br>ret = num1 + num2;<br>ok = fcvt(ret,1, &amp;decimal, &amp;sign);<br>popstring(ok);<br>MessageBox(hwndParent,ok,"Hola",64);<br></code>
</pre><br>
      If I put:<br>
      <pre>
<code><br>MyDLL::Test "5" "3"<br></code>
</pre><br>
      In the MessageBox ok is equal to "5", when is suppose to be "8". Why doesn't make the op. "5+3"
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DrO</span><br>
      <span class="post-time small text-muted">5th October 2003 16:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">use <b>wsprintf(ok,"%d",ret);</b> and change char* ok to char ok[8].<br>
      <br>
      that should work<br>
      <br>
      -daz<br>
      <br>
      [edit] you don't need the fcvt(..) part with the change [/edit]</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br>
      <span class="post-time small text-muted">5th October 2003 17:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks DrO. :) With this:<br></p>
      <pre>
<code><br>char buf1[1024];<br>char buf2[1024];<br>popstring(buf1);<br>popstring(buf2);<br>num1 = atoi(buf1);<br>num2 = atoi(buf2);<br>ret = num1 + num2;<br>wsprintf(ok,"%d",ret); <br>MessageBox(hwndParent,ok,"Hola",64);<br></code>
</pre><br>
      Now I'm going to output the value of the press messagebox button, for example: OK=1; YES=6; NO=7. The return value must be in a $(0..9), any ideas? :)
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DrO</span><br>
      <span class="post-time small text-muted">5th October 2003 17:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">try this:<br>
      <br>
      char buf1[1024];<br>
      char buf2[1024];<br>
      int ret;<br>
      popstring(buf1);<br>
      popstring(buf2);<br>
      wsprintf(ok,"%d",atoi(buf1)+atoi(buf2));<br>
      ret = MessageBox(hwndParent,ok,"Hola",64);<br>
      wsprintf(buf1,"%d",ret);<br>
      pushstring(buf1); // should put the return value into $0<br>
      <br>
      -daz</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br>
      <span class="post-time small text-muted">5th October 2003 17:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks dude :) :up:<br>
      Now I think that I can take it from here :confused: --&gt; :p</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DrO</span><br>
      <span class="post-time small text-muted">5th October 2003 17:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">no problem ;)<br>
      <br>
      -daz</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br>
      <span class="post-time small text-muted">5th October 2003 17:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, one more :rolleyes:<br>
      Since is<br></p>

      <blockquote>
        pushstring(buf1); // should put the return value into $0
      </blockquote>How can I change the value of the stack, I mean in this example is <b>$0</b> is the default, how can change it... mmm, let's say to <b>$5</b>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">5th October 2003 19:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I thought that pushstring will not replace anything on the stack, just add an item to the stack, so the user will have to pop multiple times to get all the stack strings.<br>
      <br>
      Wouldn't the user just have to Pop $5<br>
      <br>
      Edit: But then again, I don't know any C++/Delphi, so I'm probably wrong.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">DrO</span><br>
      <span class="post-time small text-muted">6th October 2003 11:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">think it's setuservariable (or something to that name) in exdll.h and from what i understand it will allow you to set $5 based on the id from the enum list you use.<br>
      <br>
      can't check this for sure at the moment but think that's the push in the right direction.<br>
      <br></p>

      <blockquote>
        I thought that pushstring will not replace anything on the stack, just add an item to the stack, so the user will have to pop multiple times to get all the stack strings.
      </blockquote>that's how i'd take it as well<br>
      <br>
      -daz
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br>
      <span class="post-time small text-muted">9th October 2003 01:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm stuck in here:<br></p>
      <pre>
<code><br>float myret;<br>float num1;<br>float num2;<br>char ok[1024];<br><br>void __declspec(dllexport) Add(HWND hWnd, int string_size, char *variables, stack_t **stacktop)<br>{<br>EXDLL_INIT();<br>{<br>char n1[1024];<br>char n2[1024];<br>popstring(n1);<br>popstring(n2);<br>num1 = atof(n1);<br>num2 = atof(n2);<br>myret = num1 + num2;<br>//gcvt(myret,3,ok);<br>sprintf(ok,"%g",myret);<br>MessageBox (hWnd, ok, "Atención", 0 + MB_ICONASTERISK);<br>}<br>}<br></code>
</pre><br>
      if I used this:<br>
      <pre>
<code><br>MyDLL::Add "5" "2"<br></code>
</pre><br>
      the <b>ok</b> returns this: <b>2.48085e+006</b> :igor:<br>
      I'm trying to read "float numbers" like "5" and "5.6" to make the op. like <b>5+5.56</b>.<br>
      Any ideas?
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">9th October 2003 11:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What's %g? Don't you mean %f? printf also has options you can put between % and f. See printf's readme for more information about setting the output precision.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br>
      <span class="post-time small text-muted">9th October 2003 23:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok. I'm trying again. Thanks :)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br>
      <span class="post-time small text-muted">10th October 2003 00:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well... This could be "it".<br>
      I have this now:<br></p>
      <pre>
<code><br>char n1[1024];<br>char n2[1024];<br>char ret[1024];<br>popstring(n1);<br>popstring(n2);<br>num1 = atof(n1);<br>num2 = atof(n2);<br>myret = num1 + num2;<br>gcvt (myret,10,ok);<br>MessageBox (hWnd, ok, "Atención", 0 + MB_ICONASTERISK);<br>popstring(ret);<br>if (ret == "Yes") MessageBox (hWnd, "Esta es para $0" , "Hola!", 0);<br>if (ret == "No") MessageBox (hWnd, "Esta es para $1" , "Hola", 0);<br></code>
</pre><br>
      With this Nsis code:<br>
      <pre>
<code><br>MyDLL::Add "3.150" "-1.134" "No"<br>Quit<br></code>
</pre><br>
      The plugin successfully do the operation. :up:<br>
      But it doesn't show the second Messagebox, anyone know why?
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">10th October 2003 00:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can't compare strings like that. Use strcmp or anyone of its varients.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br>
      <span class="post-time small text-muted">10th October 2003 23:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Kichik, that was it :D</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br>
      <span class="post-time small text-muted">11th October 2003 22:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just to say thanks to all the people who help me creating a plugin.<br>
      It's almost done. It's based in the concept of Math.dll, with a spanish style :p ;).<br>
      Thanks to all the people of this thread and brainsucker :).<br>
      It's more like a doubt. When the compiler (makensisw.exe) reads the script, it has something like this in the log:<br></p>
      <pre>
<code><br>Processing plugin dlls: "C:\lobolunar\dev\nsis\plugins\*.dll"<br> - Banner::destroy<br> - Banner::show<br> - LangDLL::LangDialog<br>...<br></code>
</pre><br>
      In my plugin I have some functions that I don't wanna show in the log... so...how do you do that....
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">12th October 2003 11:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Functions that should not be accessible to the user shouldn't be of the following format:<br>
      <br>
      void __declspec(dllexport) functionName(HWND hwndParent, int string_size, char *variables, stack_t **stacktop)</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br>
      <span class="post-time small text-muted">12th October 2003 16:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">mmm...Yes I think of that, but still...<br>
      Look, I'm attaching the source code of my first version.<br>
      In MathOpH.h has the function that I don't wanna show.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">12th October 2003 16:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Remove the functions you don't want exported from dll.def.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joel</span><br>
      <span class="post-time small text-muted">12th October 2003 16:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">mmmmm, how? :rolleyes:<br>
      /edit... I discovered :D Thanks :up: /</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>