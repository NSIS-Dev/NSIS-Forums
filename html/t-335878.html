<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Directory page help!" />

  <title>Directory page help! - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Directory page help!</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=335878">Directory page help!</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Aaskilde</span><br />
      <span class="post-time small text-muted">12th October 2011 13:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Directory page help!</strong><br />
      Hi,<br />
      <br />
      I need to create an installer that show a defined path from the registry, but if that path is incorrect the user needs to be able to point to the correct install path.<br />
      <br />
      As far as i know the MUI_DIRECTORYPAGE_VARIABLE is the one that i should use to get the path from the registry but as it is i can't get it to work, any help?<br />
      <br />
      ;Directory Page<br />
      !define MUI_DIRECTORYPAGE_TEXT_TOP "Opus Neo Installer"<br />
      !define MUI_DIRECTORYPAGE_TEXT_DESTINATION "The default install location"<br />
      !define MUI_DIRECTORYPAGE_VARIABLE ReadRegStr $0 HKLM "SOFTWARE\Lotus\Domino\1" "DataPath"<br />
      !define MUI_DIRECTORYPAGE_VERIFYONLEAVE</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">12th October 2011 14:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">MUI_DIRECTORYPAGE_VARIABLE is only used to define a variable name other than $INSTDIR.<br />
      <br />
      You can use it like this:<br />
      <br />
      Var $folder<br />
      !define MUI_DIRECTORYPAGE_VARIABLE $folder<br />
      function .onInit<br />
      ReadRegStr $folder HKLM "SOFTWARE\Lotus\Domino\1" "DataPath"<br />
      functionend</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">12th October 2011 15:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Why not just use InstallDirRegKey?<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">13th October 2011 08:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">From what I understand, he/she wants the user to confirm the path before it's used.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Aaskilde</span><br />
      <span class="post-time small text-muted">13th October 2011 13:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by MSG</small><br />
        MUI_DIRECTORYPAGE_VARIABLE is only used to define a variable name other than $INSTDIR.<br />
        <br />
        You can use it like this:<br />
        <br />
        Var $folder<br />
        !define MUI_DIRECTORYPAGE_VARIABLE $folder<br />
        function .onInit<br />
        ReadRegStr $folder HKLM "SOFTWARE\Lotus\Domino\1" "DataPath"<br />
        functionend
      </blockquote>MSG thanks that work perfect i just had to change it just a bit at the "Var $folder" to this:<br />
      Var folder(Without the $)<br />
      <br />
      So know i get my installer that pulls the path from the registry, and if there is no path in the registry the users can Browse after the right one. Is there anyway to disable the "Install" button if the directory path is empty?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">13th October 2011 14:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can probably use .onVerifyInstDir .<br />
      <a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.7.2.1.2" target="_blank">http://nsis.sourceforge.net/Docs/Cha...html#4.7.2.1.2</a><br />
      <br />
      Or just throw a messagebox error with abort in the page's LEAVE function.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Aaskilde</span><br />
      <span class="post-time small text-muted">13th October 2011 15:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Okay if i remove the !define MUI_DIRECTORYPAGE_VERIFYONLEAVE i can't install unless there is a path.<br />
      <br />
      But as i now works with the code i got from MSG something is wrong in my script. I get an error if i try and install it in a directory when i use the browse button this is after i used the directory page.<br />
      <br />
      Can you find anything there could cause this problem?<br />
      <br />
      #neodashboard<br />
      !include MUI2.nsh<br />
      !include nsDialogs.nsh<br />
      !include LogicLib.nsh<br />
      <br />
      outFile "Neo.Dashboard 4.3 Directory_Test Setup.exe"<br />
      <br />
      Name "Neo.Dashboard 4.3"<br />
      <br />
      ;General Page settings<br />
      !define MUI_PAGE_HEADER_TEXT "License Agreement"<br />
      !define MUI_PAGE_HEADER_SUBTEXT "Please review the terms before installing Neo.Dashboard 4.3"<br />
      <br />
      <br />
      <br />
      ;Headerimage<br />
      !define MUI_HEADERIMAGE<br />
      !define MUI_HEADERIMAGE_BITMAP "Installer150x57.bmp"<br />
      !define MUI_ABORTWARNING<br />
      <br />
      <br />
      ;License Page<br />
      #!define MUI_LICENSEPAGE_TEXT_TOP "Please review the license terms below before installing Neo.Dashboard 4.3"<br />
      !define MUI_LICENSEPAGE_CHECKBOX<br />
      #!define MUI_LICENSEPAGE_CHECKBOX_TEXT "Check here if you agree with the terms"<br />
      <br />
      <br />
      ;Finish Page<br />
      !define MUI_FINISHPAGE_TITLE "Installation Completed"<br />
      !define MUI_FINISHPAGE_TITLE_3LINES<br />
      !define MUI_FINISHPAGE_TEXT "Neo.Dashboard 4.3 has been installed successfully$\r$\nClick Finish to exit the wizard."<br />
      !define MUI_FINISHPAGE_NOAUTOCLOSE<br />
      !define MUI_FINISHPAGE_CANCEL_ENABLED<br />
      !define MUI_FINISHPAGE_BUTTON "Finish"<br />
      !define MUI_FINISHPAGE_SHOWREADME "https://qen.workplace.dk/LotusQuickr/neodoc/Main.nsf/h_Toc/1d2f160d62a78c9cc1257745002a1bad/?OpenDocument"<br />
      !define MUI_FINISHPAGE_SHOWREADME_TEXT "Check this box if you want to open the documentation"<br />
      !define MUI_FINISHPAGE_SHOWREADME_NOTCHECKED<br />
      !define MUI_FINISHPAGE_LINK "www.opusneo.com"<br />
      !define MUI_FINISHPAGE_LINK_LOCATION "http://www.opusneo.com"<br />
      !define MUI_FINISHPAGE_LINK_COLOR "E56E1F"<br />
      <br />
      <br />
      ;Welcome Page<br />
      !define MUI_WELCOMEPAGE_TITLE "Welcome to the installation wizard for Neo.Dashboard 4.3"<br />
      !define MUI_WELCOMEPAGE_3LINES<br />
      !define MUI_WELCOMEPAGE_TEXT "The installation wizard will unpack all the necessary files for Neo.Dashboard 4.3 on your server. To continue, click Next$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\nWARNING: This program is protected by copyright law and international treaties"<br />
      !define MUI_WELCOMEFINISHPAGE_BITMAP "Installer164x314.bmp"<br />
      #!define MUI_BGCOLOR "000000"<br />
      !define MUI_WELCOMEFINISHPAGE_BITMAP_NOSTRETCH<br />
      <br />
      ;Installation Page<br />
      !define MUI_INSTFILESPAGE_FINISHHEADER_TEXT "The installation of neodashboard has been completed"<br />
      #!define MUI_INSTFILESPAGE_FINISHHEADER_SUBTEXT "OPUSNEO"<br />
      !define MUI_INSTFILESPAGE_ABORTHEADER_TEXT "THE INSTALLATION HAVE BEEN ABORTED"<br />
      !define MUI_INSTFILESPAGE_ABORTHEADER_SUBTEXT "Please contact Opus neo support"<br />
      #!define MUI_INSTFILESPAGE_COLORS "E56E1F 000000"<br />
      !define MUI_INSTFILESPAGE_COLORS "FFFFFF FF8407"<br />
      #!define MUI_INSTFILESPAGE_PROGRESSBAR "colored"<br />
      !define MUI_INSTALLCOLORS "E56E1F"<br />
      <br />
      ;Directory Page<br />
      !define MUI_DIRECTORYPAGE_TEXT_TOP "Neo.Dashbord 4.3 installer:$\r$\n$\rBy default the installation path is taken from the registry database$\r$\n$\rIf the destination is empty, you can select the destination by clicking on Browse and select your Domino data folder. In example C:\IBM\Lotus\Domino\data"<br />
      !define MUI_DIRECTORYPAGE_TEXT_DESTINATION "Destination:"<br />
      ;!define MUI_DIRECTORYPAGE_VERIFYONLEAVE<br />
      <br />
      <br />
      Var folder<br />
      !define MUI_DIRECTORYPAGE_VARIABLE $folder<br />
      function .onInit<br />
      ReadRegStr $folder HKLM "SOFTWARE\Lotus\Domino\1" "DataPath"<br />
      functionend<br />
      <br />
      <br />
      !define MUI_ICON "neodashboard.ico"<br />
      <br />
      <br />
      ;Interface Pages<br />
      !insertmacro MUI_PAGE_WELCOME<br />
      !insertmacro MUI_PAGE_LICENSE "Program License Agreement.rtf"<br />
      !insertmacro MUI_PAGE_DIRECTORY<br />
      ;Page custom InstallDirectory<br />
      !insertmacro MUI_PAGE_INSTFILES<br />
      !insertmacro MUI_PAGE_FINISH<br />
      <br />
      <br />
      !insertmacro MUI_LANGUAGE "English"<br />
      <br />
      <br />
      <br />
      section "html"<br />
      <br />
      ReadRegStr $0 HKLM "SOFTWARE\Lotus\Domino\1" "DataPath"<br />
      <br />
      setOutPath $0\domino\html<br />
      <br />
      file /r opusneo_html\*.*<br />
      <br />
      sectionEnd<br />
      <br />
      section "data"<br />
      <br />
      ReadRegStr $0 HKLM "SOFTWARE\Lotus\Domino\1" "DataPath"<br />
      <br />
      setOutPath $0<br />
      <br />
      file /r opusneo_data\*.*<br />
      <br />
      sectionEnd<br />
      <br />
      section "ntf"<br />
      <br />
      ReadRegStr $0 HKLM "SOFTWARE\Lotus\Domino\1" "DataPath"<br />
      <br />
      setOutPath $0<br />
      <br />
      file /r opusneo_ntf\*.*<br />
      <br />
      <br />
      sectionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">13th October 2011 15:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">In the sections you're not using the path the user entered. You're once again trying to read it from registry.<br />
      <br />
      (Also note that if you have no normal directory page, you don't need to use a separate variable for it. You can simply use the default $INSTDIR variable.)<br />
      <br />
      Oh, and please don't paste large amounts of code. Use an attachment or pastebin.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">13th October 2011 18:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by MSG</small><br />
        From what I understand, he/she wants the user to confirm the path before it's used.
      </blockquote>InstallDirRegKey is exactly the same as using ReadRegStr in .onInit so I don't understand why you don't just use that along with a directory page. Also why use MUI_DIRECTORYPAGE_VARIABLE? Why not just use $INSTDIR?<br />
      <br />
      Stu
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MSG</span><br />
      <span class="post-time small text-muted">14th October 2011 08:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yeah, I was under the mistaken impression he needed a second directory page.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Aaskilde</span><br />
      <span class="post-time small text-muted">19th October 2011 10:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Okay thanks guys that work perfect!<br />
      <br />
      Thanks for the help!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
