<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Uninstall won't do it!" />

  <title>Uninstall won't do it! - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Uninstall won't do it!</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=233094">Uninstall won't do it!</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">badoddbob</span><br />
      <span class="post-time small text-muted">13th December 2005 20:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Uninstall won't do it!</strong><br />
      ...well sort of. I've tried looking through the fourm going back quite a while and have tried various things but to no avail, so hopefully someone can help me.<br />
      <br />
      The software I'm working on needs to install into multiple folders (legacy thing as it's old software) and has to be allowed to install on mapped drives (for Citrix types). So I've set the $INSTDIR to C:\ and added files ond folders from there. So far so good, works like a charm.<br />
      <br />
      But, when I come to undo all of this and uninstall, it gets rid of files, but not the folders. Here's the code:<br />
      <br />
      <font face="courier new"><font size="1">Section "Uninstall"<br />
      ;## If they are set install context to 'All Users'<br />
      SetShellVarContext all<br />
      ;## remove registry keys<br />
      DeleteRegKey ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}"<br />
      SetOutPath $INSTDIR<br />
      ;## remove files.<br />
      SetOutPath "$INSTDIR\CTP"<br />
      Delete "$INSTDIR\CTP\*.*"<br />
      SetOutPath "$INSTDIR\Program Files\The Exchange\Exweb"<br />
      Delete "$INSTDIR\Program Files\The Exchange\Exweb\*.*"<br />
      ;## remove directories used.<br />
      SetOutPath "$INSTDIR\CTP"<br />
      RMDir /r "$INSTDIR\CTP"<br />
      SetOutPath "$INSTDIR\Program Files\The Exchange\Exweb"<br />
      RMDir /r "$INSTDIR\Program Files\The Exchange\Exweb"<br />
      ;## remove shortcut<br />
      Delete "$DESKTOP\Launch Exweb.lnk"<br />
      ;## remove files.<br />
      Delete "$SMPROGRAMS\The Exchange\*.*"<br />
      ;## remove program group<br />
      SetOutPath "$SMPROGRAMS\The Exchange"<br />
      RMDir /r "$SMPROGRAMS\The Exchange"<br />
      SectionEnd</font></font><br />
      <br />
      This has got to be the 30th recompile with minor and major tweaks including a re-wriet of the Uninstall section. But each time, the files go buthe file structure and folders remain.<br />
      <br />
      Yours pleadingly.<br />
      <br />
      Rob</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">13th December 2005 21:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The uninstall won't delete the current directory so try commenting out your SetOutPath lines.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">14th December 2005 01:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Do a setoutpath to \ (backslash) , this is the root in the top of your script before deleting folders<br />
      <br />
      Then leave out all the setoutpaths.<br />
      <br />
      TIP:<br />
      Also close via sendmessage, or forcedkill of running applications still locking a folder and preventing deletion<br />
      <br />
      adding the /REBOOTOK option to RMDis can come in handy.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">badoddbob</span><br />
      <span class="post-time small text-muted">14th December 2005 08:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">OK, amended my code so uit now reads:<br />
      <br />
      <font face="courier new"><font size="1">Section "Uninstall"<br />
      SetOutPath "$INSTDIR\"<br />
      ;## If they are set install context to 'All Users'<br />
      SetShellVarContext all<br />
      ;## remove registry keys<br />
      DeleteRegKey ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}"<br />
      ;## remove files.<br />
      Delete "$INSTDIR\CTP\*.*"<br />
      Delete "$INSTDIR\Program Files\The Exchange\Exweb\*.*"<br />
      Delete "$SMPROGRAMS\The Exchange\*.*"<br />
      ;## remove shortcut<br />
      Delete "$DESKTOP\Launch Exweb.lnk"<br />
      ;## remove directories used.<br />
      RMDir /r "$INSTDIR\CTP"<br />
      RMDir /r "$INSTDIR\Program Files\The Exchange\Exweb"<br />
      ;## remove program group<br />
      RMDir /r "$SMPROGRAMS\The Exchange"<br />
      SectionEnd</font></font><br />
      <br />
      But it still does not work. It removes the desktop shortcut, but still the folders remain.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">badoddbob</span><br />
      <span class="post-time small text-muted">14th December 2005 12:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I think I may have done something n eh code before which has made it break. Can anyone have a quick look and help out?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">14th December 2005 14:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You missunderstood <i>onad</i>.<br />
      SetOutPath "$INSTDIR\" is the same as<br />
      SetOutPath "$INSTDIR"<br />
      This is setting the working directory to $INSTDIR which is why you cannot delete it (because it is locked).<br />
      <br />
      As <i>onad</i> has already mentioned, use:<br />
      SetOutPath "\"<br />
      Or<br />
      SetOutPath "$TEMP"<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">badoddbob</span><br />
      <span class="post-time small text-muted">14th December 2005 15:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Onad and Afrow UK, thanks for the help.<br />
      <br />
      Nearly there now. Still maintains some of the file structure which I can live with for now.<br />
      <br />
      Rob</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
