<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Uninstaller taking out system files"><title>Uninstaller taking out system files - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Uninstaller taking out system files</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=264215">Uninstaller taking out system files</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">tcfred</span><br><span class="post-time small text-muted">23rd January 2007 15:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Uninstaller taking out system files</strong><br>The two files comdlg32.ocx and msstdfmt.dll are required for VB6 and also are in the deployment package for my prog.<br>Thanks to the Nuttall VB6 to NIS Converter, I am as far as I am but these two files are not being incremented on install apparantly.<br><br>in the install section.....<br>ReadRegDWord $Version HKLM "Software\VBGenerator\Pgm" Version<br>IfErrors new_installation &lt;errors? why not 0&gt;<br>StrCpy $ISeeIt 1<br>new_installation....<br>!insertmacro InstallLib REGDLL $ISeeIt REBOOT_PROTECTED \<br>"Support\COMDLG32.OCX" "$SysDir\COMDLG32.OCX" "$SysDir"<br>..and for MSSTDFMT.DLL<br><br>then in the Uninstall section....<br>!insertmacro UnInstallLib REGDLL SHARED REBOOT_PROTECTED "$SysDir\COMDLG32.OCX"<br>..and for MSSTDFMT.DLL<br><br>The removal details show the DLL and OCX each being unregistered and then deleted.<br><br>A leg up on this will be greatly appreciated.<br>tcfred</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">23rd January 2007 15:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Do you properly delete that registry key in the uninstaller? If it stays there, future installers will not increment the share count because they'd think an installer for an older version has already done so for them.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tcfred</span><br><span class="post-time small text-muted">23rd January 2007 18:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The uninstall registry folder was in fact intact after the uninstallation process. Should the Uninstaller section have this line added?<br>DeleteRegKey HKLM "Software\\Micr...\Uninstall\MyProg"<br>...to get rid of the folder that remains?<br>There is also a curious line in the UnInstall details window "Could not find symbol: DllUnregisterServer.<br><br>tcfred</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">23rd January 2007 19:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes, you must use DeleteRegKey in the uninstaller.<br><br>The DllUnregisterServer line means you've tried to unregister a DLL that doesn't require registration.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tcfred</span><br><span class="post-time small text-muted">23rd January 2007 19:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Outstanding. I will fix it up tonight. Thank you for your kind assist.<br><br>tcfred</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">tcfred</span><br><span class="post-time small text-muted">24th January 2007 06:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I ran Uninstaller from Add/Remove<br>MSSTDFMT.DLL, COMDLG32.OCX were again removed from System32 folder.<br><br>Add/Remove entry is eliminated. OK<br>Registery folders properly removed.<br>StartMenu /MyProg folder is still present but is empty.<br>Program Files /MyProg folder contains only uninstaller.<br>_____________<br>Reboot<br>StartMenu folder still there &amp; empty<br>Program Files/MyProg folder still there with uninstaller.<br>_____________<br>I can't see anything in the code that would cause the 2 files to get removed but I am assuming that the installmacros would increment the file count for the 2 DLLs. Could it be that my problem is really with the VB6 Service Pack 6 installation that I am doing to replace the 2 files, and this is not incrementing the related registry from 0 to 1 so when I remove my program, the system thinks that my prog is the only one using them?<br><br>My script is attached if you could see anything else or can see why the SM folder and Program File folder/ uninstaller are not deleting.<br><br>I'm getting this gradually.<br><br>tcfred</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Red Wine</span><br><span class="post-time small text-muted">24th January 2007 06:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>StartMenu folder still there &amp; empty<br>Program Files/MyProg folder still there with uninstaller.</blockquote>Did you add at the bottom of uninstall section,<br>RmDir "$SMPROGRAMS\Myprog"<br>Delete "$INSTDIR\unistaller.exe"<br>RmDir "$INSTDIR"</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">24th January 2007 09:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">tcfred, it's probably because previous uninstallers have already eliminated the reference count for those files. After installing your application again, manually increment the reference count. Then, when you uninstall, the files won't be removed because the reference count won't yet be zero.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="../js/highlight.pack.js" async></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>