<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Include a list during compilation" />

  <title>Include a list during compilation - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Include a list during compilation</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=279859">Include a list during compilation</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">machiel</span><br />
      <span class="post-time small text-muted">24th October 2007 11:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Include a list during compilation</strong><br />
      Hello,<br />
      <br />
      During setup, I want to edit a number of installed files (e.g. to adjust the path inside these files). I would like the list of files to be edited to be configurable (i.e.,<br />
      not hardcoded in my main code, but listed in another file<br />
      e.g. "editscripts.nsh"). Preferably, I want to include<br />
      this list during compilation of the setup executable.<br />
      <br />
      With the following code, I can do this, but I wondered<br />
      whether there is some simpler way.<br />
      <br />
      (Another way would be to have a file "editscripts.dat"<br />
      that contains these filenames, and simply read this file<br />
      during execution of the setup, but I prefer to have<br />
      only one single execution file during setup and not a lot<br />
      of datafiles on the side).<br />
      <br />
      <font face="courier new"><br />
      ; editscripts.nsh, to be included in main code<br />
      ;<br />
      <br />
      Function ListEditScripts<br />
      <br />
      ; donÂ´t quit the next line,<br />
      ; otherwise the loop wonÂ´t stop...<br />
      Push ""<br />
      ; The list of files to be edited:<br />
      Push "myfiles\commandline.bat"<br />
      Push "myfiles\commandline.config"<br />
      Push "myfiles\utils\util.bat"<br />
      Push "myfiles\utils\util.config"<br />
      <br />
      FunctionEnd<br />
      <br />
      Function GetNextEditScript<br />
      <br />
      Call ListEditScripts<br />
      loop:<br />
      Pop $0<br />
      MessageBox MB_OK "Var 0 is $0"<br />
      StrCmp $0 "" endloop loop<br />
      endloop:<br />
      <br />
      FunctionEnd<br /></font></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pospec</span><br />
      <span class="post-time small text-muted">24th October 2007 11:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Maybe this could help you (?) - put these lines to somefile.nsi (.nsh):<br />
      <br />
      <font face="courier new">Push "myfiles\commandline.bat"<br />
      Push "myfiles\commandline.config"<br />
      Push "myfiles\utils\util.bat"<br />
      Push "myfiles\utils\util.config"</font><br />
      <br />
      and replace them in ListEditScripts functions with <font face="courier new">!include 'somefile.nsi'</font>. Something says me that this is not exactly what you want :rolleyes:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">machiel</span><br />
      <span class="post-time small text-muted">24th October 2007 11:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, actually, that is what I do now.<br />
      The code I showed I put in "somefile.nsi" and in my main<br />
      code "maincode.nsi" I do the include.<br />
      But I would like the code in "somefile.nsi" to be simpler.<br />
      In other words: I would like to get rid of all the 'push'<br />
      bit (and the 'push "" ' bit).<br />
      Thank you anyway.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pospec</span><br />
      <span class="post-time small text-muted">24th October 2007 12:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You <i>prefer to have only one single execution file during setup and not a lot of datafiles on the side</i>. If you <font face="courier new">!include</font> a file to NSIS script then you don't need it during setup.<br />
      OK, no problem to <i>get rid of all the 'push'</i>. Then you must parse your filelist from some file. You can do this:</p>

      <ul>
        <li>By NSIS: First do <font face="courier new">Push ""</font>. Then iterate over lines of the filelist and <font face="courier new">Push</font> every line. You don't need this filelist during setup, only during compilation of NSIS script.</li>

        <li>By SED, AWK or something else.</li>
      </ul>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pospec</span><br />
      <span class="post-time small text-muted">24th October 2007 12:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Example</strong><br />
      <font face="courier new">!define filename 'example.txt'<br />
      <br />
      name "example"<br />
      <br />
      outfile "example.exe"<br />
      <br />
      setcompressor lzma<br />
      <br />
      !include "logiclib.nsh"<br />
      <br />
      page instfiles<br />
      <br />
      section ""<br />
      fileopen $0 ${filename} r<br />
      ${do}<br />
      fileread $0 $1<br />
      messagebox mb_ok $1<br />
      ${loopuntil} $1 == ''<br />
      fileclose $0<br />
      sectionend</font></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">machiel</span><br />
      <span class="post-time small text-muted">24th October 2007 12:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I guess what I donÂ´t see is how to do "Then iterate over lines of the filelist" during compilation.<br />
      When I create a custom page, e.g.:<br />
      Page custom EditMyFiles<br />
      and do as you suggest inside "EditMyFiles" (iterate over the filelist), this will only happen during execution time, not during compilation. Indeed, in this case, my filelist.dat can be simply:<br />
      filename1<br />
      filename2<br />
      <br />
      On the other hand, if I do it by means of "!include somefile.nsh", then inside somefile.nsh I cannot simply have a list of files, I have to present them there with<br />
      Push "filename1"<br />
      Push "filename2"</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">machiel</span><br />
      <span class="post-time small text-muted">24th October 2007 12:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">In the code example, the fileread loop is done during execution of example.exe, not during creation of example.exe.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pospec</span><br />
      <span class="post-time small text-muted">24th October 2007 12:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Then you should do "pre-build step" (using sed or awk) and "translate" simple filelist into the <font face="courier new">Push</font>-filelist. And <font face="courier new">!include</font> this new one :up:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pospec</span><br />
      <span class="post-time small text-muted">24th October 2007 12:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just for your info - this is my way how I "build" setups. Simple batch file:<br />
      <br />
      <font face="courier new">call get_files_CD.bat<br />
      echo !define VERZE_CD &gt; DDVerze.nsi<br />
      echo !define DDVERZE 'CD' &gt;&gt; DDVerze.nsi<br />
      ..\common\get_time.exe "!define DATUM_VYROBY" &gt;&gt; DDVerze.nsi<br />
      <b>makensis install.nsi</b><br />
      pause<br /></font></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">machiel</span><br />
      <span class="post-time small text-muted">24th October 2007 12:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, thatÂ´s a good idea. Instead of directly compiling the nsi code, do some sed/awk stuff first to create the necessary include files.<br />
      I might go and do just that.<br />
      Many thanks for the help.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
