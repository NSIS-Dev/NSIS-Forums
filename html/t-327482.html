<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="pass a variable to a macro"><title>pass a variable to a macro - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">pass a variable to a macro</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=327482">pass a variable to a macro</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">nadigo</span><br><span class="post-time small text-muted">17th February 2011 15:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>pass a variable to a macro</strong><br>Hi,<br><br>I am trying to pass a variable to a macro and have the macro have a condition based on that variable.<br>I tried usign VAR and !define and it didnt work.<br><br>I need to have the macro do different things based on the variables sent to it.<br>how can I do it ?<br><br>this will not work:<br><br>Var /GLOBAL XYZ<br>StrCpy $XYZ "New"<br>MessageBox MB_OK "$XYZ" ; I get "New"<br>!define CONST_XYZ "$XYZ" ; not working<br><br><br>insertmacro MACRO_TEST $XYZ ; Not working<br><br>!insertmacro MACRO_TEST "${$XYZ}" ; not wokring<br><br><br><br>!macro MACRO_TEST varXYZ<br><br>!If ${varXYZ} != "New"<br><br>;....<br>!endif<br><br>!macroend</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">17th February 2011 15:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I've said this countless times and no doubt I will have to carry on saying it. You are confusing run time (variables) with compile time (macros, defines etc). Hopefully I need not say any more...<br><br>Edit: Tip; ${If} not !if.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">nadigo</span><br><span class="post-time small text-muted">17th February 2011 16:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">the problem is that I have a VAR and I want to pass it to the macro.<br><br>VAR XYZ "New"<br>!define XYZ_CON "$XYZ"<br><br>!insertmacro SEARCH_OFFERING "${XYZ_CON}"<br>!insertmacro SEARCH_OFFERING "$XYZ"<br>!insertmacro SEARCH_OFFERING $XYZ<br><br>none of the above will compile as<br><br>!insertmacro SEARCH_OFFERING "New"<br><br>why ???</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">demiller9</span><br><span class="post-time small text-muted">17th February 2011 17:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Why?? Because the macro is compiled long before the code is run. The variable doesn't have a value until the code is run; the macro cannot be compiled with a value that does not exist.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jiake</span><br><span class="post-time small text-muted">18th February 2011 02:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I thought that you are abusing or misapplying some commands. Like Afrow UK &amp; demiller9 said, the commands start with an exclamation are compiling commands. They are only used to tell compiler which lines to compile. The macro is similar, it will be expanded. Thought you see maro is short when using in script, but in fact the script is the same.<br><br>Example 1:<br>!define VAR1 AAA<br>!define VAR2 ${VAR1}BBB<br>Equals to you !define VAR2 AAABBB<br><br>Example 2:<br>!macro MYMACRO PARAM1 PARAM2 PARAM3<br>MessageBox MB_OK `${PARAM1}`<br>MessageBox MB_YESNO `${PARAM2}`<br>MessageBox MB_OKCANCEL `${PARAM3}`<br>!macroend<br>When using:<br>!insertmacro MYMACRO A B C<br>!insertmacro MYMACRO D E F<br>It completely equals to 6 lines:<br>MessageBox MB_OK `A`<br>MessageBox MB_YESNO `B`<br>MessageBox MB_OKCANCEL `C`<br>MessageBox MB_OK `D`<br>MessageBox MB_YESNO `E`<br>MessageBox MB_OKCANCEL `F`<br><br>In NSIS script, !define and !macro command only replace the text simplely, except some especial pre-defined constants, like !define a constant to %x with "/date" option. The command !define is commonly used to define a name to a fixed constant value, so that you can remember it easily rather than an irregular value, or define a value that used in your script mutiple times. This is almost the same to C++.<br><br>Define a easy-remembered name:<br>!define WM_CLOSE 0x0010<br>Modify this line will change all values of ${PI} in script rather than modify every one:<br>!define PI 3.14<br><br>Fisrt, "var" command can't assign a value.<br>VAR XYZ "New"<br>Second, you define XYZ_CON to $XYZ means tell the compiler that the value of constant ${XYZ_CON} is $XYZ.<br>!define XYZ_CON "$XYZ"<br><br>So when compiling the !insertmacro SEARCH_OFFERING "${XYZ_CON}" line, ${XYZ_CON} would be replaced with $XYZ simplely. That is the following 3 lines are the same.<br>!insertmacro SEARCH_OFFERING "${XYZ_CON}"<br>!insertmacro SEARCH_OFFERING "$XYZ"<br>!insertmacro SEARCH_OFFERING $XYZ</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jiake</span><br><span class="post-time small text-muted">18th February 2011 06:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">To pass variables to a macro, you can use CallArtificialFunciton macro in Util.nsh, or use a function call, and you must use NSIS stack for exchange values.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>