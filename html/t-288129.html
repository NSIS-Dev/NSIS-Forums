<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="RichEdit with nsDialogs?" />

  <title>RichEdit with nsDialogs? - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">RichEdit with nsDialogs?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=288129">RichEdit with nsDialogs?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vbguy</span><br />
      <span class="post-time small text-muted">8th March 2008 01:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>RichEdit with nsDialogs?</strong><br />
      I can't seem to figure out how to add a RichEdit control with nsDialogs. I've tried<br />
      <br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #0000BB">nsDialogs</span><span style="color: #007700">::</span><span style="color: #0000BB">CreateControl</span><span style="color: #007700">/</span><span style="color: #0000BB">NOUNLOADRICHEDIT_CLASS</span><span style="color: #007700">${</span><span style="color: #0000BB">WS_VISIBLE</span><span style="color: #007700">}|${</span><span style="color: #0000BB">WS_CHILD</span><span style="color: #007700">}|${</span><span style="color: #0000BB">WS_TABSTOP</span><span style="color: #007700">}|${</span><span style="color: #0000BB">WS_VSCROLL</span><span style="color: #007700">}|${</span><span style="color: #0000BB">ES_MULTILINE</span><span style="color: #007700">}|${</span><span style="color: #0000BB">ES_WANTRETURN</span><span style="color: #007700">}${</span><span style="color: #0000BB">__NSD_Text_EXSTYLE</span><span style="color: #007700">}</span><span style="color: #0000BB">010u100</span><span style="color: #007700">%</span><span style="color: #0000BB">90u</span><span style="color: #DD0000">''<br />
      <br /></span> <span style="color: #0000BB">Pop$txtLicense<br /></span></span> <!-- php buffer end -->
      <hr />
      But nothing shows. I tried looking at the MUI2 header files, but those are no cakewalk to read. I also glanced at the nsDialogs source files, but that lead me no closer to an answer.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">8th March 2008 08:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">RICHEDIT_CLASS is not the real name, try "RICHEDIT" or "RichEdit20A"</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vbguy</span><br />
      <span class="post-time small text-muted">8th March 2008 08:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks, RichEdit20A worked.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bradharding</span><br />
      <span class="post-time small text-muted">11th March 2008 08:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi!<br />
      <br />
      Now that I know how to create a richedit control using nsDialogs - thanks for that - how would I go about loading an .rtf file into the control using the system plugin?<br />
      <br />
      Thanks in advance.<br />
      <br />
      Brad.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">11th March 2008 11:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://forums.winamp.com/showthread.php?postid=1812482#post1812482" target="_blank">http://forums.winamp.com/showthread....82#post1812482</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bradharding</span><br />
      <span class="post-time small text-muted">11th March 2008 11:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for your response, Anders.<br />
      <br />
      The thread you've linked to though has example code that, as best as I can tell, only streams text into the control. Is there any [easy] way to load an actual Rich Text File into the control? I've tried googling for a Windows API command that can do it, but with no luck...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">11th March 2008 11:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">its the same message (<a href="http://msdn2.microsoft.com/en-us/library/bb774302(VS.85).aspx" target="_blank">http://msdn2.microsoft.com/en-us/lib...02(VS.85).aspx</a> )<br />
      <br />
      just use SF_RTF (2)<br />
      <br />
      and easy? there is no such thing when the system plugin is involved ;)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bradharding</span><br />
      <span class="post-time small text-muted">11th March 2008 11:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks again! I'll give it a go.... :D</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vbguy</span><br />
      <span class="post-time small text-muted">11th March 2008 12:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I just use this to load the RTF data. The article states '.txt' files, but RTF are just text files with funky formatting.<br />
      <br />
      http://nsis.sourceforge.net/External_License_file<br />
      <br />
      Also, if you want a thin border on the RichEdit box, just use the WS_EX_STATICEDGE flag instead of __NSD_Text_EXSTYLE.<br />
      <br />
      Here's the full code I use:<br />
      <br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">;</span><span style="color: #0000BB">Licensetextbox</span><span style="color: #007700">(</span><span style="color: #0000BB">richtext</span><span style="color: #007700">)<br />
      <br /></span> <span style="color: #0000BB">nsDialogs</span><span style="color: #007700">::</span><span style="color: #0000BB">CreateControl</span><span style="color: #007700">/</span><span style="color: #0000BB">NOUNLOAD</span><span style="color: #DD0000">"RichEdit20A"</span><span style="color: #007700">${</span><span style="color: #0000BB">WS_VISIBLE</span><span style="color: #007700">}|${</span><span style="color: #0000BB">WS_CHILD</span><span style="color: #007700">}|${</span><span style="color: #0000BB">WS_CLIPSIBLINGS</span><span style="color: #007700">}|${</span><span style="color: #0000BB">WS_TABSTOP</span><span style="color: #007700">}|${</span><span style="color: #0000BB">ES_READONLY</span><span style="color: #007700">}|${</span><span style="color: #0000BB">WS_VSCROLL</span><span style="color: #007700">}|${</span><span style="color: #0000BB">ES_MULTILINE</span><span style="color: #007700">}|${</span><span style="color: #0000BB">ES_WANTRETURN</span><span style="color: #007700">}${</span><span style="color: #0000BB">WS_EX_STATICEDGE</span><span style="color: #007700">}</span><span style="color: #0000BB">010u100</span><span style="color: #007700">%</span><span style="color: #0000BB">90u</span><span style="color: #DD0000">''<br />
      <br /></span> <span style="color: #0000BB">Pop$txtLicense<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">loadthelicensefromfile<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">insertmacroaddLicense<br /></span></span> <!-- php buffer end -->
      <hr />
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bradharding</span><br />
      <span class="post-time small text-muted">11th March 2008 22:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for your help, vbguy! Here's my code:<br />
      <br /></p>
      <pre>
<code>  <br />  nsDialogs::CreateControl /NOUNLOAD "RichEdit20A" ${WS_VISIBLE}|${WS_CHILD}|\<br />    ${WS_TABSTOP}|${WS_VSCROLL}|${ES_MULTILINE}|\<br />    ${ES_WANTRETURN} ${WS_EX_STATICEDGE} 0 15u 100% 80u ""<br />  Pop $CONTROL<br />  File "/oname=$PLUGINSDIR\Readme.rtf" "Resources\Readme.rtf"<br />  System::Call "kernel32::CreateFile(t '$PLUGINSDIR\Readme.rtf', i ${GENERIC_READ}, \<br />    i ${FILE_SHARE_READ}, i 0, i ${OPEN_EXISTING}, i 0, i 0) i .r0"<br />  System::Call "kernel32::GetFileSize(i r0, i 0) i .r1"<br />  MessageBox MB_OK "$1"<br />  IntOp $1 $1 + 1<br />  System::Alloc $1<br />  Pop $2<br />  System::Call "kernel32::ReadFile(i r0, i r2, i r1, *i .r3, i 0)"<br />  System::Call "kernel32::CloseHandle(i r0)"<br />  SendMessage $CONTROL ${WM_SETTEXT} $CONTROL $2<br />  System::Free $2<br /></code>
</pre><br />
      <br />
      Unfortunately, it doesn't display all of the RTF file. I'm guessing this is because of the value that GetFileSize returns, and the additional bytes used for the formatting of the RTF file. I tried using EM_STREAMIN as Anders suggested, but I'm completely lost with that bit of code.... Any further ideas?<br />
      <br />
      Brad.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vbguy</span><br />
      <span class="post-time small text-muted">11th March 2008 22:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You need to replace the hwnd to point to your added text box (or rich text box):<br />
      <br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">Var</span><span style="color: #0000BB">txtLicense</span><span style="color: #007700">;</span><span style="color: #0000BB">textboxhandle<br /></span> <span style="color: #007700">Var</span><span style="color: #0000BB">LicFile</span><span style="color: #007700">;</span><span style="color: #0000BB">pointertothelicensefileinmemory<br />
      <br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">macroaddLicense<br /></span> <span style="color: #007700">${If}</span><span style="color: #0000BB">$LicFile</span><span style="color: #007700">==</span><span style="color: #DD0000">""<br /></span> <span style="color: #0000BB">ClearErrors<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">'kernel32::CreateFile(t"$PLUGINSDIR\\EULA.rtf",i0x80000000,i1,i0,i3,i0,i0)i.r0'<br /></span> <span style="color: #0000BB">IfErrors</span><span style="color: #007700">exit<br />
      <br />
      ;</span><span style="color: #0000BB">allocatememory</span><span style="color: #007700">for</span><span style="color: #0000BB">thefile<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">'kernel32::GetFileSize(ir0,i0)i.r1'<br /></span> <span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Alloc</span><span style="color: #007700">$</span><span style="color: #0000BB">1<br />
      Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">2<br />
      <br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">readthefileintomemory<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">'kernel32::ReadFile(ir0,ir2,ir1,*i.r3,i0)'<br /></span> <span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #DD0000">'kernel32::CloseHandle(ir0)'<br />
      <br /></span> <span style="color: #0000BB">Push</span><span style="color: #007700">$</span><span style="color: #0000BB">2</span><span style="color: #007700">;</span><span style="color: #0000BB">PushtheLicensememorylocationtostack<br />
      Pop$LicFile</span><span style="color: #007700">;</span><span style="color: #0000BB">PoptheLicensememoryloctothevariableLicFile<br /></span> <span style="color: #007700">${EndIf}<br />
      <br />
      ;</span><span style="color: #0000BB">Whitebackground</span><span style="color: #007700">,</span><span style="color: #0000BB">blacktext<br />
      SetCtlColors$txtLicense0x0000000x00FFFFFF<br />
      <br />
      SendMessage$txtLicense</span><span style="color: #007700">${</span><span style="color: #0000BB">WM_SETTEXT</span><span style="color: #007700">}</span><span style="color: #0000BB">0$LicFile<br />
      <br /></span> <span style="color: #007700">exit:<br />
      !</span><span style="color: #0000BB">macroend<br /></span></span> <!-- php buffer end -->
      <hr />
      Then, deallocate the memory when the installer closes:<br />
      <br />
      PHP Code:
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">Function.</span><span style="color: #0000BB">onGUIEnd<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Free$LicFile</span><span style="color: #007700">;</span><span style="color: #0000BB">clearthememoryallocated</span><span style="color: #007700">for</span><span style="color: #0000BB">thelicensefile<br />
      FunctionEnd<br /></span></span> <!-- php buffer end -->
      <hr />
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">11th March 2008 23:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">vbguy: you can't use WM_SETTEXT, it seems to work for some simple rtf files, but not everything</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bradharding</span><br />
      <span class="post-time small text-muted">11th March 2008 23:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks for your help guys.<br />
      <br />
      Anders, any chance you could give us some example code that streams an .rtf file into a richtext control using EM_STREAMIN? Please? Before I lose any more hair? :eek:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">11th March 2008 23:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">no, can't make it work, I end up with the same problem as WM_SETTEXT, the file will not load 100%</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vbguy</span><br />
      <span class="post-time small text-muted">11th March 2008 23:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Anders</i><br />
        <b>vbguy: you can't use WM_SETTEXT, it seems to work for some simple rtf files, but not everything</b>
      </blockquote>You're right, it would likely fail if embedded images. I'd also like to see an example using streaming (if you have time).<br />
      <br />
      <b>Edit:</b> Where in the MUI2 code is the RTF data loaded for the standard license page? Is it done using a C/C++ plugin, or is the file loaded using NSIS code?<br />
      <br />
      Couldn't we just hijack the default code and apply it to the newly created RichEdit box?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bradharding</span><br />
      <span class="post-time small text-muted">12th March 2008 00:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Fixed! It's always something simple that's causing the problem isn't it?<br />
      <br />
      All you have to do is use EM_EXLIMITTEXT to set the size of the rich text control!<br />
      <br /></p>
      <pre>
<code>  ; Show the License.<br />  nsDialogs::CreateControl /NOUNLOAD "RichEdit20A" ${WS_VISIBLE}|${WS_CHILD}|${WS_TABSTOP}|${WS_VSCROLL}|${ES_MULTILINE}|\<br />    ${ES_WANTRETURN} ${WS_EX_STATICEDGE} 0 15u 100% 80u ""<br />  Pop $CONTROL<br />  File "/oname=$PLUGINSDIR\${GNU_GENERAL_PUBLIC_LICENSE}.rtf" "Resources\${GNU_GENERAL_PUBLIC_LICENSE}.rtf"<br />  System::Call "kernel32::CreateFile(t '$PLUGINSDIR\${GNU_GENERAL_PUBLIC_LICENSE}.rtf', i ${GENERIC_READ}, \<br />    i ${FILE_SHARE_READ}, i 0, i ${OPEN_EXISTING}, i 0, i 0) i .r0"<br />  System::Call "kernel32::GetFileSize(i r0, i 0) i .r1"<br />  IntOp $1 $1 + 1<br />  System::Alloc $1<br />  Pop $2<br />  System::Call "kernel32::ReadFile(i r0, i r2, i r1, *i .r3, i 0)"<br />  System::Call "kernel32::CloseHandle(i r0)"<br />  SendMessage $CONTROL ${EM_EXLIMITTEXT} 0 $1<br />  SendMessage $CONTROL ${WM_SETTEXT} 0 $2<br />  System::Free $2<br /></code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">12th March 2008 00:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">that changes nothing, thats only the length, even a rtf file less than 300bytes will not load, atleast not for me</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bradharding</span><br />
      <span class="post-time small text-muted">12th March 2008 00:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That's strange. The RTF file I'm using is about 58Kb. Without sending that EM_EXLIMITTEXT message, it wouldn't display the last quarter of the file. With the message, it displays it fine.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vbguy</span><br />
      <span class="post-time small text-muted">12th March 2008 01:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Anders</i><br />
        <b>that changes nothing, thats only the length, even a rtf file less than 300bytes will not load, atleast not for me</b>
      </blockquote>I just tested your file with the WM_SETTEXT method, and it works for me (even without EM_EXLIMITTEXT message).<br />
      <br />
      Thanks, bradharding, for finding that flag.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">12th March 2008 01:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">alright, I think this works<br /></p>
      <pre>
<code>!define SF_RTF 2<br />!define EM_STREAMIN 1097<br />!define EM_EXLIMITTEXT 1077<br />Function lic<br />FileOpen $4 "test.rtf" r<br />FindWindow $0 "#32770" "" $HWNDPARENT<br />GetDlgItem $0 $0 1000<br />SendMessage $0 ${EM_EXLIMITTEXT} 0 0x7fffffff<br />System::Get /NoUnload "(i, i .R0, i .R1, i .R2) iss"<br />Pop $2<br />System::Call /NoUnload "*(i 0, i 0, k r2) i .r3"<br />System::Call /NoUnload "user32::SendMessage(i r0, i ${EM_STREAMIN}, i ${SF_RTF}, i r3) i.s"<br />loop:<br />        Pop $0<br />        StrCmp $0 "callback1" 0 done<br />        System::Call /NoUnload "kernel32::ReadFile(i $4, i $R0, i $R1, i $R2, i 0)"<br />        Push 0 # callback's return value<br />        System::Call /NoUnload "$2"<br />        goto loop <br />done:<br />System::Free $2<br />System::Free $3<br />FileClose $4<br />FunctionEnd<br /></code>
</pre><br />
      the code is a little bit longer than the WM_SETTEXT code, but it does not alloc the whole file at once, and does not know or care about the filesize at all
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vbguy</span><br />
      <span class="post-time small text-muted">12th March 2008 02:13 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Anders</i><br />
        alright, I think this works<br />
        <br />
        the code is a little bit longer than the WM_SETTEXT code, but it does not alloc the whole file at once, and does not know or care about the filesize at all
      </blockquote>Sweet. Now that all this is known, maybe someone can submit it for inclusion into the nsDialogs.nsh header.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">16th March 2008 20:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You should.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">vbguy</span><br />
      <span class="post-time small text-muted">17th March 2008 20:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by kichik</i><br />
        You should.
      </blockquote>I meant to include it as a built-in part of the nsDialogs. I could include it with my own nsDialogs.nsh file, but I'd just overwrite it the next time I updated to a newer official version.<br />
      <br />
      Also, I think the community would benefit by having all the RichEdit particulars figured out in the nsDialogs.nsh.<br />
      <br />
      I didn't mean to belittle your work.<br />
      <br />
      If you were implying that I should do the work, then I would be glad to. I have just a couple of questions, though:<br />
      <br />
      1. On what version of nsDialogs.nsh do I base my work? The latest svn version, or the latest "stable" version?<br />
      <br />
      2. In what form do I post the results? A patch file or the full file?<br />
      <br />
      3. Where do I post the results? Here, or is there another NSIS developer forum?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">17th March 2008 20:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I misread it as "maybe I should submit it for inclusion" and wanted to encourage you to do so by letting you know I will include it in the next version.<br />
      <br />
      If you wish to make the change and submit it, you should base your work on the latest nsDialogs.nsh from Subversion. But even if you don't, this is not a fundamental change, so a patch for 2.35's version won't be hard to apply.<br />
      <br />
      The best way is to submit a patch to <a href="http://sourceforge.net/tracker/?group_id=22049&amp;atid=373087" target="_blank">patch tracker</a>, but a full file would work as well.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">grundic</span><br />
      <span class="post-time small text-muted">12th May 2009 12:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I made a test file:<br />
      <br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">!include</span><span style="color: #0000BB">nsDialogs</span><span style="color: #007700">.</span><span style="color: #0000BB">nsh<br /></span> <span style="color: #007700">!include</span><span style="color: #0000BB">LogicLib</span><span style="color: #007700">.</span><span style="color: #0000BB">nsh<br />
      <br />
      <br />
      OutFiletest</span><span style="color: #007700">.</span><span style="color: #0000BB">exe<br />
      <br /></span> <span style="color: #007700">Var</span><span style="color: #0000BB">Dialog<br /></span> <span style="color: #007700">Var</span><span style="color: #0000BB">txtLicense<br />
      <br />
      <br />
      PagecustomnsDialog<br />
      <br /></span> <span style="color: #007700">Function</span><span style="color: #0000BB">nsDialog<br />
      nsDialogs</span><span style="color: #007700">::</span><span style="color: #0000BB">Create1018<br />
      Pop$Dialog<br />
      <br /></span> <span style="color: #007700">${If}</span><span style="color: #0000BB">$Dialog</span><span style="color: #007700">==</span><span style="color: #0000BB">error<br />
      Abort<br /></span> <span style="color: #007700">${EndIf}<br />
      <br /></span> <span style="color: #0000BB">nsDialogs</span><span style="color: #007700">::</span><span style="color: #0000BB">CreateControl</span><span style="color: #007700">/</span><span style="color: #0000BB">NOUNLOADRichEdit20A</span><span style="color: #007700">${</span><span style="color: #0000BB">WS_VISIBLE</span><span style="color: #007700">}|${</span><span style="color: #0000BB">WS_CHILD</span><span style="color: #007700">}|${</span><span style="color: #0000BB">WS_TABSTOP</span><span style="color: #007700">}|${</span><span style="color: #0000BB">WS_VSCROLL</span><span style="color: #007700">}|${</span><span style="color: #0000BB">ES_MULTILINE</span><span style="color: #007700">}|${</span><span style="color: #0000BB">ES_WANTRETURN</span><span style="color: #007700">}${</span><span style="color: #0000BB">__NSD_Text_EXSTYLE</span><span style="color: #007700">}</span><span style="color: #0000BB">010u100</span><span style="color: #007700">%</span><span style="color: #0000BB">90u</span><span style="color: #DD0000">''<br /></span> <span style="color: #0000BB">Pop$txtLicense<br />
      <br />
      calllic<br />
      nsDialogs</span><span style="color: #007700">::</span><span style="color: #0000BB">Show<br />
      <br />
      <br />
      FunctionEnd<br />
      <br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineSF_RTF2<br /></span> <span style="color: #007700">!</span><span style="color: #0000BB">defineEM_STREAMIN1097<br /></span> <span style="color: #007700">;!</span><span style="color: #0000BB">defineEM_EXLIMITTEXT1077<br /></span> <span style="color: #007700">Function</span><span style="color: #0000BB">lic<br />
      MessageBoxMB_OK</span><span style="color: #DD0000">"Insidefunction"<br /></span> <span style="color: #0000BB">FileOpen</span><span style="color: #007700">$</span><span style="color: #0000BB">4</span><span style="color: #DD0000">"test.rtf"</span><span style="color: #0000BB">r<br />
      FindWindow</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"#32770"""</span><span style="color: #0000BB">$HWNDPARENT<br />
      GetDlgItem</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">$</span><span style="color: #0000BB">01000<br />
      SendMessage</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">${</span><span style="color: #0000BB">EM_EXLIMITTEXT</span><span style="color: #007700">}</span><span style="color: #0000BB">00x7fffffff<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Get</span><span style="color: #007700">/</span><span style="color: #0000BB">NoUnload</span><span style="color: #DD0000">"(i,i.R0,i.R1,i.R2)iss"<br /></span> <span style="color: #0000BB">Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">2<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #007700">/</span><span style="color: #0000BB">NoUnload</span><span style="color: #DD0000">"*(i0,i0,kr2)i.r3"<br /></span> <span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #007700">/</span><span style="color: #0000BB">NoUnload</span><span style="color: #DD0000">"user32::SendMessage(ir0,i${EM_STREAMIN},i${SF_RTF},ir3)i.s"<br /></span> <span style="color: #0000BB">loop</span><span style="color: #007700">:<br /></span> <span style="color: #0000BB">Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">0<br />
      StrCmp</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"callback1"</span><span style="color: #0000BB">0done<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #007700">/</span><span style="color: #0000BB">NoUnload</span><span style="color: #DD0000">"kernel32::ReadFile(i$4,i$R0,i$R1,i$R2,i0)"<br /></span> <span style="color: #0000BB">Push0</span><span style="color: #FF8000">#callback'sreturnvalue<br /></span> <span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #007700">/</span><span style="color: #0000BB">NoUnload</span><span style="color: #DD0000">"$2"<br /></span> <span style="color: #0000BB">gotoloop<br />
      done</span><span style="color: #007700">:<br /></span> <span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Free</span><span style="color: #007700">$</span><span style="color: #0000BB">2<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Free</span><span style="color: #007700">$</span><span style="color: #0000BB">3<br />
      FileClose</span><span style="color: #007700">$</span><span style="color: #0000BB">4<br />
      FunctionEnd<br />
      <br />
      Section<br />
      <br />
      SectionEnd<br /></span></span> <!-- php buffer end -->
      <hr />
      But nothing was shown in RichEdit. What am I doing wrong?<br />
      Also, anybody say how can I show custom text in RichEdit without using RTF file?<br />
      <br />
      Thanks in advance!
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">grundic</span><br />
      <span class="post-time small text-muted">22nd May 2009 11:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Okay, I find a way to display RTF with aforementioned code. But now I got another problem: if I go back to page with custom RTF, then nothing is shown is RichEdit. I've found, that<br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #0000BB">Pop</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #007700">;&lt;---</span><span style="color: #0000BB">HERE</span><span style="color: #007700">!<br /></span> <span style="color: #0000BB">MessageBoxMB_OK</span><span style="color: #007700">$</span><span style="color: #0000BB">0<br />
      StrCmp</span><span style="color: #007700">$</span><span style="color: #0000BB">0</span><span style="color: #DD0000">"callback1"</span><span style="color: #0000BB">0done<br />
      System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #007700">/</span><span style="color: #0000BB">NoUnload</span><span style="color: #DD0000">"kernel32::ReadFile(i$4,i$R0,i$R1,i$R2,i0)"<br /></span> <span style="color: #0000BB">Push0</span><span style="color: #FF8000">#callback'sreturnvalue<br /></span> <span style="color: #0000BB">System</span><span style="color: #007700">::</span><span style="color: #0000BB">Call</span><span style="color: #007700">/</span><span style="color: #0000BB">NoUnload</span><span style="color: #DD0000">"$2"<br /></span> <span style="color: #0000BB">gotoloop<br /></span></span> <!-- php buffer end -->
      <hr />
      <b>Pop $0 returns 0</b> :cry:<br />
      <br />
      Can anybody help me to solve this issue?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">grundic</span><br />
      <span class="post-time small text-muted">23rd May 2009 09:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've found an other way to solve my problem<br />
      <br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">...<br />
      ...<br />
      ...<br />
      <br /></span> <span style="color: #0000BB">PagecustomCreatePageFinish<br />
      <br /></span> <span style="color: #007700">...<br />
      ...<br />
      ...<br />
      <br />
      Function</span><span style="color: #0000BB">CreatePageFinish<br />
      <br />
      <br />
      nsDialogs</span><span style="color: #007700">::</span><span style="color: #0000BB">Create</span><span style="color: #007700">/</span><span style="color: #0000BB">NOUNLOAD1018<br />
      Pop$DIALOG<br />
      <br />
      nsDialogs</span><span style="color: #007700">::</span><span style="color: #0000BB">CreateControl</span><span style="color: #007700">/</span><span style="color: #0000BB">NOUNLOADRichEdit20A</span><span style="color: #007700">${</span><span style="color: #0000BB">WS_VISIBLE</span><span style="color: #007700">}|${</span><span style="color: #0000BB">WS_CHILD</span><span style="color: #007700">}|${</span><span style="color: #0000BB">WS_TABSTOP</span><span style="color: #007700">}|${</span><span style="color: #0000BB">WS_VSCROLL</span><span style="color: #007700">}|${</span><span style="color: #0000BB">ES_MULTILINE</span><span style="color: #007700">}|${</span><span style="color: #0000BB">ES_WANTRETURN</span><span style="color: #007700">}|${</span><span style="color: #0000BB">ES_READONLY</span><span style="color: #007700">}${</span><span style="color: #0000BB">__NSD_Text_EXSTYLE</span><span style="color: #007700">}</span><span style="color: #0000BB">00100</span><span style="color: #007700">%</span><span style="color: #0000BB">140</span><span style="color: #DD0000">''<br /></span> <span style="color: #0000BB">Pop$RICHEDIT<br />
      <br />
      CustomLicense</span><span style="color: #007700">::</span><span style="color: #0000BB">LoadFile</span><span style="color: #DD0000">"License.rtf"</span><span style="color: #0000BB">$RICHEDIT<br /></span> <span style="color: #007700">;</span><span style="color: #0000BB">CallLoadLicense<br />
      <br /></span> <span style="color: #FF8000">###Radiobuton:autoinstall###<br /></span> <span style="color: #007700">${</span><span style="color: #0000BB">NSD_CreateRadioButton</span><span style="color: #007700">}</span><span style="color: #0000BB">118045015</span><span style="color: #DD0000">"Qickinsall"<br /></span> <span style="color: #0000BB">Pop$RADIO_AUTO<br /></span> <span style="color: #007700">${</span><span style="color: #0000BB">NSD_CreateRadioButton</span><span style="color: #007700">}</span><span style="color: #0000BB">121045015</span><span style="color: #DD0000">"Custominstall"<br /></span> <span style="color: #0000BB">Pop$RADIO_MANUAL<br />
      <br />
      nsDialogs</span><span style="color: #007700">::</span><span style="color: #0000BB">Show<br />
      FunctionEnd<br /></span></span> <!-- php buffer end -->
      <hr />
      Hope, it'll help someone.<br />
      Here is link to the plugin: <a href="http://nsis.sourceforge.net/CustomLicense_plug-in" target="_blank">http://nsis.sourceforge.net/CustomLicense_plug-in</a> ;)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">23rd May 2009 21:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">for what it's worth - I think the actual problem is that callback1 rolls over to callback2 the next time your page is generated.<br />
      <br />
      I'm not sure if there's an appropriate method to prevent that, but you can always make the "callback1" check more dynamic by Pop'ing it into a var first, then Push'ing it back onto the stack, and then compare against that var.<br />
      <br />
      Here's a function + macro + define (I'll post to wiki after review from smarter people):<br />
      <br /></p>
      <pre>
<code><br />/* Check if LoadRTFincluded is defined so that LoadRTF can't be included twice */<br />!ifndef LoadRTFincluded<br /><br />/*<br />    Defines used by LoadRTF<br />*/<br />!ifndef SF_RTF<br />    !define SF_RTF 2<br />!endif<br />!ifndef EM_STREAMIN<br />    !define EM_STREAMIN 1097<br />!endif<br />!ifndef EM_EXLIMITTEXT<br />    !define EM_EXLIMITTEXT 1077<br />!endif<br /><br />/*<br />    LoadRTF Main Function<br />    Inserted via macro for Installer vs Uninstaller<br /><br />    Loads an RTF file into a RichEdit20a control<br /><br />    Thanks to Anders for all the heavy work<br />    Define/Macro/Functionfication and a CallbackN tweak by Animaether<br /><br />    Usage:<br />        Push Path-to-RTF-file<br />        Push HWND-of-RichEdit20A-control<br />        Call LoadRTF<br /><br />        -or for uninstallers-<br />        Call un.LoadRTF<br />*/<br />!macro LoadRTFfunc Un<br />Function ${Un}LoadRTF<br />                            ; RichEdit20A.hwnd RTFilePath.string<br />    Exch $0                 ; $0 RTFilePath.string                  ; $0 = RichEdit20A.hwnd<br />    Exch                    ; RTFilePath.string $0<br />    Exch $1                 ; $1 $0                                 ; $1 = RTFilePath.string<br />    Push $2                 ; $2 $1 $0                              ; $2 : Callback address<br />    Push $3                 ; $3 $2 $1 $0                           ; $3 : EDITSTREAM structure<br />    Push $4                 ; $4 $3 $2 $1 $0                        ; $4 : callbackN identifier from System plugin to check against<br />    Push $R0                ; $R0 $4 $3 $2 $1 $0                    ; $R0 : Buffer that receives data from ReadFile()<br />    Push $R1                ; $R1 $R0 $4 $3 $@ $1 $0                ; $R1 : Maximum number of bytes to read using ReadFile()<br />    Push $R2                ; $R2 $R1 $R0 $4 $3 $@ $1 $0            ; $R2 : Number of bytes actually read using ReadFile()<br /><br />    SendMessage $0 ${EM_EXLIMITTEXT} 0 0x7fffffff<br /><br />    System::Get "(i, i .R0, i .R1, i .R2) iss"<br />    Pop $2<br /><br />    System::Call "*(i 0, i 0, k r2) i .r3"<br />    System::Call "user32::SendMessage(i r0, i ${EM_STREAMIN}, i ${SF_RTF}, i r3) i.s"<br />    Pop $4<br />    Push $4<br /><br />    ClearErrors<br />    FileOpen $1 "$1" r                                              ; $1 = RTFile.handle<br />    _loop:<br />        Pop $0                                                      ; $0 = callbackN identifier from System plugin.<br />        StrCmp $0 "$4" 0 _done        ; check if System plugin's callbackN matches the stored callbackN<br />        System::Call "kernel32::ReadFile(i $1, i $R0, i $R1, i $R2, i 0)"<br />        Push 0 # callback's return value<br />        System::Call "$2"<br />        goto _loop<br />    _done:<br />    FileClose $1<br />    System::Free $3<br />    System::Free $2<br /><br />                            ; $R2 $R1 $R0 $4 $3 $2 $1 $0<br />    Pop $R2                 ; $R1 $R0 $4 $3 $2 $1 $0<br />    Pop $R1                 ; $R0 $4 $3 $2 $1 $0<br />    Pop $R0                 ; $4 $3 $2 $1 $0<br />    Pop $4                  ; $3 $2 $1 $0<br />    Pop $3                  ; $2 $1 $0<br />    Pop $2                  ; $1 $0<br />    Pop $1                  ; $0<br />    Pop $0                  ; -empty-<br />FunctionEnd<br />!macroend<br />!insertmacro LoadRTFfunc ""<br />!insertmacro LoadRTFfunc "un."<br /><br />/*<br />    LoadRTF Ease of use functions.<br /><br />    Simplifies usage of LoadRTF.<br /><br />    Usage:<br />        ${LoadRTF} "Path-to-RTF-file" HWND-of-RichEdit20A-control<br />        -or for uninstallers-<br />        ${un.LoadRTF} "Path-to-RTF-file" HWND-of-RichEdit20A-control<br />*/<br />!macro LoadRTF file hwnd<br />    Push "${file}"<br />    Push ${hwnd}<br />    Call LoadRTF<br />!macroend<br />!define LoadRTF `!insertmacro LoadRTF`<br /><br />!macro un.LoadRTF file hwnd<br />    Push "${file}"<br />    Push ${hwnd}<br />    Call un.LoadRTF<br />!macroend<br />!define un.LoadRTF `!insertmacro LoadRTF.un`<br /><br />/* define LoadRTFincluded so that LoadRTF can't be included twice */<br />!define LoadRTFincluded<br /><br />!endif<br /></code>
</pre><br />
      <br />
      Usage is pretty simple. Presuming you have the above saved in "LoadRTF.nsh":<br />
      <pre>
<code><br />!addplugindir "."<br />!addincludedir "."<br /><br />!include "nsDialogs.nsh"<br />!include "winmessages.nsh"<br />!include "logiclib.nsh"<br />!include "MUI2.nsh"<br /><br />!include "LoadRTF.nsh"<br /><br />OutFile "test.exe"<br /><br />var dialog<br />var hwnd<br />var null<br /><br />Page custom null ; just for testing<br />Page custom test<br />Page custom null ; just for testing<br /><br />Function .onInit<br />    InitPluginsDir<br />FunctionEnd<br /><br />var RichEditControl<br />Function test<br />    nsDialogs::Create 1018<br />        Pop $dialog<br /><br />    nsDialogs::CreateControl "RichEdit20A" \<br />        "${DEFAULT_STYLES}|${WS_TABSTOP}|${WS_VSCROLL}|${ES_MULTILINE}|${ES_READONLY}" \<br />        "${WS_EX_WINDOWEDGE}|${WS_EX_CLIENTEDGE}" \<br />        0 0 100% 100% ""<br /><br />        Pop $RichEditControl<br />        SetOutPath "$PLUGINSDIR"<br />        File "helloworld.rtf"<br />        ${LoadRTF} "$PLUGINSDIR\helloworld.rtf" $RichEditControl<br /><br />    nsDialogs::Show<br />FunctionEnd<br /><br />Function null<br />    nsDialogs::Create 1018<br />        Pop $dialog<br /><br />    ${NSD_CreateLabel} 0 0 100% 8% "Dummy page."<br />        Pop $null<br /><br />    nsDialogs::Show<br />FunctionEnd<br /><br />Section<br />SectionEnd<br /></code>
</pre><br />
      <br />
      *crosses fingers*
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">grundic</span><br />
      <span class="post-time small text-muted">25th May 2009 10:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've found more easy way (see my next post) to fix probkem with RTF.<br />
      But thanks anyway :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">25th May 2009 12:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I know - it's just there for completeness sake and for those who can't, or don't want to, rely on plugins :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">chetanphanse</span><br />
      <span class="post-time small text-muted">1st July 2013 16:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Show Rich text in control</strong><br />
      I want to show some rich text in a Label that does not come from any file. Soemthing like<br />
      <br />
      This is <b>bold</b> and this is in <i>italics</i> and this is <u>underlined</u>.<br />
      The text gets generated dynamically at run time, so i cant use multiple controls. Kindly suggest how can I achieve this<br />
      thanks for your help</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
