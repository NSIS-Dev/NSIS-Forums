<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Validate Windows Password" />

  <title>Validate Windows Password - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Validate Windows Password</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=265387">Validate Windows Password</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dogo</span><br />
      <span class="post-time small text-muted">8th February 2007 14:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Validate Windows Password</strong><br />
      Hi,<br />
      <br />
      I would like to let the user choose which account should<br />
      run a special service.<br />
      <br />
      For that I need to validate a password by user given<br />
      to validate with the special windows user password.<br />
      <br />
      Is there any way to to this ?!<br />
      Somethink like that:<br />
      <br />
      StrCmp $WindowsPassword $UserPasswordInput ... ??<br />
      <br />
      Thanks for reply,<br />
      <br />
      Wolfgang.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">8th February 2007 15:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The value of $WindowsPassword represents a password protected Windows account on NT system?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dogo</span><br />
      <span class="post-time small text-muted">8th February 2007 20:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ah, yes of course.<br />
      <br />
      Sorry that this is not very clear in my post.<br />
      <br />
      This should be an password for an local Windows account.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">8th February 2007 21:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm afraid isn't possible through NSIS, there are some "tools" out there able to hack the password, however they should be used from a dos or linux bootable media because they are all blocked from AVs within windows environment.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dogo</span><br />
      <span class="post-time small text-muted">8th February 2007 21:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ah,<br />
      <br />
      the password should not be hacked, this is not what I want.<br />
      I just would like to know if the password that was entered from the user is correct. This should be for an windows service that would be installed. The user has to select an windows user and has to enter the password, because windows needs an password to install a service :(.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">8th February 2007 21:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If I got it correctly, we're going to the same result from a different direction.<br />
      How the installer would be able to retrieve a password and verify if this is the correct password for the given account if not hack it?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dogo</span><br />
      <span class="post-time small text-muted">8th February 2007 21:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hm, maybe there is an API function within windows like enumerate users ? Just to check if password is correct ? An function has to exist, because this is used if you add an service ! Maybe some windows guru has got an answer about this ?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">8th February 2007 21:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can call LogonUser using the System plug-in.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">8th February 2007 21:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        Maybe some windows guru has got an answer about this ?
      </blockquote>most likely! However I guess the point for you is to know if the service is installed, you may simply perform a check to verify that and if not return to previous stage where users should provide the required details in order to install the service.<br />
      <br />
      edit: I'm still very slow on typing :(
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dogo</span><br />
      <span class="post-time small text-muted">8th February 2007 21:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ah, thanks for all,<br />
      <br />
      I will give them a try tomorrow :-).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dogo</span><br />
      <span class="post-time small text-muted">9th February 2007 11:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Okay,<br />
      <br />
      LoginUser is working very well for local computers,<br />
      is it also possible to do this for an network which contains<br />
      Active Directory ?<br />
      <br />
      Sincearly,<br />
      <br />
      Wolfgang.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">9th February 2007 11:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can pass the domain name in the second parameter of LogonUser.<br />
      <br />
      Also, it'd be nice if you create an example page in the Wiki with the code you've used. I'm sure other users will find it useful as well.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dogo</span><br />
      <span class="post-time small text-muted">9th February 2007 12:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hey kichik,<br />
      <br />
      thanks for your fast posts,<br />
      as far as I am ready with my installer I planned to write one or more wiki entry`s because my installer is full of such features. I hope I could help some other users with that.<br />
      But first of all I had to finish my project ;)<br />
      <br />
      Sincearly,<br />
      <br />
      Wolfgang.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">HotButteredSoul</span><br />
      <span class="post-time small text-muted">16th February 2007 17:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I needed to do the same thing in my install script. The idea: check a user login and make sure it works for a domain.<br />
      <br /></p>
      <pre>
<code><br />#<br /># MSWAuthenticate.nsh - by HotButteredSoul<br />#<br /># Function for checking to see if a Microsoft Windows Username/password<br /># pair authenticate.<br />#<br /><br />!ifndef _MSWAuthenticate_nsh<br />!define _MSWAuthenticate_nsh<br /><br />#<br /># MSWAuthenticate - authenticates username/password pair<br />#<br /># Example:<br />#<br /># Push "bob.username"<br /># Push "ADOMAIN"<br /># Push "bobs.password"<br /># Call MSWAuthenticate<br /># Pop $0 ; = "success" on succes, or "Logon failure: ..." otherwise.<br />#<br /># Uses advapi32.lib LogonUserA<br />#<br />Function MSWAuthenticate<br />    Exch $0 ; password (IN)<br />    Exch<br />    Exch $1 ; Domain (IN) / "success" (OUT)<br />    Exch 2<br />    Exch $2 ; Username (IN)<br />    Push $3 ; LogonUserA return code<br />    Push $4 ; GetLastError() code<br /><br />    ; LOGON32_LOGON_NETWORK = 3<br />    ; LOGON32_PROVIDER_DEFAULT = 0<br />    System::Call "advapi32::LogonUserA(t r2, t r1, t r0, i 3, i 0, *i) i .r3 ?e"<br />    Pop $4 ; the ?e flag from System::Call pushes the result of GetLastError() onto the stack.<br />    IntCmp 0 $3 reject ; return value of 0 is failure.<br />    StrCpy $1 "success"<br />    GoTo done<br /><br />    reject:<br />    IntCmp   87 $4 ERROR_LOGON_FAILURE<br />    IntCmp 1326 $4 ERROR_LOGON_FAILURE<br />    IntCmp 1327 $4 ERROR_ACCOUNT_RESTRICTION<br />    IntCmp 1328 $4 ERROR_INVALID_LOGON_HOURS<br />    IntCmp 1329 $4 ERROR_INVALID_WORKSTATION<br />    IntCmp 1330 $4 ERROR_PASSWORD_EXPIRED<br />    IntCmp 1331 $4 ERROR_ACCOUNT_DISABLED<br />    ;an error of some other sort<br />        StrCpy $1 "Logon failure: $4"<br />        GoTo done<br />    ERROR_LOGON_FAILURE:<br />        StrCpy $1 "Logon failure: unknown user name or bad password."<br />        GoTo done<br />    ERROR_ACCOUNT_RESTRICTION:<br />        StrCpy $1 "Logon failure: user account restriction."<br />        GoTo done<br />    ERROR_INVALID_LOGON_HOURS:<br />        StrCpy $1 "Logon failure: account logon time restriction violation."<br />        GoTo done<br />    ERROR_INVALID_WORKSTATION:<br />        StrCpy $1 "Logon failure: user not allowed to log on to this computer."<br />        GoTo done<br />    ERROR_PASSWORD_EXPIRED:<br />        StrCpy $1 "Logon failure: the specified account password has expired."<br />        GoTo done<br />    ERROR_ACCOUNT_DISABLED:<br />        StrCpy $1 "Logon failure: account currently disabled."<br />        GoTo done<br /><br />    done:<br />    Pop $4<br />    Pop $3<br />    Pop $2<br />    Pop $0<br />    Exch $1<br />FunctionEnd<br />!endif ; _MSWAuthenticate_nsh</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">HotButteredSoul</span><br />
      <span class="post-time small text-muted">16th February 2007 21:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Wiki'd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Yathosho</span><br />
      <span class="post-time small text-muted">7th June 2007 22:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">1. i have a problem with your function when the user's password is empty, it always reports "user account restriction". doesn't matter if it's a limited account or admin.<br />
      <br />
      2. when is the message i get supposed to show up anyway?<br />
      <br />
      3. when i try the function with guest accounts, the error message is "Logon failure: 1385".<br />
      <br />
      4. is there a way to check if the user has admin rights?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">8th June 2007 02:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">xp fails with blank passwords for network logons by default. You can set limitblankpassworduse=0 in HKLM\SYSTEM\CurrentControlSet\Control\Lsa to override this</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Yathosho</span><br />
      <span class="post-time small text-muted">8th June 2007 10:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">so that means if i want to use that function to validate a user really is administrator (who happens to have an empty password), it will not work?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Yathosho</span><br />
      <span class="post-time small text-muted">8th June 2007 19:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">..or asked differently, is this script not for winlogons?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Yathosho</span><br />
      <span class="post-time small text-muted">12th June 2007 00:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">5. in what other cases will "user account restriction" be displayed?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Yathosho</span><br />
      <span class="post-time small text-muted">30th June 2007 14:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">i've attached a script using the MSWAuthenticate function. it is meant to bring something like UAC to NSIS installers on older windows nt versions. however, to improve it i need some of the above questions answered. do i get the "user account restriction" <i>only</i> only when i have an empty password? does it work when the user specifies a different user (admin user) than the user logged in? any hints for improvements are welcome!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">30th June 2007 15:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There are more restrictions available in Windows but the empty password, so I doubt that'd be the only case.<br />
      <br />
      LogonUser should work with other users but the current user. It won't be too useful without working that way.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">20th September 2007 08:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry to bring back this old topic, but I came across something related to this that would probably solve the empty password issue, its called SSPI (Security Service Provider Interface)<br />
      <br />
      More info @ <a href="http://www.winterdom.com/dev/security/sspi.html" target="_blank">http://www.winterdom.com/dev/security/sspi.html</a><br />
      <br />
      Hopefully someone will write a plugin (or use the system plugin if you are insane)</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
