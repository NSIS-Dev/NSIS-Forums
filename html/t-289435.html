<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Disable text box and show default text" />

  <title>Disable text box and show default text - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Disable text box and show default text</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=289435">Disable text box and show default text</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kyleprager</span><br />
      <span class="post-time small text-muted">1st April 2008 09:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Disable text box and show default text</strong><br />
      Hi, I'm trying to create a screen for my installer that takes user input. In doing so I need to be able to have the user select a checkbox which will disable a text box and fill it with default text, overwriting whatever was in there when the user selected the checkbox (ie the checkbox will set the textbox to a default value, but it will be visually apparent to the user). I have figured out how to make the checkbox callback so I can disable the textbox, but I don't know how to put text in the textbox at the same time. What seems to be a valid command will not work. Here's the function that the page call to show:<br />
      <br />
      Function userInput<br />
      InstallOptions::dialog /NOUNLOAD $PLUGINSDIR\inputpage.ini<br />
      FunctionEnd<br />
      <br />
      Here's the funtion I use to validate/callback:<br />
      <br />
      Function onPageExit<br />
      <br />
      push $0<br />
      push $1<br />
      push $R0<br />
      push $R1<br />
      <br />
      # Read which field was changed into $R1<br />
      # Other code that does the same as the "ReadIniStr" line below<br />
      # Code: !insertmacro MUI_INSTALLOPTIONS_READ $R1 "inputpage.ini" "Settings" "State"<br />
      ReadIniStr $R1 "$PLUGINSDIR\inputpage.ini" "Settings" "State"<br />
      <br />
      # Goto changestate if a field I care about gets selected<br />
      ${if} $R1 == 1<br />
      goto changestate<br />
      ${elseif} $R1 == 3<br />
      goto changestate<br />
      ${else}<br />
      goto exit<br />
      ${endif}<br />
      <br />
      # Change state to disabled if enabled and bisa versa<br />
      changestate:<br />
      # Add 1 to $R1 to get the number of the field that will be disabled<br />
      intop $R2 $R1 + 1<br />
      <br />
      # Get handle for field to be disabled/enabled and get<br />
      # the current state of the checkbox that is causing it<br />
      ReadIniStr $0 "$PLUGINSDIR\inputpage.ini" "Field $R2" "HWND"<br />
      ReadIniStr $1 "$PLUGINSDIR\inputpage.ini" "Field $R1" "state"<br />
      <br />
      # Enable if disable, and bisa versa<br />
      StrCmp $1 1 disable enable<br />
      <br />
      disable:<br />
      EnableWindow $0 0<br />
      WriteIniStr "$PLUGINSDIR\inputpage.ini" "Field $R2" "Flags" "DISABLED"<br />
      <font color="red">WriteIniStr "$PLUGINSDIR\inputpage.ini" "Field 2" "State" "DISABLED TEXT BOX"</font><br />
      pop $R1<br />
      pop $R0<br />
      pop $1<br />
      pop $0<br />
      abort<br />
      <br />
      enable:<br />
      EnableWindow $0 1<br />
      WriteIniStr "$PLUGINSDIR\inputpage.ini" "Field $R2" "Flags" ""<br />
      pop $R1<br />
      pop $R0<br />
      pop $1<br />
      pop $0<br />
      abort<br />
      <br />
      # Just used to exit the function when we want to leave<br />
      exit:<br />
      pop $R1<br />
      pop $R0<br />
      pop $1<br />
      pop $0<br />
      <br />
      FunctionEnd<br />
      <br />
      <br />
      =================<br />
      <br />
      I've highlighted the line that I think should work but isn't working in RED. "Field 2" in this case is a text box. Here's the code from my INI file:<br />
      <br />
      ; Auto-generated by EclipseNSIS InstallOptions Script Wizard<br />
      ; Feb 22, 2008 8:09:23 PM<br />
      [Settings]<br />
      NumFields=4<br />
      Title=User Input Page<br />
      <br />
      [Field 2]<br />
      Type=Text<br />
      Left=103<br />
      Top=41<br />
      Right=258<br />
      Bottom=54<br />
      State=<br />
      Flags=<br />
      <br />
      [Field 1]<br />
      Type=CheckBox<br />
      Left=49<br />
      Top=42<br />
      Right=94<br />
      Bottom=52<br />
      Text=Default<br />
      State=0<br />
      Flags=NOTIFY<br />
      <br />
      [Field 3]<br />
      Type=CheckBox<br />
      Left=49<br />
      Top=65<br />
      Right=94<br />
      Bottom=75<br />
      Text=Default<br />
      State=0<br />
      Flags=NOTIFY<br />
      <br />
      [Field 4]<br />
      Type=Text<br />
      Left=103<br />
      Top=63<br />
      Right=258<br />
      Bottom=76<br />
      <br />
      <br />
      =================<br />
      <br />
      What's especially weird is that the highlighted line of code from earlier works if I run it inside of my page-show function just before I show the INI page with InstallOptions. Here's what I mean:<br />
      <br />
      <br />
      Function userInput<br />
      <font color="red">WriteIniStr "$PLUGINSDIR\inputpage.ini" "Field 2" "State" "DISABLED TEXT BOX"</font><br />
      InstallOptions::dialog /NOUNLOAD $PLUGINSDIR\inputpage.ini<br />
      FunctionEnd<br />
      <br />
      ==============<br />
      <br />
      That will set my textbox to have the text "DISABLED TEXT BOX" initially, but that line doesn't work when called inside the "onPageExit" function.<br />
      <br />
      What I want to do is to be able to either put text in the textbox with the checkbox unchecked, or when the checkbox is checked fill the textbox with the text of my choice (in this case it will be a port number).<br />
      <br />
      Any ideas? Any help will be much appreciated! ...Also please let me know if you need any more info or if I've been vague anywhere in this post. Thanks!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">1st April 2008 09:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You must SendMessage with ${WM_SETTEXT}.<br />
      Check the included example testnotify.nsi, it explains everything.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kyleprager</span><br />
      <span class="post-time small text-muted">1st April 2008 10:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you! That worked perfectly!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
