<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="INSTDIR and MUI_PAGE_DIRECTORY behavior problem" />

  <title>INSTDIR and MUI_PAGE_DIRECTORY behavior problem - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">INSTDIR and MUI_PAGE_DIRECTORY behavior problem</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=305178">INSTDIR and MUI_PAGE_DIRECTORY behavior problem</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jaridmo</span><br />
      <span class="post-time small text-muted">10th April 2009 01:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>INSTDIR and MUI_PAGE_DIRECTORY behavior problem</strong><br />
      I am using NSIS 2.43<br />
      <br />
      I have written an install script with the basic components of an installer (PAGE_WELCOME, PAGE_LICENSE, PAGE_COMPONENTS, PAGE_DIRECTORY, PAGE_INSTFILES, and PAGE_FINISH). I am having a problem with the PAGE_DIRECTORY.<br />
      <br />
      I understand that the default behavior of the INSTDIR is to keep the end directory of the path and append that to any newly selected path chosen in the Browse directory dialog. I CANNOT get my script to behave this way.<br />
      <br />
      I set the INSTDIR in the .onInit function to C:\Biodose<br />
      <br />
      It shows up correctly in the Directory dialog, but when I browse and select a directory it does not append Biodose to the newly chosen directory.<br />
      <br />
      From everywhere I have found I read that this should be the behavior as long as there is no trailing backslash (ie C:\Biodose\ should behave as it is now). I have tried it both ways.<br />
      <br />
      I have even created a variable called CompanyName and set the INSTDIR to C:\$CompanyName and its still not working correctly.<br />
      <br />
      The funny thing is that this is the behavior some developers are after, just not me.<br />
      <br />
      Any Ideas???</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">10th April 2009 04:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I believe the above is only the case for the InstallDir directive (set outside functions, sections, etc.)<br />
      <br /></p>
      <pre>
<code><br />!addplugindir "."<br />!addincludedir "."<br /><br />!include "nsDialogs.nsh"<br />!include "winmessages.nsh"<br />!include "logiclib.nsh"<br /><br />!include "MUI2.nsh"<br /><br />OutFile "test.exe"<br /><br />Page Directory dirPre dirShow dirPost<br /><br />InstallDir "$PROGRAMFILES\myApplication"<br /><br />Function .onInit<br />        StrCpy $INSTDIR "$PROGRAMFILES\myOtherApplication"<br />FunctionEnd<br /><br />Function dirPre<br />        MessageBox MB_OK "Pre: $INSTDIR"<br />FunctionEnd<br />Function dirShow<br />FunctionEnd<br />Function dirPost<br />        MessageBox MB_OK "Post: $INSTDIR"<br />FunctionEnd<br /><br />Section<br />SectionEnd<br /><br />!insertmacro MUI_LANGUAGE "English"<br /></code>
</pre><br />
      <br />
      You should notice that after the directory is picked, the directory text field ends in 'myApplication', as per the IntallDir directive, rathern than 'myOtherApplcation', as per the .onInit-setting of $INSTDIR.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jaridmo</span><br />
      <span class="post-time small text-muted">10th April 2009 22:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you Animaether - works now!</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
