<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Problems with FileRead at end of the file"><title>Problems with FileRead at end of the file - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Problems with FileRead at end of the file</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=118250">Problems with FileRead at end of the file</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">rarefluid</span><br><span class="post-time small text-muted">17th December 2002 21:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Problems with FileRead at end of the file</strong><br>Once again...<br>I read a textfile with $\r$\n at the end of every line in a loop.<br>When i get to the end, the last string isn't read. The string is empty "" because i got to the end of the file.<br>So my idea was to get the position of the last read and then read from there to the end of the file to avoid the "" string, but it doesn't work. Heres the code maybe you have an idea...<br>$9 is the filehandle<br><br><font size="1"><br>FileSeek $9 0 "END" $R8<br>FileSeek $9 0<br>unDOloop:<br>FileSeek $9 0 "CUR" $R9 ;get file position<br>FileRead $9 $2 ;Read string from file<br>StrCmp $2 "" end ;If end of file is reached, exit procedure<br>StrCpy $R0 $2 3 ;Get first letters and do function accordingly<br>StrCmp $R0 $R1 "" unDOloop ;if not type of change stated in $R1, seek further<br>call un.restore_changes ;if this is the right thing, restore values (string already in $2)<br>goto unDOloop ;and loop till end of the file<br>end:<br>;MessageBox MB_OK|MB_TOPMOST|MB_ICONINFORMATION "Last Fileposition : $R9$\r$\nLenght of file : $R8$\r$\nString is $2" 0 0<br>FileSeek $9 $R9 ;we've read past the end of the file, so get back to start of string<br>IntOp $R8 $R8 - $R9 ;get length till EOF-1<br>Intop $R8 $R8 - 1<br>FileRead $9 $2 $R8 ;read last string in file<br>StrCmp $2 "" exit ;If still end of file, exit procedure<br>StrCpy $R0 $2 3 ;Get first letters and do function accordingly<br>StrCmp $R0 $R1 "" exit ;if not type of change stated in $R1, exit<br>call un.restore_changes ;restore values (string already in $2)<br>exit:<br></font><br><br>KIM</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">17th December 2002 22:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>The string is empty "" because i got to the end of the file.</blockquote>What's wrong with that? What are you tring to do?</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rarefluid</span><br><span class="post-time small text-muted">17th December 2002 22:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">What does NSIS do when I try to read a string from the file and get to the end of the file?<br>The documentation says it returns an empty string, not the string till EOF...<br>Or am I wrong...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">17th December 2002 22:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It actually says:<br></p><blockquote>If the end of file is read and no more data is available, the output string will be empty, and the error flag will be set.</blockquote>This means you won't get the error flag and an empty string if there is still some data left in the buffer. You can safely read until you get an empty string and the error flag knowing that you will get all the data in the file.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">rarefluid</span><br><span class="post-time small text-muted">17th December 2002 22:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok, i understood it in a different way...<br>Thanks.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>