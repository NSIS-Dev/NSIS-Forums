<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Make the uninstaller &quot;remember&quot; what was installed?"><title>Make the uninstaller "remember" what was installed? - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Make the uninstaller "remember" what was installed?</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=183524">Make the uninstaller "remember" what was installed?</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">John P.</span><br><span class="post-time small text-muted">16th June 2004 16:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Make the uninstaller "remember" what was installed?</strong><br>Hi.<br><br>I know this is most likely a very newbie question, and is probably very easily solved(maybe even the uninstaller solves it for me automatically), but I can't seem to find this exact info.<br><br>What I need to know, is:<br><br>How can I make the uninstaller "remember" what files the user chose to install, and then <b>only</b> attempt to remove those files?<br><br>You're probably thinking "Why don't you just list all the files in the uninstaller, so it will remove all of them, disregarding the files it doesn't find?"<br><br>Well, the problem there is that - let's say a "client" of mine chooses to only install <i>one</i> of my files. So he checks that checkbox only in the installer.<br><br>Then later he downloads files that <i>another</i> guy has made, and installs <i>those</i>. In my case, those files will have the exact same file names that I use, and I can't change that.<br><br>So let's say he now decides to use my uninstaller to remove the one file he installed from me.<br><br>-Now my uninstaller will remove all the files it finds(that I have listed I mean), and that will include the files he downloaded from the other guy.<br><br>And I don't want that.<br><br>(unless I'm mistaken and the uninstaller already 'knows' what to uninstall based on what the user installed)<br><br>So somehow I need the uninstaller to know what files the user chose to install, and <i>only</i> remove those files.<br><br>Is this easily done? Or does the uninstaller somehow already sort this out automatically?<br><br>Sorry if this has been answered numerous times already.<br>I searched the forum for "uninstall" and didn't find this.<br><br>In case it's a special script, please give me a short example of how to use it.<br><br>Thank you.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">16th June 2004 16:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It's not that difficult. Depending on what you need, you can store the filenames in a registry key or file.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">zimsms</span><br><span class="post-time small text-muted">16th June 2004 17:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That would work for basics Joost. However, he stated that the files could be replaced by another application, therefore, meaning they'd have the same name and be in the same location.<br><br>What you will need to do is store the information as Joost explained, then check the file attributes using the system plugin to verify that the file is actually yours by comparing the file version tab information with the hard coded information you had stored in the installer at compile time.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">John P.</span><br><span class="post-time small text-muted">16th June 2004 18:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by zimsms</i><br><b>That would work for basics Joost. However, he stated that the files could be replaced by another application, therefore, meaning they'd have the same name and be in the same location.<br><br>What you will need to do is store the information as Joost explained, then check the file attributes using the system plugin to verify that the file is actually yours by comparing the file version tab information with the hard coded information you had stored in the installer at compile time.</b></blockquote>Thanks(both of you).<br><br>Woah - a little more complicated than I thought...<br><br>So - I use a WriteRegStr for each of the install file sections, and then in each of the uninstall file sections, I use a ReadRegStr and somehow compare the read string with the written string(?).<br><br>But hey - I really need an example here.<br><br>-How do I use the System.dll to find this info, how do I make it compare what it finds with the install reg keys, and how do I tell it to use that info to <i>not</i> uninstall the files that don't match the original reg key?<br><br>I found <a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=312" target="_blank">this</a> script - can I use any of that with a few modifications?<br><br>I'm beginning to think this is a bit over my head...<br><br>[EDIT] Or - come to think of it - maybe I could write a registry key for each installed file, then make the uninstall section search for each of those strings one by one. -If it then finds 'my' string, it will delete both the file and the reg string. If it <i>doesn't</i> find my reg string for that file, it will not touch the file.<br>And so on for all files.<br><br>Would that be a solution, you think?[/EDIT]</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">zimsms</span><br><span class="post-time small text-muted">16th June 2004 18:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It would take me too long to actually provide a complete example.<br><br>Here's a little pseudocode for ya:<br><br>During install loop through the files and write the complete install information to an ini file (for easier access), or the registry. Both have their pros and cons. ie Files can be deleted, registry can be restored etc. The above loop would contain the same System call as defined below in the uninstall; only this time for the file being installed.<br><br>On uninstall you will need to read in a value from the step above looping until there are no values left. This part is easier in an ini file. Within the loop you will want to perform a system call to the GetFileInfo function and obtain the desired information. I believe there is an example of calling this function in the new system plugin.<br>Then you use a StrCmp to compare the stored value against the obtained values.<br><br>It is a big process, however, there are many examples of doing each of the pieces seperately.<br><br>I hoped the above can help you. If I get any free time I will attempt to make an example. Though I don't see this happening in the near future.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">zimsms</span><br><span class="post-time small text-muted">16th June 2004 18:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>Or - come to think of it - maybe I could write a registry key for each installed file, then make the uninstall section search for each of those strings one by one. -If it then finds 'my' string, it will delete both the file and the reg string. If it doesn't find my reg string for that file, it will not touch the file.</blockquote>This would work for files with filenames that you don't know about, but not for files that may of had the same name which replaced your files. This was one of the snags you requested.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">John P.</span><br><span class="post-time small text-muted">16th June 2004 19:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Yes, I see you're obviously right, when I just get my brain working. :D<br><br>I'll have a look at what you wrote, and see if I can make it work. Could be I end up ignoring the problem and just give a warning that the files he has installed(other than mine) may be deleted. But I'll try to make this work first.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">JamesF1</span><br><span class="post-time small text-muted">17th June 2004 20:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The best way is definately to store the filenames installed in the registry and then read them back out to the installer and then compare versions. Pretty much foolproof.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>