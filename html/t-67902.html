<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="if makensis could choose compress method"><title>if makensis could choose compress method - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">if makensis could choose compress method</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=67902">if makensis could choose compress method</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">hotice</span><br><span class="post-time small text-muted">7th December 2001 01:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>if makensis could choose compress method</strong><br>for example<br>bz2<br>cab<br>ace<br>rar<br>and so on<br><br>I don't know which of them is open source.<br>but i found the ratio of nsis isn't the best.<br>but her head blcok seems tiny.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">liquidmotion</span><br><span class="post-time small text-muted">8th December 2001 02:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">that is one of the best features: low over head size. you have to enlarge the size when you add new features.<br><br>adding all of those compression formats could add a but much, but i'm not really an expert (justin?)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">justin</span><br><span class="post-time small text-muted">8th December 2001 02:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, here's the deal.<br><br>zlib is good and balanced and free.<br>bzip2 can be better, but isn't always, and has other downsides.<br>rar is great, but is it free?<br>likewise all the others. If there was some way of using lz32.dll or whatever that didn't have downsides, I'd be up for it.<br><br>Anyway, perhaps I will make it easier to swap out codecs, but it will still require a recompile of makensis and exehead.<br><br><br>-Justin</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Cristian Adam</span><br><span class="post-time small text-muted">8th December 2001 13:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Cab SDK can be downloaded from here: <a href="http://msdn.microsoft.com/library/en-us/dnsamples/cab-sdk.exe." target="_blank">http://msdn.microsoft.com/library/en...s/cab-sdk.exe.</a><br>Maybe justin can do something with it... (delete it<br>afterwards :)<br><br>cristi.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pjw62</span><br><span class="post-time small text-muted">8th December 2001 18:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by justin</i><br><b>Well, here's the deal.<br><br>zlib is good and balanced and free.<br>bzip2 can be better, but isn't always, and has other downsides.<br>rar is great, but is it free?<br>likewise all the others. If there was some way of using lz32.dll or whatever that didn't have downsides, I'd be up for it.<br><br>Anyway, perhaps I will make it easier to swap out codecs, but it will still require a recompile of makensis and exehead.<br><br><br>-Justin</b></blockquote>I hacked up v 1.44 using LZ compression and the microsoft compress.exe. The problem is that unlike with zlib there doesn't seem to be a way to expand data that is simply in memory..<br>Besides, I think it is the MS-ZIP quantum compression that really whips the llama's behind, which is not LZ.<br>The latter problem I can live with, but having to write out the data block to a temporary file seems a bit inelegant. I am searching on usenet now to try and figure out a solution.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">justin</span><br><span class="post-time small text-muted">8th December 2001 20:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'm all for making multiple compression mechanisms available from an #define in config.h.. Just a quick test of microsoft's lz32 (compress.exe) shows that for me it is not as good as zlib, as far as compression ratio at least (obviously it would require less code than zlib). Perhaps we could integrate bzip2, but then we'd really want to compress the whole datablock together, across file boundaries... Anyway..<br><br>-Justin</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pjw62</span><br><span class="post-time small text-muted">8th December 2001 21:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">yep, agreed microsoft's LZ isn't as good as ZLIB.<br>Using the -zq7 option with compress.exe .. on makensis.exe (a recompiled version, admittedly) 85436 - 89769, 95% saving.<br>But of course to expand this you need the blockbuster lib in the cab sdk.. just the sample application to expand cab files comes in at 55kb (using the CRT, I couldn't be bothered to rewrite it in raw win32 code, but that may shave 20kb or so off).<br><br>--&gt; for all but very small installers, LZ is useless... I vote for zlib.<br><br>/me will shut up now giving useless ideas..</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">justin</span><br><span class="post-time small text-muted">10th December 2001 09:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'm figuring that bzip2 (as well as zlib) would do a lot better in terms of compression if it could work across more than one file at a time. I'm going to implement compile-time options for both compression system (zlib, bzip2, or whatever) as well as whether it is in the current easy method (meaning you can seek around in the data a lot, each file compressed separately), or the slower hopefully more efficient space-wize method of compressing them all together. The problem is, the installer may need to move around in the compressed data. The solutions:</p><ul><li>write out the uncompressed data as it is uncompressed to a temp file.</li><li>when a seek back is needed, start from the beginning and get seekign.</li></ul><br>The benefits of the first one is that if the installer has to jump around a lot, it already has teh data cached and is less CPU intensive. But it can require a bit of disk space, and be more disk intensive. The benefits of the second method are that it requires no extra disk space, and as long as the items in the installer are sequencial (and especially if the datablock optimizer is off), it will be even faster.<br><br>Perhaps the installer can pick one of the two modes, based on disk space, as well as how much out-of-order code there is in the installer. I'll be experimenting with this.<br><br>So there will basically be in config.h:<br><br>#define NSIS_COMPRESS_FILE<br>or<br>#define NSIS_COMPRESS_WHOLE<br><br>and<br><br>#define NSIS_COMPRESS_AS_ZLIB<br>or<br>#define NSIS_COMPRESS_AS_BZIP2<br>or<br>#define NSIS_COMPRESS_AS_LZ32 // maybe, heh.<br>or (maybe eventually)<br>#define NSIS_COMPRESS_AS_CAB // maybe<br><br><br>anyway.<br><br>-Justin<br><br>P.S. and this will be for 1.90 or maybe 2.0. heh.<br></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Repzilon</span><br><span class="post-time small text-muted">11th December 2001 00:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Be sure to check out my thread about <a href="http://forums.winamp.com/showthread.php?threadid=62704" target="_blank">solid compression</a>.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">CodeSquid</span><br><span class="post-time small text-muted">11th December 2001 10:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by justin</i><br><b>I'm figuring that bzip2 (as well as zlib) would do a lot better in terms of compression if it could work across more than one file at a time. I'm going to implement compile-time options for both compression system (zlib, bzip2, or whatever) as well as whether it is in the current easy method (meaning you can seek around in the data a lot, each file compressed separately), or the slower hopefully more efficient space-wize method of compressing them all together. The problem is, the installer may need to move around in the compressed data. The solutions:</b><ul><li><b>write out the uncompressed data as it is uncompressed to a temp file.</b></li><li><b>when a seek back is needed, start from the beginning and get seekign.</b></li></ul><b><br>The benefits of the first one is that if the installer has to jump around a lot, it already has teh data cached and is less CPU intensive. But it can require a bit of disk space, and be more disk intensive. The benefits of the second method are that it requires no extra disk space, and as long as the items in the installer are sequencial (and especially if the datablock optimizer is off), it will be even faster.<br><br>Perhaps the installer can pick one of the two modes, based on disk space, as well as how much out-of-order code there is in the installer. I'll be experimenting with this.<br><br>So there will basically be in config.h:<br><br>#define NSIS_COMPRESS_FILE<br>or<br>#define NSIS_COMPRESS_WHOLE<br></b></blockquote>A good solution to the above problems would be a third option:<br>#define NSIS_COMPRESS_COMPONENT<br>Only files within one component will be compressed together.<br><br>Justin, I'm sure you'll find the best solution :)</div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>