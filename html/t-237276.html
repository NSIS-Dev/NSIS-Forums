<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Rebuild a registry key list"><title>Rebuild a registry key list - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Rebuild a registry key list</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=237276">Rebuild a registry key list</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">lucian.crisan</span><br><span class="post-time small text-muted">5th February 2006 21:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Rebuild a registry key list</strong><br>Hello guys,<br><br>I've wrote an instalation program (with NSIS Installer) for my application in AutoCAD.<br>Everything is OK at installation, but for uninstall function i need some help from you.<br>I'm a newbie with NSIS language, and i must finish asap my installation pack.<br>So, under a key i have a number of string values which follow the rule:<br><br>Value name: "index_number"Startup<br>Value data: a string which is the path to a specified file<br><br>For example:<br>1Startup "d:\Myapp\lisp1.lsp"<br>2Startup "d:\Myapp\lisp2.lsp"<br>3Startup "d:\Myapp\lisp3.lsp"<br>4Startup "d:\Myapp\lisp4.lsp"<br>5Startup "d:\Myapp\lisp5.lsp"<br>6Startup "d:\Myapp\lisp6.lsp"<br>NumStartup "6"<br><br>At the end exist a key, named "NumStartup" and its value is equal with a number which reppresent the number of files "loaded" under this key (like an index)<br><br>In the time of uninstall, i want to erase for example the fourth key (4Startup "d:\Myapp\lisp4.lsp") and to change value of NumStartup from 6 to 5.<br>This part i've done, but i need to rebuild the key's value name in ascending order.<br><br>The situation appear like follow (after erase of the fourth key):<br><br>1Startup "d:\Myapp\lisp1.lsp"<br>2Startup "d:\Myapp\lisp2.lsp"<br>3Startup "d:\Myapp\lisp3.lsp"<br>5Startup "d:\Myapp\lisp5.lsp"<br>6Startup "d:\Myapp\lisp6.lsp"<br>NumStartup "5"<br><br>What i'll need to obtain:<br><br>1Startup "d:\Myapp\lisp1.lsp"<br>2Startup "d:\Myapp\lisp2.lsp"<br>3Startup "d:\Myapp\lisp3.lsp"<br>4Startup "d:\Myapp\lisp5.lsp"<br>5Startup "d:\Myapp\lisp6.lsp"<br>NumStartup "5"<br><br>This job, at this moment, i can't handle it; and i'm asking you if anyone can help me (or guide me) to finish up my job.<br><br>And another question. I have a key which contain some paths linked with ";" character, like:<br>C:\ACADM2000\acadm;C:\ACADM2000\help;C:\ACADM2000\FONTS;D:\My work;<br>How can I search for a specified path inside this string, erase it, and rebuild the string without it.<br><br>I don't know if i was explicit by I try with an example.<br><br>I have this key:<br>Value name: ACAD<br>Value data: "C:\ACADM2000\acadm;C:\ACADM2000\help;C:\ACADM2000\FONTS;D:\My work;"<br><br>I want to search and erase the substring "C:\ACADM2000\help;C:\ACADM2000\FONTS;" from initial string to obtain<br>C:\ACADM2000\acadm;D:\My work;<br><br>That's all.<br>Thanks in forward,<br>Lucian :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">{_trueparuex^}</span><br><span class="post-time small text-muted">5th February 2006 22:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hmm... let's see...<br><br>This code should fix the list order.</p><pre>
<code> Push $R0<br> Push $R1<br> Push $R2<br><br>  ; Change this to ReadRegDWORD if necessary<br>  ReadRegStr $R0 HKCU "Software\Something" "NumStartup"<br><br>  StrCpy $R1 0 ; "fix pointer"<br>  StrCpy $R2 0 ; pointer<br><br>  loop:<br>  StrCmp $R2 $R0 end 0<br>  IntOp $R1 $R1 + 1<br><br>  notfound:<br>  ClearErrors ; just to make sure<br>  IntOp $R2 $R2 + 1<br>  StrCmp $R2 $R0 end 0<br><br>  ReadRegStr $R3 HKCU "Software\Something" "$R2Startup"<br>  IfErrors notfound 0<br>  DeleteRegValue HKCU "Software\Something" "$R2Startup"<br>  WriteRegStr HKCU "Software\Something" "$R1Startup" $R3<br>  Goto loop<br>  <br>  end:<br>  IntOp $R1 $R1 - 1<br>  WriteRegStr HKCU "Software\Something" "NumStartup" $R1<br><br> Pop $R2<br> Pop $R1<br> Pop $R0</code>
</pre><br>
      Probably There are easier way to do this, but my brain needs food. :)
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comperio</span><br>
      <span class="post-time small text-muted">6th February 2006 00:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You might want to check out AfrowUK's <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=222275&amp;highlight=array" target="_blank">NSISArray</a> plugin--it would make it easier to switch the order of elements and such without having to make your brain hurt so much! ;)<br>
      <br>
      and for this:<br></p>

      <blockquote>
        C:\ACADM2000\acadm;C:\ACADM2000\help;C:\ACADM2000\FONTS;D:\My work;<br>
        How can I search for a specified path inside this string, erase it, and rebuild the string without it.
      </blockquote>You should have a look at Instructor's <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=203228" target="_blank">Word/String/File functions</a>. (BTW: Most of Instructor's functions are included with the latest builds of NSIS--have a look at the help files for for info.)
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>