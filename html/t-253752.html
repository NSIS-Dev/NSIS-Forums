<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="really needs to get done" />

  <title>really needs to get done - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">really needs to get done</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=253752">really needs to get done</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Potz</span><br />
      <span class="post-time small text-muted">21st August 2006 18:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>really needs to get done</strong><br />
      Hey I am having problems with my installer. I added a new page to edit a Registry file. This is before it is put into regedit. I get to this point and it stalls the installer. I was wondering if anyone can tell me how to fix this. Here is my code....<br />
      <br />
      I really need this to be finished up as soon as possible so any info would be greatly apreciated. Thanks<br />
      <br />
      <br />
      ;show regEdit gui---------------------------<br />
      Function regEdit<br />
      <br />
      !insertmacro MUI_HEADER_TEXT "Edit the Registry," "read instruction below for this step."<br />
      <br />
      !insertmacro MUI_INSTALLOPTIONS_EXTRACT "RegEditing.ini"<br />
      !insertmacro MUI_INSTALLOPTIONS_DISPLAY "RegEditing.ini"<br />
      <br />
      FunctionEnd<br />
      ;-----------------------------------------------------<br />
      <br />
      ;Edit Generic NBC Reg Key------------------------------<br />
      Function leaveRegEdit<br />
      <br />
      ReadINIStr $7 "$PLUGINSDIR\Regedit.ini" "Field 2" "State"<br />
      ReadINIStr $6 "$PLUGINSDIR\Regedit.ini" "Field 1" "State"<br />
      <br />
      Call Regedit1<br />
      Call Regedit2<br />
      <br />
      FunctionEnd<br />
      ;------------------------------------------------------------<br />
      <br />
      ;------------------------------------------------------------<br />
      Function Regedit1<br />
      <br />
      StrCpy $0 "$6" # set your custom string<br />
      StrCpy $1 "/" # set the character to insert<br />
      StrLen $2 $0 # get the length of your string to loop through it<br />
      StrCpy $3 "0" # init the loop counter<br />
      StrCpy $4 "" # init output var<br />
      <br />
      loop: # begin of the loop<br />
      StrCpy $5 $0 1 $3 # copy one character of your string to a temp var (offset $3 counts up)<br />
      StrCpy $4 "$4$1$5" # add the character extracted and the one to insert everytime<br />
      IntOp $3 $3 + 1 # increase counter/offset<br />
      IntCmp $2 $3 end loop #stop the loop if end of string reached, else continue<br />
      end:<br />
      # at this stage, $4 will be "/C/o/m/p/a/n/y"<br />
      <br />
      Push "/I/I/M/S" #text to be replaced<br />
      Push $4 #replace with<br />
      Push all #replace all occurrences<br />
      Push all #replace all occurrences<br />
      Push "$INSTDIR\WARN\Dashboard\NBC\Generic NBC reg keys.reg" #file to replace in<br />
      Call AdvReplaceInFile<br />
      FunctionEnd<br />
      ;------------------------------------------------------------<br />
      <br />
      ;------------------------------------------------------------<br />
      Function Regedit2<br />
      <br />
      StrCpy $0 "$7" # set your custom string<br />
      StrCpy $1 "/" # set the character to insert<br />
      StrLen $2 $0 # get the length of your string to loop through it<br />
      StrCpy $3 "0" # init the loop counter<br />
      StrCpy $4 "" # init output var<br />
      <br />
      loop1: # begin of the loop<br />
      StrCpy $5 $0 1 $3 # copy one character of your string to a temp var (offset $3 counts up)<br />
      StrCpy $4 "$4$1$5" # add the character extracted and the one to insert everytime<br />
      IntOp $3 $3 + 1 # increase counter/offset<br />
      IntCmp $2 $3 end loop1 #stop the loop if end of string reached, else continue<br />
      end:<br />
      # at this stage, $4 will be "/C/o/m/p/a/n/y"<br />
      <br />
      Push "/C/A/S/P/O/D" #text to be replaced<br />
      Push $4 #replace with<br />
      Push all #replace all occurrences<br />
      Push all #replace all occurrences<br />
      Push "$INSTDIR\WARN\Dashboard\NBC\Generic NBC reg keys.reg" #file to replace in<br />
      Call AdvReplaceInFile<br />
      FunctionEnd<br />
      ;------------------------------------------------------</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">21st August 2006 22:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Did you notice that you have the same label in both functions? "end:" is not needed in either function. replace the references to it with a 0 (a placeholder) since you don't need them.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Potz</span><br />
      <span class="post-time small text-muted">21st August 2006 22:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What do you mean Refereces? just put a "0" instead of a "end:"?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">demiller9</span><br />
      <span class="post-time small text-muted">22nd August 2006 00:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">References are the places where you used the label, the IntCmp instructions. You take out the label name and put in a zero:<br /></p>
      <pre>
<code><br />IntCmp $2 $3 0 loop1 #stop the loop if end of string reached, else continue<br /># at this stage, $4 will be "/C/o/m/p/a/n/y"<br /></code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comperio</span><br />
      <span class="post-time small text-muted">22nd August 2006 02:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's OK to have the lables named the same--they are in different functions, so there won't be any confusion in doing do.<br />
      <br />
      But, you should extract the page file during .onInit, not in the page's display function. As you have it written, the custom page will be overwritten (set back to default) each time it's displayed becuase you're re-extracting the file at the beginning of the show function.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Potz</span><br />
      <span class="post-time small text-muted">24th August 2006 03:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">so would you know why it would be stalling?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comperio</span><br />
      <span class="post-time small text-muted">24th August 2006 04:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Did you read the 2nd part of my post?<br />
      <br />
      <b>[edit]</b><br />
      Also:<br />
      change your IntCmp functions to this:<br /></p>
      <pre>
<code><br />IntCmp $2 $3 end loop loop<br /></code>
</pre><br />
      Without the last parameter, it was stopping the loop when $2 was greater than $3 (which would have been all the time when starting the loop). With your original code, you would have had $4 = "/c" and not "/C/o/m/p/a/n/y".<br />
      <b>[end edit]</b>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
