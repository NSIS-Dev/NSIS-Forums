<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Windows Vista Standard session =&gt; Manifest without rights : Install = KO" />

  <title>Windows Vista Standard session =&gt; Manifest without rights : Install = KO - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Windows Vista Standard session =&gt; Manifest without rights : Install = KO</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=259216">Windows Vista Standard session =&gt; Manifest without rights : Install = KO</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">youn75</span><br />
      <span class="post-time small text-muted">9th November 2006 18:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Windows Vista Standard session =&gt; Manifest without rights : Install = KO</strong><br />
      Under Windows Vista on standard session user,<br />
      It is not possible to have an install in Program Files Path.<br />
      Manifest file is not complete.<br />
      On build with NSIS v2.21 we have this Manifest :<br />
      <font size="1"><br />
      &lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;<br />
      &lt;assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0"&gt;<br />
      &lt;assemblyIdentity<br />
      version="1.0.0.0"<br />
      processorArchitecture="X86"<br />
      name="Nullsoft.NSIS.exehead"<br />
      type="win32"<br />
      /&gt;<br />
      &lt;description&gt;Nullsoft Install System v2.21&lt;/description&gt;<br />
      &lt;dependency&gt;<br />
      &lt;dependentAssembly&gt;<br />
      &lt;assemblyIdentity<br />
      type="win32"<br />
      name="Microsoft.Windows.Common-Controls"<br />
      version="6.0.0.0"<br />
      processorArchitecture="X86"<br />
      publicKeyToken="6595b64144ccf1df"<br />
      language="*"<br />
      /&gt;<br />
      &lt;/dependentAssembly&gt;<br />
      &lt;/dependency&gt;<br />
      &lt;/assembly&gt;<br /></font><br />
      For a right install on Standard User session with highest privileges we must have this Manifest :<br />
      <br />
      <font size="1">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;<br />
      &lt;assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0"&gt;<br />
      &lt;assemblyIdentity<br />
      version="1.0.0.0"<br />
      processorArchitecture="X86"<br />
      name="Nullsoft.NSIS.exehead"<br />
      type="win32"<br />
      /&gt;<br />
      &lt;description&gt;Nullsoft Install System v2.21&lt;/description&gt;<br />
      &lt;dependency&gt;<br />
      &lt;dependentAssembly&gt;<br />
      &lt;assemblyIdentity<br />
      type="win32"<br />
      name="Microsoft.Windows.Common-Controls"<br />
      version="6.0.0.0"<br />
      processorArchitecture="X86"<br />
      publicKeyToken="6595b64144ccf1df"<br />
      language="*"<br />
      /&gt;<br />
      &lt;/dependentAssembly&gt;<br />
      &lt;/dependency&gt;<br />
      <font color="red"><b>&lt;trustInfo xmlns="urn:schemas-microsoft-com:asm.v3"&gt;<br />
      &lt;security&gt;<br />
      &lt;requestedPrivileges&gt;<br />
      &lt;requestedExecutionLevel<br />
      level="highestAvailable"<br />
      uiAccess="false"/&gt;<br />
      &lt;/requestedPrivileges&gt;<br />
      &lt;/security&gt;<br />
      &lt;/trustInfo&gt;</b></font><br />
      &lt;/assembly&gt;<br /></font><br />
      <br />
      I think the most expected into the next build version of NSIS, it will be to have a new variable in NSIS script :<br />
      1) for adding requestedPrivileges into manifest on compilation process,<br />
      2) for choosing the requestedExecutionLevel of requestedPrivileges.<br />
      <br />
      Regards,<br />
      <br />
      Yves</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">9th November 2006 18:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">NSIS 2.21 is exactly the version that added this feature. Use <a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.1.32" target="_blank">RequestExecutionLevel</a>.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">flizebogen</span><br />
      <span class="post-time small text-muted">10th November 2006 08:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I tested V.2.21 under Vista RC1 and was not able to install a nsis script.<br />
      <br />
      RequestExecutionLevel admin was set. The UAC didn't pop up, but the installation to C:\Program files was denied.<br />
      <br />
      Changing RequestExecutionLevel to user made the UAC pop up and then installing to C:\Program files worked.<br />
      <br />
      <br />
      Regards,<br />
      Flizebogen<br />
      <br />
      Strange - I tried it again and not it worked as expected.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">onad</span><br />
      <span class="post-time small text-muted">10th November 2006 10:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Windows Vista RC2 (or RTM out real soon) might change behaviour still.<br />
      <br />
      Let us know if your defect encountered still is there on these versions.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">youn75</span><br />
      <span class="post-time small text-muted">10th November 2006 10:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, I see it but for "RequestExecutionLevel" it exists another one. This one :<br />
      <br />
      highestAvailable<br />
      <br />
      It is the most important level otherwise it is not possible to install files to "Program Files" dir.<br />
      <br />
      Add it for next version is needed.<br />
      <br />
      Regards,<br />
      <br />
      Yves</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">youn75</span><br />
      <span class="post-time small text-muted">10th November 2006 11:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I have done a new test and I have changed manifest in ressource :<br />
      requestedExecutionLevel level="requireAdministrator"<br />
      by<br />
      RequestExecutionLevel level="highestAvailable"<br />
      <br />
      After than I have launched by arg /NCRC for seeing what's happening.<br />
      unfortunately, installation on standard user session in "Program Files" is no more done.<br />
      <br />
      I don't understand why because, it is OK with Installshield v12.0.<br />
      <br />
      Regards,<br />
      <br />
      Yves</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">youn75</span><br />
      <span class="post-time small text-muted">10th November 2006 12:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Oups,<br />
      <br />
      I had some files before to install in Windows folder and that stopped intall progress process.<br />
      For me it is 'OK' for installation in "Program Files" but I think it will be better to add "highestAvailable" parameter for "RequestExecutionLevel".<br />
      <br />
      Regards,<br />
      <br />
      Yves</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">10th November 2006 14:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've tested it again on Vista build 5728. With an administrator account, I was able to write to the Program Files folder with everything but `user` execution level. When using the power user, it asked me for the administrator's password. When using highest, it also gave me an option to use the power user's privileges which were not good enough to write to the Program Files folder. `user` was a failure with the power user as well. With normal user and guest accounts, `admin` worked and `highest` and `user` failed. Providing no manifest always worked because it used administrator's privileges.<br />
      <br />
      According to this tests, `admin` allows you to do anything, `highest` gives you the best the user has to offer and `user` allows nothing. This matches what <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnlong/html/AccProtVista.asp" target="_blank">MSDN</a> has to say about the issue and almost matches what the current documentation of NSIS has to say. I've mistakenly written that `user` will allow the best the user has to offer. That's actually `highest`. I've added `highest` to the latest version and modified the documentation to match.<br />
      <br />
      Something else might have happened to you while trying to write to Program Files. According to MSDN and tests `administrator` gives you administrator's privileges which should be sufficient to write to the Program Files folder.<br />
      <br />
      flizebogen, the UAC pop-up should always appear when using `admin`. Can you rerun the tests to make sure?</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
