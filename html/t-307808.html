<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Username/Password Integration"><title>Username/Password Integration - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Username/Password Integration</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=307808">Username/Password Integration</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">29th June 2009 22:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Username/Password Integration</strong><br>So im building a NSIS installer for one of the servers that im allowing that lets agents bridge their software to my db.<br><br>On my PHP form it takes their login/password and stores it then installs with those settings.<br><br><br>Is there a way to do this with NSIS?<br><br>Specifically, I would like it to prompt for a username/password in a window just after language setting, then transport that to one of the installer files.<br><br><br>Any ideas?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">30th June 2009 10:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">nsDialogs/InstallOptions. Or you can use the PassDialog plug-in but nsDialogs may be best.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">30th June 2009 15:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok so I got the user/pass to store to a variable, now all I need to do is print it to a .php file (it can be text, its just going to need to be there so that it can be found by another person)<br><br>FileOpen $9 asim_ini.php w<br>FileWrite $9 " &lt;?php"<br>FileWrite $9 " //bridge file created Mon, 29 Jun 2009 15:43:29 -0500 for user $uNameRem"<br>#FileWrite $9 " $asim_install_dir = "";"<br>#FileWrite $9 " $bridge_company = "A";"<br>#FileWrite $9 " $asim_bridge_upload_url = ""<br>#FileWrite $9 " $asim_bridge_server = ""<br>#FileWrite $9 " $asim_bridge_pub_key = ""<br>#FileWrite $9 " $browser_path = ""<br>#FileWrite $9 " $test_bridge_file_name = ""<br>#FileWrite $9 " $agent_auth = ""<br>#FileWrite $9 " $detect_os = ""<br>FileWrite $9 " //if this is an nt machine but %OS% is custom, uncomment next line and add custom value."<br>#FileWrite $9 " $custom_nt_os_env = "";"<br>#FileWrite $9 " $wl_user_name = "$uNameRem";"<br>#FileWrite $9 " $wl_user_password = "$pWord";"<br>#FileWrite $9 " $proxy_host = "";"<br>#FileWrite $9 " $proxy_port = "";//8080 and 3128 are common proxy ports"<br>#FileWrite $9 " $proxy_user = "";"<br>#FileWrite $9 " $proxy_pass = "";"<br>FileWrite $9 " ?&gt;"<br>FileClose $9<br><br>Thats what I have for my filewrite, but 2 things are the problem,<br><br>1. Its not writing the file and including it in the install....it doesnt show up in the folder with the install.<br><br>2. Im getting some random errors about it wanting 3 parameters instead of 6.<br><br>Ideas?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">30th June 2009 15:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">1. Specify a full path.<br>2. You have some quotes inside quotes. Either escape them using $\ or change the outer quotes to ` or '.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">30th June 2009 15:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Specify a full path for which, the<br><br>FileOpen $9 asim_ini.php w ?<br><br>i.e. FileOpen $9 C:\asim_ini.php w ?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">30th June 2009 16:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Correct. Otherwise it writes to the working directory (whatever $OUTDIR is).<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">30th June 2009 16:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Afrow UK</i><br><b>Correct. Otherwise it writes to the working directory (whatever $OUTDIR is).<br><br>Stu</b></blockquote>Ok, so here is my code. Everythign compiles without errors, but in the install Dir, the asim_ini.php is not showing up.<br><br>Am I doing something wrong? I changed the format of my code a bit.<br><br>Function asimwrite<br>!macro WriteLine Line<br>FileWrite $R0 `${Line}$\r$\n`<br>!macroend<br>!define WriteLine `!insertmacro WriteLine`<br><br>Push $R0<br>FileOpen $R0 `$INSTDIR\asim_ini.php` w<br>${WriteLine} ' &lt;?php'<br>${WriteLine} ' '<br>${WriteLine} ' '<br>${WriteLine} ' $bridge_company = "";'<br>${WriteLine} ' $asim_bridge_upload_url = "";'<br>${WriteLine} ' $asim_bridge_server = "";'<br>${WriteLine} ' $asim_bridge_pub_key = "5740dbb403b4c2c3bd7525e05364785ce84f23bc";'<br>${WriteLine} ' $browser_path = "C:\\Program Files\\Internet Explorer\\iexplore.exe";'<br>${WriteLine} ' $test_bridge_file_name = "test_brg.txt";'<br>${WriteLine} ' $agent_auth = "Y";'<br>${WriteLine} ' $detect_os = "Y";'<br>${WriteLine} ' //if this is an nt machine but %OS% is custom, uncomment next line and add custom value.'<br>${WriteLine} ' $custom_nt_os_env = "";'<br>${WriteLine} ' $wl_user_name = "$uNameRem";'<br>${WriteLine} ' $wl_user_password = "$pWord";'<br>${WriteLine} ' $proxy_host = "";'<br>${WriteLine} ' $proxy_port = "";//8080 and 3128 are common proxy ports'<br>${WriteLine} ' $proxy_user = "";'<br>${WriteLine} ' $proxy_pass = "";'<br>${WriteLine} ' ?&gt;'<br>${WriteLine} ' The write File is working!'<br>FileClose $R0<br>Pop $R0<br>FunctionEnd<br><br><br><br>All I need it to do is to make sure that text is in the .ini text file so that when it is called from another program that file is existant.<br><br><br>Ideas (thanks for all the help!)</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">30th June 2009 16:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Does $INSTDIR exist before you call this function?<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">30th June 2009 16:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Oh crap im dumb.<br><br>Okay so at the end of the install function, just call this function?<br><br>What is the code to call a function in NSIS?<br><br>Call {lkjsdklfjsd}?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">30th June 2009 16:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If you looked up Call you'd find out!<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">30th June 2009 16:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Doing that now!<br><br>Thanks for all the help!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">30th June 2009 16:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">God im dumb, it worked.<br><br>Wrote the file extremely well.....such a big help.<br><br><br>Now, when I do my username/login, its not writing the proper value that I had stored in the var.<br><br>Here is my code,<br><br>Var uNameRem<br>Var pWord<br><br>Function myPage<br>nsDialogs::Create 1018<br><br>!insertmacro MUI_HEADER_TEXT "Producer Login" "Please login to the server."<br>${NSD_CreateLabel} 0 0 300u 48u "To continue with installation you will need to login.$\n$\n$\n$\nPlease enter your producer code and password."<br>${NSD_CreateLabel} 20u 60u 60u 12u "Producer Code: "<br>${NSD_CreateText} 80u 58u 150u 12u $uNameRem<br>Pop $uNameRem<br>${NSD_CreateLabel} 20u 80u 60u 12u "Password: "<br>${NSD_CreateText} 80u 78u 150u 12u "" $pWord<br>Pop $pWord<br>GetDlgItem $0 $HWNDPARENT 1<br>SendMessage $0 ${WM_SETTEXT} 0 "STR:Login"<br>nsDialogs::Show<br><br>MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 "Are you sure you producer code is $uNameRem and your password is $pWord?" IDYES +2<br>FunctionEnd<br><br><br>when I call the $uNameRem and $pWord is just gives a big long number rather than what was entered. Is there a more explicit way to call this variable so it displays the correct variable?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">30th June 2009 17:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That is because they contain the text box control handles not the texts. You need to store the texts in 2 other variables and read the texts using NSD_GetText.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">30th June 2009 17:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Im not sure I follow you on this one, is there an example of this somewhere?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">30th June 2009 17:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">There are many examples. The nsDialogs doc shows it quite well too.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">30th June 2009 17:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">${NSD_CreateLabel} 20u 60u 60u 12u "Producer Code: "<br>${NSD_CreateText} 80u 58u 150u 12u ""<br>Pop $uNameRem<br><br>${NSD_CreateLabel} 20u 80u 60u 12u "Password: "<br>${NSD_CreateText} 80u 78u 150u 12u ""<br>Pop $pWord<br><br>${NSD_GetText} $uNameRem $Name<br>${NSD_GetText} $pWord $Pass<br><br><br>Thats what I have now, the problem is its not storing the information correctly.<br><br>I have the vars defined properly, but I have a feeling im missing something minor</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">30th June 2009 17:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You have to get the text in the leave function.<br><br>Edit: Also for the two CreateText lines rather than passing an empty string you could pass the two text variables instead so that the user does not have to enter again, but that is up to you.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">30th June 2009 17:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Afrow UK</i><br><b>You have to get the text in the leave function.<br><br>Edit: Also for the two CreateText lines rather than passing an empty string you could pass the two text variables instead so that the user does not have to enter again, but that is up to you.<br><br>Stu</b></blockquote>I dont follow you on the leave function....<br><br>Function nsDialogsPageLeave<br><br>${NSD_GetText} $Text $0<br>MessageBox MB_OK "You typed:$\n$\n$0"<br><br>FunctionEnd<br><br><br><br>Thats the only example of a leave function I could find</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">30th June 2009 17:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">All the examples use a leave function.<br><br>Page Custom ShowFunction LeaveFunction<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">30th June 2009 18:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Got it, thanks for the help afrow.<br><br><br>Next question: How can I convert the password string to an MD5 HASH?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">30th June 2009 18:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If you search the wiki for MD5 you will find 2 plugins.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">30th June 2009 18:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Got that far, just couldnt get it to display the proper hash value;<br><br>My code for it is;<br><br>Function LoginLeave<br><br>${NSD_GetText} $uNameRem $0<br>${NSD_GetText} $pWord $1<br>MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 "Are you SURE your producer code [$0] &amp; password [$1] are correct?" IDYES +2<br>Crypto::HashData "MD5" "$1"<br>Pop $2<br><br>FunctionEnd<br><br><br>Do I need to add a Get function in order to save that hash data for when it writes to the file?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">30th June 2009 19:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You should probably use the MD5 plug-in. I'm sure it's smaller in size.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">30th June 2009 19:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">New Code with MD5 still isnt working....hmmmm<br><br>${NSD_GetText} $uNameRem $0<br>${NSD_GetText} $pWord $1<br>MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 "Are you SURE your producer code [$0] &amp; password [$1] are correct?" IDYES +2<br>md5dll::GetMD5String "$1"<br>Pop $2<br><br><br><br>Edit: Do i need to add an output variable to the end of the md5 string?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">30th June 2009 20:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The Pop $2 puts the return value in $2.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">30th June 2009 20:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">thats what I thought, but when I display that value when im writing it to my file from earlier, it displays a null value.<br><br>Im assuming I need to write a function in that file writing function to call the md5 hash conversion?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">30th June 2009 20:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">got it, thanks for everything afrow</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ryanpager</span><br><span class="post-time small text-muted">30th June 2009 22:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Out of curiosity, for a password field, is there a way to get the text to show in the box as ******** rather than 12345676?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jpderuiter</span><br><span class="post-time small text-muted">2nd July 2009 19:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><a href="http://nsis.sourceforge.net/NsDialogs_FAQ#How_to_create_a_Text_Password_control" target="_blank">http://nsis.sourceforge.net/NsDialog...ssword_control</a></p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>