<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="autouninstall" />

  <title>autouninstall - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">autouninstall</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=151128">autouninstall</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SGI</span><br />
      <span class="post-time small text-muted">1st October 2003 17:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>autouninstall</strong><br />
      I have my autouninstall...but when Im running the autouninstaller there is the install window behind him ready.<br />
      I want to start the new installation only if is unistalled the old program and stop the installation (new program), if they dont accept the upgrade/cancell.<br />
      Thank you<br />
      <br />
      ReadRegStr $1 HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${PROD_NAME}" "uninstallstring"<br />
      StrCmp $1 "" cont<br />
      StrCmp $0 "" done<br />
      cont:<br />
      HideWindow<br />
      MessageBox MB_OKCANCEL|MB_ICONEXCLAMATION \<br />
      "This wizard will autouninstall the ${PROD_NAME}. $\n$\nIt is strongly recommended that you uninstall manually any previous versions of \<br />
      ${PROD_NAME} 2.5.${VER_MINOR}$\n$\nClick `OK` to install or `Cancel` to cancel this upgrade." \<br />
      IDOK uninst<br />
      Abort<br />
      <br />
      uninst:<br />
      ClearErrors<br />
      ExecWait '"$INSTDIR\uninstall.exe" /S_?=$INSTDIR'<br />
      <br />
      done:<br />
      BringToFront</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">1st October 2003 17:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you want to close the installer that runs the uninstaller, use<br />
      Exec '"$INSTDIR\uninstall.exe" /S_?=$INSTDIR'<br />
      Quit<br />
      <br />
      You could pass a command-line parameter to the uninstaller to be read in the uninstaller to re-run the installer when the uninstall is complete.<br />
      <br />
      E.g.<br />
      In installer .onInit<br />
      Exec '"$INSTDIR\uninstall.exe" /S_?=$INSTDIR yes'<br />
      Quit<br />
      <br />
      In uninstaller<br />
      Section Uninstall<br />
      ...<br />
      Call GetParameters<br />
      Pop $R0<br />
      StrCmp $R0 "/S_?=$INSTDIR yes" 0 noQuit<br />
      Exec installer.exe<br />
      Quit<br />
      noQuit:<br />
      SectionEnd<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">1st October 2003 18:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You'd better send the filename of the installer, because the user might have renamed the file.<br />
      <br />
      See <a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=427" target="_blank">http://nsis.sourceforge.net/archive/...b.php?page=427</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">1st October 2003 18:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ah yes!<br />
      Thinking about it now, it's probably easier to write the extra parameters to a temp ini file or to the registry, so that a string function isn't required to get hold of the sent command-line parameters.<br />
      <br />
      E.g.<br />
      In installer .onInit<br />
      Call GetEXEName<br />
      Pop $R0<br />
      WriteINIStr "$TEMP\myinstaller.tmp" "Installer" "InstallerEXE" "$EXEDIR\$R0"<br />
      Exec '"$INSTDIR\uninstall.exe" /S_?=$INSTDIR'<br />
      Quit<br />
      <br />
      In uninstaller<br />
      Section Uninstall<br />
      ...<br />
      IfFileExists "$TEMP\myinstaller.tmp" 0 noQuit<br />
      ReadINIStr $R0 "$TEMP\myinstaller.tmp" "Installer" "InstallerEXE"<br />
      Exec "$R0"<br />
      Delete "$TEMP\myinstaller.tmp"<br />
      Quit<br />
      noQuit:<br />
      SectionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">1st October 2003 18:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I think using the command line is a good solution.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">1st October 2003 20:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">A simpler solution would be reading the uninstaller's return value. As stated in <a href="http://nsis.sourceforge.net/Docs/AppendixC.html#C.2" target="_blank">C.2 Error Levels</a>, the uninstaller will return 1 if the process failed. Read it using the second parameter of ExecWait. For example:<br />
      <br />
      ExecWait '"$INSTDIR\uninstall.exe" _?=$INSTDIR' $0<br />
      StrCmp $0 0 goodToGo<br />
      Abort<br />
      goodToGo:<br />
      <br />
      BTW, you have an error in your call to the uninstaller. It seems as you've tried to make the uninstaller silent but missed a space after the /S parameter. I have removed it in my example because you've talked about the user clicking the cancel button, which is impossible if the uninstaller is silent.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">1st October 2003 20:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">But in that case the installer keeps running. The command line is used to send the installer filename.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">1st October 2003 20:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The installer should wait for the uninstaller if using _?=$INSTDIR on the command line.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">1st October 2003 20:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes, but it keeps running. It's nicer to close it until the uninstallation has completed.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">1st October 2003 20:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">HideWindow takes care of that, it shouldn't even show on the taskbar. And if this is used in .onInit, there is nothing to worry about anyway.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SGI</span><br />
      <span class="post-time small text-muted">2nd October 2003 18:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I never had a moment to try your script "help".<br />
      But thank you ....I'll let you know when I have free time.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SGI</span><br />
      <span class="post-time small text-muted">9th October 2003 05:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I tried your script and I have in thefollowing problem:<br />
      this is my script MUI_STARTMENUPAGE_DEFAULTFOLDER "${PROD_NAME}"<br />
      and I have the name of the "OutFile" <b>myinstaller1122.ex</b> be carefull no all name of the outfile ....missing letter <font color="red">e</font>.<br />
      So far..this is working great if the users dont change the name of the installer:<br />
      ReadRegStr $1 HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${PROD_NAME}" "uninstallstring"<br />
      StrCmp $1 "" cont<br />
      StrCmp $0 "" done<br />
      cont:<br />
      HideWindow<br />
      MessageBox MB_OKCANCEL|MB_ICONEXCLAMATION \<br />
      "This wizard will autouninstall the ${PROD_NAME}. $\n$\nIt is strongly recommended that you uninstall manually any previous versions of \<br />
      ${PROD_NAME} 2.5.${VER_MINOR}$\n$\nClick `OK` to install or `Cancel` to cancel this upgrade." \<br />
      IDOK uninst<br />
      Abort<br />
      uninst:<br />
      ClearErrors<br />
      ExecWait '"$INSTDIR\uninstall.exe" _?=$INSTDIR' $0<br />
      StrCmp $0 0 goodToGo<br />
      Abort<br />
      goodToGo:<br />
      done:<br />
      BringToFront<br />
      I have two choices :<br />
      -First: the users are unable to change the name.<br />
      -Second: find to do exactly what we want (best choice).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">9th October 2003 12:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What does the name of the installer has to do with this? You don't execute it. What exactly do you mean by "find to do exactly what we want (best choice)."?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SGI</span><br />
      <span class="post-time small text-muted">9th October 2003 14:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I used Afrow Uk script and I have the name of the installer myinstaller1122.ex("OutFile") and there I need my ${PROD_NAME}<br />
      MUI_STARTMENUPAGE_DEFAULTFOLDER "${PROD_NAME}"<br />
      <br />
      And what I mean "about" find to do exactly what we want (best choice). is to allow the users to change the name of the installer and autouninstall it.<br />
      But I found another problem: if the users changed the name of the previous version the new installer (with autouninstall) doesnt work.<br />
      Probably the best way is not to allow to change the name.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">9th October 2003 14:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You don't need Afrow's functions anymore. The code in your last post should be enough.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SGI</span><br />
      <span class="post-time small text-muted">9th October 2003 15:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you Kichik im thinking to use your code...is great.<br />
      And going to "not allow to change the name"</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SGI</span><br />
      <span class="post-time small text-muted">9th October 2003 17:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Btw I forgot to tell you ...I wrote that error on the Afrow UK on my installer to try to fix or see if is only a my problem.<br />
      I resolved my problem , with your script , but the forum is for all people no just for my script.<br />
      Thank you again for your patience.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SGI</span><br />
      <span class="post-time small text-muted">12th October 2003 07:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry Im back again....the autouninstaller was always triggered<br />
      even if no prior version of the program was installed.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">12th October 2003 12:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Please attach the entire script.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SGI</span><br />
      <span class="post-time small text-muted">12th October 2003 14:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you shoot the file....:(</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">SGI</span><br />
      <span class="post-time small text-muted">12th October 2003 14:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Sorry and thank you again...in the other post I attached the ini file.<br />
      <br />
      <a href="http://forums.winamp.com/showthread.php?threadid=152357&amp;goto=newpost" target="_blank">Link to INi file</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">12th October 2003 14:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">There is no place in the script where you actually write to HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${PROD_NAME}" "UninstallString". If you don't write anything there, the script won't be able to read anything from there. You should also write this key so your uninstaller would be listed in the Add/Remove control panel. See Appendix C - "Add uninstall information to Add/Remove Programs" for more information.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
