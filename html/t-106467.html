<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="VPatch 1.4 beta released"><title>VPatch 1.4 beta released - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">VPatch 1.4 beta released</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=106467">VPatch 1.4 beta released</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">22nd September 2002 10:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>VPatch 1.4 beta released</strong><br>I've finished a new beta version of the patch generator. What's new:<br>- Made patch generator 15-20% faster<br>- Removed progress indicator from GUI and replaced it with a console window<br>- Improved the GUI some more<br>- Included command line utilities (GenPat.exe and VAppend.exe)<br><br>Download <a href="http://gene.science.uva.nl/~ksande/vpatch14beta.exe" target="_blank">VPatch 1.4 beta</a><br><br>It's a beta version because I did not get a chance to do:<br>- create a DLL version of the runtime for NSIS 2 (can someone give me a hand? I need an ExDLL project which I can open &amp; compile in MS Visual C++ 6.0)<br>- check that the included PatchLib.NSI can be made any shorter by using new features of NSIS (it works but perhaps it could be shorter)<br><br>Let me know if you find any bugs/have problems!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">22nd September 2002 12:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">What's wrong with the ExDLL that already comes with NSIS? Just edit myFunction and you are set. Make sure you compile in Release mode.<br><br>If you still can't compile, what errors do you get?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">brainsucker</span><br><span class="post-time small text-muted">22nd September 2002 12:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>ExDLL</strong><br>I think he gets something like my problem: I can't open these Projects with MSVC++7.0, it say the project file is corrupt. Install Options - the same, and the LangDll opens successfully... Ok, going to find differences... will report...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">22nd September 2002 12:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well...<br><br></p><blockquote>(can someone give me a hand? I need an ExDLL project which I can open &amp; compile in <b>MS Visual C++ 6.0</b>)</blockquote>:D</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">22nd September 2002 12:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If I open the ExDLL workspace in MS Visual C++ 6.0, then the workspace window remains empty - nothing is opened. If I open the project then there is a complaint that the project file is "not ok" (don't know the exact message).<br>The problem is that I don't know how to create such a project file 'from scratch'. I can copy/paste into exdll.c, but I can't 'use' it without a proper project file.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">22nd September 2002 13:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I can't help you if you don't give me the exact error message...<br><br>To start a project from scratch go to File-&gt;New-&gt;Projects-&gt;Win32 Dynamic-Link Library. Give it a name, and compile. ExDLL has some size optimizations too. It is better to just use ExDLL and change all of the names.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">brainsucker</span><br><span class="post-time small text-muted">22nd September 2002 13:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Solution</strong><br>The solution was just as simple: someone sent (perhaps while using CVS?) these damaged dsp files with lineends in form of "CR" or "LF" (I never could remember which one means '0x0A' and which '0x0D' :), and by microsoft standarts (it seems so, at last) lineends should be "CRLF" or "LFCR" ( the same problem :).<br><br>Convertor attached. Use "ConvertLN &lt; infile &gt; outfile".<br>Maybe someone could update files at repository? ;)<br><br>P.S. Huh, just updated the version, cause previous should damage files with right lineends.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">22nd September 2002 13:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That depends on the CVS client you use to download the files. TortoiseCVS converts it to MS format. I will see to it that the night build will also be in MS format.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">brainsucker</span><br><span class="post-time small text-muted">22nd September 2002 14:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>:)</strong><br>Huh... In fact this is interesting microsoft bug... All other files could have any format, and only project ones are so stupid... And why some people could open it and others no?<br><br>Kichik and Koen: What OSes and MSVC (with SP numbers) do you have?<br>(I hope this is not a confedential information... :)<br><br>P.S. When the nighlty snapshot occurs, please? (In GMT)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">22nd September 2002 14:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Like I said brainsucker, it depends on the CVS client. I am using Tortoise and it converts it to MS line breaks automatically... The nightly snapshot doesn't. Rainwater has the times, I have no idea what the times are :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br><span class="post-time small text-muted">22nd September 2002 16:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Changing to CRLF does miracles :D<br>I was using the nightly snapshot btw.<br><br>I've converted most of the project, however I'm getting two compile errors now:<br>1) could be related to me renaming exdll.c-&gt;exdll.cpp (it occurs in the DLLmainCRTsomething function, on the hInstance= line):<br></p><pre>
<code><br>exdll.cpp<br>F:\vpatch\Code\rev15\DLL_C\exdll.cpp(93) : error C2440: '=' : cannot<br> convert from 'void *' to 'struct HINSTANCE__ *'<br>        Conversion from 'void*' to pointer to non-'void' requires an explicit cast<br>Error executing cl.exe.<br></code>
</pre><br>
      2) Uhm, don't know what this is:<br>
      <pre>
<code><br>Linking...<br>   Creating library Release/vpatchdll.lib and object Release/vpatchdll.exp<br>exdll.obj : error LNK2001: unresolved external symbol __chkstk<br>vpatchdll.bin : fatal error LNK1120: 1 unresolved externals<br></code>
</pre><br>
      <br>
      I've attached the project (with the meaningfull name "exdll".. still have to change that).<br>
      <br>
      Thanks for any help you can give me :)
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br>
      <span class="post-time small text-muted">22nd September 2002 17:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Right, KiCHiK was gonna answer you, but then he had to go, so then Eccles was gonna answer you, but then he had to go.... so it fell to me :)<br>
      <br>
      I was going to suggest you just rename it back to .c but then I noticed that you have lots of variable declarations after code which of course the C compiler won't like. Therefore I'd suggest you do what one of my C++ plugins does, move your actual exported plugin methods into a .cpp file and mark the functions like :<br>
      <br>
      extern "C" void __declspec(dllexport) myexportfunc(the usual plugin args)<br>
      <br>
      And include the exdll.h file at the top of the .cpp file like so :<br>
      <br>
      extern "C"<br>
      {<br>
      #include "exdll.h"<br>
      }<br>
      <br>
      That might help. KiCHiK's quick response to this was (a) don't rename the file to .cpp, and (b) he said something about watching those buffer sizes... I think he must have been cautioning against what you yourself in the code have commented on, hoping your 1024 byte buffers don't get overrun.<br>
      <br>
      If this doesn't solve your problem email me at ximon_eighteen@3b2.com and I'll put the effort in to getting your project compiling, right now I'll leave it to you tho in case that info helps.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">22nd September 2002 17:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I wasn't talking about his comments, I was talking about his second error, the linking error. __chkstk is a libc function that makes sure there is no stack overflow. It is automatically added to functions that needs more than 4K of memory on the stack. If you declare a buffer the size of 16000, it will be added, but, libc is not used for optimizing porpuses (saves about 50KB...) and thus __chkstk can not be found.<br>
      To solve this you either have to dynamically allocate the large buffers, or make them static. Static are "statically allocated" only once in memory and not with every call to the function and thus doesn't need __chkstk.<br>
      <br>
      If you need any further assitance please drop by the IRC channel.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br>
      <span class="post-time small text-muted">22nd September 2002 19:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It compiles now :D<br>
      It's just like you all said, thanks.<br>
      This just leaves one issue: where to store the patch data?<br>
      - Append it to the DLL: the EXE works this way, however I need to get the DLL name then (inside the DLL). Don't know how to do this with my limited API knowledge. And I'm not sure if you can let NSIS look in the current folder for plugins too?<br>
      - Keep it in a seperate file: Then it can be easily read from the stack. Just some extra work for the user.<br>
      Any suggestions? First one would be nice, but 2nd is easier to implement.<br>
      <br>
      Note: I can't access the IRC server. I have a dynamic IP address, and my current one is banned by some IRC server about 3 months ago. So unless I pull my net connection for an hour and acquire a new IP... you get the idea :rolleyes:. And the chances of getting a new IP succesfully... :igor:</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br>
      <span class="post-time small text-muted">22nd September 2002 19:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Koen van de Sande</i><br>
        Keep it in a seperate file: Then it can be easily read from the stack. Just some extra work for the user.<br>
        Any suggestions? First one would be nice, but 2nd is easier to implement.
      </blockquote>I prefer a separate file (also useful if you want to patch multiple files).
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br>
      <span class="post-time small text-muted">22nd September 2002 19:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Joost Verburg</i><br>
        <b><br>
        I prefer a separate file (also useful if you want to patch multiple files).</b>
      </blockquote>You can attach multiple patches to a single runtime.
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Koen van de Sande</span><br>
      <span class="post-time small text-muted">23rd September 2002 21:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Got to do a little more testing... but I just wrote a new implementation of the patch generator. And if it is working as good as it appears to be... it's fast :D</p>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>