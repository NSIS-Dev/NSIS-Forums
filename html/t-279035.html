<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="problems with Execwait coupled with checking for running while uninstalling..." />

  <title>problems with Execwait coupled with checking for running while uninstalling... - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">problems with Execwait coupled with checking for running while uninstalling...</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=279035">problems with Execwait coupled with checking for running while uninstalling...</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kinar</span><br />
      <span class="post-time small text-muted">15th October 2007 18:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>problems with Execwait coupled with checking for running while uninstalling...</strong><br />
      I have an installer that checks to see if the software is already installed and forces an uninstall before allowing a reinstall. To force the uninstall, I use ExecWait.<br />
      <br />
      ExecWait '"$PATH_DIR" _?=$INSTDIR'<br />
      <br />
      I also have a check in my uninstall that verifies the app isn't running when you uninstall by renaming the install directory, renaming it back and checking for errors.<br />
      <br />
      If the rename fails, then the uninstall aborts because files are already in use.<br />
      <br />
      The problem is that when the installer launches the uninstaller, forcing it to not copy to a temp directory so that it actually waits, the uninstaller is in use and the rename fails and doesn't allow the uninstall.<br />
      <br />
      As a result, a user must uninstall "manually" before installing. So ultimately I have the desired effect but at the expense of end user confusion.<br />
      <br />
      Can someone think of a better way around this?<br />
      <br />
      I could check each individual file to see if it is in use (instead of renaming) but that causes problems of modifying my installer everytime a new file is created that needs to be uninstalled. This is the only workable, yet undesirable, solution I have thus far.<br />
      <br />
      In the FAQ for ExecWait, I noticed this quote:<br /></p>

      <blockquote>
        To get around this problem, the executed installer must be told to <b>wait for the sub-installer</b> or simply do the work itself.
      </blockquote>This seems like an acceptable solution. My above implementation forces the installer to do the work itself (instead of copying itself to a temp dir and then running). I implemented it this way because I was told it is the only workaround that allows the installer to wait for an uninstall to complete before finishing.<br />
      <br />
      How can I tell the installer to wait for the sub-installer instead?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">15th October 2007 18:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Can you not just try a rename on the main application executable? Or, use a plug-in such as FindProcDLL or for a even more advanced check, with the LockedList plug-in.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">15th October 2007 18:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">if you copy the uninstaller to temp and execute it there in your installer(CopyFiles), the wait should work</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kinar</span><br />
      <span class="post-time small text-muted">15th October 2007 18:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Afrow UK</i><br />
        <b>Can you not just try a rename on the main application executable? Or, use a plug-in such as FindProcDLL or for a even more advanced check, with the LockedList plug-in.<br />
        <br />
        Stu</b>
      </blockquote>The problem is that it is an API that is being installed and literally hundreds of files (worst case) that would have to be checked individually (not just one exe). We could probably narrow it down to about 20 core files (exes, dlls, etc) but then it would become a nightmare to support the case where one of the others didn't get updated and is causing unexpected behavior.<br />
      <br />
      I took a brief look at your LockedList plugin. Does that require the LockedList.dll to be distributed? If so, that is not an acceptable option. However, I also noticed that you include the source code for the DLL, is it ok to use that source in one of our existing DLLs (in terms of licensing)?<br />
      <br />
      btw, this has kinda gotten away from the original question of "How can I tell the installer to wait for the sub-installer instead?" so if anyone has an answer to that, feel free to interupt this discussion.<br />
      <br />
      -edited to add quote since new replys were in the thread<br />
      <br />
      also noticed that you recommended a second plugin as well, I'll look at that one too and post in a new reply
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kinar</span><br />
      <span class="post-time small text-muted">15th October 2007 18:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Anders</i><br />
        <b>if you copy the uninstaller to temp and execute it there in your installer(CopyFiles), the wait should work</b>
      </blockquote>So you are saying to simply manually copy it to a temp and then execute it the same way I did above (with _?=$TEMP_DIR instead of $INSTDIR)?<br />
      <br />
      I think I tried that originally but ran into problems. I will have to check it out again and get post again. Do you know if that is what the WikiFAQ was referring to in the bolded section of the quote I have above?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kinar</span><br />
      <span class="post-time small text-muted">15th October 2007 20:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Changing<br /></p>
      <pre>
<code>ExecWait '"$PATH_DIR" _?=$INSTDIR'</code>
</pre><br />
      to<br />
      <pre>
<code>CopyFiles "$INSTDIR\uninst.exe" "C:\Temp\"<br />ExecWait 'C:\Temp\uninst.exe _?=$INSTDIR'</code>
</pre><br />
      <br />
      Just need to add something to get the "real" temp directory and I'll be set.<br />
      <br />
      Thanks everyone
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">15th October 2007 20:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">$temp is real temp, but using $pluginsdir is probably even better (remember to call InitPluginsDir first if needed)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kinar</span><br />
      <span class="post-time small text-muted">15th October 2007 20:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Now you've peaked my interest.<br />
      <br />
      Why would $PluginsDir possibly be "better" than $Temp? Is it still be better considering I currently use no Plugins?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">15th October 2007 21:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">$pluginsdir a subfolder inside $temp(you don't have to worry about an existing file with the same name already in the users temp dir), and it is auto deleted just before the process exits</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kinar</span><br />
      <span class="post-time small text-muted">15th October 2007 22:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">excellent, thanks again</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
