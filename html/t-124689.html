<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Decompile NSIS"><title>Decompile NSIS - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content=" Decompile NSIS"><title>Decompile NSIS - NSIS Forums</title><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Decompile NSIS</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=124689">Decompile NSIS</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Idimmu</span><br><span class="post-time small text-muted">11th February 2003 15:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Decompile NSIS</strong><br>How exactly I can decompile NSIS-compiled exe. Please some theory or concrete examples.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">11th February 2003 15:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Please see these search results:<br><a href="http://forums.winamp.com/search.php?s=&amp;action=showresults&amp;searchid=666339&amp;sortby=&amp;sortorder=" target="_blank">http://forums.winamp.com/search.php?...by=&amp;sortorder=</a><br>They should answer your question.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">11th February 2003 19:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Is not posible because you convert(Compile) your Source Code (Nsis Script) to Object code (Win32 EXE)...<br>reverse the process will give you the Object code<br>in unicode text, you know: !"#$%&amp;/()@</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">pjw62</span><br><span class="post-time small text-muted">11th February 2003 19:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">sir, where there is a will there is a way</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">11th February 2003 20:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">dark_boy, that's not true. NSIS doesn't create machine code. And reversing the process can give pretty good results.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">11th February 2003 20:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Then is possible, :D, how? With a HEX Editor?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">liquidmotion</span><br><span class="post-time small text-muted">11th February 2003 20:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">i know there is a file extractor around somewhere...anyone got a link?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">virtlink</span><br><span class="post-time small text-muted">12th February 2003 10:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Mostly, when you use an installer, all the files are extracted. I think that what Idimmu wants is to get the original script (or something alike).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">12th February 2003 14:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">dark_boy, all that needs to be done and to somehow find out the version of NSIS used to compile the installer, hope you're right and the developer didn't change the source of NSIS, read the headers, decompress data (assuming you know what compression type was used) and parse it. If the user didn't change the source, and you know the exact version the parsing will be very easy.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">virtlink</span><br><span class="post-time small text-muted">12th February 2003 15:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">A suggestion: Add the version of NSIS that it was compiled with to the header, so decompilers/decompiling people know what version was used. You could make this optional, so that not all NSIS installers can be decompiled unless you know the version number.<br>That versionnumber could be a number, starting at 0, going up for each CVS released.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">12th February 2003 17:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">That would only work for official versions, a modified source version would not be decompilable still.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">12th February 2003 19:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I watch the "source" in a HEX Editor and Resource Hacker...<br>Try to modify my IO page and when I try to recompile give errors<br>like:<br><br>Corrupted file.<br><br>Since there was used: CRCCheck, upx, etc...<br><br>It's very dificult(but not impossible) to reverse the project....<br>We most know the properties of the installer to know what we<br>can do...<br>must agree with Virtlink .... I think that he was looking for is<br>the script that genereted the installer....</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">12th February 2003 20:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">dark_boy I think you've got the wrong idea about decompilation. You don't approach it with a hex editor. You'd try to write a program that would load the installer data in the same way that the header attached to the data by makensis would go about it. In that way you'd be able to determine the opcodes and parameters to each opcode that would be run, and be able to decompress the data files contained within the exe installer. The only difficulty arises when handling many possible forms of binary data because the actual form depends on which version of makensis was used to create the exe. If you don't know what version of makensis was used to create the installer then life becomes very difficult, and it becomes (practically) impossible if an altered makensis (it is opensource after all) was used to create the installer.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joel</span><br><span class="post-time small text-muted">12th February 2003 21:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Virgin at that too :)</strong><br>mmm, ok... need to read more books about decompilation.<br>But to avoid these:<br></p><blockquote>many possible forms of binary data because the actual<br>form depends on which version of makensis was<br>used to create the exe</blockquote>Let's make a cool installer in the first time.... ;)<br>These compilation make ma head dizzy :igor:<br>Thanks for the info.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">12th February 2003 22:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>need to read more books about decompilation</blockquote>It's just the reverse process of compilation, and in our case that means what is done as an nsis installer runs... just doing that. The only reason it is hard is (a) it was never designed to be done by something other than the installer itself, and (b) decompilation code written at one time might not handle an installer created in the future... there's not much you can do about that.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">virtlink</span><br><span class="post-time small text-muted">14th February 2003 12:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Conclusion: Decompilation is hardly possible, if possible at all. But since the decompiling user only needs to extract the source code (after all, the files are extracted by the installer itself), I would include the source code and extract it automatically to the $TEMP directory. When you need it, you can get it there. And when you release your program with the installer, you just remove the few lines that include and extract the source code file.<br>Then you have never the trouble of losing the source, but having the installer that you want to decompile.<br>Might also be an option for a switch that you can use when you run MakeNSIS.exe, instead of coding it yourself.<br><br>You could even encrypt the sourcecode file with a password, to prevent others from taking the source, but no need to remove those lines when you release it.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sunjammer</span><br><span class="post-time small text-muted">14th February 2003 12:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote>But since the decompiling user only needs to extract the source code (after all, the files are extracted by the installer itself)</blockquote>The first time I came across the topic of decompilation on this forum it was not with this in mind. Instead the user who raised the issue wanted to recovere the files inside the installer when the installer had become corrupted (failed download or whatever).</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">virtlink</span><br><span class="post-time small text-muted">14th February 2003 12:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Didn't think of that.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sh0e</span><br><span class="post-time small text-muted">28th March 2003 03:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Re: Decompile NSIS</strong><br>so from reading these threads..<br>assuming you know that the original version 1.98 nsis was used and you have the original script.. you could possibly extract the files?<br>could somebody provide some information as to some point i can start at in doing something like this?<br>perhaps some information on how and where compressed files are generically stored.. or the listing of the files stored..<br><br>using a generic sfx that does nothing but extract its files.. and that uses gzip<br>i have been able to locate compressed version of the data within the executable.. (matching the gzip data) which is basically the compressed data without the header<br>the only thing i can think of right now is to find a way to locate the start and end.. which is actually not the hard part<br>and to somehow reconstruct a header..<br>or maybe just use zlib and feed it to a gunzip stream<br>im hoping tho that this is actually stored somewhere that can be excessible.. and thats generic<br>and there is not an easily spottable list of the filenames..<br><br>admittingly i am being a little lazy.. i have not actually traced/reversed the code in detail to find the possibilities of this<br>im hoping that there is some information for this :D</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">virtlink</span><br><span class="post-time small text-muted">28th March 2003 11:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">KiCHiK, Joost, Sunjammer: Are the files written between the instructions that the installer has to execute, or are they written at the end of the .exe-file. If not, I suggest this mayor change so that from all the NSIS compiled exe-files the files can be extracted, whatever version you would have.<br>Can you tell me how this works?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">RDaneel</span><br><span class="post-time small text-muted">28th March 2003 19:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Well, this <b>does</b> bring up something I have wondered about since I first came across NSIS - why aren't the ZIP-style header structures written out to the EXE?<br><br>Sure, this could be optional, and it only applies if you are using the ZIP family of compression algorithms, but the headers / data structures <i>are</i> specified such that they can occur "embedded" in some larger file... heck, I was doing this with my own installer that I used before I switched to NSIS - mostly because of MUI - thanks, Joost <i>et al.</i> :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sh0e</span><br><span class="post-time small text-muted">28th March 2003 20:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">RDaneel:<br>im not sure what you are trying to say.. but nsis does not use the zip compression format<br>but rather either bzip2 or zlib(gzip deflate)<br><br><br>virtlink:<br>the compressed data is stored at the end of the file.. i have been able to successfully take out some of the compressed data<br>and by creating a valid gzip header and appending the snippet of compressed data..<br>i have been able to extract original compressed data..<br>unfortunately this requires a lot of user intervention/analysis<br>and i have not been able to find original filenames..<br>it appears the header data is stored elsewhere.. and most likely in a special way..<br><br>i am hoping that a equivalent to the compressed datas header can be found somewhere in the sfx..<br>i will do some reversin today and see if i can turn up anything<br><br>but it is imo that extraction is potentially possible<br><br>and ive seen some people bring up the point that it will not work with all versions.. or you cant detect version..<br>and also some talking about possible alteration of the original program<br>well first of all it can be up to the user to find out what version executable it is.. i dont think that should matter<br>if it is wanted support for different versions can be put in.. and then the user could chooses which version to try.. this can be made a trial and error thing<br>second of all.. any sfx method can be altered.. this decompiler will target a specific "pure" version.. there is nothing wrong with that<br>i dont see why this should discourage development on such an utility..<br>on a further note.. this utility would not even need to be targetted at normal users.. just devers.. who cares?<br>and even if the original source were changed.. changing the way the data is stored would require large structural changes in the nsis sfx generation..<br>the new sfx would in a sense not be nsis anyways.. and its not of any concern to this decompiler utility<br><br>btw i dont think that it is impossible to detect version..<br>as anti-virus scanners prove.. every executable has a "signature" that you can detect<br>to claim that detecting differences in version is impossible does not make sense..<br>there must be something from version to version that is similar or different</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sh0e</span><br><span class="post-time small text-muted">28th March 2003 20:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>some information dug</strong><br>anyways i forgot to mention what ive found out so far.. this information is specific to version 1.98<br>the data appears to always start at address 0x8e00(decimal 36352)<br>as everything above this point is the same consistently with all generated executables<br><br>so i know that the header information must be somewhere in here..<br>and i am convinced the header information is stored in a special nsis way.. as if you turn compression off you will find the file listing seperated from the file content data<br>it seems that each file content data has 4 bytes of data preceding it.. which tells the size and compression..<br>so if you have a file that uses gzip deflate and is 5 bytes long you will have these 4 bytes: 05 00 00 80<br>anyways size and decompressing is easy to do.. i cant quite find the file listing.. i suspect if you use compression it compresses the filenames as well..<br>if anyone has information and can save me some time...;)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">RDaneel</span><br><span class="post-time small text-muted">28th March 2003 21:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I know that NSIS doesn't use "ZIP" <i>per se</i>, and you <b>may</b> elect to use bzip2 (I do)... that is why I deliberately used the phrase "ZIP family"... but where do you think "deflate" came from? :)<br><br>Anyway, I brought up the subject of these headers (actually, they are more "trailers", given that they typically come at the end of or late in the containing file) because some have expressed an interest in accessing the files contained in an NSIS-built installer, and this approach provides a fairly standard way of doing just that... for instance, installers built containing these headers are able to be "understood" by programs like WinZip - in particular, this is one of the ways that the WinZip context menu entry "Open with WinZip" becomes available.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sh0e</span><br><span class="post-time small text-muted">28th March 2003 21:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">ic what you are trying to say now..<br>what you describe are sfx installers that embed a "block" of data that is the direct compressed archive appended to the program<br>and works because most archivers search for the headers in a file<br><br></p><blockquote>RDaneel: actually, they are more "trailers"</blockquote>you are somewhat partially right.. part of the informational stuffs is put in "trailing" data.. but for most there is also a preceding header of information<br>for example gzip puts a crc32 value and uncompressed file size in the "trailer"<br>and the preceding headers contain the gzip identifier.. bytes compression method.. and some other information<br><br>in any case the aforementioned headers are not embedded directly with the original specifications in the nsis generated sfx..<br>and it seems to be deliberate..</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sh0e</span><br><span class="post-time small text-muted">28th March 2003 21:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">anyways ive made more headway.. i believe i may have found gzip data representing the filenames..<br>following the identifying text NullInst..<br>the following seems to be placed depending on the letter immediately following the NullInst text.. (how far it is displaced)<br>there will be 4 bytes that represents the size and compression method of a block of compressed data.. i suspect the filenames or more information used by the sfx<br><br>and then immediately following the above mentioned block is the compressed file data which i already identified earlier</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">RDaneel</span><br><span class="post-time small text-muted">28th March 2003 21:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">For anyone interested in how this really works,<br><br><a href="http://www.pkware.com/products/enterprise/white_papers/appnote.html" target="_blank">http://www.pkware.com/products/enter...s/appnote.html</a><br><br>talks about it from their perspective. Note that things are simpler if you are not dealing with (or <b>generating</b>, as I am suggesting here) their Zip64/Deflate64 extensions, <i>and</i> remembering that we are specifically talking about DEFLATE and Windows.<br><br>To reiterate: this should be quite do-able (depending on exactly how NSIS constructs the files portion of the installer), and would allow NSIS installers to be viewed as "archives" by virtually any of the many free and commercial archive-viewing programs out there. Whether this would be allowed or not <i>could</i> be then left up to the developer generating the NSIS installer, through a directive in the .NSI file or a command-line switch if that is preferred.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">28th March 2003 22:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">NSIS supports different compression methods. ZIP/BZIP2 headers won't be added because it will be a lot of work and it adds extra size (both the headers and the code to ignore all these things).<br><br>Not being able to decompile is also a good thing for many people.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sh0e</span><br><span class="post-time small text-muted">28th March 2003 22:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">what you are saying involves altering the structure nsis uses in generating the sfx<br>this involves changing the source and recreating the packages<br>this does not help in decompiling.. and is rather something that would be added as a feature to the nsis format<br><br>in any case.. what you are saying defeats the purpose of using nsis.. as it will alter the basic structure used by nsis<br>you are better off creating your own sfx format or using another sfx format.. and this would be really what you would be doing<br>if went by what you have said<br><br>analyse the way that the nsis sfx are built and you will see what i mean</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">RDaneel</span><br><span class="post-time small text-muted">28th March 2003 22:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">a) like I said, "optional"<br><br>b) this was for the posters who wanted to get at the contents of an NSIS-generated installer<br><br>c) I personally am happy with the way things are :)<br><br>d) why do you keep talking about "sfx"? If you mean it as "generic self-extracting archive", that's cool... of course, if you mean it as a ".sfx" file, that is a specific format - not what NSIS uses - which does support the functionality I describe! :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">28th March 2003 22:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">It's too much work for such a thing. You would need different structures for each compression method.<br><br>IMHO it's useles too...who would need it?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sh0e</span><br><span class="post-time small text-muted">28th March 2003 22:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">oh.. hm..<br>sfx is supposed to be an acronym for self-extracting executable<br>maybe ihave it wrong.. but ive always used it :D</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sh0e</span><br><span class="post-time small text-muted">28th March 2003 22:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">joost:<br>it is still possible to decompile it..<br>without anything done while making the package<br>at least im pretty sure of it..<br>since ive found information that may allow this<br><br>tho it will be difficult to make it generic<br>ive been able to successfully extract files<br>by constructing valid headers and putting it with<br>the compressed data ive been able to locate inside some sfx<br><br>ive found some new info that may allow it to be generic..<br>but it will take some more work.. but i think its possible<br><br>anyways what i am hoping is that someone can give some insight<br>so that i can maybe do this quicker.. as ive seen info<br>on people who seem to have made programs for past versions<br>that may speed things up for me as starting points</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Ippi</span><br><span class="post-time small text-muted">29th March 2003 17:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">FYI, the Kaspersky Antivirus (I use version 4.0.9) treats NSIS-generated installers as archives and checks all files inside without any difficulties.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sh0e</span><br><span class="post-time small text-muted">29th March 2003 17:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">yes but its easier on the av scanners..<br>av scanners do not need the filenames or listings to scan the files..<br>all they need to do is search for patterns within the data blocks..<br>which use gzip or bzip2 compression.. so its a simple matter for them<br>ive been able to successfully attach reconstructed header/trailer to the data blocks in the files<br>and actually extract files using that..<br>i need to work on a way to easily locate this block..<br>and to parse the filenames and listings and paths<br>it appears that a data file containing strings representing the filenames and other stuff is also compressed in a data block<br>just need to find a way to easily parse this right now</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">29th March 2003 18:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I'm not saying that it's impossible to decompile NSIS installers. You can always get at least the compressed data from the file.<br><br>What I mean is that there are more important things to do than adding optional support for decompilation.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sh0e</span><br><span class="post-time small text-muted">29th March 2003 18:53 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">aha i see.. yes i fully agree with that joost</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Ippi</span><br><span class="post-time small text-muted">29th March 2003 19:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I think the opposite option - blocking decompilation at all - will be also useful...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sh0e</span><br><span class="post-time small text-muted">29th March 2003 20:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">basically what you are asking for is a method of encrypting the data<br>and actually i would disagree with that..<br>first of all it will add to bloat of the program and im not sure but from reading the history it appears adding this would contradict their direction<br>second of all there are plenty of other programs that are designed for this<br><br>and of course you will never be able to completely block it anyways theres always a way around it.. and its usually pretty trivial to circumvent<br>and adding the fact that this is open source..<br>all it would take is a couple of decent coders..<br>give or take a week at the most itll be cracked</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">29th March 2003 20:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Getting the script from a compiled installer is almost impossible. If you want to be even more sure, you can change the order of the instructions in fileform.h and recompile.<br><br>Encrypting the file data is useles, because the installer is being used to extract these files.</p></div><hr><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Decompile NSIS</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=124689">Decompile NSIS</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Ippi</span><br><span class="post-time small text-muted">29th March 2003 22:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">All data may be at least encrypted with a random key during compilation. Of course, this key will be stored somewhere in the installer, but retrieving of this key will be a bit tricky and probably will not be fully automatizeable. In this manner we can embarrass the coming of some kind of "universal NSIS decompiler".<br><br>I am not trying to say that the above feature is absolutely necessary. But if we discuss the NSIS decompiling, it is not out of place to consider another side of subject.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">virtlink</span><br><span class="post-time small text-muted">30th March 2003 08:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">sh0e was able to extract some files from an installer, but it was very hard and is not yet easy. Extracting a script is impossible, since most of the script is compiled. All macro's and !ifdef's are lost. All installer attributes too.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">30th March 2003 11:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Getting the original script from an installer is impossible. Even if the NSIS version was not recompiled and you could get the script data (which would require lots of work), you can't get the installer attributes, labels, macro's etc, so the script will be useles.<br><br>File encryption for an installer that installs files is useles.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sh0e</span><br><span class="post-time small text-muted">30th March 2003 13:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">joost i agree with everything you said in the last post..<br>but i couldnt find the comment related to extracting the script?<br>could you provide the quote so i can better understand the viewpoint thx<br><br>virtlink:<br>it isnt actually that difficult..<br>youd be suprised at how easy this really is</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">virtlink</span><br><span class="post-time small text-muted">30th March 2003 13:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">But Ippi, do you understand that even if there would be some kind of 'universal NSIS decompiler', it wouldn't make any difference. At first, I doubt that there will ever be one. Secondly: The script cannot be retrieved and the files are extracted anyway. So what use is it to encrypt files which are decrypted and installed without any key or question?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sh0e</span><br><span class="post-time small text-muted">30th March 2003 13:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">btw finding now that all sfx generated<br>have the same executable code in the beginning<br>which i would consider as a "base" or "skeleton"<br>and i have found a lot of strange garbage like stuff<br>(i havent truly analysed it fully)<br>within the compressed block that contains the file listings..<br>i have a biting suspicion that the "garbage" may be some kind of<br>compiled version of the script.. and may possibly be decompiled (?)<br><br><br>oh yes i forgot to mention this before.. the version IS detectable<br>within this compressed data block is a string containing version..<br>heres the snippet copy/paste from an example i am reversing from<br>&gt;Nullsoft Install System v1.98</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">virtlink</span><br><span class="post-time small text-muted">30th March 2003 14:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I don't think that that 'garbage', if it's a script, can be decompiled, due to what Joost and I have been saying.<br>But maybe KiCHiK, Subjammer and/or Joost can jump into this conversation and give us some more info about the structure of the compiled .exe-file.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sh0e</span><br><span class="post-time small text-muted">30th March 2003 14:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">decompiled into the original script? probably not<br>but perhaps that data can be translated<br>into some kind of pseudo code<br>kinda useless tho</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">30th March 2003 15:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You can never get the original script from the exe file. All defines, macro's, installers attributes are being processed by the compiler.<br><br>What I mean is that there is no need for encryption, because you can't get anything useful from the exe file.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">virtlink</span><br><span class="post-time small text-muted">30th March 2003 15:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">We understand that Joost, but maybe you could tell us a bit more about the compiled .exe itself. Than sh0e can find out how to extract the files from a corrupted NSIS installer. What is the 'garbage' he's talking about?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">30th March 2003 15:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">A corrupted installer is called corrupted for a reason. Trying to extract files from such an installer is bad mojo.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">30th March 2003 17:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">A compiled installer has three parts:<br><br>1. NSIS VM<br>2. Script code<br>3. File data<br><br>Probably the 'garbage' is the script code.<br><br>The first two parts are very small. If the installer is corrupted, you can be quite sure that the compressed data is corrupted, so you won't be able to get the files back.<br><br>If certain files are not corrupted, you can always start NSIS with the /NCRC parameter so it will ignore the corruption (this is not possible if CRCCheck is set to 'force').</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sh0e</span><br><span class="post-time small text-muted">30th March 2003 17:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">i dont see why this "bad mojo" should be reason<br>that development on such a decompiler should not be done<br>in any case my reasons are for platform issues<br>and lets say the executable is truncated or the headers<br>are corrupted.. or certain blocks of data are corrupted<br>some of the data within the executable would still be<br>salvagable..<br><br>yes i see that structure and it is apparent.. the script<br>code is also compressed it seems<br>for some reason the filenames are embedded with the script code<br><br>i have found something strange tho..<br>i have been unable to reproduce the structure that some<br>sfx generated by nsis seem to have..<br>and supposedly they are all using unmodified v1.98..<br>which is strange as all the sfx ive made come out the same..<br>for example one has a significantly smaller vm.. by about 10kb<br>and the data is of a different structure</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sh0e</span><br><span class="post-time small text-muted">30th March 2003 17:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">correction.. i was downloading old versions..<br>which is why there was such a difference<br><br>it seems i have all the information i need<br>although a little bit more about the script code<br><br>anyways i will be creating a program<br>restricted to gzip deflate of unmodified nsis v1.98<br><br>probably not of use to anybody here..<br>but there is a project that is in need of this<br>and i will create what they need<br>no thx to those of you who made<br>scoffing type of comments or discounting<br>the merit in the creation of this</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Ippi</span><br><span class="post-time small text-muted">30th March 2003 18:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Joost Verburg</i><br><b>File encryption for an installer that installs files is useles.</b></blockquote>Not every installer always installs all files it contains.<br><br><blockquote><i>virtlink</i><br><b>So what use is it to encrypt files which are decrypted and installed without any key or question?</b></blockquote>While protection is usually provided by program itself, sometimes this function assigned to distribution package. In this case any difficulties attending the unauthorized file extraction process may be considered as positive factor.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">virtlink</span><br><span class="post-time small text-muted">30th March 2003 19:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Ippi</i><br><b>Not every installer always installs all files it contains.</b></blockquote>I don't see why an installer would contain files that aren't installed. There aren't any advantages except a size increase. :weird:<br><br><blockquote><i>Also originally posted by Ippi</i><br><b>While protection is usually provided by program itself, sometimes this function assigned to distribution package. In this case any difficulties attending the unauthorized file extraction process may be considered as positive factor.</b></blockquote>In that unusual case, I would encrypt the files before compiling the installer. And I would include a small DLL/EXE that can decrypt the files with the right key.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">RDaneel</span><br><span class="post-time small text-muted">30th March 2003 19:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by virtlink</i><br><b>I don't see why an installer would contain files that aren't installed. There aren't any advantages except a size increase. :weird:</b></blockquote>As an example, a <i>unified</i> installer meant to work differently in different [detected at install-time] environments... maybe extracting and installing a .VXD file on Win 9x, but installing a service instead on NT4/2000/XP?<br><br>Or installing different language DLLs based on the install-time environment detected?<br><br>Or even optionally installing components based on user selection? :D<br><br>Etc.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Ippi</span><br><span class="post-time small text-muted">30th March 2003 19:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by virtlink</i><br><b>I don't see why an installer would contain files that aren't installed. There aren't any advantages except a size increase. :weird:<br></b></blockquote>For example, the Windows Service Packs contain files for all possible configurations and all product subfamilies (server/workstation), but only the nesessary files are installed during the update. If you write a some kind of service pack for your product, which appears as "Standard" and "Pro" versions, you possible will not desire that files designated for the "Pro" version (which very likely is more expensive) can be easy mined by the "Standard" version owner.<br><br>Please understand: I'm not trying to say that program or data protection must be done in that way (quite the contrary, I never did the program protection in manner we discussed). But what to do if someone will like this way?<br><br>Actually, I know what to do ;) Encrypt the files into SFX with password using something like WinZip or WinRar and then call it from the script (password can be stored in the script, calculated in some way or retrieved from the user).</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">sh0e</span><br><span class="post-time small text-muted">30th March 2003 19:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">such a feature would add too much overhead<br>and the encryption will most likely be<br>somewhat trivial to reverse<br>with the key contained in the executable<br>i seriously doubt such a feature will be considered<br><br>-&gt;already established<br>besides.. it is possible to do thru scripting<br>and adding a decrypter to execute within the executable</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">virtlink</span><br><span class="post-time small text-muted">31st March 2003 11:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">sh0e, you just said what I said too (not that I mind ;)). That's what I mean. Just include a decrypter, and encrypt the files at compile time, or before.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br><span class="post-time small text-muted">31st March 2003 14:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by RDaneel</i><br><b>As an example, a <i>unified</i> installer meant to work differently in different [detected at install-time] environments... maybe extracting and installing a .VXD file on Win 9x, but installing a service instead on NT4/2000/XP?<br><br>Or installing different language DLLs based on the install-time environment detected?<br><br>Or even optionally installing components based on user selection? :D<br><br>Etc.</b></blockquote>So there is still no need for encryption. These files will be installed depending on the OS and user selection.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">mesurf</span><br><span class="post-time small text-muted">6th October 2008 00:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Joost Verburg</i><br><b>Getting the script from a compiled installer is almost impossible.</b></blockquote>Well you can use 7Zip to extract an NSIS installer.... Also I found that Avast also scans for viruses inside the isntallers which is nice...<br><br>I was gonna make an installer to hack concurrent connections to winxp sp3 for my mce box, then i found that somebody else already made an installer for that, but i wanted to make sure it was virus free any who... it is an can be found here if anybody cares about concurrent terminal sessions in XP (like it was in the early builds prior to GM.)<br><br>Peace...<br><br><a href="http://www.kood.org/terminal-server-patch/" target="_blank">http://www.kood.org/terminal-server-patch/</a></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">parasoul</span><br><span class="post-time small text-muted">7th October 2008 07:26 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">7-Zip can extract the files within a NSIS installer package, aside from BZIP2 compression</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
    hljs.initHighlightingOnLoad();
    //]]></script></div></body></html>