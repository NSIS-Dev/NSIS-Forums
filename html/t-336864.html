<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="MGSBOX async, ExecDos::exec running after installer closes and registry comparison."><title>MGSBOX async, ExecDos::exec running after installer closes and registry comparison. - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">MGSBOX async, ExecDos::exec running after installer closes and registry comparison.</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=336864">MGSBOX async, ExecDos::exec running after installer closes and registry comparison.</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">rick.m</span><br><span class="post-time small text-muted">1st November 2011 20:23 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>MGSBOX async, ExecDos::exec running after installer closes and registry comparison.</strong><br>&nbsp; Hi NSIS experts,<br><br>I'm playing with NSIS installer during the last 2 weeks and it's awesome, congratulations! :)<br><br>I have 3 questions and I can't find the answer myself, neither reading google and documentation, so I'm asking your help.<br><br>My installer is an application that will be deployed silent to our workstations of our company via Windows Netlogon.<br><br>1) My installer is silent as I told, however, I want to give a brief message to our users that the installation is running just to make them aware. I'm using MSGBOX, and it works, the problem is that I noted that if the user do not click on the "OK" button it never continue the installation and it's a problem, in special because I'm sure that I few users will be switching between applications and this MSGBOX will be minimized and they will not see it and at the end of the day they will turn off the computer and the installation will not be properly completed. There is a way to do a MSGBOX asynchronous ? Or another alternative?<br><br>2) At the end of my installer I want to delete all temporary files, including my all installer (because I have confidential data inside), I created a .bat file to delete everything and it works fine when I call from cmd.exe, but not from NSIS installer. I'm using ExecDOS::exec and I tried with /ASYNC and NOUNLOAD, but both fails, I mean, they work, but they are not able to delete my installer because it's in-use. There is a way to execute a command (bat file) in silent mode and exit from the installer but keep the bat file working? Or any other alternative solution to accomplish this goal?<br><br>3) I need to do a registry comparison, if value equal x86 I have to execute command A, B and C, if equal to x64 I have to execute command D, E and F and at the end independent of this registry values I have to execute command G and H. I have the following code:<br><br></p><blockquote>ReadRegStr $1 HKLM "Software\Microsoft\Office\14.0\Outlook" "Bitness"<br>StrCmp $1 "x86" 86Machine<br>Goto Independent<br><br>ReadRegStr $3 HKLM "Software\Microsoft\Office\14.0\Outlook" "Bitness"<br>StrCmp $3 "x64" 64Machine<br>Goto Independent<br><br>86Machine:<br>Command A<br>Command B<br>Command C<br><br>64Mchine:<br>Command D<br>Command E<br>Command F<br><br>Independent:<br>Command G<br>Command H</blockquote>However it always execute all routines (86Machine, 64Machine and Independent). Can you please help me to fix it?<br><br>Thanks.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">T.Slappy</span><br><span class="post-time small text-muted">2nd November 2011 06:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">1) Asynchronous MSG is wrong idea, MessageBoxes are used for controlling flow of program, ofter they are used for user decision.<br>a) simply do not show this MSG<br>b) create modeless window which will inform user that installer is running - but when installer finishes window will be closed.<br><br>2) Create another (silent) installer - called setup2.exe<br>In your setup.exe call [at the end] setup2.exe which will simply wait several seconds {while setup.exe exits} and then setup2.exe will delete setup.exe and any other files.<br><br>3) Flow of your code is wrong, use another GoTo after executing commands for each platform.<br></p><pre>
<code>ReadRegStr$1 HKLM "Software\Microsoft\Office\14.0\Outlook" "Bitness"
<br>&gt;StrCmp $1 "x86" 86Machine
<br>Goto Independent
<br><br>ReadRegStr$3 HKLM "Software\Microsoft\Office\14.0\Outlook" "Bitness"
<br>&gt;StrCmp $3 "x64" 64Machine
<br>Goto Independent
<br><br>86Machine:
<br>&gt;Command A
<br>Command B
<br>Command C
<br>GoTo ContinueAll; Without this jump you will fall into 64Mchine and execute Command D ...
<br><br>&gt;64Mchine:
<br>&gt;Command D
<br>Command E
<br>Command F
<br>GoTo ContinueAll; Without this jump you will fall into Independent and execute Command G ...
<br><br>&gt;Independent:
<br>&gt;Command G
<br>Command H 
<br><br>ContinueAll:
<br>;You are here now... 
</code>
</pre>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>