<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Sorting a DropList" />

  <title>Sorting a DropList - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Sorting a DropList</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=259432">Sorting a DropList</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ashu.joshi</span><br />
      <span class="post-time small text-muted">13th November 2006 13:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Sorting a DropList</strong><br />
      &nbsp; Dear All ,<br />
      <br />
      I have been using NSIS for quite some time now and i really find it very useful and interesting.<br />
      <br />
      Till date all of my queries were answered by seraching through this elaborate Forum of yours. But now i have a query for which i could not find any answers.<br />
      <br />
      I have created a DropList by using "SendMessage $R3 ${CB_ADDSTRING} 0 "STR:Item1" in a loop.<br />
      <br />
      But after adding the items i am unable to sort this list.<br />
      Pls advise.<br />
      <br />
      I am using NSIS 2.15 with InstalloptionsEx<br />
      <br />
      Thanks in advance<br />
      <br />
      - Ashutosh</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">14th November 2006 23:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can set the CBS_SORT style of the combo box. You could do it by calling SetWindowLong with the System plug-in. If that doesn't work, you'll have to create the window with that style in advance. For that, you'd probably have to change the source code of InstallOptionsEx.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ashu.joshi</span><br />
      <span class="post-time small text-muted">15th November 2006 04:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you so much. Will try it out and let you know the outcome.<br />
      <br />
      - Ashutosh</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">ashu.joshi</span><br />
      <span class="post-time small text-muted">15th November 2006 09:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hello Kichik,<br />
      <br />
      Tried using the system plugin with the function mentioned by you, but it does not seem to work. This is what I tried :<br />
      <br />
      strlen $5 $NEWLIST<br />
      <br />
      intop $5 $5 - 1<br />
      ${For} $R1 0 $5<br />
      strcmp $R1 0 0 +2<br />
      SendMessage $R3 ${CB_ADDSTRING} "STR:None"<br />
      strcpy $R2 $NEWLIST 1 $R1<br />
      strcmp $R2 "|" +2<br />
      SendMessage $R3 ${CB_ADDSTRING} 0 "STR:$R2"<br />
      ${next}<br />
      SendMessage $R3 ${CB_SETCURSEL} 0 0<br />
      ;SetWindowLong(hwnd,GWL_STYLE,0)<br />
      ;!define GWL_STYLE -16<br />
      ;!define GWL_EXSTYLE -20<br />
      strcpy $1 68288533 ;"0x2000L" ;"CBS_SORT"<br />
      System::Call "user32::SetWindowLongA(i $R3, i ${GWL_STYLE}, i r1)"<br />
      <br />
      -----------------------------------------------------------<br />
      So i just sorted my string before using the CB_ADDSTRING and that solved the problem.<br />
      <br />
      Thanks you.<br />
      <br />
      -Ashutosh</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Yathosho</span><br />
      <span class="post-time small text-muted">12th April 2010 16:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">looking for the same. i'm using the locate plugin to get a couple of files i want to display in a droplist. looking for some way to sort the files alphabetically.<br />
      <br />
      any ideas?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Wizou</span><br />
      <span class="post-time small text-muted">12th April 2010 17:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">try setting the CBS_SORT style *before* adding the strings</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Yathosho</span><br />
      <span class="post-time small text-muted">12th April 2010 18:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Wizou</small><br />
        try setting the CBS_SORT style *before* adding the strings
      </blockquote>it won't display the control.<br />
      <br />
      i guess i could use the array plugin, but why should it - if it should work without it
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">12th April 2010 18:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I thought I had this added to the nsDialogs pages somewhere already, but I guess not.. Stuffed it into the FAQ.<br />
      <br />
      <a href="http://nsis.sourceforge.net/NsDialogs_FAQ#How_to_create_a_sorted_droplist_control" target="_blank">http://nsis.sourceforge.net/NsDialog...oplist_control</a><br />
      ( pages are slow to load again - try again later if it doesn't appear to go anywhere )</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Yathosho</span><br />
      <span class="post-time small text-muted">12th April 2010 21:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">thanks animaether, works perfectly</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">12th April 2010 23:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">For the record you have to get the current style first with GetWindowLong, binary or CBS_SORT with the returned value and set the new value with SetWindowLong.<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Animaether</span><br />
      <span class="post-time small text-muted">12th April 2010 23:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <small>Originally posted by Afrow UK</small><br />
        For the record you have to get the current style first with GetWindowLong, binary or CBS_SORT with the returned value and set the new value with SetWindowLong.
      </blockquote>I couldn't get that to work when I made that header.. maybe I missed something, though...<br />
      <br />
      <pre>
<code>
"LogicLib.nsh"
<br />&gt;!include "nsDialogs.nsh"
<br />&gt;!include "WinMessages.nsh"
<br /><br />&gt;/* from: http://nsis.sourceforge.net/NsDialogs_FAQ#How_to_create_a_sorted_droplist_control */
<br />&gt;!include "nsDialogs_createDroplistSorted.nsh"
<br /><br />&gt;OutFile test.exe
<br /><br />XPStyle on
<br /><br />&gt;Var dialog
<br />&gt;Var hwnd
<br />&gt;Var null
<br /><br />Page custom nsDialogsPage
<br /><br />&gt;Function nsDialogsPage
<br /><br />    nsDialogs</code>::Create 1018
<br />        Pop $dialog
<br /><br />   ${NSD_CreateDroplist} 0 0 100% 40% ""
<br />        Pop $hwnd
<br />        System::Call "user32::GetWindowLong(i $hwnd,i ${GWL_STYLE}) i.r1"
<br />       IntOp $1 $1 | ${CBS_SORT}
<br />       System::Call "user32::SetWindowLong(i $hwnd,i ${GWL_STYLE}, i r1)"
<br />       ${NSD_CB_AddString} $hwnd "C"
<br />       ${NSD_CB_AddString} $hwnd "B"
<br />       ${NSD_CB_AddString} $hwnd "A"
<br />        /* doesn't work? */
<br /><br />   ${NSD_CreateDroplistSorted} 0 20% 100% 40% ""
<br />        Pop $hwnd
<br />       ${NSD_CB_AddString} $hwnd "Z"
<br />       ${NSD_CB_AddString} $hwnd "Y"
<br />       ${NSD_CB_AddString} $hwnd "X"
<br />        /* should work */
<br /><br />   nsDialogs::Show
<br />FunctionEnd
<br /><br />Section
<br />SectionEnd 
<br />&gt;

</pre>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>