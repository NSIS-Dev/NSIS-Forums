<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="EXE Encription and DLL security issue"><title>EXE Encription and DLL security issue - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">EXE Encription and DLL security issue</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=210580">EXE Encription and DLL security issue</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Sam_Engenuity</span><br><span class="post-time small text-muted">16th March 2005 14:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>EXE Encription and DLL security issue</strong><br>Hey all<br><br>This is my first post on this forum, i have 2 issues that have arised while i was creating installers for Engenuity's products.<br><br>My first question is, Is the compiled EXE file encripted? is it secure? Is there a way to penetrate in the exe and be able to extract files that you normaly don't want the user to extract?<br><br>My second question is, One of my installers has to call a dll function using the system::call however, i dont want the user to, see the dll... or be able to copy it, access it, hack it and change the current dll with the modified one that he created. The dll basically checks to see if the user is licensed to install the product or not. Is there a way to hide the dll, or to encrypt it somehow...? this is actually a big security issue for the company since they are using Installshield and they want to move with NSIS but just because of that, they might not.<br><br>Thank you very much for your answers<br>Samuel Godbout<br>Engenuity Technologies .inc<br><a href="http://www.engenuitytech.com/" target="_blank">http://www.engenuitytech.com/</a></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">16th March 2005 16:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I heard that there's software that can decompress files in an NSIS installer, but obviously from the system that has the installer on it (not remotely).<br><br>As for using that dll, all I can think of is to extract it, call it, and delete it immediately. I'm not sure how to hide it (other than using file flags)<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sam_Engenuity</span><br><span class="post-time small text-muted">16th March 2005 18:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for your reply Afrow UK<br><br>So you are saying that yes it is possible to decompress an NSIS Installer and be able to hack into it?<br>In a way the EXE is not encripted at all....<br><br>And for the DLL i tried doing what you said... I extracted the DLL in the $PLUGINDIR called it using system::call however when i try to delete it after, it doesnt allow me since, it says that it is in use. All of the code is written in Function .oninit<br><br>What can i do?<br>Thx for the help</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Pidgeot</span><br><span class="post-time small text-muted">16th March 2005 19:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">While it's impossible to guarantee that no one will ever see your DLL, you can still take various steps to keep as few people as possible from trying to crack your product(s).<br><br>Some of the things you can do are:<br>*Making the DLL file hidden upon extraction<br>*Extract as late as possible, delete as soon as possible<br>*Overwrite the file contents repeatedly to prevent undeletion<br>*Use various checks in the installer to make sure the file has not been tampered with<br>*Use various checks in the DLL to try to make sure the file has not been tampered with<br>*Make the DLL code long and complicated by inserting a bunch of useless, but seemingly relevant code right around the verification part, thus making disassembly very tiresome<br>*Instead of packing the DLL as-is, include an encrypted version and a decrypter in your uninstaller to run just before using the DLL<br>*Create a hacked version of NSIS that uses a more secure checksum, such as MD5 or SHA1, to prevent tampering<br>*Download the DLL instead of extracting it, failing the installation if anything goes wrong during the download (would be a great inconvenience if user doesn't have internet access on the target machine)<br><br>Of course, not all of these things could be done in .onInit, but the code could be adjusted accordingly.<br><br>FWIW, InstallShield wouldn't be all that much better, since you would still have to take similar steps in an attempt to guard your files from tampering. That should not be the argument for not switching, since it holds true for any installer - since the installer can do all of it on its own, a determined person could perform disassembly to tamper with the files, or learn how to extract single files.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">16th March 2005 20:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Hmm thinking about it anyway, as long as you re-extract the DLL in .onInit whenever the installer is ran then how can they get a tampered DLL to be used in the installer?<br><br>I haven't checked if this works, but you could try using the NSIS MD5 plugin on itself!<br>Edit: No that won't work because you have to have a copy of the checksum in your installer to begin with lol<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br><span class="post-time small text-muted">16th March 2005 20:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">yep, but as long as it's nearly impossible to reverse md5 encryption, this version is safe:<br>- include the checksum in your installer<br>- include the md5sum plugin in your installer<br>- get a string/integer from the user, encode it (with just one call of md5 plugin) and compare it with saved string (just another line: StrCmp instruction) and then deal with the result.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Sam_Engenuity</span><br><span class="post-time small text-muted">16th March 2005 20:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for your reply Pidgeot<br><br>*Extract as late as possible, delete as soon as possible<br><br>I understand.. however i have the same problem as before. I extract the file call it through system::Call and then when i try to delete it, the installer tells me that the file is use. I can't delete it until the installer ends and closes. I can't overwrite the file either since its in "use".<br><br>Is there a way to delete it or overwrite it somehow??<br>Thanks again</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">17th March 2005 17:48 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The System plug-in doesn't unload the DLL after it uses it. You can force it to unload it by using ?u. For example:</p><pre>
<code>System::Call "mydll::myfunc() ?u"</code>
</pre></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>