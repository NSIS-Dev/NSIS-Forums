<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Go back after Page InstFiles, run the installer again" />

  <title>Go back after Page InstFiles, run the installer again - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Go back after Page InstFiles, run the installer again</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=182764">Go back after Page InstFiles, run the installer again</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">petko</span><br />
      <span class="post-time small text-muted">9th June 2004 06:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Go back after Page InstFiles, run the installer again</strong><br />
      Hello,<br />
      <br />
      I am trying to write an installer with two pages, a custom page using InstallOptions and the page InstFiles. After installing/updating some stuff, I need it to go back, expecting the user to give another input data. The user can close the program by pressing the Cancel button on the first page.<br />
      <br />
      Unfortunately the Back button on the page InstFiles is disabled. The only working method that I found is Exec "$CMDLINE":<br /></p>
      <pre>
<span style="color: #007700">Function.</span><span style="color: #0000BB">onInstSuccess
<br />Exec</span><span style="color: #DD0000">'$CMDLINE'
<br /></span><span style="color: #0000BB">FunctionEnd
<br /></span>

<!-- php buffer end -->
                
                
                
</pre>
      <hr />
      <pre>
        
but this way the program closes and reopens, and has to decompress everything once again. Another solution would be to add some more pages:<br />
        
</pre>
      <pre>
<code>PagecustomShowCustom
<br />PageInstFiles
<br />PagecustomShowCustom
<br />PageInstFiles
<br />PagecustomShowCustom
<br />PageInstFiles
<br /></code>
</pre>
      <pre>

        
but I don't want to have a limit - as the user may need to update one file or twenty-five.<br /><br />For this goal, the global label ".onceagain:" in ShowCustom, called by .onInstSuccess isn't working.<br /><br />The best thing would be to enable the "Back" button on the page InstFiles. Do you have any idea how it could be done? I would apreciate any other idea/method that would work.<br /><br />Thank you very much for your attention.<br />Petko
                
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">petko</span><br />
      <span class="post-time small text-muted">9th June 2004 09:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I also tried some trikcs I found <a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=363&amp;instances=0,11" target="_blank">here</a>, but maybe I'm still doing something wrong.<br />
      <br /></p>
      <pre>
<code>PageInstFilesshowInst
<br /><br /></code><span style="color: #007700">function</span><span style="color: #0000BB">showInst
<br />GetDlgItem$R0$HWNDPARENT3
<br />EnableWindow$R01
<br />FunctionEnd
<br /></span>
</pre>This actually enables the "Back" button before the end of the installation, but when the text "Completed" appears, the button is disabled again.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">9th June 2004 10:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hard situation here. You could create another installation just to enable the button, using <i>Sleep</i> and the lines of code to enable the button (only changing the hWnd by the real installer one which means that <i>FindWindow $var "#32770"</i> is necessary here). Run this second program before ending the installation.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">petko</span><br />
      <span class="post-time small text-muted">9th June 2004 13:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thank you for the idea, but doesn't seem to work as expected. When I push the Back button, instead of returning to the first custom page, it runs again directly the page InstFiles. Here is the script for back.exe, called as 'Exec "$PLUGINSDIR\back.exe $HWNDPARENT"'<br />
      <br /></p>
      <pre>
<span style="color: #007700">!include</span><span style="color: #DD0000">"WinMessages.nsh"
<br /><br /></span><span style="color: #0000BB">Name</span><span style="color: #DD0000">"back"
<br /></span><span style="color: #0000BB">OutFile</span><span style="color: #DD0000">"back.exe"
<br /><br /></span><span style="color: #0000BB">Sectionmain
<br />SectionEnd
<br /><br /></span><span style="color: #007700">Function.</span><span style="color: #0000BB">onInit
<br />sleep500
<br />callGetParameters
<br />Pop$R0
<br /><br />strCmp$R0</span><span style="color: #DD0000">""</span><span style="color: #0000BB">skip
<br />GetDlgItem$R1$R03
<br />IsWindow$R10skip
<br />EnableWindow$R11
<br />gotoend
<br />skip</span><span style="color: #007700">:
<br /></span><span style="color: #0000BB">MessageBoxMB_OK</span><span style="color: #DD0000">"Novalidwindowspecified"
<br /></span><span style="color: #0000BB">end</span><span style="color: #007700">:
<br /></span><span style="color: #0000BB">abort
<br />FunctionEnd
<br /></span><span style="color: #007700">Function</span><span style="color: #0000BB">GetParameters</span><span style="color: #007700">;</span><span style="color: #FF8000">//asinthemanual
</span>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">petko</span><br />
      <span class="post-time small text-muted">9th June 2004 14:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>It works!!!</strong><br />
      It works, finally, with an additional check how the page InstFiles is called:<br />
      <br /></p>
      <pre>
<code>PagecustomShowCustomLeaveCustom
<br />PageInstFilesshowInst
<br /><br /></code><span style="color: #007700">Function</span><span style="color: #0000BB">LeaveCustom
<br />StrCpy$R91
<br />FunctionEnd
<br /></span><span style="color: #007700">function</span><span style="color: #0000BB">showInst
<br />intcmp$R91end
<br />abort</span><span style="color: #007700">;</span><span style="color: #0000BB">notcomingfromthefirstpage
<br />end</span><span style="color: #007700">:
<br /></span><span style="color: #0000BB">FunctionEnd
<br />Sectionmain
<br />StrCpy$R90
<br /></span><span style="color: #007700">;</span><span style="color: #0000BB">etc</span><span style="color: #007700">.
</span>
</pre>Thank you very much, deguix, for the tip. :up:
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Shorin</span><br />
      <span class="post-time small text-muted">7th July 2006 15:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Need a better solution....</strong><br />
      I was hoping such a simple task as making the page go back was simpler than making an external utility...<br />
      <br />
      Anybody have a better idea? (not requiring plugins?)<br />
      <br />
      - Also could someone please summarize this post and show the code that "works". It's a little confusing here.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Shorin</span><br />
      <span class="post-time small text-muted">7th July 2006 16:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Also I can't seem to get this working. It does what you said before. It goes directly to the instfiles page (annoying). I even put the changes in you said to.<br />
      <br />
      Also, I want back enabled only on error in installation.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mr Inches</span><br />
      <span class="post-time small text-muted">7th July 2006 16:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Try this:<br />
      <br />
      Use the Finish Page, but use the "Run" checkbox to be 'Run installation/again' option.<br />
      Then use deguix's Goto To NSIS page function here (<a href="http://nsis.sourceforge.net/Go_to_a_NSIS_page" target="_blank">http://nsis.sourceforge.net/Go_to_a_NSIS_page</a>) in the Run function that it calls, to return to the custom InstallOptions page.<br />
      <br />
      I have used a similar mechanism in an updater that updates multiple computers, so in my case the 'Run' box becomes an 'update another computer' box.<br />
      <br />
      Duncan</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Shorin</span><br />
      <span class="post-time small text-muted">7th July 2006 16:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'm checking that out. Also I have gotten the code on this page working. &lt;I&gt;However&lt;/I&gt; There are several mistakes.<br />
      'showInst' should really be a Pre function for INSTFILES page, not a show function.<br />
      A bug that I ran into was that the top says "Installation Aborted", and all the navigation buttons (except cancel) are disabled.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Shorin</span><br />
      <span class="post-time small text-muted">7th July 2006 19:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>CORRECT SOLUTION!</strong><br />
      I have a working, and correct solution!<br />
      <br />
      Uses deguix's RelGotoPage.<br />
      <br />
      ;this helps us navigate between pages. Cannot be called from a section or section function. Only pre-show-post functions can be callers. Won't work otherwise.<br />
      PHP Code:</p>
      <hr />
      <code style="white-space:nowrap"><!-- php buffer start --></code><span style="color: #000000"><span style="color: #007700">Function</span><span style="color: #0000BB">RelGotoPage<br />
      Pop$R9<br />
      IntCmp$R900MoveMove<br />
      StrCmp$R9</span><span style="color: #DD0000">"X"</span><span style="color: #0000BB">0Move<br />
      StrCpy$R9</span><span style="color: #DD0000">"120"<br />
      <br /></span> <span style="color: #0000BB">Move</span><span style="color: #007700">:<br /></span> <span style="color: #0000BB">SendMessage$HWNDPARENT</span><span style="color: #DD0000">"0x408""$R9"""<br /></span> <span style="color: #0000BB">FunctionEnd<br /></span> ;$GOBACK is a custom global variable. Should be initialized to 1, indicating success.<br /></span>
      <pre>
<span style="color: #007700">Function</span><span style="color: #0000BB">LeaveInst</span><span style="color: #007700">;</span><span style="color: #0000BB">LeaveInstistheleave</span><span style="color: #007700">functionfor</span><span style="color: #0000BB">INSTFILES</span><span style="color: #007700">.
<br />${If}</span><span style="color: #0000BB">$GOBACK</span><span style="color: #007700">==</span><span style="color: #0000BB">0</span><span style="color: #007700">;</span><span style="color: #0000BB">thisspecialvariableGOBACKis1whenwecomeasuccessfulinstall</span><span style="color: #007700">.</span><span style="color: #0000BB">Its</span><span style="color: #DD0000">"0"</span><span style="color: #007700">if</span><span style="color: #0000BB">anerroroccuredinthesectioninstall</span><span style="color: #007700">.
<br /></span><span style="color: #0000BB">StrCpy$R9</span><span style="color: #DD0000">"&lt;--NUMBEROFPAGESTONAVIGATE(+,-),YOURVALUE--&gt;"
<br /></span><span style="color: #0000BB">CallRelGotoPage
<br />Abort
<br /></span><span style="color: #007700">${EndIf}
<br />Return
<br /></span><span style="color: #0000BB">FunctionEnd
<br /></span>
</pre>;If you encounter an error ANYWHERE (most likely in a section. Set GOBACK to 0 and Return immediately.<br />
      ; Aborting the section instead will cause all your navigation buttons to be disabled.<br />
      ; Note that your Descript text at the top will still say "installing" when you go back to that page.<br />
      ; I'm sure there is a way to fix this though.<br />
      <br />
      - A drawback I know will occur is that the sections after your section with an error will continue to install. I am not sure how to prevent this. Perhaps <b>checking that error flag (GOBACK)</b> at the beginning of each section will tell us whether to install anything.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mr Inches</span><br />
      <span class="post-time small text-muted">8th July 2006 00:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Shorin, sounds like you are on the right track.<br />
      <br />
      You need to remember that when using RelGotoPage, it does not reset any of the variables that may have changed during the first pass of your installer (this includes any built-in/standard ones too), so you need to do this explicitly. For example, I use the RealProgress plugin, so I need to remember to reset my progress counters and unload/load/reset the RealProgress plugin before jumping back pages. My updater only has one section so I haven't seen your behaviour with multiple sections.<br />
      <br />
      Also, petko, the problem of unpacking each run can be handled by unpacking for files into a directory in the $TEMP directory in the .onInit function, refer to your files during your install, and then remove them in the .onGUIEnd function.<br />
      <br />
      Duncan</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
