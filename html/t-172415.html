<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="alternative for FindWindow" />

  <title>alternative for FindWindow - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">alternative for FindWindow</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=172415">alternative for FindWindow</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">7th March 2004 15:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>alternative for FindWindow</strong><br />
      hey.<br />
      <br />
      i need to detect if a game is running, that my installer want's to modify.<br />
      FindWindow won't work, because the window-caption includes date-information, which is impossible for me to get on any other system than my own.<br />
      but i know the .exe-name.<br />
      is there any other possibility?<br />
      i need to detect the running state, warn the user with a messagebox, and exit the game, if the user clicks on 'yes'.<br />
      i know how to do the last thing with SendMessage, but i don't know how to detect the window.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">7th March 2004 16:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It might set a mutex or you can write a plug-in that gets the list of processes.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">7th March 2004 16:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        It might set a mutex ...
      </blockquote>and that means ... ? :)<br />
      <br />

      <blockquote>
        ... or you can write a plug-in that gets the list of processes.
      </blockquote>yes, i could, if i'd know how. someone other may do this. :)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">7th March 2004 19:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">another possibility:<br />
      is there an api-call availiable to get the window-class of a thread, by his filename?<br />
      or some calls one by one to do this job?<br />
      so it would look like that:<br /></p>
      <pre>
<code>System::&lt;something&gt;<br />&lt;something other&gt;<br />FindWindow &lt;something&gt;</code>
</pre><br />
      u know what i mean?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Joost Verburg</span><br />
      <span class="post-time small text-muted">7th March 2004 19:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can search for a class name using FindWindow.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">8th March 2004 18:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can use Process Explorer (sysinternals) to c if the program creates a mutex...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">8th March 2004 19:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">@joost:<br />
      what i mean, is, that the FindWindow command needs the window-caption to find the window-class.<br />
      but the caption is variable. the only constant is the filename.<br />
      so, i need a command, that gets the window-caption (or class) from the filename.<br />
      <br />
      @anders:<br />
      i already asked: what is a mutex?<br />
      and i don't know c very well, too less to write a plugin or something similar.<br />
      <br />
      so, if there's an api-call, that i can use with the system-plugin, it'd be very nice :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MindlessOath</span><br />
      <span class="post-time small text-muted">8th March 2004 20:49 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">cant u just use findwindow and then just find the first few letters to determain the info you need, and leave out the date info?<br />
      <br />
      in regular programming, thats how i would do it.<br />
      <br />
      also seeing the process list would work to find the exe.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">8th March 2004 21:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hmm, tried it already, but didn't work :)<br />
      and, yes, through the taskmanager, _I_ could get the name, but the installer has to do this himself.<br />
      or, joost, what do u say, is there any possibility to use wildcards, or just parts of the name?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">11th March 2004 17:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hmm, as i saw <a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=386" target="_blank">this archive page</a>, i thougt that might be work for me too, in a slightly different way.<br />
      how could i detect and perhaps shutdown a task by it's mutex?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">26th March 2004 11:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">FindWindow()<br />
      GetWindowThreadProcessId()<br />
      GetModuleFileNameEx()<br />
      <br />
      But if this is your game, you can set window user_data<br />
      SetWindowLong(hDlg, GWL_USERDATA, YOUR_PROG_ID);<br />
      <br />
      This is my macro<br />
      <br />
      !macro TerminateMgr<br />
      <br />
      loop:<br />
      FindWindow $1 "#32770" "" 0 $1<br />
      IntCmp $1 0 done<br />
      IsWindow $1 0 done<br />
      System::Call "user32.dll::GetWindowLong(i r1, i -21) i.r0"<br />
      IntCmpU $0 0x4d475201 0 loop loop<br />
      SendMessage $1 0x0010 0 0<br />
      Sleep 600<br />
      goto loop<br />
      done:<br />
      <br />
      !macroend</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">27th March 2004 17:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">thank u very much!<br />
      i'll try that immidiately.<br />
      but which code do i have to customize for my application?<br />
      and what does your macro detect? the filename or the window-caption, like FindWindow?<br />
      <br />
      another thing i found while searching the inet:<br />
      <a href="http://eric.aling.***********/PB/tips/pbtip41.htm" target="_blank">http://eric.aling.***********/PB/tips/pbtip41.htm</a><br />
      <br />
      this may help too.<br />
      <br />
      and, no, it's not my game.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">27th March 2004 17:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This macro gives you all top level window handles<br />
      <br />
      !macro FindWin<br />
      <br />
      loop:<br />
      FindWindow $1 GAME_WINDOW_CLASS "" 0 $1<br />
      IntCmp $1 0 done<br />
      IsWindow $1 0 done<br />
      <br />
      #insert here 2 WIN API calls<br />
      #GetWindowThreadProcessId() - this gives you process ID for $1 window handle<br />
      #GetModuleFileNameEx() - gives path\file for process ID.<br />
      #both like System::Call ... - appendix C of NSIS help<br />
      <br />
      # next sends WM_CLOSE to window found - may be you don't need this. And WM_CLOSE may not terminate any application<br />
      SendMessage $1 0x0010 0 0<br />
      <br />
      # if few games are running and 1 sec to finish game<br />
      <br />
      Sleep 1000<br />
      goto loop<br />
      done:<br />
      <br />
      !macroend<br />
      <br />
      I wrote macro (above) to terminate my program both on install and uninstall.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">27th March 2004 17:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">And you can get game window class (string instead of GAME_WINDOW_CLASS I used above) using MS VS tool Spy++ for example.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">27th March 2004 17:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">erm, that's the problem:<br />
      the GAME_WINDOW_CLASS is variable.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">27th March 2004 18:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">attached the current development state of my function to check for a running game.<br />
      any help with the api-calls would be appreciated.<br />
      maybe some of our freaks here know some answers, like kichik or lobo-lunar?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">27th March 2004 18:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">sorry, i forgot onething:<br />
      you need to copy the attached dll to your nsis/plugins folder.<br />
      <br />
      (it's no txt, but dll's can't be attached directly. just rename)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">27th March 2004 19:41 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">GAME_WINDOW_CLASS is not script variable, it's a window class name :) For example Windows Notepad main window class is "Notepad", Internet Explorer Window - "CabinetWClass". If you don't know how to get game window class name (or this may vary), use<br />
      FindWindow $1 "" "" 0 $1<br />
      instead and check up all top level windows.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">27th March 2004 20:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">yes, but that's the point!!!<br />
      from version to version, the window-class name of the game changes!<br />
      that's just what i ment. i don't know the complete name.<br />
      <br />
      /edit:<br />
      ok, got it, but how do i get all the window-class names?<br />
      the first 13 chars of the title are constant, that may help.<br />
      <br />
      /edit2:<br />
      i'm sorry, i didn't read your posts carefully enough.<br />
      this would work:<br />
      GetWindowThreadProcessId()<br />
      GetModuleFileNameEx()<br />
      but could you tell me the correct syntax for these functions?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">atsuk</span><br />
      <span class="post-time small text-muted">27th March 2004 20:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">if you just need to close active program, then you could use:<br />
      KillProcDLL::KillProc "game.exe"<br />
      information about it:<br />
      <a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=271" target="_blank">http://nsis.sourceforge.net/archive/...php?pageid=271</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">27th March 2004 21:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">hmm, that's a very nice thing.<br />
      <br />
      but, i first wanted to pop-up a messagebox, to ask the user.<br />
      so, that's not the perfect solution for me. i want to do the steps, that this dll does, myself with nsis.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">atsuk</span><br />
      <span class="post-time small text-muted">27th March 2004 21:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">no problem:)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">27th March 2004 21:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">can you help me with the syntax of these commands?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">atsuk</span><br />
      <span class="post-time small text-muted">27th March 2004 21:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">i think it should work..just edited my own script a little<br />
      <br />
      Function "close"<br />
      MessageBox MB_YESNO|MB_ICONQUESTION|MB_DEFBUTTON1 "wanna close?" IDNO cancel<br />
      KillProcDLL::KillProc "game.exe"<br />
      goto +2<br />
      cancel:<br />
      DetailPrint "you prefered not to close program"<br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">27th March 2004 21:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">but the messagebox should only come up, if the process is really running. so, i can't use the dll. i'll have to check for the process myself.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">28th March 2004 10:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">i found the following function, that imho may be the solution:<br />
      <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/winui/winui/windowsuserinterface/windowing/windowclasses/windowclassreference/windowclassfunctions/getwindowlong.asp" target="_blank">http://msdn.microsoft.com/library/de...windowlong.asp</a><br />
      but i always get errors with the attached code.<br />
      could someone help me out with the correct syntax?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">28th March 2004 10:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">forgot the attachment ...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">28th March 2004 11:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">finally, i got it working!!!!!<br />
      attached the complete script to get all the classnames of every open window.<br />
      <br />
      i'll post it at the archive later.<br />
      hope, it'll help other people too.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">30th March 2004 18:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">ok, i postet the interesting part of my final solution at the nsis-archive. check it out <a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=460" target="_blank">here</a>.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">27th February 2006 20:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://nsis.sourceforge.net/Enhanced_FindWindow_for_variable_window_class_names" target="_blank">Updated Wiki Page</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Mæster</span><br />
      <span class="post-time small text-muted">23rd June 2006 03:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The solution above with the window class name (or a part of it) wont work for me, because the app i search for is a vb6 program and those have all the same window class name 'ThunderRT6FormDC'. So this class name leads not to a unique program.<br />
      <br />
      Is there a way to have an enhanced FindWindow function which works with only a part of the window title? The window title of my program consists of a known and a unknown part, so the classic FindWindow function (which needs the exact window title) wont work.<br />
      <br />
      Greets,<br />
      M.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Takhir</span><br />
      <span class="post-time small text-muted">23rd June 2006 06:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><a href="http://nsis.sourceforge.net/FCT_plug-in" target="_blank">http://nsis.sourceforge.net/FCT_plug-in</a></p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
