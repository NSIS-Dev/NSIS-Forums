<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Error when Extracting NSIS-Compressed Files" />

  <title>Error when Extracting NSIS-Compressed Files - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Error when Extracting NSIS-Compressed Files</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=191820">Error when Extracting NSIS-Compressed Files</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rpgfan</span><br />
      <span class="post-time small text-muted">29th August 2004 23:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Error when Extracting NSIS-Compressed Files</strong><br />
      I am trying to use NSIS to distribute a mod that I made. Everything compiles properly, but whenever I test the installer, I get the following error from the installer that was made by NSIS v2.0.<br />
      <br /></p>

      <blockquote>
        Error opening file for writing:
      </blockquote>If I click "Ignore", I get the same message for the next file in the archive.<br />
      <br />
      The error persists whether the original files are present in the installation directory or not, so it is not an overwriting issue.<br />
      <br />
      Any ideas that may help?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">30th August 2004 16:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Make sure that if the file already exists it isn't in use or read-only. If that isn't it make sure you have enough free disk space. That's the only time I've run into that error message but I guess there could be other reasons.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rpgfan</span><br />
      <span class="post-time small text-muted">31st August 2004 02:43 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The file is neither in use, nor is it Read Only.<br />
      <br />
      I've got more than 25GB available on my hard drive, so it is not a problem with that.<br />
      <br />
      I am not having problems extracting files that are in the root directory, only those that were in a folder during compression. Do all the files need to be in the same location prior to compiling the install script to get things to work correctly?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">KrYpT</span><br />
      <span class="post-time small text-muted">31st August 2004 05:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">(A side note... I doubt compression's your problem.)<br />
      <br />
      I don't know if this matters, but it's possible you're not creating the folders before you fill them with files. Maybe it would help to use CreateDirectory?<br />
      <br />
      Is the path given by the error prompt accurate? I know I was confused the first time I tried the command "File Sounds\Ding.wav" and it ended up $OUTDIR instead of $OUTDIR\Sounds. Again, check if the folder exists.<br />
      <br />
      Hope that helps....<br />
      <br />
      Geoff</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">31st August 2004 13:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">All the files don't need to be in the same location prior to compiling the script. You'll be specifying a path in your File command where the file is coming from. Do something like what KrYpT said and use CreateDiretory or use SetOutPath like it is below to make sure the folder exists and to set the path it should go to. If that doesn't work put some message boxes in to show you what your $OUTDIR and/or $INSTDIR variable are before doing your copy.<br />
      <br />
      SetOutPath "$INSTDIR\help"<br />
      File F:\companies\help\*.htm<br />
      SetOutPath "$INSTDIR\help\images"<br />
      File F:\companies\help\images\*.gif</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rpgfan</span><br />
      <span class="post-time small text-muted">31st August 2004 17:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        I don't know if this matters, but it's possible you're not creating the folders before you fill them with files. Maybe it would help to use CreateDirectory?
      </blockquote>The folders do exist on my machine prior to putting files there.<br />
      <br />

      <blockquote>
        Is the path given by the error prompt accurate? I know I was confused the first time I tried the command "File Sounds\Ding.wav" and it ended up $OUTDIR instead of $OUTDIR\Sounds. Again, check if the folder exists.
      </blockquote>The path given by the error prompt is correct.<br />
      <br />

      <blockquote>
        All the files don't need to be in the same location prior to compiling the script. You'll be specifying a path in your File command where the file is coming from. Do something like what KrYpT said and use CreateDiretory or use SetOutPath like it is below to make sure the folder exists and to set the path it should go to. If that doesn't work put some message boxes in to show you what your $OUTDIR and/or $INSTDIR variable are before doing your copy.<br />
        <br />
        SetOutPath "$INSTDIR\help"<br />
        File F:\companies\help\*.htm<br />
        SetOutPath "$INSTDIR\help\images"<br />
        File F:\companies\help\images\*.gif
      </blockquote>No help there. Here's the complete script that I'm compiling. Maybe that will help.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">31st August 2004 18:57 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It worked fine for me. I don't have that game installed so that key doesn't exist in my registry. I changed it to something else though and created a bunch of empty files to match your file names and it was fine. You said the error message is returning the correct path or is it just saying "\Kitanya\something.cre". In this case here it doesn't have an $INSTDIR set.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">31st August 2004 19:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It looks like your InstallDirRegKey is wrong. It's not pointing to anything under BG2Main.exe. It should be something more like:<br />
      <br />
      InstallDirRegKey HKLM "SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\BG2Main.exe" Path<br />
      <br />
      I'm guessing on the "Path" part since I don't have the game but I have several other apps installed that use a similar deal in the registry. Try:<br />
      MessageBox MB_OK $INSTDIR<br />
      before your first SetOutPath.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rpgfan</span><br />
      <span class="post-time small text-muted">31st August 2004 21:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That worked. It is extracting everything correctly now.<br />
      <br />
      However, I'm getting a problem with that "ExecWait" in the .onInstSuccess call-back function. Namely, the executable won't work. I get a "bad filename" or somesuch error, despite the fact that the file is both named identically to the one in the script and it is contained in the script to be compressed into the archive.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">31st August 2004 21:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I put a dummy EXE file in place of setup-kitanya.exe and it executed just fine for me. It ran as soon as I clicked Close on the final install dialog. Does the real setup-kitanya.exe reguire some command line parameters or something. I'm guessing that maybe you changed some other stuff in your script after you posted one here and it caused a problem. If so put your script back up here as an attachment and I'll check it out again.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rpgfan</span><br />
      <span class="post-time small text-muted">1st September 2004 02:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">setup-kitanya.exe does not require command line parameters.<br />
      <br />
      I can't see exactly what the error given is, as my computer opens and closes the DOS window too quickly.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">1st September 2004 14:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok, so the script is basically the same as it was before. I was thinking maybe you added some new stuff that might have altered the $INSTDIR before the ExecWait command. Both scripts work fine for me with fake files and a dummy EXE that just pops up a dialog. So, my next question is what is the path that you are installing into? I can use that to try and recreate exactly what your doing. Also, You said a DOS box pops up so what type of app is this that is getting launched (MFC app, console program, another installer)?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">KrYpT</span><br />
      <span class="post-time small text-muted">1st September 2004 18:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I don't know if this is the problem or not, but maybe you could try "SetOutPath $INSTDIR" before the ExecWait? That just sets the current directory (so that the setup program is more likely to find associated files).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rpgfan</span><br />
      <span class="post-time small text-muted">2nd September 2004 19:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        So, my next question is what is the path that you are installing into?
      </blockquote>On my computer, it is C:\Program Files\Black Isle\BGII - SoA<br />
      <br />

      <blockquote>
        Also, You said a DOS box pops up so what type of app is this that is getting launched (MFC app, console program, another installer)?
      </blockquote>It's a console program.<br />
      <br />

      <blockquote>
        I don't know if this is the problem or not, but maybe you could try "SetOutPath $INSTDIR" before the ExecWait? That just sets the current directory (so that the setup program is more likely to find associated files).
      </blockquote>I'll try that.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">zimsms</span><br />
      <span class="post-time small text-muted">2nd September 2004 20:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">"When executing an application that is a 32-bit GUI application, CMD.EXE does not wait for the application to terminate before returning to the command prompt. This new behavior does NOT occur if executing within a command script."<br />
      <br />
      You need to create a small C app that monitors the thread of the process you are running. If you don't know C, then do the following:<br />
      <br />
      1. Get the Windows Platform SDK. The C# compiler comes with it.<br />
      2. Compile the source found in <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=180398" target="_blank">this</a> thread.<br />
      <br />
      then call the new executable using your app as the -f parameter, as specified in the syntax I posted in the above thread.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">KrYpT</span><br />
      <span class="post-time small text-muted">2nd September 2004 20:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If it's really a console app you shouldn't need zimsms' code. Try using nsExec::ExecToLog and see what it comes up with.<br />
      <br />
      Also, I think you can get around the problem zimsms was having by creating a batch file which simply runs your exe. Haven't tested this but you should get the idea:<br /></p>
      <pre>
<code><br />ExecWait "echo setup-kitanya.exe &gt; temp.bat"<br />ExecWait "temp.bat"<br />Delete "temp.bat"<br /></code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rpgfan</span><br />
      <span class="post-time small text-muted">2nd September 2004 23:18 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Actually, trying to run it via a batch file was one of the first things that I tried. I got the same result.<br />
      <br />
      I'll try using ExecToLog and see if that tells me exactly what the error is.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">scully13</span><br />
      <span class="post-time small text-muted">3rd September 2004 13:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">What were the results of using SetOutPath $INSTDIR to modify the $OUTDIR that KrYpT suggested? I'm assuming that after you do your install you are able to run the setup-kitanya.exe from the installed directory and it works fine. So, I'm thinking that should be all you need.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">zimsms</span><br />
      <span class="post-time small text-muted">3rd September 2004 13:51 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">As my previous post stated if the executable you are attempting to run was actually compiled as a 32-bit GUI app, then there are only the two ways around it. a) Using the ExecWait function I created, or b) Use thw Windows Scripting Wizard to create a script equivelant to the batch file you want to use.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">rpgfan</span><br />
      <span class="post-time small text-muted">3rd September 2004 14:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by scully13</i><br />
        <b>What were the results of using SetOutPath $INSTDIR to modify the $OUTDIR that KrYpT suggested? I'm assuming that after you do your install you are able to run the setup-kitanya.exe from the installed directory and it works fine. So, I'm thinking that should be all you need.</b>
      </blockquote>It now works perfectly.<br />
      <br />
      Thanks for the help, guys.
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
