<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Run Time Install Options"><title>Run Time Install Options - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Run Time Install Options</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=118651">Run Time Install Options</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Bud-froggy</span><br><span class="post-time small text-muted">22nd December 2002 00:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Run Time Install Options</strong><br>Hey whats up.<br>The deal is that I want to have a custom install page that is compiled at run time. Think of it as this:<br>The user selects a directory, and then I list all the directories that are contained in InstDir. My reasons are a little more complex, but if someone could help get this far, I think I could manage. I was thining of calculating the current page using the .on*Page callbacks, but those are gone. Also, I am reading the options from a .ini file that is loaded in teh executable... Is there a way to either a) compile a .ini file in teh user's Temp directory and use that, or modify the one on board (doubtful).<br>Thanks for the help.<br>-Froggy</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Bud-froggy</span><br><span class="post-time small text-muted">22nd December 2002 01:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Re: Run Time Install Options</strong><br>Quote:</p><hr>Ok, i just looked at the macro definition and saw when are where it was extracted, so Ill play with that...<br>Thanks anyway =)<table cellpadding="6" cellspacing="0" border="0" width="100%"><tr><td class="alt2"><hr><i>Originally posted by Bud-froggy</i><br><b>Hey whats up.<br>The deal is that I want to have a custom install page that is [....]<br>Thanks for the help.<br>-Froggy</b><hr></td></tr></table><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Bud-froggy</span><br><span class="post-time small text-muted">22nd December 2002 03:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Haha... back again.<br>This time around, I wrote a plugin to return a list of all the files and directories in the current directory. I run into problems when I try and call it from the script.<br>I have:<br></p><pre>
<code>        InitPluginsDir<br>        ListFiles::ListFiles $PLUGINSDIR\ListFiles</code>
</pre><br>
        And the compiler returns the following error:<br>
        <pre>
<code>InitPluginsDir<br>Invalid command: ListFiles::ListFiles<br>Error in script "D:\Installer\Example.nsi" on line 24 -- aborting creation process</code>
</pre><br>
        I put the DLL in its own folder in the Contrib section of the NSIS installation...<br>
        I would very much appreciate a little help here, because I am stumped.<br>
        Then again, as soon as I hit post, I willprobably figure it out =)<br>
        -Froggy
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">matini</span><br>
        <span class="post-time small text-muted">22nd December 2002 05:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">AFAIK, you should put the dll in ${NSISDIR}\plugins. :)</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Bud-froggy</span><br>
        <span class="post-time small text-muted">22nd December 2002 09:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">doh.<br>
        <br>
        thanks =)</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
        <span class="post-time small text-muted">22nd December 2002 18:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">To list files in a directory use FindFirst, FindNext and FindClose. To write into an INI file use WriteIniStr and friends. To add another plugins dir to NSIS's list use PluginsDir. You don't have to call InitPluginsDir before calling a plug-in. You only need to call this function if you wish to use $PLUGINSDIR before any plug-in was called.</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Bud-froggy</span><br>
        <span class="post-time small text-muted">24th December 2002 11:02 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Well, scratch the plugin then =)<br>
        <br>
        MEanwhile I have been looking around, and I cant seem to figure out how to call a function after selecting an InstDir but before the custom page....<br>
        I have a declared a custom page, to be ordered right after the directory selection page, but I cant seem to hook anything that is called between the two.<br>
        SetDirectory and SetDirectory Dialog are called before the page, and the custom function for the page is called when the custom page is destroyed... too late for me since the custom page depends on the install directory that was choosen.<br>
        I am fairly certain there is a way because I was browsing thru the forums and saw something about it, but now i cant seem to find it for the life of me... quite annoying.<br>
        Anyway, thanks for any and all help<br>
        -froggy</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
        <span class="post-time small text-muted">24th December 2002 14:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">There is no after page callback function currently. The custom page function is called after the custom page is destryoed, it is called to create the page. By calling InstallOptions::dialog (MUI_INSTALLOPTIONS_DISPLAY macro in the MUI's case) in this callback function you are creating the page. All you need to do is write to that INI file before you call IO::dialog or insert the macro.</p>
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">Bud-froggy</span><br>
        <span class="post-time small text-muted">24th December 2002 15:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">.. which is what i did, but to no avail. here is the cut down code..<br></p>
        <pre>
<code><br>Function SetCustomMod<br>        InitPluginsDir<br>        File /oname=$PLUGINSDIRS\ioMod.ini ioMod.ini<br><br>        FileOpen $R0 $PLUGINSDIR\ioMod.ini "a"<br>        FileSeek $R0 0 END<br>        FileWrite $R0 "$\r$\n"<br>        <br>        FindFirst $9 $8 $INSTDIR\*.*<br>        Goto Find<br>        <br>        PathGood:<br>                FileWrite $R0 "[Field "<br>                FileWrite $R0 $R8<br>                FileWrite $R0 "]$\r$\nType=radiobutton$\r$\nText="<br>                FileWrite $R0 $8<br>                FileWrite $R0 "$\r$\nLeft=0$\r$\nRight=125$\r$\nTop="<br>                FileWrite $R0 $R9<br>                IntOp $R9 $R9 + 15<br>                FileWrite $R0 "$\r$\nBottom="<br>                FileWrite $R0 $R9<br>                FileWrite $R0 "$\r$\nState=0$\r$\n"<br>                IntOp $R8 $R8 + 1<br>                IntOp $R9 $R9 + 40<br>                <br>        Find:<br>        FindNext $9 $8<br>        IfErrors End<br>        IfFileExists $INSTDIR\$8\liblist.gam PathGood Find<br>        <br>        <br>        End:<br>        FindClose $9<br>        !insertmacro MUI_HEADER_TEXT "$(TEXT_IO_TITLE)" "$(TEXT_IO_SUBTITLE)"<br>        !insertmacro MUI_INSTALLOPTIONS_DISPLAY "ioMod.ini"           # File is places in $PLUGINSDIR<br>FunctionEnd</code>
</pre><br>
        <br>
        now, this code will only use what was originally in the ioMod.ini.<br>
        I looked at the contents of the temporary file ioMod.ini while i was on the custom page, and the contents is what i generated. However, the custom page disaplays the contents of the file that was packaged with the executable, even though I tried to extract before time....<br>
        I looked thru the source of InstallOptions fairly quickly, but I did not see iy copy the file over again anywhere... do you know where in which of the two funcs it performs the copy, so I can override it and use a custom io.dll?
      </div>
      <hr>

      <div class="post">
        <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
        <span class="post-time small text-muted">24th December 2002 15:39 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

        <p class="post-content">Why don't you use WriteIniStr? It's so much simpler then opening the file manually and writing to it...<br>
        <br>
        My best guess why this doesn't work is that you have forgot to update NumFields in [Settings].</p>
      </div>
      <hr>

      <div class="footer">
        <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
      </div>
    </div><script src="../js/highlight.pack.js" type="text/javascript">
</script> <script type="text/javascript">
//<![CDATA[
    hljs.initHighlightingOnLoad();
    //]]></script></div></body></html>