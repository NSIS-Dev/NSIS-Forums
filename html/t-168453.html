<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Help me With Windows Detection" />

  <title>Help me With Windows Detection - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Help me With Windows Detection</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=168453">Help me With Windows Detection</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">VegetaSan</span><br />
      <span class="post-time small text-muted">7th February 2004 12:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Help me With Windows Detection</strong><br />
      Got a question<br />
      <br />
      I want that my installer detects wich Windows is running<br />
      <br />
      if it is Win.95/98/ME then he must install this file<br />
      File /a "D:\MPC9598ME"<br />
      <br />
      and if it is Win.XP then he must install this file<br />
      File /a "D:\MPCXP"<br />
      <br />
      Could somebody help me ??????<br />
      <br />
      Thanks :) :) :) :) :) :) :) :) :) :) :) :) :) :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">7th February 2004 13:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">u didn't read the documentation.<br />
      look at <a href="http://nsis.sourceforge.net/Docs/AppendixB.html#B.5" target="_blank">Appendix B: Usefull Functions -&gt; Get Windows Version</a></p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">VegetaSan</span><br />
      <span class="post-time small text-muted">7th February 2004 15:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I Found this. But where should I set the<br />
      File /a "D:\MPC.exe" ??????<br />
      <br />
      Between wich commands???<br />
      <br />
      Function GetWindowsVersion<br />
      <br />
      Push $R0<br />
      Push $R1<br />
      <br />
      ReadRegStr $R0 HKLM \<br />
      "SOFTWARE\Microsoft\Windows NT\CurrentVersion" CurrentVersion<br />
      <br />
      IfErrors 0 lbl_winnt<br />
      <br />
      ; we are not NT<br />
      ReadRegStr $R0 HKLM \<br />
      "SOFTWARE\Microsoft\Windows\CurrentVersion" VersionNumber<br />
      <br />
      StrCpy $R1 $R0 1<br />
      StrCmp $R1 '4' 0 lbl_error<br />
      <br />
      StrCpy $R1 $R0 3<br />
      <br />
      StrCmp $R1 '4.0' lbl_win32_95<br />
      StrCmp $R1 '4.9' lbl_win32_ME lbl_win32_98<br />
      <br />
      lbl_win32_95:<br />
      StrCpy $R0 '95'<br />
      Goto lbl_done<br />
      <br />
      lbl_win32_98:<br />
      StrCpy $R0 '98'<br />
      Goto lbl_done<br />
      <br />
      lbl_win32_ME:<br />
      StrCpy $R0 'ME'<br />
      Goto lbl_done<br />
      <br />
      lbl_winnt:<br />
      <br />
      StrCpy $R1 $R0 1<br />
      <br />
      StrCmp $R1 '3' lbl_winnt_x<br />
      StrCmp $R1 '4' lbl_winnt_x<br />
      <br />
      StrCpy $R1 $R0 3<br />
      <br />
      StrCmp $R1 '5.0' lbl_winnt_2000<br />
      StrCmp $R1 '5.1' lbl_winnt_XP<br />
      StrCmp $R1 '5.2' lbl_winnt_2003 lbl_error<br />
      <br />
      lbl_winnt_x:<br />
      StrCpy $R0 "NT $R0" 6<br />
      Goto lbl_done<br />
      <br />
      lbl_winnt_2000:<br />
      Strcpy $R0 '2000'<br />
      Goto lbl_done<br />
      <br />
      lbl_winnt_XP:<br />
      Strcpy $R0 'XP'<br />
      Goto lbl_done<br />
      <br />
      lbl_winnt_2003:<br />
      Strcpy $R0 '2003'<br />
      Goto lbl_done<br />
      <br />
      lbl_error:<br />
      Strcpy $R0 ''<br />
      lbl_done:<br />
      <br />
      Pop $R1<br />
      Exch $R0<br />
      <br />
      FunctionEnd</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Comm@nder21</span><br />
      <span class="post-time small text-muted">7th February 2004 15:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">you should call this function in your section, here's your code:<br />
      <br />
      Section "your_section" your_section_id<br />
      Call GetWindowsVersion<br />
      Exch $0<br />
      StrCmp $0 "noNT" 0 NT<br />
      File /a "D:\MPC9598ME"<br />
      Goto done<br />
      NT:<br />
      File /a "D:\MPCXP"<br />
      done:<br />
      Pop $0<br />
      SectionEnd<br />
      <br />
      Function GetWindowsVersion<br />
      Push $0<br />
      ReadRegStr $0 HKLM "SOFTWARE\Microsoft\Windows NT\CurrentVersion" CurrentVersion<br />
      IfErrors 0 NT<br />
      StrCpy $0 "noNT"<br />
      Goto done<br />
      NT:<br />
      StrCpy $0 "NT"<br />
      done:<br />
      Exch $0<br />
      FunctionEnd<br />
      <br />
      that's all you need, to difference between winnt-systems (windows nt/xp/2003) and win98-systems (windows 95/98/se/me).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">deguix</span><br />
      <span class="post-time small text-muted">7th February 2004 15:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Functions are to be called in a Section. So in a Section, use the command Call and use StrCmp and File commands to choose what file each one do. Example (Get the code behind "Section" commands and put inside your section if you already have one):<br />
      <br /></p>
      <pre>
<code>Section<br /><br />Call GetWindowsVersion<br />Pop $0<br /><br />StrCmp $0 "95" +3<br />StrCmp $0 "98" +2<br />StrCmp $0 "ME" 0 XPFile<br /><br />  File /a "D:\MPC9598ME"<br />  Goto End<br /><br />XPFile:<br /><br />StrCmp $0 "XP" 0 NotAvailable<br /><br />  File /a "D:\MPCXP"<br />  Goto End<br /><br />NotAvailable:<br /><br />; Put a message if you want to warn<br />; who is not using Win 95, 98, ME or XP.<br /><br />End:<br /><br />; Other codes<br /><br />SectionEnd</code>
</pre><br />
      <br />
      You can use the Comm@nder21's code if you know your program works for all 64-bits Operation Systems.
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
