<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Write true install path to .INI string"><title>Write true install path to .INI string - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Write true install path to .INI string</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=254831">Write true install path to .INI string</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">TYT</span><br><span class="post-time small text-muted">5th September 2006 04:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Write true install path to .INI string</strong><br>I've searched the fourms here for about two days, hoping someone else would have had my problem, but I guess i'm not using the correct search terms.<br><br>Here's my problem. I'm using the Modern UI for my installer, and i've set the Install Directory to "$DOCUMENTS\Test Run". Since this is a basic setup, easily deleted when they are done with the files, I don't want to create any registry keys since there is no uninstaller. I've also got the script set up to create an .ini file in the Windows Directory, so when I release an update to the first set, the following sets can simply look to the .ini file and read the install path if it's different than what I set as default.<br><br>The problem.<br><br>in my script I have this...<br></p><blockquote># Installer attributes<br>OutFile E:\Temp\Releasing\Test.exe<br>InstallDir "$DOCUMENTS\Test Run"</blockquote>Which works wonderfully. Then, at the end I have this...<br><br><blockquote># Installer functions<br>Function .onInit<br>WriteINIStr "$WINDIR\Test.ini" "Install Path" "Install_Dir" "$INSTDIR"<br>InitPluginsDir<br>FunctionEnd</blockquote>Now, when the installer gets to the install directory page, I have the option for the user to choose another path to install the files to. If they change the path from the default "$DOCUMENTS\Test Run" one, the .ini file still only records the default install directory.<br><br>I hope i'm explaining myself here, if the user chooses some random install path like "c:\gibberish\another folder\more gibberish" the .ini file will still record "c:\My Documents\Test Run"<br><br>How do I get the .ini file to record the actual install path? Am I missing some part of the readme included with NSIS?<br><br>ThanQ in advance for your help.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">5th September 2006 12:33 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">If you write the install path before the user has changed it, what do you expect? lol<br>.onInit is executed when the installer is executed, not after the directory page.<br>You need to write it after the directory page, e.g. in the Leave function.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">TYT</span><br><span class="post-time small text-muted">5th September 2006 13:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">lol, yeah, how would I expect the installer to know the new path that the user has changed, even tho it seems to install all the files to the new path and the .ini file doesnt seem to be generated until the files are all installed. Silly me.<br><br>Nonetheless, I shall check out this leave function you speak of. Thank you for your reply.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>