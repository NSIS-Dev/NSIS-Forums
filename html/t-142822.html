<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Displaying $InstDir in a textbox"><title>Displaying $InstDir in a textbox - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Displaying $InstDir in a textbox</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=142822">Displaying $InstDir in a textbox</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">bSecRes</span><br><span class="post-time small text-muted">19th July 2003 20:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Displaying $InstDir in a textbox</strong><br>Slashes get removed.<br><br>I wanted to display a custom page right before the InstFiles page (mostly because I wanted an Install button). I decided to use this page to review the users selections during the install. I have a multiline textbox and I try to do this:<br>!insermacro MUI_INSTALLOPTIONS_Write "readytoinstall.ini" "Field n" "State" "Directory To Install To:\r\n\t$InstDir\r\n\r\n" but the output in the textbox is<br>Directory To Install To:<br>C:Program FilesFolder Name<br>('C:' and 'Program Files' may not actually be the user selection obviously, I just used those in this example.)<br><br>I checked the $InstDir variable and it still has slashes before and after I use it here but they won't show up in the textbox. Ultimately, the program gets installed correctly.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br><span class="post-time small text-muted">19th July 2003 20:22 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">your question is similar to mine:<br><a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=142732" target="_blank">http://forums.winamp.com/showthread....hreadid=142732</a><br><br>i also need to transfer $INSTDIR to the IO<br><br>pls help</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bSecRes</span><br><span class="post-time small text-muted">19th July 2003 20:24 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I had originally written my post as a reply to yours but then I wasn't sure what it was exactly you were trying for so I posted a new thread.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bSecRes</span><br><span class="post-time small text-muted">19th July 2003 21:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">My problems is solved here kind of:<br><a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=135250" target="_blank">http://forums.winamp.com/showthread....hreadid=135250</a><br><br>Later I escape the slashes in a CopyFiles thing and it doesn't work. I'll keep you all up to date on my progress.<br><br>Edit:<br>Guide to escaping things in NSIS<br>$$ is $<br>$\" is "<br>&amp;&amp; is &amp;<br>\\ is \<br><br>The convention appears to be double everything except the quote because that means null? If some other character has a natural meaning in it's double form like the quote then it will need to be escaped with $\x x being the character with natural double meaning.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">19th July 2003 23:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Use the ConvertBStoDBS function on the NSIS archive for placing paths in an IO page.<br><br><a href="http://nsis.sourceforge.net/archive/nsisweb.php?page=290&amp;instances=0,11,122" target="_blank">http://nsis.sourceforge.net/archive/...ances=0,11,122</a><br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br><span class="post-time small text-muted">19th July 2003 23:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Does not work so far - or am i wrong with this?<br><br>[Field 7]<br>Type=DirRequest<br>Left=10<br>Right=300<br>Top=95<br>Bottom=108<br>State=$R0</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">bSecRes</span><br><span class="post-time small text-muted">19th July 2003 23:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Brummelchen, according to Afrow, you would want to do something like this:<br><br>Push $R0<br>Call ConvertBStoDBS<br>Pop $R0<br>WriteINIStr "SomeFile.ini" "Field 7" "State" $R0<br><br>You cannot set the value of state to $R0 in a text editor and then, once the Field is processed, have the current value of $R0 appear there.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">20th July 2003 00:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">bSecRes is correct.<br><br>-Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br><span class="post-time small text-muted">20th July 2003 00:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">no fortune :(<br><br></p><pre>
<code><br>page custom selectsaveitems<br><br>Function .onInit<br>  ;Extract InstallOptions INI Files<br>  !insertmacro MUI_INSTALLOPTIONS_EXTRACT "menu01.ini"<br>  !insertmacro MUI_INSTALLOPTIONS_EXTRACT "menu02a.ini"<br>  !insertmacro MUI_INSTALLOPTIONS_EXTRACT "menu03a.ini"<br>  !insertmacro MUI_INSTALLOPTIONS_EXTRACT "menu02b.ini"<br>FunctionEnd<br><br>Function selectsaveitems<br>  Push $INSTDIR<br>    Call ConvertBStoDBS<br>  Pop $R0<br>  WriteINIStr "menu02a.ini" "Field 7" "State" $R0<br>  !insertmacro MUI_INSTALLOPTIONS_DISPLAY "menu02a.ini"<br>FunctionEnd<br></code>
</pre>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">20th July 2003 00:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Should be:<br></p>
      <pre>
<code>Function .onInit<br>  ;Extract InstallOptions INI Files<br>  !insertmacro MUI_INSTALLOPTIONS_EXTRACT "menu01.ini"<br>  !insertmacro MUI_INSTALLOPTIONS_EXTRACT "menu02a.ini"<br>  !insertmacro MUI_INSTALLOPTIONS_EXTRACT "menu03a.ini"<br>  !insertmacro MUI_INSTALLOPTIONS_EXTRACT "menu02b.ini"<br>FunctionEnd<br><br>Function selectsaveitems<br>  Push $INSTDIR<br>    Call ConvertBStoDBS<br>  Pop $R0<br>  !insertmacro MUI_INSTALLOPTIONS_WRITE "menu02a.ini" "Field 7" "State" $R0<br>  !insertmacro MUI_INSTALLOPTIONS_DISPLAY "menu02a.ini"<br>FunctionEnd</code>
</pre><br>
      <br>
      Doing a<br>
      WriteINIStr "menu02a.ini" "Field 7" "State" $R0<br>
      will write it to C:\menu02a.ini, because you did not specify the file path.<br>
      With MUI_INSTALLOPTIONS_WRITE, the macro puts the file path in for you (which is $PLUGINSDIR\menu02a.ini)<br>
      <br>
      -Stu
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br>
      <span class="post-time small text-muted">20th July 2003 00:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">This works, thx.<br>
      <br>
      But i dont need "ConvertBStoDBS" any longer - the directory is shown proper without.<br>
      <br>
      But there is something strange - the content of this page is shown after a second intermission (blank page) - huh, thats Mcafee - if deactivated its fast. grmpf - operation must be inside RAM.<br>
      <br>
      aha - IC - i put that line somewhere before (.oninit) - now it's fast again :D</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">20th July 2003 00:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The \\ \ problem must have been an old IO issue, and must have been fixed in latest (or a recent) CVS.<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">bSecRes</span><br>
      <span class="post-time small text-muted">20th July 2003 00:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Still an IO issue, just not with DirRequest fields.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br>
      <span class="post-time small text-muted">20th July 2003 01:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">jep it is<br>
      i used your idea for a pre-install page and get no "\"</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br>
      <span class="post-time small text-muted">20th July 2003 11:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">"\" becomes "" in labels.<br>
      "\" stays as "\" in anything else (text boxes, dirrequest etc)<br>
      <br>
      -Stu</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br>
      <span class="post-time small text-muted">20th July 2003 12:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's not an issue, it's by design. It is this way so you can use line breaks in labels. The unfortunate side affect is the need to double every black slash when writing to labels.</p>
    </div>
    <hr>

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Brummelchen</span><br>
      <span class="post-time small text-muted">8th September 2003 03:52 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">i tried to use this function but i had a minor problem that i have to be compatible to my "version 1" which has a "\" at each path infomation<br>
      <br>
      eg<br>
      c:\programs\<br>
      and not<br>
      c:\programs<br>
      <br>
      ConvertBStoDBS has bug inside which converts<br>
      c:\programs\<br>
      to<br>
      c:\programs\c:\programs\<br>
      <br>
      Not familiar with the code i wrote the following script which is not comfortable but which does it better.<br>
      <br>
      maybe someone can use it...<br>
      <br></p>
      <pre>
<code><font size="2"><br>Function ConvertBStoDBS2<br>  Exch $R0 ;input string<br>  Push $R1 ;length string<br>  Push $R2 ;output string<br>  Push $R3 ;temp string<br>  Push $R4 ;counter<br>  Strlen $R1 $R0<br>  StrCmp $R1 "0" done<br>  StrCpy $R2 ""<br>  StrCpy $R4 "0"<br>loop:<br>  StrCpy $R3 $R0 1 $R4<br>  StrCmp $R3 "\" "0" nobs<br>    StrCpy $R2 "$R2$R3"<br>  nobs:<br>  StrCpy $R2 "$R2$R3"<br>  IntOp $R4 $R4 + 1<br>  IntCmp $R4 $R1 loop loop "0"<br>  StrCpy $R0 $R2<br>done:<br>  Pop $R4<br>  Pop $R3<br>  Pop $R2<br>  Pop $R1<br>  Exch $R0 ;output string<br>FunctionEnd<br></font></code>
</pre>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>