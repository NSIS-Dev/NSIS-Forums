<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Unistaller code seems to not work" />

  <title>Unistaller code seems to not work - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Unistaller code seems to not work</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=209270">Unistaller code seems to not work</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pet_Gr</span><br />
      <span class="post-time small text-muted">1st March 2005 22:38 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Unistaller code seems to not work</strong><br />
      Hello i've write here my uninstaller section, but it seems that it's not working because it doesn't delete the directory neither the unistall program<br />
      Section "Uninstall"<br />
      <br />
      Delete "$INSTDIR\Reports\Dba\*.*"<br />
      Delete "$INSTDIR\Reports\Objetos\*.*"<br />
      Delete "$INSTDIR\Reports\PLSQL\*.*"<br />
      Delete "$INSTDIR\Reports\Usuario\*.*"<br />
      Delete "$INSTDIR\Manual.pdf"<br />
      Delete "$INSTDIR\Manual.cnt"<br />
      Delete "$INSTDIR\Manual.hlp"<br />
      Delete "$INSTDIR\Manual.lang"<br />
      Delete "$INSTDIR\Manual.pdf"<br />
      Delete "$INSTDIR\Uninstall.exe"<br />
      Rmdir "$INSTDIR\Reports\Dba"<br />
      Rmdir "$INSTDIR\Reports\Objetos"<br />
      Rmdir "$INSTDIR\Reports\PLSQL"<br />
      Rmdir "$INSTDIR\Reports\Usuario"<br />
      Rmdir "$INSTDIR\Reports"<br />
      Rmdir "$INSTDIR"<br />
      <br />
      <br />
      SectionEnd<br />
      Can someone help me?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Yathosho</span><br />
      <span class="post-time small text-muted">1st March 2005 23:42 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">uninstaller sections must begin with <i>un.</i> (i.e. Section "un.Uninstaller") as written in the <a href="http://nsis.sourceforge.net/Docs/Chapter2.html#2.3.3" target="_blank">manual</a>. if <a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.1.8" target="_blank">RMDir</a> still doesn't work then, use it with <i>/REBOOTOK</i>.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pidgeot</span><br />
      <span class="post-time small text-muted">2nd March 2005 00:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">No, that's just for sections beyond the first. If you only have one, the proper name is "Uninstall". See <a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.6.2" target="_blank">#4.6.2</a> in the manual.<br />
      <br />
      As for getting the files deleted, you should (as said above) try using /REBOOTOK, in case some of the files are in use. Also be sure that your uninstaller is placed in the program directory, as that's where the uninstaller gets $INSTDIR from (also mentioned in <a href="http://nsis.sourceforge.net/Docs/Chapter4.html#4.6.2" target="_blank">#4.6.2</a>). If it isn't, place it there or retrieve the value from somewhere, such as the registry.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pet_gr</span><br />
      <span class="post-time small text-muted">2nd March 2005 07:46 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I'll try to test it, thanks to all in anyway you<br />
      Greetings<br />
      Pedro Garcia Rodriguez</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">pet_Gr</span><br />
      <span class="post-time small text-muted">2nd March 2005 09:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">no work.what can i do the /rebootok don't delete the directory and don't delete the uninstall program</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">2nd March 2005 14:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Just do:<br />
      Rmdir /rebootok /r "$INSTDIR"<br />
      <br />
      /r == recursive, so it'll delete the directory and all files in it (if it isn't empty).<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pet_Gr</span><br />
      <span class="post-time small text-muted">3rd March 2005 11:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I used the instdir in this way<br />
      c:\bla bla bla\ ble ble ble<br />
      THe installer delete the ble ble ble but no the bla bla directory<br />
      anyone knows why?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Pidgeot</span><br />
      <span class="post-time small text-muted">3rd March 2005 14:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">RMDir only removes the topmost directory specified, in this case "ble ble ble", regardless whether or not you specify recursive deletion. If you want to delete "bla bla bla" as well, you need to find uot what "bla bla bla" is and delete it with an additional RMDir.<br />
      <br />
      Being able to delete "bla bla bla" with <font face="courier new">RMDir "C:\bla bla bla\ble ble ble"</font> would be very insecure, as you may end up deleting something important.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">3rd March 2005 14:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ah right, this is a problem that has always existed.<br />
      I wrote this function quite a while ago which should work:<br />
      <a href="http://nsis.sourceforge.net/archive/viewpage.php?pageid=302" target="_blank">http://nsis.sourceforge.net/archive/...php?pageid=302</a><br />
      <br />
      You pass it your $INSTDIR and then the number of parent folders to remove. It will remove the folders only if they are empty.<br />
      The top level folder ($INSTDIR) will be removed with /r switch so you do not need to use Rmdir /rebootok /r "$INSTDIR" anymore.<br />
      <br />
      -Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Gato Muerto</span><br />
      <span class="post-time small text-muted">29th April 2005 02:40 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've tried including the code, but it just doesn't seem to work. The code included is as follows:<br />
      <br /></p>
      <pre>
<code><br />Function un.UninstallDirs<br />  Exch $R0 ;input string<br />  Exch<br />  Exch $R1 ;maximum number of dirs to check for<br />  Push $R2<br />  Push $R3<br />  Push $R4<br />  Push $R5<br />    IfFileExists "$R0\*.*" 0 +2<br />    RMDir /r "$R0"<br />    StrCpy $R5 0<br />  top:<br />    StrCpy $R2 0<br />    StrLen $R4 $R0<br />  loop:<br />    IntOp $R2 $R2 + 1<br />      StrCpy $R3 $R0 1 -$R2<br />    StrCmp $R2 $R4 exit<br />    StrCmp $R3 "\" 0 loop<br />      StrCpy $R0 $R0 -$R2<br />        IfFileExists "$R0\*.*" 0 +2<br />        RMDir "$R0"<br />      IntOp $R5 $R5 + 1<br />      StrCmp $R5 $R1 exit<br />  Goto top<br />  exit:<br />  Pop $R5<br />  Pop $R4<br />  Pop $R3<br />  Pop $R2<br />  Pop $R1<br />  Pop $R0<br />FunctionEnd<br /><br />#location where code is called is elsewhere (uninstall section):<br /><br />Section "Uninstall"<br /><br />#Code clipped for brevity<br />  RMDir /R "$INSTDIR"<br />  Push 2<br />  Push "$INSTDIR"<br />  Call un.UninstallDirs<br /><br />StrCpy $0 "%c"<br />CallInstDLL "$PLUGINSDIR\nsisdt.dll" currentdate<br />DetailPrint "Uninstallation finished $0."<br />Push "$TEMP\${PRODUCTNAME}-uninstall.log"<br />DetailPrint "Please wait while uninstaller finishes..."<br /></code>
</pre>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
