<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Unicode build question" />

  <title>Unicode build question - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Unicode build question</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=322963">Unicode build question</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">noisebar</span><br />
      <span class="post-time small text-muted">6th October 2010 23:36 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Unicode build question</strong><br />
      In our NSIS script, there is a step to check that the installation directory selected contains only ANSI characters because the Amardillo DRM we are using does not support Unicode. We do this check using the following statement:<br />
      <br /></p>
      <pre>
<code>System::Call 'kernel32.dll::WideCharToMultiByte(i 437, i ${WC_NO_BEST_FIT_CHARS}, w r1, i -1, i r5, i 2048, n, n) i .r2'</code>
</pre><br />
      <br />
      This statement used to work. It'll convert what's selected in the text box to ANSI. But now it converts the text into unreadable gibberish after I upgraded to the latest version of NSIS.<br />
      <br />
      I'm very not familiar with NSIS because I just took over this project not long ago. Can somebody shed some light?<br />
      <br />
      Thanks.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Anders</span><br />
      <span class="post-time small text-muted">7th October 2010 01:59 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The issue was solved on IRC and was not actually in this posted line but on the next line when the "t" system.dll type was used to extract the ansi string. The m type must be used for ansi strings since t can be ansi or unicode (Older unicode builds probably mapped t to the wrong string type)<br />
      <br />
      (Also, n,n is not really correct, n is not a type, use i)</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
