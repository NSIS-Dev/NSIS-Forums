<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Dynamic setting of header text" />

  <title>Dynamic setting of header text - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Dynamic setting of header text</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=204240">Dynamic setting of header text</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Bobbie100</span><br />
      <span class="post-time small text-muted">8th January 2005 05:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Dynamic setting of header text</strong><br />
      I am using the MUI and want to set the MUI_PAGE_HEADER_TEXT and MUI_PAGE_HEADER_SUBTEXT dynamically so that a different message is shown at the end of Uninstall page if not all the files are deleted (common if there are user specific files that are not deleted by the uninstaller). I have tried a few different things, but without success.<br />
      <br />
      In the MUI System.nsh file in macro MUI_FUNCTION_INSTFILESPAGE the call to MUI_ENDHEADER is immediately after MUI_PAGE_FUNCTION_CUSTOM LEAVE. This seems to exclude using the normal leave function to carry out any special setting of controls.<br />
      <br />
      Any ideas how I can achieve what I want WITHOUT creating a custom page?<br />
      <br />
      Bob</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Bobbie100</span><br />
      <span class="post-time small text-muted">8th January 2005 13:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Solved by making a modified MUI System.nsh with the order of the calls to MUI_ENDHEADER and MUI_PAGE_FUNCTION_CUSTOM LEAVE reversed in the LEAVE function of MUI_FUNCTION_INSTFILESPAGE.<br />
      <br />
      Then added the following Leave function with a user variable UninstErrorFlag that indicates if there is an error during the uninstall.<br />
      <br /></p>
      <pre>
<code>Function un.InstLeave<br />  ${If} $UninstErrorFlag == True<br />    ;Header text<br />    StrCpy $MessageText "Uninstallation Not Fully Completed"<br />    GetDlgItem $MUI_TEMP1 $HWNDPARENT 1037<br />    SendMessage $MUI_TEMP1 ${WM_SETTEXT} 0 "STR:$MessageText"<br />    ;Header sub-text<br />    StrCpy $MessageText "Some parts of ${MY_PROD} were not removed \<br />      (see uninstall log for more details)"<br />    GetDlgItem $MUI_TEMP1 $HWNDPARENT 1038<br />    SendMessage $MUI_TEMP1 ${WM_SETTEXT} 0 "STR:$MessageText"<br />  ${EndIf}<br />FunctionEnd</code>
</pre>Maybe should consider reversing the order of the calls to MUI_ENDHEADER and MUI_PAGE_FUNCTION_CUSTOM LEAVE in the next update of the MUI to provide this additional flexibility. I can't see any downside.<br />
      <br />
      Anybody else got an opinion on this?<br />
      <br />
      Bob
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">8th January 2005 13:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You can use the MUI_HEADER_TEXT macro to set the header text.<br />
      <br />
      An easier solution to the entire problem would be setting MUI_UNTEXT_FINISH_TITLE and MUI_UNTEXT_FINISH_SUBTITLE to a variable. That variable can then be changed in the leave function before it is actually used by MUI_ENDHEADER.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Bobbie100</span><br />
      <span class="post-time small text-muted">8th January 2005 13:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">kichik,<br />
      <br />
      Excuse me if I don't understand this (I'm a newbie), but are these changes to the MUI System.nsh?<br />
      <br />
      Bob</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">8th January 2005 14:00 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">No, those are not changes to System.nsh. I copied the wrong define names. MUI_INSTFILESPAGE_FINISHHEADER_TEXT and MUI_INSTFILESPAGE_FINISHHEADER_TEXT are the two defines you need. Define those two right above the insertion of the uninstall instfiles macro. Instead of giving them real text, give them variables. In the leave function of the uninstall instfiles page, change those variables to the desired text.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Bobbie100</span><br />
      <span class="post-time small text-muted">8th January 2005 14:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">That's brilliant! I had no idea you could !define to a variable, I'd assumed !define was only to a static value. It certainly isn't apparent from the documentation of !define.<br />
      <br />
      How widely can this be used to modify internal parameters of the MUI via the Pre Show and Leave functions?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">8th January 2005 15:47 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Well, a define is just a "variable" of the compiler. Before the script is actually compiled, it's replaced with its contents. So, if you had the following script:</p>
      <pre>
<code>!define a Sec<br />!define b "tion ab"<br />!define c c<br />${a}${b}${c}<br />SectionEnd</code>
</pre>It will be translated to:
      <pre>
<code>Section abc<br />SectionEnd</code>
</pre>Nothing stops you from using variables in the defines too. In this case, MUI_INSTFILESPAGE_FINISHHEADER_TEXT is eventually used like this:
      <pre>
<code>!insertmacro MUI_HEADER_TEXT "${MUI_INSTFILESPAGE_FINISHHEADER_TEXT}" \<br />   "${MUI_INSTFILESPAGE_FINISHHEADER_SUBTEXT}"</code>
</pre>This translates to:
      <pre>
<code>!insertmacro MUI_HEADER_TEXT "$0" "some subtext"</code>
</pre>The text you've defined might be static, but SendMessage, which is used in the MUI_HEADER_TEXT macro, processes the text dynamically and replaces $0 with its current contents at runtime.
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
