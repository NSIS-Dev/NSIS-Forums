<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Audio Track" />

  <title>Audio Track - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Audio Track</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=68034">Audio Track</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Napek</span><br />
      <span class="post-time small text-muted">8th December 2001 10:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Audio Track</strong><br />
      Can I somehow check with my installer if audio track exist on cd?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">F. Heidenreich</span><br />
      <span class="post-time small text-muted">8th December 2001 11:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Napek,<br />
      <br />
      if you know the full path to the audio track you could use the IfFileExists command, if you don't know the full path you probably could use the depth-first scan mentioned in <a href="http://forums.winamp.com/showthread.php?s=&amp;threadid=67601" target="_blank">this</a> article.<br />
      <br />
      ~ Florian</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Napek</span><br />
      <span class="post-time small text-muted">8th December 2001 21:03 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I got a cd with data and audio track and i want installer to check if data track exist if is this possible</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">petersa</span><br />
      <span class="post-time small text-muted">11th December 2001 03:50 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hi Napek,<br />
      <br />
      You should be able to check for your data track by checking if certain files exist on the CD.<br />
      <br />
      If you are familiar with a programming language, you can use MCI to count the number of tracks on a CD. You would need to write a small app to do this though.<br />
      <br />
      I reckon it would be real cool if someone wrote a small app that allows you to pass an MCI command as a parameter, and the output was written to a small file. Any takers? :D</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Napek</span><br />
      <span class="post-time small text-muted">11th December 2001 19:56 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I don't want to check for data track w want to my instaler to check if exist audio track on cd with installer. I want it for some kind of primitive protection i want change TOC of cd that you can't copy audio track and if cou copy cd file by file it wont be work if audio track doesn't exist.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">petersa</span><br />
      <span class="post-time small text-muted">13th December 2001 10:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <font size="1"><i>Originally posted by Napek</i><br />
        <b>i want installer to check if data track exist</b></font>
      </blockquote>

      <blockquote>
        <font size="1"><i>Originally posted by Napek</i><br />
        <b>I don't want to check for data track</b></font>
      </blockquote>Just use MCI to check how many tracks exist on the CD. If only one track exists on it then the CD has been improperly copied, because there are no audio tracks.<br />
      <br />
      If you want even better protection, you can use MCI to measure the length of each and every (data and audio) track, and if one of them differs, you know the CD has been copied.<br />
      <br />
      Which programming languages are you familiar with? Pretty much every language supports MCI.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Napek</span><br />
      <span class="post-time small text-muted">13th December 2001 18:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Amos on Amiga &amp; scripts for Flash :) If yo can write for me that something you talking about and i can put it in NSIS script i'll be very happy :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">F. Heidenreich</span><br />
      <span class="post-time small text-muted">13th December 2001 22:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Napek, I quickhacked a NSIS extension DLL for you, which pushes the number of audio tracks of the CD in drive $0 on top of the stack - please note that it's a quick hack - source is included ;).<br />
      <br />
      Use it, modify it and let me know if someone has any improvements or additions to it.<br />
      <br />
      Regards,<br />
      ~ Florian</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">F. Heidenreich</span><br />
      <span class="post-time small text-muted">14th December 2001 13:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">At petersas suggestion I improved the nsisext_mci.dll a little bit to take any mci command string from stack and execute it. Sources and a small example is included. Error strings or result strings are copied to $0.<br />
      <br />
      Have Fun :)<br />
      ~ Florian</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Napek</span><br />
      <span class="post-time small text-muted">14th December 2001 20:58 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks :) I'll check what i can do with this and reply tommorow.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">petersa</span><br />
      <span class="post-time small text-muted">15th December 2001 10:05 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks to Florian's excellent work, people are now able to use video files (AVIs, MPEGs, ...) as splash screens!<br />
      <br />
      If anyone's interested, let me know and I'll post the MCI code.<br />
      <br />
      I reckon this deserves its own thread.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Napek</span><br />
      <span class="post-time small text-muted">15th December 2001 20:14 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Ok now i got number of audio tracks and its very good but you say that lenght of audio track can be checked too. Is it possible to add something like this to nsisext_mci?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">F. Heidenreich</span><br />
      <span class="post-time small text-muted">16th December 2001 12:28 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It's already possible with nsisext_mci :) Try this:<br /></p>
      <pre>
<code><br />Name "nsisext_mci"<br />OutFile "nsisext_mci.exe"<br />AutoCloseWindow true<br /><br />Function .onInit<br />  SetOutPath $TEMP<br />  File nsisext_mci.dll<br />  CallInstDLL nsisext_mci.dll nsisGetFirstCDROMDrive<br />  StrCpy $2 "open $0 type cdaudio alias nsis wait"<br />  StrCpy $1 "status nsis number of tracks wait"<br />  StrCpy $0 "status nsis length track 1"<br />  Push $0<br />  Push $1<br />  Push $2<br />  CallInstDLL nsisext_mci.dll nsisMCISendString<br />  MessageBox MB_OK "Length of track 1: $0"<br />FunctionEnd<br /><br />Section<br />  ; Rest of the setup...<br />SectionEnd<br /><br />Function .onInstSuccess<br />  Delete nsisext_mci.dll<br />FunctionEnd<br /></code>
</pre><br />
      <br />
      For more mci command see the mci reference at <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/multimed/mmcmdstr_4nub.asp" target="_blank">MSDN</a><br />
      <br />
      ~ Florian
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Napek</span><br />
      <span class="post-time small text-muted">18th December 2001 15:31 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I try to use something like this:<br />
      <br />
      StrCpy $6 x (or reading value from registry where x is number of tracks)<br />
      StrCmp $0 $6 OK BAD<br />
      OK:<br />
      MessageBox............<br />
      BAD:<br />
      MessageBox............<br />
      <br />
      And it wont work why?<br />
      <br />
      And how to compare lenght of track on cd with lenght of track that i give as a variable for example track on cd has 30 sec and on my install cd that skould be 28 sec and installer goto BAD: or OK:</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">F. Heidenreich</span><br />
      <span class="post-time small text-muted">18th December 2001 21:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">It works ;)<br />
      <br />
      Have a look at this small script and change the numbers I'm comparing to, to your specific requests:<br />
      <br /></p>
      <pre>
<code><br />Name "nsisext_mci"<br />OutFile "nsisext_mci.exe"<br />AutoCloseWindow true<br /><br />Function .onInit<br />  SetOutPath $TEMP<br />  File nsisext_mci.dll<br /><br /># getting information from nsisext_mci<br /># get the first CD-ROM  drive<br />  CallInstDLL nsisext_mci.dll nsisGetFirstCDROMDrive<br /># copy drive to $R0<br />  StrCpy $R0 $0<br /># do the track thing<br />  StrCpy $1 "open $R0 type cdaudio alias nsis wait"<br />  StrCpy $0 "status nsis number of tracks wait"<br />  Push $0<br />  Push $1<br />  CallInstDLL nsisext_mci.dll nsisMCISendString<br />  MessageBox MB_OK "Number of tracks: $0"<br />  StrCpy $R1 $0<br /># do the length thing in milliseconds<br />  StrCpy $1 "set nsis time format milliseconds wait"<br />  StrCpy $0 "status nsis length track 1 wait"<br />  Push $0<br />  Push $1<br />  CallInstDLL nsisext_mci.dll nsisMCISendString<br />  MessageBox MB_OK "Length of track 1: $0 ms"<br />  StrCpy $R2 $0<br /># close the device<br />  StrCpy $0 "close nsis"<br />  Push $0<br />  CallInstDLL nsisext_mci.dll nsisMCISendString<br /><br /># proove number of tracks<br /># 18 or what ever your track count is<br />  IntCmp $R1 18 lblTrackOK lblTrackBAD<br />  lblTrackBAD:<br />    MessageBox MB_OK "BAD CD!"<br />    Abort<br />  lblTrackOK:<br />    MessageBox MB_OK "GOOD CD!"<br /><br /># prove track length<br /># 321294 or what ever your length of track 1 is (in ms)<br />  IntCmp $R2 321294 lblLengthOK lblLengthBAD<br />  lblLengthBAD:<br />    MessageBox MB_OK "BAD length!"<br />    Abort<br />  lblLengthOK:<br />    MessageBox MB_OK "GOOD length!"<br />FunctionEnd<br /><br />Section<br />  ; Rest of the setup...<br />SectionEnd<br /><br />Function .onInstSuccess<br />  Delete "$TEMP\nsisext_mci.dll"<br />FunctionEnd<br /></code>
</pre><br />
      <br />
      ~ Florian
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">eccles</span><br />
      <span class="post-time small text-muted">19th December 2001 00:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">btw, you can simplify some of that e.g. by changing</p>
      <pre>
<code>  StrCpy $1 "open $R0 type cdaudio alias nsis wait"<br />  StrCpy $0 "status nsis number of tracks wait"<br />  Push $0<br />  Push $1<br />  CallInstDLL nsisext_mci.dll nsisMCISendString</code>
</pre>to
      <pre>
<code>  Push "status nsis number of tracks wait"<br />  Push "open $R0 type cdaudio alias nsis wait"<br />  CallInstDLL nsisext_mci.dll nsisMCISendString</code>
</pre>--<br />
      Dave.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">F. Heidenreich</span><br />
      <span class="post-time small text-muted">19th December 2001 09:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks Dave, - it was my first time on NSIS stack :)<br />
      ~ Florian</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Napek</span><br />
      <span class="post-time small text-muted">19th December 2001 20:17 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Everything working fine BUT if no cd in cd-rom there is an error message mybe you can do something with this and one more thing secconds will be better to check lenght of the track. I got hope that us work will be added to NSIS :). F. Heidenreich you great :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">F. Heidenreich</span><br />
      <span class="post-time small text-muted">19th December 2001 20:32 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">You could comment out the MessageBox calls - no error messages will pop up.<br />
      And to compare to seconds simply divide the milliseconds by 1000 (IntOp $R2 $R2 / 1000 in the sample script).<br />
      <br />
      ~ Florian<br />
      <br />
      [edit]And thanks for your praise :)[/edit]</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Napek</span><br />
      <span class="post-time small text-muted">20th December 2001 16:54 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">:) HOW? :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">F. Heidenreich</span><br />
      <span class="post-time small text-muted">20th December 2001 17:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Quote from documentation:</p>

      <blockquote>
        Lines beginning with ; or # are comments.
      </blockquote>See <a href="http://www.firehose.net/free/nsis/makensis.htm#IntOp" target="_blank">http://www.firehose.net/free/nsis/makensis.htm#IntOp</a> for IntOp documentation.<br />
      <br />
      I've included my last sample script for this thread. And for the next time: please have a look in the NSIS documentation <b>before</b> you post a question. Thanks in advance.<br />
      <br />
      ~ Florian
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Napek</span><br />
      <span class="post-time small text-muted">23rd December 2001 21:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Hmmm everything was ok but i've was got old version of NSIS and on NSIS v1.91 everything works fine :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">petersa</span><br />
      <span class="post-time small text-muted">24th December 2001 11:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Actually, you can even check if there's a CD in the drive using MCI. Not sure how, but it's possible! So you can even throw up a box like 'Please insert the CD.' or something.</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
