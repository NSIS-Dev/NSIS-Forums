<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Scheduled Tasks on Vista"><title>Scheduled Tasks on Vista - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">Scheduled Tasks on Vista</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=283321">Scheduled Tasks on Vista</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Coolblu77</span><br><span class="post-time small text-muted">17th December 2007 15:25 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>Scheduled Tasks on Vista</strong><br>I'm currently using the Scheduled Task Plugin <a href="http://nsis.sourceforge.net/Scheduled_Tasks" target="_blank">http://nsis.sourceforge.net/Scheduled_Tasks</a>,<br>this works very well on WindowsXP machines.<br>But on Vista machines the install wizard crashes the first time its ran, and the second time I get the returned value that the task already exists.<br>I have looked under C:\Windows\Tasks and found the tasks I'm trying to add are there with the .job extension.<br>But these do not work.<br><br>From reading MSDN I see that Vista uses Task Scheduler v2.0 where'as previous versions of Windows used Task Scheduler v1.0.<br><br>Does anyone have any script code or plugins that will create a task for Vista using the Task Scheduler v2.0 ?<br><br>Or am I going to have to read more about NSIS to try to do this myself (that's gonna take ages).<br><br>Thanks to anyone that can help.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">kichik</span><br><span class="post-time small text-muted">17th December 2007 20:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">For a quick solution, it'd probably be simplest to write a plug-in that'd add the task. Base it on Examples\Plugin. If not, that script will have to be fixed so it works on Vista as well.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">BSOD2600</span><br><span class="post-time small text-muted">8th March 2009 10:15 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Ok, I realize it's an old thread...<br><br>Anyone made any headway on this issue yet? The script <a href="http://nsis.sourceforge.net/Scheduled_Tasks" target="_blank">http://nsis.sourceforge.net/Scheduled_Tasks</a> hasn't been updated nor any plugins made (that I'm aware of).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">8th March 2009 21:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">The Vista v2 api has a flag called TASK_COMPATIBILITY_V1, so I assume the old api should still work. Could there be a bug with the code on the wiki?<br><br>Quoting AmitavaS - MSFT (<a href="http://blogs.msdn.com/amitava/" target="_blank">http://blogs.msdn.com/amitava/</a>) @ <a href="http://social.msdn.microsoft.com/Forums/en-US/windowscompatibility/thread/76db84f6-abae-46db-be93-337d371d6756/" target="_blank">http://social.msdn.microsoft.com/For...-337d371d6756/</a><br><br></p><blockquote>The ItaskScheduler 1.0 Interface is supported in Server 2008, and Vista. However, the tasks used by Vista and Server 2008 are accessed through the Itask Scheduler 2.0 Interface. Which means that manually scheduled tasks will not enumerate or appear when using the 1.0 interface.</blockquote>This of course does not mean it actually works.<br><br>What if you try using at.exe from XP on Vista?<br><br>If it turns out that the v1 api is broken on Vista, then someone will need to write a v2 version</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">BSOD2600</span><br><span class="post-time small text-muted">8th March 2009 22:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Anders</i><br>What if you try using at.exe from XP on Vista?</blockquote>Yes, my NSIS code regarding creating a scheduled task, which works on Windows 2000, XP, 2003 does not appear to work on Vista x86.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">8th March 2009 22:37 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I was not talking about NSIS code there, I'm talking about AT.EXE that ships with XP. Take a copy of it from XP and try it on Vista</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">BSOD2600</span><br><span class="post-time small text-muted">8th March 2009 22:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Oh the old AT command. I'm using the NSIS scheduled task code because the AT command doesn't provide me enough options/configuration that I need.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">9th March 2009 03:01 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">well, at this point we just need to know if the v1 api works or not</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">BSOD2600</span><br><span class="post-time small text-muted">9th March 2009 04:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Just tested. Yes, Vista x86 still comes with the AT command and it does work.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">BSOD2600</span><br><span class="post-time small text-muted">9th March 2009 09:08 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">After some more digging, seems Vista has a new tool to manage the scheduled tasks: schtasks.<br><br>Also, since now one can export/import Scheduled tasks via XML files, I should be able to accomplish what I need. Export an XML file, use NSIS to modify various fields and then re-import via schtasks.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Anders</span><br><span class="post-time small text-muted">9th March 2009 20:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by BSOD2600</i><br><b>Just tested. Yes, Vista x86 still comes with the AT command and it does work.</b></blockquote>I know it does, but I wanted you to COPY at.exe from XP and try that version on a Vista machine</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">BSOD2600</span><br><span class="post-time small text-muted">9th March 2009 21:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"></p><blockquote><i>Originally posted by Anders</i><br><b>I know it does, but I wanted you to COPY at.exe from XP and try that version on a Vista machine</b></blockquote>Alright, copied over the XP AT.exe to Vista. Verified with sysinternals process monitor that it used the XP AT.exe to successfully create a scheduled task.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Coolblu77</span><br><span class="post-time small text-muted">11th March 2009 17:04 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I probably should have replied to this ages ago.<br><br>I don't know if the Scheduled Task plugin has been changed, and I don't know anything about AT.exe (so I'm not really helping at all here).<br><br>But the way I got my tasks created was to get the Windows Version (<a href="http://nsis.sourceforge.net/Get_Windows_version" target="_blank">http://nsis.sourceforge.net/Get_Windows_version</a>), if it was "Vista" then I created the task using SchTasks.exe, else I used the Plugin.<br><br>SchTasks appears to be able to configure tasks with the same options that TaskScheduler in Control Panel can.<br><br><br>For anyone who comes across this thread and is interested, here's my SchTasks code to create a task that runs every day at a specified time:<br></p><pre>
<code> StrCpy $strCmdLine "SCHTASKS /Create /RU UserName /RP Password /SC DAILY /TN TaskName \<br>/TR $\"'$INSTDIR\File.exe'$\" /ST $strStartHour:$strStartMin /SD 01/01/2008 /IT /F /MO 1"<br><br>nsExec::Exec '$strCmdLine'<br>Pop $0<br>StrCpy $cmdLineResult $0 1 0<br>StrCmp $cmdLineResult "0" Cmd2Success CmdFailed </code>
</pre>
    </div>
    <hr>

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>