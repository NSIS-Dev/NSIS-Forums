<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Plugin not registering" />

  <title>Plugin not registering - NSIS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.2/readable/bootstrap.min.css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Plugin not registering</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=291316">Plugin not registering</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">AaronLS</span><br />
      <span class="post-time small text-muted">5th May 2008 18:30 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Plugin not registering</strong><br />
      &nbsp; I have a plugin that I pass a serial number to and it returns on the stack 1 for valid, 0 for invalid, or -1 for failure. It doesn't seem to be calling into the DLL, as it leaves the parameter being passed in on the stack. Below is my code, the log output that seems to indicate the problem, and a skeleton of my C code attached that is a modification of exdll.c. I had commented some things out, that I'm not sure whether they are necessary. I had a hard time getting that exdll.c to complete under Visual Studio. I remember having to recreate the whole project and solution.<br />
      <br /></p>
      <pre>
<code> Var /GLOBAL _TBaseline_TFLSerialNumberVerifier_Result
<br />  TFlSerialNumberVerifier</code>::IsValidSerialNumber /NOUNLOAD "$TBaseline_SerialNumber"
<br />  Pop $_TBaseline_TFLSerialNumberVerifier_Result
<br />  
<br /> ${If} $_TBaseline_TFLSerialNumberVerifier_Result = 0     
<br />      MessageBox MB_ICONEXCLAMATION|MB_OK "The serial number does not appear to be valid."
<br />    
<br />    Goto cancelLeave
<br /> ${ElseIf} $_TBaseline_TFLSerialNumberVerifier_Result = -1 
<br />    Goto cancelLeave    
<br />  ${EndIf}
<br />  
<br /> Pop $0 ; restore 0
<br />  Goto done;always skip the Abort statement, only some type of "GOTO cancelleave" can get here
<br />  cancelLeave:  
<br />   Pop $0 ; restore 0
<br />   ;TODO: Log error if silent    
<br />    Abort ;stay on this page    
<br />  done: 
</pre>
      <pre>
<code>File: overwriteflag=1, allowskipfilesflag=2, name="C:\DOCUME~1\ADMINI~1\LOCALS~1\Temp\nsd3A.tmp\TFlSerialNumberVerifier.dll"<br />File: wrote 13824 to "C:\DOCUME~1\ADMINI~1\LOCALS~1\Temp\nsd3A.tmp\TFlSerialNumberVerifier.dll"<br />Error registering DLL: Could not load C:\DOCUME~1\ADMINI~1\LOCALS~1\Temp\nsd3A.tmp\TFlSerialNumberVerifier.dll</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">AaronLS</span><br />
      <span class="post-time small text-muted">5th May 2008 18:34 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Eh, it lost my attachment when I previewed.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">kichik</span><br />
      <span class="post-time small text-muted">5th May 2008 19:16 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">If you've recreated the solution and project, your DLL probably depends on DLL files that do not exist on clean systems. You should build your DLL as a static DLL so it won't depend on MSVCR??.DLL.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">AaronLS</span><br />
      <span class="post-time small text-muted">5th May 2008 21:10 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Thanks.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">l0k1</span><br />
      <span class="post-time small text-muted">6th May 2008 15:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">I've got same problem and i resolve it when i changed DLL MULTITHREAD (/MD) compiler option to MULTITHREAD (/MT)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">AaronLS</span><br />
      <span class="post-time small text-muted">6th May 2008 19:20 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yeah, that has something to do with whether the c libraries are included in the exe or not. Microsoft's documentation could elaborate a little more on that kind of stuff and what those settings mean.<br />
      <br />
      I was able to successfully convert the exedll project from the most recent version of NSIS and then just renamed the project and pasted my code into it, and it is working fine now.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">7th May 2008 10:29 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Yes the easiest way is to copy the exdll.dsp and exdll.dsw files and just do a simple text replace. I spose it would be useful if I were to write an app to create a new NSIS plug-in project (to create the relevant dsp/dsw or vcproj files).<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
