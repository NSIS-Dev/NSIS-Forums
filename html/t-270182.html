<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="group exclusion" />

  <title>group exclusion - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">group exclusion</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=270182">group exclusion</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dev_akm</span><br />
      <span class="post-time small text-muted">25th April 2007 22:11 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>group exclusion</strong><br />
      A recent post by Red Wine (<a href="http://forums.winamp.com/showthread.php?postid=2161864#post2161864" target="_blank">here</a>) gave me some much-needed clues about the quirks of using RadioButtons for selecting sections, but I'm really struggling with setting up some exclusion logic.<br />
      <br />
      Basically, I have several sets of optional sections that are mutually exclusive. The exclusion itself isn't the problem, per se. The problem is that the first call to UnSelectSection seems to also inadvertently deselect the first section, even though that section is required (RO) and never referenced by any of the RadioButton logic.<br />
      <br />
      Why does it do this and how can I work around it?<br />
      <br />
      I can sort of get around the problem with an ugly hack to repeatedly SelectSection ${Required}, but this doesn't work well if there's a choice to be made in the required sectiongroup, so it's really not a solution.<br />
      <br />
      My actual code is quite long, so for the sake of brevity and clarity I have replicated the issue using a modified version of Red Wine's script. To test it, check whatever options you want in the first two sectiongroups, then pick something in the last sectiongroup (grp3), then scroll back up to the top and you'll see that the Required section has somehow become deselected. I've commented out the aforementioned ugly hack.<br />
      <br />
      Any help would be greatly appreciated.<br />
      <br />
      <br /></p>
      <pre>
<code><br />; group-exlude.nsi<br />;<br />; This example demonstrates the problem with exclusive control <br />; of section selection.<br /><br />;--------------------------------<br /><br />; Section define/macro header file<br />; See this header file for more info<br /><br />!include "Sections.nsh"<br />!include "logiclib.nsh"<br /><br />;--------------------------------<br /><br />Name "Group Exclusion Problem"<br />OutFile "group-exlude.exe"<br /><br />;--------------------------------<br /><br />; Pages<br /><br />Page components<br /><br />;--------------------------------<br /><br />; Sections<br /><br />Section !Required Required<br />  SectionIn RO<br />SectionEnd<br /><br />SectionGroup /e "Group 1" grp1<br />Section "Group 1 - Option 1" g1o1<br />SectionEnd<br /><br />Section /o "Group 1 - Option 2" g1o2<br />SectionEnd<br /><br />Section /o "Group 1 - Option 3" g1o3<br />SectionEnd<br />SectionGroupEnd<br /><br />SectionGroup /e "Group 2" grp2<br />Section "Group 2 - Option 1" g2o1<br />SectionEnd<br /><br />Section /o "Group 2 - Option 2" g2o2<br />SectionEnd<br /><br />Section /o "Group 2 - Option 3" g2o3<br />SectionEnd<br />SectionGroupEnd<br /><br />SectionGroup /e "Group 3 - excludes Group 2" grp3<br />Section /o "Group 3 - Option 1" g3o1<br />SectionEnd<br /><br />Section /o "Group 3 - Option 2" g3o2<br />SectionEnd<br /><br />Section /o "Group 3 - Option 3" g3o3<br />SectionEnd<br /><br />Section /o "Do Not Use Group 3" g3NONE<br />SectionEnd<br /><br />SectionGroupEnd<br /><br />;--------------------------------<br /><br />; Functions<br /><br />; $1 stores the status of group 1<br />; $2 stores the status of group 2<br /><br />Function .onInit<br /><br />  StrCpy $1 ${g1o1} ; Group 1 - Option 1 is selected by default<br />  StrCpy $2 ${g2o1} ; Group 2 - Option 1 is selected by default<br /><br />FunctionEnd<br /><br />Function .onSelChange<br /><br />SectionGetFlags ${grp1} $R0<br />IntOp $R0 $R0 &amp; ${SF_SELECTED}<br /><br />${If} $R0 == ${SF_SELECTED}<br />    !insertmacro SelectSection ${g1o1}<br />    !insertmacro UnSelectSection ${g1o2}<br />    !insertmacro UnSelectSection ${g1o3}<br />${EndIf}<br /><br />  !insertmacro StartRadioButtons $1<br />    !insertmacro RadioButton ${g1o1}<br />    !insertmacro RadioButton ${g1o2}<br />    !insertmacro RadioButton ${g1o3}<br />  !insertmacro EndRadioButtons<br /><br />SectionGetFlags ${grp2} $R0<br />IntOp $R0 $R0 &amp; ${SF_SELECTED}<br /><br />${If} $R0 == ${SF_SELECTED}<br />    !insertmacro SelectSection ${g2o1}<br />    !insertmacro UnSelectSection ${g2o2}<br />    !insertmacro UnSelectSection ${g2o3}<br />${EndIf}<br /><br />  !insertmacro StartRadioButtons $2<br />    !insertmacro RadioButton ${g2o1}<br />    !insertmacro RadioButton ${g2o2}<br />    !insertmacro RadioButton ${g2o3}<br />  !insertmacro EndRadioButtons<br /><br />SectionGetFlags ${grp3} $R0<br />IntOp $R0 $R0 &amp; ${SF_SELECTED}<br /><br />${If} $R0 == ${SF_SELECTED}<br />    !insertmacro SelectSection ${g3o1}<br />    !insertmacro UnSelectSection ${g3o2}<br />    !insertmacro UnSelectSection ${g3o3}<br />    !insertmacro UnSelectSection ${g3NONE}<br />    !insertmacro UnSelectSection ${grp2}<br />    #!insertmacro SelectSection ${Required}<br />${EndIf}<br /><br />  ${If} ${SectionIsSelected} ${g3o1}<br />    !insertmacro UnSelectSection ${grp2}<br />  !insertmacro StartRadioButtons $3<br />    !insertmacro RadioButton ${g3o1}<br />    !insertmacro RadioButton ${g3o2}<br />    !insertmacro RadioButton ${g3o3}<br />    !insertmacro RadioButton ${g3NONE}<br />  !insertmacro EndRadioButtons<br />    #!insertmacro SelectSection ${Required}<br />  <br />  ${ElseIf} ${SectionIsSelected} ${g3o2}<br />    !insertmacro UnSelectSection ${grp2}<br />  !insertmacro StartRadioButtons $3<br />    !insertmacro RadioButton ${g3o1}<br />    !insertmacro RadioButton ${g3o2}<br />    !insertmacro RadioButton ${g3o3}<br />    !insertmacro RadioButton ${g3NONE}<br />  !insertmacro EndRadioButtons<br />    #!insertmacro SelectSection ${Required}<br />  <br />  ${ElseIf} ${SectionIsSelected} ${g3o3}<br />    !insertmacro UnSelectSection ${grp2}<br />  !insertmacro StartRadioButtons $3<br />    !insertmacro RadioButton ${g3o1}<br />    !insertmacro RadioButton ${g3o2}<br />    !insertmacro RadioButton ${g3o3}<br />    !insertmacro RadioButton ${g3NONE}<br />  !insertmacro EndRadioButtons<br />    #!insertmacro SelectSection ${Required}<br />  <br />  ${ElseIf} ${SectionIsSelected} ${g3NONE}<br />    !insertmacro UnSelectSection ${g3NONE}<br />    !insertmacro UnSelectSection ${grp3}<br />    #!insertmacro SelectSection ${Required}<br />  ${EndIf}<br /><br />FunctionEnd</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Red Wine</span><br />
      <span class="post-time small text-muted">26th April 2007 05:55 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Nice code dev_akm :)<br />
      Add the following line to function .onInit to resolve the referred issue,<br /></p>
      <pre>
<code>  StrCpy $3 ${g3o1} ; Group 3 - Option 1 is selected by default</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dev_akm</span><br />
      <span class="post-time small text-muted">26th April 2007 16:07 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Red Wine</i><br />
        <b>Nice code dev_akm :)<br />
        Add the following line to function .onInit to resolve the referred issue,<br /></b>
        <pre>
<b><code>  StrCpy $3 ${g3o1} ; Group 3 - Option 1 is selected by default</code></b>
</pre>
      </blockquote>Thanks for the reply. Seems obvious, now that you mention it. :-)<br />
      <br />
      However, I'm doing this already in my actual code and it's not helping.<br />
      <br />
      I will experiment further and post a followup if I can replicate the issue in your example code.<br />
      <br />
      Thanks again!
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
