<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="ExecWait crashes on Vista"><title>ExecWait crashes on Vista - NSIS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"><link rel="preload" href="../css/style.css" as="style" onload="this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"><link rel="stylesheet" href="../css/style.css"></noscript><script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body><div class="container"><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-65.html">NSIS Discussion</a></li><li class="active">ExecWait crashes on Vista</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=294867">ExecWait crashes on Vista</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">simulation</span><br><span class="post-time small text-muted">21st July 2008 18:06 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content"><strong>ExecWait crashes on Vista</strong><br>Hi Guys,<br><br>I'm looking for some advice on traking a crash problem on Vista only.<br><br>Section4<br>ExecWait '"t:\batch\cgdcompile-02.cmd"'<br>SectionEnd<br><br>My installer has 5 sections and it crashes consistantly on the 4th section when I run all the sections. If just run the forth section it runs fine.<br><br>All I can think is that something I am doing in an earlier section is having an adverse effect on the Exec command. These is over 1000 lines in the script, so I am relucant to post it and I'm sure you won't want to read that lot :)<br><br>When execwait is run the installer crashes and a CMD.EXE (without a window)is left as a process?<br><br>I have tried exec, execwait, nsExec::ExecToLog etc.<br><br><br>I can only think that XP is handling any memory issues better than Vista? Does anyone have any ideas as what could cause this situation or what I should be looking for?<br><br>Any tips greatfully recieved.<br><br>Thanks</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">LoRd_MuldeR</span><br><span class="post-time small text-muted">21st July 2008 18:35 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">I don't know if Exec/ExecWait was ever intended to call Batch files. I think it's for executables (.exe) in first case! Same applies to nsExec. This <i>might</i> be the cause of the problem, but I'm not sure. Just speculation...<br><br>What if you do it like this:<br></p><pre>
<code>ExecWait '"$SYSTEM\cmd.exe" "$INSTDIR\Batchfile.cmd"'</code>
</pre></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">simulation</span><br><span class="post-time small text-muted">21st July 2008 20:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">Thanks for the quick reply.<br><br>I haven't tried that today, but I did have a similar issue a couple of months ago and it didn't help.<br><br>I'll give it another go anyway, but hope to hear from anyone else.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">21st July 2008 21:21 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You should use:<br><br>ReadEnvStr $R0 COMSPEC<br>nsExec::Exec `"$R0" /C "$INSTDIR\file.bat"`<br>Pop $R0<br><br>Also is it completely necessary to use a batch file? Most if not all of what can be done in a batch can be done in NSIS code removing the dependency on command prompt.<br><br>Stu</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">simulation</span><br><span class="post-time small text-muted">21st July 2008 23:09 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">This particular installer is used for automated testing which clears the installed product and installs a new clean version. It then starts a couple of batch files to copy additional test files and start the application many times with different script files.<br><br>The reason I wish to call a batch file is that it can be changed by follow workers who are not familiar with NSIS and wish to add additional tests or parts to the batch file without recompiling the installer.<br><br>This method has has worked well for several years on XP until Vista came along and started playing up. The crashing is not consistent and can vary from PC to PC. We run tests overnight on 8 XP machines which never fail and 2 Vista machines which are giving me a headache.<br><br>The batch file can also be used for tempoary changes commands like if %COMPUTERNAME%==FRED ..... which gives everyone a degree of flexability.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br><span class="post-time small text-muted">21st July 2008 23:45 <abbr title="Coordinated Universal Time">UTC</abbr></span></p><p class="post-content">You could also try:<br><br>ReadEnvStr $R0 COMSPEC<br>ExecWait `"$R0" /C "$INSTDIR\file.bat"` $R0<br><br>or possibly:<br><br>ExecShell open $INSTDIR\file.bat<br><br>Just some tips: Use nsExec::ExecToLog if you like the batch output in the install log window. Use the above nsExec code but with /K not /C to keep the batch window open after execution.<br><br>Stu</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p></div></div><script src="../js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]></script></body></html>