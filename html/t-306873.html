<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Custom data within a file to be installed?" />

  <title>Custom data within a file to be installed? - NSIS Forums</title>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-8','auto');ga('send','pageview');</script>
  <!-- Bootstrap core CSS -->

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-65.html">NSIS Discussion</a></li>

      <li class="active">Custom data within a file to be installed?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=306873">Custom data within a file to be installed?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Decker87</span><br />
      <span class="post-time small text-muted">29th May 2009 17:12 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content"><strong>Custom data within a file to be installed?</strong><br />
      I have a file called "Userinfo.txt", and at a certain position, I want to insert some of the user's information. For example, I want their "Full Name" go be inserted at byte 43. Then, depending on how long their "Full Name" was, I want their "Street Address" to be inserted at position 75+Length(Full Name).<br />
      <br />
      This information, such as Full Name and Street Address, is information I wish to ask the user for at the start of the installation process.<br />
      <br />
      This could be done one of two ways:</p>

      <ul>
        <li>I could mark those areas in the file with some sort of unique code, like &lt;FULLNAME&gt;, then ask NSIS to do a search-and-replace routine on the file at install time, replacing &lt;FULLNAME&gt; with the user's input.</li>

        <li>I could leave those sections within the file empty, and tell NSIS to insert the user's input at specific locations in the file.</li>
      </ul><br />
      Which of these, if any, are possible with NSIS?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">29th May 2009 17:19 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">The easier and more efficient option is to move the entire file into the NSIS script with multiple FileWrite instructions (with $\r$\n on the end of each line).<br />
      <br />
      Stu</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Decker87</span><br />
      <span class="post-time small text-muted">29th May 2009 17:27 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">So you're saying, I should just ask NSIS to write out the first part of the file byte-for-byte, until I get to where I want to write user input, then write that user input, then continue writing the file?<br />
      <br />
      Is this a good method, even when the file is around 1MB?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Afrow UK</span><br />
      <span class="post-time small text-muted">29th May 2009 18:44 <abbr title="Coordinated Universal Time">UTC</abbr></span></p>

      <p class="post-content">Whether the file is 1MB or 100MB if you need to replace any text in a file using an NSIS function it will be using FileRead and FileWrite on each line with some string manipulations in between. Therefore it would be best to store the file in an NSIS script (could be separate from your main script and included with !include) unless you use some external function (such as a plugin or exe) which will do it.<br />
      <br />
      Maybe like so:<br /></p>
      <pre>
<code><br />!macro WriteLine Line<br />  FileWrite $R0 `${Line}$\r$\n`<br />!macroend<br />!define WriteLine `!insertmacro WriteLine`<br /><br />Push $R0<br />FileOpen $R0 `$INSTDIR\some file.txt` w<br />${WriteLine} `line 1`<br />${WriteLine} `$some_data hi!`<br />${WriteLine} `blah blah`<br />FileClose $R0<br />Pop $R0<br /></code>
</pre><br />
      Stu
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/nsis-dev/NSIS-Forums/">GitHub</a></p>
    </div>
  </div><script src="../js/highlight.pack.js" type="text/javascript">
</script><script type="text/javascript">
//<![CDATA[
  hljs.initHighlightingOnLoad();
  //]]>
  </script>
</body>
</html>
