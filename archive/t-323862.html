<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Uninstaller - delete Winamp-Plugin, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Uninstaller - delete Winamp-Plugin NSIS Discussion" />
	
	<title> Uninstaller - delete Winamp-Plugin [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Uninstaller - delete Winamp-Plugin</div>
<hr />
<div class="pda"><a href="t-323862.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=323862">Uninstaller - delete Winamp-Plugin</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">blackcoder</div><div class="date">7th November 2010, 13:20</div></div><div class="posttext">Hello,<br />
<br />
i have written a program consisting of one application, which gets installed in a program-folder and a winamp-plugin which gets installed in the plugin-folder from winamp.<br />
<br />
Now i have got the problem, that my uninstaller deletes everything (application, uninstaller, shortcuts, application-folder, ...), but not the winamp-plugin. If i have two seperate installers it works. First i had two installers and started the next installer on the .onInstSuccess. I tried a similar way with the uninstalling part, but didn't got it working. Now i tried it the way it is in the attached nsi-file, but doesn't work also. :cry:<br />
<br />
I attached the nsi-file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">7th November 2010, 13:56</div></div><div class="posttext">Maybe it's because it's Sunday, but I'm not seeing anything fundamentally wrong with what the code should be doing.<br />
<br />
Have you verified that the path you're feeding to the delete command (the one you're putting up in a messagebox) is the correct path? ( I see the script using a define for the dll file on the installer side and hardcoded names in the uninstaller. )<br />
<br />
Have you verified that as far as NSIS is concerned, that file also exists in that location?<br />
<br />
${If} ${FileExists} &quot;&lt;path&gt;&quot;<br />
  MessageBox MB_OK &quot;Yup - `&lt;path&gt;` exists.&quot;<br />
<br />
<br />
If all that seems to check out...<br />
<br />
Have you verified that the delay you're using is actually long enough?  I.e. the file might still be locked by a process (winamp or otherwise) after all.  You could use a MessageBox to arbitrarily set the delay by hand.  If it turns out this might be the issue, see this thread on handling that sort of thing a bit better:<br />
http://forums.winamp.com/showpost.php?p=2709038&amp;postcount=4<br />
<br />
If it seems the file always remains locked, go download Unlocker or Process Explorer or so to find out what process might have your DLL file locked.  This seems a bit unlikely as your separate uninstallers did work OK.. just not ruling it out :)<br />
<br />
Basically, just start picking apart the entire process line by line where things -might- go wrong.<br />
<br />
Unrelated: In your uninstall code you determine the WinAmp folder by checking the registry.. why not use that in your .onInit to set the default $ANOTHER_DIR as well? :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">blackcoder</div><div class="date">7th November 2010, 20:36</div></div><div class="posttext">Thank you for your help. I got it working now. The problem was that ReadRegStr returned the path with quotes at the beginning and the end (&quot;C:\Program Files (x86)\Winamp\UninstallWA.exe&quot;). Further i noticed then that when using GetParent on that string it removes the filename as it should, but did not add the quote at the end (&quot;C:\Program Files (x86)\Winamp). I added some function to remove the quotes to get this working.<br />
<br />
Found another problem then with ReadRegStr and $InstDir. If i use $InstDir then the colon is missing in the string (&quot;C\Program Files (x86)\Winamp\UninstallWA.exe&quot;). I had to use an own variable to get that string with colon.<br />
<br />
Now one problem lasts. Using my Installer on Vista works fine, but using it on Windows XP ends up in a missing entry in the Start menu. Is this related to &quot;SetShellVarContext all&quot;?<br />
<br />
I attached my nsi-file with the changes in it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">7th November 2010, 21:51</div></div><div class="posttext">Try creating the start menu folder before creating the shortcut.. at least on XP, the folder doesn't get automatically created.<br />
<br />
SetOutPath &quot;$SMPROGRAMS\${APP_ALT}&quot; /* create folder */<br />
SetOutPath &quot;$INSTDIR&quot; /* set active folder for shortcut */<br />
CreateShortCut &quot;$SMPROGRAMS\${APP_ALT}\${APP_ALT} - Uninstall.lnk&quot; &quot;$INSTDIR\uninstall.exe&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">blackcoder</div><div class="date">7th November 2010, 22:54</div></div><div class="posttext">Thank you. That was the problem. :)<br />
I was wondering why setoutpath. Didn't know that it would create a folder, too. <br />
<br />
SetOutPath<br />
Sets the output path ($OUTDIR) and creates it (recursively if necessary), if it does not exist.<br />
<br />
I tried CreateDirectory instead of SetOutPath and this works fine.<br />
<br />
<br />
CreateDirectory &quot;$SMPROGRAMS\${APP_ALT}&quot;<br />
CreateShortCut &quot;$SMPROGRAMS\${APP_ALT}\${APP_ALT} - Uninstall.lnk&quot; &quot;$INSTDIR\uninstall.exe&quot;<br />
CreateShortCut &quot;$SMPROGRAMS\${APP_ALT}\${APP_ALT}.lnk&quot; &quot;$INSTDIR\${APP_FILE}.exe&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">8th November 2010, 01:42</div></div><div class="posttext">CreateDirectory ought to work just as well, really - but it won't change the active folder for any shortcuts subsequently created.. so I usually end up using SetOutpath for just about everything.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>