<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" XML File, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  XML File NSIS Discussion" />
	
	<title> XML File [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  XML File</div>
<hr />
<div class="pda"><a href="t-210175.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=210175">XML File</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">arfinator853</div><div class="date">12th March 2005, 04:21</div></div><div class="posttext">Is it possible with NSIS to write to a .xml file?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th March 2005, 15:35</div></div><div class="posttext">There's no plugin written for creating XML files, but you can create one with the NSIS FileOpen, FileWrite, and FileClose<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">12th March 2005, 21:08</div></div><div class="posttext">There's no plugin written for creating XML files, but you can create one with the NSIS FileOpen, FileWrite, and FileCloseYou can't create plugins with NSIS itself. But you can create a function or macro for the job.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">arfinator853</div><div class="date">12th March 2005, 21:34</div></div><div class="posttext">HELP! I am parsing some variables into my xml file, and there are about 300 other lines in the xml file that don't need intervention from the installer.  Im using the File Write command, and it is deleting everything else from the file.  All 300 lines, and just placing the one line that has the variables in it.<br />
<br />
The variables are being parsed correctly, but I am just confused as to why the rest of the file would disappear.<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">12th March 2005, 21:38</div></div><div class="posttext">Maybe this is the reason:<br />
<br />
FileWrite $0 &quot;blablabla&quot; a</div></div><hr />


<div class="post"><div class="posttop"><div class="username">arfinator853</div><div class="date">12th March 2005, 21:58</div></div><div class="posttext">I get this error when I try to do that:<br />
<br />
ClearErrors<br />
FileOpen: $INSTDIR\sam2.core.xml as w -&gt; $7<br />
IfErrors ?done:<br />
FileWrite expects 2 parameters, got 3.<br />
Usage: FileWrite $(user_var: handle input) text<br />
Error in script &quot;C:\WINDOWS\Desktop\installer\script.nsi&quot; on line 184 -- aborting creation process<br />
<br />
And I cannot open the installer.<br />
<br />
EDIT:<br />
<br />
This is my code for the filewrite:<br />
ClearErrors<br />
FileOpen $7 $INSTDIR\sam2.core.xml w<br />
IfErrors done<br />
FileWrite $7 '&lt;CONFIG application=&quot;SAM&quot; version=&quot;2.8.3&quot;&gt;&lt;Database&gt;&lt;Host&gt;$host&lt;/Host&gt;&lt;Port&gt;$port&lt;/Port&gt;&lt;Database&gt;$base&lt;/Database&gt;&lt;Username&gt;$username&lt;/Username&gt;&lt;Password&gt;$pass&lt;/Password&gt;&lt;/Database&gt;'<br />
FileClose $7<br />
done:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th March 2005, 22:00</div></div><div class="posttext">Originally posted by deguix <br />
You can't create plugins with NSIS itself. But you can create a function or macro for the job. <br />
<br />
No deguix, I'm saying he can create an XML file with FileOpen, FileWrite, and FileClose :D<br />
<br />
-Stu :p</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th March 2005, 22:02</div></div><div class="posttext">Change your FileWrite open mode... You're using &quot;w&quot; which means write. You need to use &quot;a&quot; to append.<br />
Also, you need to use FileSeek $7 0 END after FileOpen<br />
<br />
Edit: Also you need quotes around your file path on FileOpen.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">arfinator853</div><div class="date">12th March 2005, 22:12</div></div><div class="posttext">Afrow, what does the FileSeek do in this?  I added it anyways.  It correctly compiled, and when I tried to view the .xml file, I get this error:<br />
<br />
<br />
The XML page cannot be displayed <br />
Cannot view XML input using XSL style sheet. Please correct the error and then click the Refresh button, or try again later. <br />
<br />
<br />
--------------------------------------------------------------------------------<br />
<br />
End tag 'Station' does not match the start tag 'CONFIG'. Error processing resource 'file:///C:/Program Files/WiFOX/SAM2/SAM2.core.xml'. Line 1, Position 232 <br />
 <br />
<br />
&lt;CONFIG application=&quot;SAM&quot; version=&quot;2.8.3&quot;&gt;&lt;Database&gt;&lt;Host&gt;localhost&lt;/Host&gt;&lt;Port&gt;3306&lt;/Port&gt;&lt;Database&gt;SAMDB&lt;/Database&gt;&lt;Username&gt;rootname&lt;/Username&gt;&lt;Password&gt;strege&lt;/Password&gt;&lt;/Database&gt;l&gt;&lt;ICQ&gt;&lt;/ICQ&gt;&lt;AIM&gt;&lt;/AIM&gt;&lt;TouchAR&gt;-1&lt;/TouchAR&gt;&lt;/Station&gt;&lt;Member&gt;&lt;MemberID&gt;0&lt;/MemberID&gt;&lt;Username&gt;&lt;/Username&gt;&lt;Password&gt;&lt;/Password&gt;&lt;/Member&gt;&lt;Plugins&gt;&lt;Readers&gt;&lt;e0VDQzIyMEVELTA5ODktNDgwNC1CN0M5LTI1N0NGRTJCMDYxMX0&gt;&lt;MustReadInfo&gt;0&lt;/MustReadInfo&gt;&lt;Name&gt;Standard file reader&lt;/Name&gt;&lt;Description&gt;Reads files files from standard sources (Harddisk or Network).<br />
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------^</div></div><hr />


<div class="post"><div class="posttop"><div class="username">arfinator853</div><div class="date">12th March 2005, 22:21</div></div><div class="posttext">ok.  I looked at the xml code page now, and found that all but the last five lines are there.  Maybe this will help!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">arfinator853</div><div class="date">14th March 2005, 17:29</div></div><div class="posttext">does anybody have any ideas??</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">14th March 2005, 18:51</div></div><div class="posttext">No deguix, I'm saying he can create an XML file with FileOpen, FileWrite, and FileCloseI need a wake up call, two posts and I was still not seeing what was really going on! :D I did even put a wrong command syntax there which the correct is:FileOpen $0 &quot;filename.ext&quot; aI'm certainly smart ;).<br />
<br />
EDIT: I forgot again about the &quot;a&quot; parameter.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th March 2005, 19:15</div></div><div class="posttext">Well it says you don't have an end tag for &lt;CONFIG&gt; and it say's you've got an end tag of &lt;/Station&gt; there instead...<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">arfinator853</div><div class="date">14th March 2005, 20:22</div></div><div class="posttext">yes.  I just checked again, and all of the lines in the xml file are there, it just doenst wanto to read it properly or something.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">arfinator853</div><div class="date">14th March 2005, 20:32</div></div><div class="posttext">OK! I think I have figured out the error, but not the solution.  The FileWrite command is overwriting the stuff that is alrrady at the beginning of the file.  So, It deleted the beginning &lt;EMail&gt; Tag, and everything before that.<br />
<br />
Do you know how to get it so NSIS doesn't overwrite the stuff that was previously there.  Just to append it to the beginning of the file?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">arfinator853</div><div class="date">14th March 2005, 20:35</div></div><div class="posttext">UPDATE:  If I use FileOpen $0 &quot;$INSTDIR\sam2.core.xml&quot; w, then It only adds the stuff that is in the script to the beginning, and deletes all the rest, but If I use FileOpen $0 &quot;$INSTDIR\sam2.core.xml&quot; a then it overwrites the stuff at the beginning, but leaves the rest of the doc intact.<br />
<br />
Im confused.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">14th March 2005, 21:05</div></div><div class="posttext">Yeah, the &quot;a&quot; mode preserves the content, enables you to read and write to the file at the same time, but when you write, the contents get overwritten with new data. <br />
<br />
There is this function called Write to text file line number (http://nsis.sourceforge.net/archive/nsisweb.php?page=343&amp;instances=0,11,311) in the Archive that insert the line in the file, without overwriting some file contents. I tested it and works, but I think that there should be more functions that write to the file that don't overwrite contents :(.<br />
<br />
EDIT: It's quite slow though.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">arfinator853</div><div class="date">14th March 2005, 21:57</div></div><div class="posttext">by slow what do u mean?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th March 2005, 22:32</div></div><div class="posttext">Try it and find out.<br />
It's slow but not that slow so don't worry. A lot of NSIS functions are slow compared to how fast they'd be when written in ie C++.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">15th March 2005, 00:30</div></div><div class="posttext">It's slow but not that slow so don't worry. A lot of NSIS functions are slow compared to how fast they'd be when written in ie C++.That's true. :up:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">arfinator853</div><div class="date">15th March 2005, 01:51</div></div><div class="posttext">At the top of this function, I notice:<br />
Exch $0 ;file<br />
Exch<br />
Exch $1 ;line number<br />
Exch 2<br />
Exch $2 ;string to write<br />
Exch 2<br />
<br />
What do I do here? Should I define these variables earlier in my script?  Do I replace the $0 or $1 or $2 with their values?<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">15th March 2005, 02:40</div></div><div class="posttext">No you don't need to. The stack (Push, Pop, Exch) does the job of saving your variables, and thus, making possible to use the same variables inside the function. At the end of the function, the old values are returned to those variables, and the new function values go back to the stack.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">arfinator853</div><div class="date">15th March 2005, 02:45</div></div><div class="posttext">what I mean is How do I fill in the line number, and file, and string?<br />
<br />
Sorry if this seems Newb like.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">15th March 2005, 02:52</div></div><div class="posttext">Just push them in the order said on the Archive page, and customize the parameters from the &quot;Push&quot; commands, like for example:<br />
<br />
Push &quot;blablabla&quot;         ;text to insert<br />
Push &quot;13&quot;                ;line number<br />
Push &quot;$INSTDIR\file.txt&quot; ;file name <br />
Call WriteToFileLine</div></div><hr />


<div class="post"><div class="posttop"><div class="username">arfinator853</div><div class="date">15th March 2005, 02:56</div></div><div class="posttext">okay...Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">arfinator853</div><div class="date">15th March 2005, 04:25</div></div><div class="posttext">Thanks all for your help!<br />
<br />
I fixed this part of my script!<br />
<br />
Arfy</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>