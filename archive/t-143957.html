<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" File Association Problem, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  File Association Problem NSIS Discussion" />
	
	<title> File Association Problem [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  File Association Problem</div>
<hr />
<div class="pda"><a href="t-143957.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=143957">File Association Problem</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">29th July 2003, 04:26</div></div><div class="posttext">I got my file to associate to my application. However, the icon is not getting assigned to the file. Here is my code...it's basically copied directly out of Examples\makensis. Any ideas what is happening?<br />
<br />
By the way, I use RefreshShellIcons and I've also rebooted to see if that associates the icon, but those don't work either. Thanks!!!<br />
<br />
  ;Back up old value of .opt<br />
  ReadRegStr $1 HKCR &quot;.h2h&quot; &quot;&quot;<br />
  StrCmp $1 &quot;&quot; NoBackup<br />
    StrCmp $1 &quot;H2H.Document&quot; NoBackup<br />
    WriteRegStr HKCR &quot;.h2h&quot; &quot;backup_val&quot; $1<br />
  NoBackup:<br />
  WriteRegStr HKCR &quot;.h2h&quot; &quot;&quot; &quot;H2H.Document&quot;<br />
  ReadRegStr $0 HKCR &quot;H2H.Document&quot; &quot;&quot;<br />
  StrCmp $0 &quot;&quot; 0 skipOPTAssoc<br />
    WriteRegStr HKCR &quot;H2H.Document&quot; &quot;&quot; &quot;H2H File&quot;<br />
    WriteRegStr HKCR &quot;H2H.Document\shell&quot; &quot;&quot; &quot;open&quot;<br />
    WriteRegStr HKCR &quot;H2H.Document\DefaultIcon&quot; &quot;&quot; $INSTDIR\${MUI_FILE},1<br />
  skipOPTAssoc:<br />
  WriteRegStr HKCR &quot;H2H.Document\shell\open\command&quot; &quot;&quot; '$INSTDIR\${MUI_FILE} &quot;%1&quot;'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">29th July 2003, 07:29</div></div><div class="posttext">Try this code:;Back up old value of .opt <br />
ReadRegStr $1 HKCR &quot;.h2h&quot; &quot;&quot; <br />
StrCmp $1 &quot;&quot; NoBackup <br />
StrCmp $1 &quot;H2H.Document&quot; NoBackup <br />
WriteRegStr HKCR &quot;.h2h&quot; &quot;backup_val&quot; $1 <br />
NoBackup: <br />
WriteRegStr HKCR &quot;.h2h&quot; &quot;&quot; &quot;H2H.Document&quot; <br />
ReadRegStr $0 HKCR &quot;H2H.Document&quot; &quot;&quot; <br />
StrCmp $0 &quot;&quot; 0 skipOPTAssoc <br />
WriteRegStr HKCR &quot;H2H.Document&quot; &quot;&quot; &quot;H2H File&quot; <br />
WriteRegStr HKCR &quot;H2H.Document\shell&quot; &quot;&quot; &quot;open&quot; <br />
WriteRegStr HKCR &quot;H2H.Document\DefaultIcon&quot; &quot;&quot; $INSTDIR\${MUI_FILE},0 <br />
skipOPTAssoc: <br />
WriteRegStr HKCR &quot;H2H.Document\shell\open\command&quot; &quot;&quot; '$INSTDIR\${MUI_FILE} &quot;%1&quot;' Note the 0 on the 3rd last line.  I think that your exe has only 1 icon and since the icon list starts from 0 windows cannot find the 2nd icon, which does NOT exist. :) <br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">29th July 2003, 14:13</div></div><div class="posttext">You are correct...my .exe only has one icon. I'll give your example a try and let you know how it turns out!!! Thanks!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">29th July 2003, 14:33</div></div><div class="posttext">Ok, it worked...but, not like expected!<br />
<br />
First, since my last installation/uninstallation left the H2H.Document (see above example) in the registry, the change from:<br />
WriteRegStr HKCR &quot;H2H.Document\DefaultIcon&quot; &quot;&quot; $INSTDIR\${MUI_FILE},1 <br />
to:<br />
WriteRegStr HKCR &quot;H2H.Document\DefaultIcon&quot; &quot;&quot; $INSTDIR\${MUI_FILE},0 <br />
did not occur properly...so, I had to do it manually. But, THEN it worked!<br />
<br />
Second (now for the unexpected part), when I associate the files via the Folder Options...|File Types, the icon of the files has the icon of the .exe on a piece of paper...similar to how a .doc looks. This is what I want it to look like (the &quot;on a piece of paper&quot; way, that is). However, doing it the &quot;makensis&quot; way, I actually get the same icon as the .exe. Does anyone have any ideas on how to programmatically do what the Folder Options... is doing?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">29th July 2003, 14:40</div></div><div class="posttext">Not sure about that one, which version of Windows do you have since the Folder Options way is supposed to have the same icon, i.e. identical to your exe icon.  Usually if you want a document icon to have a 'paper' in the background you would have to create another icon which look like that and include that icon in either the exe file or as an .ico file with your installation.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">29th July 2003, 15:45</div></div><div class="posttext">That's interesting. It did it on Windows ME, but I can't re-produce it on Windows 2000 Professional!?!?!? If someone has Windows ME, could you try to use Folder Options... and associate a file and see what happens? I'm away from my home PC right now (which has Windows ME), else I would try it myself.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">30th July 2003, 13:36</div></div><div class="posttext">I don't know why, but I can't get this to work anymore. At one time, I associated my files with an icon, and the resulting desktop icon was my selected icon on a &quot;blank sheet of paper&quot; icon...like the .doc icon where the &quot;W&quot; is on the blank sheet of paper. Since I did it once, I'm assuming that I can do it again. Does anyone know how this is done?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2003, 14:33</div></div><div class="posttext">In Folder Options, I achieve it by telling my .bsp file extension to open in a certain program (in my case Quake2maX) and it shows the Quake2maX icon on a piece of paper as the file extension logo.<br />
It's only after I click &quot;Change Icon&quot; that I can force Windows to display the full exe logo on my .bsp file icons.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">30th July 2003, 15:04</div></div><div class="posttext">Can this be accomplished with setting some registry settings while doing an file association during installation? (that you know of?)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2003, 15:37</div></div><div class="posttext">Try<br />
WriteRegStr HKCR &quot;.bsp&quot; &quot;&quot; &quot;BSPFile&quot;<br />
WriteRegStr HKCR &quot;BSPFILE\Shell\Open\Command&quot; &quot;C:\quake2\quake2max.exe&quot;<br />
<br />
Make sure you config it to your own file extension.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2003, 15:39</div></div><div class="posttext">You should look at this:<br />
<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=337&amp;instances=0,11<br />
<br />
The WriteRegStr that writes the DefaultIcon value sets the icon of your extension.<br />
Without this, Windows will (I think) just put the application logo on a piece of paper.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">30th July 2003, 16:33</div></div><div class="posttext">The link you sent me is exactly what I tried...but, it just uses the application logo...not the logo on a piece of paper.<br />
<br />
One of the things I see different between what you posted and in the link gave, is:<br />
WriteRegStr HKCR &quot;BSPFILE\Shell\Open\Command&quot; &quot;C:\quake2\quake2max.exe&quot;<br />
<br />
as opposed to this:<br />
WriteRegStr HKCR &quot;BSPFILE\Shell\Open\Command&quot; &quot;&quot; 'C:\quake2\quake2max.exe &quot;%1&quot;'<br />
<br />
Have you used your posting in an actual application? Did it put your logo on a piece of paper?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2003, 16:39</div></div><div class="posttext">Use the same code I gave you the link to, but remove...<br />
WriteRegStr HKCR &quot;OptionsFile\DefaultIcon&quot; &quot;&quot; $INSTDIR\execute.exe,0<br />
...from the script.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">30th July 2003, 17:19</div></div><div class="posttext">I will give that a shot when I get back to my home PC (which is where my app is). Thanks a lot for your help!!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">31st July 2003, 01:01</div></div><div class="posttext">I finally got this to work...kind of...I could only get it to work if the $INSTDIR was in DOS format (you know, with the ~1 etc...) in the following line:<br />
WriteRegStr HKCR &quot;H2H.Document\shell\open\command&quot; &quot;&quot; '$INSTDIR\${MUI_FILE} &quot;%1&quot;'<br />
<br />
So, I guess I have 2 questions:<br />
1) Is that really the case? To get this to work properly, do I really have to have the DOS format for the path?<br />
2) If I DO have to have it in DOS format, is there some sort of converter that I can use in my NSIS script that will do this conversion for me?<br />
<br />
Thanks!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2003, 11:11</div></div><div class="posttext">Have a look in NSIS documentation.<br />
I thinks theres a command to convert paths to DOS format.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2003, 11:12</div></div><div class="posttext">Try this:<br />
WriteRegStr HKCR &quot;H2H.Document\shell\open\command&quot; &quot;&quot; &quot;$\&quot;$INSTDIR\${MUI_FILE}$\&quot; $\&quot;%1$\&quot;&quot;<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">31st July 2003, 14:10</div></div><div class="posttext">I didn't try your example, Afrow, but I did get this to work:<br />
<br />
GetFullPathName /SHORT $R1 $INSTDIR<br />
WriteRegStr HKCR &quot;H2H.Document\shell\open\command&quot; &quot;&quot; &quot;$R1\${MUI_FILE} %1&quot;<br />
<br />
Do you think your example is a better way of doing it, or is this way better?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2003, 16:15</div></div><div class="posttext">Mine will be better.<br />
I'm simply placing quotes &quot; &quot; around the parts, as I expect it's not working correctly because $INSTDIR has spaces in it.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">31st July 2003, 18:01</div></div><div class="posttext">I'll give your way a shot and let you know how it turns out, Afrow. And, as usual, Thanks a lot for your help!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2003, 20:13</div></div><div class="posttext">No problem :)<br />
<br />
I like to help!<br />
<br />
-Stu [15 year old kid]</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>