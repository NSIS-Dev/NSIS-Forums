<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Stack and SimpleSC: service functions question, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Stack and SimpleSC: service functions question NSIS Discussion" />
	
	<title> Stack and SimpleSC: service functions question [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Stack and SimpleSC: service functions question</div>
<hr />
<div class="pda"><a href="t-323075.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=323075">Stack and SimpleSC: service functions question</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">mabian</div><div class="date">12th October 2010, 11:11</div></div><div class="posttext">Hi all, a question about NSIS stack and SimpleSC: (service control) functions.<br />
<br />
It seems you have to Pop the result in a variable to get the function return value .<br />
<br />
What if I have<br />
<br />
Push $0<br />
<br />
SimpleSC:&lt;call&gt;<br />
Pop $0<br />
<br />
Pop $0<br />
<br />
Does this sequence screw the stack or the initial $0 value?<br />
<br />
Thanks,<br />
    Mario</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">12th October 2010, 12:34</div></div><div class="posttext">No - the stack and the initial $0 you pushed should be fine.  However, that does depend on whether or not the plugin behaves.  Easy enough to find out: try :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mabian</div><div class="date">12th October 2010, 14:18</div></div><div class="posttext">I posted because I tried before and there's something strange :)<br />
<br />
I have a for next loop with $0 as loop variable running from 1, and $0 is set back to 1 after each loop iteration (thus there's an infinite loop). But the loop contains all sequences as shown above, triple checking again...<br />
<br />
- Mario</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">12th October 2010, 14:30</div></div><div class="posttext">Well, from peeking at the Simple Service Plugin's page.. there are several calls that place more than one item on the stack; ::GetServiceFailure places 9 items on the stack, for example.  So double-check how many items the call you're using might be placing on the stack.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">12th October 2010, 14:42</div></div><div class="posttext">Just to elaborate... I often put comments in my code when there's stack operations to that I can keep track of them.. might be useful for you to do so as well.<br />
<br />
Let's say you're calling ::ServiceIsRunning...<br />
<br />
<br />
/* presuming $0 is your counter */<br />
Push $0									   ; Stack: $0:counter<br />
SimpleSC::ServiceIsRunning &quot;MyService&quot;		; Stack: errorcode running $0:counter<br />
Pop $0			; $0 = errorcode			; Stack: running $0:counter<br />
Pop $1			; $1 = running			  ; Stack: $0:counter<br />
Pop $0			; $0 = $0:counter	       ; Stack: -empty-<br />
<br />
<br />
Additionally.. if you're afraid of stack/variable corruption, it might be useful to just make your own variable...<br />
<br />
[...]<br />
Var /global counter<br />
StrCpy $counter 0<br />
IntOp $counter $counter - 1<br />
[...]<br />
<br />
...so that you don't have to worry about what plugins/macros/you do to the stack and NSIS's predefined variables.<br />
It will add a smidgen of memory use and filesize to your installer, but the more I'm working with NSIS, the more I'm finding myself using my own variables to keep code semi-readable :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mabian</div><div class="date">12th October 2010, 15:22</div></div><div class="posttext">Ok, using my own loop variable it works as expected - :\<br />
<br />
Now checking why the SimpleSC calls seem to return bogus values, but that's another story...<br />
<br />
- Mario</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>