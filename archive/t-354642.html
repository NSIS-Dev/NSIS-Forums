<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" calling NetGetJoinInformation with System::Call - parameter format?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  calling NetGetJoinInformation with System::Call - parameter format? NSIS Discussion" />
	
	<title> calling NetGetJoinInformation with System::Call - parameter format? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  calling NetGetJoinInformation with System::Call - parameter format?</div>
<hr />
<div class="pda"><a href="t-354642.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=354642">calling NetGetJoinInformation with System::Call - parameter format?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">will49</div><div class="date">16th January 2013, 21:48</div></div><div class="posttext">I need to use the Win32 API &quot;NetGetJoinInformation()&quot;, and am having problems figuring out the right syntax when using &quot;System::Call&quot;. <br />
<br />
The API format is as follows:<br />
<br />
NET_API_STATUS NetGetJoinInformation(<br />
  _In_   LPCWSTR lpServer,<br />
  _Out_  LPWSTR *lpNameBuffer,<br />
  _Out_  PNETSETUP_JOIN_STATUS BufferType<br />
);<br />
<br />
typedef enum _NETSETUP_JOIN_STATUS {<br />
    NetSetupUnknownStatus = 0,<br />
    NetSetupUnjoined,<br />
    NetSetupWorkgroupName,<br />
    NetSetupDomainName<br />
} NETSETUP_JOIN_STATUS, *PNETSETUP_JOIN_STATUS;<br />
<br />
<br />
<br />
<br />
 NET_API_STATUS is a DWORD<br />
<br />
 The first parameter can be a NULL or &quot;&quot;<br />
<br />
 The second parameter is &quot;A Pointer to the buffer that receives the NetBIOS name of the domain or workgroup to which the computer is joined. Is allocated by the system and must be freed using the NetApiBufferFree function.&quot;<br />
<br />
<br />
So I'm using the following to call the API:<br />
<br />
System::Call 'Netapi32::NetGetJoinInformation(w &quot;&quot;, *w.r0,*i.r1)i.r2'<br />
<br />
<br />
My project runs on Win7 but crashes on XP when I call that API (it works in an VC++ app, so I know it isn't an unsupported API in XP). So I'm assuming that my parameter format for System::Call isn't 100% correct and this is causing the crash.<br />
<br />
Any suggestions?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">16th January 2013, 22:02</div></div><div class="posttext">System::Call 'Netapi32::NetGetJoinInformation(w &quot;&quot;, *i.r0,*i.r1)i.r2'<br />
System::Call '*$0(&amp;w1024.r3)' ; $0 is the address of some memory where the string is stored<br />
...NetApiBufferFree(ir0)<br />
or something like that (Did not test this code). * can usually not be combined with t/m/w.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">will49</div><div class="date">16th January 2013, 22:38</div></div><div class="posttext">Excellent. That fixed it! Thanks!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>