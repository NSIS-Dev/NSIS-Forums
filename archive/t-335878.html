<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Directory page help!, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Directory page help! NSIS Discussion" />
	
	<title> Directory page help! [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Directory page help!</div>
<hr />
<div class="pda"><a href="t-335878.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=335878">Directory page help!</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Aaskilde</div><div class="date">12th October 2011, 13:47</div></div><div class="posttext">Hi,<br />
<br />
I need to create an installer that show a defined path from the registry, but if that path is incorrect the user needs to be able to point to the correct install path.<br />
<br />
As far as i know the MUI_DIRECTORYPAGE_VARIABLE is the one that i should use to get the path from the registry but as it is i can't get it to work, any help?<br />
<br />
;Directory Page<br />
  !define MUI_DIRECTORYPAGE_TEXT_TOP &quot;Opus Neo Installer&quot;<br />
  !define MUI_DIRECTORYPAGE_TEXT_DESTINATION &quot;The default install location&quot;<br />
  !define MUI_DIRECTORYPAGE_VARIABLE ReadRegStr $0 HKLM &quot;SOFTWARE\Lotus\Domino\1&quot; &quot;DataPath&quot;<br />
  !define MUI_DIRECTORYPAGE_VERIFYONLEAVE</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">12th October 2011, 14:19</div></div><div class="posttext">MUI_DIRECTORYPAGE_VARIABLE is only used to define a variable name other than $INSTDIR.<br />
<br />
You can use it like this:<br />
<br />
Var $folder<br />
!define MUI_DIRECTORYPAGE_VARIABLE $folder<br />
function .onInit <br />
ReadRegStr $folder HKLM &quot;SOFTWARE\Lotus\Domino\1&quot; &quot;DataPath&quot;<br />
functionend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th October 2011, 15:22</div></div><div class="posttext">Why not just use InstallDirRegKey?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">13th October 2011, 08:44</div></div><div class="posttext">From what I understand, he/she wants the user to confirm the path before it's used.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Aaskilde</div><div class="date">13th October 2011, 13:27</div></div><div class="posttext">MUI_DIRECTORYPAGE_VARIABLE is only used to define a variable name other than $INSTDIR.<br />
<br />
You can use it like this:<br />
<br />
Var $folder<br />
!define MUI_DIRECTORYPAGE_VARIABLE $folder<br />
function .onInit <br />
ReadRegStr $folder HKLM &quot;SOFTWARE\Lotus\Domino\1&quot; &quot;DataPath&quot;<br />
functionend<br />
<br />
MSG thanks that work perfect i just had to change it just a bit at the &quot;Var $folder&quot; to this:<br />
Var folder(Without the $)<br />
<br />
So know i get my installer that pulls the path from the registry, and if there is no path in the registry the users can Browse after the right one. Is there anyway to disable the &quot;Install&quot; button if the directory path is empty?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">13th October 2011, 14:45</div></div><div class="posttext">You can probably use .onVerifyInstDir .<br />
http://nsis.sourceforge.net/Docs/Chapter4.html#4.7.2.1.2<br />
<br />
Or just throw a messagebox error with abort in the page's LEAVE function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Aaskilde</div><div class="date">13th October 2011, 15:15</div></div><div class="posttext">Okay if i remove the !define MUI_DIRECTORYPAGE_VERIFYONLEAVE i can't install unless there is a path.<br />
<br />
But as i now works with the code i got from MSG something is wrong in my script. I get an error if i try and install it in a directory when i use the browse button this is after i used the directory page.<br />
<br />
Can you find anything there could cause this problem?<br />
<br />
#neodashboard<br />
	!include MUI2.nsh<br />
	!include nsDialogs.nsh<br />
!include LogicLib.nsh<br />
<br />
outFile &quot;Neo.Dashboard 4.3 Directory_Test Setup.exe&quot;<br />
<br />
	Name &quot;Neo.Dashboard 4.3&quot;<br />
	<br />
  ;General Page settings<br />
  !define MUI_PAGE_HEADER_TEXT &quot;License Agreement&quot;<br />
  !define MUI_PAGE_HEADER_SUBTEXT &quot;Please review the terms before installing Neo.Dashboard 4.3&quot;  <br />
	<br />
<br />
	<br />
  ;Headerimage<br />
  !define MUI_HEADERIMAGE<br />
  !define MUI_HEADERIMAGE_BITMAP &quot;Installer150x57.bmp&quot;<br />
  !define MUI_ABORTWARNING<br />
  <br />
  <br />
  ;License Page<br />
  #!define MUI_LICENSEPAGE_TEXT_TOP &quot;Please review the license terms below before installing Neo.Dashboard 4.3&quot;<br />
  !define MUI_LICENSEPAGE_CHECKBOX<br />
  #!define MUI_LICENSEPAGE_CHECKBOX_TEXT &quot;Check here if you agree with the terms&quot;<br />
 <br />
<br />
  ;Finish Page<br />
  !define MUI_FINISHPAGE_TITLE &quot;Installation Completed&quot;<br />
  !define MUI_FINISHPAGE_TITLE_3LINES<br />
  !define MUI_FINISHPAGE_TEXT &quot;Neo.Dashboard 4.3 has been installed successfully$\r$\nClick Finish to exit the wizard.&quot;<br />
  !define MUI_FINISHPAGE_NOAUTOCLOSE<br />
  !define MUI_FINISHPAGE_CANCEL_ENABLED<br />
  !define MUI_FINISHPAGE_BUTTON &quot;Finish&quot;<br />
  !define MUI_FINISHPAGE_SHOWREADME &quot;https://qen.workplace.dk/LotusQuickr/neodoc/Main.nsf/h_Toc/1d2f160d62a78c9cc1257745002a1bad/?OpenDocument&quot;<br />
  !define MUI_FINISHPAGE_SHOWREADME_TEXT &quot;Check this box if you want to open the documentation&quot;<br />
  !define MUI_FINISHPAGE_SHOWREADME_NOTCHECKED<br />
  !define MUI_FINISHPAGE_LINK &quot;www.opusneo.com&quot;<br />
  !define MUI_FINISHPAGE_LINK_LOCATION &quot;http://www.opusneo.com&quot; <br />
  !define MUI_FINISHPAGE_LINK_COLOR &quot;E56E1F&quot;<br />
  <br />
<br />
 ;Welcome Page<br />
  !define MUI_WELCOMEPAGE_TITLE &quot;Welcome to the installation wizard for Neo.Dashboard 4.3&quot;<br />
  !define MUI_WELCOMEPAGE_3LINES<br />
  !define MUI_WELCOMEPAGE_TEXT &quot;The installation wizard will unpack all the necessary files for Neo.Dashboard 4.3 on your server. To continue, click Next$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\n$\r$\nWARNING: This program is protected by copyright law and international treaties&quot;<br />
  !define MUI_WELCOMEFINISHPAGE_BITMAP &quot;Installer164x314.bmp&quot;<br />
  #!define MUI_BGCOLOR &quot;000000&quot;<br />
  !define MUI_WELCOMEFINISHPAGE_BITMAP_NOSTRETCH<br />
   <br />
  ;Installation Page<br />
  !define MUI_INSTFILESPAGE_FINISHHEADER_TEXT &quot;The installation of neodashboard has been completed&quot;<br />
  #!define MUI_INSTFILESPAGE_FINISHHEADER_SUBTEXT &quot;OPUSNEO&quot;<br />
  !define MUI_INSTFILESPAGE_ABORTHEADER_TEXT &quot;THE INSTALLATION HAVE BEEN ABORTED&quot;<br />
  !define MUI_INSTFILESPAGE_ABORTHEADER_SUBTEXT &quot;Please contact Opus neo support&quot;<br />
  #!define MUI_INSTFILESPAGE_COLORS &quot;E56E1F 000000&quot; <br />
  !define MUI_INSTFILESPAGE_COLORS &quot;FFFFFF FF8407&quot;<br />
  #!define MUI_INSTFILESPAGE_PROGRESSBAR &quot;colored&quot;<br />
  !define MUI_INSTALLCOLORS &quot;E56E1F&quot;<br />
  <br />
  ;Directory Page<br />
  !define MUI_DIRECTORYPAGE_TEXT_TOP &quot;Neo.Dashbord 4.3 installer:$\r$\n$\rBy default the installation path is taken from the registry database$\r$\n$\rIf the destination is empty, you can select the destination by clicking on Browse and select your Domino data folder. In example C:\IBM\Lotus\Domino\data&quot;<br />
  !define MUI_DIRECTORYPAGE_TEXT_DESTINATION &quot;Destination:&quot;<br />
  ;!define MUI_DIRECTORYPAGE_VERIFYONLEAVE<br />
  <br />
<br />
   Var folder<br />
!define MUI_DIRECTORYPAGE_VARIABLE $folder <br />
function .onInit<br />
ReadRegStr $folder HKLM &quot;SOFTWARE\Lotus\Domino\1&quot; &quot;DataPath&quot;<br />
functionend <br />
  <br />
  <br />
  !define MUI_ICON &quot;neodashboard.ico&quot;<br />
<br />
		<br />
	;Interface Pages<br />
	!insertmacro MUI_PAGE_WELCOME<br />
	!insertmacro MUI_PAGE_LICENSE &quot;Program License Agreement.rtf&quot;<br />
	!insertmacro MUI_PAGE_DIRECTORY<br />
	;Page custom InstallDirectory<br />
	!insertmacro MUI_PAGE_INSTFILES	<br />
    !insertmacro MUI_PAGE_FINISH<br />
	<br />
	<br />
  !insertmacro MUI_LANGUAGE &quot;English&quot;<br />
  <br />
<br />
<br />
section &quot;html&quot;<br />
<br />
	ReadRegStr $0 HKLM &quot;SOFTWARE\Lotus\Domino\1&quot; &quot;DataPath&quot;<br />
	<br />
	setOutPath $0\domino\html<br />
<br />
	file /r opusneo_html\*.*<br />
	<br />
sectionEnd<br />
<br />
section &quot;data&quot;<br />
<br />
	ReadRegStr $0 HKLM &quot;SOFTWARE\Lotus\Domino\1&quot; &quot;DataPath&quot;<br />
	<br />
	setOutPath $0<br />
	<br />
	file /r opusneo_data\*.*<br />
	<br />
sectionEnd<br />
<br />
section &quot;ntf&quot;<br />
<br />
	ReadRegStr $0 HKLM &quot;SOFTWARE\Lotus\Domino\1&quot; &quot;DataPath&quot;<br />
	<br />
	setOutPath $0<br />
	<br />
	file /r opusneo_ntf\*.*<br />
	<br />
	<br />
sectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">13th October 2011, 15:38</div></div><div class="posttext">In the sections you're not using the path the user entered. You're once again trying to read it from registry.<br />
<br />
(Also note that if you have no normal directory page, you don't need to use a separate variable for it. You can simply use the default $INSTDIR variable.)<br />
<br />
Oh, and please don't paste large amounts of code. Use an attachment or pastebin.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th October 2011, 18:57</div></div><div class="posttext">From what I understand, he/she wants the user to confirm the path before it's used.InstallDirRegKey is exactly the same as using ReadRegStr in .onInit so I don't understand why you don't just use that along with a directory page. Also why use MUI_DIRECTORYPAGE_VARIABLE? Why not just use $INSTDIR?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">14th October 2011, 08:30</div></div><div class="posttext">Yeah, I was under the mistaken impression he needed a second directory page.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Aaskilde</div><div class="date">19th October 2011, 10:07</div></div><div class="posttext">Okay thanks guys that work perfect! <br />
<br />
Thanks for the help!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>