<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Manipulating the string produced by EXEDIR, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Manipulating the string produced by EXEDIR NSIS Discussion" />
	
	<title> Manipulating the string produced by EXEDIR [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Manipulating the string produced by EXEDIR</div>
<hr />
<div class="pda"><a href="t-313716.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=313716">Manipulating the string produced by EXEDIR</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">fitzroy_doll</div><div class="date">12th October 2009, 15:48</div></div><div class="posttext">I am sure this is a well documented feature, but I'm not sure what I'm looking for.<br />
<br />
I would like to set an output directory using the EXEDIR path, but am not sure how to manipulate path strings to move up directories.<br />
<br />
I would like to achieve the following:<br />
<br />
1. Installer detects path to itself, then saves part of the path to $R0, and another part to $R1<br />
<br />
Eg <br />
<br />
Installer is in C:\Program Files\my app\my folder\target folder\installer.exe<br />
<br />
Thus<br />
<br />
EXEDIR = C:\Program Files\my app\my folder\target folder\<br />
<br />
$R0 = C:\Program Files\my app<br />
$R1 = C:\Program Files\my app\my folder<br />
<br />
How is this done?<br />
<br />
Thank you.<br />
<br />
Edit: Something like this, but with one function for each output above?<br />
<br />
from http://nsis.sourceforge.net/Get_first_part_of_a_string<br />
<br />
Push $EXEDIR ; Input string<br />
Call GetFirstStrPart<br />
Pop &quot;$R0&quot;<br />
<br />
Where $R0 will now be &quot;C:\Program Files\my app&quot;<br />
<br />
The Function<br />
<br />
Function GetFirstStrPart<br />
  Exch $R0<br />
  Push $R1<br />
  Push $R2<br />
  StrLen $R1 $R0<br />
  IntOp $R1 $R1 + 1<br />
  loop:<br />
    IntOp $R1 $R1 - 1<br />
    StrCpy $R2 $R0 1 -$R1<br />
    StrCmp $R2 &quot;&quot; exit2<br />
    StrCmp $R2 &quot;my folder\target folder\&quot; exit1 ;the directories to cut off<br />
  Goto loop<br />
  exit1:<br />
    StrCpy $R0 $R0 -$R1<br />
  exit2:<br />
    Pop $R2<br />
    Pop $R1<br />
    Exch $R0<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">12th October 2009, 20:05</div></div><div class="posttext">E.1.15 GetParent (http://nsis.sourceforge.net/Docs/AppendixE.html#E.1.15) does what you are asking for.<br />
<br />
The section intro even shows a short example:Include header:<br />
<br />
!include &quot;FileFunc.nsh&quot;<br />
<br />
Call functions:<br />
<br />
Section Install<br />
     ${GetFileExt} &quot;C:\My Downloads\Index.html&quot; $R0<br />
     ; $R0=&quot;html&quot;<br />
SectionEnd<br />
<br />
Section un.Install<br />
     ${GetParent} &quot;C:\My Downloads\Index.html&quot; $R0<br />
     ; $R0=&quot;C:\My Downloads&quot;<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fitzroy_doll</div><div class="date">12th October 2009, 20:09</div></div><div class="posttext">Edit: did not see the reply above before I posted. That sounds much better, though this works too:<br />
<br />
Edit2: Actually the post above does not do what I want, but this does:<br />
<br />
StrStrip seems to do the job...<br />
<br />
If you start with<br />
<br />
EXEDIR = C:\Program Files\my app\my folder\target folder\<br />
<br />
then call this when you need it<br />
<br />
${StrStrip}  &quot;$\my folder$\target folder&quot; &quot;$EXEDIR&quot; $R0<br />
<br />
this is the result:<br />
<br />
$R0 = C:\Program Files\my app<br />
<br />
<br />
Seems like a ropey way to do things, but I can't see a better way, unless someone can suggest something.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">12th October 2009, 20:29</div></div><div class="posttext">Your use of StrStrip requires that you know exactly what the path components are that have to be removed. Perhaps in your situation that is a constant and it will work for you. If that is the case, then just a simple string copy to remove X characters from the end is the easiest solution:StrCpy $0 &quot;C:\Program Files\my app\my folder\target folder\&quot; -24<br />
  ; $0 = &quot;C:\Program Files\my app\&quot;<br />
In general, GetParent is the better way. Your example requires calling it twice since you want to move up two levels in the path:${GetParent} &quot;C:\Program Files\my app\my folder\target folder&quot; $0<br />
${GetParent} $0 $0<br />
  ; $0 = &quot;C:\Program Files\my app&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fitzroy_doll</div><div class="date">12th October 2009, 20:40</div></div><div class="posttext">Ah, okay. Many thanks.<br />
<br />
I've ended up in fact with ${GetParent} $EXEDIR $0, as I do know the nearby path components, but not the whole string, so it really depends on the installer being in the right place.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">13th October 2009, 08:28</div></div><div class="posttext">Actually you can even do &quot;C:\NonExistingDirectory\..&quot; and you'd get &quot;C:\&quot; again. I just can't remember whether or not this also works on win9x.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>