<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to create desktop and quicklaunch options in NSIS installer, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to create desktop and quicklaunch options in NSIS installer NSIS Discussion" />
	
	<title> How to create desktop and quicklaunch options in NSIS installer [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to create desktop and quicklaunch options in NSIS installer</div>
<hr />
<div class="pda"><a href="t-322123.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=322123">How to create desktop and quicklaunch options in NSIS installer</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">rajWRT</div><div class="date">1st September 2010, 05:59</div></div><div class="posttext">Hi<br />
I want to create a desktop and quicklaunch option in my NSIS installer screen (ideally finish page ) i.e if user checks these check-boxes then shortcuts will be created .pls help me how to implement this.<br />
<br />
Also i am including XPUI.nsh i.e all installer screen layout are XPUI based i.e it has piece of code like<br />
!insertmacro XPUI_PAGE_INSTFILES<br />
!insertmacro XPUI_PAGE_FINISH<br />
<br />
<br />
Thanks,<br />
Raj</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">1st September 2010, 06:54</div></div><div class="posttext">You can either create a section called &quot;Create Shortcuts&quot;, or use nsDialogs to create a custom page. See the nsDialogs readme for a tutorial.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rajWRT</div><div class="date">2nd September 2010, 05:02</div></div><div class="posttext">Thanks MSG, i  used the nsDiaglogue to create custom page . It is also displaying desktop shortcut creation option on the page but is not creating shortcuts on desktop.I am sending piece of code.<br />
<br />
<br />
<br />
; Environment page<br />
 Page custom AdditionalTasks AdditionalTasksLeave<br />
<br />
Function AdditionalTasks<br />
    <br />
   Var /GLOBAL DESKTOP_ICON<br />
 <br />
	 Var /GLOBAL MUI_PAGE_CUSTOM<br />
	 <br />
  ;  Var /GLOBAL Checkbox_State<br />
	;Var /GLOBAL Checkbox<br />
    ; Var /GLOBAL QUICKLAUCH_ICON<br />
  <br />
   !include LogicLib.nsh<br />
   !include nsDialogs.nsh<br />
    !insertmacro MUI_HEADER_TEXT &quot;      Choose Additional Tasks&quot; &quot;    Choose the additional tasks to be performed.&quot;<br />
 <br />
    nsDialogs::Create /NOUNLOAD 1018<br />
     Pop $MUI_PAGE_CUSTOM<br />
 <br />
     ${If} $MUI_PAGE_CUSTOM == error<br />
        Abort<br />
    ${EndIf} <br />
  <br />
   ${NSD_CreateCheckBox} 5 110 100% 20 &quot;Create a desktop icon&quot;<br />
     Pop $DESKTOP_ICON<br />
   ${NSD_SetState} $DESKTOP_ICON ${BST_CHECKED}  <br />
   <br />
   <br />
    nsDialogs::Show<br />
   FunctionEnd<br />
<br />
 Function AdditionalTasksLeave<br />
    ;Var /GLOBAL CURRENTUSER<br />
    Var /GLOBAL DESKTOPUSER<br />
    ;Var /GLOBAL PATH  <br />
  ${NSD_GetState} $DESKTOP_ICON $DESKTOPUSER<br />
 <br />
 FunctionEnd<br />
   <br />
 <br />
Section -Post<br />
  WriteUninstaller &quot;$INSTDIR\uninst.exe&quot;<br />
  Call DesktopIcon<br />
SectionEnd<br />
<br />
 Function DesktopIcon<br />
  ; Create desktop icon<br />
    ${If} $DESKTOPUSER == 1<br />
  <br />
      DetailPrint &quot;Creating desktop icon, please wait...&quot;<br />
   <br />
     ; SetOutPath &quot;$INSTDIR\bin&quot;<br />
      CreateShortCut &quot;$DESKTOP\${NOKIA} ${NOKIAWDE_INST_DIR} ${VERSION}.lnk&quot; &quot;$INSTDIR\${NOKIAWDE_INST_DIR}\NokiaWDE.exe&quot;<br />
     ${EndIF}<br />
   FunctionEnd<br />
<br />
<br />
<br />
Pls help me .. where i am doing mistake.<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">2nd September 2010, 06:41</div></div><div class="posttext">1) You can't !include files like logiclib or nsdialogs inside a function. If that code compiles, it's beyond me how that would be possible.<br />
2) You never declared $DESKTOPUSER<br />
3) You may have to use SetOutPath to define the starting directory for the shortcut ('work folder').</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rajWRT</div><div class="date">2nd September 2010, 10:05</div></div><div class="posttext">MSG,<br />
I am still struggling as it is still not creating the desktop shortcuts.I am sending the complete code:<br />
<br />
; Script generated by the HM NIS Edit Script Wizard.<br />
<br />
; HM NIS Edit Wizard helper defines<br />
!define PRODUCT_NAME &quot;My application&quot;<br />
!define PRODUCT_VERSION &quot;1.0&quot;<br />
!define PRODUCT_PUBLISHER &quot;My company, Inc.&quot;<br />
!define PRODUCT_WEB_SITE &quot;http://www.google.com&quot;<br />
!define PRODUCT_UNINST_KEY &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot;<br />
!define PRODUCT_UNINST_ROOT_KEY &quot;HKLM&quot;<br />
<br />
!include nsDialogs.nsh<br />
!include LogicLib.nsh<br />
Var Checkbox<br />
Var Checkbox_State<br />
Name nsDialogs<br />
XPStyle on<br />
<br />
; MUI 1.67 compatible ------<br />
!include &quot;MUI.nsh&quot;<br />
<br />
; MUI Settings<br />
!define MUI_ABORTWARNING<br />
!define MUI_ICON &quot;${NSISDIR}\Contrib\Graphics\Icons\modern-install.ico&quot;<br />
!define MUI_UNICON &quot;${NSISDIR}\Contrib\Graphics\Icons\modern-uninstall.ico&quot;<br />
<br />
; Welcome page<br />
!insertmacro MUI_PAGE_WELCOME<br />
; License page<br />
!define MUI_LICENSEPAGE_CHECKBOX<br />
!insertmacro MUI_PAGE_LICENSE &quot;C:\Program Files\NSIS\license.txt&quot;<br />
; Instfiles page<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
Page custom AdditionalTasks AdditionalTasksLeave<br />
; Finish page<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
; Uninstaller pages<br />
!insertmacro MUI_UNPAGE_INSTFILES<br />
<br />
; Language files<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
; MUI end ------<br />
<br />
Name &quot;${PRODUCT_NAME} ${PRODUCT_VERSION}&quot;<br />
OutFile &quot;Setup.exe&quot;<br />
InstallDir &quot;$PROGRAMFILES\My application&quot;<br />
ShowInstDetails show<br />
ShowUnInstDetails show<br />
<br />
Section &quot;MainSection&quot; SEC01<br />
SectionEnd<br />
<br />
<br />
<br />
Function AdditionalTasks<br />
    <br />
   ;Var /GLOBAL DESKTOP_ICON<br />
 <br />
	 Var /GLOBAL MUI_PAGE_CUSTOM<br />
	 <br />
  ;  Var /GLOBAL Checkbox_State<br />
	;Var /GLOBAL Checkbox<br />
    ; Var /GLOBAL QUICKLAUCH_ICON <br />
    !insertmacro MUI_HEADER_TEXT &quot;      Choose Additional Tasks&quot; &quot;    Choose the additional tasks to be performed.&quot;<br />
 <br />
    nsDialogs::Create /NOUNLOAD 1018<br />
     Pop $MUI_PAGE_CUSTOM<br />
 <br />
     ${If} $MUI_PAGE_CUSTOM == error<br />
        Abort<br />
    ${EndIf} <br />
  <br />
   ${NSD_CreateCheckBox} 5 110 100% 20 &quot;Create a desktop icon&quot;<br />
    Pop $Checkbox<br />
<br />
	${If} $Checkbox_State == ${BST_CHECKED}<br />
		${NSD_Check} $Checkbox<br />
	${EndIf}<br />
	<br />
	<br />
	<br />
	; Pop $DESKTOP_ICON<br />
    ;${NSD_SetState} $DESKTOP_ICON ${BST_CHECKED}  <br />
   <br />
   <br />
    nsDialogs::Show<br />
   FunctionEnd<br />
<br />
 Function AdditionalTasksLeave<br />
    ;Var /GLOBAL CURRENTUSER<br />
   ; Var /GLOBAL DESKTOPUSER<br />
    ;Var /GLOBAL PATH  <br />
  ;${NSD_GetState} $DESKTOP_ICON $DESKTOPUSER<br />
  ${NSD_GetState} $Checkbox $Checkbox_State<br />
 <br />
 FunctionEnd<br />
   <br />
<br />
<br />
<br />
Section -AdditionalIcons<br />
  SetOutPath $INSTDIR<br />
  WriteIniStr &quot;$INSTDIR\${PRODUCT_NAME}.url&quot; &quot;InternetShortcut&quot; &quot;URL&quot; &quot;${PRODUCT_WEB_SITE}&quot;<br />
  CreateDirectory &quot;$SMPROGRAMS\My application&quot;<br />
  CreateShortCut &quot;$SMPROGRAMS\My application\Website.lnk&quot; &quot;$INSTDIR\${PRODUCT_NAME}.url&quot;<br />
  CreateShortCut &quot;$SMPROGRAMS\My application\Uninstall.lnk&quot; &quot;$INSTDIR\uninst.exe&quot;<br />
SectionEnd<br />
<br />
Section -Post<br />
  WriteUninstaller &quot;$INSTDIR\uninst.exe&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayName&quot; &quot;$(^Name)&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;UninstallString&quot; &quot;$INSTDIR\uninst.exe&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayVersion&quot; &quot;${PRODUCT_VERSION}&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;URLInfoAbout&quot; &quot;${PRODUCT_WEB_SITE}&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;Publisher&quot; &quot;${PRODUCT_PUBLISHER}&quot;<br />
   Call DesktopIcon<br />
SectionEnd<br />
<br />
 Function DesktopIcon  <br />
  ; Create desktop icon   <br />
  ;SetOutPath $INSTDIR<br />
	DetailPrint &quot;hello world&quot;<br />
	${If} $Checkbox_State == 1<br />
			SetOutPath &quot;$INSTDIR&quot;<br />
		 CreateShortCut &quot;$DESKTOP\${PRODUCT_NAME} ${PRODUCT_VERSION}.lnk&quot; &quot;&quot;<br />
		 DetailPrint &quot;hello world  Checkbox_State&quot;<br />
	${EndIf}<br />
			<br />
   FunctionEnd<br />
<br />
Function un.onUninstSuccess<br />
  HideWindow<br />
  MessageBox MB_ICONINFORMATION|MB_OK &quot;$(^Name) was successfully removed from your computer.&quot;<br />
FunctionEnd<br />
<br />
Function un.onInit<br />
  MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 &quot;Are you sure you want to completely remove $(^Name) and all of its components?&quot; IDYES +2<br />
  Abort<br />
FunctionEnd<br />
<br />
Section Uninstall<br />
  Delete &quot;$INSTDIR\${PRODUCT_NAME}.url&quot;<br />
  Delete &quot;$INSTDIR\uninst.exe&quot;<br />
<br />
  Delete &quot;$SMPROGRAMS\My application\Uninstall.lnk&quot;<br />
  Delete &quot;$SMPROGRAMS\My application\Website.lnk&quot;<br />
<br />
  RMDir &quot;$SMPROGRAMS\My application&quot;<br />
<br />
  DeleteRegKey ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot;<br />
  SetAutoClose true<br />
SectionEnd<br />
<br />
Pls check were i am doing mistake.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">2nd September 2010, 14:38</div></div><div class="posttext">CreateShortCut &quot;$DESKTOP\${PRODUCT_NAME} ${PRODUCT_VERSION}.lnk&quot; &quot;&quot;<br />
<br />
I don't know about you, but I would try to actually make the shortcut POINT to something... -__-</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rajWRT</div><div class="date">3rd September 2010, 05:35</div></div><div class="posttext">MSG, 	 <br />
<br />
CreateShortCut &quot;$DESKTOP\${PRODUCT_NAME} ${PRODUCT_VERSION}.lnk&quot; &quot;&quot;<br />
<br />
this is just a dummy desktop shortcut, which does not have any link to open the product, to verify that our approach is correct.<br />
<br />
One quick query , can we achieve the state of check box ( check box option to create the desktop shortcut) from custom page to the XPUI / MUI finish page.<br />
<br />
Because i am creating desktop shortcut only after finish page i.e  Section -Post only decides whether to create a desktop icons.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">3rd September 2010, 06:14</div></div><div class="posttext">this is just a dummy desktop shortcut, which does not have any link to open the product, to verify that our approach is correct.<br />
So in order to test whether your code is working, you're using a codeline that may very well not be valid NSIS script? Like I said, I would try to create it WITH an actual link, &quot;to verify that your approach is correct&quot;.<br />
<br />
One quick query , can we achieve the state of check box ( check box option to create the desktop shortcut) from custom page to the XPUI / MUI finish page.<br />
Please rephrase the question.<br />
<br />
Because i am creating desktop shortcut only after finish page i.e  Section -Post only decides whether to create a desktop icons.<br />
All sections are executed in the INSTFILES page. NOT in the finish page.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rajWRT</div><div class="date">3rd September 2010, 07:08</div></div><div class="posttext">Only thing i want is the desktop shortcuts should be created after the finish page.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">3rd September 2010, 09:15</div></div><div class="posttext">You could try replacing the run or readme checkbox text and letting it execute a function instead of its regular action. See the MUI2 readme.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jiake</div><div class="date">6th September 2010, 04:53</div></div><div class="posttext">I found there are some mistakes in your script:<br />
<br />
1.This is numbers comparation, not strings, using &quot;=&quot; not &quot;==&quot;:<br />
${If} $Checkbox_State == ${BST_CHECKED}<br />
${If} $Checkbox_State == 1<br />
Should be:<br />
${If} $Checkbox_State = ${BST_CHECKED}<br />
${If} $Checkbox_State = 1<br />
<br />
If you are using &quot;${If} $Checkbox_State == 1&quot;, it will also work, but this is not the correct usage. $Checkbox_State and 1 are compared as strings. But If you are using ${If} $Checkbox_State == ${BST_CHECKED}, in case the BST_CHECKED constant is defined to 1, 0x1, 0x0001 or 0x00000001, only if it is defined to 1, this expresstion is true. Using &quot;=&quot; for number comparation, the above four values are all equal to 1.<br />
<br />
2. Code in Section (such as the CreateShortcut command) are executed in INSTFILES page, so you must first insert your custom page and then insert the INSTFILES page:<br />
<br />
Page custom AdditionalTasks AdditionalTasksLeave<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
Finally, I suggest that you include MUI2.nsh, for MUI2 uses the nsDialogs plugin for WELCOME and FINISH page. Your installer will be smaller because it doesn't include the &quot;InstallOptions&quot; plugin in. Also, MUI2.nsh already include LogicLib.nsh and nsDialogs.nsh, you can include this header only.<br />
<br />
Also you may do as MSG said, using the checkbox on the finish page to create shortcut.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>