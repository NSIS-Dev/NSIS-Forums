<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem with CopyFiles, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem with CopyFiles NSIS Discussion" />
	
	<title> Problem with CopyFiles [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem with CopyFiles</div>
<hr />
<div class="pda"><a href="t-318963.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=318963">Problem with CopyFiles</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">b179210</div><div class="date">5th May 2010, 16:47</div></div><div class="posttext">Hi,<br />
i have a problem with CopyFiles, i want copy (copy and then delete from &quot;c:\test&quot;) some files from a folder to TEMP, but if error raised return back with copy from TEMP to &quot;c:\test&quot;.<br />
If a file is locked (i.e. &quot;pdf&quot;) delete command from &quot;c:\test&quot; raised an error (but other files are deleted well), and when re-copy from TEMP to &quot;c:\test&quot; copy doesn't function (file locked) and no files are copied.<br />
<br />
These are my steps:<br />
<br />
<br />
    CreateDirectory &quot;$TEMP\Backup\&quot;<br />
    CopyFiles &quot;C:\Test\*.*&quot; &quot;$TEMP\Backup\&quot;<br />
<br />
Retry:<br />
    ClearErrors<br />
    Delete &quot;C:\Test\*.*&quot;<br />
    IfErrors 0 NoError<br />
        MessageBox MB_RETRYCANCEL|MB_ICONQUESTION &quot;Error during copy, retry?&quot; IDRETRY Retry:<br />
        ClearErrors<br />
        SetOverwrite off ;i have tried with ifnewer-on-try, also<br />
        ;Rollback - re-copy original file from $TEMP<br />
        CopyFiles &quot;$TEMP\Backup\*.*&quot; &quot;C:\Test\&quot;<br />
        IfErrors 0 NoError<br />
            MessageBox MB_ICONSTOP &quot;Error during copy, stop&quot; <br />
            Abort<br />
<br />
NoError:<br />
    MessageBox MB_OK &quot;Copy Ok&quot;<br />
<br />
<br />
<br />
Many thank for your help.<br />
Mark</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th May 2010, 17:29</div></div><div class="posttext">That is not a good way to do it. Have you tried moving the entire folder (Rename)?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">b179210</div><div class="date">6th May 2010, 08:24</div></div><div class="posttext">I have tried with &quot;Rename&quot; and &quot;MoveFileFolder&quot; functions, but error flag is raised because a file is locked.<br />
<br />
My simple scenario is:<br />
<br />
- copy all files from A folder to B folder with (or without) overwrite existing file<br />
<br />
but if a file is locket in B folder error is raised and no files are copied, nor file not locked.<br />
Many thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th May 2010, 09:50</div></div><div class="posttext">Rather than do a CopyFiles using wildcards perhaps you should use Locate and copy each file individually.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">b179210</div><div class="date">6th May 2010, 10:40</div></div><div class="posttext">Yes, the problem is that i have 31 files and every time these are different..:confused:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th May 2010, 10:58</div></div><div class="posttext">That is why you can use Locate. Do a recursive search through your source folder picking up any files.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">b179210</div><div class="date">6th May 2010, 13:32</div></div><div class="posttext">Ok, good idea :) i'm searching function for do recoursive search.<br />
Many thanks, i will tell you :cool:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th May 2010, 13:40</div></div><div class="posttext">Locate is in the user manual.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">b179210</div><div class="date">18th May 2010, 08:35</div></div><div class="posttext">Finally i have finished my code using Locate function:<br />
<br />
Section<br />
	StrCpy $R0 &quot;C:\ftp&quot;   ;Directory copy from<br />
	StrCpy $R1 &quot;C:\ftp2&quot;  ;Directory copy into<br />
	StrLen $R2 $R0<br />
 <br />
	GetTempFileName $0<br />
	FileOpen $R3 $0 w<br />
	${Locate} &quot;$R0&quot; &quot;/L=FDE&quot; &quot;Example6&quot;<br />
	FileClose $R3<br />
 <br />
	IfErrors 0 +2<br />
	MessageBox MB_OK 'error'<br />
 <br />
	Exec '&quot;notepad.exe&quot; &quot;$0&quot;'     ;view log<br />
SectionEnd<br />
 <br />
Function Example6<br />
	StrCpy $1 $R8 '' $R2<br />
 <br />
	StrCmp $R6 '' 0 +3<br />
	CreateDirectory '$R1$1\$R7'<br />
	goto end<br />
	CreateDirectory '$R1$1'<br />
	CopyFiles /SILENT $R9 '$R1$1'<br />
 <br />
	IfFileExists '$R1$1\$R7' 0 +3<br />
	FileWrite $R3 &quot;-old:$R9  -new:$R1$1\$R7  -success$\r$\n&quot;<br />
	goto +2<br />
	FileWrite $R3 &quot;-old:$R9  -new:$R1$1\$R7  -failed$\r$\n&quot;<br />
 <br />
	end:<br />
	Push $0<br />
FunctionEnd<br />
<br />
So, i can copy files and see log :)<br />
<br />
Many thanks for your precious help :up:<br />
<br />
Bye bye</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th May 2010, 12:27</div></div><div class="posttext">You can rename &quot;Example6&quot; to whatever you want (i.e. &quot;LocateCallback&quot;) just to make the function mean something.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">b179210</div><div class="date">20th May 2010, 11:50</div></div><div class="posttext">You can rename &quot;Example6&quot; to whatever you want (i.e. &quot;LocateCallback&quot;) just to make the function mean something.<br />
<br />
Stu<br />
<br />
Yes, of course ;)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>