<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Complicated LogicLib problem, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Complicated LogicLib problem NSIS Discussion" />
	
	<title> Complicated LogicLib problem [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Complicated LogicLib problem</div>
<hr />
<div class="pda"><a href="t-270269.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=270269">Complicated LogicLib problem</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">DrDan</div><div class="date">27th April 2007, 15:46</div></div><div class="posttext">I spent all morning trying to work out what was causing the following compilation error:<br />
<br />
NSIS Error: label &quot;_LogicLib_Label_7.1.5:&quot; already declared in section<br />
<br />
It turns out to be the following: some of the code for the installer I am writing will be automatically generated and placed into a header file. This code is effectively just code portions that we !include in the Sections of the installer. E.g.<br />
<br />
<br />
Section<br />
  DetailPrint &quot;Installing Tool A...&quot;<br />
  <br />
  !include tool.a.nsh<br />
  !include tool.a.dependency.nsh<br />
<br />
SectionEnd<br />
<br />
<br />
The contents of the .nsh files is just the installation steps to install tool A, i.e. the files and directories for that tool, registry entries if needed etc.<br />
<br />
Now, the situation I was in was that both the header files  tool.a.nsh and tool.a.dependency.nsh contained a call to a certain macro (with different parameters each time) and in both cases that macro call was on line 7 of the .nsh file. I need to call this macro in the .nsh as it sets up some configuration data for use later in the installer.<br />
<br />
This macro uses the LogicLib and having had a quick look at the LogicLib header file, it seems that the ${If} macros use the line numbers to generate goto labels based upon line numbers in the file that they are in. However, since the macro was called on the same line in each .nsh file, this meant that LogicLib generated the same label twice which, of course, confuses the compiler.<br />
<br />
I have attached an example to illustrate this problem and it generates the error:<br />
<br />
<br />
Error: label &quot;_LogicLib_Label_1.1.5:&quot; already declared in section<br />
Error in macro _Else on macroline 13<br />
Error in macro EG04_LogicLibMacroFun on macroline 3<br />
!include: error in script: &quot;tool.a.dependency.nsh&quot; on line 1<br />
<br />
<br />
How can I get around this problem? I can't add a new line to the .nsh files because they are to be generated by another program.<br />
<br />
I would prefer to stick with using the LogicLib if possible, because it is easier to read and maintain.<br />
<br />
Thanks in advance.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">27th April 2007, 16:07</div></div><div class="posttext">Use the attached version. It'll also be distributed with 2.26.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrDan</div><div class="date">27th April 2007, 16:12</div></div><div class="posttext">Thanks for the prompt response. I'll give it a try :-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrDan</div><div class="date">7th June 2007, 09:54</div></div><div class="posttext">... I started using the Perl-compatible regular expression plug-in: http://nsis.sourceforge.net/NSISpcre_plug-in<br />
<br />
This does indeed integrate with LogicLib, but it brings the original problem back :( :( :( <br />
<br />
As a work-around, looks like we will have to add different numbers of blank lines to each of our header files to alleviate this problem.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th June 2007, 21:33</div></div><div class="posttext">What's the exact error you get? Is it from LogicLib?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">8th June 2007, 02:32</div></div><div class="posttext">The NSISpcre.nsh file contains the same (buggy) macro that used to be in LogicLib. You can correct the version you are using by changing the NSISpcre.nsh file in two places:<br />
<br />
Replace the two lines (at 854 and 882) that read!define __t _LogicLib_Label_${__LINE__}with    !define __t _LogicLib_Label_${LOGICLIB_COUNTER}<br />
    !insertmacro _IncreaseCounter<br />
The LOGICLIB_COUNTER define and _IncreaseCounter macro will exist because they are in the new LogicLib that corrected the previous problem you had.<br />
<br />
Don</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>