<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" 2.0b1 $EXEDIR bug, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  2.0b1 $EXEDIR bug NSIS Discussion" />
	
	<title> 2.0b1 $EXEDIR bug [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  2.0b1 $EXEDIR bug</div>
<hr />
<div class="pda"><a href="t-125405.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=125405">2.0b1 $EXEDIR bug</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">dirtydingus</div><div class="date">17th February 2003, 17:38</div></div><div class="posttext">In both 2.0b1 and in the nighlty downloaded a few minutes ago from  http://nsis.sourceforge.net/nightly/nsis.zip  $EXEDIR is not set correctly if the location is the root directory.<br />
<br />
If you run an exe from 'C:\' the $EXEDIR is set to 'C' instead of 'C:' as it was in 20b0<br />
<br />
Currently I have a workaround which is as follows<br />
<br />
!define EXEDR $8 ; Spare Global contains Fixed EXEDIR variable <br />
  StrLen ${TEMP1} $EXEDIR<br />
  strcpy ${EXEDR} $EXEDIR<br />
  IntCmp ${TEMP1} 1 +2 +1 exedirOK<br />
  strcpy ${EXEDR} &quot;C&quot;<br />
  strcpy ${EXEDR} &quot;${EXEDR}:&quot;<br />
  MessageBox MB_OK &quot;$EXEDIR = ${TEMP1} ${EXEDR}&quot;<br />
exedirOK:<br />
<br />
The work around is paranoid and sets the new global to C: if $EXEDIR is not defined at all. I have stuck this code in my .onInit function<br />
<br />
Share &amp; Enjoy<br />
<br />
DD <br />
PS the Help About Dialog for the betas still says version 1.9 which is a bit misleading</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th February 2003, 15:44</div></div><div class="posttext">This code should provide a better workaround as you don't have to spare a variable for it:<br />
<br />
Function .onInit<br />
	StrLen $0 $EXEDIR<br />
	StrCmp $0 1 0 +2<br />
		StrCpy $EXEDIR &quot;$EXEDIR:\&quot;<br />
FunctionEnd<br />
<br />
Here is the bug report:<br />
<br />
http://sourceforge.net/tracker/index.php?func=detail&amp;aid=684908&amp;group_id=22049&amp;atid=373085<br />
<br />
The about dialog you are talking about is for MakeNSISw, not NSIS. On the bottom of that dialog you can find the version of NSIS too.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirtydingus</div><div class="date">18th February 2003, 16:19</div></div><div class="posttext">StrCpy $EXEDIR &quot;$EXEDIR:\&quot;<br />
<br />
Two problems with that idea<br />
1) you really don't want the \ as $EXEDIR doesn't have a trailing \ in other circs<br />
2) it doesn't work, it seems not to be possible to set $EXEDIR - at least not in the nightly I'm using</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th February 2003, 16:30</div></div><div class="posttext">1) It works. The installer doesn't use $EXEDIR after .onInit, it's only for your use and NSIS automatically trims down the trailing back-slash when you use it.<br />
2) What error do you get? It worked perfectly fine for me. I am also using the latest version, and I haven't changed anythign relating to this since the latest nightly.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th February 2003, 19:59</div></div><div class="posttext">I have fixed this bug in the latest CVS version. Please try it and tell me if it works for you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirtydingus</div><div class="date">20th February 2003, 10:11</div></div><div class="posttext">It works! Thanks much. <br />
<br />
FYI Below is a suitable test case if you need one. You will see that you get an error trying to create the license.txt file with older versions of makensisw but that it works in the CVS build<br />
<br />
; test.nsi<br />
;<br />
<br />
; The name of the installer (not really used in a silent install)<br />
Name &quot;test&quot;<br />
<br />
; Set to silent mode<br />
SilentInstall silent<br />
<br />
; The file to write<br />
OutFile &quot;test.exe&quot;<br />
<br />
Function .onInit<br />
  MessageBox MB_OK &quot;Exedir is '$EXEDIR'&quot;<br />
  StrCpy $EXEDIR &quot;C:\&quot;<br />
<br />
FunctionEnd<br />
<br />
; The stuff to install<br />
Section &quot;&quot;<br />
  ; Set output path to the $EXEDIR directory.<br />
  MessageBox MB_OK &quot;Exedir is now '$EXEDIR'&quot;<br />
  SetOutPath $EXEDIR<br />
  ; Extract file<br />
  File &quot;..\license.txt&quot;<br />
  ; View file<br />
<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">20th February 2003, 10:40</div></div><div class="posttext">I think you meant makensis.exe rather than makensisw.exe. I'm getting a bit sick of people confusing the two, I wonder what we could/should do about this, if anything?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>