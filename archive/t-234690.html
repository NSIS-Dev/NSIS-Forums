<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" execwait and batch-files, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  execwait and batch-files NSIS Discussion" />
	
	<title> execwait and batch-files [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  execwait and batch-files</div>
<hr />
<div class="pda"><a href="t-234690.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=234690">execwait and batch-files</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">simplex2k4</div><div class="date">4th January 2006, 13:57</div></div><div class="posttext">hello everyone,<br />
<br />
i'm new to nsis and i'm delaing with it several days. it's impressing how easy nsis is handeled.<br />
<br />
today i ran into a problem concerning the execwait command with executing batchfiles. this doesn't work for me.<br />
<br />
i tried many times after searching the forum here for hints. all hints seem to be logic for me, unfortunately doesn't work.<br />
<br />
here is my problem-code:<br />
<br />
Execwait  &quot;$instdir\mplot\cmd.win\madmin.bat&quot;<br />
<br />
also tried with using comspec-env var and nsexec and this<br />
<br />
Exec 'start /wait &quot;$instdir\mplot\cmd.win\madmin.cmd&quot;'<br />
<br />
as suggested here in the forum.<br />
<br />
the batchfile contents:<br />
<br />
setlocal<br />
set MQUEST_INSTL=C:\Ideas\IdeasNX\mplot<br />
set MQUEST_SHARED=%MQUEST_INSTL%\bin\i686_nt<br />
call &quot;%MQUEST_INSTL%\cmd.win\mquest_varbs.cmd&quot;<br />
start &quot;Title&quot; &quot;%MQUEST_SHARED%\mqxwish.exe&quot; &quot;%MQUEST_INSTL%\madmin\madmin.mqx&quot; -- %*<br />
endlocal<br />
<br />
<br />
i also tried programming the lines directly into nsis-script - also not working:<br />
<br />
SetOutPath &quot;$INSTDIR\mplot\cmd.win&quot;	<br />
exec &quot;setlocal&quot;<br />
Exec &quot;set MQUEST_INSTL=C:\Ideas\IdeasNX\mplot&quot;<br />
Exec &quot;set MQUEST_SHARED=%MQUEST_INSTL%\bin\i686_nt&quot;<br />
SetOutPath &quot;$INSTDIR\mplot\cmd.win&quot;	<br />
Exec &quot;$instdir\mplot\cmd.win\mquest_varbs.cmd&quot;<br />
SetOutPath &quot;$INSTDIR\bin\i686_nt&quot;	<br />
Execwait '&quot;%MQUEST_SHARED%\mqxwish.exe&quot; &quot;%MQUEST_INSTL%\madmin\madmin.mqx&quot;'<br />
Exec &quot;endlocal&quot;<br />
<br />
<br />
i don't know if there is any command which checks a certain process. this could do the job. the exe-file above is the important thing to me. maybe i have an error in the code above? if yes - sorry for that but i can't see the anything wrong.<br />
<br />
<br />
i noticed that a 'pause' command is the only thing which really make nsis waiting.<br />
<br />
<br />
thanks in advance for your help.<br />
<br />
greetings <br />
simplex</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">4th January 2006, 14:47</div></div><div class="posttext">Can you explain what not works? mqxwish.exe not starts? With nsExec you can use ExecToLog to see batch output. And ExecDos (http://nsis.sourceforge.net/ExecDos) also can redirect output to file. BTW Exec &quot;set.. not works, because set is not an executable file but command line processor directive. This may help http://nsis.sourceforge.net/Setting_Environment_Variables</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simplex2k4</div><div class="date">4th January 2006, 15:21</div></div><div class="posttext">hello takhir,<br />
<br />
thank you for your support.<br />
<br />
mqxwish.exe always starts but installer finishes always before closing the exe.program.<br />
<br />
i also tried execdos but without success. <br />
<br />
<br />
<br />
the link you postet i quite good. i gave it a try and wrote following code with including WriteEnvStr.nsh as listed on that page:<br />
<br />
!define ALL_USERS<br />
!include WriteEnvStr.nsh # or the name you chose <br />
<br />
Function startmadmin<br />
<br />
  Push &quot;MQUEST_INSTL&quot;<br />
  Push &quot;$instdir\mplot&quot;<br />
  Call WriteEnvStr<br />
  Push &quot;MQUEST_SHARED&quot;<br />
  Push &quot;$instdir\mplot\bin\i686_nt&quot;<br />
  Call WriteEnvStr<br />
	<br />
Execwait '&quot;$instdir\mplot\bin\i686_nt\mqxwish.exe&quot; &quot;$instdir\mplot\madmin\madmin.mqx&quot;'<br />
<br />
FunctionEnd<br />
<br />
<br />
nsis waits for the mqxwish.exe but the exe can't read the env-vars.<br />
<br />
any suggestions?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">4th January 2006, 17:36</div></div><div class="posttext">Sorry, I had doubts when wrote previous post, but now I found this in MSDN : &quot;The SetEnvironmentVariable function sets the value of an environment variable for the current process.&quot; And finally I cannot understand the idea of WriteEnvStr (using kernel32::SetEnvironmentVariable).<br />
So the problem is following: installer not waits for batch file exit? May be mqxwish.exe starts some other application?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simplex2k4</div><div class="date">5th January 2006, 06:39</div></div><div class="posttext">So the problem is following: installer not waits for batch file exit? -&gt; correct.<br />
<br />
the strange thing is that with the writeenvstr funtcion the env-vars schould be set even the machine is rebooted. this says the description: http://nsis.sourceforge.net/Setting_Environment_Variables<br />
please see the paragraph between the first two code-segments.<br />
<br />
May be mqxwish.exe starts some other application? -&gt;<br />
mqxwish.exe is a kind of command shell which starts an special script file (madmin.mqx). that's why the command line is executed with this parameter: &quot;$instdir\mplot\madmin\madmin.mqx&quot;<br />
<br />
task manager says no other program is running when mqxwish.exe does.<br />
<br />
<br />
another idea of mine was to compile the batch file to an com or exe-file and wait for this. i tried with sharware program which can do such a compilation. and it works -<br />
<br />
BUT <br />
<br />
there is always either an advertisement showing up or the user has to press a button to continue - that is not acceptabel for me.<br />
btw do you know batch compilers which are open source or freeware?<br />
<br />
this would be an alternative way and the nsis-command is an &quot;easy-going&quot;.<br />
<br />
greetings,<br />
<br />
simplex</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simplex2k4</div><div class="date">5th January 2006, 09:41</div></div><div class="posttext">hello again takhir,<br />
<br />
i've a solution right now!<br />
<br />
it's quite simple but never thought about:<br />
<br />
in the batch-file there is already a commandline &quot;start&quot; - this command supports the internal switch &quot;/wait&quot;.<br />
<br />
whole command in the batch-file looks like this:<br />
<br />
start /wait &quot;Title&quot; &quot;%MQUEST_SHARED%\mqxwish.exe&quot; &quot;%MQUEST_INSTL%\madmin\madmin.mqx&quot; -- %*<br />
<br />
and it works!<br />
<br />
<br />
inspite, many thanks for your support.<br />
<br />
greetings!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">5th January 2006, 11:33</div></div><div class="posttext">No I see :)<br />
Your batch file launches mqxwish.exe in the new window (with new cmd) and this is why first cmd not waits. Are you sure this is really need? Or you want to start 2 applications?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simplex2k4</div><div class="date">10th January 2006, 07:40</div></div><div class="posttext">hello again,<br />
<br />
sorry for my absence.<br />
<br />
in the meantime i completed the installer and all works fine.<br />
<br />
the command line i mentioned in my last post is correct/necessary. i tried many situations but this is the only thing which works.<br />
<br />
thanx<br />
<br />
simplex</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>