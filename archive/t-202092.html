<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Uninstall and reboot, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Uninstall and reboot NSIS Discussion" />
	
	<title> Uninstall and reboot [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Uninstall and reboot</div>
<hr />
<div class="pda"><a href="t-202092.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=202092">Uninstall and reboot</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Hansen</div><div class="date">14th December 2004, 20:52</div></div><div class="posttext">Hello!<br />
<br />
I have two questions:<br />
<br />
1) Is there a limit on the stack size of NSIS? I would like to write a plugin which during uninstall finds some dynamically generated files to be deleted and puts them on the stack. I will then delete the files from my script with the /REBOOTOK parameter. But is there a limit on the stack size which may give a problem?<br />
<br />
2) Consider the following situation: A user uninstalls a program. Some files cannot be removed and are then registed for removal on system reboot (because the /REBOOTOK parameter is used). The user selects not to reboot the system at this point. Next, the user reinstalls the program. When the system reboots the newly installed files are removed. Is there any good solution to this problem? One way is not to allow the user to reinstall until the system reboot. What is the good way to ensure this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th December 2004, 21:06</div></div><div class="posttext">1) Stack elements are dynamically allocated so there should be no limit but your computer's memory limit.<br />
<br />
2) There was a forum thread about this, you might find some useful information there.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Hansen</div><div class="date">14th December 2004, 21:58</div></div><div class="posttext">Thank you very much for your promptly reply!<br />
<br />
2) I managed to find the old thread (subject: Files get Deleted on Reboot after Uninstall / Install). The suggestion there is to write a &quot;key/file&quot; so that the uninstaller can determine that an old uninstallation has not completed.<br />
<br />
Inspired by this I see one solution:<br />
<br />
On uninstall:<br />
* By using GetTickCount, approximate when the system was last rebooted.<br />
* Create a file and write this information to it.<br />
* Make the file read-only<br />
* Delete the file with /REBOOTOK <br />
* Make the file writeable<br />
* On reinstallation, read the file. If it is there, use the time information in it to determine if the system has rebooted. If the system has not rebooted, refuse to install.<br />
<br />
The reason it needs to be this complicated is, that we can not count on files to actually be removed on reboot. For example the files may be on a network drive. Or the user may not have sufficient permissions to schedule file removal on reboot.<br />
<br />
Any other suggestions will be appreciated.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>