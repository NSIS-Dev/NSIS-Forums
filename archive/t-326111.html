<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Error spawning a command prompt, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Error spawning a command prompt NSIS Discussion" />
	
	<title> Error spawning a command prompt [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Error spawning a command prompt</div>
<hr />
<div class="pda"><a href="t-326111.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=326111">Error spawning a command prompt</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">blh83</div><div class="date">18th January 2011, 01:24</div></div><div class="posttext">I am seeing some odd behavior when spawning a command prompt from an NSIS installer.  Specifically, I am trying to run the following command:<br />
<br />
rundll32.exe setupapi.dll,InstallHInfSection DefaultInstall 132 myInf.inf<br />
<br />
This will install a filter driver on Windows. If I run this command from a command prompt without using the installer, everything works just fine (it creates the necessary registry entries from the .inf file and copies my .sys file to \Windows\System32\drivers).  However, if I try and run this from the installer using something like<br />
<br />
nsExec::Exec '&quot;rundll32.exe&quot; setupapi.dll,InstallHInfSection DefaultInstall 132 myInf.inf'<br />
<br />
it kind of works.  I say 'kind of' because only the registry entries are created but the .sys file is not being copied (and no error is returned).  This seems to indicate an error registering the driver even though no error is returned.  I have made sure that I am running this command from the directory which contains 'myInf.inf'. <br />
<br />
As an experiment, I ran the following:<br />
<br />
ReadEnvStr $R0 COMSPEC<br />
Exec '&quot;$R0&quot; start cmd.exe' <br />
<br />
This opens up a command prompt that I can now interact with. If I type the rundll32 command in here directly, I still see the odd behavior that my .sys file is not being copied but no error is being returned.  Is there some issue I don't know about when spawning a command prompt from the installer?  This is incredibly frustrating and seemingly inexplicable.  The fact that my registry entries are being created from the .inf file and no errors are returned, seems to suggest that it should work even though it isn't.  Any input is appreciated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">18th January 2011, 01:39</div></div><div class="posttext">Try using SetOutPath before the exec call and set it to the directory where your .sys file is.<br />
<br />
Also, I don't think this is really the best way to install a driver these days, but without knowing what kind of driver it is I can't really offer a better solution other than trying to read about installing drivers on MSDN and http://www.osronline.com/showlists.cfm?list=ntdev</div></div><hr />


<div class="post"><div class="posttop"><div class="username">blh83</div><div class="date">18th January 2011, 16:24</div></div><div class="posttext">Thanks for your suggestions Anders.  I had tried setting the out path and it didn't help and also have made sure that I have elevated privileges.  I have to install the driver this way because it is a filter driver (not a normal device driver) and I am doing it via command line.  It may be that I have to write my own dll to call some DIFx functions but was hoping to avoid it.  <br />
<br />
I just find it very odd that a command line spawned from the installer using Windows &quot;start&quot; function doesn't spawn a command prompt that seems to have full functionality.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>