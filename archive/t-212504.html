<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" MDAC install and nopey, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  MDAC install and nopey NSIS Discussion" />
	
	<title> MDAC install and nopey [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  MDAC install and nopey</div>
<hr />
<div class="pda"><a href="t-212504.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=212504">MDAC install and nopey</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jsbach</div><div class="date">7th April 2005, 12:11</div></div><div class="posttext">i need to install mdac in silent mode. mdac must be installed with administrators rights so i'm using nopey addin with runas option. mdac version is checked and if necessary mdactyp is executed directly from inside the main nsis script which is actually installing my application.<br />
the relevant part of the code here:<br />
<br />
nsExec::ExecToStack /TIMEOUT=5000 '&quot;$INSTDIR\mdac_typ.exe&quot; /q:a /c:$\&quot;setup /qn$\&quot;'<br />
<br />
(note: i choosed nsexec because ExecWait doesn't work well).<br />
<br />
MDAC installation is correctly launched and it runs silently upon completion; the problem is that the main scripts goes on without waiting for mdac setup completion.<br />
I believe that nsExec is waiting for 'mdac_typ' execution while the 'real' process to be waited for is 'setup' which is inside the mdac package.<br />
<br />
i can't unpack mdac_typ and launch nsexec......'setup /qn'<br />
because too many files inside mdac package; in addition, mdac can run other sub-setups inside depending on system settings.<br />
<br />
Any idea on how to get rid of this situation ?<br />
note that the main script (which calls mdac) is launched by another small loader which uses nopey to get administrator rights:<br />
<br />
File /oname=$R0 &quot;${NSISDIR}\contrib\nopey\nopey.exe&quot;<br />
nsExec::ExecToStack '&quot;$R0&quot; runas <br />
localadmin:adminpwd &quot;myapp.exe&quot;' ('myapp.exe' then launches mdac if needed).<br />
<br />
<br />
thanks in advance.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th April 2005, 16:12</div></div><div class="posttext">This page (http://unattended.sourceforge.net/installers.php) contains information about installer switches. The InstallShield part shows how to make InstallShield wait for its forked processes. It might also contain such information about the setup engine your MDAC installer uses. I think there was also a forum thread about this a few months ago. Search the forum for &quot;MDAC&quot;, you might find something useful.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jsbach</div><div class="date">8th April 2005, 11:57</div></div><div class="posttext">thanks kichik. i did search forums for 'mdac' but no posts really helped me so i opened this request.<br />
the link you sent seems enough to help. i'm studying on it.<br />
i just wonder what to do with zip/rar self-extract files where you set to execute a program after extraction. in that case you don't have a .msi installer like mdac but the scenario is the same (nsexec self-extract package while you need to wait for the program you're going to launch).<br />
just a thought.<br />
paolo</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th April 2005, 12:02</div></div><div class="posttext">Wrong button?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th April 2005, 12:03</div></div><div class="posttext">*merged*</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JohnDuran</div><div class="date">11th April 2005, 23:17</div></div><div class="posttext">After launching the mdac install.. just wait until the process dies.<br />
<br />
... Exec MDAC ...<br />
sleep 5000<br />
FindProcDLL::FindProc &quot;MDAC_TYP.EXE&quot;<br />
strcmp $R0 &quot;1&quot; -2 0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgilardi</div><div class="date">12th April 2005, 09:03</div></div><div class="posttext">i thank you all for contributes but nothing really helps.<br />
MS mdac distribution (mdac_typ.exe) is not an msi so it doesn't accept msi paramters, especially /sms that would be the one really needed in this case.<br />
Also, it doesn't help wait for mdac_typ completion: nsExec already does.<br />
The issue is that mdac_typ launches the internal setup and closes so that nsExec is looking only on mdac_typ completion then the main script goes on.<br />
I guess i have only two options at this time:<br />
1. look for an official MS mdac package distributed as msi (if any)<br />
2. try to unpack and repack the original mdac_typ so to be able to manage directly the internal setup. i've laready tried this but it seems it doesn't accept paramters at all.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th April 2005, 17:42</div></div><div class="posttext">Merged again. Click the Post a Reply button, not the Post a new Topic button.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jsbach</div><div class="date">15th April 2005, 11:20</div></div><div class="posttext">thank you &amp; sorry for that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jsbach</div><div class="date">15th April 2005, 11:51</div></div><div class="posttext">At present, the only workaround i found was to check-if-mdac_typ-process is running, some thing like this:<br />
section .OnInit<br />
 GetTempFileName $1<br />
 File /oname=$1 &quot;${NSISDIR}\contrib\CheckProcess\CheckProcess.exe&quot;<br />
loop:<br />
 nsExec::ExecToStack '&quot;$1&quot; mdac_typ'<br />
 pop $0<br />
 strcmp $0 &quot;1&quot; 0 nonrunning<br />
 messagebox mb_ok &quot;mdac_typ is running&quot; ; test<br />
 sleep 2000<br />
 goto loop<br />
nonrunning:<br />
 messagebox mb_ok &quot;mdac_typ is not running&quot; ; test<br />
 goto end<br />
end:<br />
; proceed with main installation...<br />
sectionend<br />
<br />
CheckProcess is a contribute i found in this forum: it's not fast but it works.<br />
I don't like such this solutions but at this moment i have no other idea.<br />
tks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jsbach</div><div class="date">15th April 2005, 11:58</div></div><div class="posttext">At present, the only workaround i found was to check-if-mdac_typ-process is running, some thing like this:<br />
section .OnInit<br />
 GetTempFileName $1<br />
 File /oname=$1 &quot;${NSISDIR}\contrib\CheckProcess\CheckProcess.exe&quot;<br />
loop:<br />
 nsExec::ExecToStack '&quot;$1&quot; mdac_typ'<br />
 pop $0<br />
 strcmp $0 &quot;1&quot; 0 nonrunning<br />
 messagebox mb_ok &quot;mdac_typ is running&quot; ; test<br />
 sleep 2000<br />
 goto loop<br />
nonrunning:<br />
 messagebox mb_ok &quot;mdac_typ is not running&quot; ; test<br />
 goto end<br />
end:<br />
; proceed with main installation...<br />
sectionend<br />
<br />
CheckProcess is a contribute i found in this forum: it's not fast but it works.<br />
I don't like such this solutions but at this moment i have no other idea.<br />
tks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jsbach</div><div class="date">18th April 2005, 13:47</div></div><div class="posttext">i found that CheckProcess needs .net installed so it can't be used for my purposes. i use instead userfunction with this code:<br />
<br />
CheckIfMDACIsRunning:<br />
mdacloop:<br />
 FindProcDLL::FindProc &quot;dasetup.exe&quot;<br />
 strcmp $R0 &quot;1&quot; 0 NotRunning<br />
 sleep 2000<br />
 goto mdacloop<br />
NotRunning:<br />
 goto MDACOK<br />
MDACOK:</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>