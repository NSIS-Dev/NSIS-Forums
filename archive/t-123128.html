<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS target version information?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS target version information? NSIS Discussion" />
	
	<title> NSIS target version information? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS target version information?</div>
<hr />
<div class="pda"><a href="t-123128.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=123128">NSIS target version information?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">cnthomas16</div><div class="date">28th January 2003, 22:49</div></div><div class="posttext">Anyone have any idea what it would take to add version resource information to the .exe that makesnis produces? I saw a previous thread that mentioned this feature was 'not ready yet' sometime last year. <br />
<br />
I attempted to write the version info to the binary after it was created but then all the internal checksum validations failed which made this a no-go.<br />
<br />
I love this installer, coming from the InstallShield world this lightweight simpleness is outstanding. All I need to make this installer usable for me is this feature. I'm happy to lend a hand, I poked around in the code a bit, tried writing a VS_FIXEDVERSIONINFO block to the resources but didn't have much luck in getting it to work right.<br />
<br />
-Chris</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rainwater</div><div class="date">29th January 2003, 01:25</div></div><div class="posttext">I believe you will want to use !packhdr to add the source.  This way it will not fail any checksum.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th January 2003, 14:15</div></div><div class="posttext">I plan on adding this feature to b2. b1 is coming out so it shouldn't be too long... If you want to add it yourself look in Source\Build.cpp line 1505 for an example.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cnthomas16</div><div class="date">29th January 2003, 19:20</div></div><div class="posttext">rainwater, can you clarify how I might use !packhdr to insert version information into the binary during build time? or perhaps fix the header in the .exe I modified after the fact.<br />
<br />
rtfm'ing, I get the impression this command is used for something different.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">29th January 2003, 19:38</div></div><div class="posttext">EXE created by the installer is like the one of WinZIP self extractor, You can't change the info binary because, like an older post, the'll be a checksum error....<br />
If you are trying to put info. like exe version, product version, etc., it have to be from the source code of Makensis... so you have to rebuild the source code to put this info on.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th January 2003, 19:53</div></div><div class="posttext">Not so accurate... That's not the only way. The second way is !packhdr which tells makensis to run a program such as UPX before it calculates the checksum. It was originally designed for EXE compressors but it can be used for this purpose too if you create a program that adds version information.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">29th January 2003, 21:39</div></div><div class="posttext">Than !packhdr is a way to add some binary info. in the installer? Let me try it.... :P<br />
<br />
I'm too was wondering if that I can add some info the EXE installer...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th January 2003, 21:57</div></div><div class="posttext">It lets you run a program that will alter the exe header but it doesn't alter the exe header on its own. You'll have to write a program that changes the resource and adds version information and run it with !packhdr. Only this way the CRC (checksum) will be right.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">29th January 2003, 22:12</div></div><div class="posttext">Ok, I downloaded the UPX... I put this in the script:<br />
<br />
!packhdr &quot;temp.dat&quot; &quot;${dirico}\upx.exe -9 temp.dat&quot;<br />
;where ${dirico}\upx.exe is my path for the upx.exe<br />
<br />
Ok, tested and it not return error, that's great, but the temp.dat.. it suppose the have the info header? How can I make the .dat?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rainwater</div><div class="date">29th January 2003, 22:55</div></div><div class="posttext">Originally posted by dark_boy <br />
Ok, I downloaded the UPX... I put this in the script:<br />
<br />
!packhdr &quot;temp.dat&quot; &quot;${dirico}\upx.exe -9 temp.dat&quot;<br />
;where ${dirico}\upx.exe is my path for the upx.exe<br />
<br />
Ok, tested and it not return error, that's great, but the temp.dat.. it suppose the have the info header? How can I make the .dat?  <br />
<br />
The temp.dat is created automatically (thats the header).  Upx runs on it, and it will be deleted.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cnthomas16</div><div class="date">29th January 2003, 22:57</div></div><div class="posttext">I am using rsrc.exe from the rsxnt tools for adding version info to the binary, adding the line:<br />
<br />
!packhdr temp.exe &quot;rsrc.exe verinfo.res temp.exe&quot;<br />
<br />
Im assuming the makensis writes out the temp file for modification, reads it back, then writes the final output, but I can't get it to work either. I don't believe my paths are an issue, everything is one directory.<br />
<br />
I can't use .dat because the utility only works on .exe files. So when I get to the end of the build, the compiler complins with the msg:<br />
<br />
 Generating language tables... Done!<br />
 update .rsrc section<br />
 Finding icons offsets for uninstaller... <br />
 generate_unicons_offsets: no icons?! -- failing!<br />
 Error - aborting creation process<br />
<br />
<br />
Hmmmm....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th January 2003, 10:11</div></div><div class="posttext">dark_boy, UPX is an EXE compressor, it doesn't add version information. I gave it as an example usage of !packhdr.<br />
<br />
cnthomas16, according to the error there rsrc removed the icons from the exe header. It seems like it replaced all of the resources with the resources in verinfo.res. I couldn't find the program online so I can't test this, but there must be some way to tell it to add rather than replace.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">30th January 2003, 11:23</div></div><div class="posttext">For now, I think that you should use ResHack to edit the version info and just wait for NSIS 2b2.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">30th January 2003, 21:10</div></div><div class="posttext">oops, sorry dudes  ! :D <br />
I'll just wait for the feature to be added...<br />
<br />
<br />
but still cool extra compressor :p</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cnthomas16</div><div class="date">31st January 2003, 01:33</div></div><div class="posttext">Of course, that now makes sense with the icon, rsrc did replace all the resources.<br />
<br />
Thanks for the great feedback, I'm looking forward to b2. Keep up the great work, NSIS is awesome, it fills a huge void for lightweight installs. I'd like to be able to contribute to this great cause somewhere down the road when I get my head above water.<br />
<br />
I'll go check out ResHack, it just might do for now.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>