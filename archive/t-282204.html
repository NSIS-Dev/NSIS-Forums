<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" get INSTDIR in uninstaller.exe, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  get INSTDIR in uninstaller.exe NSIS Discussion" />
	
	<title> get INSTDIR in uninstaller.exe [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  get INSTDIR in uninstaller.exe</div>
<hr />
<div class="pda"><a href="t-282204.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=282204">get INSTDIR in uninstaller.exe</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">kiage</div><div class="date">27th November 2007, 15:20</div></div><div class="posttext">My application can be installed more than once on the same system with different installation dirs, registry keys, ports, etc. for example<br />
<br />
c:\Program Files\AAAA        this is the default<br />
c:\Program Files\XXXX<br />
<br />
When I want to uninstall one of those I need to determine which instance should be removed.<br />
<br />
I planned to do this by reading a file from $EXEDIR of the uninstaller. Unfortunately <br />
<br />
c:\Program Files\XXXX\uninstall.exe <br />
<br />
is first unpacked  to a temp directory and then an executable Au_.exe is started. For this programm it is<br />
<br />
$EXEDIR  = c:\Temp\~nsu.tmp<br />
$EXEPATH = c:\Temp\~nsu.tmp\Au_.exe<br />
<br />
$INSTDIR = c:\Program Files\AAAA\uninstall.exe <br />
the value of the default installation directory.<br />
<br />
So how could I determine, which instance to remove?<br />
<br />
Andy ideas?<br />
Thanks, Andre</div></div><hr />


<div class="post"><div class="posttop"><div class="username">galevsky</div><div class="date">27th November 2007, 15:40</div></div><div class="posttext">I am not sure to understand what you wanna do..... what the pb when reading from &quot;$INSTDIR\foo.txt&quot; ? ($INSTDIR contained in the uninstaller was set during the installation, so if it was installed in C:\Program Files\XXXX, it will read C:\Program Files\XXXX\foo.txt and not the C:\Program Files\AAAA\foo.txt one)<br />
<br />
Gal'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kiage</div><div class="date">27th November 2007, 16:29</div></div><div class="posttext">Thanks for pointing this out. I had seen this in the documentation, but it was not what my debugging code showed me.<br />
<br />
Unfortunately I have overlooked something the previous programmer did:<br />
<br />
ReadRegStr $INSTDIR HKLM &quot;$REGKEY&quot; Path<br />
<br />
Removing this statement gave me what I need.<br />
<br />
Thanks for the excellent answer,<br />
Andre</div></div><hr />


<div class="post"><div class="posttop"><div class="username">galevsky</div><div class="date">27th November 2007, 16:46</div></div><div class="posttext">was a pleasur'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">staffan</div><div class="date">5th March 2008, 14:53</div></div><div class="posttext">I have a simmilar problem. When I run the uninstall.exe $INSTDIR is correct, but it I run an installer and it says I already have the program installed and choose to uninstall the existing version $INSTDIR seems to be the default value rather then where I installed it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">galevsky</div><div class="date">5th March 2008, 15:15</div></div><div class="posttext">Originally posted by staffan <br />
I have a simmilar problem. When I run the uninstall.exe $INSTDIR is correct, but it I run an installer and it says I already have the program installed and choose to uninstall the existing version $INSTDIR seems to be the default value rather then where I installed it.  <br />
<br />
Of course. Your installer doesn't know if you have already installed your soft in c:\Program Files\Already\. But, during the installation, if the uninstaller is generated at the end, the uninstaller keep the information &quot;installed under C:\Program Files\Already&quot;.<br />
<br />
So, how can you do to know wether your soft is already installed or not ? Use Windows register keys to do that...<br />
<br />
During the install process, check for the key existance (you can define some variables like version, company, install_path and so on...) then warn the user if already installed. In the end of the process, don't forget to write the key into the register with the good values....<br />
<br />
That's all.<br />
<br />
<br />
Gal'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">staffan</div><div class="date">5th March 2008, 15:20</div></div><div class="posttext">Originally posted by galevsky <br />
So, how can you do to know wether your soft is already installed or not ? Use Windows register keys to do that...<br />
<br />
Yes, that's what I do. It's when the old version is to be uninstalled the problem occurs.<br />
<br />
I think I've managed to find the problem. In PageLeaveReinstall it calls ExecWait '$R1 _?=$INSTDIR' and that means it calls C:\Dir\ActuallyInstalled\Uninstall.exe _?= C:\Dir\ThinkItsInstalled and that ofcourse gets all wrong.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">galevsky</div><div class="date">5th March 2008, 15:44</div></div><div class="posttext">Good.<br />
<br />
I used to store tmp var in a tmp.ini file (deleted in the end) where I read/write all my persistent var.... so I am sure not to mix up.<br />
<br />
Gal'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">staffan</div><div class="date">5th March 2008, 16:23</div></div><div class="posttext">I solved it by using the path from the old installation as<br />
<br />
  ReadRegStr $R1 HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot; &quot;UninstallString&quot;<br />
<br />
and then trimming it<br />
<br />
    ${GetParent} &quot;$R1&quot; $R4<br />
    ExecWait '$R1 _?=$R4'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">galevsky</div><div class="date">5th March 2008, 16:38</div></div><div class="posttext">well-done.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>