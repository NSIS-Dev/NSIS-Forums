<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Access to Destination Folder string, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Access to Destination Folder string NSIS Discussion" />
	
	<title> Access to Destination Folder string [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Access to Destination Folder string</div>
<hr />
<div class="pda"><a href="t-202965.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=202965">Access to Destination Folder string</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Bobbie100</div><div class="date">24th December 2004, 15:42</div></div><div class="posttext">I am implementing an installation script with the Modern UI. NSIS carries out checks on the string in the Destination Folder before exiting the Directory Page. As part of those checks any invalid characters ( *?|&lt;&gt;/&quot;: ) are deleted. This means that the actual install directory may not be the same as the one shown in the Destination Folder edit box.<br />
<br />
I am not happy with this behaviour and want to stop the install with an appropriate message if the string in the Destination Folder contains any invalid characters. My preferred approach is to let the user set the string and then check it when the install button is pressed.<br />
<br />
I have tried implementing this by checking the $INSTDIR variable using a MUI_PAGE_CUSTOMFUNCTION_LEAVE. However, the $INSTDIR variable has already had the invalid characters stripped at this point.<br />
<br />
Is there any way to access the string in the Destination Folder directly for these checks? Or is there a better way to implement what I'm trying to do?<br />
<br />
Any help would be much appreciated,<br />
Bob</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th December 2004, 17:03</div></div><div class="posttext">You could change the NSIS source, or you could try this:<br />
http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.1.16<br />
Then in the Page's Leave function, use one of these functions:<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=628&amp;instances=0,11,122<br />
<br />
Hope that helps!<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Bobbie100</div><div class="date">24th December 2004, 17:39</div></div><div class="posttext">Afrow UK, Thanks for your reply.<br />
<br />
I had already tried using GetInstDirError with MUI_DIRECTORYPAGE_VERIFYONLEAVE, but it seems to only check after the invalid characters have been removed because GetInstDirError returns 0 (valid).<br />
<br />
Wish I'd seen your second link earlier, it would have saved me inventing my own (less efficient) version of searching for invalid characters in a string.<br />
<br />
Bob</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th December 2004, 21:40</div></div><div class="posttext">I found a solution; to use a different variable other than $INSTDIR by using DirVar...Var $MYINSTDIR<br />
PageEx Directory<br />
 PageCallbacks &quot;&quot; &quot;&quot; DirLeave<br />
 DirVerify leave<br />
 DirVar $MYINSTDIR<br />
PageExEnd-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Bobbie100</div><div class="date">24th December 2004, 23:31</div></div><div class="posttext">That's great Stu!<br />
<br />
In fact I've managed to implemented it sticking to the MUI items as follows:<br />
<br />
  Var MyInstallDir<br />
  !define MUI_DIRECTORYPAGE_VARIABLE $MyInstallDir<br />
  !define MUI_PAGE_CUSTOMFUNCTION_PRE DirPre<br />
  !define MUI_PAGE_CUSTOMFUNCTION_PRE DirLeave<br />
  ..<br />
  Function DirPre<br />
    StrCpy $MyInstallDir $INSTDIR<br />
  FunctionEnd<br />
<br />
plus a bunch of directory checking code in DirLeave<br />
<br />
Many thanks Stu<br />
Does this forum have a system of reward points for useful posts. You'd get my vote, especially as you're almost a neighbour!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th December 2004, 13:13</div></div><div class="posttext">Don't worry 'bout it :)<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>