<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" nsExec bug, probably, erroneous first run behavior, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  nsExec bug, probably, erroneous first run behavior NSIS Discussion" />
	
	<title> nsExec bug, probably, erroneous first run behavior [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  nsExec bug, probably, erroneous first run behavior</div>
<hr />
<div class="pda"><a href="t-279683.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=279683">nsExec bug, probably, erroneous first run behavior</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">chjfth</div><div class="date">22nd October 2007, 09:44</div></div><div class="posttext">On a Windows machine that nsExec::Exec has never run before, execute a installer generated by the following nsi script:<br />
<br />
<br />
Name &quot;nsExec Test&quot;<br />
<br />
OutFile &quot;nsExec-Test.exe&quot;<br />
<br />
ShowInstDetails show<br />
<br />
Section &quot;Silent MakeNSIS&quot;<br />
    nsExec::Exec &quot;regYYY&quot;<br />
	Pop $0 # return value/error/timeout<br />
	DetailPrint &quot;&quot;<br />
	DetailPrint &quot;       Return value: $0&quot;<br />
	DetailPrint &quot;&quot;<br />
SectionEnd<br />
<br />
 <br />
<br />
Of course, you don't have regYYY.exe on your Windows, but you'll get &quot;Return value: 0&quot; , which means execution success [:-(]. However, a second run of the very installer on the same machine will give the result &quot;Return value: error&quot;.<br />
<br />
You can easily reproduce this symptom by installing a virtual machine software with snapshot functionality, e.g. WMWare Workstation(you are well off making a snapshot before first launching the installer).<br />
<br />
Does any developer guy know what the problem is? I'm using NSIS v2.31 .</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">23rd October 2007, 00:58</div></div><div class="posttext">Works fine for me returning error every time. Have you been able to reproduce this on more than one VM? Which OS? Which configuration? Reboot helps?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">chjfth</div><div class="date">23rd October 2007, 03:54</div></div><div class="posttext">Thank you Kichik, before I post this topic, I tried it on two virtual machines, one is Win2k SP4, the other is WinXP SP2(both are simplified Chinese version). <br />
<br />
Since Kichik says he tried himself and did not find this problem, I tried again on a new Windows Win2K system(English version). This time nsExec behaves correctly as well. So I suspect that this problem can only be seen on simplified Chinese versions of Windows.<br />
<br />
Please download this VMware virtual machine(simplified Chinese Win2k) and try again for me. http://down.nlscan.com/Misc/Internet-Keep-Ref/_vmware-5-Win2kchs-nsExec-bug.7z<br />
<br />
BTW: On every reboot of that Win2K VM, we got 0 from nsExec::Exec, a second run after reboot gives the correct result, i.e, &quot;error&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">chjfth</div><div class="date">23rd October 2007, 04:20</div></div><div class="posttext">Why is my URL submitted hidden by the forum? That URL is: <br />
<br />
down.nlscan.com/Misc/Internet-Keep-Ref/_vmware-5-Win2kchs-nsExec-bug.7z</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">23rd October 2007, 20:48</div></div><div class="posttext">Your URL is hidden because you're a new user. I get 404 on both posted URLs.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">chjfth</div><div class="date">24th October 2007, 01:50</div></div><div class="posttext">Oh sorry, that URL is correct, but the damn IIS6 by default refuses to serve files with the unknown extension name .7z . Now I've corrected it. Please download and try.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th October 2007, 20:41</div></div><div class="posttext">I get a really lousy download speed of 3kb/s and even that is for no longer than a minute straight which is followed by at least 5 minutes of nothing. Can you upload it to a stabler website?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">chjfth</div><div class="date">25th October 2007, 01:56</div></div><div class="posttext">Well Kichik, that address is on a server of the company I work for which locates in China. It may be slow for you, so feel free to use any download manager(e.g. FlashGet) to get it. You know, it is hard to find a globally fast website that will gladly host a file larger than 300M bytes. This nsExec issue is not urgent for me. So I can wait several weeks.<br />
<br />
Or, if you can get a ISO of Windows 2000/XP simplified Chinese installation disk, you can try installing it on a VM, and I think the problem can be reproduced.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th October 2007, 19:39</div></div><div class="posttext">Well, there's RapidShare, Sendago and others. But I'm still downloading anyway... When it's done, I'll have a look.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th November 2007, 18:32</div></div><div class="posttext">I found and fixed the problem. The internal process nsExec calls never called ExitProcess but only returned its result on WinMain. If there were any threads attached to that process for some reason and they exited after the main thread, the end result would be their result and not the executed program's result.<br />
<br />
I still don't know exactly what caused this to happen just on the first execution in your VMWare, but I don't have time to debug it right now.<br />
<br />
This might have even caused some issue someone once reported about nsExec never returning at all. If there's another thread that won't die until ExitProcess is called, it might cause this.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">chjfth</div><div class="date">10th November 2007, 14:49</div></div><div class="posttext">Thank you Kichik. I'm thankful for your responsiveness.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>