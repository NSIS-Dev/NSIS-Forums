<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" VPatch plugin for NSIS: question, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  VPatch plugin for NSIS: question NSIS Discussion" />
	
	<title> VPatch plugin for NSIS: question [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  VPatch plugin for NSIS: question</div>
<hr />
<div class="pda"><a href="t-110776.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=110776">VPatch plugin for NSIS: question</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Koen van de Sande</div><div class="date">21st October 2002, 12:02</div></div><div class="posttext">I've been working on converting the VPatch exe runtime to a DLL compatible with NSIS, but I have a problem with correct 'initialization' of my filenames which I pop of the stack.<br />
The following *does not* work, however I'm not sure how to change it (since with the old way, additional libraries were required).<br />
<br />
<br />
  {<br />
  	char *source = &quot;&quot;;<br />
	char *dest = &quot;&quot;;<br />
        char *exename = &quot;&quot;;<br />
	HANDLE hPatch, hSource, hDest;<br />
        int result;<br />
<br />
	popstring(exename);<br />
	MessageBox(g_hwndParent,exename,0,MB_OK);<br />
	popstring(source);<br />
	MessageBox(g_hwndParent,source,0,MB_OK);<br />
	popstring(dest);<br />
	MessageBox(g_hwndParent,dest,0,MB_OK);<br />
<br />
	MessageBox(g_hwndParent,exename,0,MB_OK);<br />
	MessageBox(g_hwndParent,source,0,MB_OK);<br />
	MessageBox(g_hwndParent,dest,0,MB_OK);<br />
 <br />
In the last 3 lines, all filenames are the same...<br />
I've attached the complete project. What is the correct way to do this?<br />
<br />
Thanks for any help you can give!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Koen van de Sande</div><div class="date">21st October 2002, 12:30</div></div><div class="posttext">I found it... using &quot;static char exename[1024];&quot; does the trick.<br />
I've removed the bugged version from the post above, and attached a working version of the plugin with this post.<br />
You can now use this VPatch DLL in your installer: put VPatch.dll in your plugin directory, and in the installer you can use it like this:<br />
<br />
vpatch::vpatchfile (Patchfile) (sourcefile) (outputfile)<br />
<br />
The result will be pushed onto the stack; if it begins with &quot;OK&quot;, then all is well. You just need to rename outputfile to sourcefile yourself (if outputfile exists).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th October 2002, 21:11</div></div><div class="posttext">Use static char bla[MAX_PATH].<br />
<br />
Explanation below</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Koen van de Sande</div><div class="date">24th October 2002, 21:24</div></div><div class="posttext">MAX_PATH? Didn't know there was such a constant. I'll change it in the next version. Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th October 2002, 22:33</div></div><div class="posttext">MAX_PATH is the shell's maximum length of a path string.<br />
<br />
You need to define those variables as char name[] because char *name is just a pointer. When you first define it, it points to nothing. You have to give it somewhere to point to or else weird things will happen and memory that shouldn't be written to will be replaced by unwated values. When you use char bla[512] you will get a block the size of 512 bytes. In there a string can be written without overriding other data which probably is critical.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>