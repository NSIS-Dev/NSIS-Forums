<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" nsDialogs patch, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  nsDialogs patch NSIS Discussion" />
	
	<title> nsDialogs patch [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  nsDialogs patch</div>
<hr />
<div class="pda"><a href="t-293666.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=293666">nsDialogs patch</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">TobbeSweden</div><div class="date">26th June 2008, 21:06</div></div><div class="posttext">I've written a small patch for nsDialogs that enables one to specify the initial folder that will be used in a SelectFileDialog dialog.<br />
<br />
The second parameter used to be a variable that would get the path to the file.  Now this variable can also be used to specify the initial folder by setting it to the folder to use before calling SelectFileDialog.  This is very similar to how Windows does it with its Open/Save dialogs.<br />
<br />
Just place the following lines of code somewhere in the beginning of the SelectFileDialog function in browse.c after the calls to popstring. (I placed them on rows 114-118).if (path[lstrlen(path) - 1] == '\\\')<br />
{<br />
	lstrcpy(initialDir, path);<br />
	path[0] = '\0';<br />
}You also need &quot;ofn.lpstrInitialDir = initialDir;&quot; and &quot;char initialDir[1024];&quot; in suitable places.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TobbeSweden</div><div class="date">26th June 2008, 21:14</div></div><div class="posttext">Here's a proper patch: http://paste2.org/p/42721</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">27th June 2008, 07:42</div></div><div class="posttext">you probably want to put &quot;ofn.lpstrInitialDir = initialDir;&quot; inside the if block as well (initialDir could be filled with garbage) Not sure if there is a overflow problem here as well for large string builds, so use lstrcpyn(...,1024) or change char initialDir[1024] to use the nsis string size</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TobbeSweden</div><div class="date">27th June 2008, 08:27</div></div><div class="posttext">Originally posted by Anders <br />
you probably want to put &quot;ofn.lpstrInitialDir = initialDir;&quot; inside the if block as well (initialDir could be filled with garbage)Yeah, you're right. Or it could always be initialized to '\0'.<br />
<br />
Originally posted by Anders <br />
Not sure if there is a overflow problem here as well for large string builds, so use lstrcpyn(...,1024) or change char initialDir[1024] to use the nsis string size Isn't path guaranteed to be at most 1024 character long after the call to popstring(path, sizeof(path));?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">27th June 2008, 11:13</div></div><div class="posttext">Originally posted by TobbeSweden <br />
Isn't path guaranteed to be at most 1024 character long after the call to popstring(path, sizeof(path));?  <br />
yeah, my bad, nsDialogs has it own version of popstring, forgot about that</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TobbeSweden</div><div class="date">30th June 2008, 21:49</div></div><div class="posttext">Updated patch (only sets ofn.lpstrInitialDir if I'm also setting initialDir)<br />
<br />
http://paste2.org/p/43756<br />
<br />
Anything else I can do to get this patch accepted?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th July 2008, 11:09</div></div><div class="posttext">Please submit as a patch on the SourceForge project page.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TobbeSweden</div><div class="date">11th July 2008, 13:54</div></div><div class="posttext">Done</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>