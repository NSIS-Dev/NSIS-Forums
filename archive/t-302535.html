<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Detecting XP vs Vista, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Detecting XP vs Vista NSIS Discussion" />
	
	<title> Detecting XP vs Vista [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Detecting XP vs Vista</div>
<hr />
<div class="pda"><a href="t-302535.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=302535">Detecting XP vs Vista</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">abcdgoldfish</div><div class="date">28th January 2009, 22:40</div></div><div class="posttext">My installer needs to be able to detect if it is being executed on XP or on Vista so it can provide the appropriate default installation path which the user should be able to modify it.<br />
<br />
I can call getOS from within a Section but, by the time the Section code is executed, the MUI_PAGE_DIRECTORY page has already come and gone with the preassigned path.  So, the path indicated on the directory page may be wrong (e.g., if it's &quot;C:\Program Files\...&quot; and being installed on a Vista machine) and, worse, any path the user enters is ignored by the Section code that follows.<br />
<br />
Is there a way that I can populate $INSTDIR with a value after the OS has been detected but before MUI_PAGE_DIRECTORY is displayed?<br />
<br />
I've tried reordering the OS detection section and the various !define MUI_PAGE_... statements and the InstallDir statement but have not been able to come up with a working solution.  I have not been able to dig up anything on this topic in the forum or on the web.<br />
<br />
I'm using the following code to deal with the OS:<br />
<br />
Section &quot;OsDetection&quot;<br />
  call getOS<br />
  ${if} $R0 == &quot;XP&quot;<br />
    strcpy $INSTDIR &quot;C:\Program Files\&lt;work&gt;\${PRODUCT_NAME}&quot;<br />
  ${else}<br />
    strcpy $INSTDIR &quot;C:\Users\Public\Public Documents\&lt;work&gt;\${PRODUCT_NAME}&quot;<br />
  ${EndIf}<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th January 2009, 23:30</div></div><div class="posttext">You can run that code in Function .onInit which is executed before anything else. You should also move to WinVer.nsh instead of GetOS.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>