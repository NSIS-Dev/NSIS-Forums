<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Uninstalling older versions, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Uninstalling older versions NSIS Discussion" />
	
	<title> Uninstalling older versions [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Uninstalling older versions</div>
<hr />
<div class="pda"><a href="t-207036.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=207036">Uninstalling older versions</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">phllp_w</div><div class="date">6th February 2005, 12:42</div></div><div class="posttext">I had NSIS 2.02 and just got NSIS 2.05, I noticed it has an uninstaller which uninstalls older versions.<br />
<br />
Can someone please tell me how to do a thing like that?<br />
Thanks<br />
<br />
<br />
P.S. I found nothing useful in the search. :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">7th February 2005, 12:17</div></div><div class="posttext">P.S. I found nothing useful in the search.<br />
<br />
Why not? Search with unistall and older filters.<br />
<br />
Try to see makensis.nsi in your NSIS\Examples - dir. There are script and ini-file (for custom page) for these purposes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">phllp_w</div><div class="date">7th February 2005, 18:53</div></div><div class="posttext">There are many examples, but none for what I need.<br />
<br />
I need the same thing as in the NSIS installer, so I was hoping a dev could give me the code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">7th February 2005, 22:49</div></div><div class="posttext">AFAIK, makensis.nsi IS the NSIS install script. Look for the PageReinstall function, and see how it is used.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">phllp_w</div><div class="date">7th February 2005, 23:49</div></div><div class="posttext">I tried it but I get an error and my page doesn't show in the installer. :(<br />
<br />
1 warning:<br />
  label &quot;same_version&quot; not used<br />
<br />
Here's my code<br />
  Function PageReinstall<br />
<br />
  ReadRegStr $R0 HKLM &quot;Software\NAME&quot; &quot;&quot;<br />
<br />
  StrCmp $R0 &quot;&quot; 0 +2<br />
    Abortci8<br />
<br />
  ;Detect version<br />
    ReadRegDWORD $R0 HKLM &quot;Software\NAME&quot; &quot;VersionMajor&quot;<br />
    IntCmp $R0 ${VER_MAJOR} minor_check new_version older_version<br />
  minor_check:<br />
    ReadRegDWORD $R0 HKLM &quot;Software\NAME&quot; &quot;VersionMinor&quot;<br />
    IntCmp $R0 ${VER_MINOR} new_version older_version<br />
<br />
  new_version:<br />
<br />
   !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;makensis.ini&quot; &quot;Field 1&quot; &quot;Text&quot; &quot;An older version of NAME is installed on your system. It's recommended that you uninstall the current version before installing. Select the operation you want to perform and click Next to continue.&quot;<br />
   !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;makensis.ini&quot; &quot;Field 2&quot; &quot;Text&quot; &quot;Uninstall before installing&quot;<br />
   !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;makensis.ini&quot; &quot;Field 3&quot; &quot;Text&quot; &quot;Do not uninstall&quot;<br />
   !insertmacro MUI_HEADER_TEXT &quot;Already Installed&quot; &quot;Choose how you want to install NAME.&quot;<br />
   StrCpy $R0 &quot;1&quot;<br />
   Goto reinst_start<br />
<br />
  older_version:<br />
<br />
   !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;makensis.ini&quot; &quot;Field 1&quot; &quot;Text&quot; &quot;A newer version of NAME is already installed! It is not recommended that you install an older version. If you really want to install this older version, it's better to uninstall the current version first. Select the operation you want to perform and click Next to continue.&quot;<br />
   !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;makensis.ini&quot; &quot;Field 2&quot; &quot;Text&quot; &quot;Uninstall before installing&quot;<br />
   !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;makensis.ini&quot; &quot;Field 3&quot; &quot;Text&quot; &quot;Do not uninstall&quot;<br />
   !insertmacro MUI_HEADER_TEXT &quot;Already Installed&quot; &quot;Choose how you want to install NAME.&quot;<br />
   StrCpy $R0 &quot;1&quot;<br />
   Goto reinst_start<br />
<br />
  same_version:<br />
<br />
   !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;makensis.ini&quot; &quot;Field 1&quot; &quot;Text&quot; &quot;NAME ${VER_DISPLAY} is already installed. Select the operation you want to perform and click Next to continue.&quot;<br />
   !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;makensis.ini&quot; &quot;Field 2&quot; &quot;Text&quot; &quot;Reinstall NAME ${VER_DISPLAY}&quot;<br />
   !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;makensis.ini&quot; &quot;Field 3&quot; &quot;Text&quot; &quot;Uninstall NAME ${VER_DISPLAY}&quot;<br />
   !insertmacro MUI_HEADER_TEXT &quot;Already Installed&quot; &quot;Choose the maintenance option to perform.&quot;<br />
   StrCpy $R0 &quot;2&quot;<br />
<br />
  reinst_start:<br />
  !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;makensis.ini&quot;<br />
<br />
FunctionEnd<br />
<br />
Function PageLeaveReinstall<br />
<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $R1 &quot;makensis.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
<br />
  StrCmp $R0 &quot;1&quot; 0 +2<br />
    StrCmp $R1 &quot;1&quot; reinst_uninstall reinst_done<br />
<br />
  StrCmp $R0 &quot;2&quot; 0 +3<br />
    StrCmp $R1 &quot;1&quot; reinst_done reinst_uninstall<br />
<br />
  reinst_uninstall:<br />
  ReadRegStr $R1 HKLM &quot;Software\NAME&quot; &quot;UninstallString&quot;<br />
<br />
  ;Run uninstaller<br />
  HideWindow<br />
<br />
    ClearErrors<br />
    ExecWait '$R1 _?=$INSTDIR'<br />
<br />
    IfErrors no_remove_uninstaller<br />
    IfFileExists &quot;$INSTDIR\NAME Uninstall.exe&quot; no_remove_uninstaller<br />
<br />
      Delete $R1<br />
      RMDir $INSTDIR<br />
<br />
    no_remove_uninstaller:<br />
<br />
  StrCmp $R0 &quot;2&quot; 0 +2<br />
    Quit<br />
<br />
  BringToFront<br />
<br />
  reinst_done:<br />
<br />
FunctionEnd<br />
This installer is for a product with v1.3, it needs to check for 1.0 and 1.1. No minor versions or builds are needed.<br />
<br />
One more thing, makensis,ini is mentioned alot, what is it all about?<br />
<br />
Any help  would be appreciated. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">8th February 2005, 10:51</div></div><div class="posttext">The warning occurs because you removed checks for revision number and build number without correcting the previous code. Replace   minor_check: <br />
    ReadRegDWORD $R0 HKLM &quot;SoftwareNAME&quot; &quot;VersionMinor&quot; <br />
    IntCmp $R0 ${VER_MINOR} new_version older_version  with   minor_check: <br />
    ReadRegDWORD $R0 HKLM &quot;SoftwareNAME&quot; &quot;VersionMinor&quot; <br />
    IntCmp $R0 ${VER_MINOR} same_version new_version older_version  or simply define Revision and Build as 0, using the older code.<br />
<br />
To make the page display, make sure you actually define the page <br />
!insertmacro MUI_PAGE_WELCOME<br />
!insertmacro MUI_PAGE_LICENSE &quot;..\license.txt&quot;<br />
Page custom PageReinstall PageLeaveReinstall<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
!insertmacro MUI_PAGE_INSTFILES as well as any variables (VersionMajor, etc.) and functions (PageReinstallLeave) used.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">phllp_w</div><div class="date">8th February 2005, 22:23</div></div><div class="posttext">Thanks for your help. ;)<br />
<br />
. Replaced that code, and added &quot;Page custom PageReinstall PageLeaveReinstall&quot; to my pages list.<br />
. Made the installer make a reg key with VersionMajor, etc, . Defined VersionMajor, Minor, etc.<br />
. Made the PageLeaveReinstall function so I think that's it...<br />
<br />
I get NO errors, but it still doesn't show up when installing. :( What else could I have done wrong?<br />
Would it help if I emailed you my entire script so you can see what the prob is?<br />
<br />
Thanks again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">9th February 2005, 01:19</div></div><div class="posttext">It would be better to post it here on the forums, so I'm not the only one who can help you - to be honest, I'm just working from what I see in makensis.nsi. If you click the &quot;Post a Reply&quot; button, you can attach your .NSI file to your post. If need be, it can also be zipped (to save space).<br />
<br />
Of course, if you feel uncomfortable with doing that, go ahead and e-mail me.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">phllp_w</div><div class="date">9th February 2005, 22:34</div></div><div class="posttext">I have attached it to this post.<br />
Just so you know I'm using the default makensis.ini as my .ini file, if makes any difference.<br />
Thanks again for the help. ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">10th February 2005, 07:25</div></div><div class="posttext">While you've correctly put the .ini file as ReserveFile, you don't initialize the InstallOptions plugin in .onInit. This is required to show custom pages (refer to the InstallOptions readme).<br />
<br />
You need to insert this code in your .onInit:<br />
!insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;makensis.ini&quot; <br />
<br />
Replace makensis.ini with the exact file name and path used in your ReserveFile command. I suggest you keep the script and .ini in the same directory on installation, to minimize errors (deep-linking doesn't seem to work).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">phllp_w</div><div class="date">10th February 2005, 15:04</div></div><div class="posttext">I already did all the things you mentioned about the .ini but I forgot about the custom page. <br />
<br />
THANKS a million buddy, now everything works fine. :D</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>