<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Crashing on custom page, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Crashing on custom page NSIS Discussion" />
	
	<title> Crashing on custom page [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Crashing on custom page</div>
<hr />
<div class="pda"><a href="t-144503.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=144503">Crashing on custom page</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd August 2003, 19:03</div></div><div class="posttext">This is very strange, and has just started happening even though I never changed the code that is causing the crash.<br />
<br />
I have a custom IO page, and am reading registry values when the user clicks back or next.<br />
After reading the registry values, I am comparing them to &quot;1&quot;.<br />
Just those two pieces of code seems to crash the whole installer when I click back or next.<br />
<br />
My function is like this:<br />
<br />
Function MainDialog<br />
<br />
## Add header text and colour<br />
!insertmacro HEADER_TEXT &quot;Detected Updates&quot; &quot;Updates that have not yet been installed&quot;<br />
<br />
## Show dialog<br />
pagetop:<br />
 InstallOptions::dialog &quot;$TEMP\ddayupdates\dialog.du&quot;<br />
 Pop $R0<br />
 StrCmp $R0 back settings<br />
 StrCmp $R0 cancel pagecancel<br />
 StrCmp $R0 success pagesuccess<br />
 StrCmp $R0 error pagecancel <br />
<br />
## Open settings dialog<br />
settings:<br />
<br />
ReadRegStr $R0 HKLM &quot;SOFTWARE\D-Day Updater&quot; &quot;SETTINGS&quot;<br />
 ;StrCmp $R0 0 0 pagetop<br />
<br />
Exec &quot;$TEMP\ddayupdates\du_settings.exe&quot;<br />
Goto pagetop<br />
<br />
pagesuccess:<br />
ReadRegStr $R0 HKLM &quot;SOFTWARE\D-Day Updater&quot; &quot;SETTINGS&quot;<br />
 ;StrCmp $R0 0 0 pagetop<br />
<br />
ReadINIStr $R0 &quot;$TEMP\ddayupdates\dialog.du&quot; &quot;Field 3&quot; &quot;Type&quot;<br />
 StrCmp $R0 &quot;Text&quot; 0 pagecancel<br />
<br />
MessageBox MB_OK|MB_ICONEXCLAMATION &quot;There are no new detected \<br />
updates.$\r$\nYou are up-to-date!&quot; IDOK pagetop<br />
<br />
pagecancel:<br />
<br />
WriteRegStr HKLM &quot;SOFTWARE\D-Day Updater&quot; &quot;SETTINGS&quot; &quot;0&quot;<br />
<br />
FunctionEnd<br />
<br />
<br />
If I blank out the strcmp's then it works fine.<br />
Changing strcmp to intcmp also crashes the installer.<br />
<br />
I have even put another IO page before it, and that also crashes on leave (even though it does not have any StrCmp's in it).<br />
<br />
I have placed a message box before the Pop $R0 (after leaving the IO page) and that never shows either.<br />
I seem to remember this happening randomly for me a while ago, but now it happens all the time (even after reboot)<br />
<br />
I am also using Kichik's modified MakeNSIS exe with longer max strlen, but have not downloaded any latest cvs files (so no nsis base files have changed since the installer worked).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd August 2003, 22:57</div></div><div class="posttext">Please try latest CVS verison.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd August 2003, 23:04</div></div><div class="posttext">That's always a problem with me on this installer atm, because my installer requires the 8192 max strlen.<br />
<br />
Is it safe to get the makensis zip containing the modified strlen on cvs change?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd August 2003, 23:10</div></div><div class="posttext">The problem was (hopefully) in InstallOptions.dll not makensis.exe.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ramon18</div><div class="date">4th August 2003, 10:30</div></div><div class="posttext">What happens if you remove this code:<br />
<br />
pagetop:<br />
 InstallOptions::dialog &quot;$TEMP\ddayupdates\dialog.du&quot;<br />
 Pop $R0<br />
 StrCmp $R0 back settings<br />
 StrCmp $R0 cancel pagecancel<br />
 StrCmp $R0 success pagesuccess<br />
 StrCmp $R0 error pagecancel<br />
<br />
?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ramon18</div><div class="date">4th August 2003, 16:14</div></div><div class="posttext">try latest CVS Kichik as fixed a bug</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">4th August 2003, 20:14</div></div><div class="posttext">Ok,<br />
so should I just extract InstallOptions.dll, or is it safe to use modified makensis.exe with all latest cvs files?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th August 2003, 20:18</div></div><div class="posttext">Compare the time your makensis.exe was compiled with the change log and see if anything big was changed since. Better yet, tell me the date and I'll check, just to make sure.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">4th August 2003, 20:29</div></div><div class="posttext">Created and modified on:<br />
23 July 2003, 23:43:24<br />
<br />
I have noticed a modification on NSISdl - need that!<br />
Also, I have seen some nice changes to makensis that are important to my installer.<br />
<br />
Will I be able to have another compile :(<br />
Sorry, I must buy a compiler myself.<br />
Any tips on where I would be able to purchase the product (on the net?)<br />
<br />
Thanks<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th August 2003, 20:34</div></div><div class="posttext">Some important changes, same URL.<br />
<br />
Try .NET Framework, it comes with a C compiler.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">4th August 2003, 20:52</div></div><div class="posttext">Ah, ok thanks.<br />
I have a copy of latest NeoScripter (if any good) which I had to download .NET framework for.<br />
<br />
Thanks for recompile, much appreciated by me and eventually a load of gamers!<br />
<br />
-Stu :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">4th August 2003, 22:16</div></div><div class="posttext">OK, after placing the old code back in (containing StrCmp's) it still crashes.<br />
<br />
After blanking out the InstallOptions::Dialog, and the pop, it works fine.<br />
<br />
I have reverted back to IfFileExists and all is ok.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th August 2003, 22:20</div></div><div class="posttext">You did update InstallOptions.dll, right?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">4th August 2003, 22:29</div></div><div class="posttext">Yes.<br />
I extracted whole CVS zip, and makensis<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th August 2003, 22:42</div></div><div class="posttext">What does IfFileExists have to do with it? Does it replace the entire custom page? It is just the InstallOptions::dialog call that is causing this right? What's the exact text that shows in the error message?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">4th August 2003, 23:05</div></div><div class="posttext">I'm on WinXP.<br />
Before, my settings dialog would write &quot;1&quot; to the registry to show that it was running.<br />
On my IO page, I would check if the registry value was &quot;1&quot; and of so, then don't let user continue to next page.<br />
Because this causes crashes, I instead create a temp file to show that the settings dialog is running, and if that file exists then don't go to next page.<br />
<br />
The InstallOptions call is indeed causing the crash.<br />
Here is the details:<br />
AppName: ddayupdater.exe	 AppVer: 1.0.1.0	 ModName: installoptions.dll<br />
ModVer: 0.0.0.0	 Offset: 00001af6<br />
<br />
Strangely, having the StrCmp's and the IfFileExists in there stops the crashing!<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th August 2003, 23:30</div></div><div class="posttext">Can you attach a zipped example (script, ini, compiled example)?<br />
<br />
The error message makes no sense to me... If somehow a DLL can be loaded at that address or XP trims the base address it means it crashes on test eax, eax. It makes no sense. I'm sorry to doubt, but can you please make sure the InstallOptions.dll you have is versioned 1.64?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th August 2003, 00:08</div></div><div class="posttext">Where can I find the InstallOptions version?<br />
Looking at InstallerOptions, it says version 2.0.<br />
<br />
I shall zip up all involved files tomorrow (comes to about 1.5mb).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th August 2003, 00:12</div></div><div class="posttext">If you have TortoiseCVS just go the properties of InstallOptions.dll. If not, open Plugins\CVS\Entries and look at the line where InstallOptions.dll is listed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th August 2003, 00:16</div></div><div class="posttext">Yes, it's 1.64.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th August 2003, 08:03</div></div><div class="posttext">You can get it here:<br />
http://myweb.tiscali.co.uk/afrowuk/du_files.zip<br />
<br />
Search ddayupdater.nsi for &quot;Function MainDialog&quot; to get there.<br />
There are some notes underneath the function.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th August 2003, 15:59</div></div><div class="posttext">I was only able to reproduce this exact error when I gave IO a non existent INI. I have made it so IO will return an error instead of crashing in this case. You should check your script to make sure it doesn't delete the INI file ahead of time or something like that, unless it still crashes with 1.65. If it does, I need full error message and a small example that depends on nothing else.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>