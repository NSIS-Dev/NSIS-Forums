<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" nsis script, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  nsis script NSIS Discussion" />
	
	<title> nsis script [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  nsis script</div>
<hr />
<div class="pda"><a href="t-330943.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=330943">nsis script</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">johnpaullreddy17</div><div class="date">26th May 2011, 07:15</div></div><div class="posttext">hi <br />
i am new using script<br />
can u please solve my problem. <br />
actually i want to add the fetcher.<br />
if user click the second time installer file i want to display the message  &quot;already installer is there if u click ok means it will reinstall and install or click cancel.&quot;<br />
<br />
some wt i can get the message success fully <br />
but click ok means i cant able to call the uninstall <br />
how to call the uninstall plz tell me<br />
<br />
this is my function....<br />
 Function HandlePellucidPriorInstall<br />
  ## Test for existence using the UninstallString<br />
  ;ReadRegStr $R0 HKCU \<br />
  &quot;Software\Pellucid\Common\xxx&quot; &quot;&quot;<br />
   ReadRegStr $R0 HKLM \<br />
  &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot; \<br />
  &quot;UninstallString&quot;<br />
   StrCmp $R0 &quot;&quot; noPriorInstall<br />
<br />
  ## Get file version<br />
  ;Making use of the Uninstall path to build the path to the exe<br />
  StrCpy $R1 $R0 -10<br />
  GetDllVersion &quot;$R0\xxx.exe&quot; $R2 $R3<br />
  ;MessageBox MB_OK|MB_ICONSTOP $R2<br />
  ;MessageBox MB_OK|MB_ICONSTOP $R3<br />
  IntOp $R4 $R2 / 0x00010000<br />
  IntOp $R5 $R2 &amp; 0x0000FFFF<br />
  IntOp $R6 $R3 / 0x00010000<br />
  IntOp $R7 $R3 &amp; 0x0000FFFF<br />
<br />
  IntCmp ${MAJOR_VERSION} $R4 +1 installedVersionHigher installedVersionLower<br />
  IntCmp ${MINOR_VERSION} $R5 +1 installedVersionHigher installedVersionLower<br />
  IntCmp ${BUILD} $R6 +1 installedVersionHigher installedVersionLower<br />
  IntCmp ${REVISION} $R7 sameVersionInstalled installedVersionHigher installedVersionLower<br />
<br />
  installedVersionHigher:<br />
  MessageBox MB_OK|MB_ICONSTOP \<br />
  &quot;The Installer has detected that a NEWER version of ${PRODUCT_NAME} is already installed. $\n$\nThe installer will skip installation of ${PRODUCT_NAME}.&quot; /SD IDOK<br />
  strcpy $checkViewerPriorInstallationVersion &quot;cancel&quot;<br />
<br />
  return<br />
<br />
  sameVersionInstalled:<br />
  MessageBox MB_OK|MB_ICONSTOP \<br />
  &quot;The Installer has detected that the SAME version of ${PRODUCT_NAME} is already installed. $\n$\nThe installer will skip installation of ${PRODUCT_NAME}.&quot; /SD IDOK<br />
  strcpy $checkViewerPriorInstallationVersion &quot;cancel&quot;<br />
<br />
  return<br />
<br />
  installedVersionLower:<br />
  MessageBox MB_OKCANCEL|MB_ICONEXCLAMATION \<br />
  &quot;Installer has detected that an older version of ${PRODUCT_NAME} . $\n$\nClick `OK` to proceed with removing the older version and replace with new version or `Cancel` to cancel this upgrade. $\n$\n Warning ! This operation will overwrite the Study database. You will need to import your old studies again.&quot; /SD IDOK   \<br />
  IDOK beginUninstall<br />
  ;strcpy  $checkViewerPriorInstallationVersion &quot;cancel&quot;<br />
<br />
 <br />
  <br />
 !insertmacro CheckAppRunning `xxx.exe`<br />
  !insertmacro WControlPanelItem_Remove1 `yyyy`<br />
    ; Delete TaskManager Related Files<br />
   ; call un.onInit<br />
   ; !insertmacro un.DeleteTaskManagerFiles<br />
 return<br />
  ;Run the uninstaller<br />
  beginUninstall:<br />
  strcpy $checkPriorInstallationVersion &quot;older&quot;<br />
  return<br />
<br />
  noPriorInstall:<br />
  strcpy $checkPriorInstallationVersion &quot;freshInstall&quot;<br />
  Return<br />
<br />
FunctionEnd<br />
 <br />
<br />
i am calling hear<br />
<br />
var ALREADY_INSTALLED<br />
Function .onVerifyInstDir<br />
<br />
IfFileExists &quot;$INSTDIR\xxx.exe&quot; 0 new_installation <br />
   StrCpy $ALREADY_INSTALLED 1<br />
   Call   HandlePriorInstall<br />
 new_installation:<br />
 FunctionEnd<br />
<br />
<br />
<br />
<br />
 Function un.onUninstSuccess<br />
  HideWindow<br />
  MessageBox MB_ICONINFORMATION|MB_OK &quot;$(^Name) was successfully removed from your computer.&quot;<br />
FunctionEnd<br />
<br />
Function un.onInit<br />
  MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 &quot;Are you sure you want to completely remove $(^Name) and all of its components?&quot; IDYES +2<br />
  Abort<br />
FunctionEnd<br />
!macro WControlPanelItem_Remove1 `Name` 'InstallDirectory'<br />
  DeleteRegKey HKLM `SOFTWARE\Microsoft\Windows\CurrentVersion\UnInstall\${Name}` <br />
  !macroend<br />
!insertmacro  TaskRemoveService &quot;xxxService.exe&quot; &quot;xxxService&quot;<br />
!insertmacro Removeyyy &quot;yyyService.exe&quot; &quot;yyyService&quot;<br />
<br />
<br />
Section &quot;Uninstall&quot;<br />
   ;!insertmacro CheckAppRunning `jjj.exe`<br />
   !insertmacro CheckAppRunning `mmm.exe`<br />
   !insertmacro WControlPanelItem_Remove1 `mmm``mmm`<br />
<br />
   ; Delete TaskManager Related Files<br />
   ReadRegStr $TaskMgrInstallPath HKCU &quot;Software\Pellucid\vvv\&quot; &quot;&quot;<br />
   DetailPrint &quot;$TaskMgrInstallPath - Path&quot;<br />
<br />
<br />
   ReadRegStr $CommonPath HKCU &quot;Software\Pellucid\Common\ConfigPath\&quot; &quot;Path&quot;<br />
   DetailPrint &quot;$CommonPath - Common  Path&quot;<br />
   ;Remove Service<br />
<br />
<br />
     Call un.RemoveService<br />
     Call un.ddd<br />
<br />
<br />
<br />
     !insertmacro un.DeleteCommonFiles<br />
     !insertmacro un.Deleteddd<br />
     !insertmacro un.Deleteyyy<br />
<br />
<br />
   ; Delete Reg Key<br />
   DeleteRegKey  HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot;<br />
   DeleteRegKey ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot;<br />
   DeleteRegKey /ifempty HKCU &quot;Software\Modern UI Test&quot;<br />
   DeleteRegKey HKCU &quot;Software\Pellucid\yyy&quot;<br />
   DeleteRegKey HKLM &quot;${PRODUCT_DIR_REGKEY}&quot;<br />
<br />
   DeleteRegKey HKCR &quot;rdd\shell\open\command&quot;<br />
   DeleteRegKey HKCR &quot;rdd\shell\open&quot;<br />
   DeleteRegKey HKCR &quot;rdd\shell&quot;<br />
   DeleteRegKey HKCR &quot;rdd\DefaultIcon&quot;<br />
   DeleteRegKey HKCR &quot;rdd&quot;<br />
<br />
   SetAutoClose true<br />
<br />
<br />
SectionEnd<br />
<br />
<br />
<br />
i think i attach every thing so plz tell me function lo click ok means uninstall it will do<br />
cancel means simply abort<br />
thanking u.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>