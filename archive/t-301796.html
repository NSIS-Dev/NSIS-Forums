<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS Unicode 2.42 does not work with new NSIS API lib, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS Unicode 2.42 does not work with new NSIS API lib NSIS Discussion" />
	
	<title> NSIS Unicode 2.42 does not work with new NSIS API lib [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS Unicode 2.42 does not work with new NSIS API lib</div>
<hr />
<div class="pda"><a href="t-301796.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=301796">NSIS Unicode 2.42 does not work with new NSIS API lib</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">7th January 2009, 15:27</div></div><div class="posttext">Hello jimpark,<br />
<br />
one of the advantages of NSIS 2.42 is that the /NOUNLOAD is no longer needed for plugins.<br />
But I noticed that this does not seem to work with the Unicode version.<br />
<br />
For example the LogEx plugin, which has a normal and a Unicode version.<br />
When the normal NSIS version is used it runs OK, but when the Unicode version is used, only the first command is executed (which was the case with previous NSIS versions).<br />
When I put back the /NOUNLOAD option for every command, the Unicode script runs OK.<br />
<br />
Can you have a look at this?<br />
<br />
Best regards,<br />
JP</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">7th January 2009, 19:21</div></div><div class="posttext">Hey JP,<br />
<br />
I'm looking at the source and I noticed only one pluginapi.lib.  Unfortunately, we need to have two different ones.  One for ANSI and another for Unicode.  The stacks are actually different -- one being buffers of wide characters and the other being buffers of chars.  So I think the problem is probably due to the fact that it's linking to the wrong lib.  For the Unicode one, you'll need to copy the Unicode NSIS 2.42's pluginapi.lib instead.<br />
<br />
And yes, this does complicate things for the plugin developers when they want to support both the Unicode NSIS and the ANSI.  Put the libs in two different directories and create two different targets for your project, one for ANSI and one for Unicode.  Then each of the projects can go out and link to the right lib.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">7th January 2009, 19:28</div></div><div class="posttext">Also, I think I forgot to include the nsis_tchar.h file in the install also.  So that will be fixed in 2.42.1.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">7th January 2009, 21:13</div></div><div class="posttext">Hi jimpark,<br />
<br />
thanks for looking into this.<br />
Linking the Unicode Plugin with the Unicode pluginapi.lib (renamed it to pluginapiU.lib for convenience) together with your intermediate Unicode NSIS version made it work.<br />
<br />
When do you think it will be released?<br />
<br />
Best regards,<br />
Jan Pieter</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">7th January 2009, 21:41</div></div><div class="posttext">Well, I've asked a few others who had problems with the new release to see if this release fixes all their issues.  I've fixed all the issues I know about so far.  I've also added a few things to help out with writing scripts that will work for both ANSI and Unicode.<br />
<br />
For example, one of the things I've added to the System plugin is System::StrAlloc N which allocates a string buffer for N number of characters rather than just bytes.  So System::StrAlloc 1024 will allocate 1024 bytes for ANSI NSIS while it will allocate 2048 bytes for Unicode NSIS.  Another thing I've added is a predefined macro NSIS_CHAR_SIZE.  This will be 1 for ANSI and 2 for Unicode.  So if you are doing math and you want to know how many bytes you need to move forward for the string, you can use ${NSIS_CHAR_SIZE}.  And there's of course ${NSIS_UNICODE} which is only defined in the Unicode NSIS.  But that's been around for a while.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>