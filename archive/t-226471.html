<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" some questions, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  some questions NSIS Discussion" />
	
	<title> some questions [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  some questions</div>
<hr />
<div class="pda"><a href="t-226471.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=226471">some questions</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">xxx9527</div><div class="date">20th September 2005, 09:54</div></div><div class="posttext">1.about the register codes<br />
in installation section, i use lots of WriteRegValue, the problem is how can i write the unstallation section.<br />
<br />
WriteRegValue needs 4 parameters, but DeleteRegValue only needs 3 parameters, so its not easy to edit just by replace strings.<br />
<br />
2.a complile error, and i dont know how to correct it<br />
<br />
;Replace strings in files<br />
;funtion from WIKI<br />
Function AdvReplaceInFile<br />
Exch $0 ;file to replace in<br />
Exch<br />
Exch $1 ;number to replace after<br />
Exch<br />
Exch 2<br />
Exch $2 ;replace and onwards<br />
Exch 2<br />
Exch 3<br />
Exch $3 ;replace with<br />
Exch 3<br />
Exch 4<br />
Exch $4 ;to replace<br />
Exch 4<br />
Push $5 ;minus count<br />
Push $6 ;universal<br />
Push $7 ;end string<br />
Push $8 ;left string<br />
Push $9 ;right string<br />
Push $R0 ;file1<br />
Push $R1 ;file2<br />
Push $R2 ;read<br />
Push $R3 ;universal<br />
Push $R4 ;count (onwards)<br />
Push $R5 ;count (after)<br />
Push $R6 ;temp file name<br />
<br />
  GetTempFileName $R6<br />
  FileOpen $R1 $0 r ;file to search in<br />
  FileOpen $R0 $R6 w ;temp file<br />
   StrLen $R3 $4<br />
   StrCpy $R4 -1<br />
   StrCpy $R5 -1<br />
<br />
loop_read:<br />
 ClearErrors<br />
 FileRead $R1 $R2 ;read line<br />
 IfErrors exit<br />
<br />
   StrCpy $5 0<br />
   StrCpy $7 $R2<br />
<br />
loop_filter:<br />
   IntOp $5 $5 - 1<br />
   StrCpy $6 $7 $R3 $5 ;search<br />
   StrCmp $6 &quot;&quot; file_write2<br />
   StrCmp $6 $4 0 loop_filter<br />
<br />
StrCpy $8 $7 $5 ;left part<br />
IntOp $6 $5 + $R3<br />
IntCmp $6 0 is0 not0<br />
is0:<br />
StrCpy $9 &quot;&quot;<br />
Goto done<br />
not0:<br />
StrCpy $9 $7 &quot;&quot; $6 ;right part<br />
done:<br />
StrCpy $7 $8$3$9 ;re-join<br />
<br />
IntOp $R4 $R4 + 1<br />
StrCmp $2 all file_write1<br />
StrCmp $R4 $2 0 file_write2<br />
IntOp $R4 $R4 - 1<br />
<br />
IntOp $R5 $R5 + 1<br />
StrCmp $1 all file_write1<br />
StrCmp $R5 $1 0 file_write1<br />
IntOp $R5 $R5 - 1<br />
Goto file_write2<br />
<br />
file_write1:<br />
 FileWrite $R0 $7 ;write modified line<br />
Goto loop_read<br />
<br />
file_write2:<br />
 FileWrite $R0 $R2 ;write unmodified line<br />
Goto loop_read<br />
<br />
exit:<br />
  FileClose $R0<br />
  FileClose $R1<br />
<br />
   SetDetailsPrint none<br />
  Delete $0<br />
  Rename $R6 $0<br />
  Delete $R6<br />
   SetDetailsPrint both<br />
<br />
Pop $R6<br />
Pop $R5<br />
Pop $R4<br />
Pop $R3<br />
Pop $R2<br />
Pop $R1<br />
Pop $R0<br />
Pop $9<br />
Pop $8<br />
Pop $7<br />
Pop $6<br />
Pop $5<br />
Pop $4<br />
Pop $3<br />
Pop $2<br />
Pop $1<br />
Pop $0<br />
FunctionEnd<br />
<br />
!macro ReplaceStr str1 str2 filename<br />
  DetailPrint &quot;Replacing ${filename}&quot;<br />
  Push &quot;${str1}&quot; ;text to be replaced<br />
	Push &quot;${str2}&quot; ;replace with<br />
	Push all ;replace all occurrences<br />
	Push all ;replace all occurrences<br />
	Push &quot;${filename}&quot; ;file to replace in<br />
 		Call AdvReplaceInFile<br />
!macroend<br />
 <br />
<br />
when i use like this:<br />
!insertmacro ReplaceStr 'HKCU,&quot;Keyboard Layout\Preload&quot;,&quot;4&quot;,0x00000002,&quot;E0030804&quot;' &quot;&quot; $INSTDIR\i386\hivedef.inf<br />
<br />
it says &quot;ReplaceStr&quot; requires 3 parameters, passed 4!<br />
maybe its because the string 'HKCU,&quot;Keyboard Layout\Preload&quot;,&quot;4&quot;,0x00000002,&quot;E0030804&quot;' contains quotation marks(when i use !insertmacro ReplaceStr &quot;abc&quot; &quot;&quot; $INSTDIR\i386\hivedef.inf, it works)<br />
<br />
so how do i correct it? Many thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th October 2005, 14:47</div></div><div class="posttext">There's no need to delete each value separately. You can delete the entire uninstall key with DeleteRegKey. The code seems fine. Can you attach a complete example? The error must originate from another part of the code. It might be the first push line in the macro. Try replacing it with:Push `${str1}`</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>