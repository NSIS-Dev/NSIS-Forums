<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Determine which vista edition is installed, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Determine which vista edition is installed NSIS Discussion" />
	
	<title> Determine which vista edition is installed [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Determine which vista edition is installed</div>
<hr />
<div class="pda"><a href="t-278537.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=278537">Determine which vista edition is installed</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">9th October 2007, 18:43</div></div><div class="posttext">Is it possible to determine which edition of vista has been installed  using the GetVersion library or similar?<br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th October 2007, 21:45</div></div><div class="posttext">call GetProductInfo with the system plugin<br />
<br />
or even better, if you have a real need for some specific api or something you can check if the exported api exists by calling GetProcAddress on the dll with the system plugin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">9th October 2007, 22:15</div></div><div class="posttext">Pardon my ignorance but how do I that?  <br />
<br />
I assume something like<br />
<br />
System::Call 'kernel32::GetProductInfo...'<br />
<br />
but now i am lost...<br />
<br />
Essentially I like to allow Windows 2000, XP Pro 32-bit, Windows Server 2003, and Windows Vista Business, Vista Enterprise, and Vista Ultimate only.  <br />
<br />
Mainly I am reworking a function (which I previously asked help on...)<br />
<br />
<br />
Function .onInit<br />
<br />
<br />
;; denied<br />
GetVersion::WindowsName<br />
Pop $R0<br />
<br />
${If} $R0 == &quot;XP&quot;<br />
  Goto xp<br />
${ElseIf} $R0 == &quot;2000&quot;<br />
  Goto go_away<br />
${ElseIf} $R0 == &quot;Server 2003&quot;<br />
  Goto go_away<br />
${Elseif} $R0 == &quot;Server 2003 R2&quot;<br />
  Goto go_away<br />
${Elseif} $R0 == &quot;Vista&quot;   ; no idea if this works<br />
  Goto go_away<br />
${Else}<br />
  Goto error<br />
${EndIf}<br />
<br />
xp:<br />
   GetVersion::WindowsType<br />
   Pop $R0<br />
   GetVersion::WindowsPlatformArchitecture<br />
;  Pop $R1<br />
   StrCmp $R0 &quot;Home Edition&quot; xp_home_error go_away<br />
;   StrCmp $R1 &quot;64&quot; xp_64 go_away<br />
<br />
xp_home_error:<br />
    MessageBox MB_OK|MB_ICONSTOP &quot;Windows XP Home Edition is not supported!&quot; IDOK<br />
    Quit<br />
    <br />
error:<br />
    MessageBox MB_OK|MB_ICONSTOP &quot;Windows $R0 is not supported!&quot; IDOK<br />
    Quit<br />
<br />
<br />
go_away:<br />
<br />
; ... rest of code</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">9th October 2007, 22:51</div></div><div class="posttext">The GetVersion plug-in has basic Vista detection. I have plans to implement GetProductInfo when I have time.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th October 2007, 23:28</div></div><div class="posttext">Untested.System::Call kernel32::GetProductInfo(i6,i0,i0,i0,*i.r0)<br />
# $0 is 5 for Home Basic NSee MSDN  (http://msdn2.microsoft.com/en-us/library/ms724358.aspx) for all possible return values.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">10th October 2007, 16:06</div></div><div class="posttext">Okay.  Anyway to incorporate this into the main winver libraries?<br />
<br />
http://msdn2.microsoft.com/en-us/library/ms724429.aspx<br />
<br />
...<br />
<br />
Mainly, does this return hex or the dwtype value?<br />
So that I can put if type = say 0x00000005, then throw error/abort.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th October 2007, 19:53</div></div><div class="posttext">It returns a number. No need to compare to 0x000xxxx. You can take a look in WinVer.nsh and add this as another operator for LogicLib.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">10th October 2007, 20:44</div></div><div class="posttext">So for 0x0000001A i can just see if $0 is 26 in this case?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th October 2007, 21:01</div></div><div class="posttext">Yes. You can also compare it with IntCmp or LogicLib's integer comparison and use 0x1A.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Spilly</div><div class="date">19th October 2007, 19:23</div></div><div class="posttext">Ok, so I am trying to differentiate between Vista32 and Vista64. I've included this system call in .onInit:<br />
<br />
System::Call kernel32::GetProductInfo(i6,i0,i0,i0,*i.r0)<br />
MessageBox MB_OK &quot;Windows Version: $0&quot;<br />
                 or<br />
MessageBox MB_OK &quot;Windows Version: $R0&quot;<br />
<br />
<br />
but the message Box prints:<br />
<br />
&quot;Windows Version: 0&quot;<br />
       or<br />
&quot;Windows Version: &quot;<br />
<br />
<br />
Am I missing something?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th October 2007, 19:31</div></div><div class="posttext">0 means PRODUCT_UNDEFINED, which is weird. Try adding i.r1 in the end and check out the error code.<br />
<br />
But if all you want is to determine if whether or not you're running on x64, all you need is x64.nsh and then ${If} ${RunningX64}.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th October 2007, 11:04</div></div><div class="posttext">GetVersion now uses GetProductInfo on Vista.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">EmL</div><div class="date">16th April 2008, 08:48</div></div><div class="posttext">Hi,<br />
<br />
i tried with GetProductInfo, but the Return Value is -1412584499 ??? In MSDN you can read, that it also seems that the return value is different if Vista is activated or not.<br />
<br />
I tried the GetVersion plugin but it shows me not the edition, but in the wiki plugins section the date of the GetVersion.dll is 24-07-2007 (so it seems to be older than Stu's posting.<br />
<br />
I dont know how to determine the different Vista Editions ... May be is there a way over WMI with the Win32_OperatingSystem Class over the OperatingSystemSKU Value (http://msdn2.microsoft.com/en-us/library/aa394239(VS.85).aspx)? <br />
<br />
Is it possible ... and does anybody how to call this WMI Function (or another working way to determine the edition)?<br />
<br />
Thx</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">7th June 2008, 17:07</div></div><div class="posttext">Originally posted by Afrow UK <br />
GetVersion now uses GetProductInfo on Vista.<br />
<br />
Stu  I downloaded http://nsis.sourceforge.net/File:GetVersion.zip today but it only identifies Vista Home Basic as &quot;Vista&quot;.<br />
<br />
The ReadMe.txt file inside the zip file says <br />
 GetVersion.dll v0.8 (5kB) by Afrow UK<br />
<br />
  Last build: 24th July 2007<br />
so the wiki appears to have an out-of-date version of the GetVersion plugin.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th June 2008, 19:14</div></div><div class="posttext">Not quite sure where v0.9 went but it's on there now.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">7th June 2008, 20:12</div></div><div class="posttext">Thanks for uploading the new version - it works OK on my Vista system.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>