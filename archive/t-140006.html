<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Using System.dll to call Win32 APIs, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Using System.dll to call Win32 APIs NSIS Discussion" />
	
	<title> Using System.dll to call Win32 APIs [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Using System.dll to call Win32 APIs</div>
<hr />
<div class="pda"><a href="t-140006.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=140006">Using System.dll to call Win32 APIs</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">tirhoads</div><div class="date">24th June 2003, 22:06</div></div><div class="posttext">I was looking for a simple installer package the other day, and found this one. It seems to be very straight forward to use. My only problem though so far is the following:<br />
<br />
I have written a program to be run as a service and would like to install this service using NSIS scripting. The commands should be as follows:<br />
<br />
System::Call 'advapi32::OpenSCManagerA(t, t, l) l(Null, Null, 2).r0'<br />
System::Call 'advapi32::CreateServiceA(l, t, t, l, l, l, l, t, t, t, t, t, t) l(r0, &quot;ServiceName&quot;, &quot;Service Description&quot;, 983551, 16, 2, 1, &quot;ServiceLocation.exe&quot;, Null, Null, Null, &quot;LocalSystem&quot;, Null).r1'<br />
<br />
The first calls returns a handle from the Service Control Managage Database and passes that handle into the first variable in the next call which creates the service. The first call seeems to be working correctly, but the second does not, and I think it is because the handle being returned from the first call is getting changed into a string variable which needs to remain a long to be passed into the second call.<br />
<br />
I know that I could create my own extension dll to do this or I could do the install in my program, but if I could get this to work it would be very simply and elegant.<br />
<br />
If anyone could help, I would greatly appreciate it.<br />
<br />
-tim</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">24th June 2003, 22:53</div></div><div class="posttext">Usually services can install themself, I think that's the easiest solution.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">25th June 2003, 01:26</div></div><div class="posttext">1. t &quot;Null&quot; will pass pointer to &quot;Null&quot; string to API (not the 0x0 :)<br />
2. dword / int32 etc -&gt; use i, not the l parameter type (l stands for long, or int64).<br />
<br />
Try this code, please (I've checked only the correctness of functions specification, not values):<br />
<br />
System::Call 'advapi32::OpenSCManagerA(i 0, i 0, i 2) i .r0' <br />
System::Call 'advapi32::CreateServiceA(i r0, t &quot;ServiceName&quot;, t &quot;Service Description&quot;, i 983551, i 16, i 2, i 1, t &quot;ServiceLocation.exe&quot;, i 0, i 0, i 0, t &quot;LocalSystem&quot;, i 0) i .r1'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tirhoads</div><div class="date">30th June 2003, 15:50</div></div><div class="posttext">Thank you brainsucker, that worked exactly as I wanted it to.<br />
<br />
-tim</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tirhoads</div><div class="date">2nd July 2003, 19:31</div></div><div class="posttext">If anyone is interested I have now built a couple of functions using the System plugin that do the following:<br />
<br />
Install a service<br />
Start a service<br />
UnInstall a service<br />
<br />
-tim</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th July 2003, 13:28</div></div><div class="posttext">Create a page for them at The Archive, I sure it will be found useful.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>