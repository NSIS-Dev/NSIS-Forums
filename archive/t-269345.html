<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Dialog refresh/redraw problem with UMUI, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Dialog refresh/redraw problem with UMUI NSIS Discussion" />
	
	<title> Dialog refresh/redraw problem with UMUI [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Dialog refresh/redraw problem with UMUI</div>
<hr />
<div class="pda"><a href="t-269345.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=269345">Dialog refresh/redraw problem with UMUI</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">thek</div><div class="date">11th April 2007, 12:24</div></div><div class="posttext">I'm using the UMUI for the Installer<br />
<br />
But sometimes I have a problem in the section selection page <br />
It looks like the TreeContorl in this Page didn't get refreshed properly <br />
See Screenshot:<br />
http://www.thek.org/tikiwiki/show_image.php?id=193 <br />
<br />
somebody knows a quick hack to solve this problem?<br />
<br />
Simple moving the Dialog helps (because it forces the Dialog to redraw, is there some way to do this automaticly?<br />
<br />
<br />
regards<br />
nobs</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">11th April 2007, 15:11</div></div><div class="posttext">Did you contact to the developer of UMUI?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">thek</div><div class="date">11th April 2007, 15:14</div></div><div class="posttext">Indirectly: Yes<br />
<br />
Normaly he is reading this forum too!<br />
;-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">11th April 2007, 15:59</div></div><div class="posttext">Hi nobs, all.<br />
<br />
I get this once and awhile too with UMUI.<br />
<br />
I normally see it on the &quot;Files&quot; progress bar<br />
while files are being copied/installed.<br />
<br />
If I &quot;hide&quot; the window under Windows, and bring it back up, it is &quot;refreshed&quot; correctly, so I know it has something to do with UMUI not capturing its redraw events correctly.<br />
<br />
Another annoyance I have found, I wonder if you see it too...<br />
When I move from Page to Page with UMUI, there is a &quot;blink&quot; refresh problem.<br />
<br />
You can see the &quot;box&quot; where UMUI is drawn in blue, but it turns to &quot;grey&quot; box, and then moves to the next page.<br />
This &quot;flickering&quot; is very annoying.<br />
<br />
I have found a workaround for this problem in my own scripts, by having a &quot;post&quot; function for each page, and calling this routine:<br />
<br />
/* This is needed to stop &quot;flickering&quot; when using UMUI */<br />
Function RefreshPageKludge<br />
!ifdef UMUI_INCLUDED<br />
    /* This is needed to stop &quot;flickering&quot; when using UMUI */<br />
    SetCtlColors $HWNDPARENT ${MUI_BGCOLOR} ${MUI_BGCOLOR}<br />
!endif<br />
FunctionEnd<br />
<br />
Kinda lame, but it works.<br />
<br />
<br />
I was kinda letting these problems &quot;slide&quot;, mainly because I am hoping SuperPat will release his &quot;beta2&quot; of UMUI, which might already have these problems fixed.<br />
<br />
Scott</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SuperPat</div><div class="date">14th April 2007, 11:55</div></div><div class="posttext">Hello,<br />
<br />
Originally posted by Sheik <br />
I normally see it on the &quot;Files&quot; progress bar<br />
while files are being copied/installed.<br />
<br />
Another annoyance I have found, I wonder if you see it too...<br />
When I move from Page to Page with UMUI, there is a &quot;blink&quot; refresh problem.<br />
<br />
You can see the &quot;box&quot; where UMUI is drawn in blue, but it turns to &quot;grey&quot; box, and then moves to the next page.<br />
This &quot;flickering&quot; is very annoying.<br />
[/B]<br />
Somtimes, With beta 2, I have these problems...<br />
<br />
I will test the workaround of Sheik in the beta 2 shortly.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">15th April 2007, 01:25</div></div><div class="posttext">Hi SuperPat.<br />
<br />
My &quot;fix&quot; only addresses the &quot;flickering&quot; problem when switching pages.<br />
<br />
It does NOT fix the problem where UMUI doesn't refresh the page correctly, either right away, or while things are being displayed, say while the &quot;Install Files&quot; page is up and running.<br />
<br />
Scott</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">20th April 2007, 19:25</div></div><div class="posttext">Hi all,<br />
<br />
Just an update on this.<br />
<br />
I found a &quot;sledgehammer&quot; approach to fixing this problem,<br />
at least for the ProgressBar on the InstPage section.<br />
<br />
Here is what I did.<br />
<br />
In my first Install files &quot;section&quot;<br />
I do the following:<br />
<br />
    FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
    GetDlgItem $8 $0 1004<br />
    System::Call &quot;user32::InvalidateRect(i,i,i)i (r8, 0, 1).r4&quot;<br />
<br />
This forces a complete redraw of the ProgressBar.<br />
<br />
It should be noted that the above does NOT fix the problem, if I add this code to a MUI_PAGE_CUSTOMFUNCTION_SHOW function for INSTFILES page.<br />
<br />
It *has* to be used in your &quot;files&quot; section stuff to have it fix the problem.<br />
<br />
My best guess? is that there is some sort of race going on, where the problem can only be fixed AFTER the &quot;SHOW&quot; function gets called, but before any files actually start to get installed.<br />
<br />
Just as an added &quot;hint&quot;, I am surprised you see the problem with the components page, I see there is this &quot;hack&quot; already in the C++ for the components page/tree.<br />
<br />
  // workaround for bug #1397031<br />
  &lt;snip&gt;<br />
  InvalidateRect(hwTree, NULL, TRUE);<br />
<br />
(Which is where I really got the idea from) =)<br />
<br />
Scott</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrDan</div><div class="date">9th May 2007, 10:59</div></div><div class="posttext">If not, I will have to use the MUI rather than the UMUI.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">thek</div><div class="date">2nd July 2007, 14:03</div></div><div class="posttext">Hello guys<br />
<br />
is there a way to get the on_click or a on_notify message from the Userinterface?<br />
<br />
I tried to fix the redraw problem in the UMUI componentspage<br />
but the only thing I was able to achieve was adding this lines .onmousemove Function<br />
!insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br />
    push $1<br />
    push $4<br />
    push $8<br />
    FindWindow $1 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
    GetDlgItem $8 $1 1032<br />
    System::Call &quot;user32::InvalidateRect(i,i,i)i (r8, 0, 1).r4&quot;<br />
#    System::Call &quot;user32::SetWindowPos(i,i,i,i,i,i,i)i (r8, 0, 0, 0, 0, 0, 67).r4&quot;<br />
    pop $8<br />
    pop $4<br />
    pop $1<br />
    !insertmacro MUI_DESCRIPTION_TEXT ${SECGRP0000} $(DESC_SECTIONGRP_00)<br />
# other insertmacro blablabla<br />
    !insertmacro MUI_DESCRIPTION_TEXT ${SEC0016}    $(DESC_SECTION_16)<br />
!insertmacro MUI_FUNCTION_DESCRIPTION_END<br />
<br />
<br />
But the update problem still exists (it only redraws after moving the mouse)<br />
also it doesn't update the Scrollbar of the window.<br />
<br />
Can somebody give me hint?<br />
regards Norbert<br />
<br />
@SuperPat:<br />
is UMUI already dead, or you are still developing it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">2nd July 2007, 16:30</div></div><div class="posttext">I haven't heard from SuperPat in awhile...<br />
Not sure if he is still working on UMUI or not.<br />
<br />
I am hoping if he isn't, that he at least puts out what he has of the &quot;beta 2&quot; of UMUI.<br />
<br />
Even if its broken in places, I like some of the new things he has done, and could help clean up/fix them.<br />
<br />
I don't want to invest any time in &quot;fixing&quot; the existing UMUI when I know he has a new version out there that will replace the existing one.<br />
<br />
Scott</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SuperPat</div><div class="date">6th July 2007, 11:55</div></div><div class="posttext">I always work on it in my free time but It remain unfinished.<br />
<br />
This is the latest TODO List:<br />
- Maintenance Page: coding of the function of Modification of an existing installation. <br />
- Serial Number page: support of the safeguard of the parameters in the register, addition of the TOLOWER, TOUPPER and NUMBERS flags, To pass from an input to another during striking on the keyboard of the serial. <br />
- Rewriting one of the macros managing UMUI Flags (They allow, amongst other things, to know which options were chooses in various pages...)<br />
- Second reading and cleaning of all the code <br />
- Complete the documentation <br />
Corrections for InstallOptionEx: <br />
* Transparent Icons are not transparent in the page...<br />
* Button are not drawn if I use my SkinnedButton plugin... whereas that work very well with InstallOptions.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>