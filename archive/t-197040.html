<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Install Different Files for Different OS, Possible?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Install Different Files for Different OS, Possible? NSIS Discussion" />
	
	<title> Install Different Files for Different OS, Possible? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Install Different Files for Different OS, Possible?</div>
<hr />
<div class="pda"><a href="t-197040.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=197040">Install Different Files for Different OS, Possible?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Anewguytoday</div><div class="date">22nd October 2004, 06:11</div></div><div class="posttext">Question, I have drivers to install but want a different *.dll to install for a different OS or problems may occur.   Basically, I have the code below, then copy files to the users computer but I only want to copy the XP driver files if the user has XP, the Win98SE files if the user has Win98SE, etc. Any help?<br />
<br />
I have this;<br />
;--------------------------------------<br />
; GetWindowsVersion<br />
 ;<br />
 ; Based on Yazno's function, http://yazno.***********/powerpimpit/<br />
 ; Updated by Joost Verburg<br />
 ;<br />
 ; Returns on top of stack<br />
 ;<br />
 ; Windows Version (95, 98, ME, NT x.x, 2000, XP, 2003)<br />
 ; or<br />
 ; '' (Unknown Windows Version)<br />
 ;<br />
 ; Usage:<br />
 ;   Call GetWindowsVersion<br />
 ;   Pop $R0<br />
 ;   ; at this point $R0 is &quot;NT 4.0&quot; or whatnot<br />
 <br />
 Function GetWindowsVersion<br />
 <br />
   Push $R0<br />
   Push $R1<br />
 <br />
   ReadRegStr $R0 HKLM \<br />
   &quot;SOFTWARE\Microsoft\Windows NT\CurrentVersion&quot; CurrentVersion<br />
<br />
   IfErrors 0 lbl_winnt<br />
   <br />
   ; we are not NT<br />
   ReadRegStr $R0 HKLM \<br />
   &quot;SOFTWARE\Microsoft\Windows\CurrentVersion&quot; VersionNumber<br />
 <br />
   StrCpy $R1 $R0 1<br />
   StrCmp $R1 '4' 0 lbl_error<br />
 <br />
   StrCpy $R1 $R0 3<br />
 <br />
   StrCmp $R1 '4.0' lbl_win32_95<br />
   StrCmp $R1 '4.9' lbl_win32_ME lbl_win32_98<br />
 <br />
   lbl_win32_95:<br />
     StrCpy $R0 '95'<br />
   Goto lbl_done<br />
 <br />
   lbl_win32_98:<br />
     StrCpy $R0 '98'<br />
   Goto lbl_done<br />
 <br />
   lbl_win32_ME:<br />
     StrCpy $R0 'ME'<br />
   Goto lbl_done<br />
 <br />
   lbl_winnt:<br />
 <br />
   StrCpy $R1 $R0 1<br />
 <br />
   StrCmp $R1 '3' lbl_winnt_x<br />
   StrCmp $R1 '4' lbl_winnt_x<br />
 <br />
   StrCpy $R1 $R0 3<br />
 <br />
   StrCmp $R1 '5.0' lbl_winnt_2000<br />
   StrCmp $R1 '5.1' lbl_winnt_XP<br />
   StrCmp $R1 '5.2' lbl_winnt_2003 lbl_error<br />
 <br />
   lbl_winnt_x:<br />
     StrCpy $R0 &quot;NT $R0&quot; 6<br />
   Goto lbl_done<br />
 <br />
   lbl_winnt_2000:<br />
     Strcpy $R0 '2000'<br />
   Goto lbl_done<br />
 <br />
   lbl_winnt_XP:<br />
     Strcpy $R0 'XP'<br />
   Goto lbl_done<br />
 <br />
   lbl_winnt_2003:<br />
     Strcpy $R0 '2003'<br />
   Goto lbl_done<br />
 <br />
   lbl_error:<br />
     Strcpy $R0 ''<br />
   lbl_done:<br />
 <br />
   Pop $R1<br />
   Exch $R0<br />
 <br />
 FunctionEnd<br />
<br />
Section &quot;Test CopyFiles&quot;<br />
<br />
  SectionIn 1 2 3<br />
<br />
  SetOutPath $INSTDIR\cpdest<br />
  CopyFiles &quot;$WINDIR\*.ini&quot; &quot;$INSTDIR\cpdest&quot; 0<br />
 ;Then if they have XP, CopyFiles&quot;$WINDIR\winxp.ini&quot; &quot;$INSTDIR\winxp&quot;<br />
;Then if I have WinMe, CopyFiles&quot;$WINDIR\winME.ini&quot; &quot;$INSTDIR\winME&quot;<br />
<br />
SectionEnd<br />
<br />
<br />
Thanks, or if anyone has an example program installing driver files specific to an operating system, let me know.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd October 2004, 12:39</div></div><div class="posttext">Call GetWindowsVersion<br />
Pop $0<br />
StrCmp $0 &quot;XP&quot; xp<br />
StrCmp $0 &quot;ME&quot; me other<br />
xp:<br />
CopyFiles &quot;$WINDIR\winxp.ini&quot; &quot;$INSTDIR\winxp&quot;<br />
Goto done<br />
me:<br />
CopyFiles &quot;$WINDIR\winME.ini&quot; &quot;$INSTDIR\winME&quot;<br />
Goto done<br />
other:<br />
DetailPrint &quot;not xp or me&quot;<br />
done:Please attach large scripts next time.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anewguytoday</div><div class="date">24th October 2004, 23:47</div></div><div class="posttext">OK, I tried what you said, I have the above get windows version script and did whats below.   The only problem is the installer works but on my WinXP system, it still installs All files, any help again is appreciated, thanks.<br />
<br />
;------------------------------<br />
<br />
Section &quot;1&quot; Sec1<br />
<br />
   SectionIn 1 5<br />
   SetOverwrite ifnewer<br />
   SetOutPath &quot;$INSTDIR\USB Drivers&quot;<br />
   Call GetWindowsVersion<br />
   Pop $0<br />
   StrCmp $0 &quot;XP&quot; xp other<br />
   StrCmp $0 &quot;ME&quot; me other<br />
   StrCmp $0 &quot;98&quot; ne<br />
   StrCmp $0 &quot;2K&quot; tk<br />
   StrCmp $0 &quot;95&quot; nf<br />
   xp:<br />
   CopyFiles &quot;${NSISDIR}\XP&quot; &quot;$INSTDIR\USB Drivers\XP&quot;<br />
   Goto done<br />
   me:<br />
   CopyFiles &quot;${NSISDIR}\ME&quot; &quot;$INSTDIR\USB Drivers\ME&quot;<br />
   Goto done<br />
   ne:<br />
   CopyFiles &quot;${NSISDIR}\98&quot; &quot;$INSTDIR\USB Drivers\98&quot;<br />
   Goto done<br />
   tk:<br />
   CopyFiles &quot;${NSISDIR}\2K&quot; &quot;$INSTDIR\USB Drivers\2K&quot;<br />
   Goto done<br />
   other:<br />
   CopyFiles &quot;${NSISDIR}\All&quot; &quot;$INSTDIR\All&quot;<br />
   Goto done<br />
   nf:<br />
   DetailPrint &quot;Windows 95 is not supported&quot;<br />
   done:<br />
<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anewguytoday</div><div class="date">25th October 2004, 00:56</div></div><div class="posttext">I mean it installs ALL files on WinXP, not just the XP ones, thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">delboy</div><div class="date">25th October 2004, 09:22</div></div><div class="posttext">StrCmp $0 &quot;XP&quot; xp other<br />
StrCmp $0 &quot;ME&quot; me other<br />
StrCmp $0 &quot;98&quot; ne<br />
StrCmp $0 &quot;2K&quot; tk<br />
StrCmp $0 &quot;95&quot; nf <br />
<br />
<br />
you currently have it set to go to XP if its xp else ditch out and go to other.... ie it will NEVER even evaluate the other possibilities should be:<br />
<br />
StrCmp $0 &quot;XP&quot; xp <br />
StrCmp $0 &quot;ME&quot; me <br />
StrCmp $0 &quot;98&quot; ne<br />
StrCmp $0 &quot;2K&quot; tk<br />
StrCmp $0 &quot;95&quot; nf other<br />
<br />
As for it not pulling it out properly under XP i would suggest trying to work out what it is returning before you panic a quick<br />
<br />
Messagebox MB_OK $0<br />
Inserted after getwindowsversion should cast some light here... I cant remember how this behaves with XP home / Pro ...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>