<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Tray icon, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Tray icon NSIS Discussion" />
	
	<title> Tray icon [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Tray icon</div>
<hr />
<div class="pda"><a href="t-144126.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=144126">Tray icon</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2003, 16:27</div></div><div class="posttext">It would be great if anyone can show me how to get the installer to display in the System Tray area on the Windows task bar.<br />
I doubt this is possible, but it would sure be nice for my program - it downloads updates for my game, which can take hours (if many updates)<br />
<br />
Thanks<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">31st July 2003, 00:29</div></div><div class="posttext">You should be able to do it using the APIs and system plugin.  Not sure of the actual call but will check it out.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">31st July 2003, 00:41</div></div><div class="posttext">Shell_NotifyIcon is the API call...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">31st July 2003, 00:46</div></div><div class="posttext">I found some info about Shell_NotifyIcon at this site. (http://www.obodigital.com/vb/articles/shellnotifyicon.html) I know it's for VB but someone should be able to convert it to system plugin code.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2003, 10:21</div></div><div class="posttext">I know hardly anything about using System plugin let alone VB.<br />
<br />
Help would be much appreciated!<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2003, 23:33</div></div><div class="posttext">Can anyone help me on this one please :p<br />
<br />
-Stu :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RDaneel</div><div class="date">1st August 2003, 01:09</div></div><div class="posttext">Well, probably the best thing I can do for you (besides writing your installer for you :) ) is to give you a conceptual model for &quot;tray stuff&quot;.<br />
<br />
First off, things are fairly simple, and do indeed revolve around the Shell_NotifyIcon API call... the one problem I can see has, I think, been discussed here before - how to receive [Windows] messages sent to your NSIS installer process.<br />
<br />
Anyway, at its simplest, when you want to go into the tray, you set your app (NSIS installer in this case) to be invisible by doing a Win32 API call of ShowWindow(SW_HIDE), and immediately tell Windows to display your icon in the tray, using the Shell_NotifyIcon call.<br />
<br />
Flipping back to non-tray operation is just the reverse - set your main window back to the visible state, and tell Windows to delete your icon from the tray.<br />
<br />
Now, the tricks - when you first go into the tray, along with an icon handle, you tell Windows to use some user-defined Windows message of your choice to inform you of things the user does to your tray icon, like left- or right- clicking it etc.  Clearly, if you are unable to get your hands on this message when Windows sends it to your NSIS installer, you will have a problem communicating with your user. :(  Hopefully someone else (Joost?) can assist you with this...<br />
<br />
Finally, you will need to feel comfortable using the System plugin, both for simple calls, and for creating/interpreting the data structures used with the Shell_NotifyIcon API call... not to mention checking out the documentation on the handful of Windows API calls involved:<br />
<br />
* Shell_NotifyIcon<br />
* ShowWindow<br />
* LoadImage (for getting your icon handle, although you might have some other access to your icon already buried in your NSIS installer).<br />
<br />
Good luck! :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st August 2003, 13:25</div></div><div class="posttext">Thanks for your help!<br />
The reason I cannot start to properly understand the System plugin, is due to the fact that I know nothing about C++, C or hardly any VB!<br />
<br />
I know that Brainsucker would have the ultimate solution to this straight off, but he seems to be away atm :(<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">1st August 2003, 16:17</div></div><div class="posttext">The thing is in this part:<br />
<br />
Public Type NOTIFYICONDATA<br />
   cbSize As Long<br />
   hWnd As Long<br />
   uID As Long<br />
   uFlags As Long<br />
   uCallbackMessage As Long<br />
   hIcon As Long<br />
   szTip As String * 64<br />
End Type<br />
<br />
is important for the API call:<br />
Declare Function Shell_NotifyIcon Lib &quot;shell32.dll&quot; \ Alias &quot;Shell_NotifyIconA&quot; (ByVal dwMessage As Long, lpData As NOTIFYICONDATA) As Long<br />
I don't think that's possible with NSIS...<br />
A less, as you wrote, Mr. Brain popup a good example code solution.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">1st August 2003, 17:18</div></div><div class="posttext">I am 99% sure that this will be posible with nsis. The declaration can be done using the system dll as it only allocates memory.  It's too late tonight for me to this this through, almost 03:30 in the morning.  I'll have another look tomorrow.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st August 2003, 17:20</div></div><div class="posttext">Thank you :)<br />
<br />
#me awaits patiently<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd August 2003, 12:52</div></div><div class="posttext">I notice brainsucker is online atm :)...<br />
<br />
-Stu :p</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">2nd August 2003, 13:05</div></div><div class="posttext">You could create taskbar icon, modify or delete it, but it is hard to react to it. However:<br />
<br />
<br />
; ---------- Some declarations -----------<br />
;typedef struct _NOTIFYICONDATA {<br />
;    DWORD cbSize;<br />
;    HWND hWnd;<br />
;    UINT uID;<br />
;    UINT uFlags;<br />
;    UINT uCallbackMessage;<br />
;    HICON hIcon;<br />
;    TCHAR szTip[64];<br />
;}<br />
!define stNOTIFYICONDATA '(&amp;l4, i, i, i, i, i, &amp;t64) i'<br />
<br />
!define NIF_MESSAGE     0x00000001<br />
!define NIF_ICON        0x00000002<br />
!define NIF_TIP         0x00000004<br />
!define NIM_ADD         0x00000000<br />
!define NIM_MODIFY      0x00000001<br />
!define NIM_DELETE      0x00000002<br />
<br />
; ----------- To Add icon ---------------<br />
; use [t &quot;iconfilename&quot;] instead of [i 32514] to specify your icon,<br />
; or if you already have your icon handle you can use it instead of r2<br />
; at structure creation time<br />
     System::Call 'User32::LoadIconA(i 0, i 32514) i .r2' <br />
     System::Call '*${stNOTIFYICONDATA}(, $HWNDPARENT, 0, ${NIF_TIP}|${NIF_ICON}, 0, r2, &quot;How do you like this?&quot;) .r0'<br />
     System::Call 'Shell32::Shell_NotifyIcon(i ${NIM_ADD}, i r0) i.r1'<br />
<br />
; ----------- To Modify icon ---------------<br />
     System::Call '*$0${stNOTIFYICONDATA}(,,,,,, &quot;Another icon tip...&quot;)'<br />
     System::Call 'Shell32::Shell_NotifyIcon(i ${NIM_MODIFY}, i r0) i.r1'<br />
<br />
; ----------- To Delete icon ---------------<br />
     System::Call 'Shell32::Shell_NotifyIcon(i ${NIM_DELETE}, i r0) i.r1'<br />
     System::Free $0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">2nd August 2003, 14:34</div></div><div class="posttext">I notice brainsucker is online atm :)...<br />
 <br />
;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">2nd August 2003, 15:06</div></div><div class="posttext">wow! it's easy...easier than Visual Basic ;)<br />
Cool dude :up:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd August 2003, 17:59</div></div><div class="posttext">Hmm, theres a problem with the code to unload the tray icon.<br />
Sometimes it works, sometimes it doesn't, but it always brings up a crash.<br />
<br />
Can anyone see whats wrong with it?<br />
<br />
Thanks, this is excellent!<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd August 2003, 18:01</div></div><div class="posttext">Ok, also it seems that if I hover my mouse over the tray icon, it dissapears too.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">2nd August 2003, 18:11</div></div><div class="posttext">Where do you put:<br />
<br />
System::Call 'Shell32::Shell_NotifyIcon(i ${NIM_DELETE}, i r0) i.r1' <br />
System::Free $0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd August 2003, 18:47</div></div><div class="posttext">I have placed it in my abort/instsuccess functions.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RDaneel</div><div class="date">2nd August 2003, 20:12</div></div><div class="posttext">Well, brainsucker *is* Mr System plug-in, as I understand it, but the rest of us aren't, so there may be some less-obvious things to look at here :)<br />
<br />
1) so we are all clear on what is happening, the Shell_NotifyIcon API call needs a NOTIFYICONDATA data structure passed in to it EVERY time... since $0 is being used to hang on to a pointer to this structure, you must make sure that $0 is not overwritten by any other code during the time between the NIM_ADD and NIM_DELETE calls<br />
<br />
2) while the example shown is apparently using some magic in the System plug-in to allocate (and fill in) this data structure the first time (just prior to the NIM_ADD call), note that if you use the example code for the NIM_DELETE call, this data structure is released with the System::Free, and the whole initial sequence (the setup code for the NIM_ADD) must be executed again<br />
<br />
3) when initializing the structure, the first element *must* be filled in with the size in BYTES of the entire structure... this should be happening with the &quot;&amp;l4&quot; in the structure def, but has the actual value been verified?  Actually, there are some semi-trick cases to consider here, since the size specified is used by Windows to decide which version of the Shell_NotifyIcon API to offer/use... the example code will *probably* make the system think that you are only using the &quot;ancient&quot; Win95/WinNT features of this API, which would mean that the example structure will work ;)<br />
<br />
4) the NIM_MODIFY sequence will (as shown) modify the TOOLTIP, not the ICON (either or both are possible)... just a comment on the comment :D<br />
<br />
5) finally, *don't* blow off brainsucker's first line of the example post - the &quot;but it is hard to react to it&quot; is echoing my earlier remarks about receiving the Windows messages sent back to your NSIS installer to tell you when the user &quot;does something&quot; to your tray icon... if it is your intention to use the tray completely non-interactively, fine - otherwise, this issue will have to be addressed :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd August 2003, 20:18</div></div><div class="posttext">The idea was so that the installer would not be listed on the task bar, but be instead an icon on the task bar instead.<br />
The user would be able to right/left click to open the installer again.<br />
<br />
I have changed it to use $4 instead (haven't used that in my script)<br />
It now does not crash, but it still dissapears on mouseover.<br />
<br />
Thanks<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd August 2003, 00:42</div></div><div class="posttext">Ops,<br />
<br />
The idea was so that the installer would not be listed on the task bar, but be instead an icon on the sys tray instead.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd August 2003, 22:28</div></div><div class="posttext">Well, the code seems to work on Win98SE, but on WinXP the icon just dissappears on mouse-over.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RDaneel</div><div class="date">4th August 2003, 03:06</div></div><div class="posttext">You haven't mentioned whether you think the system is just disappearing your tray icon on you, or your code to make it go away is being invoked... when the icon goes away (on XP), does your app go away too (i.e., it's no longer on the system tasklist)?<br />
<br />
Why don't you put debug output to the NSIS log page when *any* of the Shell_NotifyIcon calls are made - this is a way to get more data on what may be happening.  Also, if you are worried about being able to *see* the log because your NSIS installer is invisible, just don't turn off visibility to start with when you first make the icon show in the tray. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">4th August 2003, 13:12</div></div><div class="posttext">The tray icon dissappears on mouseover (like I said) while the program is running, not when it has been shut down.<br />
This happens on WinXP only.<br />
The icon shows it's label correctly (displays the text) on mouseover on Win98/NT.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">4th August 2003, 15:54</div></div><div class="posttext">Ok...<br />
according to my recent research about system plugin...<br />
Shell_NotifyIcon it's a call like Visual Basic handles..<br />
Shell_NotifyIconA is the called for the plugin.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RDaneel</div><div class="date">4th August 2003, 18:45</div></div><div class="posttext">Ummm, &quot;Major Dude&quot;, get the trace/debug info as suggested above.  It is more likely that your NSIS code is [inadvertently] removing the tray icon than that XP is spontaneously doing it. :D <br />
<br />
&quot;Forum King&quot;, the real deal is that most of the Win32 API calls that handle text actually have *2* entry points: one with &quot;A&quot; appended, and one with &quot;W&quot;.<br />
<br />
In this particular case, then, the Shell32 DLL has both Shell_NotifyIconA and Shell_NotifyIconW.  There *is* no &quot;Shell_NotifyIcon&quot; version of the call in reality - in programming land, your development environment maps this generic version of the name to one of the real ones... either the &quot;A&quot; version for ASCII text, or the &quot;W&quot; version for Unicode.<br />
<br />
So, if things work at all as shown in brainsucker's example, I would expect it is because the System plug-in, when it fails on a GetProcAddress call, automatically retries with &quot;A&quot; appended to the supplied API entry point. ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">4th August 2003, 20:07</div></div><div class="posttext">After placing brainsuckers' code into an empty script, that does not use any variables (except for the System code itself) my problem persists where the icon just dissappears on mouse-over.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">5th August 2003, 15:21</div></div><div class="posttext">Afrow UK: It's the most likely you've forgotten to add <br />
<br />
SetPluginUnload alwaysoff<br />
<br />
option at the script start (or /nounload to every system call).<br />
Don't forget to add <br />
<br />
SetPluginUnload manual<br />
<br />
before the last system call (or fake System::Free 0 call).<br />
<br />
RDaneel: <br />
0. thanx for you comments :) <br />
1. I've spent to many time debuggin &amp;l option, so there is no one chance it'll fail!!! ;)<br />
2. System does nothing with the letter A at the proc name end, I've just forgotten to add it... The way it works?... Hmm.. Shell32.dll contains proc version without any letters, may be because it could determine which structure (unicode or ascii) passed to it by cbSize member (there are no other string params, as you see). <br />
<br />
P.S. I'll post notifyicon plugin ASAP, which will solve all the problems (the icons at TNA and removing the window from taskbar).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th August 2003, 16:20</div></div><div class="posttext">OMG BRAINSUCKER!!!!<br />
/me saw the last P.S.<br />
<br />
You are the most amazing guy on the net - seriously, you writing a plugin just like that wow!!<br />
<br />
So, will this plugin have support for simple sys tray icon click - opens program, or even more!?<br />
<br />
-Stu :o :) :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">5th August 2003, 16:30</div></div><div class="posttext">Originally posted by brainsucker <br />
<br />
2. System does nothing with the letter A at the proc name end<br />
Just to be clear: I used the term &quot;A&quot; for the conversion from<br />
Visual Basic 4/5/6 API declare function to system plugin syntax :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RDaneel</div><div class="date">5th August 2003, 18:46</div></div><div class="posttext">brainsucker,<br />
<br />
You certainly are an energetic person! :)<br />
<br />
Really, be careful with the A/W thing - in general, the A/W naming convention *is* the rule in Win32 system API calls that have any dealings with text, whether as parameters, or in this case, in a structure that is a parameter.<br />
<br />
As it happens, for *some* of the API calls, an additional entry point (without A/W) is defined to be the same as the entry point for the &quot;A&quot; version of the call... but not all of them!<br />
<br />
So, while Shell_NotifyIcon does have the &quot;extra&quot; entry point, others do not (e.g., ShellAbout and ShellExecute).<br />
<br />
Hmmm... might you want to include the strategy on failed GetProcAdress calls that I mentioned earlier (you would only need to make this change in one place)?  If you/we can convince yourself/ourselves that the &quot;A&quot; version is probably what the NSIS scripter actually meant to use, this *could* save some confusion - at the cost of further obscuring how things actually work, of course. :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">5th August 2003, 23:16</div></div><div class="posttext">Afrow UK: I'm thinking about right click menu, but it'll have a little sense anyway (there are 2 ways I see, and both are ugly: 1. assign some variable some value on menu selection, and then check it thru the script 2. Pool some plugin function which will return menu status). Any ideas about additional functionality?<br />
<br />
RDaneel: :)<br />
&quot;Really, be careful with the A/W thing&quot;<br />
:) I've just forgotten that damn letter!!!! ;) :)<br />
<br />
System+A: ok... good idea.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th August 2003, 23:36</div></div><div class="posttext">I think it wouldn't be possible for nsis programs to recieve the values from the menu.<br />
Because NSIS only runs the codes in different places (in oninit, after a page etc) not constantly...<br />
<br />
We can forget the return values I suppose.<br />
It's just up to the dll now to bring the program on-top when the user clicks on the sys tray icon.<br />
You could allow additional defines when calling the plugin (no idea what plugin is called but,)<br />
<br />
TrayIcon::Load &quot;Icon&quot; &quot;Hover title&quot;<br />
TrayIcon::Menu &quot;TI_MINIMIZE, TI_OPEN&quot; &quot;Menu header text&quot;<br />
TrayIcon::Close<br />
<br />
Going over the top would be, I dunno...<br />
<br />
TrayIcon::Menu &quot;SubMenu('Readme'), Menu('Open Readme', exec $INSTDIR\readme.txt)&quot;<br />
<br />
This would create a submenu, which on moueover brings up a second menu which inturn has a button to open the installer readme.<br />
<br />
lol<br />
<br />
-Stu :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th August 2003, 23:15</div></div><div class="posttext">Afrow, where did you put the creation code? It must not be in .onInit because in there $HWNDPARENT is not valid.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">9th August 2003, 14:02</div></div><div class="posttext">Thanks, but after moving it to GUIInit or one of my custom pages, the installer would just crash onInit, and wouldn't even reach any dialogs.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">9th August 2003, 14:04</div></div><div class="posttext">May I ask how the plugin is going?<br />
I have till next weekend to prepare for the release of my 12 map D-Day campaign, along with the release of my NSIS installer.<br />
<br />
It would be nice to get the tray icon working by then, but I can always release the installer (program) again later (It has built in updater).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">10th August 2003, 11:55</div></div><div class="posttext">Sorry... I've got some immediate work (programming USB device).... so ASAP. ;(<br />
<br />
BTW, would you like to remove program from taskbar on minimize only, or at any time?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th August 2003, 12:06</div></div><div class="posttext">Well, it at the moment I've used System code to remove the taskbar item perminantly for the settings tab (which is executed with ExecWait)<br />
But, indeed yes, it would be nice if the taskbar item dissapeared on minimize.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">10th August 2003, 23:13</div></div><div class="posttext">Hide on minimize is 10000000 times easier :) I've f*cked all the Sunday of the last week with hiding at normal state (WS_EX_TOOLBOX sux - make new styles and so on, and other techiques work hard with nsis window).<br />
I'll release tomorrow (i think) minimal version with hide on minimize and no right click menues (but with balloon tooltips for example ;).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th August 2003, 00:15</div></div><div class="posttext">Now, thinking about it, will it be able to work like this:<br />
<br />
Installer is ran, and sys tray icon is made (installer is also shown, and task bar item)<br />
User clicks on sys tray icon to show installer ui and show the task bar item.<br />
Sys tray icon stays until installer is closed.<br />
On installer minimization, task bar item dissappears (along with installer ui) Sys tray icon stays.<br />
<br />
Thanks for everything!<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">11th August 2003, 09:24</div></div><div class="posttext">Is it the question? Yes, it will be able. That is the most natural behaviour, I think.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tarwal2</div><div class="date">19th August 2003, 21:26</div></div><div class="posttext">Did this plugin ever get made? Sounds pretty useful for my purposes. I basically have two installs (one that downloads the second) and it would be nice to have a tray icon that shows progress (and options) for while the second setup is downloading.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th August 2003, 14:29</div></div><div class="posttext">Brainsucker is still working on it (I assume)<br />
<br />
I went and released my program (installer) b1 without the Task Bar functionality.<br />
When the plugin is finished, I can simply upload the new version of my program (using the plugin), and when everyone runs my program it will download the update for them.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd August 2003, 12:14</div></div><div class="posttext">Is this still being worked on?<br />
<br />
-Stu :confused:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">23rd August 2003, 23:25</div></div><div class="posttext">Afrow :) Hope you'll forgive me that delay... I've got so many immediate work... If I'll finish it (work) tomorrow (today) (in basic), I'll try to bring plugin online this evening (there is nothing to do with it actually, in simpliest form (hide on minimize) at last). I'm really sorry...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd August 2003, 23:37</div></div><div class="posttext">No theres honestly no rush.<br />
I was just hoping that it hadn't been forgotten!<br />
<br />
Thanks for showing that it's still there!<br />
<br />
-Stu :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st August 2003, 18:28</div></div><div class="posttext">Just posting to keep this topic... Alive.<br />
<br />
-Stu :eek:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">3rd September 2003, 23:56</div></div><div class="posttext">So... finally... My conscience won the fight with me :)<br />
Sorry again for such a long delay... <br />
Hope it will satisfy all your needs.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DougCox</div><div class="date">4th September 2003, 17:10</div></div><div class="posttext">brainsucker:<br />
Your Notify Icon Plugin looks awesome!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">5th September 2003, 13:11</div></div><div class="posttext">why is the traybar called 'taskbar notification area'? Regular taskbar also notifies that some program is running.<br />
<br />
Show me the light! :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">5th September 2003, 17:43</div></div><div class="posttext">Who knows... You probably should sue Microsoft ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th September 2003, 19:16</div></div><div class="posttext">Great work, and thanks.<br />
Right now however, when calling NotifyIcon::Icon r, my installer crashes.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">5th September 2003, 19:39</div></div><div class="posttext">Which system you are using? works fine for me under winxp. will check under 98.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th September 2003, 19:42</div></div><div class="posttext">I am also on Windows XP-Pro.<br />
See attached script.<br />
<br />
I'm using the remove call in .onInstSuccess .onUserAbort and my custom Abort function.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">5th September 2003, 19:45</div></div><div class="posttext">What about demo script?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th September 2003, 20:08</div></div><div class="posttext">Never unload UI plug-ins from .onUserAbort and .onInstSuccess, use .onGUIEnd.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th September 2003, 20:08</div></div><div class="posttext">\/</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th September 2003, 20:10</div></div><div class="posttext">Ah thanks Kichik, I shall try that.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th September 2003, 20:12</div></div><div class="posttext">Well, after using it in .onGUIEnd, the icon isn't removed at all.<br />
<br />
Updated testing attachment<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th September 2003, 20:20</div></div><div class="posttext">It's probably because the window is already destroyed. The plug-in should check to see if the window is destroyed and self-desrtuct if that's the case. For now remove it in the last section.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th September 2003, 20:21</div></div><div class="posttext">What about when the user clicks cancel; use it in the custom page function if IO pops cancel?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">5th September 2003, 20:22</div></div><div class="posttext">Huh, I will discuss with Kichik what to do... Problem found.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th September 2003, 20:23</div></div><div class="posttext">There is also a problem that the installer doesn't close automatically, so the tray icon will get distroyed before the install has properly finished.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th September 2003, 20:25</div></div><div class="posttext">Well, the good news is that it doesn't crash when called inside the custom page after the user clicks cancel.<br />
Now, I'll wait for the self-distruct sequence :)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">5th September 2003, 20:54</div></div><div class="posttext">Afrow, could you please test BrowseForFolder and BrowseForFolderNew rountines separately (be sure to update the system and exehead to latest cvs versioun).<br />
<br />
p.s. updated NotifyIcon.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">5th September 2003, 21:08</div></div><div class="posttext">Afrow UK: a small tip: you could skip constant parameters, for example if you use the same icon every time you could skip &quot;i&quot; &quot;103&quot;. The same goes for tip at your dday. <br />
<br />
Also, IMHO: poping up a info balloon message for every file you are downloading could be a little disturbing for user, may be you should move that info to tip, and popup only on &quot;completed&quot; or &quot;failed&quot; messages?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th September 2003, 21:14</div></div><div class="posttext">Thanks for the tips.<br />
They are good ideas!<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th September 2003, 21:25</div></div><div class="posttext">Well, it seems that the problem is fixed.<br />
I am now calling the plugin to remove the notifyicon from .onGUIEnd only, and it works fine, without a crash.<br />
<br />
Many D-Dayers are looking forward to the new installer.<br />
Thanks for writing this excellent plugin!<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th September 2003, 21:26</div></div><div class="posttext">Mind writing an archive page for it Afrow? I'll upload the zip to the archive.<br />
<br />
 uploaded to http://nsis.sourceforge.net/archive/download.php?file=NotifyIcon.zip</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th September 2003, 21:40</div></div><div class="posttext">http://nsis.sourceforge.net/archive/nsisweb.php?page=402&amp;instances=0<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">17th September 2003, 04:16</div></div><div class="posttext">it appears, that the systray icon does not get displayed properly.<br />
<br />
my icon file consists of various sizes (including 16x16 pixels). the script uses the icon from the executable (103). the icon in the systray looks like a badly downsampled version of a larger icon. why doesn't it simply display the included 16x16 icon?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">17th September 2003, 05:02</div></div><div class="posttext">having opened the .exe in a resource editor, i figured 103 is the id of the icon. now is there a way to further specify the icon size to use for the systray?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th September 2003, 09:49</div></div><div class="posttext">Originally posted by n0On3 <br />
why is the traybar called 'taskbar notification area'? Regular taskbar also notifies that some program is running.<br />
<br />
Show me the light! :) <br />
<br />
Find out here (http://blogs.gotdotnet.com/raymondc/commentview.aspx/5a811e6f-cd12-48de-8994-23409290faea).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">17th September 2003, 14:13</div></div><div class="posttext">mmm.... those reasons didn't convince me.<br />
<br />
I suspect this is another lost war. <br />
<br />
He can join Richard Stallman who fights to make people call open-source &quot;free software&quot; and Linux &quot;GNU/Linux&quot;.<br />
<br />
Thanks for the link, interesting read.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th September 2003, 14:26</div></div><div class="posttext">That's one of Windows 95 developers, you won't find a better answer ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">17th September 2003, 23:48</div></div><div class="posttext">killahbite: 103 is the number of icon group. and i know no particular way to specify which icon from group to use (the approriate icon should be selected by windows).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">18th September 2003, 02:04</div></div><div class="posttext">the current version downsizes the 32x32 icon to 16x16. it should load the default 16x16 icon instead!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">18th September 2003, 21:54</div></div><div class="posttext">killahbite :) sorry, i couldn't help you. Create additional icon group from one 16x16 icon (it shouldn't take much space) and use it as NotifyIcon icon.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th September 2003, 13:05</div></div><div class="posttext">Specifying 16x16 in the desired size should do it. According to Wine source code, LoadImage searches for the best match.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">19th September 2003, 13:35</div></div><div class="posttext">bright idea Kichik :) <br />
I'll check and update a bit later...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">19th September 2003, 18:38</div></div><div class="posttext">Fixed. Now uses 16x16 as default icon size. The previous behaviour could be selected by '.' flag before f, s, or i.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th September 2003, 10:40</div></div><div class="posttext">Uploaded.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th September 2003, 10:46</div></div><div class="posttext">My icon file has a 16x16 icon in it too, but it shows up correctly on the older dll.<br />
Maybe it's the program you used to create the icon.<br />
Also, I'm sure the order of the icons inside the file can affect which icon(s) is used.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">17th August 2005, 19:19</div></div><div class="posttext">would it be possible to add a flag, that minimizes the installer to the tray when one clicks on the minimize icon?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">flyakite</div><div class="date">12th December 2005, 20:14</div></div><div class="posttext">Would it be possible to add a feature that when you click on the balloon it calls a function?  I have a balloon tip appear when an app. is run silently, and I would like that when you click on the tip it shows a message box asking the user if they would like to restart.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BioDuo</div><div class="date">22nd February 2006, 13:31</div></div><div class="posttext">Originally posted by flyakite <br />
Would it be possible to add a feature that when you click on the balloon it calls a function?<br />
<br />
I would love so such an option.<br />
<br />
I think I found a bug:<br />
When I run NotifyIcon::Icon /NOUNLOAD in the .onInit or with SilentInstall enabled, at the moment the mouse goes over the trayicon, it simply disappears.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">22nd February 2006, 14:14</div></div><div class="posttext">I think it's already mentioned in this topic (or in the readme I can't remember) but you can't call the plugin in .onInit because at that point the GUI has not been initialised yet. Notification icons are tied with a Windows GUI and therefore you should call the plugin while the window is in memory - in .onGUIInit. Also, to remove it call in .onGUIEnd.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">22nd February 2006, 20:23</div></div><div class="posttext">Where does it access the icon from?<br />
With the default it works but not with my custom one<br />
Does the icon need to be extracted with File</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">22nd February 2006, 21:07</div></div><div class="posttext">If you don't specify the default icon (105) you specify a full path to an icon file which logically you'd need to extract :).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">23rd February 2006, 06:09</div></div><div class="posttext">Instead of using X:\t could I use \t ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd February 2006, 15:19</div></div><div class="posttext">Just extract the icon to $PLUGINSDIR and give it that path.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">25th February 2006, 03:22</div></div><div class="posttext">Still doesn't work<br />
I have extracted to C:\icon.ico<br />
but still doesn't work<br />
Using<br />
NotifyIcon::Icon /NOUNLOAD &quot;fpb&quot; &quot;C:\icon.ico&quot; &quot;START&quot; &quot;Balloon!&quot; &quot;Cool!&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">25th February 2006, 04:04</div></div><div class="posttext">Oops<br />
Working now<br />
Forgot to add y<br />
:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">25th February 2006, 06:18</div></div><div class="posttext">When you use this in conjuction with wansis, the skin window stays up.<br />
Is there a way to fix this???</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stevelam</div><div class="date">25th February 2006, 15:04</div></div><div class="posttext">Originally posted by rmccue <br />
When you use this in conjuction with wansis, the skin window stays up.<br />
Is there a way to fix this???  <br />
<br />
Hey rmccue I knew it would be you when I saw the topic title on the NSIS homepage!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">25th February 2006, 22:12</div></div><div class="posttext">Hi Steve<br />
But can anyone answer my q?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">26th February 2006, 20:21</div></div><div class="posttext">Maybe call a custom function on minimize and maximize</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BioDuo</div><div class="date">21st March 2006, 09:33</div></div><div class="posttext">My program notfies the user if something happens and displays it in a balloon (yeah,.. really! :P)<br />
<br />
But I want that if the user click on the balloon a certain action is performed, how do I do that?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st March 2006, 18:14</div></div><div class="posttext">There isn't a way I'm afraid.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mr Inches</div><div class="date">23rd March 2006, 21:12</div></div><div class="posttext">So I wonder how that (annoying) &quot;Take the Windows Tour&quot; balloon and the &quot;Windows Update&quot; ballon do it then, they launch Wizards/applications when you click on them...<br />
<br />
I think this is the functionality that is sought.<br />
<br />
I might take a look, it would be interesting to know its done.<br />
<br />
Duncan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd March 2006, 22:28</div></div><div class="posttext">There is no way via a run-time plugin to call an internal NSIS function from some event. For this to be possible we'd need modifications to the original NSIS source code, or perhaps when compiler plugin support is added this will be possible. I doubt it will get implemented because this would add to installer overhead no doubt.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">23rd March 2006, 22:55</div></div><div class="posttext">Actually, you can already call NSIS functions from plug-ins. ExecuteCodeSegment is exported to plug-ins through the extra_parameters structure passed on as the fifth function argument. However, the scripting engine is not multi-threaded, so it's up to the plug-in to synchronize it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">24th March 2006, 23:38</div></div><div class="posttext">Anyway, how would I get it to shrink the wansis window? I'm using FindWindow, ShowWindow in a custom function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zeeh3</div><div class="date">20th May 2008, 13:27</div></div><div class="posttext">I need some help here... the plugin doesn't allow me to HideWindow and I can't get &quot;p&quot; nor &quot;!p&quot; params to work with the NotifyIcon.nsi that comes in zip file (v0.2).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Alfaromeo</div><div class="date">18th May 2010, 08:25</div></div><div class="posttext">I need to show the system tray icon during an upgrade process. The upgrade will be triggered using the silent switch to make it silent. <br />
Is this feasible using the NotifyIcon plugin ? If not what are my options.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th May 2010, 12:30</div></div><div class="posttext">It's been a while since I looked at the code but it probably doesn't show any notification icon if the installer is silent. If that is the case you would need to modify the plugin to allow a force show option or something that overrides this behaviour. If you don't use the plugin you'll be using System with a lot of SendMessage lines (which the Win32 macros use internally) so it'd be pretty painful.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Alfaromeo</div><div class="date">18th May 2010, 13:27</div></div><div class="posttext">Yes it is a nice switch to have because on silent , this can be a kind of notification to the user . <br />
I'm surely in dire need of this.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>