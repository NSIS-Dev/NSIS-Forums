<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Looking for a little help, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Looking for a little help NSIS Discussion" />
	
	<title> Looking for a little help [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Looking for a little help</div>
<hr />
<div class="pda"><a href="t-142821.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=142821">Looking for a little help</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">19th July 2003, 19:50</div></div><div class="posttext">Hi,<br />
<br />
I'm looking for a little help, :)<br />
<br />
I put together a script using HM NIS Script Wizard<br />
<br />
But I've made a few changes to it<br />
<br />
What I'm looking for is a script which helps me, if the file exists it will be backed up, but I would like another option, if uninstalled the backedup files will will be placed back in the original directories.<br />
<br />
Is this possible?<br />
<br />
I know I could use copyfile, to backup the files<br />
<br />
I have seen this script Backup (http://forums.winamp.com/showthread.php?s=&amp;threadid=113987&amp;highlight=backup) <br />
<br />
Plus I'm a total novice to NSIS, and I'm not sure what all the commands and so on mean, I have looked through your documentation, but just can't figure it out :igor:<br />
<br />
I have attached the script I'm working with Text (http://www.darksaber.freeserve.co.uk/temp/text.txt) <br />
<br />
It works fine so far, I still have to make a few changes so it will delete all the installed files, but I would like if possible to back them up first<br />
<br />
Would it be possible for someone, to create that script and explain how to use.<br />
<br />
Please<br />
<br />
I would be so grateful<br />
<br />
Thanks so much:D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th July 2003, 00:26</div></div><div class="posttext">## Place in installer<br />
IfFileExists &quot;$INSTDIR\filetobackup.exe&quot; 0 nobackup<br />
CreateDirectory &quot;$INSTDIR\backup&quot;<br />
CopyFiles &quot;$INSTDIR\filetobackup.exe&quot; &quot;$INSTDIR\backup\filetobackup.exe&quot;<br />
nobackup:<br />
<br />
## Place in uninstaller<br />
IfFileExists &quot;$INSTDIR\backup\filetobackup.exe&quot; 0 nobackup<br />
CopyFiles &quot;$INSTDIR\backup\filetobackup.exe&quot; &quot;$INSTDIR\filetobackup.exe&quot;<br />
RMDir /r &quot;$INSTDIR\backup&quot;<br />
nobackup:<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">20th July 2003, 01:32</div></div><div class="posttext">Thanks alot, but the only problem was I kept getting a error with the<br />
<br />
nobackup<br />
<br />
at the end of the IfFileExists line<br />
<br />
and a error with the <br />
<br />
nobackup:<br />
<br />
at the end<br />
<br />
once I removed them it created the backup dir and placed the file in to it<br />
<br />
but once I tried to restore the backup file nothing happened plus it didn't delete the backup dir<br />
<br />
could you explain what the nobackup means<br />
<br />
Thanks again so much</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th July 2003, 11:44</div></div><div class="posttext">Um.<br />
If you have the codes seperated into the Uninstall section and Install section, then it will work.<br />
If you put the whole lot in the same section, then it defeats the purpose of the code.<br />
<br />
1st part backs up the file if it is found.<br />
2nd part returns the file on uninstall from the backup folder.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">20th July 2003, 13:28</div></div><div class="posttext">Yeah I did that<br />
<br />
Sorry to be a nuisance<br />
<br />
But would it be possible to put it into my script<br />
<br />
To show me how to do it<br />
<br />
Or do you have it in a script with it in, which I could learn from<br />
<br />
Again I know Iâ€™m a pain<br />
<br />
Thanks<br />
<br />
-Tony</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th July 2003, 13:32</div></div><div class="posttext">Section &quot;Backup old files&quot;<br />
IfFileExists &quot;$INSTDIR\filetobackup.exe&quot; 0 nobackup <br />
CreateDirectory &quot;$INSTDIR\backup&quot; <br />
CopyFiles &quot;$INSTDIR\filetobackup.exe&quot; &quot;$INSTDIR\backup\filetobackup.exe&quot; <br />
nobackup: <br />
SectionEnd<br />
<br />
Section &quot;Uninstall&quot; <br />
IfFileExists &quot;$INSTDIR\backup\filetobackup.exe&quot; 0 nobackup <br />
CopyFiles &quot;$INSTDIR\backup\filetobackup.exe&quot; &quot;$INSTDIR\filetobackup.exe&quot; <br />
RMDir /r &quot;$INSTDIR\backup&quot; <br />
nobackup: <br />
SectionEnd<br />
<br />
The Uninstall section is what makes up your uninstaller.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">20th July 2003, 15:10</div></div><div class="posttext">Thanks Stu<br />
<br />
I finally got it to work :)<br />
<br />
Now I just have to repeat the script for around 300 files :cry: <br />
<br />
I've done it with two sets of files and it works fine<br />
<br />
Hopefully I won't bug you again about this<br />
<br />
Thanks so much<br />
<br />
And to the guys who made or contribute to NSIS<br />
<br />
Thanks also :up:<br />
<br />
-Tony</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th July 2003, 15:13</div></div><div class="posttext">To make the script shorter and easier to maintain you can use a macro just like the one in the link you posted in your first post.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">20th July 2003, 15:28</div></div><div class="posttext">Thanks, I would if I knew how to implement it in to my script<br />
<br />
I know this might be asking a lot<br />
<br />
I have uploaded my script again with the changes Afrow UK suggested Text script updated (http://www.darksaber.freeserve.co.uk/temp/text.txt) <br />
<br />
If it's possible and if you have the time could you take a look at it and replace it with your script, please<br />
<br />
Sorry but I learn better if I know where to put things :confused: <br />
<br />
I would greatly appreciate it if you could :D <br />
<br />
Please<br />
<br />
Thanks so much</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th July 2003, 15:36</div></div><div class="posttext">It's very simple.<br />
<br />
!macro BackupFile FILE<br />
IfFileExists &quot;$INSTDIR\${FILE}&quot; 0 +3<br />
CreateDirectory &quot;$INSTDIR\backup&quot; <br />
CopyFiles &quot;$INSTDIR\${FILE}&quot; &quot;$INSTDIR\backup\${FILE}&quot;<br />
!macroend<br />
<br />
Put this code on the top of your script and for every file you want to backup use:<br />
<br />
!insertmacro BackupFile file_name<br />
<br />
To restor them at uninstall time put this macro on top:<br />
<br />
!macro RestoreFile FILE<br />
IfFileExists &quot;$INSTDIR\backup\${FILE}&quot; 0 +3<br />
CopyFiles &quot;$INSTDIR\backup\${FILE}&quot; &quot;$INSTDIR\${FILE}&quot;<br />
!macroend<br />
<br />
and for every file you want restored (in the uninstall section) use this code:<br />
<br />
!insertmacro RestoreFile file_name</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">20th July 2003, 19:44</div></div><div class="posttext">Ok thanks that works fine<br />
<br />
In your other script you have subfolder<br />
<br />
Would there be any chance of you showing me how to include them also<br />
<br />
Please<br />
Sorry again about this<br />
<br />
Edit<br />
<br />
No matter I figured it out, from your previous script, simple as you said :)<br />
<br />
!macro BackupFile DIR FILE<br />
IfFileExists &quot;$INSTDIR\${DIR}\${FILE}&quot; 0 +3<br />
CreateDirectory &quot;$INSTDIR\backup\${DIR}&quot; <br />
CopyFiles &quot;$INSTDIR\${FILE}&quot; &quot;$INSTDIR\backup\${DIR}\${FILE}&quot;<br />
!macroend <br />
!insertmacro BackupFile &quot;subfolder&quot; &quot;file_name&quot;<br />
<br />
!insertmacro BackupFile &quot;file_name&quot; <br />
!macro RestoreFile DIR FILE<br />
IfFileExists &quot;$INSTDIR\backup\${DIR}\${FILE}&quot; 0 +3<br />
CopyFiles &quot;$INSTDIR\backup\${DIR}\${FILE}&quot; &quot;$INSTDIR\${DIR}\${FILE}&quot;<br />
!macroend <br />
!insertmacro RestoreFile &quot;Subfolder&quot; &quot;file_name&quot;<br />
<br />
!insertmacro RestoreFile &quot;file_name&quot;<br />
<br />
Thanks so much both of you for your help :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">21st July 2003, 01:48</div></div><div class="posttext">Yeah I made a mistake with the script above<br />
<br />
should have been<br />
!insertmacro BackupFile &quot;subfolder&quot; &quot;file_name&quot;<br />
<br />
!insertmacro BackupFile &quot;&quot; &quot;file_name&quot;<br />
<br />
Anyhow<br />
<br />
Thanks for the help  :up:</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>