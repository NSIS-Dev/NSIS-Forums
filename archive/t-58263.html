<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Better ActiveX registration, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Better ActiveX registration NSIS Discussion" />
	
	<title> Better ActiveX registration [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Better ActiveX registration</div>
<hr />
<div class="pda"><a href="t-58263.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=58263">Better ActiveX registration</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">AsPhunck</div><div class="date">26th August 2001, 13:24</div></div><div class="posttext">There's a problem with the way we can check the version number when doing ActiveX registration. It requires the filename on the install system... <br />
<br />
Typically you want to install an ActiveX component if the file is newer than the one already on the system... The problem is that you don't know the filename/location of the component on the system. :( The only thing you know is the &quot;class id&quot; of the component that you want to install. And you dont want to write the class-id's in the NSIS script, instead you want the NSIS to retrieve it from the file in...<br />
<br />
What I am looking for could be expressed in pseudo-code it as: <br />
<br />
<br />
<br />
NDLL=the DLL in the NSIS package<br />
IF NDLL.classid already exists on system {<br />
   SDLL=the install systems DLL coresponding to NDLL.classid<br />
   IF SDLL.version&lt;NDLL.version {<br />
      UNREG SDLL<br />
      REG NDLL<br />
   } <br />
}<br />
 <br />
<br />
I have no idea how to implement this in the NSIS source. But I doubt i am the only one that would like this feature. If there only was a function that could retrieve the filename of SDLL.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AsPhunck</div><div class="date">29th August 2001, 10:05</div></div><div class="posttext">Am I the only one interrested in this?<br />
<br />
I really can't imagine it.. If your product is one with lots of ActiveX components then this feature is almost essential.<br />
<br />
This would be the case for almost all VB/Delphi coded products... <br />
<br />
Anybody got a solution?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AsPhunck</div><div class="date">29th August 2001, 10:27</div></div><div class="posttext">If nobody here has a solution then I think I will switch to the &quot;inno&quot; installer. It's also free, albeit not as cool...<br />
<br />
I might even consider writing my own using the &quot;Seer&quot; Scripting language. <br />
<br />
I don't want to switch so please send any solutions to my problem....<br />
<br />
;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pjw62</div><div class="date">29th August 2001, 16:24</div></div><div class="posttext">oh no... an unbeliever.. arrhgg... I will see what I can do.. if you could find an expample of how to do this progmatically, I would appreciate. I cant give it a lot of attention at the moment 'cause I'm busy ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pjw62</div><div class="date">29th August 2001, 16:32</div></div><div class="posttext">would one just read the reg key HKEY_CLASSES_ROOT\CLSID\&lt;clsid goes here&gt;\InprocServer32\<br />
<br />
??<br />
e.g.<br />
<br />
the default key value for <br />
HKEY_CLASSES_ROOT\CLSID\{00000107-0000-0010-8000-00AA006D2EA4}\InprocServer32 is &quot;C:\PROGRAM FILES\COMMON FILES\MICROSOFT SHARED\DAO\DAO360.DLL&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pjw62</div><div class="date">29th August 2001, 16:42</div></div><div class="posttext">as well as that, there are various other keys that can be read to get filename of related modules (16/32 bit)..<br />
<br />
(copied and pasted)<br />
 InprocHandler   Registers a 16-bit handler DLL <br />
 @     String value<br />
Specifies the custom handler used by the application. <br />
 InprocHandler32   Registers a 32-bit handler DLL <br />
 @     String value<br />
Specifies the custom handler used by the application. <br />
 InprocServer   Registers a 16-bit in-process server DLL <br />
 @     String value<br />
Specifies the path to the in-process server DLL. <br />
 InprocServer32   Registers a 32-bit in-process server DLL <br />
 @     String value<br />
Specifies the path to the 32-bit in-process server. <br />
 ThreadingModel     String value<br />
Specifies the threading model of the apartment the server can run in.<br />
In-process servers are loaded into an existing apartment and so do not call CoInitialize or CoInitializeEx; they must use the registry to specify an application's threading model.<br />
Allowable values are: <br />
ThreadingModel=Apartment. Single-threaded apartment.<br />
ThreadingModel=Both. Single-threaded or multithreaded apartment.<br />
ThreadingModel=Free. Multithreaded apartment.<br />
ThreadingModel=Neutral. Neutral apartment (available in Windows 2000).<br />
 <br />
 Insertable   Indicates whether the object is insertable in COM applications.<br />
Objects of this class should appear in the Insert Object dialog box's list box when used by COM container applications.  <br />
 @     String value<br />
Specifies the path to the 32-bit in-process server. <br />
 LocalServer   Full path to a 16-bit local server application <br />
 @     String value<br />
Specifies the full path to the local server, and can include command-line arguments.  <br />
 LocalServer32   Full path to a 32-bit local server application <br />
 @     String value<br />
Specifies the full path to the local server, and can include command-line arguments.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pjw62</div><div class="date">29th August 2001, 20:24</div></div><div class="posttext">&quot;And you dont want to write the class-id's in the NSIS script, instead you want the NSIS to retrieve it from the file in... &quot;<br />
<br />
actually, on reading this, it seems that you also want a way to automatically get the CLSID from a program id, so you dont have to manually find the CLSID.<br />
<br />
I haven't worked with COM/ActiveX objects before, but I think you need CLSIDFromProgID and StringFromCLSID.<br />
<br />
I will implement this in the next release of my nsis dll.<br />
<br />
I think it would be possible though, to load the CLSID directly from the CLSID registry key in HKEY_CLASSES_ROOT\&lt;progid&gt;. This would save a bit in your exe header.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AsPhunck</div><div class="date">31st August 2001, 20:54</div></div><div class="posttext">Thanks a lot... this really helped me out :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AsPhunck</div><div class="date">31st August 2001, 21:25</div></div><div class="posttext">So How do you read the default value with ReadRegStr?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AsPhunck</div><div class="date">1st September 2001, 00:19</div></div><div class="posttext">OK.....<br />
<br />
<br />
Here's a little VBscript tool i made for genereating NSIS code for ActiveX registration.... :p <br />
<br />
I have only tested it briefly so you might want to check it out yourself... I use the generated script in conjunction with the NSIS !include command. It seems to work great.<br />
<br />
This is the &quot;.vbs&quot; CODE... If you want to know how it works i suggest you start reading about the TypeLibInfo object....<br />
<br />
<br />
<br />
<br />
Option Explicit<br />
<br />
Dim LabelOffset <br />
<br />
Dim oFileOut<br />
Dim oFSO<br />
Dim oTLI<br />
<br />
LabelOffset=1<br />
<br />
Set oFSO=CreateObject(&quot;scripting.filesystemobject&quot;)<br />
Set oFileOut = oFso.CreateTextFile(&quot;DLLs-include.NSI&quot;, True)<br />
Set oTLI=CreateObject(&quot;TLI.TLIApplication&quot;)<br />
<br />
dumpTypeLibInfo &quot;c:\winnt\system32\msvbvm60.dll&quot;,&quot;$SysDir&quot;,&quot;c:\winnt\system32\vb6stkit.dll&quot;,true<br />
dumpTypeLibInfo &quot;c:\winnt\system32\comdlg32.ocx&quot;,&quot;$SysDir&quot;,&quot;&quot;,true<br />
dumpTypeLibInfo &quot;c:\winnt\system32\mci32.ocx&quot;,&quot;$SysDir&quot;,&quot;&quot;,true<br />
dumpTypeLibInfo &quot;c:\winnt\system32\mscomctl.ocx&quot;,&quot;$SysDir&quot;,&quot;&quot;,true<br />
dumpTypeLibInfo &quot;c:\winnt\system32\mswinsck.ocx&quot;,&quot;$SysDir&quot;,&quot;&quot;,true<br />
dumpTypeLibInfo &quot;c:\winnt\system32\tabctl32.ocx&quot;,&quot;$SysDir&quot;,&quot;&quot;,true<br />
<br />
<br />
oFileOut.close<br />
<br />
<br />
<br />
Sub dumpTypeLibInfo(localfilename,outpath,additionalfiles,isTypeLib)<br />
	Dim guid<br />
	Dim TII<br />
	Dim fname<br />
	Dim l<br />
	Dim sFiles<br />
	<br />
	Set TII = oTLI.TypeLibInfoFromFile(localfilename)<br />
	<br />
	fname = outpath &amp; &quot;\&quot; &amp; mid(localfilename,instrrev(localfilename,&quot;\&quot;)+1)<br />
	<br />
	<br />
	guid = TII.GUID<br />
	<br />
	<br />
	oFileOut.WriteLine(&quot;SetOutPath &quot;&quot;&quot; &amp; outpath &amp; &quot;&quot;&quot;&quot;)<br />
<br />
	If isTypeLib Then<br />
		oFileOut.WriteLine(&quot;ReadRegStr $9 HKCR &quot;&quot;TYPELIB\&quot; &amp; guid &amp; &quot;\&quot; &amp; TII.majorversion &amp; &quot;.&quot; &amp; TII.minorversion &amp; &quot;\&quot;  &amp; TII.lcid &amp; &quot;\win32&quot;&quot; &quot;&quot;&quot;&quot;&quot;)<br />
	Else<br />
		oFileOut.WriteLine(&quot;ReadRegStr $9 HKCR &quot;&quot;CLSID\&quot; &amp; guid &amp; &quot;\InprocServer32&quot;&quot; &quot;&quot;&quot;&quot;&quot;)<br />
	End If<br />
<br />
	oFileOut.WriteLine(&quot;ClearErrors&quot;)<br />
	oFileOut.WriteLine(&quot;StrCmp $9 &quot;&quot;&quot;&quot; RegisterDLL&quot; &amp; LabelOffset)<br />
	oFileOut.WriteLine(&quot;CompareDLLVersions /STOREFROM &quot;&quot;&quot; &amp; localfilename &amp; &quot;&quot;&quot; &quot;&quot;&quot; &amp; fname &amp; &quot;&quot;&quot; UnRegisterDLL&quot; &amp; LabelOffset &amp; &quot; RegComplete&quot; &amp; LabelOffset)<br />
	oFileOut.WriteLine(&quot;Goto RegComplete&quot; &amp; LabelOffset )<br />
<br />
	oFileOut.WriteLine(&quot;UnRegisterDLL&quot; &amp; LabelOffset &amp; &quot;:&quot;)<br />
	oFileOut.WriteLine(&quot;UnRegDLL &quot;&quot;&quot; &amp; fname &amp; &quot;&quot;&quot;&quot;)<br />
	oFileOut.WriteLine(&quot;Sleep 1000&quot;)<br />
	oFileOut.WriteLine(&quot;RegisterDLL&quot; &amp; LabelOffset &amp; &quot;:&quot;)<br />
	oFileOut.WriteLine(&quot;File &quot;&quot;&quot; &amp; localfilename &amp; &quot;&quot;&quot;&quot;)<br />
	sFiles=split(additionalfiles,&quot;;&quot;)<br />
	For l=0 to UBound(sFiles)<br />
		oFileOut.WriteLine(&quot;File &quot;&quot;&quot; &amp; sFiles(l) &amp; &quot;&quot;&quot;&quot;)<br />
	Next<br />
	oFileOut.WriteLine(&quot;RegDLL &quot;&quot;&quot; &amp; fname &amp; &quot;&quot;&quot;&quot;)<br />
<br />
<br />
	oFileOut.WriteLine(&quot;RegComplete&quot; &amp; LabelOffset &amp; &quot;:&quot;)<br />
	oFileOut.WriteLine(&quot;&quot;)<br />
<br />
	LabelOffset=LabelOffset+1<br />
End sub</div></div><hr />


<div class="post"><div class="posttop"><div class="username">br0kenedge</div><div class="date">3rd March 2003, 20:20</div></div><div class="posttext">I've been looking at safe ActiveX registration and came up with this script that seems to work well.  Is there an easier way?  If anyone has any suggestions or improvments feel free to post.<br />
<br />
------------------<br />
<br />
edited by kichik. please attach huge scripts. attached below :down:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd March 2003, 20:28</div></div><div class="posttext">.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th March 2003, 17:02</div></div><div class="posttext">Seems fine. You can put it in a function since it doesn't use the File command. You can also use the System plug-in to automatically get the GUID. Can you please add it to the archive so everyone else can easily find it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">br0kenedge</div><div class="date">4th March 2003, 23:05</div></div><div class="posttext">&gt;automatically get the GUID.<br />
<br />
I originally thought I would do that.  I figured I could write a DLL plugin to use &quot;TLI.TLIApplication&quot; to extract typeLibInfo.  In order to do this though, I'd have to distribute (and register) TLBINF32.DLL which comes with Visual Studio.<br />
<br />
&gt; System plug-in <br />
<br />
Does the System::call work on In-proc ActiveX components? (The documentation is hairy, it seemed like it was meant for standard DLLs) <br />
<br />
Is there another way?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th March 2003, 15:18</div></div><div class="posttext">I am sorry, I have no idea. I have never worked with ActiveX. Just thought you can call CLSIDFromProgID that pjw mentioned using System.dll but it doesn't seem like it accepts file names.<br />
<br />
System.dll is meant for normal DLLs, but if the function is exported you can call it with System.dll. If they are not exported you'll have to use the same code you'll use with your C plug-in, but then again, it will be simpler to just create a plug-in.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>