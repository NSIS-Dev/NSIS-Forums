<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" MULTIUSER_PAGE_INSTALLMODE page not showing, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  MULTIUSER_PAGE_INSTALLMODE page not showing NSIS Discussion" />
	
	<title> MULTIUSER_PAGE_INSTALLMODE page not showing [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  MULTIUSER_PAGE_INSTALLMODE page not showing</div>
<hr />
<div class="pda"><a href="t-368206.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=368206">MULTIUSER_PAGE_INSTALLMODE page not showing</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">MikeAtkinson</div><div class="date">5th August 2013, 15:06</div></div><div class="posttext">I'm doing a &quot;!include MultiUser.nsh&quot; and &quot;!include &quot;MUI2.nsh&quot;, the &quot;RequestExecutionLevel admin&quot; then later doing a &quot;!insertmacro MULTIUSER_PAGE_INSTALLMODE&quot;. <br />
<br />
For some systems it shows the screen for selecting between “Install for anyone using this compter” and “Install just for me”, but for other systems NSIS skips this screen.<br />
<br />
These are identical computers which are set up in almost identical ways, with all users having administrator privileges. The first part of the file follows:<br />
<br />
   1 !define SRCDIR .<br />
   2 !define COMPANY &quot;Company&quot;<br />
   3 !define DVRNAME &quot;Diver&quot;<br />
   4 <br />
   5 !define VERSION &quot;$%VERSION_NO%-$%VERSION_PATCH%&quot;<br />
   6 !define MULTIUSER_EXECUTIONLEVEL highest<br />
   7 !define MULTIUSER_MUI<br />
   8 !define MULTIUSER_INSTALLMODE_COMMANDLINE<br />
   9 !include MultiUser.nsh<br />
  10 <br />
  11 <br />
  12 Var /GLOBAL DRIVERFILENAME<br />
  13 Var /GLOBAL SETUPDRIVERFILENAME<br />
  14 <br />
  15 # Function that attempts to install an ODBC driver, and gives a retry/cancel<br />
  16 # message box if this fails.<br />
  17 Function installDriver<br />
  18     ClearErrors<br />
  19     install:<br />
  20     nsExec::ExecToStack '&quot;$INSTDIR\wxodbcinst.exe&quot; -d &quot;${DVRNAME}&quot; -o &quot;$DRIVERFILENAME&quot; -s &quot;$SETUPDRIVERFILENAME&quot; -i &quot;$INSTDIR&quot;'<br />
  21     Pop $0    # return value<br />
  22     Pop $1    # message<br />
  23     StrCmp $0 &quot;error&quot; odbcinstexecfail<br />
  24     IntCmp $0 0 installdriverend<br />
  25     installdriverfail:<br />
  26         MessageBox MB_RETRYCANCEL &quot;$1$\r$\n$\r$\nFailed to update ODBC drivers. Have you another ODBC client running? If so, close that application and choose Retry. Otherwise, choose Cancel to abort.&quot; IDRETRY install IDCANCEL installdriverabort<br />
  27 <br />
  28     goto installdriverend<br />
  29 <br />
  30     odbcinstexecfail:<br />
  31         MessageBox MB_OK &quot;Failed to execute wxodbcinst.exe.&quot;<br />
  32         Abort<br />
  33 <br />
  34     installdriverabort:<br />
  35         MessageBox MB_OK &quot;Installation not successful.&quot;<br />
  36         Abort<br />
  37 <br />
  38     installdriverend:<br />
  39 FunctionEnd<br />
  40 <br />
  41 Function .onInit<br />
  42   !insertmacro MULTIUSER_INIT<br />
  43 FunctionEnd<br />
  44 <br />
  45 Function un.onInit<br />
  46   !insertmacro MULTIUSER_UNINIT<br />
  47 FunctionEnd<br />
  48 <br />
  49 <br />
  50 !if $%PLATFORM% == Win64<br />
  51 !define OLDSHORTDESC &quot;64-bit Client Tools&quot;<br />
  52 !define SHORTDESC &quot;64-bit Client Tools&quot;<br />
  53 !define PACKAGE wx2clients64<br />
  54 !else<br />
  55 !define OLDSHORTDESC &quot;32-bit Client Tools&quot;<br />
  56 !define SHORTDESC &quot;32-bit Client Tools&quot;<br />
  57 !define PACKAGE wx2clients32<br />
  58 !endif<br />
  59 <br />
  60 Name &quot;${SHORTDESC}&quot;<br />
  61 !if $%PLATFORM% == Win64<br />
  62 InstallDir &quot;$PROGRAMFILES64\${COMPANY}\${PACKAGE}&quot;<br />
  63 !else<br />
  64 InstallDir &quot;$PROGRAMFILES\${COMPANY}\${PACKAGE}&quot;<br />
  65 !endif<br />
  66 <br />
  67 <br />
  68 InstallDirRegKey HKCU &quot;Software\${PACKAGE}&quot; &quot;&quot;<br />
  69 <br />
  70&gt;outfile &quot;${SRCDIR}/setup.exe&quot;<br />
  71 <br />
  72 RequestExecutionLevel admin<br />
  73 <br />
  74 !include &quot;MUI2.nsh&quot;<br />
  75 <br />
  76 <br />
  77 !define MUI_ICON &quot;${SRCDIR}/icon.ico&quot;<br />
  78 !define MUI_UNICON &quot;${SRCDIR}/icon.ico&quot;<br />
  79 <br />
  80 !define MUI_HEADERIMAGE<br />
  81 !define MUI_HEADERIMAGE_LEFT<br />
  82 !define MUI_HEADERIMAGE_BITMAP &quot;header.bmp&quot;<br />
  83 !define MUI_WELCOMEFINISHPAGE_BITMAP &quot;${NSISDIR}/Contrib/Graphics/Wizard/orange.bmp&quot;<br />
  84 !define MUI_ABORTWARNING<br />
  85 <br />
  86 <br />
  87 !define MUI_WELCOMEPAGE_TEXT &quot;...&quot;<br />
  88 <br />
  89   !insertmacro MUI_PAGE_WELCOME<br />
  90   !insertmacro MUI_PAGE_LICENSE &quot;${SRCDIR}/WX2-EULA.txt&quot;<br />
  91   !insertmacro MUI_PAGE_COMPONENTS<br />
  92   !insertmacro MULTIUSER_PAGE_INSTALLMODE<br />
  93   !insertmacro MUI_PAGE_DIRECTORY<br />
  94   !insertmacro MUI_PAGE_INSTFILES<br />
  95   !insertmacro MUI_PAGE_FINISH<br />
  96   <br />
  97   !insertmacro MUI_UNPAGE_CONFIRM<br />
  98   !insertmacro MUI_UNPAGE_INSTFILES<br />
  99 <br />
 100 <br />
 101 !insertmacro MUI_LANGUAGE &quot;English&quot;<br />
 102 <br />
 103 ...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">5th August 2013, 17:27</div></div><div class="posttext">!define MULTIUSER_EXECUTIONLEVEL highest sets RequestExecutionLevel so why do you set RequestExecutionLevel admin?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MikeAtkinson</div><div class="date">6th August 2013, 09:52</div></div><div class="posttext">Thanks for the prompt response. I have commented out that line, but there is no change.<br />
<br />
I forgot to mention we are running Windows 7 Enterprise N, service pack 1, 64 bit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">7th August 2013, 00:14</div></div><div class="posttext">!define MULTIUSER_EXECUTIONLEVEL highest does not make much sense here, you always want admin rights to install this driver, or can a unelevated user pass the installDriver test if the driver is already installed?<br />
<br />
I would suggest adding some messageboxes to the multiuser code, it does try to abort the page in a couple of places...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>