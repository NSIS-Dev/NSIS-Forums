<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" .onVerifyInstDir help (bug ?!!!), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  .onVerifyInstDir help (bug ?!!!) NSIS Discussion" />
	
	<title> .onVerifyInstDir help (bug ?!!!) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  .onVerifyInstDir help (bug ?!!!)</div>
<hr />
<div class="pda"><a href="t-94100.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=94100">.onVerifyInstDir help (bug ?!!!)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">kont2432</div><div class="date">10th July 2002, 22:07</div></div><div class="posttext">Function .onVerifyInstDir<br />
   StrCpy $4 &quot;a.exe&quot;<br />
   IfFileExists $INSTDIR\$4 Good<br />
	MessageBox MB_OK|MB_ICONSTOP &quot;file does not exist&quot;    	<br />
        Abort<br />
   Good:<br />
FunctionEnd<br />
<br />
This seems to produce the messagebox twice.<br />
Is that a bug ?<br />
Is there a work around it ?<br />
<br />
Thank you in advance</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">11th July 2002, 07:27</div></div><div class="posttext">Search the Forum. It has been discussed before. Workaround: use .onNextPage and .onPrevPage to script an alternative .onVerifyInstDir. Use RegCodeNew or MultIni4 (keywords for search, or find them in the NSIS Archive) for example scripts.<br />
<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kont2432</div><div class="date">11th July 2002, 08:51</div></div><div class="posttext">Thanks for the reply Hendri,<br />
<br />
I did not look at your pointers since I found a <br />
work-around for .onVerifyInstDir here it is:<br />
<br />
Function .onVerifyInstDir<br />
   IntOp $1 $1 + 1  ; increment counter	(was init to 0)<br />
   IntOp $1 $1 % 2  ; possible values of $1 0 and 1<br />
<br />
   IfFileExists $INSTDIR\poop.exe skip2<br />
      IntCmp $1 1 skip2 ; if I compare to 0 then install button is<br />
                        ;not disabled (weird !!)<br />
      MessageBox MB_OK &quot;poop.exe not found $1 times&quot; <br />
          ; display $1 just for testing<br />
      Abort <br />
   skip2:<br />
FunctionEnd<br />
<br />
<br />
PS.  Is there a place to report the NSIS bugs ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">11th July 2002, 08:59</div></div><div class="posttext">See http://www.clantpa.co.uk/nsis/wiki/<br />
for a bug report place.<br />
<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">12th July 2002, 09:23</div></div><div class="posttext">Sorry kont, it does not work. Try this: type in the dirselect box 'c:\p' and the installbutton is activated. Click it and it will be installed. Typing another character leads to a messagebox. Then typing another allows to click install again etc...<br />
<br />
The reason for the two messageboxes in the first place is that the return from &quot;Browse&quot; triggers the .onVerifyInstDir, but also the &quot;EditBox.onChange&quot; (this is done to check dirs when typing something in the editbox). Already a long time ago (I guess in november 2001 :)) I asked if these two routines could be removed and replaced by one: triggering .onVerifyInstDir only at clicking the button &quot;install&quot;. This never happened, I already forgot why actually...<br />
<br />
But now we have .onNextPage, we can replicate this behavior and activate an alternative .onVerifyInstdir only when clicking install. The first version of this alternative construction can be found in RegCode (http://forums.winamp.com/showthread.php?s=&amp;threadid=70530&amp;highlight=regcode). Later on this construction has been implemented in MultIni4 (http://www.clantpa.co.uk/nsis/wiki/index.php/MultIni4) and using MultIni4 again in RegCodeNew (http://www.clantpa.co.uk/nsis/wiki/index.php/RequestUserRegistrationDetails) (both in the NSIS Archive). MultIni4 allows for an easy integration of custom pages and constructions like the alternative .onVerifyInstDir into your installer. Check the function onPageExit and read the comments how to handle it.<br />
<br />
<br />
Haha :) I found my post (http://forums.winamp.com/showthread.php?s=&amp;threadid=68242) about .onVerifyInstDir from the past. It was in October :). Nice to read something from the past. Justin actually never replied. So nothing happened to the behavior of .onVerifyInstDir and no new function .onClickInstall, but that is not necessary anymore thanks to .onNextPage :D.<br />
<br />
<br />
Good luck,<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kont2432</div><div class="date">12th July 2002, 22:36</div></div><div class="posttext">I did not have time to look at it yet,<br />
but, Thanks for the note Hendri !!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th July 2002, 22:58</div></div><div class="posttext">.onVerifyInstDir should be used just to enable the install button.<br />
<br />
From the docs:<br />
<br />
This callback enables control over whether or not an installation path is valid for your installer. This code will be called every time the user changes the install directory, so it shouldn't do anything crazy with MessageBox or the likes. If this function calls Abort, the installation path in $INSTDIR is deemed invalid. <br />
<br />
<br />
If you want to let the user know what kind of directory he needs to pick use DirText.<br />
<br />
The problem is that you are using .onVerifyInstDir the wrong way... If you want a message box after the user chose his directory you would have to use .onNextPage like Smile2Me said.<br />
<br />
I will try to fix that two calls to .onVerifyInstDir bug in my next version of NSIS 1.99.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kont2432</div><div class="date">13th July 2002, 18:40</div></div><div class="posttext">You are right it does say that in the <br />
docs.  I guess I did not pay careful<br />
attention to that paragraph.<br />
<br />
Thanks you kichik</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>