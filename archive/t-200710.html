<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Labels not used on compile but still needed, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Labels not used on compile but still needed NSIS Discussion" />
	
	<title> Labels not used on compile but still needed [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Labels not used on compile but still needed</div>
<hr />
<div class="pda"><a href="t-200710.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=200710">Labels not used on compile but still needed</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">flyakite</div><div class="date">30th November 2004, 18:09</div></div><div class="posttext">Here's my problem.<br />
<br />
I'm using NSIS to patch the uxtheme.dll file for all versions of XP and Server 2003 by using FileWriteByte.  I've successfully setup the code to hex edit the file.<br />
<br />
However what I am trying to do is read the file version, then use the file version read to jump to a label like so:<br />
<br />
<br />
Section &quot;Patch uxtheme.dll&quot;<br />
  ClearErrors<br />
  GetDLLVersion &quot;$SYSDIR\uxtheme.dll&quot; $R0 $R1<br />
    IntOp $0 $R0 / 0x00010000<br />
    IntOp $1 $R0 &amp; 0x0000FFFF<br />
    IntOp $2 $R1 / 0x00010000<br />
    IntOp $3 $R1 &amp; 0x0000FFFF<br />
    StrCpy $4 &quot;$0.$1.$2.$3&quot;<br />
    StrCpy &quot;$5&quot; &quot;V$4&quot;<br />
<br />
  Goto $5<br />
<br />
  DetailPrint &quot;Your uxtheme.dll version is not supported by this patch at the moment.&quot;<br />
  Return<br />
<br />
  V5.1.2600.1106:<br />
  FileOpen $9 &quot;uxtheme.dll&quot; a<br />
  FileSeek $9 0x0000C3FF SET<br />
  FileWriteByte $9 &quot;51&quot;<br />
  FileWriteByte $9 &quot;246&quot;<br />
  FileWriteByte $9 &quot;139&quot;<br />
  FileWriteByte $9 &quot;198&quot;<br />
  FileWriteByte $9 &quot;201&quot;<br />
  FileWriteByte $9 &quot;194&quot;<br />
  FileWriteByte $9 &quot;8&quot;<br />
  FileWriteByte $9 &quot;0&quot;<br />
  FileClose $9<br />
SectionEnd<br />
<br />
<br />
And then when compiling it tells me<br />
  label &quot;V6.0.3790.1159&quot; not used<br />
  label &quot;V6.0.3790.1184&quot; not used<br />
  label &quot;V6.0.3790.1218&quot; not used<br />
  label &quot;V6.0.3790.1247&quot; not used<br />
etc. etc.<br />
<br />
When I run the installer, it correctly reads the file version, but it doesn't jump to the right section.  Instead it just prints &quot;Your uxtheme.dll version is not supported by this patch at the moment.&quot;<br />
<br />
Does anyone know what I can do to solve this without using a million StrCmp functions?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th November 2004, 18:42</div></div><div class="posttext">You could make your life easier and just use VPatch. It is capable of creating multiple patches in one file. You'll replace all of the above code with one line. You can find documentation and examples in Contrib\VPatch.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">flyakite</div><div class="date">30th November 2004, 19:07</div></div><div class="posttext">Yes, but after looking through the VPatch documentation you need the source file AND the new file.  I have the new files, and so from that I discovered what offset I needed to edit for the different file versions.  With VPatch it also creates patch files, which I'd have to include in the installer.  With the WriteFileByte method I just have to include a few lines of code for different file versions, which was already setup to begin with.<br />
<br />
Not to mention the offset is the same for every uxtheme.dll version, independent of the language.  However the different language versions of uxtheme.dll contain different text strings and what-not.<br />
<br />
The patch will be able to edit 35 different uxtheme.dll files.  Using VPatch would take me awhile to setup since they're all named the same and I don't have access to the 35 original files, just the new hacked files.<br />
<br />
I just went ahead and setup StrCmp functions, it didn't take too long.<br />
<br />
<br />
Thanks though.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>