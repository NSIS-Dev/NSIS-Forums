<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Compile with name/version from .ini file, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Compile with name/version from .ini file NSIS Discussion" />
	
	<title> Compile with name/version from .ini file [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Compile with name/version from .ini file</div>
<hr />
<div class="pda"><a href="t-346431.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=346431">Compile with name/version from .ini file</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">mrjohn</div><div class="date">18th July 2012, 08:55</div></div><div class="posttext">Hi !<br />
 We are using variables in our application to store application version number,so the same in NSI file.<br />
When we build another version,we need to modify version into NSI file and also in our source code app.<br />
Is there any way to store version in just on single place,just like .ini file ant read it also at compile time ?<br />
<br />
Thanks !</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th July 2012, 10:52</div></div><div class="posttext">Write a program (it can be written in NSIS) which reads the INI file and generates an NSH file with !defines in it which you !include in your main script.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mrjohn</div><div class="date">18th July 2012, 12:28</div></div><div class="posttext">Thanks !<br />
yes this is a way but if I understood you I must again do 2 things : <br />
1. edit ini file<br />
2. run exe to generate new NSH</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th July 2012, 14:35</div></div><div class="posttext">You automate the execution of the exe using !system. On the next line in your script you !include the outputted file. You can then use !delfile to delete the outputted file if you wish (or use the del command via !system).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mrjohn</div><div class="date">18th July 2012, 16:28</div></div><div class="posttext">Thanks Afrow !<br />
This my code and seems to work  :up:   : <br />
genNSH.nsi:<br />
SilentInstall silent<br />
<br />
var v_major<br />
var v_minor<br />
var v_build<br />
var v_revis<br />
<br />
Name &quot;genNSH&quot;<br />
<br />
OutFile &quot;genNSH.exe&quot;<br />
<br />
RequestExecutionLevel user<br />
<br />
<br />
Section &quot;&quot;<br />
  SetAutoClose true<br />
  SetOverwrite on<br />
<br />
<br />
SectionEnd <br />
<br />
Function .onInit<br />
 ReadINIStr $v_major &quot;\AA\my.ini&quot; &quot;Versiuni&quot; &quot;major&quot;<br />
 ReadINIStr $v_minor &quot;\AA\my.ini&quot; &quot;Versiuni&quot; &quot;minor&quot;<br />
 ReadINIStr $v_build &quot;\AA\my.ini&quot; &quot;Versiuni&quot; &quot;build&quot;<br />
 ReadINIStr $v_revis &quot;\AA\my.ini&quot; &quot;Versiuni&quot; &quot;revision&quot;<br />
<br />
<br />
 FileOpen  $R0 &quot;version.nsh&quot; w<br />
  FileWrite $R0 &quot;!define v_major '$v_major'&quot;<br />
  FileWrite $R0 &quot;$\r$\n&quot;<br />
  FileWrite $R0 &quot;!define v_minor '$v_minor'&quot;<br />
  FileWrite $R0 &quot;$\r$\n&quot;<br />
  FileWrite $R0 &quot;!define v_build '$v_build'&quot;<br />
  FileWrite $R0 &quot;$\r$\n&quot;<br />
  FileWrite $R0 &quot;!define v_revis '$v_revis'&quot;<br />
 FileClose $R0<br />
FunctionEnd<br />
<br />
<br />
usage : <br />
!system '\AA\genNSH.exe'<br />
<br />
!include &quot;version.nsh&quot;<br />
<br />
Name &quot;Example1&quot;<br />
OutFile &quot;example_${v_major}_${v_minor}_${v_build}_${v_revis}.exe&quot;<br />
<br />
InstallDir $DESKTOP\Example1<br />
<br />
RequestExecutionLevel user<br />
<br />
;--------------------------------<br />
<br />
<br />
Page directory<br />
Page instfiles<br />
<br />
Section &quot;&quot;<br />
<br />
  SetOutPath $INSTDIR<br />
  <br />
  SectionEnd<br />
<br />
<br />
my.ini: <br />
[ Versiuni ] <br />
major=1<br />
minor=0<br />
build=0<br />
revision=6</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>