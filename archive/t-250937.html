<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Vista detect installation unsuccessful, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Vista detect installation unsuccessful NSIS Discussion" />
	
	<title> Vista detect installation unsuccessful [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Vista detect installation unsuccessful</div>
<hr />
<div class="pda"><a href="t-250937.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=250937">Vista detect installation unsuccessful</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Voseldop</div><div class="date">12th July 2006, 12:57</div></div><div class="posttext">After install i have Vista dialog, asking me about installation result. How can i supress this dialog? <br />
<br />
Do you have any solutions? What should i do in my installer?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">13th July 2006, 16:33</div></div><div class="posttext">Since I managed to create a NSIS installer without dialog on Vista, are your sure you installer is working correctly and adheres to installer best practices? <br />
<br />
Best is just to compile a NSIS example and install and test this on Vista. <br />
<br />
Make sure you understand elevated rights on Vista.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">15th July 2006, 22:31</div></div><div class="posttext">In your case you need probabbly to ad a manifest for setting privileges in Vista see below:<br />
<br />
Creating an Application Manifest<br />
An application manifest is an eXtensible markup language (XML) file that contains the attributes that describe the application's requirements to the operating system. The following sample shows how to use the requestedExecutionLevel element in the application manifest to ensure that the application runs with elevated privilege.<br />
The terms in italic type should include application specific data. The version, name, and type attributes are mandatory. Otherwise, this sample is complete.<br />
<br />
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;<br />
&lt;assembly xmlns=&quot;urn:schemas-microsoft-com:asm.v1&quot;<br />
	manifestVersion=&quot;1.0&quot;&gt;<br />
	&lt;assemblyIdentity version=&quot;1.0.0.0&quot;<br />
		processorArchitecture=&quot;x86&quot;<br />
		name=&quot;OEM.Division.Model&quot;<br />
		type=&quot;win32&quot;/&gt;<br />
<br />
	&lt;description&gt;Description of your application&lt;/description&gt;<br />
<br />
	&lt;!-- Identify the application security requirements. --&gt;<br />
	&lt;trustInfo xmlns=&quot;urn:schemas-microsoft-com:asm.v3&quot;&gt;<br />
		&lt;security&gt;<br />
			&lt;requestedPrivileges&gt;<br />
				&lt;requestedExecutionLevel<br />
					level=&quot;requireAdministrator&quot;<br />
					uiAccess=&quot;false&quot;/&gt;<br />
			&lt;/requestedPrivileges&gt;<br />
		&lt;/security&gt;<br />
	&lt;/trustInfo&gt;<br />
&lt;/assembly&gt;<br />
<br />
When the level of the requestedExecutionLevel element is requireAdministrator, Windows Vista asks the user to elevate the privilege level before it runs the application. The uiAccess attribute should be false, as shown in the previous example, for a printer Setup application.<br />
For more information, see the paper titled Developer Best Practices and Guidelines for Applications in a Least Privileged Environment. The schema in the application manifest is described in the Platform SDK.<br />
Marking the Application with the Manifest<br />
Mark the application by using the mt.exe tool. Mt.exe is part of the platform SDK, which can be downloaded from MSDN.<br />
For example, if the application manifest file name is oem.manifest and the application is called setup123.exe, you would use the following command to mark the application with the manifest.<br />
mt -manifest oem.manifest -outputresource:setup123.exe;#1<br />
<br />
After running this mt command, Setup123.exe automatically requests permission from Windows to run with elevated rights when it is run on a Windows Vista computer.<br />
Verifying the Change<br />
Verify that the application was successfully marked by running the application. If the application has been marked correctly, Windows automatically displays the User Account Control dialog box to request that the application run with administrator privileges.<br />
Marking the application also modifies the application icon by overlaying the Windows Vista shield icon on the application icon.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Clammerz</div><div class="date">27th July 2006, 15:20</div></div><div class="posttext">onad, thank you for the great information.<br />
How do we go about doing this for the uninstaller too?<br />
Or will modifying the setup manifest apply for the uninstaller too?<br />
<br />
Thank you very much for your time.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">27th July 2006, 16:56</div></div><div class="posttext">Vista OS is &quot;smart&quot; in a way if it detects *SETUP* or *INSTALL* in a filename it expect that it needs elevated rights anyhow,<br />
<br />
(* is a wildcard)<br />
<br />
Have not tested myself by calling your un-installer <br />
<br />
unsetup.exe or uninstall.exe could do the trick also.<br />
<br />
For the rest put a request in the defect(bug) tracker where you request that this resource is added by default.<br />
<br />
( Someone might complain that the (un)install will get about 500 Bytes bigger by default ;) <br />
<br />
Else take the NSIS source, modify by adding the resource and recompile.<br />
<br />
Since I have not much time (Vista Vista Work :( I can not do this for you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">27th July 2006, 17:05</div></div><div class="posttext">Oh and adding the file that is attatched here in the unins.exe folder might help.<br />
<br />
TIP Search the Web for info about .manifest files on XP</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">27th July 2006, 18:37</div></div><div class="posttext">for understanding Windows Vista UAC to improve your NSIS installers:<br />
<br />
http://www.microsoft.com/technet/windowsvista/evaluate/feat/uaprot.mspx</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ckm</div><div class="date">8th September 2006, 08:50</div></div><div class="posttext">Onad,<br />
I followed your suggestion but could not make my unstaller work on Vista. I am not able to write the manifest file into the isntaller using MT.exe so i am shipping the manifest file also along with uninstaller.<br />
<br />
I renamed the unisntaller in the NSI to generate MainUni.exe (Just for testing) and used the same manifest file with one change (requestLevlel set to highestAvailable) and when i click on Mainunit.exe (unisntaller) it gives NSIS error and in the tempp file i see A~NSIS.exe to Z~NSIS.exe files. Could you please share the sample with use. Note my installer doesn't require any admin rights and i am testing mine using Standard USers.<br />
<br />
Thanks for any help /hints<br />
-Chetan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ckm</div><div class="date">8th September 2006, 08:51</div></div><div class="posttext">sorry i forgot to mention my installation works fine without any issues.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">davhunt</div><div class="date">9th October 2006, 19:59</div></div><div class="posttext">I think one of the reasons the dialogue might come up saying it thinks something went wrong with the installation might be that it didn't see any changes in (HKLM or HKCU)\Software\Microsoft\Windows\CurrentVersion\Uninstall\<br />
<br />
As for the manifestation solution, there are some tricky things about tweaking resources.  Many resource editors will obliterate any 'end of file' data - which is where your actual installation information is probably living inside your setup file.<br />
<br />
I think you might have more luck with CVS.  Try playing with the RequestExecutionLevel option. In this case, I think:<br />
   RequestExecutionLevel user<br />
might do the trick. [none and admin are the other two options I see in that tokens.cpp file].</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th October 2006, 18:03</div></div><div class="posttext">As for the manifestation solution, there are some tricky things about tweaking resources. Many resource editors will obliterate any 'end of file' data - which is where your actual installation information is probably living inside your setup file.For that you have !packhdr which is executed before the &quot;end of file&quot; data is written.<br />
<br />
The latest CVS version indeed supports embedding the manifest using RequestExecutionLevel.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>