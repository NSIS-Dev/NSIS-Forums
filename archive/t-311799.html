<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Running UAC plugin as admin - issue, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Running UAC plugin as admin - issue NSIS Discussion" />
	
	<title> Running UAC plugin as admin - issue [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Running UAC plugin as admin - issue</div>
<hr />
<div class="pda"><a href="t-311799.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=311799">Running UAC plugin as admin - issue</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">rizwanjavaid</div><div class="date">8th September 2009, 23:32</div></div><div class="posttext">Hi,<br />
<br />
Apologies if this has been answered before, but I can't seem to find an answer on the forums. I have written an installer under Vista, all works fine when I dont have UAC enabled under Vista. At all times, I am logged into Vista as an admin user.<br />
<br />
Here is the problem. I am modifying my installer so that any Vista UAC prompts that appear, it should deal with them. I am falling over on the first hurdle where I want my installer to be elevated to admin level. Here is my code, relevant bits:<br />
<br />
<br />
!include &quot;UAC.nsh&quot;<br />
...<br />
RequestExecutionLevel user<br />
...<br />
Function .OnInit<br />
	InitPluginsDir<br />
	${UAC.I.Elevate.AdminOnly}<br />
FunctionEnd<br />
<br />
<br />
Here is what I see:<br />
<br />
1) Installer runs, creates a process setup.exe<br />
2) Another process is created too, setup.exe<br />
3) Installer fails with error message &quot;This installer requires admin access, aborting!&quot;<br />
4) Installer fails with error message again &quot;This installer requires admin access, aborting!&quot;<br />
5) Installer quits, processes all gone.<br />
<br />
I have UAC turned on. I am admin user logged into Vista. (Maybe I need to be logged in as standard user?). I read in the forum that even if I am admin user, Vista does not run the installer process as admin user, runs as standard user?<br />
<br />
Maybe I missed something out?<br />
<br />
Any code/advice would be really helpful.<br />
<br />
Thanks<br />
Riz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CrushBug</div><div class="date">9th September 2009, 05:16</div></div><div class="posttext">Sorry, I must be missing something with what you are trying to do. Why don't you just do:<br />
RequestExecutionLevel admin<br />
and not use that plugin at all?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rizwanjavaid</div><div class="date">9th September 2009, 12:56</div></div><div class="posttext">What I am trying to do is use UAC plugin with my installer and run as admin.<br />
<br />
I have tried:<br />
<br />
RequestExecutionLevel user<br />
RequestExecutionLevel admin<br />
<br />
I tried both, I am running Vista as admin user and have the UAC enabled.<br />
<br />
It fails both times with error that I am not admin, I need admin privileges. The code I used in the .OnInit function is:<br />
<br />
Function .OnInit<br />
	InitPluginsDir<br />
	${UAC.I.Elevate.AdminOnly}<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th September 2009, 15:04</div></div><div class="posttext">The first code you posted looks ok, are you saying you don't get a UAC consent dialog at all?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rizwanjavaid</div><div class="date">9th September 2009, 16:38</div></div><div class="posttext">Sorry, I didnt make it clearer, I do get a UAC consent dialog, I click allow, and then I get error where it says that &quot;I need admin rights, aborting&quot;.<br />
<br />
Riz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th September 2009, 21:22</div></div><div class="posttext">the UAC_AdminOnly.nsi sample has the same problem?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rizwanjavaid</div><div class="date">9th September 2009, 23:31</div></div><div class="posttext">Hi Anders,<br />
<br />
I have re-enabled UAC on my user account, rebooted machine and I have tried the UAC_AdminOnly.nsi script in the examples folder.<br />
<br />
It crashes! It says, &quot;UAC_AdminOnly.exe has stopped working, windows is looking for a solution!&quot;, no UAC confirm prompts or anything.<br />
<br />
I have another user account, called testuser. Tried it with that, it has user privileges and same result, application crashes.<br />
<br />
I did try my installer again, I get the UAC prompt, I allow it, and then it loads twice, and fails twice with the &quot;The installer requires admin privileges, aborting!&quot;.<br />
<br />
I am running vista x64 and I am using the Unicode UAC dll in the plugins folder of NSIS 2.45<br />
<br />
Any help or suggestions is much appreciated.<br />
<br />
Thank you<br />
Riz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th September 2009, 23:44</div></div><div class="posttext">unicode uac plugin and unicode nsis?<br />
<br />
Try the ansi plugin and ansi nsis...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>