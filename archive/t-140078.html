<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Long file names problem, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Long file names problem NSIS Discussion" />
	
	<title> Long file names problem [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Long file names problem</div>
<hr />
<div class="pda"><a href="t-140078.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=140078">Long file names problem</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">SprinklerHead</div><div class="date">25th June 2003, 14:14</div></div><div class="posttext">Here is a serious problem that I don't think has been resolved. The only information I could find in the forums about it was here (http://forums.winamp.com/showthread.php?s=&amp;threadid=90175), unfortunately no one responded.<br />
<br />
The problem is long file names (greater than 8 characters, like bigfilename.txt) get renamed incorrectly on reboot (to bigfil~1.txt for example). This occurred on a Win98 machine here at the office, but it could happen on other operating systems as well (I haven't tried).<br />
<br />
Anyone have any ideas on this problem?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">25th June 2003, 14:41</div></div><div class="posttext">The problem is that Win98 is DOS-based, so it renames before Windows starts. This is a Windows limitation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SprinklerHead</div><div class="date">25th June 2003, 14:43</div></div><div class="posttext">Any workaround other than renaming all installation files to &lt;= 8 characters?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">25th June 2003, 14:49</div></div><div class="posttext">Wininit.ini does not support long file names. Files installed using this method should have 8.3 file names.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">25th June 2003, 14:50</div></div><div class="posttext">You could try using &quot;RunOnce&quot; section of the registry to rename files.  If this is not posible directly you might have to write a VB Script or something similar to do the actual renaming once the registry runs your command on startup.<br />
<br />
Hope this helps you.<br />
<br />
Vytautas :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">25th June 2003, 15:09</div></div><div class="posttext">I don't think that will work. Usually installers use rename on reboot to replace system files. To replace 'em, the system files should not be in use.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">25th June 2003, 15:16</div></div><div class="posttext">Originally posted by Joost Verburg <br />
I don't think that will work. Usually installers use rename on reboot to replace system files. To replace 'em, the system files should not be in use.  <br />
<br />
Is there a way to emulate a system file, e.g. make sure it is used like a systems file, so that I could test a script to see if I can get some sort of a solution for this problem?<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th June 2003, 11:16</div></div><div class="posttext">SprinklerHead, what version of NSIS are you using? What is the code you are using? Are you using the UpgradeDLL macro or something else?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SprinklerHead</div><div class="date">26th June 2003, 12:43</div></div><div class="posttext">Kichik, I am using NSIS version 2.03B. I am not using the upgradedll macro. Here is an example of the code I am using.<br />
<br />
<br />
Section<br />
  !insertmacro CopyLockedFile FullUpdater.exe $INSTDIR\SYSTEM &quot;${FilesDir}&quot;<br />
SectionEnd<br />
<br />
;-----------------------------------------<br />
; CopyLockedFile<br />
;-----------------------------------------<br />
; Attempts to copy a file. If the file could not be copied, then<br />
; the file is copied to a temporary location and copied to<br />
; its proper directory after a reboot.<br />
;-----------------------------------------<br />
!macro CopyLockedFile FILE_NAME OUTPUT_PATH LOCAL_PATH<br />
  Push $R1<br />
<br />
  ClearErrors<br />
<br />
  ; Try to copy the file.<br />
  SetOutPath ${OUTPUT_PATH}<br />
  SetOverwrite Try<br />
  File &quot;${LOCAL_PATH}\${FILE_NAME}&quot;<br />
  SetOverwrite On<br />
<br />
  ; If we got an error copying, then the file was in use.<br />
  IfErrors FileNotCopied ExitOut<br />
<br />
  ; The file could not be copied, most likely because it was in use.  <br />
  FileNotCopied:<br />
    ; Create a temporary file. The name of this file will be unique.<br />
    ; The name will be stored in $R1.<br />
    GetTempFileName $R1<br />
<br />
    ; Copy the output file over the temporary file we just created.<br />
    ; For example, this would copy asteel2.exe to j2iofawer.atj<br />
    ; (or some other unique temp file name).<br />
    File /oname=$R1 &quot;${LOCAL_PATH}\${FILE_NAME}&quot;<br />
<br />
    ; Rename and copy the temp file ($R1) to the actual destination,<br />
    ; renaming it to the proper name.<br />
    ; If a reboot is required (probably always), set the reboot flag.<br />
    Rename /REBOOTOK $R1 &quot;${OUTPUT_PATH}\${FILE_NAME}&quot;<br />
    <br />
  ExitOut:<br />
    Pop $R1<br />
!macroend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">26th June 2003, 12:53</div></div><div class="posttext">It's not a NSIS related issue, wininit.ini doesn't support it. Other installers have the same limitation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">26th June 2003, 14:02</div></div><div class="posttext">The Windows API GetShortPathName() (http://msdn.microsoft.com/library/default.asp?url=/library/en-us/fileio/base/getshortpathname.asp) might help here. Maybe NSIS should automatically use this to get the short path name when doing the reboot related stuff.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th June 2003, 14:10</div></div><div class="posttext">MoveFileOnReboot does use GetShortPathName because it's required in wininit.ini. The problem is that for some bizarre reason Windows actually uses the short file name and removes the long file name completely. I am currently looking into workarounds for this.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">26th June 2003, 15:35</div></div><div class="posttext">Originally posted by Sunjammer <br />
The Windows API GetShortPathName() (http://msdn.microsoft.com/library/default.asp?url=/library/en-us/fileio/base/getshortpathname.asp) might help here. Maybe NSIS should automatically use this to get the short path name when doing the reboot related stuff. <br />
Windows automatically converts it to a short filename, as you have descripted in your post.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>