<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Separate uninstall shortucts for each component, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Separate uninstall shortucts for each component NSIS Discussion" />
	
	<title> Separate uninstall shortucts for each component [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Separate uninstall shortucts for each component</div>
<hr />
<div class="pda"><a href="t-321792.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=321792">Separate uninstall shortucts for each component</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">blh83</div><div class="date">18th August 2010, 23:26</div></div><div class="posttext">I have a situation where I would like to be able to have separate uninstaller shortcuts in add/remove programs for each component in my application (yes this is my preferred way as opposed to a component page in the uninstaller for reasons too lengthy to describe).  I had a theory as to what I could do: In each section I would write an uninstaller (using WriteUninstaller) and then add a separate registry key for each component in the Windows uninstall section so that an icon would show up for each one in the add/remove programs list.  This works great.  As a note, I also have uninstaller sections that are specific to each component as mentioned in other posts (e.g. section named &quot;mySection&quot; has uninstaller section &quot;un.mySection&quot;), but that is sort of trivial in regards to my problem.<br />
<br />
I then thought I could simply check the processes and search for the name of the uninstaller executable that is running and determine what needs to be uninstalled based on that.  Unfortunately, no matter which one of the uninstall shortcuts is clicked, it shows up in the processes list as &quot;Au_.exe*32&quot;.  This means I can't differentiate which of the uninstall executables was clicked and throws my whole theory out the window.  Does anyone have any thoughts on how I could have a separate uninstall shortcut for each component?  I have little hope this is possible (or at least straightforward), but a man can dream I guess.  Thanks in advance.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">19th August 2010, 00:10</div></div><div class="posttext">If I were going to do what you describe, I'd create separate installers (by writing and compiling other scripts) for each component, then I'd include those uninstallers in the main installer.<br />
<br />
Each uninstaller would know only about it's one component; each component entry in the Add/Remove program registry key would point to the correct uninstaller for that component. When the user goes to remove that component, it calls 'that' uninstaller, which removes the correct component (and that item from Add/Remove program registry).<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th August 2010, 00:15</div></div><div class="posttext">What about using the command line? Add a switch in the UninstallString path to tell the uninstaller which component to uninstall.<br />
<br />
Use FileFunc.nsh with GetParameters+GetOptions (see NSIS manual).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">blh83</div><div class="date">19th August 2010, 16:05</div></div><div class="posttext">Thank you for the responses, they both sound like good ideas.  I will look into each one and see which best fits my needs.  Thanks again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th August 2010, 19:20</div></div><div class="posttext">Creating another installer and uninstaller script would be definitely be a bit more work.<br />
<br />
All you need in your uninstaller is this:${GetParameters} $R0<br />
${GetOptions} $R0 `/product=` $R0<br />
${If} $R0 == `product 1`<br />
  # do product 1 uninstall<br />
${Else}<br />
  # do product 2 uninstall<br />
${EndIf}Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">20th August 2010, 05:40</div></div><div class="posttext">Actually, you might want to make that:${GetParameters} $R0<br />
${GetOptions} $R0 `/product=` $R0<br />
${If} $R0 == `product 1`<br />
  # do product 1 uninstall<br />
${ElseIf} $R0 == `product 2`<br />
  # do product 2 uninstall<br />
${Else}<br />
  # display error<br />
${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">blh83</div><div class="date">20th August 2010, 17:47</div></div><div class="posttext">I ended up using almost exactly the code that AfrowUK (with MSG's error portion) and it worked great!  Thanks again for the help, I am still a noob to installers in general so I appreciate the patience for what may seem like a simple problem.  For those interested, here is how I added the '/product=' option to the uninstallString:<br />
<br />
WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;UninstallString&quot; &quot;$\&quot;$INSTDIR\Uninstall product.exe$\&quot; /product=aProduct&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pravin</div><div class="date">4th October 2010, 10:20</div></div><div class="posttext">Uninstaller Issue</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pravin</div><div class="date">4th October 2010, 10:26</div></div><div class="posttext">Im new to NSIS installer. Im also facing the above issue. It will be very helpful to me if can explain in detail.<br />
<br />
MY Issue :<br />
-----------<br />
<br />
Im having two components (viz. Client and Server ) in my installer with separate directory path .<br />
<br />
As u have said the reg key for UninstallString has been set but im unable to get the parameter while uninstalling.<br />
<br />
One more thing i would like to know is if i install client and server separateky I will have a two uninstaller which i created by the below code<br />
<br />
<br />
<br />
           WriteUninstaller &quot;$b1\ClientUninstaller.exe&quot;<br />
           WriteUninstaller &quot;$b1\ServerUninstaller.exe&quot;<br />
<br />
How will the software recognize which uninstaller has been triggered.<br />
<br />
Should i pass parameters  in WriteUninstaller ???</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">4th October 2010, 13:24</div></div><div class="posttext">How will the software recognize which uninstaller has been triggered.<br />
Grab the uninstaller filename from $EXEPATH, or add parameters through the uninstall shortcut, or use uninstaller sections, or use FileWriteByte to append specific data to each uninstall.exe.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pravin</div><div class="date">5th October 2010, 09:49</div></div><div class="posttext">Thanks for ur response MSG.<br />
<br />
1.As u said i tried using $EXEPATH . As already discussed by blh83 no matter which one of the uninstall shortcuts is clicked, it shows up in the processes list as &quot;Au_.exe*32&quot;. <br />
<br />
2.Next i tried by passing parameters .<br />
<br />
I dont know where i need to pass the parameters <br />
<br />
whether in WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;UninstallString&quot; &quot;$\&quot;$INSTDIR\Uninstall product.exe$\&quot; /product=aProduct<br />
<br />
or <br />
<br />
WriteUninstaller &quot;$b1\ClientUninstaller.exe <br />
<br />
can u guide me in a detailed manner. Thanks in advance Mr. MSG</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pravin</div><div class="date">5th October 2010, 09:50</div></div><div class="posttext">The only difference between blh83  and me is instead of Au_.exe*32 it shows only Au_.exe.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">5th October 2010, 10:37</div></div><div class="posttext">I dont know where i need to pass the parameters<br />
Parameters isn't a foolproof method, because then the user can still execute the uninstall.exe manually and no parameters will be passed. You should use the FileWriteByte/FileReadByte method:<br />
  FileOpen $0 &quot;$INSTDIR\Uninstall1.exe&quot; a<br />
  FileSeek $0 0 END <br />
  FileWriteByte $0 ${SomeByte}<br />
  FileClose $0<br />
<br />
do the same for uninstall2.<br />
<br />
Then in un.onInit:<br />
  FileOpen $0 $EXEPATH r<br />
  FileSeek $0 -1 END<br />
  FileReadByte $0 $1<br />
  ${If} $0 = ${SomeByte}<br />
    ;uninstall one<br />
  ${Else}<br />
    ;uninstall other<br />
  ${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pravin</div><div class="date">6th October 2010, 16:12</div></div><div class="posttext">Thanks a lot MSG. your response helped me a lot.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">6th October 2010, 16:49</div></div><div class="posttext">Parameters isn't a foolproof method, because then the user can still execute the uninstall.exe manually and no parameters will be passed. You should use the FileWriteByte/FileReadByte method<br />
<br />
That's a pretty clever idea!<br />
Great work, MSG :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">6th October 2010, 17:11</div></div><div class="posttext">Idea leeched entirely from Anders. (Because the appended bytes are not part of the CRC check, he also added basic error checking by adding a number of preset verification bits.)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>