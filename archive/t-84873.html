<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" New User Questions (2 of them), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  New User Questions (2 of them) NSIS Discussion" />
	
	<title> New User Questions (2 of them) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  New User Questions (2 of them)</div>
<hr />
<div class="pda"><a href="t-84873.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=84873">New User Questions (2 of them)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Steevo</div><div class="date">15th April 2002, 22:53</div></div><div class="posttext">First off, thanks for your time.<br />
<br />
Question #1: How do I get the /oname argument to work correctly?<br />
Here is my source<br />
<br />
  GetTempFileName $R1<br />
  SetOutPath $INSTDIR  ;Temp Directory<br />
  File /oname=&quot;$R1 h:\path\filename.exe&quot;<br />
<br />
When executing this I get an &quot;error writing to file:&quot; and it lists the temp path twice.  Example: &quot;c:\temp&quot;c:\temp\nst64.tmp&quot; I believe this is because the $R1 variable includes the entire path as does the $INSTDIR but am not sure.  If so, what is the cleanest way to get just the tempfilename without the full path?<br />
<br />
Question #2: How can one modify the executable header info from NSIS? I'd like to be able to change the version info, copyright info, etc.  and have no idea how to do so.<br />
<br />
Your response is greatly appreciated.  Thanks.<br />
<br />
Steve Behrns</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rainwater</div><div class="date">16th April 2002, 00:15</div></div><div class="posttext">Originally posted by Steevo <br />
<br />
Question #2: How can one modify the executable header info from NSIS? I'd like to be able to change the version info, copyright info, etc.  and have no idea how to do so.<br />
<br />
Your response is greatly appreciated.  Thanks.<br />
<br />
Steve Behrns <br />
<br />
Try setting the BrandingText.  That will change the text at the bottom of the installer.  As far as I know that the only place that NSIS is even mentioned.  I'm not sure what you mean by copyright info?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Steevo</div><div class="date">16th April 2002, 03:58</div></div><div class="posttext">Rereading my post I think I was unclear.  When viewing the properties of most Win32 executables there is a Version tab that includes information like Company Name, File Name, Internal Version, etc.  Once the executable is compiled that information is not changeable.  I was wondering how to modify this information from within an NSI script if possible--prior to compilation.<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rainwater</div><div class="date">16th April 2002, 07:05</div></div><div class="posttext">Originally posted by Steevo <br />
Rereading my post I think I was unclear.  When viewing the properties of most Win32 executables there is a Version tab that includes information like Company Name, File Name, Internal Version, etc.  Once the executable is compiled that information is not changeable.  I was wondering how to modify this information from within an NSI script if possible--prior to compilation.<br />
<br />
Thanks. <br />
<br />
It's not possible from a script because the exehead has already been compiled and the info would be stored in there.  You could easily recompile the exehead with this info just by editing the resource file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th April 2002, 11:39</div></div><div class="posttext">The /oname doesn't work becasue of the quotes... You are telling NSIS that the output name should be &quot;$R1 h:\path\filename.exe&quot;, but I think you want is that the output name will be $R1 and the file to extract is h:\path\filename.exe.<br />
<br />
It should look like this:<br />
File /oname=$R1 h:\path\filename.exe</div></div><hr />


<div class="post"><div class="posttop"><div class="username">veekee</div><div class="date">16th April 2002, 18:09</div></div><div class="posttext">The only way to change header information is to use resource editors .. you can use either PE Explorer (www.heaventools.com/) or Resource Hacker (www.rpi.net.au/~ajohnson/resourcehacker/) !</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rainwater</div><div class="date">16th April 2002, 18:30</div></div><div class="posttext">Originally posted by veekee <br />
The only way to change header information is to use resource editors .. you can use either PE Explorer (www.heaventools.com/) or Resource Hacker (www.rpi.net.au/~ajohnson/resourcehacker/) ! <br />
<br />
If you do that, you need to make sure that you are not using the CRCCheck or it will fail.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">16th April 2002, 19:28</div></div><div class="posttext">Just add a resource with the version info and recompile.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgt-d</div><div class="date">18th April 2003, 16:10</div></div><div class="posttext">&quot;It's not possible from a script because the exehead has already been compiled and the info would be stored in there. You could easily recompile the exehead with this info just by editing the resource file.&quot;<br />
<br />
&quot;Just add a resource with the version info and recompile.&quot;<br />
<br />
ok, i've used resource hacker a million times, but these replies don't make any sense.  what resource file?  i mean, got any examples laying around?  cuz i sure can't get this to work.<br />
<br />
versioninfo should definitely be an option that can be called from your script (somehow).<br />
<br />
i would like to see an example for nsis.  i've had to make versioninfo resource files in older versions of delphi, but the replies i'm seeing for doing this in nsis are so vague that it's impossible to determine how to do it.<br />
<br />
thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th April 2003, 16:25</div></div><div class="posttext">The easiet way would be compiling NSIS with dummy version info and then changing it using Resource Hacker while compiling the script using this kind of command:<br />
<br />
!packhdr tmp.dat '&quot;C:\program files\reshacker\res.exe&quot; tmp.dat'<br />
<br />
If you don't have a compiler you'd have to add the version info manually. You'd have have to use the same command but a different method in the resource editor. The resource editor help should say something about adding resources.<br />
<br />
versioninfo should definitely be an option that can be called from your script (somehow). <br />
<br />
It's in the todo list.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgt-d</div><div class="date">18th April 2003, 16:58</div></div><div class="posttext">hmm.  good info, but still no hardcore examples.  ok, here's is my best effort so far, and it still failed.<br />
<br />
i didn't know the correct info for the versioninfo resource, so i found a delphi exe that i made that does have a version tab.<br />
<br />
i used resource hacker to extract the versioninfo resource to a file on my desktop.  the contents:<br />
<br />
1 VERSIONINFO<br />
FILEVERSION 1,0,0,0<br />
PRODUCTVERSION 1,0,0,0<br />
FILEOS 0x4<br />
FILETYPE 0x1<br />
{<br />
BLOCK &quot;StringFileInfo&quot;<br />
{<br />
	BLOCK &quot;040904E4&quot;<br />
	{<br />
		VALUE &quot;CompanyName&quot;, &quot;Whatever, Inc.&quot;<br />
		VALUE &quot;FileDescription&quot;, &quot;Blah RC1&quot;<br />
		VALUE &quot;FileVersion&quot;, &quot;1.0.0.0&quot;<br />
		VALUE &quot;InternalName&quot;, &quot;&quot;<br />
		VALUE &quot;LegalCopyright&quot;, &quot;&quot;<br />
		VALUE &quot;LegalTrademarks&quot;, &quot;&quot;<br />
		VALUE &quot;OriginalFilename&quot;, &quot;&quot;<br />
		VALUE &quot;ProductName&quot;, &quot;&quot;<br />
		VALUE &quot;ProductVersion&quot;, &quot;1.0.0.0&quot;<br />
		VALUE &quot;Comments&quot;, &quot;Created by [SoD]Sgt-D&quot;<br />
	}<br />
}<br />
<br />
BLOCK &quot;VarFileInfo&quot;<br />
{<br />
	VALUE &quot;Translation&quot;, 0x0409 0x04E4<br />
}<br />
}<br />
<br />
ok, looks good, right?  so now i open my nsis exe in resource hacker and tell it to add in a new resource, from the file i saved on my desktop.<br />
<br />
resource type = version info<br />
resource name = 1<br />
resource language = 1033<br />
<br />
resource hacker shows everything 100% identical to my delphi exe, so it should work fine.  when i save the new exe, nothing.  no version tab.  i even tried modifying the information and clicking the &quot;compile script&quot; button.<br />
<br />
no matter what i try, it never creates the version info tab.<br />
<br />
if this really is the easiest way, then i'm screwed.  :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th April 2003, 17:04</div></div><div class="posttext">Which file exactly did you edit with Resource Hacker? If you use this line:<br />
!packhdr tmp.dat '&quot;C:\program files\reshacker\res.exe&quot; tmp.dat' <br />
And save NSIS will use the new EXE header. Make sure Resource Hacker really does add the information (find tmp.dat, rename it to .exe and check for the version tab).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgt-d</div><div class="date">18th April 2003, 18:39</div></div><div class="posttext">bah, i have no idea how to put &quot;dummy&quot; version information into my nsis script, or i don't know what you mean by that comment.  i don't have a compiler, just nsis...  so i'm not sure what &quot;You'd have have to use the same command but a different method in the resource editor&quot; - again, too vague.  i've read the resource hacker help file for adding and extracting resources, seems to work fine...  like test.rc.  so i don't know where tmp.dat is coming from in &quot;!packhdr tmp.dat ...&quot;.  i tried writing a basic nsis script use your command...<br />
<br />
!packhdr tmp.dat '&quot;C:\program files\reshacker\res.exe&quot; tmp.dat' <br />
<br />
i even tried substituting test.rc in place of tmp.dat.  during nsis compile it shows the main resource hacker screen, with none of my versioninfo, then when i close resource hacker it systematically deletes my test.rc file and i get a new exe with no version tab.<br />
<br />
unless someone has a good example i'm just going to drop it.  as far as i can tell, despite suggestions in this forum, there really is no &quot;easy&quot; way to do this, and certainly no examples of it anywhere.  maybe the version info (from the todo list) will be added to scripts sometime soon!  ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th April 2003, 18:48</div></div><div class="posttext">I am happy to declare you as the first example I have ever seen :)<br />
<br />
Lets start from the begining (ignore the compiler note and the dummy and easiet way). !packhdr tells NSIS to dump the EXE header to a certain file (tmp.dat in the above case) and then calls the program in the second parameter. This program can do whatever it wants with the EXE header, in your case it should add a version resource. After the program exits NSIS will read the edited EXE header and use it instead of the old one.<br />
<br />
The only part you should handle (besides adding that command to the script) is the addition of the resource to the EXE header, and that you have already done according to you. Just don't forget to save ;)<br />
<br />
I hope that's a bit more clear now :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgt-d</div><div class="date">18th April 2003, 19:25</div></div><div class="posttext">ok, i think i totally understand you now.  but i'm still having problems.  remember the sample version info resource i showed earlier?  i just grabbed an old exe, i even tried a windows xp exe, and i used resource hacker to extract the resource - just for version info.  here's a sample:<br />
<br />
1 VERSIONINFO<br />
FILEVERSION 1,0,0,0<br />
PRODUCTVERSION 1,0,0,0<br />
FILEOS 0x4<br />
FILETYPE 0x1<br />
{<br />
BLOCK &quot;StringFileInfo&quot;<br />
{<br />
	BLOCK &quot;040904E4&quot;<br />
	{<br />
		VALUE &quot;CompanyName&quot;, &quot;&quot;<br />
		VALUE &quot;FileDescription&quot;, &quot;VersionInfo Test #1&quot;<br />
		VALUE &quot;FileVersion&quot;, &quot;1.0.0.0&quot;<br />
		VALUE &quot;InternalName&quot;, &quot;&quot;<br />
		VALUE &quot;LegalCopyright&quot;, &quot;&quot;<br />
		VALUE &quot;LegalTrademarks&quot;, &quot;&quot;<br />
		VALUE &quot;OriginalFilename&quot;, &quot;&quot;<br />
		VALUE &quot;ProductName&quot;, &quot;&quot;<br />
		VALUE &quot;ProductVersion&quot;, &quot;1.0.0.0&quot;<br />
		VALUE &quot;Comments&quot;, &quot;&quot;<br />
	}<br />
}<br />
<br />
BLOCK &quot;VarFileInfo&quot;<br />
{<br />
	VALUE &quot;Translation&quot;, 0x0409 0x04E4<br />
}<br />
}<br />
<br />
now i should be able to manually add that resource to any exe or dll that i want to, right?  well, i can add it to every file on my hard drive, and i can save the new file with the resource inside (it looks 100% correct by the way) --- but when i right click the new exe, no version tab.<br />
<br />
i tried exporting the resource as a text file and also as a binary flie, but if i can't use resource hacker successfully add a version tab, i will never get it to work right from my nsis script.<br />
<br />
if someone can help with getting it to work manually so that i can display a version tab, i will gladly submit my nsis command line that can automatically add the resources for you.<br />
<br />
thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th April 2003, 20:17</div></div><div class="posttext">I have been playing around with Resource Hacker and finally found the exact way to do this (docs didn't help much =/):<br />
<br />
1) Open a DLL/EXE with a version resource<br />
2) Click on the version resource<br />
3) Action-&gt;Save Resource as a *.res file ...<br />
4) Save it somewhere<br />
5) Open your EXE (with !packhdr in our case)<br />
6) Action-&gt;Add a new Resource ...<br />
7) Choose the file you have just exported from the last EXE/DLL<br />
8) Chooes the version info resource in the dialog<br />
9) Edit the newly added resource<br />
10) Done! :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgt-d</div><div class="date">18th April 2003, 20:25</div></div><div class="posttext">heh, yeah, i just saw &quot;save as .res&quot; and came back to post a little message about finally successfully getting a version tab.  thanks for the help.  ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgt-d</div><div class="date">18th April 2003, 22:18</div></div><div class="posttext">A sample script to add Version tabs to your NSIS Installer Executables!<br />
<br />
This is a fully automatic method which can be implemented seamlessly into all of your NSIS scripts to automagically add Version Tabs for your installers!<br />
<br />
See the attachment for more information.  :)<br />
<br />
-sgt</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th April 2003, 22:22</div></div><div class="posttext">Nice... How about creating an archive (http://nsis.sf.net/archive) page for it so anybody can track it down easily?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">19th April 2003, 00:01</div></div><div class="posttext">Maybe I'm wrong :p but It doesn't for me on my XP:<br />
this is the code:<br />
<br />
!define ResDir &quot;C:\JOELITO\utilidades\NsisRes&quot; <br />
!packhdr tmp.dat '&quot;${ResDir}\ResHacker.exe&quot; -addoverwrite tmp.dat, tmp.dat, ${ResDir}\test.res, versioninfo,1,'<br />
<br />
Is it right? :weird:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgt-d</div><div class="date">19th April 2003, 01:24</div></div><div class="posttext">!define ResDir &quot;C:\JOELITO\utilidades\NsisRes&quot;<br />
!packhdr tmp.dat '&quot;${ResDir}\ResHacker.exe&quot; -addoverwrite tmp.dat, tmp.dat, ${ResDir}\test.res, versioninfo,1,'<br />
test.res isn't in your ResHack folder - so use test.res, not ${ResDir}\test.res<br />
<br />
does that fix it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgt-d</div><div class="date">19th April 2003, 02:05</div></div><div class="posttext">Nice... How about creating an archive (http://nsis.sf.net/archive) page for it so anybody can track it down easily?VIT - Version Info Tabsheets for NSIS (http://nsis.sourceforge.net/archive/nsisweb.php?page=246&amp;instances=0,64)<br />
 <br />
I am attaching the ZIP to this forum because I couldn't find a way to add it to the new Archive page.<br />
<br />
Thanks everyone for all of the help today...  it finally paid off!<br />
<br />
:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">19th April 2003, 02:15</div></div><div class="posttext">Nop, :(<br />
I'll try another ways :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgt-d</div><div class="date">19th April 2003, 04:12</div></div><div class="posttext">!define ResDir &quot;C:\JOELITO\utilidades\NsisRes&quot;<br />
!packhdr tmp.dat '&quot;${ResDir}\ResHacker.exe&quot; -addoverwrite tmp.dat, tmp.dat, ${ResDir}\test.res, versioninfo,1,'<br />
hmm, without the define, does this work?:<br />
<br />
!packhdr tmp.dat '&quot;C:\JOELITO\utilidades\NsisResResHacker.exe&quot; -addoverwrite tmp.dat, tmp.dat, test.res, versioninfo,1,'<br />
<br />
also, you might want to grab VIT.ZIP (http://forums.winamp.com/attachment.php?s=&amp;postid=931862) as mentioned in my previous post.  it's better than the versioninfo.zip i posted earlier.  it has updated info and might i made it a little easier to follow.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">19th April 2003, 10:36</div></div><div class="posttext">Wouldn't it be simple to add an instruction to NSIS that tells the compiler that it has to take the specified .res-file and set the version information with it?<br />
AltVersionInfo &quot;${NSISDIR}\Contrib\AltVersionInfo\template.res&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgt-d</div><div class="date">19th April 2003, 12:35</div></div><div class="posttext">Originally posted by virtlink <br />
Wouldn't it be simple to add an instruction to NSIS that tells the compiler that it has to take the specified .res-file and set the version information with it?<br />
AltVersionInfo &quot;${NSISDIR}\Contrib\AltVersionInfo\template.res&quot;  god...  wouldn't that be awesome!  ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">19th April 2003, 15:26</div></div><div class="posttext">Agree with you virtlink :up:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgt-d</div><div class="date">19th April 2003, 16:05</div></div><div class="posttext">what would make that even better is if we could type the version info in normal text and nsis could convert it to the binary res file...  that way nobody would have to rely on resource hacker.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th April 2003, 16:18</div></div><div class="posttext">Yes VirtLink, it's simple. Try it and you'll see.<br />
<br />
It's on the todo list.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">19th April 2003, 22:57</div></div><div class="posttext">In one moment of thinking :weird:<br />
How does Nsis &quot;embed&quot; the XP Manifest in the installer?<br />
Maybe I'll be the same with the .res information, isn't?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">20th April 2003, 11:45</div></div><div class="posttext">The NSIS compiler has a resource updater that handles all resource updated. Useles dialog resources are also being removed using this updater.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgt-d</div><div class="date">21st April 2003, 00:38</div></div><div class="posttext">i'd like to know how to use it     ;(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">21st April 2003, 09:38</div></div><div class="posttext">You can't. It's code inside makensis which is invoked for very specific reasons during compilation. For example, your installer only uses some of the page types so makensis decides you don't need the resources for the others and removes them. Or you turn XPStyle on, makensis adds an XP manifest into your installer binary. The code that does these things is not available to you directly.<br />
<br />
If you are still interested in the code look in CVS or your NSIS folder at source/ResourceEditor.cpp.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>