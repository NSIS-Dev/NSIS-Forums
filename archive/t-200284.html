<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Leave a directory behind on uninstall, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Leave a directory behind on uninstall NSIS Discussion" />
	
	<title> Leave a directory behind on uninstall [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Leave a directory behind on uninstall</div>
<hr />
<div class="pda"><a href="t-200284.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=200284">Leave a directory behind on uninstall</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Llynix</div><div class="date">26th November 2004, 17:42</div></div><div class="posttext">So far these forums have been very useful, special thanks to all who have posted.<br />
<br />
I tried searching for the answer to this one but couldn't quite find the perfect solution.<br />
<br />
I want the user to have an option to save a certain directory called cache upon uninstall.<br />
<br />
The Directory struction of the program is:<br />
<br />
Cache<br />
Configuration<br />
Data<br />
src<br />
Utils<br />
and then numerous dll's and other files in the default install directory.<br />
<br />
Any ideas how I can preserve the cache directory if the user wants to?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scrose</div><div class="date">26th November 2004, 18:11</div></div><div class="posttext">For similar circumstances I have used something like this.Var keepCache<br />
<br />
Function un.onInit<br />
  MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 &quot;Are you sure you want to uninstall ${PRODUCT_NAME}?&quot; IDYES +2<br />
  Abort<br />
  MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON1 &quot;Do you want to keep your cache folder?&quot; IDNO +2<br />
  StrCpy $keepCache &quot;Yes&quot;<br />
FunctionEnd<br />
<br />
Section Uninstall<br />
  StrCmp $keepCache &quot;Yes&quot; +2<br />
  Delete &quot;$INSTDIR\Cache\*.*&quot;<br />
  Delete &quot;$INSTDIR\Configuration\*.*&quot;<br />
  Delete &quot;$INSTDIR\Data\*.*&quot;<br />
  Delete &quot;$INSTDIR\src\*.*&quot;<br />
  Delete &quot;$INSTDIR\Utils\*.*&quot;<br />
<br />
  StrCmp $keepCache &quot;Yes&quot; +2<br />
  RMDir &quot;$INSTDIR\Cache&quot;<br />
  RMDir &quot;$INSTDIR\Configuration&quot;<br />
  RMDir &quot;$INSTDIR\Data&quot;<br />
  RMDir &quot;$INSTDIR\src&quot;<br />
  RMDir &quot;$INSTDIR\Utils&quot;<br />
SectionEndHave the StrCmp jump over the Deletes and RMDirs that should skipped.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Llynix</div><div class="date">26th November 2004, 18:25</div></div><div class="posttext">Originally posted by scrose <br />
For similar circumstances I have used something like this.<br />
<br />
(snip)<br />
<br />
Have the StrCmp jump over the Deletes and RMDirs that should skipped.  <br />
<br />
Thank you, one additional question.  How would I remove all the loose files,  &quot;DELETE $INSTDIR\*&quot; ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scrose</div><div class="date">26th November 2004, 18:33</div></div><div class="posttext">Yes, something like this.Delete &quot;$INSTDIR\*.*&quot;<br />
RMDir &quot;$INSTDIR&quot;But be careful when using *.* with Delete; you might erase something you didn't instead to. If possible, it's much safer to have a separate Delete command for each file you want to uninstall. Same is true for RMDir.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th November 2004, 21:07</div></div><div class="posttext">Be careful with this:  StrCmp $keepCache &quot;Yes&quot; +2<br />
  Delete &quot;$INSTDIR\Cache\*.*&quot;<br />
  Delete &quot;$INSTDIR\Configuration\*.*&quot;<br />
  Delete &quot;$INSTDIR\Data\*.*&quot;<br />
  Delete &quot;$INSTDIR\src\*.*&quot;<br />
  Delete &quot;$INSTDIR\Utils\*.*&quot;<br />
<br />
  StrCmp $keepCache &quot;Yes&quot; +2<br />
  RMDir &quot;$INSTDIR\Cache&quot;<br />
  RMDir &quot;$INSTDIR\Configuration&quot;<br />
  RMDir &quot;$INSTDIR\Data&quot;<br />
  RMDir &quot;$INSTDIR\src&quot;<br />
  RMDir &quot;$INSTDIR\Utils&quot;<br />
<br />
Firstly you only need one StrCmp for the whole lot and secondly you're using +2 (only jumping over the first command!)  StrCmp $keepCache &quot;Yes&quot; keepCache<br />
  Delete &quot;$INSTDIR\Cache\*.*&quot;<br />
  Delete &quot;$INSTDIR\Configuration\*.*&quot;<br />
  Delete &quot;$INSTDIR\Data\*.*&quot;<br />
  Delete &quot;$INSTDIR\src\*.*&quot;<br />
  Delete &quot;$INSTDIR\Utils\*.*&quot;<br />
<br />
  RMDir &quot;$INSTDIR\Cache&quot;<br />
  RMDir &quot;$INSTDIR\Configuration&quot;<br />
  RMDir &quot;$INSTDIR\Data&quot;<br />
  RMDir &quot;$INSTDIR\src&quot;<br />
  RMDir &quot;$INSTDIR\Utils&quot;<br />
 keepCache:<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scrose</div><div class="date">26th November 2004, 21:12</div></div><div class="posttext">Llynix only wanted to keep the Cache directory. That's why each StrCmp only jumped over one line.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th November 2004, 21:48</div></div><div class="posttext">Ah my mistake.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">26th November 2004, 22:14</div></div><div class="posttext">the RMDir skip is not really needed (unless you want to keep the folder even if it's empty)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>