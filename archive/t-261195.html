<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" bug with next button and multiple languages, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  bug with next button and multiple languages NSIS Discussion" />
	
	<title> bug with next button and multiple languages [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  bug with next button and multiple languages</div>
<hr />
<div class="pda"><a href="t-261195.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=261195">bug with next button and multiple languages</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">bowman2</div><div class="date">6th December 2006, 07:28</div></div><div class="posttext">Hi<br />
<br />
I have an installer that supports both English and German. The localization to German works fine, except for the first button on the install welcome page, which says &quot;next&quot;, ut the localized text on the welcome page says in German that in order to continue, you should press &quot;weiter&quot;. Is this a bug or did I forget something - all the other buttons are localized correctly?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jdannenb</div><div class="date">6th December 2006, 07:38</div></div><div class="posttext">Hi, can't confirm this one. At least with NSIS 2.22 all buttons on my multilang installer are localized correctly.<br />
<br />
Greez<br />
Jens</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bowman2</div><div class="date">6th December 2006, 07:53</div></div><div class="posttext">Updated to NSIS 2.22 - still same problem...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">6th December 2006, 08:34</div></div><div class="posttext">Could you post a sample?<br />
<br />
Cheers<br />
<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bowman2</div><div class="date">6th December 2006, 09:52</div></div><div class="posttext">Hi again<br />
<br />
The code is:<br />
<br />
<br />
;--------------------------------<br />
;Include Modern UI<br />
<br />
  !include &quot;MUI.nsh&quot;<br />
<br />
;--------------------------------<br />
;General<br />
<br />
  ;Name and file<br />
  Name &quot;foobar&quot;<br />
  OutFile foobar.exe&quot;<br />
  XPStyle on<br />
  <br />
  ;Default installation folder<br />
  InstallDir &quot;$PROGRAMFILES\foobar&quot;<br />
  <br />
  ;Get installation folder from registry if available<br />
  InstallDirRegKey HKCU &quot;Software\foobar&quot; &quot;&quot;<br />
  <br />
  <br />
;--------------------------------<br />
;Interface Configuration<br />
<br />
  !define MUI_ABORTWARNING<br />
  !define MUI_PAGE_CUSTOMFUNCTION_SHOW &quot;FinishShow&quot;<br />
  !define MUI_FINISHPAGE_RUN &quot;$INSTDIR\foobar.exe&quot;<br />
<br />
;--------------------------------<br />
;Definitions<br />
<br />
!define SHCNE_ASSOCCHANGED 0x8000000<br />
!define SHCNF_IDLIST 0<br />
!define PRODUCT_UNINST_ROOT_KEY &quot;HKLM&quot;<br />
!define PRODUCT_UNINST_KEY &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\foobar&quot;<br />
;--------------------------------<br />
<br />
; Language Selection Dialog Settings<br />
!define MUI_LANGDLL_REGISTRY_ROOT &quot;${PRODUCT_UNINST_ROOT_KEY}&quot;<br />
!define MUI_LANGDLL_REGISTRY_KEY &quot;${PRODUCT_UNINST_KEY}&quot;<br />
!define MUI_LANGDLL_REGISTRY_VALUENAME &quot;NSIS:Language&quot;<br />
<br />
<br />
;--------------------------------<br />
;Pages<br />
<br />
  !insertmacro MUI_PAGE_WELCOME<br />
  !insertmacro MUI_PAGE_LICENSE $(LicenseString)<br />
  !insertmacro MUI_PAGE_COMPONENTS<br />
  !insertmacro MUI_PAGE_DIRECTORY<br />
  !insertmacro MUI_PAGE_INSTFILES<br />
  !insertmacro MUI_PAGE_FINISH<br />
  <br />
<br />
  !insertmacro MUI_UNPAGE_WELCOME<br />
  !insertmacro MUI_UNPAGE_CONFIRM<br />
  !insertmacro MUI_UNPAGE_LICENSE $(LicenseString)<br />
  !insertmacro MUI_UNPAGE_INSTFILES<br />
  !insertmacro MUI_UNPAGE_FINISH<br />
 <br />
;--------------------------------<br />
;Languages<br />
 <br />
  !insertmacro MUI_LANGUAGE &quot;English&quot;<br />
  !insertmacro MUI_LANGUAGE &quot;German&quot;<br />
<br />
;--------------------------------<br />
;License Language String<br />
<br />
  LicenseLangString LicenseString ${LANG_ENGLISH} &quot;P:\Products\foobar\Installer\Resources\en-License.rtf&quot;<br />
  LicenseLangString LicenseString ${LANG_GERMAN} &quot;P:\Products\foobar\Installer\Resources\de-License.rtf&quot;<br />
  <br />
;--------------------------------<br />
;Other Language strings<br />
  LangString foobarMissing ${LANG_ENGLISH} &quot;This text is always shown when dialog box pops up&quot;<br />
  LangString foobarMissing ${LANG_GERMAN} &quot;This text is never shown (unless English language is removed and German is the only option)&quot;<br />
<br />
;--------------------------------<br />
<br />
Function .onInit<br />
<br />
<br />
	;------------------Language selection dialog<br />
	<br />
	Push &quot;&quot;<br />
	Push ${LANG_ENGLISH}<br />
	Push English<br />
	Push ${LANG_GERMAN}<br />
	Push German<br />
	Push A ; A means auto count languages<br />
	       ; for the auto count to work the first zempty push (Push &quot;&quot;) must remain<br />
	LangDLL::LangDialog &quot;Installer Language&quot; &quot;Please select the language of the installer&quot;<br />
<br />
	Pop $LANGUAGE<br />
	StrCmp $LANGUAGE &quot;cancel&quot; 0 +2<br />
		Abort<br />
		<br />
	MessageBox MB_YESNO $(foobarMissing) IDOK<br />
   	 Abort ; causes installer to quit.<br />
    <br />
FunctionEnd<br />
<br />
;--------------------------------<br />
<br />
Function FinishShow<br />
  GetDlgItem $0 $HWNDPARENT 3<br />
  ShowWindow $0 0                ;Hides the Back Button<br />
  GetDlgItem $0 $HWNDPARENT 2<br />
  ShowWindow $0 0                ;Hides the Cancel Button<br />
  GetDlgItem $0 $HWNDPARENT 1<br />
  SendMessage $0 ${WM_SETTEXT} 0 &quot;STR:Next&quot;<br />
FunctionEnd<br />
<br />
;--------------------------------<br />
<br />
;Installer Sections<br />
<br />
Section &quot;-foobar Section&quot; Secfoobar<br />
<br />
  SetOutPath $INSTDIR\Assets<br />
  File /r &quot;Assets\*.*&quot;<br />
  SetOutPath $INSTDIR\Help<br />
  File /r &quot;Help\*.*&quot;<br />
  SetOutPath $INSTDIR<br />
  File &quot;foobar.exe&quot;<br />
  File &quot;*.dll&quot;<br />
  <br />
  ReadRegStr $0 HKCU &quot;Software\foobar&quot; &quot;version&quot;<br />
<br />
  ;Store installation folder<br />
  WriteRegStr HKCU &quot;Software\foobar&quot; &quot;&quot; $INSTDIR<br />
  WriteRegStr HKCU &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\foobar&quot; &quot;DisplayName&quot; &quot;foobar&quot;<br />
  WriteRegStr HKCU &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\foobar&quot; &quot;UninstallString&quot; &quot;$INSTDIR\Uninstall.exe&quot;<br />
<br />
  ;Create uninstaller<br />
  WriteUninstaller &quot;$INSTDIR\Uninstall.exe&quot;<br />
<br />
SectionEnd<br />
<br />
;Assign language strings to sections<br />
  !insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br />
    !insertmacro MUI_DESCRIPTION_TEXT ${Secfoobar} $(DESC_Secfoobar)<br />
  !insertmacro MUI_FUNCTION_DESCRIPTION_END<br />
<br />
;--------------------------------<br />
<br />
Function un.onInit<br />
<br />
  !insertmacro MUI_UNGETLANGUAGE<br />
<br />
FunctionEnd<br />
<br />
;Uninstaller Section<br />
<br />
Section &quot;Uninstall&quot;<br />
<br />
<br />
  ;ADD YOUR OWN FILES HERE...<br />
  RMDir /r &quot;$INSTDIR\Assets&quot;<br />
  RMDir /r &quot;$INSTDIR\Help&quot;<br />
  Delete &quot;$INSTDIR\foobar.exe&quot;<br />
  Delete &quot;$INSTDIR\*.dll&quot;<br />
<br />
  <br />
  Delete &quot;$INSTDIR\Uninstall.exe&quot;<br />
  RMDir &quot;$INSTDIR&quot;<br />
<br />
  DeleteRegKey HKCU &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\foobar&quot;<br />
  DeleteRegKey HKCU &quot;Software\foobar&quot;<br />
<br />
<br />
SectionEnd<br />
<br />
<br />
I have attached a screenshot of the (slightly modified) welcome page<br />
<br />
Another issue is that for the message box code, it is always the text in English that is shown - not German.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">6th December 2006, 10:11</div></div><div class="posttext">Have a closer look to this code:<br />
<br />
You're executing FinishShow before welcome.<br />
<br />
;--------------------------------<br />
;Interface Configuration<br />
<br />
  !define MUI_ABORTWARNING<br />
  !define MUI_PAGE_CUSTOMFUNCTION_SHOW &quot;FinishShow&quot;<br />
<br />
And this sets the caption of the button as well...<br />
<br />
Function FinishShow<br />
  GetDlgItem $0 $HWNDPARENT 3<br />
  ShowWindow $0 0                ;Hides the Back Button<br />
  GetDlgItem $0 $HWNDPARENT 2<br />
  ShowWindow $0 0                ;Hides the Cancel Button<br />
  GetDlgItem $0 $HWNDPARENT 1<br />
  SendMessage $0 ${WM_SETTEXT} 0 &quot;STR:Next&quot;<br />
FunctionEnd<br />
<br />
<br />
Cheers<br />
<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bowman2</div><div class="date">6th December 2006, 10:27</div></div><div class="posttext">Thanks Bruno<br />
<br />
That solved the mystery. Now, how about when an alertbox pops up and it is only the English text that shows up, even when German has been selected</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">6th December 2006, 10:41</div></div><div class="posttext">You're welcome!<br />
<br />
You have to use <br />
<br />
;Interface Configuration<br />
  !define MUI_CUSTOMFUNCTION_GUIINIT onGUIInit ; &lt;---<br />
  !define MUI_ABORTWARNING<br />
<br />
Function onGUIInit<br />
	MessageBox MB_YESNO $(foobarMissing) IDOK<br />
FunctionEnd<br />
<br />
Here's the reason:<br />
<br />
http://forums.winamp.com/showthread.php?postid=2068050#post2068050<br />
<br />
And: I'd recommend using the MUI_LANGDLL...<br />
Have a look at Section 5 in<br />
http://nsis.sourceforge.net/Docs/Modern%20UI/Readme.html<br />
and of course at the MultiLanguage.nsi in the Examples folder.<br />
<br />
Cheers<br />
<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bowman2</div><div class="date">6th December 2006, 10:51</div></div><div class="posttext">Ok<br />
<br />
But in my .onInit function i make several checks, so several alert boxes might pop up, each with their own text. How do I do that?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">6th December 2006, 10:57</div></div><div class="posttext">That's ok. Just put it into the onGUIInit.<br />
<br />
Function onGUIInit<br />
:<br />
:<br />
MessageBox MB_YESNO $(foobarMissing) IDOK<br />
:<br />
:<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bowman2</div><div class="date">6th December 2006, 11:37</div></div><div class="posttext">I forgot to mention that the text displayed in the message box is localized, so it has to be selected dependant on the language selected. Also, some of the boxes are yes|no boxes, where i need to take action dependant on the user input (i.e. jump to different labels). This seems not to be possible.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">6th December 2006, 11:43</div></div><div class="posttext">It's possible. Localising is possible as well in the onGUIInit function. Did you define the function?<br />
<br />
 !define MUI_CUSTOMFUNCTION_GUIINIT onGUIInit ; &lt;---</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bowman2</div><div class="date">6th December 2006, 12:06</div></div><div class="posttext">Yes i did.<br />
<br />
I get a compile error that it cannot resolve the _continue label. the code now looks like:<br />
<br />
<br />
;--------------------------------<br />
;Include Modern UI<br />
<br />
  !include &quot;MUI.nsh&quot;<br />
<br />
;--------------------------------<br />
;General<br />
<br />
  ;Name and file<br />
  Name &quot;foobar&quot;<br />
  OutFile foobar.exe&quot;<br />
  XPStyle on<br />
  <br />
  ;Default installation folder<br />
  InstallDir &quot;$PROGRAMFILES\foobar&quot;<br />
  <br />
  ;Get installation folder from registry if available<br />
  InstallDirRegKey HKCU &quot;Software\foobar&quot; &quot;&quot;<br />
  <br />
  <br />
;--------------------------------<br />
;Interface Configuration<br />
<br />
  !define MUI_ABORTWARNING<br />
  !define MUI_PAGE_CUSTOMFUNCTION_SHOW &quot;FinishShow&quot;<br />
  !define MUI_FINISHPAGE_RUN &quot;$INSTDIR\foobar.exe&quot;<br />
  !define MUI_CUSTOMFUNCTION_GUIINIT onGUIInit<br />
<br />
;--------------------------------<br />
;Definitions<br />
<br />
!define SHCNE_ASSOCCHANGED 0x8000000<br />
!define SHCNF_IDLIST 0<br />
!define PRODUCT_UNINST_ROOT_KEY &quot;HKLM&quot;<br />
!define PRODUCT_UNINST_KEY &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\foobar&quot;<br />
;--------------------------------<br />
<br />
; Language Selection Dialog Settings<br />
!define MUI_LANGDLL_REGISTRY_ROOT &quot;${PRODUCT_UNINST_ROOT_KEY}&quot;<br />
!define MUI_LANGDLL_REGISTRY_KEY &quot;${PRODUCT_UNINST_KEY}&quot;<br />
!define MUI_LANGDLL_REGISTRY_VALUENAME &quot;NSIS:Language&quot;<br />
<br />
<br />
;--------------------------------<br />
;Pages<br />
<br />
  !insertmacro MUI_PAGE_WELCOME<br />
  !insertmacro MUI_PAGE_LICENSE $(LicenseString)<br />
  !insertmacro MUI_PAGE_COMPONENTS<br />
  !insertmacro MUI_PAGE_DIRECTORY<br />
  !insertmacro MUI_PAGE_INSTFILES<br />
  !insertmacro MUI_PAGE_FINISH<br />
  <br />
<br />
  !insertmacro MUI_UNPAGE_WELCOME<br />
  !insertmacro MUI_UNPAGE_CONFIRM<br />
  !insertmacro MUI_UNPAGE_LICENSE $(LicenseString)<br />
  !insertmacro MUI_UNPAGE_INSTFILES<br />
  !insertmacro MUI_UNPAGE_FINISH<br />
 <br />
;--------------------------------<br />
;Languages<br />
 <br />
  !insertmacro MUI_LANGUAGE &quot;English&quot;<br />
  !insertmacro MUI_LANGUAGE &quot;German&quot;<br />
<br />
;--------------------------------<br />
;License Language String<br />
<br />
  LicenseLangString LicenseString ${LANG_ENGLISH} &quot;P:\Products\foobar\Installer\Resources\en-License.rtf&quot;<br />
  LicenseLangString LicenseString ${LANG_GERMAN} &quot;P:\Products\foobar\Installer\Resources\de-License.rtf&quot;<br />
  <br />
;--------------------------------<br />
;Other Language strings<br />
  LangString InstallerAlreadyRunning ${LANG_ENGLISH} &quot;The installer is already running.&quot;<br />
  LangString InstallerAlreadyRunning ${LANG_GERMAN} &quot;not shown in german&quot;<br />
<br />
  LangString InstallingSameVersion ${LANG_ENGLISH} &quot;You are installing the same version of foobar as already installed. Continue?&quot;<br />
  LangString InstallingSameVersion ${LANG_GERMAN} &quot;not shown in german&quot;<br />
<br />
  LangString InstallingOlderVersion ${LANG_ENGLISH} &quot;You cannot install an older version of foobar!&quot;<br />
  LangString InstallingOlderVersion ${LANG_GERMAN} &quot;not shown in german&quot;<br />
<br />
;--------------------------------<br />
<br />
Function .onInit<br />
<br />
<br />
	;------------------Language selection dialog<br />
	<br />
	Push &quot;&quot;<br />
	Push ${LANG_ENGLISH}<br />
	Push English<br />
	Push ${LANG_GERMAN}<br />
	Push German<br />
	Push A ; A means auto count languages<br />
	       ; for the auto count to work the first zempty push (Push &quot;&quot;) must remain<br />
	LangDLL::LangDialog &quot;Installer Language&quot; &quot;Please select the language of the installer&quot;<br />
<br />
	Pop $LANGUAGE<br />
	StrCmp $LANGUAGE &quot;cancel&quot; 0 +2<br />
		Abort<br />
		<br />
	;------------------ check if installer is already running<br />
	_checkInstaller:<br />
	System::Call 'kernel32::CreateMutexA(i 0, i 0, t &quot;foobar&quot;) i .r1 ?e'<br />
	Pop $R0<br />
 <br />
	StrCmp $R0 0 +3<br />
	MessageBox MB_OK|MB_ICONINFORMATION $(InstallerAlreadyRunning)<br />
	Abort<br />
<br />
	;------------------ check for version<br />
	<br />
	ReadRegStr $0 HKCU &quot;Software\foobar&quot; &quot;major&quot;<br />
	ReadRegStr $1 HKCU &quot;Software\foobar&quot; &quot;minor&quot;<br />
	ReadRegStr $2 HKCU &quot;Software\foobar&quot; &quot;build&quot;<br />
	<br />
	IntCmp $0 $Current_major _sameMajor _continue _older<br />
<br />
	_sameMajor: <br />
	IntCmp $1 $Current_minor _sameMinor _continue _older<br />
	<br />
	_sameMinor:<br />
	IntCmp $2 $Current_build _sameBuild _continue _older<br />
	<br />
	_sameBuild:<br />
	MessageBox MB_YESNO $(InstallingSameVersion) IDYES _continue<br />
   	Abort ; causes installer to quit.<br />
    <br />
    	_older:<br />
	MessageBox MB_OK $(InstallingOlderVersion) IDOK _abort ; causes installer to quit.<br />
	goto _abort<br />
    <br />
	_abort:<br />
	Abort<br />
<br />
	_continue: <br />
<br />
	.....more code    <br />
FunctionEnd<br />
<br />
;--------------------------------<br />
<br />
Function onGUIInit<br />
<br />
MessageBox MB_OK|MB_ICONINFORMATION $(InstallerAlreadyRunning) IDOK<br />
MessageBox MB_YESNO $(InstallingSameVersion) IDYES _continue<br />
MessageBox MB_YESNO $(InstallingOlderVersion) IDOK _abort<br />
<br />
FunctionEnd<br />
<br />
;--------------------------------<br />
<br />
Function FinishShow<br />
  GetDlgItem $0 $HWNDPARENT 3<br />
  ShowWindow $0 0                ;Hides the Back Button<br />
  GetDlgItem $0 $HWNDPARENT 2<br />
  ShowWindow $0 0                ;Hides the Cancel Button<br />
  GetDlgItem $0 $HWNDPARENT 1<br />
  SendMessage $0 ${WM_SETTEXT} 0 &quot;STR:Next&quot;<br />
FunctionEnd<br />
<br />
;--------------------------------<br />
<br />
;Installer Sections<br />
<br />
Section &quot;-foobar Section&quot; Secfoobar<br />
<br />
  SetOutPath $INSTDIR\Assets<br />
  File /r &quot;Assets\*.*&quot;<br />
  SetOutPath $INSTDIR\Help<br />
  File /r &quot;Help\*.*&quot;<br />
  SetOutPath $INSTDIR<br />
  File &quot;foobar.exe&quot;<br />
  File &quot;*.dll&quot;<br />
  <br />
  ReadRegStr $0 HKCU &quot;Software\foobar&quot; &quot;version&quot;<br />
<br />
  ;Store installation folder<br />
  WriteRegStr HKCU &quot;Software\foobar&quot; &quot;&quot; $INSTDIR<br />
  WriteRegStr HKCU &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\foobar&quot; &quot;DisplayName&quot; &quot;foobar&quot;<br />
  WriteRegStr HKCU &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\foobar&quot; &quot;UninstallString&quot; &quot;$INSTDIR\Uninstall.exe&quot;<br />
<br />
  ;Create uninstaller<br />
  WriteUninstaller &quot;$INSTDIR\Uninstall.exe&quot;<br />
<br />
SectionEnd<br />
<br />
;Assign language strings to sections<br />
  !insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br />
    !insertmacro MUI_DESCRIPTION_TEXT ${Secfoobar} $(DESC_Secfoobar)<br />
  !insertmacro MUI_FUNCTION_DESCRIPTION_END<br />
<br />
;--------------------------------<br />
<br />
Function un.onInit<br />
<br />
  !insertmacro MUI_UNGETLANGUAGE<br />
<br />
FunctionEnd<br />
<br />
;Uninstaller Section<br />
<br />
Section &quot;Uninstall&quot;<br />
<br />
<br />
  ;ADD YOUR OWN FILES HERE...<br />
  RMDir /r &quot;$INSTDIR\Assets&quot;<br />
  RMDir /r &quot;$INSTDIR\Help&quot;<br />
  Delete &quot;$INSTDIR\foobar.exe&quot;<br />
  Delete &quot;$INSTDIR\*.dll&quot;<br />
<br />
  <br />
  Delete &quot;$INSTDIR\Uninstall.exe&quot;<br />
  RMDir &quot;$INSTDIR&quot;<br />
<br />
  DeleteRegKey HKCU &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\foobar&quot;<br />
  DeleteRegKey HKCU &quot;Software\foobar&quot;<br />
<br />
<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">6th December 2006, 12:27</div></div><div class="posttext">Although it's not written explicitly I'd suggest using letters for labels.<br />
<br />
http://nsis.sourceforge.net/Docs/Chapter4.html#4.3<br />
<br />
Put all the language related stuff into onGUIInit. (Except the code for the dialog box...)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bowman2</div><div class="date">6th December 2006, 13:01</div></div><div class="posttext">Do you mean take the lines:<br />
<br />
<br />
LangString InstallerAlreadyRunning ${LANG_ENGLISH} &quot;The installer is already running.&quot;<br />
  LangString InstallerAlreadyRunning ${LANG_GERMAN} &quot;not shown in german&quot;<br />
<br />
  LangString InstallingSameVersion ${LANG_ENGLISH} &quot;You are installing the same version of foobar as already installed. Continue?&quot;<br />
  LangString InstallingSameVersion ${LANG_GERMAN} &quot;not shown in german&quot;<br />
<br />
  LangString InstallingOlderVersion ${LANG_ENGLISH} &quot;You cannot install an older version of foobar!&quot;<br />
  LangString InstallingOlderVersion ${LANG_GERMAN} &quot;not shown in german&quot;<br />
<br />
<br />
and put into onGUIInit?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">6th December 2006, 20:59</div></div><div class="posttext">Ahm, I thought these lines. If you do this, your language variables are correctly shown. But you have to pay attention to the /S (Silent) switch. Because if someone sets this, onGUIInit is not executed. So you should prevent people from doing this. <br />
<br />
onInit:<br />
<br />
IfSilent 0 +3<br />
  MessageBOX MB_OK &quot;not possible... bye!&quot;<br />
  Quit<br />
<br />
onGUIInit<br />
<br />
;------------------ check if installer is already running<br />
	_checkInstaller:<br />
	System::Call 'kernel32::CreateMutexA(i 0, i 0, t &quot;foobar&quot;) i .r1 ?e'<br />
	Pop $R0<br />
 <br />
	StrCmp $R0 0 +3<br />
	MessageBox MB_OK|MB_ICONINFORMATION $(InstallerAlreadyRunning)<br />
	Abort<br />
<br />
	;------------------ check for version<br />
	<br />
	ReadRegStr $0 HKCU &quot;Software\foobar&quot; &quot;major&quot;<br />
	ReadRegStr $1 HKCU &quot;Software\foobar&quot; &quot;minor&quot;<br />
	ReadRegStr $2 HKCU &quot;Software\foobar&quot; &quot;build&quot;<br />
	<br />
	IntCmp $0 $Current_major _sameMajor _continue _older<br />
<br />
	_sameMajor: <br />
	IntCmp $1 $Current_minor _sameMinor _continue _older<br />
	<br />
	_sameMinor:<br />
	IntCmp $2 $Current_build _sameBuild _continue _older<br />
	<br />
	_sameBuild:<br />
	MessageBox MB_YESNO $(InstallingSameVersion) IDYES _continue<br />
   	Abort ; causes installer to quit.<br />
    <br />
    	_older:<br />
	MessageBox MB_OK $(InstallingOlderVersion) IDOK _abort ; causes installer to quit.<br />
	goto _abort<br />
    <br />
	_abort:<br />
	Abort<br />
<br />
	_continue: <br />
<br />
	; .....more code   <br />
<br />
<br />
Have a nice day!<br />
<br />
Cheers<br />
<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bowman2</div><div class="date">7th December 2006, 07:12</div></div><div class="posttext">Hi Bruno<br />
<br />
Thanks for the help so far. However, I get a compile error when trying to put in the .onGUIInit function. I define the function like you said as:<br />
<br />
  !define MUI_CUSTOMFUNCTION_GUIINIT onGUIInit<br />
<br />
<br />
and the function itself is defined as:<br />
<br />
Function .onGUIInit<br />
	;------------------Language selection dialog<br />
	!insertmacro MUI_LANGDLL_DISPLAY<br />
		<br />
	;------------------ check if installer is already running<br />
	_checkInstaller:<br />
	System::Call 'kernel32::CreateMutexA(i 0, i 0, t &quot;foobar&quot;) i .r1 ?e'<br />
	Pop $R0<br />
 <br />
	StrCmp $R0 0 +3<br />
	MessageBox MB_OK|MB_ICONINFORMATION $(InstallerAlreadyRunning)<br />
	Abort<br />
<br />
	;------------------ check for version<br />
	<br />
	ReadRegStr $0 HKCU &quot;Software\foobar&quot; &quot;major&quot;<br />
	ReadRegStr $1 HKCU &quot;Software\foobar&quot; &quot;minor&quot;<br />
	ReadRegStr $2 HKCU &quot;Software\foobar&quot; &quot;build&quot;<br />
	<br />
	IntCmp $0 $Current_major _sameMajor _continue _older<br />
<br />
	_sameMajor: <br />
	IntCmp $1 $Current_minor _sameMinor _continue _older<br />
	<br />
	_sameMinor:<br />
	IntCmp $2 $Current_build _sameBuild _continue _older<br />
	<br />
	_sameBuild:<br />
	MessageBox MB_YESNO $(InstallingSameVersion) IDYES _continue<br />
    	Abort ; causes installer to quit.<br />
    <br />
    	_older:<br />
	MessageBox MB_OK $(InstallingOlderVersion) IDOK _abort ; causes installer to quit.<br />
	goto _abort<br />
    <br />
	_abort:<br />
	Abort<br />
<br />
	_continue: <br />
<br />
	.....more code    <br />
FunctionEnd<br />
<br />
<br />
<br />
The compile error I get is:<br />
<br />
Function: &quot;.onGUIInit&quot;<br />
Error: Function named &quot;.onGUIInit&quot; already exists.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bowman2</div><div class="date">7th December 2006, 07:19</div></div><div class="posttext">Hi again<br />
<br />
I found the error myself - I should use onGUIInit and not .onGUIInit and the language selection should happen in .onInit. It works now, so thanks for the help Bruno. <br />
Cheers</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>