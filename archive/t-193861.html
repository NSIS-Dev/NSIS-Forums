<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" IfFileExists - what am I doing wrong?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  IfFileExists - what am I doing wrong? NSIS Discussion" />
	
	<title> IfFileExists - what am I doing wrong? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  IfFileExists - what am I doing wrong?</div>
<hr />
<div class="pda"><a href="t-193861.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=193861">IfFileExists - what am I doing wrong?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">John P.</div><div class="date">17th September 2004, 11:48</div></div><div class="posttext">Hi.<br />
<br />
I'm working on an installer now, that has to take into account if a file is already installed.<br />
<br />
If it finds that the file is already there, it's supposed to back up that file before it extracts the alternative file that is in the installer I am now making.<br />
<br />
So for this I have tried to use IfFileExists.<br />
<br />
But I must be doing something wrong, because it's not doing what I want it to do.<br />
<br />
Here's the script snippet(names changed etc.):<br />
<br />
<br />
Section &quot;Install section nr. 2.&quot; Sec02<br />
IfFileExists &quot;$INSTDIR\EXAMPLE_DIRECTORY\examplefile1.bmp&quot; 0 nofile1<br />
CreateDirectory &quot;$INSTDIR\EXAMPLE_DIRECTORY\BMP_Backup&quot;<br />
CopyFiles &quot;$INSTDIR\EXAMPLE_DIRECTORY\examplefile1.bmp&quot; &quot;$INSTDIR\EXAMPLE_DIRECTORY\BMP_Backup\examplefile1.bmp&quot;<br />
<br />
SetOutPath &quot;$INSTDIR\EXAMPLE_DIRECTORY&quot;<br />
File &quot;examplefile2.bmp&quot;<br />
<br />
nofile1:<br />
SetOutPath &quot;$INSTDIR\EXAMPLE_DIRECTORY&quot;<br />
File &quot;examplefile2.bmp&quot;<br />
SectionEnd<br />
<br />
<br />
<br />
What happens in the script above, is that it doesn't seem to care about the 'IfFileExists' command - it does both of those actions like they were right after each other. The whole point of using IfFileExists is that I want it to jump to the next action if the file doesn't exist(because I don't have to make a backup then obviously), but it doesn't jump, it just continues and does both actions of the Section.<br />
<br />
The weird thing is that it &quot;partially&quot; works:<br />
<br />
If the original file exists, it does make a backup directory and puts the file in there, and if the file doesn't exist, it just extracts the new file.<br />
<br />
So far so good.<br />
<br />
But it also goes on to perform the second action no matter what. <br />
<br />
I verified this because when I remove the first SetOutPath action, and the file already exists, it makes the backup, but the new file is still extracted, which means it must be continuing on to perform the second action as well(which it's supposed to skip).<br />
<br />
<br />
I also tried to store the directory string in a variable, in case that was needed when using IfFileExists, like this:<br />
<br />
StrCpy $0 &quot;$INSTDIR\EXAMPLE_DIRECTORY\examplefile1.bmp&quot;<br />
IfFileExists $0 0 nofile1<br />
But the same thing happens then.<br />
<br />
<br />
The same problem then occurs in the uninstall section, since it then both removes the backup folder I made, and removes the file in the root folder, when it's supposed to do only one of those ations(copy from backup folder if the file was there, but just delete the new file if it wasn't there to begin with).<br />
<br />
<br />
So how am I supposed to use it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th September 2004, 11:51</div></div><div class="posttext">it does both of those actions like they were right after each other.They are. The label doesn't mean &quot;stop execution here&quot;, it means &quot;I might want to jump here, remember this spot under this name&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">17th September 2004, 11:51</div></div><div class="posttext">you have to insert a goto:<br />
SetOutPath &quot;$INSTDIR\EXAMPLE_DIRECTORY&quot;<br />
File &quot;examplefile2.bmp&quot;<br />
Goto End<br />
<br />
nofile1:<br />
SetOutPath &quot;$INSTDIR\EXAMPLE_DIRECTORY&quot;<br />
File &quot;examplefile2.bmp&quot;<br />
End:<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">John P.</div><div class="date">17th September 2004, 11:55</div></div><div class="posttext">Woah, that was fast! :D <br />
<br />
OK - I AM a newbie.<br />
<br />
Thanks, I'll try that. :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>