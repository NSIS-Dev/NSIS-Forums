<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" System plugin (call C static library function), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  System plugin (call C static library function) NSIS Discussion" />
	
	<title> System plugin (call C static library function) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  System plugin (call C static library function)</div>
<hr />
<div class="pda"><a href="t-305458.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=305458">System plugin (call C static library function)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jeusdi</div><div class="date">17th April 2009, 13:36</div></div><div class="posttext">Hello forum,<br />
<br />
    I've developed a static C library: NSISWS.a. <br />
<br />
NSISWS.h-&gt;<br />
extern unsigned char* activateLicence(char* licence_type_code, char* customer_code);<br />
<br />
NSISWS.c-&gt;<br />
<br />
unsigned char* activateLicence(char* licence_type_code, char* customer_code) <br />
{<br />
          unsigned char* result;<br />
          result = &quot;fdfdfdfdfdfdfdf...&quot;;<br />
          return result;<br />
}<br />
<br />
<br />
I've copied NSISWS.a file on the same directory of my NSIS script. In order to call this function I use System plugin as follow:<br />
<br />
<br />
	System::Call &quot;NSISWS::activateLicence(&quot;bl&quot;, &quot;bl&quot;) c .r0<br />
 	DetailPrint &quot;Licence: $0&quot;<br />
<br />
<br />
The result is:<br />
http://i16.photobucket.com/albums/b45/jeusdi/NSIS1.png<br />
<br />
Can you help me please?<br />
What Am I doing wrong?<br />
I will appreciate your help a lot.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">17th April 2009, 13:57</div></div><div class="posttext">&quot;) c .r0&quot; and c would be??? you can't just make up types, you must read the system plugin readme<br />
<br />
try System::Call &quot;NSISWS::activateLicence(t &quot;bl&quot;, t &quot;bl&quot;)t.r0<br />
<br />
not sure if returning a string like that will work, normally your function would look like: <br />
void MyFunc(char*a,char*b,char*output) <br />
{<br />
lstrcpy(output,&quot;hello&quot;);//must be &lt; 1024 chars<br />
}<br />
and System::Call &quot;dll::MyFunc(t &quot;bl&quot;, t &quot;bl&quot;,t.r0)<br />
<br />
also remember that the function needs to be stdcall unless you pass ?c</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jeusdi</div><div class="date">20th April 2009, 10:54</div></div><div class="posttext">Hello Anders. Thanks for your response. I've modified function signature as:<br />
<br />
<br />
unsigned int activateLicence(const char* licence_type_code, const char* customer_code, char* licence_filename);<br />
 <br />
<br />
And I call it as:<br />
<br />
	System::Call &quot;NSISWS.a::activateLicence(t &quot;bla bla&quot;., t &quot;ble ble&quot;., t.r1) t .r0<br />
 	DetailPrint &quot;Licence: $0&quot; <br />
<br />
I think that the method is not called, because this function creates a file and it is not created.<br />
<br />
Can you help me, plase?<br />
Thanks in advance.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">20th April 2009, 11:06</div></div><div class="posttext">the function returns int, so why are the t??<br />
<br />
also remember that the function needs to be stdcall unless you pass ?c</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">21st April 2009, 01:59</div></div><div class="posttext">Maybe you should try to make it as a plugin and use the function &quot;setuservariable&quot; to write things to the nsis stack.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jeusdi</div><div class="date">21st April 2009, 10:11</div></div><div class="posttext">Does exist any tutorial in order to create NSIS Plugins?<br />
Thanks for all.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">23rd April 2009, 00:54</div></div><div class="posttext">Yes, get the source code and look for ExDLL</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>