<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" $PROGRAMFILES on x64, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  $PROGRAMFILES on x64 NSIS Discussion" />
	
	<title> $PROGRAMFILES on x64 [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  $PROGRAMFILES on x64</div>
<hr />
<div class="pda"><a href="t-262873.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=262873">$PROGRAMFILES on x64</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">sunghun</div><div class="date">2nd January 2007, 15:41</div></div><div class="posttext">I want to install my &quot;64-BIT&quot; executable binaries on &quot;C:\Program Files\MyApp&quot;.<br />
<br />
But NSIS $PROGRAMFILES variable always indicates<br />
&quot;C:\Program Files (x86)&quot;.<br />
<br />
How can I correct this problem?<br />
Thanks in advance.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">2nd January 2007, 15:46</div></div><div class="posttext">!include x64.nsh</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sunghun</div><div class="date">2nd January 2007, 15:54</div></div><div class="posttext">Surely included that file,<br />
and I also tried $(DisableX64FSRedirection) in .onInit,<br />
but same problem...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">2nd January 2007, 16:03</div></div><div class="posttext">; RunningX64 checks if the installer is running on x64.<br />
;<br />
;   ${If} ${RunningX64}<br />
;     MessageBox MB_OK &quot;running on x64&quot;<br />
;   ${EndIf}<br />
;<br />
; DisableX64FSRedirection disables file system redirection.<br />
; EnableX64FSRedirection enables file system redirection.<br />
;<br />
;   ${DisableX64FSRedirection}<br />
;   DetailPrint $SYSDIR # prints C:\Windows\System32<br />
;   ${EnableX64FSRedirection}<br />
;   DetailPrint $SYSDIR # prints C:\Windows\SysWOW64</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">2nd January 2007, 16:53</div></div><div class="posttext">Something like this should be the way to go:<br />
!include x64.nsh<br />
<br />
Function .onInit<br />
        ${If} ${RunningX64}<br />
        ${EnableX64FSRedirection}<br />
        ${else}<br />
        MessageBox MB_OK &quot;Sorry this application runs only on x64 machines&quot;<br />
        Abort<br />
        ${EndIf}<br />
        StrCpy '$INSTDIR' '$PROGRAMFILES\My Application'<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd January 2007, 20:21</div></div><div class="posttext">You should actually disable redirection only right before using something that relies on it and enable it back right away. If you don't, some weird (http://forums.winamp.com/showthread.php?s=&amp;threadid=262273&amp;highlight=x64) stuff can happen.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sunghun</div><div class="date">3rd January 2007, 05:15</div></div><div class="posttext">Thank you but still not solved.<br />
<br />
I tested the following 3 msgboxes in .onInit,<br />
<br />
MsgBox MB_OK &quot;$PROGRAMFILES 1&quot;<br />
${DisableX64FSRedirection}<br />
MsgBox MB_OK &quot;$PROGRAMFILES 2&quot;<br />
${EnableX64FSRedirection}<br />
MsgBox MB_OK &quot;$PROGRAMFILES 3&quot;<br />
<br />
All output contained &quot;(x86)&quot;...<br />
<br />
But maybe I'm wrong because <br />
$SYSDIR (instead of $PROGRAMFILES) was also <br />
not changed at these 3 msgbox test.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Backland</div><div class="date">3rd January 2007, 05:45</div></div><div class="posttext">Can you attach your complete test script</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">3rd January 2007, 06:00</div></div><div class="posttext">Just in case...<br />
!include x64.nsh<br />
<br />
Function .onInit<br />
        ${If} ${RunningX64}<br />
        ${EnableX64FSRedirection}<br />
        ${else}<br />
        MessageBox MB_OK &quot;Sorry this application runs only on x64 machines&quot;<br />
        Abort<br />
        ${EndIf}<br />
FunctionEnd<br />
<br />
Section -<br />
       Detailprint '$SYSDIR'<br />
       DetailPrint '$WINDIR'<br />
       DetailPrint '$PROGRAMFILES'<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sunghun</div><div class="date">3rd January 2007, 08:40</div></div><div class="posttext">Thanks,<br />
<br />
<br />
!include &quot;MUI.nsh&quot;<br />
!include &quot;x64.nsh&quot;<br />
<br />
Name &quot;Modern UI Test&quot;<br />
OutFile &quot;Basic.exe&quot;<br />
<br />
InstallDir &quot;$PROGRAMFILES\Modern UI Test&quot;<br />
InstallDirRegKey HKCU &quot;Software\Modern UI Test&quot; &quot;&quot;<br />
<br />
!define MUI_ABORTWARNING<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
!insertmacro MUI_PAGE_INSTFILES<br />
!insertmacro MUI_UNPAGE_CONFIRM<br />
!insertmacro MUI_UNPAGE_INSTFILES  <br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
Section &quot;Dummy Section&quot; SecDummy<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
  WriteRegStr HKCU &quot;Software\Modern UI Test&quot; &quot;&quot; $INSTDIR<br />
  WriteUninstaller &quot;$INSTDIR\Uninstall.exe&quot;<br />
SectionEnd<br />
<br />
Section &quot;Uninstall&quot;<br />
  Delete &quot;$INSTDIR\Uninstall.exe&quot;<br />
  RMDir &quot;$INSTDIR&quot;<br />
  DeleteRegKey /ifempty HKCU &quot;Software\Modern UI Test&quot;<br />
SectionEnd<br />
<br />
Function .onInit<br />
	${If} ${RunningX64}<br />
	${EnableX64FSRedirection}<br />
	${Else}<br />
	MessageBox MB_OK &quot;x64 test only&quot;<br />
	Abort<br />
	${EndIf}<br />
FunctionEnd<br />
<br />
Section -<br />
	DetailPrint '$SYSDIR'<br />
	DetailPrint '$WINDIR'<br />
	DetailPrint '$PROGRAMFILES'<br />
<br />
	MessageBox MB_OK &quot;$PROGRAMFILES 1&quot;<br />
	${DisableX64FSRedirection}<br />
	MessageBox MB_OK &quot;$PROGRAMFILES 2&quot;<br />
	${EnableX64FSRedirection}<br />
	MessageBox MB_OK &quot;$PROGRAMFILES 3&quot;<br />
SectionEnd<br />
<br />
<br />
The details output:<br />
<br />
Output folder: C:\Program Files (x86)\Modern UI Test<br />
Created uninstaller: C:\Program Files (x86)\Modern UI Test\Uninstall.exe<br />
C:\WINDOWS\system32<br />
C:\WINDOWS<br />
C:\Program Files (x86)<br />
Completed<br />
<br />
<br />
MessageBox output was &quot;C:\Program Files (x86) ?&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">3rd January 2007, 10:45</div></div><div class="posttext">Everything appears as expected in your script, though, the redirection seems that fails. I don't know what else to think. Since I have not x64 system I can't help further.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th January 2007, 21:14</div></div><div class="posttext">The problem with $PROGRAMFILES is that it's read from the registry. The same goes to $COMMONFILES. What should happen, is that SHGetSpecialFolderLocation should be called first and then, only if it failed, the registry should be read. Please submit a bug report about this.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>