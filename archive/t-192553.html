<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Change BG color for NSISDL download file static control, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Change BG color for NSISDL download file static control NSIS Discussion" />
	
	<title> Change BG color for NSISDL download file static control [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Change BG color for NSISDL download file static control</div>
<hr />
<div class="pda"><a href="t-192553.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=192553">Change BG color for NSISDL download file static control</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Taymiya</div><div class="date">5th September 2004, 16:54</div></div><div class="posttext">I am trying to change the color for all my dialogs into white. The only thing I could not do was to change the background color for the static control text in the NSISDL download component (downloading  file speed ... etc etc).<br />
<br />
Does anyone have an idea how such a thing can be done?<br />
<br />
Thanks in advance.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">5th September 2004, 17:44</div></div><div class="posttext">I was looking at NSISdl source and I found that this control doesn't have an ID, so you can't use GetDlgItem to paint the control. (this means, the control can only be accessed by the plugin itself)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Taymiya</div><div class="date">5th September 2004, 18:05</div></div><div class="posttext">Thanks deguix, this is what I am trying to do now: in file nsisdl.cpp, function download, after these lines<br />
      // set initial text<br />
      char *p = filename;<br />
      while (*p) p++;<br />
      while (*p != '\\' &amp;&amp; p != filename) p = CharPrev(filename, p);<br />
      wsprintf(buf, szDownloading, p != filename ? p + 1 : p);<br />
      SetDlgItemText(childwnd, 1006, buf);<br />
      SetWindowText(g_hwndStatic, szConnecting);<br />
<br />
<br />
I added the following lines<br />
<br />
	  HDC hdcStatic = GetDC(g_hwndStatic);<br />
	  SetBkMode(hdcStatic, OPAQUE);<br />
	  SetBkColor(hdcStatic, RGB(255,255,255)); // i want it changed to white<br />
	  LOGBRUSH lh;<br />
	  lh.lbColor = RGB(255,255,255);<br />
	  lh.lbStyle = BS_SOLID;<br />
	  CreateBrushIndirect(&amp;lh);<br />
<br />
Still it doesn't work :(<br />
<br />
Duz anyone have any idea what am I doing wrong?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">5th September 2004, 19:06</div></div><div class="posttext">Those messages are for the WM_PAINT, or WM_CTLCOLORSTATIC....<br />
<br />
You don't need to get the DC, the DC is in the WM_CTLCOLORSTATIC from ParentWndProc message ...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">5th September 2004, 19:24</div></div><div class="posttext">The recommended solution would be:<br />
<br />
- Adding a new control to 106 dialog resource.<br />
- Making the plugin to use this control instead of creating a new one.<br />
<br />
This would allow NSIS to use this control.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">6th September 2004, 02:58</div></div><div class="posttext">it should b possible to get the handle to a dialog even if it has no id, use FindWindow with the childafter parameter</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">6th September 2004, 03:57</div></div><div class="posttext">Why not re-compile nsisdl and assign an ID? These way can be used with GetDlgItem from NSIS.<br />
<br />
Another recommendation :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Taymiya</div><div class="date">6th September 2004, 16:03</div></div><div class="posttext">Thanks Lobo Lunar, deguix and Anders<br />
<br />
I can not use FindWindow because the control is not created until I make the NSISDL:download command. Placing the findwindow before or after the statement would be useless.<br />
<br />
Also assigning an ID would not do the trick for the same reason.<br />
<br />
The suggestion by deguix seems the only viable choice, but I was hoping to find something a bit less complicated, maybe plant a few statements inside the NSISdl code. All I need to do is turn the background color into white, and I don't mind hard coding the color there ;)<br />
<br />
In any case, Thank you for all your replies, I appreciate you taking the time to answer :)<br />
<br />
Still, I wonder if someone can come up with any other ideas. If someone does please do not hold back :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">6th September 2004, 17:52</div></div><div class="posttext">Also assigning an ID would not do the trick for the same reason.Now I'll explain simply:<br />
<br />
1)Open an UI with Resource Hacker.<br />
<br />
2)Go to dialog 106.<br />
<br />
3)Create a new static control with an unique ID. Also, position it where you want it to be. Remove the flag &quot;WS_VISIBLE&quot; so it will be hidden initially. The recommended position is:<br />
<br />
x1 = 0<br />
<br />
x2 = wndRect.right (266 for Default UI, 300 for Modern UI)<br />
<br />
y1 = wndRect.bottom / 2 + (ctlRect.bottom - ctlRect.top) / 2 (70 for Default UI w/ 10 for control height, 75 for Modern UI w/ 10 for control height)<br />
<br />
y2 = y1 + (ctlRect.bottom - ctlRect.top) (80 for Default UI w/ 10 for control height, 85 for Modern UI w/ 10 for control height)<br />
<br />
<br />
4)Save and exit the program.<br />
<br />
5)Open a program to edit &quot;nsisdl.cpp&quot;<br />
<br />
6)Search for &quot;HWND hwndS = GetDlgItem(childwnd, 1006);&quot;.<br />
<br />
7)Add this code below that line you found:<br />
<br />
HWND s = g_hwndStatic = GetDlgItem(childwnd, YourUniqueID);So it can recognize that the control is located in a resource. (Replace &quot;YourUniqueID&quot; with the ID of the control you added)<br />
<br />
8)Search for the line &quot;hwndB = NULL;&quot;<br />
<br />
9)Add this code below that line you found:<br />
<br />
        if (IsWindowVisible(g_hwndStatic))<br />
          ShowWindow(g_hwndStatic, SW_SHOWNA);<br />
        else<br />
          s = g_hwndStatic = NULL;This enables the control to show when the user calls NSISdl::download function.<br />
<br />
And also enables you to remove this control from the resource so the details won't appear anymore.<br />
<br />
10)Then search for &quot;HWND s = g_hwndStatic = CreateWindow&quot;<br />
<br />
11)Delete entirely the CreateWindow function. We don't want to create a control that already exists...<br />
<br />
12)Search for &quot;if (hwndL)&quot;<br />
<br />
13)Below &quot;}&quot;, add this piece of code:<br />
<br />
      if (g_hwndStatic)<br />
      {<br />
        ShowWindow(hwndL, SW_HIDE);<br />
        s = g_hwndStatic = NULL;<br />
      }So it will hide the control after the user clicked &quot;cancel&quot;.<br />
<br />
14)Search for &quot;DestroyWindow(g_hwndStatic);&quot;<br />
<br />
15)Remove this code:<br />
<br />
      if (g_hwndStatic)<br />
      {<br />
        DestroyWindow(g_hwndStatic);<br />
        g_hwndStatic = NULL;<br />
      }We don't need to destroy the control, as the plugin didn't create it.<br />
<br />
16) Compile and test it for errors.<br />
<br />
17) Color the control on sections or functions derived of sections as you normally would.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">6th September 2004, 18:05</div></div><div class="posttext">Ok, another one:<br />
<br />
You can try subclassing the static's hwnd.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Taymiya</div><div class="date">7th September 2004, 18:26</div></div><div class="posttext">Thanks deguix and Lobo Lunar :)<br />
<br />
I followed the steps spelled out by deguix and it worked (with a few changes).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th September 2004, 19:11</div></div><div class="posttext">That was a very well written tutorial :D<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">8th September 2004, 01:50</div></div><div class="posttext">That I've done was only a basic concept and I didn't test it before... (you had to do some changes by yourself though)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>