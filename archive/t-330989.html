<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Code Architecture, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Code Architecture NSIS Discussion" />
	
	<title> Code Architecture [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Code Architecture</div>
<hr />
<div class="pda"><a href="t-330989.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=330989">Code Architecture</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jai123</div><div class="date">27th May 2011, 20:45</div></div><div class="posttext">Hello everyone,<br />
<br />
I am starting to reorganize some code, and I want to structure it in a clean way. I am trying to get rid of repeated code, as well as modularize my code. So, I would like to see if you could guide me in two things I am trying to structure better.<br />
<br />
1) There are two functions that do exactly the same, but one is for the installer, and the other is for the uninstaller. I have tried to create a subfunction for both, but the compiler yells at me. How do you usually avoid duplicating code that is in the installer and uninstaller?<br />
<br />
2) My main script mixes the GUI and installation code (driver installation) into a single script. In order to organize it, I would like to pass the driver installation functions into its own file. I am looking something like compiling and linking, or something similar. Does that concept exist in NSIS? what people usually do to organize their scripts?<br />
<br />
Thanks,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">27th May 2011, 22:24</div></div><div class="posttext">1) Use macros or CallArtificialFunction (util.nsh)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th May 2011, 22:26</div></div><div class="posttext">!macro and !include. To include the same function in the installer and uninstaller, put it in a macro that takes one argument like so:<br />
<br />
!macro MyFunction Un<br />
Function ${Un}MyFunction<br />
...<br />
FunctionEnd<br />
!macroend<br />
<br />
!insertmacro MyFunction `` # for installer<br />
!insertmacro MyFunction `un.` # for uninstaller<br />
<br />
Edit: Or what Anders said :)<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jai123</div><div class="date">29th May 2011, 21:23</div></div><div class="posttext">Great Anders and Afrow UK. I will see which approach to take.<br />
<br />
About question 2), does people usually link compiled code; or they just drop functions into headers files. What usually people do to break apart (architect) their main script?<br />
<br />
Thanks,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">30th May 2011, 05:37</div></div><div class="posttext">You can't link compiled code. You can only !include .nsh and .nsi files. If you must, you could however do File YourFolder\YourCompiledExe.exe and then ExecWait that exe. But... It kind of makes zero sense to do that with an NSIS executable.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jai123</div><div class="date">30th May 2011, 15:23</div></div><div class="posttext">MSG, thank you very much for the clarification.<br />
<br />
So I am just wondering what is the whole purpose of including nsi files. I could dump all my implementation details into an nsh file and include it. Or, do people separate implementation from interface using nsh and nsi files and then include both into their main script? how do you usually organize your installer architecture?<br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jai123</div><div class="date">30th May 2011, 17:02</div></div><div class="posttext">Afrow UK, I followed your example. For some reason when compiling the macro, the compiler yells at me. I have attached the code and error below.<br />
<br />
When I get rid of the Function... and FunctionEnd lines. It just compiles fine. Am I missing something?<br />
<br />
Thanks,<br />
<br />
Code:<br />
!macro cleanFileSystem Un<br />
    Function ${Un}cleanFiles<br />
....<br />
....<br />
    FunctionEnd<br />
!macroend<br />
<br />
Error:<br />
Error in macro cleanFileSystem on macroline 1</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>