<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" VPatch--Patch Directly, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  VPatch--Patch Directly NSIS Discussion" />
	
	<title> VPatch--Patch Directly [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  VPatch--Patch Directly</div>
<hr />
<div class="pda"><a href="t-207947.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=207947">VPatch--Patch Directly</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">shaohao</div><div class="date">16th February 2005, 12:56</div></div><div class="posttext">I found VPatch can only path the source file to a new file.<br />
I want to patch the source file directly and create a backup of it.<br />
<br />
Here is the my code of vpatchdll.c:<br />
<br />
    static char source[1024];<br />
    static char dest[1024];<br />
    static char exename[1024];<br />
    HANDLE hPatch, hSource, hDest;<br />
    int result;<br />
<br />
	//added by Shao Hao - update source file directly and create a backup to dst file.<br />
    popstring(exename);<br />
	if (!lstrcmpi(exename, &quot;/replace&quot;)) { // replace mode<br />
		popstring(exename);<br />
		popstring(dest);<br />
		popstring(source);<br />
<br />
		if (!MoveFile(dest, source))<br />
			return;<br />
	}<br />
	else { // normal patching<br />
		popstring(source);<br />
		popstring(dest);<br />
	}<br />
<br />
    hPatch = CreateFile(exename, GENERIC_READ, FILE_SHARE_READ, NULL,<br />
...<br />
<br />
<br />
use the new vpatch like this:<br />
<br />
vpatch::vpatchfile /REPLACE &quot;$PLUGINSDIR\patch.pat&quot; &quot;$INSTDIR\oldfile.txt&quot; &quot;$INSTDIR\backup.txt&quot;<br />
<br />
<br />
Have a Fun:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bluenet</div><div class="date">16th February 2005, 15:20</div></div><div class="posttext">If the backup file exist, MoveFile function will failue and installer will do nothing.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Koen van de Sande</div><div class="date">18th February 2005, 23:04</div></div><div class="posttext">No! Please do not do it like this!!! :rolleyes: <br />
<br />
Instead, download the VPatch 3 release candidate (RC5a) and use the VPatchFile macro in VPatchLib.nsh. :)<br />
Or even better, look at the new example.nsi and documentation :D<br />
This provides the functionality you want but does it in NSIS and only replaces the file when the patching was succesfull.<br />
<br />
RC5a can be downloaded from: http://www.tibed.net/files/vpatch3releasecandidate.zip<br />
and will be posted on:<br />
http://www.tibed.net/vpatch<br />
in the near future.<br />
<br />
Note: the newer NSIS plug-in (v3) is not yet included with NSIS so if you make patches with v3 be sure to compile the NSIS plug-in yourself as well. The macro library is safe to use.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>