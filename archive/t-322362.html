<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSis and MSSQL_OLEDB::SQL_ExecuteScript, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSis and MSSQL_OLEDB::SQL_ExecuteScript NSIS Discussion" />
	
	<title> NSis and MSSQL_OLEDB::SQL_ExecuteScript [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSis and MSSQL_OLEDB::SQL_ExecuteScript</div>
<hr />
<div class="pda"><a href="t-322362.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=322362">NSis and MSSQL_OLEDB::SQL_ExecuteScript</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Grennvicted</div><div class="date">11th September 2010, 21:07</div></div><div class="posttext">I have a bit of a problem the SQL scripts that i use are good,they do what they were coded for when they are directly called in MS SQL, but when i call them in a NSis script they either do not execute or return an error. The Ones calling a delete on certain rows of a table always return an error,the ones calling to drop base do not drop because they say that de DB is in use. Here is the big picture, i call a script to create a temporary DB to retrieve the Data of two existing DB then modify the temporary DB(delete some rows on two tables).After, i drop the two existing DB, recreate them, transfer data in those two DB from the temporary one, drop the temporary one.The data transfering goes well both ways,the big issue is i cannot delete rows from the temporary DB and i cannot drop the two existing DB. I had to seperate alot of queries  (like the ones using Identity_Insert  on /off) to make  them work .<br />
<br />
1) Is there some kind of protection that prevents Data from being deleted when called from Nsis?<br />
<br />
2)Why Nsis says the DB is in use when i put a 10 second sleep before the last insert to drop a DB?<br />
<br />
<br />
P.S. Remember i doubled check all My queries and they are working perfectly fine when i call them from MS SQL or Access.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">11th September 2010, 23:34</div></div><div class="posttext">Can you give some sample code you are using?<br />
It should work without a problem.<br />
<br />
What version of MSSQL are you running against?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Grennvicted</div><div class="date">12th September 2010, 00:51</div></div><div class="posttext">In NSIS<br />
<br />
<br />
//Insert code that works<br />
MSSQL_OLEDB::SQL_ExecuteScript &quot;InsertIntoMyTable.sql&quot;<br />
<br />
Sleep 10000<br />
//Deletion query<br />
MSSQL_OLEDB::SQL_ExecuteScript &quot;ModifyMyTable.sql&quot;<br />
MSSQL_OLEDB::SQL_GetError<br />
//error Message<br />
<br />
<br />
<br />
The Deletion query that works in MS SQL<br />
<br />
<br />
<br />
Delete From MyTable<br />
Where (Id&gt;1 Or Id =1) And (Id&gt;5 or Id=5) And (otherStuffId=5 And OtherStuffId=6)<br />
<br />
<br />
The Id is a primary key and i want to delete the 2 rows of each Id where otherStuffId=5 and otherStuffId=6<br />
<br />
The deletion query return an error message (with NSIS)  that's what i do not understand.<br />
I'm workin with Ms SQL express 2005.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">13th September 2010, 00:04</div></div><div class="posttext">First I think nothing will deleted ever with this query, because (otherStuffId=5 And OtherStuffId=6) will always return false...<br />
<br />
But about your error, what error code is returned?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Grennvicted</div><div class="date">16th September 2010, 15:32</div></div><div class="posttext">You were right about the query but in acces and MSSQL both returned Success.(An &quot;Or&quot; was needed). Plus the fact i'm new to NSIS i used an old Script using execute &quot;sb_attach_db&quot;. <br />
It looks like you need to (RMDir ${Installdir}/&quot;SQL&quot;) recursivly remove the SQL folder when using the command, but not when you execute a script instead of a query.So that was why the series of scripts were working partly and part time.<br />
<br />
<br />
Thx!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgiusto</div><div class="date">16th September 2010, 16:30</div></div><div class="posttext">Hello, <br />
not sure of what are you meaning with 'So that was why the series of scripts were working partly and part time.'<br />
If you have scripts to ececute you should extract them in a convenient folder and then execute them.<br />
Usually you can extract them in the $PLUGINSDIR folder. This is a temp folder that nsis removes after installation.<br />
Look at the example provided with the plugin.<br />
Regards<br />
  Stefano</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>