<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Is it possible to locate a file from version information property?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Is it possible to locate a file from version information property? NSIS Discussion" />
	
	<title> Is it possible to locate a file from version information property? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Is it possible to locate a file from version information property?</div>
<hr />
<div class="pda"><a href="t-240731.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=240731">Is it possible to locate a file from version information property?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">13th March 2006, 17:39</div></div><div class="posttext">well, here is the scenario. I want to check a target machine if &quot;myapp.dll&quot; is installed and update it if needed with new one. Some strange user for some strange reason has renamed &quot;myapp.dll&quot; in &quot;another.dll&quot;. As far as I know by any documented way, there is not way to search and locate the file. My question is, could be possible to search all files in a dir looking at version information property tab? For example in description or in comments or in original file name? Is it possible for someone to grab such info?<br />
Note that the file is not shared or self registered etc so there are not any info in registry.<br />
<br />
P.S. OK, someone would say that the above is useless in real world. It is just a study affair.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dienjd</div><div class="date">13th March 2006, 18:59</div></div><div class="posttext">Have you looked into http://nsis.sourceforge.net/wiki/MD5_plugin ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th March 2006, 19:03</div></div><div class="posttext">That there ^^ is your best solution.<br />
Iterate through the files with FindFirst, FindNext, FindClose and compare each found files' MD5 checksum with a hardcoded checksum in a !define of the particular dll file that you are after. Obviously though if there are a lot of dll files in the folder it could take a while. If this is the case you could get a count of the files in the directory first and show a progress banner with the Banner plugin.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">14th March 2006, 08:12</div></div><div class="posttext">Name &quot;Output&quot;<br />
OutFile &quot;Output.exe&quot;<br />
<br />
!include &quot;FileFunc.nsh&quot;<br />
!insertmacro Locate<br />
<br />
!define DLL_PATH        &quot;C:\ftp&quot;<br />
!define DLL_SIZE_BYTES  &quot;158720&quot;<br />
!define DLL_MD5         &quot;be65a68caf476e39ff62af6813d0198f&quot;<br />
<br />
Section<br />
	StrCpy $R0 ''<br />
<br />
	${Locate} &quot;${DLL_PATH}&quot; &quot;/L=F /M=*.dll /S=0B&quot; &quot;LocateCallback&quot;<br />
<br />
	IfErrors 0 +2<br />
	MessageBox MB_OK &quot;Error&quot; IDOK +2<br />
	MessageBox MB_OK &quot;$$R0={$R0}&quot;<br />
SectionEnd<br />
<br />
Function LocateCallback<br />
	StrCmp $R6 ${DLL_SIZE_BYTES} 0 end<br />
<br />
	md5dll::GetMD5File &quot;$R9&quot;<br />
	Pop $0<br />
<br />
	StrCmp $0 ${DLL_MD5} 0 end<br />
	StrCpy $R0 $R9<br />
	StrCpy $0 StopLocate<br />
<br />
	end:<br />
	Push $0<br />
FunctionEndMD5 plugin (http://nsis.sourceforge.net/wiki/MD5_plugin) used</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">14th March 2006, 11:10</div></div><div class="posttext">Thank you all!<br />
i would say that the best reason why one should use NSIS is the instant and detailed feedback from the community.<br />
As I am examining the above by instructor I am able to find any file that I am looking for.<br />
Therefore, I understand that the conclusion is that it is not possible to grab details from the version information property tab.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th March 2006, 11:35</div></div><div class="posttext">It probably is possible, but using an MD5 would be a better solution as an MD5 checksum is unique to every non-identical file.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobGrant</div><div class="date">14th March 2006, 13:54</div></div><div class="posttext">I guess the only problem is that that's probably the least scaleable solution possible :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">14th March 2006, 14:36</div></div><div class="posttext">Therefore, I understand that the conclusion is that it is not possible to grab details from the version information property tab.There is a plugin which can be used to extract this information. It handles the standard Version Information fields and can also extract user defined entries:<br />
<br />
http://nsis.sourceforge.net/MoreInfo_plug-in</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">14th March 2006, 17:14</div></div><div class="posttext">well, MoreInfo plug-in is not the case since it requires a specific file name in the filename parameter, thereby it is useless on the above scenario.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">OldGrumpy</div><div class="date">14th March 2006, 18:09</div></div><div class="posttext">Red Wine,<br />
<br />
please see the example code from Instructor, the same method can be used with the MoreInfo plugin, just iterate through all the files matching your search filter. So it's not useless :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">14th March 2006, 20:39</div></div><div class="posttext">please see the example code from Instructor, the same method can be used with the MoreInfo plugin, just iterate through all the files matching your search filter. So it's not useless <br />
Sorry, I stuck here, I can't figure it out...<br />
Could you please set up an example just like the way Instructor did?<br />
<br />
Thanks in advance</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th March 2006, 20:46</div></div><div class="posttext">$R9 is the dll path and name.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">OldGrumpy</div><div class="date">14th March 2006, 21:31</div></div><div class="posttext">Red Wine:<br />
<br />
See Instructors code above, do you see the LocateCallback function? That is where all the work takes place. This function gets called for each file that matches the search pattern. Now, instead of <br />
md5dll::GetMD5File &quot;$R9&quot;<br />
just use any suitable function from the MoreInfo plugin. $R9 contains the full path and filename of the file found. I am too lazy to make up some sample code now, as I am still chewing on strange skinning effects, but I am sure you can figure it out now :)<br />
If not, please ask again and I'll whip up some sample code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">14th March 2006, 23:18</div></div><div class="posttext">I think I'll figure it out now, thanks.<br />
BTW examining some of the above I made a kind of auto creation for MD5 checksums. Please take a look.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">19th March 2006, 16:15</div></div><div class="posttext">It took me a while, though, I figured out how it works.<br />
With the compination of Locate and MoreInfo plug-in is possible to find any file in a target without the need to provide the file name nor the exact file size. All it needs is the file extension and the info from a supported by MoreInfo plug-in field.<br />
<br />
Name &quot;locate with moreinfo&quot;<br />
OutFile &quot;locate_moreinfo.exe&quot;<br />
ShowInstDetails show<br />
<br />
!include &quot;FileFunc.nsh&quot;<br />
!insertmacro Locate<br />
!insertmacro GetRoot<br />
<br />
!define DLL_PATH        &quot;$1&quot;<br />
!define DLL_ProductName &quot;My App***174; for Windows&quot;<br />
<br />
Function .onInit<br />
	${GetRoot} &quot;$PROGRAMFILES&quot; &quot;$1&quot;<br />
FunctionEnd<br />
<br />
Section<br />
 	StrCpy $R0 ''<br />
<br />
	${Locate} &quot;${DLL_PATH}&quot; &quot;/L=F /M=*.dll /S=0B&quot; &quot;LocateCallback&quot;<br />
<br />
	IfErrors 0 +2<br />
	MessageBox MB_OK &quot;Error&quot; IDOK +2<br />
	MessageBox MB_OK &quot;$$R0={$R0}&quot;<br />
	DetailPrint &quot;$$R0={$R0}&quot;<br />
SectionEnd<br />
<br />
Function LocateCallback<br />
	MoreInfo::GetProductName &quot;$R9&quot;<br />
	Pop $0<br />
<br />
	StrCmp '$0' '${DLL_ProductName}' 0 end<br />
	StrCpy &quot;$R0&quot; &quot;$R9&quot;<br />
	StrCpy &quot;$0&quot; StopLocate<br />
<br />
	end:<br />
	Push &quot;$0&quot;<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">20th March 2006, 14:35</div></div><div class="posttext">According to my quest for the given above scenario I had to navigate through the maze of several NSIS plugins and headers. The benefit is that I got my self a little deeper inside NSIS scripting and being able to make a fancy gui frontend for the md5dll. As far as I'm testing it on my XP-SP2 system I can't find any noteworthy bug. I'd like to kindly request the community to examine it and drop me a note if there is any.<br />
<br />
The NSIS script:<br />
!include 'TextFunc.nsh'<br />
!include 'FileFunc.nsh'<br />
!include 'WinMessages.nsh'<br />
!include 'LogicLib.nsh'<br />
!include 'StrFunc.nsh'<br />
<br />
${StrIOToNSIS}<br />
<br />
!define TEMP1 $R0<br />
!define LOG &quot;$EXEDIR\MD5_Builder.Log&quot;<br />
<br />
!insertmacro FileJoin<br />
!insertmacro GetTime<br />
!insertmacro GetFileName<br />
<br />
var md5_result<br />
var FILE_NAME<br />
var file<br />
var day<br />
var month<br />
var year<br />
var weekday<br />
var hour<br />
var min<br />
var sec<br />
var ctlcolor<br />
<br />
Name &quot;MD5 CheckSum Builder&quot;<br />
Caption &quot;MD5 CheckSum Builder&quot;<br />
OutFile &quot;Builder.exe&quot;<br />
BrandingText &quot; &quot;<br />
XPstyle on<br />
<br />
ReserveFile &quot;${NSISDIR}\Plugins\InstallOptions.dll&quot;<br />
ReserveFile &quot;builder.ini&quot;<br />
<br />
Page custom SetCustom ValidateCustom &quot;: Select a file&quot;<br />
PageEx instfiles<br />
Caption &quot;: Building MD5 CheckSum&quot;<br />
PageCallbacks &quot;&quot; &quot;&quot; InstFilesLeave<br />
PageExEnd<br />
<br />
<br />
Section &quot;builder&quot;<br />
   HideWindow<br />
<br />
   ReadINIStr '${TEMP1}' &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
   StrCpy '$FILE_NAME' '${TEMP1}'<br />
<br />
${If} ${FileExists} &quot;$FILE_NAME&quot;<br />
    ReadINIStr ${TEMP1} &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 5&quot; &quot;State&quot;<br />
 ${Unless} ${TEMP1} == &quot;1&quot;<br />
   ${GetFileName} &quot;$FILE_NAME&quot; $file<br />
   Call Get_Time<br />
   ReadINIStr ${TEMP1} &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 4&quot; &quot;State&quot;<br />
   ClearErrors<br />
   Call Build_md5<br />
   IfErrors _errors<br />
  ${Select} &quot;${TEMP1}&quot;<br />
   ${case} &quot;&quot;<br />
    WriteIniStr &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 4&quot; &quot;State&quot; \<br />
    &quot;MD5 checksum created at $weekday $day-$month-$year $hour:$min:$sec \<br />
    \r\n------------------------------------------------------------------------\r\nMD5 \<br />
    checksum for $file is: \r\n$md5_result&quot;<br />
    WriteIniStr &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 3&quot; &quot;Flags&quot; &quot;&quot;<br />
    WriteIniStr &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 5&quot; &quot;Flags&quot; &quot;&quot;<br />
    StrCpy $ctlcolor &quot;1&quot;<br />
   ${caseElse}<br />
    WriteIniStr &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 4&quot; &quot;State&quot; \<br />
    &quot;${TEMP1} \r\n\r\nMD5 checksum for $file is: \r\n$md5_result&quot;<br />
    StrCpy $ctlcolor &quot;1&quot;<br />
  ${EndSelect}<br />
 ${EndUnless}<br />
${EndIf}<br />
<br />
    ReadINIStr ${TEMP1} &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 5&quot; &quot;State&quot;<br />
<br />
${If} ${TEMP1} == '1'<br />
  ${AndIf} ${FileExists} &quot;${LOG}&quot;<br />
    ClearErrors<br />
    GetTempFileName $R7 $PLUGINSDIR<br />
    FileOpen $R8 $R7 a<br />
    ReadIniStr &quot;${TEMP1}&quot; &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 4&quot; &quot;State&quot;<br />
    ${StrIOToNSIS} $R0 &quot;${TEMP1}&quot;<br />
    FileWrite $R8 &quot;$R0 $\r$\n$\r$\n$\r$\n&quot;<br />
    FileClose $R8<br />
    IfErrors _errors<br />
    ${FileJoin} &quot;${LOG}&quot; &quot;$R7&quot; &quot;&quot;<br />
    IfErrors _errors<br />
    Exec '&quot;notepad.exe&quot; &quot;${LOG}&quot;'<br />
    WriteIniStr &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 3&quot; &quot;Flags&quot; &quot;DISABLED&quot;<br />
    WriteIniStr &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 5&quot; &quot;Flags&quot; &quot;DISABLED&quot;<br />
    WriteIniStr &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 4&quot; &quot;State&quot; &quot;&quot;<br />
<br />
 ${ElseIf} ${TEMP1} == '1'<br />
    ClearErrors<br />
    GetTempFileName $R7 $PLUGINSDIR<br />
    FileOpen $R8 $R7 a<br />
    ReadIniStr &quot;${TEMP1}&quot; &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 4&quot; &quot;State&quot;<br />
    ${StrIOToNSIS} $R0 &quot;${TEMP1}&quot;<br />
    FileWrite $R8 &quot;$R0 $\r$\n$\r$\n$\r$\n&quot;<br />
    FileClose $R8<br />
    IfErrors _errors<br />
    Rename $R7 &quot;${LOG}&quot;<br />
    Exec '&quot;notepad.exe&quot; &quot;${LOG}&quot;'<br />
    WriteIniStr &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 3&quot; &quot;Flags&quot; &quot;DISABLED&quot;<br />
    WriteIniStr &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 5&quot; &quot;Flags&quot; &quot;DISABLED&quot;<br />
    WriteIniStr &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 4&quot; &quot;State&quot; &quot;&quot;<br />
${EndIf}<br />
<br />
<br />
${If} ${Errors}<br />
  _errors:<br />
   WriteIniStr &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 4&quot; &quot;State&quot; \<br />
   &quot;MD5 checksum created at $weekday $day-$month-$year $hour:$min:$sec \<br />
   \r\n------------------------------------------------------------------------\r\nError \<br />
   creating MD5 checksum for $file&quot;<br />
   MessageBox MB_OK|MB_ICONSTOP 'Error creating MD5 checksum for $file'<br />
${EndIf}<br />
<br />
   WriteIniStr &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 2&quot; &quot;State&quot; &quot;&quot;<br />
   WriteIniStr &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 5&quot; &quot;State&quot; &quot;&quot;<br />
SectionEnd<br />
<br />
<br />
Function .onInit<br />
    InitPluginsDir<br />
    File /oname=$PLUGINSDIR\builder.ini &quot;_builder.ini&quot;<br />
FunctionEnd<br />
<br />
<br />
Function Get_Time<br />
    ${GetTime} &quot;&quot; &quot;L&quot; $day $month $year $weekday $hour $min $sec<br />
FunctionEnd<br />
<br />
<br />
Function Build_md5<br />
    md5dll::GetMD5File &quot;$FILE_NAME&quot;<br />
    Pop $0<br />
    StrCpy &quot;$md5_result&quot; &quot;$0&quot;<br />
    Push $0<br />
FunctionEnd<br />
 <br />
  <br />
Function SetCustom<br />
${If} $ctlcolor == &quot;1&quot;<br />
    Push ${TEMP1}<br />
    Push $6<br />
    InstallOptions::initDialog /NOUNLOAD &quot;$PLUGINSDIR\builder.ini&quot;<br />
    Pop ${TEMP1}<br />
    ReadINIStr $6 &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 3&quot; &quot;HWND&quot;<br />
    SetCtlColors $6 0x3E55B0 transparent<br />
    ReadINIStr $6 &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 4&quot; &quot;HWND&quot;<br />
    SetCtlColors $6 0x000000 0xFFFFFF<br />
    InstallOptions::show<br />
    Pop ${TEMP1}<br />
    Pop $6<br />
 ${Else}<br />
    Push ${TEMP1}<br />
    InstallOptions::dialog &quot;$PLUGINSDIR\builder.ini&quot;<br />
    Pop ${TEMP1}<br />
    Pop ${TEMP1}<br />
${EndIf}<br />
FunctionEnd<br />
<br />
<br />
Function ValidateCustom<br />
    ReadINIStr '${TEMP1}' &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 5&quot; &quot;State&quot;<br />
${If} ${TEMP1} &lt;&gt; &quot;1&quot;<br />
    ReadINIStr '${TEMP1}' &quot;$PLUGINSDIR\builder.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
${EndIf}<br />
${If} ${TEMP1} == &quot;&quot;<br />
    MessageBox MB_ICONEXCLAMATION|MB_OK &quot;You must select a valid file!&quot;<br />
    Abort<br />
${EndIf}<br />
    StrCpy $ctlcolor &quot;&quot;<br />
FunctionEnd<br />
<br />
Function InstFilesLeave<br />
    Bringtofront<br />
    SendMessage $HWNDPARENT &quot;0x408&quot; &quot;-1&quot; &quot;0&quot;<br />
    Abort<br />
FunctionEnd<br />
<br />
The InstallOptions INI:<br />
[Settings]<br />
NumFields=5<br />
NextButtonText=Build<br />
CancelButtonText=Close<br />
<br />
[Field 1]<br />
Type=GroupBox<br />
Left=0<br />
Right=-1<br />
Top=0<br />
Bottom=-1<br />
Text=&quot; Browse for the file to create the MD5 checksum... &quot;<br />
<br />
[Field 2]<br />
Type=FileRequest<br />
Left=11<br />
Right=-11<br />
Top=25<br />
Bottom=38<br />
Filter=Program Files|*.exe|DLL Files|*.dll|All files|*.*<br />
Flags=FILE_MUST_EXIST|FILE_EXPLORER<br />
<br />
[Field 3]<br />
Type=Label<br />
Left=14<br />
Right=-120<br />
Top=45<br />
Bottom=55<br />
Text=&quot;MD5 Checksum Builder Log&quot;<br />
Flags=DISABLED<br />
<br />
[Field 4]<br />
Type=Text<br />
Flags=VSCROLL|MULTILINE|READONLY<br />
State=<br />
Left=11<br />
Right=-12<br />
Top=56<br />
Bottom=112<br />
<br />
[Field 5]<br />
Type=radiobutton<br />
Text=&quot; Dump Log Window to file&quot;<br />
Left=12<br />
Right=-120<br />
Top=116<br />
Bottom=124<br />
State=<br />
Flags=DISABLED</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>