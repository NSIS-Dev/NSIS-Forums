<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Troubles when retrieving the state of a checkbox, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Troubles when retrieving the state of a checkbox NSIS Discussion" />
	
	<title> Troubles when retrieving the state of a checkbox [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Troubles when retrieving the state of a checkbox</div>
<hr />
<div class="pda"><a href="t-282186.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=282186">Troubles when retrieving the state of a checkbox</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">mikkelmr</div><div class="date">27th November 2007, 09:23</div></div><div class="posttext">Hi all<br />
<br />
Using nsDialogs, I'm trying to check the state of a checkbox each time it's clicked.<br />
<br />
First of all it seems like the nsDialogs::OnChange event isn't working for checkboxes... or am I wrong?<br />
<br />
Instead I tryed the nsDialogs::OnClick event like this:<br />
<br />
GetFunctionAddress $0 onClick<br />
nsDialogs::OnChange /NOUNLOAD $CHECKBOX $0<br />
<br />
Function onClick<br />
	SendMessage $CHECKBOX ${BM_GETSTATE} 0 0 $0<br />
<br />
	${If} $0 == &quot;1&quot;<br />
		MessageBox MB_ICONEXCLAMATION|MB_OK &quot;CheckBox checked&quot;	<br />
	${Else}<br />
		MessageBox MB_ICONEXCLAMATION|MB_OK &quot;CheckBox unchecked&quot;	<br />
	${EndIf}<br />
<br />
FunctionEnd<br />
<br />
The problem is that the value/state of the checkbox is either 520 or 521, when checked in the onClick event handler.<br />
<br />
But when checked in the leave page function it's 0 or 1.<br />
<br />
How come this behavior? Is a bug or am I doing something wrong?<br />
<br />
Best regards<br />
Mikkel Munck Rasmussen</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">27th November 2007, 18:04</div></div><div class="posttext">You should indeed use OnClick for checkboxes. You can use the ${NSD_OnClick} macro for easier usage.<br />
<br />
520 and 521 are invalid states. I don't understand how you can get them from BM_GETSTATE.<br />
<br />
Also, you forgot to pop the HWND in OnCLick. $CHECKBOX is passed on the stack and must be popped or else the stack would get corrupted.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mikkelmr</div><div class="date">27th November 2007, 19:15</div></div><div class="posttext">Thanks a lot for your answer<br />
<br />
Well, I based my code on the example that comes with the NSIS installation: NSISDIR\Examples\nsDialogs\example.nsi<br />
<br />
And the problem is the same here. You can check this by changing the OnCheckbox function on line 69 to:<br />
<br />
Function OnCheckbox<br />
<br />
  SendMessage $CHECKBOX ${BM_GETSTATE} 0 0 $0<br />
  MessageBox MB_OK &quot;Checkbox state: $0&quot;<br />
<br />
FunctionEnd<br />
<br />
And the problem is the same.<br />
<br />
<br />
And what do you mean by &quot;pop the HWND in OnClick&quot;? Could you please provide an example?<br />
<br />
Thanks in advance<br />
<br />
\Mikkel</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">27th November 2007, 21:02</div></div><div class="posttext">Use BM_GETCHECK instead. I don't know what are those 0x208 flags BM_GETSTATE adds, but BM_GETCHECK seems to work better.<br />
<br />
As for popping, the examples were flawed. I fixed them for the next version. You just have to Pop one item from the stack every time your OnClick and OnChange callback function is called. That item is the HWND of the item for which the notification is sent.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mikkelmr</div><div class="date">28th November 2007, 10:04</div></div><div class="posttext">Thanks a lot for your help!<br />
<br />
BM_GETCHECK did the job.<br />
<br />
\Mikkel</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>