<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" GetFileTime Example, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  GetFileTime Example NSIS Discussion" />
	
	<title> GetFileTime Example [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  GetFileTime Example</div>
<hr />
<div class="pda"><a href="t-102030.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=102030">GetFileTime Example</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">26th August 2002, 17:08</div></div><div class="posttext">Hey, Basically I need to replace a file only if its newer than the existing one. I can't find any examples using the GetFileTime function. Some help would be appreciated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">R@m00n</div><div class="date">26th August 2002, 17:34</div></div><div class="posttext">Here's a small example:<br />
<br />
It shows the functionallity of GetFileTime:<br />
<br />
Use StrCmp $1 NEWTIME to check if other file or not.<br />
<br />
<br />
OutFile &quot;Setup.exe&quot;<br />
InstallDir '$PROGRAMFILES\Test'<br />
<br />
LoadLanguageFile &quot;../../Contrib/Language Files/German.nlf&quot;<br />
Caption &quot;Test&quot;<br />
Name &quot;Test&quot;<br />
DirText &quot;Test&quot; <br />
<br />
Section &quot;Test&quot;<br />
 SetOutPath $INSTDIR<br />
SectionEnd<br />
<br />
Function .onInit<br />
 GetFileTime GetFileTime.nsi $0 $1<br />
 MessageBox MB_OK $0      ; file created<br />
 MessageBox MB_OK $1      ; file last changed<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">26th August 2002, 17:41</div></div><div class="posttext">thanks for the example. I did something similar to try it but one of the files I tried returned a negative number. An example comparing two file would be more benifical. Thanks again though for your help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th August 2002, 17:47</div></div><div class="posttext">GetFileTime returns two values that are actually one value split in half. There is the low half, and the high half. The high half is &quot;worth&quot; more, to get its real value you need to multiply it by 2^32. NSIS can only handle integers that can hold up to 32 bits, and can't hold this huge numbers, and that's why it is split in two. Because the high part is &quot;worth&quot; more you first need to compare it. If the high part is larger than the other high part the entire number is bound to be higher too. If the high parts are the same, then you need to compare the low parts.<br />
<br />
I use IntCmpU because a DWORD is an unsigned long.<br />
<br />
<br />
!define LOW1 $0<br />
!deinfe HIGH1 $1<br />
!define LOW2 $2<br />
!deinfe HIGH2 $3<br />
GetFileTime ${FILENAME} ${HIGH1} ${LOW1}<br />
GetFileTimeLocal &quot;c:\\program files\\local file.dat&quot; ${HIGH2} ${LOW2}<br />
IntCmpU ${HIGH1} ${HIGH2} 0 local_is_newer user_has_newer<br />
  ; compare lows<br />
  IntCmpU ${LOW1} ${LOW2} 0 local_is_newer user_has_newer<br />
    ; files has the same time<br />
    Return<br />
<br />
  local_is_newer:<br />
    ; user has an old file, install a newer version<br />
    File /oname=${FILENAME} &quot;localfile.dat&quot;<br />
    Return<br />
<br />
  user_has_newer:<br />
    ; user has a newer version<br />
    MessageBox MB_OK &quot;cheater!&quot;</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>