<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" EnumRegKey error! Please help -, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  EnumRegKey error! Please help - NSIS Discussion" />
	
	<title> EnumRegKey error! Please help - [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  EnumRegKey error! Please help -</div>
<hr />
<div class="pda"><a href="t-273797.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=273797">EnumRegKey error! Please help -</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">paulSeldon</div><div class="date">3rd July 2007, 10:40</div></div><div class="posttext">This is checking for Window Media Player is installed or not, if not get it and install but there is error...<br />
<br />
Please, any expert on this, help me.  newbie at NSIS.<br />
<br />
&lt; Error occurred at here --------------------------- &gt;<br />
<br />
EnumRegKey $wmpVersion HKLM &quot;SOFTWARE\Microsoft\Windows Media\Format&quot; $R0<br />
<br />
&lt; -------------------------------------------------- &gt;<br />
<br />
--Paul<br />
<br />
;---------------------------------------------------------<br />
Function checkForWMP<br />
<br />
Push $R0<br />
StrCpy $installWMP &quot;no&quot;<br />
StrCpy $R0 0<br />
<br />
Goto search<br />
search:<br />
EnumRegKey $wmpVersion HKLM &quot;SOFTWARE\Microsoft\Windows Media\Format&quot; $R0<br />
<br />
;SOFTWARE\Microsoft\Windows Media\Format&quot; $R0<br />
IfErrors notfound<br />
StrCpy $wmpVersion $wmpVersion 3<br />
<br />
;StrCmp $wmpVersion &quot;9&quot; found<br />
;StrCmp $wmpVersion &quot;10&quot; found<br />
StrCmp $wmpVersion &quot;11&quot; found  <br />
StrCmp $wmpVersion &quot;&quot;   notfound<br />
<br />
IntOp $R0 $R0 + 1<br />
Goto search<br />
<br />
notfound:<br />
MessageBox MB_YESNO &quot;You need the latest Window Media Player to use this Software. Install one now?$\n\<br />
                     Choosing No will abort the installation of the player.&quot; \<br />
                     IDYES install \<br />
                     IDNO noinstall<br />
                        <br />
Goto done<br />
<br />
install:<br />
StrCpy $installWMP &quot;yes&quot;<br />
MessageBox MB_OK  &quot;The Latest Window Media Player needs to be downloaded. Please establish a connection to$\n\<br />
                   the Internet and then click on OK to continue.&quot; <br />
<br />
NSISdl::download /TIMEOUT=30000 &quot;http://www.myDigit.com/pcplayer/wmp11-windowsxp-x86-enu.exe&quot; &quot;$INSTDIR\wmp11-windowsxp-x86-enu.exe&quot;<br />
<br />
Pop $R0 ;Get the return value<br />
StrCmp $R0 &quot;success&quot; done<br />
  MessageBox MB_OK &quot;Download of Window Media Player failed: $R0$\nAborting installation...&quot;<br />
Quit<br />
<br />
Goto done<br />
<br />
noinstall:<br />
Quit<br />
<br />
found:<br />
;MessageBox MB_OK &quot;Found WMP version: $wmpVersion&quot;<br />
Goto done<br />
<br />
done:<br />
Pop $R0<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">3rd July 2007, 11:08</div></div><div class="posttext">Are you sure you need enum here? My registry has a single string named &quot;Format&quot; containing &quot;11.0.0.5145&quot; in &quot;HKLM\SOFTWARE\Microsoft\Windows Media&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrDan</div><div class="date">3rd July 2007, 11:40</div></div><div class="posttext">... using ReadRegStr or maybe the IfKeyExists macro from the NSIS wiki: http://nsis.sourceforge.net/Check_for_a_Registry_Key</div></div><hr />


<div class="post"><div class="posttop"><div class="username">paulSeldon</div><div class="date">3rd July 2007, 13:01</div></div><div class="posttext">I am a completely NEWBie...<br />
Anders is right. Then what do I need to do?<br />
 &quot;HKLM\SOFTWARE\Microsoft\Windows Media&quot;<br />
<br />
step 1. I get the format value (11.0..)<br />
step 2. I store it into <br />
step 3. if the value is less than 11.<br />
step 4. prompt user to shall upgrade?<br />
step 5. if the format doesn't exist, <br />
step 6. prompt user to download...<br />
<br />
This is the whole logic.  <br />
What do I need to do that? step 1.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">paulSeldon</div><div class="date">3rd July 2007, 13:06</div></div><div class="posttext">;----------------------------------------------------------<br />
<br />
!insertmacro IfKeyExists &quot;ROOT&quot; &quot;KeyToCheckIn&quot; &quot;KeyToCheck&quot;<br />
Pop $R0<br />
;$R0 contains 0 (not present) or 1 (present)<br />
<br />
;----------------------------------------------------------<br />
DrDan, in my case, what do I need to put in the place of <br />
1. &quot;ROOT&quot; <br />
2. &quot;KeyToCheckIn&quot;<br />
3. &quot;KeyToCheck&quot;<br />
<br />
It will be really appreciated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">paulSeldon</div><div class="date">3rd July 2007, 13:09</div></div><div class="posttext">!insertmacro IfKeyExists &quot;ROOT&quot; <br />
&quot;HKLM\SOFTWARE\Microsoft\Windows Media&quot; &quot;Format&quot;<br />
Pop $R0<br />
<br />
DrDan, is it like this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrDan</div><div class="date">3rd July 2007, 13:14</div></div><div class="posttext">You need to do something like<br />
<br />
<br />
!insertmacro IfKeyExists &quot;HKLM&quot; &quot;SOFTWARE\Microsoft\Windows Media&quot; &quot;Format&quot;<br />
Pop $R0<br />
<br />
<br />
Try this in a barebones installer to make sure it does what you think.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrDan</div><div class="date">3rd July 2007, 13:19</div></div><div class="posttext">I don't have the reg key you give in my registry.<br />
<br />
If you need to get the reg *value*, read the NSIS docs for EnumRegValue and basically all you need to do is write another macro replacing EnumRegValue with EnumRegKey (hint: copy the macro IfKeyExists.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">paulSeldon</div><div class="date">3rd July 2007, 14:01</div></div><div class="posttext">Is it going to work like following.<br />
<br />
;------------------------------------------------<br />
Function checkForWMP<br />
<br />
Push $R0<br />
StrCpy $installWMP &quot;no&quot;<br />
StrCpy $R0 0<br />
Push $0<br />
 <br />
<br />
Goto search<br />
search:<br />
<br />
 ClearErrors<br />
  ReadRegStr $0 HKLM &quot;SOFTWARE\Microsoft\Windows Media&quot; &quot;Format&quot;<br />
<br />
;ReadRegStr $0 HKLM &quot;SOFTWARE\Microsoft\Windows Media&quot; &quot;Format&quot;<br />
;EnumRegKey $0 HKLM &quot;SOFTWARE\JavaSoft\Java Runtime Environment&quot; $R0<br />
IfErrors notfound<br />
StrCpy $0 $0 3<br />
<br />
StrCmp  $0 &quot;11&quot; found  <br />
StrCmp  $0 &quot;&quot; notfound<br />
<br />
IntOp $R0 $R0 + 1<br />
Goto search<br />
<br />
notfound:<br />
MessageBox MB_YESNO &quot;You need a suitable Window Media Player to use this Software. Install one now?$\n\<br />
                     Choosing No will abort the installation of the player.&quot; \<br />
                     IDYES install \<br />
                     IDNO noinstall<br />
                        <br />
Goto done<br />
<br />
install:<br />
StrCpy $installWMP &quot;yes&quot;<br />
<br />
MessageBox MB_OK &quot;Window Media Player needs to be downloaded. Please establish a connection to$\n\<br />
                  the Internet and then click on OK to continue.&quot; <br />
<br />
NSISdl::download /TIMEOUT=30000 &quot;http://www.myDigit.com/pcplayer/wmp11-windowsxp-x86-enu.exe&quot; &quot;$INSTDIR\wmp11-windowsxp-x86-enu.exe&quot;<br />
Pop $R0 ;Get the return value<br />
StrCmp $R0 &quot;success&quot; done<br />
  MessageBox MB_OK &quot;Download of Window Media Player failed: $R0$\nAborting installation...&quot;<br />
Quit<br />
<br />
Goto done<br />
<br />
noinstall:<br />
Quit<br />
<br />
found:<br />
;MessageBox MB_OK &quot;Found Window Media Player version: $javaVersion&quot;<br />
Goto done<br />
<br />
done:<br />
Pop $R0<br />
<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>