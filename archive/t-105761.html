<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Features request :), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Features request :) NSIS Discussion" />
	
	<title> Features request :) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Features request :)</div>
<hr />
<div class="pda"><a href="t-105761.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=105761">Features request :)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">17th September 2002, 23:44</div></div><div class="posttext">Heh, I think it would be great to add a Subsection Rename hint to the documentation (SectionSetText Name &quot;-Caption&quot; :), 'cause it's not very amazing to search for this thru source code :)<br />
<br />
Now, the feauture request :) Is it posible for InstType to became Multi-lingual?<br />
<br />
And at last: can you help me to find sources for MagicLime? I would like to add some features (for the first make it a Plugin :) to it and I'm too lazy (now) to write such a cool fading by myself :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">17th September 2002, 23:48</div></div><div class="posttext">In addition to my poor English your cool board system ate all my closing brackets :) <br />
<br />
Hope you'll understand me...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">18th September 2002, 01:14</div></div><div class="posttext">In addittion: russian text for the button &quot;Show Details&quot; is too long (modern2.exe). So, you could either change it to &quot;Äåòàëè&quot; or enlarge the button...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">18th September 2002, 01:27</div></div><div class="posttext">Huh, I'm having a great pleasure spaming at your forum! :)<br />
<br />
What about the uninstaller translation? There are options (/LANG=) at uninstaller commands and there are translated uninstaller strings at MultiLinguage.nsi. But neither your example uninstaller translation or my own uninstaller trans. works... <br />
It's 3:23 a.m. at my country and really hard for me to think and scan your sources already... :) May be you have a $(LANG) variable and I must save it during install process and restore at uninstaller start? Who knows... :)<br />
I hope I'll get tomorrow (today) at the morning and find answers to all my questions... Good luck to me... :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th September 2002, 08:47</div></div><div class="posttext">Now, the feauture request  Is it posible for InstType to became Multi-lingual?<br />
Already in the todo list.<br />
<br />
And at last: can you help me to find sources for MagicLime? I would like to add some features (for the first make it a Plugin  to it and I'm too lazy (now) to write such a cool fading by myself<br />
It is now called UberSplash and its sources are avaiable in the contrib dir.<br />
<br />
In addittion: russian text for the button &quot;Show Details&quot; is too long (modern2.exe). So, you could either change it to &quot;Äåòàëè&quot; or enlarge the button...<br />
Talk to the translator and have hime send me a new translation.<br />
<br />
What about the uninstaller translation?<br />
It won't remember the language you have used in the installer. The first option is the system language, then what you choose in .onInit. You can, as you said, save it somewhere from the registry.<br />
<br />
Please edit your message next time to add tiny details...<br />
Check &quot;Disable Smilies in This Post&quot; if you don't want :) to be a smily.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">19th September 2002, 10:13</div></div><div class="posttext">I'm spotted bug (or feature :)) at InstallOptions: if the user closed the window with the X icon (heh, close mark at the top-right of the window), WM_CLOSE message sent directly to parent, so dialog finishes with &quot;success&quot; result. Hm... Strange behavior, I think :)<br />
<br />
I've patched ParentWndProc for my needs by inserting that before the last return:<br />
<br />
  if (message == WM_CLOSE)<br />
  {<br />
        PostMessage(hConfigWindow,WM_USER+666,0,IDCANCEL);<br />
        return 0;<br />
  }<br />
<br />
Tested and works fine...<br />
The second &quot;feature&quot; was found at ModernUI.nsh: by removing the &quot;goto done&quot; line at MUI_HEADER_TEXT macro (and decreasing StrCmp jump value) we'll receive some additional functionality (for the CPU consumption cost to follow all other branches of course): for example it will be easier to create InstallOptions pages at uninstaller:<br />
<br />
   !insertmacro MUI_HEADER_START 2<br />
     !insertmacro MUI_HEADER_TEXT 1033 &quot;Options&quot; &quot;Select options.&quot;<br />
<br />
     ; Uninstall options dialog<br />
     Push $7<br />
     CallInstDLL $8 dialog<br />
     Pop $0<br />
     StrCmp $0 &quot;success&quot; &quot;&quot; hdrend<br />
   <br />
     !insertmacro MUI_HEADER_TEXT 1033 &quot;Uninstalling&quot; &quot;Wait.&quot;<br />
   !insertmacro MUI_HEADER_STOP 2<br />
hdrend:<br />
<br />
One more question: is there any way to tell uninstaller we want to cancel uninstallation process from &quot;un.&quot; functions (can be very useful if we are using InstallerOptions for example)?<br />
<br />
By the way: I was very suprised to found uninstaller using the same engine as installer, so we could pack and use anything during uninstallation process... Great thing!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">19th September 2002, 11:34</div></div><div class="posttext">Originally posted by brainsucker <br />
The second &quot;feature&quot; was found at ModernUI.nsh: by removing the &quot;goto done&quot; line at MUI_HEADER_TEXT ... <br />
You can add your own function to .onNextPage and .onPrevpage, but this is a little bit easier. I'll change this stuff a bit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th September 2002, 14:59</div></div><div class="posttext">One more question: is there any way to tell uninstaller we want to cancel uninstallation process from &quot;un.&quot; functions (can be very useful if we are using InstallerOptions for example)?<br />
<br />
Have you tried Abort or Quit?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">19th September 2002, 15:22</div></div><div class="posttext">Have you tried Abort or Quit? <br />
<br />
I've tried Abort - it succesfully returns to previous page, even if page is first (May be this behaviour should be patched?). Quit... hm... Telling the truth I'm lost that command in tons of printed NSIS documentation :)... Beside this, isn't it a emergency quit command? No callabacks and so on... <br />
<br />
Ok, there is another question: Plugin commands return. For example InstallOptions returns to stack, and that destroys the beaty of &quot;dll:proc&quot; plugin call... I would like to propose to use one of 2 behaviors as default:<br />
1) Return to $0 (NSISdl is using such way). I think this way can be sometimes cumbersome, cause the user cannot select the output register...<br />
2) Use extended syntax, for example &quot;dll::proc /RET=$0 $1 $2 $3&quot;, where $0 receives the function return, and $1 and etc are usual parameters.<br />
<br />
More over, I would like to propose Dll procs to use default return way (int dialog(), &quot;return 0;&quot; for example :)) and NSIS to hold all other work... In other case plugins may return on stack and NSIS may automaticaly insert pop command... Huh...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th September 2002, 15:52</div></div><div class="posttext">Abort returns to the previous page only in un.onNextPage.<br />
<br />
I can make the plugin command auto insert pop commands, but the question is, what would be a good syntax. Both of your suggestions are not good INMHO. The first one, as you said, forces one to use $0. The second can conflict with plugins that might want /RET as a paremeter. How would NSIS know if it's a parameter or a return statement?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">19th September 2002, 16:54</div></div><div class="posttext">I made some changes to the Modern UI macro system. You can now add a new page to the SetPage function for InstallOptions. Make sure that you change the ${CURRENTPAGE} variable and call SetPage again depending on what the user does on the IO dialog.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">19th September 2002, 18:04</div></div><div class="posttext">Originally posted by kichik <br />
Abort returns to the previous page only in un.onNextPage.<br />
<br />
That's right! I'm at general a newbie to NSIS, and don't know other places where I can place my InstallOptions dialog (during uninstall!) :). Any ideas? Of course, I can wait for example 'till un.onInitDialog receives control and handle Cancel (i.e. call Abort) here, but this way is smelting bad... The other way (huh, worse than previous i think) is to wait for uninstall to begin and call Abort as the first command... May be I'm broken my logic somewhere at university today, but I don't see any other ways to do that damn Cancel :)<br />
<br />
And what about Abort as Cancel at un.onNextPage for first page?<br />
<br />
 Both of your suggestions are not good INMHO. <br />
Ok, ok... Any other ideas?<br />
I just dislike the stack return method, because later it is likely to become reason of many users bugs (&quot;I dont need the return, so I'll not pop...&quot; -&gt; stack corruption).<br />
<br />
Originally posted by Joost Verburg<br />
I made some changes to the Modern UI macro system.<br />
Ok, I have to wait for nightly CVS snapshot :(, and than I'll try it...<br />
<br />
P.S. Somebody knows when it (snapshot) occurs? :) (in GMT please)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th September 2002, 18:15</div></div><div class="posttext">Use Quit in un.onNextPage.<br />
We have thought of some ideas for that plugin stuff but couldn't find any good ideas. Users can not put /RET= too, so it doesn't really help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">19th September 2002, 18:41</div></div><div class="posttext">Integer values at NSIS are int 32 or int 64? int or uint? thanx :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th September 2002, 18:49</div></div><div class="posttext">They are strings :)<br />
You can compare as unsigned or signed using IntCmpU or IntCmp, calculate as signed using IntOp, and print as whatever you want with IntFmt. All ints, when converted, are held in a 32 bit int.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">19th September 2002, 22:37</div></div><div class="posttext">There was a while back a lengthy discussion between myself, KiCHiK and a few others about the return value of plugin calls. It is far from a simple problem.<br />
<br />
Due to the way NSIS works internally it doesn't make sense to try and define target variables for each return value (as one of your ideas suggested) and the other idea of using $0 assumes that there is only a single returned value.<br />
<br />
How about if there were a second stack, cleared on every plugin call and then plugins stack their return values onto this second stack. There'd be no problems with stack corruption because it wouldn't be altering the main stack, it could cope with many return values, and we could add a PopRet op ala normal Pop but for the return value stack. I don't think script code should be allowed to Push to this special stack, only the plugin.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">19th September 2002, 23:16</div></div><div class="posttext">Originally posted by brainsucker <br />
I'm spotted bug (or feature :)) at InstallOptions: if the user closed the window with the X icon (heh, close mark at the top-right of the window), WM_CLOSE message sent directly to parent, so dialog finishes with &quot;success&quot; result. Hm... Strange behavior, I think :)<br />
<br />
<br />
Hm... Time passed... Heh... Just expecting comments, cause I don't like the idea of shipping my patched InstallOptions with my software for the rest of my life... :)<br />
May be I'm wrong and this behavior of InstallOptions is ok?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th September 2002, 23:39</div></div><div class="posttext">eccles will be working on this among some other stuff for IO.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">21st September 2002, 00:03</div></div><div class="posttext">Just noticed dll::proc plugin call passes parameters to stack at left-to-right order, so the first argument pops out as last... Strange behavior, I think... For example it make functions with variable arguments count much more complicated! And what about other languages examples? For example all C/++ calling conventions pass arguments at right-to-left order...<br />
<br />
Have I any powers to affect the NSIS developers? :((</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st September 2002, 00:08</div></div><div class="posttext">No, because that's the way the old CallInstDLL way worked. You push push push, and get it from bottom to top, same as right to left. Maybe I will add a compiler flag that will make it push from right to left. C++ calling convention has nothing to do with it, the parameters are pushed to the NSIS stack.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">21st September 2002, 00:25</div></div><div class="posttext">in the assembler you push 3 push 2 push 1, but when C compiler compiles it actually reverses the order, so proc(1,2,3) looks like the same push 3 push 2 push 1! That's not the matter of stack we use, but the matter of usability,:) That is not a lecture, just a note...<br />
<br />
Ok.. I understand you position, but d::p is actually a new feature to nsis 2, so it's the best time to apply changes! Latter it will much more complicated... In fact all plugins will be updated and NSIS scripts too! Please....!!! You know not worse than me, that such &quot;features&quot; could grow like a snow ball....<br />
<br />
By the way: adding a compiler flag -&gt; incompatible plugins (anyway, for some order of passing)...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">21st September 2002, 08:54</div></div><div class="posttext">mydll::myfunc arga argb argc<br />
<br />
Translates to (pseudo code)<br />
<br />
push arga<br />
push argb<br />
push argc<br />
<br />
So the top of the stack (i.e. the first item to be popped) is argc.<br />
<br />
Hence in the plugin c/c++ code when it does popstring it gets arguments in reverse order. This has NOTHING to do with the compiler<br />
and EVERYTHING to do with the NSIS stack and original CallInstDLL behaviour.<br />
<br />
I don't see a problem with this, so the c/c++ code has to popstring args in reverse order, your problem is what exactly? This never affects a user of NSIS scripts or plugins, just plugin developers.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">21st September 2002, 13:25</div></div><div class="posttext">Huh, I've mentioned C compiler and Asm, just like examples of REAL LANGUAGES args passing conventions. :)<br />
<br />
Ok, I understand the thing: when plugin system developed it looked easyer for users to push parameters at right order (first...last). <br />
But now, when dll::proc macro incorporated, it is very unlikely somebody will use the old CallInstDll method, and such proffesionals, which will do, the are able to revert the order (last..first). And for macro (that's wrong name for it, I know, just short :) it's nothing to do... That will require small recoding of present plugins, but these small spendings will make life easyer for plugin developers a lot!<br />
<br />
Now, WHY we should do that? Ok, there are several reasons:<br />
1) If users passes the arg at first place, the plugin may want to take that arg in hands at the very beginning.<br />
2) The main reason: formal arguments lists, as they named in C. The plugin function may expect the variable number of args (for example, let this function to be the printf (wsprintf) clone). The function starts poping out args, but it don't know where to stop to read the real output format specification (something like &quot;hello, %s=%d&quot;), and it don't know the count of args. (Yes, we could invert the args order and user will call [dll::printf 1982 &quot;a+b&quot; &quot;hello, %s=%d&quot;], but...)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">21st September 2002, 15:04</div></div><div class="posttext">Okay in the situation where the first parameter popped tells the plugin code how many more parameters it should grab I see your point.<br />
<br />
As for the stacking thing it turns out the code has been changed since then. The way it worked before was that there was a custom opcode for plugin commands and that opcode stored string ids so it was limited by opcode storage space, that is no longer true.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">justin</div><div class="date">22nd September 2002, 00:30</div></div><div class="posttext">I agree, pushing the first parameter last makes sense :) Yes, just like real languages like C (worth noting that pascal at least used to do it the other way, which sucked).<br />
<br />
The version in CVS is updated to do reverse-order. <br />
<br />
-Justin<br />
<br />
Originally posted by brainsucker <br />
Huh, I've mentioned C compiler and Asm, just like examples of REAL LANGUAGES args passing conventions. :)<br />
<br />
Ok, I understand the thing: when plugin system developed it looked easyer for users to push parameters at right order (first...last). <br />
But now, when dll::proc macro incorporated, it is very unlikely somebody will use the old CallInstDll method, and such proffesionals, which will do, the are able to revert the order (last..first). And for macro (that's wrong name for it, I know, just short :) it's nothing to do... That will require small recoding of present plugins, but these small spendings will make life easyer for plugin developers a lot!<br />
<br />
Now, WHY we should do that? Ok, there are several reasons:<br />
1) If users passes the arg at first place, the plugin may want to take that arg in hands at the very beginning.<br />
2) The main reason: formal arguments lists, as they named in C. The plugin function may expect the variable number of args (for example, let this function to be the printf (wsprintf) clone). The function starts poping out args, but it don't know where to stop to read the real output format specification (something like &quot;hello, %s=%d&quot;), and it don't know the count of args. (Yes, we could invert the args order and user will call [dll::printf 1982 &quot;a+b&quot; &quot;hello, %s=%d&quot;], but...)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">22nd September 2002, 09:12</div></div><div class="posttext">I have to wait for the evening to download the latest CVS snapshot, so I couldn't check now, but you haven't updated the plugins for sure... <br />
<br />
So, there is a bit of work for somebody...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Koen van de Sande</div><div class="date">22nd September 2002, 10:46</div></div><div class="posttext">But justin did update most of the plugins :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">27th September 2002, 00:06</div></div><div class="posttext">Originally posted by brainsucker <br />
I'm spotted bug (or feature :)) at InstallOptions: if the user closed the window with the X icon (heh, close mark at the top-right of the window), WM_CLOSE message sent directly to parent, so dialog finishes with &quot;success&quot; result. Hm... Strange behavior, I think :)<br />
<br />
I've now added your fix, thanks. :) Available from the usual place.<br />
<br />
-- <br />
Dave Laundon.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">28th September 2002, 17:52</div></div><div class="posttext">thanx eccles. <br />
<br />
I've got another 'feature request' (to the whole nsis developers team): couldn't you add something like permanent subj (/NOUNLOAD) option? In some cases there will be many calls to plugin (for example System plugin :), and using /NOUNLOAD every time... hm :( <br />
Allow NSIS to unload plugin everytime? A resource consuming solution, <br />
futhermore plugin may want to save something in it's own static vars... (bad habbit, I know :)<br />
<br />
P.S. Something like 'SetDllUnload on|off' will do the thing, I think... ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd October 2002, 20:20</div></div><div class="posttext">Done. Added SetPluginUnload manual|alwaysoff.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>