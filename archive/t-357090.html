<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" ExecWait as user, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  ExecWait as user NSIS Discussion" />
	
	<title> ExecWait as user [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  ExecWait as user</div>
<hr />
<div class="pda"><a href="t-357090.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=357090">ExecWait as user</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">azureusvuze</div><div class="date">10th March 2013, 09:57</div></div><div class="posttext">Anyone have plugin which can ExecWait as user privileges?<br />
<br />
Usually i used:<br />
Push &quot;$EXEDIR\${APPDIR}\${APPEXE}&quot;<br />
Push &quot;open&quot;<br />
Push '${APPSWITCH} $0'<br />
StdUtils::ExecShellAsUser /NOUNLOAD<br />
FindProcDLL::WaitProcEnd &quot;${APPEXE}&quot; -1</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">10th March 2013, 15:17</div></div><div class="posttext">If you need to run a application as the user (other than the finish checkbox) you are probably doing something wrong...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">10th March 2013, 22:47</div></div><div class="posttext">What you want is not possible the way &quot;ExecShellAsUser&quot; works. The implementation of ExecShellAsUser in the StdUtils plug-in is based on the IShellDispatch2 (http://msdn.microsoft.com/de-de/library/windows/desktop/bb774138%28v=vs.85%29.aspx) COM interface. And if you look at the ShellExecute  (http://msdn.microsoft.com/de-de/library/windows/desktop/bb774148%28v=vs.85%29.aspx) function, you'll see it is rather limited, compared to the &quot;native&quot; ShellExecuteEx (http://msdn.microsoft.com/en-us/library/windows/desktop/bb762154%28v=vs.85%29.aspx) function. It does NOT return a handle we could use for waiting. Can you explain what exactly your use-case is?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">azureusvuze</div><div class="date">16th March 2013, 07:35</div></div><div class="posttext">What you want is not possible the way &quot;ExecShellAsUser&quot; works. The implementation of ExecShellAsUser in the StdUtils plug-in is based on the IShellDispatch2 (http://msdn.microsoft.com/de-de/library/windows/desktop/bb774138%28v=vs.85%29.aspx) COM interface. And if you look at the ShellExecute  (http://msdn.microsoft.com/de-de/library/windows/desktop/bb774148%28v=vs.85%29.aspx) function, you'll see it is rather limited, compared to the &quot;native&quot; ShellExecuteEx (http://msdn.microsoft.com/en-us/library/windows/desktop/bb762154%28v=vs.85%29.aspx) function. It does NOT return a handle we could use for waiting. Can you explain what exactly your use-case is?<br />
<br />
Installer is executed as administrator privileges, but will execwait app.exe as user privileges.<br />
Is this possible?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">16th March 2013, 10:30</div></div><div class="posttext">Installer is executed as administrator privileges, but will execwait app.exe as user privileges.<br />
Is this possible?<br />
<br />
This is possible with the UAC plugin, but it's not easy. But like Anders said, if you need this, you are probably doing things in a very broken way. Reconsider your approach carefully, you are most probably trying to make an application that is not Windows compatible.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">16th March 2013, 14:15</div></div><div class="posttext">Installer is executed as administrator privileges, but will execwait app.exe as user privileges.<br />
Is this possible?<br />
<br />
Again: What exactly are you trying to do? Usually there is only one use-case to run applications with user-privileges from an elevated installer: You are done installing and now want to launch the app you've just installed. But you don't want that app to run elevated. In that case, you don't need to wait for that app, of course... Why do you need to wait for the app and need it to run with user-privileges?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">azureusvuze</div><div class="date">17th March 2013, 07:45</div></div><div class="posttext">Again: What exactly are you trying to do? Usually there is only one use-case to run applications with user-privileges from an elevated installer: You are done installing and now want to launch the app you've just installed. But you don't want that app to run elevated. In that case, you don't need to wait for that app, of course... Why do you need to wait for the app and need it to run with user-privileges?<br />
<br />
I try to make portable app launcher like portableapps.com, launcher need to be run as administrator to backup and restore registry, but target need to be run as user privileges.<br />
<br />
Like this:<br />
	registry::_DeleteKey /NOUNLOAD &quot;${_REGKEY}-BackupBy${APP}Portable&quot;<br />
	registry::_MoveKey /NOUNLOAD &quot;${_REGKEY}&quot; &quot;${_REGKEY}-BackupBy${APP}Portable&quot;<br />
<br />
ExecWait app.exe<br />
<br />
	registry::_DeleteKey /NOUNLOAD &quot;${_REGKEY}&quot;<br />
	registry::_MoveKey /NOUNLOAD &quot;${_REGKEY}-BackupBy${APP}Portable&quot; &quot;${_REGKEY}&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">17th March 2013, 13:58</div></div><div class="posttext">So, do I get this right? You have an application that is not &quot;portable&quot;, but you try to pretend it is portable by silently installing (i.e. setting up registry keys and stuff) the application right before its launched and again silently uninstalling the application after it has terminated?<br />
<br />
I guess the only way to achieve that currently is what MSG has suggested already: Use the UAC plug-in. But even more important: Instead of inventing ugly workarounds, why not make your application &quot;portable&quot; right away, so these workarounds are not needed any longer ???</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Highcoder</div><div class="date">17th March 2013, 14:33</div></div><div class="posttext">I think its because &quot;his&quot; app is not his app. ;)<br />
And the most of all programs that are designed to be installed normally need this keys to run.<br />
But these apps are not portable with this workaround.<br />
Portable means you can run this app on every (windows)machine without adminrights an installing.<br />
Your thing is not portable at all because you need adminrights for your &quot;launcher&quot; to set the necessary keys.<br />
<br />
But the most people use &quot;Portable&quot; Apps because they have no mess on their PC caused by bad uninstall routines that doesn't clean up and left a lot of files an regkeys.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">17th March 2013, 17:52</div></div><div class="posttext">I think its because &quot;his&quot; app is not his app. ;)<br />
<br />
Then there are two possibilities: The app that is not &quot;his&quot; is OpenSource/FreeSoftware and thus can be &quot;fixed&quot; to be portable. In that case we don't need the workarounds. Or that app is proprietary, in which case he might not even be allowed to redistribute it! Only real case I see is, when the app is proprietary but still allows redistribution under a Freeware license (and also explicitly allows repackaging). And, in that particular case, I would still try to contact the developer can get him convinced to release a &quot;real&quot; portable version, first...<br />
<br />
If nothing else helps and if also the UAC plug-in method isn't acceptable, he could also do this: Create a &quot;base&quot; (wrapper) installer that explicitly runs with user privileges. In that installer, include two more installers that will run with admin privileges: One to prepare starting the app and one for cleaning up afterwards. Then he could do something like:<br />
<br />
ExeShell '&quot;$PLUGINSDIR\prepare-installer.exe&quot;'<br />
ExecWait '&quot;$PLUGINSDIR\the-not-so-portable-app.exe&quot;'<br />
ExeShell '&quot;$PLUGINSDIR\cleanup-installer.exe&quot;'<br />
<br />
Only drawback: User will have to accept an UAC dialog twice...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">azureusvuze</div><div class="date">19th March 2013, 06:23</div></div><div class="posttext">Then there are two possibilities: The app that is not &quot;his&quot; is OpenSource/FreeSoftware and thus can be &quot;fixed&quot; to be portable. In that case we don't need the workarounds. Or that app is proprietary, in which case he might not even be allowed to redistribute it! Only real case I see is, when the app is proprietary but still allows redistribution under a Freeware license (and also explicitly allows repackaging). And, in that particular case, I would still try to contact the developer can get him convinced to release a &quot;real&quot; portable version, first...<br />
<br />
If nothing else helps and if also the UAC plug-in method isn't acceptable, he could also do this: Create a &quot;base&quot; (wrapper) installer that explicitly runs with user privileges. In that installer, include two more installers that will run with admin privileges: One to prepare starting the app and one for cleaning up afterwards. Then he could do something like:<br />
<br />
ExeShell '&quot;$PLUGINSDIR\prepare-installer.exe&quot;'<br />
ExecWait '&quot;$PLUGINSDIR\the-not-so-portable-app.exe&quot;'<br />
ExeShell '&quot;$PLUGINSDIR\cleanup-installer.exe&quot;'<br />
<br />
Only drawback: User will have to accept an UAC dialog twice...<br />
<br />
Too many exe to be run.<br />
I'll back using StdUtils and FindProcDLL (mod by hnedka).<br />
<br />
Thanks for your answer.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>