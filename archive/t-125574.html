<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" checking version, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  checking version NSIS Discussion" />
	
	<title> checking version [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  checking version</div>
<hr />
<div class="pda"><a href="t-125574.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=125574">checking version</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">JXL</div><div class="date">18th February 2003, 23:44</div></div><div class="posttext">Hello all,<br />
<br />
I made a version check on installer startup.<br />
It works as well, but i have a problem with the check in combination with Language selection.<br />
<br />
That's my code:<br />
Function .onInit<br />
ReadRegStr $1 HKCU &quot;Software\myapp&quot; &quot;Version&quot;<br />
 StrCmp $1 &quot;${MUI_VERSION}&quot; 0 Abort<br />
     MessageBox MB_OK &quot;You have the latest Version installed.&quot;<br />
Abort:<br />
<br />
  ;Language selection<br />
<br />
  ;Font<br />
  Push Tahoma<br />
  Push 8<br />
<br />
  ;Languages<br />
  !insertmacro MUI_LANGDLL_PUSH &quot;English&quot;<br />
  !insertmacro MUI_LANGDLL_PUSH &quot;French&quot;<br />
  !insertmacro MUI_LANGDLL_PUSH &quot;German&quot;<br />
  !insertmacro MUI_LANGDLL_PUSH &quot;Spanish&quot;<br />
  ...<br />
  ...<br />
FunctionEnd<br />
<br />
So when the installer starts up it shows me that i have already the latest version but when i click on OK the language selection window opens.<br />
<br />
The installer should quit after the Abort.<br />
<br />
Anyone who can help me ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">19th February 2003, 03:26</div></div><div class="posttext">The Abort you have in your code is a label, not a command.<br />
Do this:<br />
<br />
Function .onInit <br />
ReadRegStr $1 HKCU &quot;Software\myapp&quot; &quot;Version&quot; <br />
StrCmp $1 &quot;${MUI_VERSION}&quot; 0 continue <br />
MessageBox MB_OK &quot;You have the latest Version installed.&quot; <br />
Abort<br />
continue: <br />
<br />
;Language selection <br />
<br />
;Font <br />
Push Tahoma <br />
Push 8 <br />
<br />
;Languages <br />
!insertmacro MUI_LANGDLL_PUSH &quot;English&quot; <br />
!insertmacro MUI_LANGDLL_PUSH &quot;French&quot; <br />
!insertmacro MUI_LANGDLL_PUSH &quot;German&quot; <br />
!insertmacro MUI_LANGDLL_PUSH &quot;Spanish&quot; <br />
... <br />
... <br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">19th February 2003, 03:29</div></div><div class="posttext">Another problem with your installer: If someone has the latest version installed and then runs an older installer, it will blow away the latest version and install an older version.<br />
You need better version checking.<br />
See Sunjammer's Dotted Comparison Script in the NSIS archive.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">19th February 2003, 07:37</div></div><div class="posttext">The script can be found here:<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=34&amp;instances=0,11<br />
<br />
BTW, I wrote it, not Sunjammer, but NP :)<br />
<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">19th February 2003, 09:10</div></div><div class="posttext">bad iceman_k :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">19th February 2003, 09:12</div></div><div class="posttext">LOL @ Sunjammer :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">19th February 2003, 15:00</div></div><div class="posttext">My bad. I should read the attributions more carefully.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">19th February 2003, 17:38</div></div><div class="posttext">Yep, but it's OK already. No big deal :)<br />
<br />
What matters is that I hope that JXL and more people can use the script for their installer :)<br />
<br />
Have fun, greetz,<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JXL</div><div class="date">19th February 2003, 20:18</div></div><div class="posttext">Many thanks, it works with your script.<br />
<br />
All i need now is something to abort the installation when the check calls $0 or $1 and continue the installation on $2. It should have something like the continue tag to show the language window when $2 is called.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">19th February 2003, 20:37</div></div><div class="posttext">If I understand your question correctly: StrCmp the output of the script with '2'. If '2' then continue (go to some label). In the other case, continue and the installer will come across the abort and abort the installer. Just as iceman_k explained in the reply above.<br />
<br />
Does that answer it?<br />
<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JXL</div><div class="date">19th February 2003, 21:09</div></div><div class="posttext">Could your show me a example ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">19th February 2003, 21:19</div></div><div class="posttext">Push ${version number saved in registry}<br />
Push ${version of software in installer}<br />
Call VersionCheck<br />
Pop $0<br />
StrCmp $0 '2' Continue<br />
Abort 'A newer or the same version of this software is already installed'<br />
<br />
Continue:<br />
...<br />
But that is the same as iceman_k showed...<br />
<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JXL</div><div class="date">21st February 2003, 08:54</div></div><div class="posttext">This doesn't work for me.<br />
I've added this:<br />
<br />
  Call VersionCheck<br />
  Pop $0<br />
  StrCmp $0 &quot;2&quot; continue 0<br />
  MessageBox MB_OK &quot;You are updating from ($1) to (${MUI_VERSION})&quot;<br />
Abort<br />
<br />
  StrCmp $0 &quot;0&quot; 0 continue<br />
  MessageBox MB_OK &quot;You have the latest MVersion installed.&quot;<br />
Abort<br />
<br />
  StrCmp $0 &quot;1&quot; 0 continue<br />
  MessageBox MB_OK &quot;You have already a newer version installed ($1). This is (${MUI_VERSION})&quot;<br />
Abort<br />
continue:<br />
<br />
What's wrong ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">21st February 2003, 08:59</div></div><div class="posttext">Take a look at the labels. It will never visit the code where it compares the output of VersionCheck with '0' nor the part to compare with '1'. Add some additional labels:<br />
<br />
Call VersionCheck <br />
Pop $0 <br />
StrCmp $0 &quot;2&quot; 0 continue1<br />
MessageBox MB_OK &quot;You are updating from ($1) to (${MUI_VERSION})&quot; <br />
Goto continue <br />
<br />
continue1:<br />
StrCmp $0 &quot;0&quot; 0 continue2 <br />
MessageBox MB_OK &quot;You have the latest MVersion installed.&quot; <br />
Abort <br />
<br />
continue2:<br />
; [not necessary anymore] StrCmp $0 &quot;1&quot; 0 continue <br />
MessageBox MB_OK &quot;You have already a newer version installed ($1). This is (${MUI_VERSION})&quot; <br />
Abort<br />
<br />
continue: <br />
<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JXL</div><div class="date">21st February 2003, 09:07</div></div><div class="posttext">Great, it works.<br />
Sorry, i suck at scripting. It's my first project with NSIS. <br />
Well, it's a great installer with many options but you have to read the whole docu to understand how the variables are working. And i couldn't find these continue or Abort labels to look at them how they works.<br />
<br />
And big thx for your help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">21st February 2003, 09:11</div></div><div class="posttext">NP, that's what we're here for :)<br />
<br />
To clarify: the continue labels are custom labels, you can give them any name you want. As long as they end with ':' it is a custom label. Abort however is a function, not a label.<br />
<br />
One more thing: the last StrCmp is not necessary anymore: if it is not a 2 nor a zero then it has to be a 1. So that one line can be deleted from the script...<br />
<br />
Good luck scripting, greetz,<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yovav</div><div class="date">13th May 2003, 03:40</div></div><div class="posttext">Originally posted by Smile2Me <br />
The script can be found here:<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=34&amp;instances=0,11<br />
<br />
BTW, I wrote it, not Sunjammer, but NP :)<br />
<br />
-Hendri.  <br />
<br />
<br />
Hi,<br />
<br />
I love this function,<br />
<br />
but I got this small warning,install function &quot;VersionCheck&quot; not referenced - zeroing code (15-62) out<br />
<br />
Can U guess why ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">13th May 2003, 08:52</div></div><div class="posttext">Are you actually calling VersionCheck, the makensis compiler doesn't think you are. If you are still unsure why you are getting this then attach your .nsi script here so we can help you work it out. Also can you tell us which version of NSIS you are using (2.0b4 CVS, 2.0b3, something else?)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yovav</div><div class="date">13th May 2003, 13:19</div></div><div class="posttext">I use 2.0b3,<br />
<br />
I love 2 get my hands on a new yammi version<br />
(I just download it three days ago - already got a new stuff ?)<br />
<br />
and I just copied it from:<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=34&amp;instances=0,11<br />
<br />
Function VersionCheck<br />
  Exch $0 ;second versionnumber<br />
  Exch<br />
  Exch $1 ;first versionnumber<br />
  Push $R0 ;counter for $0<br />
  Push $R1 ;counter for $1<br />
  Push $3 ;temp char<br />
  Push $4 ;temp string for $0<br />
  Push $5 ;temp string for $1<br />
  StrCpy $R0 &quot;-1&quot;<br />
  StrCpy $R1 &quot;-1&quot;<br />
  Start:<br />
  StrCpy $4 &quot;&quot;<br />
  DotLoop0:<br />
  IntOp $R0 $R0 + 1<br />
  StrCpy $3 $0 1 $R0<br />
  StrCmp $3 &quot;&quot; DotFound0<br />
  StrCmp $3 &quot;.&quot; DotFound0<br />
  StrCpy $4 $4$3<br />
  Goto DotLoop0<br />
  DotFound0:<br />
  StrCpy $5 &quot;&quot;<br />
  DotLoop1:<br />
  IntOp $R1 $R1 + 1<br />
  StrCpy $3 $1 1 $R1<br />
  StrCmp $3 &quot;&quot; DotFound1<br />
  StrCmp $3 &quot;.&quot; DotFound1<br />
  StrCpy $5 $5$3<br />
  Goto DotLoop1<br />
  DotFound1:<br />
  Strcmp $4 &quot;&quot; 0 Not4<br />
    StrCmp $5 &quot;&quot; Equal<br />
    Goto Ver2Less<br />
  Not4:<br />
  StrCmp $5 &quot;&quot; Ver2More<br />
  IntCmp $4 $5 Start Ver2Less Ver2More<br />
  Equal:<br />
  StrCpy $0 &quot;0&quot;<br />
  Goto Finish<br />
  Ver2Less:<br />
  StrCpy $0 &quot;1&quot;<br />
  Goto Finish<br />
  Ver2More:<br />
  StrCpy $0 &quot;2&quot;<br />
  Finish:<br />
  Pop $5<br />
  Pop $4<br />
  Pop $3<br />
  Pop $R1<br />
  Pop $R0<br />
  Pop $1<br />
  Exch $0<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th May 2003, 17:34</div></div><div class="posttext">If you have the function in your script, but don't actually have...<br />
Call VersionCheck<br />
...then the compiler will remove the function - because you haven't used it!<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yovav</div><div class="date">13th May 2003, 18:57</div></div><div class="posttext">Originally posted by Afrow UK <br />
If you have the function in your script, but don't actually have...<br />
Call VersionCheck<br />
...then the compiler will remove the function - because you haven't used it!<br />
<br />
-Stu  <br />
<br />
<br />
10X - I guess that was the reason<br />
(suddenly it gives no S*IT)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>