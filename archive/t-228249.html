<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" InstallDirRegKey work with (^Name)?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  InstallDirRegKey work with (^Name)? NSIS Discussion" />
	
	<title> InstallDirRegKey work with (^Name)? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  InstallDirRegKey work with (^Name)?</div>
<hr />
<div class="pda"><a href="t-228249.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=228249">InstallDirRegKey work with (^Name)?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">l_d_allan</div><div class="date">12th October 2005, 14:39</div></div><div class="posttext">Name &quot;My Project&quot;<br />
... some statements ...<br />
InstallDir &quot;$PROGRAMFILES\Project Family\$(^Name)&quot;<br />
InstallDirRegKey HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; &quot;Install_Dir&quot;<br />
.... more statements ...<br />
WriteRegStr HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; Install_Dir $INSTDIR<br />
<br />
InstallDir can resolve (do variable/macro replacement of) $(^Name), as can WriteRegStr, but it doesn't seem like InstallDirRegKey can do this. If the end-user changes the Installation directory from:<br />
C:\Program Files\Project Family\My Project<br />
to<br />
C:\Temp\AlternateName<br />
then the next installation uses<br />
C:\Program Files\Project Family\My Project<br />
<br />
InstallDirRegKey works ok if I don't use $(^Name):<br />
<br />
InstallDirRegKey HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\My Project&quot; &quot;Install_Dir&quot;<br />
<br />
Am I doing something wrong or leaving something out? Should I be using an actual variable rather than a &quot;pseudo variable&quot; like Name?<br />
<br />
I'm helping a freeware project convert from InstallShield to NSIS, and I believe the original script was generated by the Eclipse plug-in, using the Modern UI.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th October 2005, 14:45</div></div><div class="posttext">InstallDirRegKey can not use language strings or variables because it's read before the language tables are initialized. It should say that in the documentation, I'll add it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">l_d_allan</div><div class="date">12th October 2005, 14:57</div></div><div class="posttext">Thanks ... you're good!<br />
<br />
I have always been incredibly impressed by the support made available on this forum. Oh, that other software was anywhere near as good.<br />
<br />
InstallDirRegKey can not use language strings or variables because it's read before the language tables are initialized.<br />
<br />
Having said that, is there a technical reason why InstallDirRegKey can't resolve variables, and has to be read before the language tables are initialized? It seems like pretty much everything else can.<br />
<br />
If not, perhaps this statement should be forced to be very close to the top as a &quot;clue&quot; that it has to be treated differently?<br />
<br />
I was going to look around in the NSIS code to see how the &quot;Check for Update&quot; code worked (to clone into my own project code). Perhaps you (or someone else) could point me where to look, and this behavior could be revised, as applicable. (Just trying to help ... :-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th October 2005, 15:06</div></div><div class="posttext">There's no technical reason, only a functional one. InstallDirRegKey is processed before .onInit, so .onInit will be able to check $INSTDIR and manipulate it, if needed. The language table is fully selected only after .onInit, and the earliest place variables can be initialized is .onInit.<br />
<br />
Check for update is implemented in Contrib\MakeNSISw\update.cpp. The server backend code is attached.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">l_d_allan</div><div class="date">12th October 2005, 15:50</div></div><div class="posttext">Thanks very much for the link to the &quot;Check for Update&quot; code.<br />
<br />
!define PROJECT_FAMILY &quot;The Family&quot;<br />
!define PROJECT_NAME &quot;The Project&quot;<br />
Name &quot;${PROJECT_NAME}&quot;<br />
; ... some statements ...<br />
InstallDir &quot;$PROGRAMFILES\Project Family\${PROJECT_FAMILY}\${PROJECT_NAME}&quot;<br />
InstallDirRegKey HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\${PROJECT_FAMILY}\${PROJECT_NAME}&quot; &quot;InstallLocation&quot;<br />
; ... some more statements ...<br />
WriteRegStr HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\${PROJECT_FAMILY}\${PROJECT_NAME}&quot; InstallLocation $INSTDIR<br />
<br />
<br />
The above seems to work ok (preview shows space before &quot; SOFTWARE&quot; which isn't there). My preference is to have one statement to change, and minimize the proliferation of the same information all over the script. Does this seem like a reasonable &quot;work-around&quot;, or are there flaws I'm naively overlooking? <br />
<br />
The norm in the uninstall &quot;sub-hive&quot; seems to be only one level (${PROJECT_NAME}) rather than multiple levels (${PROJECT_FAMILY}\${PROJECT_NAME}). At least with WinXp, the Add/Remove programs seems to work ok, and reinstallations seem to recognize and use ${PROJECT_FAMILY}\${PROJECT_NAME}.<br />
<br />
BTW: I came across the link:<br />
http://cvs.sourceforge.net/viewcvs.py/nsis/NSIS/Docs/Attic/AppendixD.html?rev=1.56<br />
<br />
which seems to indicate that InstallLocation in the Uninstall &quot;sub-hive&quot; is the preferred place for this information. Seem reasonable?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th October 2005, 16:08</div></div><div class="posttext">A define is OK and it's actually the common way of doing this. It's also a liter solution because it involves no runtime code at all.<br />
<br />
InstallLocation under a subkey in the Software\Microsoft\Windows\CurrentVeresion\Uninstall is not only the preferred location, but the only possible location as far as I know. The Add/Remove control panel doesn't look in sub-subkeys to the best of my knowledge.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>