<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem with the large string version of NSIS, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem with the large string version of NSIS NSIS Discussion" />
	
	<title> Problem with the large string version of NSIS [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem with the large string version of NSIS</div>
<hr />
<div class="pda"><a href="t-315958.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=315958">Problem with the large string version of NSIS</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">SuperPat</div><div class="date">2nd January 2010, 18:46</div></div><div class="posttext">Hello,<br />
<br />
When I try to compile Ultra Modern UI with the large string build of NSIS, the compiler stop without any error...<br />
<br />
Log with the Confirm.nsi example:MakeNSIS v2.46 - Copyright 1995-2009 Contributors<br />
See the file COPYING for license details.<br />
Credits can be found in the Users Manual.<br />
<br />
Processing config: <br />
Processing plugin dlls: &quot;C:\Program Files\NSIS\Plugins\*.dll&quot;<br />
 - AdvSplash::show<br />
 - Banner::destroy<br />
 - Banner::getWindow<br />
 - Banner::show<br />
 - BgImage::AddImage<br />
 - BgImage::AddText<br />
 - BgImage::Clear<br />
 - BgImage::Destroy<br />
 - BgImage::Redraw<br />
 - BgImage::SetBg<br />
 - BgImage::SetReturn<br />
 - BgImage::Sound<br />
 - Dialer::AttemptConnect<br />
 - Dialer::AutodialHangup<br />
 - Dialer::AutodialOnline<br />
 - Dialer::AutodialUnattended<br />
 - Dialer::GetConnectedState<br />
 - InstallOptions::dialog<br />
 - InstallOptions::initDialog<br />
 - InstallOptions::show<br />
 - InstallOptionsEx::dialog<br />
 - InstallOptionsEx::initDialog<br />
 - InstallOptionsEx::setFocus<br />
 - InstallOptionsEx::show<br />
 - InstallOptionsEx::skipValidation<br />
 - InstallOption****legacy::dialog<br />
 - InstallOption****legacy::initDialog<br />
 - InstallOption****legacy::setFocus<br />
 - InstallOption****legacy::show<br />
 - InstallOption****legacy::skipValidation<br />
 - InstallOption****newAPI::dialog<br />
 - InstallOption****newAPI::initDialog<br />
 - InstallOption****newAPI::setFocus<br />
 - InstallOption****newAPI::show<br />
 - InstallOption****newAPI::skipValidation<br />
 - LangDLL::LangDialog<br />
 - Math::Script<br />
 - NSISArray::ArrayCount<br />
 - NSISArray::ArrayExists<br />
 - NSISArray::Clear<br />
 - NSISArray::Concat<br />
 - NSISArray::Copy<br />
 - NSISArray::Cut<br />
 - NSISArray::Debug<br />
 - NSISArray::Delete<br />
 - NSISArray::ErrorStyle<br />
 - NSISArray::Exists<br />
 - NSISArray::ExistsI<br />
 - NSISArray::FreeUnusedMem<br />
 - NSISArray::Join<br />
 - NSISArray::New<br />
 - NSISArray::Pop<br />
 - NSISArray::Push<br />
 - NSISArray::Put<br />
 - NSISArray::ReDim<br />
 - NSISArray::Read<br />
 - NSISArray::ReadToStack<br />
 - NSISArray::Reverse<br />
 - NSISArray::Search<br />
 - NSISArray::SearchI<br />
 - NSISArray::SetAutoReDim<br />
 - NSISArray::SetSize<br />
 - NSISArray::Shift<br />
 - NSISArray::SizeOf<br />
 - NSISArray::Sort<br />
 - NSISArray::Splice<br />
 - NSISArray::Subtract<br />
 - NSISArray::Swap<br />
 - NSISArray::Unload<br />
 - NSISArray::Unshift<br />
 - NSISArray::Write<br />
 - NSISArray::WriteList<br />
 - NSISArray::WriteListC<br />
 - NSISdl::download<br />
 - NSISdl::download_quiet<br />
 - SkinnedControls::setskin<br />
 - SkinnedControls::skinit<br />
 - SkinnedControls::unskinit<br />
 - Splash::show<br />
 - StartMenu::Init<br />
 - StartMenu::Select<br />
 - StartMenu::Show<br />
 - System::Alloc<br />
 - System::Call<br />
 - System::Copy<br />
 - System::Free<br />
 - System::Get<br />
 - System::Int64Op<br />
 - System::Store<br />
 - TypeLib::GetLibVersion<br />
 - TypeLib::Register<br />
 - TypeLib::UnRegister<br />
 - UserInfo::GetAccountType<br />
 - UserInfo::GetName<br />
 - UserInfo::GetOriginalAccountType<br />
 - VPatch::GetFileCRC32<br />
 - VPatch::GetFileMD5<br />
 - VPatch::vpatchfile<br />
 - nsDialogs::Create<br />
 - nsDialogs::CreateControl<br />
 - nsDialogs::CreateItem<br />
 - nsDialogs::CreateTimer<br />
 - nsDialogs::GetUserData<br />
 - nsDialogs::KillTimer<br />
 - nsDialogs::OnBack<br />
 - nsDialogs::OnChange<br />
 - nsDialogs::OnClick<br />
 - nsDialogs::OnNotify<br />
 - nsDialogs::SelectFileDialog<br />
 - nsDialogs::SelectFolderDialog<br />
 - nsDialogs::SetRTL<br />
 - nsDialogs::SetUserData<br />
 - nsDialogs::Show<br />
 - nsExec::Exec<br />
 - nsExec::ExecToLog<br />
 - nsExec::ExecToStack<br />
<br />
!define: &quot;MUI_INSERT_NSISCONF&quot;=&quot;&quot;<br />
<br />
Changing directory to: &quot;C:\Program Files\NSIS\Examples\******odernUI&quot;<br />
<br />
Processing script file: &quot;C:\Program Files\NSIS\Examples\******odernUI\Confirm.nsi&quot;<br />
Name: &quot;******odernUI Confirm&quot;<br />
OutFile: &quot;Confirm.exe&quot;<br />
SetCompressor: /FINAL lzma<br />
InstallDir: &quot;$LOCALAPPDATA\******odernUI Test&quot;<br />
InstallRegKey: &quot;HKCU\Software\******odernUI Test\&quot;<br />
!include: &quot;C:\Program Files\NSIS\Include\UMUI.nsh&quot;<br />
!include: &quot;C:\Program Files\NSIS\Contrib\******odernUI\UMUI.nsh&quot;<br />
NSIS Ultra Modern User Interface version 1.00 beta 2 - 2005-2009 SuperPat (C:\Program Files\NSIS\Contrib\******odernUI\UMUI.nsh:12)<br />
Based on: NSIS Modern User Interface version 1.8 - 2002-2009 Joost Verburg (C:\Program Files\NSIS\Contrib\******odernUI\UMUI.nsh:13)<br />
!define: &quot;MUI_INCLUDED&quot;=&quot;&quot;<br />
!define: &quot;UMUI_SYSVERSION&quot;=&quot;1.00 beta 2&quot;<br />
!define: &quot;MUI_SYSVERSION&quot;=&quot;1.8&quot;<br />
!define: &quot;MUI_VERBOSE&quot;=&quot;3&quot;<br />
!include: closed: &quot;C:\Program Files\NSIS\Contrib\******odernUI\UMUI.nsh&quot;<br />
!include: closed: &quot;C:\Program Files\NSIS\Include\UMUI.nsh&quot;<br />
!include: &quot;C:\Program Files\NSIS\Include\WinMessages.nsh&quot;<br />
!include: closed: &quot;C:\Program Files\NSIS\Include\WinMessages.nsh&quot;<br />
!define: &quot;UMUI_SKIN&quot;=&quot;red&quot;<br />
!define: &quot;MUI_ABORTWARNING&quot;=&quot;&quot;<br />
!define: &quot;MUI_UNABORTWARNING&quot;=&quot;&quot;<br />
Var: &quot;STARTMENU_FOLDER&quot;<br />
!insertmacro: MUI_PAGE_LICENSE<br />
!insertmacro: end of MUI_PAGE_LICENSE<br />
!insertmacro: MUI_PAGE_COMPONENTS<br />
!insertmacro: end of MUI_PAGE_COMPONENTS<br />
!insertmacro: MUI_PAGE_DIRECTORY<br />
!insertmacro: end of MUI_PAGE_DIRECTORY<br />
!define: &quot;MUI_STARTMENUPAGE_REGISTRY_ROOT&quot;=&quot;HKCU&quot;<br />
!define: &quot;MUI_STARTMENUPAGE_REGISTRY_KEY&quot;=&quot;Software\******odernUI Test&quot;<br />
!define: &quot;MUI_STARTMENUPAGE_REGISTRY_VALUENAME&quot;=&quot;Start Menu Folder&quot;<br />
!insertmacro: UMUI_PAGE_ALTERNATIVESTARTMENU<br />
!insertmacro: end of UMUI_PAGE_ALTERNATIVESTARTMENU<br />
!define: &quot;UMUI_CONFIRMPAGE_TEXTBOX&quot;=&quot;confirm_function&quot;<br />
!insertmacro: UMUI_PAGE_CONFIRMIt did the same thing when you try to insert an ultra modern page.<br />
<br />
Do you now why?<br />
<br />
Best Regards,<br />
SuperPat</div></div><hr />


<div class="post"><div class="posttop"><div class="username">{_trueparuex^}</div><div class="date">2nd January 2010, 20:05</div></div><div class="posttext">I just tried to compile the ******odernUI (1.00 2009-12-25) basic.nsi example with the large string build and it worked...<br />
<br />
But when I tried to compile the confirm.nsi example makensis crashed.Second chance exception 0xC00000FD (Stack Overflow) occurred in &quot;MAKENSIS.EXE&quot; at address 0x0044F907.<br />
<br />
ps. For some reason the forum is filtering word ****** (u-l-t-r-a-m) effectively breaking urls to ******odernUI.<br />
<br />
PaR</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SuperPat</div><div class="date">2nd January 2010, 21:20</div></div><div class="posttext">The basic.nsi example works because it does not use any InstallOptionsEx pages.<br />
<br />
The WelcomeFinishAbort.nsi, MultiLanguage.nsi examples work fine</div></div><hr />


<div class="post"><div class="posttop"><div class="username">{_trueparuex^}</div><div class="date">2nd January 2010, 21:31</div></div><div class="posttext">Reduced test case probably would help to solve this problem. ;) <br />
<br />
PaR</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">2nd January 2010, 21:39</div></div><div class="posttext">With &quot;Stack Overflow&quot; two things come to my mind: Either UMUI uses too many nested macros/functions, so that the stack runs out of free space (maybe the long strings build requires more stack space per macro/function call, so that's why the &quot;normal&quot; build works?) or there is an infinite recursion somewhere. The latter is unlikely, because it would (most-likely) apply to the &quot;normal&quot; build as well. Can't we simply increase the stack size ???</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SuperPat</div><div class="date">3rd January 2010, 14:26</div></div><div class="posttext">Originally posted by LoRd_MuldeR <br />
With &quot;Stack Overflow&quot; two things come to my mind: Either UMUI uses too many nested macros/functions, so that the stack runs out of free space (maybe the long strings build requires more stack space per macro/function call, so that's why the &quot;normal&quot; build works?)<br />
You are right but there are only three sub-macro level where it crashes but some of them can be called several times in the same function.<br />
<br />
It is true that I use too many macros, and not enough functions because of their difficulty in managing it:<br />
<br />
Some function may be called in install script and uninstall script but it is not an obligation and an unused function causes a warning.<br />
<br />
I might try using a little less macro, but I think the stack will still always too small.<br />
<br />
<br />
Originally posted by LoRd_MuldeR <br />
Can't we simply increase the stack size ??? <br />
This would be perfect!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">{_trueparuex^}</div><div class="date">4th January 2010, 20:34</div></div><div class="posttext">Here's an modified version of the large string makensis.exe with stack size set to 8 MB. I used EDITBIN from the VC++ toolset to change the stack size.<br />
<br />
PaR</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">4th January 2010, 20:43</div></div><div class="posttext">That one works for me :)<br />
<br />
BTW: Is there a way to detect NSIS_MAX_STRLEN at runtime?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">{_trueparuex^}</div><div class="date">4th January 2010, 20:59</div></div><div class="posttext">Not sure what you mean, but NSIS_MAX_STRLEN is defined at script compiletime and passing it to some runtime variable shouldn't be a problem. E.g. StrCpy $0 ${NSIS_MAX_STRLEN}<br />
<br />
NSIS_MAX_STRLEN is also passed on plug-in when they are called.<br />
<br />
PaR</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">4th January 2010, 21:02</div></div><div class="posttext">Ah, thanks again!<br />
<br />
I couldn't find ${NSIS_MAX_STRLEN} in the docs and only tried ${__NSIS_MAX_STRLEN__} ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">{_trueparuex^}</div><div class="date">4th January 2010, 21:12</div></div><div class="posttext">Right :)<br />
You can run command 'makensis /HDRINFO' to get a list of options makensis was compiled with. All those options should be defined when compiling scripts.<br />
<br />
PaR</div></div><hr />


<div class="post"><div class="posttop"><div class="username">theTallGuy</div><div class="date">13th May 2010, 01:37</div></div><div class="posttext">Here's an modified version of the large string makensis.exe with stack size set to 8 MB. I used EDITBIN from the VC++ toolset to change the stack size.<br />
<br />
<br />
Is this version of the file still available somewhere?  I, too, am getting the crashing issue, and would love a quick fix.<br />
<br />
Alternately, is there another way to change the stack size without using the VC++ toolset, which I don't have?<br />
<br />
Thanks in advance!<br />
Michael</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th May 2010, 10:49</div></div><div class="posttext">http://nsis.sourceforge.net/Docs/AppendixG.html#G.1<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">{_trueparuex^}</div><div class="date">15th May 2010, 14:15</div></div><div class="posttext">Is this version of the file still available somewhere?  I, too, am getting the crashing issue, and would love a quick fix.<br />
<br />
Alternately, is there another way to change the stack size without using the VC++ toolset, which I don't have?<br />
<br />
Thanks in advance!<br />
Michael<br />
Not sure what happened to the attachment, but I uploaded another version to my website:<br />
http://koti.mbnet.fi/vaultec/files/miscellaneous/makensis_strlen_8192_stack_8M.zip<br />
<br />
The stack size is just a value in the PE header and you can change it with tools like: LordPE, PE tools, PE Explorer ... hex editor of your choice. :D <br />
<br />
PaR</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">20th May 2010, 03:52</div></div><div class="posttext">AddSize no longer works. Is this version based on a nightly build? Otherwise, thanks.<br />
<br />
edit:<br />
Nor does it automatically get the section size for 'Space required'. You have to calculate manually and SectionSetSize as a workaround.<br />
<br />
edit again:<br />
It hinges on the placement of sections. Don't ask me why. They have to be before .onInit? (Or nothing installs.) I can't fix it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">20th May 2010, 06:00</div></div><div class="posttext">There is another large string download from sourceforge. The installer it builds fails the integrity check. This puts me in a bind. Not being a developer, I can't build me own version.<br />
<br />
I'm using a single string with potentially, although unlikely, up to 150 paths of files that are in use. I'm unable to divide the string up into several smaller segments, because each path will be added onto the one string with a line break, and the string will be displayed on the MUI UnConfirmPage as a list of files. I would trim the full paths and use only the file names, as a last resort.<br />
<br />
Is anyone else having similar issues with the large string build: &quot;Installer integrity check has failed&quot;?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">20th May 2010, 08:44</div></div><div class="posttext">Why not use a listbox to display the paths?<br />
You could add one line at a time</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">20th May 2010, 09:01</div></div><div class="posttext">It's possible. I haven't worked with listboxes before. The list has to refresh when there are still some files open after the Uninstall button is pressed, scroll down with many files, and scroll horizontally or wrap if the path is long. I think you can achieve the first two, but not sure about the third. I'll see what happens. Thanks. :up:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">20th May 2010, 09:07</div></div><div class="posttext">http://lmgtfy.com/?q=listbox+horizontal+scroll</div></div><hr />


<div class="post"><div class="posttop"><div class="username">{_trueparuex^}</div><div class="date">20th May 2010, 17:32</div></div><div class="posttext">AddSize no longer works. Is this version based on a nightly build? Otherwise, thanks.<br />
<br />
edit:<br />
Nor does it automatically get the section size for 'Space required'. You have to calculate manually and SectionSetSize as a workaround.<br />
<br />
edit again:<br />
It hinges on the placement of sections. Don't ask me why. They have to be before .onInit? (Or nothing installs.) I can't fix it.<br />
It's the official large string build (NSIS v2.46) modified with EDITBIN.<br />
<br />
Are you using the correct stub files?<br />
<br />
PaR</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">21st May 2010, 00:01</div></div><div class="posttext">I'm using stubs that are in the stubs folder for the normal build. Is that wrong?<br />
<br />
What strikes me is that AddSize does not add size to the section it's in. Unless I move the section that installs files forward, nothing really happens. It's like the section wasn't there.<br />
<br />
edit: I just read the readme.txt, which mentions stubs. I missed that. Sorry. My mistake.<br />
<br />
Yes, and the sourceforge download and the large string build you posted are both up and running without a hitch now. Again, sorry for the fuss, people. :o Oops. Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">PoRtAbLe_StEaLtH</div><div class="date">8th January 2013, 15:25</div></div><div class="posttext">only works with ANSI?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">8th January 2013, 22:02</div></div><div class="posttext">only works with ANSI?<br />
<br />
The unicode build uses large strings by default IIRC</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>