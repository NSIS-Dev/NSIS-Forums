<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" nsExec is performing very slow, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  nsExec is performing very slow NSIS Discussion" />
	
	<title> nsExec is performing very slow [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  nsExec is performing very slow</div>
<hr />
<div class="pda"><a href="t-274457.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=274457">nsExec is performing very slow</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">123mobile</div><div class="date">16th July 2007, 15:41</div></div><div class="posttext">I am using lot of already created exe files in my installer. I am prefering nsExec over exec as it allows me to redirect my output to the logfile. The problem is nsExec takes a long time to run and sometimes it is even not able to recover from minor errors, for which I have no Idea. <br />
I would be very thankful if someone can shed light on this topic. <br />
<br />
Thanks in advance,<br />
Prabhat Jain.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">123mobile</div><div class="date">16th July 2007, 15:58</div></div><div class="posttext">For Example run this nsi file on your computer.<br />
It is a simple example of what I am pointing out. When I run this it does not take me to the completion point immediately. but takes a long time.<br />
<br />
;nsis script begin----------<br />
<br />
Name &quot;nsExec Test&quot;<br />
<br />
OutFile &quot;nsExec Test.exe&quot;<br />
<br />
ShowInstDetails show<br />
<br />
<br />
Section &quot;MakeNSIS commands help&quot;<br />
        nsExec::ExecToLog &quot;notepad&quot;<br />
	;nsExec::ExecToLog '&quot;${NSISDIR}\makensis.exe&quot; /CMDHELP'<br />
	Pop $0 # return value/error/timeout<br />
	DetailPrint &quot;&quot;<br />
	DetailPrint &quot;       Return value: $0&quot;<br />
	DetailPrint &quot;&quot;<br />
SectionEnd<br />
<br />
;nsis script ends----------</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th July 2007, 16:00</div></div><div class="posttext">This is not a good example. Script execution will cease until you close notepad!<br />
<br />
nsExec's sole purpose is for console applications anyway.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">123mobile</div><div class="date">16th July 2007, 16:21</div></div><div class="posttext">Notepad was just an example, my problem is whanever I am using nsExec it is not coming to the point of completion so that I can exit my installer properly, I have to kill the process from taskmanager. It is somehow not returning back. <br />
Use rather this script, the same thing will <br />
happen.<br />
<br />
;NSI script begins--------------------------<br />
Name &quot;nsExec Test&quot;<br />
<br />
OutFile &quot;nsExec Test.exe&quot;<br />
<br />
ShowInstDetails show<br />
<br />
<br />
Section &quot;MakeNSIS commands help&quot;<br />
     	nsExec::ExecToLog '&quot;${NSISDIR}\makensis.exe&quot; /CMDHELP'<br />
	Pop $0 # return value/error/timeout<br />
	DetailPrint &quot;&quot;<br />
	DetailPrint &quot;       Return value: $0&quot;<br />
	DetailPrint &quot;&quot;<br />
SectionEnd<br />
<br />
;NSI script ends--------------------------</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th July 2007, 18:11</div></div><div class="posttext">Hmm that worked fine for me. Returned in under a second. Latest NSIS version, Win XP SP2.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">123mobile</div><div class="date">17th July 2007, 08:43</div></div><div class="posttext">You are right it is working on Win XP SP2 correctly, I checked it on my laptop, but at my workplace we are using Windows Server 2003 sp2 and it is not working there. Did I found a Bug? I also have latest installation of NSIS(Installed it yesterday again).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">17th July 2007, 12:39</div></div><div class="posttext">Cannot be sure. Can you try out the ExecDos plugin (http://nsis.sourceforge.net/ExecDos)?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th July 2007, 17:38</div></div><div class="posttext">Anything special with your Windows 2003? You're not the first, but I could never reproduce any report.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">123mobile</div><div class="date">18th July 2007, 16:09</div></div><div class="posttext">Thanks for the reply. <br />
I have started using ExecDos::exec and it is working fine for now...<br />
So no need for nsExec. <br />
<br />
Prabhat.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th July 2007, 17:01</div></div><div class="posttext">Any chance you're going to donate information about this problem anyway?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Andrew Wallo</div><div class="date">19th July 2008, 21:12</div></div><div class="posttext">Very confused, but the scenario seems to be along the lines of stack corruption.  I can't be sure..... but I have a page that runs a nsExec::ExecToLog call and pops the result... and if I skip that segment.... the following page, ( the components page. ) actually progresses when I press the install button.....<br />
<br />
But if I execute the call.... ( though it doesn't fail immediately ) after it completes, and I move on.. from the custom page into the component page...<br />
<br />
( I track the entry into the component page with a pre or show popup box) and I track the exit with a MessageBox in the leave.....<br />
<br />
Thing is.... when I press the Install button of the components, I never hit the leave function but I stall immediately.  I put popups into each of my sections, and it never fires a section marker.....  <br />
<br />
This was stable code till yesturday when I added the nsExec::ExecToLog calls to the custom page leave function..... very strange.  <br />
<br />
The thing that makes me think its stack corruption is that it doesn't fail immediately, but fails later on an instrinsic page-move call... which are all stack critical....  it also seems to have corrupted the ability to go back....<br />
<br />
Not saying that it couldn't be something else... ( and if I find it.... I will come back and disreguard this guess... ) but kitchic was looking for a straw to yank on.... maybe this is something...<br />
<br />
_AWallo</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th July 2008, 12:11</div></div><div class="posttext">You shouldn't be using ExecToLog unless you're running from a section anyway but that shouldn't cause any problems. Can you post a script that reproduces the problem?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Andrew Wallo</div><div class="date">21st July 2008, 15:11</div></div><div class="posttext">The script is huge... and won't run independantly.. ( i.e. if I snip ) but I was playing with my sequence, and I swapped for Exec and used a different $var to pop into, and then I went back to ExecLog but didn't change back the variable and the amazing page problem just went away.<br />
<br />
. !insertmacro BIMAGE &quot;BannerFindingRulebase.bmp&quot; &quot;&quot;<br />
        SendMessage $HWNDPARENT ${WM_SETTEXT} 0 &quot;STR:Downloading Rulebase:&quot;<br />
<br />
        ; Ok we're leaving but if we're using an existing rulebase, we still should test the s2check test for the new authentication string..<br />
<br />
; This flag was determined on the previous page.  Its<br />
; defaulted in onInit and set on a custom page as it goes <br />
; through.  Essentially, if we're getting a new set of rules<br />
; then we're going to do a lot of stuff on this screen<br />
; which ( executed safe, further down. ) <br />
; but when the top branch fell through, it would hang<br />
; two pages away.<br />
<br />
<br />
StrCmp $UseDetectedRulebase &quot;1&quot; 0 GetTheRulebaseNow<br />
            ; Ok, well do the s2check for concurrance....<br />
<br />
; Poking around, messed with this.  <br />
; USED to use $var 9 but for some reason went to 0 and<br />
; cleared it up. <br />
            ;nsExec::ExecWait 's2check.exe $LicenseID.snf &quot;$Authentication&quot;' $9<br />
            ;pop $9<br />
<br />
; Then when we went back to this<br />
; it didn't have a problem.            <br />
<br />
nsExec::ExecToLog '&quot;$InstallDir\$FolderPrefix\snf2check.exe&quot; $LicenseID.snf &quot;$Authentication&quot;'<br />
<br />
pop $0<br />
<br />
StrCpy $s2Check $0 ; Set this as a flag for the message for the next screen, or if we just pass through. ( 0 result is clean )<br />
        Return ; ignore displaying this screen.....<br />
<br />
;Otherwise<br />
                <br />
    GetTheRulebaseNow:<br />
        ; Else download and report.<br />
        nsDialogs::Create /NOUNLOAD 1018<br />
	Pop $0 ; All my screens tend to pop $0 for the Nounload temp var... <br />
 <br />
<br />
Just so we're clear.  The script portion that I'm editing was two pages away from the place in the code that froze.<br />
<br />
And the malfunction in the script occurred when you clicked on &lt;Back&gt; or &lt;install&gt;.  Then it became unresponsive.  Just because of something with <br />
<br />
nsExec:ExecToLog &quot;blah blah blah&quot;<br />
pop $9<br />
<br />
Which when I moved the pop to $0 viola...... problem dissappeared.<br />
<br />
Now, None of my code depends on $vars 0-9 being stable.  i.e. I only use them for temp vars. And YES I looked for something depending on $9 for something else.... but it was not to be.<br />
<br />
So..... Now please elaborate why I can't use ExecToLog in my custom pages?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st July 2008, 15:34</div></div><div class="posttext">Because ExecToLog writes STDOUT to the install log window. Obviously you don't have an install log window when you are in a custom page!<br />
<br />
Use nsExec::Exec or nsExec::ExecToStack. However, as I said before, this shouldn't be causing a problem.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bbondy</div><div class="date">20th July 2012, 00:28</div></div><div class="posttext">Hi, I work for Mozilla and we recently had a bug report that Microsoft Security Essentials caused one of our files to act very slowly on updates and downloads while it scanned the file.  <br />
<br />
I could reproduce consistently. We narrowed down the slowness to be from nsExec::Exec.  Replacing with ExecWait fixed the problem, but of course it has command prompts popup now.  I then searched to see if anyone else had this problem and found this thread.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bbondy</div><div class="date">20th July 2012, 03:08</div></div><div class="posttext">Also I should add that you have to have a silent installer for this to happen. Also I know this is a really old topic but just in case someone else finds this thread :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">20th July 2012, 04:47</div></div><div class="posttext">Hmm. I haven't seen that problem with my installers. <br />
<br />
Our main product installer uses NsExec:Exec 9 times. This installer is run silent via /S. There are 8 times I use that in an outer meta-installer (which is not run silently). Other installers we run during our product installation have 7 NsExec calls during TFTP install and 2 more in another component installer (these are run with /S, too). I also use that in other utilities that aren't a normal part of our product.<br />
<br />
Our product is run on a dedicated PC included with our system (HW &amp; SW). Until this month we've been using Windows 2000. We tested Windows 7 last year and are just now releasing new systems with that OS. A small number of installations have been done by our developers or other inhouse personnel on Windows XP. I've never seen or received reports of the installer hanging or the program that was Exec'ed not ending properly. We have about 15000 customers, most have had the software installed many times as we upgrade to new versions.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th July 2012, 10:43</div></div><div class="posttext">I have always used the ExecDos plug-in because of it's better output-to-stack support. Also I have had an issue with nsExec in the past on systems that have AntiExecutable or similar software installed - nsExec appears to create its own temporary process under a random name which is always blocked.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bbondy</div><div class="date">21st July 2012, 04:22</div></div><div class="posttext">The problem doesn't happen with the /S option.  That's actually how we're fixing the problem, to have a UI and to use the /S option.  MS Security Essentials Real time scan option seems to trigger some longer than normal scan when data is read or written from disk, when the installer is silent and there is a call to nsExec::Exec.  <br />
<br />
You can only reproduce if you have both of the above conditions.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>