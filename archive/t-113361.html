<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Multiple installs on 1 machine with variables, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Multiple installs on 1 machine with variables NSIS Discussion" />
	
	<title> Multiple installs on 1 machine with variables [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Multiple installs on 1 machine with variables</div>
<hr />
<div class="pda"><a href="t-113361.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=113361">Multiple installs on 1 machine with variables</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Paul_Hammons</div><div class="date">8th November 2002, 20:54</div></div><div class="posttext">All,<br />
<br />
In a nutshell, I am using install options to ask for a port number and assigning it to $R2.<br />
I am then appending this portnumber to the end of a service name and directory.  Lets say 5000 for this example.<br />
<br />
This creates a directory called $INSTDIR\$R2\ and the executable is appended with the $R2 variable, so when it runs it is running as app.exe5000 or whatever the port number is they entered.<br />
<br />
The reason I am doing this is because the app can be installed many times to monitor many ports.<br />
<br />
The uninstaller makes an uninstall app called uninst$R2 and the uninstall entry says &quot;Uninstall app.exe5000&quot;.  So far so good.<br />
<br />
The problem I am having is as follows:<br />
How do I make the uninstaller remove the appropriate directory?<br />
If I tell it to delete $INSTDIR, it wipes out everything.  If I tell it to delete $INSTDIR\$R2\, when the installer is written, it literally writes it as $\INSTDIR\$R2 instead of $INSTDIR\5000.<br />
I have tried to write the values in the registry and an .ini file, but I cannot get the initial uninstall to look in the right directory or registry key without NSIS expanding the variable values when creating the uninstaller.<br />
<br />
Any ideas?  Hoping I can call writeUninstaller with a switch that passes variable values to it so it can populate them when creating the uninstaller.  It somehow does pass $INSTDIR (and populates it at the time of creation) but doesn't seem to pass any other variables.<br />
<br />
If there is no secret switch or something, is there a way I can get the name of the uninst.exe?  Since I appended the port number to the end, I could read the filename of uninst$R2.exe and do an offset to repopulate $R2 uninstaller.  The problem with offsets is how long is the port number?  If I offset from the left side, is there a way to just read the filename?  There is a command to get the full path and short path, creation date, etc, but how do I just get the name of a file without the path?  If I offsetfrom the right using -4 and the port is 5 numbers long, it is going to be wrong.<br />
<br />
Another though, is there a way to use a character as the offset value?  For instance, instead of &quot;strcpy 4&quot; which copy 4 characters can I do something like &quot;strcpy until .&quot;?  This would let me copy until it finds a &quot;.&quot;<br />
<br />
Last thought, is there a way to count the characters in a filename?  If I can count the characters in a variable, I would know how many characters to offset.  Or if I could could the characters in a filename, I could figure out how many to offset.<br />
<br />
Sorry for making this so long, I am just hitting a brick wall from every angle I try and am looking for some fresh ideas.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th November 2002, 21:32</div></div><div class="posttext">To set $INSTDIR with vairables use the callback function .onInit and set $INSTDIR to whatever you want.<br />
<br />
To get the uninstaller name process $CMDLINE.<br />
<br />
To get the number of characters in a string use StrLen.<br />
<br />
To pass variables to the uninstaller you will have to use the registry or an INI file. To change $INSTDIR according to them use .onInit that I have mentioned above.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>