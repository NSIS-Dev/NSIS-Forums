<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Strange happenings between 2 installers, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Strange happenings between 2 installers NSIS Discussion" />
	
	<title> Strange happenings between 2 installers [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Strange happenings between 2 installers</div>
<hr />
<div class="pda"><a href="t-148325.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=148325">Strange happenings between 2 installers</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th September 2003, 13:24</div></div><div class="posttext">I have made a simple installer to get the file size (FileSizeNew) of say blah.bsp on my hard drive, then write the value to an ini file which I can store on the web.<br />
<br />
A typical value is 5036424.<br />
<br />
Now, my main installer downloads the ini file from the web, then gets the file size of that same file (blah.bsp) on the users' hard drive (in this case, the exact same blah.bsp on my hard drive).<br />
<br />
However, the value is always 5036425 and not 5036424.<br />
It seems to add 1 on even though it is exactly the same file that my installer is getting the file size from.<br />
<br />
Right now I am taking 1 from the file size to get it to work, but this shouldn't be happening at all.<br />
<br />
This is not just happening to the one bsp file, but for all the files.<br />
Could it be because of different installer styles (the installer to first get the file sizes is only a basic one with just an instfiles page)<br />
<br />
-Stu :cry:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">6th September 2003, 13:27</div></div><div class="posttext">Isn't it a webserver related issue (UNIX/DOS newlines etc.)?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">6th September 2003, 13:29</div></div><div class="posttext">not a solution - but i understood it this way:<br />
<br />
prog gets size from file &gt; ini<br />
ini uploaded to web<br />
prog gets ini from web &gt; size = size+1<br />
<br />
So ini has changed?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th September 2003, 13:30</div></div><div class="posttext">No, the value written to my ini file on my hard drive is always 1 less even before upload.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">6th September 2003, 13:55</div></div><div class="posttext">So<br />
<br />
&gt;&gt; prog gets size from file &gt; ini <br />
(1st step)<br />
<br />
writes the wrong size?<br />
routines are same? 2 different progs?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th September 2003, 17:15</div></div><div class="posttext">That is correct.<br />
Same path, two different progs.<br />
Either the 1st prog is getting it wrong, or the main prog is.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">6th September 2003, 18:25</div></div><div class="posttext">is it possible to get your code or codesnippets?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th September 2003, 19:39</div></div><div class="posttext">To write the file sizes to my ini (txt) file:<br />
Section &quot;&quot;<br />
 FileOpen $R0 &quot;C:\progra~1\nsis\Dev\ddayupdater\gfs\newmaps.lst&quot; r<br />
loop:<br />
ClearErrors<br />
 FileRead $R0 $R1<br />
IfErrors done<br />
 Push $R1<br />
  Call TrimNewLines<br />
 Pop $R1<br />
 StrCmp $R1 &quot;&quot; done<br />
 StrCmp $R1 eof done<br />
Push &quot;C:\quake2\dday\maps\$R1.bsp&quot;<br />
Call FileSizeNew<br />
Pop $0<br />
 WriteINIStr &quot;C:\progra~1\nsis\Dev\ddayupdater\du_objects.txt&quot; &quot;New map versions&quot; &quot;$R1.bsp&quot; &quot;$0&quot;<br />
 FileRead $R0 $0<br />
 Push $0<br />
  Call TrimNewLines<br />
 Pop $0<br />
 WriteINIStr &quot;C:\progra~1\nsis\Dev\ddayupdater\du_objects.txt&quot; &quot;New map versions&quot; &quot;$R1.bsp-zip&quot; &quot;$0&quot;<br />
Goto loop<br />
done:<br />
FileClose $R0<br />
SectionEnd<br />
<br />
Then in my main installer, I read the values again from the downloaded du_objects.txt and compare:<br />
ReadINIStr $1 &quot;$TEMP\ddayupdates\objects.du&quot; &quot;New map versions&quot; &quot;$R3&quot;<br />
 StrCmp $1 &quot;&quot; loop_maplist<br />
<br />
ReadINIStr $2 &quot;$TEMP\ddayupdates\objects.du&quot; &quot;New map versions&quot; &quot;$R3-zip&quot;<br />
 StrCmp $2 $R0 0 loop_maplist<br />
<br />
 Push &quot;$EXEDIR\maps\$R3&quot;<br />
 Call FileSizeNew<br />
 Pop $2<br />
 StrCmp $1 $2 loop_maplist<br />
<br />
du_objects.txt is here: http://myweb.tiscali.co.uk/imker/ddayupdater/du_objects.txt<br />
<br />
newmaps.lst is attached as newmaps.txt<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">6th September 2003, 20:23</div></div><div class="posttext">FileRead $R0 $0<br />
 Push $0<br />
<br />
  Call TrimNewLines<br />
 Pop $0<br />
<br />
Somewhere between these lines...<br />
<br />
&quot;TrimNewLines&quot; ?<br />
<br />
i often control vars with a messagebox<br />
<br />
eg.<br />
MessageBox MB_ICONINFORMATION|MB_OK &quot;'$R0', '$0'&quot;<br />
<br />
So i can see quickly whats going wrong and where - i had such a situation here.<br />
<br />
hmm - a bug in &quot;FileRead $R0 $0&quot; ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th September 2003, 21:02</div></div><div class="posttext">Try calling FileSizeNew without any other things on the script with those two computers you were testing on. Though I can't see a reason it might fail, you should try and make sure that's not the reason.<br />
<br />
Also make sure the files are really the same size on both computers... Who knows, you might have some program/virus that tacks another byte on the end.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th September 2003, 21:17</div></div><div class="posttext">Originally posted by kichik <br />
Try calling FileSizeNew without any other things on the script with those two computers you were testing on. Though I can't see a reason it might fail, you should try and make sure that's not the reason.<br />
<br />
Also make sure the files are really the same size on both computers... Who knows, you might have some program/virus that tacks another byte on the end.  <br />
<br />
The bsps are the same, they are the same bsps on the same computer.<br />
The computers are the same - I am testing on one.<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>