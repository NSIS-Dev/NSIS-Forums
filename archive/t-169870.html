<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Execute a SQL file, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Execute a SQL file NSIS Discussion" />
	
	<title> Execute a SQL file [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Execute a SQL file</div>
<hr />
<div class="pda"><a href="t-169870.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=169870">Execute a SQL file</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">fabiochelly</div><div class="date">18th February 2004, 08:44</div></div><div class="posttext">Hi,<br />
<br />
In my setup, In install Apache and MySQL.<br />
Is it possible to execute a .sql file to create my database and all its content directly in my NSIS setup?<br />
<br />
Thanks &amp; Best regards</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kobus</div><div class="date">18th February 2004, 10:36</div></div><div class="posttext">Recenlty I've got similar problem with Oracle DB.<br />
I finally did it in line that looks <br />
<br />
 nsExec::Exec '$OracleExe\$SqlCli $User/$Passwd@$Db @$script '<br />
<br />
where <br />
  nsExec::Exec - function from nsExec plugin that execute program and wait till it finish<br />
  $OracleExe   - directory of Oracle executables<br />
  $SqlCli      - name of SQL client that will run sql script<br />
  $User/$Passwd@$Db - name, passwd and connect string to make a valid connection to database<br />
  $Script      - full path to the string<br />
<br />
This line start the client in silient mode without any window on the screen.<br />
<br />
If you want to do this with MySQL check options for MySQL client because they will be probably different ones.<br />
<br />
<br />
Good luck :) <br />
Kobus</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Spatacoli</div><div class="date">18th February 2004, 19:18</div></div><div class="posttext">For mySQL I use a line like this:<br />
nsExec::ExecToLog 'cmd /C $mySQLEXE -u$dbUser -h$dbHost -P$dbPort &lt; &quot;$INSTDIR\tmp\dbinit\create_user.sql&quot;'<br />
<br />
$mySQLEXE is usually C:\mysql\bin\mysql.exe, but I detect the correct path earlier in the scripts. The rest should be self explanitory.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fabiochelly</div><div class="date">18th February 2004, 22:03</div></div><div class="posttext">Thank you very much.<br />
That's exactly what I was looking for.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fabiochelly</div><div class="date">20th February 2004, 07:31</div></div><div class="posttext">How do you do when you have a long path to mysql?<br />
I tried to put the mysql path between double quotes but the command doesn't work in this case.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">20th February 2004, 07:40</div></div><div class="posttext">Did you put it between single and double quotes?<br />
<br />
'&quot;file&quot;'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fabiochelly</div><div class="date">20th February 2004, 09:17</div></div><div class="posttext">I tried to put the path between double quotes.<br />
The whole command line is between single quotes<br />
<br />
In fact, the command:<br />
nsExec::ExecToLog 'cmd /C c:\mysql\mysql.exe -uroot -hlocalhost -P3306 &lt; &quot;$INSTDIR\install.sql&quot;'<br />
works fine but the command:<br />
nsExec::ExecToLog 'cmd /C &quot;c:\mysql\mysql.exe&quot; -uroot -hlocalhost -P3306 &lt; &quot;$INSTDIR\install.sql&quot;'<br />
doesn't work (I get nothing)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Spatacoli</div><div class="date">20th February 2004, 23:57</div></div><div class="posttext">not to be picky about it, but I want to be sure you have it right, mysql.exe lives in the bin directory, so do you mean that the path to your mysql.exe file is C:\mysql\bin\mysql.exe or is it C:\mysql\mysql.exe?<br />
<br />
I'm trying what you have here, I've always put the path in a variable like mySQLEXE<br />
<br />
StrCpy $mySQLEXE &quot;C:\mysql\bin\mysql.exe&quot;<br />
<br />
and then used that with quotes around it like this:<br />
nsExec::ExecToStack 'cmd /C &quot;$mySQLEXE&quot; -u$dbUser -p$dbPassword -h$dbHost -P$dbPort &lt;  &quot;$INSTDIR\install.sql&quot;'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Spatacoli</div><div class="date">21st February 2004, 00:05</div></div><div class="posttext">So I tried it like this and it doesn't have a problem working (the path is the longest I could come up with on short notice):<br />
<br />
nsExec::ExecToStack 'cmd /C &quot;C:\Documents and Settings\temp1\Local Settings\Temporary Internet Files\Content.IE5\Q5IVCDQ1\mysql.exe&quot; -uroot -prootpass -hlocalhost -P3306 &lt; &quot;$INSTDIR\install.sql&quot;'<br />
<br />
A short version is:<br />
<br />
nsExec::ExecToStack 'cmd /C &quot;C:\mysql\bin\mysql.exe&quot; -uroot -prootpass -hlocalhost -P3306 &lt; &quot;$INSTDIR\install.sql&quot;'<br />
<br />
As Joost pointed out to me in a different post, cmd will only work on an NT system (NT, 2000, XP, 2003) not on 9x.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">22nd February 2004, 11:44</div></div><div class="posttext">For Win9x use command instead of cmd.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fabiochelly</div><div class="date">22nd February 2004, 12:30</div></div><div class="posttext">is it necessary to use the command 'command' or 'cmd'?<br />
<br />
Cannot I type directly the instruction:<br />
nsExec::ExecToStack '&quot;C:\mysql\bin\mysql.exe&quot; -uroot -prootpass -hlocalhost -P3306 &lt; &quot;$INSTDIR\install.sql&quot;'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">22nd February 2004, 12:53</div></div><div class="posttext">You are using Windows console features so you have to use command or cmd.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fabiochelly</div><div class="date">22nd February 2004, 13:43</div></div><div class="posttext">And isn't it better to always use 'command' instead of 'cmd'?<br />
<br />
Are there cases where 'command' cannot be used or where 'cmd' doesn't work the same way than 'command'?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Spatacoli</div><div class="date">22nd February 2004, 19:56</div></div><div class="posttext">As Joost pointed out, cmd isn't a recognized program on Windows 9x. I use it in my installers because our software is only supported on Windows 2000, XP, and 2003. If you need compatibility with Windows 9x you should use command.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">22nd February 2004, 20:01</div></div><div class="posttext">command on Windows NT is not the same as cmd.<br />
<br />
command is the 16-bit MS-DOS version that will be emulated. It does not support long files names.<br />
<br />
cmd is a 32-bit console with long file name support.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">arfinator853</div><div class="date">25th February 2005, 22:44</div></div><div class="posttext">I am using this code that you guys mentioned earlier for the sql files that I need executed (9 of them)<br />
nsExec::ExecToLog 'cmd /C $mySQLEXE -u$user -h$host -P$port &lt; &quot;$INSTDIR\tmp\db\&quot;<br />
<br />
I have the user enter these mysql values in a custom page I created.  (Value - user variable)<br />
<br />
Username - $user<br />
Password - $pass<br />
SQL Host - $host<br />
Port MySQL is running on - $port<br />
SQL Database - $base<br />
<br />
<br />
I am very new at mysql, and I was wondering if in the code, how I should deal with the database password, and what actual schema to put it in.<br />
<br />
For this would -b (schema to put it in) -p (for password), would these work.  Should I just add them into the code?<br />
<br />
Thanks in advance everybody! :)<br />
<br />
Arfy</div></div><hr />


<div class="post"><div class="posttop"><div class="username">arfinator853</div><div class="date">26th February 2005, 16:44</div></div><div class="posttext">*bump*</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mutantbc</div><div class="date">13th November 2006, 06:43</div></div><div class="posttext">Hi,<br />
<br />
Have you guys encountered hang on your installer when trying to execute below script?<br />
<br />
nsExec::ExecToLog 'cmd /C $MySQLEXE -u $dbUser -p $dbPwd -h $dbHost -P $dbPort &lt; $MySQLScript'<br />
<br />
<br />
where:<br />
  MySQLScript -&gt; contains the sql file (Check the syntax alread, which is correct :))<br />
<br />
  usrname, pwd, host, port are correct also.<br />
<br />
<br />
Please help.<br />
<br />
<br />
thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">13th November 2006, 08:21</div></div><div class="posttext">Hi mutantbc!<br />
<br />
<br />
nsExec::ExecToLog 'cmd /C $MySQLEXE -u $dbUser -p$dbPwd -h $dbHost -P $dbPort &lt; $MySQLScript'<br />
<br />
<br />
I think the installer 'hangs' because mysql.exe is waiting for the password. Remove the space between -p and $dbPwd and try again.<br />
<br />
Have a nice day!<br />
<br />
Cheers<br />
<br />
Bruno<br />
<br />
Edit: Erm, there's something else to consider: cmd is Windows NT and higher only. The %COMSPEC% environment variable contains the correct value. (Forget this if you are sure, that your installer is not getting in touch with Windows 9x versions.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mutantbc</div><div class="date">13th November 2006, 09:37</div></div><div class="posttext">after installing MySQL, i try to execute MySQLInstanceConfig.exe...this will configure the username/pwd and install mysql as service. After the configuration, I try to connect to mysql server and execute the sql script...if I remove the -p $dbPwd, an error will occured &quot;Access denied...&quot;<br />
<br />
How can i proceed? it seems mysql will ask a password if -p is supplied.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">13th November 2006, 09:44</div></div><div class="posttext">Hi!<br />
<br />
Of course, you have to provide a password! But not in the format<br />
-p MyPassWOrD<br />
<br />
You have to use it like this:<br />
-pMyPassWOrD<br />
<br />
(without space between -p and password)<br />
<br />
Cheers<br />
<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sunlight112</div><div class="date">13th November 2006, 10:46</div></div><div class="posttext">I think this can help you,<br />
It works perfectly, :)<br />
<br />
   GetTempFileName $0<br />
   StrCpy $0 &quot;temp.bat&quot;<br />
   FileOpen $1 $0 &quot;w&quot;<br />
   FileWrite $1 &quot;@echo off$\r$\n&quot;<br />
   StrCpy $2 $TEMP 2     ##C:<br />
   FileWrite $1 &quot;$2$\r$\n&quot;<br />
   FileWrite $1 &quot;mysql.exe database --user=root --password=$passroot &lt; c:\test.sql$\r$\n&quot;<br />
   FileClose $1<br />
   nsExec::exec &quot;$0&quot;<br />
<br />
However, I think you should check Environment Variable in Computer property. In Path,you must add &quot;C:\MySQL\MySQL server..\bin&quot;<br />
It also can recognize mysql.exe when you run it on command line.<br />
:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mutantbc</div><div class="date">16th November 2006, 05:33</div></div><div class="posttext">the parameter without space works...strange but i works without  prompting a password. :)<br />
<br />
-pwithoutspacepassword<br />
<br />
<br />
thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">16th November 2006, 05:44</div></div><div class="posttext">Hi mutantbc!<br />
<br />
Actually you'll find this in the manual:<br />
<br />
http://dev.mysql.com/doc/refman/5.0/en/mysql-command-options.html<br />
<br />
--password[=password], -p[password]<br />
<br />
Cheers<br />
<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mutantbc</div><div class="date">17th November 2006, 10:31</div></div><div class="posttext">you are right, maybe I didnt read the manual thourougly</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>