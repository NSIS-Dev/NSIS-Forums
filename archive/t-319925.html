<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" ErrorLevel Not returning, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  ErrorLevel Not returning NSIS Discussion" />
	
	<title> ErrorLevel Not returning [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  ErrorLevel Not returning</div>
<hr />
<div class="pda"><a href="t-319925.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=319925">ErrorLevel Not returning</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Squirre1</div><div class="date">13th June 2010, 18:51</div></div><div class="posttext">I am using a custom errorlevel in an installer and it does not appear to be returning as necessary...<br />
<br />
      !insertmacro logme $INSTLOG &quot;OS Detected: Windows $R0 $R1&quot; l<br />
      !insertmacro logme $INSTLOG &quot;Install Error: OS Not Supported&quot; l<br />
      MessageBox MB_OK|MB_ICONINFORMATION &quot;Please provide the following information to support.$\r$\n$\r$\nInstallation of ${APP_DESC} failed with error: OS Not Supported$\r$\n$\r$\nTerminating Installation&quot;  /SD IDOK<br />
      SetErrorLevel 999<br />
      SetRebootFlag false<br />
      goto _ierrored<br />
<br />
<br />
    _ierrored:<br />
<br />
    !insertmacro logme $INSTLOG &quot;Cleaning Up Temporary Files ... Please be Patient&quot; b<br />
    SetOutPath $INSTDIR<br />
    !insertmacro RemoveFilesAndSubDirs &quot;$INSTDIR\${APP_NAME}&quot;<br />
    RMDir /r &quot;$INSTDIR\${APP_NAME}&quot;<br />
<br />
    !insertmacro logme $INSTLOG &quot;*** ${APP_DESC} Installation Ended in Error ***&quot; b<br />
    StrCpy $FINISHPAGE_TEXT &quot;The installation of ${APP_DESC} has resulted in an error and was not completed.$\r$\n$\r$\nClick Finish to close this wizard.&quot;<br />
<br />
    _end:<br />
<br />
<br />
There are just the two sections of any relavence so you can see whats taking place.. The log is generating correctly, but there errorlevel does not appear to be getting set.<br />
<br />
13.06.2010 12:28:47	*-----------------------------------------------------*<br />
13.06.2010 12:28:47	### Microsoft Windows Installer 4.5 Installation Starting<br />
13.06.2010 12:28:47	### Build Verison: 1.0.0.1<br />
13.06.2010 12:28:47	### Runtime: 6/13/2010 12:28:47<br />
13.06.2010 12:28:47	### Switches: /S<br />
13.06.2010 12:28:47	*-----------------------------------------------------*<br />
13.06.2010 12:28:47	<br />
13.06.2010 12:28:47	Silent Installation has been Requested<br />
13.06.2010 12:28:47	Running Pre-installation Processes<br />
13.06.2010 12:28:47	Detecting the Running Operating System<br />
13.06.2010 12:28:47	OS Detected: Windows 7 64<br />
13.06.2010 12:28:47	Install Error: OS Not Supported<br />
13.06.2010 12:28:47	Cleaning Up Temporary Files ... Please be Patient<br />
13.06.2010 12:28:47	*** Microsoft Windows Installer 4.5 Installation Ended in Error ***<br />
<br />
Any Ideas are greatly appreciated..<br />
<br />
Thanks...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">13th June 2010, 18:57</div></div><div class="posttext">I don't see Quit in there</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Squirre1</div><div class="date">13th June 2010, 19:12</div></div><div class="posttext">Do you have to have a Quit in order for it to return the errorlevel... I thought the SetErrorLevel was enough for it to assign the errorlevel for when the installation finishes..? Please correct me if I am wrong.<br />
<br />
In a commandline window I do the following...<br />
<br />
&gt;Set errorlevel=15      ; Set a dummy errorlevel level to validate it changes<br />
&gt;Installer.exe /S<br />
&gt;echo %errorlevel%    ; Still returns 15 for the errorlevel, like the installer NEVER influenses it..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Squirre1</div><div class="date">13th June 2010, 20:15</div></div><div class="posttext">Just as a FYI, I tested with the Quit in there, and it is STILL not returning the errorlevel correctly. Not sure what is up...<br />
<br />
I have also tested different methods of SetErrorLevel for ex.<br />
SetErrorLevel &quot;999&quot;<br />
SetErrorLevel 999<br />
SetErrorLevel '999'<br />
<br />
All with the same result, none of them return...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">13th June 2010, 20:43</div></div><div class="posttext">I believe SetErrorLevel must come immediately before your Quit command (not too sure if GoTo's are allowed), as otherwise NSIS' own code for error level setting upon installer exit may override whatever you set.<br />
Worth a try, at least - our installers have it set immediately before Quit / last command of .onGuiEnd , and work correctly.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">13th June 2010, 21:22</div></div><div class="posttext">It looks like you have masked the true errorlevel by setting a variable with that name before the program started. Remove the &quot;Set ErrorLevel=15&quot; and see if your program returns 999.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Squirre1</div><div class="date">13th June 2010, 21:32</div></div><div class="posttext">That does not mask it, anytime the NSIS installer finishes it should overwrite the previous errorlevel... I have even created small scripts based on some recommendations from the others...<br />
<br />
Doesn't Work: Post Execution Errorlevel = 0<br />
Name &quot;SetErrorLevel test&quot;<br />
<br />
OutFile &quot;SetErrorLevel.exe&quot;<br />
<br />
Function .onInit<br />
FunctionEnd<br />
<br />
Section<br />
  SetErrorLevel 25<br />
SectionEnd<br />
<br />
<br />
Doesn't Work: Post Execution Errorlevel = 0<br />
Name &quot;SetErrorLevel test&quot;<br />
<br />
OutFile &quot;SetErrorLevel.exe&quot;<br />
<br />
Function .onInit<br />
FunctionEnd<br />
<br />
Section<br />
SectionEnd<br />
<br />
Function .onGUIEnd<br />
  SetErrorlevel 25<br />
  Quit<br />
FunctionEnd<br />
<br />
<br />
No matter how you do it, for some reason the errorlevel is not returning... I have another installer where errorlevel is assigned with no problem the exact same way as in the first post, BUT it is not assigned manually, but by the installer... For ex.<br />
<br />
ExecWait &quot;blah blah blah&quot; $0<br />
SetErrorLevel $0<br />
<br />
That works find with no problem... So not quite sure what is up... Im Stumped for the moment...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Squirre1</div><div class="date">13th June 2010, 21:43</div></div><div class="posttext">So, a little more into it.. And this is even a little more messed up...<br />
<br />
From the scripts in my previous post. If you call it from command line as just seterrorlevel.exe it returns with 0. But if you call it from command line as cmd /c &quot;seterrorlevel.exe&quot; it actually does return the errorlevel of 25... Ugh... Now I am lost, if it is just an interfacing issue or if there is some underlying thing in my NSIS script that is not getting set...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">13th June 2010, 22:40</div></div><div class="posttext">To verify error levels, use another nsis script and call ExecWait yourapp.exe $0 and check the register, cmd.exe has many problems with error codes</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">13th June 2010, 23:15</div></div><div class="posttext">Anders is right..<br />
In cmd.exe, if you want to catch the correct ERRORLEVEL from a non-console app, you must call<br />
start &quot;&quot; /WAIT myapp.exe<br />
echo %ERRORLEVEL%<br />
or make a program (like Anders is suggesting) that catch the errorlevel for you</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">14th June 2010, 01:48</div></div><div class="posttext">Raymond Chen wrote an article (http://blogs.msdn.com/b/oldnewthing/archive/2008/09/26/8965755.aspx) that explains ERRORLEVEL is not the same as %ERRORLEVEL%. That's why I suggested that your &quot;Set errorlevel=0&quot; and &quot;echo %errorlevel% are not displaying the actual errorlevel that the exe returns.<br />
<br />
You can also refer to the MS  documentation (http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/batch.mspx?mfr=true) of the &quot;IF&quot; command which says %errorlevel% expands into a string representation of the current value of errorlevel, provided that there is not already an environment variable with the name ERRORLEVEL</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>