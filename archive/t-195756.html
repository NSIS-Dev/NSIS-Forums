<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" GetWindowsVersion does not detect win2k!!, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  GetWindowsVersion does not detect win2k!! NSIS Discussion" />
	
	<title> GetWindowsVersion does not detect win2k!! [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  GetWindowsVersion does not detect win2k!!</div>
<hr />
<div class="pda"><a href="t-195756.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=195756">GetWindowsVersion does not detect win2k!!</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">caykahve2003</div><div class="date">6th October 2004, 13:46</div></div><div class="posttext">Hello,<br />
<br />
I use GetWindowsVersion function (found in NSIS User Manual) to detect the OS. <br />
<br />
What I want to do is to detect the OS and continue according to that. The setup detects win NT 4, and Win XP, but it does not detect win 2000. I tested on two different machines with win 2000. In the function, it goes to the lbl_error label. R1 and R0 are empty only with win 2000.<br />
<br />
I attached necessary parts of the code to this message and added ';*****' to the end of the lines I would like to draw your attention. I also put the messages that pop up in comments.<br />
<br />
As Win xp and win 2000 go to the same label in the just after the function call, and XP works, I do not think that there is a problem with the rest of the code that I wrote. <br />
<br />
Thank you.<br />
<br />
Regards,<br />
caykahve</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobGrant</div><div class="date">6th October 2004, 16:30</div></div><div class="posttext">First thing to say I think is that posting threads with titles accusing the developers of not making a good enough method is not a 100% foolproof way of getting the best response from said developers.<br />
<br />
Having said that I'm sure they'll be nice.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">caykahve2003</div><div class="date">6th October 2004, 17:10</div></div><div class="posttext">Posting a message here does not mean that you are accusing people. You ask for help in the forums because you are doing something wrong but you cannot realize where the error is. <br />
<br />
I thought that I had done everything right, but I have seen that it is not so. I cannot understand why it has happened. That is the reason I am writing here. Saying something doesn't work is not accusing people. There are a million reasons why something doesn't work. I have to express the situation as clear as possible.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">6th October 2004, 20:28</div></div><div class="posttext">I tried it on a Windows 2000 server and it seemed fine. It popped both of the messages that you had marked in the script as not popping.  It popped the winnt message and then the 2000 message.  The value of $R1 was also 5.0.  Is your test machine running Windows 2000 server?  I don't think I have any non server 2000 machines here to try it on here.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">caykahve2003</div><div class="date">7th October 2004, 10:00</div></div><div class="posttext">Thank you for trying. my machine is Windows 2000, not server. $R1 is '' with mine.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">caykahve2003</div><div class="date">7th October 2004, 11:53</div></div><div class="posttext">I put more messages inside the GetWindowsVersion function, and saw that on win2000, it reads the &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion&quot; key's  CurrentVersion value perfectly as '5.0' but, afterwards does not jump to lbl_winnt from the line <br />
&quot;IfErrors 0 lbl_winnt&quot;<br />
and continues by trying to read the &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion&quot; key's VersionNumber value. Afterwards what it reads is null. Therefore, the rest of the code fails. <br />
<br />
In the user's manual it says for ReadRegStr: &quot;If the value is present, but is of type REG_DWORD, it will be read and converted to a string and the error flag will be set.<br />
&quot; The value is of type REG_SZ. I could not understand why the error flag is still set.<br />
<br />
BTW, I made a trial again on XP: it works correctly and jumps after reading the registry value on &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion&quot; .<br />
<br />
I will be happy if someone can help me...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kolos</div><div class="date">7th October 2004, 12:42</div></div><div class="posttext">Hi,<br />
<br />
Try to use<br />
strcmp $R0 &quot;&quot; 0 lbl_winnt<br />
instead of<br />
IfErrors 0 lbl_winnt</div></div><hr />


<div class="post"><div class="posttop"><div class="username">caykahve2003</div><div class="date">7th October 2004, 13:47</div></div><div class="posttext">that works! :)<br />
thank you kolos!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">7th October 2004, 15:14</div></div><div class="posttext">The error flag has probably been set somewhere else, I think there should a ClearErrors call before reading the  key.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">caykahve2003</div><div class="date">8th October 2004, 07:38</div></div><div class="posttext">ClearErrors before ReadRegStr also solved the problem. Tested on 2000, XP, and NT 4.<br />
Thank you Joost Verburg.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>