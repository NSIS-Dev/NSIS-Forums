<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem NSIS Discussion" />
	
	<title> Problem [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem</div>
<hr />
<div class="pda"><a href="t-301717.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=301717">Problem</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">hanschen</div><div class="date">5th January 2009, 12:28</div></div><div class="posttext">I haven't been able to find what I'm looking for. It could be that I'm searching wrong as my English isn't the best.<br />
<br />
Anyways, here is my problem:<br />
<br />
I've created an installer and now there have to be some extra options. I have 4 sections and 4 fields which have to write in 2 files. A .txt file and a .cmd file.<br />
<br />
The first 2 fields aren't a problem as they need to be filled in always. But the last to 2 fields should be hidden or grayed-out when sec04 is unchecked.<br />
<br />
So SEC04 brings the .cmd file and then the last 2 fields are needed to fill in.<br />
<br />
<br />
!insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ihm.ini&quot; &quot;Field 6&quot; &quot;State&quot; $HOST   <br />
!insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ihm.ini&quot; &quot;Field 2&quot; &quot;State&quot; $SERVER  <br />
!insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ihm.ini&quot; &quot;Field 8&quot; &quot;State&quot; $DLC   <br />
!insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ihm.ini&quot; &quot;Field 10&quot; &quot;State&quot; $DBMTC<br />
<br />
<br />
Section &quot;MM&quot; SEC04<br />
<br />
<br />
So what I was thinking was something like if SEC04 is Checked then show the last 2 fields: Field 8 en Field 10.<br />
<br />
Attached is a picture of the four fields I'm reffering to.<br />
I hope you can help me with my sucky english :-)<br />
<br />
If you have any questions left, let me know!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">5th January 2009, 14:10</div></div><div class="posttext">should be simple enough... use SectionGetFlags or the Sections header to check if section ${SEC04} is selected or not.<br />
If it is not selected, then use EnableWindow &lt;control hwnd&gt; 0 or ShowWindow &lt;control hwnd&gt; 0 to disable/hide the two controls.<br />
<br />
Depending on what you use to build the custom page, getting the control hwnd is either as simple as accessing the variable (NSDialogs), or as 'complex' as using ReadIniStr for InstallOptions(2/Ex), to completely fudging it yourself using GetDlgItem &lt;parent dialog&gt; &lt;control id&gt;.<br />
<br />
Edit: Quick example (NSDialogs)<br />
<br />
!include MUI.nsh<br />
!include nsDialogs.nsh<br />
<br />
OutFile &quot;c:\testsetup.exe&quot;<br />
<br />
Page Components<br />
Page Custom fnCreate<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
  <br />
Var CHECKBOX<br />
<br />
Section &quot;Hello&quot; Hello<br />
SectionEnd<br />
<br />
Function fnCreate<br />
	nsDialogs::Create /NOUNLOAD 1018<br />
	Pop $0<br />
<br />
	${NSD_CreateCheckbox} 0 -50 100% 8u &quot;Test&quot;<br />
	Pop $CHECKBOX<br />
<br />
	SectionGetFlags ${Hello} $0<br />
	IntOp $0 $0 &amp; 1 ; 1 == selected<br />
<br />
	IntCmp $0 1 _check _uncheck<br />
	    _check:<br />
	        ${NSD_SetState} $CHECKBOX 1<br />
		goto _done<br />
	    _uncheck:<br />
	        ${NSD_SetState} $CHECKBOX 0<br />
	_done:<br />
	nsDialogs::Show<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th January 2009, 14:30</div></div><div class="posttext">Instead of using labels, just use LogicLib:<br />
<br />
${If} ${SectionIsSelected} ${SectionId}<br />
...<br />
${Else}<br />
...<br />
${EndIf}<br />
<br />
Also make sure you put this code after you define the section in your script - Animaether's code references a section with an id of ${Hello} before the actual section is defined in the script. This will not work.<br />
<br />
I should also point out that (although if you use LogicLib, then this doesn't matter) Animaether has used the wrong operator with IntOp. It should be a single ampersand (&amp;) and not two (&amp;&amp;). Two ampersands being a logical AND rather than a binary AND.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">hanschen</div><div class="date">5th January 2009, 14:50</div></div><div class="posttext">I've tried the following options:<br />
<br />
  ConfigOptionsEtape4:<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ihm.ini&quot; &quot;Field 6&quot; &quot;State&quot; $HOST<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ihm.ini&quot; &quot;Field 2&quot; &quot;State&quot; $SERVER<br />
  ${If} ${SectionIsSelected} ${SEC04}<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ihm.ini&quot; &quot;Field 8&quot; &quot;State&quot; $DLC<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ihm.ini&quot; &quot;Field 10&quot; &quot;State&quot; $DBMTC<br />
  ${Else}<br />
  ${EndIf<br />
<br />
and<br />
<br />
    ConfigOptionsEtape4:<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ihm.ini&quot; &quot;Field 6&quot; &quot;State&quot; $HOST<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ihm.ini&quot; &quot;Field 2&quot; &quot;State&quot; $SERVER<br />
  ${If} ${SectionIsSelected} ${SEC04}<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ihm.ini&quot; &quot;Field 8&quot; &quot;State&quot; $DLC<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ihm.ini&quot; &quot;Field 10&quot; &quot;State&quot; $DBMTC<br />
  ${Else}<br />
  Abort<br />
  ${EndIf}<br />
<br />
The first option didn't work. And the section option was all or nothing. When I selected the SEC04 it showed what it should, but when I didn't select SEC04 it didn't do anything at all. <br />
<br />
Am I doing something wrong. I already had LogicLib included.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th January 2009, 14:56</div></div><div class="posttext">Have you got this code after the section declaration in your script?<br />
At what point are you running this code? Before the install options page is shown?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">5th January 2009, 15:00</div></div><div class="posttext">whoops - mea culpa on the single vs double ampersands; adjusting post.<br />
<br />
Oddly enough the code does work despite the section being declared after the function, though o_O</div></div><hr />


<div class="post"><div class="posttop"><div class="username">hanschen</div><div class="date">5th January 2009, 15:03</div></div><div class="posttext">Originally posted by Afrow UK <br />
Have you got this code after the section declaration in your script?<br />
At what point are you running this code? Before the install options page is shown?<br />
<br />
Stu  <br />
<br />
Can I PM you my script? That will probally explain a lot more I guess.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th January 2009, 15:04</div></div><div class="posttext">Yes if you give SectionGetFlags/SectionGetText an invalid index (in this case the string &quot;${Hello}&quot;) then it gets the flags/text of the first section in your script.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">hanschen</div><div class="date">5th January 2009, 15:11</div></div><div class="posttext">I've used your hint, however I can't PM at. It contains to many characters.<br />
<br />
I've got the code behind the section declaration in the Function declaration.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th January 2009, 15:22</div></div><div class="posttext">Mail to afrowuk tiscali co uk<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">hanschen</div><div class="date">5th January 2009, 15:25</div></div><div class="posttext">Originally posted by Afrow UK <br />
Mail to afrowuk tiscali co uk<br />
<br />
Stu  <br />
<br />
Its on its way!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th January 2009, 16:54</div></div><div class="posttext">Code looks fine. Try putting a MessageBox in your If branch to see if it gets displayed depending on the section state.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">hanschen</div><div class="date">6th January 2009, 07:44</div></div><div class="posttext">I think I have found one of the problems. If you look at the code I send you, what I was talking about was line: 338 t/m 342<br />
<br />
How ever, if I'd look a few row's down where my ini files get called, should I do something there?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>