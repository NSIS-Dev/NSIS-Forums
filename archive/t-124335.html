<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Need to edit two files after installation (search &amp; replace), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Need to edit two files after installation (search &amp; replace) NSIS Discussion" />
	
	<title> Need to edit two files after installation (search &amp; replace) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Need to edit two files after installation (search &amp; replace)</div>
<hr />
<div class="pda"><a href="t-124335.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=124335">Need to edit two files after installation (search &amp; replace)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">8th February 2003, 14:12</div></div><div class="posttext">Dear Community,<br />
<br />
I have started a project for installing a complete WAMP (webserver with PHP and MySQL). After successfully copying the files to their destination, two files have to be edited. The first is the webservers-configfile, the other one is the php-configurationfile. In these two files I have some directives which correspond to the installation-path. So I want to deliver a modified conf-file with one variable called (e.g.) @@SERVERROOT@@. After installation is completed, I need to search for that string and replace it with &quot;$INSTDIR\path\to\program&quot;. <br />
<br />
How can this be achieved/solved?<br />
<br />
Another question:<br />
Does anybody know how to search for an existing service and if this exists to make the installer stop (better open a pre-definied textfile with a solution to solve this problem &quot;and go on with the installation after solving&quot;)?<br />
<br />
Cheers<br />
Mosestycoon</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th February 2003, 14:34</div></div><div class="posttext">To edit files use FileOpen, FileWrite, FileRead, FileSeek and FileClose. Go to this (http://nsis.sourceforge.net/archive/nsisweb.php?page=73&amp;instances=0,44) for a good example. It replaces certain line in a text file with another line. You can set in the config file you are installing a certain line and then have this little script replace it with whatever you want.<br />
<br />
To find and stop services use services.dll by Sunjammer from:<br />
http://nsis.sourceforge.net/archive/download.php</div></div><hr />


<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">8th February 2003, 15:14</div></div><div class="posttext">I am really surprised. For even the most complicated things (at least to me) is something to solve it. The answer is even shorter than the question!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">8th February 2003, 15:20</div></div><div class="posttext">Thx, I will give it a try :-)<br />
<br />
Mosestycoon<br />
<br />
P.S. Where do I have to place it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">8th February 2003, 15:25</div></div><div class="posttext">It's not really commended well, so as I'm a really bad programmer, this is not simple for me ;-(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th February 2003, 15:51</div></div><div class="posttext">Put that code after the file extraction code. Maybe it a section of its own called &quot;edit config files&quot;, maybe right after the config extraction, that's up to you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">8th February 2003, 20:01</div></div><div class="posttext">I tried it with this function:<br />
<br />
  FileOpen $0 &quot;$INSTDIR\Apache2\conf\httpd.pre.conf&quot; &quot;r&quot; <br />
  GetTempFileName $R0 <br />
  FileOpen $1 $R0 &quot;w&quot; <br />
  loop:  <br />
    FileRead $0 $2  <br />
  IfErrors done <br />
  StrCmp $2 &quot;ServerRoot @@SERVERROOT@@/Apache2$\r$\n&quot; 0 +3  <br />
     FileWrite $1 &quot;ServerRoot $INSTDIR/Apache2$\r$\n&quot;  <br />
	 Goto loop <br />
;  StrCmp $2 &quot;line to replace&quot; 0 +3  <br />
;    FileWrite $1 &quot;replacement of line&quot;  <br />
;	 Goto loop <br />
  FileWrite $1 $2  <br />
     Goto loop <br />
 done:  <br />
  FileClose $0  <br />
  FileClose $1  <br />
  Delete &quot;$INSTDIR\Apache2\conf\httpd.pre.conf&quot;  <br />
  Rename $R0 &quot;$INSTDIR\Apache2\conf\httpd.conf&quot;<br />
 <br />
<br />
BUT the compiler said:<br />
<br />
Processed 1 file, writing output:<br />
Adding plug-ins initializing function... Done!<br />
warning: install function &quot;.ReplaceString&quot; not referenced - zeroing code (4182-4196) out<br />
<br />
So this is a bit suspect, because the installer should &quot;search &amp; replace&quot;, not the compiler...<br />
<br />
Am I wrong?<br />
<br />
I need this to be parsed on clients, after installation.<br />
<br />
A possibility would be to parse this through sed.exe (streaming-editor), but I have no idea where to get the installation-path from so that this could be taken as parameter for sed.exe</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th February 2003, 20:08</div></div><div class="posttext">The problem with your code is that regular functions are called if you don't call them. Sections are called according to the user's choice in the components page, but functions have to be called from sections by you. For example:<br />
<br />
Function myFunc<br />
# do stuff....<br />
FunctionEnd<br />
<br />
Section &quot;Do stuff&quot;<br />
# extract some files...<br />
# write do the registry...<br />
Call myFunc<br />
SectionEnd<br />
<br />
There is another type of functions, call-back function, that are called by the installer, but you shouldn't care about those now.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">9th February 2003, 00:22</div></div><div class="posttext">Ok, after a good movie and some tests I think I got it.<br />
<br />
Thx 4 help</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>