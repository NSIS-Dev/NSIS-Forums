<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS compile error, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS compile error NSIS Discussion" />
	
	<title> NSIS compile error [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS compile error</div>
<hr />
<div class="pda"><a href="t-179848.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=179848">NSIS compile error</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">ovidiu</div><div class="date">13th May 2004, 15:27</div></div><div class="posttext">I'm getting the following error while trying to compile NSIS.<br />
Anyone can tell me which library am i missing ?<br />
<br />
Ui.obj : error LNK2001: unresolved external symbol __aullshr<br />
Release-bzip2/exehead_bzip2.exe : fatal error LNK1120: 1 unresolved externals</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th May 2004, 11:59</div></div><div class="posttext">Which compiler?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lroathe</div><div class="date">4th June 2004, 23:34</div></div><div class="posttext">Originally posted by ovidiu <br />
I'm getting the following error while trying to compile NSIS.<br />
Anyone can tell me which library am i missing ?<br />
<br />
Ui.obj : error LNK2001: unresolved external symbol __aullshr<br />
Release-bzip2/exehead_bzip2.exe : fatal error LNK1120: 1 unresolved externals<br />
 <br />
<br />
<br />
I am also seeing this error, and have been unable to find any reference to aullshr in the windows docs or headers.<br />
<br />
I am using MSVS (vc) 6.0 with the latest service pack.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">5th June 2004, 02:37</div></div><div class="posttext">Make sure that you also have the latest Platform SDK (http://www.microsoft.com/msdownload/platformsdk/sdkupdate/) downloaded.<br />
Then register the PSDK directories with Visual Studio using the shortcuts installed with the PSDK.<br />
Then try compiling again.<br />
Maybe it will fix the problem.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lroathe</div><div class="date">5th June 2004, 03:40</div></div><div class="posttext">Originally posted by iceman_k <br />
Make sure that you also have the latest Platform SDK (http://www.microsoft.com/msdownload/platformsdk/sdkupdate/) downloaded.<br />
Then register the PSDK directories with Visual Studio using the shortcuts installed with the PSDK.<br />
Then try compiling again.<br />
Maybe it will fix the problem.  <br />
<br />
Unfortunately I had already done that. Does NSIS require .net?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">5th June 2004, 04:00</div></div><div class="posttext">Not that I know of.<br />
I just tried compiling and it worked fine. I assume you are using the latest CVS version?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lroathe</div><div class="date">5th June 2004, 04:06</div></div><div class="posttext">Trying to compile the latest from CVS, just checked it out this afternoon. The aullshr reference is in gui.c if that helps.<br />
<br />
Actually, the only reason I want to compile is to modify the error message reported for &quot;Corrupt Installation Detected&quot; -- many of my users get this when downloading our products (they range from 25MB to 105MB in size) and it would be good if that message indicated it was probably a download problem and give a suggestion on how to solve it.<br />
<br />
Can I otherwise modify this string?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th June 2004, 09:49</div></div><div class="posttext">__aullshr is probably VC6 SP6's function that performs shift right operations on unsigned long long variables. No idea what the 'a' is for :)<br />
<br />
Try replacing Ui.c line 907:available = (int)(available64.QuadPart &gt;&gt; 10);with:available = (int)(Int64ShrlMod32(available64.QuadPart, 10));</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lroathe</div><div class="date">5th June 2004, 17:16</div></div><div class="posttext">Originally posted by kichik <br />
__aullshr is probably VC6 SP6's function that performs shift right operations on unsigned long long variables. No idea what the 'a' is for :)<br />
<br />
Try replacing Ui.c line 907:available = (int)(available64.QuadPart &gt;&gt; 10);with:available = (int)(Int64ShrlMod32(available64.QuadPart, 10));  <br />
<br />
That was exactly the problem, and I can now compile and link all targets! Now, why the frick does my copy of VC6 SP6 generate a call to that function, but is then not able to link in that function? Could it be that there is a way to setup VC6 with long-long support libraries as an option?<br />
<br />
Anyway, thanks for the help!<br />
<br />
PS: my guess at the function name is &quot;arithmatic unsigned long long shift right&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">5th June 2004, 18:32</div></div><div class="posttext">Alternately, you can extract ullshr.obj from libc:<br />
<br />
lib /extract:build\intel\st_obj\ullshr.obj libc.lib<br />
<br />
<br />
and link it in the project.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">2nd July 2004, 16:33</div></div><div class="posttext">Originally posted by kichik<br />
__aullshr is probably VC6 SP6's function that performs shift right operations on unsigned long long variables. No idea what the 'a' is for :)<br />
<br />
Try replacing Ui.c line 907:<br />
available = (int)(available64.QuadPart &gt;&gt; 10);with:available = (int)(Int64ShrlMod32(available64.QuadPart, 10));<br />
<br />
Any plans of making this change in the CVS source?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd July 2004, 22:06</div></div><div class="posttext">No. It produces larger code. A better solution must be found.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">3rd July 2004, 03:09</div></div><div class="posttext">Is this of any use to you?<br />
ullshr.asm (http://www.dpi.ufv.br/downloads/C++%20Introductory%20Edition)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd July 2004, 13:38</div></div><div class="posttext">Hmm... Visual C++ Introductory Edition? I assume you meant to link to an implementation of ullshr. I prefer not to get assembler in yet. Extracting __aullshr as an .obj file and linking to it so SP6 can find does seem like a possible solution. I would, of course, prefer a code change solution that will both work on SP6 and SP5 and not increase code size.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">3rd July 2004, 19:54</div></div><div class="posttext">Oops! :o <br />
Certainly didn't mean to imply that you needed an intro to VC++.<br />
Here is the correct link:<br />
ullshr.asm (http://www.dpi.ufv.br/downloads/C++%20Introductory%20Edition/VCB600ENU1/VC98/CRT/SRC/PLATFORM/ULLSHR.ASM) <br />
<br />
But, yes, it is assembly.<br />
So, perhaps not the right solution for now.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RDaneel</div><div class="date">3rd July 2004, 20:32</div></div><div class="posttext">Hmmm... going along with kichik, let's not be too hasty here. :)<br />
<br />
I built from CVS on June 3 (because of the NT4 installer problem with GetDiskFreeSpaceEx), and this chunk of code dealing with the 64-bit right-shift is right there in the sources... and *I* used a vc6 SP6 system to do it.<br />
<br />
BUT, I am still using the code generator (c2.dll) from the &quot;Processor Pack&quot; for SP5... and possibly because of the newer [&quot;vc7&quot;]  compiler piece, all I see is inline code generated for  the code sequence in question:<br />
mov	 eax, DWORD PTR _available64$93998[ebp]<br />
mov	 ecx, DWORD PTR _available64$93998[ebp+4]<br />
shrd	 eax, ecx, 10<br />
shr	 ecx, 10			; 0000000aH<br />
<br />
<br />
This is with the NSIS-standard optimization setting of &quot;Minimize Size&quot;, BTW.  However, I do specify the &quot;Pentium Pro&quot; (/G6) code generation option, since that more accurately reflects the in-use processor architectures one is like ly to see these days.<br />
<br />
So, since as I recall, kichik uses the Processor Pack, this could explain why only some people are seeing this linking issue - the people who are not using the Processor Pack. :)<br />
<br />
As to *why* the linking problem exists, it is not really clear to me - the &quot;ullshr.asm&quot; file has been part of the CRT sources for a long time - take a look in ..\CRT\SRC\Intel.<br />
<br />
As for vc6 SP6 + the SP5 Processor Pack, I have been using this combination since SP6 came out with no difficulty.  Besides not seeing any trouble myself, I might point out that SP6 does NOT include a new version of c2.dll, so the possibility of incompatible changes to the intermediate representation from the compiler's earlier passes is small. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">3rd July 2004, 22:22</div></div><div class="posttext">Hmmm... I didn't try VS6 SP6 + SP5 processor pack.<br />
Let me try that and see.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RDaneel</div><div class="date">3rd July 2004, 22:45</div></div><div class="posttext">If you have any trouble doing this... SP6 *will* attempt to remove/disable the Processor Pack. :(<br />
<br />
I took care of this by saving the contents of the appropriate &quot;Bin&quot; directory first, and then restoring any of the c2.dll / MASM support files I needed to after the SP6 update was done.<br />
<br />
One could take this approach, or if the &quot;damage&quot; has already been done, using 7-Zip or WinZip to pull the relevant files straight out of the SP5 Processor Pack installer would probably be fine too. :)<br />
<br />
Note that this all works fine if one just wants the superior code generator from the Processor Pack... if you want to actually use the processor Pack as MS intended (to have compiler support for the MMX/SSE etc H/W), there may be a little more environment needed to restore - see the .reg files in the PP installer, for example.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th July 2004, 18:01</div></div><div class="posttext">Originally posted by RDaneel <br />
As to *why* the linking problem exists, it is not really clear to me - the &quot;ullshr.asm&quot; file has been part of the CRT sources for a long time - take a look in ..\CRT\SRC\Intel.We don't use CRT ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bluenet</div><div class="date">1st October 2004, 01:47</div></div><div class="posttext">I got another error: NSIS\Source\DialogTemplate.cpp(353) : error C2065: 'DS_SHELLFONT' : undeclared identifier<br />
What wrong for me? Compiler is VC++ 6 with SP6<br />
I find it define in exehead\resource.h<br />
<br />
I try to add<br />
<br />
<br />
#ifndef DS_SHELLFONT<br />
#define DS_SHELLFONT        (DS_SETFONT | DS_FIXEDSYS)<br />
#endif<br />
 <br />
<br />
to DialogTemplate.h it compile OK. :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st October 2004, 10:46</div></div><div class="posttext">Fixed, thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th September 2005, 17:27</div></div><div class="posttext">I've added a check to the SConscript to check for this specific case and use Int64ShrlMod32 instead. Building using SP6 should no longer require manual intervention.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">17th March 2010, 11:17</div></div><div class="posttext">I have a problem building NSIS with MSVC 2005 tools:<br />
as /coff -o build\debug\System\Source\Call.obj Contrib\System\Source\Call.S<br />
'as' was not found. <br />
After some investigation, I think the problem is that SCons should use masm.py configuration in order to use the ml.exe MASM compiler that comes with MSVC, instead of as.exe (from MingW?)<br />
<br />
But I don't know how to tell SCons to do that..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd March 2010, 15:33</div></div><div class="posttext">Are you sure ml.exe is in the PATH? At least on VC6 it required a separate installation of the Processor Pack, iirc.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">23rd March 2010, 10:10</div></div><div class="posttext">thanks! after adding MSVC dir to the PATH, it worked</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>