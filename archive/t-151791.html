<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Help with Startmenu macros?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Help with Startmenu macros? NSIS Discussion" />
	
	<title> Help with Startmenu macros? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Help with Startmenu macros?</div>
<hr />
<div class="pda"><a href="t-151791.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=151791">Help with Startmenu macros?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Torok</div><div class="date">7th October 2003, 04:44</div></div><div class="posttext">Hi All,<br />
<br />
I've been trying for several days now to understand how to use NSIS to make my installer for a Java program (including the JRE and Java3D).  Since the API is changing rapidly, I now have part of one made for the latest beta (NSIS 2b4), with CVS code from last night.  Problem:<br />
<br />
I have a section for creating startmenu icons, like so:<br />
<br />
!insertmacro MUI_STARTMENU_WRITE_BEGIN<br />
  CreateDirectory &quot;$SMPROGRAMS\${COMPANY_NAME}&quot;<br />
  CreateDirectory &quot;$SMPROGRAMS\${COMPANY_NAME}\${MUI_PRODUCT}&quot;<br />
  CreateShortCut &quot;$SMPROGRAMS\${COMPANY_NAME}\${MUI_PRODUCT}\Uninstall.lnk&quot; &quot;$INSTDIR\uninstall.exe&quot; &quot;&quot; &quot;$INSTDIR\uninstall.exe&quot; 0<br />
  CreateShortCut &quot;$SMPROGRAMS\${COMPANY_NAME}\${MUI_PRODUCT}\${MUI_PRODUCT}.lnk&quot; &quot;$INSTDIR\${EXE_NAME}&quot; &quot;&quot; &quot;$INSTDIR\${EXE_NAME}&quot; 0<br />
!insertmacro MUI_STARTMENU_WRITE_END<br />
<br />
It gives me nasty errors:<br />
<br />
!insertmacro: MUI_STARTMENU_WRITE_BEGIN<br />
warning: unknown variable &quot;{MUI_STARTMENUPAGE_VARIABLE}&quot; detected, ignoring (macro:MUI_STARTMENU_WRITE_BEGIN:5)<br />
warning: unknown variable &quot;{MUI_STARTMENUPAGE_VARIABLE}&quot; detected, ignoring (macro:MUI_STARTMENU_GETFOLDER_IFEMPTY:2)<br />
warning: unknown variable &quot;{MUI_STARTMENUPAGE_DEFAULTFOLDER}&quot; detected, ignoring (macro:MUI_STARTMENU_GETFOLDER:13)<br />
Usage: StrCpy $(user_var: output) str [maxlen] [startoffset]<br />
Error in macro MUI_STARTMENU_GETFOLDER on macroline 13<br />
Error in macro MUI_STARTMENU_GETFOLDER_IFEMPTY on macroline 4<br />
Error in macro MUI_STARTMENU_WRITE_BEGIN on macroline 8<br />
<br />
<br />
Does anyone know why?  It used to work :(  I'm baffled most of the time, trying to create a fairly simple installer.....<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Torok</div><div class="date">7th October 2003, 05:07</div></div><div class="posttext">Apparently the InsertMacro lines must be deleted for beta4 to compile it.... but eh MUI readme that comes with beta 4 seems to suggest otherwise.  I'm totally lost here.  Am I doing something wrong, or reading the wrong docs?  <br />
<br />
NSIS is impressive, if a bit confusing....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th October 2003, 12:58</div></div><div class="posttext">The begin and end macros are still needed. If MUI_STARTMENUPAGE_VARIABLE is not defined it's probably because you didn't insert the start menu page macro (MUI_PAGE_STARTMENU). There is an example called StartMenu.nsi in Examples\Modern UI.<br />
<br />
But why would you want to show a start menu page if you don't use its input? In your code above you're using a static folder name instead of the one chosen by the user in the start menu page.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Torok</div><div class="date">7th October 2003, 16:28</div></div><div class="posttext">Hmmmm...  ok, well how do I give the user an option to install startmenu icons, but don't give them a choice as to where they go or what they're named? I assume a StartmenuPage would give them the opportunity to decide where things go in the startmenu, right? Which is why I wouldn't want to have a page like that. Instead I just put an installer section in that would write the shortcuts. In that case, do I still need the macros?<br />
<br />
There's a good chance that I'm misunderstanding how NSIS is meant to work, so please correct me if that's the case!  (I really do think this is great software, I'm just confused)<br />
<br />
Thanks :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th October 2003, 16:36</div></div><div class="posttext">MessageBox MB_YESNO|MB_ICONQUESTION &quot;Do you wish to create start-menu shortcuts for ${MUI_PRODUCT}?&quot; IDNO NoShortcuts<br />
CreateDirectory &quot;$SMPROGRAMS\${COMPANY_NAME}&quot;<br />
CreateDirectory &quot;$SMPROGRAMS\${COMPANY_NAME}\${MUI_PRODUCT}&quot;<br />
CreateShortCut &quot;$SMPROGRAMS\${COMPANY_NAME}\${MUI_PRODUCT}\Uninstall.lnk&quot; &quot;$INSTDIR\uninstall.exe&quot; &quot;&quot; &quot;$INSTDIR\uninstall.exe&quot; 0<br />
CreateShortCut &quot;$SMPROGRAMS\${COMPANY_NAME}\${MUI_PRODUCT}\${MUI_PRODUCT}.lnk&quot; &quot;$INSTDIR\${EXE_NAME}&quot; &quot;&quot; &quot;$INSTDIR\${EXE_NAME}&quot; 0<br />
NoShortcuts:<br />
<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th October 2003, 16:51</div></div><div class="posttext">You don't need to insert the MUI_STARTMENU_WRITE_BEGIN/END macros. It's only needed if you want to allow the user to choose the start menu folder. If you wish to just give the user a choice weather to create it or not make a section out of it or use a MessageBox or anyother method of input like Afrow suggseted.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>