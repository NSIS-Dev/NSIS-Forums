<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" SetSystemEnvironmentVariable, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  SetSystemEnvironmentVariable NSIS Discussion" />
	
	<title> SetSystemEnvironmentVariable [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  SetSystemEnvironmentVariable</div>
<hr />
<div class="pda"><a href="t-137439.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=137439">SetSystemEnvironmentVariable</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">shortpasta</div><div class="date">1st June 2003, 23:29</div></div><div class="posttext">the application i install runs as a service.<br />
<br />
because of this i need to set a SYSTEM environment variable and update the SYSTEM path.  can anyone tell me how to do this?<br />
<br />
the samples i found on the forums/sf.net only work on the USER environment.<br />
<br />
PS: the only way i could find to set system environment variables is with microsoft's &quot;setx.exe&quot; utility (from their resource kit).<br />
<br />
PS2: i also know that there is are &quot;Get/SetSystemEnvironmentVariable&quot; functions in the SDK but don't know which module.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st June 2003, 23:35</div></div><div class="posttext">Welcome to the forum.<br />
<br />
Use these functions:<br />
http://nsis.sourceforge.net/archive/viewpage.php?pageid=137<br />
<br />
When you define ALL_USERS they will affect the system environment variable table and not just the user's.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">shortpasta</div><div class="date">2nd June 2003, 01:07</div></div><div class="posttext">Thanks, it worked like you said.<br />
<br />
i had seen that before but i immediately discarted it in my mind because it said ALL USERS and not SYSTEM account.<br />
<br />
i looked further in microsoft's site &amp; found out that the system environment functions are *deprecated*, odd to see microsoft do this, but it speaks in favor of the &quot;ALL USERS&quot; concept including SYSTEM.<br />
<br />
Later gaters!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dabneyra</div><div class="date">1st November 2003, 04:33</div></div><div class="posttext">I cannot get this to work.  Here is the relevant code:<br />
<br />
!define ALL_USERS<br />
!include WriteEnvStr.nsh<br />
Section &quot;Add Env Var&quot;<br />
  Push Path<br />
  Push $INSTDIR\bin\win32<br />
  Call WriteEnvStr<br />
SectionEnd<br />
<br />
When I compile, I get this error ouput:<br />
<br />
GetTempFileName -&gt; $2<br />
File: &quot;RefreshEnv\Release\RefreshEnv.exe&quot; -&gt; no files found.<br />
Usage: File [/nonfatal] [/a] ([/r] filespec [...]|/oname=outfile one_file_only)<br />
!include: error in script: &quot;C:\Program Files\NSIS\Include\WriteEnvStr.nsh&quot; on line 52<br />
<br />
I am sure I am just misunderstanding how to use this function.  Can someone please set me straight?  Thank you,<br />
<br />
dabneyra</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st November 2003, 14:45</div></div><div class="posttext">You are using an old version of the function. Where did you take it from?<br />
<br />
You shold update to the latest code from the link above.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dabneyra</div><div class="date">2nd November 2003, 05:10</div></div><div class="posttext">Hi,<br />
<br />
I think that old version was in the NSIS install.  Anyway, I was able to compile with the new version using the same code as above. This time, it seems to have worked TOO well... instead of adding the install directory to the Path variable, it ENTIRELY replaced the Path directory with the install directory.  The rest of my old path had been deleted.  What to do?  Is there some way to recover the default Windows XP Path?  Sorry to continue being a pain in the ass about this, but I would really like to understand how this is working.  Thanks,<br />
<br />
dabneyra</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd November 2003, 07:28</div></div><div class="posttext">Isn't that what you've wanted? You've used WriteEnvStr... WriteEnvStr replaces, it doesn't add. If you want to change the path you should use the path manipulation (http://nsis.sourceforge.net/archive/viewpage.php?pageid=91) functions.<br />
<br />
As for restoring, try system restore.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dabneyra</div><div class="date">2nd November 2003, 17:15</div></div><div class="posttext">Hi,<br />
<br />
I saw those functions earlier, and actually was able to use them to append to the user path variable, but not the system path variable.  It was not immediately obvious to me how to use or modify the path manipulation functions to set the path for all users.<br />
<br />
Thanks,<br />
dabneyra</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dabneyra</div><div class="date">2nd November 2003, 20:28</div></div><div class="posttext">Hi,<br />
this thread (http://forums.winamp.com/showthread.php?s=&amp;threadid=140083) had the answer I was looking for.  Briefly, in case someone in the future is looking at this message to try and solve this problem, the change to be made is as follows:<br />
<br />
In the Path Manipulation Function (http://nsis.sourceforge.net/archive/viewpage.php?pageid=91), change<br />
<br />
HKCU<br />
<br />
to:<br />
<br />
HKLM &quot;SYSTEM\CurrentControlSet\Control\Session Manager\Environment&quot;<br />
<br />
Thanks for the help,<br />
dabneyra</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>