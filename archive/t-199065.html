<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" VXD and GetDLLVersionLocal, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  VXD and GetDLLVersionLocal NSIS Discussion" />
	
	<title> VXD and GetDLLVersionLocal [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  VXD and GetDLLVersionLocal</div>
<hr />
<div class="pda"><a href="t-199065.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=199065">VXD and GetDLLVersionLocal</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Andy La Rubin</div><div class="date">12th November 2004, 11:25</div></div><div class="posttext">Hi. <br />
<br />
There is a problem in NSIS when you need to install VXD driver with version control. Altough GetDLLVersion works fine with VXD under Win9x systems (it doesn't work under NT systems, but it usually isn't required), but GetDLLVersionLocal fails when you're trying to build installation under NT system (which is usually the case).<br />
<br />
The problem is that Win32 API functions GetFileVerisonInfoSize and GetFileVersionInfo do not work with LE format under NT system. So, I took the liberty of fixing that problem.<br />
<br />
There is a topic in MSDN, named &quot;HOWTO: Programmatically Retrieve a VxD's Version Information&quot;, it contains sample code which provides two functions - GetVxdVersionInfoSize and GetVxdVersionInfo, they are analogous to the GetFileVersionInfoSize and GetFileVersionInfo. I've put them into util.cpp/util.h (slightly rewritten). Then I've changed the logic of retrieving version info during GetDLLVersionLocal compiling (in script.cpp). First, the version info is retrieved the usual way, and if it fails, it is retrieved via new function pair. Now it works both on Win9x and NT systems. The attached file contains fixed source files. Of course, all the code is Win32-specific, so <br />
required #ifdefs are in place.<br />
<br />
Hope, you'll put this fix in the future updates of this great installer :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th November 2004, 13:38</div></div><div class="posttext">Any chance you can convert it to using standard library functions so it'll work on *nix too?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Andy La Rubin</div><div class="date">12th November 2004, 15:09</div></div><div class="posttext">I can try, but it'll do not much good, actually, because they're just retrieving version info data block from a file, and then this block is being parsed by Win32 function VerQueryValue.<br />
<br />
For *nix support I suppose CResourceEditor should be somehow changed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th November 2004, 15:16</div></div><div class="posttext">The code to extract VS_FIXEDFILEINFO from the resource is already written. The only problem is getting the resource from the LE.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th April 2007, 15:26</div></div><div class="posttext">Created patch tracker item (http://sourceforge.net/tracker/index.php?func=detail&amp;aid=1706624&amp;group_id=22049&amp;atid=373087) and applied. Thanks.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>