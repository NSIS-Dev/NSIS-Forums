<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Directory where ${__FILE__} is located?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Directory where ${__FILE__} is located? NSIS Discussion" />
	
	<title> Directory where ${__FILE__} is located? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Directory where ${__FILE__} is located?</div>
<hr />
<div class="pda"><a href="t-202595.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=202595">Directory where ${__FILE__} is located?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">grahamk</div><div class="date">20th December 2004, 19:00</div></div><div class="posttext">Hi everyone,<br />
<br />
I know about the compiler variable ${__FILE__} which returns the name of the file that is currently being compiled.<br />
<br />
Is there a way to get the directory where that file is located?<br />
<br />
Basically I want to create a sort of &quot;shared NSIS stuff&quot; directory that all of my scripts can access. In there I want to place a file called &quot;MyOptions.nsh&quot; which uses InstallOptions and requires &quot;MyOptions.ini&quot;.<br />
<br />
So the problem is, if I have &quot;ProductA.nsi&quot; do this:<br />
<br />
!addincludedir &quot;..\..\SharedNSIS&quot;<br />
!include &quot;MyOptions.nsh&quot;<br />
<br />
then the compile fails, because obviously NSIS will not look in the &quot;include&quot; dirs for an INI file.<br />
<br />
For now I have modified MyOptions.nsh so that the full path to MyOptions.ini is hardcoded -- but this is bad, because other developers might place the source tree in a different location on their workstations.<br />
<br />
If &quot;MyOptions.nsh&quot; could determine its own path, then I'd be all set.<br />
<br />
Thanks for your help... and NSIS guys, thank you for the excellent software.<br />
<br />
-- graham</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th December 2004, 19:59</div></div><div class="posttext">I think the NSIS dev should add a ${__PATH__} constant.<br />
You could then just use ${__PATH__}\${__FILE__}.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grahamk</div><div class="date">20th December 2004, 20:49</div></div><div class="posttext">I'm looking at the NSIS sources for the first time, and it looks rather straightforward to me. This is all in &quot;script.cpp&quot; as far as I can see. Maybe this code will provide a starting point:<br />
<br />
<br />
char *CEXEBuild::set_path_predefine(char *filename)<br />
{<br />
  char *oldpath = definedlist.find(&quot;__PATH__&quot;);<br />
  if(oldpath)<br />
  {<br />
    definedlist.del(&quot;__PATH__&quot;);<br />
  }<br />
  char *p = strrchr(filename, '\\\');<br />
  if(p)<br />
  {<br />
    char *filepath = strdup(filename);<br />
    filepath[p - filename] = '\0';<br />
    definedlist.add(&quot;__PATH__&quot;, filepath);<br />
  }<br />
  return oldpath;<br />
}<br />
<br />
void CEXEBuild::restore_path_predefine(char *oldpath)<br />
{<br />
  char *curpath = definedlist.find(&quot;__PATH__&quot;);<br />
  if(curpath)<br />
  {<br />
    free(curpath);<br />
    definedlist.del(&quot;__PATH__&quot;);<br />
  }<br />
  if(oldpath) {<br />
      definedlist.add(&quot;__PATH__&quot;,oldpath);<br />
  }<br />
}<br />
<br />
<br />
Then just add these to the class definition, and call them at the same time you'd call set_file_predefine and restore_file_predefine.<br />
<br />
NSIS devs, please verify this code before you check it in. It looks okay to me, but I haven't tested it (or even tried to compile it).<br />
<br />
Thanks<br />
<br />
-- graham</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th January 2005, 16:12</div></div><div class="posttext">For now you can use !system to redirect the output of the `cd` command into a file. For example:!system 'echo !define __PATH__ \ &gt; $%TEMP%\PATH.nsh'<br />
!system 'cd &gt;&gt; $%TEMP%\PATH.nsh'<br />
!include $%TEMP%\PATH.nsh</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Backland</div><div class="date">3rd November 2006, 06:21</div></div><div class="posttext">I've just tried this, if you add the above code by kickik to a file b.nsh and include it from a.nsi, __PATH__ will contain the parent directory of a.nsi, how can we determine the parent of b.nsh in this case?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd November 2006, 10:52</div></div><div class="posttext">If you want it at build time, simply append two dots &quot;${__PATH__}\..&quot;. If you want it at runtime, you can use GetParent (http://nsis.sourceforge.net/Docs/AppendixC.html#C.1) for a nicer looking path.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Backland</div><div class="date">3rd November 2006, 11:26</div></div><div class="posttext">nope, that didnt work<br />
<br />
I have a.nsi on the desktop and b.nsh in C:\, so it's not just going up one directoy, any other ideas?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd November 2006, 11:37</div></div><div class="posttext">In that case, you can simply use:!include &quot;\b.nsh&quot;makensis automatically changes the working directory to that of the script it compiles.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Backland</div><div class="date">3rd November 2006, 12:04</div></div><div class="posttext">yep that works out, but the problem is i got a bunch of other files/resources that b.nsh uses and those files are always going to be in the same directory as b.nsh, so I wanted to make the code in b.nsh be able to reference those files in its directory. Then if I change the location of the include in a.nsi to C:\abc\123\b.nsh, nothing else would need changing</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd November 2006, 12:16</div></div><div class="posttext">Then you're looking for the path of b.nsh, not a.nsi. You can use a similar trick, but instead of calling 'cd', call a program that'd convert b.nsh's ${__FILE__} into ${__PATH__}. It could be a simple silent NSIS installer that'd call GetParent and write the result into a file.# in b.nsh<br />
!system &quot;GetParent.exe ${__FILE__}&quot;<br />
!include &quot;$%TEMP%\PATH.nsh&quot;<br />
<br />
!echo &quot;${__PATH__}&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Backland</div><div class="date">3rd November 2006, 12:22</div></div><div class="posttext">thanks, i'll try it out</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>