<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Disabling &quot;Destination Folder&quot; page, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Disabling &quot;Destination Folder&quot; page NSIS Discussion" />
	
	<title> Disabling &quot;Destination Folder&quot; page [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Disabling &quot;Destination Folder&quot; page</div>
<hr />
<div class="pda"><a href="t-231906.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=231906">Disabling &quot;Destination Folder&quot; page</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Cerf</div><div class="date">25th November 2005, 20:25</div></div><div class="posttext">Hello there,<br />
<br />
I Searched the forum, but couldn't find the how to. I am a little new to NSIS. So please excuse if it's a very simple question.<br />
<br />
I have an app that comes with several modules, each can be installed separately but if there is one of the modules already installed the other ones *HAVE* to be in the same folder, so I better disable the Destination Folder page or dialog. <br />
I have used the NSIS examples and this forum to build the script, but I can't figure out how can I check if the InstallDirRegKey is present and then don't let the user mess with install dir.<br />
<br />
Thanks in advance,<br />
<br />
Cërf.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Cerf</div><div class="date">25th November 2005, 22:08</div></div><div class="posttext">I found something Here (http://forums.winamp.com/showthread.php?s=&amp;threadid=166727&amp;highlight=Disable+Browse) but I don't think it performs the check about installRegKey being present.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th November 2005, 11:35</div></div><div class="posttext">Use ReadRegStr.<br />
<br />
E.g.<br />
<br />
!define InstallDirRegKey '&quot;HKCU&quot; &quot;Software\MyApp&quot; &quot;InstallDir&quot;'<br />
InstallDirRegKey ${InstallDirRegKey}<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE DirectoryPre<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
<br />
Function DirectoryPre<br />
 ReadRegStr $R0 ${InstallDirRegKey}<br />
 StrCmp $R0 &quot;&quot; +2<br />
  Abort # Skip page<br />
FunctionEnd<br />
<br />
<br />
Edit: If you want to disable the directory field only, then your code would be different...<br />
<br />
<br />
!define InstallDirRegKey '&quot;HKCU&quot; &quot;Software\MyApp&quot; &quot;InstallDir&quot;'<br />
InstallDirRegKey ${InstallDirRegKey}<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_SHOW DirectoryShow<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
<br />
Function DirectoryShow<br />
 FindWindow $R1 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
 ReadRegStr $R0 ${InstallDirRegKey}<br />
 StrCmp $R0 &quot;&quot; NoDisable<br />
  GetDlgItem $R2 $R1 1019 # Dir box<br />
  EnableWindow $R2 0<br />
  GetDlgItem $R2 $R1 1001 # Browse button<br />
  EnableWindow $R2 0<br />
 Goto End<br />
 NoDisable:<br />
  GetDlgItem $R2 $R1 1019 # Dir box<br />
  EnableWindow $R2 1<br />
  GetDlgItem $R2 $R1 1001 # Browse button<br />
  EnableWindow $R2 1<br />
 End:<br />
FunctionEnd<br />
<br />
<br />
There's code in there to re-enable them again just in case.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Cerf</div><div class="date">28th November 2005, 14:45</div></div><div class="posttext">Hey there Stu,<br />
<br />
Thanks for the reply!<br />
I'm using the &quot;skip&quot; code, but now I am facing the embarrasing problem of not knowing how to assing a value to $INSTDIR when no other installation have been detected.<br />
<br />
Thanks again!<br />
<br />
Cërf.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dotdavid</div><div class="date">19th May 2006, 16:05</div></div><div class="posttext">StrCpy $INSTDIR &quot;C:\Your\Default\Path&quot;<br />
<br />
?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">19th May 2006, 18:48</div></div><div class="posttext">Use InstallDir as always, so if there is not other installation and the directory page is going to be visible, the browse field would prompt users with what you have entered in InstallDir.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>