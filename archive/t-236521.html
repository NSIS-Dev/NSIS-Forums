<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Code works in Function Not In Macro, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Code works in Function Not In Macro NSIS Discussion" />
	
	<title> Code works in Function Not In Macro [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Code works in Function Not In Macro</div>
<hr />
<div class="pda"><a href="t-236521.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=236521">Code works in Function Not In Macro</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">mhollander</div><div class="date">27th January 2006, 14:03</div></div><div class="posttext">Hi All,<br />
<br />
The following code works well as a function and gives no problems when compiling the script, but when I make it a macro, it complains about the lbl_done has already been defined. I have checked the script that calls the .nsh that contains this macro and there is no other label like it. I then copy it into that very same script as a function and then call it and the complaint about the label goes away. I woould appreciate it if someone can shed some light on this issue:<br />
<br />
P.S. I have stripped the comments and headers to keep this post short.<br />
<br />
:: CODE ::<br />
Function IsDotNetInstalled<br />
        Push $0<br />
        Push $1<br />
        Push $2<br />
        Push $3<br />
        Push $4<br />
        <br />
        ReadRegStr $4 HKEY_LOCAL_MACHINE &quot;Software\Microsoft\.NETFramework&quot; &quot;InstallRoot&quot;<br />
        # remove trailing back slash<br />
        Push $4<br />
        Exch $EXEDIR<br />
        Exch $EXEDIR<br />
        Pop $4<br />
        # if the root directory doesn't exist .NET is not installed<br />
        IfFileExists $4 0 noDotNET<br />
        StrCpy $0 0<br />
        <br />
        EnumStart:<br />
            EnumRegKey $2 HKEY_LOCAL_MACHINE &quot;Software\Microsoft\.NETFramework\Policy&quot;  $0<br />
            IntOp $0 $0 + 1<br />
            StrCmp $2 &quot;&quot; noDotNET<br />
            StrCpy $1 0<br />
        <br />
        EnumPolicy:<br />
            EnumRegValue $3 HKEY_LOCAL_MACHINE &quot;Software\Microsoft\.NETFramework\Policy\$2&quot; $1<br />
            IntOp $1 $1 + 1<br />
            StrCmp $3 &quot;&quot; EnumStart<br />
            IfFileExists &quot;$4\$2.$3&quot; foundDotNET EnumPolicy<br />
        <br />
        noDotNET:<br />
            StrCpy $0 &quot;False&quot;<br />
            Goto lbl_done<br />
        <br />
        foundDotNET:<br />
            StrCpy $0 &quot;True&quot;<br />
            Goto lbl_done<br />
        <br />
        lbl_done:<br />
            Pop $4<br />
            Pop $3<br />
            Pop $2<br />
            Pop $1<br />
            Exch $0<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">27th January 2006, 14:50</div></div><div class="posttext">Macros are blocks of code inserted into your script at compile time.  This means that if you use labels in your macro, the labels will be repeated each time the macro is called.<br />
<br />
To get around this, I use a !define command to define the current line number and then append this to the end of the macro name.  This makes each label unique when the macro is inserted more than once.<br />
<br />
Example:<br />
<br />
!macro TestMacro<br />
   !define x ${__LINE__}<br />
   ; code, code, code... blah blah blah...<br />
   ; now a label:<br />
   label${x}:<br />
   ; more code... blah blah blah<br />
   !undef x<br />
!macroend</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>