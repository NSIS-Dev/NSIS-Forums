<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Validate Windows Password, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Validate Windows Password NSIS Discussion" />
	
	<title> Validate Windows Password [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Validate Windows Password</div>
<hr />
<div class="pda"><a href="t-265387.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=265387">Validate Windows Password</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">dogo</div><div class="date">8th February 2007, 14:09</div></div><div class="posttext">Hi, <br />
<br />
I would like to let the user choose which account should<br />
run a special service. <br />
<br />
For that I need to validate a password by user given<br />
to validate with the special windows user password.<br />
<br />
Is there any way to to this ?!<br />
Somethink like that:<br />
<br />
StrCmp $WindowsPassword $UserPasswordInput ... ??<br />
<br />
Thanks for reply, <br />
<br />
Wolfgang.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">8th February 2007, 15:46</div></div><div class="posttext">The value of $WindowsPassword represents a password protected Windows account on NT system?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dogo</div><div class="date">8th February 2007, 20:55</div></div><div class="posttext">Ah, yes of course.<br />
<br />
Sorry that this is not very clear in my post.<br />
<br />
This should be an password for an local Windows account.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">8th February 2007, 21:00</div></div><div class="posttext">I'm afraid isn't possible through NSIS, there are some &quot;tools&quot; out there able to hack the password, however they should be used from a dos or linux bootable media because they are all blocked from AVs within windows environment.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dogo</div><div class="date">8th February 2007, 21:04</div></div><div class="posttext">Ah, <br />
<br />
the password should not be hacked, this is not what I want.<br />
I just would like to know if the password that was entered from the user is correct. This should be for an windows service that would be installed. The user has to select an windows user and has to enter the password, because windows needs an password to install a service :(.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">8th February 2007, 21:12</div></div><div class="posttext">If I got it correctly, we're going to the same result from a different direction.<br />
How the installer would be able to retrieve a password and verify if this is the correct password for the given account if not hack it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dogo</div><div class="date">8th February 2007, 21:16</div></div><div class="posttext">Hm, maybe there is an API function within windows like enumerate users ? Just to check if password is correct ? An function has to exist, because this is used if you add an service ! Maybe some windows guru has got an answer about this ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th February 2007, 21:23</div></div><div class="posttext">You can call LogonUser using the System plug-in.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">8th February 2007, 21:26</div></div><div class="posttext">Maybe some windows guru has got an answer about this ?most likely! However I guess the point for you is to know if the service is installed, you may simply perform a check to verify that and if not return to previous stage where users should provide the required details in order to install the service.<br />
<br />
edit: I'm still very slow on typing :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dogo</div><div class="date">8th February 2007, 21:37</div></div><div class="posttext">Ah, thanks for all, <br />
<br />
I will give them a try tomorrow :-).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dogo</div><div class="date">9th February 2007, 11:39</div></div><div class="posttext">Okay, <br />
<br />
LoginUser is working very well for local computers,<br />
is it also possible to do this for an network which contains<br />
Active Directory ?<br />
<br />
Sincearly, <br />
<br />
Wolfgang.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th February 2007, 11:56</div></div><div class="posttext">You can pass the domain name in the second parameter of LogonUser.<br />
<br />
Also, it'd be nice if you create an example page in the Wiki with the code you've used. I'm sure other users will find it useful as well.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dogo</div><div class="date">9th February 2007, 12:36</div></div><div class="posttext">Hey kichik, <br />
<br />
thanks for your fast posts, <br />
as far as I am ready with my installer I planned to write one or more wiki entry`s because my installer is full of such features. I hope I could help some other users with that.<br />
But first of all I had to finish my project ;) <br />
<br />
Sincearly, <br />
<br />
Wolfgang.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">HotButteredSoul</div><div class="date">16th February 2007, 17:57</div></div><div class="posttext">I needed to do the same thing in my install script.  The idea: check a user login and make sure it works for a domain.<br />
<br />
<br />
#<br />
# MSWAuthenticate.nsh - by HotButteredSoul<br />
#<br />
# Function for checking to see if a Microsoft Windows Username/password<br />
# pair authenticate.<br />
#<br />
<br />
!ifndef _MSWAuthenticate_nsh<br />
!define _MSWAuthenticate_nsh<br />
<br />
#<br />
# MSWAuthenticate - authenticates username/password pair<br />
#<br />
# Example:<br />
#<br />
# Push &quot;bob.username&quot;<br />
# Push &quot;ADOMAIN&quot;<br />
# Push &quot;bobs.password&quot;<br />
# Call MSWAuthenticate<br />
# Pop $0 ; = &quot;success&quot; on succes, or &quot;Logon failure: ...&quot; otherwise.<br />
#<br />
# Uses advapi32.lib LogonUserA<br />
#<br />
Function MSWAuthenticate<br />
    Exch $0 ; password (IN)<br />
    Exch<br />
    Exch $1 ; Domain (IN) / &quot;success&quot; (OUT)<br />
    Exch 2<br />
    Exch $2 ; Username (IN)<br />
    Push $3 ; LogonUserA return code<br />
    Push $4 ; GetLastError() code<br />
<br />
    ; LOGON32_LOGON_NETWORK = 3<br />
    ; LOGON32_PROVIDER_DEFAULT = 0<br />
    System::Call &quot;advapi32::LogonUserA(t r2, t r1, t r0, i 3, i 0, *i) i .r3 ?e&quot;<br />
    Pop $4 ; the ?e flag from System::Call pushes the result of GetLastError() onto the stack.<br />
    IntCmp 0 $3 reject ; return value of 0 is failure.<br />
    StrCpy $1 &quot;success&quot;<br />
    GoTo done<br />
<br />
    reject:<br />
    IntCmp   87 $4 ERROR_LOGON_FAILURE<br />
    IntCmp 1326 $4 ERROR_LOGON_FAILURE<br />
    IntCmp 1327 $4 ERROR_ACCOUNT_RESTRICTION<br />
    IntCmp 1328 $4 ERROR_INVALID_LOGON_HOURS<br />
    IntCmp 1329 $4 ERROR_INVALID_WORKSTATION<br />
    IntCmp 1330 $4 ERROR_PASSWORD_EXPIRED<br />
    IntCmp 1331 $4 ERROR_ACCOUNT_DISABLED<br />
    ;an error of some other sort<br />
        StrCpy $1 &quot;Logon failure: $4&quot;<br />
        GoTo done<br />
    ERROR_LOGON_FAILURE:<br />
        StrCpy $1 &quot;Logon failure: unknown user name or bad password.&quot;<br />
        GoTo done<br />
    ERROR_ACCOUNT_RESTRICTION:<br />
        StrCpy $1 &quot;Logon failure: user account restriction.&quot;<br />
        GoTo done<br />
    ERROR_INVALID_LOGON_HOURS:<br />
        StrCpy $1 &quot;Logon failure: account logon time restriction violation.&quot;<br />
        GoTo done<br />
    ERROR_INVALID_WORKSTATION:<br />
        StrCpy $1 &quot;Logon failure: user not allowed to log on to this computer.&quot;<br />
        GoTo done<br />
    ERROR_PASSWORD_EXPIRED:<br />
        StrCpy $1 &quot;Logon failure: the specified account password has expired.&quot;<br />
        GoTo done<br />
    ERROR_ACCOUNT_DISABLED:<br />
        StrCpy $1 &quot;Logon failure: account currently disabled.&quot;<br />
        GoTo done<br />
<br />
    done:<br />
    Pop $4<br />
    Pop $3<br />
    Pop $2<br />
    Pop $0<br />
    Exch $1<br />
FunctionEnd<br />
!endif ; _MSWAuthenticate_nsh</div></div><hr />


<div class="post"><div class="posttop"><div class="username">HotButteredSoul</div><div class="date">16th February 2007, 21:41</div></div><div class="posttext">Wiki'd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">7th June 2007, 22:09</div></div><div class="posttext">1. i have a problem with your function when the user's password is empty, it always reports &quot;user account restriction&quot;. doesn't matter if it's a limited account or admin.<br />
<br />
2. when is the message i get supposed to show up anyway?<br />
<br />
3. when i try the function with guest accounts, the error message is &quot;Logon failure: 1385&quot;.<br />
<br />
4. is there a way to check if the user has admin rights?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">8th June 2007, 02:41</div></div><div class="posttext">xp fails with blank passwords for network logons by default. You can set limitblankpassworduse=0 in HKLM\SYSTEM\CurrentControlSet\Control\Lsa to override this</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">8th June 2007, 10:17</div></div><div class="posttext">so that means if i want to use that function to validate a user really is administrator (who happens to have an empty password), it will not work?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">8th June 2007, 19:14</div></div><div class="posttext">..or asked differently, is this script not for winlogons?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">12th June 2007, 00:04</div></div><div class="posttext">5. in what other cases will &quot;user account restriction&quot; be displayed?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">30th June 2007, 14:51</div></div><div class="posttext">i've attached a script using the MSWAuthenticate function. it is meant to bring something like UAC to NSIS installers on older windows nt versions. however, to improve it i need some of the above questions answered. do i get the &quot;user account restriction&quot; only only when i have an empty password? does it work when the user specifies a different user (admin user) than the user logged in? any hints for improvements are welcome!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th June 2007, 15:32</div></div><div class="posttext">There are more restrictions available in Windows but the empty password, so I doubt that'd be the only case.<br />
<br />
LogonUser should work with other users but the current user. It won't be too useful without working that way.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">20th September 2007, 08:06</div></div><div class="posttext">Sorry to bring back this old topic, but I came across something related to this that would probably solve the empty password issue, its called SSPI (Security Service Provider Interface)<br />
<br />
More info @ http://www.winterdom.com/dev/security/sspi.html<br />
<br />
Hopefully someone will write a plugin (or use the system plugin if you are insane)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>