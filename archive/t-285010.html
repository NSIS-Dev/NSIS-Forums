<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Install using Registry Key, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Install using Registry Key NSIS Discussion" />
	
	<title> Install using Registry Key [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Install using Registry Key</div>
<hr />
<div class="pda"><a href="t-285010.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=285010">Install using Registry Key</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">JediKnight2</div><div class="date">15th January 2008, 03:12</div></div><div class="posttext">I have searched and tried every thing I can think of and have read, but I cannot seem to get this to work.<br />
<br />
I have a registry key at HKLM &quot;SOFTWARE\MyProgram&quot; &quot;&quot;<br />
Basically it shows the location of the install.  I have a patched file that needs to go into the location the key shows, but in a sub folder so if the key shows C:\Program Files\MyProgram, I need it in C:\Program Files\MyProgram\lib<br />
<br />
I have tried this but it just wont work<br />
<br />
Section &quot;MainSection&quot; SEC01<br />
ReadRegStr $0 HKLM SOFTWARE\MyProgram &quot;&quot;<br />
IfFileExists $0\lib +2<br />
  StrCpy $0 &quot;$INSTDIR&quot;<br />
SetOutPath $0<br />
  SetOverwrite on<br />
  File &quot;file.txt&quot;<br />
SectionEnd<br />
<br />
I also tried to add the lib part on the SetOutPath, no worky</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">15th January 2008, 05:07</div></div><div class="posttext">Assuming that the mentioned key behaves like the InstallDirRegKey and shows the installation dir, all you need is:<br />
ReadRegStr $0 HKLM &quot;SOFTWARE\MyProgram&quot; &quot;&quot;<br />
SetOutPath &quot;$0\lib&quot;<br />
or in function .onInit<br />
ReadRegStr $0 HKLM &quot;SOFTWARE\MyProgram&quot; &quot;&quot;<br />
StrCpy $INSTDIR &quot;$0\lib&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">IFX</div><div class="date">15th January 2008, 22:01</div></div><div class="posttext">Well, I searched for the term registry folder and read 10 pages worth of stuff and tried all of them.  Using the onit, getParent, read the key, etc.  For some reason it just wont pick it up.  I have used the install directory registry key string and it will read fine from the key.  However, when I try to use a read reg key in the section it isn't working.<br />
<br />
I tried what you had Red, but it didn't work either...I am posting my code...<br />
<br />
Also, for some reason my other account went dead?  Not sure what happened to it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">IFX</div><div class="date">15th January 2008, 22:14</div></div><div class="posttext">Forgot the file</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th January 2008, 22:17</div></div><div class="posttext">InstallDirRegKey has some minor processing applied to the registry key specified. For example, if it detects a path to an executable, it removes the last part. Make sure $0 contains exactly what you think it contains.<br />
<br />
You should use $SYSDIR instead of C:\Windows\System32.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">IFX</div><div class="date">16th January 2008, 00:13</div></div><div class="posttext">When it reads the registry key it pulls<br />
<br />
C:\Program Files\MyProgram<br />
<br />
If I use InstallDirRegKey in a non section it correctly pulls the directory...however what I need to do is append what it pulled and add \lib...so I tried various ways in the Section to read the key and add the \lib..tried Reds way and it didn't work for some reason...it might be something in my script that is why I posted it....I'm lost, it's like it totally ignores the setoutputpath in the Section</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">16th January 2008, 05:04</div></div><div class="posttext">According to the code that you've posted above, you're attempting to read a registry key which obviously doesn't exist, so $0 should be empty and the error flag up.<br />
The key doesn't exist because your script missing that part where it should create it upon successful installation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">IFX</div><div class="date">16th January 2008, 14:21</div></div><div class="posttext">Something isn't right...the key is there because I can see it in the registry and it is at HKLM Software\MyProgram  There are two strings in there...one is a default string and another is a DB location.  If I take out the ReadRegStr part in the Section and use InstallDirRegKey HKLM &quot;SOFTWARE\${SHORTNAME}&quot; &quot;&quot; it correctly sets the install location.  So that is where I am confused...I take the InstallDirRegKey out and use ReadRegStr in the Section and it doesn't work....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th January 2008, 15:31</div></div><div class="posttext">Check the value of $0 after you read it from the registry using a message box.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">IFX</div><div class="date">22nd January 2008, 13:19</div></div><div class="posttext">Ok...I see what is going on, but I haven't figured out how to fix it.  I just took that page off since it is a patch anyway..it IS going to the right directory, however when it goes to this page <br />
; Directory page<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
it is printing out the wrong directory not the one that is read in the section...like I said I don't need it because it is a patch and the registry key correctly points to the location I need it to.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">22nd January 2008, 13:39</div></div><div class="posttext">You need to use !define MUI_DIRECTORYPAGE_VARIABLE $Var<br />
Otherwise it will use $INSTDIR.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>