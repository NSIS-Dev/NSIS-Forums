<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Create a GUID, a Globally Unique Identifier, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Create a GUID, a Globally Unique Identifier NSIS Discussion" />
	
	<title> Create a GUID, a Globally Unique Identifier [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Create a GUID, a Globally Unique Identifier</div>
<hr />
<div class="pda"><a href="t-145684.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=145684">Create a GUID, a Globally Unique Identifier</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">13th August 2003, 20:34</div></div><div class="posttext">Creates a GUID, or Globally Unique Identifier. Thanks to everyone who helped with the hex and character array issues.<br />
<br />
Supports: Win9x, WINNT, WIN2K and WINXP<br />
Requires: System Plugin<br />
Archive: http://nsis.sourceforge.net/archive/nsisweb.php?page=374&amp;instances=0<br />
<br />
<br />
;Call CreateGUID<br />
;Pop $0 ;contains GUID<br />
Function CreateGUID<br />
  Push $R0<br />
  Push $R1<br />
  Push $R2<br />
  Push $R3<br />
  Push $R4<br />
  ;allocate space for character array<br />
  System::Alloc 15<br />
  ;get pointer to new space<br />
  Pop $R1<br />
  ;call the CoCreateGuid api in the ole32.dll<br />
  System::Call 'ole32::CoCreateGuid(i R1) i .R2'<br />
  ;if 0 then continue<br />
  IntCmp $R2 0 0 lbl_done<br />
  ;set counter to 0<br />
  StrCpy $R3 0<br />
  lbl_loop:<br />
    ;increment counter<br />
    IntOp $R3 $R3 + 1<br />
    ;if less than 16 then continue<br />
    IntCmp $R3 16 lbl_done 0 lbl_done<br />
    ;retrieve item in character array<br />
    System::Call &quot;*$R1(&amp;t$R3-1, &amp;i1 .R2)&quot;<br />
    ;convert to hex<br />
    IntFmt $R4 &quot;%X&quot; $R2<br />
    StrCpy $R4 &quot;00$R4&quot; <br />
    StrLen $R2 $R4<br />
    IntOp $R2 $R2 - 2<br />
    StrCpy $R4 $R4 2 $R2<br />
    StrCpy $R0 &quot;$R0$R4&quot;<br />
    Goto lbl_loop<br />
  lbl_done:<br />
  ;cleanup<br />
  System::Free $R1<br />
  ;format guid<br />
  StrCpy $R1 $R0<br />
  StrCpy $R0 &quot;&quot;<br />
  StrCpy $R2 $R1 8<br />
  StrCpy $R0 &quot;$R0$R2-&quot;<br />
  StrCpy $R2 $R1 4 8<br />
  StrCpy $R0 &quot;$R0$R2-&quot;<br />
  StrCpy $R2 $R1 4 12<br />
  StrCpy $R0 &quot;$R0$R2-&quot;<br />
  StrCpy $R2 $R1 4 16<br />
  StrCpy $R0 &quot;$R0$R2-&quot;<br />
  StrCpy $R2 $R1 12 20<br />
  StrCpy $R0 &quot;$R0$R2&quot;<br />
  Pop $R4<br />
  Pop $R3<br />
  Pop $R2<br />
  Pop $R1<br />
  Exch $R0<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th August 2003, 20:51</div></div><div class="posttext">Works great!<br />
Could you post it on the NSIS Archive (http://nsis.sourceforge.net/archive) for others.<br />
<br />
Thanks<br />
<br />
-Stu :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">13th August 2003, 21:10</div></div><div class="posttext">He already did.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">14th August 2003, 00:12</div></div><div class="posttext">You actually need 16 bytes to be allocated for GUID (128 bit) (I meaning your system::alloc). The alternative way completely thru ole and kernel functions (string guid at $3):<br />
     System::Alloc 16<br />
     Pop $1<br />
     System::Alloc 80<br />
     Pop $2<br />
     System::Call 'ole32::CoCreateGuid(i r1) i'<br />
     System::Call 'ole32::StringFromGUID2(i r1, i r2, i 80) i'<br />
     System::Call 'kernel32::WideCharToMultiByte(i 0, i 0, i r2, i 80, t .r3, i ${NSIS_MAX_STRLEN}, i 0, i 0) i'<br />
     System::Free $1<br />
     System::Free $2</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">14th August 2003, 00:15</div></div><div class="posttext">Oh :) A bit better look :)<br />
<br />
System::Alloc 80 <br />
System::Alloc 16 <br />
System::Call 'ole32::CoCreateGuid(i sr1) i' <br />
System::Call 'ole32::StringFromGUID2(i r1, i sr2, i 80) i' <br />
System::Call 'kernel32::WideCharToMultiByte(i 0, i 0, i r2, i 80, t .r3, i ${NSIS_MAX_STRLEN}, i 0, i 0) i' <br />
System::Free $1 <br />
System::Free $2</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">14th August 2003, 14:20</div></div><div class="posttext">Thanks for the help brainsucker. I actually was going to use the stringfromguid2 api but I was under the impression that it wasn't support under Win9x. I've updated the archive entree with your better version. Thanks again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mrtech</div><div class="date">17th August 2003, 21:12</div></div><div class="posttext">So will this function work with Win 9x machines?  Does the archive need to be updated? :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">17th August 2003, 22:51</div></div><div class="posttext">I've tested it on 98, ME, NT, 2K and XP without any problems. I have already updated the archive with the new code.<br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">18th August 2003, 00:47</div></div><div class="posttext">:up: good code dselkirk :up: :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">18th August 2003, 13:54</div></div><div class="posttext">the new code is thanks to brainsucker. thanks anyway.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mrtech</div><div class="date">21st January 2005, 10:20</div></div><div class="posttext">I had the same question with regard to 9x support, basically from microsoft site stringfromguid2 does seem to be supported but it's WideCharToMultiByte that might not be fully supported with Windows 95 unless you have the  Microsoft Layer for Unicode (http://msdn.microsoft.com/library/en-us/mslu/winprog/microsoft_layer_for_unicode_on_windows_95_98_me_systems.asp) software installed.  Just thought I would post this in case someone else looks this up. <br />
<br />
My question is, how safe is it to switch and not block out users that might not have this installed?<br />
<br />
StringFromGUID2:<br />
http://msdn.microsoft.com/library/default.asp?url=/library/en-us/com/htm/cmf_m2z_2jzm.asp<br />
<br />
WideCharToMultiByte:<br />
http://msdn.microsoft.com/library/default.asp?url=/library/en-us/intl/unicode_2bj9.asp</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st January 2005, 11:41</div></div><div class="posttext">It's not fully supported, but the support it does give is sufficient. The translated text is plain US-ASCII, only English letters and numbers. There shouldn't be any problem using unicows.dll, but there is no reason to.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>