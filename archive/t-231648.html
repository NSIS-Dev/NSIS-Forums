<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" [POSIX] [CVS] test failure - double free, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  [POSIX] [CVS] test failure - double free NSIS Discussion" />
	
	<title> [POSIX] [CVS] test failure - double free [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  [POSIX] [CVS] test failure - double free</div>
<hr />
<div class="pda"><a href="t-231648.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=231648">[POSIX] [CVS] test failure - double free</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">pabs</div><div class="date">22nd November 2005, 08:53</div></div><div class="posttext">I got the following failure with today's CVS. I'm not sure, but the test code is so simple that this makes me think this is a cppunit bug. Any ideas?$ gdb build/release/tests/test<br />
GNU gdb 6.3.90_20051119-debian<br />
Copyright 2004 Free Software Foundation, Inc.<br />
GDB is free software, covered by the GNU General Public License, and you are<br />
welcome to change it and/or distribute copies of it under certain conditions.<br />
Type &quot;show copying&quot; to see the conditions.<br />
There is absolutely no warranty for GDB.  Type &quot;show warranty&quot; for details.<br />
This GDB was configured as &quot;i486-linux-gnu&quot;...Using host libthread_db library &quot;/lib/tls/libthread_db.so.1&quot;.<br />
<br />
(gdb) run<br />
Starting program: /home/pabs/devel/debian/misc/nsis/NSIS/build/release/tests/test<br />
*** glibc detected *** free(): invalid pointer: 0x08059388 ***<br />
<br />
Program received signal SIGABRT, Aborted.<br />
0xb7cb47a7 in raise () from /lib/tls/libc.so.6<br />
(gdb) bt<br />
#0  0xb7cb47a7 in raise () from /lib/tls/libc.so.6<br />
#1  0xb7cb604b in abort () from /lib/tls/libc.so.6<br />
#2  0xb7ceb005 in __fsetlocking () from /lib/tls/libc.so.6<br />
#3  0xb7cf1657 in malloc_usable_size () from /lib/tls/libc.so.6<br />
#4  0xb7cf1af2 in free () from /lib/tls/libc.so.6<br />
#5  0xb7e9e7c1 in operator delete () from /usr/lib/libstdc++.so.6<br />
#6  0x0804bfe3 in __gnu_cxx::new_allocator&lt;std::string*&gt;::deallocate (this=0xbfb60607, __p=0x8059388) at new_allocator.h:94<br />
#7  0x0804c124 in std::_Deque_base&lt;std::string, std::allocator&lt;std::string&gt; &gt;::_M_deallocate_map (this=0xbfb60684, __p=0x8059388, __n=8) at stl_deque.h:411<br />
#8  0x0804c17e in ~_Deque_base (this=0xbfb60684) at stl_deque.h:430<br />
#9  0xb7f03ec3 in CppUnit::TestPath::TestPath () from /usr/lib/libcppunit-1.10.so.2<br />
#10 0xb7efb433 in CppUnit::Test::resolveTestPath () from /usr/lib/libcppunit-1.10.so.2<br />
#11 0xb7f0fe5c in CppUnit::TestRunner::run () from /usr/lib/libcppunit-1.10.so.2<br />
#12 0xb7f1511b in CppUnit::TextTestRunner::run () from /usr/lib/libcppunit-1.10.so.2<br />
#13 0x0805069b in main (argc=1, argv=0xbfb608f4) at Source/Tests/textrunner.cpp:18I got this with vanilla CVS and with the POSIX install patch (new version soon).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd November 2005, 19:46</div></div><div class="posttext">All of the stack entries are outside of the tests code. Did it even reach some of test code?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pabs</div><div class="date">23rd November 2005, 08:44</div></div><div class="posttext">Correct, the tests are not being called. I wonder if this is a toolchain issue perhaps - symbol naming change or something. Any suggestions for tracking down why the tests are not called?<br />
<br />
Edit: it probably has something to do with this: http://bugs.debian.org/339158 (libstdc++ allocator change). There is a new version available for that, so I'll wait until that is available and try again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pabs</div><div class="date">23rd November 2005, 10:01</div></div><div class="posttext">On another related issue, the endian test fails on m68k:/build/buildd/nsis-2.11/build/release/tests/test<br />
..F..<br />
<br />
endian.cpp:31:Assertion<br />
Test name: EndianTest::testFixEndian<br />
equality assertion failed<br />
- Expected: 2018915346 (0x78563412)<br />
- Actual  : 305419896 (0x12345678)<br />
<br />
Failures !!!<br />
Run: 4   Failure total: 1   Failures: 1   Errors: 0<br />
scons: *** [test-code] Error 1Full logs are available here: <br />
http://experimental.debian.net/fetch.php?&amp;pkg=nsis&amp;ver=2.11-1&amp;arch=m68k&amp;stamp=1132413921&amp;file=log&amp;as=raw<br />
<br />
I don't have access to any m68k machines yet, but I might be able to get my sponsor to find the problem, or get access to one later. Looking at the code I don't understand why it fails.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pabs</div><div class="date">24th November 2005, 02:27</div></div><div class="posttext">Explanation of the endianness problem: util.h wasn't detecting the endianness correctly when defining FIX_ENDIAN_INT32_INPLACE. On linux you detect this by including endian.h and testing if BYTE_ORDER == LITTLE_ENDIAN. I'm not sure how portable this is, so there is no proper patch yet. A quick grep reveals a few places test for __BIG_ENDIAN__, most of them are not relevant because they are in code that is compiled using the Win32 cross compiler.<br />
<br />
http://lists.debian.org/debian-68k/2005/11/msg00043.html<br />
http://lists.debian.org/debian-68k/2005/11/msg00045.html<br />
<br />
Ugh, shouldn't have posted that question at 3am :/</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>