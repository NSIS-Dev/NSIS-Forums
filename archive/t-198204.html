<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Previous installation directory, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Previous installation directory NSIS Discussion" />
	
	<title> Previous installation directory [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Previous installation directory</div>
<hr />
<div class="pda"><a href="t-198204.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=198204">Previous installation directory</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">RiteshN</div><div class="date">3rd November 2004, 07:51</div></div><div class="posttext">Hello,<br />
<br />
I have an app called XXX. <br />
<br />
Using NSIS, I have installing it in \Program File\XXX.<br />
<br />
Now we are coming out with two editions of XXX. XXX Enterprise and simple XXX.<br />
<br />
I am creating the installer using NSIS (version I am not sure but if required i can download NSIS 2.02). Now I want to check whether \Program Files\XXX exists or not. If it exists then I would like to install both Enterprise and Basic version in XXX otherwise I would like to install in \Program Files\XXX Enterprise or \Program Files\XXX Basic whichever the case maybe?<br />
<br />
How  can I check whether \XXX exists and how to go about with it?<br />
<br />
Regards,<br />
RiteshN</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">3rd November 2004, 08:57</div></div><div class="posttext">Read NSIS Help description of:<br />
InstallDir<br />
InstallDirRegKey<br />
and use something like this<br />
  WriteRegStr HKCU &quot;${REG_PATH}&quot; &quot;${INST_DIR}&quot; &quot;$INSTDIR&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RiteshN</div><div class="date">3rd November 2004, 12:47</div></div><div class="posttext">Sorry but I am still confised. I read the docs but I am unable to understand how to replace current installation.<br />
<br />
This is a required part from my current nsis script:<br />
<br />
<br />
; HM NIS Edit Wizard helper defines<br />
!define PRODUCT_NAME &quot;XXX&quot;<br />
!define PRODUCT_VERSION &quot;1.0&quot;<br />
!define PRODUCT_PUBLISHER &quot;Me&quot;<br />
!define PRODUCT_WEB_SITE &quot;http://www.me.com&quot;<br />
!define PRODUCT_DIR_REGKEY &quot;Software\Microsoft\Windows\CurrentVersion\App Paths\xxx.exe&quot;<br />
!define PRODUCT_UNINST_KEY &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot;<br />
!define PRODUCT_UNINST_ROOT_KEY &quot;HKLM&quot;<br />
<br />
Name &quot;${PRODUCT_NAME} ${PRODUCT_VERSION}&quot;<br />
OutFile &quot;G:\\output\\xxx.exe&quot;<br />
InstallDir &quot;$PROGRAMFILES\${PRODUCT_NAME}&quot;<br />
InstallDirRegKey HKLM &quot;${PRODUCT_DIR_REGKEY}&quot; &quot;&quot;<br />
ShowInstDetails show<br />
ShowUnInstDetails show<br />
 <br />
<br />
as I see in my new scripty I will have something like the following:<br />
<br />
<br />
; HM NIS Edit Wizard helper defines<br />
!define PRODUCT_NAME &quot;XXX Enterprise&quot;<br />
!define PRODUCT_VERSION &quot;2.0&quot;<br />
!define PRODUCT_PUBLISHER &quot;Me&quot;<br />
!define PRODUCT_WEB_SITE &quot;http://www.me.com&quot;<br />
!define PRODUCT_DIR_REGKEY &quot;Software\Microsoft\Windows\CurrentVersion\App Paths\xxxent.exe&quot;<br />
!define PRODUCT_UNINST_KEY &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot;<br />
!define PRODUCT_UNINST_ROOT_KEY &quot;HKLM&quot;<br />
<br />
Name &quot;${PRODUCT_NAME} ${PRODUCT_VERSION}&quot;<br />
OutFile &quot;G:\\output\\xxxent.exe&quot;<br />
InstallDir &quot;$PROGRAMFILES\${PRODUCT_NAME}&quot;<br />
InstallDirRegKey HKLM &quot;${PRODUCT_DIR_REGKEY}&quot; &quot;&quot;<br />
ShowInstDetails show<br />
ShowUnInstDetails show<br />
 <br />
<br />
But I am unable to understand where to check whether XXX is already installed then use the current installation directory otherwise use &quot;$PROGRAMFILES\${PRODUCT_NAME}&quot; i.e. XXX Enterprise or XXX Basic.<br />
<br />
A sample script will be very helpful.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">3rd November 2004, 13:25</div></div><div class="posttext">1. Use correct registry paths with slashes<br />
!define PRODUCT_DIR_REGKEY &quot;Software\Microsoft\Windows\CurrentVersion\App Pathsxxx.exe&quot; <br />
The same for uninst key.<br />
<br />
2. Try to read this value from registry at the beginnig of installation. If this is first installation you will get error. For example<br />
ReadRegStr $0 HKLM &quot;${PRODUCT_DIR_REGKEY}&quot; &quot;&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RiteshN</div><div class="date">3rd November 2004, 13:41</div></div><div class="posttext">1. Use correct registry paths with slashes<br />
!define PRODUCT_DIR_REGKEY &quot;Software\Microsoft\Windows\CurrentVersion\App Pathsxxx.exe&quot; <br />
The same for uninst key. <br />
<br />
I am using slashes but when I pasted it as code out here, the board didnt like it :)<br />
<br />
<br />
Try to read this value from registry at the beginnig of installation. If this is first installation you will get error. For example<br />
ReadRegStr $0 HKLM &quot;${PRODUCT_DIR_REGKEY}&quot; &quot;&quot;<br />
 <br />
<br />
OK. understood a little. But how do I handle the error and proceed?<br />
<br />
Thanks for your patience.<br />
<br />
Regards,<br />
Karam</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd November 2004, 13:59</div></div><div class="posttext">MessageBox, Abort.<br />
<br />
Use [code] not [php]<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RiteshN</div><div class="date">3rd November 2004, 14:09</div></div><div class="posttext">I will try to make myself more clear.<br />
<br />
In my previous script i had:<br />
<br />
<br />
!define PRODUCT_NAME &quot;XXX&quot;<br />
!define PRODUCT_VERSION &quot;1.0&quot;<br />
PRODUCT_DIR_REGKEY &quot;Software\Microsoft\Windows\CurrentVersion\App Paths\XXX.exe&quot;<br />
!define PRODUCT_DIR_REGKEYENT &quot;Software\Microsoft\Windows\CurrentVersion\App Paths\XXX.exe&quot;<br />
!define PRODUCT_UNINST_KEY &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot;<br />
!define PRODUCT_UNINST_ROOT_KEY &quot;HKLM&quot;<br />
<br />
Name &quot;${PRODUCT_NAME} ${PRODUCT_VERSION}&quot;<br />
OutFile &quot;G:\output\xxx.exe&quot;<br />
InstallDir &quot;$PROGRAMFILES\${PRODUCT_NAME}&quot;<br />
InstallDirRegKey HKLM &quot;${PRODUCT_DIR_REGKEY}&quot; &quot;&quot;<br />
ShowInstDetails show<br />
ShowUnInstDetails show<br />
 <br />
<br />
This means by default it will install XXX in \\Program Files\\XXX folder or if the user changes it while installation. In the registry, the uninstallation folder is also kept as \\Program Files\\XXX. I have been creating upgrades to my app in the same way. Therefore if a user upgraded then NSIS automatically detected the previous installation. I think it was due to the fact that my product name was always XXX till now.<br />
<br />
Now I am having two editions: XXX and XXX Enterprise. As I see, I wont have any problems with XXX as it will recoginise the previous installation.<br />
<br />
I am having difficulty with XXX Enterprise. If I put the PRODUCT_NAME as XXX Enterprise, it is doing a complete new installation even if XXX is installed before i.e. \\Program Files\\XXX Enterprise coz it is not matching with XXX.  <br />
<br />
Also, the binary name has changed from XXX to XXXEnt.exe so the shortcut in the program menu also needs to be changed.<br />
<br />
Hope this sheds more light on the matter.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RiteshN</div><div class="date">3rd November 2004, 14:10</div></div><div class="posttext">Originally posted by Afrow UK <br />
MessageBox, Abort.<br />
<br />
Use [code] not [php]<br />
<br />
-Stu  <br />
<br />
I dont want to abort. Gives wrong impression to the user :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd November 2004, 14:30</div></div><div class="posttext">Function .onInit<br />
 Push $R0<br />
<br />
 ReadRegStr $R0 &quot;Software\Microsoft\Windows\CurrentVersion\App Paths\XXX.exe&quot; &quot;&quot;<br />
 StrCmp $R0 &quot;&quot; +3<br />
  MessageBox MB_OK &quot;${PRODUCT_NAME} already installed&quot;<br />
   Abort<br />
<br />
 Pop $R0<br />
FunctionEnd<br />
<br />
Is that the general thing you want?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RiteshN</div><div class="date">3rd November 2004, 15:22</div></div><div class="posttext">No.<br />
<br />
What I want is that if XXX is installed then XXX Enterprise also gets installed in same directory as XXX otherwise, it should do a new installation as XXX Enterprise.<br />
<br />
Therefore, I have to basically change the installation directory during the installation process :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd November 2004, 15:55</div></div><div class="posttext">That is already the default behavour.<br />
If no registry value is found for InstallDirRegKey then the InstallDir value is used instead.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RiteshN</div><div class="date">3rd November 2004, 16:57</div></div><div class="posttext">I am aware of this feature and it works great for me.<br />
<br />
My problem is that with XXX Enterprise, my product name is XXX Enterprise and it being first release will never be present in anybodys computer. It will always create a new one. What I want is that if it finds XXX (which was being used till date) then it should install in XXX folder rather XXX Enterprise as it will happen normally.<br />
<br />
I guess - I am not able to make myself clear.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd November 2004, 17:44</div></div><div class="posttext">So why doesn't this work?<br />
<br />
InstallDirRegKey HKCU &quot;Software\Microsoft\Windows\CurrentVersion\App Paths\XXX.exe&quot; &quot;&quot;<br />
InstallDir &quot;C:\Program Files\XXX Enterprise&quot;<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RiteshN</div><div class="date">4th November 2004, 08:43</div></div><div class="posttext">Nope. It dosnt work.<br />
<br />
Here is a sample of my nsi:<br />
<br />
<br />
!define PRODUCT_NAME &quot;XXX Enterprise&quot;<br />
!define PRODUCT_VERSION &quot;4.0 RC 1&quot;<br />
!define PRODUCT_PUBLISHER &quot;MyCompany&quot;<br />
!define PRODUCT_WEB_SITE &quot;http://www.me.com&quot;<br />
!define PRODUCT_DIR_REGKEY &quot;Software\Microsoft\Windows\CurrentVersion\App Paths\XXXEnt.exe&quot;<br />
!define PRODUCT_UNINST_KEY &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot;<br />
!define PRODUCT_UNINST_ROOT_KEY &quot;HKLM&quot;<br />
<br />
...<br />
...<br />
<br />
InstallDir &quot;$PROGRAMFILES\${PRODUCT_NAME}&quot;<br />
InstallDirRegKey HKCU &quot;Software\Microsoft\Windows\CurrentVersion\App Paths\XXX.exe&quot; &quot;&quot;<br />
 <br />
<br />
In this case even if my previous version of XXX was installed, by the default the installation directory is always shown to be XXX Enterprise. I want to keep it XXX if XXX is installed.<br />
<br />
BTW, the following code:<br />
<br />
<br />
CreateShortCut &quot;$SMPROGRAMS\${PRODUCT_NAME}\XXXEnt.lnk&quot; &quot;$INSTDIR\XXXEnt.exe&quot;<br />
 <br />
<br />
is also not creating creating a menu under All Programs. Am I doing something wrong as it was previously working?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>