<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Installation Error on Windows 95, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Installation Error on Windows 95 NSIS Discussion" />
	
	<title> Installation Error on Windows 95 [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Installation Error on Windows 95</div>
<hr />
<div class="pda"><a href="t-145473.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=145473">Installation Error on Windows 95</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">11th August 2003, 23:19</div></div><div class="posttext">I have installed my software using NSIS on Windows ME and Windows 2000 without problem. However, I just tried to install it on Windows 95 and the installer crashes when it attempts to do the following line of code (I think):<br />
CreateShortCut &quot;$DESKTOP\${MUI_PRODUCT}.lnk&quot; &quot;$INSTDIR\${MUI_FILE}&quot; \<br />
&quot;&quot; &quot;$INSTDIR\${MUI_FILE}&quot; 0<br />
<br />
I'm not sure even where to begin on this. The only thing I can think of is that the Windows 95 laptop that I'm installing on is not Win32...is that possible (The laptop is extremely old)? If so, how can I check to see if that is the case? Or, does this even matter? Any advice or pointers would be much appreciated!!!!<br />
<br />
Edit:<br />
I looked under System Properties, and it says the File System is 32-bit...does that mean it's Win32?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">11th August 2003, 23:26</div></div><div class="posttext">By the way, in case anyone wanted to see the actual installation dump...<br />
<br />
H2HINSTALL21B caused an invalid page fault in<br />
module &lt;unknown&gt; at 0000:70bdc4e3.<br />
Registers:<br />
EAX=007baa10 CS=0157 EIP=70bdc4e3 EFLGS=00010246<br />
EBX=0040a530 SS=015f ESP=0100ef84 EBP=0100f5cc<br />
ECX=00409d30 DS=015f ESI=007ba9ac FS=1187<br />
EDX=00000000 ES=015f EDI=007ba9ac GS=10c6<br />
Bytes at CS:EIP:<br />
<br />
Stack dump:<br />
70936e4b 007baa10 a0000001 00409d30 7095164e 007ba9ac a0000001 00000001 00409d30 0040a530 0100f148 00000409 bff9d8f3 0100f118 bfc044ca 0100eff7 <br />
<br />
Thanks for anyone's help!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">11th August 2003, 23:26</div></div><div class="posttext">Win32 means: all 32-bit Windows platforms (Windows 95, 98, ME, NT4, 2000, XP, 2003). I recently tested my NSIS installer on Windows 95 (including CreateShortcut) and had no problems.<br />
<br />
So it should work on Windows 95. Which version of NSIS are you using? Did you recompile?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">11th August 2003, 23:33</div></div><div class="posttext">I'm using NSIS Version 2.0 Beta 4. What do you mean...&quot;recompile&quot;? Do you mean recompile my installation script? If so, the answer is &quot;yes&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">11th August 2003, 23:47</div></div><div class="posttext">Can I supply someone with a link to download my software and try to install it on Windows 95? I'm just wondering if it's my laptop/version of Windows 95, or if it's a problem for others as well. I could try to dumb up the installer so as to only attempt the &quot;Problem&quot; area. Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th August 2003, 23:52</div></div><div class="posttext">What Joost meant to ask is if you have recompiled NSIS itself.<br />
<br />
According to the crash message the problem is outside of NSIS code in an unknown module. It's probably a DLL you're trying to register. Try focusing the &quot;dumber&quot; installer on [un]RegDLL instructions if it's not CreateShortcut.<br />
<br />
It would be useful for testing if you can generate a ZIP file with a stripped example script (with the DLL in question if it is the cause) that causes the crash.<br />
<br />
If your Windows 95 version isn't 32-bit NSIS shouldn't have even started.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">12th August 2003, 00:13</div></div><div class="posttext">I updated my NSIS via the &quot;NSIS Update&quot; option (via CVS - clean copy). Is there something I need to do with &quot;recompiling&quot; NSIS??<br />
<br />
I am registering some DLLs, but all my DLLs (VB related) are working fine. I will look into that, however.<br />
<br />
Thanks for the help...any other advice would be very helpful!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">12th August 2003, 01:31</div></div><div class="posttext">I've narrowed my problem down to the following bit of code (Thanks kichik for pointing me in the right direction):<br />
<br />
!insertmacro UpgradeDLL &quot;${MY_SYSDIR}SHLWAPI.DLL&quot; &quot;$SYSDIR\SHLWAPI.DLL&quot;<br />
Push $SYSDIR\SHLWAPI.DLL<br />
Call AddSharedDLL<br />
<br />
<br />
I'm going to look into it a little closer, but does anyone see anything wrong with this????<br />
<br />
By the way, it was recommended at one time (by kichik, I believe) to check to make sure that the installing computer has IE 4.0 or greater installed on it (SHLWAPI.DLL is installed with IE 4.0 or greater)...and tell the installing person that the computer must have IE4 in order to install my software. However, I kept the above code active because I didn't want my software to rely on IE4 being installed. The Win95 laptop has IE5.5...but the above lines of code fail!?!?!? If I choose to do the &quot;make sure you have IE 4 or greater&quot; way, do I still need to add a shared value to this dll??? How would my above code change? Can I skip this code entirely if they have IE4 or greater installed? When I uninstall my software, do I remove a shared value on this DLL?<br />
<br />
As you can see, I have a lot of questions regarding this. Thanks for everyone's help on this!!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dajvid</div><div class="date">12th August 2003, 04:16</div></div><div class="posttext">Although I am far from an expert on system files, you may want to check as to whether you need separate versions of SHLWAPI.DLL depending on what version of Windows your installer is running on.<br />
<br />
When installing applications such as Internet Explorer or Microsoft Office (both of which include system file updates), the Microsoft installers install different system files depending on your version of Windows. You may need to also do the same thing with SHLWAPI.DLL.<br />
<br />
The first thing you need to find out is whether different versions of SHLWAPI.DLL is installed to different versions of Windows. If so, you'll need to package all of the different versions of SHLWAPI.DLL and only extract the appropriate version depending on the version of Windows your installer is running on.<br />
<br />
Ta,<br />
Dave.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th August 2003, 13:01</div></div><div class="posttext">Jcagle, my advice (http://forums.winamp.com/showthread.php?s=&amp;threadid=143829&amp;highlight=shlwapi.dll) was to check for SHLWAPI.dll and if not present require the user to install IE 4 and above. It's far more simpler than checking for the version of Windows and the version of Internet Explorer. By checking the versions you're also assuming you know which versions of Internet Explorer provide SHLWAPI.dll, and you can't be sure of that.<br />
<br />
As dajvid said, the Microsoft installer can install different versions of the file for different systems or configurations. It can be Unicode enabled for Windows NT and MBCS for Windows 9x, it could install a certain version for XP that uses new features that are just in XP, etc. If Microsoft didn't supply a redistributable and didn't say it's possible to redistribute the DLL on your own you should probably shouldn't.<br />
<br />
In conclusion, the code I'd suggest is:<br />
<br />
Function .onInit<br />
  IfFileExists $SYSDIR\SHLWAPI.DLL +3<br />
    MessageBox MB_OK|MB_ICONSTOP &quot;Required DLL missing, please \<br />
      install Internet Explorer 4.0 or above. Bye.&quot;<br />
    Abort<br />
FunctionEnd<br />
<br />
If there are some functions that your program imports from SHLWAPI.dll that are not in all versions of it you should check for its version too and tell the user what to install according to Microsoft supplied information.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>