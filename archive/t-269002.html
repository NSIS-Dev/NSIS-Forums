<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" changed command line behaviour for makensisw in v.2.25?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  changed command line behaviour for makensisw in v.2.25? NSIS Discussion" />
	
	<title> changed command line behaviour for makensisw in v.2.25? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  changed command line behaviour for makensisw in v.2.25?</div>
<hr />
<div class="pda"><a href="t-269002.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=269002">changed command line behaviour for makensisw in v.2.25?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">flizebogen</div><div class="date">5th April 2007, 12:35</div></div><div class="posttext">Hi,<br />
<br />
i compile my scripts by batch file. I use the following code:<br />
<br />
start ..\..\NSISCompiler\makensisw.exe /DSOME_DEFINE scriptfile.nsi <br />
<br />
Unfortunately the doesn't work anymore in 2.25. It seems to me that makensisw treats every parameter as a filename as therefor fails to open /DSOME_DEFINE.<br />
<br />
Can anyone confirm?<br />
<br />
Regards<br />
<br />
Flizebogen</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th April 2007, 12:42</div></div><div class="posttext">Try:<br />
start &quot;..\..\NSISCompiler\makensisw.exe&quot; &quot;/DSOME_DEFINE scriptfile.nsi&quot;<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">flizebogen</div><div class="date">5th April 2007, 13:10</div></div><div class="posttext">No that gives only a different error message. This time provided by makensis and not the wrapper</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">5th April 2007, 17:45</div></div><div class="posttext">cmdline behaviour hasnt changed, just tested, works fine for me.<br />
<br />
problem on first post:<br />
the /D switch is interpreted by the &quot;start&quot; command itself, so it won't work. type &quot;start /?&quot; in your cmdline and read :)<br />
<br />
problem on the second post:<br />
afrows solution is right, but you should not call &quot;makensisw.exe&quot; but &quot;makensis.exe&quot;<br />
makensisw is just a GUI wrapper for the makensis cmdline compiler.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">5th April 2007, 23:53</div></div><div class="posttext">when using start and quoted paths on NT, you need to provide a title aswell (very stupid move by MS)<br />
<br />
try: start &quot;&quot; &quot;..\..\NSISCompiler\makensis.exe&quot; /DSOME_DEFINE scriptfile.nsi</div></div><hr />


<div class="post"><div class="posttop"><div class="username">flizebogen</div><div class="date">6th April 2007, 08:18</div></div><div class="posttext">I tested it on a second XP machine and the problem is there too.<br />
<br />
There are various reasons for using makensisw instead of the compiler itself.<br />
<br />
- Log of compilation is cut off in ms-dos box<br />
- possibility to recompile<br />
<br />
I used the start command to immediate close the dos box. <br />
<br />
@anders<br />
<br />
Yes the online help for start says the first parameter should be the title but the command is also executed if the title is missing.<br />
<br />
@ Afrow UK<br />
<br />
If i quote everything than i'm forced to add a title for the &quot;start&quot; command. But this still doesn't work. The error message i get is:<br />
<br />
Command line defined: &quot;SOMEDEFINE scriptname.nsi&quot;<br />
<br />
If i drop the &quot;start&quot; command and call makensisw directly without quoting i get the following message:<br />
<br />
MakeNSIS v2.25 - Copyright 1995-2007 Contributors<br />
See the file COPYING for license details.<br />
Credits can be found in the Users Manual.<br />
<br />
Can't open script &quot;/DSOMEDEFINE&quot;<br />
 <br />
<br />
If i change the call to makensis.exe then it compiles fine regardless of the not set Title for the &quot;start&quot; command. It also compiles fine if i use the makensisw.exe (v.2.2) from nsis 2.24.<br />
<br />
For me this is the prove that makensisw parameter handling is buggy /differs from makensisw.exe v.2.2</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th April 2007, 16:17</div></div><div class="posttext">Command line handling has changed for MakeNSISw v2.3. It passes `--` to escape the script name now that makensis supports both dash and slash as the switch escape code. Please open a bug report for it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">10th April 2007, 12:43</div></div><div class="posttext">&quot;v2.3&quot; ? possibly since v2.23?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">flizebogen</div><div class="date">10th April 2007, 14:11</div></div><div class="posttext">No<br />
<br />
Makensisw.exe v.2.3 is shipped with nsis 2.25<br />
Makensisw.exe v.2.2 is shipped with nsis 2.24</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">10th April 2007, 16:42</div></div><div class="posttext">Ah, sorry plus the &quot;w&quot;, I never see and use, I need to put of my :cool:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">31st August 2007, 12:46</div></div><div class="posttext">strange, I have a similar problem with MakeNSISw (Release 2.30)<br />
<br />
This doesn't work<br />
<br />
start &quot;&quot; &quot;%NSISDIR%\makensisw.exe&quot; /DABCDEFGHIJKLMNOPQ=1 /DABCDEFGHI=2 Update.nsi<br />
<br />
MakeNSIS v2.30 - Copyright 1995-2007 Contributors<br />
See the file COPYING for license details.<br />
Credits can be found in the Users Manual.<br />
<br />
Processing config: <br />
Processing plugin dlls: &quot;C:\Program Files\NSIS\Plugins\*.dll&quot;<br />
... <br />
But this works: (ABCDEFGH instead of ABCDEFGHI)<br />
start &quot;&quot; &quot;%NSISDIR%\makensisw.exe&quot; /DABCDEFGHIJKLMNOPQ=1 /DABCDEFGH=2 Update.nsi<br />
<br />
MakeNSIS v2.30 - Copyright 1995-2007 Contributors<br />
See the file COPYING for license details.<br />
Credits can be found in the Users Manual.<br />
<br />
Command line defined: &quot;ABCDEFGHIJKLMNOPQ=1&quot;<br />
Command line defined: &quot;ABCDEFGH=2&quot;<br />
Processing config: <br />
Processing plugin dlls: &quot;C:\Program Files\NSIS\Plugins\*.dll&quot;<br />
...<br />
<br />
Seems like a buffer limit to the optional arguments ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">31st August 2007, 15:29</div></div><div class="posttext">This does not happen if I call makensis.exe directly..<br />
Any idea ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st August 2007, 21:43</div></div><div class="posttext">Both scripts work fine for me. I can't reproduce.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">3rd September 2007, 14:41</div></div><div class="posttext">I tracked the bug down to this:<br />
The following WORKS:<br />
<br />
SET Path=C:\123456789<br />
&quot;C:\Program Files\NSIS\makensisw.exe&quot; -D12345678901234567890123456789012345 -DBUG Test.nsi<br />
<br />
The following DOESN'T WORK: (one char LESS in argument)<br />
<br />
SET Path=C:\123456789<br />
&quot;C:\Program Files\NSIS\makensisw.exe&quot; -D1234567890123456789012345678901234 -DBUG Test.nsi<br />
<br />
<br />
So just having a char LESS as parameter make it work !<br />
<br />
(The link with &quot;start&quot; was that &quot;start&quot; seems to add an additionnal space on the command-line before the first argument)<br />
<br />
There seems to be something also with the PATH variable length because if you SET Path=C:\12345678 it seems to work<br />
<br />
In my opinion there must be a problem in MakeNSISw argument parser</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">3rd September 2007, 14:44</div></div><div class="posttext">as it seems to be dependent on the PATH variable length and the argument length, I'm guessing a buffer overflow bug, with a '\0' a bit too far that erase the parsed defines (-D)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th September 2007, 03:30</div></div><div class="posttext">Both still work for me.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">4th September 2007, 13:23</div></div><div class="posttext">What can I do to track the bug further and provide more information ?<br />
I don't see what could be wrong in my machine configuration that is causing this, but it is really annoying</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th September 2007, 00:43</div></div><div class="posttext">Create a better model for the issue. Does it happen with makensis.exe? If environment variables seem to affect, clear them all and add some until it happens. Delete all files but makensis.exe and makensisw.exe and the stubs and see if it depends on other files. Etc...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">13th September 2007, 13:50</div></div><div class="posttext">I was able to reproduce the problem while debugging MakeNSISw inside Visual Studio, and tracking down the problem through assembly-code... !<br />
<br />
So from what I can see, when passing 2 arguments like this:<br />
SET Path=C:\123456789<br />
&quot;C:\Program Files\NSIS\makensisw.exe&quot; -D1234567890123456789012345678901234 -DBUG Test.nsi<br />
the second time GlobalReAlloc is called (inside AddScriptCmdArgs), it fails (returns 0) with ERROR_NOT_ENOUGH_MEMORY<br />
<br />
I have no idea why reallocating to 30 bytes fails however... probably the global heap is not correctly initialized</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">13th September 2007, 15:02</div></div><div class="posttext">found the problem in MakeNSISw !<br />
<br />
char *args = (char *) GlobalLock(g_sdata.script_cmd_args);<br />
...<br />
GlobalUnlock(args);<br />
<br />
<br />
it should be<br />
char *args = (char *) GlobalLock(g_sdata.script_cmd_args);<br />
...<br />
GlobalUnlock(g_sdata.script_cmd_args);<br />
<br />
<br />
otherwise the HGLOBAL is not correctly unlocked and the memory block can only be reallocated in-place (which sometimes is not possible =&gt; ERROR_NOT_ENOUGH_MEMORY)<br />
<br />
can you fix this ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th September 2007, 18:39</div></div><div class="posttext">Please submit the details as a bug report, or even a patch if you have one and I'll look thoroughly into it tomorrow.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">17th September 2007, 09:17</div></div><div class="posttext">done<br />
http://sourceforge.net/tracker/index.php?func=detail&amp;aid=1796053&amp;group_id=22049&amp;atid=373085</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">17th September 2007, 14:52</div></div><div class="posttext">Yes, I remember seeing this bug while going through my changes.  The bug is in utils.cpp in Contrib/Makensisw, in the function CompileNSISScript().  The GlobalAlloc size does not account for the &quot; -- &quot; in the command line.  My source code changes for Unicode support fixes this problem both in the ANSI and Unicode version.<br />
<br />
http://www.scratchpaper.com/nsis-05-Sep-2007.csv-setup.exe (ANSI)<br />
http://www.scratchpaper.com/nsis-05-Sep-2007.cvs-unicode-setup.exe (Unicode)<br />
<br />
Please look at the thread on &quot;Unicode&quot; for more information about these builds.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">17th September 2007, 15:14</div></div><div class="posttext">note that jimpark points out a bug different than mine, but also linked to command-line parameters.<br />
(mine is in function AddScriptCmdArgs)<br />
<br />
jimpark you should add the description for your bug to my bug report or create a new bug report, for tracking purpose</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>