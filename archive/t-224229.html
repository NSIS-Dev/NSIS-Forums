<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Port Testing, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Port Testing NSIS Discussion" />
	
	<title> Port Testing [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Port Testing</div>
<hr />
<div class="pda"><a href="t-224229.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=224229">Port Testing</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jlee</div><div class="date">18th August 2005, 22:48</div></div><div class="posttext">I have succesfully made an installer, but it lacks robustness.  Now I would like to test to see if ports are in use, and change the default config ports of the program I am installing if they are in use.  Does anyone know of a way of testing if ports such as 3306, or 80 are being used by the &quot;localhost&quot; ( the installer is geared for a a windows machine), with NSIS?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th August 2005, 10:44</div></div><div class="posttext">grahama was trying to do a similar thing in this topic:<br />
http://forums.winamp.com/showthread.php?threadid=221461<br />
Except there's no plugin to do this kind of thing. I'm not sure if grahama made the plugin either.<br />
<br />
Are there any DOS tools you can use?<br />
Try searching Google.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kike_velez</div><div class="date">22nd August 2005, 09:01</div></div><div class="posttext">Maybe this thread can be useful for you :<br />
<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=215817&amp;highlight=socket<br />
<br />
Best Regards.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grahama</div><div class="date">22nd August 2005, 16:35</div></div><div class="posttext">I am using tcpvcon to test for port communication...but have since moved on to more pressing issues...<br />
/<br />
tcpvcon is a pretty small command line tool NSIS can extract and control in the background. I settled on tcpvcon because it can get the process and specific port communication. You will have to include it in your NSIS exe as it does not come with Windows like netstat. Netstat can not get the process number, btw. I'd be very happy if someone proved me wrong.<br />
/<br />
Here is the command I used called every 1/2 second or so from NSIS:<br />
tcpvcon -anc 828 | find /c  &quot;8181&quot;<br />
/<br />
'828' is the process number of your app which NSIS can find for you. Then, just do a common [98/2000/XP] windows 'find' for the port and you are done :)<br />
If the returned string is &quot;1&quot;, port 8181 is being used by your process.<br />
/<br />
I wanted to use this to get the url string too [like http://127.0.0.1:8181?cmd=some_cmd], but initial research proved pretty fruitless. Anyone know how to do this ? Please let me know! Wonder if tcpvcon could be converted into a NSIS plugin... Anyway, it works very well for what it is.<br />
/<br />
hope this helps<br />
g</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kike_velez</div><div class="date">24th August 2005, 09:29</div></div><div class="posttext">Sorry Grahama but I don´t understand what do you want. Can you explain a litle more ?<br />
<br />
Best Regards</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th August 2005, 11:09</div></div><div class="posttext">Not sure if this is what you want?<br />
http://cpp.enisoc.com/articles/ip2host/<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grahama</div><div class="date">24th August 2005, 17:07</div></div><div class="posttext">thanks guys :)<br />
;<br />
I want myNSISInstaller and myApp to communicate on the same computer by sending http requests to localhost.  <br />
;<br />
Both myNSISInstaller and myApp are listening for any port communication on 8181. Http requests sent look something like:<br />
http://127.0.0.1:8181?command2NSIS=doSomething<br />
http://127.0.0.1:8181?command2myAPP=doSomething<br />
;<br />
Unfortunately, myApp  can only communicate by sending out http requests. Pretty limiting :( Great for database stuff...bad for inter app communication. I need sockets but am at the mercy of myApp's platform.<br />
;<br />
So, if my app sends out local host port 8181:<br />
http://127.0.0.1:8181?cmd2NSIS=quit<br />
;<br />
I want NSIS to grab the entire url above including the GET request, cmd2NSIS=quit, and then QUIT<br />
;<br />
With tcpvcon controlled with NSIS, I can grab the process,my app, and the port, 8181. Unfortunately, I can not get the GET request. <br />
Does that make more sense?<br />
;<br />
Afrow, as to the ip2host link<br />
I have just started on the C++ road :) Maybe in several weeks, I'll be able to make use out of http://cpp.enisoc.com/articles/ip2host/<br />
thanks<br />
g</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kike_velez</div><div class="date">25th August 2005, 09:21</div></div><div class="posttext">Hello <br />
<br />
@grahama :<br />
<br />
I understand this :<br />
<br />
You have one application made with nsis : myNSISInstaller. That is always listening on port 8181 ( I think that is a server)<br />
<br />
And you have another application myApp  listening on the same port 8181 . This is a server too.<br />
<br />
Maybe I am wrong but I think that you can not have 2 servers listening on the same port.  <br />
<br />
Best Regards</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kike_velez</div><div class="date">25th August 2005, 14:38</div></div><div class="posttext">Hello<br />
<br />
If you want a server here is.<br />
This function is a server that wait until there´s a client conected. After that the server gets the conection string (see example).<br />
<br />
In a section :<br />
<br />
Section &quot;server&quot; serve<br />
<br />
          push &quot;127.0.0.1&quot;<br />
          push &quot;8180&quot;<br />
          Call ServerWithSockets<br />
          Pop $0<br />
          messagebox mb_ok &quot;$0&quot;<br />
         <br />
SectionEnd<br />
<br />
And you can do everything you want with $0.<br />
If you don´t want to stop the server , it must be on a loop in the section.<br />
I Hope this is what you are looking for.<br />
Best Regards</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grahama</div><div class="date">26th August 2005, 01:47</div></div><div class="posttext">thanks for the script :)<br />
unfortunately, it does not give me the url string either :(<br />
On the plus side this could be a great alternative to including tcpvcon in the nsis installer.<br />
;<br />
A clue:<br />
The compiled script DOES output: GET/HTTP/1.1<br />
It DOES NOT output the actual GET request...which is ?cmd=helloworld<br />
;<br />
To recap, myApp is sending out the http request to localhost:<br />
http://127.0.0.1:8181?cmd=helloworld<br />
;<br />
this script you sent detects everything but the actual url string and GET request...<br />
;<br />
the question becomes: How do you grab the GET Request too ?<br />
;<br />
many thanks, kike :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grahama</div><div class="date">26th August 2005, 01:58</div></div><div class="posttext">I am getting:<br />
GET/HTTP/1.1  HOST:127.0.0.1  Range:bytes=0-  Accept:*/*  User-Agent: QuickTime (qtver=6.5.1,os=Windows NT 5.0ServicePack 4)<br />
;<br />
seems a bit like getting php's user environment variables.<br />
so, how do I flag '?cmd=helloworld' too<br />
;<br />
thanks :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grahama</div><div class="date">26th August 2005, 02:09</div></div><div class="posttext">Also,<br />
if I use myApp to send a http request to:<br />
http://www.myserver.com/phpScript.php?cmd=helloworld<br />
everything works fine and the GET works as advertised<br />
;<br />
when I switch to localhost, I start having problems<br />
g</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kike_velez</div><div class="date">26th August 2005, 09:14</div></div><div class="posttext">Hello Grahama<br />
<br />
Sorry if the script not run for you.<br />
<br />
To do the test (because i don´t have a app to send https):<br />
<br />
    1º - I start the server<br />
    2º - The server wait for a client<br />
    3º - I use the IE like appp. And I write <br />
       http://127.0.0.1:8180?app2nsis=cmd (or similar)<br />
    4º - The server catch the petition and show (with a msgbox mb_ok ....) The string:<br />
<br />
   GET /?app2nsis=cmd HTTP/1.1 Accept ............<br />
<br />
    5º - The server stop.<br />
<br />
Maybe I am doing something wrong or I don´t understand you (my level of english is not good ;-)).<br />
<br />
Best regards<br />
<br />
Note : do you have a Server Web runing on port 8180 ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grahama</div><div class="date">26th August 2005, 16:42</div></div><div class="posttext">wow :)<br />
it works now :)Was a quirk in the way my app sends out http requests in local host<br />
;<br />
thanks so much....as I have been attacking this problem on and off for serveral weeks now<br />
;<br />
g</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grahama</div><div class="date">26th August 2005, 19:12</div></div><div class="posttext">Here is a question :)<br />
;<br />
Can your socket server work as a PHP alternative for localhost communication? <br />
I could see this working as middleware for SQLite.<br />
;<br />
If I wanted to use your NSIS socket server to send info back to myApp...like PHP does...how would that work ?  Is there some kind of 'echo' equivalent that sends info back to the app that  sent the request ?<br />
;<br />
thanks for all of your help, kike :)<br />
g</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kike_velez</div><div class="date">29th August 2005, 09:38</div></div><div class="posttext">Hello<br />
<br />
Well Grahama you must think that this is a basic,basic,basic server. Maybe you need something better than my basic server ;-)<br />
<br />
Another question is if the server may received/send information. I think that is posible but with some changes.<br />
<br />
I supose that you don´t need an echo server but a server that sends diferent information for diferent information received. I am wrong?<br />
<br />
Best Regards</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grahama</div><div class="date">30th August 2005, 04:22</div></div><div class="posttext">myApp is correctly sending commands to myNSISServer thru your socket :)<br />
I wanted to see if it were possible to have myNSISServer send info back to myAPP... like a php script would do. <br />
In PHP, you can use something like:<br />
if(messageSent2Me){<br />
echo &quot;I'm sending a message back to you&quot;;<br />
}<br />
As far your socket server, what would be the proper way to send info back ? Is this possible within the confines of your basic,basic,basic server ? <br />
You have this function call for Receiving:<br />
System::Call 'ws2_32::recv(i $4,t .R3,i 256,i 0)i .R2'<br />
;<br />
Is there a similar function for SENDING in ws2_32 ?<br />
I saw this from msdn: http://msdn.microsoft.com/library/default.asp?url=/library/en-us/winsock/winsock/send_2.asp<br />
//-----------------------------------------<br />
// If data has been received, echo the received data<br />
// from DataBuf back to the client<br />
if (WSASend(AcceptSocket, &amp;DataBuf, 1, &amp;RecvBytes, Flags, &amp;AcceptOverlapped, NULL) == SOCKET_ERROR)<br />
printf(&quot;WSASend() is busted\n&quot;);<br />
;<br />
C++ is not yet my strong suite...although I am doing my homework on the subject<br />
;<br />
many thanks for all of your help, kike :)<br />
g</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kike_velez</div><div class="date">30th August 2005, 12:07</div></div><div class="posttext">Hello Grahama   :)<br />
<br />
This Basic Server can do:<br />
     Initialize WSA.<br />
     Create a socket.<br />
     Bind the socket.<br />
     Listen on the socket.<br />
     Accept a connection.<br />
     Receive data.<br />
     Send data to the client ----&gt; Call ServerSendDataToClient<br />
     Disconnect.<br />
<br />
I separate with two functions:<br />
<br />
- ServerReceivedAndSend: This function wait for a client conection and call to the ServerSendDataToClient funtion and disconnect .(is like the ServerWithSockets function with the Call to ServerSendDataToClient )<br />
<br />
- ServerSendDataToClient: This function is an example of how you can send data to the client. This function must be modified with your preferences. This is only a basic example.<br />
<br />
The way to call in a section is:<br />
<br />
 Section &quot;server&quot; server<br />
<br />
          push &quot;127.0.0.1&quot;<br />
          push &quot;8180&quot;<br />
          Call ServerReceivedAndSend<br />
         <br />
SectionEnd<br />
Note : no errors treatment¡¡</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>