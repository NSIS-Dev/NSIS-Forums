<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Write true install path to .INI string, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Write true install path to .INI string NSIS Discussion" />
	
	<title> Write true install path to .INI string [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Write true install path to .INI string</div>
<hr />
<div class="pda"><a href="t-254831.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=254831">Write true install path to .INI string</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">TYT</div><div class="date">5th September 2006, 04:32</div></div><div class="posttext">I've searched the fourms here for about two days, hoping someone else would have had my problem, but I guess i'm not using the correct search terms.<br />
<br />
Here's my problem.  I'm using the Modern UI for my installer, and i've set the Install Directory to &quot;$DOCUMENTS\Test Run&quot;.  Since this is a basic setup, easily deleted when they are done with the files, I don't want to create any registry keys since there is no uninstaller.  I've also got the script set up to create an .ini file in the Windows Directory, so when I release an update to the first set, the following sets can simply look to the .ini file and read the install path if it's different than what I set as default.<br />
<br />
The problem.<br />
<br />
in my script I have this...<br />
# Installer attributes<br />
OutFile E:\Temp\Releasing\Test.exe<br />
InstallDir &quot;$DOCUMENTS\Test Run&quot;<br />
<br />
Which works wonderfully.  Then, at the end I have this...<br />
<br />
# Installer functions<br />
Function .onInit<br />
    WriteINIStr &quot;$WINDIR\Test.ini&quot; &quot;Install Path&quot; &quot;Install_Dir&quot; &quot;$INSTDIR&quot;<br />
    InitPluginsDir<br />
FunctionEnd<br />
<br />
Now, when the installer gets to the install directory page, I have the option for the user to choose another path to install the files to.  If they change the path from the default &quot;$DOCUMENTS\Test Run&quot; one, the .ini file still only records the default install directory.  <br />
<br />
I hope i'm explaining myself here, if the user chooses some random install path like &quot;c:\gibberish\another folder\more gibberish&quot; the .ini file will still record &quot;c:\My Documents\Test Run&quot;<br />
<br />
How do I get the .ini file to record the actual install path?  Am I missing some part of the readme included with NSIS?  <br />
<br />
ThanQ in advance for your help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th September 2006, 12:33</div></div><div class="posttext">If you write the install path before the user has changed it, what do you expect? lol<br />
.onInit is executed when the installer is executed, not after the directory page.<br />
You need to write it after the directory page, e.g. in the Leave function.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TYT</div><div class="date">5th September 2006, 13:38</div></div><div class="posttext">lol, yeah, how would I expect the installer to know the new path that the user has changed, even tho it seems to install all the files to the new path and the .ini file doesnt seem to be generated until the files are all installed.  Silly me.<br />
<br />
Nonetheless, I shall check out this leave function you speak of.  Thank you for your reply.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>