<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Mixed-Mode Installation Issue, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Mixed-Mode Installation Issue NSIS Discussion" />
	
	<title> Mixed-Mode Installation Issue [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Mixed-Mode Installation Issue</div>
<hr />
<div class="pda"><a href="t-289578.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=289578">Mixed-Mode Installation Issue</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">rooma</div><div class="date">3rd April 2008, 17:47</div></div><div class="posttext">Hi all,<br />
<br />
I'd want to create an installer that allows mixed-mode installation with the new MultiUser.nsh header but I'm stuck with a problematic scenario:<br />
<br />
(The installer would use HKLM if launched with Admin priviledge, and use HKCU if launched with User priviledge.)<br />
<br />
1. an Admin installs the app to $PROGRAM_FILES\$INSTDIR<br />
=&gt; this creates keys in HKLM<br />
2. a User installs the same app to the same dir<br />
=&gt; this creates keys in HKCU<br />
<br />
Then if either of these two user uninstall the app, it will remove it for the other, and leave keys polluting the reg.<br />
<br />
How could I prevent the second installation to reuse the path used in the 2nd installation ?<br />
<br />
I'm really stuck here, this is a real show stopper for the mixed install mode case...<br />
<br />
Thanks,<br />
Rom.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fabian.rap.more</div><div class="date">8th April 2008, 22:11</div></div><div class="posttext">why dont you check and see if the HKCU keys have been created? if they have then you can remove them</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rooma</div><div class="date">8th April 2008, 22:20</div></div><div class="posttext">Well, yes in case you're an admin you can always check the HKCU.<br />
<br />
However if you're a user you can't check and delete the HKLM, so there's still a problem... unless I'm missing something ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fabian.rap.more</div><div class="date">8th April 2008, 22:24</div></div><div class="posttext">then you will have to run it as an admin............either ask the user to do it manually or use a function. i believe there is a plugin but i may be wrong<br />
<br />
edit:: here is the link<br />
<br />
http://nsis.sourceforge.net/NSIS-RunAs</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rooma</div><div class="date">8th April 2008, 22:31</div></div><div class="posttext">Do you mean restrict the installer to be admin only ?<br />
<br />
That's what I currently do, but I was actually trying to have a multi-user enabled installer that would work in both admin and user cases.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fabian.rap.more</div><div class="date">9th April 2008, 00:21</div></div><div class="posttext">so since the user can't modify anything in HKLM then u r stuck.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Daniel James</div><div class="date">10th April 2008, 23:38</div></div><div class="posttext">Originally posted by rooma <br />
(The installer would use HKLM if launched with Admin priviledge, and use HKCU if launched with User priviledge.)<br />
<br />
1. an Admin installs the app to $PROGRAM_FILES\$INSTDIR<br />
=&gt; this creates keys in HKLM<br />
2. a User installs the same app to the same dir<br />
=&gt; this creates keys in HKCU<br />
<br />
Then if either of these two user uninstall the app, it will remove it for the other, and leave keys polluting the reg.<br />
<br />
How could I prevent the second installation to reuse the path used in the 2nd installation ?<br />
I would imagine that in most cases the Admin will ensure that the user doesn't have write access to to $PROGRAMFILES so he won't be able to install his copy there. The situation can be avoided by the Admin ensuring that the PC is set up securely.<br />
<br />
OK, it's not a perfect world, though. You can't rely on the Admin user knowing what he's doing. ;)<br />
<br />
Two different users from the Administrators (or Power Users) group can, of course, ALWAYS screw the system up by installing to the same directory. There's not much you can do about that!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rooma</div><div class="date">11th April 2008, 07:40</div></div><div class="posttext">OK I'll assume the admin/power users are smart guys and I'll allow the problematic case above.<br />
<br />
The installer can always try to do it's best to uninstall everything in a clean way (if the uninstaller user is an admin): clean the user reg + the machine reg, clean user shortcuts + all shortcuts. <br />
<br />
Thank you all for your replies.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>