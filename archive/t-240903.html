<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" vpatch-&gt;how to generate new files in dest dir, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  vpatch-&gt;how to generate new files in dest dir NSIS Discussion" />
	
	<title> vpatch-&gt;how to generate new files in dest dir [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  vpatch-&gt;how to generate new files in dest dir</div>
<hr />
<div class="pda"><a href="t-240903.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=240903">vpatch-&gt;how to generate new files in dest dir</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">DarkUniverse</div><div class="date">15th March 2006, 08:38</div></div><div class="posttext">Hi@all,<br />
I need a patch that generates new files in the dest dir. Background: I have to patch several files from old to new version and I also have to add some new files. One member of the forum did it in 2005 but did not post the solution. So, how is it possible? I have tried to do it since hours and days and also had a look in this forum and google...<br />
Thanx,<br />
Christian</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th March 2006, 17:21</div></div><div class="posttext">I'd create a macro that first checks if the file exists and only then patches. If it doesn't exist, it'll just extract the newest version.<br />
<br />
If you want to have in a patch file, try creating a patch from an empty file to the file you want.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DarkUniverse</div><div class="date">16th March 2006, 18:30</div></div><div class="posttext">Hi kichik! <br />
Thanx for your suggestion which is pretty cool.<br />
At the moment I only update the files in the dest dir (so there is no need to check if the file exists). Next step is to create the new (empty) files and update them. But this means that I have to know the new files which should be in the dest dir. Since I don't know the name of the new file, I have to create a list and send the list with the patch and a macro to the user and compare the list with the files. Is it possible to get the information solely from the patch file without comparison?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th March 2006, 11:28</div></div><div class="posttext">Don't you have to know the name of the files you want to patch anyway? The VPatch plug-in needs to know the name of the file it should patch. It takes its path as the second argument.<br />
<br />
By the way, I've tested a patch from an empty file to another file and the VPatch plug-in wouldn't apply the patch unless the file already exists. This made me think of a simpler way than checking for the existence of the file. You can simply open the file using append mode. This way, if the file doesn't exist, it'll be created. If it does exist, nothing will happen.FileOpen $0 &quot;$INSTDIR\file&quot; &quot;a&quot;<br />
FileClose $0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DarkUniverse</div><div class="date">19th March 2006, 10:31</div></div><div class="posttext">I only take the files in the destdir. If there is a patch in patchfile, then it will be patched. It will do nothing on the file if there is no patch. Thus, I have patched all files, that exists in the dest dir without problems. But now, the files that I have to create new...<br />
<br />
The procedure should then be something like this:<br />
1. create the patch file with all patches (also the new files)<br />
2. create a list of all patched/new files<br />
3. send the installer along with the list of files and the patch to the user<br />
4. The user starts the intsaller/patch<br />
5. the installer does:<br />
     - patch all existing files<br />
     - compares the list with files in dest dir and creates the new files with: <br />
  FileOpen $0 &quot;$INSTDIR\file&quot; &quot;a&quot;<br />
  FileClose $0<br />
and patch these files.<br />
     - and maybe deletes files not used anymore<br />
6. done :-)<br />
<br />
Does this looks like a good solution?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st March 2006, 18:00</div></div><div class="posttext">But in order to patch the file, you must know the patched file name. The VPatch plug-in requires the output file path. You can not patch without the file name. There's no need for a list in this case. Before you patch the file, check if it exists.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DarkUniverse</div><div class="date">22nd March 2006, 09:08</div></div><div class="posttext">Originally posted by DarkUniverse <br />
I only take the files in the destdir. If there is a patch in patchfile, then it will be patched. It will do nothing on the file if there is no patch. Thus, I have patched all files, that exists in the dest dir without problems. But now, the files that I have to create new...<br />
 <br />
<br />
Ok. I guess you mean this part.<br />
<br />
I generate the patch file as usual: I take the files of a directory recursive and write the patches into the patch file. This is done by the developer.<br />
Result is a patch file which includes all patches of the files.<br />
<br />
I recursive take the files of the client, where I know the basedir. The I use vpatch on every file. If there is one patch available, it will be executed. If not, nothing is done on the file.<br />
<br />
So far, I do not need any list. A list is only used on new or deleted files.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DarkUniverse</div><div class="date">22nd March 2006, 09:13</div></div><div class="posttext">I'll check the solution by implementing it today. Hope it works! :-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DarkUniverse</div><div class="date">22nd March 2006, 10:59</div></div><div class="posttext">Another possibility is to compress the whole dir in a zip or jar file and then doing the patch just on one file. Then, uncompress it on the client. The patch file will be bigger, but this solution is maybe more stable and easier.<br />
<br />
Hm, I am not sure... has someone tried this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DarkUniverse</div><div class="date">22nd March 2006, 12:34</div></div><div class="posttext">Hm, I had a second thought on it. I think that it is not possible, because he MD5/CRC of the copmpressed file on the client(which consists of the whole files in the dest dir) is not the same. Thus, the patch vcan not find the file with the right checksum.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DarkUniverse</div><div class="date">28th March 2006, 12:07</div></div><div class="posttext">I had not much time since I wrote the last messages... but I'm still on this topic.<br />
<br />
Regards,<br />
Christian</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>