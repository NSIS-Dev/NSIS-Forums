<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" 1 Remaining Issue - Need Help, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  1 Remaining Issue - Need Help NSIS Discussion" />
	
	<title> 1 Remaining Issue - Need Help [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  1 Remaining Issue - Need Help</div>
<hr />
<div class="pda"><a href="t-136829.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=136829">1 Remaining Issue - Need Help</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Tolwyn</div><div class="date">27th May 2003, 21:50</div></div><div class="posttext">All files in the package have a target folder location.<br />
($INSTDIR}\blah\blah<br />
<br />
The &quot;administrative&quot; files (shortcuts, uninst.exe, etc.) have a target of:<br />
<br />
${programfiles}\${mui_product}<br />
<br />
All files deploy to the proper locations.<br />
Uninstallation fails, however. No files are removed from:<br />
<br />
($INSTDIR}\blah\blah<br />
<br />
And it says I'm trying to remove &quot;Start Menu\Programs&quot; which I am not.<br />
<br />
Can someone please tell me what I'm doing wrong and how to get this to work?<br />
<br />
According to the logic in the documentation, there is no reason why this should not work; unless the writing of the uninstallation is not &quot;smart enough&quot; to remember where files were placed on the building of the installation exe.<br />
<br />
Sigh. I'm so close.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">27th May 2003, 21:59</div></div><div class="posttext">Why not use:<br />
<br />
RMDir /r &quot;$PROGRAMFILES\${MUI_PRODUCT}&quot;<br />
<br />
And...<br />
Does the Uninstaller remembers the value for:<br />
${MUI_STARTMENUPAGE_VARIABLE}<br />
Doesn't this variable only for runtime during Intallation?<br />
Maybe if you save the ${MUI_STARTMENUPAGE_VARIABLE} in the<br />
registry then the uninstaller recover that value...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Tolwyn</div><div class="date">27th May 2003, 22:08</div></div><div class="posttext">Haven't a clue about runtime.<br />
Seems to me, the uninstaller should be written knowing where the user has chosen to install the files.<br />
<br />
I wouldn't know how to write that value to the registry and call it later.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">27th May 2003, 22:12</div></div><div class="posttext">The StartMenu.nsi example shows you how to store it in the registry (using MUI defines).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Tolwyn</div><div class="date">27th May 2003, 22:16</div></div><div class="posttext">Sorry, Joost.<br />
I don't get how to apply what is in the example script to my script. That to me is one of the biggest problems with NSIS--examples between scripts don't &quot;port&quot; that well to other scripts.<br />
<br />
I'm just not sure how to do it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Tolwyn</div><div class="date">27th May 2003, 22:19</div></div><div class="posttext">Yeah. This just doesn't make sense to me.<br />
None of the files I've deployed are being deleted when the uninstallation section seems to be perfectly legal.<br />
<br />
The Start Menu program group created is not getting deleted.<br />
<br />
The ONLY thing being deleted correctly is the Program Files\${MUI_PRODUCT} folder and its contents.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th May 2003, 13:02</div></div><div class="posttext">Your $INSTDIR defauls to &quot;$PROGRAMFILES\Forgotten Battles&quot; (InstallDir command) but you are writing the uninstaller to &quot;$PROGRAMFILES\${MUI_PRODUCT}&quot; which is &quot;$PROGRAMFILES\7JG77 Skin Pack&quot;. You should always use $INSTDIR. The uninstaller initializes $INSTDIR to the directory it lies in.<br />
<br />
As for the start menu, this is the part of the example you need (notice the .lnk files deletion):<br />
<br />
!insertmacro MUI_STARTMENU_DELETE_BEGIN ${TEMP}<br />
  <br />
    Delete &quot;$SMPROGRAMS\${TEMP}\Modern UI.lnk&quot;<br />
    Delete &quot;$SMPROGRAMS\${TEMP}\Uninstall.lnk&quot;<br />
    RMDir &quot;$SMPROGRAMS\${TEMP}&quot; ;Only if empty, so it won't delete other shortcuts<br />
    <br />
  !insertmacro MUI_STARTMENU_DELETE_END</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Tolwyn</div><div class="date">28th May 2003, 16:19</div></div><div class="posttext">Ok. Thanks, Kichik.<br />
<br />
Will the uninstaller remember or know what to substitute ${TEMP} with? Will it be able to pull the variable from installation MUI_STARTMENUPAGE_VARIABLE ($9) ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th May 2003, 16:22</div></div><div class="posttext">As TEMP is a define, and is a compile time &quot;variable&quot; it will be &quot;remembered&quot; in the uninstaller too. Everytime the compiler sees ${TEMP} it just replaces it with its value, $9 in this case.<br />
<br />
The value inside $9 will not stick to the uninstaller but this line:<br />
!insertmacro MUI_STARTMENU_DELETE_BEGIN ${TEMP}<br />
reads it from the registry for you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Tolwyn</div><div class="date">28th May 2003, 16:33</div></div><div class="posttext">When did it get written TO the registry?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th May 2003, 16:35</div></div><div class="posttext">In the MUI_STARTMENU_WRITE_BEGIN macro.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th May 2003, 16:36</div></div><div class="posttext">Nope, wrong one. It's in the MUI_STARTMENU_WRITE_END macro and only if MUI_STARTMENUPAGE_REGISTRY_ROOT, MUI_STARTMENUPAGE_REGISTRY_KEY and MUI_STARTMENUPAGE_REGISTRY_VALUENAME are defined. Define those and the MUI macros will take care of the writing and reading. You should still delete though.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Tolwyn</div><div class="date">28th May 2003, 16:52</div></div><div class="posttext">Kichik. This has all just made everything worse.<br />
I define one thing, something else breaks. I fix that, and it breaks something else.<br />
<br />
I'm getting the error:<br />
!insertmacro: macro named &quot;MUI_STARTMENU_DELETE_BEGIN&quot; not found!<br />
<br />
Can you look at this and tell me where I've screwed up?<br />
<br />
<br />
!define MUI_STARTMENUPAGE<br />
!define MUI_STARTMENUPAGE_NODISABLE<br />
!define MUI_STARTMENUPAGE_DEFAULTFOLDER &quot;${MUI_PRODUCT}&quot;<br />
!define MUI_STARTMENUPAGE_REGISTRY_ROOT &quot;HKCU&quot;<br />
!define MUI_STARTMENUPAGE_REGISTRY_KEY &quot;Software\${MUI_PRODUCT}&quot;<br />
!define MUI_STARTMENUPAGE_REGISTRY_VALUENAME &quot;$9&quot;<br />
<br />
<br />
I have this before the language macro (which needs to be last)...<br />
<br />
I use $9 because that is the variable that will hold the users' custom Start Menu group if they don't choose default, right??</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Tolwyn</div><div class="date">28th May 2003, 16:54</div></div><div class="posttext">How do I populate the MUI_STARTMENUPAGE_REGISTRY_VALUENAME without redefining the reserved variable $9 ??<br />
<br />
If $9 contains the user's choice for SMPROGRAMS, then how do I populate that choice as a variable in MUI_STARTMENUPAGE_REGISTRY_VALUENAME without redefining the very same variable??</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th May 2003, 17:09</div></div><div class="posttext">Right, that's an addition in the latest CVS version. Use:<br />
<br />
;Remove shortcut<br />
  ReadRegStr ${TEMP} &quot;${MUI_STARTMENUPAGE_REGISTRY_ROOT}&quot; &quot;${MUI_STARTMENUPAGE_REGISTRY_KEY}&quot; &quot;${MUI_STARTMENUPAGE_REGISTRY_VALUENAME}&quot;<br />
  <br />
  StrCmp ${TEMP} &quot;&quot; noshortcuts<br />
  <br />
    Delete &quot;$SMPROGRAMS\${TEMP}\Modern UI.lnk&quot;<br />
    Delete &quot;$SMPROGRAMS\${TEMP}\Uninstall.lnk&quot;<br />
    RMDir &quot;$SMPROGRAMS\${TEMP}&quot; ;Only if empty, so it won't delete other shortcuts<br />
    <br />
  noshortcuts:<br />
<br />
<br />
To remove the shortcuts (taken from the StartMenu.nsi example).<br />
<br />
MUI_STARTMENUPAGE_REGISTRY_VALUENAME is $9. When you define  MUI_STARTMENUPAGE_REGISTRY_VALUENAME as $9 the compiler just replaces every ${MUI_STARTMENUPAGE_REGISTRY_VALUENAME} with $9, that's all, it's not another variable. Its value is set after the start menu page shows.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Tolwyn</div><div class="date">28th May 2003, 17:16</div></div><div class="posttext">No...<br />
MUI_STARTMENUPAGE_VARIABLE is $9.<br />
Not MUI_STARTMENUPAGE_REGISTRY_VALUENAME ??<br />
<br />
What populates MUI_STARTMENUPAGE_REGISTRY_VALUENAME if the user chooses their own custom Registry entry?<br />
<br />
How do I !define this variable without stepping on the toes of the MUI_STARTMENUPAGE_VARIABLE, which is $9 ?<br />
<br />
I have to put SOMETHING in quotes after MUI_STARTMENUPAGE_REGISTRY_VALUENAME. Since I don't want to hardcode anything, I need that variable to write to the registry whatever the user chooses if the user does not choose my suggested default!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Tolwyn</div><div class="date">28th May 2003, 17:24</div></div><div class="posttext">Besides, using your example, I get a new error:<br />
<br />
Usage: ReadRegStr $(user_var: output) rootkey subkey entry<br />
   root_key=(HKCR|HKLM|HKCU|HKU|HKCC|HKDD|HKPD)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th May 2003, 17:25</div></div><div class="posttext">MUI_STARTMENUPAGE_REGISTRY_VALUENAME is the registry value name. It has nothing to do with MUI_STARTMENUPAGE_VARIABLE. It is not the value itself, just the name that identifies the value. You should name it something like &quot;Start Menu Folder&quot;, just like in the example.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th May 2003, 17:26</div></div><div class="posttext">That's because you have not defined TEMP. Either use:<br />
<br />
!define TEMP $R9<br />
<br />
or replace every ${TEMP} with another variable.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Tolwyn</div><div class="date">28th May 2003, 17:34</div></div><div class="posttext">Kichik.<br />
Where do I donate $$ to WinAMP and NSIS?<br />
<br />
My installer now works. I GREATLY appreciate your time in helping me through my frustration and learning curves.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th May 2003, 09:45</div></div><div class="posttext">Thanks, I'll check and let you know :)<br />
<br />
Good luck with your installer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th May 2003, 14:44</div></div><div class="posttext">As Winamp and NSIS are two different projects there is no one place to donate for both. To donate to Winamp you need to donate to Nullsoft (http://www.nullsoft.com/) and as for NSIS, I have sent you a PM with a mailing address.<br />
<br />
Thanks</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>