<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How do I delete a directory after rebooting?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How do I delete a directory after rebooting? NSIS Discussion" />
	
	<title> How do I delete a directory after rebooting? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How do I delete a directory after rebooting?</div>
<hr />
<div class="pda"><a href="t-126436.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=126436">How do I delete a directory after rebooting?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Red Prince</div><div class="date">26th February 2003, 05:23</div></div><div class="posttext">Hello, this is my first post here. First, I would like to express my gratitude for such a nice installer package! Second, I have searched for the answer to my question and did not find it. Here, then, is the question:<br />
<br />
I am installing a server that always runs. So, when uninstalling, I use the /REBOOTOK option for the program executable. That works very well. However, I also need to delete the directory the executable is in and, optionally, its parent directory. So I do:<br />
<br />
  Delete /REBOOTOK $INSTDIR\program.exe<br />
  ; MUST REMOVE UNINSTALLER, too<br />
  Delete $INSTDIR\uninstall.exe<br />
  ; remove directories used.<br />
  RMDir /r &quot;$INSTDIR&quot;<br />
  RMDir &quot;$PROGRAMFILES\Company Name&quot;<br />
<br />
(The &quot;Company Name&quot; is the parent directory of $INSTDIR). The problem is the directories do not get deleted because program.exe is still running, so it is deleted upon reboot. I tried to specify /REBOOTOK after the RMDir, but the compiler smote me.<br />
<br />
If there is a way to have these directories removed on reboot (with the &quot;Company Name&quot; one only if nothing else is left inside it), please let me know.<br />
<br />
Thanks,<br />
Adam</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">26th February 2003, 07:09</div></div><div class="posttext">As far as I know, there is no possibility to do this directly. However, you could make a small separate exe that you put in the temp dir at uninstall and let that execute at startup, so put a shortcut in $SMSTARTUP or a regentry in HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run. Then this program could perform some last minute tasks and delete the regentry/shortcut. It cannot delete itself, but since it is in the temp dir it doesn't harm that much and the user will delete himself after some time (when cleaning the comp).<br />
<br />
Hope this helps. It has been discussed before (as far as I can remember), but can't find that anymore.<br />
<br />
Good luck,<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th February 2003, 10:44</div></div><div class="posttext">RMDir /REBOOTOK is now on the todo list.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Prince</div><div class="date">26th February 2003, 14:30</div></div><div class="posttext">Thanks, both of you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Prince</div><div class="date">2nd March 2003, 01:19</div></div><div class="posttext">I ended up with a workaround. Strangely, it works for one program but not for another. They are both running at the time of the uninstall, so there should be no difference.<br />
<br />
Anyway, I thought perhaps others might find it useful, so here is what I did:<br />
<br />
  GetTempfileName $0<br />
  Delete $0<br />
  Rename &quot;$INSTDIR\foo.exe&quot; $0<br />
  Delete /REBOOTOK $0<br />
  ; If that did not work, delete it from its directory<br />
  IfFileExists &quot;$INSTDIR\foo.exe&quot; &quot;&quot; &quot;bar&quot;<br />
  Delete /REBOOTOK &quot;$INSTDIR\foo.exe&quot;<br />
bar:<br />
  RMDir /r &quot;$INSTDIR&quot;</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>