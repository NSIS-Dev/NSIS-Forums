<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Iterate through ComboBox items, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Iterate through ComboBox items NSIS Discussion" />
	
	<title> Iterate through ComboBox items [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Iterate through ComboBox items</div>
<hr />
<div class="pda"><a href="t-355224.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=355224">Iterate through ComboBox items</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">28th January 2013, 12:51</div></div><div class="posttext">would anyone be so kind a provide an example how to iterate through the items of a combobox?<br />
<br />
actually a working example using CB_GETITEMDATA for any position in the combobox would be enough, i can wrap a loop around that myself. it's only that i haven't found a clear example and (as always) msdn (http://msdn.microsoft.com/en-us/library/windows/desktop/bb775859(v=vs.85).aspx) provides near to zero information, let alone examples.<br />
<br />
thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">28th January 2013, 16:32</div></div><div class="posttext">I have an installer with a combobox but I didn't need to use CB_GETITEMDATA. The user's choice is read with ${NSD_GetText} and I set a default selection with ${NSD_CB_SelectString} when building the list or modify it later with SendMessage $hComboBox ${CB_SETCURSEL} $1 0When I need to modify the selection the item number is determined by using ${WordFind} on the list of items I put in the combobox list. This works for us because our list is under a dozen items.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">28th January 2013, 21:10</div></div><div class="posttext">GET/SETITEMDATA only stores a pointer sized number (32bit), if you wanted to store an extra string in addition to the displayed text you need to allocate memory/struct with the system plugin and just store the memory address as the item data. (Just storing the item data in a .ini is probably less work)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">28th January 2013, 23:29</div></div><div class="posttext">I have an installer with a combobox but I didn't need to use CB_GETITEMDATA. The user's choice is read with ${NSD_GetText} and I set a default selection with ${NSD_CB_SelectString} when building the list or modify it later with SendMessage $hComboBox ${CB_SETCURSEL} $1 0When I need to modify the selection the item number is determined by using ${WordFind} on the list of items I put in the combobox list. This works for us because our list is under a dozen items.<br />
<br />
i'm not looking for the user choice, i'd like to hide all entries in the combobox that don't partially fit what the user entered.<br />
<br />
example:<br />
the combobox is populated with all css properties. when the user types &quot;background&quot; into the  box i want to hide all items that are not background properties (background-color, background-image etc.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">30th January 2013, 11:29</div></div><div class="posttext">ok, i got a bit further. turns out i can use CB_FINDSTRING to iterate through all items in the combobox. what i haven't figured out yet is how i can read a string from its index (i guess this is where CB_GETITEMDATA comes in)<br />
<br />
i tried the following without success<br />
SendMessage $ComboBox ${CB_GETITEMDATA} $index $string</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">30th January 2013, 16:43</div></div><div class="posttext">Cb_getlbtext</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">30th January 2013, 20:56</div></div><div class="posttext">phew, i'm not getting this to work. as always, i find msdn's documentation more than scarce. here's what i've bee using<br />
<br />
${NSD_GetText} $ComboBox $R0<br />
SendMessage $ComboBox ${CB_FINDSTRING} -1 &quot;STR:$R0&quot; $0<br />
SendMessage $ComboBox ${CB_GETLBTEXT} $0 $1<br />
<br />
must be the last line and i tried several variants (e.g. providing three arguments after CB_GETLBTEXT) - no success. i don't even understand what a TCHAR is, so i'd really appreciate a working example.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">31st January 2013, 00:33</div></div><div class="posttext">To receive a string you have to use System::Call user32::SendMessage... (See GetText in nsdialogs.nsh)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">2nd February 2013, 23:08</div></div><div class="posttext">i don't see how this is supposed to help</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">3rd February 2013, 05:34</div></div><div class="posttext">To receive the string you need the &quot;t.r1&quot; syntax of the system plugin, the built-in basic sendmessage cannot convert the raw memory buffer back to a nsis variable...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">4th February 2013, 14:08</div></div><div class="posttext">unfortunately, i don't understand any of that. which is why i kindly asked for an example in the first place.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">4th February 2013, 14:19</div></div><div class="posttext">http://forums.winamp.com/showthread.php?t=314626</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">5th February 2013, 13:15</div></div><div class="posttext">looking good so far, thanks a lot!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">19th February 2013, 13:53</div></div><div class="posttext">i've attached a first working version showcasing what i'm trying to accomplish. unfortunately, this is currently a one-way, older combobox items do not get restored. not sure what would be the best practice to do so, should i listen whether the delete key was pressed (and how does that work?) or simply compare whether the input length got shorter compared to a previous input?<br />
<br />
edit: to see what this example does, start typing any command from the combobox, e.g. &quot;border&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">19th February 2013, 19:50</div></div><div class="posttext">big problem: typing works, but selecting an item with the mouse breaks the whole thing. it seems that when clicking, nsd_gettext will always get the previous item, how could this be?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">20th February 2013, 06:09</div></div><div class="posttext">nsDialogs hooks CBN_EDITUPDATE and CBN_SELCHANGE, that callback might be too soon, use something other than nsd_gettext (CB_*) or try a timer hack...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">20th February 2013, 08:38</div></div><div class="posttext">nsDialogs hooks CBN_EDITUPDATE and CBN_SELCHANGE, that callback might be too soon, use something other than nsd_gettext (CB_*) or try a timer hack...<br />
<br />
hm, i was taking a look at nsDialogs.nsh hoping to find any of the keywords you delivered. changed quite a lot, i remember tinkering around in that file years ago, but it looks nothing like that anymore. got some further leads?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">23rd February 2013, 00:02</div></div><div class="posttext">i'm wondering how that can be a desired behaviour, onChange should really listen to both cases, especially since combining onChange and onClick doesn't work as one would expect. if there's need for seperating both (and i can't think of a scenario), it'd probably good to have a third macro. any thoughts on this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd March 2013, 07:14</div></div><div class="posttext">You probably want to iterate all of the available options and not all of the items in the combobox when filtering. This way, if someone hits the backspace, you still get all the other options.<br />
<br />
To get text from a combobox item, one System::Call is enough. No need to allocate stuff and use the built-in SendMessage.<br />
<br />
# new<br />
System::Call &quot;user32::SendMessage(i $ComboBox, i ${CB_GETLBTEXT}, i r9, t.r2)&quot;<br />
		<br />
# old<br />
#System::Alloc ${NSIS_MAX_STRLEN}<br />
#Pop $1<br />
#SendMessage $ComboBox ${CB_GETLBTEXT} $9 $1<br />
#System::Call &quot;*$1(&amp;t32.r2)&quot;<br />
#System::Free $1<br />
<br />
As for the last issue of choosing something with the mouse, I'm not sure why this happens, but Anders is probably right. In any case, you can work around it by calling CB_GETCURSEL first and checking if it returns -1 or not. If it returns a value, the user selected that item. If not, the user typed something.<br />
<br />
SendMessage $ComboBox ${CB_GETCURSEL} 0 0 $9<br />
${If} $9 != -1<br />
	# user selected something<br />
	System::Call &quot;user32::SendMessage(i $ComboBox, i ${CB_GETLBTEXT}, i r9, t .R0)&quot;<br />
${Else}<br />
	${NSD_GetText} $ComboBox $R0<br />
${EndIf}<br />
<br />
Attached is my almost working version. I'm sure you can take it from here.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">5th March 2013, 22:40</div></div><div class="posttext">thanks for the help, love how this works. can this be blocked for certain keystrokes (e.g. cursor keys)?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>