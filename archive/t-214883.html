<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Self copy install ?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Self copy install ? NSIS Discussion" />
	
	<title> Self copy install ? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Self copy install ?</div>
<hr />
<div class="pda"><a href="t-214883.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=214883">Self copy install ?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">SnipeGod</div><div class="date">4th May 2005, 11:05</div></div><div class="posttext">Is there a way to make the install file copy itself after installation into the install dir ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">4th May 2005, 11:16</div></div><div class="posttext">Function .onInstSuccess<br />
CopyFiles /SILENT &quot;$EXEDIR\Setup.exe&quot; &quot;$INSTDIR\Setup.exe&quot;<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SnipeGod</div><div class="date">4th May 2005, 14:07</div></div><div class="posttext">but what if the user renamed the file ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">4th May 2005, 14:16</div></div><div class="posttext">System plugin can help you to detect filename<br />
<br />
System::Call 'kernel32::GetModuleFileNameA(i 0, t .R0, i 1024) i r1'<br />
<br />
After this call $R0 will be equal to full path of file (i.e. path and file-name). Parse this variable.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SnipeGod</div><div class="date">4th May 2005, 15:59</div></div><div class="posttext">wow!<br />
thanks :D but I'm new to this scripting system so I'm not sure how to combine those two scripts to make it work :P</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">4th May 2005, 16:25</div></div><div class="posttext">I think this may be like this:<br />
<br />
Function .onInstSuccess<br />
System::Call 'kernel32::GetModuleFileNameA(i 0, t .R0, i 1024) i r1'<br />
StrLen $0 $R0<br />
Push $R0<br />
Call GetParent<br />
Pop $1<br />
StrLen $1 $1<br />
IntOp $0 $0 - $1<br />
IntOp $0 $0 - 1<br />
StrCpy $R1 $R0 &quot;&quot; &quot;-$0&quot;<br />
CopyFiles /SILENT &quot;$R0&quot; &quot;$INSTDIR\$R1&quot;<br />
FunctionEnd<br />
<br />
<br />
Add:<br />
Forgotten: GetParent function you can take from NSIS-docs - Appendix C - Get parent directory.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SnipeGod</div><div class="date">4th May 2005, 19:17</div></div><div class="posttext">You R AMAZING!!! :D I O U a HUGE beer :up: Once again THANK YOU :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">4th May 2005, 19:56</div></div><div class="posttext">Rather than use GetParent to get the file name (for some reason) just use GetFileName:<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=221&amp;instances=0,11,211<br />
<br />
Function .onInstSuccess<br />
System::Call 'kernel32::GetModuleFileNameA(i 0, t .R0, i 1024) i r1'<br />
Push $R0<br />
Call GetFileName<br />
Pop $R1<br />
CopyFiles &quot;$R0&quot; &quot;$INSTDIR\$R1&quot;<br />
FunctionEnd<br />
<br />
Edit: Silent may not be wise if the installer is large.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SnipeGod</div><div class="date">4th May 2005, 20:14</div></div><div class="posttext">hmmm... OK :] I'll try it then...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th May 2005, 17:47</div></div><div class="posttext">Why use GetParent or GetFileName? CopyFiles works with full paths, it's even required:Fully-qualified path names should always be used with this instruction. Using relative paths will have unpredictable results.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th May 2005, 18:26</div></div><div class="posttext">He needed the installer file to be copied to $INSTDIR.<br />
GetFileName was used to get the installer file name from $R0.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th May 2005, 18:31</div></div><div class="posttext">Right... Sorry, my bad.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SnipeGod</div><div class="date">5th May 2005, 20:20</div></div><div class="posttext">the script works great ! nothing more to add :] thank you all for your help !!!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>