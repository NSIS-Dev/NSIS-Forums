<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" &quot;Unpacking Data&quot; After installer closes, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  &quot;Unpacking Data&quot; After installer closes NSIS Discussion" />
	
	<title> &quot;Unpacking Data&quot; After installer closes [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  &quot;Unpacking Data&quot; After installer closes</div>
<hr />
<div class="pda"><a href="t-322280.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=322280">&quot;Unpacking Data&quot; After installer closes</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Squirre1</div><div class="date">8th September 2010, 21:08</div></div><div class="posttext">I have added a history switch to an installer that extracts a change log...<br />
<br />
I have designed a new template process... Well, now when I do my history switch, it extacts my text file, closes all my logging like it is suppose to and goes to my finish page..<br />
<br />
When I click Finish, it goes to &quot;Unpacking data&quot; for however much data I have and then just closes...<br />
<br />
Has anyone ever seen this before..<br />
<br />
Thanks,<br />
<br />
Squirre1</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Squirre1</div><div class="date">8th September 2010, 21:31</div></div><div class="posttext">I have at least isolated it, now I have to determine the best way to work around it or solve for it...<br />
<br />
In my installer, I have the following closing function<br />
<br />
<br />
  Function .onGUIend<br />
    ${registry::Unload}<br />
    ${time::Unload}<br />
    RMDir /r $PLUGINSDIR<br />
  FunctionEnd<br />
<br />
<br />
So the issue appears to occur when I have not called/used the registry plugin. Is there a way in NSIS to detect if a plugin has been loaded so I can unload it at the end for a good cleanup, and inversely not call the unload if it has not been used... :)<br />
<br />
Thanks,<br />
<br />
Squirre1</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Squirre1</div><div class="date">8th September 2010, 21:57</div></div><div class="posttext">This fixed it everyone... Just for those who may or may not be interested..<br />
<br />
Function .onGUIend<br />
    IfFileExists $PLUGINSDIR\regsitry.dll 0 +2<br />
      ${registry::Unload}<br />
    IfFileExists $PLUGINSDIR\time.dll 0 +2<br />
      ${time::Unload}<br />
    RMDir /r $PLUGINSDIR<br />
  FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">9th September 2010, 10:31</div></div><div class="posttext">Just to point out you mustn't use relative jumps to jump over macros (that is any !insertmacro or ${...} line). If the macro contains more than one line then the jump will end up somewhere unexpected inside. Use ${If} ${EndIf} instead. In this case you're OK because these macros only have a call to Plugin::Unload.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">9th September 2010, 11:14</div></div><div class="posttext">Just to add.. ${If} and ${EndIf} are from LogicLib.nsh, of course ;)<br />
http://nsis.sourceforge.net/LogicLib<br />
Definitely recommend using it - makes writing installers with NSIS much easier.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Squirre1</div><div class="date">9th September 2010, 12:47</div></div><div class="posttext">I love using the if's in nsis... They are all over my template..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Squirre1</div><div class="date">9th September 2010, 16:21</div></div><div class="posttext">Here is the final code I went with if anyone is interested and ever searches this thread.<br />
<br />
  Function .onGUIend<br />
    ${If} ${FileExists} &quot;$PLUGINSDIR\regsitry.dll&quot;<br />
      ${registry::Unload}<br />
    ${EndIf}<br />
    ${If} ${FileExists} &quot;$PLUGINSDIR\time.dll&quot;<br />
      ${time::Unload}<br />
    ${EndIf}<br />
    RMDir /r $PLUGINSDIR<br />
  FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>