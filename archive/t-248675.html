<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" VB6 Runtime Script for WinXP and Win2K, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  VB6 Runtime Script for WinXP and Win2K NSIS Discussion" />
	
	<title> VB6 Runtime Script for WinXP and Win2K [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  VB6 Runtime Script for WinXP and Win2K</div>
<hr />
<div class="pda"><a href="t-248675.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=248675">VB6 Runtime Script for WinXP and Win2K</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">RossW</div><div class="date">14th June 2006, 03:24</div></div><div class="posttext">Newbie here ...<br />
<br />
I've searched the forum on VB6 runtime files installation, but I can't figure out if I can use a single script to install my VB6 app on both WinXP and Win2K client machines. I've had problems in the past with a VB6 PDW setup that works on WinXP (my development platform), but not Win2k. I'm not sure if the VB6 runtime files are different for those OSs, or there are additional .dlls I need to install for Win2k.<br />
<br />
Can one script work on both platforms, i.e. determine dynamically what OS the user has and install differnt .dlls? Can I configure the script so that it will tell users to reboot for Win2k, but not for WinXP?<br />
<br />
Thanks in advance for any help offered.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">14th June 2006, 06:38</div></div><div class="posttext">For installation of the VB6 runtime check the NSIS manual (Section B.4 Visual Basic 6 Runtimes): !include Library.nsh<br />
<br />
 Var ALREADY_INSTALLED<br />
<br />
 Section &quot;-Install VB6 runtimes&quot;<br />
<br />
   ;Add code here that sets $ALREADY_INSTALLED to a non-zero value if the application is already installed. For example:<br />
<br />
   IfFileExists &quot;$INSTDIR\MyApp.exe&quot; 0 new_installation ;Replace MyApp.exe with your application filename<br />
     StrCpy $ALREADY_INSTALLED 1<br />
   new_installation:<br />
<br />
   !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_NOTPROTECTED &quot;msvbvm60.dll&quot; &quot;$SYSDIR\msvbvm60.dll&quot; &quot;$SYSDIR&quot;<br />
   !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;oleaut32.dll&quot; &quot;$SYSDIR\oleaut32.dll&quot; &quot;$SYSDIR&quot;<br />
   !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;olepro32.dll&quot; &quot;$SYSDIR\olepro32.dll&quot; &quot;$SYSDIR&quot;<br />
   !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;comcat.dll&quot;   &quot;$SYSDIR\comcat.dll&quot;   &quot;$SYSDIR&quot;<br />
   !insertmacro InstallLib DLL    $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;asycfilt.dll&quot; &quot;$SYSDIR\asycfilt.dll&quot; &quot;$SYSDIR&quot;<br />
   !insertmacro InstallLib TLB    $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;stdole2.tlb&quot;  &quot;$SYSDIR\stdole2.tlb&quot;  &quot;$SYSDIR&quot;<br />
<br />
 SectionEnd<br />
<br />
 Section &quot;-un.Uninstall VB6 runtimes&quot;<br />
<br />
   !insertmacro UnInstallLib REGDLL SHARED NOREMOVE &quot;$SYSDIR\msvbvm60.dll&quot;<br />
   !insertmacro UnInstallLib REGDLL SHARED NOREMOVE &quot;$SYSDIR\oleaut32.dll&quot;<br />
   !insertmacro UnInstallLib REGDLL SHARED NOREMOVE &quot;$SYSDIR\olepro32.dll&quot;<br />
   !insertmacro UnInstallLib REGDLL SHARED NOREMOVE &quot;$SYSDIR\comcat.dll&quot;<br />
   !insertmacro UnInstallLib DLL    SHARED NOREMOVE &quot;$SYSDIR\asycfilt.dll&quot;<br />
   !insertmacro UnInstallLib TLB    SHARED NOREMOVE &quot;$SYSDIR\stdole2.tlb&quot;<br />
<br />
 SectionEnd<br />
If I am not mistaken the VB files are the same for XP/2k. You can use this (http://nsis.sourceforge.net/Get_Windows_version)  code to determine the windows version and then decide if the installer will reboot or not.<br />
Hope this helps<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RossW</div><div class="date">17th June 2006, 02:42</div></div><div class="posttext">If I use the section for installing the VB6 runtime files, will it be smart and only copy/regsiter the files if the ones in the target directory are older (datetime stamp or version) than the ones included in the install program?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">17th June 2006, 09:30</div></div><div class="posttext">Since the libraries are shared, you also need to inform the OS that your program is using them. This is done by increasing the count for a shared file under the HKLM\Software\Microsoft\Windows\CurrentVersion\SharedDLLs key and this is something that the above macro does. In this way when an application that is using the shared lib is uninstalled the system knows if the lib should be deleted or not.<br />
In short, better use the macros to be on the safe side :)<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RossW</div><div class="date">21st June 2006, 03:04</div></div><div class="posttext">How do I know if the runtimes were actually installed? Will those macros automatically add a 'Reboot now' option to the finish page of a modern UI installer?<br />
<br />
I don't want to force the user to reboot if it's not necessary, i.e. if the runtimes are already installed or installing them no longer requires a reboot (WinXP, I think)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">21st June 2006, 06:26</div></div><div class="posttext">If a file that is in use has to be overwritten then the reboot flag will be set. Take a look at the Library.nsh header to get an idea of what is happening or read AppendixB (http://nsis.sourceforge.net/Docs/AppendixB.html) of the manual ...<br />
B.2.1 Introduction<br />
<br />
The InstallLib macro allows you to install a library. It sets the error flag if something went wrong during library setup.<br />
<br />
To ask the user for a reboot, if required, use the Modern UI with a Finish page or use IfRebootFlag and make your own page or message box.<br />
<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RossW</div><div class="date">21st June 2006, 13:23</div></div><div class="posttext">So the Modern UI Finish page will automatically display a reboot now option, without me having to do anything programatically, if the InstallLib returns an error?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th June 2006, 08:53</div></div><div class="posttext">It will ask to reboot if the reboot flag is set. I don't understand your question about the error flag.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RossW</div><div class="date">30th June 2006, 14:15</div></div><div class="posttext">Does InstallLib set the reboot flag automatically if it needs to update a .dll that's in use, or do I have to capture an error returned by InstallLib and set the reboot flag myself?<br />
<br />
(BTW, the error flag I was referring to was in the quote from Cancer Face)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th June 2006, 18:13</div></div><div class="posttext">It sets the reboot flag on its own.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RossW</div><div class="date">30th June 2006, 18:25</div></div><div class="posttext">Got it - thanks!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>