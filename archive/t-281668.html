<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Issues executing MySQL sql file, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Issues executing MySQL sql file NSIS Discussion" />
	
	<title> Issues executing MySQL sql file [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Issues executing MySQL sql file</div>
<hr />
<div class="pda"><a href="t-281668.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=281668">Issues executing MySQL sql file</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">BSOD2600</div><div class="date">18th November 2007, 06:36</div></div><div class="posttext">I've got an installer which installs MySQL (and other programs).  Part of the installer installs a pre-setup database. If the user installs it on another drive besides C:, I need to modify several paths.  I've written a MySQL .sql file to modify the database, but it seems MySQL 5 doesn't properly execute it. Instead, it just displays the default command line page.  <br />
<br />
Any ideas why?<br />
<br />
<br />
    Section MySQL SecMySQL        <br />
        SetOutPath $INSTDIR\mysql<br />
        SetOverwrite on<br />
        File /r C:\mysql\*<br />
        ;Create shortcuts   <br />
        SetShellVarContext All<br />
        CreateDirectory &quot;$SMPROGRAMS\MySQL\MySQL Server 5.0&quot;<br />
        CreateShortcut &quot;$SMPROGRAMS\MySQL\MySQL Server 5.0\MySQL Server Instance Config Wizard.lnk&quot; &quot;$INSTDIR\mysql\bin\MySQLInstanceConfig.exe&quot;<br />
        CreateShortcut &quot;$SMPROGRAMS\MySQL\MySQL Server 5.0\MySQL Manual.lnk&quot; &quot;$INSTDIR\mysql\docs\manual.chm&quot;<br />
              <br />
        ;Write registry entires<br />
	;ommited<br />
<br />
        SetOutPath $IISDIR\cacti\log<br />
        ;Install mysql service<br />
        ExecDos::exec /TIMEOUT=${EXECTIMEOUT} '&quot;$INSTDIR\mysql\bin\mysqld-nt.exe&quot; --install MySQL --defaults-file=&quot;$INSTDIR\MySQL\my.ini' &quot;&quot; &quot;$IISDIR\cacti\log\mysql_service.log&quot;  <br />
        ;Start MySQL service    <br />
        ExecDos::exec /TIMEOUT=${EXECTIMEOUT} '&quot;net&quot; start MySQL' &quot;&quot; &quot;$IISDIR\cacti\log\net_start_mysql.log&quot; <br />
        <br />
        ;Modify file paths if not C:<br />
        SetOutPath $TEMP<br />
        ${If} $INSTDIR != &quot;c:&quot; <br />
            ;Change forward slashes to backwards           <br />
            Push $INSTDIR<br />
            Push &quot;\&quot;<br />
            Call StrSlash<br />
            Pop $R0<br />
            StrCpy $R9 $R0<br />
            Push $IISDIR<br />
            Push &quot;\&quot;<br />
            Call StrSlash<br />
            Pop $R0<br />
            StrCpy $R8 $R0<br />
            Push $WINDIR<br />
            Push &quot;\&quot;<br />
            Call StrSlash<br />
            Pop $R0<br />
            StrCpy $R7 $R0                                                       <br />
            FileOpen $0 batch.txt w<br />
            FileWrite $0 &quot;update settings set name='path_rrdtool', value='$R9/rrdtool/rrdtool.exe' where name='path_rrdtool';$\r$\n&quot;<br />
            FileWrite $0 &quot;update settings set name='path_rrdtool_default_font', value='$R7/fonts/VeraMono.ttf' where name='path_rrdtool_default_font';$\r$\n&quot;<br />
            FileWrite $0 &quot;update settings set name='path_php_binary', value='$R9/php/php.exe' where name='path_php_binary';$\r$\n&quot;<br />
            FileWrite $0 &quot;update settings set name='path_snmpwalk', value='$R9/net-snmp/bin/snmpwalk.exe' where name='path_snmpwalk';$\r$\n&quot;<br />
            FileWrite $0 &quot;update settings set name='path_snmpget', value='$R9/net-snmp/bin/snmpget.exe' where name='path_snmpget';$\r$\n&quot;<br />
            FileWrite $0 &quot;update settings set name='path_snmpbulkwalk', value='$R9/net-snmp/bin/snmpbulkwalk.exe' where name='path_snmpbulkwalk';$\r$\n&quot;<br />
            FileWrite $0 &quot;update settings set name='path_snmpgetnext', value='$R9/net-snmp/bin/snmpgetnext.exe' where name='path_snmpgetnext';$\r$\n&quot;<br />
            FileWrite $0 &quot;update settings set name='path_cactilog', value='$R8/cacti/log/cacti.log' where name='path_cactilog';$\r$\n&quot;<br />
            FileWrite $0 &quot;update settings set name='path_Spike', value='$R9/Spike/Spike.exe' where name='path_Spike';$\r$\n&quot;<br />
            FileWrite $0 &quot;update settings set name='path_webroot', value='$R8/cacti' where name='path_webroot';$\r$\n&quot;<br />
        ${EndIf}<br />
        ;Modify rrdtool font path for win2k, since installer path based on XP<br />
        ${If} $OS == &quot;Windows2000&quot; <br />
            ;Change forward slashes to backwards<br />
            Push $WINDIR<br />
            Push &quot;\&quot;<br />
            Call StrSlash<br />
            Pop $R0<br />
            StrCpy $R7 $R0  <br />
            FileOpen $1 batch.txt a                             <br />
            FileWrite $1 &quot;update settings set name='path_rrdtool_default_font', value='$R7/fonts/VeraMono.ttf' where name='path_rrdtool_default_font';$\r$\n&quot;            <br />
            FileWrite $1 &quot;exit$\r$\n&quot;<br />
        ${EndIf}        <br />
        FileWrite $0 &quot;exit$\r$\n&quot;<br />
        FileClose $1<br />
        FileClose $0<br />
        ExecCmd::exec /TIMEOUT=${EXECTIMEOUT} '$INSTDIR\mysql\bin\mysql.exe --user=root --password=cacti --database=cacti &lt; &quot;$TEMP\batch.txt&quot;' &quot;&quot;                <br />
        ExecDOS::exec /TIMEOUT=${EXECTIMEOUT} '$INSTDIR\mysql\bin\mysql.exe --user=root --password=cacti --database=cacti &lt; &quot;$TEMP\batch.txt&quot;' &quot;&quot; &quot;$IISDIR\cacti\log\mysql_batch.txt&quot;<br />
        Delete /REBOOTOK $TEMP\batch.txt</div></div><hr />


<div class="post"><div class="posttop"><div class="username">galevsky</div><div class="date">19th November 2007, 10:36</div></div><div class="posttext">Hereafter is the way I managed to make it right:<br />
<br />
ExecWait '&quot;$1\bin\mysql&quot; --user=$mysql_user --password=$mysql_password --execute=&quot;source $0&quot;' $2<br />
<br />
with $0 the full path to my file that has been slashified first(you need a '\' =&gt; '/' function).</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>