<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem: GetTempFileName &amp; Upgrade Shared-DLLs, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem: GetTempFileName &amp; Upgrade Shared-DLLs NSIS Discussion" />
	
	<title> Problem: GetTempFileName &amp; Upgrade Shared-DLLs [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem: GetTempFileName &amp; Upgrade Shared-DLLs</div>
<hr />
<div class="pda"><a href="t-104044.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=104044">Problem: GetTempFileName &amp; Upgrade Shared-DLLs</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">NoStarWhere</div><div class="date">7th September 2002, 08:15</div></div><div class="posttext">Hi All,<br />
<br />
My OS is Windows 9x, and in my autoexec.bat has (red) lines :<br />
<br />
SET TEMP=C:\WINDOWS\TEMP<br />
:temp=c:\windows\temp is default by Windows, but I re-set for sure an existing TEMP environment<br />
:then remove all temporary files in TEMP folder that countn't be deleted because PC halted, Software halted or bad softwares have been created<br />
IF NOT EXIST %TEMP%\*.* GOTO endbat<br />
ECHO Y | DEL %TEMP%\*.* &gt; NUL<br />
:endbat<br />
<br />
<br />
In .NSI:<br />
<br />
Push $SYSDIR\xyz.dll<br />
!insermacro UpgradeDLL xyz.dll<br />
;Reboot<br />
<br />
After running installer, I found in WININIT.INI, such as<br />
<br />
[rename]<br />
C:\WINDOWS\SYSTEM\xyz.dll=C:\WINDOWS\TEMP\nst_unique.TMP<br />
<br />
After restarting computer, the file nst_unique.TMP in C:\WINDOWS\TEMP has been deleted (ensuant on the autoexec.bat) before Windows loads. And the file xyz.dll cannot be upgraded.<br />
<br />
I think, the best of this case is never copy nst_unique.TMP to $TEMP<br />
If and when GetTempFileName only assigned to user-var a value &quot;filename.tmp&quot; instead of &quot;$TEMP\filename.tmp&quot;, then I want, I'll use such as &quot;$SYSDIR\filename.tmp&quot;, &quot;$INSDIR\filename.tmp&quot;, &quot;$TEMP\filename.tmp&quot;, etc.<br />
In the meantime, can get &quot;filename.tmp&quot;:<br />
<br />
GetTempFileName $0<br />
Push $0		; ex: $0 = C:\WINDOWS\TEMP\nst_unique.TMP<br />
Call Filename<br />
Pop $0		 ; ---&gt; $0 = nst_unique.TMP<br />
<br />
Function Filename<br />
; You are easy to write this code<br />
FunctionEnd<br />
<br />
<br />
Sorry my bad English... too. :cry: <br />
So I hope you understand what I mean.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th September 2002, 09:44</div></div><div class="posttext">Simply change the output file from the result of GetTempFile to the filename plus .onreboot or something alike. Put it in the same directory and it won't be deleted on reboot.<br />
<br />
For example, if you had in the macro:<br />
GetTempFileName $0<br />
File /oname=$0 $R0 ; $R0 being the variable holding the filename<br />
<br />
Replace it with:<br />
File /oname=$R0.onreboot $R0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">superrock</div><div class="date">7th September 2002, 09:55</div></div><div class="posttext">Hi!<br />
<br />
I made the experience, that deleting the Windows %temp% directory in Autoexec.bat is making troubles anyway. Windows is using this directory as a system part. Therefore installers will write temporary files, which are used after restarting the system.<br />
<br />
May be it's better to delete the temp directory in a batch file in the autostart group of the Windows. Tasks for installing applications needing a Windows restart should have executed all operations before and hopefully delete all temporary stuff!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NoStarWhere</div><div class="date">7th September 2002, 11:28</div></div><div class="posttext">I agree with what you say. But I don't know users which using my installer, in their autoexec.bat has been deleting temp folder.<br />
<br />
<br />
To Kichik : Thank you for quick reply. I'll try now.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>