<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" get disk volume serial number, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  get disk volume serial number NSIS Discussion" />
	
	<title> get disk volume serial number [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  get disk volume serial number</div>
<hr />
<div class="pda"><a href="t-173860.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=173860">get disk volume serial number</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">danewbie</div><div class="date">18th March 2004, 16:50</div></div><div class="posttext">Hi,<br />
<br />
Is there a built-in function to get disk volume serial number in NSIS? I know InstallShield has one.<br />
<br />
<br />
Thanx!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">18th March 2004, 17:05</div></div><div class="posttext">Use the System plug-in to call Windows API.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">18th March 2004, 23:57</div></div><div class="posttext">Go with GetVolumeInformation (http://msdn.microsoft.com/library/en-us/fileio/base/getvolumeinformation.asp)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">atsuk</div><div class="date">5th April 2004, 21:34</div></div><div class="posttext">hi,<br />
i found that quite old topic about getting volume serial number. that's what i'm also interested in. The problem is that starter of this thread didn't post a solution and i have no experiences with msdn. i analysed some similar examples and put something together that looked quite like it should (to me). but....<br />
here it is(PS. again, i have never used msdn...forgive me my dumb mistakes!)<br />
<br />
<br />
Function GetVolumeInformation<br />
 strcpy $3 c<br />
 System::Call '${GetVolumeInformation}(i *r3, *r2,i 20, *r4, *r5, *r6, *r7,i 20) i r4'<br />
 dumpstate::debug<br />
functionend<br />
 <br />
so some help is needed here. please edit this system::call line and explain why this should not be the way i wrote. huge tnx for any help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">5th April 2004, 22:44</div></div><div class="posttext">!define GetVolumeInformation \<br />
&quot;Kernel32::GetVolumeInformation(t,t,i,i,i,i,t,i) i&quot;<br />
<br />
System::Call '${GetVolumeInformation}(&quot;C:\\&quot;,,255,.r0,,,,255)'<br />
<br />
The code returns the result to $0. Replace &quot;C:\&quot; with the volume you want to know (include the backslash &quot;\&quot;).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">atsuk</div><div class="date">6th April 2004, 05:58</div></div><div class="posttext">tnx,<br />
but it returns always 0 as serial number($0) no matter weather i choose c:\ or d:\ which are partitions of one HD or e:\ which is sepparate HD.<br />
i expected that this serial number is at least 5 characters and sertainly not 0.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">6th April 2004, 10:51</div></div><div class="posttext">!define GetVolumeInformation <br />
&quot;Kernel32::GetVolumeInformation(t,*t,i,*i,*i,*i,t,i) i&quot;<br />
<br />
System::Call '${GetVolumeInformation}(&quot;C:\\&quot;,,${NSIS_MAX_STRLEN},.r0,,,,${NSIS_MAX_STRLEN})'Sometimes I get confused when putting &quot;pointers&quot;. Now probably the code is right. The result is returned as a decimal integer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">habin</div><div class="date">30th May 2006, 05:51</div></div><div class="posttext">Is anyone know this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th May 2006, 11:13</div></div><div class="posttext">The code is in the post above yours!!<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">didava</div><div class="date">15th October 2008, 23:06</div></div><div class="posttext">hello,<br />
Thank you for your information,<br />
<br />
<br />
<br />
Name &quot;test&quot;<br />
OutFile &quot;test.exe&quot;<br />
<br />
        !include MUI.nsh<br />
<br />
Section<br />
Call GetDiskVolumeSerialNumber<br />
IntFmt $0 &quot;%08X&quot; $0<br />
MessageBox MB_OK &quot;$0&quot;<br />
SectionEnd<br />
<br />
Function GetDiskVolumeSerialNumber<br />
  !define GetVolumeInformation &quot;Kernel32::GetVolumeInformation(t,t,i,*i,*i,*i,t,i) i&quot;<br />
  System::Call '${GetVolumeInformation}(&quot;$0&quot;,,${NSIS_MAX_STRLEN},.r0,,,,${NSIS_MAX_STRLEN})'<br />
FunctionEnd<br />
 <br />
<br />
My code is not working,<br />
Can you help me!<br />
So Make an Example of Me,<br />
thanks in advance!!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">didava</div><div class="date">16th October 2008, 13:17</div></div><div class="posttext">hello!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">16th October 2008, 14:08</div></div><div class="posttext">You changed the example code that was provided.<br />
<br />
Which disk are you trying to get the serial number from?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">didava</div><div class="date">16th October 2008, 16:08</div></div><div class="posttext">no i have not changed the code, i have picked up the Function from here: http://nsis.sourceforge.net/Get_Disk_Volume_Serial_Number, and i want to get a permanent serial from the computer which is installing this program, and i want this in order for it to be clear that only one person is using this program. it is not important where this serial has come from, but only when he is installing the program, the serial would not change if the windows is changed. and please give us an example about how we can get this serial. i have asked my previous question, please read it again to understand it fully what i want to do.thank you very much, do not forget the example, by the way.<br />
the question: http://forums.winamp.com/showthread.php?s=&amp;postid=2421499#post2421499</div></div><hr />


<div class="post"><div class="posttop"><div class="username">QOAL</div><div class="date">16th October 2008, 16:37</div></div><div class="posttext">You haven't set anything to $0 before calling GetDiskVolumeSerialNumber, that may be the problem.Section<br />
StrCpy $0 &quot;C:\&quot;<br />
Call GetDiskVolumeSerialNumber<br />
IntFmt $0 &quot;%08X&quot; $0<br />
MessageBox MB_OK &quot;$0&quot;<br />
SectionEnd<br />
You'll find that section works now.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Velinas</div><div class="date">17th December 2008, 22:03</div></div><div class="posttext">Hi all,<br />
<br />
the code works fine for me so far.<br />
My trouble is that I need the Volume Serial in decimal format.<br />
<br />
Example of my drive c:<br />
E079E09B (NSIS is reporting right)<br />
in decimal: 3766083739 (I don't get this value from NSIS).<br />
<br />
I tried:<br />
<br />
Section<br />
StrCpy $0 &quot;C:\&quot;<br />
Call GetDiskVolumeSerialNumber<br />
IntFmt $0 &quot;%08X&quot; $0<br />
IntFmt $0 &quot;%d&quot; $0 &lt;---------- tried this<br />
MessageBox MB_OK &quot;$0&quot;<br />
SectionEnd<br />
<br />
I guess it's a noob question but I can't figure out how to it displayed in decimal. My code above results in 0 instead of 3766083739<br />
<br />
Thanks in advance for your help!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">17th December 2008, 23:23</div></div><div class="posttext">use format %u instead of %d<br />
<br />
<br />
	StrCpy $0 0xE079E09B<br />
	IntFmt $1 &quot;%u&quot; $0<br />
	MessageBox MB_OK &quot;$0 -&gt; $1&quot;<br />
<br />
<br />
result:<br />
<br />
---------------------------<br />
Name Setup<br />
---------------------------<br />
0xE079E09B -&gt; 3766083739<br />
---------------------------<br />
OK   <br />
---------------------------</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Velinas</div><div class="date">18th December 2008, 00:18</div></div><div class="posttext">Thanks a lot for your quick answer!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">18th December 2008, 00:55</div></div><div class="posttext">no prob... I do have to admit that %u was a total guess (unsigned int?)... I haven't the foggiest where there's a reference for IntFmt that actually lists all the Format strings.<br />
<br />
Edit: A-ha.<br />
wsprintf -&gt; http://msdn.microsoft.com/en-us/library/ms647550.aspx<br />
<br />
Might be nice to include that (either a link -or- the reference as it stands) in the help file -_-</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DIYQuads</div><div class="date">11th September 2013, 23:05</div></div><div class="posttext">Anyone know how this could be edited to display Volume Label instead of Volume Serial Number?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DIYQuads</div><div class="date">12th September 2013, 00:46</div></div><div class="posttext">Nevermind, I got it. <br />
In case anyone else is interested, here is the code:<br />
<br />
Name &quot;GetVolumeName&quot;<br />
OutFile &quot;GetVolumeName.exe&quot;<br />
!include MUI.nsh<br />
<br />
Section<br />
StrCpy $1 &quot;C:\&quot;<br />
Call GetDiskVolumeName<br />
MessageBox MB_OK &quot;$1 $0&quot;<br />
SectionEnd<br />
<br />
Function GetDiskVolumeName<br />
System::Alloc 1024<br />
Pop $0 <br />
!define GetVolumeInformation &quot;Kernel32::GetVolumeInformation(t,t,i,*i,*i,*i,t,i) i&quot;<br />
System::Call '${GetVolumeInformation}(&quot;$1&quot;,.r0,1024,,,,,1024)' ; <br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>