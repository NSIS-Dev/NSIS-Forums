<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" ExecDos creates an empty file in $EXEDIR, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  ExecDos creates an empty file in $EXEDIR NSIS Discussion" />
	
	<title> ExecDos creates an empty file in $EXEDIR [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  ExecDos creates an empty file in $EXEDIR</div>
<hr />
<div class="pda"><a href="t-313899.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=313899">ExecDos creates an empty file in $EXEDIR</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">820815</div><div class="date">16th October 2009, 05:08</div></div><div class="posttext">I'm trying to make a GUI :rolleyes: for a console application.<br />
The problem is that ExecDos creates an empty file with a random (?) number name in the $EXEDIR. :weird:<br />
nsExec &amp; ExecCmd haven't function &quot;isDone&quot;, which is needed for further use.<br />
<br />
Here's just an example script:<br />
OutFile test.exe<br />
<br />
!include FileFunc.nsh<br />
!include LogicLib.nsh<br />
!include nsDialogs.nsh<br />
<br />
Page custom window<br />
<br />
Var hwnd_func_load<br />
<br />
Function .onInit<br />
InitPluginsDir<br />
GetTempFileName $R3 $PLUGINSDIR<br />
StrLen $R2 $EXEDIR<br />
IntOp $R2 $R2 + 1<br />
FunctionEnd<br />
<br />
Function window<br />
nsDialogs::Create 1018<br />
${NSD_CreateGroupBox} 0 0 100% 100% 'test'<br />
GetFunctionAddress $hwnd_func_load load<br />
nsDialogs::CreateTimer $hwnd_func_load 1<br />
nsDialogs::Show<br />
FunctionEnd<br />
<br />
Function load<br />
nsDialogs::KillTimer $hwnd_func_load<br />
FileOpen $R1 $R3 w<br />
${Locate} '$EXEDIR' '/L=F /M=*.txt' writeLine<br />
FileClose $R1<br />
ExecDos::exec '$SYSDIR\\sort.exe &quot;$R3&quot; /o &quot;$R3&quot;'<br />
FunctionEnd<br />
<br />
Function writeLine<br />
StrCpy $R8 $R8 '' $R2<br />
${If} $R8 == ''<br />
FileWrite $R1 ' $R7$\r$\n'<br />
${Else}<br />
FileWrite $R1 '\$R8\$R7$\r$\n'<br />
${EndIf}<br />
Push $0<br />
FunctionEnd<br />
<br />
Section<br />
SectionEnd<br />
Any ideas? :confused:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">16th October 2009, 06:00</div></div><div class="posttext">What exactly do you need/want to accomplish?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">820815</div><div class="date">16th October 2009, 06:29</div></div><div class="posttext">I just want to understand why these empty files are created and how can I fix it :)<br />
Other functions and macros that goes after, doesn't matter, because they don't affect the bug.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">17th October 2009, 09:51</div></div><div class="posttext">First idea is to read ExecDos manual ;) http://nsis.sourceforge.net/ExecDos_plug-in<br />
If you want to have a file with your application output, you must define 3 parameters in plug-in's command line. Now I see one only - this work if utility' output goes not to file, options are [/TOSTACK | /DETAILED | /TOWINDOW | /TOFUNC]. In your code plug-in gets some garbage from stack and creates output file in current folder with this name, but 'sort' utility probably not produces any output - this is why file is empty.<br />
isDone may have sence with /ASYNC option only.<br />
Very good idea is to check plug-in exit code (Pop) - this a) will give you info about operation complition; b) will remove exit code value from installer stack and subsequent stack operations will be more reliable.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">820815</div><div class="date">17th October 2009, 13:21</div></div><div class="posttext">I've read, but did not notice that 3 parameters are required :o <br />
<br />
Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ChocJunkie</div><div class="date">10th November 2009, 10:41</div></div><div class="posttext">I've got a similar problem.<br />
I want to write the output of the program I'm calling to a text file.<br />
The installer executes and the file will be created, but then the installer remains in a infinite loop.<br />
ExecDos::exec &quot;wmic&quot; &quot;PATH Win32_DiskDrive WHERE InterfaceType!='USB' GET DeviceID /VALUE&quot; &quot;C:\test.txt&quot;<br />
<br />
Pop $R0<br />
MessageBox MB_OK &quot;Exit code $R0&quot;<br />
<br />
Any ideas what I'm doing wrong?<br />
<br />
Thanks :)<br />
<br />
CJ</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ChocJunkie</div><div class="date">10th November 2009, 11:49</div></div><div class="posttext">Ok, the task manager shows that wmic.exe is still running. <br />
Any ideas why it doesn't end?<br />
<br />
Using nsExec plugin wmic ends normally. But I'm not able to get the output of the function call in a file. If I'm using  &quot;&gt;FILE&quot; the call fails...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">10th November 2009, 13:19</div></div><div class="posttext">nsExec runs the exe directly, you need to use %comspec% /c if you want redirection</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">10th November 2009, 13:24</div></div><div class="posttext">See attached screenshot. You started wmic in a 'dialog' mode, so it waits for termination signal. BTW $\n required in stdin line if you want the string to be sent to application. But simplest way is to do everything in command lineExecDos::exec &quot;wmic PATH Win32_DiskDrive WHERE InterfaceType!='USB' GET DeviceID /VALUE&quot; &quot;&quot; &quot;$EXEDIR\stdout.txt&quot;<br />
<br />
Added: interesting situation, I could make it working with ExecCmd plug-in only (ExecCmd::exec &quot;wmic PATH Win32_DiskDrive WHERE InterfaceType!='USB' GET DeviceID /VALUE &gt;stdout.txt&quot; &quot;&quot; &quot;$EXEDIR\stdout.txt&quot;). May be wmic require terminal emulation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ChocJunkie</div><div class="date">10th November 2009, 14:04</div></div><div class="posttext">Added: interesting situation, I could make it working with ExecCmd plug-in only (ExecCmd::exec &quot;wmic PATH Win32_DiskDrive WHERE InterfaceType!='USB' GET DeviceID /VALUE &gt;stdout.txt&quot; &quot;&quot; &quot;$EXEDIR\stdout.txt&quot;). May be wmic require terminal emulation. [/B]<br />
Yeah, it's kind of interesting. ^^'<br />
I've tried your code and I thing it's working but the correct command would be:ExecCmd::exec &quot;wmic PATH Win32_DiskDrive WHERE InterfaceType!='USB' GET DeviceID /VALUE &gt;stdout.txt&quot;<br />
The last two paramteres are not needed.<br />
<br />
It's not the cleanest method - I think - but I'm really happy it's working. :) Thank you. :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>