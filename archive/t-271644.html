<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Including a file at runtime, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Including a file at runtime NSIS Discussion" />
	
	<title> Including a file at runtime [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Including a file at runtime</div>
<hr />
<div class="pda"><a href="t-271644.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=271644">Including a file at runtime</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Andrew Peacock</div><div class="date">23rd May 2007, 13:08</div></div><div class="posttext">Hi,<br />
I'd like to be able to include an optional text file at runtime. The NSIS script then reads that text file (if it exists), stores the content in a variable, and uses that variable later.<br />
<br />
All working well.<br />
<br />
My question is how to share this file with others.<br />
<br />
I'm using:<br />
IfFileExists $EXEDIR\data.txt 0 affiddone <br />
<br />
to work out where to find the text file, but that doesn't work if the installer is ZIPped. The only option is to ask the user to extract the ZIP file before they run the installer.<br />
<br />
Is there any way to point the NSIS script to the text file within the ZIP file directly?<br />
<br />
Regards,<br />
Andy</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd May 2007, 14:16</div></div><div class="posttext">Why don't you have the data file in the installer, or do you need to have a static installer with a changing data file?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Andrew Peacock</div><div class="date">23rd May 2007, 14:40</div></div><div class="posttext">The latter - static installer with changing data file,<br />
Andy</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd May 2007, 14:45</div></div><div class="posttext">How about storing the data file on a website and downloading it with InetC? Or maybe rather than using a Zip file for distribution, use another basic wrapper installer with no UI, has  CRCCheck off, extracts the two files then runs the extracted installer all in .onInit before calling Quit.<br />
<br />
To build the wrapper installer, I would use a batch file that calls makensis.exe<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Andrew Peacock</div><div class="date">23rd May 2007, 14:51</div></div><div class="posttext">Hi Stu,<br />
OK, alot of that was meaningless to me... but it sounds like you know what you're talking about, so I'll have a scoot around the forum and piece together the relevant code.<br />
<br />
Thanks for the pointers!<br />
<br />
Andy</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd May 2007, 15:39</div></div><div class="posttext">Something like this.<br />
<br />
Name &quot;My Installer Wrapper&quot;<br />
OutFile setup.exe<br />
<br />
SilentInstall silent<br />
CRCCheck off<br />
<br />
Function .onInit<br />
<br />
  SetOutPath $EXEDIR<br />
  File data.txt<br />
  File install.exe<br />
<br />
  Exec &quot;$EXEDIR\install.exe&quot;<br />
<br />
  Quit<br />
<br />
FunctionEnd<br />
<br />
Section<br />
SectionEnd<br />
<br />
<br />
I also put SilentInstall silent in there so that no GUI resources are added to the installer.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Andrew Peacock</div><div class="date">23rd May 2007, 15:44</div></div><div class="posttext">Stu,<br />
You da man!<br />
<br />
Thanks very much. I was never really sure what the .onInit etc routines do, but I think I've got that now, as well.<br />
<br />
Thanks again,<br />
Andy</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Andrew Peacock</div><div class="date">23rd May 2007, 16:28</div></div><div class="posttext">Stu,<br />
Had a look at it, and that's not exactly what I want. Mainly because I wasn't  being very specific :-)<br />
<br />
So, here's the scenario: <br />
<br />
1. I've created an installer which can take the value of an optional text file, and use it later in the program.<br />
<br />
2. I give that installer to resellers.<br />
<br />
3. THEY add that text file, with their own details, that I'll never see.<br />
<br />
4. The resellers give the ZIP (or other) file to users, who run the install, which picks up the reseller's details and installs appropriately.<br />
<br />
So, the resellers never have access to NSIS to create a new, unique installer.<br />
<br />
What I'd like is like the ZIP function where it asks &quot;Do you want to extract to a folder before installing?&quot;, so that the install .exe and the data.txt file are in the same folder. The install can then work as planned.<br />
<br />
Any chance you can shed some light on how to do this?<br />
<br />
Regards,<br />
Andy</div></div><hr />


<div class="post"><div class="posttop"><div class="username">theblazingangel</div><div class="date">23rd May 2007, 16:48</div></div><div class="posttext">if thats what you want then why not use an sfx archive...<br />
<br />
- you supply the main installer<br />
- reseller creates the text file, then packages the two files together as an sfx archive<br />
- end user runs the sfx archive and specifies where to extract to, the sfx archive extracts the files and calls your installer<br />
<br />
it might be a better idea to not go down the route of asking for an extraction location though. instead have the files extracted to a temporary location silently. if you can't do this with sfx archives, it can be done by wrapping your installer and the reseller's text file in another NSIS installer, Afrow UK supplied a script for this above.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">23rd May 2007, 17:31</div></div><div class="posttext">Provided that, <br />
1. the text file is always wrapped in a zip with a standard name or at least a range of names<br />
2. the zip resides into the same place with your main installer (this is preferred because the main installer won't need to perform a search to locate the zip)<br />
You could use one of the available unzip plugins (http://nsis.sourceforge.net/Category:Plugins) to extract the zip in a temporary place, read the required data and remove it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Andrew Peacock</div><div class="date">25th May 2007, 12:30</div></div><div class="posttext">Thanks for your help all. I'm looking at using server-side RAR to create a self-extracing ZIP. The reseller will enter their details into a PHP form, the server creates the ZIP, the reseller distributes the ZIP, and (hopefully) the self-extracting ZIP will correctly locate the data file.<br />
<br />
Regards,<br />
Andy</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th May 2007, 17:04</div></div><div class="posttext">Good idea :)<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">chivalri</div><div class="date">25th May 2007, 18:22</div></div><div class="posttext">I had the same issue.  I have a software package that gets rebranded by some of our bigger distributors.  I have created the installer so that the software gets rebranded if an ini file exists in $EXEDIR/custom.  If the file is not there then the installer looks and works as usual.  If it is there, the skin of the installer is changed using the distributors graphics and information and the changes are made to the installed applications.<br />
<br />
Function .onInit<br />
  strCpy $MyAPP_NAME &quot;My Software&quot;<br />
  strCpy $DoStamp &quot;0&quot;<br />
  IfFileExists &quot;$EXEDIR\custom\custom.ini&quot; GoodToDoStamp<br />
  goto NoStamp<br />
  GoodToDoStamp:<br />
  strCpy $DoStamp &quot;1&quot;<br />
  strCpy $MyAPP_NAME &quot;Resellers Software&quot;<br />
  NoStamp:<br />
FunctionEnd<br />
<br />
<br />
Then in each section I run this code<br />
  ${If} $DoStamp != &quot;0&quot;<br />
    ${StampMacro} &quot;This Section&quot;<br />
  ${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Andrew Peacock</div><div class="date">25th May 2007, 20:44</div></div><div class="posttext">Hi Chivalri,<br />
Does the end user have to unzip to a folder first, or did you also use a self-extracting exe? If the latter, what's the process for getting the self-extractor created?<br />
<br />
Regards,<br />
Andy</div></div><hr />


<div class="post"><div class="posttop"><div class="username">chivalri</div><div class="date">1st June 2007, 22:13</div></div><div class="posttext">Neither.  In my particular case, I have created an installer that has my company's logo and text in it as well as all over the software that is installed.  This is the default operation.<br />
<br />
If a distributor wants to put their stamp on the installer and the software, they must create a sub directory from $EXEDIR named custom and create a custom.ini file in that directory that has their text changes and paths to the replacement graphics.<br />
<br />
I ran a simple test for you using Stu's code.  I added a statement to launch my setup.exe after unpacking the installer and the custom dir and then removed the installer and custom dir when done and it worked very well.<br />
<br />
I did not make a delivery mechanism for getting the installer and the custom mods to the customer.  In the instructions I provided to the distributors, I suggested they put the installer on a CD and have the custom dir there along with any other extra software they wish to add.<br />
<br />
It works well this way.<br />
<br />
I ran a demo for our distributors showing that if I dropped the setup.exe into 4 different folders (each with their own custom dir) I got 4 different company skins on both the installer and the applications.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Andrew Peacock</div><div class="date">1st June 2007, 22:26</div></div><div class="posttext">Chivalri,<br />
Ah, OK. That makes sense. I was trying to make this download only rather than CD, so that won't help in this situation.<br />
<br />
But thanks very much for taking the time to share your experience. Much appreciated.<br />
<br />
Regards,<br />
Andy</div></div><hr />


<div class="post"><div class="posttop"><div class="username">chivalri</div><div class="date">4th June 2007, 15:00</div></div><div class="posttext">My normal delivery for the file is by download and using code like Stu's I tested to verify that a single file download could contain the custom folder and the setup file and auto launch the setup file after unpacking.<br />
<br />
For me, this works well since I am using a package based (web or cd delivery) install system.  Thus the setup file is small (less than 4 Mb) and adding the extra step for a distributor to wrap the package with their &quot;skin&quot; does not require much extra time in the setup or download.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>