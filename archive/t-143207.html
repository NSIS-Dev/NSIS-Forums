<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Checking Registry, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Checking Registry NSIS Discussion" />
	
	<title> Checking Registry [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Checking Registry</div>
<hr />
<div class="pda"><a href="t-143207.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=143207">Checking Registry</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">22nd July 2003, 20:30</div></div><div class="posttext">Hi There,<br />
<br />
I know it must be possible using ReadRegStr <br />
<br />
Plus I have read the documents and searched through other topics on this matter, but they where of no help as they don't explain what script I need.<br />
<br />
Anyhow to my question, I would to be able to create a small script within my patch scritp that before installation checks the registry to see if the game I'm patching is the correct version.<br />
<br />
Say if it was version 1.0 the installation would abort with a message saying I need to upgrade to version 2.0, but it version 2.0 was found in the registry the installation of my patch would continue.<br />
<br />
Any help would be grateful, including the script that would show me what I would need :)<br />
<br />
Thanks<br />
<br />
-Tony</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">22nd July 2003, 21:39</div></div><div class="posttext">Try this:<br />
<br />
ReadRegStr $0 HKLM &quot;SOFTWARE\GameX&quot; &quot;Version&quot;<br />
IniCmp $0 1 +1 +1 +3<br />
MessageBox MB_OK &quot;Must upgrade, dude&quot;<br />
Goto +2<br />
MessageBox MB_OK &quot;Your Ok, dude.&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">22nd July 2003, 22:37</div></div><div class="posttext">Didn't work I just got this error<br />
<br />
ReadRegStr expects 4 parameters, got 5.<br />
Usage: ReadRegStr $(user_var: output) rootkey subkey entry<br />
   root_key=(HKCR|HKLM|HKCU|HKU|HKCC|HKDD|HKPD)<br />
<br />
this is the code I used<br />
<br />
ReadRegStr $0 HKLM &quot;SOFTWARE\blah\blah\v1.0\&quot; &quot;Version&quot;=&quot;2.0&quot;<br />
IniCmp $0 1 +1 +1 +3<br />
MessageBox MB_OK &quot;Must upgrade, dude&quot;<br />
Goto +2<br />
MessageBox MB_OK &quot;Your Ok, dude.&quot;<br />
<br />
Oh where in the script do I add it i.e. top, bottom?<br />
<br />
Do I need to add Function or Section?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">22nd July 2003, 23:49</div></div><div class="posttext">ReadRegStr must be inside of Section or Function.<br />
Your error was for the &quot;Version&quot;=&quot;2.0&quot; thing...<br />
Try this little exampleFor example: <br />
<br />
Function .onInit<br />
ReadRegStr $0 HKLM &quot;SOFTWARE\Microsoft\DirectX&quot; &quot;Version&quot;<br />
StrCpy $1 $0 4 3<br />
MessageBox MB_OK $1<br />
Quit<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">23rd July 2003, 01:00</div></div><div class="posttext">Ok that worked fine<br />
<br />
I also figured out why the other script didn't work<br />
<br />
you put IniCmp <br />
<br />
When it should have been IntCmp with a T, sorry, I'm not complaining :)<br />
<br />
Also sorted out the version thing thanks alot :)<br />
<br />
Anyhow, how would I do it, if I only wanted the &quot;Must upgrade, dude&quot; message, if it was the wrong version, and then just quit the program after clicking OK.<br />
<br />
If it was the right version it wouldn't show any message or any Ok button and just carry on to the License page and so on<br />
<br />
At the moment it shows either message, you click on OK and it carries on with the program.<br />
<br />
Thanks<br />
<br />
-Tony</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">23rd July 2003, 12:50</div></div><div class="posttext">Anymore help would be appreciated :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">23rd July 2003, 13:01</div></div><div class="posttext">To abort the installation from .onInit use the Abort instruction.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">23rd July 2003, 20:34</div></div><div class="posttext">Thanks I had already figured that out, before I could change my last post<br />
<br />
Thanks to all who gave help<br />
<br />
The installer works perfectly now :)<br />
<br />
By the way guys great work keep it up :up:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">25th July 2003, 13:56</div></div><div class="posttext">hi there !<br />
ive written the following section, to read the installation path from the registry:<br />
<br />
Section &quot;-installdir&quot;<br />
!define BFDIR &quot;&quot;<br />
ReadRegStr $BFDIR HKLM &quot;Software\EA GAMES\Battlefield 1942&quot; &quot;GAMEDIR&quot;<br />
StrCpy $INSTDIR &quot;$BFDIR\Mods\$MODPATH&quot;<br />
SectionEnd<br />
InstallDir &quot;$INSTDIR&quot;<br />
<br />
<br />
but i always get this error-message:<br />
Error in script &quot;...&quot; on line 81 -- aborting creation process<br />
<br />
what's wrong with that code?<br />
is this just another bug in the compiler?<br />
<br />
if it looks like this, it works:<br />
<br />
Section &quot;-installdir&quot;<br />
!define BFDIR &quot;&quot;<br />
ReadRegStr $INSTDIR HKLM &quot;Software\EA GAMES\Battlefield 1942&quot; &quot;GAMEDIR&quot;<br />
StrCpy $INSTDIR &quot;$BFDIR\Mods\$MODPATH&quot;<br />
SectionEnd<br />
InstallDir &quot;$INSTDIR&quot;<br />
<br />
<br />
plz help me.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th July 2003, 14:01</div></div><div class="posttext">What is the exact error you get? Try updating to the latest CVS version (from now), maybe it's a bug with user variables Ramon has already fixed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">25th July 2003, 14:03</div></div><div class="posttext">ok. im updating.<br />
but this IS the exact error, the 3 points only stand for the filename.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th July 2003, 14:05</div></div><div class="posttext">But what's the error text above it? There is usually more than one line of error, the last one just saying processing has stopped.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">25th July 2003, 14:07</div></div><div class="posttext">hmm, above theres that:<br />
Usage: ReadRegStr $(user_var: output) rootkey subkey entry<br />
   root_key=(HKCR|HKLM|HKCU|HKU|HKCC|HKDD|HKPD)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th July 2003, 14:13</div></div><div class="posttext">Ah, it doesn't recognize the variable. You need latest CVS version, it should solve it. Also make sure you define the variable using Var BFDIR and Var MODPATH.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th July 2003, 14:35</div></div><div class="posttext">Shouldn't it be<br />
!define BFDIR $R9?<br />
<br />
Or is this using the variables plug-in?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">25th July 2003, 14:38</div></div><div class="posttext">no.<br />
other custom variables r working correctly.<br />
and whats that with those $Rx variables??</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th July 2003, 14:41</div></div><div class="posttext">$R* are built-in registers that existed long before you could define your own.<br />
<br />
BTW, Afrow, the new user variables are not a plug-in, they're built-in.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">25th July 2003, 14:44</div></div><div class="posttext">hmm, nothing just works.<br />
ive updatet the compiler, and defined it as $R1 and $R9 but always the same error.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">25th July 2003, 14:49</div></div><div class="posttext">kichik is it better, faster or more efficient to use the standard variables, $0..9 etc., rather than the new user defined vars?<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th July 2003, 14:50</div></div><div class="posttext">So Kichik, I can use anything with $ in front of it now as variables?<br />
<br />
-Stu ???</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th July 2003, 14:51</div></div><div class="posttext">Defined what as $R9??? Drop that !define, it shouldn't be there. The exact script should be:<br />
<br />
Var BFDIR<br />
Var MODPATH<br />
<br />
Section &quot;-installdir&quot;<br />
ReadRegStr $BFDIR HKLM &quot;Software\EA GAMES\Battlefield 1942&quot; &quot;GAMEDIR&quot;<br />
StrCpy $INSTDIR &quot;$BFDIR\Mods\$MODPATH&quot;<br />
SectionEnd<br />
InstallDir &quot;$INSTDIR&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th July 2003, 14:52</div></div><div class="posttext">Vytautas, the only difference is less memory usage when you don't define your own variables. With normal makensis.exe (NSIS_MAX_STRLEN = 1024) it's another 1KB of memory for every variable.<br />
<br />
Afrow, as long as you define it using Var, yes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th July 2003, 14:52</div></div><div class="posttext">OMG!<br />
That is great Kichik, I never knew it was possible to define variables now...<br />
<br />
Damn, somone needs to update the docs &gt;:p<br />
<br />
-Stu :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th July 2003, 14:55</div></div><div class="posttext">Hmm... http://nsis.sourceforge.net/Docs/Chapter4.html#4.2.1 ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th July 2003, 15:01</div></div><div class="posttext">Argh!!!<br />
oops...<br />
<br />
BTW, if you ned me to update the docs when needed then I don't mind (I'm getting paid to do websites now :))<br />
<br />
-Stu :p</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">25th July 2003, 15:04</div></div><div class="posttext">thx very much, guys!<br />
it's now working correctly.<br />
and $MODPATH doesnt have to be defined as var. it works with !definde $MODPATH.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th July 2003, 15:09</div></div><div class="posttext">No it doesn't. ${MODPATH} is the value of the define, $MODPATH is just plain $MODPATH. You should also get a warning about MODPATH not found. If you do want $MODPATH literally (doubt you do, it's in a path), you need to write it with double dollar sign: $$MODPATH.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th July 2003, 15:10</div></div><div class="posttext">For compile time constants:<br />
!define MODDIR &quot;C:\quake2\dday&quot;<br />
<br />
Then, you can do stuff in your script like so:<br />
CopyFiles &quot;$TEMP\blah\*.*&quot; ${MODDIR}<br />
<br />
Changeable variables should be set using:<br />
Var MODDIR<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">25th July 2003, 17:03</div></div><div class="posttext">ive got none errors with that code:<br />
<br />
!define $MODPATH &quot;abc&quot;<br />
$INSTDIR &quot;C:\$MODPATH&quot;<br />
<br />
ok, not the original entries, but it looks like them.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">26th July 2003, 01:18</div></div><div class="posttext">Yes that will work but you won't be able to modify $MODPATH after it's initial definition.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">26th July 2003, 18:07</div></div><div class="posttext">right. but it needn't to be modified this time :D<br />
later, i want to read out a file for this variable, but only at compile time, so, same like definition but through an external file instead of this scripted line.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>