<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Is this right ?? (NSISdl &amp; ZipDLL usage), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Is this right ?? (NSISdl &amp; ZipDLL usage) NSIS Discussion" />
	
	<title> Is this right ?? (NSISdl &amp; ZipDLL usage) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Is this right ?? (NSISdl &amp; ZipDLL usage)</div>
<hr />
<div class="pda"><a href="t-132430.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=132430">Is this right ?? (NSISdl &amp; ZipDLL usage)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">tcalp</div><div class="date">20th April 2003, 08:51</div></div><div class="posttext">I'm using Modern UI and I'm just curious if this will end up working properly once the installer is all done.<br />
I'm downloading DLL's using NSISdl, and then unziping them to windows temp dir (I think), and then using Upgrade DLL macro to install and register the dll.  If there is a problem with my code please let me know.<br />
<br />
;----------------------- ASYCFILT.DLL ----------------------------------------------------------------------<br />
   IfFileExists $SYSDIR\Comcat.dll skipDLL2<br />
      NSISdl::download /TIMEOUT=30000 http://www.mdb-project.com/Downloads/dll/asycfilt.zip $TEMP\asycfilt.zip<br />
        Pop $R0 ;Get the return value<br />
        StrCmp $R0 &quot;success&quot; +3<br />
        MessageBox MB_OK &quot;Download failed: $R0&quot;<br />
        Quit<br />
      ZipDLL::extractall &quot;$TEMP\asycfilt.zip&quot; &quot;$TEMP&quot;<br />
      !insertmacro UpgradeDLL $TEMP\asycfilt.dll $SYSDIR\asycfilt.dll<br />
   skipDLL2:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tcalp</div><div class="date">20th April 2003, 11:03</div></div><div class="posttext">as per the above example, this is the error I end up with (attempting to compile the script when the DLL doesn't exist I guess)<br />
<br />
I guess the problem is that it's running the script (attempting to getdllversion) on a file that will only exist during runtime ? .. how do I get around this ?<br />
<br />
<br />
IfFileExists: &quot;$SYSDIR\Comcat.dll&quot; ? skipDLL1 : <br />
File: &quot;nsisdl.dll&quot;-&gt;&quot;$PLUGINSDIR\nsisdl.dll&quot; 13312 bytes<br />
Plugin Command: download /TIMEOUT=30000 http://www.mdb-project.com/Downloads/dll/Comcat.zip $TEMP\Comcat.zip<br />
Pop: $R0<br />
StrCmp &quot;$R0&quot; &quot;success&quot; equal=+3, nonequal=<br />
MessageBox: 0: &quot;Download failed: $R0&quot;<br />
Quit<br />
Plugin Command: extractall $TEMP\Comcat.zip $TEMP<br />
!insertmacro: UpgradeDLL<br />
Push: $R0<br />
Push: $R1<br />
Push: $R2<br />
Push: $R3<br />
IfFileExists: &quot;$SYSDIR\Comcat.dll&quot; ?  : copy_$TEMP\Comcat.dll<br />
ClearErrors<br />
GetDLLVersionLocal: error reading version info from &quot;$TEMP\Comcat.dll&quot;<br />
Error in macro UpgradeDLL on macroline 13</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">20th April 2003, 11:53</div></div><div class="posttext">The first parameter of UpgradeDLL is the location of the file on your computer (the creator of the installer).<br />
<br />
UpgradeDLL included the DLL file in your installer, if you want to download a DLL, you will have to modify the macro.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tcalp</div><div class="date">21st April 2003, 07:49</div></div><div class="posttext">Thanks for your reply Joost.  I have no created a small macro to download the DLL's I need and the NSISdl will ALWAYS error.  in the Detail view it shows &quot;Error: (3 unledgible characters)mission denied&quot;<br />
and in the msgbox it says &quot;Error: Online&quot;.  There should be no permission problem, I say this because I've given pretty much every possible account read access to the files located on the server, all users can access the files through IE.  Is there something I'm missing ? (I'm using the Dailer to verify internet connection long before the downloads happen).  Also it is trying to download asycfilt.dll which is already in my &quot;C:\Winnt\System32&quot; folder, so shouldn't it be skipped alltogether ? ...<br />
<br />
Here is how I'm Calling DLL d/l's:<br />
      !insertmacro DoDllWork &quot;asycfilt&quot; &quot;dll&quot; <br />
      !insertmacro DoDllWork &quot;Comcat&quot; &quot;dll&quot;<br />
      !insertmacro DoDllWork &quot;comdlg32&quot; &quot;ocx&quot;<br />
<br />
And The Macro:<br />
!macro DoDllWork FILENAME EXT<br />
   DetailPrint &quot;${FILENAME}.${EXT}&quot;<br />
      DetailPrint &quot;URL: http://www.mdb-project.com/Downloads/dll/${FILENAME}.zip&quot;<br />
      DetailPrint &quot;$SYSDIR\${FILENAME}.${EXT}&quot;<br />
   IfFileExists &quot;$SYSDIR\${FILENAME}.${EXT}&quot; +8<br />
      NSISdl::download &quot;http://www.mdb-project.com/Downloads/dll/${FILENAME}.zip&quot; &quot;C:\${FILENAME}.zip&quot;<br />
        Pop $R0 ;Get the return value<br />
        StrCmp $R0 &quot;success&quot; +3<br />
        MessageBox MB_OK &quot;Download failed: $R0&quot;<br />
        Quit<br />
      ZipDLL::extractall &quot;$TEMP\${FILENAME}.zip&quot; &quot;$SYSDIR&quot;<br />
      Delete &quot;$TEMP\${FILENAME}.zip&quot;<br />
      RegDLL &quot;${FILENAME}.${EXT}&quot;<br />
   <br />
!macroend<br />
<br />
I've put in a few extra DetailPrints in there to verify paths are correct, and all seems good.   If anyone could please shed some light on this matter it would be greatly appriciated.<br />
<br />
Thanks,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tcalp</div><div class="date">21st April 2003, 08:32</div></div><div class="posttext">All fixed :) ... looked in docs and discovered IfFileExists only supports labels, not +N  ... still not sure why that made NSISdl crap out but it works so I'm happy.  And for anyone else this is a great little macro for D/L'ing and Reg'in DLL's :) ... <br />
<br />
<br />
!macro DoDllWork FILENAME EXT<br />
   IfFileExists &quot;$SYSDIR\${FILENAME}.${EXT}&quot; skip${FILENAME}<br />
      NSISdl::download http://www.mdb-project.com/Downloads/dll/${FILENAME}.zip $TEMP\${FILENAME}.zip<br />
        Pop $R0 ;Get the return value<br />
        StrCmp $R0 &quot;success&quot; +3<br />
        MessageBox MB_OK &quot;Download failed: $R0&quot;<br />
        Quit<br />
      ZipDLL::extractall &quot;$TEMP\${FILENAME}.zip&quot; &quot;$SYSDIR&quot;<br />
      Delete &quot;$TEMP\${FILENAME}.zip&quot;<br />
      RegDLL &quot;${FILENAME}.${EXT}&quot;<br />
   skip${FILENAME}:<br />
!macroend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">21st April 2003, 12:31</div></div><div class="posttext">IfFileExists does support jumps, but the problem is the plug-ins call. Certain commands are being processed to multiple commands internally, so you can't use relative jumps.<br />
<br />
From the docs:<br />
<br />
Note: relative jumps don't work with Exch, File, plug-ins (Plugin::Function), InitPluginsDir, GetFileTimeLocal or GetDLLVersionLocal. Do not try to jump over them using relative jumps, you will not get the result you were expecting.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">21st April 2003, 13:22</div></div><div class="posttext">I think that the compiler should throw a warning when an instruction is trying to jump over those instructions. It is often not seen as an error, since the compiler still compiles the installer correctly.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">21st April 2003, 13:57</div></div><div class="posttext">Adding such a check is not easy. This limitation will be gone soon, so there is no need to work on that now.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>