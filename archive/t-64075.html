<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Improvement to process_string, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Improvement to process_string NSIS Discussion" />
	
	<title> Improvement to process_string [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Improvement to process_string</div>
<hr />
<div class="pda"><a href="t-64075.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=64075">Improvement to process_string</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">28th October 2001, 21:24</div></div><div class="posttext">Hi all!<br />
<br />
Been lurking and using the fantastic NSIS for quite a while, thought it was time to give something back :) <br />
<br />
I was browsing through the NSIS source code (as you do) and thought of a way to reduce the installer size a little, so gave it a go.  The basic exehead remained the same size (although turns out to save 512 bytes when a packer such as UPX is used) but it gives a little more breathing space for future features.  Basically just another case of getting the compiler to do more work and the exehead less...<br />
<br />
So, here it is.  The compiler converts references to variables (such as $INSTDIR and $STARTMENU) in strings to encoded versions ($A, $B, etc) so that the exehead doesn't need to know about their names.  The expanding of variables in the installer is now a simple switch statement.<br />
<br />
Here (http://homepage.ntlworld.com/dave.laundon/nsis161-DL.zip) is a zip with a modified makensis.exe and two chunks of source code that made it.<br />
<br />
Enjoy! :) and it would be great if it was deemed safe/good enough to merge in to the official NSIS ;) <br />
<br />
-- <br />
Dave Laundon</div></div><hr />


<div class="post"><div class="posttop"><div class="username">justin</div><div class="date">29th October 2001, 00:28</div></div><div class="posttext">Heh I have been thinking about this one for a while =) .. the main reason I didn't want to touch it was for fear of breaking a lot. But it would seem that it works :)<br />
<br />
Anyway, I've also thought, why not use internally use non-standard values as the key, i.e. an ascii value of 1. <br />
<br />
Since we don't have very many variables anyway, perhaps they should be encoded as 1-20 or 240-255 or something on those lines (which would simplify the exehead side even more, and make strings even smaller =)<br />
<br />
Thoughts, comments?<br />
-Justin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">29th October 2001, 19:22</div></div><div class="posttext">Originally posted by justin <br />
Since we don't have very many variables anyway, perhaps they should be encoded as 1-20 or 240-255 or something on those lines (which would simplify the exehead side even more, and make strings even smaller =)<br />
Aha!  Hadn't thought of that..  Yes, then just have an escape character for the few times one of those actual characters is needed.  Mmm, will try that...<br />
<br />
Another thought for reducing size - turning virtually every string literal in the exehead into entries in the string-list, regardless of whether they might need to be overridden in a .nsi script or not.  That way they'd benefit from the zlib compression.  Exehead still probably won't change enough for it's .exe size to change, but UPX etc should be able to crunch it down a bit more?<br />
<br />
-- <br />
Dave Laundon</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">29th October 2001, 22:37</div></div><div class="posttext">I knew there'd be something.<br />
<br />
Places in the compiler that read previously stored entries from the string list get the encoded versions.  Not quite what's wanted...  :(<br />
<br />
-- <br />
Dave Laundon</div></div><hr />


<div class="post"><div class="posttop"><div class="username">justin</div><div class="date">30th October 2001, 17:26</div></div><div class="posttext">Originally posted by eccles <br />
I knew there'd be something.<br />
<br />
Places in the compiler that read previously stored entries from the string list get the encoded versions.  Not quite what's wanted...  :(<br />
<br />
-- <br />
Dave Laundon <br />
<br />
True, but that doesn't happen too often; generally when it does, the compiler is copying a string from the installer string table to the uninstaller string table. And then, we could make it just do a direct copy. Right?<br />
<br />
-justin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">30th October 2001, 21:08</div></div><div class="posttext">Originally posted by justin <br />
<br />
True, but that doesn't happen too often; generally when it does, the compiler is copying a string from the installer string table to the uninstaller string table. And then, we could make it just do a direct copy. Right?<br />
<br />
-justin <br />
<br />
Mmm, yes.. but I've done it now....  :o <br />
<br />
Just needs tidying up a bit, and is probably large enough to warrant a strlist.cpp now.<br />
<br />
-- <br />
Dave Laundon</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">3rd November 2001, 00:25</div></div><div class="posttext">Right.  Got round to finishing it at last...<br />
<br />
Justin - source files changed to implement the more efficient variable system can be found here (http://homepage.ntlworld.com/dave.laundon/nsis162-DL1.zip) for your perusal.  Everything appears to work...<br />
<br />
Everyone else - love the gui's btw :cool: - sorry this isn't something similar, but smaller/faster installers is a good thing, right? :) <br />
<br />
-- <br />
Dave Laundon</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Koen van de Sande</div><div class="date">3rd November 2001, 08:49</div></div><div class="posttext">Yes, we all want faster and smaller installers :D</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>