<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" VPatch 1.4 beta released, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  VPatch 1.4 beta released NSIS Discussion" />
	
	<title> VPatch 1.4 beta released [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  VPatch 1.4 beta released</div>
<hr />
<div class="pda"><a href="t-106467.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=106467">VPatch 1.4 beta released</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Koen van de Sande</div><div class="date">22nd September 2002, 10:43</div></div><div class="posttext">I've finished a new beta version of the patch generator. What's new:<br />
- Made patch generator 15-20% faster<br />
- Removed progress indicator from GUI and replaced it with a console window<br />
- Improved the GUI some more<br />
- Included command line utilities (GenPat.exe and VAppend.exe)<br />
<br />
Download VPatch 1.4 beta (http://gene.science.uva.nl/~ksande/vpatch14beta.exe) <br />
<br />
It's a beta version because I did not get a chance to do:<br />
- create a DLL version of the runtime for NSIS 2 (can someone give me a hand? I need an ExDLL project which I can open &amp; compile in MS Visual C++ 6.0)<br />
- check that the included PatchLib.NSI can be made any shorter by using new features of NSIS (it works but perhaps it could be shorter)<br />
<br />
Let me know if you find any bugs/have problems!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd September 2002, 12:11</div></div><div class="posttext">What's wrong with the ExDLL that already comes with NSIS? Just edit myFunction and you are set. Make sure you compile in Release mode.<br />
<br />
If you still can't compile, what errors do you get?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">22nd September 2002, 12:39</div></div><div class="posttext">I think he gets something like my problem: I can't open these Projects with MSVC++7.0, it say the project file is corrupt. Install Options - the same, and the LangDll opens successfully... Ok, going to find differences... will report...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd September 2002, 12:46</div></div><div class="posttext">Well...<br />
<br />
(can someone give me a hand? I need an ExDLL project which I can open &amp; compile in MS Visual C++ 6.0)<br />
<br />
:D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Koen van de Sande</div><div class="date">22nd September 2002, 12:54</div></div><div class="posttext">If I open the ExDLL workspace in MS Visual C++ 6.0, then the workspace window remains empty - nothing is opened. If I open the project then there is a complaint that the project file is &quot;not ok&quot; (don't know the exact message).<br />
The problem is that I don't know how to create such a project file 'from scratch'. I can copy/paste into exdll.c, but I can't 'use' it without a proper project file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd September 2002, 13:06</div></div><div class="posttext">I can't help you if you don't give me the exact error message...<br />
<br />
To start a project from scratch go to File-&gt;New-&gt;Projects-&gt;Win32 Dynamic-Link Library. Give it a name, and compile. ExDLL has some size optimizations too. It is better to just use ExDLL and change all of the names.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">22nd September 2002, 13:43</div></div><div class="posttext">The solution was just as simple: someone sent (perhaps while using CVS?) these damaged dsp files with lineends in form of &quot;CR&quot; or &quot;LF&quot; (I never could remember which one means '0x0A' and which '0x0D' :), and by microsoft standarts (it seems so, at last) lineends should be &quot;CRLF&quot; or &quot;LFCR&quot; ( the same problem :).<br />
<br />
Convertor attached. Use &quot;ConvertLN &lt; infile &gt; outfile&quot;.<br />
Maybe someone could update files at repository? ;)<br />
<br />
P.S. Huh, just updated the version, cause previous should damage files with right lineends.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd September 2002, 13:50</div></div><div class="posttext">That depends on the CVS client you use to download the files. TortoiseCVS converts it to MS format. I will see to it that the night build will also be in MS format.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">22nd September 2002, 14:09</div></div><div class="posttext">Huh... In fact this is interesting microsoft bug... All other files could have any format, and only project ones are so stupid... And why some people could open it and others no?<br />
<br />
Kichik and Koen: What OSes and MSVC (with SP numbers) do you have?<br />
(I hope this is not a confedential information... :)<br />
<br />
P.S. When the nighlty snapshot occurs, please? (In GMT)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd September 2002, 14:15</div></div><div class="posttext">Like I said brainsucker, it depends on the CVS client. I am using Tortoise and it converts it to MS line breaks automatically... The nightly snapshot doesn't. Rainwater has the times, I have no idea what the times are :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Koen van de Sande</div><div class="date">22nd September 2002, 16:35</div></div><div class="posttext">Changing to CRLF does miracles :D<br />
I was using the nightly snapshot btw.<br />
<br />
I've converted most of the project, however I'm getting two compile errors now:<br />
1) could be related to me renaming exdll.c-&gt;exdll.cpp (it occurs in the DLLmainCRTsomething function, on the hInstance= line):<br />
<br />
exdll.cpp<br />
F:\vpatch\Code\rev15\DLL_C\exdll.cpp(93) : error C2440: '=' : cannot<br />
 convert from 'void *' to 'struct HINSTANCE__ *'<br />
        Conversion from 'void*' to pointer to non-'void' requires an explicit cast<br />
Error executing cl.exe.<br />
<br />
2) Uhm, don't know what this is:<br />
<br />
Linking...<br />
   Creating library Release/vpatchdll.lib and object Release/vpatchdll.exp<br />
exdll.obj : error LNK2001: unresolved external symbol __chkstk<br />
vpatchdll.bin : fatal error LNK1120: 1 unresolved externals<br />
<br />
<br />
I've attached the project (with the meaningfull name &quot;exdll&quot;.. still have to change that).<br />
<br />
Thanks for any help you can give me :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">22nd September 2002, 17:04</div></div><div class="posttext">Right, KiCHiK was gonna answer you, but then he had to go, so then Eccles was gonna answer you, but then he had to go.... so it fell to me :)<br />
<br />
I was going to suggest you just rename it back to .c but then I noticed that you have lots of variable declarations after code which of course the C compiler won't like. Therefore I'd suggest you do what one of my C++ plugins does, move your actual exported plugin methods into a .cpp file and mark the functions like :<br />
<br />
extern &quot;C&quot; void __declspec(dllexport) myexportfunc(the usual plugin args)<br />
<br />
And include the exdll.h file at the top of the .cpp file like so :<br />
<br />
extern &quot;C&quot;<br />
{<br />
  #include &quot;exdll.h&quot;<br />
}<br />
<br />
That might help. KiCHiK's quick response to this was (a) don't rename the file to .cpp, and (b) he said something about watching those buffer sizes... I think he must have been cautioning against what you yourself in the code have commented on, hoping your 1024 byte buffers don't get overrun.<br />
<br />
If this doesn't solve your problem email me at ximon_eighteen@3b2.com and I'll put the effort in to getting your project compiling, right now I'll leave it to you tho in case that info helps.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd September 2002, 17:33</div></div><div class="posttext">I wasn't talking about his comments, I was talking about his second error, the linking error. __chkstk is a libc function that makes sure there is no stack overflow. It is automatically added to functions that needs more than 4K of memory on the stack. If you declare a buffer the size of 16000, it will be added, but, libc is not used for optimizing porpuses (saves about 50KB...) and thus __chkstk can not be found.<br />
To solve this you either have to dynamically allocate the large buffers, or make them static. Static are &quot;statically allocated&quot; only once in memory and not with every call to the function and thus doesn't need __chkstk.<br />
<br />
If you need any further assitance please drop by the IRC channel.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Koen van de Sande</div><div class="date">22nd September 2002, 19:31</div></div><div class="posttext">It compiles now :D<br />
It's just like you all said, thanks.<br />
This just leaves one issue: where to store the patch data?<br />
- Append it to the DLL: the EXE works this way, however I need to get the DLL name then (inside the DLL). Don't know how to do this with my limited API knowledge. And I'm not sure if you can let NSIS look in the current folder for plugins too?<br />
- Keep it in a seperate file: Then it can be easily read from the stack. Just some extra work for the user.<br />
Any suggestions? First one would be nice, but 2nd is easier to implement.<br />
<br />
Note: I can't access the IRC server. I have a dynamic IP address, and my current one is banned by some IRC server about 3 months ago. So unless I pull my net connection for an hour and acquire a new IP... you get the idea :rolleyes:. And the chances of getting a new IP succesfully... :igor:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">22nd September 2002, 19:38</div></div><div class="posttext">Originally posted by Koen van de Sande <br />
Keep it in a seperate file: Then it can be easily read from the stack. Just some extra work for the user.<br />
Any suggestions? First one would be nice, but 2nd is easier to implement.<br />
I prefer a separate file (also useful if you want to patch multiple files).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Koen van de Sande</div><div class="date">22nd September 2002, 19:46</div></div><div class="posttext">Originally posted by Joost Verburg <br />
<br />
I prefer a separate file (also useful if you want to patch multiple files). <br />
<br />
You can attach multiple patches to a single runtime.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Koen van de Sande</div><div class="date">23rd September 2002, 21:54</div></div><div class="posttext">Got to do a little more testing... but I just wrote a new implementation of the patch generator. And if it is working as good as it appears to be... it's fast :D</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>