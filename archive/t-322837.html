<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to call System::Call with an absolute DLL path, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to call System::Call with an absolute DLL path NSIS Discussion" />
	
	<title> How to call System::Call with an absolute DLL path [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to call System::Call with an absolute DLL path</div>
<hr />
<div class="pda"><a href="t-322837.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=322837">How to call System::Call with an absolute DLL path</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">gianlucav</div><div class="date">1st October 2010, 01:20</div></div><div class="posttext">Hi.<br />
<br />
I have an installer that does this:<br />
<br />
<br />
SetOutPath $INSTDIR<br />
	<br />
System::Call 'MyDll::MyFunction(t, i) i(&quot;&quot;,&quot;w&quot;).r0 ? u'<br />
<br />
The problem is that MyDll.dll is loaded from the current directory (probably using LoadLibrary with a relative path) and this breaks when this KB from MS in installed:<br />
<br />
http://support.microsoft.com/kb/2264107<br />
<br />
The current directory is removed from the DLL search path and System::Call fails.<br />
<br />
The solution is probably to use an absolute path. How to I pass an absolute path to System::Call?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">1st October 2010, 07:05</div></div><div class="posttext">you just... do?<br />
<br />
System::Call &quot;some.dll:someFunction(parameters)&quot;<br />
becomes<br />
System::Call &quot;DRIVE:\folder\subfolder\etc\some.dll:someFunction(parameters)&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gianlucav</div><div class="date">1st October 2010, 17:22</div></div><div class="posttext">If the path contains parentheses, the call fails. This is for example the case when the path is c:\program files (x86)\.... (x86 application installed on x64 Windows)<br />
<br />
I think System::Call interprets the parenthesis in (x86) as the beginning of the parameters.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">1st October 2010, 17:49</div></div><div class="posttext">Ok, so how about just adding some quotes then?<br />
System::Call '&quot;DRIVE:\folder\subfolder\etc\some.dll&quot;:someFunction(parameters)'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">1st October 2010, 17:56</div></div><div class="posttext">hmmm... sounds like a bug.. 'll drop that in the bug tracker later<br />
<br />
In the mean time.. hum... work-arounds.. work-arounds..<br />
putting quotes around it doesn't help... sticking the path in a variable and using that doesn't help...<br />
<br />
Here's one method that should work - but I admit readily that it kinda sucks...<br />
<br />
System::Call &quot;kernel32::LoadLibrary(t 'c:\path\to\your.dll') i .r0&quot;<br />
System::Call &quot;kernel32::GetProcAddress(i r0, t 'ExportedFunction') i .r1&quot;<br />
System::Call &quot;::$1(the usual parameters here)&quot;<br />
System::Call &quot;kernel32::FreeLibrary(i r0)&quot;<br />
<br />
might have to call 'kernel32::FreeLibrary $0'.. that tended to crash on the DLL I was testing with, though.. can't say I know 100% for sure that FreeLibrary() is required ( I guess the reference count dies on installer exit anyway, and the DLL doesn't appear to be locked )<br />
<br />
Edit: FreeLibrary() should indeed be used.. must be the test DLL.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">1st October 2010, 18:18</div></div><div class="posttext">Looks like the devs are aware of the issue, at least on some level... Bug 1616267 applies readily.  You already tried the suggestion therein (using SetOutpath).  I'll add a comment to that bug as kichik notes in it that parentheses are indeed problematic.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>