<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" installer crash during regsvr32, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  installer crash during regsvr32 NSIS Discussion" />
	
	<title> installer crash during regsvr32 [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  installer crash during regsvr32</div>
<hr />
<div class="pda"><a href="t-187629.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=187629">installer crash during regsvr32</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Idioteque</div><div class="date">24th July 2004, 10:53</div></div><div class="posttext">Hi I have a problem I cant solve.<br />
<br />
I build my own codecpack.<br />
<br />
I have recently switched to a open source mpeg2 decoder and splitter.<br />
<br />
When the installer build by nsis tries to register the OsMpegSplitter.ax filter the installer crashes. I dont know what causes this because on some computers  is crashes and on others is does not.<br />
<br />
when I manually type regsvr32 OsMpegSplitter.ax the filter is registered and works.<br />
<br />
<br />
The question then becomes, why does the installer crash. I have build in some waits between the different filters  to be registerd but that is not it.<br />
<br />
The installer can be found at :<br />
<br />
http://www2.vhl.tudelft.nl/~rloggen/vhl-codecpack/vhl-codecpack.exe<br />
<br />
thx</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th July 2004, 11:00</div></div><div class="posttext">Nothing much can be said without the crash details, but if I had to guess, I'd say some dependencies for the DLL you're trying to register are not present or are present with a mismatching version.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Idioteque</div><div class="date">24th July 2004, 11:18</div></div><div class="posttext">Event Type:	Information<br />
Event Source:	DrWatson<br />
Event Category:	None<br />
Event ID:	4097<br />
Date:		24-7-2004<br />
Time:		12:11:54<br />
User:		N/A<br />
Computer:	AD21<br />
Description:<br />
The application, , generated an application error The error occurred on 07/24/2004 @ 12:11:54.218 The exception generated was c0000005 at address 6483731F (&lt;nosymbols&gt;) <br />
<br />
<br />
sorry didnt kown how long the message was :P<br />
Hope this helps ??</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th July 2004, 11:23</div></div><div class="posttext">I'll have a look.<br />
<br />
Please attach large files next time.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Idioteque</div><div class="date">24th July 2004, 11:27</div></div><div class="posttext">the error message</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th July 2004, 11:48</div></div><div class="posttext">Crash log says the DLL caused the crash, before control is returned to NSIS. Try making sure all dependencies are presnt when calling RegDLL.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Idioteque</div><div class="date">24th July 2004, 12:32</div></div><div class="posttext">Crash log says the DLL caused the crash, before control is returned to NSIS. Try making sure all dependencies are presnt when calling RegDLL. <br />
<br />
the weird thing is, is that there are no dependencies as far as I know. <br />
<br />
Because if I want to reg te file manually regsvr32 osMPEGSplitter.ax it works.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Idioteque</div><div class="date">24th July 2004, 12:35</div></div><div class="posttext">I added the filter for you.<br />
<br />
the May 28th 2004 Gabest Universal Open Source MPEG Splitter (Windows XP/2000/2003):<br />
<br />
multipart rar file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th July 2004, 13:02</div></div><div class="posttext">Indeed it has no special dependencies... But it does try to call something that's no longer there. Can you use  Dependency Walker (http://www.dependencywalker.com/) to profile the installer and attach its log of a crashed installer along with Dr. Watson's new crash log? I want to see what OsMpegSplitter.ax is looking for.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Idioteque</div><div class="date">24th July 2004, 13:34</div></div><div class="posttext">Here the file from de Dependency walker <br />
<br />
there are some references to files not foudn but that's because I try to unload any exiting direct show filters.<br />
<br />
thx in anycase for all the help :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th July 2004, 13:35</div></div><div class="posttext">You forgot to attach the file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Idioteque</div><div class="date">24th July 2004, 13:36</div></div><div class="posttext">part 1</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Idioteque</div><div class="date">24th July 2004, 13:39</div></div><div class="posttext">part2</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Idioteque</div><div class="date">24th July 2004, 13:41</div></div><div class="posttext">part 3</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th July 2004, 13:59</div></div><div class="posttext">According to that log, the problem seems to be that IR41_32.AX is unregistred, reregistered, unloaded and then OsMpegSplitter.ax tries to unload it. Are you trying to replace IR41_32.AX too?<br />
<br />
Try adding /NOUNLOAD to the RegDLL command that registers IR41_32.AX. It looks like it loads itself again and waits for someone to unload it using CoFreeUnusedLibraries and not FreeLibrary as NSIS frees it.<br />
<br />
I think calling CoFreeUnusedLibraries after unregitering and before registering the new DLLs should help. Try:<br />
<br />
System::Call &quot;ole32::CoFreeUnusedLibraries()&quot;<br />
<br />
and/or:<br />
<br />
System::Call &quot;ole32::CoFreeAllLibraries()&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Idioteque</div><div class="date">24th July 2004, 14:15</div></div><div class="posttext">ok thx for the quick replies. Ill build a new version and include the added commands. I'll post the results<br />
<br />
thx for the help resolving the nasty problem</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th November 2004, 20:37</div></div><div class="posttext">I have made a change to RegDLL that should fix this. Can you please try it? I have uploaded a compiled version (http://nsis.sourceforge.net/regdll.zip).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Idioteque</div><div class="date">18th November 2004, 00:00</div></div><div class="posttext">sorry worked around the problem so I have no way of testing this version</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>