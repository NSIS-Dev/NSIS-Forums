<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Function parameters, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Function parameters NSIS Discussion" />
	
	<title> Function parameters [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Function parameters</div>
<hr />
<div class="pda"><a href="t-248010.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=248010">Function parameters</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">brasse</div><div class="date">6th June 2006, 20:00</div></div><div class="posttext">Hello!<br />
<br />
I have just started to use NSIS for one of my projects. In my installer script I want to use functions and I want to pass parameters to these function. As far as I can see the standard way of doing this is using the stack. If I have a function taking three parameters it will look something like this<br />
<br />
<br />
Function GetRegValue<br />
  Exch $R2 ; 3rd parameter, default<br />
  Exch<br />
  Exch $R1 ; 2nd parameter, name<br />
  Exch<br />
  Exch 2<br />
  Exch $R0 ; 1st parameter, sub_key<br />
<br />
  Push $R3 ; Save<br />
<br />
  ReadRegStr $R3 HKLM $R0 $R1<br />
  <br />
  IfErrors use_default<br />
<br />
  StrCpy $R2 $R3<br />
  Goto end<br />
<br />
use_default:<br />
  ;StrCpy $R0 $R2<br />
<br />
end:<br />
  Pop $R3 ; Restore<br />
  Pop $R0 ; Restore<br />
  Pop $R1 ; Restore<br />
  Exch $R2 ; Restore and return<br />
FunctionEnd<br />
<br />
<br />
All the Exch instructions to retrieve the arguments and store the values of the variables we need to use are kind of cryptic to say the least. Is this the best practice when it comes to parameters to functions in NSIS or is there a better way?<br />
<br />
Regrads,<br />
Mattias</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">6th June 2006, 22:12</div></div><div class="posttext">You could use a macro and pass the three parameters:!macro GetRegValue VAR1 VAR2 VAR3<br />
  !define Index &quot;Line${__LINE__}&quot;<br />
  ClearErrors<br />
  ReadRegStr $R3 HKLM $VAR1 $VAR2<br />
  IfErrors ${Index}_use_default<br />
<br />
  StrCpy ${VAR3} $R3<br />
  Goto ${Index}_end<br />
<br />
 ${Index}_use_default:<br />
  StrCpy $R0 ${VAR3}<br />
<br />
 ${Index}_end:<br />
  !undef Index<br />
!macroend<br />
However I am not sure where you want the output. If the ReadRegStr fails then you copy the 3rd variable over to the 1st. However if it succeeds you copy the output to the 3rd variable (?)<br />
<br />
In general you would call the macro like this:<br />
!insertmacro $R0 $R1 $R2<br />
Hope this helps ...<br />
CF</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>