<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" HowTo: User variables for Name, DirText, File, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  HowTo: User variables for Name, DirText, File NSIS Discussion" />
	
	<title> HowTo: User variables for Name, DirText, File [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  HowTo: User variables for Name, DirText, File</div>
<hr />
<div class="pda"><a href="t-78242.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=78242">HowTo: User variables for Name, DirText, File</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">paraclete</div><div class="date">4th March 2002, 15:45</div></div><div class="posttext">I've got several very common installation files.  I'd like to use variables so I can !include and call.<br />
<br />
I'm having trouble getting user variables to work the way I would think they would/should work.  They don't seem to be usable outside a section, so they are unavailable for &quot;Name&quot;, &quot;OutFile&quot;, &quot;InstallDir&quot;, etc.  I tried .onInit, which partially works.<br />
<br />
Within a Section, they seem to be partially available.  <br />
File $1 or File &quot;$1&quot; doesn't seem to work.<br />
<br />
WriteRegStr HKCU SOFTWARE\MySw\$1\Params &quot;Install_Dir&quot; &quot;$INSTDIR&quot;<br />
WriteRegStr HKCU SOFTWARE\MySw\$1\Params &quot;TestVar1&quot; &quot;$1&quot;<br />
both work as I would expect.<br />
<br />
Am I doing something wrong?  Is there another way to accomplish this same functionality?  I would like to have MyInstall.nsi as parameterized as possible, perhaps even to the point of using command line arguments.  That seems partially possible.<br />
<br />
Is there a way to set variables before 'Name', 'OutFile' ?<br />
<br />
Below is a TestVars.nsi<br />
<br />
Function .onInit<br />
  StrCpy $1 &quot;TestVars&quot;<br />
  StrCpy $2 &quot;$1Setup.exe&quot;<br />
  StrCpy $3 &quot;3.0.91&quot;<br />
  StrCpy $4 &quot;V:\$1.exe&quot;<br />
FunctionEnd<br />
<br />
;StrCpy $5 $1  ; &lt;--- This doesn't work<br />
Name $1  ; &lt;-- This doesn't work<br />
OutFile $2.exe  ; &lt;--- This doesn't work<br />
InstallDir $PROGRAMFILES\$1<br />
InstallDirRegKey HKLM SOFTWARE\LaSofStuf\$1 &quot;Install_Dir&quot;<br />
DirText &quot;Welcome to the installation/setup program for $1 ver $3&quot;<br />
<br />
Section &quot;ThisNameIsIgnored&quot;<br />
  SetOutPath $INSTDIR<br />
  ; Put files there<br />
  ; File $4     &lt;-- This doesn't work<br />
<br />
  WriteRegStr HKCU SOFTWARE\MySw\$1\Params &quot;Install_Dir&quot; &quot;$INSTDIR&quot;<br />
  WriteRegStr HKCU SOFTWARE\MySw\$1\Params &quot;TestVar1&quot; &quot;$1&quot;<br />
  WriteRegStr HKCU SOFTWARE\MySw\$1\Params &quot;TestVar2&quot; &quot;$2&quot;<br />
  WriteRegStr HKCU SOFTWARE\MySw\$1\Params &quot;TestVar3&quot; &quot;$3&quot;<br />
  WriteRegStr HKCU SOFTWARE\MySw\$1\Params &quot;TestVar4&quot; &quot;$4&quot;<br />
<br />
SectionEnd ; end the section<br />
<br />
Regards,<br />
Paraclete</div></div><hr />


<div class="post"><div class="posttop"><div class="username">superrock</div><div class="date">4th March 2002, 19:23</div></div><div class="posttext">Hi,<br />
<br />
Sorry, variables are only valid in Sections. Unfortunately this is the standard behavior of this tool. <br />
<br />
See documentation(makensis.htm): &quot;Installer attributes&quot; <br />
<br />
With the exception of InstallDir, none of these attributes allow use of Variables other than $\r and $\n in their strings. <br />
<br />
You must use a preprocessor function for it ( e.g. ${variable} ).<br />
<br />
Greetings,<br />
Andreas<br />
<br />
;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">paraclete</div><div class="date">4th March 2002, 19:49</div></div><div class="posttext">Thanks for the very prompt reply. :up:<br />
<br />
I'm still thinking the 'File' command inside the install section should have worked.  Am I doing something wrong there?  Should I define a user variable $R1?  :weird: <br />
<br />
I didn't see anything about preprocessing variables.  I'll take a relook.:igor:<br />
<br />
These icons are cool.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">superrock</div><div class="date">4th March 2002, 22:23</div></div><div class="posttext">Hi Paraclete:) <br />
<br />
I really don't know why FIle is not working with variables. The documentations does not disallow to do what you want.<br />
<br />
For preprocessing an example for you. For further details refer &quot;Compiler defines/conditional compilation&quot;<br />
<br />
;Superrock example<br />
!define VER_MAIN 3<br />
!define VER_MAJOR 0<br />
!define VER_MINOR 91<br />
!define VERSION ${VER_MAIN}.${VER_MAJOR}.${VER_MINOR}<br />
!define APPLNAME TestVars<br />
!define INSTSOURCE V:\<br />
<br />
Name ${APPLNAME}<br />
OutFile ${APPLNAME}.exe<br />
InstallDir $PROGRAMFILES\${APPLNAME}<br />
InstallDirRegKey HKLM SOFTWARE\LaSofStuf\${APPLNAME} &quot;Install_Dir&quot; <br />
DirText &quot;Welcome to the installation/setup program for ${APPLNAME} V${VERSION}&quot; <br />
<br />
; The stuff to install<br />
Section &quot;${PACKAGE} Program files&quot;<br />
<br />
	SetOutPath $INSTDIR <br />
<br />
	File &quot;${INSTSOURCE}\${APPLNAME}.exe&quot;<br />
<br />
	Strcpy $1 ${APPLNAME}<br />
	WriteRegStr HKCU SOFTWARE\MySw\$1\Params &quot;Install_Dir&quot; &quot;$INSTDIR&quot; <br />
	WriteRegStr HKCU SOFTWARE\MySw\$1\Params &quot;TestVar1&quot; &quot;$1&quot; <br />
.<br />
.<br />
<br />
SectionEnd<br />
<br />
<br />
Greetings,<br />
Andreas;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">paraclete</div><div class="date">4th March 2002, 22:41</div></div><div class="posttext">Thanks Andreas!!<br />
<br />
I'll post a bug report on 'File'.  With just a glance, it looks like maybe I can do something equivalent with !define.  <br />
<br />
Paraclete</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>