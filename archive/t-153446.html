<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" force install dir when a previous installation is finded, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  force install dir when a previous installation is finded NSIS Discussion" />
	
	<title> force install dir when a previous installation is finded [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  force install dir when a previous installation is finded</div>
<hr />
<div class="pda"><a href="t-153446.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=153446">force install dir when a previous installation is finded</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">moxo</div><div class="date">21st October 2003, 13:35</div></div><div class="posttext">Hello<br />
can you help me? i have searched in the forum and in the documentation but i don't find that i want.<br />
i have a two programs who are need to be install in the same path. i install one of this 2 programs, i want my program read a key<br />
readRegStr $R6 HKCU &quot;Software\${COMPANY}&quot; &quot;PathComp&quot; and if is key is configured i want my program use this path (the path appears in directory page but is not possible to modify) but if key is empty, the user can modify the path in directory page.<br />
thanks for your help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st October 2003, 14:08</div></div><div class="posttext">Use InstallDirRegKey to initially set $INSTDIR to whatever is in that key. If it's empty, copy your default installation directory into $INSTDIR in .onInit and set a variable to a certain vaule. In the show function of the directory selection page enable or disable the directory selection box according to the value of that variable.<br />
<br />
To enable/disable the box use:<br />
<br />
FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
GetDlgItem $$0 $0 1019<br />
EnableWindow $0 0 # change the last 0 to 1 if you want to enable<br />
<br />
The EnableWindow instruction is available only in the latest CVS version. If you're using b3 use the System plug-in instead:<br />
<br />
# change the last 0 to 1 to enable<br />
System::Call &quot;user32::EnableWindow(i r0, i 0)&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">moxo</div><div class="date">21st October 2003, 16:45</div></div><div class="posttext">!define MUI_LICENSEPAGE<br />
 page directory mapage<br />
 !define MUI_STARTMENUPAGE<br />
 !define MUI_ABORTWARNING<br />
 !define MUI_FINISHPAGE</div></div><hr />


<div class="post"><div class="posttop"><div class="username">moxo</div><div class="date">21st October 2003, 16:59</div></div><div class="posttext">is it good to put this in script?<br />
i try to use oninit function to initiliaze installdir but i have error<br />
<br />
function .oninit<br />
 ReadRegStr $R8 HKCU &quot;Software\${COMPANY}&quot; &quot;PathComp&quot;<br />
 StrCmp $R8 &quot;&quot; 0 notfirst<br />
 InstallDir &quot;$PROGRAMFILES\${COMPANY}\&quot;<br />
 InstallDirRegKey HKCU &quot;Software\${COMPANY}\&quot; &quot;PathComp&quot;<br />
 goto done<br />
 <br />
 notfirst:<br />
 InstallDir $R8<br />
 InstallDirRegKey HKCU &quot;Software\${COMPANY}\&quot; &quot;PathComp&quot;<br />
 goto done<br />
 <br />
 done:<br />
 Functionend<br />
<br />
i don't kow what i put in function mapage <br />
<br />
 !define MUI_LICENSEPAGE<br />
 page directory mapage<br />
 !define MUI_STARTMENUPAGE<br />
 !define MUI_ABORTWARNING<br />
 !define MUI_FINISHPAGE<br />
<br />
function mapage<br />
System::Call &quot;user32::EnableWindow(i r0, i 0)&quot;<br />
functionend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st October 2003, 19:26</div></div><div class="posttext">InstallDir and InstallDirRegKey can't be used inside functions or section. Use StrCpy $INSTDIR &quot;something&quot; to set $INSTDIR manually.<br />
<br />
As for the disabling of the text box, that's not the way to do it. You should put the code in the show function, not the pre function. That's also not the way to define a show function using the MUI. See the MUI readme for more information about page's callbacks functions. You have also copied just part of the disbaling script. That System line is a replacement just for the EnableWindow command, not all of the code.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>