<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" space required, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  space required NSIS Discussion" />
	
	<title> space required [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  space required</div>
<hr />
<div class="pda"><a href="t-321448.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=321448">space required</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">orecchionebruno</div><div class="date">6th August 2010, 12:26</div></div><div class="posttext">Hello everyone,<br />
<br />
any one can suggest me how get space required by installer?<br />
<br />
The standard installer directory page of NSIS shows the Space required and the Space avaible. I would recreate that infos in a custom page.<br />
<br />
For the avaible space I've used the function &quot;UpdateFreeSpace&quot; included in Starting from &quot;NSIS\Examples\nsDialogs\welcome.nsi&quot;, but the for the Space required i din't found a solution. So can I retrieve this info or I should calculate it?<br />
<br />
Thankss<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">6th August 2010, 13:06</div></div><div class="posttext">Get the size of every selected section using:<br />
http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.13.8</div></div><hr />


<div class="post"><div class="posttop"><div class="username">orecchionebruno</div><div class="date">6th August 2010, 13:22</div></div><div class="posttext">sorry but I've not understood<br />
<br />
SectionGetSize can retrieve the amount size (in byte or Mb) of files and folder that NSIS will compress on the exe of the installer?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">orecchionebruno</div><div class="date">6th August 2010, 13:55</div></div><div class="posttext">Thanksss I've followed your suggestion and I'v solved my question:<br />
<br />
SectionGetSize ${MySectionFileToExtract} $0<br />
IntOp $0 $0 + 100<br />
SectionSetSize ${MySectionFileToExtract} $0<br />
<br />
Thanksss</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">6th August 2010, 13:56</div></div><div class="posttext">SectionGetSize can retrieve the amount size (in byte or Mb) of files and folder that NSIS will compress on the exe of the installer?<br />
It retrieves the size in kilobytes of a given section when -uncompressed-.  Note that this does not take into account things like filesystem overhead or NTFS compression, etc.  But if drive space available is tight enough for such things to matter, the drive is definitely too full ;)<br />
<br />
As MSG would say... search the forum;<br />
http://forums.winamp.com/showthread.php?t=320859&amp;highlight=space+required</div></div><hr />


<div class="post"><div class="posttop"><div class="username">orecchionebruno</div><div class="date">6th August 2010, 14:26</div></div><div class="posttext">Ok thankss and thanks for the thread that you post me</div></div><hr />


<div class="post"><div class="posttop"><div class="username">orecchionebruno</div><div class="date">6th August 2010, 16:50</div></div><div class="posttext">It retrieves the size in kilobytes of a given section when -uncompressed-.  Note that this does not take into account things like filesystem overhead or NTFS compression, etc.  But if drive space available is tight enough for such things to matter, the drive is definitely too full ;)<br />
<br />
Thanksss I'm not sure to had understood. If SectionGetSize retrieves uncompressed size, I should not have any problems on any filesystem compresions or not?<br />
<br />
<br />
As MSG would say... search the forum;<br />
http://forums.winamp.com/showthread.php?t=320859&amp;highlight=space+required<br />
<br />
I read your suggestion about &quot;${DriveSpace} &quot;$0\&quot; &quot;/D=F /S=G&quot; $spaceAvailable ; G = GiB&quot;<br />
What the difference beetween ${DriveSpace} and GetDiskFreeSpaceEx?<br />
<br />
This what I've used:<br />
<br />
StrCpy $1 &quot; byte&quot;<br />
System::Call kernel32::GetDiskFreeSpaceEx(tr0,*l,*l,*l.r0)<br />
<br />
${If} $0 &gt; 1024<br />
${OrIf} $0 &lt; 0<br />
        System::Int64Op $0 / 1024<br />
        Pop $0<br />
        StrCpy $1 &quot;kb&quot;<br />
        ${If} $0 &gt; 1024<br />
        ${OrIf} $0 &lt; 0<br />
                System::Int64Op $0 / 1024<br />
                Pop $0<br />
                StrCpy $1 &quot;mb&quot;<br />
                ${If} $0 &gt; 1024<br />
                ${OrIf} $0 &lt; 0<br />
                        System::Int64Op $0 / 1024<br />
                        Pop $0<br />
                        StrCpy $1 &quot;gb&quot;<br />
                ${EndIf}<br />
        ${EndIf}<br />
${EndIf}<br />
SendMessage $FREESPACE ${WM_SETTEXT} 0 &quot;STR:Space available: $0 $1&quot;<br />
<br />
Ciao<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">6th August 2010, 20:05</div></div><div class="posttext">Thanksss I'm not sure to had understood. If SectionGetSize retrieves uncompressed size, I should not have any problems on any filesystem compresions or not?<br />
Well, filesystem compression compresses the file when it's written away or as it's written away (depending on the FS).  Let's say your application needs 13MB of space when not compressed, and the system only shows 12MB free.  Your installer would then claim it can't be installed; but if you were to attempt install anyway, the filesystem might compress the files down to 8MB and it does fit.<br />
Again, though, in any such situation I'd err on the side of caution and just tell the user that you don't care if they use compression, it's time for them to delete some stuff if they want your app installed :)<br />
<br />
<br />
I read your suggestion about &quot;${DriveSpace} &quot;$0\&quot; &quot;/D=F /S=G&quot; $spaceAvailable ; G = GiB&quot;<br />
What the difference beetween ${DriveSpace} and GetDiskFreeSpaceEx?<br />
No real difference. DriveSpace uses the same API (GetDiskFreeSpaceEx) to get the free space.  It just does some of the math bits for you and has some flags for getting total space/used space/free space.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">7th August 2010, 06:11</div></div><div class="posttext">If SectionGetSize retrieves uncompressed size, I should not have any problems on any filesystem compresions or not?<br />
<br />
Animaether, I think he meant to say: &quot;I should not have any problems on any filesystem, regardless of the installer's compression.&quot;  orecchionebruno, the answer to that question would be: Yes. SectionSetSize gets the harddrive space required for *installing* the section. It doesn't have anything to do with the size of the installer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">orecchionebruno</div><div class="date">7th August 2010, 09:43</div></div><div class="posttext">thanks Animaether and MSS<br />
<br />
I'll consider any Animaether suggestions but for this specific situatation I'll consider only uncopress size because my data are only some mbytes and it's very hard that user has not some mb free. If not user will delete something.<br />
<br />
thankss again</div></div><hr />


<div class="post"><div class="posttop"><div class="username">orecchionebruno</div><div class="date">10th August 2010, 10:51</div></div><div class="posttext">No real difference. DriveSpace uses the same API (GetDiskFreeSpaceEx) to get the free space.  It just does some of the math bits for you and has some flags for getting total space/used space/free space.<br />
<br />
Hi Animaether and hi to everyone,<br />
<br />
I've followed Animaether suggestions because when I use the API as follow I'm not able to retrieve correct values:<br />
System::Call kernel32::GetDiskFreeSpaceEx(tr0,*l,*l,*l.r0)<br />
<br />
If I try to get free space on C:\ everything is correct, but if try in other drive the values are not correct. I'm sure that happens because I don't know wich parameter I should change so I had started using ${DriveSpace} but it happens something that I don't understand.<br />
<br />
Using ${DriveSpace} I can get any value of any drives.<br />
<br />
The problem happens when I try to compare some values. If I compare free space of C:\ or D:\ or H:\ (this is a USB pen) everything works but when I compare with my E:\ (it's a recovery partition) the conditions commands give me wrong value.<br />
<br />
For example:<br />
${GetRoot} $MYPATH1 $1<br />
${DriveSpace} &quot;$1\&quot; &quot;/D=F /S=B&quot; $1<br />
<br />
${GetRoot} $MYPATH2 $2<br />
${DriveSpace} $MYPATH2 <br />
<br />
${If} &quot;$MYPATH1 &quot; U&gt;= &quot;$MYPATH2&quot;<br />
   MessageBox MB_OK &quot;PATH1 &gt;= PATH2&quot;<br />
${Else}<br />
   MessageBox MB_OK &quot;PATH1 &lt; PATH2&quot;<br />
${EndIf}<br />
<br />
If MYPATH1 and MYPATH2 is C:\, F:\ D:\, I obtain correct results but when is E:\ (the partition recovery) the value is apparently correct but the condition script doesn't work.<br />
<br />
The problem should be on the variable format so I tried to see what happens if I do this but I get a negative value:<br />
System::Int64Op $MYPATH1 * 1<br />
Pop $MYPATH1<br />
<br />
Any one have a suggestion to solve this problem?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">10th August 2010, 20:18</div></div><div class="posttext">Looks like you had posted this to a separate thread as well - see there :)<br />
http://forums.winamp.com/showthread.php?t=321543 - &quot;${DriveSpace} and some strange values &quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">orecchionebruno</div><div class="date">11th August 2010, 10:19</div></div><div class="posttext">Hi Animaether, I'm sorry upper I made a mistake translating my variables. I correct the script, but the problem that I wrote is that happens.<br />
<br />
${GetRoot} $MYPATH1 $1<br />
${DriveSpace} &quot;$1\&quot; &quot;/D=F /S=B&quot; $FreeSpace1<br />
<br />
${GetRoot} $MYPATH2 $2<br />
${DriveSpace} &quot;$2\&quot; &quot;/D=F /S=B&quot; $FreeSpace2<br />
<br />
${If} &quot;$FreeSpace1&quot; U&gt;= &quot;$FreeSpace2&quot;<br />
MessageBox MB_OK &quot;PATH1 &gt;= PATH2&quot;<br />
${Else}<br />
MessageBox MB_OK &quot;PATH1 &lt; PATH2&quot;<br />
${EndIf}<br />
<br />
_____<br />
As Animaether wrote, this discussion continue here:<br />
http://forums.winamp.com/showthread.php?t=321543<br />
<br />
Thanksss</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">11th August 2010, 10:21</div></div><div class="posttext">orecchionebruno, please stop posting in two threads at once. Use the other thread, not this one.<br />
<br />
(And please don't reply to this post, either.)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>