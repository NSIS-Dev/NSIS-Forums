<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Help with System::call, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Help with System::call NSIS Discussion" />
	
	<title> Help with System::call [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Help with System::call</div>
<hr />
<div class="pda"><a href="t-281033.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=281033">Help with System::call</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">tigereye</div><div class="date">8th November 2007, 20:10</div></div><div class="posttext">Trying to figure out system::call to get to an external .dll that I've written.<br />
<br />
The DLL's function declaration is pretty simple.  It takes a string to search for, and returns a boolean whether it's installed:<br />
<br />
__declspec(dllexport) int __cdecl CheckProductInstalled(LPTSTR)<br />
<br />
I've tried various versions of the system::call string, but I think this is correct, based on what I can get from the readme.<br />
<br />
System::Call 'EnumProductsDLL.dll::CheckProductInstalled(t r0) i.r2?e'<br />
<br />
Where $0 contains the string to search for.<br />
<br />
However, I keep getting 'error' back in $2.  If I pop the stack to get the lastdllerror I always get 0.<br />
<br />
I don't think I'm actually getting to the .dll because there is some debug logic in the .dll that doesn't appear to be happening.<br />
<br />
Anything obvious where I might have messed up?<br />
<br />
Thanks,<br />
<br />
Mike</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th November 2007, 20:52</div></div><div class="posttext">You are using cdecl. The default is stdcall. Use ?c.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th November 2007, 23:05</div></div><div class="posttext">Seems to me like System can't find the DLL. Have you extracted it somewhere it can be found?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tigereye</div><div class="date">9th November 2007, 19:46</div></div><div class="posttext">Thanks for the help.<br />
<br />
Afrow,<br />
<br />
I tried with both ?c and removing the cdecl from the declaration, same results.<br />
<br />
Kickik<br />
<br />
I am extracting the file immediately before this call.  The logic from my test program is below:<br />
INSTDIR is set to C:\temp<br />
<br />
  SetOutPath $INSTDIR<br />
  file &quot;enumproductsdll.dll&quot;<br />
  strcpy $0 'Symantec Antivirus'<br />
  System::Call 'EnumProductsDLL.dll::CheckProductInstalled(t r0) i.r2?e'<br />
  messagebox mb_ok $2<br />
  pop $5<br />
  messagebox mb_ok $5<br />
<br />
Thanks,<br />
<br />
Mike</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th November 2007, 19:50</div></div><div class="posttext">Are you sure all of its dependencies can also be loaded? Open it from that directory with Dependency Walker (http://www.dependencywalker.com/) to make sure.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tigereye</div><div class="date">9th November 2007, 20:32</div></div><div class="posttext">Originally posted by kichik <br />
Are you sure all of its dependencies can also be loaded? Open it from that directory with Dependency Walker (http://www.dependencywalker.com/) to make sure.  <br />
<br />
Hmmm... well, that was at least part of the problem (hadn't statically linked it to msvcrt8).  However, after doing that, am still having issues.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th November 2007, 20:41</div></div><div class="posttext">Well, that's about it. Either the DLL can not be found due to a typo or wrong search path or it can't be loaded due to missing dependencies. Unless you're trying to load x86 DLL on x64, which is quite impossible considering NSIS doesn't build on x64, it's those two.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>