<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" how to get value from  droplist, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  how to get value from  droplist NSIS Discussion" />
	
	<title> how to get value from  droplist [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  how to get value from  droplist</div>
<hr />
<div class="pda"><a href="t-249419.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=249419">how to get value from  droplist</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">bigbluestranger</div><div class="date">23rd June 2006, 09:03</div></div><div class="posttext">Hi,<br />
I'm creating install program and I've used droplist in ini file like this:<br />
[Field 5]<br />
Type=Droplist<br />
;Flags=NOTIFY<br />
State=COM1<br />
ListItems=COM1|COM2|COM3|COM4|COM5<br />
Left=180<br />
Right=230<br />
Top=10<br />
Bottom=22<br />
<br />
Everything works good, but I don't know how to read value, which is set by user.<br />
Please help me.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd June 2006, 09:18</div></div><div class="posttext">Value is stroed in State, which must be read with MUI_INSTALLOPTIONS_READ (for Modern UI) or ReadINIStr (classic UI).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rajiv naravane</div><div class="date">20th September 2006, 04:36</div></div><div class="posttext">A related question to Afrow UK: Is it OK to use ReadINIStr in Modern UI instead of using MUI_INSTALLOPTIONS_READ -- Would it cause any errors?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th September 2006, 12:27</div></div><div class="posttext">No.<br />
These will do exactly the same thing:<br />
<br />
ReadINIStr $R0 &quot;$PLUGINSDIR\file.ini&quot; &quot;Field 1&quot; &quot;State&quot;<br />
<br />
!insertmacro MUI_INSTALLOPTIONS_READ $R0 &quot;file.ini&quot; &quot;Field 1&quot; &quot;State&quot;<br />
<br />
Notice the only difference is that with MUI_INSTALLOPTIONS_READ you don't need to specify $PLUGINSDIR in the path.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rajiv naravane</div><div class="date">20th September 2006, 14:39</div></div><div class="posttext">Thank you Afrow UK. My only concern is, I modify the .ini for the next page based on the selections in the current page, in which case, I believe a copy residing in $PLUGINSDIR\file.ini is what I want to write to -- Am I correct?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th September 2006, 17:11</div></div><div class="posttext">Yes. MUI_INSTALLOPTIONS_READ is what you can use.<br />
You'd resort to using ReadINIStr with Classic UI or if your INI file isn't under $PLUGINSDIR.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rajiv naravane</div><div class="date">20th September 2006, 17:14</div></div><div class="posttext">Thanks a lot</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sayo9394</div><div class="date">11th December 2006, 05:56</div></div><div class="posttext">Hello Afrow,<br />
<br />
i would really appreciate it if you can help with this problem. <br />
i have the following ini file;<br />
<br />
[Field 3]<br />
Type=Droplist<br />
Flags=NOTIFY<br />
State=1- Full Installation<br />
ListItems=1- Full Installation|2- HMI Host|3- Database Host|4- Helmsman<br />
Left=4<br />
Right=-10<br />
Top=22<br />
Bottom=32<br />
<br />
[Field 4]<br />
Type=text<br />
Left=0<br />
Right=-1<br />
Top=64<br />
Bottom=-4<br />
flags=MULTILINE|VSCROLL|READONLY<br />
State=&quot;Description:\r\n\r\nFull Installation:\r\nThis type of installation will install the following:\r\n1 \<br />
       - MySQL Server 5.0\r\n2 - HPS_DB Database and IS3 Database\r\n3 - ISSS Suite including HMI and Helmsman\r\n4 \<br />
       - SevenCs Charts\r\nIt will also configure the system to Auto Admin Logon&quot;<br />
<br />
<br />
what i wish to do is that according to the option chosen by the user in the drop list, the state in field 4 should change automatically.<br />
i tried the following, but nothing is happening...<br />
<br />
Function ShowCustom<br />
<br />
  !insertmacro MUI_HEADER_TEXT &quot;$(TEXT_IO_TITLE)&quot; &quot;$(TEXT_IO_SUBTITLE)&quot;<br />
<br />
  ; Initialise the dialog but don't show it yet<br />
  InstallOptions::initDialog /NOUNLOAD &quot;$PLUGINSDIR\testnotify.ini&quot;<br />
  ; In this mode InstallOptions returns the window handle so we can use it<br />
  Pop $0<br />
  ; Now show the dialog and wait for it to finish<br />
  InstallOptions::show<br />
  ; Finally fetch the InstallOptions status value (we don't care what it is though)<br />
  Pop $0<br />
FunctionEnd<br />
<br />
Function LeaveCustom<br />
  ReadINIStr $0 &quot;$PLUGINSDIR\testnotify.ini&quot; &quot;Settings&quot; &quot;State&quot;<br />
<br />
  StrCmp $0 0 validate  ; Next button?<br />
  StrCmp $0 3 comboBox ; Full install or DB<br />
  Abort ; Return to the page<br />
<br />
comboBox:<br />
  ReadINIStr $0 &quot;$PLUGINSDIR\testnotify.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
  ;messagebox mb_ok $0<br />
  strcmp $0 &quot;1- Full Installation&quot; 0 +6<br />
      WriteINIStr &quot;$PLUGINSDIR\testnotify.ini&quot; &quot;Field 4&quot; &quot;State&quot; &quot;Description:\r\n\r\nFull Installation:\r\nThis type of installation will install the following:\r\n1 - MySQL Server 5.0\r\n2 \<br />
- HPS_DB Database and IS3 Database\r\n3 - ISSS Suite including HMI and Helmsman\r\n4 - \<br />
SevenCs Charts\r\nIt will also configure the system to Auto Admin Logon&quot;<br />
      IfErrors 0 +2<br />
         messagebox mb_ok &quot;Error writting to ini file&quot;<br />
      messagebox mb_ok $0<br />
      abort<br />
  strcmp $0 &quot;2- HMI Host&quot; 0 +5<br />
      WriteINIStr &quot;$PLUGINSDIR\testnotify.ini&quot; &quot;Field 4&quot; &quot;State&quot; &quot;Description:\r\n\r\nHMI Host:\r\nThis will install the HMI on this machine&quot;<br />
      IfErrors 0 +2<br />
         messagebox mb_ok &quot;Error writting to ini file&quot;<br />
      abort<br />
  strcmp $0 &quot;3- Database Host&quot; 0 +5<br />
      WriteINIStr &quot;$PLUGINSDIR\testnotify.ini&quot; &quot;Field 4&quot; &quot;State&quot; &quot;Description:\r\n\r\nDatabase Host:\r\nThis will install the following:\r\n1 - MySQL Server 5.0\r\n2 \ <br />
       - HPS_DB Database and IS3 Database\r\n3 - ISSS Suite (Except HMI and Helmsman apps)\r\n4 \  <br />
       - SevenCs Charts\r\nIt will also configure the system to Auto Admin Logon&quot;<br />
      IfErrors 0 +2<br />
         messagebox mb_ok &quot;Error writting to ini file&quot;<br />
      abort<br />
  strcmp $0 &quot;4- Helmsman&quot; 0 +4<br />
      WriteINIStr &quot;$PLUGINSDIR\testnotify.ini&quot; &quot;Field 4&quot; &quot;State&quot; &quot;Description:\r\n\r\nFull Installation:\r\nThis will install the Helmsman add&quot;<br />
      IfErrors 0 +2<br />
         messagebox mb_ok &quot;Error writting to ini file&quot;<br />
      abort<br />
validate:<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">11th December 2006, 06:43</div></div><div class="posttext">Hi Simon!<br />
<br />
The ini file isn't read again by the installer. You have to send the text by sendmessage.<br />
<br />
This macro is doing everything you need. Write the text to the ini file, in case you want to use back/next buttons and send it directly to the textbox.<br />
<br />
<br />
;change text field and put value in ini file<br />
!macro CHANGETEXTFIELD ELEMENT VALUE<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE ${VALUE} &quot;my.ini&quot; &quot;${ELEMENT}&quot; &quot;State&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $tmp &quot;my.ini&quot; &quot;${ELEMENT}&quot; &quot;HWND&quot;<br />
  SendMessage $tmp ${WM_SETTEXT} 0 &quot;STR:${VALUE}&quot;<br />
!macroend<br />
<br />
<br />
Cheers<br />
<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sayo9394</div><div class="date">11th December 2006, 07:59</div></div><div class="posttext">Originally posted by bholliger <br />
Hi Simon!<br />
<br />
The ini file isn't read again by the installer. You have to send the text by sendmessage.<br />
<br />
This macro is doing everything you need. Write the text to the ini file, in case you want to use back/next buttons and send it directly to the textbox.<br />
<br />
<br />
;change text field and put value in ini file<br />
!macro CHANGETEXTFIELD ELEMENT VALUE<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE ${VALUE} &quot;my.ini&quot; &quot;${ELEMENT}&quot; &quot;State&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $tmp &quot;my.ini&quot; &quot;${ELEMENT}&quot; &quot;HWND&quot;<br />
  SendMessage $tmp ${WM_SETTEXT} 0 &quot;STR:${VALUE}&quot;<br />
!macroend<br />
<br />
<br />
Cheers<br />
<br />
Bruno  <br />
Hello Bruno,<br />
Thank you for ur quick responce.<br />
while trying your macro, $tmp was returning an error, so i just changed it $1.<br />
<br />
in function LeaveCustom (shown above)<br />
i did the following,<br />
<br />
!macro CHANGETEXTFIELD ELEMENT VALUE<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;${VALUE}&quot; &quot;testnotify.ini&quot; &quot;${ELEMENT}&quot; &quot;State&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $1 &quot;$testnotify.ini&quot; &quot;${ELEMENT}&quot; &quot;HWND&quot;<br />
  SendMessage $1 ${WM_SETTEXT} 0 &quot;STR:${VALUE}&quot;<br />
!macroend<br />
<br />
Function LeaveCustom<br />
  ReadINIStr $0 &quot;$PLUGINSDIR\testnotify.ini&quot; &quot;Settings&quot; &quot;State&quot;<br />
<br />
  StrCmp $0 0 validate  ; Next button?<br />
  StrCmp $0 3 comboBox ; Full install or DB<br />
  Abort ; Return to the page<br />
<br />
comboBox:<br />
  ReadINIStr $0 &quot;$PLUGINSDIR\testnotify.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
  messagebox mb_ok $0<br />
  strcmp $0 &quot;1- Full Installation&quot; 0 +3<br />
      !insertmacro CHANGETEXTFIELD &quot;Field 4&quot; &quot;Description:$\r$\n$\r$\nFull Installation:$\r$\nThis type of installation will install the following:$\r$\n1 \ <br />
            - MySQL Server 5.0$\r$\n2 - HPS_DB Database and IS3 Database$\r$\n3 - ISSS Suite including HMI and Helmsman$\r$\n4 \ <br />
            - SevenCs Charts$\r$\nIt will also configure the system to Auto Admin Logon&quot;<br />
      abort<br />
  strcmp $0 &quot;2- HMI Host&quot; 0 +3<br />
      !insertmacro CHANGETEXTFIELD &quot;Field 4&quot; &quot;Description:$\r$\n$\r$\nHMI Host:$\r$\nThis will install the HMI on this machine&quot;<br />
      abort<br />
  strcmp $0 &quot;3- Database Host&quot; 0 +3<br />
      !insertmacro CHANGETEXTFIELD &quot;Field 4&quot; &quot;Description:$\r$\n$\r$\nDatabase Host:$\r$\nThis will install the following:$\r$\n1 \ <br />
            - MySQL Server 5.0$\r$\n2 - HPS_DB Database and IS3 Database$\r$\n3 \ <br />
            -ISSS Suite (Except HMI and Helmsman apps)$\r$\n4 - SevenCs Charts$\r$\nIt will also configure the system to Auto Admin Logon&quot;<br />
      abort<br />
  strcmp $0 &quot;4- Helmsman&quot; 0 +3<br />
      !insertmacro CHANGETEXTFIELD &quot;Field 4&quot; &quot;Description:$\r$\n$\r$\nFull Installation:$\r$\nThis will install the Helmsman app&quot;<br />
  abort<br />
      <br />
validate:<br />
<br />
FunctionEnd<br />
<br />
<br />
Now this has given me some weird behavior, it will only write to window for first option and not the rest.<br />
<br />
thanx again :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">11th December 2006, 10:45</div></div><div class="posttext">Hi Simon!<br />
<br />
I think StrCmp in conjunction with relative jumps and macros is a bit difficult. Why don't you use the excellent flow control functions provided by logiclib?<br />
<br />
Like ${Switch} ... ${Case} ... ${EndSwitch}? That might solve the problem.<br />
<br />
Cheers<br />
<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sayo9394</div><div class="date">12th December 2006, 01:14</div></div><div class="posttext">Cheers Bruno,<br />
<br />
your definitely the man, it worked perfectly with Logiclib. i was afraid this day will come where i have to fix my script to use LogicLib, and MUI insertmacro calls...<br />
<br />
i only went along with Classic UI because more examples exist.<br />
<br />
cheers mate,<br />
Simon</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">12th December 2006, 01:36</div></div><div class="posttext">Hi Simon!<br />
<br />
Thanks for your feedback. Well, logiclib might be a bit confusing. But with time you'll see that it is convenient and easy to use. And the best of all it's a lot clearer than StrCmp ... +4.<br />
<br />
Greetings from Sydney!<br />
<br />
Cheers<br />
<br />
Bruno</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>