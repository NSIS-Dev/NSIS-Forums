<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Win2k SP3 and up, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Win2k SP3 and up NSIS Discussion" />
	
	<title> Win2k SP3 and up [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Win2k SP3 and up</div>
<hr />
<div class="pda"><a href="t-241130.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=241130">Win2k SP3 and up</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">coco_vc</div><div class="date">17th March 2006, 18:05</div></div><div class="posttext">Hi all,<br />
<br />
My app should be installed only on Win2000 ServicePack 3 and up, so at the beginning I have to check for this. How can I check this?<br />
<br />
Thx,<br />
Viv</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dienjd</div><div class="date">17th March 2006, 18:44</div></div><div class="posttext">You can use a plug-in (http://nsis.sourceforge.net/wiki/File:GetVersion.zip) or some (http://nsis.sourceforge.net/Get_Windows_version) functions (http://nsis.sourceforge.net/Get_last_installed_service_pack_version).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">19th March 2006, 16:25</div></div><div class="posttext">if you require a specific Win32 API function you can call LoadLibrary and GetProcAddress with the system plugin on the .dll containing the func</div></div><hr />


<div class="post"><div class="posttop"><div class="username">coco_vc</div><div class="date">21st March 2006, 16:08</div></div><div class="posttext">Hi all,<br />
<br />
Thanks for your answers.<br />
<br />
1) I can't use the plugin as one of my requirements is that my script needs to be compilable by anybody who downloads the version of the NSIS specified in some docu. So I can't ask those to download a dll and to put it somewhere.<br />
2) so I used the other functions in order to accomplish what I need<br />
3) I'll post here the code I wrote to check if it's Win2000 ServicePack 3 and up<br />
<br />
<br />
; check that we have the correct OS and ServicePack otherwise abort. We need Win2000 SP3 and up<br />
Function checkCorrectOSandServicePack<br />
#   read the registry entry SOFTWARE\Microsoft\Windows NT\CurrentVersion&quot; CurrentVersion<br />
#   - if it doesn't exists, we are on Win9x systems, so not OK<br />
#   - if it starts with 3 or 4 we are on WinNT system, so not OK<br />
#   - 5.0, 5.1, 5.2 mean Win2k, XP, 2003, so are OK for us.<br />
  ReadRegStr $OSVer HKLM &quot;SOFTWARE\Microsoft\Windows NT\CurrentVersion&quot; CurrentVersion<br />
  IntCmp $OSVer 5 IS_Win2000_OrMore Not_OK_OS_Or_ServicePack OK_OS_And_ServicePack ; IntCmp compares only integers, so we can't compare with 5.0, but here we don't need to, but to keep in mind that if the result is equal, means it's 5.x so Win2k and up<br />
IS_Win2000_OrMore:<br />
    ; check in case of Win2000 if also Service Pack is correct (for Win2000 it should be SP3 or up)<br />
    StrCmp $OSVer &quot;5.0&quot; 0 OK_OS_And_ServicePack ; it's Win2000 or it's more?<br />
      call GetServicePack ; http://nsis.sourceforge.net/wiki/Get_last_installed_service_pack_version<br />
      Pop $ServicePack<br />
      Pop $MinorServicePack ; just to clean the stack<br />
      IntCmp $ServicePack 3 OK_OS_And_ServicePack Not_OK_OS_Or_ServicePack OK_OS_And_ServicePack<br />
Not_OK_OS_Or_ServicePack:<br />
    MessageBox MB_ICONEXCLAMATION|MB_OK &quot;You need Win2000 with ServicePack 3 and up&quot;<br />
    Quit ; quit the whole installer<br />
OK_OS_And_ServicePack:<br />
FunctionEnd<br />
<br />
<br />
Seems to be working, but if smbd sees a problem with this method pls tell me about it.<br />
<br />
4) one more issue: I used the function to get the windows service pack from here: http://nsis.sourceforge.net/wiki/Get_last_installed_service_pack_version but I noticed that in the post from here http://forums.winamp.com/showthread.php?s=&amp;threadid=156031&amp;highlight=CSDVersion cjs says that &quot;CSD Version outputs &quot;SERVICE PACK (NUMBER)&quot;&quot;. This is weird as the function from wiki uses the implementation like there will always be only a number, so no &quot;service pack&quot; string in front of the number. Anybody knowing more about this issue?<br />
<br />
Thx,<br />
Viv</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>