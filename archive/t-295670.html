<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Mistake in a script... I can not understand where..., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Mistake in a script... I can not understand where... NSIS Discussion" />
	
	<title> Mistake in a script... I can not understand where... [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Mistake in a script... I can not understand where...</div>
<hr />
<div class="pda"><a href="t-295670.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=295670">Mistake in a script... I can not understand where...</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">and84</div><div class="date">8th August 2008, 07:58</div></div><div class="posttext">Hi all! <br />
Has written a script with custom page... <br />
Here a part of a script...<br />
.... <br />
Page license <br />
Page custom CustomFun &quot;&quot; &quot;&quot; <br />
!insertmacro MUI_PAGE_INSTFILES <br />
<br />
ReserveFile &quot;${NSISDIR}\Plugins\InstallOptions.dll&quot; <br />
ReserveFile &quot;page.ini&quot; <br />
<br />
!insertmacro MUI_LANGUAGE &quot;Russian&quot; <br />
<br />
Section &quot;-Install&quot; <br />
... <br />
SectionEnd <br />
<br />
Function .oninit <br />
         InitPluginsDir <br />
         File /oname=$PLUGINSDIR\page.ini &quot;page.ini&quot; <br />
Functionend <br />
<br />
Function CustomFun <br />
         !insertmacro MUI_HEADER_TEXT &quot;TEXT1&quot; &quot;TEXT2&quot; <br />
         !insertmacro INSTALLOPTIONS_INITDIALOG &quot;page.ini&quot; <br />
         !insertmacro INSTALLOPTIONS_SHOW <br />
FunctionEnd<br />
The section of installation is carried out two times. I can not understand why. <br />
Probably I was mistaken in macros. <br />
<br />
Help please. <br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pospec</div><div class="date">8th August 2008, 12:56</div></div><div class="posttext">You have to post a whole script if you want help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">and84</div><div class="date">8th August 2008, 17:11</div></div><div class="posttext">Originally posted by pospec <br />
You have to post a whole script if you want help. <br />
All script... <br />
!include &quot;MUI.nsh&quot;<br />
!include &quot;Locate.nsh&quot;<br />
<br />
Name &quot;Setup&quot;<br />
OutFile &quot;Setup.exe&quot;<br />
Caption 'Setup: ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ'<br />
SubCaption 0 &quot; &quot;<br />
CRCCheck on<br />
XPStyle on<br />
MiscButtonText &quot;ÐÐ°Ð·Ð°Ð´&quot; &quot;Ð’Ð¿ÐµÑ€ÐµÐ´&quot; &quot;ÐŸÑ€ÐµÑ€Ð²Ð°Ñ‚ÑŒ&quot; &quot;Ð“Ð¾Ñ‚Ð¾Ð²Ð¾&quot;<br />
InstallButtonText &quot;ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ&quot;<br />
ShowInstDetails show<br />
CompletedText &quot;ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾! Ð”Ð»Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ ÐºÐ½Ð¾Ð¿ÐºÑƒ 'Ð“Ð¾Ñ‚Ð¾Ð²Ð¾'&quot;<br />
<br />
Var url<br />
Var ip<br />
Var lnk<br />
Var ini_xz<br />
Var ip_add<br />
<br />
Var HWND1<br />
Var DLGITEM<br />
Var FONT<br />
<br />
Page license <br />
Page custom SetCustom &quot;&quot; &quot;&quot;<br />
!insertmacro MUI_PAGE_INSTFILES<br />
Licensetext &quot; &quot; &quot;ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ&quot;<br />
LicenseData &quot;lic1.rtf&quot;<br />
LicenseBkColor /windows<br />
LicenseForceSelection checkbox &quot;Ð¯ Ð¿Ñ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð» ÑÐ¾Ð³Ð»Ð°ÑˆÐµÐ½Ð¸Ðµ Ð¸ ÑÐ¾Ð³Ð»Ð°ÑÐµÐ½ Ñ ÐµÐ³Ð¾ ÑƒÑÐ»Ð¾Ð²Ð¸ÑÐ¼Ð¸!&quot;<br />
<br />
ReserveFile &quot;${NSISDIR}\\Plugins\\InstallOptions.dll&quot;<br />
ReserveFile &quot;page.ini&quot;<br />
<br />
!insertmacro MUI_LANGUAGE &quot;Russian&quot;<br />
<br />
Section &quot;-init&quot;<br />
        StrCpy $url &quot;Error&quot;<br />
        StrCpy $ip &quot;OFF&quot;<br />
        StrCpy $lnk &quot;OFF&quot;<br />
        ReadINIStr $ini_xz &quot;$PLUGINSDIR\\page.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
        StrCmp $ini_xz &quot;1&quot; 0 +3<br />
        StrCpy $url &quot;http://22.10.10.120/load&quot;<br />
        StrCpy $ip_add &quot;22.10.10.120&quot;<br />
        ReadINIStr $ini_xz &quot;$PLUGINSDIR\\page.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
        StrCmp $ini_xz &quot;1&quot; 0 +3<br />
        StrCpy $url &quot;http://10.1.1.177/load&quot;<br />
        StrCpy $ip_add &quot;10.1.1.177&quot;<br />
        ReadINIStr $ini_xz &quot;$PLUGINSDIR\\page.ini&quot; &quot;Field 4&quot; &quot;State&quot;<br />
        StrCmp $ini_xz &quot;1&quot; 0 +3<br />
        StrCpy $ip &quot;OK&quot;<br />
        ReadINIStr $ini_xz &quot;$PLUGINSDIR\\page.ini&quot; &quot;Field 12&quot; &quot;State&quot;<br />
        StrCmp $ini_xz &quot;1&quot; 0 +3<br />
        StrCpy $lnk &quot;OK&quot;<br />
SectionEnd<br />
Section &quot;-Install&quot;<br />
        StrCpy $2 &quot;0&quot;<br />
        StrCmp $url &quot;Error&quot; 0 urlOK<br />
        DetailPrint &quot;ÐžÑˆÐ¸Ð±ÐºÐ°: ÐÐµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ URL=$url(58x59x60x77x78)!&quot;<br />
        goto error<br />
        urlOK:<br />
        SetOutPath $EXEDIR<br />
        DetailPrint &quot;Ð¡Ð¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ñ ÑÐµÑ€Ð²ÐµÑ€Ð¾Ð¼...&quot;<br />
        DetailPrint &quot;Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ„Ð°Ð¹Ð» data.ini Ñ ÑÐµÑ€Ð²ÐµÑ€Ð°...&quot;<br />
        NSISdl::download /TRANSLATE &quot;Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ„Ð°Ð¹Ð» data.ini Ñ ÑÐµÑ€Ð²ÐµÑ€Ð°...&quot; &quot;Ð¡Ð¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ñ ÑÐµÑ€Ð²ÐµÑ€Ð¾Ð¼...&quot; &quot;ÑÐµÐº.&quot; &quot;Ð¼Ð¸Ð½.&quot; &quot;Ñ‡.&quot; &quot;c&quot; &quot;%d ÐšÐ± (%d%%) Ð¸Ð· %d ÐšÐ± -- %d.%01d ÐšÐ±/Ñ&quot; &quot; ( %d %s Ð¾ÑÑ‚Ð°Ð»Ð¾ÑÑŒ )&quot; &quot;$url/data.ini&quot; &quot;$EXEDIR\data.ini&quot;<br />
        IfFileExists &quot;$EXEDIR\\data.ini&quot; +4<br />
        goto error<br />
        DetailPrint &quot;Ð§Ñ‚ÐµÐ½Ð¸Ñ Ñ„Ð°Ð¹Ð»Ð°...&quot;<br />
        next:<br />
        IntOp $2 $2 + 1<br />
        ReadINIStr $R1 '$EXEDIR\\data.ini' 'FILE $2' 'NAME'<br />
        ReadINIStr $R2 '$EXEDIR\\data.ini' 'FILE $2' 'PATH'<br />
        ReadINIStr $R3 '$EXEDIR\\data.ini' 'FILE $2' 'CRC'<br />
        ReadINIStr $R4 '$EXEDIR\\data.ini' 'FILE $2' 'END'<br />
        StrCmp $R2 &quot;system&quot; +3 0<br />
        StrCmp $R2 &quot;BASE&quot; +2 0<br />
        goto end<br />
        IfFileExists &quot;$EXEDIR\$R2\$R1&quot; +2<br />
        goto load<br />
	CRCCheck::GenCRC &quot;$EXEDIR\$R2\$R1&quot;<br />
        Pop $R0<br />
        StrCmp $R0 $R3 end 0<br />
        load:<br />
        NSISdl::download /TRANSLATE &quot;Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹...&quot; &quot;Ð¡Ð¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ñ ÑÐµÑ€Ð²ÐµÑ€Ð¾Ð¼...&quot; &quot;ÑÐµÐº.&quot; &quot;Ð¼Ð¸Ð½.&quot; &quot;Ñ‡.&quot; &quot;c&quot; &quot;%d ÐšÐ± (%d%%) Ð¸Ð· %d ÐšÐ± -- %d.%01d ÐšÐ±/Ñ&quot; &quot; ( %d %s Ð¾ÑÑ‚Ð°Ð»Ð¾ÑÑŒ )&quot; &quot;$url/$R2/$R1&quot; &quot;$EXEDIR\$R2\$R1&quot;<br />
        end:<br />
        StrCmp $R4 &quot;END&quot; 0 +3<br />
        DetailPrint &quot;ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!&quot;<br />
        goto quit<br />
        goto next<br />
        error:<br />
        DetailPrint &quot;ÐžÑˆÐ¸Ð±ÐºÐ°: ÐÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ñ„Ð°Ð¹Ð»Ñƒ!&quot;<br />
        DetailPrint &quot;ÐžÐ±Ñ€Ð°Ñ‚Ð¸Ñ‚ÐµÑÑŒ Ð² Ñ‚ÐµÑ…. Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÑƒ Ð½Ð° Ñ„Ð¾Ñ€ÑƒÐ¼Ðµ!&quot;<br />
        quit:<br />
SectionEnd<br />
<br />
Section &quot;-host&quot;<br />
         StrCmp $ip &quot;OFF&quot; 0 +3<br />
         DetailPrint &quot;Ð’ÐÐ–ÐÐž! ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð½Ð°Ñ‚ÑÑ€Ð¾Ð¸Ñ‚ÑŒ Ð¥Ð¾ÑÑ‚ Ñ„Ð°Ð¸Ð»...&quot;<br />
         Goto exit<br />
         CopyFiles $SYSDIR\\drivers\\etc\\hosts $SYSDIR\\drivers\\etc\\hosts.bak<br />
         FileOpen $0 $SYSDIR\\drivers\\etc\\hosts w<br />
         DetailPrint &quot;ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ñ…Ð¾ÑÑ‚ Ñ„Ð°Ð¹Ð»Ð°...&quot;<br />
         FileWrite $0 &quot;127.0.0.1              localhost$\n&quot;<br />
         FileWrite $0 &quot;$ip_add         Info.DT.net$\n&quot;<br />
         FileWrite $0 &quot;$ip_add         help.DT.net$\n&quot;<br />
         FileClose $0<br />
         exit:<br />
SectionEnd<br />
<br />
<br />
Function .oninit<br />
         System::Call 'kernel32::CreateMutexA(i 0, i 0, t &quot;myMutex&quot;) i .r1 ?e'<br />
         Pop $0<br />
         StrCmp $0 0 +3<br />
         MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Setup.exe ÑƒÐ¶Ðµ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½!&quot;<br />
         Abort<br />
         IfFileExists &quot;$EXEDIR\system\RunDT.exe&quot; +2<br />
         MessageBox MB_ICONSTOP|MB_OK &quot;Setup.exe Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ð¸Ð· Ð¿Ð°Ð¿ÐºÐ¸ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹ DT!&quot; IDOK +2<br />
         MessageBox MB_USERICON|MB_YESNO|MB_DEFBUTTON1 &quot;ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð’Ð°Ñˆ ÐºÐ»Ð¸ÐµÐ½Ñ‚?&quot; IDYES +2<br />
         Abort<br />
         InitPluginsDir<br />
         File /oname=$PLUGINSDIR\\page.ini &quot;page.ini&quot;<br />
Functionend<br />
<br />
Function SetCustom<br />
         !insertmacro MUI_HEADER_TEXT &quot;TEXT1&quot; &quot;TEXT2&quot;<br />
         !insertmacro INSTALLOPTIONS_INITDIALOG &quot;page.ini&quot;<br />
         !insertmacro INSTALLOPTIONS_READ $DLGITEM &quot;page.ini&quot; &quot;Field 1&quot; &quot;HWND&quot; ; Ð’Ñ‹Ð±Ð¾Ñ€<br />
                      CreateFont $FONT &quot;Tahoma&quot; 8 700<br />
                      SendMessage $DLGITEM ${WM_SETFONT} $FONT 0<br />
         !insertmacro INSTALLOPTIONS_READ $DLGITEM &quot;page.ini&quot; &quot;Field 5&quot; &quot;HWND&quot; ; Ð¥Ð¾ÑÑ‚<br />
                      CreateFont $FONT &quot;Tahoma&quot; 8 700<br />
                      SendMessage $DLGITEM ${WM_SETFONT} $FONT 0<br />
         !insertmacro INSTALLOPTIONS_READ $DLGITEM &quot;page.ini&quot; &quot;Field 7&quot; &quot;HWND&quot; ; ÐŸ ÐÐµÑ‚<br />
                      CreateFont $FONT &quot;Tahoma&quot; 8 300 /UNDERLINE<br />
                      SendMessage $DLGITEM ${WM_SETFONT} $FONT 0<br />
         !insertmacro INSTALLOPTIONS_READ $DLGITEM &quot;page.ini&quot; &quot;Field 9&quot; &quot;HWND&quot; ; ÐŸ Ð_ÐµÐ°Ð»<br />
                      CreateFont $FONT &quot;Tahoma&quot; 8 300 /UNDERLINE<br />
                      SendMessage $DLGITEM ${WM_SETFONT} $FONT 0<br />
         !insertmacro INSTALLOPTIONS_READ $DLGITEM &quot;page.ini&quot; &quot;Field 6&quot; &quot;HWND&quot;<br />
                      CreateFont $FONT &quot;Tahoma&quot; 8 300 /UNDERLINE<br />
                      SendMessage $DLGITEM ${WM_SETFONT} $FONT 0<br />
         !insertmacro INSTALLOPTIONS_READ $DLGITEM &quot;test.ini&quot; &quot;Field 2&quot; &quot;HWND&quot;<br />
                      CreateFont $FONT &quot;Tahoma&quot; 8 400<br />
                      SendMessage $DLGITEM ${WM_SETFONT} $FONT 0<br />
         !insertmacro INSTALLOPTIONS_SHOW<br />
FunctionEnd<br />
<br />
Function .onInstSuccess<br />
         StrCmp $lnk &quot;OK&quot; 0 +2<br />
         DetailPrint &quot;Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÑ€Ð»Ñ‹ÐºÐ° Ð½Ð° Ñ€Ð°Ð±Ð¾Ñ‡ÐµÐ¼ ÑÑ‚Ð¾Ð»Ðµ...&quot;<br />
         CreateShortCut &quot;$DESKTOP\RunDT.lnk&quot; &quot;$EXEDIR\system\RunDT.exe&quot; &quot;&quot; &quot;$EXEDIR\system\DT.ico&quot;<br />
FunctionEnd<br />
<br />
Structure page.ini<br />
[Settings]<br />
NumFields=12<br />
<br />
[Field 1]<br />
Type=GroupBox<br />
Left=0<br />
Right=-1<br />
Top=1<br />
Bottom=-65<br />
Text=&quot; ÐÐ°Ñ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ... &quot;<br />
<br />
[Field 2]<br />
Type=RadioButton<br />
Text=Ð¯ Ð¸Ð· Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ Home<br />
Left=10<br />
Right=-10<br />
Top=14<br />
Bottom=22<br />
State=1<br />
Flags=/NOTIFY<br />
<br />
[Field 3]<br />
Type=RadioButton<br />
Text=Ð¯ Ð¸Ð· Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ ÑÐµÑ‚Ð¸ DT<br />
Left=10<br />
Right=-10<br />
Top=47<br />
Bottom=57<br />
State=0<br />
Flags=/NOTIFY<br />
<br />
[Field 4]<br />
Type=checkbox<br />
Text=ÐÐ°ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ Ñ…Ð¾ÑÑ‚-Ñ„Ð°Ð¸Ð»<br />
Left=10<br />
Right=-10<br />
Top=95<br />
Bottom=105<br />
State=1<br />
Flags=NOTABSTOP<br />
<br />
[Field 5]<br />
Type=GroupBox<br />
Left=0<br />
Right=-1<br />
Top=83<br />
Bottom=-1<br />
Text=&quot; Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾... &quot;<br />
<br />
[Field 6]<br />
Type=Label<br />
Left=25<br />
Right=-230<br />
Top=106<br />
Bottom=116<br />
Text=ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ:<br />
<br />
[Field 11]<br />
Type=Label<br />
Left=-227<br />
Right=-5<br />
Top=106<br />
Bottom=116<br />
Text=Ð_ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°.<br />
<br />
[Field 7]<br />
Type=Label<br />
Left=28<br />
Right=-230<br />
Top=25<br />
Bottom=35<br />
Text=ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ:<br />
<br />
[Field 8]<br />
Type=Label<br />
Left=-227<br />
Right=-5<br />
Top=25<br />
Bottom=45<br />
Text=Ð”Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÐ¼Ð¸ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ Home.<br />
<br />
[Field 9]<br />
Type=Label<br />
Left=28<br />
Right=-230<br />
Top=58<br />
Bottom=68<br />
Text=ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ:<br />
<br />
[Field 10]<br />
Type=Label<br />
Left=-227<br />
Right=-5<br />
Top=58<br />
Bottom=68<br />
Text=Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ ÑÐµÑ‚Ð¸.<br />
<br />
[Field 12]<br />
Type=checkbox<br />
Text=Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÑ€Ð»Ñ‹Ðº Ð½Ð° Ñ€Ð°Ð±Ð¾Ñ‡ÐµÐ¼ ÑÑ‚Ð¾Ð»Ðµ.<br />
Left=10<br />
Right=-10<br />
Top=121<br />
Bottom=131<br />
State=1<br />
Flags=NOTABSTOP</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>