<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" ExecWait in Uninstall Section, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  ExecWait in Uninstall Section NSIS Discussion" />
	
	<title> ExecWait in Uninstall Section [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  ExecWait in Uninstall Section</div>
<hr />
<div class="pda"><a href="t-82614.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=82614">ExecWait in Uninstall Section</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">maragato</div><div class="date">27th March 2002, 20:58</div></div><div class="posttext">I had problems when I used the ExecWait procedure in Uninstall Section!<br />
<br />
Example:<br />
ExecWait &quot;$WINDIR\notepad.exe&quot;<br />
<br />
The application does not execute! (Only in Uninstall Section, but in all others instalation sections it works.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">27th March 2002, 21:41</div></div><div class="posttext">Maragato,<br />
<br />
I tested it, no problems at my machine! It just works fine. Maybe there are other problems in the installer...<br />
<br />
-Hn3.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">maragato</div><div class="date">28th March 2002, 11:47</div></div><div class="posttext">Please, send me a .nsi file with this case.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">28th March 2002, 14:13</div></div><div class="posttext">The test file:<br />
<br />
if executed it runs and waits for notepad<br />
then it creates $DESKTOP\unprob.exe<br />
<br />
when run this exe it starts notepad.exe again.<br />
<br />
Why wouldn't this not work? Maybe you did something wrong in the rest of the script. Maybe you delete notepad.exe???<br />
<br />
Just a guess... :)<br />
<br />
Good luck,<br />
Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Piotr Strycharz</div><div class="date">9th April 2002, 08:54</div></div><div class="posttext">There is a &quot;feature&quot; (bug?) in NSI scripts.<br />
ExecWait does not work when used after RmDir /r $INSTDIR (this is where I have uninstall executable).<br />
However it may not work in other situations, too, but I have not tested it.<br />
<br />
Solution: Remove $INSTDIR as the last line in your uninstall script.<br />
<br />
These are the fragments of the NSI file:<br />
<br />
; Won't work<br />
Section &quot;Uninstall&quot;<br />
	RMDir /r $INSTDIR<br />
	DeleteRegKey HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\C+Shop v 6.0&quot;<br />
	Call un.RmDLL	; This is where ExecWait is called<br />
SectionEnd<br />
<br />
; Will work<br />
Section &quot;Uninstall&quot;<br />
	DeleteRegKey HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\C+Shop v 6.0&quot;<br />
	Call un.RmDLL<br />
	RMDir /r $INSTDIR<br />
SectionEnd<br />
<br />
Piotr.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">9th April 2002, 10:29</div></div><div class="posttext">Piotr,<br />
<br />
please tell me what this un.RmDll does. If it tries to display some text (readme.txt or something) that is supposed to be in $INSTDIR of course this will not work because you just deleted the file in the original script. So the correction is obvious then. Just do not delete files if you still have to display/execute them.<br />
<br />
But that's my guess for I don't know what this un.RmDll is doing. Just post this script or take a look at it yourself. I expect that this might be the solution to the problem. But I can only tell if there is really a bug or just a mistake in the script when you post the un.RMDLL script.<br />
<br />
Or take a look at the uninstall details (in the uninstall window) If you don't find the ExecWait command there, the uninstall could not find or execute the file.<br />
<br />
Good luck,<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Piotr Strycharz</div><div class="date">9th April 2002, 10:56</div></div><div class="posttext">Hendri,<br />
<br />
I've just removed unnecessary code to make it clear. It does not matter what function un.RmDLL does. There is FULL nsi script at the bottom that does not work.<br />
It should probably run write.exe (it's in system directory, not in \TEMP that is removed).<br />
Please make sure the script removes the \TEMP dir. Actually if it's not removed (eg you have it open in Command Prompt or Explorer) the script runs well.<br />
If you move RMDIR just before SectionEnd - works fine !<br />
<br />
Probably (I did not look at the code) when installer get's removed (and its dir, too) it looses environment (with PATH variable)<br />
<br />
Piotr.<br />
<br />
;<br />
OutFile &quot;Test.exe&quot;<br />
InstallDir &quot;C:\TEMP&quot;<br />
<br />
Section &quot;Install&quot;<br />
	SetOutPath $INSTDIR<br />
	File &quot;C:\WINNT\Notepad.exe&quot;<br />
	WriteUninstaller &quot;$INSTDIR\uninst.exe&quot;<br />
	WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\Test&quot; \<br />
		&quot;DisplayName&quot; &quot;Test&quot;<br />
	WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\Test&quot; \<br />
		&quot;UninstallString&quot; '&quot;$INSTDIR\uninst.exe&quot;'<br />
SectionEnd<br />
<br />
Section &quot;Uninstall&quot;<br />
	RMDir /r $INSTDIR<br />
	ExecWait &quot;write.exe&quot;<br />
	DeleteRegKey HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\Test&quot;<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">9th April 2002, 11:48</div></div><div class="posttext">Piotr,<br />
<br />
take a look at this script:OutFile &quot;Test.exe&quot; <br />
InstallDir &quot;C:\TEMP&quot;<br />
name test <br />
<br />
Section &quot;Install&quot;<br />
SetOutPath $INSTDIR <br />
WriteUnInstaller &quot;$INSTDIR\uninst.exe&quot;<br />
SectionEnd<br />
<br />
Section uninstall<br />
RMDir /r $INSTDIR<br />
SetOutPath $WINDIR<br />
ExecWait &quot;write.exe&quot;<br />
sectionend<br />
It works. Apparently, the problem is that once the dir has been removed, the uninstaller cannot find the path anymore. So we have to set it manually to an existing dir, eg &quot;WinDir&quot;. BTW, the same is true for an installer like this:OutFile &quot;Test.exe&quot; <br />
InstallDir &quot;C:\TEMP&quot;<br />
name test <br />
<br />
Section &quot;Install&quot;<br />
SetOutPath $INSTDIR <br />
RMDir /r $INSTDIR<br />
SetOutPath $WINDIR<br />
ExecWait &quot;write.exe&quot;<br />
SectionEnd<br />
I don't know if this is a bug. It seems a bit logical to me since $INSTDIR does not exists anymore. It has to do with the way Windows manages the path and how it can find it, I guess.<br />
<br />
But it's nice we know of the problem right now and of the solution. So there are no limitations to the script (in terms of deleting dirs ONLY at the end of the uninstall) but just take care that the program can find the files to be run by including the proper path or resetting the current dir to an existing one.<br />
<br />
Good luck, greetz,<br />
-Hendri.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>