<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Help with this system plugin syntax, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Help with this system plugin syntax NSIS Discussion" />
	
	<title> Help with this system plugin syntax [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Help with this system plugin syntax</div>
<hr />
<div class="pda"><a href="t-146688.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=146688">Help with this system plugin syntax</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">22nd August 2003, 21:29</div></div><div class="posttext">!define Browse '(i,i,t,t,i,i,i,i)'<br />
<br />
Function &quot;.onInit&quot;<br />
System::Call 'shell32.dll::SHBrowseForFolderA(*${Browse}) i .r0'<br />
System::Call 'shell32.dll::SHGetPathFromIDListA(i $0, t .r1) i r2'<br />
MessageBox MB_OK|MB_ICONINFORMATION &quot;$1&quot;<br />
FunctionEnd<br />
<br />
<br />
I'm trying to open the choose folder dialog... <br />
A.K.A DirRequest...<br />
<br />
What's wrong... :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">22nd August 2003, 21:58</div></div><div class="posttext">These forums actually have search function implemented ;)<br />
<br />
Usage Example: <br />
     push       &quot;Select folder Demo&quot;<br />
     push       &quot;d:\Program files&quot;<br />
     call       BrowseForFolder<br />
     pop        $0<br />
     MessageBox MB_OK &quot;Selected folder '$0'&quot;<br />
<br />
The code is coming here:<br />
<br />
Function BrowseForFolder<br />
        System::Store &quot;s r8r9&quot;<br />
<br />
        ; Get callback<br />
        System::Get  '(i.s, i.s, i.s, i.s) i ss'<br />
        pop     $0<br />
        <br />
        ; BrowseInfo structure<br />
        System::Call '*(i $HWNDPARENT, i 0, t &quot;&quot;, t r9, i 0x45, k r0, i, i) i.r1'<br />
        System::Call 'shell32::SHBrowseForFolderA(i r1) i.s'<br />
ShBrowse:<br />
        Pop $2<br />
        StrCmp $2 &quot;callback1&quot; 0 ExitBrowse<br />
<br />
        System::Store &quot;s r3r4r5r6&quot;<br />
        ; BFMM_INITIALIZED ?<br />
        IntCmp $4 1 0 exit exit<br />
        ; yes, set the starting dir<br />
        System::Call 'user32::SendMessageA(i $3, i 1126, i 1, t r8) i'<br />
        System::Store &quot;r2r3r4r5r6&quot;<br />
        System::Call &quot;$0&quot; 0<br />
exit:<br />
        ; Restore<br />
        System::Store &quot;l&quot;<br />
        System::Call &quot;$0&quot; 0<br />
        Goto ShBrowse<br />
<br />
ExitBrowse:<br />
        ; free used resources<br />
        System::Free $0        <br />
        System::Free $1<br />
<br />
        ; now we should determine folder name from given PIDL<br />
        System::Call 'shell32::SHGetPathFromIDListA(i $2, t &quot;&quot; r3)'<br />
<br />
        ; IMalloc-&gt;Free work<br />
        System::Call 'shell32::SHGetMalloc(*i . r4)'    ; Get the pointer to interface<br />
        System::Call '*$4(i.r7)'                        ; Get the pointer to interface VTABLE<br />
        System::Call '*$7(&amp;t20, i.r5)'                  ; Get the pointer to IMalloc-&gt;Free<br />
        System::Call '::$5(i r2)'                  ; Call Free method<br />
<br />
        System::Store &quot;p3 l&quot;<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">22nd August 2003, 22:02</div></div><div class="posttext">btw, system supports no nested calls/declarations. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">22nd August 2003, 22:11</div></div><div class="posttext">The same without starting folder (could be more stable):<br />
<br />
     push       &quot;Select folder Demo&quot;<br />
     call       BrowseForFolderNew<br />
     pop        $0<br />
     MessageBox MB_OK &quot;Selected folder '$0'&quot;<br />
<br />
<br />
Function BrowseForFolderNew<br />
        System::Store &quot;s r9&quot;<br />
<br />
        ; BrowseInfo structure<br />
        System::Call '*(i $HWNDPARENT, i 0, t &quot;&quot;, t r9, i 0x45, i 0, i, i) i.r1'<br />
        System::Call 'shell32::SHBrowseForFolderA(i r1) i.r2'<br />
        System::Free $1<br />
<br />
        ; now we should determine folder name from given PIDL<br />
        System::Call 'shell32::SHGetPathFromIDListA(i $2, t &quot;&quot; r3)'<br />
<br />
        ; IMalloc-&gt;Free work<br />
        System::Call 'shell32::SHGetMalloc(*i . r4)'    ; Get the pointer to interface<br />
        System::Call '*$4(i.r7)'                        ; Get the pointer to interface VTABLE<br />
        System::Call '*$7(&amp;t20, i.r5)'                  ; Get the pointer to IMalloc-&gt;Free<br />
        System::Call '::$5(i r2)'                  ; Call Free method<br />
<br />
        System::Store &quot;p3 l&quot;<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">22nd August 2003, 22:18</div></div><div class="posttext">you know what.... I forgot to search :igor:<br />
Thanks... ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">22nd August 2003, 22:29</div></div><div class="posttext">You know what, too..<br />
this also works... :)<br />
<br />
Function &quot;.onInit&quot;<br />
System::Call '*(i $HWNDPARENT, i 0, t &quot;&quot;, t &quot;Búscame&quot;, i 0x45, i 0, i, i) i.r1'<br />
System::Call 'shell32.dll::SHBrowseForFolderA(i $1) i .r2'<br />
System::Call 'shell32.dll::SHGetPathFromIDListA(i $2, t .r1) i r3'<br />
StrCmp $1 &quot;&quot; +1 +2<br />
StrCpy $1 &quot;None.&quot;<br />
MessageBox MB_OK|MB_ICONINFORMATION &quot;Your directory: $\r$\n$1&quot;<br />
Quit<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">22nd August 2003, 22:33</div></div><div class="posttext">MSDN: The calling application is responsible for freeing the returned PIDL by using the Shell allocator's IMalloc::Free method. To retrieve a handle to that IMalloc interface, call SHGetMalloc. For further discussion of the Shell allocator and PIDLs, see The Shell Namespace.<br />
<br />
It wouldn't crash your installer anyway, but...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">22nd August 2003, 22:52</div></div><div class="posttext">More or less like this, brainsucker:<br />
<br />
Function &quot;.onInit&quot;<br />
System::Call '*(i $HWNDPARENT, i 0, t &quot;&quot;, t &quot;Búscame&quot;, i 0x45, i 0, i, i) i.r1'<br />
System::Call 'shell32.dll::SHBrowseForFolderA(i $1) i .r2'<br />
System::Call 'shell32.dll::SHGetPathFromIDListA(i $2, t .r1) i r3'<br />
System::Call 'ole32.dll::CoTaskMemFree(i $2)'<br />
StrCmp $1 &quot;&quot; +1 +2<br />
StrCpy $1 &quot;None.&quot;<br />
MessageBox MB_OK|MB_ICONINFORMATION &quot;Your directory: $\r$\n$1&quot;<br />
Quit<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">23rd August 2003, 23:03</div></div><div class="posttext">Hi! Need one more push...<br />
How can I make like an array with system plugin?<br />
For example:<br />
<br />
System::Call 'dll::Myfunc(i 1) i .r0' <br />
<br />
this will make $0 = 10 <br />
but if you change as:<br />
<br />
System::Call 'dll::Myfunc(i 2) i .r0' <br />
<br />
this will make $0 = 45.<br />
As you can see, is like an indexed value...<br />
I wanna use one line:<br />
<br />
System::Call 'dll::Myfunc(i ???) i .r(0..9)'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">23rd August 2003, 23:20</div></div><div class="posttext">forum king :) 2174 (9.45 posts per day)<br />
<br />
MSDN says no a single word about TaskMemFree :) IMalloc :)<br />
<br />
About arrays. I don't understand what you want. What YourFunc actually takes and what returns?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">24th August 2003, 02:26</div></div><div class="posttext">forum king :) 2174 (9.45 posts per day)<br />
MSDN says no a single word about TaskMemFree :) IMalloc :)<br />
<br />
<br />
The function here in VB (http://www.developerfusion.com/show/220/).<br />
<br />
Also something about in MSDN (http://msdn.microsoft.com/library/default.asp?url=/library/en-us/com/htm/cmf_a2c_63l1.asp).<br />
<br />
<br />
About arrays. I don't understand what you want. What YourFunc actually takes and what returns?<br />
<br />
Take the example in the GetSystemMetrics API, indexed:<br />
<br />
System::Call 'user32::GetSystemMetrics(i x) i .r0'<br />
<br />
X are a few integer values from 1 to 20 ( I think)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">24th August 2003, 23:12</div></div><div class="posttext">IMalloc &amp; CoTaskMemFree: we are speaking different languages... :)<br />
<br />
Arrays: I know no such call method as you proposed at any high level language, like C or VB :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>