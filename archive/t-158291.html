<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Detect Multiple Language's Bug, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Detect Multiple Language's Bug NSIS Discussion" />
	
	<title> Detect Multiple Language's Bug [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Detect Multiple Language's Bug</div>
<hr />
<div class="pda"><a href="t-158291.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=158291">Detect Multiple Language's Bug</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">s793016</div><div class="date">2nd December 2003, 09:11</div></div><div class="posttext">Sorry, my English is very very poor.<br />
<br />
I found that &quot;Regional Option&quot; will make  NSIS's to choose wrong Language during callback Function .onInit.<br />
<br />
This will happened at all windows platform.<br />
<br />
Screen Capture Enviroment:<br />
OS - WinXP SP1 English Version<br />
Languages for non-unicode programs - Always set to &quot;Chinese(Taiwan)&quot;<br />
NSIS Version - 2.0 B4 (final)<br />
<br />
Let me show you an example:<br />
<br />
1.The good one ... almost ...<br />
http://cpatch.org/witchfive/pastepic/l1.jpg<br />
<br />
2.Just change &quot;Regional Option&quot; to &quot;English&quot;<br />
http://cpatch.org/witchfive/pastepic/l2.jpg<br />
<br />
3.Just change &quot;Regional Option&quot; to &quot;Japanese&quot;<br />
http://cpatch.org/witchfive/pastepic/l3.jpg<br />
<br />
4.Just change &quot;Regional Option&quot; to &quot;Chinese (PRC)&quot;<br />
http://cpatch.org/witchfive/pastepic/l4.jpg<br />
<br />
== LangTest.nsi ==<br />
OutFile LangTest.exe<br />
Name LangBugTests<br />
XPStyle on<br />
<br />
LoadLanguageFile &quot;${NSISDIR}\Contrib\Language files\English.nlf&quot;<br />
LoadLanguageFile &quot;${NSISDIR}\Contrib\Language files\TradChinese.nlf&quot;<br />
LoadLanguageFile &quot;${NSISDIR}\Contrib\Language files\SimpChinese.nlf&quot;<br />
LoadLanguageFile &quot;${NSISDIR}\Contrib\Language files\Japanese.nlf&quot;<br />
<br />
LangString IL ${LANG_ENGLISH}     &quot;EN Installer Language&quot;<br />
LangString IL ${LANG_TRADCHINESE} &quot;TW Installer Language&quot;<br />
LangString IL ${LANG_SIMPCHINESE} &quot;CN Installer Language&quot;<br />
LangString IL ${LANG_JAPANESE}    &quot;JP Installer Language&quot;<br />
<br />
LangString CL ${LANG_ENGLISH}     &quot;EN Please select a language.&quot;<br />
LangString CL ${LANG_TRADCHINESE} &quot;TW Please select a language.&quot;<br />
LangString CL ${LANG_SIMPCHINESE} &quot;CN Please select a language.&quot;<br />
LangString CL ${LANG_JAPANESE}    &quot;JP Please select a language.&quot;<br />
<br />
LangString PM ${LANG_ENGLISH}     &quot;EN&quot;<br />
LangString PM ${LANG_TRADCHINESE} &quot;TW&quot;<br />
LangString PM ${LANG_SIMPCHINESE} &quot;CN&quot;<br />
LangString PM ${LANG_JAPANESE}    &quot;JP&quot;<br />
<br />
Section Sec1Name sec1<br />
SectionEnd<br />
<br />
Function .onInit<br />
LangDLL::LangDialog &quot;$(IL)&quot; &quot;$(CL)&quot; 4 $(PM)Eng 1033 $(PM)TW 1028 $(PM)CN 2052 $(PM)JP 1041<br />
quit<br />
FunctionEnd<br />
==</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd December 2003, 12:42</div></div><div class="posttext">Well, the only method I know of getting the user's setting of `Languages for non-Unicode programs' is GetACP(). Essentially, that's the only thing it needs to change. It just needs to change the code page for the conversion from/to Unicode. The only problem is that not all languages have a different code page. For example, ANSI - Central European (1250) is used for Polish, Czech, Romanian, Slovak and many more. ANSI - Latin I (1252) is used by even more languages. Given this situation, getting the user's default language is the best method I have found.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">s793016</div><div class="date">2nd December 2003, 14:54</div></div><div class="posttext">Sorry, my English is very very poor.<br />
<br />
OK, I found this at NSIS Archie, and tested OK to get user's setting of &quot;Languages for non-Unicode programs&quot; exactly correct at all windows platform.<br />
<br />
== code ==<br />
System::Call 'kernel32::GetSystemDefaultLangID() i .r0'<br />
IntOp $0 $0 &amp; 0xFFFF<br />
IntFMT $0 &quot;%04X&quot; $0<br />
==<br />
<br />
Unfortunally, I still can't change the Language detected by NSIS during callback function .onInit. <br />
<br />
And after callback function .onInit finished, the Language could be correct by some tricker.<br />
<br />
Besides, this bug make us getting wrong Language at those &quot;Messages&quot; proceed durning callback function .onInit, like LANGDLL, MessageBox, and something else.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd December 2003, 19:55</div></div><div class="posttext">The user might have selected a different language for himself, automatically selecting the system's language will not be wise. But if you really want to do it use:<br />
<br />
System::Call 'kernel32::GetSystemDefaultLangID() i .a'<br />
<br />
in .onInit before the call to LangDLL.<br />
<br />
As for the messages in .onInit, the language selected in .onInit, if different than the one chosen by NSIS, only takes affect after .onInit.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>