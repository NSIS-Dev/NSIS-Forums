<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" SetFileOwner, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  SetFileOwner NSIS Discussion" />
	
	<title> SetFileOwner [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  SetFileOwner</div>
<hr />
<div class="pda"><a href="t-332683.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=332683">SetFileOwner</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">sliceofpie</div><div class="date">21st July 2011, 00:34</div></div><div class="posttext">Hi,<br />
I'm running into an issue with AccessControl::SetFileOwner.<br />
<br />
I've created a script that sets the ownership of a file to the current logged in user:<br />
<br />
  AccessControl::GetCurrentUserName &quot;&quot; &quot;$0&quot;<br />
  Pop $0<br />
  AccessControl::SetFileOwner &quot;$INSTDIR\myfile.txt&quot; $0<br />
<br />
<br />
This works well in workgroups but does not work in a domain environment :weird:.  In a domain, it actually assigns the local admin, instead of the logged in user.  Im not sure if this is due to &quot;RequestExecutionLevel admin&quot;.<br />
<br />
Anyhow Id like it to assign the actual user that is logged on.  I've tried to use UserMgr::GetCurrentDomain in conjuction with AccessControl::GetCurrentUserName but I believe my syntax was wrong.. (I'm new to NSIS so couldn't figure out the format :tinfoil:)<br />
<br />
Any ideas?     Any help is greatly appreciated !!! :) :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">21st July 2011, 02:27</div></div><div class="posttext">If you are using RequestExecutionLevel admin then you can't really get the user.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sliceofpie</div><div class="date">21st July 2011, 17:07</div></div><div class="posttext">I see.  Is it possible to switch the RequestExecutionLevel back down then take ownership of the file?  not sure if that would be appropriate in my scenario.:confused:<br />
<br />
Any examples would really help. :p</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">21st July 2011, 17:39</div></div><div class="posttext">As far as I know it's not possible to downgrade access level in Windows. But if it is possible, the only way to do it is to use shellexecuteas or runas.exe to start a new process. And for that you need to know the username, which you don't.<br />
<br />
So, the best option is probably to use the UAC plugin to get two instances of your installer, one at userlevel and one at adminlevel. You can then get the username in the outer (userlevel) instance, and do all adminny stuff in the inner (admin) instance. Not recommended for beginners.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sliceofpie</div><div class="date">21st July 2011, 18:24</div></div><div class="posttext">MSG thank you for suggestion.<br />
<br />
I thought about something else.  What if I run the dos command &quot;takeown.exe&quot; from the installer.  Is that possible to do?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>