<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" System plugin and passing parameters to dll, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  System plugin and passing parameters to dll NSIS Discussion" />
	
	<title> System plugin and passing parameters to dll [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  System plugin and passing parameters to dll</div>
<hr />
<div class="pda"><a href="t-259003.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=259003">System plugin and passing parameters to dll</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">pps</div><div class="date">6th November 2006, 12:06</div></div><div class="posttext">Hello.<br />
<br />
I've got problem with passing parameters to DLL.<br />
I need to pass something like char** (just like parameters table in regular c++), but after some tries I've given up.<br />
I'm sure that this is not correct way:<br />
  System::Call '*(t R3) i.R2'<br />
  System::Call '*(i R2) i.R1'<br />
  System::Call 'advapi32::StartServiceA(i r5, i $R4, i $R1) i.r6 ? e'<br />
  System::Free $R1<br />
  System::Free $R2<br />
  Pop $0 ; error code<br />
<br />
In StartServiceA:<br />
$R1 should be a pointer to table of pointers to null-terminated strings.<br />
$R4 should contain number of strings.<br />
<br />
How can I make structure like this and how can I count $R4 value (assuming I have only regular string with spaces in $R7)?<br />
<br />
And another question. Option '? e' pops an error code to stack. Is the order of 'Pop' and 'Free' important (in other words: does '::Call*(...)' and '? e' use the same stack)?<br />
<br />
Thanks,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pps</div><div class="date">6th November 2006, 15:21</div></div><div class="posttext">Maybe this way:  System::Call '*(t R3, n) i.R1'<br />
  System::Call 'advapi32::StartServiceA(i r5, i $R4, i $R1) i.r6 ? e'<br />
  System::Free $R1$R3 contains first (and only one in this example) parameter.<br />
$R4 = 1<br />
<br />
If there will be more parameters, this will looks like:  System::Call '*(t R3, R6, R7, R8, n) i.R1'Am I wrong?<br />
<br />
I've tried to start notepad as a service (successful), but the parameter is ignored. The idea was to run notepad with filename :  c:\windows\system32\notepad.exe c:\test.txt<br />
The notepad is starting just fine, but the file isn't opening (the parameter isn't recognized).<br />
<br />
Any ideas?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th November 2006, 20:47</div></div><div class="posttext">Almost. You need to use specify a type for each member of the structure. Use `t` before R6, R7 and R8. There's also no need for that last `n`.  System::Call '*(t R3, t R6, t R7, t R8) i.R1'The order of System::Free and Pop is not important, even though they use the same stack. System::Free only pops on item from the stack, so it won't pop the error.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pps</div><div class="date">7th November 2006, 16:34</div></div><div class="posttext">Thanks for help :)<br />
<br />
And what about creating tables of structures?<br />
For example I want to create structure like this:<br />
typedef struct {<br />
   int a;<br />
   char t[10];<br />
   __int64 b;<br />
   double x;<br />
   char *p;<br />
} myStruct;<br />
Is the only way to do that this way (just 2-elements array):<br />
System::Call '*(i 1, t&amp;10 &quot;asdfb&quot;, l 100, ???, t* n, i 7, t&amp;10 &quot;qwerty&quot;, l 1991, ???, t* r2) i.r1'<br />
And what about float numbers?<br />
<br />
I've successfully used this method to pass address of int[][] to dll, but is there any simplier method?<br />
<br />
2 weeks isn't enough to fully explore NSIS' capabilities... ;)<br />
<br />
Thanks again,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">7th November 2006, 19:47</div></div><div class="posttext">2 weeks isn't enough to fully explore NSIS' capabilities...<br />
<br />
believe me: 2 years aren't either :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th November 2006, 20:11</div></div><div class="posttext">It depends if you're defining an array of structs or struct pointers. If those are pointers, allocate each structure using the same method you allocate the array and allocate the array with all of the pointers. If it's just an array, the method you've shown should work. Just don't forget to mind alignments.<br />
<br />
Probably the easiest method of seeing where everything should be placed is writing a simple C program that'd print the offsets of every member.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pospec</div><div class="date">12th May 2008, 09:55</div></div><div class="posttext">OK, and how can I System::Call with float parameter, please?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th May 2008, 13:51</div></div><div class="posttext">You can't. It doesn't support floats. The Math plug-in, however, has support for floats.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pospec</div><div class="date">12th May 2008, 13:55</div></div><div class="posttext">So there is no way how to System::Call my DLL exported 'float func(float x)' without writing some &quot;wrapper&quot;?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th May 2008, 14:03</div></div><div class="posttext">That's correct.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pospec</div><div class="date">12th May 2008, 14:06</div></div><div class="posttext">Sad but true. And why can't System plugin convert from string to float and pass it to function?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th May 2008, 19:24</div></div><div class="posttext">Because it doesn't that functionality built-in. Floats are a pin to handle.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>