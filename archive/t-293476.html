<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" problem with umui, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  problem with umui NSIS Discussion" />
	
	<title> problem with umui [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  problem with umui</div>
<hr />
<div class="pda"><a href="t-293476.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=293476">problem with umui</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">EvilTwin1</div><div class="date">23rd June 2008, 00:45</div></div><div class="posttext">i tried to create a setup with umui but it looks like this :D<br />
http://bildupload.sro.at/a/images/umui.jpg<br />
<br />
<br />
<br />
here is the script:<br />
<br />
SetCompressor  lzma<br />
<br />
<br />
;MUI SETTINGS<br />
!include &quot;UMUI.nsh&quot;<br />
<br />
<br />
!define UMUI_SKIN  blue<br />
!define MUI_ICON  &quot;GRM_48.ico&quot;<br />
<br />
;Installer Pages<br />
!insertmacro MUI_PAGE_WELCOME<br />
!insertmacro MUI_PAGE_LICENSE &quot;licence.rtf&quot;<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
!insertmacro MUI_PAGE_INSTFILES<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
;Uninstaller Pages<br />
!insertmacro MUI_UNPAGE_WELCOME<br />
!insertmacro MUI_UNPAGE_COMPONENTS<br />
!insertmacro MUI_UNPAGE_DIRECTORY<br />
!insertmacro MUI_UNPAGE_INSTFILES<br />
!insertmacro MUI_UNPAGE_FINISH<br />
<br />
<br />
<br />
;Languages<br />
!insertmacro MUI_LANGUAGE &quot;German&quot;<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
<br />
<br />
<br />
;--------------------------------<br />
Name &quot;Gothic Reloaded Mod&quot;<br />
OutFile &quot;GRM.exe&quot;<br />
InstallDir &quot;$PROGRAMFILES\PiranhaBytes\Gothic&quot;<br />
;--------------------------------<br />
<br />
Function .onGUIInit<br />
        ;/////////////////////////////////////////<br />
          InitPluginsDir<br />
          SetOutPath $PLUGINSDIR<br />
          File &quot;background.bmp&quot;<br />
          BgImage::setBg /NOUNLOAD /FILLSCREEN &quot;$PLUGINSDIR\background.bmp&quot;<br />
          BgImage::Redraw /NOUNLOAD<br />
        ;/////////////////////////////////////////<br />
FunctionEnd<br />
<br />
<br />
<br />
<br />
<br />
Function .onInit<br />
<br />
!insertmacro MUI_LANGDLL_DISPLAY<br />
InitPluginsDir<br />
<br />
<br />
<br />
              ;--------------------------------<br />
;             SetOutPath $PLUGINSDIR<br />
;             File &quot;Installer_loop.mp3&quot;<br />
;             System::Call 'msvfw32.dll::MCIWndCreate(i 0, i 0,i 0x0070, t &quot;$PLUGINSDIR\Installer_loop.mp3&quot;) i .r0'<br />
;             StrCpy $hmci $0<br />
;             SendMessage $hmci 0x0490 0 0 $0<br />
;             IntCmp $0 0 nosup<br />
;             ShowWindow $hmci SW_HIDE<br />
;             SendMessage $hmci 0x0465 0 &quot;STR:play repeat&quot;<br />
;             nosup:<br />
              ;--------------------------------<br />
<br />
<br />
FunctionEnd<br />
<br />
<br />
;Sections<br />
;/////////////////////////////////////////////////////<br />
;/////////////////////////////////////////////////////<br />
Section &quot;Gothic1-mod&quot; G1<br />
SectionIn RO<br />
<br />
;Icon und INI in System kopieren<br />
  SetOutPath &quot;$INSTDIR\System&quot;<br />
  File      &quot;.\install\System\GRM.ini&quot;<br />
  File      &quot;.\install\System\GRM_48.ico&quot;<br />
<br />
;.mod in modvdf kopieren<br />
  SetOutPath &quot;$INSTDIR\Data\modvdf&quot;<br />
  File      &quot;.\install\Data\modvdf\GRM.mod&quot;<br />
<br />
<br />
;Uninstaller<br />
  WriteUninstaller &quot;$INSTDIR\GRM-Uninstall.exe&quot;<br />
<br />
;Save Ordner<br />
 CreateDirectory &quot;$INSTDIR\saves_GRM\current&quot;<br />
SectionEnd<br />
<br />
<br />
<br />
<br />
Section &quot;Gothic Reloaded Mod&quot; GRM<br />
        ;Icon und INI in System kopieren<br />
        SetOutPath &quot;$INSTDIR\System&quot;<br />
        File      &quot;.\install\System\GRM.ini&quot;<br />
        File      &quot;.\install\System\GRM_48.ico&quot;<br />
SectionEnd<br />
;/////////////////////////////////////////////////////<br />
;/////////////////////////////////////////////////////<br />
<br />
<br />
<br />
<br />
LangString DESC_G1 ${LANG_ENGLISH} &quot;Gothic 1 Modification for the game Gothic 2&quot;<br />
LangString DESC_GRM ${LANG_ENGLISH} &quot;More detailed meshes and better textures to improve the graphics of the game&quot;<br />
<br />
LangString DESC_G1 ${LANG_GERMAN} &quot;Gothic 1 Mod fÃ¼r Gothic 2&quot;<br />
LangString DESC_GRM ${LANG_GERMAN} &quot;Detailreichere Meshes und bessere Texturen fÃ¼r Gothic 1&quot;<br />
<br />
!insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br />
 !insertmacro MUI_DESCRIPTION_TEXT ${G1} $(DESC_G1)<br />
 !insertmacro MUI_DESCRIPTION_TEXT ${GRM} $(DESC_GRM)<br />
!insertmacro MUI_FUNCTION_DESCRIPTION_END<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
Function un.onUninstSuccess<br />
  HideWindow<br />
  MessageBox MB_ICONINFORMATION|MB_OK &quot;Gothic Reloaded wurde erfolgreich deinstalliert.&quot;<br />
FunctionEnd<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
Section &quot;Uninstall&quot;<br />
<br />
Delete &quot;$INSTDIR\System\GRM.ini&quot;<br />
Delete &quot;$INSTDIR\Data\modvdf\GRM.mod&quot;<br />
Delete &quot;$INSTDIR\DS-Uninstall.exe&quot;<br />
<br />
<br />
RMDir  &quot;$INSTDIR\Data\modvdf&quot;<br />
SectionEnd<br />
<br />
<br />
<br />
also the window to select the language doesnt show up<br />
and the part to play background music isnt working -&gt; error while compiling in line: &quot;StrCpy $hmci $0&quot;<br />
<br />
<br />
thx for all help i may will get :D <br />
and sorry for the bad english</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">23rd June 2008, 02:30</div></div><div class="posttext">Calling the language dialog/page is a bit different in UMUI:<br />
<br />
In your &quot;.onInit&quot; function, instead of<br />
<br />
!insertmacro MUI_LANGDLL_DISPLAY<br />
<br />
you must use this code:<br />
<br />
!insertmacro UMUI_MULTILANG_GET<br />
<br />
Also you must use this as your very first page:<br />
<br />
!insertmacro UMUI_PAGE_MULTILANGUAGE<br />
<br />
<br />
BTW: Is that variable $hmci defined anywhere?<br />
<br />
If not, you'll have to add this at the top of your script:<br />
<br />
Var $hmci</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pospec</div><div class="date">23rd June 2008, 12:23</div></div><div class="posttext">Var hmci</div></div><hr />


<div class="post"><div class="posttop"><div class="username">EvilTwin1</div><div class="date">23rd June 2008, 14:50</div></div><div class="posttext">ohhhh :D ... i forgot to copy the variable xD<br />
<br />
anyway<br />
the compiler says<br />
<br />
&quot;macro named UMUI_PAGE_MULTILANGUAGE not found&quot;<br />
<br />
<br />
i also searched in files with an editor for &quot;UMUI_PAGE_MULTILANGUAGE&quot; but found nothing</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">23rd June 2008, 14:54</div></div><div class="posttext">It's definitely there. It's in the following file:<br />
NSIS\Contrib\UltraModernUI\UMUI.nsh (Line 4813)<br />
<br />
Maybe you use an outdated version of UMUI ???<br />
<br />
Get the latest release here:<br />
http://sourceforge.net/project/showfiles.php?group_id=146999&amp;package_id=161955&amp;release_id=608330</div></div><hr />


<div class="post"><div class="posttop"><div class="username">EvilTwin1</div><div class="date">23rd June 2008, 15:10</div></div><div class="posttext">it realy was an older version^^<br />
<br />
the display-problem with the gui is also fixed now<br />
<br />
thx :)<br />
<br />
edit: it seems when i select a language and hit &quot;next&quot;<br />
the .onGuiInit function is called again so the musik starts from the beginning ^^<br />
<br />
edit2: strange :D the problem only appears when i choose german language</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">23rd June 2008, 15:28</div></div><div class="posttext">The language cannot be changed when the installer is already running. That is why MUI shows the language dialog before the installer window appears. In contrast to MUI, UMUI uses an integrated language selection page. So it starts the installer with the default language. In case you keep that language, the installer simply continues with the next page. But in case you switch language, UMUI will have to restart your installer executable and pass the new language via commandline parameter. If you keep that in mind, the behavior you describe is not strange at all...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">EvilTwin1</div><div class="date">23rd June 2008, 15:37</div></div><div class="posttext">thx for the explanation<br />
<br />
is there a way to set german standart language?<br />
so the drop down list will not look like this at the beginning<br />
http://bildupload.sro.at/a/images/language-dialogbox.jpg</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">23rd June 2008, 16:08</div></div><div class="posttext">There is no need to set the default language explicitly. The first language (German in your script) will be the default language. And it should be selected by default.<br />
<br />
Maybe you should have a closer look at:<br />
NSIS\Examples\UltraModernUI\MultiLanguage.nsi ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">EvilTwin1</div><div class="date">23rd June 2008, 16:16</div></div><div class="posttext">yes i thought so too<br />
but the default language is still english ^^<br />
<br />
<br />
thx i will have a look at the example :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">23rd June 2008, 17:01</div></div><div class="posttext">Originally posted by EvilTwin1 <br />
yes i thought so too<br />
but the default language is still english <br />
<br />
Maybe your installer stored the language that was selected on a previous install in the registry. So now it will load the default language from the registry, instead of defaulting to the first language. Simply delete all reg values written by the installer to test the behavior on a &quot;fresh&quot; system...<br />
<br />
!define UMUI_PARAMS_REGISTRY_ROOT &quot;HKLM&quot;<br />
!define UMUI_PARAMS_REGISTRY_KEY &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\MyApplication&quot;<br />
!define UMUI_LANGUAGE_REGISTRY_VALUENAME &quot;Language&quot;<br />
!define UMUI_LANGUAGE_ALWAYSSHOW</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>