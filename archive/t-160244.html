<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Compile-time/Run-time defines, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Compile-time/Run-time defines NSIS Discussion" />
	
	<title> Compile-time/Run-time defines [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Compile-time/Run-time defines</div>
<hr />
<div class="pda"><a href="t-160244.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=160244">Compile-time/Run-time defines</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">AlwaysLearning</div><div class="date">17th December 2003, 10:31</div></div><div class="posttext">Hello,<br />
<br />
I've read all related topics and documentation , but still<br />
confused and dont know if it's possible to do what i need with NSIS installer.<br />
<br />
I'm building setup packages for different affiliates.<br />
Set of setup files is the same , but what changes is<br />
packages name and installation folder.<br />
<br />
Before running the setup , there is some small pre-setup<br />
utility that can write values to registry.<br />
<br />
The question is : is it possible &quot;to tell&quot; nsis to take<br />
these values from registry and not to &quot;hardcode&quot; them in the script ?<br />
<br />
<br />
Here's my current installation script:<br />
---------------------------------<br />
<br />
!define MUI_PRODUCT &quot;AAASoft&quot; ;Define your own software name here<br />
!define MUI_PRODUCT_LINK &quot;AAA Soft&quot; ;Define your own software short cut here<br />
!define MUI_VERSION &quot;2.1&quot; ;Define your own software version here<br />
<br />
!define MUI_ICON &quot;C:\SoftProjectV2\IconBig.ico&quot;<br />
!define MUI_UNICON &quot;C:\SoftProjectV2\IconBig.ico&quot;<br />
<br />
SetCompress Off<br />
!include &quot;MUI.nsh&quot;<br />
<br />
;--------------------------------<br />
;Configuration<br />
AutoCloseWindow true ;<br />
<br />
;General<br />
OutFile &quot;C:\SoftProjectV2\SoftSetup.exe&quot;<br />
<br />
;Folder selection page<br />
InstallDir &quot;$PROGRAMFILES\${MUI_PRODUCT}&quot;<br />
<br />
!define MUI_UNINSTALLER<br />
;--------------------------------<br />
;Language<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
;--------------------------------<br />
BrandingText &quot;Installing soft&quot;<br />
;--------------------------------<br />
;Installer Sections<br />
<br />
Section &quot;CopyingFiles&quot;<br />
SetOutPath &quot;$INSTDIR&quot;<br />
FILE &quot;C:\SoftProjectV2\SoftDLLS\file1.dll&quot;<br />
FILE &quot;C:\SoftProjectV2\SoftDLLS\file2.dll&quot;<br />
FILE &quot;C:\SoftProjectV2\SoftDLLS\file.exe&quot;<br />
SectionEnd<br />
<br />
;Add Shortcuts<br />
<br />
Section &quot;SettingEnvironment&quot;<br />
SetOutPath $INSTDIR<br />
;Create Desktop Icon<br />
CreateShortCut &quot;$DESKTOP\${MUI_PRODUCT_LINK}.lnk&quot; &quot;$INSTDIR\soft.exe&quot;<br />
CreateShortCut &quot;$SMPROGRAMS\${MUI_PRODUCT_LINK}.lnk&quot; &quot;$INSTDIR\soft.exe&quot;<br />
WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${MUI_PRODUCT}&quot; &quot;DisplayName&quot; &quot;${MUI_PRODUCT_LINK}&quot;<br />
WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${MUI_PRODUCT}&quot; &quot;UninstallString&quot; &quot;$INSTDIR\Uninst.exe&quot;<br />
WriteUninstaller &quot;$INSTDIR\Uninst.exe&quot;<br />
SectionEnd<br />
<br />
;--------------------------------<br />
<br />
;Uninstaller Section<br />
<br />
  Section &quot;Uninstall&quot;<br />
<br />
  ;Delete Files<br />
  Delete &quot;$INSTDIR\*.*&quot;<br />
<br />
 ;Delete Desktop Icon<br />
  Delete &quot;$DESKTOP\${MUI_PRODUCT_LINK}.lnk&quot;<br />
<br />
  ;Delete Start Menu Shortcuts<br />
  Delete &quot;$SMPROGRAMS\${MUI_PRODUCT_LINK}.lnk&quot;<br />
<br />
  Delete &quot;$INSTDIR\*.*&quot;<br />
  RMDir /r &quot;$INSTDIR\&quot;<br />
<br />
  ;Delete Uninstaller And Unistall Registry Entries<br />
  DeleteRegKey HKEY_CURRENT_USER &quot;SOFTWARE\${MUI_PRODUCT}&quot;<br />
  DeleteRegKey HKEY_LOCAL_MACHINE &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\${MUI_PRODUCT}&quot;<br />
  DeleteRegKey /ifempty HKCU &quot;Software\${MUI_PRODUCT}&quot;<br />
<br />
SectionEnd<br />
<br />
<br />
Function .onInstSuccess<br />
   ExecShell open &quot;$INSTDIR\Soft.exe&quot;<br />
FunctionEnd<br />
;eof<br />
<br />
--------------------------------------------------------<br />
<br />
What i need is small modification , so if there's some specific known location in registry defining product name - script will take it from there.<br />
<br />
Thanks a lot!<br />
<br />
<br />
<br />
<br />
P.S. I found out that &quot;InstallDirRegKey&quot; command might help,<br />
is it correct direction ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">17th December 2003, 11:23</div></div><div class="posttext">The easiest solution is to let the utility write a NSIS include file or to create an application that reads a few registry settings and writes an include file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">17th December 2003, 11:26</div></div><div class="posttext">Do you want to be able to read the registry entries at compile-time, when the script is made on your machine, or at run-time from the users machine?<br />
<br />
For compile-time mods you will have to create another little program which will read these entries and write them into a NSIS compatible include file which then can be included into the main script.  To execute the program you will have to use the '!system' command.<br />
<br />
If you want to chage these at runtime simply read them using the registry functions available in NSIS.  To modify the name it-self you might need to define it with a variable and then set the variable at run-time.<br />
<br />
I hope this helps you!<br />
<br />
Vytautas ;)<br />
<br />
Oops joost was just a bit quicker :D<br />
<br />
BTW: In future could you attach long scripts.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AlwaysLearning</div><div class="date">17th December 2003, 12:05</div></div><div class="posttext">I want these variables at run-time (on user machine).<br />
<br />
I would appreciate if you show me specific code i need to insert.<br />
<br />
Joost Verburg:  &quot;The easiest solution is to let the utility write a NSIS include file or to create an application that reads a few registry settings and writes an include file.&quot;<br />
<br />
It sounds like what i need. Can you please point me to some<br />
example using this approach ?<br />
<br />
Vytautas : What do you mean by &quot;In future could you attach long scripts.&quot; ? Is it a problem to paste code here ?<br />
I deleteted unneeded strings before posting it to make it<br />
shorter.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">17th December 2003, 12:17</div></div><div class="posttext">I think that joost's idea will only work at compile-time.  You were right about the &quot;InstallDirRegKey&quot; command, you can see how its supposed to be used from examples available with NSIS.  The thoery behind my other suggestion is that if you define the name of the installer with a variable like $1 and then change $1 at run-time the name should then also change, although I could be wrong as it depends on how NSIS Installers have their names defined internally.<br />
<br />
As for my comment about attaching scripts it would just make the thread load quicker for us with dail-up internet :p <br />
<br />
Vytautas</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>