<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Maintaining Ini files during upgrade, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Maintaining Ini files during upgrade NSIS Discussion" />
	
	<title> Maintaining Ini files during upgrade [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Maintaining Ini files during upgrade</div>
<hr />
<div class="pda"><a href="t-247590.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=247590">Maintaining Ini files during upgrade</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">beaglelander</div><div class="date">1st June 2006, 12:12</div></div><div class="posttext">Hi everyone,<br />
<br />
I'm writting an installer/upgrader for an application which relies heavily on ini files to store config settings. I need the installer to be used for either a new installation or an upgrade - I don't want to have a separate installer for upgrades and another for new installations.<br />
<br />
New installations are fine because I can simply create ini files with the default entries in.  <br />
<br />
My problem arises when I want to perform upgrades.  I cannot recreate the entire ini file because it may overwrite some existing settings.  So I was wondering, does anyone know if a function already exits similar to WriteINIStr that has an extra parameter that specifies whether to overwrite an existing entry in an ini file?  This way I could ensure my existing settings do not get overwritten if they already exist, or force an overwrite if it does already exist.  Or can anyone think of a better solution?<br />
<br />
Many thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">1st June 2006, 13:00</div></div><div class="posttext">Just read from the INI first and check if the result is empty and/or error flag</div></div><hr />


<div class="post"><div class="posttop"><div class="username">beaglelander</div><div class="date">1st June 2006, 13:35</div></div><div class="posttext">Well that's essentially what I want to achieve. But I can't pheasibly do this for the hundreds of entries it needs to check - the script will be huuuuuge</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st June 2006, 14:24</div></div><div class="posttext">I'm not sure if this is what you want:<br />
http://nsis.sourceforge.net/Update_an_existing_INI_file_with_values_from_an_updated_INI_file<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">beaglelander</div><div class="date">1st June 2006, 15:46</div></div><div class="posttext">Hi Stu<br />
<br />
mmmmm not exactly what i'm after.  That method would still overwrite my existing settings.<br />
<br />
Here's a full example of what I'm aiming for:<br />
<br />
Installer makes the following ini file with these default entries:<br />
<br />
A=1<br />
B=2<br />
C=3<br />
<br />
The program modifies these default settings to:<br />
<br />
A=1a<br />
B=2a<br />
C=3a<br />
<br />
Now, lets assume I want to run an upgrade at some later date. Let's say the program now uses D=4, so that needs to be added to the ini file. I don't want to overwrite the modifications that have been made to the existing entries (i'll have many unhappy users on my hand if I did this), so the end result is:<br />
<br />
[Section]<br />
A=1a<br />
B=2a<br />
C=3a<br />
D=4<br />
<br />
So basically, I want to do what Anders suggested and check if the entry already exists, if it does - skip it.  <br />
<br />
I know I could do this:<br />
<br />
ReadINIStr $R0 &quot;C:\myini.ini&quot; &quot;Section&quot; &quot;A&quot;<br />
StrCmp $R0 &quot;&quot; 0 +1<br />
WriteINIStr &quot;C:\myini.ini&quot; &quot;Section&quot; &quot;A&quot; &quot;1&quot;<br />
<br />
<br />
But bascially I don't want to have reems of code to check this, as it will treble the length of my script.  Ideally what I'd like is this:<br />
<br />
WriteINIStr /c &quot;C:\myini.ini&quot; &quot;Section&quot; &quot;A&quot; &quot;1&quot;<br />
<br />
Where /c checks whether the entry already exists, if it does then skip it.  I'm guessing something like that doesn't already exist, but I think it would be a useful addition.  How difficult would it be to write a plugin?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st June 2006, 16:24</div></div><div class="posttext">Put it in a macro...<br />
<br />
<br />
!macro WriteINIStrIfMissing File Section Key Value<br />
  ClearErrors<br />
  ReadINIStr $R0 &quot;${File}&quot; &quot;${Section}&quot; &quot;${Key}&quot;<br />
  IfErrors 0 +2<br />
    WriteINIStr &quot;${File}&quot; &quot;${Section}&quot; &quot;${Key}&quot; &quot;${Value}&quot;<br />
!macroend<br />
!define WriteINIStrIfMissing `!insertmacro WriteINIStrIfMissing`<br />
<br />
<br />
Usage:<br />
${WriteINIStrIfMissing} &quot;myfile.ini&quot; &quot;Section&quot; &quot;Key&quot; &quot;Val&quot;<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">beaglelander</div><div class="date">1st June 2006, 16:35</div></div><div class="posttext">Ahhhh I've never used macros before so I never thought to use one - that's excellent, thanks for your help stu!   :-)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>