<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" GetParameters error, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  GetParameters error NSIS Discussion" />
	
	<title> GetParameters error [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  GetParameters error</div>
<hr />
<div class="pda"><a href="t-244139.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=244139">GetParameters error</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">goldy1064</div><div class="date">21st April 2006, 17:50</div></div><div class="posttext">I have a problem with GetOptions on East Asian language OS's, but only when running from the desktop.  I'm checking for a command-line switch (-cd) in order to do a semi-silent temporary install and then launch the application.  However, when run from the desktop on Chinese (Traditional and Simplified) and Japanese, it detects this option.  I used a messagebox and saw that after calling GetParameters, my variables was set to *.  Any help would be much appreciated.<br />
<br />
Thanks,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">22nd April 2006, 09:05</div></div><div class="posttext">goldy1064 can you produce some code? It can be unicode problem or something else.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">22nd April 2006, 19:49</div></div><div class="posttext">I think this could be an issue with StrCpy. A lot of functions on the Wiki (Archive back in the day) failed because as soon as they'd hit a unicode character they'd return &quot;&quot; and so the functions would think they were at the end of the string and exit the loops. We had to change it to a character count vs position.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">goldy1064</div><div class="date">24th April 2006, 17:09</div></div><div class="posttext">Well, I had recently changed my code to use this instead of the old GetParameters function that use to be in the NSIS help and that worked fine.  I guess that I will switch back to what I had previous.  Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th April 2006, 17:27</div></div><div class="posttext">The GetParameters function in the NSIS manual used to have this issue but was later updated.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">goldy1064</div><div class="date">24th April 2006, 18:09</div></div><div class="posttext">Whatever version I had taken, I guess was correct.  I'm not sure why the FileFunc GetParameters would have a problem, though, since I thought it was based from the GetParameters that use to be in the help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">24th April 2006, 18:49</div></div><div class="posttext">goldy1064 what command line? What returns ${GetParameters}? What returns sunjammer's &quot;GetParameters&quot;?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">goldy1064</div><div class="date">24th April 2006, 19:29</div></div><div class="posttext">I use the following function to determine whether or not this will be a full install.  If the -cd option is detected, I don't write any registry keys and I remove all files after reboot.<br />
Here's what I currently do:<br />
<br />
...<br />
Function .onInit<br />
    ...<br />
    Call IsTempInstall<br />
    ...<br />
FunctionEnd<br />
<br />
Function IsTempInstall<br />
    Push $R0<br />
    Push $R1<br />
<br />
    ${GetParameters} $R0<br />
    ClearErrors<br />
    ${GetOptions} $R0 -cd $R1<br />
    ${If} ${Errors}<br />
        StrCpy $TempInstall 0<br />
    ${Else}<br />
        StrCpy $TempInstall 1<br />
        MessageBox MB_OK &quot;-cd detected&quot;<br />
    ${EndIf}<br />
<br />
    Pop $R1<br />
    Pop $R0<br />
FunctionEnd<br />
<br />
<br />
Here's what I use to do (with the GetParameters function that I was using from the help):<br />
<br />
Function IsTempInstall<br />
    Push $R0<br />
    Push $R1<br />
<br />
    Call GetParameters<br />
    Pop $R0<br />
    ${If} $R0 == &quot;-cd&quot;<br />
        StrCpy $TempInstall 1<br />
    ${Else}<br />
        StrCpy $TempInstall 0<br />
    ${EndIf}<br />
<br />
    Pop $R1<br />
    Pop $R0<br />
FunctionEnd<br />
<br />
Function GetParameters<br />
   Push $R0<br />
   Push $R1<br />
   Push $R2<br />
   Push $R3<br />
<br />
   StrCpy $R2 1<br />
   StrLen $R3 $CMDLINE<br />
<br />
   ;Check for quote or space<br />
   StrCpy $R0 $CMDLINE $R2<br />
   StrCmp $R0 '&quot;' 0 +3<br />
     StrCpy $R1 '&quot;'<br />
     Goto loop<br />
   StrCpy $R1 &quot; &quot;<br />
<br />
   loop:<br />
     IntOp $R2 $R2 + 1<br />
     StrCpy $R0 $CMDLINE 1 $R2<br />
     StrCmp $R0 $R1 get<br />
     StrCmp $R2 $R3 get<br />
     Goto loop<br />
<br />
   get:<br />
     IntOp $R2 $R2 + 1<br />
     StrCpy $R0 $CMDLINE 1 $R2<br />
     StrCmp $R0 &quot; &quot; get<br />
     StrCpy $R0 $CMDLINE &quot;&quot; $R2<br />
<br />
   Pop $R3<br />
   Pop $R2<br />
   Pop $R1<br />
   Exch $R0<br />
FunctionEnd<br />
<br />
I changed to use my new way, though, because this older code will only work with one command-line parameter (and I was planning ahead since I know that I'll need to support more).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">24th April 2006, 20:27</div></div><div class="posttext">I'm not sure why the FileFunc GetParameters would have a problem, though, since I thought it was based from the GetParameters that use to be in the help.I'll repeat:<br />
What command line?<br />
MessageBox MB_OK &quot;[$CMDLINE]&quot;<br />
What returns ${GetParameters}?<br />
${GetParameters} $R0<br />
MessageBox MB_OK &quot;[$R0]&quot;<br />
What returns sunjammer's &quot;GetParameters&quot;?<br />
Call GetParameters<br />
Pop $R0<br />
MessageBox MB_OK &quot;[$R0]&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">goldy1064</div><div class="date">24th April 2006, 22:32</div></div><div class="posttext">$CMDLINE on both is<br />
<br />
&quot;C:\Documents and Settings\HP_Owner\×ÀÃæ\Setup_getparameters.exe&quot; <br />
<br />
However, depending on which localized OS I run it on, I get a different result for what GetParameters returns.  Using the original GetParameters function, the return value is &quot;&quot;.  However, with the new GetParameters function, the return value on a Chinese OS is &quot; &quot; (a space).  I did a filewrite for all of this to be sure I wasn't missing any characters.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">25th April 2006, 06:39</div></div><div class="posttext">Can you write hex code of the $CMDLINE?<br />
FileOpen $0 HexCmd.txt w<br />
FileWrite $0 $CMDLINE<br />
FileClose $0And open with hex viewer/editor. Something like:433A5C446F63756D656E747320616E642053657474696E67735C48505F4F776E65725CD7C0C3E65C53657475705F676574706172616D65746572732E657865<br />
<br />
Edit:<br />
Or better attach this file</div></div><hr />


<div class="post"><div class="posttop"><div class="username">goldy1064</div><div class="date">25th April 2006, 17:27</div></div><div class="posttext">Attached are the files.<br />
<br />
Setup_filefunc_getparameters.log - GetParameters using FileFunc header.<br />
<br />
Setup_getparameters.log - GetParameters using sunjammer's GetParameters.<br />
<br />
Setup_getparameters_cmdline.log - echo of $CMDLINE.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">25th April 2006, 18:17</div></div><div class="posttext">Hm... can't reproduce. If you run program as:<br />
&quot;C:\Documents and Settings\HP_Owner\×ÀÃæ\Setup_getparameters.exe&quot; -cdWhat return each of the functions?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">goldy1064</div><div class="date">25th April 2006, 21:23</div></div><div class="posttext">If I try to run this from the desktop, I get a Windows alert saying that I need to Add/Remove programs through the Control Panel.  This bad behaviour only happens on these systems when the full path has a localized string within it (like the Desktop).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mtconleyuk</div><div class="date">13th November 2008, 10:29</div></div><div class="posttext">I've just run into this exact same problem myself, on a Japanese system. I do the following:<br />
<br />
	${GetParameters} $0<br />
<br />
	${GetOptions} &quot;$0&quot; &quot;-A&quot; $1<br />
	${Unless} ${Errors}<br />
		IntOp $doAllUsersInstall 1 +<br />
	${EndUnless}<br />
<br />
GetParameters() returns a string containing Japanese characters; GetOptions() then fails to parse the string correctly, and reports that the option exists (i.e., no error condition is set), even though it isn't.<br />
<br />
As noted earlier, this occurs whenever the installer is launched from a location whose path contains non-Roman characters, so that the path to the executable, specified on the command line, screws up the parsing.<br />
<br />
It's been 3 years since the last posting on this topic. Has there been a resolution? Is there a workaround, or a</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mtconleyuk</div><div class="date">13th November 2008, 10:31</div></div><div class="posttext">Hm. Forgot to finish that last sentence, but you get the point. And, okay, it's actually been 2 years, but still....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">designer_nexus</div><div class="date">23rd March 2010, 17:27</div></div><div class="posttext">Anyone resolve this?  unicode NSIS doesn't seem to do it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">designer_nexus</div><div class="date">25th March 2010, 17:45</div></div><div class="posttext">My bad.  This is resolved by the unicode installer.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>