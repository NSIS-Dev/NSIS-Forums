<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" installing fonts on Vista, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  installing fonts on Vista NSIS Discussion" />
	
	<title> installing fonts on Vista [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  installing fonts on Vista</div>
<hr />
<div class="pda"><a href="t-279398.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=279398">installing fonts on Vista</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">GDMVET</div><div class="date">19th October 2007, 11:50</div></div><div class="posttext">Hi all,<br />
<br />
I'm having problems installing a font in de $FONTS directory of Windows Vista.<br />
<br />
I use this code which works great on Windows XP<br />
<br />
To copy the font :<br />
<br />
SetOutPath $FONTS<br />
File &quot;Vet-Files.ttf&quot;<br />
<br />
To use the font without restarting Windows :<br />
<br />
GetTempFileName $R0 <br />
SetOverwrite On<br />
File /oname=$R0 fonts.dll <br />
;SetOverwrite ifnewer<br />
<br />
Push &quot;Vet-Files.TTF&quot; <br />
CallInstDLL $R0 registerFont<br />
<br />
I understand you can't copy files into system directories because of UAC.<br />
<br />
I've tried the UAC.dll plugin.<br />
I've also tried using RequestExecutionLevel user<br />
<br />
But nothing works :(<br />
<br />
Any help would be appreciated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th October 2007, 12:02</div></div><div class="posttext">Where exactly does it fail? Does it not copy the font file at all? Does it fail registering?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GDMVET</div><div class="date">19th October 2007, 15:15</div></div><div class="posttext">It fails to copy the font in the $FONTS directory.  The funny thing is that it does register the font.  So my program runs normal shortly after installation, but not anymore after you restart the computer, because the font wasn't copied to the $FONTS directory.<br />
<br />
I try to package a demo-version of a database program.<br />
Another frustrating thing is that you can't add new items in the demo-version because Windows Vista only allows users to view the data, not update it.  Unless you turn of UAC which isn't the best way to go off course.<br />
<br />
You can see screenshots of my program on my website wwww.vet-files.com</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th October 2007, 15:23</div></div><div class="posttext">I bet the font is actually installed under %APPDATA%\Windows\Fonts. Use RequestExecutionLevel admin and it should be able to write to C:\Windows\Fonts.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GDMVET</div><div class="date">19th October 2007, 15:54</div></div><div class="posttext">I can't find it under %APPDATA%<br />
<br />
This is the very simple code I use :<br />
<br />
RequestExecutionLevel admin<br />
Name &quot;Font&quot;<br />
OutFile &quot;font.exe&quot;<br />
<br />
Page instfiles<br />
<br />
Section &quot;&quot;<br />
<br />
SetOutPath &quot;C:\Windows\Fonts&quot;<br />
File Vet-Files.ttf<br />
	  <br />
SectionEnd<br />
<br />
<br />
I've got the latest version of NSIS (2.31) (which by the<br />
way is a very nice program)<br />
<br />
I don't know what i'm doing wrong.<br />
On my Windows XP this code works perfect.<br />
<br />
:(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th October 2007, 16:02</div></div><div class="posttext">Vista has some automatic file redirection when it comes to the system directory. It's usually disabled when you use RequestExecutionLevel. I don't know why it keeps redirecting in this case. Maybe if we find out where it redirects, it'll shed some light. Can you search the entire HD for vet-files.ttf?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GDMVET</div><div class="date">19th October 2007, 16:24</div></div><div class="posttext">I've searched the entire HD but can't find &quot;vet-files.ttf&quot; anywhere :(<br />
<br />
(except off course in my own maps in program files)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th October 2007, 16:32</div></div><div class="posttext">Try running FileMon (http://www.microsoft.com/technet/sysinternals/utilities/filemon.mspx) in the background to see where it actually tries to write it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">19th October 2007, 17:25</div></div><div class="posttext">Just an idea: <br />
It might actually copy the font in C:\Windows\Fonts correctly, but the search feature of windows scan the &quot;Fonts&quot; folder differently that a standard folder and search through the registered fonts rather than the actual files.<br />
(use a DOS box to &quot;dir&quot; the content of this folder)<br />
<br />
Try adding the registerFont call to your latest scripts ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GDMVET</div><div class="date">19th October 2007, 17:51</div></div><div class="posttext">Hi Wizou,<br />
<br />
You're right !!! I used the dos box to scan for my font and it was there ! Process Monitor already showed me that the font was copied correctly to the fonts folder.<br />
<br />
So I changed my simple code to this :<br />
<br />
RequestExecutionLevel admin<br />
Name &quot;Font&quot;<br />
OutFile &quot;font.exe&quot;<br />
<br />
Page instfiles<br />
<br />
Section &quot;&quot;<br />
<br />
SetOutPath &quot;C:\Windows\Fonts&quot;<br />
File Vet-Files.ttf<br />
<br />
sectionEnd<br />
<br />
Section &quot;Font&quot;<br />
<br />
GetTempFileName $R0 <br />
SetOverwrite On<br />
File /oname=$R0 fonts.dll <br />
Push &quot;Vet-Files.TTF&quot; <br />
CallInstDLL $R0 registerFont<br />
<br />
SectionEnd<br />
<br />
What happens is it registers the font correct, but only once.  When I restart Windows, it's not registered and my font doesn't show up anymore.<br />
<br />
Any ideas ? Is there another way to register a font in Vista ?<br />
<br />
Thx already for all the great responses<br />
<br />
So there must be a different code for registering the font in Vista !</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">21st October 2007, 20:49</div></div><div class="posttext">I tried using the http://nsis.sourceforge.net/Register_Fonts example, and it seems to work fine in Vista after a reboot</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GDMVET</div><div class="date">22nd October 2007, 09:56</div></div><div class="posttext">Hi Anders,<br />
<br />
Thx for the link you provided.  I already played around with FontReg.nsh awhile ago, but couldn't get it to work back then.  Now I can, so my font problem is solved !<br />
It works perfect both under XP and Vista, even after rebooting.<br />
Thanks alot everyone for pointing in me in the right direction.<br />
<br />
Now there's still one big hurdle for me to overcome deploying my demo-version on Windows Vista : my demo contains a database with a backend and a frontend.  The backend sits in a subfolder of $ProgramFiles\Vet-Files-Demo.<br />
The problem is that Vista doesn't allow users to change data in the backend.  I can only overcome this by letting users disable UAC on their computer, which is something I rather don't want to do.  Is there a simple workaround ? Am I doing something stupid here ?  I'm not really a programmer, I'm more more like a selfmade amateur ;) Any tips would be appreciated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">22nd October 2007, 10:22</div></div><div class="posttext">Give normal users write access to that folder with http://nsis.sourceforge.net/AccessControl_plug-in</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GDMVET</div><div class="date">22nd October 2007, 11:46</div></div><div class="posttext">Hi Anders,<br />
<br />
Thx for the link ! Works like a charm !<br />
All my hurdles are overcome ;) I'm gonna start burning now !<br />
Thx everybody for the great support.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>