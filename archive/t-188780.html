<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Read version out .ini file, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Read version out .ini file NSIS Discussion" />
	
	<title> Read version out .ini file [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Read version out .ini file</div>
<hr />
<div class="pda"><a href="t-188780.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=188780">Read version out .ini file</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Perky Jacket</div><div class="date">3rd August 2004, 18:43</div></div><div class="posttext">Hi,<br />
<br />
I wanna make a patch for my application.<br />
So I gotta write a registry string for the previous version<br />
and have to read this registry string in the new version,<br />
right?<br />
<br />
But how i do this? <br />
(version is 1.0)<br />
<br />
WriteRegStr HKLM &quot;Software/Example&quot; &quot;&quot; &quot;${PRODUCT_VERSION}&quot; <br />
<br />
is that right?<br />
<br />
And in the setup for the new version<br />
<br />
ReadRegStr HKLM &quot;Software/Example&quot; &quot;&quot; &quot;.....&quot; ;and now? this is my first problem<br />
<br />
When I find it out, how I insert a condition, that ask for the registry and version of the old version.<br />
<br />
The setup shouldn´t to continue, if the previous version not installed on the system. But it shouldn´t check, if a file is installed.<br />
This is the reason why I need this stuff with the registry bla bla.<br />
<br />
Oh sh*t, my english is so bad :( <br />
I hope your understand me and can help.<br />
<br />
ps: I don´t look over the documention for the registry stuff<br />
<br />
EDIT:<br />
I´ve choose a wrong thread name. &quot;Read version out .ini file&quot; was my misstake, sry.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">3rd August 2004, 19:13</div></div><div class="posttext">you're mixing up WriteRegStr (http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.2.16) with WriteINIStr (http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.2.13) and ReadRegStr (http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.2.12) with ReadINIStr (http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.2.10). if you want to write the version into an ini-file (myfile.ini) you will need to use WriteINIStr/ReadINIStr. if you want the version stored in the windows registry, you must use WriteRegStr/ReadRegStr.<br />
<br />
the other problem is that you don't use the correct syntax for each Read command.<br />
<br />
try this:<br />
WriteRegStr &quot;HKLM&quot; &quot;Software/Example&quot; &quot;&quot; &quot;${PRODUCT_VERSION}&quot;<br />
ReadRegStr $0 &quot;HKLM&quot; &quot;Software/Example&quot; &quot;&quot;<br />
or<br />
WriteINIStr &quot;$EXEDIR\MyFile.ini&quot; &quot;MySection&quot; &quot;Version&quot; &quot;${PRODUCT_VERSION}&quot;<br />
ReadINIStr $0 &quot;$EXEDIR\MyFile.ini&quot; &quot;MySection&quot; &quot;Version&quot;<br />
in both cases the value is in the string $0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Perky Jacket</div><div class="date">3rd August 2004, 21:59</div></div><div class="posttext">Thanks.<br />
<br />
In the setup of the previous version I insert:<br />
<br />
WriteRegStr &quot;HKLM&quot; &quot;Software/Example&quot; &quot;&quot; &quot;${PRODUCT_VERSION}&quot;<br />
<br />
And in the setup of the new version I insert:<br />
<br />
ReadRegStr $0 &quot;HKLM&quot; &quot;Software/Example&quot; &quot;&quot;<br />
<br />
<br />
But with wich command I have to insert the condition?<br />
If version xyz than ...<br />
<br />
else<br />
....<br />
<br />
How I do this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">4th August 2004, 03:00</div></div><div class="posttext">Check out this:<br />
<br />
Comparing full versions numbers (xx.xx.xx.xx ? xx.xx.xx.xx) (http://nsis.sourceforge.net/archive/viewpage.php?pageid=409)<br />
<br />
You can compare the return value with IntCmp. Like:<br />
<br />
IntCmp $var 1 IfNewer IfEqual IfOlder<br />
IfNewer:<br />
<br />
  # put commands, or wharever you like.<br />
<br />
Goto End<br />
<br />
IfEqual:<br />
<br />
  # put commands, or wharever you like.<br />
<br />
Goto End<br />
<br />
IfOlder:<br />
<br />
  # put commands, or wharever you like.<br />
<br />
End:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Perky Jacket</div><div class="date">4th August 2004, 13:57</div></div><div class="posttext">It´s so damn complicated or I´m dumb like bread.<br />
<br />
I´ve insert this (in the setup for the new version):<br />
<br />
<br />
WriteRegStr &quot;HKLM&quot; &quot;Software/Map2&quot; &quot;&quot; &quot;${PRODUCT_VERSION}&quot;<br />
ReadRegStr $0 &quot;HKLM&quot; &quot;Software/Map&quot; &quot;&quot;<br />
IntCmp $var 1 IfNewer IfEqual IfOlder<br />
IfNewer:<br />
<br />
  Messagebox MB_OK &quot;Older Version was found&quot;<br />
<br />
Goto End<br />
<br />
IfEqual:<br />
<br />
  Messagebox MB_OK &quot;Same Version was found&quot;<br />
<br />
Goto End<br />
<br />
IfOlder:<br />
<br />
  Messagebox MB_OK &quot;Newer Version was found&quot;<br />
<br />
End:<br />
<br />
<br />
But if I install the new version (with this code) it´s<br />
show &quot;Same Version was found&quot;. But it´s have to show<br />
&quot;Older Version was found&quot;.<br />
<br />
What´s wrong?<br />
<br />
Sry, I´m a noob.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">4th August 2004, 14:06</div></div><div class="posttext">Sorry, I was expecting you to use that function I pointed out, because you can't compare dotted versions with IntCmp alone.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Perky Jacket</div><div class="date">4th August 2004, 14:41</div></div><div class="posttext">I´ve checked out thee link, wich u give me.<br />
I´ve tryed the scripts but it doesn´t work.<br />
<br />
It´s to puke &gt;_&lt; .<br />
<br />
I can script simply installers with downloads, with subsection, with custompages but not this! *arg*<br />
<br />
Now I have tryed the code from the NSIS setup.<br />
The code with &quot;add/reinstall components&quot; and &quot;remove&quot;.<br />
It´s checked the version, too.<br />
It´s works halfways. The only problem is, that the setup show, it´s an older version installed. Doing so it is<br />
the same version. :mad:<br />
<br />
Please, u have to help me. It´s damn important.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">4th August 2004, 14:58</div></div><div class="posttext">Hmmm... I read more about this function and it's not what expected. I used a function called &quot;Version Check&quot; function (where can I find it?).<br />
<br />
Use this code where you want to detect the version:<br />
<br />
ReadRegStr $0 &quot;HKLM&quot; &quot;Software/Map&quot; &quot;&quot;<br />
<br />
Push $0<br />
Push ${PRODUCT_VERSION}<br />
Call VersionCheck<br />
Pop $1<br />
<br />
IntCmp $1 1 IfNewer IfEqual IfOlder<br />
IfNewer:<br />
<br />
  # put commands, or wharever you like.<br />
<br />
Goto End<br />
<br />
IfEqual:<br />
<br />
  # put commands, or wharever you like.<br />
<br />
Goto End<br />
<br />
IfOlder:<br />
<br />
  # put commands, or wharever you like.<br />
<br />
End:Put this at the bottom of the script, outside functions and sections:<br />
<br />
Function VersionCheck<br />
  Exch $0 ;second versionnumber<br />
  Exch<br />
  Exch $1 ;first versionnumber<br />
  Push $R0 ;counter for $0<br />
  Push $R1 ;counter for $1<br />
  Push $3 ;temp char<br />
  Push $4 ;temp string for $0<br />
  Push $5 ;temp string for $1<br />
  StrCpy $R0 &quot;-1&quot;<br />
  StrCpy $R1 &quot;-1&quot;<br />
  Start:<br />
  StrCpy $4 &quot;&quot;<br />
  DotLoop0:<br />
  IntOp $R0 $R0 + 1<br />
  StrCpy $3 $0 1 $R0<br />
  StrCmp $3 &quot;&quot; DotFound0<br />
  StrCmp $3 &quot;.&quot; DotFound0<br />
  StrCpy $4 $4$3<br />
  Goto DotLoop0<br />
  DotFound0:<br />
  StrCpy $5 &quot;&quot;<br />
  DotLoop1:<br />
  IntOp $R1 $R1 + 1<br />
  StrCpy $3 $1 1 $R1<br />
  StrCmp $3 &quot;&quot; DotFound1<br />
  StrCmp $3 &quot;.&quot; DotFound1<br />
  StrCpy $5 $5$3<br />
  Goto DotLoop1<br />
  DotFound1:<br />
  StrCmp $4 &quot;&quot; 0 Not4<br />
    StrCmp $5 &quot;&quot; Equal<br />
    Goto Ver2Less<br />
  Not4:<br />
  StrCmp $5 &quot;&quot; Ver2More<br />
    IntCmp $4 $5 Start Ver2Less Ver2More<br />
  Equal:<br />
  StrCpy $0 &quot;0&quot;<br />
  Goto Finish<br />
  Ver2Less:<br />
  StrCpy $0 &quot;1&quot;<br />
  Goto Finish<br />
  Ver2More:<br />
  StrCpy $0 &quot;2&quot;<br />
  Finish:<br />
  Pop $5<br />
  Pop $4<br />
  Pop $3<br />
  Pop $R1<br />
  Pop $R0<br />
  Pop $1<br />
  Exch $0<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Perky Jacket</div><div class="date">6th August 2004, 13:39</div></div><div class="posttext">Thank you! Thank you! Thank you! Thank you! Thank you!<br />
<br />
It´s work!<br />
<br />
At first time I had make it so like u said.<br />
It had doesn´t work.<br />
<br />
The mistake was this:<br />
<br />
ReadRegStr $0 &quot;HKLM&quot; &quot;Software/Map&quot; &quot;&quot;<br />
<br />
<br />
It have to be:<br />
<br />
ReadRegStr $0 &quot;HKLM&quot; &quot;Software\Map&quot; &quot;&quot;<br />
<br />
<br />
A backslash.<br />
<br />
And it´s work now!<br />
Thanks!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>