<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" ReadRegStr $0 \subdirectory, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  ReadRegStr $0 \subdirectory NSIS Discussion" />
	
	<title> ReadRegStr $0 \subdirectory [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  ReadRegStr $0 \subdirectory</div>
<hr />
<div class="pda"><a href="t-326243.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=326243">ReadRegStr $0 \subdirectory</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Aaskilde</div><div class="date">20th January 2011, 13:00</div></div><div class="posttext">Hi,<br />
<br />
I have a question about the ReadRegStr code!<br />
<br />
section &quot;ntf&quot;<br />
<br />
	ReadRegStr $0 HKLM &quot;SOFTWARE\Lotusnotes\Domino\1&quot; &quot;DataPath&quot;<br />
	<br />
	setOutPath $0<br />
	<br />
	file /r NeoDashboard43_ntf\*.*<br />
	<br />
sectionEnd<br />
<br />
This code works just fine, but i need to go down one more directory then the path in the directory specify.<br />
<br />
Like this, the path that i get from the Registry file is different depending on where the path is installed on the target computer, but lets say is something like: &quot;....\Domino\Data&quot; that path is from the ReadRegStr code. But i need to get one directory further down, &quot;\Domino\Data\html&quot;, how can i get my installer to take the html directory in with that code?<br />
<br />
I hope you can understand my question..<br />
<br />
-Aaskilde</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Aaskilde</div><div class="date">20th January 2011, 13:23</div></div><div class="posttext">setOutPath $0\html <br />
<br />
is the answer to my problems :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th January 2011, 13:23</div></div><div class="posttext">SetOutPath $0\html<br />
<br />
?<br />
<br />
Edit: Ah you got it. Also you're not checking that value exists. If it doesn't you will end up extracting to C:\html.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Aaskilde</div><div class="date">20th January 2011, 13:38</div></div><div class="posttext">SetOutPath $0\html<br />
<br />
?<br />
<br />
Edit: Ah you got it. Also you're not checking that value exists. If it doesn't you will end up extracting to C:\html.<br />
<br />
Stu<br />
<br />
<br />
<br />
Oh!, I have just been asked by my boss, if i can find a way to make a code that do like you said, checking if it is there, and if continue, if not pop up with a page where you can browse the path?<br />
<br />
-Aaskilde</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th January 2011, 13:44</div></div><div class="posttext">To do that you should add a MUI_PAGE_DIRECTORY and read the value in the page pre function (define MUI_PAGE_CUSTOMFUNCTION_PRE). If the value is valid then call Abort to skip the page:Function Directory_Pre<br />
  ClearErrors<br />
  ReadRegStr $0 HKLM SOFTWARE\Lotusnotes\Domino\1 DataPath<br />
  ${IfNot} ${Errors}<br />
  ${AndIf} $0 != ``<br />
  ${AndIf} ${FileExists} $0\html\*.*<br />
    Abort<br />
  ${EndIf}<br />
FunctionEndStu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Aaskilde</div><div class="date">20th January 2011, 14:02</div></div><div class="posttext">Okay i am very new to this and i do not think that the manual is beginner friendly so i am sorry for all the questions! <br />
<br />
I have made this code now:<br />
	<br />
!define MUI_PAGE_CUSTOMFUNCTION_Html_PRE<br />
	<br />
	Function Html_Pre<br />
<br />
  ClearErrors<br />
<br />
  ReadRegStr $0 HKLM SOFTWARE\Lotusnotes\Domino\1 DataPath<br />
<br />
  ${IfNot} ${Errors}<br />
<br />
  ${AndIf} $0 != setOutPath $DESKTOP<br />
<br />
  ${AndIf} ${FileExists} $0\html\*.*<br />
<br />
    Abort<br />
<br />
  ${EndIf}<br />
<br />
FunctionEnd<br />
<br />
Should this work? I get this error if i try run it;<br />
<br />
!define: &quot;MUI_PAGE_CUSTOMFUNCTION_Html_PRE&quot;=&quot;&quot;<br />
Function: &quot;Html_Pre&quot;<br />
ClearErrors<br />
ReadRegStr $0 HKLM\SOFTWARE\Lotusnotes\Domino\1\DataPath<br />
Invalid command: ${IfNot}<br />
<br />
<br />
I think i get that if there is an error it's running the code i place here: ${AndIf} $0 != ``<br />
<br />
But if i need a browser to show up, so they can give that path themselves, is that something u might know?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th January 2011, 14:51</div></div><div class="posttext">Are you using Modern UI?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Aaskilde</div><div class="date">21st January 2011, 14:28</div></div><div class="posttext">Hey mate, thanks for the help! <br />
<br />
I did not use the Modern UI, but have now rewritting my code and are using it now, and damn that is just a lot easier and much more stylish! <br />
<br />
I been looking at finding some way so slow down the installation, maybe some disc space check and sleeptimer, but i have not been able to find the code to the Modern UI, i do not now if there maybe is a site with more different codes then on the Modern UI page?<br />
<br />
Aaskilde</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st January 2011, 16:28</div></div><div class="posttext">OK now that you are using Modern UI 2 (MUI2.nsh yes?) then you can use my code with:Var DataPath<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE Directory_Pre<br />
!define MUI_DIRECTORYPAGE_VARIABLE $DataPath<br />
!insertmacro MUI_PAGE_DIRECTORY(Replace $0 with $DataPath in my code).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Aaskilde</div><div class="date">24th January 2011, 10:26</div></div><div class="posttext">Okay perfect i will give it try!<br />
<br />
And yes i am using MUI2.nsh, and i must say its quit interesting to make installers, live the result you get :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Aaskilde</div><div class="date">24th January 2011, 13:08</div></div><div class="posttext">Var DataPath<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE Directory_Pre<br />
<br />
!define MUI_DIRECTORYPAGE_VARIABLE $DataPath<br />
<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
Function Directory_Pre<br />
<br />
  ClearErrors<br />
<br />
  ReadRegStr $0 HKLM &quot;SOFTWARE\Lotusnotes\Domino\1&quot; &quot;DataPath&quot;<br />
<br />
  ${IfNot} ${Errors}<br />
<br />
  ${AndIf} $0\domino\html != <br />
<br />
  ${AndIf} ${FileExists} $0\domino\html<br />
<br />
    Abort<br />
<br />
  ${EndIf}<br />
<br />
FunctionEnd<br />
______________________________________________________________________<br />
<br />
Okay then this is my code now. <br />
<br />
But i don't think it work like it maybe should! :) The main thing is that at the $0\domino\html, the html dir can in some of my cases have been moved it happens rarely but i need an error, or if it is possible a way to extract that specific &quot;html&quot; folder on a browsed location, and only that folder(Its a installer for some of our users and they should be able to do it by themselves) ! But when i try and test it, and move the html dir so it is not in that path, it just creates the folder and move the files in there, i hope you can follow me! <br />
<br />
-Aaskilde</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th January 2011, 13:51</div></div><div class="posttext">As I said in my post you need to replace the 3 instances of $0 with $DataPath. $DataPath is what will be displayed on the directory page but you are reading into $0.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Aaskilde</div><div class="date">24th January 2011, 14:44</div></div><div class="posttext">Function Directory_Pre<br />
<br />
  ClearErrors<br />
<br />
  ReadRegStr $Datapath HKLM &quot;SOFTWARE\Lotusnotes\Domino\1&quot; &quot;DataPath&quot;<br />
<br />
  ${IfNot} ${Errors}<br />
<br />
  ${AndIf} $Datapath != ''<br />
<br />
  ${AndIf} ${FileExists} $Datapath\domino\html\*.*<br />
<br />
    Abort<br />
<br />
  ${EndIf}<br />
<br />
FunctionEnd<br />
___________________________<br />
<br />
Likes this right? If i remove the html folder the .exe just creates the folder at the location from the registry, and that is what is should not do, i need an error or and browser were you can manually place the files. Is that possible?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th January 2011, 18:43</div></div><div class="posttext">The only thing wrong with that code is you probably want to add StrCpy $DataPath $DataPath\domino\html just before the Abort. You keep saying you need a 'browser' for manual directory selection which is exactly what the Directory page is for. Do you never see the directory page? Also make sure you use $DataPath in your install sections. If you're reading from the registry key again on install then that is defeating the purpose of having $DataPath store the result of the directory page.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Aaskilde</div><div class="date">25th January 2011, 08:33</div></div><div class="posttext">I know that i can get a directory page to show, but the main thing with this installer is that the users i am creating this installer to, are in hopefully all cases having the directories in the path i am getting from the registry, but it is possible to move the &quot;html&quot; dir, as said before in that case i need the html dir to be manually installed, but i have talked with some from my work and they say that it is most rarely and some have never seen it being moved, so that is not a priority anymore. <br />
<br />
Now my boss has asked if it is possible to get a page that shows the directory in which the installer gets from the registry, in this case C:\Lotus\Domino\Data for example.<br />
<br />
I have tried to add the directory page, and get the ReadRegStr $0 HKLM &quot;SOFTWARE\Lotus\Domino\1&quot; &quot;DataPath&quot; - to be shown and grayed out in best case so they cant change it, and i need it to be the path from the directory because it can be placed on different drives depending on the user, but i can't get it to work. <br />
Then i tough a customized page, but that seems pretty difficult to make, .ini file, and so on. <br />
<br />
I don't know if you got something that could help me here. I am really great full for all the help i have gotten from you at this point!<br />
<br />
-Aaskilde</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">25th January 2011, 08:47</div></div><div class="posttext">Then i tough a customized page, but that seems pretty difficult to make, .ini file, and so on. <br />
.ini files belong to InstallOptions, which should no longer be used. What you need is nsDialogs. There's an excellent tutorial in the nsDialogs readme.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Aaskilde</div><div class="date">25th January 2011, 10:39</div></div><div class="posttext">.ini files belong to InstallOptions, which should no longer be used. What you need is nsDialogs. There's an excellent tutorial in the nsDialogs readme.<br />
<br />
Okay great gonna look at it :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>