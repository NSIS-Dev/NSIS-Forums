<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" how to edit a text file?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  how to edit a text file? NSIS Discussion" />
	
	<title> how to edit a text file? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  how to edit a text file?</div>
<hr />
<div class="pda"><a href="t-205283.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=205283">how to edit a text file?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">JedBartlett</div><div class="date">18th January 2005, 20:03</div></div><div class="posttext">Hi,<br />
<br />
I'm installing an app with a config file that looks something like this:<br />
<br />
&lt;config&gt;<br />
&lt;path&gt;c:\my_dir\my.file&lt;/path&gt;<br />
&lt;/config&gt;<br />
<br />
I need to change &quot;c:\my_dir&quot; to the installation directory at install time (ex. to &quot;d:\another_dir&quot;) <br />
<br />
Can anyone help me get started?  A simple find and replace text in a file would be perfect.<br />
<br />
Any help is greatly appreciated, Jed</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">18th January 2005, 20:26</div></div><div class="posttext">at this time there isn't &quot;teh&quot; xml parser plugin .... :rolleyes:<br />
<br />
but you can parse that file.... isn't that hard... just loop with strstr until you'll find &lt;path&gt;...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">18th January 2005, 20:27</div></div><div class="posttext">there are various scripts for text-replacement in the archive (http://nsis.sourceforge.net/archive/nsisweb.php)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">FitzChivalry</div><div class="date">18th January 2005, 20:30</div></div><div class="posttext">There are several text replacement examples provided with NSIS, but I found that I needed to dig a little deeper to come up with what I needed to do exactly what you're requesting. Here's the code that I came up with (which is cobbled together from a couple different sources, and then slightly modified): <br />
<br />
Function searchReplace<br />
  ClearErrors<br />
  StrCpy $OLD_TEXT_EOL &quot;$OLD_TEXT$CRLF&quot;<br />
  FileOpen $SOURCE_FILE $FILENAME &quot;r&quot;<br />
  GetTempFileName $TMP_FILE<br />
  FileOpen $TARGET_FILE $TMP_FILE &quot;w&quot;<br />
  loop:<br />
     FileRead $SOURCE_FILE $CURRENT_STRING<br />
     IfErrors done<br />
     StrCmp $CURRENT_STRING $OLD_TEXT_EOL 0 compare_without_eol<br />
        FileWrite $TARGET_FILE $NEW_TEXT<br />
        FileWrite $TARGET_FILE $CRLF<br />
;        MessageBox MB_OK &quot;Replaced text $OLD_TEXT&quot;<br />
        Goto loop<br />
        <br />
     compare_without_eol:<br />
     StrCmp $CURRENT_STRING $OLD_TEXT 0 write_original_string<br />
        FileWrite $TARGET_FILE $NEW_TEXT<br />
;        MessageBox MB_OK &quot;Replaced text $OLD_TEXT&quot;<br />
        Goto loop<br />
<br />
     write_original_string:<br />
     FileWrite $TARGET_FILE $CURRENT_STRING<br />
     Goto loop<br />
<br />
  done:<br />
     FileClose $SOURCE_FILE<br />
     FileClose $TARGET_FILE<br />
     Delete $SOURCE_FILE<br />
     CopyFiles /SILENT $TMP_FILE $FILENAME<br />
     Delete $TMP_FILE<br />
FunctionEnd<br />
<br />
<br />
To call this function:<br />
<br />
  StrCpy $OLD_TEXT &quot;c:\my_dir&quot;<br />
  StrCpy $NEW_TEXT &quot;${INSTDIR}&quot;<br />
  Call searchReplace</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JedBartlett</div><div class="date">18th January 2005, 21:44</div></div><div class="posttext">Originally posted by Yathosho <br />
there are various scripts for text-replacement in the archive (http://nsis.sourceforge.net/archive/nsisweb.php)  <br />
&lt;p&gt;<br />
Great, thanks!  Found one that did the trick.<br />
&lt;p&gt;<br />
Jed</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>