<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" run bat file in WindowXP, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  run bat file in WindowXP NSIS Discussion" />
	
	<title> run bat file in WindowXP [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  run bat file in WindowXP</div>
<hr />
<div class="pda"><a href="t-308075.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=308075">run bat file in WindowXP</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">DanielTao</div><div class="date">8th July 2009, 10:34</div></div><div class="posttext">Hi, all, I'm a fresher, I want to run a bat in my setup, but I tried several routines and none succeeded. Any expert can help me?  <br />
<br />
Refer to the -RunScript section. Every exec command just shows the command line black window but no bat excuted, why?<br />
<br />
Here is my bat: <br />
<br />
rem Test<br />
echo this is exec: %1<br />
notepad<br />
pause<br />
rem Test End<br />
<br />
Here is my nsi file:<br />
<br />
!Define PRODUCT_NAME &quot;My application&quot;<br />
!define PRODUCT_VERSION &quot;1.0&quot;<br />
!define PRODUCT_PUBLISHER &quot;My company, Inc.&quot;<br />
!define PRODUCT_WEB_SITE &quot;http://www.mycompany.com&quot;<br />
!define PRODUCT_UNINST_KEY &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot;<br />
!define PRODUCT_UNINST_ROOT_KEY &quot;HKLM&quot;<br />
<br />
Name &quot;${PRODUCT_NAME} ${PRODUCT_VERSION}&quot;<br />
OutFile &quot;Setup.exe&quot;<br />
InstallDir &quot;C:\My application&quot;<br />
ShowInstDetails show<br />
ShowUnInstDetails show<br />
<br />
Section &quot;MainSection&quot; SEC01<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
  SetOverwrite try<br />
  File &quot;D:\AENet\NSISWorkSpace\testExec\src\exec.bat&quot;<br />
  WriteUninstaller &quot;$INSTDIR\uninst.exe&quot;<br />
SectionEnd<br />
<br />
Section -RunScript<br />
;ReadEnvStr $0 COMSPEC<br />
ExpandEnvStrings $0 %COMSPEC%<br />
Exec '&quot;$0&quot;  &quot;$INSTDIR\exec.bat&quot;'<br />
MessageBox MB_OK &quot;exec&quot;<br />
Exec 'cmd.exe   &quot;$INSTDIR\exec.bat&quot;'<br />
MessageBox MB_OK &quot;execwait&quot;<br />
ExecWait '$0  &quot;$INSTDIR\exec.bat&quot;'<br />
MessageBox MB_OK &quot;execshell&quot;<br />
ExecShell &quot;&quot; &quot;$INSTDIR\exec.bat&quot; $InstDir SW_ShowNormal<br />
MessageBox MB_OK &quot;nsisexec&quot;<br />
nsExec::Exec '$0  &quot;$INSTDIR\exec.bat&quot; &quot;$INSTDIR&quot;'<br />
SectionEnd<br />
<br />
<br />
Function un.onUninstSuccess<br />
  HideWindow<br />
  MessageBox MB_ICONINFORMATION|MB_OK &quot;$(^Name) was successfully removed from your computer.&quot;<br />
FunctionEnd<br />
<br />
Function un.onInit<br />
  MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 &quot;Are you sure you want to completely remove $(^Name) and all of its components?&quot; IDYES +2<br />
  Abort<br />
FunctionEnd<br />
<br />
Section Uninstall<br />
  Delete &quot;$INSTDIR\uninst.exe&quot;<br />
  Delete &quot;$INSTDIR\exec.bat&quot;<br />
  RMDir &quot;$INSTDIR&quot;<br />
<br />
  SetAutoClose true<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">8th July 2009, 10:52</div></div><div class="posttext">no need to post your full script (and if, please attach it). you need to use ExecShell for bat files, Exec is for executables only.<br />
<br />
http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.1.3</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DanielTao</div><div class="date">9th July 2009, 02:08</div></div><div class="posttext">Thanks for you reply, I also tried ExecShell, but I found I can NOT add correct parameters to this running, like I want to execute:<br />
exec.bat &quot;c:\my project&quot;<br />
but in execshell, always is:<br />
exec.bat c:\my<br />
params after the space are lost.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DanielTao</div><div class="date">9th July 2009, 02:11</div></div><div class="posttext">See my tries, all these are wrong:<br />
<br />
Section -RunScript<br />
;ReadEnvStr $0 COMSPEC<br />
ExpandEnvStrings $0 %COMSPEC%<br />
Exec '&quot;$0&quot; &quot;$INSTDIR\exec.bat&quot;'<br />
MessageBox MB_OK &quot;exec&quot;<br />
Exec 'cmd.exe &quot;$INSTDIR\exec.bat&quot;'<br />
MessageBox MB_OK &quot;execwait&quot;<br />
ExecWait '$0 &quot;$INSTDIR\exec.bat&quot;'<br />
MessageBox MB_OK &quot;execshell&quot;<br />
ExecShell &quot;&quot; &quot;$INSTDIR\exec.bat&quot; $InstDir SW_ShowNormal<br />
MessageBox MB_OK &quot;nsisexec&quot;<br />
nsExec::Exec '$0 &quot;$INSTDIR\exec.bat&quot; &quot;$INSTDIR&quot;'<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DanielTao</div><div class="date">9th July 2009, 06:44</div></div><div class="posttext">At last I found the resolution, I must add many quote to abide spaces, below three are right, but still has problem with execshell and nsExec:Exec<br />
<br />
ExpandEnvStrings $0 %COMSPEC%<br />
Exec '&quot;$0&quot; /C &quot;&quot;$INSTDIR\exec.bat&quot; &quot;$InstDir&quot;&quot;'<br />
MessageBox MB_OK &quot;exec&quot;<br />
Exec 'cmd.exe /K  &quot;&quot;$INSTDIR\exec.bat&quot; &quot;$InstDir&quot;&quot;'<br />
MessageBox MB_OK &quot;execwait&quot;<br />
ExecWait '$0  /C &quot;&quot;$INSTDIR\exec.bat&quot; &quot;$InstDir&quot;&quot;'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">9th July 2009, 06:59</div></div><div class="posttext">There are a lot of threads about this, you might try a search for it:<br />
<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=161259</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DanielTao</div><div class="date">10th July 2009, 02:19</div></div><div class="posttext">Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th July 2009, 12:02</div></div><div class="posttext">It's pretty simple:<br />
<br />
ReadEnvStr $R0 COMSPEC<br />
nsExec::ExecToLog `&quot;$R0&quot; /C &quot;$INSTDIR\exec.bat&quot;`<br />
Pop $R0<br />
<br />
You can also use ExecDos::exec /DETAILED which I prefer:<br />
http://nsis.sourceforge.net/ExecDos_plug-in<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>