<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Another Compile Time Question, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Another Compile Time Question NSIS Discussion" />
	
	<title> Another Compile Time Question [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Another Compile Time Question</div>
<hr />
<div class="pda"><a href="t-215620.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=215620">Another Compile Time Question</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">10th May 2005, 17:47</div></div><div class="posttext">I have to go one step further with this.  At compile time, I have to find filenames and use them at runtime.  It would be horrible to try to hardcode this many files.  Is this possible?  Here's the code with a bit of pseudo thrown in:<br />
<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
Name &quot;Test&quot;<br />
<br />
;Output File Name<br />
OutFile &quot;test.exe&quot;<br />
<br />
Section &quot;Install&quot;<br />
<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
;Find any dll's to deploy, deploy them, and register them ;<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
<br />
  !system 'ECHO ;FileCheck&gt;&quot;%TEMP%\Temp$$$.nsh&quot;'<br />
  !system 'IF EXIST &quot;D:\CheckFileTest\Folder1\*.dll&quot; ECHO !define Folder1&gt;&gt;&quot;%TEMP%\Temp$$$.nsh&quot;'<br />
  !include &quot;$%TEMP%\Temp$$$.nsh&quot;<br />
  !system 'DEL &quot;%TEMP%\Temp$$$.nsh&quot;'<br />
<br />
  !ifdef Folder1<br />
    ;;;COMPILE TIME CODE;;;<br />
    !system 'dir /B &quot;D:\CheckFileTest\Folder1\*.dll&quot; &gt; myFile.txt'<br />
    open myFile.txt<br />
    whileNotEndOfFile<br />
      $FileName = getLine myFile.txt<br />
<br />
      ;;;RUNTIME CODE;;;<br />
      IfFileExists &quot;$INSTDIR\$FileName&quot; 0 new_installation<br />
      StrCpy $ALREADY_INSTALLED 1<br />
 <br />
      new_installation:<br />
      !insertmacro InstallLib REGDLL $ALREADY_INSTALLED NOREBOOT_NOTPROTECTED $FileName $INSTDIR\$FileName %TEMP%<br />
    endWhile<br />
  !endif<br />
<br />
SectionEnd<br />
<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
<br />
Thanks,<br />
Eric</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th May 2005, 18:04</div></div><div class="posttext">You'll have to write an NSIS program to do it:<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=920&amp;instances=0,44<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">10th May 2005, 19:00</div></div><div class="posttext">I just couldn't come up with how this was going to pass back one filename at a time.  I guess I'd have to call one NSIS program to the write the filenames, then call a different program to grab one line at a time and delete that line, until all was gone???  Seems like a lot of work.<br />
<br />
But I think I've got an easier way.  NSIS is obviously best at runtime stuff.  I use NAnt in conjunction with NSIS in all of my builds.  So, I'll use NAnt to do the compile time stuff and add code (via NAnt) to the NSIS script to put the &quot;dll deployment&quot; code into the NSIS script.  I'll post an example here when I'm done if anyone is interested.  Thanks for the help Stu!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">11th May 2005, 11:19</div></div><div class="posttext">To have all features of NSIS run-time: &quot;create single exe and hand needfull parameters by CMDLINE (Call this single exe with !execute)&quot;</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>