<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" New plugin, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  New plugin NSIS Discussion" />
	
	<title> New plugin [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  New plugin</div>
<hr />
<div class="pda"><a href="t-209086.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=209086">New plugin</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">hgerstung</div><div class="date">28th February 2005, 09:17</div></div><div class="posttext">Hi y'all!<br />
<br />
I released my first plugin for NSIS (so be careful, it's a newbies work) called UserMgr. It can be found in the plugin section of the NSIS Archive and adds some functionality to NSIS when it comes to creating/deleting user accounts and adding/removing user privileges to accounts. Some user group related functions are included, too.<br />
<br />
I would appreciate any feedback / comments if you are willing to use this thing for your installer and surprisingly get it to work (or not).<br />
<br />
Kind regards,<br />
Heiko<br />
<br />
The Archive page for UserMgr (http://nsis.sourceforge.net/archive/nsisweb.php?page=917&amp;instances=0)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">flizebogen</div><div class="date">28th February 2005, 13:42</div></div><div class="posttext">Can you put a list of privileges online?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">28th February 2005, 14:05</div></div><div class="posttext">mmm, sounds cool, good work, dude :up:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">hgerstung</div><div class="date">28th February 2005, 15:17</div></div><div class="posttext">@flizebogen:<br />
<br />
Originally posted by flizebogen <br />
Can you put a list of privileges online?  <br />
<br />
That's tricky, I did not find a complete list on the web. But I added a list (incomplete) at the bottom of the archive page (here (http://nsis.sourceforge.net/archive/nsisweb.php?page=917&amp;instances=0)), this can be used for a start. <br />
<br />
HTH<br />
<br />
@Joelito: :cool: Thanks dude! :cool: <br />
<br />
Kind regards,<br />
Heiko</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Apazman123</div><div class="date">29th April 2005, 18:54</div></div><div class="posttext">I am trying to use this plugin to create a user and add them to the &quot;Administrators&quot; Group. I can add the user successfully, however when I try to Add that user to a group I get an ERROR 2220 Which is &quot;The group name could not be found. &quot; I have double and triple checked the spelling. I also tried to add it to the &quot;Guests&quot; group. I still got the same error. It seems like adding a user to a group may not work? Here is the code I am trying to use. <br />
<br />
UserMgr::AddToGroup &quot;progsvc&quot; &quot;Administrators&quot;<br />
Pop $0                           <br />
MessageBox MB_OK &quot;AddToGroup Result : $0&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">hgerstung</div><div class="date">30th April 2005, 19:40</div></div><div class="posttext">Originally posted by Apazman123 <br />
I am trying to use this plugin to create a user and add them to the &quot;Administrators&quot; Group. I can add the user successfully, however when I try to Add that user to a group I get an ERROR 2220 Which is &quot;The group name could not be found. &quot; I have double and triple checked the spelling. I also tried to add it to the &quot;Guests&quot; group. I still got the same error. It seems like adding a user to a group may not work? Here is the code I am trying to use. <br />
<br />
UserMgr::AddToGroup &quot;progsvc&quot; &quot;Administrators&quot;<br />
Pop $0                           <br />
MessageBox MB_OK &quot;AddToGroup Result : $0&quot;  <br />
<br />
Hi!<br />
<br />
The AddToGroup function is not working properly, there is a problem with the string format I use, it's some UNICODE struggling and I was not able to solve this. But I'll try to check things again on Monday, so please stay tuned :-)<br />
<br />
Sorry for the inconvenience!<br />
<br />
Kind regards,<br />
Heiko</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Apazman123</div><div class="date">2nd May 2005, 18:43</div></div><div class="posttext">I really appreciate the help. It's a cool plugin and makes things really easy for setting up a web and/or application servers.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobGrant</div><div class="date">3rd May 2005, 09:12</div></div><div class="posttext">I use some user manipulation stuff in my company's installer - the syntax I use to add someone to a group is this:<br />
<br />
<br />
  ExecWait 'net localgroup group_name &quot;user_name&quot; /add'<br />
<br />
<br />
And to remove:<br />
<br />
<br />
  ExecWait 'net localgroup group_name &quot;user_name&quot; /delete'<br />
<br />
<br />
And mate, if your work (which I'm about to try) adds/removes the SeServiceLogonRight property correctly, then you've saved me lots of time, thanks! (I can add it easily, but can't remove it)<br />
<br />
-rob-</div></div><hr />


<div class="post"><div class="posttop"><div class="username">hgerstung</div><div class="date">3rd May 2005, 09:21</div></div><div class="posttext">Hi !<br />
<br />
I just wanted to tell you that I'm still working on that AddToGroup issue ... But maybe you can use Rob's way as a workaround until the plugin is able to do that.<br />
<br />
Originally posted by RobGrant <br />
I use some user manipulation stuff in my company's installer - the syntax I use to add someone to a group is this:<br />
<br />
<br />
  ExecWait 'net localgroup group_name &quot;user_name&quot; /add'<br />
<br />
<br />
And to remove:<br />
<br />
<br />
  ExecWait 'net localgroup group_name &quot;user_name&quot; /delete'<br />
<br />
<br />
And mate, if your work (which I'm about to try) adds/removes the SeServiceLogonRight property correctly, then you've saved me lots of time, thanks! (I can add it easily, but can't remove it)<br />
<br />
-rob-  <br />
<br />
Please note that there are a bunch of &quot;SeDenyxxLogonRight&quot; privileges which I needed to add in order to avoid an account from being able to logon interactively. That's a cute security model, isn't it?<br />
<br />
Kind regards,<br />
Heiko</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Apazman123</div><div class="date">3rd May 2005, 23:45</div></div><div class="posttext">Thanks Rob and Heiko for the cmd lines. Worked like a charm. Now I have another issue. I am trying to add the following options to the user:<br />
<br />
-Password Never expires<br />
-User cannot change Password<br />
<br />
Any Ideas?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">UnregBryan</div><div class="date">28th September 2005, 12:48</div></div><div class="posttext">Hi all.  28 September 05<br />
<br />
  Just ran into the problem of AddToGroup problem, but as none of the messages are dated do not know if this problem has been outstanding for a year or a day! Can someone please give me a time scale for a solution - thanks.<br />
<br />
Tried ...<br />
ExecWait 'net localgroup administrators &quot;TagUser&quot; /add'<br />
<br />
But get system error 1788 &quot;the trusted relationship..&quot;. I'm adding a user to Administrators. Any solution here?<br />
<br />
Many thanks<br />
Bryan<br />
<br />
<br />
Originally posted by hgerstung <br />
Hi !<br />
<br />
I just wanted to tell you that I'm still working on that AddToGroup issue ... But maybe you can use Rob's way as a workaround until the plugin is able to do that.<br />
<br />
 <br />
<br />
Please note that there are a bunch of &quot;SeDenyxxLogonRight&quot; privileges which I needed to add in order to avoid an account from being able to logon interactively. That's a cute security model, isn't it?<br />
<br />
Kind regards,<br />
Heiko</div></div><hr />


<div class="post"><div class="posttop"><div class="username">hgerstung</div><div class="date">28th September 2005, 13:03</div></div><div class="posttext">Hi!<br />
<br />
First:<br />
The time and date of a post can be found on the left side of the line directly below the message text (where the &quot;profile&quot;, &quot;pm&quot;, &quot;search&quot; etc. buttons reside)<br />
<br />
Second:<br />
As you see (by now), the last post you quoted was from March 2005, so it's been a while..<br />
<br />
I was not able to resolve this in the meantime as I simply do not have enough time to go after it (sorry).<br />
<br />
Maybe someone else can help out with the commandline workaround. If this does not work, my plugin has no chance either..<br />
<br />
Kind regards,<br />
Heiko</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ThierryThelliez</div><div class="date">28th October 2005, 19:07</div></div><div class="posttext">I have the same need here. Right now I am thinking of using NTRights.exe from the resource toolkit.<br />
<br />
http://support.microsoft.com/?kbid=279664<br />
<br />
(I hope it will work for W2K3)<br />
<br />
Your plugin would be really useful.<br />
<br />
Thierry</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jamyn Shanley</div><div class="date">26th February 2006, 12:42</div></div><div class="posttext">Just tried this plugin tonight; I wanted to add a user account to run a service in the background.  I must say, thank you for writing this plugin.  I think it will be very useful.<br />
<br />
A couple notes:<br />
<br />
1) The plugin does add the user and set the password. However, the user does not appear in the Control Panel -&gt; Users list. (testing with WindowsXP SP2).  This could be abused, obviously; hopefully this could be fixed.<br />
<br />
In comparison, when using the &quot;net user&quot; command, the user appears in &quot;Control Panel -&gt; Users&quot; immediately.<br />
<br />
2) Is there a way to &quot;update&quot; a user with this plugin, instead of just add/remove? I would like to be able to reset the password on the account if it exists (the password for the account is randomly generated during any install, and I need that password for the task scheduler).<br />
<br />
Example:<br />
<br />
<br />
Function AddUser <br />
    UserMgr::GetUserInfo ${RUNAS} EXISTS<br />
    StrCmp &quot;$0&quot; &quot;OK&quot; user_modify user_add<br />
    user_modify:<br />
    # FIXME: Previous password is random and unknown,<br />
    # so we need to reset it here.<br />
    Goto user_done<br />
    user_add:<br />
        UserMgr::CreateAccount &quot;${RUNAS}&quot; &quot;$RandomPassword&quot; &quot;${NAME} User&quot;<br />
        Pop $0<br />
        DetailPrint &quot;User: ${RUNAS} does not exist. Creating account (result: $0)&quot;<br />
        UserMgr::AddToGroup  &quot;${RUNAS}&quot; &quot;Guests&quot;<br />
        Pop $0<br />
        DetailPrint &quot;User: ${RUNAS} - applying account restrictions (result: $0)&quot;        <br />
        # FIXME: Remove interactive login permissions, etc.<br />
        # Lock the account down as much as possible.<br />
    Goto user_done<br />
    user_done:<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">hgerstung</div><div class="date">27th February 2006, 10:49</div></div><div class="posttext">Hi!<br />
<br />
The account can be found in the &quot;extended&quot; user manager applet, you can reach this by using the &quot;Advanced..&quot; button (I am not sure how exactly it is labelled, as my system is a german language XP). The cause of this could be a group membership (but I do not know exactly), maybe it appears if you add it to the Users group?<br />
<br />
Unfortunately the modification of a user account is not implemented. You could delete and re-create the user but this could of course cause problems with settings and files and so on.<br />
<br />
Kind regards,<br />
Heiko</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jamyn Shanley</div><div class="date">8th March 2006, 19:57</div></div><div class="posttext">I found some interesting code for PostgreSQL's msi-based installer.  I may be wrong, but the following code from their installer seems to deal with user and group permissions, etc.  Maybe it will help present new ideas for the current plugin?<br />
<br />
installer source (http://pgfoundry.org/frs/?group_id=1000007&amp;release_id=440)<br />
<br />
file: pginstaller-rel8_1_2-src\pginst\ca\user.c<br />
<br />
I am not really capable of translating this information into the current plugin; I apologize.  And maybe this information will not prove to be useful. But maybe it will :)<br />
<br />
-J</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">31st December 2007, 15:00</div></div><div class="posttext">Hello Heiko,<br />
<br />
I know it has been a while since the last post, but I have made a patch for your UserMgr plugin.<br />
<br />
These are the changes:<br />
<br />
 - I used NetLocalGroupAddMembers instead of NetGroupAddUser in the AddToGroup function to make it work.(Thanks to the article of CancerFace (http://nsis.sourceforge.net/User_Management_using_API_calls))<br />
<br />
 - I added the function CreateAccountEx to be able to add a fullname of a user (Shown in the Welcome Screen) and add flags to the user (Password never expires etc.):<br />
<br />
<br />
UserMgr::CreateAccountEx USERID PASSWORD COMMENT FULLNAME USERCOMMENT FLAGS<br />
where FLAGS can be one or more of the following, seperated by '|':<br />
UF_ACCOUNTDISABLE      The user's account is disabled.<br />
UF_PASSWD_NOTREQD      No password is required.<br />
UF_PASSWD_CANT_CHANGE  The user cannot change the password.<br />
UF_DONT_EXPIRE_PASSWD  The password will never expire on the account.<br />
<br />
 - I added the function BuiltAccountEnv. This function creates the User Environment (Documents and settings\{User} folder, User Registry Hive etc. to be able to do something there without the need to login as the new created user first:<br />
<br />
<br />
UserMgr::BuiltAccountEnv USERID PASSWORD<br />
<br />
 - I added the function RegLoadUserHive. This function loads the User Registry hive in HKEY_USERS\{USERID} to be able to add keys and values to the HKEY_CURRENT_USER of this user:<br />
<br />
<br />
UserMgr::RegLoadUserHive USERID<br />
<br />
 - I added the function RegUnLoadUserHive. This function unloads the User Registry hive:<br />
<br />
<br />
UserMgr::RegUnLoadUserHive USERID<br />
<br />
I guess the last two functions should be in a Registry Plugin, but since I only found a Plugin with Macro's (which I dislike...) I added it here.<br />
If you don't want it in the plugin, I can remove it.<br />
<br />
NOTE: The Platform SDK is needed for this project to compile (The February 2003 build is the last version which work with VC6) (http://www.microsoft.com/msdownload/platformsdk/sdkupdate/psdk-full.htm)<br />
 <br />
Best regards,<br />
Jan Pieter de Ruiter</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st December 2007, 18:20</div></div><div class="posttext">You should add the new version to the Wiki page. To upload files, see:<br />
<br />
http://nsis.sourceforge.net/Uploading_files</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">1st January 2008, 00:12</div></div><div class="posttext">Yes I know,<br />
<br />
but since it's Heiko's plugin I wanted to ask his opinion first.<br />
<br />
JP</div></div><hr />


<div class="post"><div class="posttop"><div class="username">hgerstung</div><div class="date">2nd January 2008, 20:55</div></div><div class="posttext">Jan Pieter,<br />
<br />
awesome work! Please do not hesitate to update the Wiki, that's what it's for! And please do not forget to give yourself the due credit.<br />
<br />
Thanks a lot for working on this,<br />
<br />
 Cheers,<br />
   Heiko</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">2nd January 2008, 21:43</div></div><div class="posttext">I have made two additions for the plugin:<br />
<br />
 - PASSWORD added as possible FIELD for the SetUserInfo function. With this field the user password can be changed (Admin rights needed)<br />
<br />
 - The function ChangeUserPassword is added to be able to change a user password (Admin rights not needed)<br />
<br />
I have also updated the Wiki page:<br />
http://nsis.sourceforge.net/UserMgr_plug-in<br />
You can find the updated plugin there.<br />
<br />
Regards,<br />
JP</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">15th January 2008, 00:50</div></div><div class="posttext">Hello,<br />
<br />
I have uploaded a new version:<br />
<br />
 - Fixed a small bug in GetUserInfo function<br />
<br />
 - Fixed 2 small bugs in SetUserInfo function<br />
<br />
 - Added GetCurrentUserName function<br />
<br />
 - Added GetLocalizedStdAccountName function<br />
(e.g. &quot;NT AUTHORITY\SYSTEM&quot; for &quot;S-1-5-18&quot; on a English system and &quot;NT-AUTORITÃ„T\NETZWERKDIENST&quot; for &quot;S-1-5-20&quot; on a German system)<br />
The most often used SID's are defined in the included SpecialGroupsSIDs.nsh<br />
<br />
 - Added IsMemberOfGroup function<br />
<br />
Best regards,<br />
jpderuiter</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">15th January 2008, 17:06</div></div><div class="posttext">Whoops, found a small (localization) bug in RegLoadUserHive.<br />
<br />
I uploaded a new version on the wiki page.<br />
<br />
JP</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">1st February 2008, 17:25</div></div><div class="posttext">Hello,<br />
<br />
I have uploaded a new version:<br />
<br />
- Fixed a bug in SetUserInfo function<br />
<br />
- Added HasPrivilege function<br />
<br />
Best regards,<br />
jpderuiter</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Margon</div><div class="date">21st June 2008, 12:12</div></div><div class="posttext">Hi,<br />
First of all, sorry for my English.<br />
<br />
I tried to use plugin in Russian Windows XP and found little localization problem: when i tried to work with user name in russian language function &quot;swprintf&quot; can't convert ANSI string to UNICODE in russian locale. I'l tried to use MultiByteToWideChar instead them and all works.<br />
IMHO, all functins <br />
&quot;swprintf(UNICODE_variable, L&quot;%S&quot;, ANSI_variable)&quot; <br />
must be replaced to something like<br />
MultiByteToWideChar(CP_ACP,0,UNICODE_variable,-1,ANSI_variable,sizeof(UNICODE_variable));<br />
<br />
Best regards, Dmitriy.<br />
P.S.: Sorry for my English.Once again:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">25th June 2008, 09:57</div></div><div class="posttext">@jpderuiter: you should really think about opening a new forum topic for your plugin, because this one lacks a decent title..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kc7bfi</div><div class="date">19th September 2008, 13:15</div></div><div class="posttext">The UserMgr.zip link does not seem to be working</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">19th September 2008, 14:52</div></div><div class="posttext">The UserMgr.zip link does not seem to be workingThe NSIS site is hosted by SourceForge who are currently migrating to a new datacentre. As a result some features on the NSIS wiki, including downloads, are not working properly at the moment. For more information see this topic:<br />
<br />
http://forums.winamp.com/showthread.php?threadid=297527</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ivan Andreevich</div><div class="date">21st January 2009, 20:27</div></div><div class="posttext">I am logged in as 'mshome\ivan', but <br />
UserMgr::GetCurrentUserName<br />
returns only 'ivan'. I am creating a service which uses network log on permissions. This action fails when domain is not specified. <br />
<br />
Any way to grab the full username, including the domain?<br />
<br />
Actually this http://nsis.sourceforge.net/NSISUser_plug-in kind of does what I need, but I would still prefer to be able to do the above.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">22nd January 2009, 00:23</div></div><div class="posttext">Hello Ivan,<br />
<br />
I uploaded a new version of the plugin, which has a new Function &quot;GetCurrentDomain&quot;.<br />
This function will return the domainname you are currently logged in to (in your case &quot;mshome&quot;).<br />
<br />
Best regards,<br />
jpderuiter</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">22nd January 2009, 08:19</div></div><div class="posttext">BTW:<br />
<br />
I started a new thread about the UserMgr Plugin with a more decent title:<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=302322</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>