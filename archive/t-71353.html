<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Path and environment variable, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Path and environment variable NSIS Discussion" />
	
	<title> Path and environment variable [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Path and environment variable</div>
<hr />
<div class="pda"><a href="t-71353.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=71353">Path and environment variable</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">DarkLord23</div><div class="date">9th January 2002, 10:20</div></div><div class="posttext">Hi to all,<br />
<br />
I would like to register some environment variables once the installer completed successfully.<br />
<br />
Add something to the PATH environment variable<br />
Add something to the CLASSPATH environment variable<br />
Define a new environment variable WEBCONF_HOME<br />
<br />
I have seen that for Win2000/NT this information is located on the registry so It would be possible to manipulate the content. However I do not know if NSIS is able to edit the autoexec.bat file ...<br />
<br />
I would like also put this for all users on Win2000, as well as shortcuts. There is a thread here but it's for not only (WINDIR\Profiles\All Users is for not, now it's Document And Settings\...)<br />
<br />
Thanks for any help</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th January 2002, 14:14</div></div><div class="posttext">Hi!<br />
<br />
Please see this thread (http://forums.winamp.com/showthread.php?s=&amp;threadid=67208).<br />
<br />
The last reply contains all the functions you need.<br />
<br />
KiCHiK</div></div><hr />


<div class="post"><div class="posttop"><div class="username">petersa</div><div class="date">9th January 2002, 14:27</div></div><div class="posttext">Hi DarkLord23,<br />
<br />
NSIS comes with file appending capabilities. All you need to do is append these lines to the AUTOEXEC.BAT file: SET PATH=%PATH%;[what to add to the path] SET CLASSPATH=%CLASSPATH%;[what to add] SET WEBCONF_HOME=[what to add]</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DarkLord23</div><div class="date">9th January 2002, 14:32</div></div><div class="posttext">Originally posted by petersa <br />
Hi DarkLord23,<br />
<br />
NSIS comes with file appending capabilities. All you need to do is append these lines to the AUTOEXEC.BAT file: SET PATH=%PATH%;[what to add to the path] SET CLASSPATH=%CLASSPATH%;[what to add] SET WEBCONF_HOME=[what to add] <br />
<br />
Thanks !!!<br />
Could u please give me more details about the append function? :) <br />
<br />
Thanks thanks thanks ;-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th January 2002, 14:34</div></div><div class="posttext">I have given you a link to the entire source code ready for you in functions...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DarkLord23</div><div class="date">9th January 2002, 14:37</div></div><div class="posttext">In the same problem, how can I append the path and the classpath in the registry (in case of NT/2000/XP) ???<br />
<br />
Thanks<br />
<br />
PS : for all users!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DarkLord23</div><div class="date">9th January 2002, 14:41</div></div><div class="posttext">Originally posted by kichik <br />
I have given you a link to the entire source code ready for you in functions... <br />
<br />
I've had a look at it but i can't find out how i Can append line to the files ... And how I can create new line :( :( :( <br />
<br />
What I want is :<br />
<br />
If OS is Win9x:<br />
<br />
Edit autoexec.bat<br />
add<br />
rem --- Added for webconf ---<br />
set PATH=$INSTDIR\bin\;%PATH%<br />
set CLASSPATH=$INSTDIR\lib\webconf.jar;$INSTDIR\lib\WebcanalApplet.class;%CLASSPATH%<br />
set WEBCONF_HOME=$INSTDIR<br />
<br />
If os is win NT/2000/XP<br />
<br />
APPEND these information in the registry for all users ...<br />
<br />
Thaks for ur help:( :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th January 2002, 14:46</div></div><div class="posttext">My AddToPath function does exactly that but only for PATH. It also changes the registry only for current user so you should change that one.<br />
<br />
Have a deeper look, if you still don't understand say so and I will be happy to help you understand.<br />
<br />
KiCHiK</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DarkLord23</div><div class="date">9th January 2002, 14:53</div></div><div class="posttext">Originally posted by kichik <br />
My AddToPath function does exactly that but only for PATH. It also changes the registry only for current user so you should change that one.<br />
<br />
Have a deeper look, if you still don't understand say so and I will be happy to help you understand.<br />
<br />
KiCHiK <br />
<br />
Thanks. In fact I don't figure out how to invoke your function. Something like<br />
<br />
AddToPath &quot;$INSTDIR\bin&quot; <br />
<br />
???<br />
<br />
;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th January 2002, 15:03</div></div><div class="posttext">Push &quot;C:\AddThisDirToPath\&quot;<br />
Call AddToPath<br />
<br />
<br />
I have also found remains to the times before version 1.80~<br />
Please change every<br />
GetShortPathName $0 $0<br />
;GetFullPathName /SHORT $0 $0<br />
to<br />
<br />
GetFullPathName /SHORT $0 $0<br />
[/code]<br />
<br />
KiCHiK</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DarkLord23</div><div class="date">9th January 2002, 15:18</div></div><div class="posttext">Originally posted by kichik <br />
<br />
Push &quot;C:\AddThisDirToPath\&quot;<br />
Call AddToPath<br />
<br />
<br />
I have also found remains to the times before version 1.80~<br />
Please change every<br />
GetShortPathName $0 $0<br />
;GetFullPathName /SHORT $0 $0<br />
to<br />
<br />
GetFullPathName /SHORT $0 $0<br />
[/code]<br />
<br />
KiCHiK <br />
<br />
In your code where are u declaring the KEY to Append. I want to make a new Function to add The classpath and the path to all users. Curently, there is<br />
<br />
<br />
ReadRegStr $1 HKCU &quot;Environment&quot; &quot;PATH&quot;<br />
		StrCmp $1 &quot;&quot; AddToPath_NTwasEmpty<br />
			StrCpy $0 &quot;$1;$0&quot;<br />
			Goto AddToPath_NTdoIt<br />
		AddToClassPath_NTwasEmpty:<br />
			StrCpy $1 $0<br />
		AddToClassPath_NTdoIt:<br />
			WriteRegStr HKCU &quot;Environment&quot; &quot;PATH&quot; $0<br />
			Push $OUTDIR<br />
			SetOutPath $TEMP<br />
			File &quot;RefreshEnv\Release\RefreshEnv.exe&quot;<br />
			Exec &quot;$TEMP\RefreshEnv.exe&quot;<br />
			Delete &quot;$TEMP\RefreshEnv.exe&quot;<br />
			Pop $OUTDIR<br />
<br />
<br />
The key where I have to write my classpath is:<br />
<br />
HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\Session Manager\Environment\classpath<br />
<br />
How can I do this?<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DarkLord23</div><div class="date">9th January 2002, 15:56</div></div><div class="posttext">Ok sorry It works. But I'm not sure whether <br />
<br />
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Environment<br />
<br />
Is the good place to update the variables ....<br />
<br />
Anyway, I have antoher question. In your fonction, you only need one param. I need two param for my fonction (add a new environment variable wich takes the name of the variable and its value<br />
<br />
Something like <br />
<br />
Push &quot;WEBCONF_HOME&quot; $INSTDIR&quot;<br />
Call createEnvVar<br />
<br />
<br />
Any idea?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th January 2002, 17:32</div></div><div class="posttext">It will be easier for you to make it accept two pushes.<br />
Push &quot;WEBCONF_HOME&quot;<br />
Push $INSTDIR<br />
Call createEnvStr<br />
If you don't know how have a look in my StrStr function in the same path.nsi file.<br />
<br />
About the registry, personally I prefer this kind of enviorment variable in the current user key because I want every user to have an option and not to force him this PATH from the local machine key.<br />
However, you can do whatever you want, and if you need every user to have this env var then go ahead and put it in the local machine key.<br />
<br />
KiCHiK</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>