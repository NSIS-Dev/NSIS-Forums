<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Removing parent directories, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Removing parent directories NSIS Discussion" />
	
	<title> Removing parent directories [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Removing parent directories</div>
<hr />
<div class="pda"><a href="t-125798.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=125798">Removing parent directories</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">tderouin</div><div class="date">20th February 2003, 21:58</div></div><div class="posttext">Our current installation installs our product to something like:<br />
<br />
C:\Program Files\CompanyName\ProductName<br />
<br />
During the uninstall, <br />
<br />
  RMDir /R &quot;$INSTDIR&quot;<br />
<br />
<br />
will only remove the ProductName folder, leaving an empty CompanyName folder. <br />
<br />
Is there a smart way to remove the folder CompanyName? As far as I can tell there is no way to capture which directories are being created by the installer. Hardcoding <br />
<br />
  RMDir /R &quot;$INSTDIR&quot;<br />
  RMDir /R &quot;C:\\Program Files\\CompanyName&quot;<br />
<br />
isn't a viable solution, because the problem still exists for non-default installations that have subfolders (and this problem also exists for removing shortcuts).<br />
<br />
Also, doing something like <br />
<br />
StrCpy $R0 $INSTDIR<br />
loop:<br />
      RMDir &quot;$R0&quot;<br />
      IfErrors goto done<br />
      StrCpy &quot;$R0&quot; &quot;$R0\\..&quot;<br />
      goto loop<br />
done:<br />
<br />
isn't a (completely) viable solution because you might end up deleting an empty directory the installer didn't create, that the user doesn't want deleted.<br />
<br />
Suggestions?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rainwater</div><div class="date">20th February 2003, 22:03</div></div><div class="posttext">http://nsis.sourceforge.net/archive/nsisweb.php?page=31&amp;instances=0,11</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th February 2003, 22:23</div></div><div class="posttext">You can use GetParent from the useful functions appendix (or from the link rainwater posted), use it on $INSTDIR and if what comes out is $PROGRAMFILES\CompanyName then you can delete it. I suggest you don't use /r so whatever the user put in there will stay.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tderouin</div><div class="date">20th February 2003, 22:55</div></div><div class="posttext">Right, but that is pretty much the same thing as the RMDIR $R0\.. option. <br />
<br />
What I need to know is whether or not the parent was created by the installer, what would be usefull (a suggestion) is that NSIS somehow keeps track of the files/directories it created, so they can be removed during the uninstall. I'm certain this is how most installers/uninstallers handle it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th February 2003, 23:03</div></div><div class="posttext">That's not the same as $R0\.. because you check against $PROGRAMFILES\CompanyName. If you want to know exactly which directories were created you can make a little recursion that will take the directory path apart and try to create every directory from the smallest part to the largest and final part. Use the latest CVS version and IfErrors after you create the directory to know if it was created or not. Save that somewhere and delete it upon uninstallation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tderouin</div><div class="date">20th February 2003, 23:06</div></div><div class="posttext">Right, but comparing it against CompanyName won't work if the user has entered in anoter value for &quot;CompanyName&quot;. Right?<br />
<br />
That's a good suggestion about creating the directories manually. Thanks :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>