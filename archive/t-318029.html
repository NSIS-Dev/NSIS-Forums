<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Folder.CopyHere to install fonts on Win7, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Folder.CopyHere to install fonts on Win7 NSIS Discussion" />
	
	<title> Folder.CopyHere to install fonts on Win7 [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Folder.CopyHere to install fonts on Win7</div>
<hr />
<div class="pda"><a href="t-318029.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=318029">Folder.CopyHere to install fonts on Win7</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Legace</div><div class="date">28th March 2010, 16:48</div></div><div class="posttext">I've tried and tried, but I just couldn't get CopyFiles or File to install fonts on Windows 7. Then I stumbled on this VBScript that does work:<br />
<br />
Const FONTS = &amp;H14&amp;<br />
'/-&gt; Path And Name To Font<br />
 Dim Font :Font =  &quot;PATH_FONT_NAME_HERE&quot;<br />
'/-&gt; Objects                              <br />
 Dim Folder, Fso, Shell<br />
 Set Fso = CreateObject(&quot;Scripting.FileSystemObject&quot;)<br />
 Set Shell = CreateObject(&quot;Shell.Application&quot;)<br />
 Set Folder = Shell.Namespace(FONTS)<br />
'/-&gt; Check For File Exists<br />
 If Fso.FileExists(Font) Then <br />
  Folder.CopyHere Font<br />
 Else<br />
  MsgBox &quot;Missing &quot; &amp; Font,4128,&quot;Missing Font&quot;<br />
 End If<br />
<br />
or simply:<br />
Const FONTS = &amp;H14&amp;<br />
<br />
Set objShell = CreateObject(&quot;Shell.Application&quot;)<br />
Set objFolder = objShell.Namespace(FONTS)<br />
objFolder.CopyHere &quot;PATH_TO_FONT&quot;<br />
<br />
The problem is that I don't know how to use that in NSIS. I've read http://msdn.microsoft.com/en-us/library/bb787866%28VS.85%29.aspx but I don't have a clue on how to convert that to NSIS.<br />
<br />
I've tried System::Call and other stuff, but I guess I'm stupid and can't get it right.<br />
<br />
Any help? Thanks :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st March 2010, 22:26</div></div><div class="posttext">None of the Wiki scripts or plugins work?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Legace</div><div class="date">2nd April 2010, 16:12</div></div><div class="posttext">Not for me.<br />
<br />
Using FontReg.exe for now, is small enough and does what it's supposed to.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">6th April 2010, 13:47</div></div><div class="posttext">Worked fine for me using...<br />
http://nsis.sourceforge.net/Register_Fonts<br />
...<br />
<br />
Just a few notes on it..<br />
1. The page refers to the FontName plugin which seems to include the same script already as a header file.  However, that header file does not have the latest update which allows you to use spaces in the font path.  So make sure you adjust the header, or copy/paste the code from the wiki page.<br />
2. Make sure your installer runs as Administrator.  Non-administrators can't write to the Windows Fonts folder.<br />
3.1 Make sure you don't forget &quot;SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0 /TIMEOUT=5000&quot; otherwise Windows won't know there's a new font.<br />
3.2 The example on that page was missing the WinMessages.nsh include (required for the above two defines), I've adjusted this on that page now.<br />
<br />
Platform: Windows 7 Home Premium NL 64bit<br />
Code used:<br />
<br />
!addincludedir &quot;.&quot; ; path to FontReg.nsh and FontName.nsh<br />
!addplugindir &quot;.&quot; ; Path to FontName.dll<br />
<br />
!include &quot;FontName.nsh&quot;<br />
!include &quot;FontReg.nsh&quot;<br />
!include &quot;WinMessages.nsh&quot;<br />
<br />
OutFile &quot;test.exe&quot;<br />
<br />
RequestExecutionLevel admin<br />
<br />
Section<br />
    StrCpy $FONT_DIR $FONTS<br />
    !insertmacro InstallTTFFont 'Andalemo.TTF'<br />
    SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0 /TIMEOUT=5000<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MarcelP1977</div><div class="date">16th May 2010, 10:53</div></div><div class="posttext">@Animaether:<br />
<br />
Thanks for your help here.<br />
<br />
I have issue on Win7 Font Installation (works for me fine, but one User is reporting a Error-Message: &quot;Ungültiges Dateihandle 32&quot; (in German)<br />
<br />
Look also here:<br />
http://centrafuse.de/board/wbb/index.php?page=Thread&amp;postID=11401#post11401<br />
<br />
Maybe you can post the right Header that i have to change?! That would be nice if you can help me with this.<br />
<br />
Best Regards, Marcel.<br />
<br />
(My nsi-Code is correct as you have posted.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MarcelP1977</div><div class="date">16th May 2010, 11:09</div></div><div class="posttext">Ok, i have found one thing in line 60:<br />
<br />
Changed it from:<br />
<br />
${GetFileName} ${FontFile} $0<br />
<br />
to:<br />
<br />
${GetFileName} &quot;${FontFile}&quot; $0<br />
<br />
Is all that i need?<br />
<br />
Why i become this Error &quot;Ungültiges Dateihandle 32&quot;?<br />
<br />
But only one User has this Issue (on Win7 64Bit).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">16th May 2010, 12:19</div></div><div class="posttext">${GetFileName} &quot;${FontFile}&quot; $0<br />
Is all that i need?<br />
It's the only header change that I noticed with regard to spaces in paths.<br />
<br />
Why i become this Error &quot;Ungültiges Dateihandle 32&quot;?<br />
No idea - I know what it's trying to say (invalid filehandle).. but don't know -why- it's saying it :)<br />
<br />
But only one User has this Issue (on Win7 64Bit).<br />
Could be that this specific user has a particular path either to the font file or the windows font folder?  You could add some debug information (messageboxes or dump out to a file) for this particular user and see if that offers any clues.<br />
<br />
There's also this previous post where as u user had the same error...<br />
http://forums.winamp.com/showpost.php?p=2640488&amp;postcount=12<br />
...where they fixed it by changing the location of the TTF file on the build machine; not sure how/why that matters, but worth a shot.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MarcelP1977</div><div class="date">16th May 2010, 12:48</div></div><div class="posttext">Thanks.<br />
<br />
I have it allready as it in other thread is.<br />
<br />
But maybe i can fix it with this changes?!<br />
<br />
Old Code was:<br />
<br />
!insertmacro InstallTTFFont 'GOTHIC.ttf'<br />
<br />
and now i will try with this:<br />
<br />
!insertmacro InstallTTFFont 'GOTHIC.TTF'<br />
<br />
Thanks, i hope it works.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>