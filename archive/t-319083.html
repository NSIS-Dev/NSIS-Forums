<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem with kernel32::ReadFile, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem with kernel32::ReadFile NSIS Discussion" />
	
	<title> Problem with kernel32::ReadFile [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem with kernel32::ReadFile</div>
<hr />
<div class="pda"><a href="t-319083.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=319083">Problem with kernel32::ReadFile</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">santana108</div><div class="date">10th May 2010, 19:21</div></div><div class="posttext">I am having a problem with the Windows ReadFile function when executing it with the system.dll plug-in. I am able to open the file and get the file size with the kernel32 functions, so I know that the file handle is valid.  When I attempt to read data from the file with the ReadFile Function it always returns 0 indicating failure and 0 bytes read.  The GetLastError returns the code file already exists which is probably from when the file was opened with CreateFile.  If anyone has an idea as to what might be wrong I would be bery gratefull for a response.  The code snippet is below<br />
<br />
!define OPEN_EXISTING  3  <br />
!define CREATE_NEW 1<br />
!define CREATE_ALWAYS 2<br />
<br />
!define FILE_ATTRIBUTES_NORMAL 128 <br />
!define GENERIC_WRITE  0x40000000<br />
!define GENERIC_READ   0x80000000<br />
<br />
System::Call Alloc 80  ; Allocate memory for read buffer<br />
Pop $0  ; Pointer to Read Buffer<br />
<br />
System::Call &quot;kernel32::CreateFile(t '$INSTDIR\$1', ${GENERIC_READ},i 0, i 0, i ${OPEN_EXISTING}, i ${FILE_ATTRIBUTES_NORMAL}, i 0) i .r8&quot;<br />
<br />
System::Call &quot;kernel32::GetFileSize(i r8, i 0) i .r6&quot;<br />
<br />
System::Call &quot;kernel32::ReadFile(i r8, i r0, i 80, *i .r2, i 0) i .r3&quot;<br />
 <br />
<br />
Chris Lustig</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th May 2010, 19:28</div></div><div class="posttext">Any reason you are using that instead of FileOpen/FileRead/FileClose?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">santana108</div><div class="date">10th May 2010, 19:44</div></div><div class="posttext">Any reason you are using that instead of FileOpen/FileRead/FileClose?<br />
<br />
Stu<br />
<br />
I am trying to copy binary CAB files from a PC to a Windows CE device attached to PC with ActiveSync.  If FileRead encounters the code for a new line it is going to return and I will not know how many bytes have been read.  Also I was allocating memory for a buffer that is bigger than 1024 bytes.<br />
<br />
Chris</div></div><hr />


<div class="post"><div class="posttop"><div class="username">f0rt</div><div class="date">10th May 2010, 22:13</div></div><div class="posttext">My guess would be that<br />
<br />
System::Call Alloc 80 ; Allocate memory for read buffer<br />
<br />
should be changed into<br />
<br />
System::Alloc 80 ; Allocate memory for read buffer</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>