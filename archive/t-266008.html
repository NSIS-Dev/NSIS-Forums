<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Loop to deselect sections doesn't work, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Loop to deselect sections doesn't work NSIS Discussion" />
	
	<title> Loop to deselect sections doesn't work [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Loop to deselect sections doesn't work</div>
<hr />
<div class="pda"><a href="t-266008.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=266008">Loop to deselect sections doesn't work</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">zjckwht</div><div class="date">17th February 2007, 19:22</div></div><div class="posttext">outfile `test.exe`<br />
!include 'MUI.nsh'<br />
!include 'LogicLib.nsh'<br />
!define LOGICLIB_SECTIONCMP<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
<br />
<br />
SectionGroup '!Parent' pnt<br />
      <br />
      Section '!aaaa' aa<br />
            <br />
      SectionEnd<br />
      <br />
      Section '!bbbb' bb<br />
            <br />
      SectionEnd<br />
      <br />
      Section '!cccc' cc<br />
            <br />
      SectionEnd<br />
      <br />
SectionGroupEnd<br />
<br />
Function .OnInit<br />
         ${For} $0 ${aa} ${cc}<br />
               !insertmacro UnSelectSection $0<br />
         ${Next}<br />
FunctionEnd<br />
<br />
<br />
However if I change the .OnInit function content to the following, it works. Anybody knows why?<br />
<br />
Function .OnInit<br />
<br />
      !insertmacro UnSelectSection ${aa}<br />
      !insertmacro UnSelectSection ${bb}<br />
      !insertmacro UnSelectSection ${cc}<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">17th February 2007, 19:34</div></div><div class="posttext">I've just been trying to figure this out for an hour or two since I read the other post you had on this question...<br />
<br />
Your original code (the for loop) will work if you modify Sections.nsh. In that file change the $0 into $1 (including the push and pop) for the macro UnselectSection (lines 58 to 62).<br />
<br />
Saving the registers before and after using them should make it indifferent to which register is used, but it doesn't seem to work with $0 as originally delivered!<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th February 2007, 19:35</div></div><div class="posttext">The macros use $0 internally so it fails. Use $1 for now and submit a bug report so it'll be fixed for the next version.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">17th February 2007, 19:56</div></div><div class="posttext">Here's a simple script that displays the macro 'Section' argument before and after the macro calls SectionGetFlags. I copied the macro into the nsi file twice, one copy uses $1 and the other uses the original $0.<br />
<br />
The SectionGetFlags instruction seems to destroy the ${SECTION} argument, even if that argument has a different name (ie, I tried modifying its name and it still gets destroyed).<br />
<br />
Don<br />
<br />
[edit] I see Kichik found a problem, so my test script is redundant. ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zjckwht</div><div class="date">18th February 2007, 04:38</div></div><div class="posttext">Oh yes..this problem fixed.Thanks demiller9 and kichik.But now another problem found, see my new post &quot;Modifying sectiongroup will make all its subsections restore default?&quot;</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>