<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Win7: Install a prog for user &quot;James&quot; correctly, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Win7: Install a prog for user &quot;James&quot; correctly NSIS Discussion" />
	
	<title> Win7: Install a prog for user &quot;James&quot; correctly [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Win7: Install a prog for user &quot;James&quot; correctly</div>
<hr />
<div class="pda"><a href="t-340433.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=340433">Win7: Install a prog for user &quot;James&quot; correctly</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">aRalf</div><div class="date">11th January 2012, 16:22</div></div><div class="posttext">Hi, we want to install our software for a user James under Win7. Naturally we need admin rights to write into the program_files directory. NSIS first asks for authorization. Then we can only select an admin user and enter his password. From now on NSIS installs everything for this admin user and forgot that we wanted to install for user James at the beginning. After restarting as user James, the files reside in the admin's AppDataPath and James has no rights to write-access the files in AppDataPath.<br />
<br />
How can we install a program for user James under Win7, giving him full access rights to the files in his AppDataPath?<br />
<br />
Thanks for your help!<br />
<br />
Best regards, aRalf</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th January 2012, 18:08</div></div><div class="posttext">If it's a per user install then you shouldn't be writing to Program Files. Everything should be in $APPDATA.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aRalf</div><div class="date">12th January 2012, 15:29</div></div><div class="posttext">The Prog's Exe has to be written into &quot;Program Files&quot; during installation. The user afterwards has to be able to read/write in his $AppData during program run. Unfortunately, during installation the user changes from James to Admin so $AppData for Admin is used, but not for James.<br />
<br />
That means any subdirectory in $AppData created during installation is for Admin. Can I switch back to user James during installation to create a subdir in James' $AppData?<br />
<br />
Best regards, aRalf.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aRalf</div><div class="date">15th January 2012, 15:11</div></div><div class="posttext">I hope, my question is comprehensible. Is any information missing?<br />
<br />
Best regards, aRalf</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">15th January 2012, 19:51</div></div><div class="posttext">The proper way to do this (which is also the easiest way), is simply to let your program create the %APPDATA%\YourApp directory, instead of trying to do it from the installer. When the program is run (as the James user), the %APPDATA% variable will automatically point to the proper directory.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aRalf</div><div class="date">16th January 2012, 11:42</div></div><div class="posttext">This might be the solution. During install I copy everything I need into the Programs dir and later I copy it with the first start of the app into the respective user's AppData dir.<br />
<br />
Several users can then reside on the same PC. I do not need to ask &quot;one user or all users?&quot; during install. Every time a new user starts the app, his appropriate data is copied anew into his AppData. For deinstall I write a hint into the registry each time?<br />
<br />
Thank you AfrowUK and MSG for your help!<br />
<br />
Best regards, aRalf</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aRalf</div><div class="date">16th January 2012, 11:54</div></div><div class="posttext">Thanks for your help, Afrow UK and MSG.<br />
<br />
I copy everything into the Programs dir during install. Later during first run, I copy it into the appropriate user's AppData dir :up:<br />
<br />
I do not need to ask for &quot;one user or all users?&quot;, as several users can get their own AppDatas. During every &quot;first run&quot; I write a hint into the registry for the uninstall?<br />
<br />
Best regards, aRalf</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">16th January 2012, 12:19</div></div><div class="posttext">Yes, writing a hint into the registry is probably the best solution for uninstall. In the uninstaller, you can use EnumUsersReg to go through every user's HKCU registry hive, to collect all the hints.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th January 2012, 12:24</div></div><div class="posttext">You have three options that I can think of:<br />
1. Enumerate all folders in the uninstaller under the value specified in the HKLM\Software\Microsoft\Windows NT\CurrentVersion\ProfileList\ProfilesDirectory value.<br />
2. Enumerate all keys in the uninstaller under HKLM\Software\Microsoft\Windows NT\CurrentVersion\ProfileList and read each ProfileImagePath value.<br />
3. Have your app write their uninstall path (under AppData) to each of the user's registry (HKCU) as you suggest and then enumerate the registry using EnumUsersReg in the uninstaller (bit more long-winded way).<br />
<br />
You can't store a list of users in HKLM or Program Files because those locations are read-only for normal users.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aRalf</div><div class="date">16th January 2012, 14:36</div></div><div class="posttext">I will check all proposed uninstall ideas :)<br />
<br />
Best regards, aRalf</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aRalf</div><div class="date">18th January 2012, 11:09</div></div><div class="posttext">Hi again,<br />
<br />
unfortunately if I launch the program (with &quot;Exec&quot;) directly at the end of the admin-install  then the user is still admin. But I want to launch the program as the current user James! Now during direct launch the $Appdata path is the wrong one.<br />
<br />
Do I have to drop the &quot;direct launch&quot; feature of NSIS?<br />
<br />
Best regards, aRalf</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">18th January 2012, 11:35</div></div><div class="posttext">There are three solutions to this problem.<br />
<br />
1) Disable the direct launch option. This is by far the easiest and most reliable solution. Recommended. The Run Now checkbox is a useless feature anyway.<br />
2) Use the ShellExecAsUser plugin. Relatively simple solution, but will not always work. For more information, see this thread: http://forums.winamp.com/showthread.php?t=335435<br />
3) Use the UAC plugin. Most complex solution. Should works in all cases, but only if you use it right.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aRalf</div><div class="date">18th January 2012, 12:17</div></div><div class="posttext">Thank you MSG, we will use your method 1  ;-)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>