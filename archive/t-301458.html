<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Adding a button during the install process, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Adding a button during the install process NSIS Discussion" />
	
	<title> Adding a button during the install process [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Adding a button during the install process</div>
<hr />
<div class="pda"><a href="t-301458.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=301458">Adding a button during the install process</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">omeara55</div><div class="date">27th December 2008, 17:03</div></div><div class="posttext">Hey guys...  I've searched the forums and NSIS wiki here and haven't been able to come up with an answer on this one, so hopefully a NSIS stud can help me out!<br />
<br />
I'd like to add a button (a bitmap button to be specific) on the installing components screen (the MUI_PAGE_INSTFILES page).  The goal is to have a button with an image saying something to the effect of &quot;click here to go to our site and learn more&quot;  while the user is waiting for the installation to complete. <br />
<br />
So although a InstallOptions::dialog approach can work using a custom page, it really it's a poor solution since users will blow right past it to get on with the installation process.  The INSTFILES page is the perfect place to communicate with users since they're waiting for the installer to do its thing.<br />
<br />
So far, I've tried editing the resource in modern.exe (adding a bitmap button), but the problem is that I need a way for NSIS to callback when that button is pressed.  Where is the code that dispatches a button press to the action?  I wasn't able to find a InstallOptions::dialog style call in MUI, so it's not even clear how I can catch my custom button press.<br />
<br />
I've burned a ton of time trying to crack this one, so an elegant solution would be REALLY appreciated!  Thanks in advance!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th December 2008, 17:05</div></div><div class="posttext">You can add a standard button and use the ButtonEvent plug-in on it to open your site with ExecShell.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">omeara55</div><div class="date">27th December 2008, 18:13</div></div><div class="posttext">Excellent, Stu -- that seems to be perfect!  <br />
<br />
Hrm, the only remaining puzzle is that all my attempts to set the button image aren't working.  I'm using BS_BITMAP and then using the code:<br />
<br />
FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
GetDlgItem $0 $0 2000<br />
System::Call '${sysLoadImage} (0, s, ${IMAGE_BITMAP}, 0, 0, ${LR_CREATEDIBSECTION}|${LR_LOADFROMFILE}) .r6' &quot;$1&quot;<br />
SendMessage $0 ${STM_SETIMAGE} ${IMAGE_BITMAP} $6<br />
System::Call &quot;${sysDeleteObject} (r6)&quot;<br />
<br />
Think there's ay way to make this image trick work?  Thanks in advance, stu!<br />
<br />
<br />
<br />
Originally posted by Afrow UK <br />
You can add a standard button and use the ButtonEvent plug-in on it to open your site with ExecShell.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th December 2008, 18:20</div></div><div class="posttext">Just to ensure there are no errors in that code, you could use the NSD_SetImage and NSD_FreeImage macros as described in the nsDialogs documentation.<br />
<br />
Setting an image like this will not properly skin the button IIRC.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">omeara55</div><div class="date">27th December 2008, 19:10</div></div><div class="posttext">Interesting...  The issue with nsDialogs is that it doesn't seem to work with the NSIS standard INSTFILES page (in that nsDialogs assumes you want to make the page from scratch).  Is there are a way to have nsDialogs add to the existing/current dialog?  Otherwise, I'm not seeing the way one can use nsDialogs with an existing dialog (and it seems like it'd be a lot of work to implement the existing INSTFILES page using nsDialogs since it's tied to innate NSIS functionality).<br />
<br />
Meanwhile, using BM_SETIMAGE  instead of STM_SETIMAGE in that above code seems to cause the image to update inconsistently (sometimes it doesn't appear--it seems to depend on if the image gets obscured and needs to get refreshed).  I know you mentioned this wasn't the way to go, but without a way to use nsDialogs in combination with the existing MUI_PAGE_INSTFILES, I'm not sure how to proceed.<br />
<br />
Thanks again for you help, Stu -- I'll owe ya one if we can get this!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th December 2008, 19:42</div></div><div class="posttext">Try destroying your bitmap in .onGUIEnd instead.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">omeara55</div><div class="date">27th December 2008, 23:42</div></div><div class="posttext">Hah, that was it -- that image needs to stick around.<br />
<br />
Very much thanks for your help, Stu!  Very kind of you, and have a great holidays!<br />
<br />
Cheers,<br />
Andy</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>