<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Getting the current date at install time, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Getting the current date at install time NSIS Discussion" />
	
	<title> Getting the current date at install time [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Getting the current date at install time</div>
<hr />
<div class="pda"><a href="t-68980.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=68980">Getting the current date at install time</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">timelord50</div><div class="date">17th December 2001, 06:00</div></div><div class="posttext">:confused: <br />
I am trying to write a shareware application and I need to get the current date on installation and record it. I have written a small C++ program that does this but I would prefer to get the installer to do it. Is there anyway to get the current date on installation? or is it possible to write a C++ program that can be run using ExecWait that returns the date?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">F. Heidenreich</div><div class="date">17th December 2001, 07:17</div></div><div class="posttext">At the moment you can't get the current date from NSIS. But it's possible to write your own little NSIS extension dll for that. There is an example in Contrib/ExDLL, in Contrib/NSISdl and my extension for executing mci commands stays here (http://forums.winamp.com/attachment.php?s=&amp;postid=418131) :).<br />
<br />
~ Florian</div></div><hr />


<div class="post"><div class="posttop"><div class="username">justin</div><div class="date">17th December 2001, 08:31</div></div><div class="posttext">How about this (requires NSIS 1.90+, though with a little modification you can make it work in earlier versions):<br />
<br />
<br />
GetTempFileName $R0 ; creates a file, assigns name to $R0<br />
GetFileTime $R0 $R1 $R2<br />
Delete $R0<br />
; $R1 is high dword of current time<br />
; $R2 is low dword of current time<br />
<br />
<br />
-Justin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">timelord50</div><div class="date">17th December 2001, 09:06</div></div><div class="posttext">thanks Justin - my first thought was to get the creation time for the .exe file but that wasn't working because I stuffed my C++ code up. I thought that there was something wrong with the way I was using the NSIS GetFileTime function but when I saw that you used it in your post I went back over it and realised my application's code was stuffed.<br />
<br />
I tried your solution too F. Heidenreich but it wouldn't compile - it came up with the dreaded &quot;LNK2001: unresolved external symbol _main&quot; error. I did it as a Win32 Dynamic Link Library project in Visual C++ 6 so I don't understand why it wouldn't accept _DLLMainCRTStartup instead. I also found that exdll didn't compile either - it had the same link error.However your extension (nsisext_mci) compiled and linked perfectly. Has anyone else encountered this error using Visual C++ 6 to compile exdll or any extension of their own making?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">F. Heidenreich</div><div class="date">17th December 2001, 09:18</div></div><div class="posttext">The solution for the linker prob is to enable the checkbox 'Project-&gt;Settings-&gt;Linker-&gt;General-&gt;Ignore all default libraries'.<br />
<br />
If you get the 'error LNK2001: unresolved external symbol __chkesp', remove the /GZ from the compiler switches.<br />
<br />
~ Florian</div></div><hr />


<div class="post"><div class="posttop"><div class="username">timelord50</div><div class="date">17th December 2001, 09:20</div></div><div class="posttext">To Help anyone else who has a similar problem: :)<br />
Here's the code I used with NSIS version 1.81. The date is stored in $R1 and $R2 and these values can be written to the registry or a file or whatever. The 2 variables $R1 and $R2 form the 2 variables of a win32 FILETIME structure.Create a FILETIME structure in your C++ program and initialize it with the values of these 2 variables (wherever you stored them). The FILETIME struct can then be manipulated to turn it into a SYSTEMTIME structure or a CTime object.  <br />
<br />
;get current time by creating a temp file and reading it's time stamp<br />
;make a new file in the temp directory<br />
SetOutPath &quot;$TEMP&quot;<br />
File &quot;new file&quot;<br />
SetOutPath &quot;$INSTDIR&quot;<br />
;get it's time stamp<br />
GetFileTime &quot;$TEMP\new file&quot; $R1 $R2<br />
; $R1 is high dword of current time<br />
; $R2 is low dword of current time<br />
;delete our new file (it's purpose has been served)<br />
Delete &quot;$TEMP\new file&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rainwater</div><div class="date">30th December 2001, 23:40</div></div><div class="posttext">I've written a dll extension that will handle this.  See the other thread (http://forums.winamp.com/showthread.php?threadid=70281).<br />
<br />
Rob</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>