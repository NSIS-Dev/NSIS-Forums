<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem aborting page, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem aborting page NSIS Discussion" />
	
	<title> Problem aborting page [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem aborting page</div>
<hr />
<div class="pda"><a href="t-296266.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=296266">Problem aborting page</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Haplo</div><div class="date">21st August 2008, 11:27</div></div><div class="posttext">Hi all,<br />
<br />
I have a page as below:<br />
<br />
Page EnterCustom LeaveCustom<br />
<br />
And the EnterCustom function:<br />
<br />
<br />
Function EnterCustom 	<br />
	File /oname=$PLUGINSDIR\installer.ini &quot;@CMAKE_CURRENT_SOURCE_DIR@\installer\installer.ini&quot;<br />
<br />
	StrCpy $0 &quot;$PLUGINSDIR\installer.ini&quot;<br />
<br />
	Call CreateDialogFromINI<br />
FunctionEnd<br />
<br />
<br />
The Installer.ini features a DirRequest as the 3rd field:<br />
<br />
<br />
[Field 3]<br />
Type=DirRequest<br />
Left=10<br />
Right=-10<br />
Top=32<br />
Bottom=44<br />
Text=Select directory:<br />
State=<br />
<br />
<br />
And the LeaveCustom function:<br />
<br />
<br />
Function LeaveCustome<br />
	Call UpdateINIState<br />
	<br />
	ReadINIStr $Dir1 &quot;$PLUGINSDIR\installer.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
	<br />
	FindFirst $0 $1 &quot;$Dir1\*.jpg&quot;<br />
	StrCmp $1 &quot;&quot; 0 AllGood<br />
	MessageBox MB_OK|MB_ICONEXCLAMATION &quot;The directory is not valid. Please try again.&quot;<br />
		Abort<br />
	<br />
	AllGood:<br />
<br />
FunctionEnd<br />
<br />
<br />
As you see, after the user provides a directory (either by manually typing it or by selecting it using the '...' button), the scripts checks to make sure there are JPG files available in that directory. If not, it will prompt the user to enter another/valid directory.<br />
<br />
Now the problem: If the user enters a valid directory the first time, it all works great. But if the user enters something invalid, let's say &quot;qwerty&quot;, the error message is shown and the Abort happens, but the $Dir1 variable always keeps the 'qwerty' value even if users enters some other data afterwards. So if after the error message user types 'lkjh' in that box, $Dir1 still reads 'qwerty'. Also, if at this stage user presses the '...' button and chooses a directory, not only $Dir1 stays 'qwerty', but also even the text box on the screen stays 'qwerty'. <br />
<br />
Can you please tell me what I am doing wrong? Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Haplo</div><div class="date">22nd August 2008, 04:27</div></div><div class="posttext">I found the mistake: because $0 was being clubbered everything was getting derailed.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>