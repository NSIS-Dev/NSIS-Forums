<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Updating Listbox, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Updating Listbox NSIS Discussion" />
	
	<title> Updating Listbox [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Updating Listbox</div>
<hr />
<div class="pda"><a href="t-211137.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=211137">Updating Listbox</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">tsuoying</div><div class="date">23rd March 2005, 02:44</div></div><div class="posttext">On a simple ini screen, i have 3 items: 1) FileRequest, 2) Listbox, and 3) Button.<br />
<br />
I want the user to choose a file with the FileRequest, then click on the Button to add the filepath to the Listbox.  (Ideally it would automatically add the filepath to the list when FileRequest is clicked, or by clicking on the button, a file dialog appears, thus making the FileRequest unncessary.  But that can come later.)<br />
<br />
I've set up the Button with a flag of NOTIFY so I can call a function which will read the data from the FileRequest object and add it to the ListItems of the listbox.<br />
<br />
So the code for the function is like this:<br />
---------<br />
;Get filepath from the FileRequest [field #2]<br />
!insertmacro MUI_INSTALLOPTIONS_READ $FROM_FILE_REQUEST &quot;mysimplescreen.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
        <br />
;Get the current list from the ListBox [field #4]<br />
!insertmacro MUI_INSTALLOPTIONS_READ $CURRENT_LIST &quot;mysimplescreen.ini&quot; &quot;Field 4&quot; ListItems<br />
<br />
;Add the new item to list<br />
StrCpy $NEW_LIST &quot;$CURRENT_LIST|$FROM_FILE_REQUEST&quot;<br />
<br />
;replace the ListItems in the listbox<br />
!insertmacro MUI_INSTALLOPTIONS_WRITE &quot;mysimplescreen.ini&quot; &quot;Field 4&quot; ListItems &quot;$NEW_LIST&quot;<br />
<br />
------------<br />
<br />
Please pardon me if this is wrong way of doing what I want.  I've just been using nsi for a few days... Anyhow, the problem is - although I can tell that the ListItems has actually changed (with the help of MessageBox), the screen doesn't actually show the changed list.  I searched on this forum and someone mentioned &quot;SendMessage&quot;?  I've looked at the documentation for that but am uncertain how to use it.  <br />
<br />
Am I basically missing a step to REFRESH the screen, and SendMessage is one way to do that?  Any help you can provide would be wonderful, thanks in advance!<br />
<br />
-paul</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tsuoying</div><div class="date">23rd March 2005, 22:13</div></div><div class="posttext">No takers? :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">24th March 2005, 10:19</div></div><div class="posttext">1. Modern UI custom page<br />
2. FileRequest control (autoadd in ListBox or not)<br />
3. Add file to ListBox button<br />
4. Delete file from ListBox button<br />
5. You must select file to enable Next button<br />
6. If file already exists in ListBox then shows message<br />
7. If file inputed in FileRequest manually and it not exists then shows message</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tsuoying</div><div class="date">24th March 2005, 16:16</div></div><div class="posttext">Thank you so much!!  Before your reply, I had finally gotten something to work, but your additional code for the delete button and the validations will save me lots of time, thanks again.  I really appreciate your help. And by the looks of the download #s, other folks will benefit, too!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tsuoying</div><div class="date">24th March 2005, 21:39</div></div><div class="posttext">Another question - does anyone know what the sendmessage command is to update the value of a FileRequest control? I.e., if the user had used the browse button and the filerequest control states:<br />
c:\abc.txt<br />
How can I change it to something else, not via the browse button? WM_SETTEXT changes the browse button text, but i want the actual filepath text changed. Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">24th March 2005, 21:54</div></div><div class="posttext">In the script you can change it with:GetDlgItem $1 $HWND 1200<br />
SendMessage $1 ${WM_SETTEXT} 1 &quot;STR:String&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tsuoying</div><div class="date">24th March 2005, 21:59</div></div><div class="posttext">Hi, thanks for the superfast response! But when i use this code, it seems to only change the browse button's text. But I really want to change the filerequest's value.  Do you know how I can do this?  Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">24th March 2005, 22:09</div></div><div class="posttext">If you don't change ini Fields in script then browse button have &quot;item_id&quot;=1201 and filerequest &quot;item_id&quot;=1200. If you change it then just SendMessage to all controls 1200, 1201, 1202,... to find &quot;item_id&quot; :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tsuoying</div><div class="date">24th March 2005, 22:26</div></div><div class="posttext">Thanks so much!  I didn't know that FileREquest consists of actually two controls, I mean, they're grouped together as one field in HM NIS edit, but of course to windows, they're separate!  So I used Microsoft Spy to figure out what the control id is and got it to work! Yeah!!<br />
<br />
Just two last questions:<br />
1.  How do I get the values out of the listbox as one string?  I thought the following would work but it didn't:<br />
<br />
!insertmacro MUI_INSTALLOPTIONS_READ $FILE_PATH_STRING &quot;ListBox.ini&quot; &quot;Field 4&quot; ListItems<br />
<br />
2. Where can I find a reference of which sendmessages are available for which controls, and what arguments are needed?<br />
<br />
Again, you've been so tremdously helpful, I hope you didn't mind my asking so many q's!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">24th March 2005, 23:36</div></div><div class="posttext">1. Variables is limited to 1024 bytes (more in special build). I think the best way use stack or text file for export items from ListBox. But I don't known how to get string from ListBox if I have index (trying unsuccessful: LB_GETITEMDATA, LB_GETTEXT).<br />
<br />
2. http://msdn.microsoft.com/library/default.asp?url=/library/en-us/shellcc/platform/commctls/wincontrols.asp</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>