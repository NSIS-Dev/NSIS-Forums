<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Old topic: Deinstallation of services under NT/2K/XP/2003, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Old topic: Deinstallation of services under NT/2K/XP/2003 NSIS Discussion" />
	
	<title> Old topic: Deinstallation of services under NT/2K/XP/2003 [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Old topic: Deinstallation of services under NT/2K/XP/2003</div>
<hr />
<div class="pda"><a href="t-138384.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=138384">Old topic: Deinstallation of services under NT/2K/XP/2003</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">9th June 2003, 10:15</div></div><div class="posttext">Dear Folks -<br />
<br />
I am stuck with my Installer Package. I need to uninstall several services within my packages.<br />
<br />
This has to be done with the uninstaller.<br />
--&gt; Check if running (yes: stop), if &quot;not&quot; proceed with uninstall.<br />
<br />
Can this goal be achieved within &quot;board-functions&quot; in the uninstaller? And if not, is there a way to make the uninstaller running *.bat-scripts? These scripts have to be *extracted* out of the uninstaller package at runtime. What I don't want is to install the scripts at installation time, and run them at uninstall-time, because if anybody deletes these scripts, the uninstaller will hang up!<br />
<br />
Cheers and thx<br />
Chris</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th June 2003, 11:10</div></div><div class="posttext">I doubt it can somehow be done with just NSIS commands. Maybe its state is somewhere in the registery but I doubt it. Sunjammer's services.dll plug-in can check if a service is running and can stop it:<br />
<br />
This plugin does things relating to Windows NT/2000/XP services. It can find out if they are installed or running, start them, stop them, etc. It can also do other useful things like grant, remove and test for the right on a user to logon as a service.<br />
<br />
You can get it at the Archive's downloads page (http://nsis.sourceforge.net/archive/download.php).<br />
<br />
Aside from that, you can extract .bat files at uninstall time. The File command can be used there. You can execute them using Exec, ExecWait or nsExec.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">9th June 2003, 11:15</div></div><div class="posttext">It's very easy to create a plugin to remove a specific service. Alternatively I have a simple executable I once wrote which is capable of deleting any service by name or display name, but I don't generally give it out because it's very dangerous to be able to delete any service at will. <br />
<br />
Are you sure that the service itself doesn't have a command line option to remove the service? Did you write the service?<br />
<br />
If you need anything coded relating to services just drop me a line and I'll write it for you.<br />
<br />
Actually, I'm not sure why I didn't make that plugin capable of deleting services. I think it was because I figured services should have other ways of being removed, &quot;proper&quot; ways. I can add that functionality if it's desired to the services plugin.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DITMan</div><div class="date">9th June 2003, 11:43</div></div><div class="posttext">Lol... looks like everybody one wants to delete processes/services in a bad way :P<br />
<br />
Bad habit, bad habit :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">9th June 2003, 12:02</div></div><div class="posttext">@Kichik<br />
<br />
I tried it and, well it does find these services, but there is no parameter to uninstall it....<br />
<br />
@Sunjammer<br />
<br />
Every of the named services has its own start/stop/install/uninstall command, but I have no idea how to combine the search for service-stop it- call uninstall -scenario. I am absolutely the worst programmer in the world, think my sister can do better (and she's fashion-designer)<br />
<br />
So what I need is @ uninstall-time:<br />
<br />
1.) Find &quot;service running&quot;<br />
2.) stop &quot;service if running&quot;<br />
3.) Uninstall &quot;service(s)&quot;<br />
4.) Proceed with uninstallation<br />
<br />
Service one has the following parameter:<br />
 -k uninstall, but where can I get the fully path back to its binary executable?<br />
<br />
Chris</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">9th June 2003, 12:10</div></div><div class="posttext">I can add a function to the services dll to get you information about the service, or you can just look under HKLM\System\CurrentControlSet\Services\ServiceName\ImagePath but you need to know the real service name, not the display name. The services plugin dll can tell you the real name from the display name.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">9th June 2003, 12:31</div></div><div class="posttext">@Sunjammer<br />
<br />
Ok, understood!<br />
I know the real service name. How can I read it from Registry, and than call the /stop /uninstall ?<br />
<br />
The four (I forgot one at the last post) services are:<br />
<br />
1.) Apache with optional parameters Apache.exe -k stop (or net STOP Apache) and Apache.exe -k uninstall<br />
2.) Apache2 with the same parameters<br />
3.) A FTP-Server with parameter /stop and /uninstall and<br />
4.) MySQL with parameter mysqladmin -u root shutdown*) (or net stop mysql[/b]) and \Path\to\binary.exe --remove<br />
<br />
*) This can't be read from registry<br />
<br />
Thx <br />
<br />
Joker</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">9th June 2003, 12:41</div></div><div class="posttext">If you already know the real service name then you can get the path to the service executable (e.g. Apache.exe) by doing:-StrCpy $1 &quot;realservicename&quot;<br />
ReadRegStr $0 HKLM &quot;System\CurrentControlSet\Services\$1\ImagePath&quot;<br />
<br />
Now in the case of Apache I noticed in my registry that the ImagePath also includes options to apache so you'll need to strip out just the path from the string you get back in $0. Note: I have not tried this, I don't have time :(.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">9th June 2003, 12:50</div></div><div class="posttext">Ohh,...<br />
so thx for your time!<br />
<br />
Can anybody tell me how to write the result of &quot;Registry-reading&quot; into a file, parsing it, to get the missing parameters written at the end of String, rename it (the written file) to  *.bat, execute it and delete it afterwards?<br />
<br />
Or more simple (as I think)<br />
1.) At &quot;install-time&quot; I write a *.bat (I know how to:)) which has all the parameters in it to uninstall (at least an unmodified, original installed service).<br />
<br />
2.) So my problem is as mentioned early in this post, to bring this file to the uninstaller!!!!<br />
<br />
The uninstaller should content this *.bat, to extract it at uninstallation-time, call/execute it and delete it the next step.<br />
<br />
How can this be achieved?<br />
<br />
Chris<br />
<br />
<br />
P.S.: So as Kichik mentioned above, but before the uninstaller is built, the files have to be modified to get the path. S**t, how should I explain:<br />
<br />
Hmmm, I do all the file manipulation with the &quot;search &amp; replace&quot; function from the Archive. So I need to have the files (*.bat) to be written at iunstallation-time and packed into the uninstaller. Otherwise at least the /uninstall function of the services will fail, not the stops as I can call them by &quot;net stop servicename&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">9th June 2003, 12:54</div></div><div class="posttext">For the &quot;more simple&quot; approach :-<br />
<br />
You could get the uninstaller to write the bat file using FileWrite in the Uninstaller part of the .nsi (icky I know but the File commands are for the installer, not the uninstaller). Then you just execute it as you would execute anything else from an .nsi, i.e. using Exec, or ExecWait, or nsExec::xxx etc.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">9th June 2003, 12:56</div></div><div class="posttext">Ok, but the uninstaller is written at compile time, not installation time, right? So I will never get the unmodified installation path!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">9th June 2003, 13:09</div></div><div class="posttext">I attached an example.nsi, which I wrote for this. Will it work? Can somebody take a look?<br />
<br />
What I want is: Create a file, manipulate it, pack it to the uninstaller. At uninstallation time call the file, and delete the directory with the included files. As mentioned earlier, the file should never appear visible for the user, because of probably deletion. so I want to pack it with the uninstaller.<br />
<br />
Thx <br />
Chris</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th June 2003, 13:30</div></div><div class="posttext">Why not just execute it without a batch file? Get the ImagePath into, lets say, $1, and then use:<br />
<br />
ExecWait '&quot;$1&quot; /k uninstall'<br />
<br />
or:<br />
<br />
nsExec::ExecToLog '&quot;$1&quot; /k uninstall'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">9th June 2003, 13:37</div></div><div class="posttext">@ Kichik -<br />
<br />
Sorry, sorry, sorry you have a really really DAU in front of you<br />
<br />
(DAU = Dümmster anzunehmender User, means &quot;Most stupid User you can get&quot;)<br />
:igor: <br />
<br />
So please be more specific<br />
<br />
Chris</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th June 2003, 13:52</div></div><div class="posttext">Specific enough? :p</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">9th June 2003, 13:56</div></div><div class="posttext">If it works :D <br />
<br />
Thx man, I'll give it a try and post result as soon as I tested it!<br />
<br />
Thx again<br />
Chris</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">9th June 2003, 15:21</div></div><div class="posttext">Hey Kichik! :up: <br />
<br />
Sensational !!! It really works great, but that's not really a surprise. Never got advice from you which didn't work :D <br />
<br />
Thx<br />
Chris</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>