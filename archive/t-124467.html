<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Bug in compiler, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Bug in compiler NSIS Discussion" />
	
	<title> Bug in compiler [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Bug in compiler</div>
<hr />
<div class="pda"><a href="t-124467.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=124467">Bug in compiler</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">9th February 2003, 15:40</div></div><div class="posttext">Section &quot;ThisName&quot;<br />
    MessageBox MB_YESNO &quot;Are you male?&quot; IDYES IsMale<br />
    MessageBox MB_OK &quot;You aren’t male, possibly female.&quot;<br />
    Goto +3  ; Jumps to the third instruction from here, skipping the<br />
             ; “You are male.” messagebox.<br />
  IsMale:  ; To this label jumps the messagebox if Yes is clicked.<br />
    MessageBox MB_OK &quot;You are male.&quot;<br />
  EndOfSection:<br />
SectionEnd<br />
<br />
<br />
This doesn't generate an error when compiling, but does when executing: Invalid OPcode. I think this is a bug. I know how to solve this with replacing +3 by a label, but anyway...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th February 2003, 15:56</div></div><div class="posttext">There is no third instruction from that Goto... You should be careful with relative jumps.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">9th February 2003, 19:08</div></div><div class="posttext">I know, but the compiler doesn't see that, only when I execute it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">9th February 2003, 19:17</div></div><div class="posttext">Fixing this one specific case is probably not too hard but making the compiler attempt to spot the users mistakes is a lot of work for relatively little return. Personally this just strikes me as a case of garbage in leads to garbage out :P</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">9th February 2003, 20:05</div></div><div class="posttext">When I do this in .onInit function, with Modern UI and Install Options 2, show a strange window (you only can close this window by using Ctrl+Alt+Del) :</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">9th February 2003, 20:07</div></div><div class="posttext">When I don't use Install Options, don't show any window.<br />
<br />
This is the normal window  (When I don't use this goto at .onInit function finish) :</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th February 2003, 20:27</div></div><div class="posttext">deguix, that code makes the installer jump 3 commands ahead, you can't know what affect a code that's not related to the function will have on the installer. In your case, this was it, in another case there is no command there, if the function is at the end of the script it might just access random memory. In any case, putting wrong code in the compiler on purpose is a bad idea.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">10th February 2003, 12:41</div></div><div class="posttext">Yes, but when I wrote that code, I didn't know that it was wrong code:<br />
Jumping from Goto +3, where does that lead?<br />
To the third line from the Goto Instruction, the third instruction from the Goto instruction (labels, section ends, function ends or macro ends included?).<br />
<br />
To me, the above code should jump to the messagebox.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">10th February 2003, 12:52</div></div><div class="posttext">I guess this is just an issue with what you expect to happen. I read your code and expected trouble because I count only things that I think will generate an opcode as valid goto targets. After reading the docs thoroughly I'm a little unsure as to whether or not a label is counted when using offsets. I don't think they are but then you *can* goto to a label. Add to that the fact that you can use GetXXXAddress() to find goto targets and it really gets confusing...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">10th February 2003, 12:59</div></div><div class="posttext">If you can go to labels, no error would ne generated, since 'EndOfSection:' is the third instruction (labels included) from the Goto Instruction.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th February 2003, 13:26</div></div><div class="posttext">It only counts instructions.<br />
<br />
From Goto's docs:<br />
If +offset or -offset is specified, jump is relative by offset instructions. Goto +1 goes to the next instruction, Goto -1 goes to the previous instruction, etc.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">10th February 2003, 13:28</div></div><div class="posttext">Where is instruction defined though? Is it necessarily clear what an instruction is or isn't to people other than yourself KiCHiK? Logically I can usually work it out by looking at the code, it tends to &quot;goto&quot; as I expect. However I'm just trying to play Devil's Advocate here :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th February 2003, 13:53</div></div><div class="posttext">Welp, from Label:<br />
<br />
Labels are the targets of Goto instructions, or of the various branching instructions (such as IfErrors, MessageBox, IfFileExists, and StrCmp). Labels must be within a Section or a Function. Labels are local in scope, meaning they are only accessible from within the Section or Function that they reside in. To declare a label, simply do:<br />
<br />
MyLabel:<br />
<br />
Labels cannot begin with a -, +, !, $, or 0-9. When specifying labels for the various instructions that require them, remember that both an empty string (&quot;&quot;) and 0 both represent the next instruction (meaning no Goto will occur). Labels beginning with a period (.) are global, meaning you can jump to them from any function or section (though you cannot jump to an uninstall global label from the installer, and vice versa).<br />
<br />
And from Goto:<br />
<br />
If a user variable is specified, jumps to absolute address (generally you will want to get this value from a function like GetLabelAddress). Compiler flag commands and SectionIn aren't instructions so jumping over them has no effect.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">10th February 2003, 14:07</div></div><div class="posttext">Yep, I'd already read that. Doesn't really answer my question about what is or isn't an instruction though. But since I don't really have a problem with goto and was just playing Devil's Advocate I'll shut up now :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th February 2003, 14:35</div></div><div class="posttext">The label part doesn't mention a thing about label being an instruction and the goto part tells you exactly what +* jumps over.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">10th February 2003, 16:54</div></div><div class="posttext">That is something that will propably change with the new documentation of NSIS:<br />
Listed where you can use sertain instructions (in sections, functions, macros or outside them).<br />
Listed to what instructions you can(not) jump to with Goto +n or Goto -n.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th February 2003, 18:47</div></div><div class="posttext">Who put that there? :p<br />
http://nsis.sourceforge.net/Docs/Chapter3.html#3.4</div></div><hr />


<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">10th February 2003, 19:06</div></div><div class="posttext">Great work! I didn't even need the Goto +3, but my thread became a discussion about what to jump and what not. Now you see what's the result!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>