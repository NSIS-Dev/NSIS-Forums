<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Reading variables from file unseen in sections., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Reading variables from file unseen in sections. NSIS Discussion" />
	
	<title> Reading variables from file unseen in sections. [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Reading variables from file unseen in sections.</div>
<hr />
<div class="pda"><a href="t-345267.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=345267">Reading variables from file unseen in sections.</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">eredhal</div><div class="date">31st May 2012, 10:56</div></div><div class="posttext">Hello, for some time already im using NSIS. Since now i used only hardcodded method for names and paths for the installation. Now i wanted to make universal installtion with config file, for names in my installation file. Sadly i got big issue with some variables.<br />
<br />
Thats what i do :<br />
<br />
MainFile.nsh<br />
Name $AppName<br />
!define APP_NAME $(^Name)<br />
!define COMPANYNAME $CompanyName<br />
Function .onInit<br />
	ClearErrors<br />
	Delete $TEMP\Company\install.log<br />
	InitPluginsDir<br />
	Push $R1<br />
    File /oname=$PLUGINSDIR\spltmp.bmp &quot;${NSISDIR}\Contrib\Graphics\Header\splash.bmp&quot;<br />
    advsplash::show 1000 600 400 -1 $PLUGINSDIR\spltmp<br />
    Pop $R1<br />
    Pop $R1<br />
    !insertmacro MULTIUSER_INIT<br />
	Iffileexists &quot;$EXEDIR\setup.ini&quot; 0 onInitNoFile<br />
	!insertmacro &quot;ReadSetupINI&quot;<br />
	CreateDirectory &quot;$INSTDIR\$(^Name)&quot;<br />
	!insertmacro Logger &quot;INFO&quot; &quot;Installation started, reading setup.ini&quot;<br />
	Iferrors 0 onInitSetLang<br />
	!insertmacro Logger &quot;INFO&quot; &quot;Setup.ini read cause an error.&quot;<br />
	Goto onInitSetLang<br />
	onInitNoFile:<br />
	!insertmacro Logger &quot;ERROR&quot; &quot;Setup.ini file doesn't exist loading default values&quot;<br />
	onInitSetLang:<br />
	${SetLanguage} $Lang<br />
	StrCpy $LiczSerial &quot;1&quot;<br />
	!insertmacro Logger &quot;INFO&quot; &quot;Language has been set up to $Lang($LANGUAGE)&quot;<br />
	!insertmacro Logger &quot;INFO&quot; &quot;Initialisation complete, proceed with user interface.&quot;<br />
FunctionEnd<br />
<br />
Thats where i want to read setup.ini, macroes(shorten) :<br />
!define ReadSetupini &quot;!insertmacro ReadSetupini&quot;<br />
!macro ReadSetupini<br />
Clearerrors<br />
${ReadSetupKey} $R0 &quot;Startup&quot; &quot;CompanyName&quot; &quot;CompanyName&quot;<br />
${ReadSetupKey} $R0 &quot;Startup&quot; &quot;Appname&quot; &quot;AppName&quot;<br />
${ReadSetupKey} $R0 &quot;Startup&quot; &quot;ProductGUID&quot;  &quot;ProductGUID&quot;<br />
${ReadSetupKey} $R0 &quot;Languages&quot; &quot;Default&quot; &quot;Lang&quot;<br />
!macroend<br />
<br />
!define ReadSetupKey &quot;!insertmacro ReadSetupKey&quot;<br />
!macro ReadSetupKey Var Sect Key Def<br />
   ClearErrors<br />
   ReadINIStr ${Var} ${SETUP_INI} ${Sect} ${Key}<br />
   Var /GLOBAL ${Def} <br />
   StrCpy $${Def} &quot;${Var}&quot;<br />
   StrCmpS &quot;${Key}&quot; &quot;CompanyName&quot; &quot;${Key}jump&quot; 0<br />
   !insertmacro Logger &quot;INFO&quot; &quot;Setup.ini: Definition ${Def} is set to ${Var}&quot;<br />
   Goto &quot;${Key}jumpend&quot;<br />
   ${Key}jump:<br />
   StrCmpS $CompanyName &quot;&quot; 0 +2<br />
   StrCpy $CompanyName &quot;Ontia&quot;<br />
   CreateDirectory $TEMP\$CompanyName<br />
   !insertmacro Logger &quot;INFO&quot; &quot;Setup.ini: Definition of ${Def} wasn't set up properly, using default value&quot;<br />
   ${Key}jumpend:<br />
!macroend<br />
<br />
<br />
For what i see, when i copy $AppName into (^Name) i can use it anywhere. However, when i get $CompanyName from a file i can use it only in .onInit. When i get into first Section and then i call Macro Logger, it shows that $CompanyName is empty(returns $CompanyName while using MessageBox)<br />
<br />
!define Logger &quot;!insertmacro Logger&quot;<br />
!macro Logger Type Message<br />
	${GetTime} &quot;&quot; &quot;L&quot; $0 $1 $2 $3 $4 $5 $6<br />
	nsislog::log &quot;$TEMP\${COMPANYNAME}\install.log&quot; &quot;$4:$5:$6 ${Type} ${Message}&quot;<br />
!macroend<br />
<br />
whatever i use ${CompanyName} or $CompanyName its empty and returns only those ${x} / $x<br />
<br />
If you ask why i did this that way, i need to make about 5 different installers, very similiar but i need them to read from file different values, and ReadSetupINI make it easier to use then setting variables inside MainFile.nsh.<br />
<br />
I hope that i shown clearly what i need :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>