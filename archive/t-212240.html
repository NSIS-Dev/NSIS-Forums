<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" !system call during compile time, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  !system call during compile time NSIS Discussion" />
	
	<title> !system call during compile time [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  !system call during compile time</div>
<hr />
<div class="pda"><a href="t-212240.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=212240">!system call during compile time</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">PatrickFraley</div><div class="date">4th April 2005, 10:09</div></div><div class="posttext">Hi All,<br />
<br />
I am making a !system call during compile time to start a batch file.  In this batch file I have 2 commands, the first synchronises the source directory agains a given release using a tool called directory compare.  this part works perfect.  the sekond step is to copy in any customer specific files using xcopy and this command gets ignored.  if i open a command shell in windows and call the batch file all works great.  if i call it from nsis the xcopy command does not seem to execute (even though the interpreter says it is executing it).<br />
<br />
please help<br />
<br />
tia<br />
patrick</div></div><hr />


<div class="post"><div class="posttop"><div class="username">flizebogen</div><div class="date">4th April 2005, 11:58</div></div><div class="posttext">how do you call it?<br />
<br />
As xcopy is an internal command of cmd you need to start cmd and give the xcopy as a parameter<br />
<br />
Maybe you can share your code</div></div><hr />


<div class="post"><div class="posttop"><div class="username">PatrickFraley</div><div class="date">4th April 2005, 12:54</div></div><div class="posttext">Hi,<br />
<br />
actually I do not call xcopy directly, I call the following batch file, which in turn calls xcopy. xcopy is cmd internal?  I have it laying under: C:\WINDOWS\SYSTEM32\xcopy.exe<br />
<br />
NSIS call:<br />
<br />
!system '..\common\scripte\copyRelease.bat'<br />
<br />
oder:<br />
<br />
!system 'cmd /c ..\common\scripte\copyRelease.bat'<br />
<br />
beides l√§sst den xcopy befehl aus :(<br />
<br />
<br />
tia<br />
patrick<br />
<br />
<br />
copyRelease.bat:<br />
<br />
rem @echo off<br />
<br />
<br />
<br />
&quot;M:\mM4Setups\current\NSIS Source\common\programme\DIRCMP&quot; /s M:\mediMACH\Releases\mediMACH4-%1 /t M:\mM4Setups\current\mM4Source\%2\mediMACH4 /m /q /w<br />
<br />
<br />
<br />
xcopy.exe &quot;M:\mediMACH\Kundenversionen\mediMACH4\*.*&quot; &quot;M:\mM4Setups\current\mM4Source\mediMACH4\&quot; /E /Y</div></div><hr />


<div class="post"><div class="posttop"><div class="username">flizebogen</div><div class="date">4th April 2005, 13:41</div></div><div class="posttext">oops... i always thought xcopy is an internal command<br />
<br />
i tested the following and i worked:<br />
<br />
!system 'xcopy /s /e c:\test_ordner d:\3'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">PatrickFraley</div><div class="date">4th April 2005, 14:08</div></div><div class="posttext">I tried calling it the way you did, but no luck.<br />
<br />
do the files realy get copied?  the compiler output say's !system returned 0, but actually nothing happened.<br />
<br />
this is really odd.  like I said when I call the batchfile from hand everything works fine, but when I call it from nsis during compiletime it never executes the xcopy command.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">flizebogen</div><div class="date">4th April 2005, 14:16</div></div><div class="posttext">yes i see a list of files being copied. Is M:\ a drive mapping? If yes test a xcopy with local paths</div></div><hr />


<div class="post"><div class="posttop"><div class="username">PatrickFraley</div><div class="date">4th April 2005, 14:31</div></div><div class="posttext">yes m: is a drive mapping.  i tried using just c: and it did not work either.  it must have something to do with the way nsis executes shell commands.  maybe it sees the xcopy command and then does not execute it, since it is a special command for nsis (doesn't it use xcopy to copy files onto a target system?)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">4th April 2005, 15:38</div></div><div class="posttext">try to run your batch file manually, i don't think, your xcopy-syntax is correct.<br />
<br />
as first argument, u used a file specification:<br />
&quot;M:\mediMACH\Kundenversionen\mediMACH4\*.*&quot;<br />
but as second one just a directory:<br />
&quot;M:\mM4Setups\current\mM4Source\mediMACH4\&quot;<br />
<br />
use a directory OR a file specification in BOTH arguments, like this:<br />
xcopy.exe &quot;M:\mediMACH\Kundenversionen\mediMACH4&quot; &quot;M:\mM4Setups\current\mM4Source\mediMACH4&quot; /E /Y</div></div><hr />


<div class="post"><div class="posttop"><div class="username">PatrickFraley</div><div class="date">4th April 2005, 15:46</div></div><div class="posttext">Hi,<br />
<br />
thanks for the reply, but the syntax is correct and the batchFile when I start it from a command (cmd) shell works fine (as I stated in my first post ;), just calling it from NSIS it does not work.  I also tried your syntax, with no difference.<br />
<br />
thanks<br />
patrick</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Gabriel Sieben</div><div class="date">4th May 2005, 14:29</div></div><div class="posttext">Use the robust copy command out of the windows resource kit.<br />
<br />
!system '${InstallScriptInput}\robocopy /NFL /E &quot;${ProductInput}\cd-Root&quot; &quot;${Output}&quot; '</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th May 2005, 17:44</div></div><div class="posttext">NSIS simply calls system() (http://msdn.microsoft.com/library/en-us/vccore98/HTML/_crt_system.2c_._wsystem.asp) which calls %COMSPEC% /c &lt;your command here&gt;. Your problem might be that the COMSPEC environment variable is not defined correctly.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mynab</div><div class="date">19th October 2005, 09:53</div></div><div class="posttext">Hello,<br />
<br />
I am facing the exact same problem. If you write a simple .bat file that does:<br />
<br />
echo %COMSPEC%<br />
xcopy /?<br />
<br />
and execute it from your script with a !system call you'll notice that it does output the right COMSPEC but that the call to xcopy is simply bypassed and does not output anthing. I replaced xcopy by &quot;c:\windows\system32\xcopy.exe&quot; and got the same result. Of course, running this from anywhere displays the help message of xcopy...<br />
<br />
Thanks,<br />
mynab<br />
<br />
PS: copy /? does work (but does not perform recursive file copy) so this seems to be xcopy related...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th October 2005, 20:33</div></div><div class="posttext">xcopy requires stdin which MakeNSISw doesn't provide. This problem was already fixed for nsExec (http://forums.winamp.com/showthread.php?s=&amp;threadid=172311&amp;highlight=nsexec+pipe), so fixing it again for MakeNSISw wasn't hard. Until 2.11, or the next nightly build, you can use makensis.exe directly.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mynab</div><div class="date">21st October 2005, 16:31</div></div><div class="posttext">Thanks you very much kichik!<br />
<br />
Another almost related question: when I run makensis.exe using the /O flag all my output is nicely redirected to a file except the output of commands run with !system. Is there a may to make this output go to the /O specified log file the same way it merges in the makensisw.exe window?<br />
<br />
Thanks<br />
mynab</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st October 2005, 16:35</div></div><div class="posttext">Use output redirection:makensis.exe script.nsi &gt; output.txtTo redirect errors to the file as well:makensis.exe script.nsi &gt; output.txt 2&gt;&amp;1For more information:<br />
http://www.robvanderwoude.com/redirection.html</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mynab</div><div class="date">21st October 2005, 16:37</div></div><div class="posttext">Thanks I know redirections but in that case why did you put a /O switch to makensis? :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st October 2005, 16:39</div></div><div class="posttext">I don't know, I didn't add it. It might be for easy redirection outside of a command prompt.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>