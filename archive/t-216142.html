<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem with $INSTDIR: a bug?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem with $INSTDIR: a bug? NSIS Discussion" />
	
	<title> Problem with $INSTDIR: a bug? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem with $INSTDIR: a bug?</div>
<hr />
<div class="pda"><a href="t-216142.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=216142">Problem with $INSTDIR: a bug?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">hooklee</div><div class="date">16th May 2005, 09:26</div></div><div class="posttext">When I click &quot;Cancel&quot; button of the Dir-Browsing dialog of DirPage, $INSTDIR becomes the last path I have clicked in the cancelled dialog, though the original value (maybe different from the real value of $INSTDIR) is displayed in the edit box. As a result, I cannot verify the correct $INSTDIR in my own LeaveDirPage function :-(<br />
<br />
To make the above description clearer, see the following code segment and example. <br />
<br />
<br />
PageEx directory<br />
  DirVerify leave<br />
  PageCallbacks &quot;&quot; &quot;&quot; LeaveDirPage<br />
PageExEnd<br />
<br />
Function LeaveDirPage<br />
...<br />
FunctionEnd<br />
<br />
<br />
-- The original value of $INSTDIR is &quot;C:\temp&quot;<br />
-- Click &quot;Browse&quot; button, click a different folder &quot;C:\abc&quot;, then click &quot;Cancel&quot; button to close the dir-browsing dialog.<br />
-- Then, &quot;C:\temp&quot; remains in the edit box, however, now $INSTDIR = &quot;C:\abc&quot; if you check it in .onVerifyInstDir or LeaveDirPage function.<br />
-- After LeaveDirPage runs, $INSTDIR is assigned to the original value (i.e., the one displayed in the edit box) &quot;C:\temp&quot;.<br />
-- Though NSIS will not install to a wrong dir, but LeaveDirPage cannot catch a correct one.<br />
<br />
Do you think it is a BUG? Or did I misuse antything?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">hooklee</div><div class="date">16th May 2005, 09:56</div></div><div class="posttext">Two possible solutions to my problem:<br />
<br />
1) In LeaveDirPage function, read $INSTDIR from the edit box. Could anyone please tell me how to do so?<br />
<br />
2) In the pre function of the next page, verify $INSTDIR. If it is invalid, automatically back to DirPage. I failed to find a instruction to mimic the Back button. Please help me if you know. Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">16th May 2005, 12:30</div></div><div class="posttext">I think there is two bugs:<br />
1. Problem you post<br />
2. SendMessage with WM_GETTEXT<br />
&amp;nbsp;&amp;nbsp;&amp;nbsp; (crash: SendMessage $0 ${WM_GETTEXT} ${NSIS_MAX_STRLEN} $0)<br />
<br />
Try this:<br />
Name &quot;Output&quot;<br />
OutFile &quot;Output.exe&quot;<br />
InstallDir &quot;C:\temp&quot;<br />
<br />
!include &quot;WinMessages.nsh&quot;<br />
<br />
<br />
PageEx directory<br />
	DirVerify leave<br />
	PageCallbacks &quot;&quot; &quot;&quot; LeaveDirPage<br />
PageExEnd<br />
<br />
Page instfiles<br />
<br />
<br />
Function LeaveDirPage<br />
	FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
	GetDlgItem $0 $0 1019<br />
	System::Call &quot;user32::SendMessage(i $0, i ${WM_GETTEXT}, i ${NSIS_MAX_STRLEN}, t .r0)&quot;<br />
<br />
	MessageBox MB_OK &quot;$$INSTDIR={$INSTDIR}$\n$$0={$0}&quot;<br />
FunctionEnd<br />
<br />
Section<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">hooklee</div><div class="date">16th May 2005, 13:11</div></div><div class="posttext">Thanks for the code. Using GetWindowText may be simpler ;-)<br />
<br />
<br />
FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
GetDlgItem $1 $0 1019 ; IDC_DIR<br />
System::Call 'User32::GetWindowText(i $1, t .R0, i 256)'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th May 2005, 20:53</div></div><div class="posttext">The problem is indeed a bug. I have fix this in CVS. Thanks.<br />
<br />
The SendMessage is not a bug. When you use $0, you use its value, not a pointer to it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">18th May 2005, 08:40</div></div><div class="posttext">Originally posted by kichik <br />
The problem is indeed a bug. I have fix this in CVS. Thanks.<br />
<br />
The SendMessage is not a bug. When you use $0, you use its value, not a pointer to it.Can you write an example using  SendMessage $0 ${WM_GETTEXT} ...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th May 2005, 17:38</div></div><div class="posttext">I can't give you an example because it's impossible. You can't define pointers in the script without the System plug-in.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>