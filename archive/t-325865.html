<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" UAC_AsUser_ExecShell doing nothing, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  UAC_AsUser_ExecShell doing nothing NSIS Discussion" />
	
	<title> UAC_AsUser_ExecShell doing nothing [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  UAC_AsUser_ExecShell doing nothing</div>
<hr />
<div class="pda"><a href="t-325865.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=325865">UAC_AsUser_ExecShell doing nothing</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">laughingman86</div><div class="date">12th January 2011, 12:25</div></div><div class="posttext">hi<br />
<br />
at the end of install need to start a program, so using this string<br />
!insertmacro UAC_AsUser_ExecShell &quot;&quot; &quot;$INSTDIR\${APP_EXE_FILE}&quot; &quot;&quot; &quot;&quot; &quot;&quot;<br />
But it isn't running<br />
<br />
On init using this:<br />
Function .OnInit<br />
  !insertmacro UAC_RunElevated<br />
  # call userInfo plugin to get user info.  The plugin puts the result in the stack<br />
    userInfo::getAccountType<br />
  # pop the result from the stack into $0<br />
    pop $0<br />
    # compare the result with the string &quot;Admin&quot; to see if the user is admin.<br />
    # If match, jump 3 lines down.<br />
    strCmp $0 &quot;Admin&quot; +2<br />
    # if there is not a match, quit<br />
    Abort<br />
    # otherwise, continue<br />
<br />
What am i doing wrong?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">12th January 2011, 20:25</div></div><div class="posttext">There was a fix related to $instdir in the plugin recently so make sure you have the latest version. Also, you .onInit code is all wrong.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">laughingman86</div><div class="date">13th January 2011, 14:32</div></div><div class="posttext">Thanks, also appearently my installer file uses ANSI encoding so most of the commands didn't work right.<br />
i used this onInit code to test my admin rights - because of the above reason.<br />
So now i test this onInit<br />
<br />
!insertmacro UAC_RunElevated<br />
  ${IfNot} ${UAC_IsAdmin}<br />
	Quit<br />
  ${EndIf}<br />
<br />
and it works fine</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">13th January 2011, 22:02</div></div><div class="posttext">Still wrong, you are supposed to check $0,$1,$2 and $3</div></div><hr />


<div class="post"><div class="posttop"><div class="username">browserseal</div><div class="date">18th June 2011, 14:17</div></div><div class="posttext">I'm having exactly the same problem,     !insertmacro UAC_AsUser_ExecShell '' '&quot;$TEMP&quot;' '' '' '' has no effect and it is not clear how to debug this.<br />
<br />
Could not figure out how the original poster solved his problem...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">18th June 2011, 14:26</div></div><div class="posttext">I don't think starting $temp would work no matter what:<br />
<br />
Admin's $temp is c:\users\admin\... , the normal user cannot access that path...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">18th June 2011, 17:19</div></div><div class="posttext">Also I'm pretty sure you can't just 'execute' a directory... You'll probably want to run a function as user, and in that function do Exec $windir\explorer.exe /n,&quot;$temp&quot;  or something like that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">browserseal</div><div class="date">18th June 2011, 18:28</div></div><div class="posttext">Yeah... you are probably right about the user not being able to access the admin's temp directory. I wonder how can I make NSIS download something to a directory that will be later accessible by the user...<br />
<br />
P.S. Of course I'm not trying to run the directory, I removed the program name after I copy-pasted the code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">18th June 2011, 19:11</div></div><div class="posttext">Perhaps you can call a function as user and let that download?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">browserseal</div><div class="date">19th June 2011, 05:35</div></div><div class="posttext">UAC_AsUser_Call... right. Should work. Thanks</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>