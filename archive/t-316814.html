<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSDialogs::NSD_GetText intermittent failure and crash with 8192-char build, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSDialogs::NSD_GetText intermittent failure and crash with 8192-char build NSIS Discussion" />
	
	<title> NSDialogs::NSD_GetText intermittent failure and crash with 8192-char build [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSDialogs::NSD_GetText intermittent failure and crash with 8192-char build</div>
<hr />
<div class="pda"><a href="t-316814.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=316814">NSDialogs::NSD_GetText intermittent failure and crash with 8192-char build</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">5th February 2010, 20:01</div></div><div class="posttext">I'm running into an odd problem here where NSD_GetText will return what appears to be an empty string from an edit control (NSD_CreateText) intermittently.<br />
<br />
I.e. on my installer's startup, where I've got an interactive feedback through an NSD_OnChange, it will very often fail.. I'll enter some gobbledygook into the edit control and suddenly - randomly - it'll start working.  After that it'll tend to keep working, but every once in a while it'll break again as well and once again it returns an empty string.<br />
<br />
I am using the 8192-character version of makensis, and this seems to be the culprit somehow; reverting to the regular build solves the issue - but creates a new one ;)<br />
<br />
I can't share the actual installer code, but here's a sample that will replicate the behavior - albeit less severely so.<br />
<br />
<br />
!include &quot;MUI2.nsh&quot;<br />
!include &quot;nsDialogs.nsh&quot;<br />
<br />
OutFile &quot;test.exe&quot;<br />
<br />
Page Custom test<br />
<br />
Var dialog<br />
Var editcontrol<br />
Var label<br />
Var hwnd<br />
<br />
Function test<br />
	nsDialogs::Create 1018<br />
	Pop $dialog<br />
<br />
	${NSD_CreateText} 0% 3% 100% 8% &quot;Testing&quot;<br />
		Pop $editcontrol<br />
		${NSD_OnChange} $editcontrol editchanged<br />
<br />
	${NSD_CreateLabel} 0% 12% 100% 70% &quot;Testing&quot;<br />
		Pop $label<br />
<br />
	nsDialogs::Show<br />
FunctionEnd<br />
<br />
Function editchanged<br />
	Pop $hwnd<br />
	${NSD_GetText} $hwnd $0<br />
	${NSD_SetText} $label $0<br />
FunctionEnd<br />
<br />
Section<br />
SectionEnd<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
 <br />
<br />
Tests to run:<br />
1. Enter some text.  It should get replicated in the label below the edit contol.<br />
<br />
2. Copy the text and paste it a bunch of times - eventually (at 256 characters), the label will not show the text anymore.<br />
At this point, if you erase your text, the label may either update again or it will stay empty.<br />
( in the standard build, you can enter well beyond 256 characters without problem. )<br />
<br />
3. Paste your text a whole lot more - eventually, the installer will simply crash to desktop.<br />
<br />
Unfortunately this is not exactly the same scenario as in my actual installer - as it has far less than 256 characters in it; but I'd imagine the problems are related if not the exact same in origin.<br />
<br />
Thoughts?  Thanks in advance! :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th February 2010, 16:31</div></div><div class="posttext">I can't reproduce this with either builds. Can you find a scenario that's easier to reproduce?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">6th February 2010, 23:34</div></div><div class="posttext">I was hoping that was the easiest reproduction case - never fails to fail here :\<br />
<br />
Let's try with this, though...<br />
<br />
!include &quot;MUI2.nsh&quot;<br />
!include &quot;nsDialogs.nsh&quot;<br />
<br />
OutFile &quot;test.exe&quot;<br />
<br />
Var InstallDir<br />
<br />
Var dialog<br />
Var hwnd<br />
Var null<br />
<br />
Var NSD_InstallDir<br />
Var NSD_StatusLabel<br />
<br />
Page Custom page.settings<br />
<br />
<br />
Function page.settings<br />
	!insertmacro MUI_HEADER_TEXT &quot; Installation settings&quot; &quot; Some more text goes here...&quot;<br />
<br />
	nsDialogs::Create 1018<br />
	Pop $dialog<br />
<br />
	${NSD_CreateLabel} 3% 3% 25% 8% &quot;&amp;Installation folder: &quot;<br />
		Pop $null<br />
<br />
	${NSD_CreateText} 29% 3% 63% 8% &quot;C:\Program Files\Test\Test 2&quot;<br />
		Pop $NSD_InstallDir<br />
		${NSD_OnChange} $NSD_InstallDir page.settings.installdir.onchange<br />
<br />
	${NSD_CreateButton} 92% 3% 5% 8% &quot;...&quot;<br />
		Pop $hwnd<br />
<br />
	${NSD_CreateGroupbox} 0% 60% 100% 39% &quot;&quot;<br />
	    Pop $null<br />
	${NSD_CreateLabel} 3% 66% 94% 31% &quot;&quot;<br />
	    Pop $NSD_StatusLabel<br />
<br />
	nsDialogs::Show<br />
FunctionEnd<br />
<br />
Function page.settings.installdir.onchange<br />
	Pop $hwnd<br />
	${NSD_GetText} $hwnd $InstallDir<br />
	MessageBox MB_OK &quot;$$InstallDir = '$InstallDir'&quot;<br />
	${NSD_SetText} $NSD_StatusLabel &quot;'$InstallDir'&quot;<br />
FunctionEnd<br />
<br />
<br />
Section<br />
SectionEnd<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
This is slightly more akin to the actual installer I'm working on - basically that's an installation path bit with browse button and whatnot, and I'm interactively checking whether the path is malformed or not, etc.  That code isn't included here, but you get the idea.<br />
<br />
Build this with NSIS 2.46 base install + makensis v2.46 NSIS_MAX_STRLEN=8192.<br />
<br />
Upon execution, nothing particular should happen.  Now add/remove text from the path.  You should get a messagebox, and a status label gets updated.<br />
On the very first character I enter, that messagebox and label shows me that the value that was retrieved with NSD_GetText appears to be empty, displaying ''.  The second character is okay.<br />
<br />
The aforementioned bits still apply, though - it intermittently fails again.  Easier to test after removing the messagebox (which is just there to check whether the problem was in gettext or settext).<br />
<br />
Without fail - the 1024-character default build works just fine even on the first character changed.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>