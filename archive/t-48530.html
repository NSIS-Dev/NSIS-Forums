<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" T^T need help...., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  T^T need help.... NSIS Discussion" />
	
	<title> T^T need help.... [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  T^T need help....</div>
<hr />
<div class="pda"><a href="t-48530.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=48530">T^T need help....</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">dTomoyo</div><div class="date">30th April 2001, 13:09</div></div><div class="posttext">Section &quot;Driver 0.1&quot;<br />
SectionIn 12<br />
IfFileExists $SYSDIR\drive.ax CheckFile InstFile<br />
CheckFile:<br />
    CompareDLLVersions files\file.ax $SYSDIR\drive.ax InstFile SkipFile<br />
InstFile:<br />
    SetOverwrite try<br />
    SetOutPath $SYSDIR<br />
    File files\drive.ax<br />
    RegDLL $SYSDIR\drive.ax<br />
    ReadINIStr $0 $WINDIR\system.ini 386enh ebios<br />
    StrCmp $0 &quot;*ebios&quot; Win98Reg Win2000Reg<br />
    Win98Reg:<br />
        WriteRegStr HKLM &quot;1...&quot; &quot;a...&quot; &quot;x...&quot;<br />
        WriteRegStr HKLM &quot;2...&quot; &quot;b...&quot; &quot;y...&quot;<br />
        WriteRegStr HKLM &quot;3...&quot; &quot;c...&quot; &quot;z...&quot;<br />
        Nop<br />
    Win2000Reg:<br />
        WriteRegStr HKLM &quot;4...&quot; &quot;d...&quot; &quot;v...&quot;<br />
        WriteRegStr HKLM &quot;5...&quot; &quot;e...&quot; &quot;w...&quot;<br />
        Nop<br />
SkipFile:<br />
SectionEnd<br />
<br />
------------------------------<br />
(1) Installation success.<br />
(2) but, Registry has Win98 and Win2000 both Reg entries.<br />
(3) I'm using system.ini's '386enh-ebios' element for detecting Windows Version.<br />
If exist 'ebios', it's Win9x. else Win2000.<br />
(4) I want install a part of reg keys, Win98 or Win2000.<br />
<br />
How do that?<br />
<br />
Need help....<br />
<br />
<br />
[Edited by dTomoyo on 04-30-2001 at 09:33 AM]</div></div><hr />


<div class="post"><div class="posttop"><div class="username">yazno</div><div class="date">30th April 2001, 17:37</div></div><div class="posttext">hi,<br />
<br />
as the string in variable $x is empty when the inistring you try to read doesn't exist you should better (IMHO) use IfErrors.<br />
<br />
and .. the way you did it in your script on win98 systems there would be always written both registry entries, after writing to the registry you should use GoTo to jump out.<br />
<br />
try it like that:<br />
<br />
Section &quot;Driver 0.1&quot;<br />
SectionIn 12<br />
IfFileExists $SYSDIR\drive.ax CheckFile InstFile<br />
<br />
CheckFile:<br />
CompareDLLVersions files\file.ax $SYSDIR\drive.ax InstFile\<br />
SkipFile<br />
<br />
InstFile:<br />
<br />
SetOverwrite try<br />
SetOutPath $SYSDIR<br />
File files\drive.ax<br />
RegDLL $SYSDIR\drive.ax<br />
ReadINIStr $0 $WINDIR\system.ini 386enh ebios<br />
IfErrors Win2000Reg Win98Reg <br />
<br />
Win98Reg:<br />
WriteRegStr HKLM &quot;1...&quot; &quot;a...&quot; &quot;x...&quot;<br />
WriteRegStr HKLM &quot;2...&quot; &quot;b...&quot; &quot;y...&quot;<br />
WriteRegStr HKLM &quot;3...&quot; &quot;c...&quot; &quot;z...&quot;<br />
GoTo SkipFile<br />
<br />
Win2000Reg:<br />
WriteRegStr HKLM &quot;4...&quot; &quot;d...&quot; &quot;v...&quot;<br />
WriteRegStr HKLM &quot;5...&quot; &quot;e...&quot; &quot;w...&quot;<br />
<br />
SkipFile:<br />
SectionEnd<br />
<br />
i hope it works<br />
<br />
btw:<br />
justin, wouldn't it be fine to implement a constant in NSIS which holds the windows version ?<br />
<br />
cu yzo</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dTomoyo</div><div class="date">1st May 2001, 01:18</div></div><div class="posttext">Thanks.<br />
<br />
:) :) :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dTomoyo</div><div class="date">1st May 2001, 03:36</div></div><div class="posttext">Originally posted by yazno <br />
<br />
Section &quot;Driver 0.1&quot;<br />
SectionIn 12<br />
IfFileExists $SYSDIR\drive.ax CheckFile InstFile<br />
<br />
CheckFile:<br />
CompareDLLVersions files\file.ax $SYSDIR\drive.ax InstFile SkipFile<br />
<br />
InstFile:<br />
SetOverwrite try<br />
SetOutPath $SYSDIR<br />
File files\drive.ax<br />
RegDLL $SYSDIR\drive.ax<br />
ReadINIStr $0 $WINDIR\system.ini 386enh ebios<br />
IfErrors Win2000Reg Win98Reg <br />
<br />
Win98Reg:<br />
  WriteRegStr HKLM &quot;1...&quot; &quot;a...&quot; &quot;x...&quot;<br />
  WriteRegStr HKLM &quot;2...&quot; &quot;b...&quot; &quot;y...&quot;<br />
  WriteRegStr HKLM &quot;3...&quot; &quot;c...&quot; &quot;z...&quot;<br />
  GoTo SkipFile<br />
<br />
Win2000Reg:<br />
  WriteRegStr HKLM &quot;4...&quot; &quot;d...&quot; &quot;v...&quot;<br />
  WriteRegStr HKLM &quot;5...&quot; &quot;e...&quot; &quot;w...&quot;<br />
<br />
SkipFile:<br />
SectionEnd<br />
<br />
<br />
<br />
:(<br />
Didn't work...<br />
Registry has both settings.<br />
<br />
I guess 'ReadIniStr' &amp; 'IfErrors' command has some bug.<br />
<br />
:(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">justin</div><div class="date">1st May 2001, 04:37</div></div><div class="posttext">You have to do a ClearErrors before the ReadINIStr, then do IfErrors after...<br />
<br />
-Justin</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>