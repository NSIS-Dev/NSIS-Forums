<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Uninstall deleted all files under Program Files, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Uninstall deleted all files under Program Files NSIS Discussion" />
	
	<title> Uninstall deleted all files under Program Files [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Uninstall deleted all files under Program Files</div>
<hr />
<div class="pda"><a href="t-288112.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=288112">Uninstall deleted all files under Program Files</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Hernaez</div><div class="date">7th March 2008, 18:30</div></div><div class="posttext">Have been using this installer for a few months now, it's fairly simple - just copies files to an installation directory. <br />
<br />
Problem was that on one instance of the uninstall in addition to it's own installation directory it also wiped out the contents of Program Files.<br />
<br />
Any ideas why this might have occurred and how I can be sure to prevent this?<br />
<br />
The only thing I can think of is that the &quot;${PRODUCT_DIR_REGKEY}&quot; happened to be a duplicate of another product of ours that was also installed.  I dont' actually know what this key is used for - it was inserted by the HM NIS wizard.<br />
<br />
Here's my uninstall section, any help would be appreciated.<br />
<br />
Section Uninstall<br />
  Call un.KillPro<br />
  Delete &quot;$INSTDIR\${PRODUCT_NAME}.url&quot;<br />
  Delete &quot;$INSTDIR\uninst.exe&quot;<br />
  RMDir /r &quot;$INSTDIR\plugins&quot;<br />
  RMDir /r &quot;$INSTDIR\common&quot;<br />
  Delete &quot;$SMPROGRAMS\ClearCanvas Ris Client\Uninstall.lnk&quot;<br />
  Delete &quot;$SMPROGRAMS\ClearCanvas Ris Client\Website.lnk&quot;<br />
  Delete &quot;$DESKTOP\ClearCanvas Ris Client.lnk&quot;<br />
  Delete &quot;$SMPROGRAMS\ClearCanvas Ris Client\ClearCanvas Ris Client.lnk&quot;<br />
  RMDir &quot;$SMPROGRAMS\ClearCanvas Ris Client&quot;<br />
<br />
  RMDir /r &quot;$INSTDIR&quot;<br />
<br />
  DeleteRegKey ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot;<br />
  DeleteRegKey HKLM &quot;${PRODUCT_DIR_REGKEY}&quot;<br />
  SetAutoClose true<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rixor</div><div class="date">7th March 2008, 20:50</div></div><div class="posttext">RMDir /r &quot;$INSTDIR&quot;<br />
<br />
That call causes the installer to remove the whole $INSTDIR tree recursively, regardless of whether or not it is empty. If $INSTDIR happens to be Program Files, then it will delete everything in Program Files.<br />
<br />
This is from the scripting reference: &quot;Warning: using RMDir /r $INSTDIR in the uninstaller is not safe. Though it is unlikely, the user might select to install to the Program Files folder and so this command will wipe out the entire Program Files folder, including other programs that has nothing to do with the uninstaller. The user can also put other files but the program's files and would expect them to get deleted with the program. Solutions are available for easily uninstalling only files which were installed by the installer.&quot;</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>