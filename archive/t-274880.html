<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" ANT_HOME Problem, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  ANT_HOME Problem NSIS Discussion" />
	
	<title> ANT_HOME Problem [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  ANT_HOME Problem</div>
<hr />
<div class="pda"><a href="t-274880.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=274880">ANT_HOME Problem</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">madams</div><div class="date">24th July 2007, 16:40</div></div><div class="posttext">Hi, <br />
<br />
I have yet another problem with my installer (posted in a thread right below this): Even though I set the ANT_HOME variable at the beginning of my main section, the installer claims ANT_HOME is invalid when I try to execute an ANT command toward the end of my main section. Here is my code snippet:<br />
<br />
SetOutPath $INSTDIR<br />
    SetOverwrite on<br />
    File /r caTissueCore1.2\* <br />
    WriteRegStr HKLM &quot;${REGKEY}\Components&quot; Main 1<br />
    <br />
    ${if} $antHomeDir == ''<br />
        !insertmacro ZIPDLL_EXTRACT &quot;$EXEDIR\apache-ant-1.6.0-bin.zip&quot; &quot;C:\&quot; &quot;&lt;ALL&gt;&quot;<br />
        Strcpy $antHomeDir &quot;C:\apache-ant-1.6.0&quot;<br />
    ${endif}<br />
    ${if} $jboss.home.dir == ''<br />
        !insertmacro ZIPDLL_EXTRACT &quot;$EXEDIR\jboss-4.0.0.zip&quot; &quot;C:\&quot; &quot;&lt;ALL&gt;&quot;<br />
        Strcpy $jboss.home.dir &quot;C:\JBoss-4.0.0&quot;<br />
    ${endif}  <br />
    Push $antHomeDir\bin<br />
    Call AddToPath<br />
    <br />
    Push JBOSS_HOME<br />
    Push $jboss.home.dir<br />
    Call WriteEnvStr <br />
    <br />
    Push ANT_HOME<br />
    Push $antHomeDir<br />
    Call WriteEnvStr<br />
    <br />
    call editCaTissueInstall.Properties<br />
    call editSqlConfigFiles<br />
    call editTextFilesAndLogo<br />
    <br />
    StrCpy $mySQLEXE &quot;$mySQLEXEbin\mysql.exe&quot;<br />
    detailPrint &quot;cmd /C $mySQLEXE -uroot -popen123 &lt; $databaseConfigFile&quot;<br />
    <br />
    nsExec::ExecToLog 'cmd /C IF 1==1 &quot;$mySQLEXE&quot; -uroot -p$databaseLoginPass &lt; $databaseConfigFile'<br />
    nsExec::ExecToLog 'cmd /C cd $INSTDIR'<br />
    nsExec::ExecToLog 'cmd /C $antHomeDir\bin\ant -f deploy.xml deploy_all_with_config'<br />
<br />
Any help would be greatly appreciated.<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th July 2007, 17:26</div></div><div class="posttext">You mean it is saying that the ANT_HOME environment variable does not exist?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">madams</div><div class="date">24th July 2007, 19:46</div></div><div class="posttext">The exact error I am getting is: &quot;ANT_HOME is set incorrectly or Ant could not be located. Please set ANT_HOME.&quot; <br />
<br />
I know that the ANT_HOME variable is getting set correctly, becuase I have checked it in System &gt; Advanced &gt; Environmental Variables as soon as the installer finishes. Also, if I try running the installer again after the first run fails, it works perfectly. Could it be that I have to restart the computer for the changed environmental variable settings to take effect?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th July 2007, 20:28</div></div><div class="posttext">Setting the environment variables only works for new processes started from explorer. To set it to new processed started from your process, you need to manually update the environment variables of your process.<br />
<br />
Use:<br />
<br />
http://nsis.sourceforge.net/Setting_Environment_Variables_to_Active_Installer_Process</div></div><hr />


<div class="post"><div class="posttop"><div class="username">madams</div><div class="date">24th July 2007, 20:42</div></div><div class="posttext">Ok, I edited my main section with the code in the link you provided, but I am still getting the invalid ANT_HOME error. Here's the edited code: <br />
<br />
 Section -Main SEC0000<br />
    SetOutPath $INSTDIR<br />
    SetOverwrite on<br />
    File /r caTissueCore1.2\* <br />
    WriteRegStr HKLM &quot;${REGKEY}\Components&quot; Main 1<br />
    <br />
    ${if} $antHomeDir == ''<br />
        !insertmacro ZIPDLL_EXTRACT &quot;$EXEDIR\apache-ant-1.6.0-bin.zip&quot; &quot;C:\&quot; &quot;&lt;ALL&gt;&quot;<br />
        Strcpy $antHomeDir &quot;C:\apache-ant-1.6.0&quot;<br />
    ${endif}<br />
    ${if} $jboss.home.dir == ''<br />
        !insertmacro ZIPDLL_EXTRACT &quot;$EXEDIR\jboss-4.0.0.zip&quot; &quot;C:\&quot; &quot;&lt;ALL&gt;&quot;<br />
        Strcpy $jboss.home.dir &quot;C:\JBoss-4.0.0&quot;<br />
    ${endif}  <br />
    Push $antHomeDir\bin<br />
    Call AddToPath<br />
    <br />
    ReadEnvStr $R0 &quot;PATH&quot;<br />
    StrCpy $R0 &quot;$R0;$antHomeDir\bin&quot;<br />
    System::Call 'Kernel32::SetEnvironmentVariableA(t, t) i(&quot;PATH&quot;, R0).r2'<br />
    <br />
    Push JBOSS_HOME<br />
    Push $jboss.home.dir<br />
    Call WriteEnvStr <br />
    <br />
    Push ANT_HOME<br />
    Push $antHomeDir<br />
    Call WriteEnvStr<br />
    <br />
    ReadEnvStr $R0 &quot;ANT_HOME&quot;<br />
    StrCpy $R0 &quot;$antHomeDir\bin&quot;<br />
    System::Call 'Kernel32::SetEnvironmentVariableA(t, t) i(&quot;PATH&quot;, R0).r2'<br />
    <br />
    call editCaTissueInstall.Properties<br />
    call editSqlConfigFiles<br />
    call editTextFilesAndLogo<br />
    <br />
    StrCpy $mySQLEXE &quot;$mySQLEXEbin\mysql.exe&quot;<br />
    detailPrint &quot;cmd /C $mySQLEXE -uroot -popen123 &lt; $databaseConfigFile&quot;<br />
    <br />
    nsExec::ExecToLog 'cmd /C IF 1==1 &quot;$mySQLEXE&quot; -uroot -p$databaseLoginPass &lt; $databaseConfigFile'<br />
    nsExec::ExecToLog 'cmd /C cd $INSTDIR'<br />
    nsExec::ExecToLog 'cmd /C $antHomeDir\bin\ant -f deploy.xml deploy_all_with_config'<br />
SectionEnd <br />
<br />
Am I doing anything wrong?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">madams</div><div class="date">24th July 2007, 20:51</div></div><div class="posttext">Nevermind, I made a stupid syntax error in the code above and everything works perfectly now. Thanks for all your help!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>