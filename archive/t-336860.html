<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Plugin with dependancies, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Plugin with dependancies NSIS Discussion" />
	
	<title> Plugin with dependancies [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Plugin with dependancies</div>
<hr />
<div class="pda"><a href="t-336860.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=336860">Plugin with dependancies</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">ginglese</div><div class="date">1st November 2011, 18:58</div></div><div class="posttext">Hi,<br />
<br />
i would like to create a nsis plugin to manage homemade stuff before installing my software.<br />
So i have created a project for a nsis plugin and build it.<br />
This plugin dll has some dependencies for Qt or homemade dll (for exemple).<br />
<br />
could it work ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">1st November 2011, 23:20</div></div><div class="posttext">You would have to put all DLL's that the plug-in DLL depends on into the same folder as the installer EXE (aka $EXEDIR) - not into the folder from where the plug-in DLL is loaded (aka $PLUGINSDIR). For details look at the Dynamic-Link Library Search Order (http://msdn.microsoft.com/en-us/library/windows/desktop/ms682586%28v=vs.85%29.aspx#search_order_for_desktop_applications). Anyway, I would recommend to link everything statically into plug-in DLL to avoid dependencies. Qt can be built as static lib. Check your plug-in DLL with Dependency Walker (http://www.dependencywalker.com/) to make sure it doesn't have any dependencies that could prevent it from loading correctly...<br />
<br />
(BTW: The dependency on the Visual C++ Runtime libraries is another problem. Thus I would recommend to build plug-in DLL's with the static Runtime. Either that or link them against the VC 6.0 Runtime library, aka MSVCRT.DLL, which ships with Windows)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">T.Slappy</div><div class="date">2nd November 2011, 06:53</div></div><div class="posttext">Read this article: http://nsis.sourceforge.net/Building_plug-ins_without_Microsoft_Visual_C_Run-Time_%28MSVCRT%29_dependency<br />
<br />
or this forum thread where my plug-in suffered with similar issues: http://forums.winamp.com/showthread.php?t=331275</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ginglese</div><div class="date">2nd November 2011, 07:37</div></div><div class="posttext">Hi,<br />
<br />
Thanks a lot for the returns.<br />
I will look at those links and post here how i handle things.<br />
<br />
Guillaume</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ginglese</div><div class="date">5th November 2012, 12:05</div></div><div class="posttext">Hi,<br />
<br />
Just for the record, here is how I handled it :<br />
I use the SetOutPath before using my plugin functions.<br />
<br />
ReserveFile &quot;${NSISDIR}\Plugins\MyPlugin.dll&quot;<br />
...<br />
<br />
SetOutPath $TEMP<br />
File &quot;MyPluginDependenciesDlls.dll&quot;<br />
File ... <br />
<br />
MyPlugin::myPluginFunction <br />
; get result<br />
pop $R2<br />
<br />
Guillaume</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">5th November 2012, 19:24</div></div><div class="posttext">I think SetOutPath will also change the &quot;current directory&quot;, which is why the DLL will be loaded from there. That's because the &quot;current directory&quot; is one of the directories that will be searched when loading a DLL (remember the Dynamic-Link Library Search Order (http://msdn.microsoft.com/en-us/library/windows/desktop/ms682586%28v=vs.85%29.aspx#search_order_for_desktop_applications)). However the directory where the installer executable is located will always be searched first. This could result in the wrong DLL being loaded! Furthermore loading DLL's from the &quot;current directory&quot; is discouraged, because it can result in security problems. That's why most applications will disable this behavior by calling SetDllDirectory(&quot;&quot;) nowadays. I think you would be best off by either avoiding DLL dependencies for plug-in DLL's or, if that isn't possible, let your plug-in DLL load the required DLL via LoadLibrary() and a full path. Your plug-in DLL could determine its own location (i.e. the installer's plug-ins directory) via GetModuleFileName() and then construct the path.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>