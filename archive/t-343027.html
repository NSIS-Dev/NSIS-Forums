<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Unicode: Replace TargetMinimalOS with?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Unicode: Replace TargetMinimalOS with? NSIS Discussion" />
	
	<title> Unicode: Replace TargetMinimalOS with? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Unicode: Replace TargetMinimalOS with?</div>
<hr />
<div class="pda"><a href="t-343027.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=343027">Unicode: Replace TargetMinimalOS with?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th March 2012, 18:36</div></div><div class="posttext">It has been decided that TargetMinimalOS is not going to be implemented at this time so we need a (new) instruction to toggle the creation of unicode installers.<br />
<br />
My suggestion is just: Unicode &lt; yes (default) | no &gt;<br />
<br />
Post your alternative instructions/syntax suggestions and we will vote on the final syntax if required.<br />
<br />
Thoughts and comments are also welcome...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">9th March 2012, 19:50</div></div><div class="posttext">Simpler is often better, so Unicode sounds good to me.<br />
<br />
http://nsis.sourceforge.net/Docs/Chapter4.html#4.8<br />
Current installer attributes use true/false or on/off. I'd say on/off is most suitable here, because unicode is not a small addition such as AllowRootDirInstall (true/false). Rather, it compiles to a completely different executable.<br />
<br />
But should there be only two options? Are there perhaps situations where a third option would be helpful/necessary?<br />
<br />
As for the default value, if the nsi wasn't saved as UTF8 (or other unicode formats), I'm thinking it might make sense to auto-switch back to ansi building for backwards compatibility. In such a case, 'unicode on' could still be used to force unicode building.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th March 2012, 20:06</div></div><div class="posttext">Current installer attributes use true/false or on/off. I'd say on/off is most suitable here, because unicode is not a small addition such as AllowRootDirInstall (true/false). Rather, it compiles to a completely different executable.<br />
<br />
IMHO true/false is better than on/off<br />
<br />
<br />
<br />
But should there be only two options? Are there perhaps situations where a third option would be helpful/necessary?<br />
<br />
No, this is a A vs W API thing, there will never be more options. Unless you mean auto...<br />
<br />
<br />
<br />
As for the default value, if the nsi wasn't saved as UTF8 (or other unicode formats), I'm thinking it might make sense to auto-switch back to ansi building for backwards compatibility. In such a case, 'unicode on' could still be used to force unicode building.<br />
I thought you wanted UTF8 files without BOM to be treated as UTF8 and not backwards compatible with older ansi scripts?<br />
<br />
<br />
I guess the following syntax would be possible:<br />
&lt;true | false | auto (default) &gt;<br />
Where auto uses unicode if the main .nsi has a BOM</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">9th March 2012, 20:23</div></div><div class="posttext">No, this is a A vs W API thing, there will never be more options. Unless you mean auto...<br />
Yeah, something like an auto mode. Your true/false/auto suggestion seems to cover it all.<br />
(Although there's no such thing as a semi-true boolean, so on/off/auto makes more sense to me than true/false/auto.)<br />
<br />
I thought you wanted UTF8 files without BOM to be treated as UTF8 and not backwards compatible with older ansi scripts?<br />
I was thinking about ansi scripts. UTF8 without BOM should definitely be compiled as unicode by default.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">redxii</div><div class="date">10th March 2012, 05:10</div></div><div class="posttext">SetEncoding &lt; ansi (default) | unicode &gt;<br />
<br />
I don't know if it handles/allows existing ansi plug-ins so they'll work in unicode, if there isn't maybe ansi should be default backward compatibility.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">10th March 2012, 06:57</div></div><div class="posttext">From chat:<br />
- NSIS Unicode will be NSIS v3.0. This has some consequences for backwards compatibility and defaults.<br />
- Distinguishing between ansi and UTF8 without BOM will probably not be coded any time soon. Again, consequences for defaults.<br />
<br />
My opinion at this point:<br />
If we can't easily recognize whether an nsi file saved as UTF-8 without BOM is intended for a unicode or an ansi installer, it seems we have two options: Either we default to ANSI for ascii/UTF8noBOM files and unicode for anything else, or we default to unicode across the whole line.<br />
<br />
If that's the choice, given that this is for NSIS v3.0, I vote for making it unicode. I think the number of people coding for unicode installers will (eventually) be higher than the number of newbies recompiling ancient nsi scripts meant for NSIS 2. And anyone making new installers with NSIS 3 should know what the difference is and should simply supply the proper attribute Unicode Off in the script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">10th March 2012, 11:56</div></div><div class="posttext">IMHO true/false is better than on/off<br />
<br />
better yes, but inconsistent with previous syntax</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">10th March 2012, 18:07</div></div><div class="posttext">SetEncoding &lt; ansi (default) | unicode &gt;<br />
<br />
<br />
The SetXYZ pattern should only be used by flags that can be changed at runtime. I'm also not sure if &quot;Encoding&quot; is specific enough...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pawel</div><div class="date">10th March 2012, 18:09</div></div><div class="posttext">I think this is good: &lt;true | false | auto (default) &gt;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">10th March 2012, 22:42</div></div><div class="posttext">The SetXYZ pattern should only be used by flags that can be changed at runtimeI think SetEncoding sounds better than Unicode &lt;true|false|...&gt; .</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">11th March 2012, 08:35</div></div><div class="posttext">The SetXYZ pattern should only be used by flags that can be changed at runtime.`<br />
That's not how it's been done in the past, though:  http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.2.4</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">11th March 2012, 17:34</div></div><div class="posttext">That's not how it's been done in the past, though:  http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.2.4<br />
<br />
That is true, but those instructions are really old and we cannot change them now...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th March 2012, 18:52</div></div><div class="posttext">How about UnicodeInstall.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">11th March 2012, 19:55</div></div><div class="posttext">How about UnicodeInstall.<br />
<br />
Will this not be confusing? What about the uninstaller?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">11th March 2012, 21:24</div></div><div class="posttext">I don't think it would be confusing. Aren't BrandingText, AutoCloseWindow, etc, also shared with the uninstaller? They're still called Installer attributes. In fact, it doesn't mention an uninstaller' even in the intro of chapter 4.8.1. http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.1</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">11th March 2012, 22:50</div></div><div class="posttext">I don't see much reason to not use Unicode these days :)<br />
<br />
Even good old Windows 2000 did support the Unicode Win32 API functions. But, as Windows 2000 isn't maintained anymore (and thus won't get any security fixes), using it nowadays is a severe security problem! Not to speak about even older Windows versions! Consequently we can assume 99.9% of all users are on Windows XP or newer these days. The remaining 0.1% is Windows 2000 maybe. So, if we really need a switch to disable &quot;Unicode support&quot;, it should probably be called ForceWin9xCompatibility &lt;true|false(default)&gt; or something like that. And the manual should highly discourage its use (like &quot;Use this only, if you really need Win9x compatibility!&quot;). Or are there any other sane reasons, except Win9x compatibility, why anybody may want to disable Unicode support nowadays?<br />
<br />
BTW: I don't know which compiler you use to create the NSIS stubs, but if you use MSVC2010, the binaries won't even run on Windows 2000. They certainly won't run on Win9x, which makes any compatibility options for Win9x pointless then. If you stick with MSVC2008, then Windows 2000 is still supported, but that one certainly doesn't need the No-Unicode workaround. I have no idea what the last MSVC was that still supported Win9x. But unless you plan to stick with that old MSVC forever, Win9x compatibility switches become pointless...<br />
<br />
(The next MSVC won't even support Windows XP anymore :cry:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">12th March 2012, 00:11</div></div><div class="posttext">i agree with lord moulder and i think it's clear that a platform should only use the kind of software that was made to support it. that software can likely be installed already and in any other can use a nsis version that supports it. there's no need to support all of the platforms (like i haven't heard of nsis working on dec alpha)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">12th March 2012, 02:45</div></div><div class="posttext">BTW: I don't know which compiler you use to create the NSIS stubs, but if you use MSVC2010, the binaries won't even run on Windows 2000. They certainly won't run on Win9x, which makes any compatibility options for Win9x pointless then. If you stick with MSVC2008, then Windows 2000 is still supported, but that one certainly doesn't need the No-Unicode workaround. I have no idea what the last MSVC was that still supported Win9x. But unless you plan to stick with that old MSVC forever, Win9x compatibility switches become pointless...<br />
<br />
<br />
We support VC6+, MinGW and cross compiling on POSIX and VC6 is our preferred compiler but this thread has nothing to do with which compiler is used for the stubs, we simply need to figure out what the syntax in the .nsi should look like. (We will provide stubs and plugins for ansi and unicode)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">12th March 2012, 03:45</div></div><div class="posttext">Well, I think this is an important point that should be considered here. The one and only reason to add an option to disable Unicode support (once Unicode is supported in an official NSIS release) would be backward-compatibility to older OS' that didn't provide the required Unicode API. This would be the Windows 9x series then, I guess. But adding backward-compatibility options for an &quot;old&quot; OS to NSIS is completely pointless, if the compiler (the one used for the stubs) doesn't generate code compatibility with that &quot;old&quot; OS anyway. Consequently by dropping support for the Windows 9x platform, we could kill two birds with one stone: There would be no need for adding the &quot;Unicode&quot; compatibility option anymore and we wouldn't have to stick with an outdated compiler (e.g. VC 6) for the stubs.<br />
<br />
And again: While support for Windows 9x is completely meaningless these days, even the need for Windows 2000 support is questionable. But if we decide that Windows 2000 should still be supported (which I think we should do!), then not Unicode support is the problem (Windows 2000 does support it just fine), but the lack of an up-to-date compiler that still supports this platform is the biggest problem...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">12th March 2012, 04:51</div></div><div class="posttext">...and we wouldn't have to stick with an outdated compiler (e.g. VC 6) for the stubs.<br />
<br />
<br />
The stubs (and most of the plugins) are written in plain C and don't use the CRT so what do you hope to gain by updating the compiler? (Not even VS11 has full C99 support) Not only do you gain nothing, MS are actually dropping support for some of the switches we use to generate smaller files (/OPT:NOWIN98, filealign etc)<br />
<br />
<br />
I don't think we are ready to drop the ansi support just yet, this means we will need a keyword to toggle unicode. If you think ansi support is pointless, just save your files as UTF16LE and pretend that the other mode does not exist...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">redxii</div><div class="date">12th March 2012, 04:53</div></div><div class="posttext">How much actively developed software distributed with NSIS even still support Win9x/NT4? What good is it that the installer still supports Win9x/NT4 when the market share is virtually nil along with the amount of active software that still support those platforms.<br />
<br />
I guess that's a better idea. Drop ANSI/Win9x/NT4, go Unicode only. If you are still making software for Win9x/NT4 you can stick with the latest 2.x.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pawel</div><div class="date">12th March 2012, 19:08</div></div><div class="posttext">I would say, there should be NSIS 3.0 that supports only Windows XP+, fully Unicode.<br />
And I agree with above posts. Drop ANSI/Win9x/NT4 support. Leave it in NSIS 2.4x line.<br />
But, if this is not possible, making ANSI and Unicode in one package is not bad idea... but I think it need much more work.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">12th March 2012, 20:04</div></div><div class="posttext">But, if this is not possible, making ANSI and Unicode in one package is not bad idea... but I think it need much more work.<br />
<br />
The code in SVN already produces ansi and unicode stubs and plugins when you build, there is no extra work that needs to be done...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">12th March 2012, 20:11</div></div><div class="posttext">Unicode true | false | auto (default)that's what i'd prefer to see as it seems to best cover what would appear in compiles attempted be if from those who have remained using the official release or moved over to the unicode release.<br />
<br />
i know there's all this talk about ansi being pointless, but i still think it has it's place for things like specific internal installers or even uber simple ones or those that must rely on older plug-ins for specific features to work. yes i know someone is going to bring up the paths issue but it's no more different than what was the case in the years before the unicode fork appeared and things generally worked ok then anyway (am sure i'll be pointed at something if that is wrong).<br />
<br />
yes i know that unicode is the way and i'm not disagreeing with that at all but it still seems reasonable to support things as can and if people are willing to work on it then it's their time that they're spending on it so what does it really matter?<br />
<br />
and really, all i want to see is a consistent official release without some of the hacks and fragmentation which has been caused by the unicode fork.<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Koopa</div><div class="date">12th March 2012, 23:12</div></div><div class="posttext">I would say, there should be NSIS 3.0 that supports only Windows XP+, fully Unicode.<br />
And I agree with above posts. Drop ANSI/Win9x/NT4 support. Leave it in NSIS 2.4x line.<br />
But, if this is not possible, making ANSI and Unicode in one package is not bad idea... but I think it need much more work.<br />
+1<br />
<br />
I'd drop ANSI in 3.0 as well, as I'd drop support for operating systems &lt; XP.<br />
Win 2000 doesn't get any security related update anymore and for those people, who still depend on these systems, you still provide 2.4x related updates for some time. I guess all agree, that the whole Win9x line isn't worth to be mentioned anymore.. <br />
<br />
Unicode is the future, ANSI simply the past, but I'd may agree with an ANSI/Unicode hybrid package, because it will take some time, until the majority of the NSIS plugins are available as Unicode version unless you find another way to make those plugins available in Unicode NSIS.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pawel</div><div class="date">12th March 2012, 23:21</div></div><div class="posttext">Wow, Koopa, you just wrote it so clearly and nice :D<br />
I hope Anders and other NSIS magicians will make NSIS alive soon. This is my favourite<br />
software. <br />
<br />
Btw, Anders, if you need any help I am ready (not necessarily with programming, but help system, graphics is what I can do).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">12th March 2012, 23:28</div></div><div class="posttext">+1<br />
<br />
I'd drop ANSI in 3.0 as well, as I'd drop support for operating systems &lt; XP.<br />
Win 2000 doesn't get any security related update anymore and for those people, who still depend on these systems, you still provide 2.4x related updates for some time. I guess all agree, that the whole Win9x line isn't worth to be mentioned anymore.. <br />
<br />
Unicode is the future, ANSI simply the past, but I'd may agree with an ANSI/Unicode hybrid package, because it will take some time, until the majority of the NSIS plugins are available as Unicode version unless you find another way to make those plugins available in Unicode NSIS.<br />
<br />
There is not much reason to drop NSIS support for Windows 2000 yet. If your software doesn't run on Windows 2000, it's MUCH better to have your installer exit cleanly with a &quot;Sorry, this software doesn't run on Windows 2000&quot; than having it crash/fail with a &quot;Not a valid Win32 executable!&quot; And yes, some people are still using Windows 2000. Also keep in mind that Unicode is supported on Windows 2000 just fine. It's Windows 9x (and maybe NT 4.0) that didn't support Unicode! So, in my opinion, we should drop ANSI support in NSIS 3.0 along with any Windows 9x support, but keep the Windows 2000 support for now. If there was a reason to drop Windows 2000, then this would be compiler incompatibility. But Anders said that they currently prefer VC6, so this doesn't seem to be an issue ^^</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">1st June 2012, 06:48</div></div><div class="posttext">Somebody is working on a x64 fork, this means we would need a setting to control that as well. I'm not sure if it is a good idea but I'll throw it out there anyway; a general &quot;target&quot; property.<br />
<br />
Target &lt;x86|amd64|ansi|unicode&gt; [...]<br />
<br />
so<br />
Target ansi = Similar to 2.46<br />
Target unicode == Target x86 unicode<br />
Target amd64 == Target unicode amd64 <br />
<br />
(&quot;Target amd64 ansi&quot; is not a valid combination, x64 will always be unicode)<br />
<br />
Possible problems:<br />
*&quot;Unicode auto&quot; mode would probably not be supported because I don't know how the syntax for that would look<br />
*.nsi files would be harder to parse (Not for makensis but for external things like batch files etc)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">1st June 2012, 09:30</div></div><div class="posttext">Afrow's UnicodeInstall attribute comes to mind again. UnicodeInstall and x64Install? Using the latter would then automatically mean unicodeinstall is enabled. This would also prevent the use of an illegal x64/ansi combination.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Damian Kohlfeld</div><div class="date">8th June 2012, 15:19</div></div><div class="posttext">Definitely release a new version, and soon.  So many people think this project is dead weight.  A lot of other installer projects popping up, a new version like a 3.0, etc would bolster this project in a major way and would really help to sway developers looking to get away from the typical garbage.  I almost didn't go NSIS when I saw 2009 as the last revision.  Now, I've very glad to be here.<br />
<br />
As far as unicode, yes yes yes.  But, support win2k, perhaps in a separate branch, whatever.  Most Microsoft developers are .NET now and .NET 2.0 runs on win2k.  That is actually a REALLY big deal.  I have several customers who are running my code on some ancient win2k servers which are virtual machines.  So, I'm still building against the 2.0sp1 framework all day long.  Which is a major shame because I've never touched LINQ yet, but, I love what I'm seeing.  The final straw for me will be the Parallel MultiCore featureset in 4.5.  Now, with 8 core AMD's, I cannot handle the limited multicore support in .net 2.0, so I'm ready for a jump, and a version jump in NSIS would be awesome to go along with my jump from .Net 2...<br />
<br />
Unicode is going to also bring on a bunch of newb's because unicode demand is really strong now, almost everything I do now is unicode only.  <br />
<br />
I say if you can make it run on win2k, great, if not, make the min winxp, and setup a branch for win2k and earlier.  Then the community of people writing for 98, ME, etc can provide the support to handle bug fixes, etc, on the 98/me possibly win2k branch.  <br />
<br />
Sorry for the long winded post, writing a lot of ASM today all NASM, 64bit, dreading it, only know 32bit, anyway, thanks,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">8th June 2012, 17:09</div></div><div class="posttext">As far as unicode, yes yes yes.  But, support win2k, perhaps in a separate branch, whatever. The exehead stubs are already using TCHAR and the minimum target is NT4 or 2000, the hold up is the compiler, not the code running on the end-users system...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JamesB7</div><div class="date">22nd June 2012, 16:21</div></div><div class="posttext">I like your original suggestion &quot;Unicode yes/no&quot;.<br />
Unicode support wouldn't hurt for software that requires an NT OS, though I have to admit I haven't felt a great need for the feature. From my perspective, built-in timestamp+code sign for installer/uninstaller would be handier. I do it with conditionals and a batch file presently...<br />
<br />
Please don't break compatibility with Windows 9X.<br />
If you already have the code there, there is no technical reason.<br />
It'd require me to keep two versions of NSIS. Older software still needs patches/support, and honestly, any decent developer should make their software run on the widest range of Windows versions compatible with their economics. Don't force my users to upgrade for an installer's sake of all things. Even new software, if it doesn't *need* a recent OS feature, why *choose to fail*?<br />
<br />
For those talking about &quot;even Win2K doesn't work in VS2010&quot;, Google EncodePointer Win2K and see for yourself how trivial the fix is.<br />
<br />
I'd encourage you to ignore those with an upgrade fetish.<br />
<br />
Lastly, Damien, for .NET... My Mono 2.10.8 install, it doesn't seem to have an EncodePointer dependency so probably runs on Windows 2000. Mono for Windows works quite well and lacks the conflicts of interest that cause .NET's minimum OS to keep going up and up. You can fit the necessary runtime for a WinForms application in about 4MB compressed, and won't even need admin access as the executables are relocatable and do not use registry entries.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">22nd June 2012, 16:35</div></div><div class="posttext">Please don't break compatibility with Windows 9X.<br />
<br />
<br />
We will break 9x compatibility...for makensis.exe (because this thread really is about the compiler). It will be Win2000+ probably.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JamesB7</div><div class="date">22nd June 2012, 16:41</div></div><div class="posttext">Oh ok, my bad, I'd thought you were discussing the resulting executables. :)<br />
On the compiler side, yeah, seems unlikely anyone is still *developing* from a 9X machine.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">22nd June 2012, 19:18</div></div><div class="posttext">btw, would be interesting to get some insights on the usage stats. do you run any sort of analytics software on the nsis website?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">22nd June 2012, 19:45</div></div><div class="posttext">btw, would be interesting to get some insights on the usage stats. do you run any sort of analytics software on the nsis website?<br />
<br />
Stats of what? The admins have access to Piwik. There are public download and commit stats on SF...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>