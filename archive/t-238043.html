<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Deleting &quot;Application Data&quot; from Multiple Users during Uninstall?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Deleting &quot;Application Data&quot; from Multiple Users during Uninstall? NSIS Discussion" />
	
	<title> Deleting &quot;Application Data&quot; from Multiple Users during Uninstall? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Deleting &quot;Application Data&quot; from Multiple Users during Uninstall?</div>
<hr />
<div class="pda"><a href="t-238043.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=238043">Deleting &quot;Application Data&quot; from Multiple Users during Uninstall?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">MankyD</div><div class="date">14th February 2006, 18:06</div></div><div class="posttext">The program I am installing creates a folder in each individual user's &quot;application data&quot; directory when the user runs the app.  I'm wondering if there is a way to find every &quot;application data&quot; folder that the app created and remove it when I run the NSIS uninstaller (running with admin priviledges, of course.)<br />
<br />
As an addendum to that question, does anyone know if you could do a partial uninstall - only remove shortcuts and application  data for each individual user rather than everyone.  Then, when the last person to have the program uinstalls it, remove everything?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th February 2006, 19:27</div></div><div class="posttext">Either create a list (INI file or registry) of all application data dirs created on install, and read the list (ReadINI/RegString) on uninstall.<br />
Another option is to create a unique file in any application data dirs created by the installer (with FileOpen, FileWrite, FileClose) and delete those dirs that contain the unique file on uninstall (check if the file exists with IfFileExists).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th February 2006, 20:35</div></div><div class="posttext">You can also get every folder with EnumUsersReg (http://nsis.sourceforge.net/EnumUsersReg) and HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders. Actually, EnumUsersReg even shows you how to get the profile directories list (SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MankyD</div><div class="date">14th February 2006, 21:19</div></div><div class="posttext">I've come up with a first attempt at a solution (haven't tried kichik's method, but I'll check it out, thanks!)  Sorry if this problem/solution seems a bit ameteur, I just started NSIS yesterday:<br />
<br />
<br />
        FindFirst $0 $1 &quot;c:\documents and settings\*&quot;<br />
        loop:<br />
          StrCmp $1 &quot;&quot; done<br />
          StrCmp $1 &quot;.&quot; continue<br />
          StrCmp $1 &quot;..&quot; continue<br />
<br />
          RMDir /r /REBOOTOK &quot;c:\documents and settings\$1\Application Data\my_program&quot;<br />
<br />
        continue:<br />
          FindNext $0 $1<br />
          Goto loop<br />
        done:<br />
<br />
<br />
I hope to have a per-user uninstall option setup next.  Thanks again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MankyD</div><div class="date">14th February 2006, 22:00</div></div><div class="posttext">kichik's method worked great except for one small catch:<br />
<br />
<br />
<br />
Section &quot;un.install&quot;<br />
...<br />
        ${EnumUsersReg} un.EraseAppDataCB temp.key<br />
...<br />
<br />
SectionEnd<br />
<br />
Function &quot;un.EraseAppDataCB&quot;<br />
         Pop $0<br />
         ReadRegStr $0 HKU &quot;$0\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders&quot; &quot;AppData&quot;<br />
         RMDir /r /REBOOTOK &quot;$0\my_program&quot;<br />
FunctionEnd<br />
<br />
<br />
You have to edit EnumUsersReg (http://nsis.sourceforge.net/EnumUsersReg) in order to enable it to work during the uninstallation proceess (as opposed to during the install process.)  Simply add &quot;un.&quot; in front of &quot;_EnumUsersReg&quot; on lines 73 and 82.  A better solution would probably be to create a second version of the macro specifically for uninstall purposes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">15th February 2006, 00:34</div></div><div class="posttext">MankyD,<br />
Your first solution of sweeping through the &quot;C:\Documents and settings&quot; folder won't always work.  The PC may not have a &quot;C&quot; drive, or the person setting up the users may have chosen a differnt location for each user's home appdata directory.  <br />
<br />
The EnumUsersReg suggestion is a more fool-proof solution.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>