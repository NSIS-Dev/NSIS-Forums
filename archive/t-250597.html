<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Converting UNC to local path, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Converting UNC to local path NSIS Discussion" />
	
	<title> Converting UNC to local path [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Converting UNC to local path</div>
<hr />
<div class="pda"><a href="t-250597.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=250597">Converting UNC to local path</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">zorphnog</div><div class="date">7th July 2006, 15:31</div></div><div class="posttext">I am looking for a way to convert a UNC path to a local path. The UNC path is for the local machine that is running the installer. I am prompting the user for a directory using \\$HOSTNAME as the root, where $HOSTNAME is the name of the machine. I am prompting this way because I want to ensure that the user chooses a shared folder. I can use the UNC path for all of my NSIS script, however I also need the local path translation for configuring something installed.<br />
<br />
Are there any functions to translate UNC to local paths? Possible registry keys or system files with UNC/local path mapping? Any insights would be greatly appreciated.<br />
<br />
The target systems are Windows Server 2003.<br />
Currently using NSIS v2.17.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">7th July 2006, 16:25</div></div><div class="posttext">Hi!<br />
<br />
Thats not the best way, but it is very easy:<br />
<br />
Use &quot;net share&quot; and analyze the output.<br />
<br />
-Bruno.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vitoco</div><div class="date">7th July 2006, 16:41</div></div><div class="posttext">You can try one of the methods mentioned on http://forums.winamp.com/showthread.php?threadid=206888<br />
<br />
I would use:<br />
nsExec::ExecToStack 'NET SHARE MyShare'<br />
then capture the access path from the stack, and use some string manipulation to turn \\$HOSTNAME\MyShare from $INSTDIR into $AccessPath.<br />
<br />
If you write such a function, could you share it?<br />
<br />
++Vitoco</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zorphnog</div><div class="date">7th July 2006, 16:55</div></div><div class="posttext">Thanks for the suggestions. I'm working on a function now. Will post when done.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zorphnog</div><div class="date">7th July 2006, 19:15</div></div><div class="posttext">Originally posted by vitoco <br />
If you write such a function, could you share it?<br />
<br />
<br />
Here's a solution that works for me so far. You need to have $HOSTNAME and $sharePath set before calling the function. HOSTNAME is the local machine name and sharePath is a UNC path for your local machine.<br />
<br />
<br />
!include WordFunc.nsh<br />
!include FileFunc.nsh<br />
<br />
!insertmacro GetRoot<br />
!insertmacro WordFind<br />
<br />
Var HOSTNAME<br />
Var sharePath<br />
Var shareFolder<br />
Var shareLP<br />
<br />
Section<br />
  ...<br />
  ReadRegStr $0 HKLM &quot;SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName&quot; ComputerName<br />
  StrCpy $HOSTNAME $0<br />
  StrCpy $sharePath &quot;\\$HOSTNAME\Your\Share\Folder\Path&quot;<br />
  call UNCtoLP<br />
  ...<br />
SectionEnd<br />
<br />
Function UNCtoLP<br />
<br />
  ${GetRoot} $sharePath $0  ;Gets the share root (eg. \\$HOSTNAME\Your)<br />
  StrCpy $1 &quot;\\$HOSTNAME\&quot;<br />
  StrLen $2 $1<br />
  StrCpy $shareFolder $0 &quot;&quot; $2 ;Concat \\$HOSTNAME\ from our root path<br />
<br />
  nsExec::ExecToStack 'net share &quot;$shareFolder&quot;' ;Get net share output<br />
  Pop $0 ;Return code<br />
  Pop $1 ;Exec output<br />
  StrCmp $0 0 +3<br />
    MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Could not map the share folder to local path.&quot;<br />
    Abort<br />
<br />
  ;parse exec output<br />
  ${WordFind} $1 &quot;Path              &quot; &quot;-01&quot; $R0<br />
  ${WordFind} $R0 &quot;$\r$\n&quot; &quot;+01&quot; $shareLP<br />
<br />
FunctionEnd<br />
<br />
<br />
Hope that helps. Oh yeah, the result is stored in shareLP.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">catpoopjb7</div><div class="date">13th November 2008, 00:33</div></div><div class="posttext">you can use GetTempFileName() as follows:<br />
<br />
<br />
char buf[MAX_PATH];<br />
GetTempFileName(&quot;\\\\hostname\\share&quot;,&quot;prefix&quot;,0,buf); <br />
DeleteFile(buf);<br />
<br />
<br />
the full path name of the temporary file returned in [buf] contains the local path name for the share; just strip off the filename.ext from the end. (this works on WIN32; i dont know about vista(r)).</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>