<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Mui problem, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Mui problem NSIS Discussion" />
	
	<title> Mui problem [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Mui problem</div>
<hr />
<div class="pda"><a href="t-278169.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=278169">Mui problem</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">l0k1</div><div class="date">1st October 2007, 11:09</div></div><div class="posttext">Hi, can you help me with this one :<br />
<br />
When i use MUI_PAGE_FINISH i get <br />
<br />
resolving install function &quot;Nsis2Io&quot; in function &quot;mui.FinishPre_159.5.9&quot;<br />
Note: uninstall functions must begin with &quot;un.&quot;, and install functions must not<br />
Error - aborting creation process<br />
<br />
on compilation<br />
<br />
Here's the code :<br />
<br />
;<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
;Languages selection<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
;<br />
!ifdef LANG_EN<br />
    !include &quot;lang_en.nsh&quot;<br />
    !InsertMacro MUI_LANGUAGE &quot;English&quot;<br />
    LicenseLangString license ${LANG_ENGLISH} &quot;..\..\lic\license_en.txt&quot;<br />
!EndIf<br />
!ifdef LANG_FR<br />
    !include &quot;lang_fr.nsh&quot;<br />
    !InsertMacro MUI_LANGUAGE &quot;French&quot;<br />
    LicenseLangString license ${LANG_FRENCH} &quot;..\..\lic\license_fr.txt&quot;<br />
!EndIf<br />
!ifdef LANG_ES<br />
    !include &quot;lang_es.nsh&quot;<br />
    !InsertMacro MUI_LANGUAGE &quot;Spanish&quot;<br />
    LicenseLangString license ${LANG_SPANISH} &quot;..\..\lic\license_sp.txt&quot;<br />
!EndIf<br />
;<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
;Interface Configuration for pages and executables<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
;<br />
; UAC Vista<br />
 RequestExecutionLevel Admin<br />
;The icon for the installer.<br />
!IfDef MUI_ICON<br />
    !UnDef MUI_ICON<br />
!EndIf<br />
!Define MUI_ICON &quot;..\..\bmp\icon_16x16.ico&quot;<br />
;The icon for the uninstaller.<br />
!IfDef MUI_UNICON<br />
    !UnDef MUI_UNICON<br />
!EndIf<br />
!Define MUI_UNICON &quot;..\..\bmp\icon_16x16.ico&quot;<br />
;Display settings<br />
;!Define MUI_HEADERIMAGE<br />
;Bitmap image to display on the header of installers pages.<br />
!Define MUI_HEADERIMAGE_BITMAP &quot;..\..\bmp\install_haut_nsis.bmp&quot;<br />
;Do not stretch the installer header bitmap to fit the size of the field.<br />
!Define MUI_HEADERIMAGE_BITMAP_NOSTRETCH<br />
;Bitmap image to display on the header of uninstaller pages.<br />
!Define MUI_HEADERIMAGE_UNBITMAP &quot;..\..\bmp\install_haut_nsis.bmp&quot;<br />
;Do not stretch the uninstaller header bitmap to fit the size of the field.<br />
!Define MUI_HEADERIMAGE_UNBITMAP_NOSTRETCH<br />
;Show a message box with a warning when the user wants to close the installer.<br />
!Define MUI_ABORTWARNING<br />
;Set the Cancel button as the default button on the message box.<br />
!Define MUI_ABORTWARNING_CANCEL_DEFAULT<br />
;Show a message box with a warning when the user wants to close the uninstaller.<br />
!Define MUI_UNABORTWARNING<br />
;Set the Cancel button as the default button on the message box.<br />
!Define MUI_UNABORTWARNING_CANCEL_DEFAULT<br />
;<br />
!Define MUI_LANGDLL_REGISTRY_ROOT &quot;HKCU&quot; <br />
!Define MUI_LANGDLL_REGISTRY_KEY &quot;Software\${EDITOR_NAME}\${PRODUCT_NAME}&quot; <br />
!Define MUI_LANGDLL_REGISTRY_VALUENAME &quot;Language&quot; <br />
;<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
;Install Pages<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
;<br />
;Welcome Page<br />
    !Include &quot;WelcomePage.nsh&quot;<br />
    !Define MUI_PAGE_CUSTOMFUNCTION_PRE GetPreRequisites<br />
    !IfDef MUI_WELCOMEFINISHPAGE_BITMAP<br />
        !UnDef MUI_WELCOMEFINISHPAGE_BITMAP<br />
    !EndIf<br />
    !Define MUI_WELCOMEFINISHPAGE_BITMAP &quot;..\..\bmp\install_gauche_nsis.bmp&quot;<br />
    !Define MUI_WELCOMEFINISHPAGE_BITMAP_NOSTRETCH<br />
    !InsertMacro MUI_PAGE_WELCOME<br />
;License Page<br />
!InsertMacro MUI_PAGE_LICENSE $(license)<br />
;Detect Page<br />
    !Include &quot;DetectPage.nsh&quot;<br />
    Page custom CreatorDetectPage LeaveDetectPage<br />
;Authenticate Page<br />
!ifdef AuthenticateUser<br />
    ;!Define MUI_PAGE_CUSTOMFUNCTION_LEAVE SaveEMail<br />
    !Include &quot;AuthenticateUserPage.nsh&quot;<br />
    Page custom AuthenticateUser SaveEMail<br />
!EndIf<br />
;!InsertMacro MUI_PAGE_DIRECTORY<br />
;Start menu Page<br />
    !Include &quot;StartMenuPage.nsh&quot;<br />
    ;The default Start Menu Folder.<br />
    !Define MUI_STARTMENUPAGE_DEFAULTFOLDER &quot;${PRODUCT_NAME}&quot;<br />
    ;The registry keys to store the Start Menu folder<br />
    !Define MUI_STARTMENUPAGE_REGISTRY_ROOT HKCU<br />
    !Define MUI_STARTMENUPAGE_REGISTRY_KEY &quot;Software\${EDITOR_NAME}\${PRODUCT_NAME}&quot;<br />
    !Define MUI_STARTMENUPAGE_REGISTRY_VALUENAME &quot;Start Menu Folder&quot;<br />
    !Define MUI_PAGE_CUSTOMFUNCTION_PRE DeletePreviousShortcuts <br />
    !InsertMacro MUI_PAGE_STARTMENU &quot;Application&quot; $STARTMENU_FOLDER<br />
;Install Files Page<br />
!InsertMacro MUI_PAGE_INSTFILES<br />
;Finish Page<br />
    !Include &quot;FinishPage.nsh&quot;<br />
    !Define MUI_PAGE_CUSTOMFUNCTION_PRE PreFinish<br />
    !Define MUI_PAGE_CUSTOMFUNCTION_SHOW ShowFinish<br />
    !Define MUI_PAGE_CUSTOMFUNCTION_LEAVE LeaveFinish<br />
    !Define MUI_FINISHPAGE_RUN &quot;$INSTDIR\${PRODUCT_NAME}.exe&quot;<br />
    !InsertMacro MUI_PAGE_FINISH<br />
    <br />
Here's the code of the customized finish page :<br />
<br />
################################################################################<br />
#                                  FINISHPAGE                                  #<br />
################################################################################<br />
;<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
;install Finish Page functions<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
;<br />
Function PreFinish<br />
; Description : load et show interface    <br />
; Parameters : none<br />
    !InsertMacro MUI_INSTALLOPTIONS_READ $R0 &quot;ioSpecial.ini&quot; &quot;Settings&quot; &quot;NumFields&quot;<br />
    IntOp $R0 $R0 + 1<br />
    ;update fields count<br />
    !InsertMacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;Settings&quot; &quot;NumFields&quot; &quot;$R0&quot;<br />
    ;Add Desktop Shortcut checkbox<br />
    !InsertMacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;Field $R0&quot;  &quot;Type&quot;   &quot;CheckBox&quot;<br />
    !InsertMacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;Field $R0&quot;  &quot;Text&quot;   &quot;$(txtCreateDesktopShortcut)&quot;<br />
    !InsertMacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;Field $R0&quot;  &quot;Left&quot;   &quot;120&quot;<br />
    !InsertMacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;Field $R0&quot;  &quot;Right&quot;  &quot;315&quot;<br />
    !InsertMacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;Field $R0&quot;  &quot;Top&quot;    &quot;150&quot;<br />
    !InsertMacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;Field $R0&quot;  &quot;Bottom&quot; &quot;160&quot;<br />
    !InsertMacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;Field $R0&quot;  &quot;State&quot;  &quot;1&quot;<br />
FunctionEnd<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
Function ShowFinish<br />
; Description : Checks if Windows version is Vista and hide checkbox Launch EXE    <br />
; Parameters : none<br />
    xtInfoPlugin::GetWindowsVersion<br />
    Push &quot;5.99999&quot;<br />
    xtInfoPlugin::CompareVersion<br />
    Pop $0<br />
    ${If} $0 == &quot;-1&quot;<br />
        ;Get windows<br />
        ;FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
        ;Get start program checbox control<br />
        GetDlgItem $2 $MUI_HWND &quot;1203&quot; <br />
        ;Uncheck it<br />
        SendMessage $2 ${WM_LBUTTONDOWN} 0 0<br />
        SendMessage $2 ${WM_LBUTTONUP} 0 0<br />
        ;Hide it<br />
        ShowWindow $2 ${SW_HIDE}  <br />
    ${EndIf}<br />
FunctionEnd<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
Function LeaveFinish<br />
; Description : Read checkboxes and execute (or not) <br />
;               - Shortcut creation <br />
;               - launch .Exe  <br />
;               Send message to Server (end install) <br />
; Parameters : none<br />
    !InsertMacro MUI_INSTALLOPTIONS_READ $R0 &quot;ioSpecial.ini&quot; &quot;Settings&quot; &quot;NumFields&quot;<br />
    !InsertMacro MUI_INSTALLOPTIONS_READ $R0 &quot;ioSpecial.ini&quot; &quot;Field $R0&quot; &quot;State&quot;<br />
    StrCmp $R0 &quot;0&quot; ENDCREATESHORTCUT CREATESHORTCUT<br />
CREATESHORTCUT:<br />
    CreateShortCut &quot;$DESKTOP\${PRODUCT_NAME}.lnk&quot; &quot;$INSTDIR\${PRODUCT_NAME}.exe&quot;  &quot;&quot; &quot;$INSTDIR\${PRODUCT_NAME}.exe&quot; 0<br />
    WriteRegDWORD HKCU &quot;Software\${EDITOR_NAME}\${PRODUCT_NAME}&quot; &quot;desktopshortcut&quot; &quot;1&quot;<br />
ENDCREATESHORTCUT:<br />
    WriteRegDWORD HKCU &quot;Software\${EDITOR_NAME}\${PRODUCT_NAME}&quot; &quot;desktopshortcut&quot; &quot;0&quot;<br />
SENDFINISHTOSERVER: ;Send request to server<br />
    !InsertMacro MUI_INSTALLOPTIONS_READ $R0 &quot;ioSpecial.ini&quot; &quot;Field 4&quot; &quot;State&quot;<br />
    IntOp $R0 2 - $R0<br />
    Push &quot;URL_ENDINSTALL&quot;<br />
    !InsertMacro SetUrlMessage $R0<br />
    Pop $0<br />
    inetc::get &quot;$0&quot; &quot;$TEMP\End.txt&quot;<br />
    Pop $0<br />
    StrCmp $0 &quot;OK&quot; SENDFINISHOK<br />
SENDFINISHERR:<br />
SENDFINISHOK:<br />
    DELETE &quot;$TEMP\End.txt&quot;<br />
FunctionEnd<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
<br />
I've seen one recent previous post with similar error but the guy changes his code and doesn't reproduce it. I wonder what i'm doing wrong or if there's a bug in MUI ?<br />
<br />
thx.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">l0k1</div><div class="date">1st October 2007, 16:07</div></div><div class="posttext">I've found the solution. It's just that i miss the right order of includes (Languages selection after Install Pages and not before)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>