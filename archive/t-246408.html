<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Using DLL's, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Using DLL's NSIS Discussion" />
	
	<title> Using DLL's [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Using DLL's</div>
<hr />
<div class="pda"><a href="t-246408.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=246408">Using DLL's</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">RyanC</div><div class="date">18th May 2006, 01:06</div></div><div class="posttext">Hi,<br />
<br />
I'm trying to use the XZip.dll which lets you add and delete files from a zip archive which is what I need to do.<br />
<br />
http://xstandard.com/printer-friendly.asp?id=C9891D8A-5390-44ED-BC60-2267ED6763A7<br />
<br />
I'm using it fine with visual basic, but I'm trying to get it to work in the nullsoft installer.<br />
<br />
In visual basic I told the dll to do something such as:<br />
objZip.Delete &quot;path/file&quot;, &quot;\zipfile.zip&quot;<br />
<br />
Is there anyway to do something similar in the nullsoft installer? The only other option I can find is to use the 7za.exe command line style but I would rather not do this.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th May 2006, 09:14</div></div><div class="posttext">You could probably call the dll functions with the System plugin.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RyanC</div><div class="date">18th May 2006, 12:07</div></div><div class="posttext">I've been looking at that and I am totaly confused.<br />
<br />
I'm trying something like:<br />
<br />
  StrCpy $0 &quot;$INSTDIR\file&quot;<br />
  StrCpy $1 &quot;$INSTDIR\zip&quot;<br />
  StrCpy $2 &quot;True&quot;<br />
  StrCpy $3 &quot;file/path/in/zip&quot;<br />
  System::Call 'XZip::Pack(i, *i, t) i(r0, r1, r2, r3) .r4'<br />
<br />
But I really have no idea what I am doing, and the documentation does not make sense to me</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">18th May 2006, 12:30</div></div><div class="posttext">Hi RyanC,<br />
After reading the link that you provided for the command that you want to execute:Method Sub Pack(sFilePath As String, sArchive As String, [bStorePath As Boolean = False], [sNewPath As String], [lCompressionLevel As Long = -1])<br />
Add file or folder to an archive. Compression level 1 is minimum, level 9 is maximum, all other values default to level 6.<br />
I think that your call should look like this:<br />
StrCpy $0 &quot;$INSTDIR\file&quot;<br />
StrCpy $1 &quot;$INSTDIR\zip&quot;<br />
StrCpy $2 &quot;True&quot;<br />
StrCpy $3 &quot;file/path/in/zip&quot;<br />
StrCpy $4 6 ; compression level<br />
System::Call 'XZip::Pack(t r0, t r1, t r2, t r3, i r4)'<br />
I am not sure if the function returns anything out, not by reading the API reference (http://xstandard.com/printer-friendly.asp?id=C9891D8A-5390-44ED-BC60-2267ED6763A7). I'll try to test it myself since I am not sure about $2 either (it is a boolean so it might be 'i 1' or 'i 0' instead of 't r2').<br />
Hope this helps<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RyanC</div><div class="date">18th May 2006, 17:10</div></div><div class="posttext">Thanks for the reply, I wont dive in so deeply for the first project next time ;-).<br />
<br />
I have tried the method suggested, using both boolean and string with no success.<br />
<br />
It does appear to report an error, at least the only thing I ever get back from it is &quot;error&quot;.<br />
<br />
If you test it yourself and get something to work please let me know. I will keep on it and see if I can get it working.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th May 2006, 18:53</div></div><div class="posttext">Boolean values are not string values. They are integer values of 1 or 0.<br />
You should also use SetOutPath to tell the System plugin where the DLL is located.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RyanC</div><div class="date">18th May 2006, 19:05</div></div><div class="posttext">Currently making it as simple as possible using:<br />
<br />
<br />
setoutpath $SYSDIR<br />
<br />
StrCpy $0 &quot;C:\test.txt&quot;<br />
StrCpy $1 &quot;C:\test.zip&quot;<br />
;StrCpy $2 &quot;false&quot;<br />
StrCpy $3 &quot;&quot;<br />
StrCpy $4 6 ; compression level<br />
System::Call 'XZip::Pack(t r0, t r1, i 0, t r3, i r4)' r5<br />
<br />
<br />
but no luck. Have tried a whole combination or different data types for the call, all string, correct boolean\interger\string combinations etc but with no luck.<br />
<br />
The API mentions I should be able to call <br />
<br />
system::call 'XZip::ErrorDescription' r6<br />
<br />
But i'm not getting anything in return.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th May 2006, 19:07</div></div><div class="posttext">I'll give it a try myself.<br />
Edit: Could you please attach the DLL file in a Zip? I don't feel like giving them my e-mail address.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th May 2006, 19:09</div></div><div class="posttext">One more thing. Did you register the DLL with RegDll first?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RyanC_2</div><div class="date">18th May 2006, 19:38</div></div><div class="posttext">Yes the dll is registered.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th May 2006, 20:22</div></div><div class="posttext">I guess it doesn't work because it's an ActiveX DLL.<br />
There's nothing wrong with the function call, because I've checked it with PE_Explorer.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RyanC</div><div class="date">21st May 2006, 18:16</div></div><div class="posttext">thanks for the help and info</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>