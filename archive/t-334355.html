<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Need to store text files in AppData folder, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Need to store text files in AppData folder NSIS Discussion" />
	
	<title> Need to store text files in AppData folder [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Need to store text files in AppData folder</div>
<hr />
<div class="pda"><a href="t-334355.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=334355">Need to store text files in AppData folder</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">SteveRussell</div><div class="date">3rd September 2011, 23:58</div></div><div class="posttext">Now that I am in Windows 7, I suddenly find that simple text files that my app updates per user are denied access. Until now, I have kept these profiles in a subfolder of my install directory.<br />
<br />
I am wondering if I could get a bit of direction on how to use NSIS to find the right appdata folder and place some files in that location during installation. Of course, the folder name varies, such as 'Application Data' in XP and 'AppData' in Windows 7.  I am thinking and hoping that this move will eliminate access problems.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">msroboto</div><div class="date">4th September 2011, 05:48</div></div><div class="posttext">Look up $APPDATA in the wiki.<br />
I think that's what you want.  There is a warning about how the SetShellVarContext is set.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">4th September 2011, 06:48</div></div><div class="posttext">It's all in the manual.<br />
<br />
http://nsis.sourceforge.net/Docs/Chapter4.html#4.2.3</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SteveRussell</div><div class="date">4th September 2011, 08:45</div></div><div class="posttext">Thank you, gentlemen. I did discover $APPDATA after posting, but this is a new concept for me.<br />
<br />
I am wondering:  When might &quot;All Users&quot; be chosen over &quot;Current user&quot;?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">4th September 2011, 17:43</div></div><div class="posttext">If you enforce admin access for your installer (for example because you need to write to a protected directory such as $SYSTEM or $PROGRAMFILES), you must install for all users. In this case, you must use the HKLM registry hive for all registry stuff.<br />
<br />
If you do not do anything that requires admin access, you can do one of two things:<br />
1) Force admin-only installation anyway. This means installing for all users and using HKLM (see above).<br />
2) Allow user-level installation. This means NOT asking for admin access, NOT writing to any protected folders, only installing for the current user, and using the HKCU registry hive instead of HKLM.<br />
<br />
This is how windows is designed to operate, so this is how you're supposed to do it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">5th September 2011, 10:48</div></div><div class="posttext">I am wondering:  When might &quot;All Users&quot; be chosen over &quot;Current user&quot;?<br />
<br />
I you have things that are shared with all users of your program</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SteveRussell</div><div class="date">5th September 2011, 14:45</div></div><div class="posttext">If you enforce admin access for your installer (for example because you need to write to a protected directory such as $SYSTEM or $PROGRAMFILES), you must install for all users. <br />
<br />
I definitely do write to program files. But I thought that it was no longer possible to enforce admin access with RequestExecutionLevel.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th September 2011, 15:48</div></div><div class="posttext">You need RequestExecutionLevel admin but you still need to check the user is an administrator in .onInit and abort if they are not.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SteveRussell</div><div class="date">5th September 2011, 16:03</div></div><div class="posttext">You need RequestExecutionLevel admin but you still need to check the user is an administrator in .onInit and abort if they are not.<br />
<br />
Stu<br />
<br />
I would love to see an example of checking the user. Haven't found one yet.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">5th September 2011, 16:07</div></div><div class="posttext">requestexecutionlevel doesn't do anything in WinXP, or in Win7 if UAC is turned off. So use both:<br />
<br />
requestexecutionlevel admin<br />
<br />
function .onInit<br />
  userInfo::getAccountType<br />
  pop $0<br />
  ${If} $0 != &quot;Admin&quot;<br />
    messageBox MB_OK &quot;Requires admin&quot;<br />
    quit<br />
  ${EndIf}<br />
functionend<br />
<br />
(and same for un.onInit!)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SteveRussell</div><div class="date">5th September 2011, 16:57</div></div><div class="posttext">(Ignore this post. I had inserted code before includes.):<br />
<br />
Thank you. I'm getting an error:<br />
<br />
Function: &quot;.onInit&quot;<br />
File: &quot;UserInfo.dll&quot;-&gt;&quot;$PLUGINSDIR\UserInfo.dll&quot; [compress] 1336/4096 bytes<br />
Plugin Command: GetAccountType<br />
Pop: $0<br />
Invalid command: ${If}<br />
<br />
------<br />
<br />
Function .onInit<br />
  UserInfo::GetAccountType<br />
  Pop $0<br />
  ${If} $0 != &quot;Admin&quot;<br />
    MessageBox MB_OK &quot;Your system requires administrative permissions in order to install this software.&quot;<br />
    Quit<br />
  ${EndIf}<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">5th September 2011, 19:49</div></div><div class="posttext">!include LogicLib.nsh</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SteveRussell</div><div class="date">7th September 2011, 10:58</div></div><div class="posttext">Should I remove related folders and data files from the appdata folder when uninstalling?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">msroboto</div><div class="date">7th September 2011, 14:55</div></div><div class="posttext">Depends what it is.  If you uninstall word do you expect the .doc files to be deleted.<br />
I don't know if that analogy works in your case.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">7th September 2011, 16:15</div></div><div class="posttext">You should delete everything you don't want to keep. As simple as that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SteveRussell</div><div class="date">8th September 2011, 23:57</div></div><div class="posttext">I kind of like the doc comparison. My tiny data files are profiles that record user progress, otherwise meaningless when the application is uninstalled. But they could remain for re-installation.<br />
<br />
I have never before dealt programmatically with the appdata file structure, so never had to think about some of these ramifications. I treat the register very carefully, leaving it clean at uninstall. Now I am wondering about the neighborhood rules - Is it considered sloppy to allow some files to remain in appdata when the program is removed?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">12th September 2011, 12:27</div></div><div class="posttext">Is it considered sloppy to allow some files to remain in appdata when the program is removed?<br />
<br />
That entirely depends on your definition. &quot;Uninstallation&quot; implies you undo the installation, but you can define &quot;installation&quot; as that which the installer created (so, only the original application), or you can define it as everything that comprises and belongs to the installed application (so, both the app and its settings etc).<br />
<br />
Note that it may also depend on the size and number of files you're leaving behind. What most uninstallers do is add a checkbox or messagebox option to delete saves/settings along with the application.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th September 2011, 13:04</div></div><div class="posttext">You should ask the user if they wish the files to be deleted. You can either use a simple MessageBox, and an uninstall component (i.e. another un. Section) or add a custom page with a check-box on it.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SteveRussell</div><div class="date">13th September 2011, 01:56</div></div><div class="posttext">Yes, I need to give the user the choice to delete or keep the associated files. Thank you all again for your thoughts, which have clarified mine. I greatly appreciate your advice and direction.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SteveRussell</div><div class="date">13th September 2011, 23:13</div></div><div class="posttext">You can either use a simple MessageBox, and an uninstall component (i.e. another un. Section)....<br />
<br />
Stu<br />
<br />
Section, or Function?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th September 2011, 11:25</div></div><div class="posttext">You can have multiple uninstall sections along with an uninstall components page (read the docs).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SteveRussell</div><div class="date">18th September 2011, 11:02</div></div><div class="posttext">OK, I have created un.CleanUp_Profiles as an additional Section.<br />
<br />
Section un.CleanUp_Profiles<br />
  MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 &quot;Do you want to delete all Sign In id's associated with $(^Name)?&quot; IDYES true IDNO false<br />
  true:<br />
    Delete &quot;$APPDATA\${PRODUCT_FAMILY}\pf\*_scii.txtt&quot;<br />
    Goto next<br />
  false:<br />
    Goto next<br />
  next:<br />
SectionEnd<br />
<br />
I was already conditionally deleting other files and folders in Section Uninstall, depending on whether or not other similar products have been installed in the same directory.<br />
<br />
I don't see the docs telling me what should go inside the main section and what should not.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">19th September 2011, 05:45</div></div><div class="posttext">For NSIS it doesn't matter in which section you put it. That's entirely up to you. If you want to make it an optional section, obviously all the optional files should be deleted in that section, not in another.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>