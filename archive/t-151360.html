<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS Logic Library, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS Logic Library NSIS Discussion" />
	
	<title> NSIS Logic Library [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS Logic Library</div>
<hr />
<div class="pda"><a href="t-151360.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=151360">NSIS Logic Library</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">3rd October 2003, 15:34</div></div><div class="posttext">Hey, Here is another library to simplify the creation of your installs. This is the result of the previous post entitled &quot;Select Statements&quot;. Thanks to eccles I have been able to completely rewrite it with improved functionality and speed.<br />
<br />
Here is a list of the available statements:<br />
<br />
  if..elseif..else..endif<br />
  ifthen..|..|<br />
  ifcmd..||..|<br />
  select..case..case2..case3..case4..case5..case_else..endselect<br />
  for..exitfor..next<br />
  foreach..exitfor..next<br />
  do..exitdo..loop<br />
  dountil..exitdo..loop<br />
  do..exitdo..loopuntil<br />
  while..exitwhile..endwhile<br />
<br />
Have a look at the provided example.nsi for working examples of the library. Once I get some feed back on possible changes or improvements then I will post it in the archive.<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">3rd October 2003, 19:37</div></div><div class="posttext">Hey Don, check your private messages...!<br />
<br />
Dave.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">5th October 2003, 23:06</div></div><div class="posttext">Version 2.1 adds break and continue labels to repeat type statements. Useful for functions like MessageBox, here is an example:<br />
<br />
<br />
  ${do}<br />
    MessageBox MB_YESNO &quot;Stop loop?&quot; IDYES ${_break} ID_NO ${_continue}<br />
  ${loop}<br />
<br />
<br />
Thanks to eccles for the idea.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th October 2003, 01:02</div></div><div class="posttext">Damn, that's so cool! :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">7th October 2003, 13:56</div></div><div class="posttext">Don, I've made a couple of changes for your perusal.<br />
<br />
 Simplified IfThen by utilising If and EndIf<br />
 Maybe something similar could be done with IfCmd but I've not investigated this yet<br />
 Simplified For by utilising ForEach<br />
 Fixed ForEach missing the final iteration<br />
 Fixed a couple of Break/Continue bugs<br />
 <br />
You've added some code to the If {ElseIf} [Else] EndIf code (ElseIf labels) that I don't understand - I'm not sure that they are needed?<br />
<br />
Anyway, looking good!  Should help newcommers to NSIS no end :) <br />
<br />
--<br />
Dave.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">7th October 2003, 14:55</div></div><div class="posttext">Good work on the consolidation and fixes. I especially love your solution for the operation comparison in the foreach statement. Very nice. What were the issues with the break and continue labels? For the if..then statments I had to add some extra lines to handle just an if..else..endif statements. When I had something like the foloowing:<br />
<br />
${if} 1 = 5<br />
  MessageBox MB_OK &quot;test1&quot;<br />
${else}<br />
  MessageBox MB_OK &quot;test2&quot;<br />
${endif}<br />
<br />
Both messages would appear. It wasn't moving to the end. Here it is again with the updated file header.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">7th October 2003, 16:04</div></div><div class="posttext">Originally posted by dselkirk <br />
I especially love your solution for the operation comparison in the foreach statement.<br />
Heh, you have to jump through some hoops sometimes to get NSIS to do what you want, but it's not often impossible.<br />
What were the issues with the break and continue labels?<br />
Either For or ForEach was not setting them (I forget which) and a couple of places were pushing them instead of popping them (IIRC...).<br />
<br />
<br />
${if} 1 = 5<br />
  MessageBox MB_OK &quot;test1&quot;<br />
${else}<br />
  MessageBox MB_OK &quot;test2&quot;<br />
${endif}<br />
<br />
Both messages would appear.<br />
Ah, OK fair enough. :)<br />
<br />
-- <br />
Dave.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fraefel</div><div class="date">7th October 2003, 21:15</div></div><div class="posttext">Hi eccles &amp; dselkirk!<br />
<br />
You are amazing - very nice job done !<br />
This is going to save quite some lines of script...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">11th December 2003, 00:18</div></div><div class="posttext">NSIS LogicLib Version 2.3 Much reworking and refactoring of things to help reduce duplication, etc. E.g. all loop varieties now go through a common set of macros.<br />
 Added built-in support for the rest of NSIS's built-in conditional tests (Abort, Errors, FileExists, RebootFlag, Silent).<br />
 Added ability to use any NSIS conditional command in a normal If type statement (no longer restricted to the specialised IfCmd statement).<br />
 Optimised the code produced by If (fewer Goto's).<br />
 Added statement similar to If that works in reverse: &quot;Unless&quot; executes the code in the contained block if the condition is false. If, Unless, ElseIf, ElseUnless, EndIf and EndUnless can be used freely in any combination.<br />
 Fixed bug where using Continue in a Do..LoopUntil loop went to the top of the loop and not the loop condition.<br />
 Added DoWhile..Loop and Do..LoopWhile loop varieties (the existing While..EndWhile loop is still available and is identical to DoWhile..Loop).<br />
 Optimised the code produced by Select (fewer Goto's).<br />
 Renamed Case_Else to CaseElse (nothing else has an underscore so why should that one). The old name is still available too though (if you must).<br />
 CaseElse can also be called Default (for the C-minded).More changes are in the pipeline and LogicLib should be included in the standard NSIS distribution by the next NSIS release.<br />
<br />
Enjoy!<br />
<br />
-- <br />
Dave.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">13th December 2003, 16:53</div></div><div class="posttext">NSIS LogicLib Version 2.4 Added Switch..Case*/Default..EndSwitch: similar to Select but behaves just like the C version. I.e.:<br />
- Each Case is more like a label than a block so execution &quot;falls through&quot; unless you use Break.<br />
- CaseElse (or Default) does not have to be the final case.<br />
- Case*/Default can appear anywhere inside the Switch (e.g. inside an If inside the Switch).<br />
(With thanks to kichik for the idea and proof-of-concept model). Added unsigned integer comparisons U&lt;, U&gt;=, U&gt; and U&lt;=. Added 64-bit integer comparisons L=, L&lt;&gt;, L&lt;, L&gt;=, L&gt; and L&lt;= (these use System.dll). Added case-sensitive string tests S== and S!= (these use System.dll). Added string comparisons (not case sensitive) S&lt;, S&gt;=, S&gt; and S&lt;= (these use System.dll). Added section flag tests (SectionIsSelected, etc.) (to use these your script must include sections.nsh).All of the new features can be seen in action in the example script.<br />
<br />
-- <br />
Dave.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th December 2003, 17:04</div></div><div class="posttext">I love it! :D :up:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CodeSquid</div><div class="date">14th December 2003, 11:28</div></div><div class="posttext">Great stuff! Truly amazing! What dou you come up with next? A NSIS compiler written in NSIS? :D<br />
<br />
There's only one thing which should be improved:<br />
Get rid of the ${} around the commands.<br />
For example by adding a DeclareCommand function to NSIS or something similar. DeclareCommand ${If} If would make the If command available which then works like any of the built-in commands.<br />
Or another way: Add support for function parameters and get rid of call.<br />
<br />
And last but not least: Implicit inclusion of LogicLib.nsh to every script ;) <br />
<br />
Keep up the good work!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">14th December 2003, 13:14</div></div><div class="posttext">These things will become possible when NSIS supports compiler plug-ins.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CodeSquid</div><div class="date">14th December 2003, 13:54</div></div><div class="posttext">Compiler plugins? Whoah, any ETA?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">14th December 2003, 15:33</div></div><div class="posttext">NSIS 2.1 :)<br />
<br />
NSIS 2.0 has to be finished first.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">14th December 2003, 16:10</div></div><div class="posttext">Thanks all for the thanks :D  Thanks must also go out to Don (dselkirk) for planting the seed (and the code up to version 2.1 ;)).<br />
<br />
LogicLib has now been added to CVS and is included in the nightly snapshots and forthcoming NSIS releases.<br />
<br />
I am open to ideas for other improvements and logic tests to encapsulate (such as the section flag tests added in the latest version).And last but not least: Implicit inclusion of LogicLib.nsh to every script ;)nsisconf.nsh :p<br />
<br />
-- <br />
Dave.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">23rd August 2004, 14:49</div></div><div class="posttext">New in CVS: LogicLib v2.5<br />
 AndIf, AndUnless, OrIf, OrUnless added. These can be placed after If, Unless, ElseIf and ElseUnless to add any number of extra conditions. Order of precedence is strictly left-to-right though (or rather, top to bottom). Warnings of &quot;unused variable _LOGICLIB_TEMP&quot; are now avoided. When using the features that make use of this variable you will need to add a !define above !include LogicLib.nsh to let LogicLib know in advance. If you forget, a compiler error message will explain what is needed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rsegal</div><div class="date">24th August 2004, 03:54</div></div><div class="posttext">eccles this logic library is amazing.  I've converted some of my scripts to use it and have been able to eliminate huge chunks of script because of it.  Thanks alot man!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">24th November 2005, 01:33</div></div><div class="posttext">small question... can you not use LogicLib inside of macros with passed variables ?<br />
e.g.<br />
<br />
<br />
!macro someMacro someVar<br />
  ${If} ${someVar} == 0<br />
    # do something<br />
  ${EndIf}<br />
!macroend<br />
<br />
Tells me: !insertmacro: macro &quot;_If&quot; requires 4 parameter(s), passed 3!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">24th November 2005, 04:19</div></div><div class="posttext">nevermind... it's fine..<br />
<br />
The problem is that I'm passing the macro an empty string:<br />
<br />
!insertmacro someMacro &quot;&quot;<br />
<br />
And that throws the error. Apparently because once inside the macro, &quot;&quot; becomes &lt;null&gt;. Weird.<br />
<br />
Work-arounds?<br />
<br />
!macro someMacro someVar<br />
${If} &quot;${someVar}&quot; == &quot;0&quot;<br />
  # do something<br />
${ElseIf} &quot;${someVar}&quot; == &quot;&quot;<br />
  # do something else<br />
${EndIf}<br />
!macroend<br />
<br />
That would kill any integer checks, though.<br />
<br />
<br />
!insertmacro someMacro &quot;''&quot;<br />
<br />
Seems to work - is that the proper way to go about this ?<br />
<br />
I'm a bit confused as to why an empty string becomes null if passed to a macro, though.  In the latter bit, my string consisting of two quotation marks essentially becomes an empty string? :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th November 2005, 13:24</div></div><div class="posttext">Quoting in the ${If} line is the correct way to get around this. Why would it kill any integer checks?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">24th November 2005, 15:55</div></div><div class="posttext">because I'm making the gross assumption that you can't compare a string to an int :x<br />
<br />
Thanks for the pointer :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th November 2005, 16:00</div></div><div class="posttext">But an integer is a string in NSIS. Commands that require integers automatically convert the string to an integer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mamilo</div><div class="date">29th November 2006, 11:59</div></div><div class="posttext">Hi,<br />
i have a question how to use If in the new Logiclib.<br />
${If} ${SectionIsSelected} ${CSEC}  <br />
    !insertmacro UnSelectSection ${ESEC}<br />
${EndIf}<br />
<br />
i get an error: &quot;macro &quot;If&quot; requires 3 parameter(s), passed 2!&quot;<br />
I don't understand</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">29th November 2006, 21:00</div></div><div class="posttext">Hi mamilo!<br />
<br />
Did you write this code below the <br />
Section Sec01 CSEC<br />
declaration?<br />
<br />
Cheers<br />
<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">1st December 2006, 15:28</div></div><div class="posttext">Shouldn't it be this?<br />
<br />
${If} ${CSEC} = ${SectionIsSelected}<br />
!insertmacro UnSelectSection ${ESEC}<br />
${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">1st December 2006, 22:31</div></div><div class="posttext">I think the code is correct.<br />
<br />
http://nsis.sourceforge.net/LogicLib#Expressions<br />
<br />
But I believe the define has not yet been created by the compiler and therefore the constant is empty. Put the code below the section declaration.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">phunkydizco</div><div class="date">20th November 2008, 14:40</div></div><div class="posttext">How do I use the OrUnless Statement correctly? I want to do something when one of two sections is selected. Here is my code that doesn't work:<br />
SectionGetFlags ${SEC02} $R0<br />
Intop $R1 $R0 | 1<br />
SectionGetFlags ${SEC03} $R2<br />
Intop $R3 $R2 | 1<br />
${Unless} $R0 &lt;&gt; $R1 ${OrUnless} $R2 &lt;&gt; $R3<br />
  Do Something<br />
${EndUnless}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">20th November 2008, 14:46</div></div><div class="posttext">only one &quot;if&quot; statement per line</div></div><hr />


<div class="post"><div class="posttop"><div class="username">phunkydizco</div><div class="date">20th November 2008, 14:50</div></div><div class="posttext">Is this correct?<br />
SectionGetFlags ${SEC02} $R0<br />
Intop $R1 $R0 | 1<br />
SectionGetFlags ${SEC03} $R2<br />
Intop $R3 $R2 | 1<br />
${Unless} $R0 &lt;&gt; $R1<br />
${OrUnless} $R2 &lt;&gt; $R3<br />
  Do Something<br />
${EndUnless}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th November 2008, 17:40</div></div><div class="posttext">You can just use the ${If} ${SectionIsSelected} ... ${OrIf} ${SectionIsSelected} ...<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">20th November 2008, 18:31</div></div><div class="posttext">besides what Afrow said - yes, that'd be correct :)<br />
'd still go with what Afrow said, though :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">phunkydizco</div><div class="date">20th November 2008, 18:49</div></div><div class="posttext">Originally posted by Afrow UK <br />
You can just use the ${If} ${SectionIsSelected} ... ${OrIf} ${SectionIsSelected} ...<br />
<br />
Stu  <br />
<br />
That is not a good idea. Because with your code I have to copy my &quot;Do Something&quot; code twice.<br />
<br />
${Unless} $R0 &lt;&gt; $R1<br />
${OrUnless} $R2 &lt;&gt; $R3<br />
  Do Something<br />
${EndUnless}<br />
<br />
This seems to work and is very short.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th November 2008, 19:01</div></div><div class="posttext">Why?<br />
<br />
${If} ${SectionIsSelected} ${SEC02}<br />
${OrIf} ${SectionIsSelected} ${SEC03}<br />
...<br />
${EndIf}<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">phunkydizco</div><div class="date">20th November 2008, 19:47</div></div><div class="posttext">That's right I didn't see that. But my code is also ok?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th November 2008, 23:42</div></div><div class="posttext">It may work but the proper logic is to check if ${SF_SELECTED} (1) is set:<br />
<br />
SectionGetFlags ${SEC02} $R0<br />
IntOp $R0 $R0 &amp; ${SF_SELECTED}<br />
${If} $R0 != 0<br />
...<br />
<br />
This is what ${If} ${SectionIsSelected} ${SEC02} would be doing internally.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">phunkydizco</div><div class="date">21st November 2008, 07:49</div></div><div class="posttext">What does this line?<br />
<br />
IntOp $R0 $R0 &amp; ${SF_SELECTED}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o___O</div><div class="date">8th March 2011, 08:06</div></div><div class="posttext">There's a replacement macro for ${FileExists} in the Wiki, but it doesn't work with ${IfNot} or ${Unless}.<br />
<br />
http://nsis.sourceforge.net/LogicLib<br />
<br />
FileExists <br />
<br />
The ${FileExists} condition included in LogicLib will evaluate to true if what exists is actually a directory. I suggest you add the following macros to your script (right after including LogicLib.nsh): <br />
!macro _FileExists2 _a _b _t _f<br />
	StrCmp `${_b}` `` `${_f}` 0<br />
	IfFileExists `${_b}` `0` `${_f}` ;returns true if this is a directory<br />
	IfFileExists `${_b}\*.*` `${_f}` `${_t}` ;so if it is a directory, jump to false<br />
!macroend<br />
!undef FileExists<br />
!define FileExists `&quot;&quot; FileExists2`<br />
!macro _DirExists _a _b _t _f<br />
	StrCmp `${_b}` `` `${_f}` 0<br />
	IfFileExists `${_b}\*.*` `${_t}` `${_f}`<br />
!macroend<br />
!define DirExists `&quot;&quot; DirExists`<br />
<br />
Then you can use ${If} ${FileExists} and ${If} ${DirExists}.In my script if I use:<br />
<br />
${If} ${FileExists} &lt;path&gt; and it exists, it will perform.<br />
<br />
However, if I use:<br />
<br />
${IfNot} ${FileExists} &lt;path&gt; and the file doesn't exist, it won't perform.<br />
<br />
I deleted the FileExists2 macro code from my script and returned to the one included in LogicLib.nsh and it works correctly again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">8th March 2011, 08:10</div></div><div class="posttext">There's no need for a new macro. You can simply use ${If} ${FileExists} $YourFile ${AndIfNot} ${FileExists} &quot;$YourFile\*.*&quot; .</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o___O</div><div class="date">8th March 2011, 11:16</div></div><div class="posttext">I know that but the code in the LogicLib Wiki (which is the official entry for LogicLib and makes the recommendation, actually - and links to this thread) doesn't work. It's weird that it doesn't work actually, FileExists2 is nearly identical to the old one, it looks like it should work the same except for returning false on directories.<br />
<br />
Original:<br />
!macro _FileExists _a _b _t _f<br />
        IfFileExists `${_b}` `${_t}` `${_f}`<br />
!macroend<br />
!define FileExists `&quot;&quot; FileExists`<br />
<br />
FileExists2 (slightly edited version)<br />
!macro _FileExists2 _a _b _t _f<br />
	IfFileExists `${_b}` `0` `${_f}` ;continues if something exists, returns false if not<br />
	IfFileExists `${_b}\*.*` `${_f}` `${_t}` ;so if it is a directory, jump to false - else return true<br />
!macroend<br />
!define FileExists2 `&quot;&quot; FileExists2`<br />
<br />
<br />
Wonder why it doesn't work?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">8th March 2011, 11:30</div></div><div class="posttext">Ah, my bad for not reading your post completely. I've reverted the wiki entry.<br />
<br />
<br />
Edit: As for why it doesn't work, not sure, I'm not that pro with preprocessor magic. But his/her 'suggested' code, even if it were working, changes LogicLib in a way that breaks backwards compatibility. It is therefore a big no-no. Also, if he/she wants to change logiclib, he/she should submit a patch for logiclib.nsh, not start messing around with the wiki page and advising people to do bad things.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o___O</div><div class="date">8th March 2011, 12:22</div></div><div class="posttext">I guess that's true, but they didn't advise modifying LogicLib.nsh - the code goes inside your .nsi right after LogicLib.nsh is included and merely replaces the functionality of LogicLib. It goes after LogicLib so it doesn't override the new macro. The information about FileExists returning true for directories is a useful addition to the Wiki but the provided solution just doesn't work with IfNot or Unless...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jiake</div><div class="date">8th March 2011, 13:24</div></div><div class="posttext">I thought a problem must be correct: Switch... Case... EndSwitch is used to detect the numeric value of the variable. But once I use it, I found in fact it can't be used to compare numbers. Such as I have defined a hexadecimal notification code 0x0300, if it is used to compile with a decimal number returned by NSIS, of course, they undoubtedly are not equal. Actually, I found that Switch and Case are only used in mathematical expression but not a string. So I modify the header, use the macro &quot;_=&quot; to replace with the original &quot;_==&quot;. But I still advice official developtors to modify this.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>