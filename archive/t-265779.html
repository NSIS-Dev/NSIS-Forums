<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Function and section, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Function and section NSIS Discussion" />
	
	<title> Function and section [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Function and section</div>
<hr />
<div class="pda"><a href="t-265779.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=265779">Function and section</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">rxs2k5</div><div class="date">14th February 2007, 12:46</div></div><div class="posttext">Hi all pros,<br />
<br />
I have a question.<br />
<br />
example I have a function page<br />
<br />
Function PageLeave<br />
<br />
## Pop password &amp; username from stack<br />
 Pop $R0<br />
 Pop $R1<br />
 <br />
 ## Get MD5 string for username<br />
MD5DLL::GetMD5String $R0<br />
Pop $R0<br />
<br />
## Get MD5 string for password<br />
MD5DLL::GetMD5String $R1<br />
Pop $R1<br />
<br />
## A bit of validation<br />
StrCmp $R0 '${Username1MD5}' 0 +2<br />
StrCmp $R1 '${Password1MD5}' Good Bad<br />
StrCmp $R0 '${Username3MD5}' 0 +2<br />
StrCmp $R1 '${Password3MD5}' Die Bad<br />
<br />
Bad:<br />
IntOp $R3 $R3 + 1<br />
MessageBox MB_OK|MB_ICONEXCLAMATION &quot;blah blah blah&quot;<br />
StrCmp $R3 2 +2<br />
Abort<br />
Quit<br />
Good:<br />
Goto Test<br />
Die:<br />
Goto Destroy<br />
FunctionEnd<br />
<br />
<br />
Here's how it goes<br />
<br />
Die:<br />
Goto Destroy<br />
<br />
The Destroy is actually in another sections which means I have a main and a secondary.<br />
<br />
In the main section, I have Test:<br />
<br />
In the secondary section, I have Destory:<br />
<br />
How can I make the Function to obey or recongise my label ?<br />
<br />
Die:<br />
Goto Destroy<br />
<br />
Which will actually know that I have a secondary section, and have Destory: in it ??<br />
<br />
I asking this because I got this error<br />
<br />
<br />
Error: could not resolve label &quot;Destroy&quot; in function &quot;passwordPageLeave&quot;<br />
Error - aborting creation process</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">14th February 2007, 17:36</div></div><div class="posttext">Generally you can't jump from a function to a section's label, but why you're making things such complicated, is there any particular reason?<br />
I guess would be easier and accurate as well, if the destroy condition resides into the passwordPageLeave function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rxs2k5</div><div class="date">15th February 2007, 00:53</div></div><div class="posttext">I trying to make these because I was thinking is it possible, coz example I have an master access and client access rights in these password, it will work separate ways.<br />
<br />
So what solution do u recommend for making such complicated access rights</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">15th February 2007, 08:47</div></div><div class="posttext">What I'm able to understand from your code is that label destroy pops up a message and terminates the installer.<br />
You don't need to add it in a section while sections executed in order within InstFiles page.<br />
You could make a separate function named destroy which performs specific actions and terminates the installer, that you may call when die condition is true, e.g.<br />
Die:<br />
Call Destroy</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rxs2k5</div><div class="date">15th February 2007, 12:11</div></div><div class="posttext">Hmm...<br />
<br />
Just need to know more about Function, If you do not mind Redwine.<br />
<br />
I been playing around with sections for some times but never got a chance to understand Function.<br />
<br />
Maybe you have some little example of what can function can do or may do to allow a task like another installer to install sliently or maybe a priorty access rights...<br />
<br />
Just anything you can think of a solution to my case because I dun quite understand Function , creating a new Page Custom Destroy so and so can help me fufill my task</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">15th February 2007, 22:01</div></div><div class="posttext">That it might need to be said more than the NSIS documentation, is that taking a tour to wiki where there are tons of examples, would help you understand everything much better than any possible example I could provide here.<br />
<br />
http://nsis.sourceforge.net/Developer_Center</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rxs2k5</div><div class="date">16th February 2007, 08:01</div></div><div class="posttext">Hi Redwine,<br />
<br />
I want to know more about this script u made during runtime<br />
<br />
&quot;Managing Sections on Runtime&quot;<br />
http://nsis.sourceforge.net/Managing_Sections_on_Runtime<br />
<br />
Is it possible to make function to change the sections?<br />
<br />
example.<br />
<br />
<br />
!include Sections.nsh<br />
!include &quot;myheader.nsh&quot;<br />
<br />
<br />
Function passwordPageLeave<br />
1............ good bad<br />
2............ die bad<br />
<br />
bad:<br />
.....<br />
good:<br />
Goto exit<br />
die:<br />
Call Destroy<br />
exit:<br />
FunctionEnd<br />
<br />
Function Destroy<br />
${UnSelectSection} ${SEC0000}<br />
${SelectSection} ${SEC001}<br />
FunctionEnd <br />
<br />
Section main SEC0000<br />
.........<br />
........<br />
........<br />
SectionEnd<br />
<br />
Section Destory SEC001<br />
........<br />
.......<br />
.......<br />
SectionEnd<br />
<br />
<br />
<br />
This is the problem when I key in username and password for 1, it goes to good then it jump directly into Function Destroy. I do not want it to jump to Function Destroy. Because it is for die. When I key in username and password for 2, it work.<br />
<br />
Do you know how can I good and die work separately and obey to activate the selected or unselected sections to use ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">16th February 2007, 18:56</div></div><div class="posttext">Provided that 1 and 2 comparisons both jump to the right label as expected, it is the section destroy which executed not the function destroy.<br />
The section destroy is executed because it is selected by default, actually the function destroy when called removes the selection of section main.<br />
You could solve it either by adding the code that section destroy contains into function destroy and remove the mentioned section from the script, or by making this section optional so could select it within the function destroy. e.g.<br />
Section /o Destory SEC001</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rxs2k5</div><div class="date">17th February 2007, 04:47</div></div><div class="posttext">Hi Red Wine,<br />
<br />
I followed ur instructions but its seems the same<br />
<br />
when I input username and password on 1 in the previous Quoted script, it will run Section main , when I input username and password on 2, it didn't call Destroy even though the Function Destroy is being set, it runs Section main.<br />
<br />
I think the Function Destroy <br />
<br />
${UnSelectSection} ${SEC0000}<br />
${SelectSection} ${SEC001}<br />
<br />
is not even working....<br />
<br />
by the way I changed the Section Destroy SEC001 to Section /o Destroy SEC001.<br />
<br />
Plus I am getting this warnings<br />
<br />
4 warnings:<br />
unknown variable/constant &quot;{SEC0000}&quot; detected, ignoring (macro:SecUnSelect:3)<br />
unknown variable/constant &quot;{SEC0000}&quot; detected, ignoring (macro:SecUnSelect:4)<br />
unknown variable/constant &quot;{SEC001}&quot; detected, ignoring (macro:SecSelect:3)<br />
unknown variable/constant &quot;{SEC001}&quot; detected, ignoring (macro:SecSelect:4)<br />
<br />
I think its gotta do with the modified header that I had modified.<br />
<br />
<br />
##          HEADER PART BEGINS HERE<br />
!define SF_USELECTED1  0<br />
!define SF_SELECTED1   1<br />
###############################<br />
 <br />
!macro SecSelect SecId<br />
  Push $0<br />
  IntOp $0 ${SF_SELECTED1} | ${SF_RO}<br />
  SectionSetFlags ${SecId} $0<br />
  SectionSetInstTypes ${SecId} 1<br />
  Pop $0<br />
!macroend<br />
 <br />
!define SelectSection '!insertmacro SecSelect'<br />
#################################<br />
 <br />
!macro SecUnSelect SecId<br />
  Push $0<br />
  IntOp $0 ${SF_USELECTED1} | ${SF_RO}<br />
  SectionSetFlags ${SecId} $0<br />
  SectionSetText  ${SecId} &quot;&quot;<br />
  Pop $0<br />
!macroend<br />
 <br />
!define UnSelectSection '!insertmacro SecUnSelect'<br />
###################################<br />
 <br />
##        HEADER PART ENDS HERE<br />
<br />
one last thing do I have to include this<br />
Function .onSelChange ???</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">17th February 2007, 08:56</div></div><div class="posttext">Not knowing what exactly you're trying to achieve is hard to help, but I don't think the header you're using could be helpful for your case.<br />
<br />
I hope following example would offer some direction.<br />
!define CUSTINI &quot;$PLUGINSDIR\custom.ini&quot;<br />
<br />
!include Sections.nsh<br />
<br />
outfile test.exe<br />
InstallDir &quot;$PROGRAMFILES\test&quot;<br />
ShowInstDetails show<br />
<br />
Page Custom CreateCustom LeaveCustom<br />
Page InstFIles<br />
<br />
Section &quot;main&quot; sec1<br />
MessageBox MB_OK &quot;Simulating Case GOOD&quot;<br />
SetOutPath &quot;$INSTDIR&quot;<br />
DetailPrint &quot;Simulating Case GOOD&quot;<br />
SectionEnd<br />
<br />
Section /o &quot;destroy&quot; sec2<br />
MessageBox MB_OK &quot;Simulating Case DESTROY&quot;<br />
SetOutPath &quot;$INSTDIR&quot;<br />
DetailPrint &quot;Simulating Case DESTROY&quot;<br />
SectionEnd <br />
<br />
Function CreateCustom<br />
push $0<br />
InstallOptions::Dialog &quot;${CUSTINI}&quot;<br />
pop $0<br />
pop $0<br />
FunctionEnd<br />
<br />
Function LeaveCustom<br />
ReadINIStr $0 &quot;${CUSTINI}&quot; &quot;field 1&quot; &quot;state&quot;<br />
StrCmp $0 1 end<br />
!insertmacro ReverseSection ${sec1}<br />
!insertmacro ReverseSection ${sec2}<br />
<br />
end:<br />
FunctionEnd<br />
<br />
Function .onInit<br />
InitPluginsDir<br />
WriteINIStr &quot;${CUSTINI}&quot; &quot;Settings&quot; &quot;NumFields&quot; &quot;2&quot;<br />
<br />
WriteINIStr &quot;${CUSTINI}&quot; &quot;field 1&quot; &quot;type&quot; &quot;radiobutton&quot;<br />
WriteINIStr &quot;${CUSTINI}&quot; &quot;field 1&quot; &quot;text&quot; &quot;simulate case good&quot;<br />
WriteINIStr &quot;${CUSTINI}&quot; &quot;field 1&quot; &quot;left&quot; &quot;10&quot;<br />
WriteINIStr &quot;${CUSTINI}&quot; &quot;field 1&quot; &quot;right&quot; &quot;-10&quot;<br />
WriteINIStr &quot;${CUSTINI}&quot; &quot;field 1&quot; &quot;top&quot; &quot;10&quot;<br />
WriteINIStr &quot;${CUSTINI}&quot; &quot;field 1&quot; &quot;bottom&quot; &quot;22&quot;<br />
WriteINIStr &quot;${CUSTINI}&quot; &quot;field 1&quot; &quot;state&quot; &quot;1&quot;<br />
WriteINIStr &quot;${CUSTINI}&quot; &quot;field 1&quot; &quot;flags&quot; &quot;GROUP&quot;<br />
<br />
WriteINIStr &quot;${CUSTINI}&quot; &quot;field 2&quot; &quot;type&quot; &quot;radiobutton&quot;<br />
WriteINIStr &quot;${CUSTINI}&quot; &quot;field 2&quot; &quot;text&quot; &quot;simulate case destroy&quot;<br />
WriteINIStr &quot;${CUSTINI}&quot; &quot;field 2&quot; &quot;left&quot; &quot;10&quot;<br />
WriteINIStr &quot;${CUSTINI}&quot; &quot;field 2&quot; &quot;right&quot; &quot;-10&quot;<br />
WriteINIStr &quot;${CUSTINI}&quot; &quot;field 2&quot; &quot;top&quot; &quot;26&quot;<br />
WriteINIStr &quot;${CUSTINI}&quot; &quot;field 2&quot; &quot;bottom&quot; &quot;38&quot;<br />
WriteINIStr &quot;${CUSTINI}&quot; &quot;field 2&quot; &quot;state&quot; &quot;0&quot;<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rxs2k5</div><div class="date">17th February 2007, 16:41</div></div><div class="posttext">Hi Red Wine<br />
<br />
You almost hit the solution I needed, I need a little more help.<br />
<br />
Function LeaveCustom<br />
ReadINIStr $0 &quot;${CUSTINI}&quot; &quot;field 1&quot; &quot;state&quot;<br />
StrCmp $0 1 end<br />
!insertmacro ReverseSection ${sec1}<br />
!insertmacro ReverseSection ${sec2}<br />
<br />
1.How can I make this implementation without using CUSTINI ?<br />
<br />
Can you implement the above to select only 1 section in this code<br />
<br />
Function passwordPageLeave<br />
1............ good bad<br />
2............ die bad<br />
<br />
bad:<br />
.....<br />
good:<br />
Goto exit<br />
die:<br />
[ insert an implementation in here, I only want Section Destroy to be selected and not Section Main ]<br />
exit:<br />
FunctionEnd<br />
<br />
I know there's a way but its seems I cannot get the idea.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">17th February 2007, 22:21</div></div><div class="posttext">I'm afraid I can't help it furthermore, sorry...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>