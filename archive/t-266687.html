<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Vista - Cannot copy files to non-admin user's Desktop/Pictures, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Vista - Cannot copy files to non-admin user's Desktop/Pictures NSIS Discussion" />
	
	<title> Vista - Cannot copy files to non-admin user's Desktop/Pictures [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Vista - Cannot copy files to non-admin user's Desktop/Pictures</div>
<hr />
<div class="pda"><a href="t-266687.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=266687">Vista - Cannot copy files to non-admin user's Desktop/Pictures</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">marucosuz</div><div class="date">27th February 2007, 01:53</div></div><div class="posttext">Hello all,<br />
<br />
My installer copies some files to the &quot;$DESKTOP&quot; and &quot;$PICTURES&quot; folder of the current user. I have tested it with Window XP and it works fine for admin and non-admin users. However, it does not work correctly with Vista. No matter which user I am logged in as, the files are always copied into the administrator's folders as opposed to the current user's folders.<br />
<br />
I have tried running the &quot;UserInfo.exe&quot; example (that comes with the NSIS installation) as a non-admin user and noticed that UserInfo::GetName and UserInfo::GetAccountType always return the information of the Administrator user whose password was used to authorized the installation. Is this an OS bug? Can I do something to fix this? <br />
<br />
I am using the &quot;RequestExecutionLevel admin&quot; command to avoid getting the warning message after the vista installation. Also, I have tried using the &quot;SetShellVarContext current&quot; command just before calling &quot;$PICTURES&quot; but it didnt work as expected. <br />
<br />
Any help will be appreciated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">27th February 2007, 07:07</div></div><div class="posttext">Vista not only elevates installer's process rights (UAC), but makes it running from administrator. This way installer forgets about logged user and executes installer as it was started by admin. Thread with the same problem http://forums.winamp.com/showthread.php?s=&amp;threadid=265780<br />
May be Vista SDK can help with process token tricks (new NSIS plug-in required), but SDK &quot;Download Size: 1 KB - 1185.7 MB*&quot; :-( http://www.microsoft.com/downloads/details.aspx?FamilyId=C2B1E300-F358-4523-B479-F53D234CDCCF&amp;displaylang=en</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>