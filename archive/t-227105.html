<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Process in ExecWait reboots, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Process in ExecWait reboots NSIS Discussion" />
	
	<title> Process in ExecWait reboots [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Process in ExecWait reboots</div>
<hr />
<div class="pda"><a href="t-227105.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=227105">Process in ExecWait reboots</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">madden</div><div class="date">28th September 2005, 00:48</div></div><div class="posttext">Hello<br />
<br />
I'm a new user of NSIS.<br />
I need to redistribute Windows Common Controls, SHFolder.dll, Microsft Data Access Components and a few others.<br />
<br />
Problem is, to install these, I have to Exec some installers from Microsoft (madc_typ.exe, 50comupd.exe, SHFolder.exe) that in turn will install the components. This is the documented way to redistribute the .dlls and this is how I have to deploy them.<br />
<br />
Now any of these can potentialy reboot the computer, and I have to install all of them.<br />
<br />
I found somewhere on these pages that NSIS denies WM_QUERYENDSESSION requests from Windows while it is installing.<br />
<br />
Is this in the help file, I mean is this behaviour documented so that I can count on it ? Is it enough and a safe method so that I can create my installer ?<br />
<br />
If the installer is silent does the installer still do the job ?<br />
<br />
Can I have makensis.exe output an installer that could  interrupt an installation to allow for a reboot at ExecWait and then continue or something like this ?<br />
<br />
How can I ExecWait a proces that reboots ?<br />
<br />
Thank you<br />
Adrian Constantin<br />
Romania</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th September 2005, 12:16</div></div><div class="posttext">Microsoft installers usually accept a switch that prevents a reboot. Unattended (http://unattended.sourceforge.net/installers.php) contains information about this switches.<br />
<br />
As for NSIS, the change log (http://nsis.sourceforge.net/Docs/AppendixF.html) says WM_QUERYENDSESSION is denied since 2.02. As you've guessed, this isn't done in a silent installer because there's no window to receive messages.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">madden</div><div class="date">30th September 2005, 14:25</div></div><div class="posttext">I wish there would be a better way.<br />
<br />
Excelent list of Install Systems though.<br />
<br />
Now that I think of it, I've seen setups that could reboot and continue. Do you know of any Install System that would let me do such an installer ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th September 2005, 14:28</div></div><div class="posttext">Why would you want to stop the installer for every reboot? It's a much more pleasant user experience to have just one reboot.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">madden</div><div class="date">30th September 2005, 22:06</div></div><div class="posttext">Because I want to install 50comupd.exe (comctl32.dll 5.8 from Microsoft) and that one will reboot (with user's permision) on old win versions. Same for MDAC (mdac_typ.exe) and SHFolder.dll (SHFolder.exe)<br />
<br />
Besides, if comctl32.dll v5.8 is waiting for a reboot to be installed than many of my dll's may not be registered if they are staticaly linked to it. LoadLibrary called from regsrv32.exe (or directly form the NSIS installer that registers my dll) will see the old comctl32 still in use on the user system and will fail (because my dll will not link to the old comctl).<br />
<br />
And I also need to start my executable after install to register a new service in Control Panel and my executable may need any of the installed files currently waiting for a reboot if it staticaly links to them. Actualy for my executable to start in any way instalation must be complete and all .dlls updated and registered.<br />
<br />
Fortunately IS appears to 'magicaly' redistribute MDAC and comctl32 without several reboots, but I am afraid it does nothing more than repackaging, and Microsoft doesn't actualy allow this for it's redists.<br />
<br />
Can NSIS execute 'ExecWait' after a reboot, as it can execute 'File' and 'Delete' ?<br />
<br />
Timothy Madden<br />
Romania</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th September 2005, 23:06</div></div><div class="posttext">With the information on the link I've posted, you can make the installers silent and deny reboot.<br />
<br />
In the latest version of NSIS, the Library macro will delay registration of DLLs until reboot, if the reboot flag is set. You can check the return value of the installers and set the reboot flag accordingly.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>