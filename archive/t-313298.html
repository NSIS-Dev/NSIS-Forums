<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" PATH is erased/replaced, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  PATH is erased/replaced NSIS Discussion" />
	
	<title> PATH is erased/replaced [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  PATH is erased/replaced</div>
<hr />
<div class="pda"><a href="t-313298.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=313298">PATH is erased/replaced</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jan007</div><div class="date">3rd October 2009, 12:05</div></div><div class="posttext">Hi,<br />
I've made a commandline utility (.exe) that depends on a couple of dll's. <br />
After looking for some kind of packer that would allow me to let users download and use a single (working) exe (with the dll's included) it seems that is impossible.<br />
So someone pointed me to NSIS, which is a great tool, although I don't actually need to install software. <br />
<br />
Crucial in my setup is that users don't have to add the directory with the exe to their environmental PATH variable. NSIS does a great job with this but in my case it erased my entire PATH even though I used A(ppend).<br />
Gladly enough I read a lot of related posts before I tried, so I made a backup of my PATH.<br />
But I can't seem to find a solution to this problem. My PATH contains 1081 characters and slimming it down does solve the problem. But I can't ask my users to do that or otherwise I could just as well offer a zip and make them add the dir to their PATH themselves.<br />
<br />
1)Is there a 'real' solution to this problem? <br />
2)Can I otherwise somehow count the characters of their PATH variable and show a warning that their PATH will not be updated and that they will (still) have to add it themselves manually and show/link to a manual of how to do this?<br />
3)The directory which should added to the PATH variable is now hardcoded in my nsi script, but when people choose to 'install' in another directory this won't be correct. How can I retrieve what 'custom' directory they choose and use that dir to append to their PATH?<br />
4)As I said before: I'm not actually installing software, it's more like saving into a dir and setting up the PATH. So, can I leave out all the registry stuff from the example.nsi or can this be usefull for other things such as an uninstaller which in my case would be just to remove the dir+contents and the PATH var?<br />
<br />
I'm using NSIS 2.45 and Windows XP.<br />
<br />
Thanks in advance!<br />
<br />
Although the provided examples seem quite easy to change to reflect my setup I'm still posting it to make sure it does not contain unwanted, unneeded or even dangerous stuff.<br />
<br />
!include EnvVarUpdate.nsh<br />
Name &quot;MyApp&quot;<br />
OutFile &quot;MyApp_installer.exe&quot;<br />
InstallDir $PROGRAMFILES\MyApp<br />
InstallDirRegKey HKLM &quot;Software\MyApp&quot; &quot;Install_Dir&quot;<br />
RequestExecutionLevel admin<br />
<br />
Page components<br />
Page directory<br />
Page instfiles<br />
<br />
UninstPage uninstConfirm<br />
UninstPage instfiles<br />
<br />
Section &quot;MyApp (required)&quot;<br />
  SectionIn RO<br />
  <br />
  SetOutPath $INSTDIR<br />
  <br />
  File &quot;MyApp.exe&quot;<br />
  File &quot;gc.dll&quot;<br />
  File &quot;neko.dll&quot;<br />
  File &quot;regexp.ndll&quot;<br />
  File &quot;std.ndll&quot;<br />
  File &quot;zlib.ndll&quot;	<br />
  File &quot;LICENSE&quot;	<br />
  File &quot;neko_source_download.txt&quot;<br />
  File &quot;howto.txt&quot;	<br />
	<br />
  WriteRegStr HKLM SOFTWARE\MyApp &quot;Install_Dir&quot; &quot;$INSTDIR&quot;<br />
<br />
  WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp&quot; &quot;DisplayName&quot; &quot;MyApp&quot;<br />
  WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp&quot; &quot;UninstallString&quot; '&quot;$INSTDIR\uninstall.exe&quot;'<br />
  WriteRegDWORD HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp&quot; &quot;NoModify&quot; 1<br />
  WriteRegDWORD HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp&quot; &quot;NoRepair&quot; 1<br />
  WriteUninstaller &quot;uninstall.exe&quot;<br />
  ${EnvVarUpdate} $0 &quot;PATH&quot; &quot;A&quot; &quot;HKLM&quot; &quot;C:\Program Files\MyApp&quot;<br />
SectionEnd<br />
<br />
Section &quot;Start Menu Shortcuts (uninstaller)&quot;<br />
  CreateDirectory &quot;$SMPROGRAMS\MyApp&quot;<br />
  CreateShortCut &quot;$SMPROGRAMS\MyApp\Uninstall.lnk&quot; &quot;$INSTDIR\uninstall.exe&quot; &quot;&quot; &quot;$INSTDIR\uninstall.exe&quot; 0<br />
  CreateShortCut &quot;$SMPROGRAMS\MyApp\howto.lnk&quot; &quot;$INSTDIR\howto.txt&quot; &quot;&quot; &quot;$INSTDIR\howto.txt&quot; 0<br />
SectionEnd<br />
<br />
Section &quot;Uninstall&quot;<br />
  DeleteRegKey HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\MyApp&quot;<br />
  DeleteRegKey HKLM SOFTWARE\MyApp<br />
<br />
  Delete $INSTDIR\MyApp.exe<br />
  Delete $INSTDIR\uninstall.exe<br />
  Delete $INSTDIR\gc.dll<br />
  Delete $INSTDIR\neko.dll<br />
  Delete $INSTDIR\regexp.ndll<br />
  Delete $INSTDIR\std.ndll<br />
  Delete $INSTDIR\zlib.ndll<br />
  Delete $INSTDIR\LICENSE<br />
  Delete $INSTDIR\neko_source_download.txt<br />
  Delete $INSTDIR\howto.txt<br />
<br />
  Delete &quot;$SMPROGRAMS\MyApp\*.*&quot;<br />
<br />
  RMDir &quot;$SMPROGRAMS\MyApp&quot;<br />
  RMDir &quot;$INSTDIR&quot;<br />
	<br />
	${un.EnvVarUpdate} $0 &quot;PATH&quot; &quot;R&quot; &quot;HKLM&quot; &quot;C:\Program Files\MyApp&quot;<br />
SectionEnd<br />
Cheers,<br />
<br />
Jan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">3rd October 2009, 15:09</div></div><div class="posttext">1)<br />
yes, this is a known problem, someone(not me) needs to rewrite the path functions to use the system plugin and dynamic memory so you don't run into the 1024 limit. In the mean time you could use the large string build of nsis ( http://nsis.sourceforge.net/Special_Builds )<br />
<br />
2) yes it would be possible to count (read the registry path string and check its length)<br />
<br />
3) $instdir</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jan007</div><div class="date">3rd October 2009, 16:36</div></div><div class="posttext">Originally posted by Anders <br />
1)In the mean time you could use the large string build of nsis ( http://nsis.sourceforge.net/Special_Builds ) <br />
Thanks, It does solve my problem. (I read about it but was under the false impression I had to build that from source.)<br />
But yesterday I read in this thread that it could still go wrong. :eek: <br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=302516  threadid=302516(last post)<br />
I'd hate to erase someone's PATH (I surely would be furious if someone/thing did it to me)<br />
<br />
Is there a reason the special build is not the default one? Are there any drawbacks or good reasons not to use it?<br />
Originally posted by Anders <br />
2) yes it would be possible to count (read the registry path string and check its length) <br />
I guess I won't need to anymore since it works now.<br />
Originally posted by Anders <br />
3) $instdir  <br />
Ah, as simple as that, nice, works perfectly. Many thanks. <br />
<br />
Cheers,<br />
Jan</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>