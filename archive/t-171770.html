<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" whats wrong :(, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  whats wrong :( NSIS Discussion" />
	
	<title> whats wrong :( [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  whats wrong :(</div>
<hr />
<div class="pda"><a href="t-171770.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=171770">whats wrong :(</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">2nd March 2004, 16:26</div></div><div class="posttext">Var declaration before:<br />
<br />
!define INISECTION &quot;sdatupd&quot;<br />
!define SDATINI &quot;sdatupd.ini&quot;<br />
VAR PATHINI     ; $PATHINI<br />
VAR AUTODOWN    ; $AUTODOWN<br />
<br />
some code before function:<br />
<br />
  StrCpy $PATHINI &quot;$EXEDIR\${SDATINI}&quot;<br />
  call readsettings<br />
<br />
<br />
function readsettings<br />
<br />
  ClearErrors<br />
    ReadINIStr $VERSIONINFO $PATHINI ${INISECTION} version<br />
  IfErrors 0 readsettings01<br />
    StrCmp $VERSIONINFO &quot;1.2&quot; readsettings01<br />
    StrCmp $VERSIONINFO &quot;1.3&quot; readsettings01<br />
      DeleteINISec $PATHINI ${INISECTION}<br />
  readsettings01:<br />
    WriteINIStr $PATHINI ${INISECTION} version &quot;${VERSION}&quot;<br />
<br />
  ; read out autodown<br />
  ClearErrors<br />
    ReadINIStr $AUTODOWN $PATHINI ${INISECTION} autodown<br />
  IfErrors 0 readsettings02<br />
    StrCmp $AUTODOWN &quot;0&quot; readsettings02<br />
    StrCmp $AUTODOWN &quot;1&quot; readsettings02<br />
      WriteINIStr $PATHINI ${INISECTION} autodown &quot;1&quot;<br />
  readsettings02:<br />
    !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;menu01.ini&quot; &quot;Field 2&quot; &quot;State&quot; $AUTODOWN<br />
<br />
  ; read out path<br />
  ClearErrors<br />
    ReadINIStr $INSTDIR $PATHINI ${INISECTION} path<br />
  IfErrors readsettings09<br />
    !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;menu01.ini&quot; &quot;Field 11&quot; &quot;State&quot; $INSTDIR<br />
  readsettings09:<br />
<br />
functionend<br />
<br />
1st works, 2nd not, 3rd works again - the INI looks like this<br />
<br />
[sdatupd]<br />
version=1.2<br />
autodown=<br />
path=C:\Download<br />
<br />
autodown has to be 0 or 1<br />
<br />
Code skips WriteINIStr but why ?<br />
<br />
BTW: i cant rename/delete an INI file which is opened by setup?<br />
<br />
<br />
thx</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">2nd March 2004, 16:45</div></div><div class="posttext">I have no idea what you mean. Please describe the problem, test it without the whole function and attach a script that compiles.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">2nd March 2004, 16:57</div></div><div class="posttext">thats all...<br />
<br />
i declare the vars<br />
<br />
and function opens INI and read out values - if not valid or empty it sets default value.<br />
each value is put in the IO<br />
<br />
1st &amp; 3rd case with VERSION and INSTDIR are ok, 2nd not (autodown) - and i dont get it why.<br />
<br />
ok - i sorted the script above logical now...<br />
<br />
Joost - i am trying now for half an hour the code with and w/o brackets {} but i didn't got it yet :cry:<br />
<br />
PS some parts of code are valid cause the ini-file is created if not present and as you can see the entries too - but w/o values.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">2nd March 2004, 17:07</div></div><div class="posttext">Ok, second attempt<br />
<br />
the first IO normally shows the values of the INI (in check boxes)<br />
<br />
i found out that the values from ini are not stored in the IO.<br />
<br />
so especially this part dont works:<br />
<br />
 !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;menu01.ini&quot; &quot;Field 2&quot; &quot;State&quot; $AUTODOWN<br />
<br />
where is my fault?<br />
<br />
thx</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">2nd March 2004, 17:28</div></div><div class="posttext">3rd attempt:<br />
<br />
  ; read out autodown<br />
  ClearErrors<br />
    ReadINIStr $AUTODOWN $PATHINI &quot;${INISECTION}&quot; autodown<br />
  IfErrors 0 readsettings02<br />
    StrCmp $AUTODOWN &quot;0&quot; readsettings02<br />
    StrCmp $AUTODOWN &quot;1&quot; readsettings02<br />
      StrCpy $AUTODOWN &quot;1&quot;<br />
      WriteINIStr $PATHINI &quot;${INISECTION}&quot; autodown &quot;1&quot;<br />
  readsettings02:<br />
    !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;menu01.ini&quot; &quot;Field 2&quot; &quot;State&quot; $AUTODOWN<br />
<br />
<br />
&gt;&gt;   IfErrors 0 readsettings02<br />
<br />
is not working proper - i remind some trouble with jumps that can not be relativ - is this a case of it?<br />
<br />
hmm<br />
<br />
could it be<br />
&gt;&gt;   IfErrors +1 readsettings02<br />
?<br />
<br />
From help<br />
&quot;+1 jumps to the next instruction&quot;<br />
<br />
IfErrors is not indicated not to work with relativ jumps...<br />
<br />
PS<br />
i forgot<br />
 StrCpy $AUTODOWN &quot;1&quot;<br />
if not a valid value is found - so the IO is now working proper too</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">2nd March 2004, 17:46</div></div><div class="posttext">gotcha :)<br />
<br />
is it possible that this part is totally nonsens?<br />
<br />
 ClearErrors<br />
ReadINIStr $AUTODOWN $PATHINI ${INISECTION} autodown<br />
IfErrors 0 readsettings02<br />
<br />
So i think that ReadINIStr is not only reading - it creates entries because IfErrors NEVER grips - there is no error cause the entry exists (but it never has to)<br />
<br />
pls check your script - ReadINIStr may not create any entry - it only reads out</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>