<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Uninstaller needs Reboot option, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Uninstaller needs Reboot option NSIS Discussion" />
	
	<title> Uninstaller needs Reboot option [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Uninstaller needs Reboot option</div>
<hr />
<div class="pda"><a href="t-136830.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=136830">Uninstaller needs Reboot option</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">27th May 2003, 21:58</div></div><div class="posttext">hello out there<br />
<br />
nice forum :)<br />
<br />
i am reading now for some days... but i didnt found any solution - i am not firm at all with nsis<br />
<br />
I need a reboot option on the uninstaller (like reboot option on installer)<br />
<br />
Please give me a hint</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">27th May 2003, 22:05</div></div><div class="posttext">check the Docs...<br />
&quot;Reboot&quot; is there :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">27th May 2003, 22:16</div></div><div class="posttext">Check the reboot flag (IfRebootFlag), display a message and use Reboot to reboot.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">27th May 2003, 23:04</div></div><div class="posttext">Joost<br />
&gt;display a message <br />
that is one problem - i dont know how<br />
<br />
i just captured some syntax from &quot;if&quot; and vars - but the MUI? Just egypt to me :/<br />
<br />
I found similar from the system.nsh (v1.63, your work) but i can't use it - call me a dumb.<br />
<br />
BTW. Same problem with an additional README-MUI section - never got it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">28th May 2003, 22:11</div></div><div class="posttext">i found a code snippet like this:<br />
IfRebootFlag &quot;&quot; noreboot<br />
<br />
  re_boot:<br />
  MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 &quot; &lt;bla&gt; reboot?&quot; IDYES +2<br />
  REBOOT<br />
  Abort<br />
<br />
noreboot:<br />
<br />
But there is something wrong - it reboots always.<br />
must the &quot;abort&quot; before or after the reboot or can i use a jump on that question - dont know how</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">28th May 2003, 22:38</div></div><div class="posttext">Change +2 to noreboot, e.g.<br />
re_boot:<br />
  MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 &quot; &lt;bla&gt; reboot?&quot; IDYES noreboot<br />
  REBOOT<br />
  Abort<br />
noreboot:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">28th May 2003, 22:52</div></div><div class="posttext">thank you very much :)<br />
<br />
grmpblfix - did not work :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th May 2003, 09:58</div></div><div class="posttext">If you want it to reboot when the user clicks yes you should change IDYES to IDNO.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">29th May 2003, 15:02</div></div><div class="posttext">kichik<br />
<br />
it was late today and i read again again again the manual and i changed it to IDNO and it works<br />
<br />
not easy to a newbie<br />
<br />
thank you<br />
<br />
but i have a solution to my problem<br />
; Usage:<br />
;  push dirname\dllname<br />
;  call exchange<br />
<br />
Function exchange<br />
  Exch $R1<br />
  Push $R2<br />
  Push $R3<br />
  Push $R4<br />
  ; $R1=oldname<br />
  ; $R2=newname<br />
  ; $R3=counter<br />
  StrCpy $R3 0<br />
  <br />
  ;check first if deletable<br />
  Delete $R1<br />
  IfFileExists $R1 0 copy<br />
<br />
  loop:<br />
    StrCpy $R2 $R1.$R3.tmp<br />
    IfFileExists $R2 0 done<br />
    IntOp $R3 $R3 + 1<br />
    Goto loop<br />
<br />
  done:<br />
  Rename $R1 $R2<br />
  <br />
  copy:<br />
  ;file was found and renamed<br />
  File &quot;yourdll.dll&quot;<br />
  ;delete old TMP-files on next boot<br />
  Delete /REBOOTOK &quot;$INSTDIR\*.tmp&quot;<br />
<br />
  Pop $R3<br />
  Pop $R2<br />
  Pop $R1<br />
FunctionEnd<br />
<br />
<br />
another installer gave me that hint to rename that file, copy new file and delete old one on reboot.<br />
i dont need the other script (UpgradeDLL.nsh]any longer :)<br />
<br />
Now it is a fine peace of work i finshed a couple of minutes ago WITH your help<br />
<br />
PS the function isnt perfect at all but it takes someone only a minute to make it 100% variable<br />
<br />
PPS some explanation:<br />
the file that has to be replaced will be renamed to &lt;oldname.ext.counter.tmp&gt;<br />
counter goes up from &quot;0&quot; to anywhere but it is quite impossible that someone has done this a million times<br />
before renaming it is controlled if that file is not there otherwise counter=counter+1 and loop<br />
TMP-files are deleted on reboot</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th May 2003, 15:07</div></div><div class="posttext">Are you sure this code works? If you can't delete the file how come you can rename it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">29th May 2003, 15:11</div></div><div class="posttext">dont ask me that - i even wondered too but it works on my dll - unfortunately i cant delete it in any case nor the folder.<br />
<br />
as i mentioned above this is no system-dll but it is shown in the explorer context<br />
<br />
##<br />
damn i posted the function into the wrong topic.<br />
must be http://forums.winamp.com/showthread.php?s=&amp;postid=971088#post971088<br />
<br />
hey mod you can /join if you like to :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th May 2003, 15:30</div></div><div class="posttext">Make sure it works on every system, seems a little odd...<br />
<br />
Is there any difference between the code in this post and the code in the other post? Looks exactly the same to me.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>