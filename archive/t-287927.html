<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Control+Shift via GetAsyncKeyState() on Vista?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Control+Shift via GetAsyncKeyState() on Vista? NSIS Discussion" />
	
	<title> Control+Shift via GetAsyncKeyState() on Vista? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Control+Shift via GetAsyncKeyState() on Vista?</div>
<hr />
<div class="pda"><a href="t-287927.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=287927">Control+Shift via GetAsyncKeyState() on Vista?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">mtconleyuk</div><div class="date">3rd March 2008, 12:00</div></div><div class="posttext">I have an installer that needs to detect whether both the Control and Shift keys are being pressed as it launches so as to enable certain advanced features. I use GetAsynchKeyState() under XP to do this, and it works fine.<br />
<br />
However, I've just tried doing this under Vista and discovered that it doesn't work. GetAsynchKeyState() returns the expected result if one or the other key is held down, but if both are down, it returns 0 in both cases.<br />
<br />
I tried substituting both GetKeyState() and GetKeyboardState() instead, but the result is the same.<br />
<br />
Anyone seen this before?<br />
<br />
The code is pretty straightforward:<br />
<br />
	System::Call &quot;user32::GetAsyncKeyState(i 0x11) i .r0 ? !e&quot;<br />
	<br />
	IntOp $0 $0 &amp; 0x8000<br />
<br />
	${If} 0 &lt;&gt; $0<br />
		System::Call &quot;user32::GetAsyncKeyState(i 0x10) i .r0 ? !e&quot;<br />
	<br />
		IntOp $0 $0 &amp; 0x8000<br />
	<br />
		${If} 0 &lt;&gt; $0<br />
			IntOp $0 1 +<br />
		${EndIf}<br />
	${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd March 2008, 19:50</div></div><div class="posttext">Seems you're not the only one with this problem. A quick Google search didn't find any answers but it did find your post in the third spot.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mtconleyuk</div><div class="date">12th March 2008, 10:12</div></div><div class="posttext">Did a little more testing, and found that if I run a test app that does the same thing on Vista as Administrator, it only saw one key or the other, but if I ran it normally, it worked fine. The obvious difference was the UAC dialog that popped up when I tried to run it as Admin; when I disabled UAC using MSCONFIG, and ran the app as Admin, it worked fine again.<br />
<br />
So the UAC dialog screws up the results of ::GetAsyncKeyState() such that it only ever sees one of the two keys, never both. Now, *why* that happens is another question. Any ideas?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>