<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" access without administration rights, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  access without administration rights NSIS Discussion" />
	
	<title> access without administration rights [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  access without administration rights</div>
<hr />
<div class="pda"><a href="t-337631.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=337631">access without administration rights</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">NOCaut</div><div class="date">16th November 2011, 11:29</div></div><div class="posttext">I run installer with RequestExecutionLevel user and <br />
<br />
Function .onInit<br />
!insertmacro useUAC<br />
!insertmacro MULTIUSER_INIT<br />
...<br />
<br />
then run silent installer RequestExecutionLevel user and <br />
<br />
Function .onInit <br />
!insertmacro useUAC<br />
!insertmacro MULTIUSER_INIT<br />
....<br />
<br />
1)  I call two !insertmacro useUAC - it is bad <br />
2)  not have rights for delete or change key in registry<br />
Function un.onInit<br />
 !insertmacro useUAC<br />
 !insertmacro MULTIUSER_UNINIT</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NOCaut</div><div class="date">16th November 2011, 11:43</div></div><div class="posttext">If i run subinstaller without !insertmacro useUAC i cant access to registry and Program Files</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">16th November 2011, 12:26</div></div><div class="posttext">Please do not use the UAC plugin for getting admin access. It is much too complex for such a simple task. And if I recall correctly, it cannot be used together with multiuser.nsh. In fact, multiuser.nsh isn't really designed for new versions of Windows. You're better off not using it if you ask me.<br />
<br />
What you need can be done much simpler:<br />
1) use &quot;requestexecutionlevel admin&quot;<br />
2) in .onInit, use the UserInfo plugin to verify that the user really has admin access<br />
3) Always install for all users. Admin-level installers should always install for all users, *especially* if the user running the installer is not an administrator himself. This is how windows is designed to be used.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NOCaut</div><div class="date">16th November 2011, 13:41</div></div><div class="posttext">bad idea<br />
1) use  use &quot;requestexecutionlevel admin&quot;<br />
then all nsis const return path like administation<br />
installer write all in application data admin<br />
i want say when i write in registry i write in admin account key</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">16th November 2011, 14:00</div></div><div class="posttext">If you're writing to HKLM, you should also be writing to all users's appdata. As I said, that's how Windows is designed to be used. If your application requires some files to be present in the *user's* appdata, you need to code your app to copy those files from alluser appdata (if they don't exist in the user's appdata yet).<br />
<br />
(Edit: The reason why the app should do this, and not the installer itself, is that there's no way for the installer to know which users will be running the app. You cannot extract files if the installer doesn't know where they need to go.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NOCaut</div><div class="date">16th November 2011, 14:35</div></div><div class="posttext">I know but i want change Internet explorer key. I most write in the curent user, Or i most run application and in app change reg key ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">16th November 2011, 15:49</div></div><div class="posttext">If you want to change a registry key in HKLM, you should install as all users, using admin access.<br />
If you want to change a registry key in HKU, you can install for a single user, using userlevel access.<br />
<br />
What key do you want to change?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NOCaut</div><div class="date">16th November 2011, 16:58</div></div><div class="posttext">HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Main<br />
<br />
but if i run with userlevel access. i change registry but can not create folder and register dll in the system<br />
<br />
but if i  run with admin access i can reg dll but cant change registry key</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NOCaut</div><div class="date">16th November 2011, 17:09</div></div><div class="posttext">Maybe better for change registry write small *.bat or *exe file on —Å++/Delphi</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">16th November 2011, 18:26</div></div><div class="posttext">There are several ways you can do this (enumusersreg, uac plugin, runas through system plugin...), but I still say they are all wrong. I don't know what it is you want to do in HKCU\IE\Main, but I'd make sure that there isn't some all-user setting for this before messing with userlevel settings for an alluser-type application.<br />
<br />
If there's really no other way: You can use enumusersreg to change the HKCU of every user if you want to install for every single user separately, or you can use the UAC plugin to only install for the user who executed the installer (expert option, I don't recommend it).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NOCaut</div><div class="date">17th November 2011, 08:54</div></div><div class="posttext">Thanks for EnumUsersReg. If i have any problem i write in this post within a week.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NOCaut</div><div class="date">17th November 2011, 12:08</div></div><div class="posttext">How i can Push my params in then EnumUsersReg function ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NOCaut</div><div class="date">17th November 2011, 15:39</div></div><div class="posttext">I have next problem:<br />
i write install with admin righth<br />
<br />
install applixation on user without admin rights + UAC<br />
1)<br />
when i uninstall application uninstall not have righths for program files, unreg dll file, clear registry, and etc!!!<br />
<br />
When I add UAC function in the uninstall section all good but uninstall runs twice.<br />
<br />
Function un.onInit<br />
 ;!insertmacro useUAC<br />
 !insertmacro MULTIUSER_UNINIT<br />
<br />
2)<br />
  in user user without admin rights + UAC I can not run *.exe file i try<br />
  - !insertmacro UAC_AsUser_ExecShell &quot;open&quot; &quot;${FF_REGISTRATION}&quot; &quot;&quot; &quot;&quot; &quot;&quot;<br />
  - Exec &quot;$INSTDIR\${FF_REGISTRATION}&quot;<br />
not work</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">17th November 2011, 16:17</div></div><div class="posttext">Again, please do not use the UAC plugin for this.<br />
<br />
Use &quot;requestexecutionlevel admin&quot;, and in both .onInit AND un.onInit use the UserInfo plugin to verify that the installer really has admin access (and if it doesn't, show a MessageBox error and quit).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NOCaut</div><div class="date">17th November 2011, 16:30</div></div><div class="posttext">HOW? in Windows7 this code not work!<br />
  System::Call &quot;kernel32::GetModuleHandle(t 'shell32.dll') i .s&quot;<br />
  System::Call &quot;kernel32::GetProcAddress(i s, i 680) i .r0&quot;<br />
  System::Call &quot;::$0() i .r0&quot;  <br />
  ${If} $0 == 0	<br />
	MessageBox MB_OK &quot;You must have Administrator privileges to install this application.$\nPlease log in as Administrator and start the installation again.&quot;<br />
	Quit <br />
 ${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">17th November 2011, 16:46</div></div><div class="posttext">Why are you calling IsUserAnAdmin by ordinal?<br />
<br />
Use the UserInfo plugin!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NOCaut</div><div class="date">18th November 2011, 09:20</div></div><div class="posttext">http://nsis.sourceforge.net/Examples/UserInfo/UserInfo.nsi - fuk, not work always say that i am administrator group</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">18th November 2011, 09:47</div></div><div class="posttext">If it says it has admin access, then it's working, isn't it? Isn't that what you've been trying to accomplish?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NOCaut</div><div class="date">18th November 2011, 10:24</div></div><div class="posttext">then it's working, isn't it? - No because i login as USER accoun.<br />
<br />
let's try from start: I want in user in windows7:<br />
1) write in registry &amp;<br />
2) register dll file<br />
3) run exe file<br />
<br />
and all that in one installer. I try write two silent install one for write in the registry and dll registry with admin right and two with user rughts + !includemacro useUAC for run Exe file.  but did not work two silent installer run not correctly</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">18th November 2011, 10:49</div></div><div class="posttext">The userinfo plugin is to ensure that you have admin access to begin with. It doesn't have anything to do with running a userlevel exe from an admin installer.<br />
<br />
To run a userlevel exe from an admin installer, you can either use the UAC plugin (see the example nsi scripts shipped with the plugin!), or use the ShellExecAsUser plugin. <br />
<br />
Once again, I repeat that what you want to accomplish is NOT easy to do for a beginner. You should probably rethink your installer strategy, instead.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NOCaut</div><div class="date">18th November 2011, 11:26</div></div><div class="posttext">i know it`s hard, because I wrote this for you so that you have helped me in. ok thanks for help. if you  have any ideas write me in the post or send mail.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>