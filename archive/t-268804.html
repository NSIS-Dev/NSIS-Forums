<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Fonts installation Win9x/WinNT, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Fonts installation Win9x/WinNT NSIS Discussion" />
	
	<title> Fonts installation Win9x/WinNT [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Fonts installation Win9x/WinNT</div>
<hr />
<div class="pda"><a href="t-268804.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=268804">Fonts installation Win9x/WinNT</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">ginther</div><div class="date">2nd April 2007, 14:02</div></div><div class="posttext">Hello @all,<br />
i have some problems with fonts installation and uninstall on Win98.<br />
On Windows XP everything is ok. After the installation process on Win98 the fonts were not shown in the fontstable. After a reboot they are shown, but it should work without a reboot. Should i use CreateScalableFontResource before calling AddFontResourceA? I have the same problem using fonts.dll and i would prefer to do it without the plugin.<br />
<br />
Can anyone help me (using NSIS 2.24)?<br />
<br />
<br />
!define FONT2 &quot;tt0856m_.ttf&quot;<br />
...<br />
<br />
Win9x:<br />
          StrCpy $RegKey2Fonts   &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Fonts&quot;<br />
          StrCpy $FontsDirectory &quot;C:\Windows\Fonts&quot;<br />
          StrCpy $OSBasis &quot;Win9x&quot;<br />
          Goto OSVersionEnd<br />
    <br />
<br />
    WinNT:<br />
          StrCpy $RegKey2Fonts &quot;SOFTWARE\Microsoft\Windows NT\CurrentVersion\Fonts&quot;<br />
          StrCpy $FontsDirectory $FONTS<br />
          StrCpy $OSBasis &quot;WinNT&quot;<br />
          Goto OSVersionEnd<br />
<br />
...<br />
<br />
Section &quot;${ProductName} ${DISPLAY_VERSION}&quot;<br />
<br />
  SetOutPath $FontsDirectory<br />
<br />
  File ..\Fonts\Fonts-V1.1\${FONT2}<br />
<br />
  System::Call &quot;GDI32::AddFontResourceA(t) i ('${FONT2}') .s&quot;<br />
  Pop $0<br />
  # $0 is zero if the function failed<br />
  StrCmp $0 &quot;0&quot; 0 +3<br />
  DetailPrint &quot;Fehler beim registrieren von ${FONT2} ($0) ...&quot;<br />
  Goto NewFont3<br />
  DetailPrint &quot;${FONT2} erfolgreich registriert ($0) ...&quot;<br />
  WriteRegStr HKLM &quot;$RegKey2Fonts&quot; &quot;${FONT2_NAME}&quot; &quot;${FONT2}&quot;<br />
<br />
  DetailPrint &quot;Nachricht an alle Anwendungen bzgl. neuer Fontlist ...&quot;<br />
  SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0<br />
<br />
...<br />
<br />
SectionEnd<br />
<br />
<br />
Section Uninstall<br />
<br />
  System::Call &quot;GDI32::RemoveFontResourceA(t) i ('${FONT2}') .s&quot;<br />
  Pop $0<br />
  DetailPrint &quot;${FONT2} aus Fonttable lÃ¶schen ...&quot;<br />
  ${If} $0 != &quot;0&quot;<br />
        DetailPrint &quot;LÃ¶schen aus Fonttable erfolgreich ($0) ...&quot;<br />
        DetailPrint &quot;${FONT2} aus $FontsDirectory lÃ¶schen ...&quot;<br />
        ClearErrors<br />
        Delete $FontsDirectory\${FONT2}<br />
        IfErrors 0 +3<br />
        DetailPrint &quot;LÃ¶schen aus Filesystem fehlgeschlagen ...&quot;<br />
        Goto +4<br />
        DetailPrint &quot;LÃ¶schen aus Filesystem erfolgreich ...&quot;<br />
        DetailPrint &quot;HKLM\$RegKey2Fonts\${FONT2_NAME} lÃ¶schen ...&quot;<br />
        DeleteRegValue HKLM &quot;$RegKey2Fonts&quot; &quot;${FONT2_NAME}&quot;<br />
  ${Else}<br />
        DetailPrint &quot;LÃ¶schen aus Fonttable fehlgeschlagen ($0) ...&quot;<br />
  ${EndIf}<br />
<br />
...<br />
<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd April 2007, 21:20</div></div><div class="posttext">Your code looks like it should work. The only thing that might go around that I can see is C:\Windows\Fonts on 9x. Why not use $FONTS or at least $WINDIR\Fonts?<br />
<br />
Also, why not use one of the available solutions?<br />
<br />
http://nsis.sourceforge.net/Register_Fonts</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">3rd April 2007, 18:42</div></div><div class="posttext">most of my scripts didn't work on win 9x, when i didn't use quotes throughout the entire script. i don't know if that changed with later nsis versions, but it's worth a try to put quotes around each file/directory.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>