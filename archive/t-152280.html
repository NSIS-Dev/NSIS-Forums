<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" two directory pages question, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  two directory pages question NSIS Discussion" />
	
	<title> two directory pages question [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  two directory pages question</div>
<hr />
<div class="pda"><a href="t-152280.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=152280">two directory pages question</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jaschulz</div><div class="date">11th October 2003, 15:56</div></div><div class="posttext">I want two directory pages in the installer, one for the program and one for the data files.  I have this:<br />
<br />
!define MUI_DIRECTORYPAGE_TEXT '&quot;SetUp will install ${PRODUCT} in the Destination Folder \<br />
  shown below.$\r$\n$\r$\nTo select a different Destination Folder, Click Browse...&quot; \<br />
  &quot;Destination Folder: &quot;'<br />
  !define MUI_PAGE_HEADER_TEXT &quot;Program Install Location&quot;<br />
  !insertmacro MUI_PAGE_DIRECTORY<br />
  !define MUI_DIRECTORYPAGE_VARIABLE ${DATAINSTDIR}<br />
  !define MUI_PAGE_HEADER_TEXT &quot;Data Install Location&quot;<br />
  !define MUI_DIRECTORYPAGE_TEXT '&quot;SetUp will install the ${PRODUCT} data files in the Destination Folder \<br />
  shown below.$\r$\n$\r$\nTo select a different Destination Folder, Click Browse...&quot; \<br />
  &quot;Destination Folder: &quot;'<br />
  !insertmacro MUI_PAGE_DIRECTORY<br />
<br />
but that gets me an error on the second call to MUI_PAGE_DIRECTORY<br />
<br />
What am I doing wrong?<br />
<br />
Thanks.<br />
<br />
JAS<br />
<br />
P.S. ${DATAINSTDIR} is set to the My Documents folder in .OnInit</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">11th October 2003, 16:13</div></div><div class="posttext">Thanks, fixed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jaschulz</div><div class="date">11th October 2003, 16:57</div></div><div class="posttext">OK, but when I try to do NSIS update, it complains as follows:<br />
<br />
Initializing CVX update...<br />
cvs95 update: Empty password used - try 'cvs login' with a real password<br />
cvs95 update[aborted]: Error reading from server cvs.sourceforge.net: 0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">11th October 2003, 20:26</div></div><div class="posttext">Hopefully the NSIS project will be moved to the new CVS servers next week. The current public CVS data is very old, so in the meanwhile, use a development snapshot.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jaschulz</div><div class="date">11th October 2003, 20:45</div></div><div class="posttext">OK.  I downloaded the snapshot and ran the compiler again.  This time I got a new error.  In my &quot;pages&quot; section, the compiler complains at the marked line (below) the MUI_PAGE_HEADER_TEXT is already defined.<br />
<br />
here is my &quot;pages&quot; section (the error line is marked with ***ERROR***)<br />
<br />
;--------------------------------<br />
;Pages<br />
<br />
  !define MUI_WELCOMEPAGE_TITLE &quot;SetUp: ${PRODUCT} ${VERSION}&quot;<br />
  !define MUI_WELCOMEPAGE_TEXT &quot;This wizard will guide you through the installation of \<br />
    ${company}'s ${PRODUCT} software.\r\n\r\n\  We recommend that you close any currently \<br />
    running programs before proceeding with this installation.  This should make \<br />
    it possible to update relevant system files without requiring you to reboot your \<br />
    computer. \r\n\r\n\ Click Next to begin the installation process.&quot;<br />
  !insertmacro MUI_PAGE_WELCOME<br />
  !define MUI_LICENSEPAGE_CHECKBOX<br />
  !define MUI_LICENSEPAGE_CHECKBOX_TEXT &quot;I accept all the terms of the License Agreement.&quot;<br />
  !define MUI_LICENSEPAGE_TEXT_TOP &quot;Please review the all terms of the License Agreement: &quot;<br />
  !define MUI_LICENSEPAGE_TEXT '&quot;If you accept all the terms of the License Agreement, \<br />
  check the box below and then click CONTINUE \<br />
  to proceed with the installation.&quot; &quot;CONTINUE&quot;'<br />
  !define MUI_PAGE_HEADER_TEXT &quot;License Agreement&quot;<br />
  !define MUI_PAGE_HEADER_SUBTEXT &quot;${COMPANY} ${ADDRESS}&quot;<br />
  !insertmacro MUI_PAGE_LICENSE &quot;gaLicense.txt&quot;<br />
***ERROR***  !define MUI_PAGE_HEADER_TEXT &quot;Program Install Location&quot;<br />
  !define MUI_DIRECTORYPAGE_TEXT '&quot;SetUp will install ${PRODUCT} in the Destination Folder \<br />
  shown below.$\r$\n$\r$\nTo select a different Destination Folder, Click Browse...&quot; \<br />
  &quot;Destination Folder: &quot;'<br />
  !insertmacro MUI_PAGE_DIRECTORY<br />
  !define MUI_DIRECTORYPAGE_VARIABLE ${DATAINSTDIR}<br />
  !define MUI_PAGE_HEADER_TEXT &quot;Data Install Location&quot;<br />
  !define MUI_DIRECTORYPAGE_TEXT '&quot;SetUp will install the ${PRODUCT} data files in the Destination Folder \<br />
  shown below.$\r$\n$\r$\nTo select a different Destination Folder, Click Browse...&quot; \<br />
  &quot;Destination Folder: &quot;'<br />
  !insertmacro MUI_PAGE_DIRECTORY<br />
  !insertmacro MUI_PAGE_INSTFILES<br />
;  !define MUI_FINISHPAGE_TEXT_REBOOTNOW &quot;Reboot the computer now?&quot;<br />
;  !define MUI_FINISHPAGE_TEXT_REBOOTLATER &quot;Reboot the computer later?&quot;<br />
  !define MUI_FINISHPAGE_SHOWREADME &quot;$INSTDIR\TE.chm&quot;<br />
  !define MUI_FINISHPAGE_SHOWREADME_TEXT &quot;Show Installation Help&quot;<br />
  !insertmacro MUI_PAGE_FINISH<br />
  <br />
  !insertmacro MUI_UNPAGE_CONFIRM<br />
  !insertmacro MUI_UNPAGE_INSTFILES</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">11th October 2003, 21:49</div></div><div class="posttext">That's what I just fixed, are you sure your snapshot already contains the latest file? The snapshot is being updated 4 times a day.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jaschulz</div><div class="date">11th October 2003, 22:29</div></div><div class="posttext">The change log says there was a fix at 15:25 and the snapshot I just downloaded (which still gives the error) says 17:46</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jaschulz</div><div class="date">12th October 2003, 16:26</div></div><div class="posttext">I downloaded the snapshot this morning (Sunday), but I am still getting the same error (at macro line 23) as before.  Just to be sure, before I downloaded the snapshot this morning, I entirely deleted my NSIS files, but it didn't help.  Am I doing something wrong here?<br />
<br />
JAS</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">12th October 2003, 20:18</div></div><div class="posttext">Works fine for me. Can you attach your entire script?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jaschulz</div><div class="date">12th October 2003, 20:27</div></div><div class="posttext">Sure.  Here it is.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">12th October 2003, 21:13</div></div><div class="posttext">MUI_DIRECTORYPAGE_VARIABLE should be a variable like $R0 or $MYVAR (defined using the Var command). Then you can use StrCpy to set the default value in .onInit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jaschulz</div><div class="date">12th October 2003, 22:30</div></div><div class="posttext">Thanks.  I got it to work now.  I would suggest there should be something in the docs about this.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bugfix</div><div class="date">22nd October 2003, 21:13</div></div><div class="posttext">I would appriciate to have the final working script for this.<br />
I have been looking for an example of this in a very long time.<br />
So please upload the final running script <br />
<br />
THANX</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jaschulz</div><div class="date">23rd October 2003, 18:20</div></div><div class="posttext">OK.  Here it is:<br />
<br />
;NSIS Modern User Interface version 1.66<br />
;--------------------------------<br />
;Include Modern UI<br />
<br />
  !include &quot;MUI.nsh&quot;<br />
<br />
;--------------------------------<br />
;Configuration<br />
<br />
  ;General<br />
<br />
  Name &quot;Test NSIS&quot;<br />
  var DATAINSTDIR<br />
  !define VERSION &quot;v. 1.0&quot;<br />
  !define PRODUCT &quot;Test NSIS&quot;<br />
  !define SHORT_PRODUCT_NAME &quot;TN&quot;<br />
  !define COMPANY &quot;WiseWare&quot;<br />
  !define ADDRESS &quot;PO Box 2678780  Chicago, IL  60626-7870&quot;<br />
  !define COPYRIGHT &quot;Copyright Â© 2003 by ${COMPANY}&quot;<br />
  Caption &quot;${PRODUCT} ${VERSION}&quot;<br />
  OutFile &quot;TestNSIS.exe&quot;<br />
<br />
  ;Folder selection page<br />
<br />
  InstallDir &quot;$PROGRAMFILES\${COMPANY}\${PRODUCT}&quot;<br />
  <br />
  ;Get install folder from registry if available<br />
<br />
  InstallDirRegKey HKCU &quot;Software\${COMPANY}\${PRODUCT}&quot; &quot;&quot;<br />
<br />
;--------------------------------<br />
;Modern UI Configuration<br />
<br />
  !define MUI_ABORTWARNING<br />
<br />
;--------------------------------<br />
;Pages<br />
<br />
  !insertmacro MUI_PAGE_WELCOME<br />
  !insertmacro MUI_PAGE_LICENSE &quot;License.txt&quot;<br />
  !insertmacro MUI_PAGE_DIRECTORY<br />
  !define MUI_DIRECTORYPAGE_VARIABLE $DATAINSTDIR<br />
  !define MUI_PAGE_HEADER_TEXT &quot;Data Install Location&quot;<br />
  !define MUI_PAGE_HEADER_SUBTEXT &quot;Choose the folder in which to install the ${PRODUCT} data files.&quot;<br />
  !define MUI_DIRECTORYPAGE_TEXT '&quot;SetUp will install the ${PRODUCT} data files in the Destination Folder \<br />
  shown below.$\r$\n$\r$\nTo select a different Destination Folder, Click Browse...&quot; \<br />
  &quot;Destination Folder: &quot;'<br />
  !insertmacro MUI_PAGE_DIRECTORY<br />
  !insertmacro MUI_PAGE_INSTFILES<br />
  !insertmacro MUI_PAGE_FINISH<br />
  <br />
  !insertmacro MUI_UNPAGE_CONFIRM<br />
  !insertmacro MUI_UNPAGE_INSTFILES<br />
  <br />
;--------------------------------<br />
;Languages<br />
 <br />
  !insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
;--------------------------------<br />
;Installer Functions<br />
<br />
Function .onInit<br />
  ClearErrors<br />
  ReadRegStr $0 HKCU &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders&quot; Personal<br />
  StrCpy $DATAINSTDIR &quot;$0\${PRODUCT}&quot;<br />
FunctionEnd<br />
<br />
;--------------------------------<br />
;Installer Sections<br />
<br />
Section &quot;${SHORT_PRODUCT_NAME}.exe&quot; SecCopyUI<br />
<br />
  ;Establish install folder<br />
<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
<br />
  ;Extract the program file<br />
  <br />
  File &quot;${SHORT_PRODUCT_NAME}.exe&quot;<br />
<br />
  ;Establish data folder<br />
<br />
  SetOutPath &quot;$DATAINSTDIR&quot;<br />
<br />
  ;Extract the data file<br />
<br />
  File &quot;${SHORT_PRODUCT_NAME}.DAT&quot;<br />
<br />
  ;Write Registry Keys<br />
  <br />
  WriteRegStr   HKCU &quot;Software\${COMPANY}\${PRODUCT}&quot; &quot;&quot; $INSTDIR<br />
<br />
  WriteRegStr   HKCU &quot;Software\${COMPANY}\${PRODUCT}&quot; &quot;DataDir&quot; $DATAINSTDIR<br />
<br />
  ;Add Application to Add/Remove Programs<br />
<br />
  WriteRegStr HKCU &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT}&quot; &quot;DisplayName&quot; &quot;${PRODUCT}&quot;<br />
  WriteRegStr HKCU &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT}&quot; &quot;UninstallString&quot; '&quot;$INSTDIR\Uninstall${SHORT_PRODUCT_NAME}.exe&quot;'<br />
  WriteRegDWord HKCU &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT}&quot; &quot;NoModify&quot; 1<br />
  WriteRegDWord HKCU &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT}&quot; &quot;NoRepair&quot; 1<br />
  <br />
  ;Create uninstaller<br />
<br />
  WriteUninstaller &quot;$INSTDIR\Uninstall${SHORT_PRODUCT_NAME}.exe&quot;<br />
<br />
SectionEnd<br />
<br />
;--------------------------------<br />
;Uninstaller Section<br />
<br />
Section &quot;Uninstall&quot;<br />
<br />
  ;Delete the program<br />
<br />
  Delete /REBOOTOK &quot;$INSTDIR\${SHORT_PRODUCT_NAME}.exe&quot;<br />
  <br />
  ;Delete the uninstaller<br />
  <br />
  Delete &quot;$INSTDIR\Uninstall${SHORT_PRODUCT_NAME}.exe&quot;<br />
<br />
  ;Remove the install folder<br />
  <br />
  RMDir &quot;$INSTDIR&quot;<br />
<br />
  ; Delete the registry keys<br />
  DeleteRegKey HKCU &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT}&quot;<br />
  DeleteRegKey /ifempty HKCU &quot;Software\${COMPANY}\${PRODUCT}&quot;<br />
  DeleteRegKey /ifempty HKCU &quot;Software\${COMPANY}&quot;<br />
<br />
SectionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>