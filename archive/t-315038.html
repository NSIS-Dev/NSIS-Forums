<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" exdll plugin made with MSVC9 does not work on W98, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  exdll plugin made with MSVC9 does not work on W98 NSIS Discussion" />
	
	<title> exdll plugin made with MSVC9 does not work on W98 [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  exdll plugin made with MSVC9 does not work on W98</div>
<hr />
<div class="pda"><a href="t-315038.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=315038">exdll plugin made with MSVC9 does not work on W98</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">davo123</div><div class="date">2nd December 2009, 07:28</div></div><div class="posttext">I have been using a simple plug-in DLL with NSIS for years. It displays a simple dialog box, accepts passwords, makes some checks on registry entries (plus some other 'magic'). If I compile the DLL using MSVC5 (1997) the installation program works on all Windows OS including W98 and even W95. But if I re-compile the DLL using the upgraded (sic) MSVC9 (2008) the installation program will not work on W98.<br />
<br />
I've searched google and tried every phrase I can think of in the WinAmp search options.<br />
<br />
I can make DLLs and executables using MSVC9 that work perfectly OK on W98. I have set the compiler not to use Unicode, use the /MT option so it doesn't require the C run time, even fixed the DLL executable with Legacy Extender so it fixes the MSVC9 &quot;feature&quot; that stops executables working on W95 variants. These settings will make an executable that works on W98. But if I incorporate the DLL into a NSIS installer, it locks up the W98 system as soon as any call is made using *any* MyDLL::MyFunc-style command, with or without a dialog. The plug-in DLL is made using the proper exdll.c/h files provided. I have NSIS 2.38.<br />
<br />
Anyone else had this problem on W98 or know the correct settings for MSVC9? I know I could use another compiler, but I'd like to make this work with MSVC9, if possible.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd December 2009, 10:12</div></div><div class="posttext">Have you tried running dumpbin.exe on the DLL and looking for anything funny? Probably one of the /RTC options need to be disabled, or just all of them with /GZ- (http://msdn.microsoft.com/en-us/library/hddybs7t%28VS.71%29.aspx).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">davo123</div><div class="date">2nd December 2009, 10:46</div></div><div class="posttext">I've used CFF Explorer and there's nothing obviously amiss. I write many DLLs using MSVC9 that work very well on W98. I'd like to think I know all the settings and fixes to do. It's the distribution of these programs to end users on W98 that worries me.<br />
<br />
Since writing the first post, I've done some more tests using the provided exdll.c/h files and a simple test script:<br />
<br />
Name &quot;Test exdll plug in&quot;<br />
!addplugindir &quot;.&quot;<br />
outfile testexdll.exe<br />
Section Test<br />
   StrCpy $0 &quot;Hello world&quot;<br />
	DetailPrint &quot;About to call myFunction: $0&quot;<br />
	exdll::myFunction<br />
SectionEnd<br />
<br />
1. If I compile exdll.dll (using simpler, old 2003 versions of the source code) using MSVC5, it will work OK on W98.<br />
<br />
2. If I compile exdll.dll using Pelles C, it will work but then give me a GPF error before exiting.<br />
<br />
3. If I compile using MSVC9 without using Legacy Extender, it gives an error message that the DLL could not be loaded.<br />
<br />
4. If I use Legacy Extender on exdll.dll, it hangs in W98 immediately the first call is made to exdll:MyFunction.<br />
<br />
Then I downloaded the latest version of NSIS (2.45). This includes an MSVC2008 (=MSVC9) project file (but oh joy, now we have to include a .lib file, so we can't even compile it on anything else --  not a clever move, guys!). <br />
<br />
5. I compile the new exdll source using MSVC9, remake the script, but get the same error as in (3) above on W98. <br />
<br />
6. If I recompile the test NSIS script using the original exdll.dll made in (1) using the latest NSIS, it works OK in W98.<br />
<br />
I'd very much like to continue using NSIS to distribute my programs to end users who may well still be using W98. Our friends at MS do not seem to be making this easy. I know the world moves on, but there are still customers out there!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd December 2009, 11:09</div></div><div class="posttext">What does Dependency Walker say when profiling the loading process?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">davo123</div><div class="date">2nd December 2009, 22:29</div></div><div class="posttext">Solved it. And of course I was the culprit. There are *two* changes you have to make in MSVC9 to use Legacy Extender and I'd missed out one. Hence the system crash in W98. My punishment has been to waste the last 24 hours trying to fix it. They are setting up the flogging frame already.<br />
<br />
Thanks to kichik for the suggestions and, of course, to the guys at NSIS for a great tool. Here's what I've learned to make sure it works on legacy W98 systems (and presumably W95 and WMe, too):<br />
<br />
1. If you want to use a plug-in DLL with your installation then either:<br />
<br />
(a) Compile the DLL with MSVC6 or earlier (don't know about MSVC7); or<br />
<br />
(b) Compile with MSVC8 (VS2005+) or above but then use Cloanto's Legacy Extender to &quot;fix&quot; the DLL (http://www.legacyextender.com/) <br />
<br />
2. Read their Project Configuration instructions properly! If you don't make the Legacy Extender fixes, you will just get a message that temp\xxx.DLL did not work.<br />
<br />
3. The old 2003 exdll.c/h files still work perfectly well on all systems. You don't need to use the complications of pluginapi.lib, etc.<br />
<br />
If anyone knows the settings to make a DLL compatible with both NSIS and W98 using Pelles C or MinGW, I'm sure we'd all be grateful to hear.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>