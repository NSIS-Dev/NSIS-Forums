<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" On my travels..., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  On my travels... NSIS Discussion" />
	
	<title> On my travels... [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  On my travels...</div>
<hr />
<div class="pda"><a href="t-225381.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=225381">On my travels...</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">7th September 2005, 06:49</div></div><div class="posttext">I have been playing around with the UI exes with resource hacker and I have noticed some (I call them features) bugs relating to the verify dialog. If you add a title bar, the dialog shows up on the instfiles page when the percent comes up (if you don't use solid compression the dialog pops up for each command).<br />
<br />
And a request. To have a .onverify function so you can maipulate the verify dialog after the crc check has been done. So you can set the text on the label to show different actions being done. And when the function ends, the dialog disappears.<br />
<br />
I hope this is implemented (it probably won't) but I thought I would try.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th September 2005, 17:52</div></div><div class="posttext">It probably appeared because you've set the WS_VISIBLE flag to the dialog. The dialog is almost always created, but the default is being invisible. When you've added WS_VISIBLE, it also showed up when it was created.<br />
<br />
.onVerify, as you've requested, can not be added. When the CRC verification dialog shows, the code has not yet been unpacked. It is also unverified. You can use the Banner plug-in which shows the verification dialog with custom text.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">9th September 2005, 04:16</div></div><div class="posttext">Thanks for that. I will check it out. I also forgot to mention this. If a function is not used, the code in the function is zeroed, right? How about the same for unused macros?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th September 2005, 09:28</div></div><div class="posttext">If a macro is not used, it's not used. Its code will not be compiled.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">11th September 2005, 22:52</div></div><div class="posttext">Also for BgGradient if you could have an extra optional field to specify if the gradient is in a dialog in the background. I am currently working on a dll for my UI that has this in it (text with a drop shadow but no gradient). This would be nice for the next version.<br />
I have also gone back to using 2.07 - I will upgrade as soon as 2.1 is released. Oh and I have upgraded to XP Professional and it's great. No more computer slowdowns.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th September 2005, 18:08</div></div><div class="posttext">You can simply specify the same color for both the starting and ending color. This way, no gradient will appear.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">14th September 2005, 06:17</div></div><div class="posttext">What I meant by BgGradient in a dialog was... well... see the attached picture.<br />
<br />
Now all that's needed is a black drop shadow for the text.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">14th September 2005, 06:22</div></div><div class="posttext">Doh! Forgot to add it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">14th September 2005, 14:29</div></div><div class="posttext">You can create the drop shadow yourself by adding the same text offset a couple of pixels to the right and bottom before adding the text.<br />
Other than that I don't understand what you mean by: <br />
an extra optional field to specify if the gradient is in a dialog in the background</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">15th September 2005, 00:15</div></div><div class="posttext">an extra optional field to specify if the gradient is in a dialog in the backgroundSee the bitmap? I have added a title and a frame around the border of the bitmap. I added the title and the frame manually to show what I wanted in the next version (or my dll). <br />
<br />
Example:<br />
<br />
BgGradient 000000 0000FF FFFFFF &quot;Text&quot; /SHOWFRAME /SHOWDROP<br />
<br />
/SHOWFRAME is for showing the title and frame around the gradient (optional).<br />
/SHOWDROP would be for showing a shadow behind the text (optional).<br />
<br />
Hopefully now you know what I mean.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">15th September 2005, 03:48</div></div><div class="posttext">Well then, you need to add an additional field for the dropshadow color.<br />
What if the user specified black text? Or if the gradient colors are black and black?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">21st September 2005, 05:41</div></div><div class="posttext">I didn't relise you were talking about the source in nsis, I thought it was in the dll (duh). Anyway, I got the window to appear in my dll in the weekend. The window would not appear for a long time and kept giving me a fatal error when I ran the dll in a sample nsis installer. Then I relised I forgot the /nounload switch when calling the dll. I kept thinking my programming was bad. Oh well, I will have a look at the source and see what I can do.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">24th September 2005, 05:21</div></div><div class="posttext">Well, I have adapted the code from the BgImage plugin and got what I needed, but there is no title or proper icon showing in the titlebar. I tried using different icons and default windows icons but that didn't work. I tried adding the caption in the source code but that caused the plugin to not show at all. I tried adding the caption manually though a test script but that did not work either. The window also shows in the taskbar (I don't want it to). I made a basic plugin that displays a dialog template and nsis automatically adds the icon to it. And the caption appears as well. <br />
<br />
I have attached a zip of the modified BgImage source code. I suggest copying a source distribution, copy the bgimage.cpp to the source and compile using scons (if you want to have a go at fixing this problem).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">5th October 2005, 04:10</div></div><div class="posttext">My Plugin Demo (http://forums.winamp.com/showthread.php?s=&amp;threadid=223443)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">13th October 2005, 23:36</div></div><div class="posttext">Ok, a few questions:<br />
<br />
1. <br />
I have thought of an idea for the unload plugins flag. Currently the plugin unloading has two options:<br />
manual or alwaysoff. <br />
I was thinking of adding a 'force' option. This option is basicly the same as the alwaysoff option but when calling a dll function you can have the /FORCEUNLOAD parameter on it to force it to unload. <br />
<br />
2.<br />
How about an extra parameter on the page command? Example:<br />
page instfiles [pre] [show] [leave] [rect]<br />
where rect is the custom dialog control to display the page in (the default is 1018. I would like to be able to change it so I can have pages displayed in different locations in the window - this will help in my InstallSpider UI).<br />
<br />
3.<br />
Is there any way to get the info off the instfiles page and use it in my own custom (dll made) instfiles page?<br />
<br />
4.<br />
I can't set the icon on my background window. If I use a dialog template it appears but the dialog has no border and has a space at the top (presumably where the menu would have gone). I have tried setting it in my dll and nsis but nothing works (I just thought of another possibility - I will reply when I have tried it). Currently I am using no icon (no WS_SYSMENU in the window config).<br />
<br />
And now for a magic trick. If you add this line to your installer:<br />
caption &quot;$(^SetupCaption)&quot;<br />
your installer will not run at all! (this is a bug). This line works:<br />
caption &quot;$(^Name) Setup)&quot;.<br />
I have not tried this in the lastest versions of NSIS (still using 2.07).<br />
<br />
Cheers, Jason.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th October 2005, 13:49</div></div><div class="posttext">Why would you ever want to forcibly unload a plug-in that way? Calling FreeLibrary more times than you've called LoadLibrary will most probably generate a crash. Add a feature request (http://sourceforge.net/tracker/?group_id=22049&amp;atid=373088). You can hook the instfiles dialog using a plug-in. If I understand you correctly, you're talking about a background window that was once used by NSIS. If it was used, you can find code to create it in CVS. This code:Caption &quot;$(^SetupCaption)&quot;rightfully generates the following error for me:Error: LangString ^SetupCaption is recursive!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">18th October 2005, 00:16</div></div><div class="posttext">For the instfiles dialog, I have tried using something similar to the banner plugin in my dll and that did not work. If you could post an example with source code, I can integrate it into my dll (therefore avoiding me having to write alot more code to manually move the progress bar and set the detailprint - I am still new to C/C++). <br />
<br />
I have also made a completely new abort to finish system in my user interface - I am not revealing any more about it no matter how much you beg me :).<br />
<br />
edit: I forgot to mention, would it be possible during the crc check to move a progress bar (which is put in manually)? I have one on my UI and I was just wondering if this could be added (if you have a huge installer (700MB) the crc check stays for about 10-20 seconds and I would like somthing to be happening during the check).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th October 2005, 13:11</div></div><div class="posttext">To change the instfiles page, you'd have to subclass, and probably hide, the original progress bar. Then you'd have to forward any PBM_SETPOS message it gets to your progress bar. The code that handles it is available on the top of the exec.c file.<br />
<br />
To move a progress bar in the CRC dialog you'd have to change the source code of NSIS itself (fileform.c). No script is ran and so no plug-in is extracted, until the CRC check completes. But something is moving. It shows the progress using percentages.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">22nd October 2005, 02:48</div></div><div class="posttext">Well, I am going to reinvent the wheel (so to speak), and make a completely new section system in my UI. Basically it is the normal section commands disguised by the UI with extra code added. This will automatically move the progress bar if the user wants to use the custom instfiles page I have made. I will also use a VB6 Active X progress bar like the ones use on the InstallShie1d installers. I have probably revealed to much about my UI in this thread :) (I was trying to keep quiet about it).<br />
<br />
One more question: Would I be able to read the license file text into nsis, and then set it (using sendmessage) to the text control on an installoptions page? Or is there another way to display the license text in an installoptions page?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd October 2005, 10:46</div></div><div class="posttext">Originally posted by JasonFriday13 <br />
One more question: Would I be able to read the license file text into nsis, and then set it (using sendmessage) to the text control on an installoptions page? Or is there another way to display the license text in an installoptions page? You can, but you'll need a plug-in, like System, to avoid the 1024 characters limit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">14th November 2005, 23:38</div></div><div class="posttext">Mayby I didn't explain correctly what I wanted with plugin unloading. I want it the same as it is now, but if you set SetPluginsUnload to alwaysoff, the plugins never unload, correct? So if I wanted an /UNLOAD flag on a dll call, it would call loadlibrary, call the exported function from the dll, then the /UNLOAD flag unloads the dll from memory after the function returns.<br />
<br />
For anyone who compiles 150MB+ installers and have the crc check on, I have added three lines of code to fileform.c and the result is the verify dialog moves a progress bar during the crc check. The ripoff is that it adds 500 to 1000 bytes of data to the stubs :( . Anyway, I have included fileform.c in the attachment along with the compiled stubs for people who don't want to recompile NSIS.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">14th November 2005, 23:42</div></div><div class="posttext">Also, I have made a simple program that convert RGB, eg. 255 0 255, to hexadecimal, eg. FF00FF. This little app has no license, so you can do what ever you like with it. This app was made in VB6 (you must have the vb runtimes to run this app).</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>