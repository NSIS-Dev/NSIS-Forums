<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Language select, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Language select NSIS Discussion" />
	
	<title> Language select [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Language select</div>
<hr />
<div class="pda"><a href="t-188202.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=188202">Language select</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Freezerman350</div><div class="date">29th July 2004, 16:07</div></div><div class="posttext">Hello, <br />
it is possible to choose by default the &quot;lang&quot; of my windows...<br />
<br />
for exemple if my windows is a english windows english is select..<br />
<br />
french --&gt;  french...<br />
<br />
Thx !</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">29th July 2004, 16:51</div></div><div class="posttext">That is already the default behavior.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Freezerman350</div><div class="date">29th July 2004, 16:53</div></div><div class="posttext">....but i got 2 windows the first is in french athe second is in english<br />
<br />
and both are showing my program with french in default !!!!<br />
....  this is my problem !</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Freezerman350</div><div class="date">29th July 2004, 17:21</div></div><div class="posttext">please help me !</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th July 2004, 17:43</div></div><div class="posttext">Please attach your script(s).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Freezerman350</div><div class="date">29th July 2004, 19:30</div></div><div class="posttext">this is my script during the   <br />
oninit <br />
<br />
<br />
;Demande du language au début<br />
  StrCmp $LANGUAGE ${LANG_ENGLISH} french english<br />
  french:<br />
  StrCpy $R0 &quot;Select your Windows sytem language.$\rChoisissez la langue de votre systeme Windows.&quot;<br />
  StrCpy $R1 &quot;Install language / Langue d'installation&quot;<br />
  Goto end<br />
  english:<br />
  StrCpy $R0 &quot;Select your Windows sytem language.$\rChoisissez la langue de votre systeme Windows.&quot;<br />
  StrCpy $R1 &quot;Install language / Langue d'installation&quot;<br />
  end:<br />
  !Define MUI_LANGDLL_WINDOWTITLE $R1<br />
  !Define MUI_LANGDLL_INFO $R0<br />
<br />
<br />
<br />
<br />
presently i put both language in french and in english...because my if dont wanna work</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2004, 12:20</div></div><div class="posttext">Why on earth are you doing it like that?<br />
That will not work.<br />
<br />
Try this:<br />
<br />
;Demande du language au début<br />
StrCmp $LANGUAGE ${LANG_ENGLISH} french english<br />
french:<br />
StrCpy $R0 &quot;Choisissez la langue de votre systeme Windows.&quot;<br />
StrCpy $R1 &quot;Langue d'installation&quot;<br />
Goto end<br />
english:<br />
StrCpy $R0 &quot;Select your Windows sytem language.&quot;<br />
StrCpy $R1 &quot;Install language&quot;<br />
end:<br />
!Define MUI_LANGDLL_WINDOWTITLE $R1<br />
!Define MUI_LANGDLL_INFO $R0<br />
<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Freezerman350</div><div class="date">30th July 2004, 14:24</div></div><div class="posttext">Hey stu, i'm not stupid....so i suppose<br />
<br />
<br />
I try your method and the page is always in english.<br />
if you change the if by <br />
--&gt; StrCmp $LANGUAGE ${LANG_FRENCH} french english<br />
the page will be always in french, no matter the language of the windows<br />
<br />
The only reason of WHY I do the stupid thing of putting together french and english on each is because the compagny need the installer for today and they wanna see the message in english and in french<br />
<br />
the best solution is depending of the system but, for a time question i put french and english together</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2004, 15:22</div></div><div class="posttext">Have you looked at languages.nsi in Examples (or the Modern UI equiv.)<br />
<br />
I've never written a multi-linqual installer, but I'll have a go at making a working example.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2004, 15:30</div></div><div class="posttext">!include &quot;MUI.nsh&quot;<br />
  Name &quot;Modern UI Test 1.70&quot;<br />
  OutFile &quot;MultiLanguage.exe&quot;<br />
<br />
  !insertmacro MUI_PAGE_INSTFILES<br />
<br />
  !insertmacro MUI_LANGUAGE &quot;English&quot;<br />
  !insertmacro MUI_LANGUAGE &quot;French&quot;<br />
<br />
Section<br />
DetailPrint $LANGUAGE<br />
DetailPrint ${LANG_ENGLISH}<br />
SectionEnd<br />
Tried this, and it shows that the $LANGUAGE is ${LANG_ENGLISH}<br />
<br />
I don't see why it isn't working for you.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">30th July 2004, 15:41</div></div><div class="posttext">have you had a look at this function (http://nsis.sourceforge.net/archive/viewpage.php?pageid=278) from the  archive (http://nsis.sourceforge.net/archive/nsisweb.php)?<br />
<br />
other than that, you might make the user select the language using LangDLL (http://nsis.sourceforge.net/Docs/Chapter4.html#4.10.2). as afrow pointed out, you can find it used in the languages.nsi (http://nsis.sourceforge.net/Examples/languages.nsi)  example.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Freezerman350</div><div class="date">30th July 2004, 15:54</div></div><div class="posttext">Lokk at this<br />
<br />
this is my problem !<br />
<br />
<br />
<br />
http://www.easydeal.qc.ca/test.jpg</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2004, 16:23</div></div><div class="posttext">Ahhh....<br />
Ok. Try the Modern UI example in Examples\Modern UI\MultiLanguage.nsi<br />
<br />
That also uses the LangDLL<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Freezerman350</div><div class="date">30th July 2004, 16:54</div></div><div class="posttext">Again !<br />
<br />
now in modern IU<br />
<br />
<br />
http://www.easydeal.qc.ca/test2.jpg</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2004, 17:05</div></div><div class="posttext">Hmm. Ok, open up MultiLanguage.nsi, and replace .onInit function with:<br />
<br />
Function .onInit<br />
<br />
  MessageBox MB_OK $LANGUAGE<br />
  !insertmacro MUI_LANGDLL_DISPLAY<br />
<br />
FunctionEnd<br />
<br />
If the message box displays '1033' (English) then there's difinately a problem.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Freezerman350</div><div class="date">30th July 2004, 17:08</div></div><div class="posttext">1036</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2004, 17:32</div></div><div class="posttext">Ok, in that case it's working fine (1036 == French)<br />
<br />
Could you attach your whole script file.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th July 2004, 17:35</div></div><div class="posttext">No. Don't attach your script.<br />
<br />
That's how LangDLL works. It displays some text asking for the user to select the language and a combo box with available languages. The text doesn't change according to the currently selected language.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Freezerman350</div><div class="date">30th July 2004, 17:39</div></div><div class="posttext">Ok but dont pay attention on the oninit ...<br />
<br />
<br />
;NSIS Modern User Interface version 1.70<br />
;ADNT - EASYDEAL<br />
;Written by Olivier Duval-Montminy<br />
<br />
;---------------------------------------------------------------------------------------<br />
;Include Modern UI<br />
<br />
  !include &quot;MUI.nsh&quot;<br />
<br />
;---------------------------------------------------------------------------------------<br />
;General<br />
<br />
  ;Name and file<br />
  Name &quot;EasyDeal&quot;<br />
;Icone<br />
  !define MUI_ICON &quot;.\graphics\Icone.ico&quot; <br />
  !define MUI_UNICON &quot;.\graphics\Icone.ico&quot;<br />
  <br />
<br />
  OutFile &quot;EasyDeal_Installer.exe&quot;<br />
;Titre bas dans les pages<br />
  BrandingText /TRIMRIGHT &quot;Powered by A.D.N.T. Inc&quot;<br />
<br />
<br />
  ;Default installation folder<br />
  InstallDir &quot;C:\EASYDEAL&quot;<br />
  <br />
  ;Get installation folder from registry if available<br />
  InstallDirRegKey HKCU &quot;Software\EASYDEAL&quot; &quot;&quot;<br />
<br />
;---------------------------------------------------------------------------------------<br />
;Interface Configuration<br />
;Déclaration des image de header et wizard<br />
  !define MUI_HEADERIMAGE<br />
  !define MUI_HEADERIMAGE_BITMAP &quot;.\Graphics\header.bmp&quot; <br />
  !define MUI_WELCOMEFINISHPAGE_BITMAP &quot;.\Graphics\arrow.bmp&quot;<br />
  <br />
;---------------------------------------------------------------------------------------<br />
;Interface Settings<br />
<br />
  ;!define MUI_ABORTWARNING<br />
<br />
;---------------------------------------------------------------------------------------<br />
;Language Selection Dialog Settings<br />
<br />
  ;Remember the installer language<br />
  ;!define MUI_LANGDLL_REGISTRY_ROOT &quot;HKCU&quot; <br />
  ;!define MUI_LANGDLL_REGISTRY_KEY &quot;Software\EASYDEAL&quot; <br />
  ;!define MUI_LANGDLL_REGISTRY_VALUENAME &quot;Installer Language&quot;<br />
<br />
 <br />
<br />
;---------------------------------------------------------------------------------------<br />
;Pages<br />
<br />
  !insertmacro MUI_PAGE_WELCOME<br />
<br />
   <br />
 <br />
  !insertmacro MUI_PAGE_LICENSE $(License1)<br />
<br />
  Page custom CustomPage1<br />
<br />
  !insertmacro MUI_PAGE_COMPONENTS<br />
<br />
  Page custom CustomPage2<br />
<br />
  !insertmacro MUI_PAGE_INSTFILES<br />
  !insertmacro MUI_PAGE_FINISH<br />
  <br />
  !insertmacro MUI_UNPAGE_WELCOME<br />
  !insertmacro MUI_UNPAGE_CONFIRM<br />
  !insertmacro MUI_UNPAGE_INSTFILES<br />
  !insertmacro MUI_UNPAGE_FINISH<br />
;---------------------------------------------------------------------------------------<br />
;Languages<br />
  !insertmacro MUI_LANGUAGE &quot;English&quot;<br />
  !insertmacro MUI_LANGUAGE &quot;French&quot;<br />
  !insertmacro MUI_RESERVEFILE_LANGDLL  <br />
 LicenseLangString License1 ${LANG_ENGLISH} &quot;.\licenseA.txt&quot; <br />
   LicenseLangString License1 ${LANG_FRENCH} &quot;.\licenseF.txt&quot;  <br />
<br />
;---------------------------------------------------------------------------------------<br />
;Reserve Files<br />
  <br />
  ;These files should be inserted before other files in the data block<br />
  ;Keep these lines before any File command<br />
  ;Only for solid compression (by default, solid compression is enabled for BZIP2 and LZMA)<br />
<br />
  ReserveFile &quot;OPT.ini&quot;<br />
  ReserveFile &quot;RT.ini&quot;<br />
  <br />
<br />
;---------------------------------------------------------------------------------------<br />
;Variables<br />
<br />
  Var INI_VALUE<br />
  Var INI_VALUE1<br />
<br />
;---------------------------------------------------------------------------------------<br />
;Installer Sections<br />
<br />
Section &quot;EasyDeal&quot; SecED<br />
SectionIn RO<br />
<br />
;#=#=#=#=#=#=#=#=#=#=#=#==#=#=#= INSTALL #=#=#=#=#=#=#=#=#=#=#=#==#=#=#=<br />
<br />
  ;Read a value from an InstallOptions INI file<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $INI_VALUE &quot;OPT.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $INI_VALUE1 &quot;OPT.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
<br />
;SERVER ET CLIENT<br />
SetOutPath &quot;$INSTDIR&quot;<br />
;################################## fichier info ##############################<br />
GetTempFileName $R0<br />
  File /oname=$R0 &quot;info.exe&quot;<br />
<br />
        <br />
<br />
<br />
	FileOpen $3 &quot;system_info.txt&quot; &quot;w&quot;<br />
        ReadRegStr $1 HKLM &quot;System\CurrentControlSet\control\ComputerName\ComputerName&quot; &quot;Computername&quot;<br />
        FileWrite  $3 'Computer name : $1$\r$\n$\r$\n$\r$\n'<br />
        FileWrite $3 '-----------------------------------------------------------$\r$\n$\r$\n'<br />
	nsExec::ExecToStack '&quot;$R0&quot; info os'<br />
	Pop $0 # return value/error/timeout<br />
	Pop $1 # printed text, up to ${NSIS_MAX_STRLEN}<br />
	FileWrite $3 'Some os details:$\r$\n$\r$\n'<br />
        FileWrite $3 '$1$\r$\n$\r$\n$\r$\n'<br />
        FileWrite $3 '-----------------------------------------------------------$\r$\n$\r$\n'<br />
        <br />
<br />
<br />
	nsExec::ExecToStack '&quot;$R0&quot; info disk'<br />
	Pop $0 # return value/error/timeout<br />
	Pop $1 # printed text, up to ${NSIS_MAX_STRLEN}<br />
	FileWrite $3 'Some disk details:$\r$\n$\r$\n'<br />
        FileWrite $3 '$1$\r$\n$\r$\n$\r$\n'<br />
        FileWrite $3 '-----------------------------------------------------------$\r$\n$\r$\n'<br />
<br />
	nsExec::ExecToStack '&quot;$R0&quot; info cd'<br />
	Pop $0 # return value/error/timeout<br />
	Pop $1 # printed text, up to ${NSIS_MAX_STRLEN}<br />
	FileWrite $3 'Some CD details:$\r$\n$\r$\n'<br />
        FileWrite $3 '$1$\r$\n$\r$\n$\r$\n'<br />
<br />
        FileWrite $3 '-----------------------------------------------------------$\r$\n$\r$\n'<br />
	nsExec::ExecToStack '&quot;$R0&quot; info video'<br />
	Pop $0 # return value/error/timeout<br />
	Pop $1 # printed text, up to ${NSIS_MAX_STRLEN}<br />
	FileWrite $3 'Some video details:$\r$\n$\r$\n'<br />
        FileWrite $3 '$1$\r$\n$\r$\n$\r$\n'	<br />
	FileClose $3<br />
<br />
	<br />
<br />
  GetTempFileName $R1<br />
<br />
  Delete $R1<br />
;################################## fichier info ##############################<br />
<br />
SetOutPath &quot;$SYSDIR&quot;<br />
<br />
   File &quot;dll\*.*&quot;<br />
<br />
<br />
SetOutPath &quot;$DESKTOP&quot;<br />
<br />
   File &quot;bureau\*.*&quot;<br />
<br />
SetOutPath &quot;$INSTDIR&quot;<br />
<br />
   File &quot;easydeal\*.*&quot;<br />
<br />
;CLIENT<br />
  ;Display a messagebox if check box was checked<br />
  StrCmp $INI_VALUE1 &quot;1&quot; ifClient<br />
    File &quot;client.txt&quot;<br />
  ifClient:<br />
<br />
;SERVER<br />
  StrCmp $INI_VALUE &quot;1&quot; ifServer<br />
<br />
    SetOutPath &quot;c:\dataeasydeal&quot;<br />
    File &quot;dataeasydeal\*.*&quot;<br />
<br />
    SetOutPath &quot;$SMPROGRAMS\Startup&quot;<br />
    File &quot;bureau\*.*&quot;<br />
<br />
    SetOutPath &quot;$SMPROGRAMS\Démarrage&quot;<br />
    File &quot;bureau\*.*&quot;<br />
<br />
    SetOutPath &quot;c:\dataeasydeal\AnalyseF&quot;<br />
    File &quot;analyseF\*.*&quot;<br />
<br />
    ;==================PARTAGE VÉRIF WIN==========================<br />
     StrCpy $1 &quot;$windir&quot;<br />
     IfFileExists &quot;$1\winver.exe&quot; +2<br />
     StrCpy $1 &quot;$sysdir&quot;<br />
     GetDllVersion &quot;$1\winver.exe&quot; $R0 $R1<br />
     IntOp $R2 $R0 / 0x00010000<br />
     IntOp $R3 $R0 &amp; 0x0000FFFF<br />
     IntOp $R4 $R1 / 0x00010000<br />
     IntOp $R5 $R1 &amp; 0x0000FFFF<br />
     StrCpy $0 &quot;$R2.$R3.$R4.$R5&quot;<br />
<br />
     StrCmp $0 '5.1.2600.0' WinXP NotWinXP<br />
     WinXP:<br />
     messagebox mb_ok &quot;DataEasyDeal -- Partagé/Share&quot;<br />
     nsExec::Exec 'net share dataeasydeal=c:\dataeasydeal'<br />
     NotWinXP:<br />
<br />
     StrCmp $0 '4.0.1381.336' WinNT NotWinNT<br />
     WinNT:<br />
        messagebox mb_ok &quot;DataEasyDeal -- non Partagé/ not Share&quot;<br />
     NotWinNT:<br />
<br />
     StrCmp $0 '5.0.2195.6703' Win2000 NotWin2000<br />
     Win2000:<br />
        messagebox mb_ok &quot;DataEasyDeal -- Partagé/Share&quot;<br />
        nsExec::Exec 'net share dataeasydeal=c:\dataeasydeal'<br />
     NotWin2000:<br />
<br />
     StrCmp $0 '5.2.3790.0' Win2003 NotWin2003<br />
     Win2003:<br />
        messagebox mb_ok &quot;DataEasyDeal -- Partagé/Share&quot;<br />
        nsExec::Exec 'net share dataeasydeal=c:\dataeasydeal'<br />
     NotWin2003:<br />
<br />
     StrCmp $0 '4.10.0.2222' Win98 NotWin98<br />
     Win98:<br />
        messagebox mb_ok &quot;DataEasyDeal -- non Partagé/ not Share&quot;<br />
     NotWin98:<br />
<br />
     ; 2003 = 5.2.3790.0<br />
     ;   XP = 5.1.2600.0<br />
     ;   2K = 5.0.2195.6703<br />
     ;   NT = 4.0.1381.336<br />
     ;   ME = 4.90.0.3000<br />
     ; 98SE = 4.10.0.2222<br />
     ;   98 = 4.10.0.1998<br />
     ; 95S2 = ???<br />
     ;   95 = 4.00.950 <br />
    ;=============================================================<br />
<br />
<br />
    ReadRegStr $1 HKLM &quot;System\CurrentControlSet\control\ComputerName\ComputerName&quot; &quot;Computername&quot;<br />
<br />
    StrCmp $LANGUAGE ${LANG_ENGLISH} 0 notEnglish<br />
       MessageBox MB_OK  &quot;Server name : $1&quot;<br />
    notEnglish:<br />
<br />
    StrCmp $LANGUAGE ${LANG_FRENCH} 0 notFrench<br />
       MessageBox MB_OK  &quot;Nom du serveur : $1&quot;<br />
    notFrench:<br />
  ifServer:<br />
<br />
<br />
;CLIENT SERVER<br />
<br />
;Supression de la clé de reboot à la fin de l'installation non éffacer su ART a redémarrer avant<br />
 DeleteRegKey /ifempty HKCU &quot;Software\Microsoft\Windows\CurrentVersion\RunOnce&quot;<br />
<br />
<br />
  <br />
  ;Store installation folder and exe path<br />
  WriteRegStr HKCU &quot;Software\EASYDEAL&quot; &quot;dirpath&quot; $EXEDIR<br />
  WriteRegStr HKCU &quot;Software\EASYDEAL&quot; &quot;folder&quot; $INSTDIR<br />
  <br />
  <br />
  ;Create uninstaller<br />
  WriteUninstaller &quot;$INSTDIR\Uninstall.exe&quot;<br />
<br />
SectionEnd<br />
;#=#=#=#=#=#=#=#=#=#=#=#==#=#=#= INSTALL #=#=#=#=#=#=#=#=#=#=#=#==#=#=#=<br />
;---------------------------------------------------------------------------------------<br />
;Installer Functions<br />
<br />
Function .onInit<br />
MessageBox MB_OK  &quot;ATTENTION AVANT DE PROCÉDER À L'INSTALLATION$\n$\r$\n$\rVous devez confirmer si votre système Windows est en version française ou anglaise, pour ce faire, vous devez regarder au bas à gauche de votre écran si le bouton affiche 'Démarrer' (Version française) ou 'Start' (English version)$\n$\r$\n$\r$\n$\r$\n$\rATTENTION BEFORE PROCEEDING WITH INSTALLATION$\n$\r$\n$\rYou must validate your Windows language system. In order to do so, verify on the bottom left of your screen if the button says 'Start' (English version) or 'Démarrer' (French version) &quot;<br />
<br />
<br />
;######################################### SPLASH ######################################<br />
        # the plugins dir is automatically deleted when the installer exits<br />
        InitPluginsDir<br />
        File /oname=$PLUGINSDIR\splash.bmp &quot;.\Graphics\install.bmp&quot;<br />
<br />
        advsplash::show 1000 600 400 -1 $PLUGINSDIR\splash<br />
<br />
        Pop $0          ; $0 has '1' if the user closed the splash screen early,<br />
                        ; '0' if everything closed normal, and '-1' if some error occured.<br />
;######################################## SPLASH #######################################<br />
<br />
<br />
<br />
;Demande du language au début<br />
  StrCmp $LANGUAGE ${LANG_ENGLISH} french english<br />
  french:<br />
  StrCpy $R0 &quot;Select your Windows sytem language.$\rChoisissez la langue de votre systeme Windows.&quot;<br />
  StrCpy $R1 &quot;Install language / Langue d'installation&quot;<br />
  Goto end<br />
  english:<br />
  StrCpy $R0 &quot;Select your Windows sytem language.$\rChoisissez la langue de votre systeme Windows.&quot;<br />
  StrCpy $R1 &quot;Install language / Langue d'installation&quot;<br />
  end:<br />
  !Define MUI_LANGDLL_WINDOWTITLE $R1<br />
  !Define MUI_LANGDLL_INFO $R0<br />
<br />
;Déclaration des ini<br />
  !insertmacro MUI_LANGDLL_DISPLAY<br />
  !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;RT.ini&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;OPT.ini&quot;<br />
<br />
FunctionEnd<br />
<br />
;---------------------------------------------------------------------------------------<br />
;Descriptions<br />
<br />
;Language strings pour l'installation<br />
  LangString DESC_SecED ${LANG_ENGLISH} &quot;This section is for the EasyDeal installation.&quot;<br />
  LangString DESC_SecED ${LANG_FRENCH}  &quot;Cette section est pour l'installation de EasyDeal.&quot;<br />
<br />
<br />
<br />
  ;Assign language strings to sections<br />
  !insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br />
    !insertmacro MUI_DESCRIPTION_TEXT ${SecED} $(DESC_SecED)<br />
  !insertmacro MUI_FUNCTION_DESCRIPTION_END<br />
<br />
<br />
;---------------------------------------------------------------------------------------<br />
;Uninstaller Section<br />
<br />
Section &quot;Uninstall&quot;<br />
<br />
  ;ADD YOUR OWN FILES HERE...<br />
  Delete &quot;$INSTDIR\*.*&quot;<br />
  Delete &quot;$INSTDIR\Uninstall.exe&quot;<br />
  Delete &quot;$SMPROGRAMS\Startup\EasyDeal.lnk&quot;<br />
  Delete &quot;$SMPROGRAMS\Démarrage\EasyDeal.lnk&quot;<br />
  Delete &quot;$DESKTOP\EasyDeal.lnk&quot;<br />
<br />
  ;Clé du language<br />
  DeleteRegKey /ifempty HKCU &quot;Software\EASYDEAL&quot;<br />
  RMDir  &quot;$INSTDIR&quot;<br />
<br />
<br />
SectionEnd<br />
;---------------------------------------------------------------------------------------<br />
;Uninstaller Functions<br />
<br />
Function un.onInit<br />
<br />
  ;Demande du language au début<br />
  StrCmp $LANGUAGE ${LANG_ENGLISH} french english<br />
  french:<br />
  StrCpy $R0 &quot;Select your Windows sytem language.$\rChoisissez la langue de votre systeme Windows.&quot;<br />
  StrCpy $R1 &quot;Install language / Langue d'installation&quot;<br />
  Goto end<br />
  english:<br />
  StrCpy $R0 &quot;Select your Windows sytem language.$\rChoisissez la langue de votre systeme Windows.&quot;<br />
  StrCpy $R1 &quot;Install language / Langue d'installation&quot;<br />
  end:<br />
  !Define MUI_UNLANGDLL_WINDOWTITLE $R1<br />
  !Define MUI_UNLANGDLL_INFO $R0<br />
<br />
  !insertmacro MUI_UNGETLANGUAGE<br />
  <br />
FunctionEnd<br />
;------------Voir le language de la page Access RT et client/server-------------------<br />
   LangString TEXT_IO_TITLE ${LANG_ENGLISH} &quot;InstallOptions page&quot;<br />
   LangString TEXT_IO_SUBTITLE ${LANG_ENGLISH} &quot;This is a page is for Access RT.&quot;<br />
   LangString TEXT_IO_TITLE ${LANG_FRENCH} &quot;Page d'installation&quot;<br />
   LangString TEXT_IO_SUBTITLE ${LANG_FRENCH} &quot;Cette page est pour Access RT.&quot;<br />
<br />
;------------Voir le language de la page Installation EasyDeal  -----------------------<br />
   LangString TEXT_IO_TITLE1 ${LANG_ENGLISH} &quot;InstallOptions page&quot;<br />
   LangString TEXT_IO_SUBTITLE1 ${LANG_ENGLISH} &quot;This is a page is for the EasyDeal installation.&quot;<br />
   LangString TEXT_IO_TITLE1 ${LANG_FRENCH} &quot;Page d'installation&quot;<br />
   LangString TEXT_IO_SUBTITLE1 ${LANG_FRENCH} &quot;Cette page est pour l'installation d'EasyDeal.&quot;<br />
<br />
;--------------------------------------------------------------------------------------<br />
;Page de ART<br />
Function CustomPage1<br />
;La Lettre d'ou le setup a démarrer<br />
  <br />
<br />
	<br />
  !insertmacro MUI_HEADER_TEXT &quot;$(TEXT_IO_TITLE)&quot; &quot;$(TEXT_IO_SUBTITLE)&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;RT.ini&quot;<br />
<br />
<br />
  IfFileExists &quot;c:\runtime\office\MSACCESS.*&quot; 0 NotFileExisted<br />
    Abort<br />
  NotFileExisted:<br />
<br />
    <br />
<br />
;Selon la langue on démarre l'installation de Access RT selon la langue<br />
<br />
  StrCmp $LANGUAGE ${LANG_ENGLISH} 0 notEnglish<br />
    ;Chemin du setup<br />
    StrCpy $9 $EXEDIR<br />
    ; Clé de reboot dans le RunOnce<br />
    WriteRegStr HKCU &quot;Software\Microsoft\Windows\CurrentVersion\RunOnce&quot; &quot;EasyDealIns&quot; &quot;$9\EasyDeal_Installer.exe&quot;<br />
    ;StrCpy $9 $EXEDIR 1 0<br />
    ;nsExec::Exec &quot;$9\AccessRT-A\setup.exe&quot;<br />
    ExecWait &quot;$9\AccessRT-A\setup.exe /wait&quot;<br />
  notEnglish:<br />
 <br />
  StrCmp $LANGUAGE ${LANG_FRENCH} 0 notFrench<br />
    ;Chemin du setup<br />
    StrCpy $9 $EXEDIR<br />
    ; Clé de reboot dans le RunOnce<br />
    WriteRegStr HKCU &quot;Software\Microsoft\Windows\CurrentVersion\RunOnce&quot; &quot;EasyDealIns&quot; &quot;$9\EasyDeal_Installer.exe&quot;<br />
    ;StrCpy $9 $EXEDIR 1 0<br />
    ;nsExec::Exec &quot;$9\AccessRT\setup.exe&quot;<br />
    ExecWait &quot;$9\AccessRT\setup.exe /wait&quot;<br />
<br />
<br />
  notFrench:<br />
<br />
FunctionEnd<br />
<br />
;---------------------------------------------------------------------------------------<br />
Function CustomPage2<br />
<br />
   StrCmp $LANGUAGE ${LANG_ENGLISH} english1 french1<br />
<br />
   english1:		<br />
   !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;OPT.ini&quot; &quot;Field 1&quot; &quot;text&quot; &quot;Installation Type&quot;<br />
   !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;OPT.ini&quot; &quot;Field 4&quot; &quot;text&quot; &quot;Install EasyDeal as server. This computer will share files with\r\nall the others.&quot;<br />
   !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;OPT.ini&quot; &quot;Field 5&quot; &quot;text&quot; &quot;Install EasyDeal as client. This computer will take informations\r\nfrom the server to be able to run.&quot;<br />
   goto showpage<br />
<br />
   french1:<br />
   !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;OPT.ini&quot; &quot;Field 1&quot; &quot;text&quot; &quot;Type d'installation&quot;<br />
   !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;OPT.ini&quot; &quot;Field 4&quot; &quot;text&quot; &quot;Installation de type serveur. Cet ordinateur va partager les\r\nfichiers aux autres ordinateurs.&quot;		<br />
   !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;OPT.ini&quot; &quot;Field 5&quot; &quot;text&quot; &quot;Installation de type client. Cet ordinateur prendra ses informations\r\nà partir du serveur.&quot;<br />
   showpage:<br />
<br />
<br />
;Choix entre l'installation server ou client<br />
  !insertmacro MUI_HEADER_TEXT &quot;$(TEXT_IO_TITLE1)&quot; &quot;$(TEXT_IO_SUBTITLE1)&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;OPT.ini&quot;<br />
<br />
FunctionEnd<br />
;----------------------------------------------------------------------------------------</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th July 2004, 17:39</div></div><div class="posttext">If you wish to change the text displayed, use MUI_LANGDLL_* at the appropriate place, as explained in the MUI readme.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th July 2004, 17:41</div></div><div class="posttext">Never mind.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Freezerman350</div><div class="date">30th July 2004, 18:50</div></div><div class="posttext">So ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">31st July 2004, 05:49</div></div><div class="posttext">Your original solution would have never worked- because !define is evaluated at compile time, not runtime.<br />
The MUI macros also define the LangDLL titles at compile time.<br />
What you should do is this:<br />
<br />
<br />
Function .onInit<br />
    StrCmp $LANGUAGE ${LANG_ENGLISH} french english<br />
french:<br />
    LangDLL::LangDialog &quot;Select your Windows system language.&quot; &quot;Install language&quot; 2 English 1033 French 1036<br />
    Goto end<br />
english:<br />
    LangDLL::LangDialog &quot;Choisissez la langue de votre systeme Windows.&quot; &quot;Langue d'installation&quot; 2 French 1036 English 1033<br />
end:<br />
    Pop $LANGUAGE<br />
    StrCmp $LANGUAGE &quot;cancel&quot; 0 +2<br />
    Abort<br />
FunctionEnd<br />
<br />
<br />
Create similar code for un.onInit (or save $LANGUAGE in the registry so it can be done automatically).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st July 2004, 10:54</div></div><div class="posttext">$R0 and $R1, however, are resolved at runtime. It should work, and it does if he fixes his mistake in the first code, as he said himself. The only problem in the first code is that he jumps to the French label if the language is English. Fixing that, as he already mentioned he did, should fix everything and it works in an example I tested.<br />
<br />
Seeing as the &quot;attached&quot; (see forum rules) script is so huge, I don't want to dig into it to find out why &quot;the page will be always in french, no matter the language of the windows&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">31st July 2004, 13:36</div></div><div class="posttext">$R0 and $R1 are evaluated at runtime, but aren't the following lines evaluated at compiletime?<br />
<br />
<br />
!Define MUI_LANGDLL_WINDOWTITLE $R1<br />
!Define MUI_LANGDLL_INFO $R0<br />
<br />
<br />
I think jumping to the French label when the default language is English is correct- he is providing the prompt in English in that case and giving the user the chance to switch to French. <br />
Similarly, when the default language is French, he prompts the user in French to switch their language.<br />
<br />
You could say that his label names are misleading, but the logic is correct.<br />
<br />
The solution I provided will work. I tested it with a reduced version of the MUI Multilanguage.nsi example (attached). I switched my Windows region from US to France and tested with French as the default as well.<br />
<br />
The only remaining issues I can see are that the LangDLL dialog buttons are still in English and that the MessageBox displayed when you click  Cancel on any of the pages also has its buttons in English.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st July 2004, 13:40</div></div><div class="posttext">The defines are evaluated at compile time and therefore $R0 and $R1 are used as the values. $R0 and $R1 are then evaluated at runtime to get the final value.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">31st July 2004, 13:46</div></div><div class="posttext">OK. I see what you mean.<br />
So something like this should work for him:<br />
<br />
Function .onInit<br />
    Push $R0<br />
    Push $R1<br />
    StrCmp $LANGUAGE ${LANG_ENGLISH} french english<br />
french:<br />
    StrCpy $R0 &quot;Select your Windows system language.&quot;<br />
    StrCpy $R1 &quot;Install language&quot;<br />
Goto end<br />
english:<br />
    StrCpy $R0 &quot;Choisissez la langue de votre systeme Windows.&quot;<br />
    StrCpy $R1 &quot;Langue d'installation&quot;<br />
end:<br />
!Define MUI_LANGDLL_INFO $R0<br />
!Define MUI_LANGDLL_WINDOWTITLE $R1<br />
  !insertmacro MUI_LANGDLL_DISPLAY<br />
    Pop $LANGUAGE<br />
    StrCmp $LANGUAGE &quot;cancel&quot; 0 +2<br />
    Abort<br />
    Pop $R1<br />
    Pop $R0<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st July 2004, 13:54</div></div><div class="posttext">If you remove:Pop $LANGUAGE<br />
StrCmp $LANGUAGE &quot;cancel&quot; 0 +2<br />
Abortit should work, assuming he wants to display English text when the system language is French.<br />
<br />
If you don't remove the Pop $LANGUAGE instruction, $LANGUAGE will always be set to &quot;&quot; and the user's selection will be ignored. The MUI already pops the value into $LANGUAGE and compares it to &quot;cancel&quot;. The extra Pop instruction in your code pops $R1's value pushed on the third line.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">31st July 2004, 14:50</div></div><div class="posttext">Oops- forgot to remove those lines :D .<br />
Final version should be:<br />
<br />
Function .onInit<br />
    Push $R0<br />
    Push $R1<br />
    StrCmp $LANGUAGE ${LANG_ENGLISH} english french<br />
english:<br />
    StrCpy $R0 &quot;Select your Windows system language.&quot;<br />
    StrCpy $R1 &quot;Install language&quot;<br />
Goto end<br />
french:<br />
    StrCpy $R0 &quot;Choisissez la langue de votre systeme Windows.&quot;<br />
    StrCpy $R1 &quot;Langue d'installation&quot;<br />
end:<br />
!Define MUI_LANGDLL_INFO $R0<br />
!Define MUI_LANGDLL_WINDOWTITLE $R1<br />
  !insertmacro MUI_LANGDLL_DISPLAY<br />
    Pop $R1<br />
    Pop $R0<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Freezerman350</div><div class="date">4th August 2004, 20:17</div></div><div class="posttext">So dude, that so logical.. !!!<br />
<br />
look.. I pop up my $language on the oninit !<br />
<br />
on my french windows  1036  ! Good that my french version so i just have to make a little if and that it ! <br />
<br />
BUT   &lt;-----------------------<br />
<br />
I build  my &quot;if&quot; ...but i tried it on a english windows version  bam...dont work...<br />
<br />
<br />
  StrCpy $0 $LANGUAGE<br />
  StrCmp $0 '1036' WinFR NotWinFR<br />
     WinFR:<br />
          StrCpy $R0 &quot;Choisissez la langue de votre systeme Windows.&quot;<br />
          StrCpy $R1 &quot;Langue d'installation&quot;<br />
     NotWinFR:<br />
  StrCmp $0 '1033' WinEn NotWinEn<br />
     WinEn:<br />
          StrCpy $R0 &quot;Select your Windows sytem language&quot;<br />
          StrCpy $R1 &quot;Install language&quot;<br />
     NotWinEn:<br />
  !Define MUI_LANGDLL_WINDOWTITLE $R1<br />
  !Define MUI_LANGDLL_INFO $R0<br />
<br />
<br />
<br />
<br />
SO wht i can do... nothing work...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">4th August 2004, 21:36</div></div><div class="posttext">The script I posted worked fine- I tried it with both French &amp; English regional settings.<br />
Your latest script is missing some gotos.<br />
I couldn't understand what your exact situation is now.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Freezerman350</div><div class="date">5th August 2004, 15:21</div></div><div class="posttext">But another question, if i want to to autodetect the language...<br />
<br />
the user have noting to choose <br />
<br />
<br />
how i can do that ??</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Freezerman350</div><div class="date">5th August 2004, 15:36</div></div><div class="posttext">Mr Iceman...   i just try your new version...   work great on my french windows<br />
<br />
and  also work in french on my english windows....<br />
so... i think Nsis work with maybe the keyboard language or regional language     ....   maybe this is why   all my windows french or english..pup up withthe french version of my installer !</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Freezerman350</div><div class="date">5th August 2004, 15:39</div></div><div class="posttext">thx guys ...  but the probleme is actually the regional information...<br />
<br />
I absolutly need the windows language     whatever the regional param</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>