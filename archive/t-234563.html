<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Bug with MUI, WinXP Luna and SetCtlColors?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Bug with MUI, WinXP Luna and SetCtlColors? NSIS Discussion" />
	
	<title> Bug with MUI, WinXP Luna and SetCtlColors? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Bug with MUI, WinXP Luna and SetCtlColors?</div>
<hr />
<div class="pda"><a href="t-234563.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=234563">Bug with MUI, WinXP Luna and SetCtlColors?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">stb</div><div class="date">2nd January 2006, 18:33</div></div><div class="posttext">I have a problem with WinXP, Luna, NSIS 2.12, ModernUI. I added some custom controls to welcome page and changed the background to transparent in custom show function using setCtlColors. This does not work correct with Luna (modern WinXP Gui).<br />
<br />
The following code works with WinXP Luna AND classic:<br />
<br />
<br />
Function showWelcomePage<br />
  Push $0<br />
  GetDlgItem $0 $MUI_HWND 1203<br />
  SetCtlColors $0 &quot;000080&quot; &quot;${MUI_BGCOLOR}&quot;<br />
  GetDlgItem $0 $MUI_HWND 1204<br />
  SetCtlColors $0 &quot;&quot; &quot;${MUI_BGCOLOR}&quot;<br />
  Pop $0<br />
FunctionEnd<br />
<br />
<br />
The following code works only with classic. The last ctl (highest ID) will get black background (unreadable). This occurs directly after starting the Installer. Similar problem with uninstaller welcome page.<br />
<br />
<br />
Function showWelcomePage<br />
  Push $0<br />
  GetDlgItem $0 $MUI_HWND 1203<br />
  SetCtlColors $0 &quot;000080&quot; &quot;transparent&quot;<br />
  GetDlgItem $0 $MUI_HWND 1204<br />
  SetCtlColors $0 &quot;&quot; &quot;transparent&quot;<br />
  Pop $0<br />
FunctionEnd<br />
<br />
<br />
Of course those controls get added in preWelcomePage. 1204 is a checkbox and 1203 is a web link.<br />
<br />
ioSpecial.ini<br />
<br />
<br />
[Settings]<br />
Rect=1044<br />
NumFields=5<br />
RTL=0<br />
NextButtonText=<br />
CancelEnabled=<br />
[Field 1]<br />
Type=bitmap<br />
Left=0<br />
Right=109<br />
Top=0<br />
Bottom=193<br />
Flags=RESIZETOFIT<br />
Text=C:\Temp\nstB0.tmp\modern-wizard.bmp<br />
HWND=1704972<br />
[Field 2]<br />
Type=label<br />
Left=120<br />
Right=315<br />
Top=10<br />
Text=Welcome...<br />
Bottom=38<br />
HWND=853212<br />
[Field 3]<br />
Type=label<br />
Left=120<br />
Right=315<br />
Top=45<br />
Bottom=140<br />
Text=bla bla<br />
HWND=853208<br />
[Field 4]<br />
Type=Link<br />
Left=120<br />
Right=315<br />
Top=175<br />
Bottom=185<br />
State=http://nsis.sf.net<br />
Text=Web page<br />
HWND=1508514<br />
[Field 5]<br />
Type=Checkbox<br />
Text=Express-Installation<br />
Flags=NOTIFY<br />
State=0<br />
Left=120<br />
Right=315<br />
Top=145<br />
Bottom=155<br />
HWND=787520</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd January 2006, 19:17</div></div><div class="posttext">How did you get it to show up in classic? The only difference I can think of between MUI and classic is that the MUI sets the background of the entire dialog to white. In the MUI, setting the background back to nothing still showed up the check box as black.<br />
<br />
Anyway, back to the original issue, I think I saw it once. I think it's a problem with the BUTTON class lack of support for transparent backgrounds. It probably has something to do with this quote from MSDN's page about WM_CTLCOLORBTN:However, only owner-drawn buttons respond to the parent window processing this message.NSIS itself doesn't handle SetCtlColors differently for different window classes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stb</div><div class="date">4th January 2006, 09:02</div></div><div class="posttext">Sorry, I did mean &quot;Windows GUI classic mode&quot; (Windows XP user style &quot;classic&quot; which is similar to Win2000 GUI).<br />
<br />
So: WinXP classic style works correct, Luna NOT. Same installer.<br />
<br />
What is quite weird: My welcome page has two custom controls. In the code above always the last (highest ID, 1204) control is black, it is always a checkbox. I'm quite sure I had also both controls black during my experiments, probably due to not changing the foreground color of the link control (1203).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st January 2006, 18:29</div></div><div class="posttext">A checkbox also uses the BUTTON window class, so I don't think it has anything to do with their order.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stb</div><div class="date">31st January 2006, 18:56</div></div><div class="posttext">Maybe it is the fact that 1204 is the last control in ioSpecial.ini</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st January 2006, 19:03</div></div><div class="posttext">Can you attach a complete example? I don't want to create it again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st January 2006, 19:23</div></div><div class="posttext">Never mind, created one on my own. I've added another checkbox, set its background to transparent and both of them were black. I've also tried changing their field numbers to 1 and 2, still black. It's not related to its location in the INI file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stb</div><div class="date">31st January 2006, 19:29</div></div><div class="posttext">Sorry. I don't have a full script for this one. (funny order :-))</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st January 2006, 19:31</div></div><div class="posttext">Why not use ${MUI_BGCOLOR}?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stb</div><div class="date">31st January 2006, 19:39</div></div><div class="posttext">In fact, I do (now). So the issue is somewhat academic. But it is not &quot;transparent&quot;. If it is not working correctly, &quot;transparent&quot; should be removed (at least from NSIS help) or this issue should be mentioned. I never noticed this quite some time because I use classic Windows GUI.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st January 2006, 19:45</div></div><div class="posttext">The &quot;transparent&quot; switch is working. It only fails for check boxes on XP for some weird unknown reason which seems to be unrelated to NSIS. I've tried some other applications, and they all exhibit this behavior.<br />
<br />
I'll update the help file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">1st February 2006, 12:26</div></div><div class="posttext">If one really want to solve it, there is always the hard way :(<br />
<br />
IDEA:<br />
<br />
1)Get position x,y, h,w of Checkbox text. (x = Full + Checkbox width)  <br />
2)Create a memorybitmap and copy the background for moriginal background source to this canvas<br />
3) Write the text on the memorybitmap canvas<br />
4) Copy the memorybitmap to the dialogcanvas on the correct position.<br />
<br />
Just an idea, I know it is a lot of work, but that is sometimes the case with developing...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>