<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Need to add switches to installer, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Need to add switches to installer NSIS Discussion" />
	
	<title> Need to add switches to installer [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Need to add switches to installer</div>
<hr />
<div class="pda"><a href="t-242531.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=242531">Need to add switches to installer</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Pharaoh Atem</div><div class="date">3rd April 2006, 23:31</div></div><div class="posttext">I need to add a switch to an installer that will write a DIFFERENT INI setting instead of the normal one, using MUI.. How do I go about doing this? If it is easier to use InstallOptions to figure this out, then by all means do that!<br />
 The switch I want is &quot;--user&quot;<br />
Code by default:<br />
WriteINIStr &quot;$INSTDIR\\overrwdef.ini&quot; &quot;System&quot; &quot;OverWrite&quot; &quot;0 ; If enabled Program will use overwrite profile settings when run&quot;<br />
Code I want optional:<br />
WriteINIStr &quot;$INSTDIR\\overrwdef.ini&quot; &quot;System&quot; &quot;OverWrite&quot; &quot;1 ; If enabled Program will use overwrite profile settings when run&quot;<br />
The code is in a section during file installation process, if you want to give InstallOptions thing, then it should be able to change within the section...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">4th April 2006, 01:51</div></div><div class="posttext">Sorry I don't have time to create a better working example, but if I understood you correctly, something like this should get you started:<br />
<br />
1.  First, define a variable (such as PARAMETER) in the first part of your script.  Then, in the first line of your .onInit function, set it's value to zero.<br />
<br />
2.  In Appendix E (Useful headers), you'll find two functions: GetOptions and GetParameters.  Use one or both to read the paramater and then set $PARAMETER to 1 if &quot;--user&quot; is found as a parameter.<br />
<br />
3.  Finally, check the value of $PARAMETER during your installation to decide what 'branch' of code you want to execute.  <br />
<br />
Using your optional INI settings from above as an example:<br />
<br />
StrCmp $PARAMETER 1 JumpIfSet JumpIfNotSet<br />
<br />
JumpIfSet:<br />
   WriteINIStr &quot;$INSTDIR\overrwdef.ini&quot; &quot;System&quot; &quot;OverWrite&quot; &quot;1&quot;<br />
Goto JumpIfNotSet<br />
<br />
JumpIfNotSet:<br />
; continue your code here</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pharaoh Atem</div><div class="date">4th April 2006, 02:58</div></div><div class="posttext">Let me restate it: I want the perameter to be set by a switch.<br />
<br />
WriteINIStr &quot;$INSTDIR\\overrwdef.ini&quot; &quot;System&quot; &quot;OverWrite&quot; &quot;$PERAMETER ; If enabled Program will use overwrite profile settings when run&quot;<br />
<br />
If --user is given in commandline, the $PERAMETER should be set to &quot;1&quot;. Otherwise, it should be set to &quot;0&quot;. I hope this helps... The solution given doesn't work in my script...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">4th April 2006, 04:19</div></div><div class="posttext">So what I understand is that you want to set a parameter depending on whether the '--user' switch is used or not. If so, use GetParameters described above, and do a strcmp on the result. This code should either be in a function or in a section.<br />
;The getparameters function here and put the result in $0<br />
<br />
StrCmp $0 &quot;--user&quot; +1 DontOverwrite<br />
WriteINIStr &quot;$INSTDIR\overrwdef.ini&quot; &quot;System&quot; &quot;OverWrite&quot; &quot;1&quot;<br />
GoTo skip<br />
DontOverwrite:<br />
WriteINIStr &quot;$INSTDIR\overrwdef.ini&quot; &quot;System&quot; &quot;OverWrite&quot; &quot;0&quot;<br />
skip:<br />
;the rest of code here</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pharaoh Atem</div><div class="date">4th April 2006, 12:36</div></div><div class="posttext">Originally posted by JasonFriday13 <br />
So what I understand is that you want to set a parameter depending on whether the '--user' switch is used or not. If so, use GetParameters described above, and do a strcmp on the result. This code should either be in a function or in a section.<br />
;The getparameters function here and put the result in $0<br />
<br />
StrCmp $0 &quot;--user&quot; +1 DontOverwrite<br />
WriteINIStr &quot;$INSTDIR\overrwdef.ini&quot; &quot;System&quot; &quot;OverWrite&quot; &quot;1&quot;<br />
GoTo skip<br />
DontOverwrite:<br />
WriteINIStr &quot;$INSTDIR\overrwdef.ini&quot; &quot;System&quot; &quot;OverWrite&quot; &quot;0&quot;<br />
skip:<br />
;the rest of code here <br />
<br />
How do I set the GetPeraters function, I'm using:<br />
${GetParameters} $0<br />
When I use it before the INI settings, it saying the GetPerameters is invalid?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th April 2006, 15:22</div></div><div class="posttext">Did you use the following at the top of your script?!insertmacro GetParametersSee the documentation (http://nsis.sourceforge.net/Docs/AppendixE.html#E.1.1) for more information.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pharaoh Atem</div><div class="date">4th April 2006, 22:38</div></div><div class="posttext">Originally posted by kichik <br />
Did you use the following at the top of your script?!insertmacro GetParametersSee the documentation (http://nsis.sourceforge.net/Docs/AppendixE.html#E.1.1) for more information. <br />
<br />
Yeah, it says invalid macro!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">4th April 2006, 23:09</div></div><div class="posttext">Read the docs:<br />
You need to make sure you include the header file.<br />
<br />
From the docs:<br />
Include header:<br />
!include &quot;FileFunc.nsh&quot;<br />
<br />
<br />
And make sure you are using the latest build of NSIS.  The extra header files used for this function were not included until version 2.08 and some functions may have had a few updates/fixes since then.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pharaoh Atem</div><div class="date">4th April 2006, 23:27</div></div><div class="posttext">I did, and I am using NSIS v2.15!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">5th April 2006, 01:16</div></div><div class="posttext">Alright then, post the script as an attachment, and we can tell you where you went wrong.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pharaoh Atem</div><div class="date">5th April 2006, 01:30</div></div><div class="posttext">Alright, here is a script with all the parts in it...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">5th April 2006, 01:41</div></div><div class="posttext">Check your spelling:<br />
!insertmacro GetParameters<br />
Was: !insertmacro GetPerameters</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pharaoh Atem</div><div class="date">5th April 2006, 01:55</div></div><div class="posttext">Changed it and it still was invalid! Is there a way to do this in a dialog instead? As in a dialog before the file transfer page...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">5th April 2006, 03:51</div></div><div class="posttext">I have fixed the script and attached it. I commented out all the stuff that was not needed for the script just so you could see that it does work. The only thing the installer does now is write the ini to the desktop. At the command prompt type: setup.exe --user and you will get an ini file with 1 in it instead of 0.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pharaoh Atem</div><div class="date">5th April 2006, 04:01</div></div><div class="posttext">This looks like the EXACT same script as the one I attached earlier... Even my spelling error of GetPerameters is still there...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">5th April 2006, 04:19</div></div><div class="posttext">Alright then, just to prove it, I have uploaded a zip with the script and the .exe produced by it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pharaoh Atem</div><div class="date">5th April 2006, 13:13</div></div><div class="posttext">Alright, it is working! Thank you all...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th April 2006, 16:17</div></div><div class="posttext">Pharaoh Atem, sounds like your internet cache needs clearing out. I suspect you're using IE?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pharaoh Atem</div><div class="date">5th April 2006, 22:24</div></div><div class="posttext">I was, I accidently used IE to view it last time... I switched to Firefox and saw the changes... Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">5th April 2006, 23:30</div></div><div class="posttext">Thats what I like to hear.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>