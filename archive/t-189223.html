<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Backup/restore, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Backup/restore NSIS Discussion" />
	
	<title> Backup/restore [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Backup/restore</div>
<hr />
<div class="pda"><a href="t-189223.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=189223">Backup/restore</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">phllp_w</div><div class="date">7th August 2004, 16:52</div></div><div class="posttext">I would like the installer to backup some folders and files in them, put them in a preselected folder...<br />
<br />
And the uninstaller should ask the user if he wants to restore the backup.<br />
<br />
Is that possible?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th August 2004, 17:49</div></div><div class="posttext">Yes it is.<br />
The easiest thing would be to have a MessageBox asking the user if he/she wants to copy the installed files to a Backup folder.<br />
<br />
Then on Uninstall, check if a Backup folder exists, and if one does, ask the user again if he wants to copy the Backup back after uninstallation.<br />
<br />
Also, on installation, you should check that no Backup folder already exists, and if one does, ask the user if he/she wants to remove it before the new backup copying occurs.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">phllp_w</div><div class="date">7th August 2004, 18:31</div></div><div class="posttext">Yes, that's exactly what I want to do...<br />
<br />
But the problem is I'm still a beginner and don't know how to do it...<br />
<br />
Can someone help?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th August 2004, 18:45</div></div><div class="posttext">Ok, for a start...<br />
<br />
<br />
Function DoBackup<br />
## First, check for previous installation<br />
IfFileExists &quot;$INSTDIR\*.*&quot; 0 NoBackup<br />
<br />
 MessageBox MB_YESNO|MB_ICONQUESTION &quot;A previous installation of [product name] was found.$\r$\n$\r$\nWould you like to create a backup?&quot; IDNO NoBackup<br />
<br />
## Check for previous backup too!!!<br />
IfFileExists &quot;$INSTDIR\Backup\*.*&quot; 0 +2<br />
MessageBox MB_OKCANCEL|MB_ICONINFORMATION &quot;A previous backup was found!$\r$\n$\r$\nWould you like to remove the previous backup?&quot; IDCANCEL Error<br />
RMDir /r &quot;$INSTDIR\Backup&quot;<br />
<br />
##Do the backup [we will move all to Temp Plugins folder]<br />
InitPluginsDir<br />
Rename &quot;$INSTDIR&quot; &quot;$PLUGINSDIR\Backup&quot;<br />
CreateDirectory &quot;$INSTDIR&quot; #make $INSTDIR<br />
Rename &quot;$PLUGINSDIR\Backup&quot; &quot;$INSTDIR\Backup&quot; #move to new backup<br />
<br />
MessageBox MB_OK|MB_ICONINFORMATION &quot;Backup completed.$\r$\n$\r$\nInstallation will now continue&quot; IDOK NoBackup<br />
<br />
Error:<br />
 MessageBox MB_OKCANCEL|MB_ICONEXCLAMATION &quot;You have chosen not to remove the previous backup, therefore a new backup cannot take place.$\r$\nClick OK to continue with the installation.&quot; IDOK NoBackup<br />
 Abort<br />
<br />
NoBackup:<br />
FunctionEnd<br />
<br />
This is just for the installation!<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">phllp_w</div><div class="date">7th August 2004, 19:07</div></div><div class="posttext">It doesn't work...<br />
<br />
Says: <br />
1 warning:<br />
  install function &quot;DoBackup&quot; not referenced - zeroing code (0-14) out.<br />
<br />
???</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th August 2004, 19:16</div></div><div class="posttext">You need to call the function with &quot;Call DoBackup&quot;<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">phllp_w</div><div class="date">7th August 2004, 19:34</div></div><div class="posttext">Sorry for asking this but I'm a beginner...<br />
<br />
How do I call the function?<br />
Do I need to put the code you gave me in my script or in a seperate file and then call it with the .nsi script?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th August 2004, 21:33</div></div><div class="posttext">Put the Function in your script.<br />
<br />
Like I have said, use:<br />
Call DoBackup in a Section or Function.<br />
<br />
Optionally, change the name of the Function to .onInit and it will be called as the installer starts.<br />
Although, if you're using MUI, I recommend you call it as a leave function for the Welcome page.<br />
See MUI readme about setting Custom Functions.<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>