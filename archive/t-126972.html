<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" nsExec question, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  nsExec question NSIS Discussion" />
	
	<title> nsExec question [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  nsExec question</div>
<hr />
<div class="pda"><a href="t-126972.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=126972">nsExec question</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd March 2003, 17:36</div></div><div class="posttext">nsExec is good that it will get the output of an MS-DOS program, but it will only get the ouput and print it after the MS-DOS program has finished running.<br />
Is there any way to get the ouput of the MS-DOS program every second?<br />
<br />
I'm suspecting this isn't possible under Windows (but I know it is under Linux)<br />
<br />
-Stuart</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd March 2003, 17:39</div></div><div class="posttext">If you use ExecToLog it gets new output and prints it as long as it gets it from the DOS program. If there is no output it waits 1/10 seconds and tries again. If you use ExecToStack you'll get the output only when the program has finished.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd March 2003, 19:11</div></div><div class="posttext">Hmm, well it still only prints the ouput when the program has finished, and prints nothing inbetween.<br />
<br />
-Stuart</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd March 2003, 19:13</div></div><div class="posttext">nsExec takes the output when the program gives it. Maybe it's your program that only outputs when it's finished.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd March 2003, 21:39</div></div><div class="posttext">In MS-DOS, there are loads of live output shown on the screen, like % complete, count status, section part etc<br />
None of this shows up with nsExec.<br />
<br />
Has nsExec been tested with any 'live' MS-DOS programs before?<br />
<br />
-Stuart</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th March 2003, 16:58</div></div><div class="posttext">That output will indeed not show until the line break appears. I will add that to the todo list. Did I understand right or does it wait for the whole output even though there are line breaks in there?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th March 2003, 23:54</div></div><div class="posttext">Output sample...<br />
<br />
----------- qvis3 -----------<br />
original code by id Software<br />
Modified by Geoffrey DeWan<br />
Revision 1.02<br />
-----------------------------<br />
fastvis = true<br />
reading C:\Quake2\map-compile\maps\gbr\gbrsnow1.bsp<br />
reading C:\Quake2\map-compile\maps\gbr\gbrsnow1.prt<br />
1890 portalclusters<br />
5804 numportals<br />
0...1...2...3...4...5...6...7...8...9... (54)<br />
WARNING: Leaf portals saw into leaf (938)<br />
WARNING: Leaf portals saw into leaf (1091)<br />
WARNING: Leaf portals saw into leaf (1451)<br />
Average clusters visible: 1091<br />
Building PHS...<br />
Average clusters hearable: 1854<br />
visdatasize:810110  compressed from 907200<br />
writing C:\Quake2\map-compile\maps\gbr\gbrsnow1.bsp<br />
 56.0 seconds elapsed<br />
<br />
It goes line by line, but also the bit...<br />
0...1...2...3...4...5...6...7...8...9... (54)<br />
...counts up as the compile goes along.<br />
<br />
This is 1 of the 3 compile programs. They all have roughly the same output, but all output for all compilers only show after completion.<br />
<br />
I hope nsExec can support live compile status, since no-one has been able to do it under Windows before. It has been done under Linux through a program called tee.exe. tee.exe was converted over to Windows, but unfortunatly Windows restricts it to showing output only after the program producing the output has finished.<br />
Same as with MS-DOS where you can log commands / outputs like so:<br />
C:\quake2\quake2.exe &gt;&gt; log1.log<br />
<br />
-Stuart</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">8th March 2003, 09:56</div></div><div class="posttext">Yeah the problem with that is the fact that the 0...1... bit doesn't ever print a newline character out so nsExec doesn't do anything with it until the end of the line. This can be solved but isn't brilliantly simple because it would involve repeatedly updating the same line in the details window rather than just printing out one line at a time.<br />
<br />
There are probably lots of windows programs that can capture that, it's not hard, just unusual.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">8th March 2003, 10:14</div></div><div class="posttext">I've tried making some changes to nsExec, can you try my changed nsExec.dll please and tell me if it works for you... I don't have time to test this right now.. I'll be back later today some time.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th March 2003, 20:09</div></div><div class="posttext">I tried it.<br />
Output still comes up only after it has finished:cry:<br />
<br />
-Stuart</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">9th March 2003, 11:07</div></div><div class="posttext">I'm having trouble fixing this at the mo, will try again later today.<br />
<br />
I've tried changing all kinds of things but the pipe nsExec reads from is just not receiving the data... the best I've got so far is for nsExec to finally receive some data when the child process fills its output buffer but that takes a while (I'm guessing this is what's happening anyway). The damndest thing is that I don't appear to be able to disable or shrink that buffer. I tried getting the pipe to operate in byte mode but that didn't help either... I'll try some more stuff later.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">9th March 2003, 21:46</div></div><div class="posttext">Right, I gave what time I had to this today (not much I'm afraid) but a solution was not forthcoming. I'm not saying I give up, I'm just saying don't hold your breath waiting for me to deliver a solution. I'll continue my investigation as soon as I can.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th March 2003, 18:20</div></div><div class="posttext">Would you like me to give you the exe program and a small map to test nsexec on?<br />
<br />
-Stuart</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">12th March 2003, 08:42</div></div><div class="posttext">I was testing it using pscp which also rewrites a line showing status information about the copy. I simply could not get the nsExec code to receive output from pscp until it finished the line and started a new one.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th March 2003, 23:57</div></div><div class="posttext">I know that WorldCraft's compiler window (the map editor I use) only outputs the text after a line break occurs. None of the counting up is shown. This caused a HUGE amount of anoyances from the general web public, but no matter how much the programmers at Valve tried, no one could get it to produce the live counting up output.<br />
<br />
I'm not sure if the latest versions of WorldCraft show complete live output, because the old v1.6 version does Quake2 maps.<br />
<br />
It seems that it was quite a task to get the output, even for people that created one of the best mapping programs out there.<br />
<br />
Please don't give up though!<br />
<br />
-Stuart</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th March 2003, 13:09</div></div><div class="posttext">Maybe you could show me the source?<br />
I'm no C/C++ wizard, but I know of many people who could help extremely.<br />
<br />
-Stuart</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st April 2003, 14:06</div></div><div class="posttext">Resuming the topic from before about trying to get nsExec to get the live output from executables, I've just noticed it does get some output from exe files straight away.<br />
<br />
e.g. with the Quake2 compilers, it outputs a lot of the information until it reaches the compile % done area. Thats where it stops outputing anything until the compile process has actually finished.<br />
<br />
So, nsExec is nearly complete that it gets almost all live output,<br />
however, it still doesn't get all live output.<br />
Other peoples' compile programs do just the same as the current nsExec I have downloaded from SunJammer as I explained above.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">21st April 2003, 14:14</div></div><div class="posttext">That's right. nsExec outputs a new line when it gets a line break.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">21st April 2003, 14:20</div></div><div class="posttext">What annoys me is that a DOS window prints characters that change before a line break appears, and no matter how hard I tried I couldn't alter nsExec so that it could do the same. I tried many approaches but it simply never receives the data... :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st April 2003, 14:25</div></div><div class="posttext">I wonder if we could conact M$ :p<br />
<br />
-Stu :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">7th October 2003, 16:19</div></div><div class="posttext">I wonder if we could conact M$ :p and pigs will fly :blah: <br />
<br />
has anything more been done with this? (would have been good to see what changes Sunjammer had made in the modified version)<br />
<br />
have a few ideas on this since i had some code way back that would capture the current screen from a console which you could then alter/use as needed (was an alternate way to get the data without using pipes - well it was my first attempt at hard core win32 and i didn't know about pipes at the time ;))<br />
i'm sure it would update when the screen had changed in any way<br />
<br />
will check it out when i get home tonight and see what i can do<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th October 2003, 16:28</div></div><div class="posttext">nsExec in latest CVS contains the changes that Sunjammer made, plus some other things.<br />
However, the full live output was never achieved.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">7th October 2003, 16:31</div></div><div class="posttext">thanks for that, just had a look at the nsExec source but will need to get on my machine to have a full check out of what's going on before i try anything else.<br />
<br />
now where's those code backups... ;)<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th October 2003, 16:47</div></div><div class="posttext">I'm glad someone is going to have another hack at it!<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">7th October 2003, 16:55</div></div><div class="posttext">had seen the thing in the todo.txt and had wondered what it was until i finally remembered to have a look at what it was today.<br />
<br />
hack at it!i think that's going to be the best way to describe it and i'm a sucker for punishment :blah:<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">8th October 2003, 12:49</div></div><div class="posttext">attached dll is what i have done so far.<br />
<br />
it should capture things correctly when using ExecToLog(). i've checked it using chkdsk on win2k and NT4 (seems to lose the live line from the test just done on NT4 when it starts back on normal output :() otherwise it should be fine. (will have to get worldcraft out again for extra checking)<br />
<br />
if there are issues then please post what has gone wrong so i can get an idea of what to fix/change (already got the NT issue to work on).<br />
<br />
i'm also working on ExecToStack() to handle live output correctly too (should have that done by tomorrow ;))<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th October 2003, 16:41</div></div><div class="posttext">Sorry to be negative, but this version is worse.<br />
The older version actually printed the program name, and then went onto the processing, but this one waits before the processing has finished before printing anything.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">8th October 2003, 16:50</div></div><div class="posttext">hmmm, strange that since before i altered things i checked how it worked using the example script and then against what i have done and it seemed to be fine.<br />
<br />
what are you testing it with? may have an idea of why the first line could be being ditched. so it's not displaying anything since with chkdsk i've got it to correctly show the when % part was changing<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th October 2003, 16:56</div></div><div class="posttext">http://myweb.tiscali.co.uk/imker/test.zip<br />
<br />
Run qbsp3.exe on resist.map like so:<br />
nsExec::ExecToLog &quot;$\&quot;$EXEDIR\qbsp3.exe$\&quot; $\&quot;C:\quake2\resist.map$\&quot;&quot;<br />
<br />
resist.map must go in C:\quake2 for the map compiler program to work.<br />
<br />
It's a good idea to try the program in DOS first, to see how it runs, then compare it to nsExec.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">8th October 2003, 17:48</div></div><div class="posttext">[off topic]cycling will kill me![/off topic]<br />
at work (again) on a different machine so will give it a go now<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">8th October 2003, 19:18</div></div><div class="posttext">getting No gamedir in c:\quake2\resist.map also i don't have a copy of quake2 to work with at home :(<br />
<br />
will just have to crack out worldcraft and half life (hopefully that will work in a similar way - quickly scanned down the page) or it's custom dos program time :eek: <br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">9th October 2003, 19:44</div></div><div class="posttext">ok how it's going so far...<br />
<br />
managed to get a test system running with worldcraft 3.3 and using Afrow Uk's test map and a smaller one i've generated.<br />
<br />
in all tests, the output will not appear until it has all finished (no title even when it starts - checked against direct running via the console) - also checked this with the current cvs code too :(<br />
<br />
checking the code and the peeknamedpipe(..) function returns that there is no data to get from the screen even though when running the dos version it can be seen that there is data available (especially when starting!).<br />
<br />
why this is the case i'm not too sure :confused:<br />
it almost seems as though the data is being locked from being read and so the pipe can't get at the screen data.<br />
<br />
going to check a few more things out about pipes, etc. also going to give my old screen capture code a go as well to see how that fairs with things (readconsolescreen(..) etc and all of those functions, oh the fun :))<br />
<br />
will also fix the code i've done to handle certain 'live output' as chkdsk does - is part way there for full live output, just the locked display issue to get around and it should run correctly.<br />
<br />
-daz<br />
<br />
p.s.  i will upload a test exe of what the chkdsk thing does to show what i mean for certain 'live' outputs happening</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">9th October 2003, 19:50</div></div><div class="posttext">gamedir is baseq2, so simply move the map to C:\quake2\baseq2\maps<br />
<br />
Sorry I should have told you earlier, but haven't been around.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">9th October 2003, 20:27</div></div><div class="posttext">don't worry about it ;) and thanks for the info<br />
<br />
off to crack on with it again soon so let the fun begin again i guess :eek: <br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">10th October 2003, 13:08</div></div><div class="posttext">done some more work on things (using Afrow Uk's example now for testing).<br />
<br />
for whatever reason the console does not seem to be recognising that there is data on the screen until processing ends :hang: <br />
<br />
checked the working of the code against the standard console redirection and the problems with nsExec also happen with the console<br />
e.g.<br />
qbsp3.exe c:\quake2\baseq2\maps\resist.map &gt; blah.txt<br />
will only put data into the file once the processing has been finished. i also tried this with chkdsk and that will output the screen data as it changes. i even tried control-breaks to see what was output and for the resist.map test there is still no output to the blah.txt file.<br />
<br />
so whatever the reason causing this, even the OS can't deal with things :weird: <br />
<br />
what i'm working on (as an idea) of outputting a basic string such as nsExec is working... / where the last part ( / ) will go /,-,\,| to indicate that processing is still going - at least gives some indication that things are working.<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">10th October 2003, 15:17</div></div><div class="posttext">here's an example of the indicating processing code when the output can't be read.<br />
<br />
it's not complete (only started on it this morning) but it shows the basics of the feature<br />
<br />
note: the previous line may disappear when reading occurs (still to track that down)<br />
<br />
-daz<br />
<br />
<br />
the test is set to use Afrow Uk's example, see above for the setup of the files and to get them too ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">10th October 2003, 16:44</div></div><div class="posttext">Some console based applications do not use the standard handles for their input/output (IO) operations. The Win32 API does not support redirection of these processes.after a little searching my thoughts were confirmed with the above quote from m$ here (http://support.microsoft.com/default.aspx?scid=kb;EN-US;190351) :(<br />
<br />
Will finish the processing... part since it doesn't look like it's possible to get the data and some indication is going to be better than nothing i think<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">11th October 2003, 13:52</div></div><div class="posttext">attached is the modified source code that will put<br />
nsExec is working... /<br />
when the code detects the process is running but it is not able to get the data put to the console (see above as to why).<br />
<br />
i'm re-working the code that will display live output that can be detected but the attached modification is good to go for the cases when it is not detectable :)<br />
<br />
-daz<br />
<br />
p.s. is just the source file (forgot to bring the new dll with me)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">16th October 2003, 07:29</div></div><div class="posttext">finally remembered to bring all the files with me, so here is a working example of the modified nsExec and there is a test program to show it at work when the output is held back until processing is finished (damn you printf(..) :blah: )<br />
<br />
just extract the installer and dummycon.exe to the same place and run.<br />
<br />
the next update will incorporate earlier code (further up this thread) that will be able to handle the output holding at the same position such as a %increase (or the 0... to 9... in the attached example file).<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">20th October 2003, 16:15</div></div><div class="posttext">if i'm altering the nsExec code, is it be alright to put my modified version in the archive? i'm asking this since i've added in an abort button (needed it for testing for bits above) and i thought it might be useful for other people.<br />
<br />
thanks<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th October 2003, 21:26</div></div><div class="posttext">Of course you can. Where else? :)<br />
<br />
It should find its way into CVS too, but I don't know if before b4 or not.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">21st October 2003, 12:09</div></div><div class="posttext">thanks, i just thought it best to check before i did put it in the archive.<br />
<br />
if it gets in it's probably best to go after b4 i think since i found a few problems with the code i posted (fixed in the latest version i have ;) )<br />
<br />
will put an updated version in the archive as soon as i can<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cc213t</div><div class="date">28th June 2008, 07:08</div></div><div class="posttext">Well, this thread has been dormant for a few years, but in case anyone else is having this problem, I found that one way to get live output streaming working with nsExec::ExecToLog is to do this in each console app you'll be running:<br />
setvbuf(stdout, NULL, _IONBF, 0);<br />
This fully disables output buffering on stdout, which seems to solve the problem.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>