<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Create a build that can install 2 different packages by user wish, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Create a build that can install 2 different packages by user wish NSIS Discussion" />
	
	<title> Create a build that can install 2 different packages by user wish [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Create a build that can install 2 different packages by user wish</div>
<hr />
<div class="pda"><a href="t-299612.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=299612">Create a build that can install 2 different packages by user wish</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">believer</div><div class="date">6th November 2008, 14:54</div></div><div class="posttext">I need suggestion about my technical problem:<br />
I want to create a build that let to user to choose 1 of 2 options (packages) for installation, but<br />
1. How can I add window with radio choice?<br />
2. After user has chosen a package, how can I pass him to right installation path?<br />
Now I have this version:<br />
***********************************************************<br />
<br />
!define TAKING &quot;files_to_take&quot;<br />
!addincludedir &quot;${TAKING}\inc&quot;<br />
!addincludedir &quot;..\common_lib&quot;<br />
<br />
#Things you can change are here<br />
!define VERSION &quot;1.0&quot; <br />
!define PROD_VERSION &quot;1.0&quot;<br />
!define MUTEX &quot;NewSetup&quot;<br />
!define BRAND &quot;Copyright Home Ltd.&quot;<br />
!define COMPLETED &quot;Setup has finished successfully.&quot;<br />
<br />
!define RELEASEDIR &quot;releases\&quot;<br />
!define IMAGES &quot;${TAKING}\img&quot;<br />
!define FILEBASE &quot;game&quot;<br />
!define TEMPFILES &quot;${TAKING}\temp&quot;<br />
!define DISTRO1 &quot;${TAKING}\folder1&quot;<br />
!define DISTRO2 &quot;${TAKING}\folder2&quot;<br />
!define DEST &quot;C:\game&quot;<br />
!define TESTFILE &quot;game.exe&quot;<br />
<br />
#additional file version information here<br />
!define Product_Name &quot;Game&quot;<br />
!define Company_Name &quot;Home&quot;<br />
!define File_Description &quot;Setup Package v.${VERSION}&quot;<br />
SetCompressor /FINAL lzma # Set the compression type<br />
#-------------Pre-Execution Includes------<br />
# Support for &quot;IF&quot; &quot;FOR&quot; and other logic constructs<br />
#-------------Imports from common functions<br />
!define fnCheckForMutex<br />
!define fnDumpLog<br />
#!define fnGetFilePath<br />
!include &quot;LogicLib.nsh&quot; <br />
!include &quot;common.nsh&quot;<br />
!include &quot;Sections.nsh&quot;<br />
!include &quot;WinMessages.nsh&quot;<br />
!include &quot;UMUI.nsh&quot;<br />
<br />
#-------------Modern Interfce Settings-------------------<br />
!define MUI_ABORTWARNING<br />
!define MUI_CUSTOMFUNCTION_GUIINIT myGUIInit<br />
#------Page Macros-----------------------------<br />
!insertmacro MUI_PAGE_WELCOME<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE  prelic<br />
!insertmacro MUI_PAGE_LICENSE &quot;${TAKING}\inc\lic.txt&quot;<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
!insertmacro MUI_LANGUAGE &quot;French&quot;<br />
<br />
#---------------Global things---------------------<br />
Name &quot;${Product_Name} v.${PROD_VERSION}&quot;<br />
ShowInstDetails show<br />
CompletedText &quot;${COMPLETED}&quot;<br />
InstallDir &quot;${DEST}&quot; <br />
BrandingText &quot;${BRAND}&quot;<br />
OutFile ${RELEASEDIR}\${FILEBASE}_v${PROD_VERSION}_${VERSION}.exe<br />
<br />
#----------------Version Information ------------------<br />
VIAddVersionKey &quot;ProductName&quot; &quot;${Product_Name} v.${PROD_VERSION}&quot;<br />
VIAddVersionKey &quot;Comments&quot; &quot;${Comments}&quot;<br />
VIAddVersionKey &quot;CompanyName&quot; &quot;${Company_Name}&quot;<br />
VIAddVersionKey &quot;FileDescription&quot; &quot;${File_Description}&quot;<br />
VIAddVersionKey &quot;FileVersion&quot; &quot;${VERSION}&quot;<br />
VIProductVersion &quot;${PROD_VERSION}&quot;<br />
VIAddVersionKey &quot;LegalCopyright&quot; &quot;Home&quot;<br />
<br />
#-----Global Variables----------------------<br />
var setup_type<br />
var instal_type<br />
#----------Sections-------------------------<br />
<br />
# The Main Section is here - this one is the 2nd executed<br />
Section -First  <br />
  DetailPrint &quot;The setup type is $setup_type.&quot;<br />
  SetOutPath &quot;${DEST}&quot;<br />
  #${If} $setup_type == &quot;fresh&quot;<br />
  # DetailPrint &quot;Executing fresh installation.&quot;<br />
    #SetOutPath &quot;${DEST}&quot;<br />
   # SetOverwrite on<br />
   # File /r ${DISTRO}\*.*<br />
  #${ElseIf} $setup_type == &quot;upgrade&quot;<br />
#------- UPGRADE to a newer version of MATIC  <br />
    # DetailPrint &quot;Upgrading current version ...&quot;<br />
    # SetOutPath ${DEST}<br />
    # SetOverwrite on<br />
     #File /r &quot;${DISTRO}\*.exe&quot;<br />
    # SetOverwrite off<br />
    # File /r &quot;${DISTRO}\*.*&quot;  <br />
    # ClearErrors<br />
  #${EndIf}<br />
  WriteUninstaller &quot;$INSTDIR\Uninstall.exe&quot;<br />
SectionEnd<br />
<br />
#-----------FunishUp---------------<br />
Section -Finishup <br />
<br />
  DetailPrint &quot;**********Finishup section.***************&quot;<br />
  DetailPrint &quot;Create All those nice icons and shortcuts.&quot;<br />
  <br />
  SetShellVarContext all<br />
  SetOutPath $INSTDIR<br />
 <br />
  CreateDirectory &quot;$SMPROGRAMS\game&quot;<br />
  CreateShortCut &quot;$SMPROGRAMS\game\game.lnk&quot; &quot;$INSTDIR\game.exe&quot; <br />
  CreateShortCut &quot;$SMPROGRAMS\game\UninstallerGame.lnk&quot; &quot;$INSTDIR\Uninstall.exe&quot;<br />
  CreateShortCut &quot;$DESKTOP\game.lnk&quot; &quot;$INSTDIR\game.exe&quot;<br />
  DetailPrint &quot;Dumping the log to file.&quot;<br />
  Push &quot;$TEMP\${Product_Name}_Setup_v_${VERSION}_install.log&quot;<br />
  <br />
  Call DumpLog<br />
SectionEnd<br />
#---------Functions ---------------------<br />
<br />
 Section &quot;Uninstall&quot;<br />
    Delete $INSTDIR\Uninstall.exe ; delete self <br />
    Delete $INSTDIR\*.*<br />
	Delete $INSTDIR\folder1\*.*<br />
	Delete $INSTDIR\folder2\*.*<br />
        RMDir $INSTDIR\folder1<br />
	RMDir $INSTDIR\folder2<br />
	RMDir $INSTDIR<br />
SectionEnd<br />
<br />
#--------------------On Init------------------------------<br />
Function .onInit<br />
#Check for Multiple instances<br />
#Put any other mutex checks or &quot;... is running&quot; tests<br />
  ${MutexErr} &quot;${MUTEX}&quot; &quot;This installation is already running.&quot; &quot;&quot;<br />
  ${MutexErr} &quot;MATIC.EXE&quot; &quot;Matic is running. Close it and run this setup again.&quot; &quot;&quot; <br />
  ${If} ${FileExists} &quot;${DEST}\${TESTFILE}&quot; <br />
     StrCpy $setup_type &quot;upgrade&quot;  <br />
  ${Else}<br />
     StrCpy $setup_type &quot;fresh&quot; <br />
  ${EndIf} <br />
   <br />
   MessageBox MB_OK &quot;Now choose one of 2 kinds of installation modes: YES=new1 or NO=new2&quot;<br />
   <br />
   MessageBox MB_YESNO &quot;Again, YES=new1 or NO=new2. Choose right version!&quot; IDYES new1<br />
      Exec :new2<br />
    new1:<br />
 <br />
  InitPluginsDir<br />
  File &quot;/oname=$PLUGINSDIR\button.bmp&quot; \<br />
  &quot;${NSISDIR}\Contrib\skinnedbutton\skins\ishield.bmp&quot;<br />
FunctionEnd <br />
<br />
Function new1<br />
   ${If} $setup_type == &quot;fresh&quot;<br />
    DetailPrint &quot;Executing fresh installation.&quot;<br />
    SetOutPath &quot;${DEST}&quot;<br />
    SetOverwrite on<br />
    File /r ${DISTRO1}\*.*<br />
  ${ElseIf} $setup_type == &quot;upgrade&quot;<br />
     DetailPrint &quot;Upgrading current version ...&quot;<br />
     SetOutPath ${DEST}<br />
     SetOverwrite on<br />
     File /r &quot;${DISTRO1}\*.exe&quot;<br />
     SetOverwrite off<br />
     File /r &quot;${DISTRO1}\*.ini&quot;  <br />
	 File /r &quot;${DISTRO1}\*.udl&quot;<br />
     ClearErrors<br />
  ${EndIf}<br />
  FunctionEnd<br />
<br />
Function new2<br />
   ${If} $setup_type == &quot;fresh&quot;<br />
    DetailPrint &quot;Executing fresh installation.&quot;<br />
    SetOutPath &quot;${DEST}&quot;<br />
    SetOverwrite on<br />
    File /r ${DISTRO2}\*.*<br />
  ${ElseIf} $setup_type == &quot;upgrade&quot;<br />
     DetailPrint &quot;Upgrading current version ...&quot;<br />
     SetOutPath ${DEST}<br />
     SetOverwrite on<br />
     File /r &quot;${DISTRO2}\*.exe&quot;<br />
     SetOverwrite off<br />
     File /r &quot;${DISTRO2}\*.ini&quot;  <br />
	 File /r &quot;${DISTRO2}\*.udl&quot;<br />
     ClearErrors<br />
  ${EndIf}<br />
  FunctionEnd<br />
<br />
Function SaveLog<br />
  Push &quot;$TEMP\${Product_Name}_Setup_v_${VERSION}_install.log&quot;<br />
  Call DumpLog<br />
FunctionEnd<br />
<br />
Function .onInstFailed<br />
   MessageBox MB_OK &quot;Try your installation again in next time.&quot; <br />
   Call SaveLog<br />
FunctionEnd<br />
<br />
Function myGUIInit<br />
  skinnedbutton::skinit /NOUNLOAD &quot;$PLUGINSDIR\button.bmp&quot;<br />
        Pop $0<br />
        StrCmp $0 &quot;success&quot; noerror<br />
           MessageBox MB_ICONEXCLAMATION|MB_OK &quot;skinned button error: $0&quot;<br />
        noerror:<br />
FunctionEnd<br />
<br />
Function prelic<br />
  ${If} $setup_type != &quot;fresh&quot;<br />
    Abort<br />
  ${Endif}<br />
FunctionEnd<br />
<br />
Function .onInstSuccess<br />
    MessageBox MB_YESNO &quot;Congratulation, installation completed sucessfully. Do you want view readme?&quot; IDNO NoReadme<br />
      Exec notepad.exe ; view readme or whatever, if you want.<br />
    NoReadme:<br />
  FunctionEnd<br />
***********************************************************<br />
<br />
Again, this version didn't work properly because it can't reference to nwe1 or new2 functions. Hope to your help!<br />
PS: I just started to work with NSIS scripts</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>