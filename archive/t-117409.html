<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Section control, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Section control NSIS Discussion" />
	
	<title> Section control [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Section control</div>
<hr />
<div class="pda"><a href="t-117409.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=117409">Section control</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">10th December 2002, 19:05</div></div><div class="posttext">The return of the n00bi...<br />
<br />
I *thought* $INSTDIR was supposed to be in the installation path box on the instdir page by default.  Is this not true?  If not, how can I make it the default path?<br />
And if I'm mixing up the Winamp installation directory and the user-chosen directory, just tell me<br />
<br />
I also want to know how I can prevent the user from turning options (A) and (B) both on or both off (i.e. to switch one to the other when the other is turned on, and to disable either from being turned off).<br />
<br />
Also, is it possible to, when an option in subsubsection (B) is turned on, turn off subsection (A)?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th December 2002, 19:22</div></div><div class="posttext">I *thought* $INSTDIR was supposed to be in the installation path box on the instdir page by default.  Is this not true?  If not, how can I make it the default path?<br />
And if I'm mixing up the Winamp installation directory and the user-chosen directory, just tell me<br />
<br />
Yes, $INSTDIR goes into the path box on the instdir. Where do you set it? It's best to set the default $INSTDIR using InstallDir. If you want to set $INST condtionally you should set it in .onInit.<br />
<br />
I also want to know how I can prevent the user from turning options (A) and (B) both on or both off (i.e. to switch one to the other when the other is turned on, and to disable either from being turned off).<br />
<br />
Also, is it possible to, when an option in subsubsection (B) is turned on, turn off subsection (A)?<br />
<br />
Have a look in Examples\one-section.nsi. If you don't understand it, don't hesitate to ask again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">10th December 2002, 19:40</div></div><div class="posttext">I saw that, it didn't really answer my question, since it doesn't switch between two different options...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th December 2002, 19:45</div></div><div class="posttext">It shows you how. Using SectionSetFlags, SectionGetFlags and .onSelChange. You can save the last selected section of the two, on every call to .onSelChange check if it's still checked. If it is checked, and the second one too you need to turn off the second. If it's off and the second one too you should turn on the second. If it's on and the second one is off, do nothing.<br />
<br />
One-section does exactly that with 4 sections.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">10th December 2002, 20:12</div></div><div class="posttext">Okay...I think I've got it<br />
<br />
Is there any way to have 3 nested menus:<br />
Menu<br />
.Submenu<br />
..Sub-submenu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th December 2002, 20:20</div></div><div class="posttext">Sure:<br />
<br />
SubSection bla<br />
  Section blo<br />
  SectionEnd<br />
  SubSection innerbla<br />
    Section innerblo<br />
    SectionEnd<br />
  SubSectionEnd<br />
SubSectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">10th December 2002, 21:14</div></div><div class="posttext">Oooh...ahhh...Thanx :p<br />
<br />
But now I can't figure out how to set the flag to what I want.  I'll assume for now that this is not kosher:<br />
<br />
SectionSetFlags ${avs} ${S_SLBLDEXP}<br />
SectionSetFlags ${avs2} ${S_SELECTED}<br />
SectionSetFlags ${avs3} ${S_NOSELECT}<br />
SectionSetFlags ${ape} ${S_SLCTXPND}<br />
SectionSetFlags ${ape2} ${S_SELECTED}<br />
SectionsetFlags ${ape3} ${S_NOSELECT}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th December 2002, 14:36</div></div><div class="posttext">SectionSetFlags doesn't care if the section is inside a sub section or not. Just give the section a name and use it with SectionSetFlags, it should work.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">11th December 2002, 18:10</div></div><div class="posttext">...I did do that, didn't I...?  Sorry, I'm new to all of this :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th December 2002, 18:26</div></div><div class="posttext">I can't know what you did if I don't have the script ;)<br />
<br />
It's just the same as a regualr section:<br />
<br />
Section &quot;display name&quot; DEFINED_NAME<br />
<br />
And then use it like always:<br />
<br />
SectionGetFlags ${DEFINED_NAME} $0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">11th December 2002, 22:47</div></div><div class="posttext">So I can't just do:<br />
<br />
SectionSetFlags ${avs} 32<br />
<br />
instead I'd do this:<br />
!define EXPANDED 32<br />
...<br />
SectionSetFlags ${avs} ${EXPANDED}<br />
<br />
or this:<br />
!define EXPANDED 32<br />
...<br />
StrCpy $0 ${EXPANDED}<br />
SectionSetFlags ${avs} $0<br />
<br />
I'm asking because that makes absolutely no sense whatsoever :)<br />
<br />
What I meant by &quot;I can't figure out how to set the flag to whatever I want&quot; was &quot;I tried this code and it didn't work.&quot;  Basically it set everything to 0, except for the section I didn't (try to) set.<br />
<br />
I also tried this, and it did the same thing:<br />
<br />
Function .onInit<br />
<br />
StrCpy $0 ${SELECTED}<br />
IntOp $1 $0 + ${EXPANDED}<br />
IntOp $2 $1 + ${BOLDFACE}<br />
StrCpy $3 ${NOSELECT} ; 0<br />
SectionSetFlags ${avs} $2<br />
SectionSetFlags ${avs2} $0<br />
SectionSetFlags ${avs3} $3<br />
SectionSetFlags ${ape} $1<br />
SectionSetFlags ${ape2} $0<br />
SectionsetFlags ${ape3} $3<br />
<br />
FunctionEnd<br />
<br />
:conf00zed:<br />
<br />
<br />
btw, thanks for tolerating me :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th December 2002, 16:09</div></div><div class="posttext">OK, here goes:<br />
<br />
Each section, whether inside a sub section or not, has a name and a unique number identifying it. The unique number starts from 1 for the first section and goes up for each section, subsection or subsectionend. To avoid having to count the numbers and change them all whenever you add/remove a section the Section command receives a third parameter that is defined as the number of the section.<br />
<br />
For example:<br />
Section bla Sec1<br />
SectionEnd<br />
Section bla Sec2<br />
MessageBox MB_OK ${Sec1}<br />
MessageBox MB_OK ${Sec2}<br />
SectionEnd<br />
<br />
Will pop up two message boxes. The first one will say 1, and the second 2.<br />
<br />
Every section also has flags which you can get using SectionGetFlags and change using SectionSetFlags. The flags are:<br />
<br />
# Section selected<br />
!define SF_SELECTED   1<br />
# Section is a subsection<br />
!define SF_SUBSEC     2<br />
# Section is a subsection end<br />
!define SF_SUBSECEND  4<br />
# Section is shown bold in the components page<br />
!define SF_BOLD       8<br />
# Section is read-only<br />
!define SF_RO         16<br />
# Subsection is to be automatically expanded<br />
!define SF_EXPAND     32<br />
<br />
All but the first flag is changeable from everywhere. The first flag (selected) should only be changed after the components page is created, because when it is created it checks for the default configuration and selects the appropriate sections according to it. If you don't have installation options (InstType) then you can change the section from .onInit too and it should be ok.<br />
<br />
Now, if you want to control what the user can and can not choose you should use the .onSelChange callback function which is called whenever the user clicks on a section. It's in this function where you should determine if the clicked section should remain clicked, be disabled, other section be disabled or enabled, made read-only or bolded.<br />
<br />
Now that you know where everything should go, and what it means we shall move on to the real coding.<br />
<br />
What you want is to force the user to select only one section out of two. one-section.nsi does the exact same thing with four sections. It does this by first checking only one section and unchecking the rest in .onInit. It also takes note of the section it selected for later use. Whenever the user clicks on a section and .onSelChange is called it turns off the old selected section (line 57 in the script), goes over all four sections and checks which one is selected (could be only one section or zero sections). If no section has been selected it means that the user clicked a section other than the four it is trying to control and that means we should turn the old selected section back on (line 83). If there was a selection it remembers it for the next time .onSelChange will be called. This way, only one section can be selected at a time because we always turn off the old selected section.<br />
<br />
I hope this clears it up.<br />
<br />
BTW, IntOp $1 $0 + ${BOLDFACE} is not good. You need to or ( using | ) $0 with ${BOLDFACE}, not add them. If you add them and $1 is already bold then 1+1 is 10 and not 1 as you wanted it to be...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">12th December 2002, 18:37</div></div><div class="posttext">I still don't know where I'm supposed to initialize the section flags, which is my problem.  Past that I'm pretty damn sure I can make the components selections calculate primes in binary, if I wanted to :p<br />
<br />
*thinks about the logic paramaters for a second*<br />
<br />
Oh...duh. I should know that by now :rolleyes:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">14th December 2002, 23:52</div></div><div class="posttext">Umm...anyone? :cry:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th December 2002, 18:44</div></div><div class="posttext">Sorry, this:<br />
<br />
*thinks about the logic paramaters for a second* <br />
<br />
Oh...duh. I should know that by now <br />
<br />
made me think that you understood.<br />
<br />
Initialize the sections in the first call for .onSelChange.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">16th December 2002, 06:41</div></div><div class="posttext">I was talking about the OR vs. +.<br />
And I still don't understand - do you mean the first time .onSelChange is called?  And wouldn't that make it so that the first time someone changed the setup, it would initialize; instead of initializing...when the page is...initialized...?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th December 2002, 16:09</div></div><div class="posttext">You should always use `|` for flags.<br />
<br />
If you initialize the section everytime the page loads, like I said before, it will reset the user selection whenever the user gets back to that page.<br />
<br />
If you have install types (InstType) then the first install type will be chosen automatically on start-up and you won't have anything to worry about, but if you don't you will have to set it in .onInit. In any way you will have to set current section variable ($1 in one-section.nsi) to the section that is first selected in .onInit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">16th December 2002, 17:53</div></div><div class="posttext">God do I feel stupid now :rolleyes: I completely forgot that one of the preset-install-types is selected on the first page load.<br />
<br />
Thanx again for your help and toleranace :p</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">17th December 2002, 19:48</div></div><div class="posttext">Sorry to keep bothering you about this, but how do I set a section to expanded or boldface .onInit?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th December 2002, 20:07</div></div><div class="posttext">SectionGetFlags ${section} $0<br />
IntOp $0 $0 | ${SF_BOLD}<br />
# or<br />
# IntOp $0 $0 | ${SF_EXPAND}<br />
SectionSetFlags ${section} $0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">17th December 2002, 21:48</div></div><div class="posttext">If you mean put that in .onInit it's not working (nothing changed).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th December 2002, 22:05</div></div><div class="posttext">Works fine for me. Please attach the script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">17th December 2002, 23:27</div></div><div class="posttext">:cry:<br />
<br />
Here</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th December 2002, 23:37</div></div><div class="posttext">You work on $R0 yet the flags are in $0 and you set them from $0... Change it to:<br />
<br />
SectionGetFlags ${avs} $0<br />
IntOp $0 $0 | ${BOLDFACE}<br />
IntOp $0 $0 | ${EXPANDED}<br />
SectionSetFlags ${avs} $0<br />
<br />
SectionGetFlags ${ape} $0<br />
IntOp $0 $0 | ${EXPANDED}<br />
SectionSetFlags ${ape} $0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">18th December 2002, 00:53</div></div><div class="posttext">Oops.  Didn't see that.<br />
<br />
It still didn't change though.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th December 2002, 14:57</div></div><div class="posttext">Attach the corrected script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">18th December 2002, 17:52</div></div><div class="posttext">It's exactly the same as before, just with that bit fixed (exactly the way you said).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th December 2002, 18:14</div></div><div class="posttext">If this script works you are still using NSIS 2.0a7. Upgrade first.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">18th December 2002, 19:51</div></div><div class="posttext">I did.  I just re-installed NSIS2b0.<br />
<br />
And what script?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th December 2002, 19:56</div></div><div class="posttext">The script you have attached. It uses Fonts.dll:: which is the old syntax of a7 and below. If that works you are still using a7. Make sure in the log that it is b0 you are running.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">18th December 2002, 21:02</div></div><div class="posttext">Whoah...Apparently the wrapper (which is what I've been using) is a7, but the DOS version is b0.  I dun get it...<br />
<br />
Anyway, using the DOS version works.  Thanx</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th December 2002, 21:07</div></div><div class="posttext">I suggest you delete every directory you have installed NSIS in and install one instance of NSIS 2.0b0. When ohter version come out, install into that directory.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">18th December 2002, 22:15</div></div><div class="posttext">Did so, it's working now :)<br />
<br />
Are there any logical operators (as in IF or FOR) in NSIS2b0?  It'd make this process so much easier..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th December 2002, 14:19</div></div><div class="posttext">Nope, that will come in NSIS 3.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">19th December 2002, 18:31</div></div><div class="posttext">*thinks*<br />
<br />
Doesn't seem THAT hard to program, if you have a real language to work with (as opposed to NSIS2 script :p )</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th December 2002, 23:38</div></div><div class="posttext">I prefer to work on more important stuff for NSIS 2 and not waste my time destroying the current scripting language. It will all be added in NSIS 3 (if, for, while, funcitons with parms, more than one command per line, maybe even classes).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">20th December 2002, 02:00</div></div><div class="posttext">if you ask me, logical flow functions are extremely important to any programming language, and you wouldn't exactly &quot;destroy&quot; nsis by adding it...but that's just one user's opinion :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirkdeftly</div><div class="date">21st December 2002, 05:56</div></div><div class="posttext">Gah...sorry, I just realized what I was doing wrong.  If a mod would like to delete this, they may...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>