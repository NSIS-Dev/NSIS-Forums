<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Dynamic Version Information, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Dynamic Version Information NSIS Discussion" />
	
	<title> Dynamic Version Information [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Dynamic Version Information</div>
<hr />
<div class="pda"><a href="t-263441.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=263441">Dynamic Version Information</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Nniol</div><div class="date">11th January 2007, 07:58</div></div><div class="posttext">Hi,<br />
<br />
My install is rebuilt every night form a nightly build script, however ther version of the install file, set in <br />
<br />
VIAddVersionKey /LANG=${LANG_ENGLISH} &quot;FileVersion&quot; &quot;310.0.0.154&quot;<br />
<br />
VIProductVersion &quot;310.0.0.154&quot;<br />
<br />
Must be the same the executable about to be installed, this can be retrieved using GetDllVersionLocal, however seeing as VIAddVersionkey and VIProductVersion can not be in Sections or Functions it is hard to make dynamic.<br />
<br />
Is it possible to retrieve the version information in .onInit and then assign it to a variable which is later assigned in VIAddVersionKey and VIProductVersion<br />
<br />
VIProductVersion $DynamicallyDeterminedVersionNumber<br />
VIAddVersionKey /LANG=${LANG_ENGLISH} &quot;FileVersion&quot; $DynamicallyDeterminedVersionNumber<br />
<br />
<br />
Nniol</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">11th January 2007, 08:47</div></div><div class="posttext">on the top of your script execute with !system an exe that retrieves the desired info and adds them as defines to a header e.g. versions.nsh and then !include versions.nsh to your script.<br />
e.g.<br />
the small exe:<br />
section<br />
FileOpen $0 '$EXEDIR\versions.nsh<br />
call GetDllVersionLocal<br />
FileWrite $0 '!define File_Ver &quot;&lt;resulting_var_from_call&gt;&quot;$\r$\n'<br />
FileClose $0<br />
sectionend<br />
<br />
the main script,<br />
!system &quot;$EXEDIR\small.exe&quot;<br />
!include versions.nsh<br />
............<br />
VIProductVersion &quot;${File_Ver}&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">11th January 2007, 08:50</div></div><div class="posttext">edit: Red Wine beat me to it, that should teach me not to read some random blog before hitting submit :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Nniol</div><div class="date">11th January 2007, 09:05</div></div><div class="posttext">Thaanks guys, a real life saver there<br />
<br />
Nniol (not so Insane anymore)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">niteflyer</div><div class="date">11th January 2007, 12:45</div></div><div class="posttext">This macro does the same and a little more:<br />
http://nsis.sourceforge.net/NfUtils_header_file#nfu.SetVersionInfo</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">11th January 2007, 13:28</div></div><div class="posttext">Originally posted by niteflyer <br />
This macro does the same and a little more:<br />
http://nsis.sourceforge.net/NfUtils_header_file#nfu.SetVersionInfo  <br />
No doubt, though, I'd need an example to show me how to achieve the requested by Nniol issue. That's why my preferred way was the very simple code above :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">niteflyer</div><div class="date">11th January 2007, 13:47</div></div><div class="posttext">${nfu.SetVersionInfo} does not include /LANG= in VIAddVersionKey but you could use ${nfu.!FileVersion} to store the version in a symbol:<br />
<br />
<br />
${nfu.!FileVersion} DynamicallyDeterminedVersionNumber &quot;c:\myproject\myapp.exe&quot;<br />
VIProductVersion ${DynamicallyDeterminedVersionNumber}<br />
VIAddVersionKey /LANG=${LANG_ENGLISH} &quot;FileVersion&quot; ${DynamicallyDeterminedVersionNumber}<br />
<br />
should do it (untested).<br />
<br />
see http://nsis.sourceforge.net/NfUtils_header_file#nfu..21FileVersion<br />
<br />
If you dont need /LANG in VIAddVersionKey then you might want to use<br />
<br />
<br />
${nfu.SetVersionInfo} &quot;My Installer&quot; &quot;c:\myproject\myapp.exe&quot; &quot;My Company&quot; &quot;My Copyright 2007&quot; &quot;No Comments&quot;</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>