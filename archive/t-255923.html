<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Delete empty dirs/subdirs from directory file - strange behaviour, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Delete empty dirs/subdirs from directory file - strange behaviour NSIS Discussion" />
	
	<title> Delete empty dirs/subdirs from directory file - strange behaviour [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Delete empty dirs/subdirs from directory file - strange behaviour</div>
<hr />
<div class="pda"><a href="t-255923.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=255923">Delete empty dirs/subdirs from directory file - strange behaviour</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">saschagottfried</div><div class="date">21st September 2006, 16:27</div></div><div class="posttext">I report a strange behaviour for the combination of instructions: Locate, RMDir<br />
<br />
I use filelists to install and for uninstallation. Installation works well, but I have to remove empty dirs after deleting every file read from the filelist.<br />
<br />
I tried Recfind, Locate with Callbackfunction, read a lot in the forum. After generating the DirList with Locate or RecFind, I process it from the end to start to delete empty dirs/subdirs. But RMDir can not delete anything. <br />
<br />
*Manual deletion of those directories works.<br />
*I know that current directory can't be deleted - I switch before deletion.<br />
*I test whether the directory are recognized as dirs and if they are empty or not.<br />
* I already tried /REBOOTOK, that deleted the subdirs after Reboot. This would just be a lazy fix. I KNOW that no Reboot is necessary.<br />
<br />
Strange Behaviour:<br />
I splitted the code into two sections. One creates the directorylist. The other one reads it and invokes RMDir on those paths.<br />
<br />
If I execute both section afterwards, RMDir can not delete dirs. Thus I used &quot;/o&quot; on second section to skip it in first run of &quot;installer&quot;. The list got created. Installer exits without trying to read and delete the dirs. Second Run: I edited my source code to unselect the first section. After execution the dirlist got read and deleted without any problems. &quot;Strange, huh&quot; as Guybrush Threepwood would comment in this case.<br />
<br />
I would like to have first some explanation of this behaviour and in second place suggestions for existing &quot;solutions&quot; for this task. <br />
<br />
I added the code as attachment. You have to create &quot;C:\testdir&quot; with some subdirs hierarchy in it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd September 2006, 12:34</div></div><div class="posttext">The problem is with GetSize. It doesn't properly close the search handles it opens. Locate seems a little problematic on the subject as well. When its callback passes stop it and in another case I still haven't figured out, it doesn't close the last opened handle.<br />
<br />
If Locate or RecFind is giving you problems, you can use my old function (http://nsis.sourceforge.net/Search_For_a_File). As for GetSize, either wait for Instructor to fix it, or implement your own solution using Locate.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">saschagottfried</div><div class="date">22nd September 2006, 14:01</div></div><div class="posttext">I am really happy that you cared about my problem. Great work. <br />
I started to use GetSize to prove that Locate writes the same number of dirs in my dirlist-file as GetSize reports. I kept GetSize in my code and thus switching from Locate to RecFind did not helped. Now I know the reason. Well done. I really appreciate your work for all forum members.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrDan</div><div class="date">8th June 2007, 14:05</div></div><div class="posttext">I simply can't get the example &quot;Example (Delete empty directories):&quot; in &quot;Appendix E.1.2 Locate&quot; to work.<br />
<br />
Any idea if this has been or will be fixed?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">saschagottfried</div><div class="date">13th June 2007, 17:08</div></div><div class="posttext">Please provide more information! What is your problem, what code you used to solve this and so on. Please append your code and describe its purpose.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrDan</div><div class="date">14th June 2007, 09:31</div></div><div class="posttext">One of my colleagues helped me to work out another algorithm to do this without using Locate.<br />
<br />
The problems I was experiencing with the Locate example were directories not being deleted.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">saschagottfried</div><div class="date">14th June 2007, 15:00</div></div><div class="posttext">Fine. But the idea of a installation tool could be that you just use built in function without the need to develop a special workaround for simple task. <br />
<br />
If you do not mind, share your example with us. Imagine the next example you can not get to run. Develop the next algorithm or ask the community? Anyways, I think if there is a problem with Locate you should tell us. Cheers!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrDan</div><div class="date">15th June 2007, 10:12</div></div><div class="posttext">Luckily, I have finally had some time to look into this carefully, and I am completely wrong. :D :D :D The example does work correctly. :D :D :D :D :D :D :D<br />
<br />
I withdraw my previous comment that the example did not work.<br />
<br />
Apologies for the confusion.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrDan</div><div class="date">15th June 2007, 10:17</div></div><div class="posttext">And here's an example that works.<br />
<br />
If you wish to run it, change the !define MY_FILE  on line 18 to any dummy file you have lying around.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrDan</div><div class="date">15th June 2007, 10:18</div></div><div class="posttext">Missed the attachment.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">15th June 2007, 10:37</div></div><div class="posttext">${locate::RMDirEmpty} (http://nsis.sourceforge.net/Locate_plugin) fast algorithm</div></div><hr />


<div class="post"><div class="posttop"><div class="username">saschagottfried</div><div class="date">15th June 2007, 12:10</div></div><div class="posttext">@Instructor:<br />
<br />
Is your Plugin the code base for FileFunc.nsh? What about your special RMDirEmpty function. Will it find its way into main NSIS? Anyways, I will check this function next time.<br />
<br />
@DrDan:<br />
<br />
Thanks a lot. Its always like this: as soon as you do it right, it works. Great stuff! *g*</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>