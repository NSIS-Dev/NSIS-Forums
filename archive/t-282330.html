<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Scheduled Task with Multiple Schedules?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Scheduled Task with Multiple Schedules? NSIS Discussion" />
	
	<title> Scheduled Task with Multiple Schedules? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Scheduled Task with Multiple Schedules?</div>
<hr />
<div class="pda"><a href="t-282330.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=282330">Scheduled Task with Multiple Schedules?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Coolblu77</div><div class="date">29th November 2007, 14:29</div></div><div class="posttext">I'm new to using NSIS.<br />
<br />
I've found the plugin code for creating Scheduled Tasks (http://nsis.sourceforge.net/Scheduled_Tasks).<br />
<br />
Is it possible to create one with multiple schedules?<br />
i.e. start daily at 7:30 and run every 30 minutes (I've got this bit working), but also start at System Startup.<br />
<br />
Thanks for any help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th November 2007, 17:17</div></div><div class="posttext">That should be possible if you duplicate the lines that create the trigger and modify them to add a different trigger. It starts with the CreateTrigger() call and ends in freeing the TASK_TRIGGER structures.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Coolblu77</div><div class="date">30th November 2007, 10:25</div></div><div class="posttext">Thanks for your reply.<br />
<br />
I've been trying to copy the lines that add the trigger.<br />
<br />
  ; ITask-&gt;CreateTrigger(trindex, ITaskTrigger)<br />
System::Call '$R2-&gt;3(*i .R4, *i .R5)'<br />
; allocate TASK_TRIGGER structure  <br />
System::Call '$5'  Pop $R6   <br />
; ITaskTrigger-&gt;SetTrigger  <br />
System::Call '$R5-&gt;3(i R6)'       <br />
; ITaskTrigger-&gt;Release  <br />
System::Call '$R5-&gt;2()'        <br />
; free TASK_TRIGGER structure  <br />
System::Free $R6 <br />
<br />
But as I said before I'm new to this and don't really know what I'm doing.<br />
Where do I put the new trigger values?<br />
<br />
I've been changing this line (on the 2nd copy):<br />
  ; ITaskTrigger-&gt;SetTrigger  <br />
System::Call '$R5-&gt;3(i R6)' <br />
to:<br />
  ; ITaskTrigger-&gt;SetTrigger  <br />
System::Call '$R5-&gt;3(i &quot;*(&amp;l2, &amp;i2 0, \          <br />
&amp;i2 2007, &amp;i2 1, &amp;i2 1, \          <br />
&amp;i2 0, &amp;i2 0, &amp;i2 0, \          <br />
&amp;i2 7, &amp;i2 1, \          <br />
i 0, \          <br />
i 0, \          <br />
i 0, \          <br />
i 6, \          <br />
i 0, &amp;i2 0, i 0, &amp;i2 0) i.s&quot;)' <br />
What I'm trying to do is have 2 triggers. The 1st will run the task at a particular time at 30 minute intervals, which works fine.<br />
This 2nd trigger should schedule the task to run at system startup, however instead its setting this trigger to run once at the current time.<br />
<br />
Obviously I'm missing something, hopefully just some syntax, but possibly I'm doing it completely wrong.<br />
<br />
Also I didn't like to push the 2nd trigger values in the same way as the first, because I think all those values are popped into registers, and all 10 are in use already (I think).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th November 2007, 12:29</div></div><div class="posttext">According to MSDN, you only need to specify TASK_EVENT_TRIGGER_AT_SYSTEMSTART (== 6) in the trigger type field of the TASK_TRIGGER structure. It seems you've already done that but missed one field. The TriggerType field is fourth from the end. You've set the fifth field to 6.<br />
<br />
As for the registers, you have 20 (you forgot $R0-$R9) by default and you can declare more using Var.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Coolblu77</div><div class="date">30th November 2007, 13:02</div></div><div class="posttext">Thanks again for your reply.<br />
<br />
I'm a little confused though, are you sure I've missed a field?<br />
<br />
System::Call '$R5-&gt;3(i &quot;*(&amp;l2, &amp;i2 0, \  ; skip<br />
&amp;i2 2007, &amp;i2 1, &amp;i2 1, \                ; Begin YY MM DD<br />
&amp;i2 0, &amp;i2 0, &amp;i2 0, \                   ; End YY MM DD<br />
&amp;i2 7, &amp;i2 1, \                          ; Start HH MM<br />
i 0, \                                   ; Duration<br />
i 0, \                                   ; Interval<br />
i 0, \                                   ; Flags<br />
i 6, \                                   ; Trigger<br />
i 0, &amp;i2 0, i 0, &amp;i2 0) i.s&quot;)'           ; not sure about the last line, <br />
                                           I copied this from the example in the comments <br />
<br />
As I understand it for this trigger the only parameters that might need a value are the start date and time, and of course the trigger.<br />
<br />
<br />
Also I know I could define a variable, although I'm not sure about the scope of them and some syntax (need to read more tutorials), but thought it would be simplier to hard code this trigger, as every install will use this trigger, the other daily trigger might change start time from one user to another, so thats being pushed as in the example.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th November 2007, 13:08</div></div><div class="posttext">There's some field confusion. You've one extra field in the end or some fields are mixed up. You said you wanted it be triggered on system start-up. For that, the fourth field from the end needs to be 6, not the fifth. I suggest you look for TASK_TRIGGER in MSDN and make sure every field is where it should be.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Coolblu77</div><div class="date">4th December 2007, 10:20</div></div><div class="posttext">I've got it working.<br />
<br />
I still don't understand what's needed for the last params, as far as I can tell if the TriggerType is 6 (or some others) then the next field the Type (TRIGGER_TYPE_UNION) is not required, then the next field is reserved so needs a 0, and the last field is not used.<br />
However from my testing the only combination that seems to work, has &quot;&amp;i2 0, i 0, i 0, &amp;i2 0&quot; after the trigger type, this looks wrong, but works.<br />
<br />
My main problem was that I was passing in a string instead of a pointer to a TASK_TRIGGER. I found this out by using some message boxes.<br />
After trying to hard code the values directly, and copying to a var and pushing and popping them, I finally came across System::Call with a register name, this works fine.<br />
<br />
So in case anyone else has problems with this, all I had to do was copy the section mentioned above, but replace Pop$R6 with   ; put the trigger values into a buffer on R6  <br />
System::Call &quot;*$R6(&amp;l2, &amp;i2 0, \          <br />
&amp;i2 2003, &amp;i2 9, &amp;i2 4, \          <br />
&amp;i2 0, &amp;i2 0, &amp;i2 0, \          <br />
&amp;i2 7, &amp;i2 01, \          <br />
i 0, i 0, \          <br />
i 0, \          <br />
i 6, \          <br />
&amp;i2 0, i 0, i 0, &amp;i2 0) i.s&quot;</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>