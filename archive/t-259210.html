<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Service Creation Function, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Service Creation Function NSIS Discussion" />
	
	<title> Service Creation Function [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Service Creation Function</div>
<hr />
<div class="pda"><a href="t-259210.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=259210">Service Creation Function</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">9th November 2006, 17:10</div></div><div class="posttext">The below function, only KIND OF works.  It installs the service and puts the user name in there, but you have to re-enter the password in order to start it.  Can anyone see what I'm doing wrong?<br />
<br />
&lt;!-------------------snip--------------------&gt;<br />
Function serviceUtility<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
;; Install Service if not installed ;;<br />
;;                                  ;;<br />
;; Pass to function:                ;;<br />
;;  $R8 - Service Name              ;;<br />
;;  $R7 - Path to executable        ;;<br />
;;                                  ;;<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
<br />
  !insertmacro SERVICE &quot;installed&quot; &quot;$R8&quot; 0<br />
  pop $0<br />
  strCmp $0 'false' createService<br />
  !insertmacro SERVICE &quot;stop&quot; &quot;$R8&quot; 0<br />
  Goto endServiceUtility<br />
<br />
  createService:<br />
  strCmp $R9 &quot;1&quot; serviceUtility1				;if we already have userName and password continue to create<br />
  strCpy $R9 1							;note that we've already gotten the user, password, and computername<br />
  Dialogs::InputBox &quot;UserID&quot; &quot;Please enter service username to run new service as&quot; &quot;OK&quot; &quot;Cancel&quot; &quot;0&quot; ${VAR_R1}<br />
  Dialogs::InputBox &quot;Password&quot; &quot;Please enter the service user password:&quot; &quot;OK&quot; &quot;Cancel&quot; &quot;1&quot; ${VAR_R2}<br />
  serviceUtility1:<br />
<br />
  nsSCM::Install &quot;$R8&quot; &quot;$R8&quot; 16 2 &quot;$R7&quot; &quot;&quot; &quot;&quot; &quot;$R1&quot; &quot;$R2&quot;<br />
<br />
<br />
  endServiceUtility:<br />
<br />
FunctionEnd<br />
&lt;!------------------end snip-----------------&gt;<br />
<br />
Thanks Much,<br />
Eric</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th November 2006, 17:58</div></div><div class="posttext">Try prefixing the user name with .\ as MSDN suggests.If the service type is SERVICE_WIN32_OWN_PROCESS, use an account name in the form DomainName\UserName. The service process will be logged on as this user. If the account belongs to the built-in domain, you can specify .\UserName.It might fail to find the user, show up the dialog which has a better search method for the user, but where the password is already lost.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">9th November 2006, 18:24</div></div><div class="posttext">I can't because the user is a domain user rather than local.  So it's going to be:<br />
<br />
DomainName\UserName<br />
<br />
It sets the user up correctly in the service, just seems to fail on the password.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">9th November 2006, 18:32</div></div><div class="posttext">OK, figured it out.  There is no problem with this script.  The problem lies in our domain default group policy.  The specific user has to be granted logon rights in order to be started with Net Start command.  Is there a way to script this in NSIS that anyone knows?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>