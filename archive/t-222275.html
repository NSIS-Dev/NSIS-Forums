<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSISArray plugin, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSISArray plugin NSIS Discussion" />
	
	<title> NSISArray plugin [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSISArray plugin</div>
<hr />
<div class="pda"><a href="t-222275.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=222275">NSISArray plugin</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd July 2005, 18:28</div></div><div class="posttext">A plugin which adds fast dynamic array support to NSIS with over 20 functions for array manipulation.<br />
It also has an array script header to mask the plugin calls with a more friendly scripting syntax.<br />
<br />
http://nsis.sourceforge.net/wiki/File:NSISArray.zip<br />
<br />
Please note:<br />
If you have a previous release of NSISArray installed, please delete the Contrib\NSISArray and Examples\NSISArray folders before installing the new release.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">24th July 2005, 21:58</div></div><div class="posttext">Hey Afrow,<br />
I just downloaded your new plugin and from what I've seen, it looks great!  (Excellent job!)<br />
<br />
But I have one quick question:<br />
In the Include folder, you have the file NSISArray.nsh.  But the file includes another NSISArray.nsh file located in ${NSISDIR}\Contrib\NSISArray.  Why not just have the one real NSISArray.nsh in the include folder?  (This would be less confusing and easier to maintain in my opinion.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">24th July 2005, 22:07</div></div><div class="posttext">If there is only source code in the Contrib folder (so nothing for the end-user), I would also recommend you to put the actual contents in Include.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th July 2005, 00:37</div></div><div class="posttext">Good question! I think I just did it because of Modern UI and my Self-Extractor kit. It just keeps all the source code (C++/NSIS) in one folder so if someone (or I) wants to modify the source code (plugin code or the NSIS code), we know where to find it.<br />
<br />
The readme and some examples are also in the Contrib folder so again, everything is kept close together.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">25th July 2005, 02:38</div></div><div class="posttext">I was testing the arrays and ran into a few problems.  Please look at this dummy script:<br />
<br />
name 'test array'<br />
outfile 'test_array.exe'<br />
!include NSISArray.nsh<br />
<br />
Section<br />
  DetailPrint &quot;Initializing array...&quot;<br />
  ${Array} &quot;TestArray&quot;<br />
  ${TestArray-&gt;Init}<br />
  DetailPrint &quot;adding 'dog'&quot;<br />
  ${TestArray-&gt;Push} &quot;dog&quot;<br />
  DetailPrint &quot;Adding 'hippo'&quot;<br />
  ${TestArray-&gt;Push} 'hippo'<br />
  DetailPrint &quot;Adding 'cat'&quot;<br />
  ${TestArray-&gt;Push} 'cat'<br />
  ${TestArray-&gt;SizeOf} $0<br />
  DetailPrint &quot;My Array now contains $0 items:&quot;<br />
  ${TestArray-&gt;Search} $1 &quot;dog&quot; 0<br />
  DetailPrint &quot;'Dog' is item $1&quot;<br />
  DetailPrint &quot;All items: &quot;<br />
  ${TestArray-&gt;Concat} $2 &quot;, &quot;<br />
  DetailPrint $2<br />
SectionEnd<br />
<br />
page instfiles<br />
<br />
<br />
During compile, on this line:<br />
${TestArray-&gt;Search} $1 &quot;dog&quot; 0<br />
I get this error:<br />
!insertmacro: macro &quot;Array_Search&quot; requires 4 parameter(s), passed 5!<br />
<br />
If I REM this line, then I get an error at runtime that says &quot;SizeOf:parameter error&quot;  <br />
<br />
Am I being stupid or are these both bugs?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">25th July 2005, 13:37</div></div><div class="posttext">Originally posted by Afrow UK <br />
Good question! I think I just did it because of Modern UI and my Self-Extractor kit. It just keeps all the source code (C++/NSIS) in one folder so if someone (or I) wants to modify the source code (plugin code or the NSIS code), we know where to find it.<br />
<br />
The readme and some examples are also in the Contrib folder so again, everything is kept close together.<br />
<br />
-Stu <br />
The point is that the Modern UI also puts other NSIS header files (langauge files) and data in the 'Contrib\Modern UI' folder.<br />
<br />
Documentation and source files are indeed also in the Contrib folder on the CVS server, but for end-user releases the build system puts documentation in the Docs folder and examples in the Examples folder.<br />
<br />
So whenever releasing a compiled plug-in for the end-user, there should be nothing in Contrib at all, just a binary in Plugins, a readme in Docs and a example in Examples (and maybe a header file in Include).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th July 2005, 19:32</div></div><div class="posttext">Ah right I see.<br />
I'll change everything so it's like that (nsh in Include, docs in Docs).<br />
<br />
Edit: Yeh they are bugs. One was an error in the plugin code and the other was in the NSH. Uploading new build now.<br />
<br />
Edit #2: Uploaded.<br />
Before installing, delete the Contrib\NSISArray folder, because now the readme is in Docs, and NSH in Include.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">25th July 2005, 20:23</div></div><div class="posttext">Thanks, Afrow.  <br />
<br />
hmmm.. Technical difficulties: I can't seem to get to the Wiki at the moment.  As soon as it lets me, I'll download it and try it out.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">25th July 2005, 21:11</div></div><div class="posttext">The SourceForge database server has performance issues, they are working on doubling the capacity. In the meanwhile the NSIS Site and Wiki may be slow during peak times.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">27th July 2005, 04:22</div></div><div class="posttext">Hey Afrow,<br />
The sample script above seems to work, but I need you clarify something for me regarding the 'SizeOf' function.<br />
<br />
Your docs describe this as:<br />
Places the amount of items in myArray into $Var.  <br />
Based on this, I would expect it to return the total number of elements in the array.  However, using the example above, I see that it returns 2, not three.  While 2 is the highest element number (due to the fact that the array is zero-based), the total number of elements (items) in the array is actually 3.<br />
<br />
So, I feel that either your function or the documentation are wrong.  (either way you go is fine, but one should match ther other.)  Would you agree?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th July 2005, 20:35</div></div><div class="posttext">That's interesting. For some reason in the source I was taking 1 away from the output (when I shouldn't have been).<br />
<br />
I will recompile and upload v0.3<br />
<br />
Thanks for finding this out.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">29th July 2005, 00:27</div></div><div class="posttext">No problem.  I've been wanting to check some of the other functions, but just haven't had time. From the little I've worked with it, this looks like it will be a very powerful plugin.<br />
<br />
And I have to complement you on the array debug utility you included with this plugin.  That is a really nice touch--should make problem solving a lot easier.  <br />
<br />
I can tell you put a lot of thought into this.  Keep up the great work! :up: :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">29th July 2005, 05:08</div></div><div class="posttext">Ok Afrow, now that I've buttered you up, I've got several bugs to report! :eek: <br />
<br />
you are really gonna get tied of me!  hehe! <br />
:p <br />
<br />
Note: this is just some quick prelim testing.  Time permitting, I'd like to test all functions. (Feel free to use a PM if you think that'd be easier.)  Sample scripts for each are attached.<br />
<br />
Bug #1<br />
(Test_01.nsi) Calling Write to an existing array overwrites the element as expected, but also adds an empty element to the end of the array.<br />
<br />
Bug #2<br />
(Test_02.nsi) Calling WriteListC causes the install to crash.  (must be a problem in the plugin itself).<br />
BTW: Can CHAR be a string or should it always be a single character?<br />
<br />
Bug #3<br />
(Test_03.nsi) My understanding of the Put command is that it should insert an item at a specfied element.  However, it doen't seem to do that.  I start with an array of zero,one,two,three.  After I call ${TestArray-&gt;Put} 1 'insert', I end up with null,insert,one,three,null.  (It'll probably make more sense once you compile the example script.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th July 2005, 11:52</div></div><div class="posttext">Right thanks.<br />
1. Easy fix (I know what the issue is :)).<br />
2. Yes, it has to be a single character. I'll add some code to prevent people using a string.<br />
3. Not sure why this is happening but I'll look into it.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th July 2005, 12:28</div></div><div class="posttext">Thanks again Comperio, uploaded fixed version.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">30th July 2005, 00:43</div></div><div class="posttext">All fixes worked great!<br />
:up: <br />
 <br />
Minor detail:<br />
You may want to mention in the docs that that CHAR in the WriteListC function is just a single character.  <br />
<br />
If I get more time this weekend, I'll continue testing the other functions.<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">30th July 2005, 18:16</div></div><div class="posttext">Another bug.  Using the function ReadToStack, I found I had to commend out line #136 of the NSISArray.nsh file:<br />
!macro Array_ReadToStack Plugin Name<br />
   ${Plugin}::ReadToStack /NOUNLOAD &quot;${Name}&quot;<br />
   Pop &quot;${ArrayErrVar}&quot;  ### this is the line that needed commented out<br />
!macroend<br />
I didn't find ${ArrayErrVar} defined anywhere in the header file.  And I didn't see that anything extra was being pushed to the stack by your plugin.  (Maybe you were using ArrayErrVar when debugging and just forgot to take it out?)<br />
<br />
Also:<br />
When I called PushToStack, I noticed that it pushed in the reverse order than I was expecting based on your example.  I pushed the Array [0,1,2,3] and when I popped, I got 3, 2, 1, and then 0.  I'm not saying you need to change the code, but perhaps you could just make that clearer in the docs.:cool:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">30th July 2005, 22:37</div></div><div class="posttext">Found another bug (maybe?)<br />
Using the Splice function this time.  I start out with this array:  [zero,one,two,three]<br />
<br />
I call this command:<br />
${TestArray-&gt;Splice} 0 3 &quot;'0' '1' '2'&quot;<br />
<br />
Based on the docs, this should replace elements from index 0 up to, but not including, index 3.  Therefore, I'd expect this:<br />
[0,1,2,three]<br />
<br />
but instead I get this:<br />
[0,1,2]<br />
<br />
I've attached my sample script for you to look over.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">30th July 2005, 23:52</div></div><div class="posttext">OK, 2 more bugs, and I think that's it:<br />
Bug #1<br />
A bug in the debug program. (how ironic is that?)<br />
<br />
I have 2 arrays.  One named TestArray1 and the other TestArray2.<br />
<br />
If I use ${TestArray1-&gt;Debug}, I get the dialog that shows the contents of TestArray1.  But if I then call ${TestArray2-&gt;Debug}, I still get the contents of TestArray1, even though the page caption tells me its TestArray2.<br />
<br />
renaming TestArray2 to &quot;blah&quot; also gave the same thing.  But by calling the SizeOf function, I as able to determine the Arrays themselves are OK.  So it's got to be just a bug in the debug function of the plugin itself.<br />
<br />
(Use the attached script called &quot;copy.nsi&quot; to test)<br />
<br />
Bug #2<br />
Your docs say that the search command is supposed to be case insensitive, but in my testing, it's actually not.  (see attached &quot;search.nsi&quot;)<br />
<br />
and BTW:  I see that Exists and Search do pretty much the same. So why can you specify a starting index with SEARCH and not with EXISTS?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2005, 12:25</div></div><div class="posttext">Thanks, fixed.<br />
<br />
-Stu :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">31st July 2005, 16:14</div></div><div class="posttext">I still have the problems with ReadToStack and Splice.  (See my first 2 posts from yesterday).<br />
<br />
Edit:<br />
But the other problems are OK now.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2005, 16:44</div></div><div class="posttext">Doh I didn't see the post above it.<br />
Will look into it soon.<br />
<br />
Edit:<br />
They should also all be fixed now. Just waiting to get on the machine I use for compiling.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2005, 18:07</div></div><div class="posttext">Uploaded new build (still v0.5 though).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">31st July 2005, 18:28</div></div><div class="posttext">OK, getting closer...<br />
<br />
1.  SearchI is not defined in your NSISArray.nsh<br />
2.  When adding SearchI, the plugin call is working, but returns the same as the regular Search.  (In other words, SearchI is not case insensitive like it's supposed to be.)<br />
3.  Both Exists and ExistsI return a 'parameter error' from the plugin<br />
<br />
New examples attached.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st August 2005, 01:30</div></div><div class="posttext">Dear me, that wasn't very good :(<br />
I've updated the readme and NSISArray.nsh properly. Just trying to upload now, but sourceforge is having problems as usual.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">1st August 2005, 03:23</div></div><div class="posttext">Hey Afrow,<br />
I've been having problems on an off with my own ISP.. Kind of refreshing to know I'm not the only one!<br />
<br />
I was going to mention that I've saved all my test scripts for every function in your plugin.  Just let me know if you'd like a copy of them to include as examples in with your plugin distribution.  (I can either post them here, on the Wiki, or send them to you directly.)<br />
<br />
Thanks again for all your help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st August 2005, 11:41</div></div><div class="posttext">I was thinking that also. Please send them to afrowuk at tiscali dot co dot uk<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st August 2005, 15:28</div></div><div class="posttext">Uploaded new build. I've done a bit more than bug fixes in this release (although it's still v0.5). Check the Change Log in the readme.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">1st August 2005, 23:13</div></div><div class="posttext">Hey Afrow,<br />
I downloaded the new version today and it works great!  <br />
<br />
Now for a feature request:<br />
It would be nice if you could give the developer the option to trap the plugin errors rather than having the plugin display its own message box when there's a problem.  I was thinking of perhaps having the plugin place another value on the stack after the return value. A zero could mean no problems or a unique error code based on  one of your predefined errors.  <br />
<br />
For example, -1 might mean &quot;Array name already declared&quot;, -2 would mean &quot;Parameters error.&quot;, and so on.  Then, you could either wrap the 'english translation' of the error into a plugin call or just use !defines in your NSH header file in case the developer chose to display the erorr you have now.  (Using the NSH file, you could even use this to set the error flag if you wanted.)<br />
<br />
It would add another pop command to each plugin call, but for flexibility to the developer, I think it would be worth it.  Whatcha think?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd August 2005, 13:13</div></div><div class="posttext">This is how it was before. Remember there was a Pop ${ArrayErrVar} in ReadToStack. Error messages used to get passed onto the stack, but for some reason I changed it.<br />
I'll add this in today as the default with a compile-time define to use MessageBox's instead.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd August 2005, 19:48</div></div><div class="posttext">Uploaded v0.6 with the new $ArrayErr (stack) error support. Use !define ArrayErrorMsgBox to use the old school error message boxes.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">5th August 2005, 05:24</div></div><div class="posttext">Afrow,<br />
Just found another bug.  In your header in the macro 'Array_Delete', you are undefining ${ArrayObj}.  <br />
<br />
Since ${ArrayObj} is used goblaly (meaning that more than one array can use it), it will cause the compiler to crash when you need to undefine more than one array.   <br />
<br />
(The reason I spotted it was becuase I happend to be using 2 arrays in my installation.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th August 2005, 11:27</div></div><div class="posttext">For some reason I missed out the new header file which adds support for the ArrayErrorMsgBox define (and fixes that problem you've mentioned).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">5th August 2005, 15:39</div></div><div class="posttext">Another issue I'm still looking into, but perhaps you could guide me:<br />
<br />
I've noticed that NSISArray.dll is not being removed from the plugins directory.  I'm using 2 arrays and I'm deleting both using the ${arrayName-&gt;delete} command in my last (hidden) section.<br />
<br />
Should I be placing this command somewhere else (like in .onInstSuccess)?  Is there another command/procedure I should be using?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th August 2005, 12:47</div></div><div class="posttext">I'll have a look. It could be a /NOUNLOAD issue.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th August 2005, 13:34</div></div><div class="posttext">I've added ${ArrayUnload} to this build (v0.6 RC3).<br />
Also updated all your example scripts (can't use ${Array} inside a Section or Function, added ${Array-&gt;Delete} and ${ArrayUnload} to all scripts).<br />
<br />
I found out why NSISArray.nsh wasn't included in the last Zip. It actually was, but for some reason it was put in the Plugins folder instead. So make sure you delete Plugins\NSISArray.nsh.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">6th August 2005, 17:47</div></div><div class="posttext">Thanks!  I'll check it out.<br />
<br />
edit:<br />
Things seem to be working great!  <br />
:D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">superruzafa</div><div class="date">7th August 2005, 02:00</div></div><div class="posttext">I want to use two arrays in my installer. This basic example results in a compiling error. A bug?<br />
<br />
!include nsisarray.nsh<br />
<br />
outfile array.exe<br />
<br />
${Array} &quot;array1&quot;<br />
${Array} &quot;array2&quot;<br />
<br />
section -array<br />
<br />
sectionendError: variable &quot;ArrayErr&quot; already declared<br />
Error in macro Array on macroline 3</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">7th August 2005, 05:27</div></div><div class="posttext">I did some digging and found the problem (and turned up another problem in the process).  My modified header file attached should fix it.  (Note that I changed the name of the header file.  Afrow may have another way he'd prefer to handle it so I didn't want my modifications to be confused with the 'official' version.)<br />
<br />
Two problems addressed (which are also commented in the attached header file):<br />
1.  the variable ArrayErr was getting defined multiple times when the array messagebox handling was turned off.  To correct this, I turned the !define &quot;ArrayErrorMsgBox&quot; into a macro.  So insted of using the &quot;!define ArrayErrorMsgBox&quot;, I can now use &quot;${ArrayErrorMsgBox}&quot;.  (This is only if you want the plugin to generate error messages instead of you handling it the script.  See the original docs for more info.)<br />
<br />
2.  ArrayUnload was also getting defined more than once.  To correct this, I simply enclosed the ArrayUnload define inside an &quot;!ifndef&quot; block.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th August 2005, 09:56</div></div><div class="posttext">Thanks for helping out.<br />
I had to go about ArrayErrorMsgBox differently though as when the ArrayErrorMsgBox is defined, all functions will do a Pop $ArrayVar. However, your code had it defined constantly and therefore it couldn't work.<br />
With the Var ArrayErr, I've just added another define so that it isn't added twice.<br />
<br />
(Uploaded v0.6 RC4)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">7th August 2005, 16:40</div></div><div class="posttext">I see your point...<br />
:tinfoil: <br />
<br />
RC4 looks good.  Thanks again!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">9th August 2005, 12:38</div></div><div class="posttext">Uploaded v0.7.<br />
<br />
Added a second parameter to ${myArray-&gt;Sort} which can specify another array name. The 2nd array will be rearranged into the same order as the sorted array (works like associative arrays). Both arrays must be of the same size initially.<br />
<br />
Added the SetSize function to set the array to a specific size of items.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th August 2005, 12:46</div></div><div class="posttext">Uploaded v0.7 RC3.<br />
Minor code changes and readme typo fixes.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th August 2005, 16:11</div></div><div class="posttext">Uploaded 0.7 RC4<br />
<br />
Added ReadFirst, ReadNext and ReadClose.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">17th August 2005, 13:00</div></div><div class="posttext">Uploaded v0.8<br />
<br />
Added IsEmpty, IsFull, IsInRange, and ArrayExists / Inited.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SuperPat</div><div class="date">26th February 2006, 21:23</div></div><div class="posttext">Hello,<br />
<br />
It would be possible to add a function in the array plug-in that erase the elements which appear already in the array?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">1st March 2006, 17:15</div></div><div class="posttext">Hi Stu<br />
<br />
This array-plugin is great! Thank you very much!<br />
<br />
With the plugin I would like to pop some values from the array. The value returned was &quot;2&quot; and nothing happened to the array.<br />
<br />
Even the provided example did not work. I would be glad, if you could investigate in this.<br />
<br />
Thank you very much!<br />
<br />
Have a nice Day.<br />
<br />
-Bruno.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st March 2006, 17:39</div></div><div class="posttext">Will look at it now.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st March 2006, 18:01</div></div><div class="posttext">Thanks, fixed.<br />
Let me know if you discover any other problems.<br />
<br />
http://nsis.sourceforge.net/File:NSISArray.zip<br />
<br />
SuperPat:<br />
Use ${myArrayName-&gt;Clear}<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">1st March 2006, 18:07</div></div><div class="posttext">Wow great! Thank you very much!<br />
<br />
-Bruno.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ahab282</div><div class="date">16th March 2006, 10:50</div></div><div class="posttext">Hey Stu!<br />
<br />
Your plugin is really great! <br />
But I have a problem with your script. <br />
For example when executing ${MyArray-&gt;Init} there seems to be a value popped from the stack but the function in your plugin doesn't push anything to the stack so the stack is getting emptier!<br />
<br />
Some other macros do this too!<br />
<br />
I think it's a bug, isn't it!?<br />
<br />
-Marcy</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Grimace</div><div class="date">28th March 2006, 08:39</div></div><div class="posttext">I'm new to NSIS and gratefully using the NSISArray plugin. I stumbled upon an issue which I, by some debugging, tracked down to variable name length of arrays. I'm not sure whether this restriction is by NSIS design, or an NSISArray issue (or just me overlooking something else).<br />
<br />
Anyway, when using the following code:<br />
<br />
<br />
${Array} &quot;TheObject-&gt;Foo1_&quot;<br />
${Array} &quot;TheObject-&gt;Foo2_&quot;<br />
<br />
Section<br />
	${TheObject-&gt;Foo1_-&gt;Init}<br />
	${TheObject-&gt;Foo2_-&gt;Init}<br />
	${TheObject-&gt;Foo1_-&gt;Debug}<br />
	${TheObject-&gt;Foo2_-&gt;Debug}<br />
SectionEnd<br />
<br />
<br />
you'll only get a debug window for the last initialized array (you can verify that by swapping the 2 Init statements). If you remove the underscore to shorten the variable names, all works fine.<br />
<br />
Am I stretching some limits, or is this a bug?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Grimace</div><div class="date">28th March 2006, 08:57</div></div><div class="posttext">Originally posted by Grimace <br />
<br />
Am I stretching some limits, or is this a bug? <br />
Ok, I took a quick look at the plugin code, and I guess this one's responsible for it:<br />
<br />
char arrNames[ARRAY_MAX_COUNT][16];<br />
<br />
<br />
I think I'll just recompile then ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th March 2006, 13:31</div></div><div class="posttext">I thought I put an error check in for that, but perhaps not.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd April 2006, 21:42</div></div><div class="posttext">Version 1.1 is available for download.<br />
<br />
Its most notable change is support for dynamic arrays.<br />
A complete list of changes can be found in the included documentation.<br />
<br />
http://nsis.sf.net/File:NSISArray.zip<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">23rd April 2006, 23:11</div></div><div class="posttext">Very interesting...<br />
Thanks AfrowUK!<br />
:D <br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">24th April 2006, 23:53</div></div><div class="posttext">I can't wait to test it after my vacation! :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th April 2006, 22:03</div></div><div class="posttext">1.2 is now available with some modifications for better error checking.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SuperPat</div><div class="date">27th April 2006, 13:47</div></div><div class="posttext">Hello<br />
<br />
It there a bug with NSISArray 1.2 with the Exists and ExistsI function?<br />
<br />
This is a peace of code that add in a array the name of all the directory contained in $SMPROGRAMS (it work well with the version 1.0):<br />
<br />
    StrCpy $MUI_TEMP2 &quot;&quot;<br />
<br />
    NSISArray::New /NOUNLOAD &quot;SMProgList&quot;<br />
<br />
<br />
    SetShellVarContext current<br />
    FindFirst $UMUI_TEMP3 $MUI_TEMP1 &quot;$SMPROGRAMS\*&quot;<br />
    FindNext  $UMUI_TEMP3 $MUI_TEMP1<br />
      loop:<br />
      FindNext  $UMUI_TEMP3 $MUI_TEMP1<br />
      StrCmp $MUI_TEMP1 &quot;&quot; exit<br />
      IfFileExists $SMPROGRAMS\$MUI_TEMP1\* add<br />
      goto loop<br />
      add:<br />
        NSISArray::ExistsI /NOUNLOAD &quot;SMProgList&quot; &quot;$MUI_TEMP1&quot; 0<br />
		Pop $MUI_TEMP2<br />
 MessageBox MB_OK &quot;$MUI_TEMP1  $MUI_TEMP2&quot;<br />
        StrCmp $MUI_TEMP2 -1 0 NoAdd<br />
          NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; $MUI_TEMP1<br />
        NoAdd:<br />
      goto loop<br />
      exit:<br />
      FindClose $UMUI_TEMP3<br />
<br />
Tthe value of $MUI_TEMP2 is curiously allways &quot;4&quot; :eek:<br />
Consequently, no items are added in the array</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SuperPat</div><div class="date">27th April 2006, 14:10</div></div><div class="posttext">I have found an other problem:<br />
<br />
This is a test code:<br />
<br />
NSISArray::New /NOUNLOAD &quot;SMProgList&quot;<br />
<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;a&quot;<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;b&quot;<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;c&quot;<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;d&quot;<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;e&quot;<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;f&quot;<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;g&quot;<br />
<br />
NSISArray::Concat /NOUNLOAD &quot;SMProgList&quot; &quot;|&quot;<br />
Pop $UMUI_TEMP3<br />
MessageBox MB_OK &quot;$UMUI_TEMP3&quot;<br />
<br />
NSISArray::Delete /NOUNLOAD &quot;SMProgList&quot;<br />
      <br />
NSISArray::Unload<br />
<br />
<br />
Instead of return &quot;a|b|c|d|e|f|g&quot;, it return &quot;4&quot; :(<br />
<br />
Edit: apprently &quot;4&quot; is the error code for the array does not exist</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Filus</div><div class="date">27th April 2006, 14:26</div></div><div class="posttext">In the new versions (1.1 and 1.2) Write function has a bug when it is writing to the last element. It's creating new &quot;empty&quot; element or &quot;undeleting&quot; one of previosuly deleted.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th April 2006, 20:17</div></div><div class="posttext">Thanks Filus, this problem has been fixed in the new version. The problem also appeared in three other functions while I was making modifications between 1.1 and 1.2.<br />
<br />
v1.3 is now available for download from the same location.<br />
<br />
Please note:<br />
If you have a previous release of NSISArray installed, please delete the Contrib\NSISArray and Examples\NSISArray folders before installing the new release.<br />
<br />
SuperPat:<br />
Sorry I hadn't updated the information on the New function.<br />
It now requires two extra parameters.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SuperPat</div><div class="date">27th April 2006, 21:34</div></div><div class="posttext">Sorry I hadn't updated the information on the New function.<br />
It now requires two extra parameters.<br />
<br />
Yes But:<br />
<br />
NSISArray::New /NOUNLOAD &quot;SMProgList&quot; 7 1<br />
<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;a&quot;<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;b&quot;<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;c&quot;<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;d&quot;<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;e&quot;<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;f&quot;<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;g&quot;<br />
<br />
NSISArray::Concat /NOUNLOAD &quot;SMProgList&quot; &quot;|&quot;<br />
Pop $UMUI_TEMP3<br />
MessageBox MB_OK &quot;$UMUI_TEMP3&quot;<br />
<br />
NSISArray:Delete /NOUNLOAD &quot;SMProgList&quot;<br />
      <br />
NSISArray::Unload<br />
 <br />
even with the 2 parameters, this code don't work<br />
the string is empty... :rolleyes: <br />
What is wrong in my code?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th April 2006, 22:01</div></div><div class="posttext">You forgot (or perhaps didn't know) that C strings have a NULL character on the end of them (/0) which specifies the end of the string.<br />
<br />
I should put a note about this in the documentation, but the minimum string length is 2 not 1.<br />
<br />
If you get any other problems, use NSISArray::ErrorStyle /NOUNLOAD 2 or 4 to find out what error is being produced.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SuperPat</div><div class="date">28th April 2006, 11:26</div></div><div class="posttext">Even by putting 10 15 like parameters, the string of exit remains always equal to 0<br />
<br />
<br />
NSISArray::New /NOUNLOAD &quot;SMProgList&quot; 10 15<br />
<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;e&quot;<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;f&quot;<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;g&quot;<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;a&quot;<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;b&quot;<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;c&quot;<br />
NSISArray::Push /NOUNLOAD &quot;SMProgList&quot; &quot;d&quot;<br />
<br />
	  NSISArray::Sort /NOUNLOAD &quot;SMProgList&quot; &quot;&quot;<br />
<br />
      ; Build the list<br />
	NSISArray::Concat /NOUNLOAD &quot;SMProgList&quot; &quot;|&quot;<br />
	Pop $0<br />
MessageBox MB_OK &quot;$0&quot;<br />
<br />
<br />
My other example gives the same result</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th April 2006, 11:30</div></div><div class="posttext">I can't test the script here at college but when I get home I will do so (6 hours from now).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SuperPat</div><div class="date">28th April 2006, 11:35</div></div><div class="posttext">I see with the debug window that the Push and the Sort functions work, but the Concat function return always &quot;0&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th April 2006, 11:36</div></div><div class="posttext">I have identified the problem. It's a problem in the DLL. I'll fix it when I get home. There is also a problem with the script header which I need to fix.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th April 2006, 17:54</div></div><div class="posttext">Please try v1.3 RC3:<br />
http://nsis.sourceforge.net/File:NSISArray.zip<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SuperPat</div><div class="date">28th April 2006, 21:00</div></div><div class="posttext">This version work fine.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">29th April 2006, 22:30</div></div><div class="posttext">A few suggestions for the docs whenever you happen to add/change something else:<br />
[list=1]<br />
 Sometimes it's hard to remember if an array starts with element &quot;0&quot; or element &quot;1&quot;.  (I know the norm is to have zero-based arrays, but I use scripting languages that work both ways, so sometimes I just get confused...)  It might be helpful to have this stated somewhere in the beginning of the docs.<br />
<br />
 The function ${Array-&gt;Write} allows you to overwrite elements.  It's made clear in the docs that the ${Array-&gt;Put} command DOES NOT overwrite existing values, but it does not mention in the docs for the ${Array-&gt;Write} command that it WILL overwrite values.<br />
[/list=1] <br />
<br />
PS: I just have to say how extremely useful your plugin has been for me!  I use it every chance I get!<br />
:D  :up:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th April 2006, 23:03</div></div><div class="posttext">Thanks Comperio I shall add some notes to the documentation for next release.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pharaoh Atem</div><div class="date">1st May 2006, 22:57</div></div><div class="posttext">The latest NSISArray plugin freezes my installer... I had to revert to the version that I have that uses the .NET Framework...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd May 2006, 14:32</div></div><div class="posttext">It would be more helpful if you could identify what exactly freezes the installer (e.g. which plugin function).<br />
Perhaps you could create an example which reproduces the problem.<br />
<br />
Did you make sure you extracted all the plugin files from the Zip? You can't expect to use the new plugin if you don't extract the new script header as well for example.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pharaoh Atem</div><div class="date">2nd May 2006, 22:44</div></div><div class="posttext">I am using Component Manager, which utilizes the NSISArray plugin, and comes with it... It turns out a special build is required to use it with Component Manager... Unfortunately, neither I nor dandaman32 have VC6, but we had C::B, but I don't have a clue how to dynamically link to the VC6 library using MinGW... So, it was statically linked... If it could be dynamically linked to the VC6 DLL using MinGW, that would be good, because my installer blew up 120K for including a statically linked version...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd May 2006, 23:00</div></div><div class="posttext">I guess the special build was made for custom array sizes. Since NSISArray 1.0, arrays are now dynamic and so special builds are not needed.<br />
<br />
I haven't seen dandaman32 around for a while, so he may not know about the new version. To use the new plugin, major changes are needed on old scripts.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SuperPat</div><div class="date">27th July 2006, 00:14</div></div><div class="posttext">Hello,<br />
<br />
I have a problem with NSISArray, To be more precise, with the Concat function:<br />
<br />
I wish to create a MULTILANGUAGE page for UltraModernUI.<br />
<br />
I have a variable named $UMUI_LANGLIST that contain all the names of the language inserted in the NSIS script.<br />
Example:<br />
&quot;English|Français|Português (do Brasil)|Deutsch|Español|Chinese (Simplified)|Chinese (Traditional)|Japanese|Korean|Italiano|Nederlands|Danish|Svenska|Norwegian|Suomi|Greek|Russian|Português|Polski|Ukrainian|Cesky|Slovensky|Hrvatski|Bulgarian|Magyar|Thai|Romana|Latvieðu|Macedonian|Eesti keel|Türkçe|Lietuviu|Català|Slovenski jezik|Serbian Cyrillic|Serbian Latin|Arabic|Farsi|Hebrew|Indonesian|Mongolian|Lëtzebuergesch|Albanian|Brezhoneg|Byelorussian|Icelandic|Malay|Bosanski|Kurdî|Euskera|Welsh|Irish&quot;<br />
Its StrLen is 499<br />
<br />
<br />
The goal of this code is to sort the language list:<br />
<br />
StrLen $R0 $UMUI_LANGLIST  ; $Ro = 499<br />
    ; create an array that containing the langstring<br />
    NSISArray::New /NOUNLOAD &quot;LangList&quot; 55 8<br />
    <br />
    NSISArray::WriteListC /NOUNLOAD &quot;LangList&quot; &quot;$UMUI_LANGLIST&quot; &quot;|&quot;<br />
    <br />
    NSISArray::Sort /NOUNLOAD &quot;LangList&quot; &quot;&quot;<br />
<br />
    NSISArray::Concat /NOUNLOAD &quot;LangList&quot; &quot;|&quot;<br />
    Pop $UMUI_LANGLIST<br />
    <br />
StrLen $R1 $UMUI_LANGLIST ; $R1 = 392  Only....<br />
    NSISArray::Debug /NOUNLOAD &quot;LangList&quot; ; The array contain well all the 52 items<br />
<br />
MessageBox MB_OK &quot;$R1 instead of $R0&quot;  ; ===&gt;  392 instead of 499 bytes returned<br />
<br />
The array contain well all the 52 items but when I want to get the list with the Concat function, it return only the 41 first items...<br />
<br />
Why NSISArray has not returned the others items?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th July 2006, 00:42</div></div><div class="posttext">I'll look into this tomorrow morning as soon as possible. It's getting late here :)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th July 2006, 11:26</div></div><div class="posttext">Thanks, fixed.<br />
http://nsis.sourceforge.net/File:NSISArray.zip<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SuperPat</div><div class="date">27th July 2006, 12:42</div></div><div class="posttext">Work fine, Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">13th March 2007, 07:44</div></div><div class="posttext">how many entries/bytes can hold an array?<br />
<br />
i have 2 hash arrays and after extact 361 entries with <br />
each 32 token the script quits without warning or gpf.<br />
<br />
:(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th June 2007, 23:52</div></div><div class="posttext">I have uploaded v1.4 which has a new &quot;Subtract&quot; function among code cleanup and utilisation.<br />
<br />
Subtract allows you to take-away items in one array that are in another. This is useful for comparing two arrays to see which items do not match (i.e. with GetDrives or something).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th June 2007, 23:53</div></div><div class="posttext">Brummelchen, sorry I missed that post. Can you create a script to reproduce this?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th June 2007, 22:10</div></div><div class="posttext">I found out what was causing the crashing.<br />
I tested the plugin with all 8 arrays filled with 10000 strings of 100 characters and everything was fine.<br />
<br />
Uploaded v1.5<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">8th June 2007, 00:43</div></div><div class="posttext">Thank you - i try it next build here.<br />
meanwhile right after trouble i repalced the array <br />
with a file list as TXT and it runs smooth. now i <br />
need to improve zero byte files which all have same <br />
hash - nsis itself can handle that - me not.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th June 2007, 14:13</div></div><div class="posttext">Uploaded v1.5 RC2. Fixed some parameter validation check issues for some of the functions.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizarth</div><div class="date">10th July 2007, 06:26</div></div><div class="posttext">I tried using this plugin today, and find that the ${myArray-&gt;SizeOf} macro would cause an error. After assorted cursing and headscratching, I discovered:<br />
<br />
Line 686 of NSISArray.nsh:<br />
!macro Array_IndexesOf Name VarBufferLen VarItems VarIndexes<br />
<br />
should be<br />
!macro Array_SizeOf Name VarBufferLen VarItems VarIndexes<br />
<br />
Note that this bug did cause the Examples/NSISArray/Sizeof.nsi to fail, and this change fixed it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th July 2007, 10:43</div></div><div class="posttext">Thanks, fixed.<br />
<br />
That probably happened when I did a Size-&gt;Indexes text replace in the script header :(<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">22nd September 2007, 12:55</div></div><div class="posttext">Stu,<br />
I am using the array plugin in both my installer and uninstaller in oder to register (during installation) and unregister (during uninstall) a large number of file extensions for my application. I am creating an array at my .onInit function and then call it inside a section of the installer and this works fine.<br />
<br />
However if I create the array for the uninstaller in my un.onInit section and try to call it in any of my uninstall sections, the uninstaller crashes (no messages, it just dies).<br />
<br />
After playing around with it I finally got it to work without declaring an array in the un.onInit function, but right inside  an uninstall section.<br />
<br />
Any ideas why this is happening?<br />
<br />
Note that even the NSISArray::ArrayExists command inside an uninstall section causes a crash in the case that the array was created in the un.onInit function<br />
<br />
Cheers,<br />
<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">22nd September 2007, 15:10</div></div><div class="posttext">I'll need to make a script to reproduce this. If you have one, I would be grateful.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">22nd September 2007, 16:04</div></div><div class="posttext">I can reproduce the crash with this minimal script:<br />
SetCompressor /SOLID lzma<br />
!include &quot;MUI.nsh&quot;<br />
!include &quot;LogicLib.nsh&quot;<br />
<br />
OutFile &quot;TEST.exe&quot;<br />
InstallDir &quot;$PROGRAMFILES\Test&quot;<br />
<br />
!define EXTENTIONS_ARRAY_LIST_A 'ext1|ext2|ext3|ext4'<br />
!define EXTENTIONS_ARRAY_TYPE_A &quot;TestFile&quot;<br />
<br />
Section -Ext<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Starting Section&quot;<br />
  NSISArray::ArrayExists /NOUNLOAD ExtentionsArray<br />
  Pop $0<br />
  ${If} $0 &lt;&gt; 1<br />
    NSISArray::New /NOUNLOAD ExtentionsArray 2 2<br />
  ${EndIf}<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Starting Process&quot;<br />
    NSISArray::WriteListC /NOUNLOAD ExtentionsArray '${EXTENTIONS_ARRAY_LIST_A}' &quot;|&quot;<br />
    NSISArray::Debug /NOUNLOAD ExtentionsArray<br />
    NSISArray::Clear /NOUNLOAD ExtentionsArray<br />
SectionEnd<br />
<br />
Section -Uninstaller<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
  WriteUninstaller &quot;$INSTDIR\uninstall.exe&quot;<br />
SectionEnd<br />
<br />
Section -Un.Ext<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Starting Section&quot;<br />
  NSISArray::ArrayExists /NOUNLOAD unExtentionsArray<br />
  Pop $0<br />
  ${If} $0 &lt;&gt; 1<br />
    NSISArray::New /NOUNLOAD unExtentionsArray 2 2<br />
  ${EndIf}<br />
  NSISArray::Debug /NOUNLOAD unExtentionsArray<br />
  NSISArray::WriteListC /NOUNLOAD unExtentionsArray &quot;${EXTENTIONS_ARRAY_LIST_A}&quot; &quot;|&quot;<br />
  NSISArray::Clear /NOUNLOAD unExtentionsArray<br />
SectionEnd<br />
<br />
Function .onInit<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Creating array in .onInit&quot;<br />
  NSISArray::New /NOUNLOAD ExtentionsArray 2 2<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Created array on .onInit&quot;<br />
FunctionEnd<br />
<br />
Function un.onInit<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Creating array in un.onInit&quot;<br />
  NSISArray::New /NOUNLOAD unExtentionsArray 2 2<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Created array in un.onInit&quot;<br />
FunctionEnd<br />
<br />
Function .onGUIEnd<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Deleting Array on .onGUIEnd&quot;<br />
  NSISArray::Delete /NOUNLOAD ExtentionsArray<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Deleted Array on .onGUIEnd&quot;<br />
  NSISArray::Unload<br />
FunctionEnd<br />
<br />
Function un.onGUIEnd<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Deleting Array on un.onGUIEnd&quot;<br />
  NSISArray::Delete /NOUNLOAD unExtentionsArray<br />
  NSISArray::Unload<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Deleted Array on un.onGUIEnd&quot;<br />
FunctionEnd<br />
<br />
The install part works fine.<br />
The uninstaller crashes when the first Array command is called (NSISArray::ArrayExists) if the array is created in un.onInit.<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">7th October 2007, 00:21</div></div><div class="posttext">exactly that script dont crash here ... nsis 2.30, array 1.5rc2<br />
winxp sp2 latest updates, vc8sp1<br />
<br />
# ok, vista ultimate on vmware dont crash either</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">7th October 2007, 07:40</div></div><div class="posttext">another problem here... :(<br />
!include MUI.nsh<br />
!include NSISArray.nsh<br />
<br />
Name 'Subtract'<br />
OutFile 'NSISArrayExample - Subtract.exe'<br />
ShowInstDetails show<br />
<br />
!insertmacro MUI_PAGE_INSTFILES<br />
!insertmacro MUI_LANGUAGE English<br />
<br />
${Array} &quot;TestArray1&quot; 1 256<br />
${ArrayFunc} WriteList<br />
${ArrayFunc} Subtract<br />
${ArrayFunc} Debug<br />
${Array} &quot;TestArray2&quot; 1 256<br />
${ArrayFunc} WriteList<br />
${ArrayFunc} Debug<br />
<br />
Section<br />
  ${TestArray1-&gt;Init}<br />
  ${TestArray2-&gt;Init}<br />
<br />
  ${TestArray1-&gt;WriteList} &quot;'we1234.tmp' 'we3456.tmp' 'we5432.tmp'&quot;<br />
  ${TestArray2-&gt;WriteList} &quot;'we1234.tmp' 'we3456.tmp'&quot;<br />
  ${TestArray1-&gt;Debug}<br />
<br />
  DetailPrint 'Subtracting TestArray2 from TestArray1...'<br />
  ${TestArray1-&gt;Subtract} TestArray2<br />
  ${TestArray2-&gt;Delete}<br />
  ${TestArray1-&gt;Debug}<br />
  ${TestArray1-&gt;Delete}<br />
SectionEnd<br />
<br />
result is 'we3456.tmp' - can't obviously...<br />
<br />
# array 1.5rc2, nsis 2.30<br />
<br />
btw docs have typo<br />
1.6.27     ${myArray-&gt;Subtract}   myArray2<br />
<br />
Takes away items in myArray2 that are also in myArray. Items are matched case sensitively.<br />
<br />
For a compilable NSIS script example, see Examples\NSISArray\Subtract.nsi.<br />
<br />
underlined say wrong direction - it takes content in (2) from (1) away - like example do<br />
<br />
Might better: &quot;takes away items in (2) from (1)&quot;<br />
<br />
#fix<br />
for my problem i have to add a fake entry (like &quot;---&quot;) to both arrays - then it works.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">7th October 2007, 11:25</div></div><div class="posttext">@Brummelchen<br />
the script works for me as well. The uninstaller that is generated however is the one that crashes. Both on XP/SP2 and 2000/SP4 with nsis 2.31 and array 1.5 RC6. On different PCs as well.<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th October 2007, 14:29</div></div><div class="posttext">Back from holiday now. Will attempt to fix these problems today if I have time.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">7th October 2007, 18:44</div></div><div class="posttext">&gt;&gt; The uninstaller that is generated however is the one that crashes. <br />
<br />
how do i get the uninstaller from that script?<br />
might this line help me to understand<br />
<br />
WriteUninstaller &quot;$exedir\uninstall.exe&quot;<br />
<br />
&gt;&gt; array 1.5 RC6. <br />
<br />
Where to get? :D<br />
<br />
i am currently working on a special supporting program again<br />
which need arrays... ok, there are many other ways but array<br />
will fit them fastest ^^ (snapshot before &amp; after)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th October 2007, 18:53</div></div><div class="posttext">Run the installer exe and it will generate uninstall.exe in the same folder.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">7th October 2007, 20:17</div></div><div class="posttext">ok, confirmed with 15rc2 - i now found the uninstaller here.<br />
for my blame i did not investigate more time yesterday about that.<br />
au_.exe crashes</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">7th October 2007, 20:46</div></div><div class="posttext">Where to get?I got it from here (http://nsis.sourceforge.net/File:NSISArray.zip)<br />
<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">7th October 2007, 21:13</div></div><div class="posttext">oh, i see - thats same i have - but i got it from here<br />
http://nsis.sourceforge.net/Array_plug-in<br />
(there is no such info, only mentioned as 1.5 in html doc)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th October 2007, 21:43</div></div><div class="posttext">There is a deeper problem here - possible bug with WriteList. I don't have a build machine available right now so I'll continue tomorrow.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th October 2007, 19:05</div></div><div class="posttext">CancerFace, I found that the crash that you were experiencing was because your array name was too long. The new build has 32 bytes allocated for array names (as opposed to 16).<br />
<br />
Brummelchen, fixed Subtract.<br />
<br />
I also found a memory leak in the Delete function which is now fixed.<br />
<br />
http://nsis.sf.net/File:NSISArray.zip<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">12th October 2007, 19:23</div></div><div class="posttext">thank you :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">12th October 2007, 19:53</div></div><div class="posttext">Groovy!<br />
Thanks Stu!<br />
:D <br />
<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">congtak</div><div class="date">17th October 2007, 07:34</div></div><div class="posttext">Hi, I think there is a possible bug in the {Array-&gt;ReadtoStack} function <br />
when I do ${TestArray-&gt;ReadtoStack} 0 -1<br />
and TestArray only has one element in it, nothing gets copied to the stack.<br />
<br />
To test this I change the ReadToStack.nsi<br />
${TestArray-&gt;WriteList} &quot;'zero'&quot;<br />
${TestArray-&gt;ReadtoStack} 0 -1<br />
Pop $R0<br />
$R0 is empty.<br />
<br />
Thank you</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th October 2007, 21:33</div></div><div class="posttext">This was indeed a bug. Thanks, fixed.<br />
http://nsis.sf.net/File:NSISArray.zip<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">congtak</div><div class="date">19th October 2007, 00:02</div></div><div class="posttext">cool</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">13th February 2008, 09:36</div></div><div class="posttext">${myArray-&gt;Concat} $Var &quot;&quot;<br />
<br />
returns empty string - is the connecting character mandatory?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th February 2008, 18:20</div></div><div class="posttext">I've never tried that but yes it shouldn't be. I will look at it soon, thanks.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">13th February 2008, 18:28</div></div><div class="posttext">i have another problem, pls have a look here - it blows the  memory and make it crash<br />
Function anagram_sort<br />
  Pop  $R9 ;source<br />
  Push $R5<br />
  Push $R6<br />
  Push $R7<br />
  Push $R8<br />
<br />
  ;insert seperater<br />
  StrCpy $R6 &quot;&quot;<br />
  StrCpy $R7 &quot;0&quot;<br />
  loop1:<br />
  StrCpy $R8 $R9 1 $R7<br />
  StrCmp $R8 &quot;&quot; loop1_done<br />
    StrCpy $R6 &quot;$R6$R8|&quot;<br />
    IntOp $R7 $R7 + 1<br />
    Goto loop1<br />
  loop1_done:<br />
  StrCpy $R9 $R6 -1<br />
  ;messagebox mb_ok &quot;'$R9'&quot;<br />
<br />
  ${anagram-&gt;Init}<br />
  ${anagram-&gt;Clear}<br />
  ;write array<br />
  ${anagram-&gt;WriteListC} $R9 &quot;|&quot;<br />
  ;sort array<br />
  ${anagram-&gt;Sort} &quot;&quot;<br />
  ;read array<br />
  StrCpy $R9 &quot;&quot;<br />
  ${anagram-&gt;ReadtoStack} 0 -1<br />
  Pop $R5<br />
  StrCpy $R9 &quot;$R9$R5&quot;<br />
  Pop $R5<br />
  StrCpy $R9 &quot;$R9$R5&quot;<br />
  Pop $R5<br />
  StrCpy $R9 &quot;$R9$R5&quot;<br />
  Pop $R5<br />
  StrCpy $R9 &quot;$R9$R5&quot;<br />
  Pop $R5<br />
  StrCpy $R9 &quot;$R9$R5&quot;<br />
  Pop $R5<br />
  StrCpy $R9 &quot;$R9$R5&quot;<br />
  Pop $R5<br />
  StrCpy $R9 &quot;$R9$R5&quot;<br />
  Pop $R5<br />
  StrCpy $R9 &quot;$R9$R5&quot;<br />
  Pop $R5<br />
  StrCpy $R9 &quot;$R9$R5&quot;<br />
  ${anagram-&gt;Delete}<br />
<br />
  Push $R9<br />
  Push &quot;|&quot;<br />
  Push &quot;&quot;<br />
    Call StrRep<br />
  Pop $R9<br />
<br />
  ;messagebox mb_ok &quot;'$R9'&quot;<br />
  Pop  $R8<br />
  Pop  $R7<br />
  Pop  $R6<br />
  Pop  $R5<br />
  Push $R9<br />
FunctionEnd<br />
<br />
The code works on 429mbyte with 4meg lines each 9 byte (11 with LF).<br />
The crash is around 2.7mbyte above line 256.400.<br />
(simple character sort)<br />
<br />
The Math script instead with bubble sort is working here now for hours.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st May 2008, 11:07</div></div><div class="posttext">Can you produce a fully working script to reproduce the problem?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ilitirit</div><div class="date">25th August 2008, 18:19</div></div><div class="posttext">How do I add an empty string to an array?<br />
<br />
I tried<br />
${Array-&gt;Write} $0 &quot;&quot;<br />
<br />
but it doesn't add the element.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TobbeSweden</div><div class="date">12th March 2009, 09:22</div></div><div class="posttext">NSISArray::SearchI seems to modify the array elements. Would it be possible to just temporarily convert them to lower case when comparing?<br />
<br />
Edit: Something like this might possibly work. I haven't tried it, or even compiled it...<br />
// Function: Search for string inside string<br />
BOOL my_strstr(TCHAR *s1, int len_s1, TCHAR *s2, int len_s2, BOOL bCaseSensitive)<br />
{<br />
  int i = 0, j = 0;<br />
<br />
  for (;;)<br />
  {<br />
    if (s2[j] == '\0')<br />
      return TRUE;<br />
    if (s1[i] == '\0')<br />
      return FALSE;<br />
    if (s1[i] == s2[j] || <br />
      (!bCaseSensitive &amp;&amp; LOWORD(CharLower(s1[i])) == LOWORD(CharLower(s2[j]))))<br />
    {<br />
      i++;<br />
      j++;<br />
    }<br />
    else<br />
    {<br />
      i = i - j + 1;<br />
      j = 0;<br />
    }<br />
  }<br />
  return FALSE;<br />
}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TobbeSweden</div><div class="date">12th March 2009, 18:56</div></div><div class="posttext">I've got an array declared in the global scope with ${Array}. I call init on it in .onInit. After that I can use it in the installer.<br />
<br />
Trying to use it in the uninstaller I get an error about the array not existing. Trying to init it in un.onInit I get an error about calling init on the array twice :S<br />
<br />
What should I do? Do I really have to make two arrays, one for install and one for uninstall?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">12th March 2009, 21:44</div></div><div class="posttext">Originally posted by TobbeSweden <br />
Do I really have to make two arrays, one for install and one for uninstall?  <br />
<br />
In short: yes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TobbeSweden</div><div class="date">12th March 2009, 21:57</div></div><div class="posttext">Ok. Too bad.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TobbeSweden</div><div class="date">12th March 2009, 23:13</div></div><div class="posttext">Here's another problem I'm having. SizeOf doesn't work...<br />
<br />
This code:<br />
<br />
	${whereprofilesarray-&gt;SizeOf} $3 $4 $5<br />
	MessageBox MB_OK &quot;EnumerateUsers.nsh(${__LINE__}): $3 = $4 = $5 Will show debug next&quot;<br />
	${whereprofilesarray-&gt;Debug}<br />
<br />
	NSISArray::ErrorStyle /NOUNLOAD 2<br />
<br />
	${whereprofilesarray-&gt;SizeOf} $3 $4 $5<br />
	MessageBox MB_OK &quot;EnumerateUsers.nsh(${__LINE__}): $3 = $4 = $5 Will show debug next&quot;<br />
	${whereprofilesarray-&gt;Debug}<br />
<br />
<br />
Gives me these message boxes:<br />
<br />
---------------------------<br />
Program Installation<br />
---------------------------<br />
EnumerateUsers.nsh(34.32): 1024 = 5 = 1 Will show debug next<br />
---------------------------<br />
OK   <br />
---------------------------<br />
<br />
<br />
---------------------------<br />
Program Installation<br />
---------------------------<br />
EnumerateUsers.nsh(34.38): 5 = 1 =  Will show debug next<br />
---------------------------<br />
OK   <br />
---------------------------<br />
<br />
<br />
As you can see in the second message box the SizeOf return values are wrong. The last return value (blank in this case) seems to vary depending on what's on the stack...<br />
<br />
The Debug output looks correct.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TobbeSweden</div><div class="date">15th March 2009, 19:24</div></div><div class="posttext">This particular problem goes away if I remove 'NSISArray::ErrorStyle /NOUNLOAD 2' and use '${ArrayErrorStyle} MsgBox' instead.<br />
<br />
I'm using scripts from the wiki that uses the direct plugin calls (NSISArray::*) for portability and in my own code I use the header wrappers because I find them easier to work with.<br />
<br />
Is this the real source of my problems? Is it a known fact that you can't mix the header file macros with direct NSISArray:: calls?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th March 2009, 16:10</div></div><div class="posttext">I'm back home in 2 weeks. I will have a look at these bugs then.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TobbeSweden</div><div class="date">16th March 2009, 19:00</div></div><div class="posttext">I've &quot;solved&quot; it by replacing all NSISArray:: calls with their header macro alternatives. Everything seems to work as it should now :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th April 2009, 12:37</div></div><div class="posttext">TobbeSweden, late reply but looking at the NSISArray script header of course you cannot use an ErrorStyle of 2. Using 2 stops the plugin pushing errors to the stack but of course the script macros are still popping the same number of elements. Hence why your problem occurs as it is expecting 4 items on the stack but only gets 3.<br />
<br />
What you should have used was the ArrayErrorStyle macro which has 3 possible values: MsgBox, LogWin and Off. All 3 options still push items to the stack and therefore do not break any of the script header macros.<br />
<br />
Edit: Will upload new version later with fixed SearchI/ExistsI.<br />
Edit #2: Uploaded.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TobbeSweden</div><div class="date">25th April 2009, 16:43</div></div><div class="posttext">Heh, had forgotten all about this :)<br />
<br />
Good job on the update.<br />
<br />
Now if arrays could only be an integrated part of NSIS itself...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dougcvc</div><div class="date">29th May 2009, 09:34</div></div><div class="posttext">Hello great job on the plugin.<br />
<br />
I am having trouble in using it for what i need however, i may just be doing something wrong.<br />
<br />
I have added all the data in the array which consists of numbers and i need to sort in in a certain order.<br />
<br />
Lets say the 3 values in the array are<br />
<br />
<br />
7069<br />
4776<br />
63374<br />
<br />
<br />
I need the data sorted from lowest to highest number, however when i use the sort function it arranges it as the following<br />
<br />
4776<br />
63374<br />
7069<br />
<br />
It sorts the nummbers by the first digit only.<br />
Is there any way to sort by the values lowest to highest such as<br />
<br />
4776<br />
7069<br />
63374<br />
<br />
or am i just doing something wrong?<br />
<br />
<br />
<br />
Many thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th May 2009, 09:44</div></div><div class="posttext">Ah that is a problem. NSISArray stores strings and therefore sorts them as if they were strings (not numbers).<br />
<br />
I would need to write a new sort function to perform this but at the moment I don't have the build tools available and won't have them for some time until I go back home.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dougcvc</div><div class="date">29th May 2009, 10:00</div></div><div class="posttext">Ah thank you for the quick response, I am sure theres some other way to do what im trying to achieve anyway.<br />
<br />
Cheers.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grs1961</div><div class="date">15th July 2009, 08:37</div></div><div class="posttext">Originally posted by jerrydg <br />
I have a couple of problems with NSISArray:<br />
<br />
1.  If I write to an index higher than one that has previously been written, that value is not actually written.<br />
<br />
Don't skip over array indices.  It's not really a random array, but if you pre-load things it will behave as you expect.<br />
<br />
2.  If I write a &quot;&quot; to an array element that previously contained a non-zero length string, that element is not set to the empty string.  The write function seems to ignore an empty string parameter.  This defeats the purpose of using an array to store user input that can legally be an empty string.<br />
<br />
If you do:<br />
${ArrayErrorStyle} MsgBox<br />
at the start of the section you will get a big clue - hint: passing empty strings to macros is not necessarily a simple task.<br />
<br />
Oh, and your example is missing a &quot;${a1-&gt;Read} $tmp $i&quot; from near the end of the loop (so it is working as written, not as intended).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th July 2009, 17:14</div></div><div class="posttext">That is explained under 2.3 Plug-in DLL information. I will take a look at the empty string problem some time today.<br />
<br />
Yes as jerrydg has rightly pointed out - you can't just skip an array index as the upper bound when working with the array needs to be known otherwise memory leaks are possible.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grs1961</div><div class="date">16th July 2009, 03:56</div></div><div class="posttext">Originally posted by jerrydg <br />
I ran into another undocumented limitation:  There is a limit of 8 arrays.  :(  I realize my installer requirements are atypical, but this is a pretty small upper bound.  <br />
<br />
But it is documented, you just have to read far enough along.<br />
<br />
That said, I re-built it almost immediately with 24 as the limit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th July 2009, 15:07</div></div><div class="posttext">I have added a /numeric switch to the Sort function to sort an array numerically rather than alphabetically. I have also addressed the issue of adding empty values to an array.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">HarryPlotter</div><div class="date">31st August 2009, 14:51</div></div><div class="posttext">Since a few days I am working with this great plugin.<br />
I only have one problem with it. If the array is not previously initialized, there is a stack problem in ${myArray-&gt;Inited}.<br />
I've modified the example Inited.nsi. It shows the problem.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ChocJunkie</div><div class="date">20th January 2010, 14:34</div></div><div class="posttext">Hi,<br />
<br />
I'm using the NSISArray plugin for quite some time now. Until today it worked perfectly for me.<br />
Today, I've added another array to my installer. Now I get the system error '0xc0000005' (access violation of the memory) after I did differnt actions on my different arrays.<br />
<br />
I've got absolutely no hint whats the problem - beside its a memory error. I've tried several differnt combinations of active (-&gt; initialized and not deleted) arrays and sizes of the arrays.<br />
<br />
I did several test to get a hint.<br />
<br />
Test (#1):<br />
I've got 8 active arrays. When I'm trying to init the 9th one, the initialization fails. After that I trie to delete all initialized arrays befor the installer ends. The first three deletion commands succeed. Deleting the fourth array fails and I get the '0xc0000005' exception.<br />
<br />
Test #2:<br />
I'm using only 8 active arrays. Everything works fine until I want to delete the arrays when the installer finishes. Like at test #1, the first three deleting commands succed - yes, that are the same as in #1. The fourth deletion command fails. Result: The same error for the SAME! memory address.<br />
<br />
Test #3:<br />
It's the same installer as in #2.<br />
I cancel the installation process early when I've got only 2 initialized arrays. Everything works fine.<br />
<br />
I'm kind of helpless about determing and solving the problem.<br />
Any ideas what the reason could be or what I can text explicitly?<br />
<br />
Thanks! <br />
<br />
CJ<br />
<br />
[moderator - 2 post thread merged into plug-in discussion)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ChocJunkie</div><div class="date">21st January 2010, 09:21</div></div><div class="posttext">Ok, at first I have to say, I'm not used to C/C++. ;)<br />
<br />
I've rebuilded the NSISArray plug-in as debug version. The debugger shows me:<br />
 - I've got 8 active arrays [as expected]<br />
 - the pointers to my first two arrays have been overwritten at some point. So that they are pointing to nowhere (at the address 0x00000000). [unexpected]<br />
<br />
I know, the two compromized arrays have not been wrong right from the beginning, because I'm using them several times befor the crash occueres.<br />
<br />
If someone comes up with 'Oh, I know at which line/block of the plug-in the problem is located!', I would be happy. ;)<br />
<br />
<br />
CJ</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ChocJunkie</div><div class="date">21st January 2010, 11:00</div></div><div class="posttext">Two things...<br />
<br />
1.) Why can only 8 arrays be declared? Is there a reason or can I manipulate this value for my purpose?<br />
<br />
<br />
2.) Inside the debug function, the value of g_iArrayCount is decreased at last after deleting the array. Because of that, the array after the deleted one will be erased. (But this one is empty so that no problems will be detected.) That's not exactly correct but it works as long as the user doesn't use 8 (ARRAY_MAX_COUNT) arrays. Because if he does, the memory 'after' the array will be manipulated.<br />
<br />
In short<br />
<br />
Old version:g_iArrInformation[g_iArrayCount][ARRAY_UPPERINDEX] = g_iArrInformation[g_iArrayCount][ARRAY_INDEXES] = g_iArrInformation[g_iArrayCount][ARRAY_BUFFER] = 0;<br />
        my_strcpy(g_szArrNames[g_iArrayCount], (int)ARRAY_BUFFER_NAME, &quot;&quot;, 1);<br />
g_iArrayCount--;<br />
<br />
Correctedg_iArrayCount--;<br />
g_iArrInformation[g_iArrayCount][ARRAY_UPPERINDEX] = g_iArrInformation[g_iArrayCount][ARRAY_INDEXES] = g_iArrInformation[g_iArrayCount][ARRAY_BUFFER] = 0;<br />
        my_strcpy(g_szArrNames[g_iArrayCount], (int)ARRAY_BUFFER_NAME, &quot;&quot;, 1);<br />
<br />
<br />
CJ</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st January 2010, 23:20</div></div><div class="posttext">Thanks for spotting that. With that fixed would you mind posting a script that crashes?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ChocJunkie</div><div class="date">22nd January 2010, 07:28</div></div><div class="posttext">Sorry, I've forgott to tell: With that fixed, the plugin doesn't crash any more. ^^'<br />
<br />
CJ</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th March 2010, 22:21</div></div><div class="posttext">v2.2 is now available. Some bug fixes, new NSIS plugin API integration and a unicode build is included.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SpudNyk</div><div class="date">1st April 2010, 23:39</div></div><div class="posttext">There is an compilation error when using the ReadFirst Macro<br />
<br />
I belive I fixed it by changing line 676 from:<br />
  ${Array_PopErrVar} <br />
to:<br />
  ${Array_PopErrVar} true<br />
<br />
Asides from that the plugin works well, Thanks for writing it and supporting it too.<br />
<br />
Cheers</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd April 2010, 14:04</div></div><div class="posttext">Thanks, fixed.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">22nd April 2010, 13:10</div></div><div class="posttext">Uploaded v2.4. The DLL had an XML manifest in it defining Microsoft VC90 CRT as a dependency.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">montonero</div><div class="date">19th October 2010, 19:21</div></div><div class="posttext">Hi. Thanks for useful plugin. There's my contribution: errors fixes for Join and Subtract functions.<br />
--- I:/nsis/Contrib/NSISArray/NSISArray.cpp    Thu Apr 22 12:57:24 2010<br />
+++ C:/Program Files/NSIS/Contrib/NSISArray/NSISArray.cpp    Mon Oct 18 11:41:42 2010<br />
@@ -1,5 +1,6 @@<br />
 #include &lt;windows.h&gt;<br />
 #include &lt;commctrl.h&gt;<br />
+#include &lt;assert.h&gt;<br />
 #ifdef UNICODE<br />
 #include &quot;nsis_unicode/pluginapi.h&quot;<br />
 #else<br />
@@ -1462,9 +1463,10 @@<br />
         return;<br />
       }<br />
 <br />
+      int iBiggestArrayBuffer=max(g_iArrInformation[iArrayIndexA][ARRAY_BUFFER], g_iArrInformation[iArrayIndexB][ARRAY_BUFFER]);<br />
       for (i=0; i&lt;iNewSize; i++)<br />
       {<br />
-        szArrTemp[i] = (TCHAR *)MALLOC(sizeof(TCHAR) * g_iArrInformation[iArrayIndexA][ARRAY_BUFFER]);<br />
+        szArrTemp[i] = (TCHAR *)MALLOC(sizeof(TCHAR) * iBiggestArrayBuffer);<br />
         if (szArrTemp[i] == NULL)<br />
         {<br />
           FREE(szArrTemp);<br />
@@ -1474,10 +1476,10 @@<br />
       }<br />
 <br />
       for (i=0; i&lt;=g_iArrInformation[iArrayIndexB][ARRAY_UPPERINDEX]; i++)<br />
-        my_strcpy(szArrTemp[i], g_iArrInformation[iArrayIndexA][ARRAY_BUFFER], g_szArrData[iArrayIndexB][i], g_iArrInformation[iArrayIndexB][ARRAY_BUFFER]);<br />
+        my_strcpy(szArrTemp[i], iBiggestArrayBuffer, g_szArrData[iArrayIndexB][i], g_iArrInformation[iArrayIndexB][ARRAY_BUFFER]);<br />
 <br />
       for (i=g_iArrInformation[iArrayIndexB][ARRAY_UPPERINDEX]+1, j=0; i&lt;iNewSize; i++, j++)<br />
-        my_strcpy(szArrTemp[i], g_iArrInformation[iArrayIndexA][ARRAY_BUFFER], g_szArrData[iArrayIndexA][j], g_iArrInformation[iArrayIndexA][ARRAY_BUFFER]);<br />
+        my_strcpy(szArrTemp[i], iBiggestArrayBuffer, g_szArrData[iArrayIndexA][j], g_iArrInformation[iArrayIndexA][ARRAY_BUFFER]);<br />
 <br />
       for (i=0; i&lt;g_iArrInformation[iArrayIndexB][ARRAY_INDEXES]; i++)<br />
         FREE(g_szArrData[iArrayIndexB][i]);<br />
@@ -1487,7 +1489,7 @@<br />
 <br />
       g_iArrInformation[iArrayIndexB][ARRAY_UPPERINDEX] = iNewSize-1;<br />
       g_iArrInformation[iArrayIndexB][ARRAY_INDEXES] = iNewSize;<br />
-      g_iArrInformation[iArrayIndexB][ARRAY_BUFFER] = g_iArrInformation[iArrayIndexA][ARRAY_BUFFER];<br />
+      g_iArrInformation[iArrayIndexB][ARRAY_BUFFER] = iBiggestArrayBuffer;<br />
 <br />
       NoErrorMsg();<br />
     }<br />
@@ -1860,6 +1862,13 @@<br />
         }<br />
       }<br />
 <br />
+      if (!iNewSize){<br />
+        NoErrorMsg();<br />
+        return;<br />
+      }<br />
+<br />
+      iNewSize=g_iArrInformation[iArrayIndexA][ARRAY_UPPERINDEX]-iNewSize+1;<br />
+<br />
       szArrTemp = (TCHAR **)MALLOC(sizeof(TCHAR *) * iNewSize);<br />
       if (szArrTemp == NULL)<br />
       {<br />
@@ -1881,16 +1890,13 @@<br />
       for (i=0; i&lt;=g_iArrInformation[iArrayIndexA][ARRAY_UPPERINDEX]; i++)<br />
       {<br />
         bFound = FALSE;<br />
-        for (j=0; j&lt;=g_iArrInformation[iArrayIndexB][ARRAY_UPPERINDEX]; j++)<br />
-        {<br />
-          if (lstrcmp(g_szArrData[iArrayIndexA][i], g_szArrData[iArrayIndexB][j]) == 0)<br />
+        for (j=0; j&lt;=g_iArrInformation[iArrayIndexB][ARRAY_UPPERINDEX] &amp;&amp; !bFound; j++)<br />
           {<br />
-            bFound = TRUE;<br />
-            break;<br />
-          }<br />
+          bFound = !lstrcmp(g_szArrData[iArrayIndexA][i], g_szArrData[iArrayIndexB][j]);<br />
         }<br />
         if (!bFound)<br />
         {<br />
+          assert(k&lt;iNewSize);<br />
           my_strcpy(szArrTemp[k], g_iArrInformation[iArrayIndexA][ARRAY_BUFFER], g_szArrData[iArrayIndexA][i], g_iArrInformation[iArrayIndexA][ARRAY_BUFFER]);<br />
           k++;<br />
         }</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TVNST</div><div class="date">21st August 2012, 10:50</div></div><div class="posttext">I'm using the newest version 2.4, but I still can't add empty strings.<br />
Will this ever be fixed? Since for my purposes, it's unusable this way.<br />
<br />
Any alternatives?<br />
I've tried NSArray, but it suffers from memory corruption from time to time, loosing complete values or returning corrupted ones.<br />
NSISList plug-in sounds good, but I can only use unicode plugins and it doesn't seem to have a dll for that. Same applies to stack plugin.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st August 2012, 12:26</div></div><div class="posttext">I'm using the newest version 2.4, but I still can't add empty strings.<br />
Will this ever be fixed? Since for my purposes, it's unusable this way.<br />
<br />
Any alternatives?<br />
I've tried NSArray, but it suffers from memory corruption from time to time, loosing complete values or returning corrupted ones.<br />
<br />
I don't plan on updating NSISArray any more but I will if I get time. As for nsArray, I have not experienced any memory corruption and I have tested thoroughly in a debugger. Are you using the ANSI or Unicode build? Do you have a script which reproduces?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TVNST</div><div class="date">21st August 2012, 13:31</div></div><div class="posttext">I used the Unicode build of both nsArray and NSISArray.<br />
<br />
Unfortunately, the memory corruption problems only occur sporadic. There's no way to reproduce the problem reliable.<br />
However, they occured on two different computers.<br />
<br />
I experienced two different kinds of problems:<br />
1.) Elements that were added are suddenly missing<br />
I had this several times. I add usually 'sets' of parameters via macro.<br />
Therefore if the first parameter is retrieved, the other parameters must also have been added since the NSIS compiler would fail if there's a parameter missing.<br />
Example:<br />
!macro _TVWriteRegStr sRegPath sValName sValData<br />
<br />
	nsArray::Set aRegActions /list &quot;WRITE_STRING&quot; `${sRegPath}` `${sValName}` `${sValData}` /end<br />
!macroend<br />
At a later point I retrieve this command values and compute them.<br />
Now, the error I got was that I could retrieve &quot;WRITE_STRING&quot;, but if I tried to get one of the following parameters with	nsArray::Get aRegActions $R0 the error flag is set, indicating that the array reached its last value which was clearly not the case.<br />
<br />
2.) Elements corrupted<br />
Another problem I experienced a few times was if I added a string value, then one letter of the string value was corrupted when I retrieved the value.<br />
One example I remember is that I added &quot;DELETE&quot; and got &quot;DE$ETE&quot; when retrieving the value.<br />
<br />
However, there's still the possibility that it's not a bug from nsArray itself, but another buggy plugin function that corrupts the memory of nsArray. However, I would have guessed that this would also affect the NSIS stack, since it's elements are also created dynamically.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st August 2012, 14:33</div></div><div class="posttext">After your code:<br />
<br />
aRegActions = { 0 =&gt; &quot;WRITE_STRING&quot;, 1 =&gt; &quot;${sRegPath}&quot;, 2 =&gt; &quot;${sValName}&quot;, 3 =&gt; &quot;${sValData}&quot; }<br />
<br />
Are you saying nsArray::Get aRegActions 1 sets the error flag?<br />
<br />
For what you are doing, you may find it easier to use my nsJSON plug-in.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TVNST</div><div class="date">21st August 2012, 15:17</div></div><div class="posttext">I think I had both the first and the second value setting an error flag on different occasions.<br />
However, the array stores more than just one Registry-Action.<br />
All registry actions in the NSIS code are first gathered in the array and then executed in a loop through all registry actions.<br />
The idea behind that is to implement a rollback on errors mechanism similar to MSI installers which is not supported by NSIS by default.<br />
Therefore, the error flag was set on something like nsArray::Get aRegActions 42 since it wasn't in the first registry action, it was somewhere inbetween.<br />
<br />
The JSON plugin uses a file which is not what I want. I could also have used an ini file in this case.<br />
File errors are the most likely errors that can occur in an installation and I want to avoid to make an error check on each write or read operation.<br />
Therefore I'd prefer to keep those actions in the memory.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st August 2012, 15:27</div></div><div class="posttext">I think I had both the first and the second value setting an error flag on different occasions.<br />
However, the array stores more than just one Registry-Action.<br />
All registry actions in the NSIS code are first gathered in the array and then executed in a loop through all registry actions.<br />
The idea behind that is to implement a rollback on errors mechanism similar to MSI installers which is not supported by NSIS by default.<br />
Therefore, the error flag was set on something like nsArray::Get aRegActions 42 since it wasn't in the first registry action, it was somewhere inbetween.<br />
<br />
The JSON plugin uses a file which is not what I want. I could also have used an ini file in this case.<br />
File errors are the most likely errors that can occur in an installation and I want to avoid to make an error check on each write or read operation.<br />
Therefore I'd prefer to keep those actions in the memory.<br />
<br />
I'll look into the nsArray issues when I can. As for nsJSON you don't need to use files at all. You can create and manipulate a JSON tree in memory.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TVNST</div><div class="date">21st August 2012, 15:52</div></div><div class="posttext">Thanks for the help. I check out the JSON plugin again. If it can keep the data in the memory then it could be a solution for my problems.<br />
I hope I can find some examples somewhere since its use with the tree notes seems a bit complicated.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>