<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Need help enforcing .Net installation., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Need help enforcing .Net installation. NSIS Discussion" />
	
	<title> Need help enforcing .Net installation. [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Need help enforcing .Net installation.</div>
<hr />
<div class="pda"><a href="t-334091.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=334091">Need help enforcing .Net installation.</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">siegeon</div><div class="date">26th August 2011, 22:11</div></div><div class="posttext">I have run into this issue in the past, I thought I had it licked, but I have recently gotten some reports from users that .net 4 is not installing on their system as intended. I have a specific section of my installer set up to handle the .net installation. <br />
<br />
Basically what is going on is at the start of our programs installation it checks to ensure that the client has .net4 full on their system, if not, then installs the bootstrapped file. However on some systems it seems that rather then install the file, the installer just keeps on going.<br />
<br />
For now I will post the section dealing with dot net, if needed I can post more.<br />
<br />
<br />
	Section &quot;.Net&quot; SEC01<br />
		SetOutPath &quot;$INSTDIR&quot;<br />
		SetOverwrite ifnewer<br />
	<br />
		; Begin Check .NET version<br />
		StrCpy $InstallDotNET &quot;No&quot;<br />
			${If} ${DOTNETVER_4_0} HasDotNetFullProfile 1<br />
				StrCpy $InstallDotNet &quot;No&quot;<br />
			${EndIf}<br />
			${If} ${DOTNETVER_4_0} HasDotNetFullProfile 0<br />
        		StrCpy $InstallDotNET &quot;Yes&quot;<br />
			${EndIf}<br />
		<br />
		; Get .NET if required<br />
			${If} $InstallDotNET == &quot;Yes&quot;<br />
				MessageBox MB_YESNO &quot;Microsoft .NET 4 is required to run this application. Install the Microsoft .NET Framework 4 Redistributable?&quot; /SD IDYES IDNO endNetCF<br />
				File &quot;..\..\Redist\dotNetFx40_Full_x86_x64.exe&quot;<br />
				ExecWait &quot;$INSTDIR\dotNetFx40_Full_x86_x64.exe&quot;<br />
			${EndIf}<br />
				endNetCF:<br />
				Delete &quot;$INSTDIR\dotNetFx40_Full_x86_x64.exe&quot;<br />
		 <br />
	     SetDetailsView show<br />
	 <br />
		; Install Files<br />
		; save install location<br />
		WriteRegStr ${PRODUCT_DIR_ROOT_KEY} &quot;${PRODUCT_DIR_REGKEY}&quot; &quot;InstallLocation&quot; &quot;$INSTDIR&quot;<br />
	SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">27th August 2011, 13:14</div></div><div class="posttext">How is the macro &quot;${DOTNETVER_4_0}&quot; defined?<br />
<br />
Also I would add some more verbose output to installer, so you can find out whether it is your .NET detection that failed to detect the missing .NET framework or the installer that failed to execute.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">siegeon</div><div class="date">29th August 2011, 15:52</div></div><div class="posttext">I can tell you with almost perfect certainty that it has to do with the exewait function not waiting on some systems. I searched around a bit over the weekend, and I am a little unclear about how to resolve that problem; it would seem there is something I can add to the specific line, like <br />
<br />
ExecWait &quot;$INSTDIR\dotNetFx40_Full_x86_x64.exe /norestart /passive /showfinalerror&quot;<br />
<br />
but I am unclear where these arguments are found, and there does not seem to be a specific one for my installer, that or I am not looking for the right thing.<br />
<br />
The Installer in question works fine on an XP 32/64, and on all the windows 7 32/64 machines I have set up in a VM environment. However it seems to fail on just a few systems; since these are client machines, I have limited information about their systems/settings, and I am not sure what I am looking for. <br />
<br />
The macro is defined in an add on written by David Grinberg you can check it out here<br />
Homepage: http://ontheperiphery.veraida.com/</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">29th August 2011, 16:11</div></div><div class="posttext">Try like this:<br />
ExecWait `&quot;$INSTDIR\dotNetFx40_Full_x86_x64.exe&quot; /norestart /passive /showfinalerror`<br />
<br />
It's important to enclose command-line arguments that might contain whitespaces within quotes, such as the path to the installer! However you must put the whole command-line into quotes (a different kind of quotes), because ExecWait expects a single operand.<br />
<br />
Also be aware that some installer executable (SFX files), which have not been made with NSIS, will only extract the setup files to some folder and then invoke the actual installer program from there. In that case 'ExecWait' would only wait for the first executable, but not for the second executable that was launched by the first one. This can still work if the first executable waits for the second one. But if it doesn't, then it won't work. AFAIK an ExecWait() that will also wait for all child-processes of the created process doesn't exist in NSIS.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">siegeon</div><div class="date">29th August 2011, 16:59</div></div><div class="posttext">AFAIK an ExecWait() that will also wait for all child-processes of the created process doesn't exist in NSIS. <br />
<br />
That seems to be the general consensus, however that must be a consistent way of installing things such as .NET or other redistributes, otherwise the usefulness of this software drops dramatically. How can one use software like this that may install your product correctly on a consumers computer. As it stands I can tell users to manually install .NET4 full so our software will run, but I do not want to spend my day answering calls and explaining that. I can't be the only one in this community that is attempting to install a redistributable, and has run into this child process issue. I don't know that I am approaching this the write way, so I am open to suggestions on how to resolve this.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">29th August 2011, 17:09</div></div><div class="posttext">That seems to be the general consensus, however that must be a consistent way of installing things such as .NET or other redistributes, otherwise the usefulness of this software drops dramatically.<br />
<br />
Well, that's something to complain about at the author of the redistributable :rolleyes:<br />
<br />
How can one use software like this that may install your product correctly on a consumers computer. As it stands I can tell users to manually install .NET4 full so our software will run, but I do not want to spend my day answering calls and explaining that.<br />
<br />
1) Don't use .NET, there are plenty of alternatives that don't require to user to install a bloated framework separately. With GUI framworks like Qt or WxWidgets you put a few runtime DLL's into the install folder (or even link everything statically into the EXE file) and that's it.<br />
<br />
2) Add the required version of the .NET framework to the system requirements of your software and simply abort setup with an error message, if the framework is not installed yet. AFAIK obtaining the .NET framwrok via Windows Update is the recommend way anyway. But you can also offer the user to open the .NET download site in the browser, within your error message dialog.<br />
<br />
I can't be the only one in this community that is attempting to install a redistributable, and has run into this child process issue. I don't know that I am approaching this the write way, so I am open to suggestions on how to resolve this.<br />
<br />
As said before, if that is really the problem, it's a problem of the individual redistributable installer and only the developers of the installer could fix the issue. If a self-extractor extracts setup files and then launches setup, the self-extractor is supposed to wait for the setup program to terminate and perform a clean-up afterwards. At least when running in non-interactive mode.<br />
<br />
(I don't use .NET, but all other redistributable installers I came across so far work that way. And it would be strange if only .NET doesn't)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">siegeon</div><div class="date">29th August 2011, 17:21</div></div><div class="posttext">Sorry to come off as a complainer, that is not the case. I don't really have time to learn and port over to QT, I have inherited this software from a previous developer, and the rate at which I have to create deliverables prevents me from making any meaningful or fundamental changes, let alone learn a system like QT. I have enough time to get small things done here and there. I was hoping to keep things in the installer department about the same for the newest version of the software. Ill keep looking; thanks again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">29th August 2011, 17:35</div></div><div class="posttext">Another option would be:<br />
<br />
Manually extract the .NET installer redistributable package. Something like 7-Zip or Universal Extractor should be able to do the job. Then make your installer extract the .NET setup files to a temporary folder (you can use $PLUGINSDIR or a sub-folder thereof) and let ExecWait() run the actual installer executable directly. NSIS will clean-up the $PLUGINSDIR folder automatically when the installer exists.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">siegeon</div><div class="date">29th August 2011, 17:51</div></div><div class="posttext">Now that is not a bad idea Mulder; I will see if I cant get that to work, all in all I am very green when it comes to this installer software and I am learning as I go. Thank you for the time you spend on this!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">siegeon</div><div class="date">30th August 2011, 16:31</div></div><div class="posttext">Today I started the above mentioned process, since I'm still new to NSIS I am not sure that I have gone about this correctly. <br />
<br />
I extracted all of the files from the redistributable placing them in a folder called redist.<br />
<br />
Then I edited the code (see bold lines below) but the installer now does not want to install, am I missing a step?<br />
<br />
<br />
Section &quot;.Net&quot; SEC01<br />
		SetOutPath &quot;$INSTDIR&quot;<br />
		SetOverwrite ifnewer<br />
	<br />
		; Begin Check .NET version<br />
		StrCpy $InstallDotNET &quot;No&quot;<br />
			${If} ${DOTNETVER_4_0} HasDotNetFullProfile 1<br />
				StrCpy $InstallDotNet &quot;No&quot;<br />
			${EndIf}<br />
			${If} ${DOTNETVER_4_0} HasDotNetFullProfile 0<br />
        		StrCpy $InstallDotNET &quot;Yes&quot;<br />
			${EndIf}<br />
		<br />
		; Get .NET if required<br />
			${If} $InstallDotNET == &quot;Yes&quot;<br />
				MessageBox MB_YESNO &quot;Microsoft .NET 4 is required to run this application. Install the Microsoft .NET Framework 4 Redistributable?&quot; /SD IDYES IDNO endNetCF<br />
				SetOutPath &quot;$PLUGINSDIR&quot;<br />
				File /nonfatal /r &quot;..\..\Redist\*.*&quot;<br />
				ExecWait &quot;$PLUGINSDIR\Setup.exe&quot;<br />
			${EndIf}<br />
				endNetCF:<br />
				Delete &quot;$INSTDIR\dotNetFx40_Full_x86_x64.exe&quot;<br />
		 <br />
	     SetDetailsView show<br />
	 <br />
		; Install Files<br />
		; save install location<br />
		WriteRegStr ${PRODUCT_DIR_ROOT_KEY} &quot;${PRODUCT_DIR_REGKEY}&quot; &quot;InstallLocation&quot; &quot;$INSTDIR&quot;<br />
	SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">30th August 2011, 16:36</div></div><div class="posttext">I'd probably use:<br />
<br />
SetOutPath &quot;$PLUGINSDIR\dotNetInstall&quot;<br />
File /r &quot;..\..\Redist\*.*&quot;<br />
ExecWait '&quot;$PLUGINSDIR\dotNetInstall\Setup.exe&quot; &lt;more parameters&gt;'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">siegeon</div><div class="date">30th August 2011, 16:55</div></div><div class="posttext">Ha, turns our Microsoft locked down this installer, you can not run it directly from the Setup.exe and their command line parameter options are weak sauce. Other then chainingpackage I have tried them all, but to no avail. Though I understand the problem much better now, thank you.<br />
<br />
/q              <br />
/norestart   <br />
/repair<br />
/chainingpackage</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lim56</div><div class="date">31st August 2011, 07:46</div></div><div class="posttext">I've no problem installing the .Net redistributable from my setup. Try:<br />
<br />
ExecWait '$INSTDIR\dotnetfx40_Full_x86_x64.exe /passive /log $INSTDIR\Log\dotNetFx40.log /c:&quot;Install /q&quot;'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st August 2011, 10:51</div></div><div class="posttext">@lim56:<br />
You are missing quotes around the executable path.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lim56</div><div class="date">31st August 2011, 11:41</div></div><div class="posttext">Yes, you're right, to handle spaces in the executable path as pointed out before.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">siegeon</div><div class="date">28th September 2011, 20:01</div></div><div class="posttext">Thank you Thank you Thank.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>