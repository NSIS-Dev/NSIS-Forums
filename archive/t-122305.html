<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Closing IE Windows, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Closing IE Windows NSIS Discussion" />
	
	<title> Closing IE Windows [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Closing IE Windows</div>
<hr />
<div class="pda"><a href="t-122305.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=122305">Closing IE Windows</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">simham_uk</div><div class="date">21st January 2003, 22:03</div></div><div class="posttext">Hi all<br />
<br />
It's been a while since I've been here or used the NSIS installer, but since I have started again I have found a new problem.<br />
<br />
I have looked at all the methods for closing windows, and examples show how it works with Winamp, but when I try everything I can think of with FindWindow, etc I just cant get the IE Window to close.<br />
<br />
Actually I want to close all open IE windows so perhaps a loop is required, but I have even seen examples of that.<br />
<br />
If anyone knows if and how this can be achieved I would be most grateful.<br />
<br />
Thanks<br />
<br />
Simon H</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd January 2003, 15:25</div></div><div class="posttext">Try this search:<br />
http://forums.winamp.com/search.php?s=&amp;action=showresults&amp;searchid=618696&amp;sortby=lastpost&amp;sortorder=descending<br />
<br />
As I have mentioned in each one of those threads, it's never a good idea to terminate Explorer/Internet Explorer. There is always a better way of refreshing it for the change you have made. So, what's your change?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simham_uk</div><div class="date">22nd January 2003, 16:37</div></div><div class="posttext">What I have is a customer with 2 proxy servers, and I'm writing an app using NSIS to change the proxy settings based on a commandline parameter in the shortcut to the proposed NSIS App.<br />
<br />
So...when the user clicks on the link it closes existing windows, changes the proxy settings and re-opens IE.<br />
<br />
I would find this tidier than leaving windows open that cannot access the pages that they were previously at, because of proxy settings, rather than leave dead windows open in the background.<br />
<br />
Is there an easier way?<br />
<br />
I will read that other post too, but probably have already!<br />
<br />
Thanks <br />
<br />
Simon H</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simham_uk</div><div class="date">9th February 2003, 12:11</div></div><div class="posttext">No further ideas on this?<br />
<br />
Simon</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jthompson</div><div class="date">9th February 2003, 12:53</div></div><div class="posttext">Well, at least on Windows XP SP1 with IE6, all open IE windows automatically get a proxy server change.  I opened 5 windows and changed that setting (to a bogus server) in one window and tried browsing to google in one of the other windows.  Did not work because the proxy setting was read by all open windows.<br />
<br />
Probably doesn't help you, but on XP with IE6, there is no need to close the windows.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">9th February 2003, 12:54</div></div><div class="posttext">I have a little macro in one of my installers which might be of interest. See the attachment. The coding is pretty poor but I've never needed to improve it for that installer so I never bothered. Strictly speaking the macro could use offset jumps instead of labels which would be much better.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simham_uk</div><div class="date">10th February 2003, 20:34</div></div><div class="posttext">Originally posted by jthompson <br />
Well, at least on Windows XP SP1 with IE6, all open IE windows automatically get a proxy server change.  I opened 5 windows and changed that setting (to a bogus server) in one window and tried browsing to google in one of the other windows.  Did not work because the proxy setting was read by all open windows.<br />
<br />
Probably doesn't help you, but on XP with IE6, there is no need to close the windows. <br />
<br />
This is true, and lesser versions also.  The problem is that if a user is browsing an inTRAnet with 1 proxy setting, and then they change it (for intERnet) in a different window, they may still go back to the other window and continue to (try) and browse the inTRAnet.  That would be confusing for joe user who know nothing.<br />
<br />
Thanks for the input tho!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simham_uk</div><div class="date">10th February 2003, 20:43</div></div><div class="posttext">Originally posted by Sunjammer <br />
I have a little macro in one of my installers which might be of interest. See the attachment. The coding is pretty poor but I've never needed to improve it for that installer so I never bothered. Strictly speaking the macro could use offset jumps instead of labels which would be much better. <br />
<br />
Thanks Sunjammer!  (Good to see you're helping NSIS a lot!!!..you've been busy!)<br />
<br />
I have tried a variation of your attachment, from your Archive &quot;Useful Functions&quot; bit of the website, but with no joy.<br />
<br />
Here is what I have now:<br />
<br />
<br />
Function CloseProgram <br />
  Exch $1<br />
  Push $0<br />
  loop:<br />
    FindWindow $0 $1<br />
    IntCmp $0 0 done<br />
    IsWindow $0 0 done<br />
      SendMessage $0 ${WM_CLOSE} 0 0<br />
      SendMessage $0 ${WM_QUIT} 0 0<br />
      SendMessage $0 ${WM_DESTROY} 0 0<br />
    Sleep 100 <br />
    Goto loop <br />
  done: <br />
  Pop $0 <br />
  Pop $1<br />
FunctionEnd<br />
<br />
<br />
I am calling it using:<br />
<br />
<br />
Push &quot;IEFrame&quot;<br />
Call CloseProgram<br />
<br />
<br />
The problem is that it locks IE, I lose the content, and the Menubar greys.<br />
<br />
BTW I used Win32spy to get the class name (cool tool!!).<br />
<br />
But this doesn't seem to actually close IE.  I have also seen some C code for doing this, which may be useful in a DLL if you can make one, but haven't tested it yet.  If you are interested I can email it to you.<br />
<br />
Or if you have any further ideas on the code above, please let me know.<br />
<br />
Thanks dude!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stereo</div><div class="date">10th February 2003, 21:00</div></div><div class="posttext">IE is a bit different in that it doesn't seem to want to close using SendMessage() calls.<br />
<br />
The solution I've used to shut down all IE windows is to send a WM_CLOSE to the IE window using PostMessage().  Unfortunately, this API isn't natively supported by NSIS.<br />
<br />
I believe there's an NSIS plugin that allows you to call API functions, and if not, it wouldn't be very difficult to build one that could just call PostMessage() for you.<br />
<br />
Hope this helps,<br />
<br />
Scott.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simham_uk</div><div class="date">10th February 2003, 21:07</div></div><div class="posttext">Originally posted by stereo <br />
IE is a bit different in that it doesn't seem to want to close using SendMessage() calls.<br />
<br />
The solution I've used to shut down all IE windows is to send a WM_CLOSE to the IE window using PostMessage().  Unfortunately, this API isn't natively supported by NSIS.<br />
<br />
I believe there's an NSIS plugin that allows you to call API functions, and if not, it wouldn't be very difficult to build one that could just call PostMessage() for you.<br />
<br />
Hope this helps,<br />
<br />
Scott.  <br />
<br />
Here is a link to some CPP code that will kill process by name...maybe it could be used in a plugin (with the authors permission of course).<br />
<br />
http://www.physiology.wisc.edu/ravi/software/killproc/ (http://www.physiology.wisc.edu/ravi/software/killproc)<br />
<br />
I can't compile nor do I know CPP, but if something can even be learnt from it then good.<br />
<br />
Anyway...I still need to find a way to do it.<br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simham_uk</div><div class="date">10th February 2003, 21:10</div></div><div class="posttext">BTW, I'm still using 1.98 I think, maybe 99, but havne't made the move to version 2 just yet!<br />
<br />
Simon</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">10th February 2003, 21:19</div></div><div class="posttext">System::Call 'user32::PostMessageA(i,i,i,i) i($0,${WM_CLOSE},0,0)'<br />
<br />
might work, assuming $0 contains the window handle as returned by FindWindow. If it doesn't work something similar should. I'd say consult the System docs in Contrib\System\System.txt but you'll need a Greek translator to help you :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simham_uk</div><div class="date">10th February 2003, 21:25</div></div><div class="posttext">Originally posted by Sunjammer <br />
System::Call 'user32::PostMessageA(i,i,i,i) i($0,${WM_CLOSE},0,0)'<br />
<br />
might work, assuming $0 contains the window handle as returned by FindWindow. If it doesn't work something similar should. I'd say consult the System docs in Contrib\System\System.txt but you'll need a Greek translator to help you :) <br />
<br />
Can I use this in 1.98/9?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">10th February 2003, 21:38</div></div><div class="posttext">Errm good question. System was first distributed with NSIS in version 2.0b0 according to the release history. My improved plugin syntax became part of NSIS as of version 2.0a4 so the syntax would have to be that of the old CallInstDLL command, so you'd have to push the argument to the stack first... something like this:<br />
<br />
<br />
SetOutPath $TEMP<br />
GetTempFileName $1<br />
File /oname=$1 system.dll<br />
Push 'user32::PostMessageA(i,i,i,i) i($0,0x10,0,0)'<br />
CallInstDLL $1 Call<br />
<br />
<br />
I *think* that syntax is correct. Whether it will actually work? No idea. Anyway what are you using 1.98 for???</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simham_uk</div><div class="date">10th February 2003, 21:45</div></div><div class="posttext">Originally posted by Sunjammer <br />
Errm good question. System was first distributed with NSIS in version 2.0b0 according to the release history. My improved plugin syntax became part of NSIS as of version 2.0a4 so the syntax would have to be that of the old CallInstDLL command, so you'd have to push the argument to the stack first... something like this:<br />
<br />
<br />
SetOutPath $TEMP<br />
GetTempFileName $1<br />
File /oname=$1 system.dll<br />
Push 'user32::PostMessageA(i,i,i,i) i($0,0x10,0,0)'<br />
CallInstDLL $1 Call<br />
<br />
<br />
I *think* that syntax is correct. Whether it will actually work? No idea. Anyway what are you using 1.98 for??? <br />
<br />
LOL...cheers dude!  I have just compiled my little thing in v.2.0b and it works ok.<br />
<br />
I have also tried your system call but it only seems to cclose one window...just need to put it into a loop I guess.<br />
<br />
I'll let you know how I get on, but this might work out ok!<br />
<br />
Thanks again</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">10th February 2003, 21:50</div></div><div class="posttext">You mean that System code I just concocted works??? Woohoo that was unexpected !!! :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simham_uk</div><div class="date">10th February 2003, 21:51</div></div><div class="posttext">YEEEEEHHHH!!!!<br />
<br />
It works dude..closes all IE windows :-)!!!<br />
<br />
Here's the code (tested on Win2kpro only):<br />
<br />
<br />
loop:<br />
    FindWindow $0 &quot;IEFrame&quot;<br />
    IntCmp $0 0 done<br />
    IsWindow $0 0 done<br />
    System::Call 'user32::PostMessageA(i,i,i,i) i($0,${WM_CLOSE},0,0)'<br />
    Sleep 100<br />
    Goto loop<br />
done:<br />
<br />
<br />
Thanks for the help!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">10th February 2003, 21:52</div></div><div class="posttext">Go on, you know you want to, do me a favour :D<br />
<br />
Create a page in the Archive for that solution pretty please :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simham_uk</div><div class="date">10th February 2003, 22:03</div></div><div class="posttext">no probs...glad to be of help!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simham_uk</div><div class="date">15th February 2003, 14:36</div></div><div class="posttext">Originally posted by simham_uk <br />
YEEEEEHHHH!!!!<br />
<br />
It works dude..closes all IE windows :-)!!!<br />
<br />
Here's the code (tested on Win2kpro only):<br />
<br />
<br />
loop:<br />
    FindWindow $0 &quot;IEFrame&quot;<br />
    IntCmp $0 0 done<br />
    IsWindow $0 0 done<br />
    System::Call 'user32::PostMessageA(i,i,i,i) i($0,${WM_CLOSE},0,0)'<br />
    Sleep 100<br />
    Goto loop<br />
done:<br />
<br />
<br />
Thanks for the help! <br />
<br />
I think I have a problem.  I'm calling this in .onInit, then in .onInstSuccess I'm doing this:<br />
<br />
<br />
Function .onInstSuccess<br />
  ExecShell open 'iexplore.exe'<br />
FunctionEnd<br />
<br />
<br />
My problem is, that on a Win98 machine I got it tested on, the new window didnt open in .onInstSuccess (it works from Start&gt;&gt;run ok).<br />
<br />
Could it be, that because this machine is slow, the system call is STILL closing IE windows when the .onInstSuccess function is excecuted, therefore resulting in the system call closing THAT window too?<br />
<br />
To ensure this is not the case, is there a way I can check that the system call has completely finished before proceding?<br />
<br />
If not, perhaps you may have an idea to over come this anyway?<br />
<br />
TIA</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">15th February 2003, 20:42</div></div><div class="posttext">The system call could still be causing Windows to close, but it should only be those that were open when the system call was made. New windows would not receive the close message.<br />
<br />
By the time .onInstSuccess is reached the loop of System calls has finished so the message definitely should not get sent to a new ie window that opens. (in my opinion, I might be wrong)<br />
<br />
Have you tried other ways of running iexplore.exe? (e.g. a batch file, a shortcut, using the start command (Exec 'start iexplore'), using nsExec, etc.).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th February 2003, 20:51</div></div><div class="posttext">You are right Sunjammer. There is absolutely no way this loop closed that window. My guess is that the window never even opened. Try and see if you get an error after that ExecShell command (ClearErrors, ExecShell, IfErrors...). Maybe it can't find iexpolrer.exe for whatever reason.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simham_uk</div><div class="date">16th February 2003, 02:28</div></div><div class="posttext">Originally posted by kichik <br />
You are right Sunjammer. There is absolutely no way this loop closed that window. My guess is that the window never even opened. Try and see if you get an error after that ExecShell command (ClearErrors, ExecShell, IfErrors...). Maybe it can't find iexpolrer.exe for whatever reason.  <br />
<br />
Thanks guys<br />
<br />
I'll give it a try in the morning (afternoon :-)  and see what happens...will let you know!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simham_uk</div><div class="date">16th February 2003, 15:28</div></div><div class="posttext">Originally posted by simham_uk <br />
Thanks guys<br />
<br />
I'll give it a try in the morning (afternoon :-)  and see what happens...will let you know! <br />
<br />
Just wondering...excuse my ignorance please if I'm talking rubbish, but since I have included the system DLL would it be possible to use this to open a window of IE?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th February 2003, 17:21</div></div><div class="posttext">AFAIK, there is no Windows API function that opens an Internet Explorer window. I bet there is some COM class you can use but I have no idea how to use those with System...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">16th February 2003, 18:10</div></div><div class="posttext">Well COM just involves calling CoCreateInstance and QueryInterface to get the object you want and then calling methods on it. I'm sure you can use the vtbl directly yourself to call them like you would C functions and so System might be able to do it that way. Not sure really.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simham_uk</div><div class="date">17th February 2003, 00:01</div></div><div class="posttext">Originally posted by Sunjammer <br />
Well COM just involves calling CoCreateInstance and QueryInterface to get the object you want and then calling methods on it. I'm sure you can use the vtbl directly yourself to call them like you would C functions and so System might be able to do it that way. Not sure really. <br />
<br />
It appeared to just be a stoooopid syntax thing...this works just fine:<br />
<br />
<br />
Function .onInstSuccess<br />
  ExecShell open &quot;iexplore.exe&quot; &quot;&quot; SW_SHOWNORMAL<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>