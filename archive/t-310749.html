<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Nested SectionGroup(s) - problem hiding Groups, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Nested SectionGroup(s) - problem hiding Groups NSIS Discussion" />
	
	<title> Nested SectionGroup(s) - problem hiding Groups [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Nested SectionGroup(s) - problem hiding Groups</div>
<hr />
<div class="pda"><a href="t-310749.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=310749">Nested SectionGroup(s) - problem hiding Groups</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">xbarns</div><div class="date">25th August 2009, 13:32</div></div><div class="posttext">Hello all,<br />
<br />
i have nested Section Groups as follows <br />
<br />
<br />
SectionGroup &quot;Features&quot; SEC_GRP_FEATURES<br />
  SectionGroup &quot;Contract Plus&quot; SEC_GRP_FEATURES_CONTRACT_PLUS<br />
      Section /o &quot;Building Contracts&quot; SEC_FEATURE_CONTRACT_PLUS_BUILDING_CONTRACTS<br />
    MessageBox MB_OK &quot;Building&quot; <br />
    SectionEnd<br />
      Section /o &quot;Vehicle Contracts&quot; SEC_FEATURE_CONTRACT_PLUS_VEHICLE_CONTRACTS 		<br />
    MessageBox MB_OK &quot;Vehicle&quot;<br />
    SectionEnd <br />
  SectionGroupEnd 	 	 	 	<br />
  SectionGroup &quot;Asset Plus&quot;  SEC_GRP_FEATURES_ASSET_PLUS<br />
    Section /o &quot;Depreciation&quot;  SEC_FEATURE_ASSET_PLUS_DEPRECIATION<br />
      MessageBox MB_OK &quot;Depreciation&quot;<br />
    SectionEnd<br />
  SectionGroupEnd<br />
SectionGroupEnd<br />
<br />
<br />
Now using a <br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE &quot;SetFeatures&quot;<br />
<br />
i try to disable some features depending on a given license key, the code is as follows <br />
<br />
<br />
Var /Global AmountFeatures<br />
	Var /Global AmountFeaturesAsset<br />
	Var /Global AmountFeaturesContract<br />
	<br />
	StrCpy $AmountFeatures 2 ;Maximum Amount of Groups in Folder Features <br />
	StrCpy $AmountFeaturesAsset 1 ;Maximum Amount of features contained in Group SEC_GRP_FEATURES_ASSET_PLUS<br />
	StrCpy $AmountFeaturesContract 2 ;Maximum Amount of features contained in Group SEC_GRP_FEATURES_CONTRACT_PLUS<br />
	<br />
	MessageBox MB_OK &quot;AmountFeatures: $AmountFeatures$\r$\nAmountFeaturesAsset: $AmountFeaturesAsset$\r$\nAmountFeaturesContract :$AmountFeaturesContract&quot;<br />
	<br />
	Var /Global Inst_AssetPlus<br />
	Var /Global Inst_ContractPlus<br />
	<br />
	ReadRegStr $Inst_AssetPlus HKLM &quot;${REGKEY}&quot; Inst_AssetPlus <br />
	ReadRegStr $Inst_ContractPlus HKLM &quot;${REGKEY}&quot; Inst_ContractPlus <br />
	<br />
	MessageBox MB_OK &quot;Inst_AssetPlus: $Inst_AssetPlus$\r$\nInst_ContractPlus: $Inst_ContractPlus&quot;<br />
	     ${If} $Inst_AssetPlus != 1<br />
		MessageBox MB_OK &quot;Remove Feature Asset Plus Depreciation&quot;<br />
		!insertmacro ClearSectionFlag ${SEC_FEATURE_ASSET_PLUS_DEPRECIATION} ${SF_SELECTED}<br />
		SectionSetText ${SEC_FEATURE_ASSET_PLUS_DEPRECIATION} &quot;&quot; <br />
		IntOp $AmountFeaturesAsset $AmountFeaturesAsset - 1<br />
	${EndIf}<br />
	<br />
	${If} $Inst_ContractPlus != 1<br />
	    MessageBox MB_OK &quot;Remove Features Contract Plus&quot;<br />
		!insertmacro ClearSectionFlag ${SEC_FEATURE_CONTRACT_PLUS_BUILDING_CONTRACTS} ${SF_SELECTED}<br />
		SectionSetText ${SEC_FEATURE_CONTRACT_PLUS_BUILDING_CONTRACTS} &quot;&quot; <br />
		!insertmacro ClearSectionFlag ${SEC_FEATURE_CONTRACT_PLUS_VEHICLE_CONTRACTS} ${SF_SELECTED}<br />
		SectionSetText ${SEC_FEATURE_CONTRACT_PLUS_VEHICLE_CONTRACTS} &quot;&quot; 	   <br />
		IntOp $AmountFeaturesContract $AmountFeaturesContract - 2		<br />
	${EndIf}<br />
	<br />
	<br />
	${If} $AmountFeaturesAsset = 0 <br />
		MessageBox MB_OK &quot;Remove Feature Group Asset Plus&quot;<br />
			!insertmacro ClearSectionFlag ${SEC_GRP_FEATURES_ASSET_PLUS} ${SF_SECGRP}<br />
			!insertmacro ClearSectionFlag ${SEC_GRP_FEATURES_ASSET_PLUS} ${SF_SECGRPEND} <br />
			!insertmacro ClearSectionFlag ${SEC_GRP_FEATURES_ASSET_PLUS} ${SF_SELECTED}<br />
			SectionSetText ${SEC_GRP_FEATURES_ASSET_PLUS} &quot;&quot; 	   <br />
		IntOp $AmountFeatures $AmountFeatures - 1<br />
	${EndIf}<br />
	<br />
	${If} $AmountFeaturesContract = 0 <br />
		MessageBox MB_OK &quot;Remove Feature Group Contract Plus&quot;<br />
			!insertmacro ClearSectionFlag ${SEC_GRP_FEATURES_CONTRACT_PLUS} ${SF_SECGRP}<br />
			!insertmacro ClearSectionFlag ${SEC_GRP_FEATURES_CONTRACT_PLUS} ${SF_SECGRPEND} <br />
			!insertmacro ClearSectionFlag ${SEC_GRP_FEATURES_CONTRACT_PLUS} ${SF_SELECTED}<br />
			SectionSetText ${SEC_GRP_FEATURES_CONTRACT_PLUS} &quot;&quot; <br />
		IntOp $AmountFeatures $AmountFeatures - 1<br />
	${EndIf}<br />
		<br />
	${If} $AmountFeatures = 0 <br />
		MessageBox MB_OK &quot;Remove Features Group&quot;<br />
		!insertmacro ClearSectionFlag ${SEC_GRP_FEATURES} ${SF_SECGRP}		<br />
		!insertmacro ClearSectionFlag ${SEC_GRP_FEATURES} ${SF_SECGRPEND} <br />
		!insertmacro ClearSectionFlag ${SEC_GRP_FEATURES} ${SF_SELECTED} <br />
		SectionSetText ${SEC_GRP_FEATURES} &quot;&quot; <br />
	${EndIf}<br />
<br />
<br />
Now if both &quot;Features&quot; are enabled it looks like this:<br />
<br />
http://www.bergens.org/Clip1.jpg<br />
<br />
If only the &quot;Contract&quot; Features are enabled it still looks fine.<br />
http://www.bergens.org/Clip2.jpg<br />
<br />
But if the Contract Features are disabled and the Asset Features are enabled it looks weird like this :(<br />
<br />
http://www.bergens.org/Clip3.jpg<br />
<br />
I am using NSIS Unicode 2.42-6.<br />
<br />
any help would be much appreciated.<br />
<br />
Thanks a lot.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">25th August 2009, 19:34</div></div><div class="posttext">Hi,<br />
<br />
I can reproduce your problem.<br />
It occures in the ANSI version of NSIS as well.<br />
<br />
I think it's a bug in NSIS, because if you swap the two sectiongroups (contract and asset), the contract sectiongroup hides correctly, but the asset sectiongroup doesn't.<br />
<br />
I don't know a workaround for this issue as well.<br />
Sorry I can't help you further.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xbarns</div><div class="date">25th August 2009, 22:57</div></div><div class="posttext">Thanks for reproducing, maybe someone else can shed light on this :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">26th August 2009, 00:22</div></div><div class="posttext">Ok, after reading this post:<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=224801<br />
I figured that the SectionGroupEnd needs the SF_SECGRPEND flag being cleared instead of the SectionGroup.<br />
<br />
This is a little tricky, as to get the SectionGroupEnd identifier, you need to add 1 to the section identifier of the previous section.<br />
<br />
You also need to make the SectionGroupEnd name &quot;&quot; as well (don't ask me why, but that works).<br />
<br />
So you can leave the SF_SECGRPEND clearing of the Sectiongroup, and add the following lines after SectionSetText ${SEC_GRP_XXX_XXX} &quot;&quot;:IntOp $0 ${SEC_FEATURE_XXX_XXX} + 1 ; previous section<br />
!insertmacro ClearSectionFlag $0 ${SF_SECGRPEND}<br />
SectionSetText $0 &quot;&quot;<br />
<br />
To make it clearer here is the complete working code:Var /Global AmountFeatures <br />
    Var /Global AmountFeaturesAsset <br />
    Var /Global AmountFeaturesContract <br />
     <br />
    StrCpy $AmountFeatures 2 ;Maximum Amount of Groups in Folder Features <br />
    StrCpy $AmountFeaturesAsset 1 ;Maximum Amount of features contained in Group SEC_GRP_FEATURES_ASSET_PLUS <br />
    StrCpy $AmountFeaturesContract 2 ;Maximum Amount of features contained in Group SEC_GRP_FEATURES_CONTRACT_PLUS <br />
     <br />
    MessageBox MB_OK &quot;AmountFeatures: $AmountFeatures$\r$\nAmountFeaturesAsset: $AmountFeaturesAsset$\r$\nAmountFeaturesContract :$AmountFeaturesContract&quot; <br />
     <br />
    Var /Global Inst_AssetPlus <br />
    Var /Global Inst_ContractPlus <br />
     <br />
    ReadRegStr $Inst_AssetPlus HKLM &quot;${REGKEY}&quot; Inst_AssetPlus <br />
    ReadRegStr $Inst_ContractPlus HKLM &quot;${REGKEY}&quot; Inst_ContractPlus <br />
     <br />
    MessageBox MB_OK &quot;Inst_AssetPlus: $Inst_AssetPlus$\r$\nInst_ContractPlus: $Inst_ContractPlus&quot; <br />
         ${If} $Inst_AssetPlus != 1 <br />
        MessageBox MB_OK &quot;Remove Feature Asset Plus Depreciation&quot; <br />
        !insertmacro ClearSectionFlag ${SEC_FEATURE_ASSET_PLUS_DEPRECIATION} ${SF_SELECTED} <br />
        SectionSetText ${SEC_FEATURE_ASSET_PLUS_DEPRECIATION} &quot;&quot; <br />
        IntOp $AmountFeaturesAsset $AmountFeaturesAsset - 1 <br />
    ${EndIf} <br />
     <br />
    ${If} $Inst_ContractPlus != 1 <br />
        MessageBox MB_OK &quot;Remove Features Contract Plus&quot; <br />
        !insertmacro ClearSectionFlag ${SEC_FEATURE_CONTRACT_PLUS_BUILDING_CONTRACTS} ${SF_SELECTED} <br />
        SectionSetText ${SEC_FEATURE_CONTRACT_PLUS_BUILDING_CONTRACTS} &quot;&quot; <br />
        !insertmacro ClearSectionFlag ${SEC_FEATURE_CONTRACT_PLUS_VEHICLE_CONTRACTS} ${SF_SELECTED} <br />
        SectionSetText ${SEC_FEATURE_CONTRACT_PLUS_VEHICLE_CONTRACTS} &quot;&quot;         <br />
        IntOp $AmountFeaturesContract $AmountFeaturesContract - 2         <br />
    ${EndIf}<br />
     <br />
    ${If} $AmountFeaturesAsset = 0 <br />
        MessageBox MB_OK &quot;Remove Feature Group Asset Plus&quot; <br />
            !insertmacro ClearSectionFlag ${SEC_GRP_FEATURES_ASSET_PLUS} ${SF_SECGRP} <br />
            ;!insertmacro ClearSectionFlag ${SEC_GRP_FEATURES_ASSET_PLUS} ${SF_SECGRPEND} <br />
            !insertmacro ClearSectionFlag ${SEC_GRP_FEATURES_ASSET_PLUS} ${SF_SELECTED} <br />
            SectionSetFlags ${SEC_GRP_FEATURES_ASSET_PLUS} 0<br />
            SectionSetText ${SEC_GRP_FEATURES_ASSET_PLUS} &quot;&quot;         <br />
            IntOp $0 ${SEC_FEATURE_ASSET_PLUS_DEPRECIATION} + 1 ; Add 1 to get the SEC_GRP_FEATURES_ASSET_PLUS SectionGroupEnd identifier<br />
            !insertmacro ClearSectionFlag $0 ${SF_SECGRPEND}<br />
            SectionSetText $0 &quot;&quot;<br />
        IntOp $AmountFeatures $AmountFeatures - 1 <br />
    ${EndIf} <br />
     <br />
    ${If} $AmountFeaturesContract = 0 <br />
        MessageBox MB_OK &quot;Remove Feature Group Contract Plus&quot; <br />
            !insertmacro ClearSectionFlag ${SEC_GRP_FEATURES_CONTRACT_PLUS} ${SF_SECGRP} <br />
            ;!insertmacro ClearSectionFlag ${SEC_GRP_FEATURES_CONTRACT_PLUS} ${SF_SECGRPEND} <br />
            !insertmacro ClearSectionFlag ${SEC_GRP_FEATURES_CONTRACT_PLUS} ${SF_SELECTED}<br />
            SectionSetFlags ${SEC_GRP_FEATURES_CONTRACT_PLUS} 0<br />
            SectionSetText ${SEC_GRP_FEATURES_CONTRACT_PLUS} &quot;&quot; <br />
            IntOp $0 ${SEC_FEATURE_CONTRACT_PLUS_VEHICLE_CONTRACTS} + 1 ; Add 1 to get the SEC_GRP_FEATURES_CONTRACT_PLUS SectionGroupEnd identifier<br />
            !insertmacro ClearSectionFlag $0 ${SF_SECGRPEND}<br />
            SectionSetText $0 &quot;&quot;<br />
        IntOp $AmountFeatures $AmountFeatures - 1 <br />
    ${EndIf} <br />
         <br />
    ${If} $AmountFeatures = 0 <br />
        MessageBox MB_OK &quot;Remove Features Group&quot; <br />
        !insertmacro ClearSectionFlag ${SEC_GRP_FEATURES} ${SF_SECGRP}         <br />
        ;!insertmacro ClearSectionFlag ${SEC_GRP_FEATURES} ${SF_SECGRPEND} <br />
        !insertmacro ClearSectionFlag ${SEC_GRP_FEATURES} ${SF_SELECTED} <br />
        SectionSetFlags ${SEC_GRP_FEATURES} 0<br />
        SectionSetText ${SEC_GRP_FEATURES} &quot;&quot; <br />
        IntOp $0 ${SEC_FEATURE_ASSET_PLUS_DEPRECIATION} + 2 ; Add 2 to get the SEC_GRP_FEATURES SectionGroupEnd identifier<br />
        !insertmacro ClearSectionFlag $0 ${SF_SECGRPEND}<br />
        SectionSetText $0 &quot;&quot;<br />
    ${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xbarns</div><div class="date">26th August 2009, 07:40</div></div><div class="posttext">Cool this works, Thanks a lot!!!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>