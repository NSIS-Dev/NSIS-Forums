<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Find the directory in registry to install to?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Find the directory in registry to install to? NSIS Discussion" />
	
	<title> Find the directory in registry to install to? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Find the directory in registry to install to?</div>
<hr />
<div class="pda"><a href="t-173167.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=173167">Find the directory in registry to install to?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">kukomamasan</div><div class="date">13th March 2004, 16:40</div></div><div class="posttext">Hi im an absolute new to make installers by scripting, what i would like to know is how do you make a section that tells to read i the registry for a location to install too. remember im new, i dont understand any scripting language :-( , though i can read hehe, so found out i need to use readregstr somewhere, how should the line look like, and how do i make the installdir to point to that directory? plz give me an example from the real life :-) , cant translate any of the var_set x+y and thing like that.<br />
would be great if you could even write the whole command on how to read from registry place HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\GhostRecon.exe  and under there is a string called path, thats where i would like to make NSIS look and somehow make the string to installdir.<br />
Hope anyone see my problem :-)<br />
Another little thing, how do you add a whole directory containing of several 1000 files and folders? im not gonna add them individualy lol, so far im repacking my stuff to zip and use zip2exe.<br />
thx in advance kuko.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">13th March 2004, 16:48</div></div><div class="posttext">the StripPath (http://nsis.sourceforge.net/archive/viewpage.php?pageid=321)  function should help you here</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kukomamasan</div><div class="date">13th March 2004, 16:54</div></div><div class="posttext">ty for the quick reply, but im new lol cant understand any of the thing that script do, cant even see where it would look for the uninstall reg entry to look for winamp, i need a step by step guide :-( sorry.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">atsuk</div><div class="date">13th March 2004, 17:23</div></div><div class="posttext">this reads directory from registry, and returns it inot variable $RegInstDir. later in sections you can use $RegInstDir just like $INSTDIR.<br />
<br />
<br />
Var RegInstDir<br />
Function .oninit<br />
 ReadRegStr $RegInstDir HKCU &quot;Software\MyProgram&quot; &quot;Directory&quot;<br />
FunctionEnd<br />
<br />
Section<br />
 SetOutPath $RegInstDir<br />
  File &quot;c:\\myfile.txt&quot;<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">13th March 2004, 17:27</div></div><div class="posttext">ah, i read something else. depending on the registry entry, either InstallDirRegKey (http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.1.21) or the above mentioned StripPath should bring you further. i recommend you check the example-scripts in the NSIS directory or in the archive (http://nsis.sourceforge.net/archive/nsisweb.php).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kukomamasan</div><div class="date">13th March 2004, 19:12</div></div><div class="posttext">ok thx for the answers, well i found something similar though required alot of testing, but i got it working somehow, looks like this<br />
<br />
Function .onInit<br />
Push $INSTDIR ;save compile-time value<br />
ReadRegStr $INSTDIR HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\GhostRecon.exe&quot; path<br />
 StrCmp $INSTDIR &quot;&quot; 0 +2<br />
Pop $INSTDIR ;return compile-time value<br />
FunctionEnd<br />
<br />
so thats the first part :-) i got it to show d:\ghost recon  , now i need to add \mods\ to the $instdir</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">13th March 2004, 19:22</div></div><div class="posttext">InstallDirRegKey does exactly the same thing.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kukomamasan</div><div class="date">13th March 2004, 19:42</div></div><div class="posttext">Amasing how simpel it can be done :-) jep InstallDirRegKey worked fine for this installer, thx, though i still need to find out how to add \mods\ to the install dir then?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">13th March 2004, 19:46</div></div><div class="posttext">Function .onInit<br />
  StrCpy $INSTDIR $INSTDIR\mods<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kukomamasan</div><div class="date">13th March 2004, 19:59</div></div><div class="posttext">Thx now im ready to make some installations :-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kukomamasan</div><div class="date">14th March 2004, 00:45</div></div><div class="posttext">oh wasent so easy at all :-( i got this so far : Name &quot;${PRODUCT_NAME}&quot;<br />
OutFile &quot;C:\Documents and Settings\admin\Skrivebord\SotoPlasterV4.exe&quot;<br />
InstallDir &quot;$PROGRAMFILES\Red Storm Entertaintment\Ghost Recon\Mods\SotoPlasterv4&quot;<br />
ShowInstDetails show<br />
ShowUnInstDetails show<br />
<br />
InstallDirRegKey HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\GhostRecon.exe&quot; path<br />
<br />
Function .onInit<br />
StrCpy $INSTDIR $INSTDIR\MODS\SotoPlasterV4<br />
FunctionEnd<br />
<br />
Section &quot;MainSection&quot; SEC01<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
  SetOverwrite ifnewer<br />
  File /r &quot;E:\Ghost Recon\mods\SOTOPlasterV4\*.*&quot;<br />
SectionEnd  problem is if there is no reference to the path in the registry, the path would look like this C:\Programmer\Red Storm Entertaintment\Ghost Recon\Mods\SotoPlasterv4\MODS\SotoPlasterV4   i guess i should add some check to see if it found a valid directory in the registry, what should that be?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">14th March 2004, 11:45</div></div><div class="posttext">That's because you have added<br />
<br />
InstallDir &quot;$PROGRAMFILES\Red Storm Entertaintment\Ghost<br />
<br />
If you remove that line $INSTDIR will be empty in .onInit if there is no valid path.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kukomamasan</div><div class="date">15th March 2004, 01:33</div></div><div class="posttext">Thx though i have found another solution, and its working, again somehow :-)<br />
<br />
Function .onInit<br />
ReadRegStr $R0 HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\GhostRecon.exe&quot; &quot;path&quot;<br />
StrCmp $R0 &quot;&quot; NotPresent Present<br />
<br />
notpresent:<br />
StrCpy $INSTDIR &quot;$programfiles\Red Storm Entertainment\Ghost Recon\Mods\SotoPlasterV4&quot;<br />
goto done<br />
<br />
present:<br />
strcpy $instdir $R0\mods\SotoPlasterV4<br />
done:<br />
functionend<br />
installdir \SotoPlasterV4<br />
Section &quot;MainSection&quot; SEC01<br />
    SetOutPath &quot;$INSTDIR&quot;<br />
  SetOverwrite ifnewer<br />
  File /r &quot;E:\Ghost Recon\mods\SOTOPlasterV4\*.*&quot;<br />
SectionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>