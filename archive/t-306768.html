<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Overriding default dir with /D, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Overriding default dir with /D NSIS Discussion" />
	
	<title> Overriding default dir with /D [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Overriding default dir with /D</div>
<hr />
<div class="pda"><a href="t-306768.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=306768">Overriding default dir with /D</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">abcdgoldfish</div><div class="date">26th May 2009, 19:40</div></div><div class="posttext">My installer detects if it is running on a Vista or XP machine by using WinVer.nsh.  Based on its results the installer installs code in one place or another.  Works like a charm.<br />
<br />
However, testers want to be able to install via the command line and use /D to override the installation directory.  This is not working.<br />
<br />
I am using this code:<br />
<br />
Function .onInit<br />
${If} ${AtLeastWinVista}<br />
  strcpy $INSTDIR &quot;C:\Users\Public\Public Documents\blah&quot;     <br />
${Else}<br />
  strcpy $INSTDIR &quot;C:\Program Files\blah&quot;<br />
${EndIf}<br />
FunctionEnd<br />
<br />
Is there a way to override this code on the command line?  If not then I will need a way to install via XP or Vista some other way.  I'd appreciate any ideas or insights.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">26th May 2009, 19:50</div></div><div class="posttext">I guess you could set installdir to something like &quot;$programfiles\{117CCC32-4A26-11DE-A88F-DCAB55D89593}&quot; and then see if its changed</div></div><hr />


<div class="post"><div class="posttop"><div class="username">abcdgoldfish</div><div class="date">26th May 2009, 21:15</div></div><div class="posttext">I don't understand.  The Vista installation should go under C:\Users\Public\Public Documents, not C:\Program Files.  Also, where does the GUID come from and what does it represent?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th May 2009, 21:35</div></div><div class="posttext">If you use GetParameters followed by GetOptions (with `/D=`) then you can detect /D usage on the command line and jump over you code.<br />
<br />
Edit: Ah sorry, /D will not show up in $CMDLINE!<br />
Here is another idea. If $INSTDIR is not set to InstallDir before your code then you know /D has been used (not tried this but worth a try).<br />
<br />
Edit #2: Or easier, if you don't use InstallDir at all then $INSTDIR will be empty unless /D has been used. This is assuming that /D is applied before .onInit is called (and so does the point in the first edit).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">26th May 2009, 22:18</div></div><div class="posttext">My idea was the same as Afrow, just in a more stupid way, forget about checking for empty when i rushed to answer on my way out the door</div></div><hr />


<div class="post"><div class="posttop"><div class="username">msroboto</div><div class="date">11th March 2010, 20:33</div></div><div class="posttext">I have tried everything in this post and I am stumped.<br />
<br />
On a machine that already has my software installed I cannot detect if /D was passed or not.<br />
<br />
$INSTDIR is set from the get go in that case.<br />
<br />
I am not using InstallDir.<br />
<br />
I tried setting InstallDir to something but it doesn't matter.<br />
<br />
Is there a pre .OnInit function that I am missing?<br />
Is there a way to know if /D was passed?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">12th March 2010, 12:31</div></div><div class="posttext">When you supply the /D option are you sure it is in the correct format, as described in the User Manual:<br />
<br />
&quot;It must be the last parameter used in the command line and must not contain any quotes, even if the path contains spaces. Only absolute paths are supported.&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">msroboto</div><div class="date">12th March 2010, 14:24</div></div><div class="posttext">Yes if /D= is sent I get the correct value but I am trying to determine if /D was actually sent in or if it is coming from somewhere else.<br />
<br />
If I am re-installing $INSTDIR is set and if /D is sent $INSTDIR will be set to whatever was passed.<br />
<br />
I can't determine the difference.<br />
<br />
I need to know if /D was passed on the command line.<br />
<br />
I'm ok with the values.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">12th March 2010, 14:43</div></div><div class="posttext">Sorry, I misunderstood your question.<br />
<br />
Have you tried Afrow UK's second idea:<br />
<br />
If you don't use InstallDir at all then $INSTDIR will be empty unless /D has been used.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">12th March 2010, 15:29</div></div><div class="posttext">Afrow UK's idea works for me:Name &quot;/D Demo&quot;<br />
OutFile slash-d.exe<br />
<br />
RequestExecutionLevel &quot;user&quot;<br />
<br />
ShowInstDetails show<br />
<br />
Section default<br />
  DetailPrint &quot;Command-line: $CMDLINE&quot;<br />
  DetailPrint &quot;&quot;<br />
  StrCmp $INSTDIR &quot;&quot; no_slash_d_supplied<br />
  DetailPrint &quot;/D=$INSTDIR&quot;<br />
  Goto exit<br />
  <br />
no_slash_d_supplied:<br />
  DetailPrint &quot;No /D supplied ($$INSTDIR='$INSTDIR')&quot;<br />
<br />
exit:<br />
  DetailPrint &quot;&quot;<br />
SectionEnd<br />
Test results:<br />
<br />
(1) command: slash-d.exeCommand-line: slash-d.exe<br />
<br />
No /D supplied ($INSTDIR='')<br />
<br />
Completed<br />
<br />
(2) command: slash-d.exe /D=C:\Program Files (x86)\Dummy\Install\PathCommand-line: slash-d.exe <br />
<br />
/D=C:\Program Files (x86)\Dummy\Install\Path<br />
<br />
Completed</div></div><hr />


<div class="post"><div class="posttop"><div class="username">msroboto</div><div class="date">15th March 2010, 17:07</div></div><div class="posttext">Run this script twice.<br />
The first time it works.<br />
<br />
The second time it will say that /D was supplied.<br />
<br />
I know that the detail prints won't work in the on init so I am using a messagebox.<br />
<br />
<br />
Sorry it took so long to get this little test together.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">msroboto</div><div class="date">15th March 2010, 17:12</div></div><div class="posttext">I see the issue now.<br />
<br />
InstallDirRegKey is the culprit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">msroboto</div><div class="date">15th March 2010, 18:19</div></div><div class="posttext">Sorry I fixed the test a bit and then couldn't attach again in the last post.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>