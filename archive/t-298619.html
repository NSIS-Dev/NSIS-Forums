<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS 2.40 LongStr Crashes!, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS 2.40 LongStr Crashes! NSIS Discussion" />
	
	<title> NSIS 2.40 LongStr Crashes! [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS 2.40 LongStr Crashes!</div>
<hr />
<div class="pda"><a href="t-298619.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=298619">NSIS 2.40 LongStr Crashes!</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">13th October 2008, 01:19</div></div><div class="posttext">When I try to compile my installer with the &quot;large strings&quot; edition of NSIS v2.40, then makensis.exe will crash reproducible! The very same script compiles just fine with the &quot;normal&quot; version of NSIS v2.40 as well as with the &quot;large strings&quot; edition of NSIS v2.38. Any ideas?<br />
<br />
http://img402.imageshack.us/img402/3157/makensiscrash2yj6.th.png (http://img402.imageshack.us/my.php?image=makensiscrash2yj6.png)http://img402.imageshack.us/images/thpix.gif (http://g.imageshack.us/thpix.php)<br />
<br />
<br />
Script available from SVN:<br />
http://opensvn.csie.org/viewcvs.cgi/MPlayer/Setup/?root=mulder1984</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">13th October 2008, 10:35</div></div><div class="posttext">could you narrow it down to a minimal script?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">13th October 2008, 13:02</div></div><div class="posttext">I could try to do so, but I got no idea where to start :(<br />
<br />
Any ideas?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">13th October 2008, 13:35</div></div><div class="posttext">remove half of the file instructions, check<br />
remove the other half, check<br />
remove the pages one by one while checking for crash</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">13th October 2008, 13:48</div></div><div class="posttext">Well, obviously it crashes near the beginning and while processing the MUI/UMUI header/defines, long before any file command is being processed...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">13th October 2008, 13:55</div></div><div class="posttext">Here is the output from a debugger, if that helps:<br />
<br />
<br />
Microsoft (R) Windows Debugger  Version 6.6.0003.5<br />
Copyright (c) Microsoft Corporation. All rights reserved.<br />
<br />
CommandLine: D:\NSIS\makensis.exe /DBuild_Number=35 /DCompile_Date=&quot;2008-10-13&quot; /DVersion_MPlayer=&quot;SVN-r27743 (2008-10-11)&quot; /DVersion_MPUI=&quot;v1.2-pre3 (Build 38)&quot; /DVersion_SMPlayer=&quot;v0.6.3 (SVN-r1997)&quot; /DVersion_Codecs=&quot;(2007-10-07)&quot; /DVersion_NSIS=&quot;v2.40&quot; /DPath_Out=&quot;D:\MPUI\upload\MPUI.2008-10-13.Build-35&quot; /DPath_Builds=&quot;D:\MPUI\builds&quot; Installer.nsi<br />
Starting directory: D:\MPUI<br />
Symbol search path is: *** Invalid ***<br />
****************************************************************************<br />
* Symbol loading may be unreliable without a symbol search path.           *<br />
* Use .symfix to have the debugger choose a symbol path.                   *<br />
* After setting your symbol path, use .reload to refresh symbol locations. *<br />
****************************************************************************<br />
Executable search path is: <br />
ModLoad: 00400000 00480000   image00400000<br />
ModLoad: 7d4c0000 7d5f0000   NOT_AN_IMAGE<br />
ModLoad: 7d600000 7d6f0000   C:\WINDOWS\SysWOW64\ntdll32.dll<br />
ModLoad: 7d4c0000 7d5f0000   C:\WINDOWS\syswow64\kernel32.dll<br />
ModLoad: 7d800000 7d890000   C:\WINDOWS\syswow64\GDI32.dll<br />
ModLoad: 7d930000 7da00000   C:\WINDOWS\syswow64\USER32.dll<br />
ModLoad: 00480000 0051b000   C:\WINDOWS\syswow64\ADVAPI32.dll<br />
ModLoad: 7da20000 7db00000   C:\WINDOWS\syswow64\RPCRT4.dll<br />
ModLoad: 7d8d0000 7d920000   C:\WINDOWS\syswow64\Secur32.dll<br />
ModLoad: 77b90000 77b98000   C:\WINDOWS\syswow64\VERSION.dll<br />
ModLoad: 77ba0000 77bfa000   C:\WINDOWS\syswow64\msvcrt.dll<br />
(121c.126c): Break instruction exception - code 80000003 (first chance)<br />
eax=77c00000 ebx=7efde000 ecx=00000003 edx=00000008 esi=7d6a01f4 edi=00211f38<br />
eip=7d61002d esp=0012fb4c ebp=0012fcac iopl=0         nv up ei pl nz na pe nc<br />
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00000202<br />
*** ERROR: Symbol file could not be found.  Defaulted to export symbols for C:\WINDOWS\SysWOW64\ntdll32.dll - <br />
ntdll32!DbgBreakPoint:<br />
7d61002d cc               int     3<br />
0:000&gt; g<br />
ModLoad: 7dee0000 7df40000   C:\WINDOWS\SysWOW64\IMM32.DLL<br />
ModLoad: 7dbc0000 7dbc9000   C:\WINDOWS\SysWOW64\LPK.DLL<br />
ModLoad: 75490000 754f5000   C:\WINDOWS\SysWOW64\USP10.dll<br />
(121c.126c): Stack overflow - code c00000fd (first chance)<br />
First chance exceptions are reported before any exception handling.<br />
This exception may be expected and handled.<br />
eax=00003000 ebx=0012da18 ecx=00032f1c edx=00000000 esi=0000009f edi=00050134<br />
eip=0044ef17 esp=00037f14 ebp=000500f0 iopl=0         nv up ei pl nz na po nc<br />
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010206<br />
*** WARNING: Unable to verify checksum for image00400000<br />
*** ERROR: Module load completed but symbols could not be loaded for image00400000<br />
image00400000+0x4ef17:<br />
0044ef17 8501             test    [ecx],eax         ds:002b:00032f1c=00000000<br />
0:000&gt; g<br />
(121c.126c): Stack overflow - code c00000fd (!!! second chance !!!)<br />
eax=00003000 ebx=0012da18 ecx=00032f1c edx=00000000 esi=0000009f edi=00050134<br />
eip=0044ef17 esp=00037f14 ebp=000500f0 iopl=0         nv up ei pl nz na po nc<br />
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010206<br />
image00400000+0x4ef17:<br />
0044ef17 8501             test    [ecx],eax         ds:002b:00032f1c=00000000<br />
0:000&gt; g<br />
(121c.126c): Access violation - code c0000005 (first chance)<br />
First chance exceptions are reported before any exception handling.<br />
This exception may be expected and handled.<br />
eax=00000000 ebx=0012da18 ecx=0012da18 edx=00000000 esi=0000009f edi=00050134<br />
eip=00000000 esp=0003af2c ebp=000500f0 iopl=0         nv up ei pl nz na pe nc<br />
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010202<br />
00000000 ??               ???</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">13th October 2008, 15:13</div></div><div class="posttext">Looks like this is the problem:<br />
<br />
(121c.126c): Stack overflow - code c00000fd (!!! second chance !!!)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">13th October 2008, 15:22</div></div><div class="posttext">kichik is away and will not be back until november, if you want me to take a look, you will have to narrow it down to a single line with the problem if possible (without UMUI and other 3rd party plugins)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">13th October 2008, 16:15</div></div><div class="posttext">I'm afraid I can't, because various &quot;simple&quot; installers I tried do work just fine.<br />
It seems the problem is only triggers with a &quot;complex&quot; installer...<br />
<br />
But even &quot;NSIS\examples\UltraModenUI\bigtest.nsi&quot; crashes! :cry: <br />
It crashed on &quot;!insertmacro: UMUI_PAGE_INFORMATION&quot;, while my installer crashed on &quot;!insertmacro: UMUI_PAGE_SETUPTYPE&quot;<br />
<br />
So there is not the &quot;one line that crashes&quot; :( <br />
<br />
The &quot;NSIS\examples\bigtest.nsi&quot; compiles just fine though :confused: <br />
<br />
Any more ideas?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">13th October 2008, 16:26</div></div><div class="posttext">UMUI bug maybe</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">13th October 2008, 16:42</div></div><div class="posttext">Well, there are only two possibilities:<br />
* UMUI generates a valid script and makensis.exe compiles that script<br />
* UMUI generates an invalid script and makensis.exe rejects that script<br />
<br />
But makensis.exe simply crashing without error messages definitely shouldn't happen, no matter how buggy the script is (which I'm pretty sure it is not). Also the very same script compiles fine with NSIS v2.38, with NSIS v2.38 &quot;Long Strings&quot; build and also with NSIS v2.40. This all sounds like an NSIS bug to me. And it might or might not be related to this (http://forums.winamp.com/showthread.php?s=&amp;threadid=291948) one, which still remains unresolved...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">13th October 2008, 16:53</div></div><div class="posttext">I don't feel link looking at UMUI and all of its junk, give me a stand alone .nsi that crashes and I might have a go at figuring out the problem</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">13th October 2008, 17:23</div></div><div class="posttext">Uff, here you go:<br />
http://www.mediafire.com/file/zzjtleyl5gt/CrashTest.nsi<br />
<br />
This .nsi crashed reproducible with NSIS v2.40 &quot;Long Stings&quot; and compiles fine with NSIS v2.38 &quot;Long Stings&quot; ;)<br />
<br />
(Note: The actual installer starts at line #10012)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">13th October 2008, 18:12</div></div><div class="posttext">you are not making this easy are you, thats just a big file that does not even compile, I want something without UMUI<br />
<br />
edit: If I add !include &quot;installoptions.nsh&quot; to the top of CrashTest.nsi, it does not crash</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">13th October 2008, 18:38</div></div><div class="posttext">The script &quot;as-is&quot; does compile just fine with NSIS v2.38 &quot;Long Stings&quot;, but it gives the same crash (reproducible!) as shown on my screenshot with NSIS v2.40 &quot;Long Stings&quot;. If I knew how to trigger the crash without UMUI, I'd post a shorter script. But I don't. Since it's a stack overflow, I guess it happens only with a lot of defines and macros. So it's perfectly possible that it cannot be reproduced with a &quot;minimalistic&quot; script...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">13th October 2008, 19:17</div></div><div class="posttext">as far as i can tell, the crash is @<br />
<br />
!macro UMUI_STR2INT VALUE<br />
  Push $0 ; The source  &lt;&lt;&lt; here<br />
....<br />
<br />
in alloca_probe (stack allocation stuff IIRC)<br />
<br />
edit:<br />
the call stack in debug build looks like:<br />
<br />
<br />
MAKENSIS! _alloca_probe + 23 bytes<br />
CEXEBuild::doParse(const char * 0x00c0c91a) line 543 + 19 bytes<br />
CEXEBuild::process_oneline(char * 0x00ac0a34, char * 0x0005dc24, int 1) line 854 + 17 bytes<br />
CEXEBuild::doCommand(int 80, LineParser &amp; {...}) line 1086 + 32 bytes<br />
CEXEBuild::doParse(const char * 0x00bf48d2) line 543 + 19 bytes<br />
CEXEBuild::process_oneline(char * 0x00ac14ee, char * 0x00076b00, int 10) line 854 + 17 bytes<br />
CEXEBuild::doCommand(int 80, LineParser &amp; {...}) line 1086 + 32 bytes<br />
CEXEBuild::doParse(const char * 0x00b9ff3c) line 543 + 19 bytes<br />
CEXEBuild::process_oneline(char * 0x00ac1aed, char * 0x0008f9dc, int 6) line 854 + 17 bytes<br />
CEXEBuild::doCommand(int 80, LineParser &amp; {...}) line 1086 + 32 bytes<br />
CEXEBuild::doParse(const char * 0x00bdc86a) line 543 + 19 bytes<br />
CEXEBuild::process_oneline(char * 0x00af3281, char * 0x000a88b8, int 10) line 854 + 17 bytes<br />
CEXEBuild::doCommand(int 80, LineParser &amp; {...}) line 1086 + 32 bytes<br />
CEXEBuild::doParse(const char * 0x00bcc83c) line 543 + 19 bytes<br />
CEXEBuild::process_oneline(char * 0x00af26c5, char * 0x000c1794, int 17) line 854 + 17 bytes<br />
CEXEBuild::doCommand(int 80, LineParser &amp; {...}) line 1086 + 32 bytes<br />
CEXEBuild::doParse(const char * 0x00b77ec2) line 543 + 19 bytes<br />
CEXEBuild::process_oneline(char * 0x00aec112, char * 0x000da670, int 5) line 854 + 17 bytes<br />
CEXEBuild::doCommand(int 80, LineParser &amp; {...}) line 1086 + 32 bytes<br />
CEXEBuild::doParse(const char * 0x00bb000a) line 543 + 19 bytes<br />
CEXEBuild::process_oneline(char * 0x00af24e8, char * 0x000f354c, int 2) line 854 + 17 bytes<br />
CEXEBuild::doCommand(int 80, LineParser &amp; {...}) line 1086 + 32 bytes<br />
CEXEBuild::doParse(const char * 0x00a7100c) line 543 + 19 bytes<br />
CEXEBuild::process_oneline(char * 0x00ad31f8, char * 0x0010c428, int 83) line 854 + 17 bytes<br />
CEXEBuild::doCommand(int 80, LineParser &amp; {...}) line 1086 + 32 bytes<br />
CEXEBuild::doParse(const char * 0x00b213ba) line 543 + 19 bytes<br />
CEXEBuild::process_oneline(char * 0x00ad26f0, char * 0x00125304, int 19) line 854 + 17 bytes<br />
CEXEBuild::doCommand(int 80, LineParser &amp; {...}) line 1086 + 32 bytes<br />
CEXEBuild::doParse(const char * 0x00a3a050) line 543 + 19 bytes<br />
CEXEBuild::parseScript() line 729 + 23 bytes<br />
CEXEBuild::process_script(_iobuf * 0x004c13d0, char * 0x0012da08) line 221 + 8 bytes<br />
main(int 2, char * * 0x00900cc0) line 509 + 25 bytes<br />
MAKENSIS! mainCRTStartup + 180 bytes<br />
KERNEL32! 7c816d4f<br />
<br />
<br />
for CrashTest.nsi. The recursion is not that deep, but it might still use a lot of local variables. Maybe putting more on the heap instead would help, anyways, kichik would have to take a look at it when he comes back. You should file a bug report on the project tracker so this does not get lost when it scrolls off the forum front page</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th October 2008, 19:31</div></div><div class="posttext">Did you extract the stubs?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">13th October 2008, 19:32</div></div><div class="posttext">Thanks you for looking into this, Anders.<br />
<br />
I'll file a bugreport...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">13th October 2008, 19:33</div></div><div class="posttext">Originally posted by Afrow UK <br />
Did you extract the stubs?<br />
<br />
Stu  <br />
<br />
I may be stupid, but not THAT stupid :D <br />
<br />
-&gt; Yes, I did extract/replace the stubs accordingly.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th November 2008, 22:06</div></div><div class="posttext">Did you submit a bug report?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">7th November 2008, 23:55</div></div><div class="posttext">Originally posted by kichik <br />
Did you submit a bug report?  <br />
No, but I did, its @ http://sourceforge.net/tracker/index.php?func=detail&amp;aid=2171240&amp;group_id=22049&amp;atid=373085</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">26th November 2008, 18:34</div></div><div class="posttext">Originally posted by Anders <br />
No, but I did, its @ http://sourceforge.net/tracker/index.php?func=detail&amp;aid=2171240&amp;group_id=22049&amp;atid=373085  <br />
<br />
<br />
MakeNSIS v2.41 still crashes with UMUI installer :( <br />
<br />
(&quot;Large strings&quot; build only, normal one seems to work okay)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">26th November 2008, 20:19</div></div><div class="posttext">the bug is still marked as open so no surprise there</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">22nd January 2009, 01:14</div></div><div class="posttext">Just to let you know: The &quot;Large strings&quot; build of NSIS v2.42 still crashes while compiling my UMUI installer :(<br />
<br />
The good news is: The new plugin system apparently didn't break my installer :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">22nd January 2009, 07:04</div></div><div class="posttext">Originally posted by Anders <br />
the bug is still marked as open so no surprise there</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ripper17</div><div class="date">1st June 2011, 09:06</div></div><div class="posttext">In my case, it helped to replace &quot;MUI_INSTALLOPTIONS_*&quot; (e.g. &quot;MUI_INSTALLTOPTIONS_READ&quot;) with &quot;INSTALLOPTIONS_*&quot; (e.g. INSTALLOPTIONS_READ).<br />
<br />
So simply drop the MUI_ prefix and don't forget to add InstallOptions.nsh to your includes.<br />
<br />
Hope that helps<br />
<br />
Martin</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>