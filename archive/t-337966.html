<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Install USB driver / .inf file - pnputil fails, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Install USB driver / .inf file - pnputil fails NSIS Discussion" />
	
	<title> Install USB driver / .inf file - pnputil fails [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Install USB driver / .inf file - pnputil fails</div>
<hr />
<div class="pda"><a href="t-337966.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=337966">Install USB driver / .inf file - pnputil fails</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Elmi</div><div class="date">22nd November 2011, 19:32</div></div><div class="posttext">Hi,<br />
<br />
I want to install an USB driver via its .inf file using NSIS. I found a Wiki-entry regarding this that recommended to use Microsofts pnputil to add the .inf file to the driver storage.<br />
<br />
Unfortunately pnputil fails, it cancels the operation with an error message &quot;Access denied&quot;. This is strange because I have administrator privileges.<br />
<br />
So what can I do - how can I pre-install a driver/.inf file so that it is used as soon as the related device is attached?<br />
<br />
Elmi</div></div><hr />


<div class="post"><div class="posttop"><div class="username">T.Slappy</div><div class="date">23rd November 2011, 08:36</div></div><div class="posttext">What version of Windows are you using?<br />
For W2k and XP use these plug-ins: http://nsis.sourceforge.net/Driver_installation_and_update and http://nsis.sourceforge.net/InstDrv_plug-in<br />
<br />
For Vista and later PnPUtil is better.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Elmi</div><div class="date">23rd November 2011, 11:36</div></div><div class="posttext">Hi,<br />
<br />
I'm using Win 7</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Elmi</div><div class="date">27th November 2011, 17:01</div></div><div class="posttext">Hi,<br />
<br />
I think I found the reason:<br />
<br />
when executing pnputil within NSIS using command &quot;Exec&quot; it is NOT executed with administrator privileges although I previously called &quot;RequestExecutionLevel admin&quot;.<br />
<br />
So how can I execute pnputil WITH admin privileges correctly?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">27th November 2011, 17:11</div></div><div class="posttext">Are you sure you have administrative access? Note that requestexecutionlevel admin is NOT sufficient to guarantee it - you need to use the userinfo plugin (in .onInit) to verify!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Elmi</div><div class="date">27th November 2011, 17:28</div></div><div class="posttext">I'm sure I don't have administrative access because pnputil fails. Therefore my question: how can I get administrative privileges for &quot;Exec&quot; calls?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Elmi</div><div class="date">27th November 2011, 18:12</div></div><div class="posttext">May be I have to be more detailled:<br />
<br />
When using &quot;pnputil&quot; manually I have to run a &quot;cmd.exe&quot; as administrator, elsewhere pnputil fails.<br />
<br />
So to execute pnputil out of a NSIS installer I currently execute it using &quot;Exec&quot;. But this does not seem to execute it within a &quot;cmd&quot; that has administrator privileges.<br />
<br />
So how can I &quot;Exec&quot; it correctly so that the underlying command line environment has the same privileges like a &quot;cmd.exe&quot; that is executed with administrator privileges?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">28th November 2011, 06:38</div></div><div class="posttext">If your installer isn't at admin level, the pnputil also will not be executed at admin level. To make sure the installer's child processes are admin, make sure the installer is admin. To do this, use the userinfo plugin.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Elmi</div><div class="date">20th December 2011, 11:07</div></div><div class="posttext">make sure the installer is admin. To do this, use the userinfo plugin.<br />
<br />
OK, it tells me I'm not Admin - how do I change that?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th December 2011, 12:09</div></div><div class="posttext">Simplest approach is to bring up a message box and tell the user they must run the installer as an administrator using Run As (and then exit). Another option is you could run the installer again using ExecShell with the runas verb. Last option I suppose is to use the UAC plug-in.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Elmi</div><div class="date">20th December 2011, 14:25</div></div><div class="posttext">Simplest approach is to bring up a message box and tell the user they must run the installer as an administrator using Run As (and then exit).<br />
<br />
OK, in this case we're back to my original problem: running the installer as Administrator DOES NOT cause pnputil to work properly since the command line that is spawned from such an installer seems not to inherit its privileges!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Theresias</div><div class="date">20th December 2011, 15:15</div></div><div class="posttext">Save yourself the trouble and use DPInst instead, we've wasted our time with several approaches and after having tried them &quot;all&quot; we went with DPInst. In fact at this point we are very glad to have used as it also allows easy un-installation of specific driver versions.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">T.Slappy</div><div class="date">21st December 2011, 09:13</div></div><div class="posttext">I can confirm Theresias words: PnPUtil is not working correctly in some cases.<br />
I made drivers installer some time ago and it was too difficult to find out why is PnPUtil causing troubles so I switched to DPInst.<br />
<br />
Use DPInst - there is simple example here: http://blogs.technet.com/b/svengruenitz/archive/2008/07/02/driver-installation-and-up*******made-easy-dpinst-exe.aspx<br />
Also all necessary files are there so you do not need to download whole SDK package.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>