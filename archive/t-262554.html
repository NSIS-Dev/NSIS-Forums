<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Detect Internet Connection's Speed?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Detect Internet Connection's Speed? NSIS Discussion" />
	
	<title> Detect Internet Connection's Speed? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Detect Internet Connection's Speed?</div>
<hr />
<div class="pda"><a href="t-262554.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=262554">Detect Internet Connection's Speed?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">27th December 2006, 18:46</div></div><div class="posttext">I've found a precious piece of code by kichik on this forum thread (http://forums.winamp.com/showthread.php?s=&amp;threadid=195301) and I use it to detect If target system is connected.<br />
I know that Inetc plugin (http://nsis.sourceforge.net/Inetc_plug-in) while downloading shows info about speed, remaining time etc.<br />
What I want is to show some exclusive info about the estimated download time with current connection just before the actual download process is going to start. Since I know a little about APIs, I only guess that it should be possible with system plugin, and I wonder if someone from the community has achieved such a thing.<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">27th December 2006, 19:02</div></div><div class="posttext">You can get connection type with InternetGetConnectedState http://forums.winamp.com/showthread.php?postid=1494691</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">27th December 2006, 20:16</div></div><div class="posttext">Originally posted by Takhir <br />
You can get connection type with InternetGetConnectedState http://forums.winamp.com/showthread.php?postid=1494691 <br />
Takhir thanks for the response! <br />
I tried it and it returns an empty string! I don't know why... <br />
I use kichik's function, the one I mentioned above, I have just replaced google with the actual server where I'm going to connect, and this is always successful. When I remove the network cable it detects no connection, when I set the cable back, successfully detects connection, when I block my pc with the firewall it detects no connection, and so on. I tested this function 100 times and always I'm getting true results.<br />
Anyway this is not the point. This has been achieved. As I mentioned, I'd like to show some exclusive info to the end user, so, the point is if there is a function that somehow detects the speed of the connection before Inetc starts downloading, and not if there is connection. :-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">28th December 2006, 09:40</div></div><div class="posttext">Just to keep you informed :)<br />
System::Call 'wininet.dll::InternetGetConnectedState(*i .r0, i 0) i.r1'<br />
MessageBox MB_OK &quot;$1 $0 Modem=1, LAN=2, Proxy=4, RAS=0x10, Offline=0x20 Configured=0x40&quot;shows 18 - LAN and INTERNET_RAS_INSTALLED.<br />
The only way to test performance is to download a file (silent). GetTickCount() returnes ms. Bigger file - higher precision, but more time for customer to press all buttons ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">28th December 2006, 11:09</div></div><div class="posttext">Great!<br />
The code that you've posted above works as it expected!<br />
In the envirenment that I'm currently running, it returns &quot;1 18&quot;. I guess is means Modem and LAN and INTERNET_RAS_INSTALLED.<br />
Perhaps you know what it returns when detects a single dial up modem?<br />
I'm asking this because I'm thinking that probably these info are enough. When a dial up modem is detected, I could inform users that depending on modem speed, the download would need aprox. &lt;time&gt;, when a Lan/dsl is detected, then there is not need for extra info, they will see the actual download speed  from Inetc.<br />
Thanks in advance!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">28th December 2006, 12:01</div></div><div class="posttext">No, function returns $1 and 1 means &quot;state is connected&quot; (MSDN). 18 is 0x12 that means presisely LAN + RAS. You should use 'and' to get modem bit: IntOp $0 $0 &amp; 1</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">28th December 2006, 13:43</div></div><div class="posttext">Takhir thanks a lot!<br />
Now I think I got it :-) I had to make various tests by enable/disable proxy, plug/unplug, etc, and use IntFmt to get it :-)<br />
Now what I have is the following, please could you confirm that I'm in the right direction?<br />
System::Call 'wininet.dll::InternetGetConnectedState(*i .r0, i 0) i.r1'<br />
Detailprint '$$1==$1 (connected state)'<br />
; When plugged at this point $1 = 1<br />
; When plugged+proxy at this point $1 = 1<br />
; When unplugged at this point $1 = 0<br />
<br />
Detailprint '$$0==$0 (connection)'<br />
; When plugged at this point $0 = 18<br />
; When plugged+proxy at this point $0 = 86<br />
; When unplugged at this point $0 = 16<br />
<br />
IntFmt $R1 &quot;0x%X&quot; &quot;$0&quot;<br />
Detailprint '$$R1==$R1 (connection in hex)'<br />
; When plugged at this point $R1 = 0x12<br />
; When plugged+proxy at this point $R1 = 0x56<br />
; When unplugged at this point $R1 = 0x10<br />
<br />
IntOp $R0 $0 &amp; 1<br />
Detailprint '$$R0==$R0 (modem bit)'<br />
; When plugged at this point $R0 = 0<br />
; When plugged+proxy at this point $R0 = 0<br />
; When unplugged at this point $R0 = 0<br />
Thanks in advance!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">29th December 2006, 09:26</div></div><div class="posttext">Well, I was running the above code several times and I think this is all what I need.<br />
With this code, I'm able to achieve my plan in a very single step.<br />
Checking var $1 would tell me that the target is connected, in combination with var $R0, I would capture if the connection is lan or a dial up modem.<br />
I guess the only thing I need further confirm is to find a pc with modem installed and check the accuracy of the code in that environment.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">31st December 2006, 13:59</div></div><div class="posttext">Well, the code works accurately on both environments LAN/Dial up modem :-)<br />
Thank you very much Takhir!<br />
<br />
Ð¡ ÐÐžÐ’Ð«Ðœ Ð“ÐžÐ”ÐžÐœ</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">31st December 2006, 14:46</div></div><div class="posttext">Thanks Major Dude ;)<br />
eftikhes to neon ethos (may be a bit early, Greece and Russia selebrate both January 1 and 14 :) )<br />
The only remaining question is default connection and how to use the fast one from Inetc ...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">31st December 2006, 15:16</div></div><div class="posttext">Yes... a newbie Major Dude :-)<br />
eftikhes to neon ethos (may be a bit early, Greece and Russia selebrate both January 1 and 14)<br />
This isn't so bad :-) It is only that we need 2 bottles of vodka when we're going to celebrate twice :-)<br />
<br />
<br />
The only remaining question is default connection and how to use the fast one from Inetc ...<br />
I really stuck on this, I can't figure it out.<br />
Though, I have to assume that a normal user who has both connections, would never use as default connection the dial up, normally, would use as default the fast one, leaving the dial up just for cases when the fast connection is disabled.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">31st December 2006, 18:25</div></div><div class="posttext">Though, I have to assume that a normal user who has both connections, would never use as default connection the dial up, normally, would use as default the fast one, leaving the dial up just for cases when the fast connection is disabled. <br />
This case might be better to check LAN bit in the code function returned ;) It gives you fastest interface. You can supose it is default. And to check modem bit otherwise.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">1st January 2007, 09:23</div></div><div class="posttext">This case might be better to check LAN bit in the code function returned  It gives you fastest interface. You can suppose it is default. And to check modem bit otherwise.<br />
Obviously this is the right way to go, hopefully I wouldn't meet the weird case when a dial up connection is defined as default/always dial. (Case Internet properties/connections &quot;always dial my default connection&quot; radiobutton is checked.)<br />
In both other cases &quot;never dial a connection&quot; radiobutton or &quot;dial whenever a network connection is not present&quot; radiobutton, the LAN bit is detected.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>