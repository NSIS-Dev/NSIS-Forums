<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to prevent files extraction from an Installer created with NSIS?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to prevent files extraction from an Installer created with NSIS? NSIS Discussion" />
	
	<title> How to prevent files extraction from an Installer created with NSIS? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to prevent files extraction from an Installer created with NSIS?</div>
<hr />
<div class="pda"><a href="t-335433.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=335433">How to prevent files extraction from an Installer created with NSIS?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">within</div><div class="date">30th September 2011, 15:43</div></div><div class="posttext">Hi there,<br />
<br />
I am pretty happy with NSIS, but i'd wish to avoid to extract the files directly from the Installer EXE. I've serched the Forums and the web without success.<br />
<br />
Is it possible to prevent files extraction? if YES, then how?<br />
If NO, then how can I simply encrypt my files inside the Installer EXE using some script lines within the *.nsi file, and WITOUT using a thrid-party software to run properly the Installer?<br />
<br />
Thanks in advance,<br />
within</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th September 2011, 16:27</div></div><div class="posttext">It is possible, but you have to rebuild NSIS. All NSIS instructions have an opcode and all you need to do is change the opcode of the File instruction so that e.g. 7-zip does not find any.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">T.Slappy</div><div class="date">2nd October 2011, 06:07</div></div><div class="posttext">Do not put files into setup.exe but at first put them into archive with password, then extract that archive $PLUGINDIR or $TEMP and unpack files into final destination.<br />
It may be slow to unpack huge archives but no special software/script is needed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">2nd October 2011, 07:41</div></div><div class="posttext">Do not put files into setup.exe but at first put them into archive with password, then extract that archive $PLUGINDIR or $TEMP and unpack files into final destination.<br />
This does NOT work. The password is stored in plaintext in the nsi script, and the nsi script can be extracted. Anything that is long enough to be a strong password will also be easy to find by someone looking through the code.<br />
<br />
I suppose you could try to put a lot of variable manipulations here and there, and pass those variables as the password parameter, but even then it's still relatively easy to replace the plugin / unrar.exe / 7za.exe by something that simply MessageBox's the parameters it was given. Voila instant password.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">2nd October 2011, 20:40</div></div><div class="posttext">...or just check the 7zip command line in process explorer...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd October 2011, 20:46</div></div><div class="posttext">You don't even need process explorer any more. You can see it in task manager on Windows 7 if you add the column.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">within</div><div class="date">3rd October 2011, 08:57</div></div><div class="posttext">Thanks to all of you for your comments and possible solutions.<br />
<br />
Password solution might be easy to do, but quite &quot;useless&quot; if I read your comments...<br />
Rebuild NSIS? not sure if it's a good idea...<br />
<br />
I've gathered some information from wiki, and the NSIS resources pages and it seems I can use the password way with encryption. Seems a plug-in is necessary for compress/decompress. The thing is: I'd like to avoid special requirements for the installer to be run properly. I mean, I just wish the installer can run without any third parties to be installed first. I admit the encryption docs I've read aren't clear for me...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd October 2011, 10:43</div></div><div class="posttext">What's wrong with rebuilding NSIS?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">3rd October 2011, 10:46</div></div><div class="posttext">wouldn't making the installer use bzip compression block 7zip accessing the installer without the need to rebuild NSIS itself? (i know that used to be the way to do what seems to be asked).<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd October 2011, 10:49</div></div><div class="posttext">Ah yes I forgot about that. It does work indeed. The only downside is the poorer compression.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">3rd October 2011, 12:43</div></div><div class="posttext">wouldn't making the installer use bzip compression block 7zip accessing the installer without the need to rebuild NSIS itself? (i know that used to be the way to do what seems to be asked).<br />
<br />
-daz<br />
<br />
iirc the latest 7-zip builds also extracts bzip compressed installers<br />
<br />
edit: it does, see screenshot</div></div><hr />


<div class="post"><div class="posttop"><div class="username">within</div><div class="date">3rd October 2011, 12:51</div></div><div class="posttext">What's wrong with rebuilding NSIS?<br />
<br />
Stu<br />
<br />
I am not aware of doing it. Furthermore, I am not sure what do do then...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">3rd October 2011, 12:53</div></div><div class="posttext">Yathosho: *shrugs* wasn't aware of that having changed and from a quick try that seems to be true.<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">3rd October 2011, 13:02</div></div><div class="posttext">btw, here's the original post (http://forums.winamp.com/showthread.php?t=245397) in which the extraction of files has been discussed<br />
<br />
Yathosho: *shrugs* wasn't aware of that having changed and from a quick try that seems to be true.<br />
<br />
happened with 9.x, presumably 9.16 (&quot;NSIS support was improved (http://7-zip.org/history.txt)&quot;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">within</div><div class="date">3rd October 2011, 13:19</div></div><div class="posttext">found this post, but can't figure out a solution... dumb me</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">3rd October 2011, 13:46</div></div><div class="posttext">it seems to me there's no secure way of protecting your files, but rebuilding NSIS comes closest. i think there are some valid points why it's ultimately pointless, but maybe you can describe your situation a bit better. what exactly are you trying to protect - and why?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">T.Slappy</div><div class="date">4th October 2011, 06:04</div></div><div class="posttext">What's wrong with rebuilding NSIS?<br />
<br />
Stu<br />
<br />
Regular people do not like compiling and building software before they want to use it :)<br />
This is Linux speciality.<br />
Also 99% NSIS users has no time/resources/knowledge to rebuild NSIS from sources!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">within</div><div class="date">4th October 2011, 09:45</div></div><div class="posttext">it seems to me there's no secure way of protecting your files, but rebuilding NSIS comes closest. i think there are some valid points why it's ultimately pointless, but maybe you can describe your situation a bit better. what exactly are you trying to protect - and why?<br />
<br />
There are 2 reasons to limit file extracttion:<br />
- first, we do provide a kind of license, that just says &quot;you are aware of what you do... bla bla bla... and only you can use this software... bla bla bla&quot;. This softare is not ment to be widely spread, but only given to dedicated people according to a contract they have to sign. Thus, the license is here to remind them. If extraction is possible, it means the software can be available to everyone, even if they didn't sign the contract before and without agreement. <br />
- we also provide the software and some sources. we don't wish this sources to be available without the above agreement and the ability to be given to third parties.<br />
<br />
<br />
I believe compressing and encrypt the file and then package it into the installer is maybe the best solution. I just need to find out how!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">4th October 2011, 13:28</div></div><div class="posttext">you will have to encrypt your file with a 3rd party app. nsis can deal with several encryption algorithms, but i haven't found a way to decrypt a file without relying on a 3rd party tool (which, as mentioned, can easily be intercepted). so the passing of the password is the real weak spot.<br />
<br />
if the files don't exceed the strlen, i guess you could read the file into the buffer and let one of the plugins decrypt it there.<br />
<br />
http://nsis.sourceforge.net/NsisCrypt_plug-in<br />
http://nsis.sourceforge.net/Blowfish_plug-in<br />
<br />
i'm not an expert on encryption/decryption, there might still be a weak spot. i'm sure there are commercial solutions to deal with that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">4th October 2011, 13:32</div></div><div class="posttext">i'm wondering... suppose the 7-zip plugin for nsis would support commandline instructions (such as passing a password), could that password be intercepted as it can be done when using 7za.exe? can this password be extracted when using that old 7-zip 4.40 beta which could extract (portions of) the .nsi file?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">within</div><div class="date">4th October 2011, 14:13</div></div><div class="posttext">Interesting comments Yathosho. I may have to rethink some things...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">4th October 2011, 14:46</div></div><div class="posttext">i'm wondering... suppose the 7-zip plugin for nsis would support commandline instructions (such as passing a password), could that password be intercepted as it can be done when using 7za.exe? can this password be extracted when using that old 7-zip 4.40 beta which could extract (portions of) the .nsi file?<br />
Any string is visible, as far as I know. But like I said before, you can simply replace the plugin dll, and still get the password that way.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">within</div><div class="date">6th October 2011, 07:41</div></div><div class="posttext">Thanks to all of you for comments and remarks. Interesting subject, but we'd deceided to drop down this idea. We'd rather seperate the Installer into 2: one for application itself, and one for sources (SDK) on the other side.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brizz</div><div class="date">3rd January 2012, 02:11</div></div><div class="posttext">I have searched all over--and asked on other forums.<br />
<br />
...This thread is what shows up in Google--and I imagine there are others that also want this..<br />
<br />
I'm willing to edit source--and compile. ...not complete newb--but def can't sit down and code stuff from scratch.<br />
<br />
I want to prevent NSIS executables from being able to be extracted (at least prevent it from being done simply...).<br />
<br />
If someone knows--can you please point me to where I would find this in the source..and what exactly I would need to modify. ...would be VERY much appreciated..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">4th January 2012, 17:30</div></div><div class="posttext">You need to modify exehead\fileform.h. Insert a dummy enum value name just before EW_EXTRACTFILE (this ensures File gets a new opcode). E.g.EW_WHYDIDNTITHINKOFTHISDOH,<br />
EW_EXTRACTFILE,Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">isawen</div><div class="date">18th June 2012, 19:15</div></div><div class="posttext">You need to modify exehead\fileform.h. Insert a dummy enum value name just before EW_EXTRACTFILE (this ensures File gets a new opcode). E.g.EW_WHYDIDNTITHINKOFTHISDOH,<br />
EW_EXTRACTFILE,Stu<br />
<br />
Hi Afrow,<br />
<br />
If this idea is good, why NSIS is not released with the opcode changed?<br />
Compiling it is just to an easy task for me.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th June 2012, 21:08</div></div><div class="posttext">Because then 7-zip could be modified to decompile installers using the new opcode which would defeat the purpose.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">isawen</div><div class="date">19th June 2012, 00:19</div></div><div class="posttext">Because then 7-zip could be modified to decompile installers using the new opcode which would defeat the purpose.<br />
<br />
Stu<br />
<br />
Hard stuff compiling the NSIS even with the metioned prerequisites. I give up trying to compile it.:cry:</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>