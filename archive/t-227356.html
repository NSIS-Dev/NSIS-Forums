<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" FindNext Does Not Work - Why?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  FindNext Does Not Work - Why? NSIS Discussion" />
	
	<title> FindNext Does Not Work - Why? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  FindNext Does Not Work - Why?</div>
<hr />
<div class="pda"><a href="t-227356.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=227356">FindNext Does Not Work - Why?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">fperez</div><div class="date">30th September 2005, 22:04</div></div><div class="posttext">Hello,<br />
<br />
The &quot;findNext&quot; function does not seem to work. It's as if every time it gets executed the Uninstaller just stops executing.<br />
<br />
Below is the code:<br />
FindFirst $0 $1 $INSTDIR\server\webapps\*.xml<br />
  FindContextsLoop:<br />
    StrCmp $1 &quot;&quot; FindContextsLoopDone<br />
    ${UnStrRep} $R0 &quot;$1&quot; &quot;.xml&quot; &quot;&quot;<br />
    MessageBox MB_OK &quot;About to Delete Virtual Directory: $R0&quot;<br />
    !insertmacro DELETE_VIRTUAL_DIRECTORY $R0<br />
    MessageBox MB_OK &quot;Just deleted Virtual Directory: $R0&quot;<br />
    MessageBox MB_OK &quot;Dollar Zero = $0&quot;<br />
    MessageBox MB_OK &quot;Dollar One = $1&quot;<br />
    FindNext $0 $1<br />
    IfErrors 0 FindContextsLoop<br />
  FindContextsLoopDone:<br />
  FindClose $0<br />
<br />
Please help me. <br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th September 2005, 23:01</div></div><div class="posttext">You must clear the error flag before you use the instruction you wish to test for using IfErrors. The error flag might be set by anything executed before FindNext. You'll therefore test everything above it, not only FindNext itself.ClearErrors<br />
FindNext $0 $1<br />
IfErrors 0 FindContextsLoop</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fperez</div><div class="date">3rd October 2005, 14:23</div></div><div class="posttext">I tried the above in inside my UnInstaller code. Adding the &quot;ClearErrors&quot; instruction before executing &quot;FindNext&quot; still did not cause the program to work. When the UnIninstaller tries to execute &quot;FindNext&quot; it simply stops executing.<br />
<br />
Below is the code:<br />
StrCpy $0 &quot;&quot;<br />
  StrCpy $1 &quot;&quot;<br />
  StrCpy $R0 &quot;&quot;<br />
  FindFirst $0 $1 $INSTDIR\server\webapps\*.xml<br />
  FindContextsLoop:<br />
    StrCmp $1 &quot;&quot; FindContextsLoopDone<br />
    ${UnStrRep} $R0 &quot;$1&quot; &quot;.xml&quot; &quot;&quot;<br />
    MessageBox MB_OK &quot;About to Delete Virtual Directory: $R0&quot;<br />
    !insertmacro DELETE_VIRTUAL_DIRECTORY $R0<br />
    MessageBox MB_OK &quot;Just deleted Virtual Directory: $R0&quot;<br />
    MessageBox MB_OK &quot;Dollar Zero = $0&quot;<br />
    MessageBox MB_OK &quot;Dollar One = $1&quot;<br />
    ClearErrors<br />
    MessageBox MB_OK &quot;Just completed ClearErrors instruction.&quot;<br />
    MessageBox MB_OK &quot;About to execute FindNext instruction.&quot;<br />
    FindNext $0 $1<br />
    MessageBox MB_OK &quot;Just completed FindNext instruction.&quot;<br />
    IfErrors 0 FindContextsLoop<br />
  FindContextsLoopDone:<br />
  FindClose $0<br />
<br />
Please help me.<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd October 2005, 14:34</div></div><div class="posttext">What exactly do you mean by &quot;stops executing&quot;? Does no message box show up after &quot;About to execute FindNext instruction&quot;? What does happen, if it doesn't show?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">3rd October 2005, 14:37</div></div><div class="posttext">Maybe some problem with handle, try to comment out:<br />
# ${UnStrRep} $R0 &quot;$1&quot; &quot;.xml&quot; &quot;&quot;<br />
# !insertmacro DELETE_VIRTUAL_DIRECTORY $R0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fperez</div><div class="date">3rd October 2005, 14:43</div></div><div class="posttext">&gt;What exactly do you mean by &quot;stops executing&quot;? Does no &gt;message box show up after &quot;About to execute FindNext &gt;instruction&quot;? What does happen, if it doesn't show?<br />
<br />
That's exactly what I mean. The next message box that should appear is the one stating &quot;Just completed FindNext instruction.&quot; Then, the UnInstaller simply stops executing.<br />
<br />
Any answers why?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd October 2005, 14:48</div></div><div class="posttext">I believe Instructor is right. DELETE_VIRTUAL_DIRECTORY must have changed $0 and/or $1.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fperez</div><div class="date">3rd October 2005, 15:03</div></div><div class="posttext">Hi. I fixed the problem by not using $0 and $1. Instead I used global variables I defined myself.<br />
<br />
Below is the code that works:<br />
StrCpy $R0 &quot;&quot;<br />
  var /GLOBAL FileHandle<br />
  var /GLOBAL FileName<br />
  StrCpy $FileHandle &quot;&quot;<br />
  StrCpy $FileName &quot;&quot;<br />
  FindFirst $FileHandle $FileName $INSTDIR\server\webapps\*.xml<br />
  FindContextsLoop:<br />
    StrCmp $FileName &quot;&quot; FindContextsLoopDone<br />
    ${UnStrRep} $R0 &quot;$FileName&quot; &quot;.xml&quot; &quot;&quot;<br />
    MessageBox MB_OK &quot;About to Delete Virtual Directory: $R0&quot;<br />
    !insertmacro DELETE_VIRTUAL_DIRECTORY $R0<br />
    MessageBox MB_OK &quot;Just deleted Virtual Directory: $R0&quot;<br />
    MessageBox MB_OK &quot;FileHandle = $FileHandle&quot;<br />
    MessageBox MB_OK &quot;FileName = $FileName&quot;<br />
    ClearErrors<br />
    MessageBox MB_OK &quot;Just completed ClearErrors instruction.&quot;<br />
    MessageBox MB_OK &quot;About to execute FindNext instruction.&quot;<br />
    FindNext $FileHandle $FileName<br />
    MessageBox MB_OK &quot;Just completed FindNext instruction.&quot;<br />
    IfErrors 0 FindContextsLoop<br />
  FindContextsLoopDone:<br />
  FindClose $FileHandle<br />
<br />
Thanks for your help.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>