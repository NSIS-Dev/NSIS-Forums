<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" SelectSection Circular Reference problem, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  SelectSection Circular Reference problem NSIS Discussion" />
	
	<title> SelectSection Circular Reference problem [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  SelectSection Circular Reference problem</div>
<hr />
<div class="pda"><a href="t-260619.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=260619">SelectSection Circular Reference problem</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">ogden_ogly</div><div class="date">28th November 2006, 20:37</div></div><div class="posttext">Hi, my installer is structured such that:<br />
<br />
1. Prerequisites are checked<br />
2. Needed prerequisites are Downloaded<br />
3. Needed prerequisites are Installed<br />
4. Installation of my application.<br />
<br />
However, the problem I'm having is this:<br />
<br />
I have written various macros to detect these prerequisites, and in these macros I use the SelectSection macros.  The *PROBLEM* is that, because my sections appear later in the code, the SelectSection macros give me this error:<br />
<br />
  unknown variable/constant &quot;{MUI_LANGDLL_PUSHLIST}&quot; detected, ignoring (macro:MUI_LANGDLL_DISPLAY:24)<br />
  unknown variable/constant &quot;{sec_i_MSI}&quot; detected, ignoring (macro:UnSelectSection:3)<br />
  unknown variable/constant &quot;{sec_i_MSI}&quot; detected, ignoring (macro:UnSelectSection:5)<br />
  unknown variable/constant &quot;{sec_i_MSI}&quot; detected, ignoring (macro:SelectSection:3)<br />
  unknown variable/constant &quot;{sec_i_MSI}&quot; detected, ignoring (macro:SelectSection:5)<br />
<br />
How can I circumvent this error?  I feel like I'm missing something fairly obvious.<br />
<br />
Thanks,<br />
Ogden<br />
<br />
<br />
FYI my script looks like this...<br />
<br />
...preambles and such<br />
<br />
Section &quot;-Windows Installer Check&quot;<br />
	!insertmacro CheckWindowsInstaller <br />
          (which contains calls like <br />
           !insertmacro UnSelectSection ${sec_i_MSI})<br />
SectionEnd<br />
<br />
...<br />
;Dialogs and whatnot<br />
...<br />
<br />
Section &quot;Windows Installer 3.1&quot; sec_i_MSI<br />
        SectionIn RO<br />
        DetailPrint &quot;MSI 3.1&quot;<br />
SectionEnd<br />
<br />
...rest of the installation</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n_baua</div><div class="date">29th November 2006, 10:04</div></div><div class="posttext">hi ogden_ogly,<br />
<br />
you may have to do following things<br />
1. write to registry if the macro1, macro2, etc are passed without any error code<br />
2. read this status entry(ies) from registry and <br />
3. use logiclib.nsh<br />
to form code as below<br />
<br />
ReadRegStr $0 HKLM &quot;Software\MySoft\Macro1&quot; &quot;Installed&quot;<br />
${If} $0 = &quot;1&quot; ;$0 is satus for macro1 read from registry.<br />
!insertmacro CheckWindowsInstaller <br />
${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">29th November 2006, 10:48</div></div><div class="posttext">You can use the values of the section indexes only after the Section mySection SEC000 declaration, not before.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ogden_ogly</div><div class="date">30th November 2006, 18:47</div></div><div class="posttext">bholliger:<br />
<br />
Thanks for the reply.  I tried adding:<br />
<br />
Section NoCode SEC000<br />
push $0<br />
pop $0<br />
sectionend<br />
<br />
To the top of the script, it didn't seem to help resolve anything.  Any thoughts?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th November 2006, 19:03</div></div><div class="posttext">Simply put the code of the first section in a function and call that function from the section. Put that function after the definition of the second section and you're set.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ogden_ogly</div><div class="date">30th November 2006, 19:03</div></div><div class="posttext">n_baua: <br />
<br />
While this is certainly possible, I don't think its a real solution.  There *HAS* to be a way to set a section on or off *before* you've reached it?  Otherwise would be madness.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n_baua</div><div class="date">1st December 2006, 01:35</div></div><div class="posttext">Hi ogden_ogly,<br />
<br />
Yes, you are correct, but I also had faught on this for a long time, didn't had much time to research at that time, so adopted the registry logic. It works fine for me.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">1st December 2006, 03:50</div></div><div class="posttext">The reason why this has to be done this way is that the compiler creates defines for each section index.<br />
And you can't use a define before it has been created.<br />
<br />
Have a look at NSIS Manual, Chapter 4, 4.6.1.2 Section.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ogden_ogly</div><div class="date">1st December 2006, 18:22</div></div><div class="posttext">Looks like it's time for a 2-pass compiler :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">2nd December 2006, 03:51</div></div><div class="posttext">Hi!<br />
<br />
I think a solution would be to scan the source file and create the defines on top of the file.<br />
<br />
1. Save createsectiondefines.nsi to the folder and compile it.<br />
2. Save this<br />
<br />
!macro SECTIONDEFCREATOR FILE<br />
  !system &quot;createsectiondefines.exe /file ${FILE}&quot;<br />
  !include sectiondefs.nsh<br />
!macroend<br />
<br />
 to the file sectiondefcreator.nsh to the folder<br />
3. Put this in the project<br />
!include sectiondefcreator.nsh<br />
!insertmacro SECTIONDEFCREATOR ${__FILE__}<br />
<br />
<br />
This creates a file sectiondefs.nsh that is included into the project with the definitions for every section. Due to the fact that the sections are simply counted from 0 to (SECTIONCOUNT-1) this should work.<br />
<br />
A sample:<br />
<br />
Section &quot;My Section&quot; SEC01<br />
<br />
Creates a definition named CC_SEC01 that can be used before the sections compilation.<br />
<br />
Well, it's just an idea. What do you think?<br />
<br />
Cheers<br />
<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ogden_ogly</div><div class="date">5th December 2006, 00:30</div></div><div class="posttext">bholliger<br />
<br />
This seems to work quite well!  I think I owe you a beer :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>