<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Not allow users to change app directory, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Not allow users to change app directory NSIS Discussion" />
	
	<title> Not allow users to change app directory [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Not allow users to change app directory</div>
<hr />
<div class="pda"><a href="t-261229.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=261229">Not allow users to change app directory</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Boyito</div><div class="date">6th December 2006, 21:08</div></div><div class="posttext">HI its me again<br />
Following the suggestions of this forum I ask for a new problem<br />
I dont want to allow user to select the directory of the application and I need now to create 2 different directories depending on the options that are selected, until everything what I saw in the samples uses<br />
 SetOutPath $INSTDIR\MyApp<br />
How I make to create for example \MyApp and \MyApp2 ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th December 2006, 22:00</div></div><div class="posttext">Use LogicLib.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">6th December 2006, 22:20</div></div><div class="posttext">Examine this test:<br />
outfile 'Components_test.exe'<br />
InstallDir '$PROGRAMFILES\Components Test'<br />
<br />
!include 'mui.nsh'<br />
<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
# no dir page<br />
#!insertmacro MUI_PAGE_DIRECTORY<br />
!insertmacro MUI_PAGE_INSTFILES<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
section &quot;!Required Section&quot;<br />
  SectionIn RO<br />
   SetOutPath '$INSTDIR'<br />
SectionEnd<br />
<br />
Section &quot;Components 1&quot;<br />
   SetOutPath '$INSTDIR\Component 1'<br />
SectionEnd<br />
<br />
Section /o &quot;Components 2&quot;<br />
   SetOutPath '$INSTDIR\Component 2'<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Boyito</div><div class="date">7th December 2006, 14:06</div></div><div class="posttext">Thanks Red Wine<br />
But now my answer is, exist a way to create directories under the ROOT of the Disc and not under $PROGRAMFILES??<br />
<br />
TIA</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">7th December 2006, 16:03</div></div><div class="posttext">Here is an example on how to create installation directories on the drive where windows are installed  :-)<br />
E.g. if it is D:\WINDOWS the installation is going to D:\My Test etc.<br />
!define DEFAULT_DIR 'My Test'<br />
<br />
outfile 'test.exe'<br />
showinstdetails show<br />
InstallDir '$PROGRAMFILES\${DEFAULT_DIR}'<br />
<br />
page license<br />
page directory dir_pre<br />
page instfiles <br />
<br />
function dir_pre<br />
   strcpy '$R0' '$WINDIR' 3<br />
   strcpy '$INSTDIR' '$R0${DEFAULT_DIR}'<br />
functionend<br />
<br />
section -<br />
<br />
  Setoutpath '$INSTDIR'<br />
<br />
   Setoutpath '$INSTDIR\MyAPP'<br />
<br />
    Setoutpath '$INSTDIR\My App More'<br />
<br />
sectionend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Boyito</div><div class="date">7th December 2006, 17:40</div></div><div class="posttext">Thank You RW, this solve my problem<br />
<br />
Bye</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Boyito</div><div class="date">7th December 2006, 18:06</div></div><div class="posttext">RW<br />
Sorry its me again<br />
<br />
When i compile trying to use your tip, shows me an error<br />
<br />
This is a part of code :<br />
<br />
--------------------------------------------<br />
!define DEFAULT_DIR 'MyApp'<br />
<br />
!include &quot;MUI.nsh&quot;<br />
<br />
!insertmacro MUI_PAGE_WELCOME<br />
!insertmacro MUI_PAGE_LICENSE $(MUILicense)<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
!insertmacro MUI_PAGE_DIRECTORY dir_pre<br />
--------------------------------------<br />
<br />
And the error<br />
<br />
!insertmacro: macro &quot;MUI_PAGE_DIRECTORY&quot; requires 0 parameter(s), passed 1!<br />
Error in script &quot;IpReader.nsi&quot; on line 58 -- aborting creation process<br />
<br />
--------------------------------------------<br />
<br />
Whats wrong?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">7th December 2006, 19:20</div></div><div class="posttext">The example above is about classic UI. For MUI here it is:<br />
!define DEFAULT_DIR 'My Test'<br />
<br />
outfile 'test.exe'<br />
showinstdetails show<br />
InstallDir '$PROGRAMFILES\${DEFAULT_DIR}'<br />
<br />
!include 'mui.nsh'<br />
<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE dir_pre<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE verify_default_dir<br />
!insertmacro MUI_PAGE_INSTFILES<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
function dir_pre<br />
  strcpy '$R0' '$WINDIR' 3<br />
  strcpy '$INSTDIR' '$R0${DEFAULT_DIR}'<br />
functionend<br />
<br />
section - &quot;a hidden section&quot;<br />
  Setoutpath '$INSTDIR'<br />
sectionend<br />
<br />
section /o &quot;Section MyApp&quot;<br />
  Setoutpath '$INSTDIR\MyAPP'<br />
sectionend<br />
<br />
section /o &quot;Section My App More&quot;<br />
  Setoutpath '$INSTDIR\My App More'<br />
sectionend<br />
<br />
function verify_default_dir<br />
  strcpy '$R0' '$WINDIR' 3<br />
  strcmp '$R0${DEFAULT_DIR}' '$INSTDIR' +3 +1<br />
  strcpy '$INSTDIR' '$R0${DEFAULT_DIR}'<br />
  messagebox mb_ok 'reseting output directory to $R0${DEFAULT_DIR}'<br />
functionend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Boyito</div><div class="date">7th December 2006, 19:26</div></div><div class="posttext">Ups, sorry<br />
Thanks i try with this one</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Boyito</div><div class="date">7th December 2006, 20:03</div></div><div class="posttext">Hi RW<br />
I try and doesnt work in the way I need.<br />
It generates a C:\My Test\MyApp directory to me and a C:\My Test\MYapp\My App More<br />
In addition never shows the message to me of messagebox mb_ok â€œreseting output directory to $R0$ {DEFAULT_DIR}â€<br />
I need to create C:\My App and C:\My App More<br />
<br />
Any idea ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">7th December 2006, 20:22</div></div><div class="posttext">1. you'll see the message if you attempt to change the default dir, remove it, probably you don't need that.<br />
2. feel free to modify the skeleton script to suit your needs. add/remove sections, change dirs etc.<br />
EXAMPLE:<br />
outfile 'test.exe'<br />
showinstdetails show<br />
AllowRootDirInstall true<br />
<br />
!include 'mui.nsh'<br />
<br />
!insertmacro MUI_PAGE_WELCOME<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE dir_pre<br />
; no dir page<br />
; !insertmacro MUI_PAGE_DIRECTORY<br />
!insertmacro MUI_PAGE_INSTFILES<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
function dir_pre<br />
  strcpy '$R0' '$WINDIR' 3<br />
  strcpy '$INSTDIR' '$R0'<br />
functionend<br />
<br />
section - &quot;Section MyApp&quot;<br />
  Setoutpath '$INSTDIR\MyAPP'<br />
sectionend<br />
<br />
section - &quot;Section My App More&quot;<br />
  Setoutpath '$INSTDIR\My App More'<br />
sectionend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Boyito</div><div class="date">7th December 2006, 20:44</div></div><div class="posttext">Thanks RW<br />
It Works as i need<br />
Thank you very much<br />
Now I have another problems, but I am going to ask them in new post<br />
Thanks for your time</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">8th December 2006, 17:29</div></div><div class="posttext">You welcome :-)<br />
Just remember that the above, used in function dir_pre code, it's a trick just to give us the drive letter of the disk where windows are installed.<br />
If you wish to install on other media, network drives etc, you have to refer to the included GetRoot, GetDrives etc.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>