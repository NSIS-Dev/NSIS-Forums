<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" System::Call &quot;How to call User32.dll's  API GetKeyboardLayoutList&quot;, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  System::Call &quot;How to call User32.dll's  API GetKeyboardLayoutList&quot; NSIS Discussion" />
	
	<title> System::Call &quot;How to call User32.dll's  API GetKeyboardLayoutList&quot; [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  System::Call &quot;How to call User32.dll's  API GetKeyboardLayoutList&quot;</div>
<hr />
<div class="pda"><a href="t-252587.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=252587">System::Call &quot;How to call User32.dll's  API GetKeyboardLayoutList&quot;</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">engine</div><div class="date">3rd August 2006, 20:20</div></div><div class="posttext">Hello everyone.<br />
<br />
I am writing a IME intaller with NSIS. <br />
I want to call User32.dll's API GetKeyboardLayoutList with the System plugin. but, I don't know how to write.<br />
I think the script should be..<br />
...<br />
System::Call &quot;user32.dll::GetKeyboardLayoutList(???)??&quot;<br />
...<br />
<br />
I am a novice at NSIS.:(  It is too difficult for me to use system.dll now.<br />
<br />
Anybody can help me?<br />
Thanks very much.:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">engine</div><div class="date">4th August 2006, 20:12</div></div><div class="posttext">:( There is nobody gave reply to my problem. why?:(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th August 2006, 20:26</div></div><div class="posttext">It'd be easier with a plug-in, because of the array management. But if you really wish...System::Call 'user32::GetKeyboardLayoutList(i 0, i 0) i .r0'<br />
IntOp $1 $0 * 4<br />
System::Alloc $1<br />
Pop $2<br />
System::GetKeyboardLayoutList(i r0, i r2)<br />
# $2 is a pointer to the handles list<br />
# $0 is its lengthOf course some error handling is needed...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">engine</div><div class="date">4th August 2006, 20:52</div></div><div class="posttext">Thank you, kichik.<br />
I have noticed that you are one of the best here.<br />
<br />
Your answer helps a lot. I need to have a try myself now.<br />
<br />
Is NsisArray.dll the plugin you just referred to? It looks that it will make the work much easier.<br />
Thanks again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th August 2006, 20:54</div></div><div class="posttext">NSISArray.dll won't help you here. You need direct memory access, not string arrays. You'll need to manipulate the array pointer and read the values one by one.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">engine</div><div class="date">4th August 2006, 21:29</div></div><div class="posttext">Forgive my stupidity.:) <br />
<br />
I have to analyze it seriously right away.<br />
<br />
I am sorry for my poor English. :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">engine</div><div class="date">4th August 2006, 23:39</div></div><div class="posttext">MessageBox MB_OK &quot;Test Start... &quot;<br />
<br />
System::Call 'user32::GetKeyboardLayoutList(i 0, i 0)i .r0'<br />
IntOp $1 $0 * 4<br />
System::Alloc $1<br />
Pop $2<br />
System::Call 'user32::GetKeyboardLayoutList(i r0, i r2)i .r0'<br />
<br />
StrCpy $1 1<br />
loop:<br />
System::Call '*$2(i .R1)'<br />
IntFmt $R1 &quot;%08X&quot; $R1<br />
ReadRegStr $R2 HKLM \<br />
&quot;SYSTEM\CurrentControlSet\Control\Keyboard Layouts\$R1&quot; &quot;Layout Text&quot;<br />
StrCpy $R1 &quot;0x$R1&quot;<br />
MessageBox MB_OK &quot;($1/$0) --&gt; $R1 $R2&quot;<br />
StrCmp $1 $0 done<br />
IntOp $1 $1 + 1<br />
IntOp $2 $2 + 4<br />
Goto loop<br />
done:<br />
MessageBox MB_OK &quot;Test End! &quot;<br />
<br />
<br />
Well done in this test means that the big problem in uninstall section of my IME package has been resolved!<br />
<br />
My Best Regards to kichik.:)  Thank you very very much!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>