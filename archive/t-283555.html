<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Exclude folders at install, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Exclude folders at install NSIS Discussion" />
	
	<title> Exclude folders at install [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Exclude folders at install</div>
<hr />
<div class="pda"><a href="t-283555.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=283555">Exclude folders at install</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Socrate</div><div class="date">21st December 2007, 17:12</div></div><div class="posttext">Hello<br />
<br />
I have made my installer with NSIS and the client doesn't want to the user can install my application on the Desktop (for example).<br />
<br />
I'm a newbie with NSIS.<br />
<br />
I create a MUI_PAGE_DIRECTORY where the user can select the installation path. But I want to show him a message box whihc tell him that he doesn't allow to install the application on the Desktop if he has decided to do it.<br />
<br />
Which method can I use to solve this problem ? <br />
Thanks for all your replies</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">21st December 2007, 19:20</div></div><div class="posttext">Here's some clue to start over,<br />
outfile test.exe<br />
InstallDir `$PROGRAMFILES\My Application`<br />
<br />
page directory `` `` dirleave<br />
page instfiles<br />
<br />
section<br />
<br />
sectionend<br />
<br />
Function dirleave<br />
    Push &quot;$INSTDIR&quot;<br />
    Push &quot;$DESKTOP&quot;<br />
    Call StrOutOfStr<br />
    Pop $R0<br />
    StrCmp &quot;$R0&quot; &quot;error&quot; proceed<br />
    MessageBox MB_ICONSTOP|MB_OK \<br />
    &quot;Installation on DESKTOP is not allowed, choose another directory&quot;<br />
    Abort<br />
   proceed:<br />
FunctionEnd<br />
<br />
Function StrOutOfStr<br />
   Exch $0 <br />
   Exch<br />
   Exch $1 <br />
   Push $2<br />
   Push $3<br />
   Push $4<br />
   Push $5<br />
<br />
        StrCpy $3 &quot;0&quot;<br />
        StrLen $4 &quot;$0&quot;<br />
        StrLen $5 &quot;$1&quot;<br />
        IntCmp $4 $5 0 0 _err<br />
        Intop $5 $5 - $4<br />
<br />
  _start:<br />
        StrCpy $2 &quot;$1&quot; $4 $3<br />
        StrCmp &quot;$2&quot; &quot;$0&quot; _done<br />
        IntCmp &quot;$3&quot; &quot;$5&quot; _err<br />
        Intop $3 $3 + 1<br />
        Goto _start<br />
<br />
   _err:<br />
        StrCpy $2 &quot;error&quot;<br />
<br />
  _done:<br />
        StrCpy $0 &quot;$2&quot;<br />
<br />
   Pop $5<br />
   Pop $4<br />
   Pop $3<br />
   Pop $2<br />
   Pop $1<br />
   Exch $0<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">{_trueparuex^}</div><div class="date">21st December 2007, 21:10</div></div><div class="posttext">And here's a different approach...<br />
<br />
...<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE MyDirLeave<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
...<br />
<br />
Function MyDirLeave<br />
 Push $0<br />
<br />
  StrLen $0 $DESKTOP<br />
  StrCpy $0 $INSTDIR $0<br />
  StrCmp $0 $DESKTOP 0 proceed<br />
    MessageBox MB_ICONSTOP|MB_OK \<br />
        &quot;Installation on DESKTOP is not allowed, choose another directory&quot;<br />
    Abort<br />
  proceed:<br />
<br />
 Pop $0<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>