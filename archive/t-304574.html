<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How set the value of the attributes, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How set the value of the attributes NSIS Discussion" />
	
	<title> How set the value of the attributes [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How set the value of the attributes</div>
<hr />
<div class="pda"><a href="t-304574.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=304574">How set the value of the attributes</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">LingoSag</div><div class="date">25th March 2009, 00:21</div></div><div class="posttext">First,excuse my english, my native language is french<br />
<br />
I try to set a SYMBOL with !define inside a macro.<br />
<br />
The final target is: set the value of attribute at compile-time.<br />
<br />
I take Caption for this exemple.<br />
<br />
Later, if it work, I use ${If} ${Else}... for decide which value for each attributes...<br />
<br />
I don't understand why is so difficult to set the value of this attributes<br />
<br />
at compile-time for differents circumstances ???<br />
<br />
-inside section...........No permit<br />
<br />
-inside function..........No permit<br />
<br />
-With variable............No permit<br />
<br />
How set the value of this attributes in a flexible way ?<br />
<br />
###############################<br />
<br />
!macro test<br />
<br />
!define TITLE_TEXT &quot;SimpleTest&quot;<br />
<br />
!macroend<br />
<br />
<br />
outFile &quot;Output.exe&quot;<br />
<br />
Caption &quot;${TITLE_TEXT}&quot;<br />
<br />
<br />
section<br />
<br />
!insertmacro test<br />
<br />
sectionEnd<br />
<br />
;Don't work ???</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">25th March 2009, 02:04</div></div><div class="posttext">The final target is: set the value of attribute at compile-time. I take Caption for this exemple. Later, if it work, I use ${If} ${Else}... for decide which value for each attributes <br />
That's not going to work because ${If} ${Else} are runtime instructions and cannot modify the compile time (!define) values.<br />
<br />
You can modify the !define values with compile time statements !if !else !endif !ifdef and all their cousins.<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LingoSag</div><div class="date">25th March 2009, 03:22</div></div><div class="posttext">Tanks Don,<br />
<br />
I note that.<br />
<br />
But, in my Exemple i dont use ${If} or ${Else} and the !define inside the macro<br />
<br />
Don't work<br />
<br />
If we can't set a value of attributes(*) with a:<br />
<br />
macro<br />
section<br />
function<br />
variable<br />
<br />
Then How ?<br />
<br />
(*)<br />
AddBrandingImage<br />
AllowRootDirInstall<br />
AutoCloseWindow<br />
BGFont<br />
BGGradient<br />
BrandingText<br />
Caption<br />
ChangeUI<br />
CheckBitmap<br />
CompletedText<br />
ComponentText<br />
CRCCheck<br />
DetailsButtonText<br />
DirText<br />
DirVar<br />
DirVerify<br />
FileErrorText<br />
Icon<br />
InstallButtonText<br />
InstallColors<br />
InstallDir<br />
InstallDirRegKey<br />
InstProgressFlags<br />
InstType<br />
LicenseBkColor<br />
LicenseData<br />
LicenseForceSelection<br />
LicenseText<br />
MiscButtonText<br />
Name<br />
OutFile<br />
RequestExecutionLevel<br />
SetFont<br />
ShowInstDetails<br />
ShowUninstDetails<br />
SilentInstall<br />
SilentUnInstall<br />
SpaceTexts<br />
SubCaption<br />
UninstallButtonText<br />
UninstallCaption<br />
UninstallIcon<br />
UninstallSubCaption<br />
UninstallText<br />
WindowIcon<br />
XPStyle<br />
<br />
<br />
SylBou</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">25th March 2009, 03:58</div></div><div class="posttext">You can use !define inside a !macro, and you can use !insertmacro in a Section or Function.<br />
<br />
You cannot use a defined name ( ${TITLE_TEXT} ) before the !define is compiled. Because you put the !define in a macro, the name does not get its value until or unless the macro is inserted.<br />
<br />
The error occurred in your script because the macro was inserted after (below the line where) the defined name ${TITLE_TEXT} was used.<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LingoSag</div><div class="date">25th March 2009, 04:34</div></div><div class="posttext">Ok, Merci Beaucoup !<br />
<br />
My error is very stupid...<br />
<br />
<br />
But for the moment is not very useful.<br />
<br />
<br />
If i want my Caption = &quot;YesYes&quot; if ${GoodTest} = &quot;yes&quot;<br />
<br />
and &quot;NoNo&quot; if ${GoodTest} &lt;&gt; &quot;yes&quot;<br />
<br />
How do that !<br />
<br />
<br />
<br />
###########################<br />
<br />
!define GoodTest &quot;yes&quot;<br />
<br />
!macro test<br />
<br />
!define TITLE_LABEL &quot;WorkWithCaptionInMacro&quot;<br />
<br />
!macroend<br />
<br />
section<br />
<br />
!insertmacro test<br />
<br />
sectionEnd<br />
<br />
OutFile &quot;OutPut.exe&quot;<br />
<br />
Caption ${TITLE_LABEL}<br />
<br />
;??????????????????????????</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">25th March 2009, 04:50</div></div><div class="posttext">!define GoodTest &quot;yes&quot;<br />
<br />
!macro test<br />
<br />
!ifndef TITLE_LABEL<br />
  !define TITLE_LABEL &quot;WorkWithCaptionInMacro&quot;<br />
!endif<br />
<br />
!macroend<br />
<br />
!if ${GoodTest} = &quot;yes&quot;<br />
  !define TITLE_LABEL &quot;yesyes&quot;<br />
!else<br />
  !define TITLE_LABEL &quot;nono&quot;<br />
!endif<br />
<br />
OutFile &quot;OutPut.exe&quot;<br />
Caption ${TITLE_LABEL}<br />
<br />
section<br />
<br />
!insertmacro test<br />
<br />
sectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LingoSag</div><div class="date">25th March 2009, 05:26</div></div><div class="posttext">!!! WONDERFUL !!!<br />
<br />
WithOut LogicLib<br />
<br />
!!! FANTASTIK !!!<br />
<br />
Tanks,Tanks,Tanks<br />
<br />
I need time for test that with ReadINIStr and comeback with news.<br />
<br />
Why ?<br />
<br />
Because i want config the NSIS script with a external .ini file.<br />
<br />
exactly like another software...<br />
<br />
<br />
I am a Lingo programmer (Adobe Director) and i want &quot;automatized&quot; the process<br />
<br />
of the my screensavers SetUp build.<br />
<br />
Tanks a another time...<br />
<br />
SylBou<br />
<br />
PS: The programmation language of NSIS is very crazy.<br />
<br />
Lingo<br />
ActionScript<br />
Javascript<br />
<br />
is for the baby...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LingoSag</div><div class="date">25th March 2009, 07:46</div></div><div class="posttext">;Don, Try this (For the Moment: Full path name for the ini file)<br />
<br />
<br />
outfile &quot;OutPut.exe&quot;<br />
<br />
<br />
Caption '$0'<br />
<br />
BrandingText '$1'<br />
<br />
CompletedText '$2'<br />
<br />
<br />
ShowInstDetails show<br />
<br />
<br />
function .onInit<br />
<br />
ReadINIStr '$0' &quot;F:\Data\040-WinXp-Bureau\MyConfig.ini&quot; Main Cap<br />
<br />
ReadINIStr '$1' &quot;F:\Data\040-WinXp-Bureau\MyConfig.ini&quot; Main Brand<br />
<br />
ReadINIStr '$2' &quot;F:\Data\040-WinXp-Bureau\MyConfig.ini&quot; Main CompTxt<br />
<br />
functionend<br />
<br />
<br />
section<br />
<br />
DetailPrint &quot;Hello World&quot;<br />
<br />
sectionend<br />
<br />
############<br />
<br />
;Don't work with outfile. I dont know because<br />
<br />
Hooups ini file<br />
<br />
ini file...<br />
<br />
[Main]<br />
Cap=MyCaption<br />
Brand=MyBrand<br />
CompTxt=MyCompletedTxt</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">25th March 2009, 08:02</div></div><div class="posttext">You can't change the Outfile parameter because the .onInit Function is called during runtime and contains runtime statements but Outfile needs a file name during compile time.<br />
<br />
You can pass defined values into the NSIS compiler from the command line with the /D switch. Maybe that will allow you the configuration changes you are looking for.<br />
makensis.exe /DOutFileName=Output.exe myscript.nsi  In the script you will use this define like this:<br />
...<br />
Outfile ${OutFileName}<br />
...<br />
<br />
(Edit: script name should be after the /D switches)<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LingoSag</div><div class="date">25th March 2009, 17:18</div></div><div class="posttext">Ok,Three things,<br />
<br />
After excitement, I finaly dont trust the usage of the '$0','$1','$2'...<br />
<br />
for set the attributes values.<br />
<br />
NSIS Crash many times and i loose confidence. (he do, but he dont like it...)<br />
<br />
NSIS Official Doc:<br />
<br />
&quot;Note that these attributes can be set anywhere in the file except in a Section or Function&quot;<br />
<br />
--<br />
<br />
Tanks for command line usage for set OutFile,<br />
<br />
But the script must work also in standard way (context menu) (I dont test if overwrite)<br />
<br />
<br />
The real basic question is:<br />
<br />
Simple exemple, for ??? Very simple thing ???<br />
<br />
How set (!define) the value of the PRODUCT_NAME with a external ini file (ReadINIStr) ?<br />
<br />
<br />
###############################################<br />
<br />
!define PRODUCT_NAME &quot;MyApplicationName&quot;<br />
<br />
OutFile &quot;${PRODUCT_NAME}.exe&quot;<br />
<br />
section<br />
<br />
;<br />
<br />
sectionEnd<br />
<br />
###############################################<br />
<br />
ini file<br />
[Main]<br />
PRODUCT_NAME=MyApplicationName<br />
<br />
<br />
:(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">25th March 2009, 18:03</div></div><div class="posttext">You cannot use ReadIniStr during the compile time because it is a runtime command.<br />
<br />
I think you should consider using the !SYSTEM and !EXECUTE commands to read your ini file and create a nsh header file that contains !defines for the ini values. The nsh header file can then be !included before the defined names are needed.<br />
<br />
You will have to create a batch file, script file (pl or vbs, perhaps), or separate exe to convert the ini values for the nsh file.<br />
<br />
I do something like that to define a build version number and the year (for the copyright data).<br />
...<br />
!execute &quot;wscript.exe BuildNum.vbs&quot;<br />
!include &quot;BuildNum.nsh&quot; 					# create date/serial build number<br />
...<br />
!define COPYRIGHT &quot;Copyright Â© ${YEAR} ${COMP_NAME}&quot;<br />
VIProductVersion  &quot;${VERSION}.${BUILDNUM}&quot;<br />
VIAddVersionKey &quot;LegalCopyright&quot;  &quot;${COPYRIGHT}&quot;<br />
 BuildNum.nsh :<br />
!define BuildNum 9051.1<br />
!define YEAR 2009<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LingoSag</div><div class="date">25th March 2009, 18:29</div></div><div class="posttext">Is not simple, but also very interesting.<br />
<br />
Thank you<br />
<br />
I work on that, and come back with news...<br />
<br />
SylBou</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LingoSag</div><div class="date">25th March 2009, 20:16</div></div><div class="posttext">Ok Don, use nsh file is a good strategy.<br />
<br />
Edit this file with Lingo is very very easy. Directly or via an ini file, no problem.<br />
<br />
But, please one more step with your pass answer/exemple.<br />
<br />
If ${GoodTest} = &quot;yes&quot; I want set ${TITLE_LABEL} with the value of ${GoodTestDataOne}<br />
<br />
And If ${GoodTest} &lt;&gt; &quot;yes&quot; I want set ${TITLE_LABEL} with the value of ${GoodTestDataTwo}<br />
<br />
Possible ?<br />
<br />
<br />
!define GoodTest &quot;yes&quot;<br />
<br />
!define GoodTestDataOne &quot;Dog&quot;<br />
<br />
!define GoodTestDataTwo &quot;Cat&quot;<br />
<br />
<br />
!macro test<br />
<br />
!ifndef TITLE_LABEL<br />
<br />
  !define TITLE_LABEL &quot;&quot;<br />
  <br />
!endif<br />
<br />
!macroend<br />
<br />
<br />
!if ${GoodTest} = &quot;yes&quot;<br />
<br />
  !define TITLE_LABEL &quot;yesyes&quot;<br />
  <br />
!else<br />
<br />
  !define TITLE_LABEL &quot;nono&quot;<br />
  <br />
!endif<br />
<br />
<br />
OutFile &quot;OutPut.exe&quot;<br />
<br />
Caption ${TITLE_LABEL}<br />
<br />
<br />
section<br />
<br />
!insertmacro test<br />
<br />
sectionEnd<br />
<br />
SylBou</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">25th March 2009, 21:03</div></div><div class="posttext">!define GoodTest &quot;yes&quot;<br />
!define GoodTestDataOne &quot;Dog&quot;<br />
!define GoodTestDataTwo &quot;Cat&quot;<br />
<br />
!if ${GoodTest} = &quot;yes&quot;<br />
  !define TITLE_LABEL ${GoodTestDataOne}<br />
!else<br />
  !define TITLE_LABEL ${GoodTestDataTwo}<br />
!endif<br />
<br />
Outfile outfile.exe<br />
Caption ${TITLE_LABEL}<br />
<br />
section<br />
sectionend<br />
<br />
You may be making it overly complicated with TITLE_LABEL derived from GoodTestDataOne or GoodTestDataTwo. Unless you are using GoodTestDataOne and GoodTestDataTwo other places, you can eliminate them and write !define GoodTest &quot;yes&quot;<br />
!define GoodTestDataOne &quot;Dog&quot;<br />
!define GoodTestDataTwo &quot;Cat&quot;<br />
<br />
!if ${GoodTest} = &quot;yes&quot;<br />
  Caption ${GoodTestDataOne}<br />
!else<br />
  Caption ${GoodTestDataTwo}<br />
!endif<br />
<br />
Outfile outfile.exe<br />
<br />
section<br />
sectionend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LingoSag</div><div class="date">25th March 2009, 22:08</div></div><div class="posttext">Ok Don,<br />
<br />
Its simple and work well, Thank you !<br />
<br />
My Last Question (Sorry)<br />
<br />
What's wrong with this script:<br />
<br />
I Know is not logic, Because !insertmacro test is after<br />
<br />
the Conditional but how do Otherwise ?<br />
<br />
######################################<br />
<br />
<br />
Outfile &quot;outfile.exe&quot;<br />
<br />
<br />
!define FRENCH_CAPTION &quot;MyFrenchCaption&quot;<br />
<br />
!define ENGLISH_CAPTION &quot;MyEnglishCaption&quot;<br />
<br />
!define LOCALE_SNATIVELANGNAME '0x4'<br />
<br />
<br />
!macro test<br />
<br />
System::Call 'kernel32::GetLocaleInfoA(i 1024, i ${LOCALE_SNATIVELANGNAME}, t .r1, i ${NSIS_MAX_STRLEN}) i r0'<br />
<br />
;MessageBox MB_OK $1<br />
<br />
!macroend<br />
<br />
<br />
!if $1 = &quot;franÃ§ais&quot;<br />
<br />
  Caption ${FRENCH_CAPTION}<br />
  <br />
!else<br />
<br />
  Caption ${ENGLISH_CAPTION}<br />
  <br />
!endif<br />
<br />
<br />
section<br />
<br />
!insertmacro test<br />
<br />
sectionend<br />
<br />
<br />
######################################</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">25th March 2009, 23:15</div></div><div class="posttext">What's wrong with this script:!if $1 = &quot;franÃ§ais&quot; The registers don't exist or have a value during compile time (when the !if is trying to determine true or false). The macro 'test' won't be run until the compiled code is executed by the user.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LingoSag</div><div class="date">26th March 2009, 00:16</div></div><div class="posttext">Is not the only problem with this Stategy<br />
<br />
Even if work, at compile time is set the value of<br />
<br />
my system language and not the user system language.<br />
<br />
Then, the true question now is:<br />
<br />
<br />
How set the values of attributes(*) at run time ?<br />
<br />
<br />
Forget the solution with '$0','$1','$2'...is not BugProof<br />
<br />
I take one day for write the script of my screensaver installer.<br />
<br />
And i have no idea for set a simples variables in a conditional environnement.<br />
<br />
<br />
I musk think <br />
<br />
Tank you, Don, for your Great Help.<br />
<br />
SylBou<br />
<br />
(*)<br />
Caption<br />
MiscButtonText<br />
InstallButtonText<br />
BrandingText<br />
CompletedText<br />
<br />
For automatic language GUI<br />
<br />
<br />
PS:I like my lingo, is simple and very powerfull</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LingoSag</div><div class="date">26th March 2009, 04:12</div></div><div class="posttext">That is the true limitation of the NSIS<br />
<br />
NSIS Official Doc:<br />
<br />
&quot;Note that these attributes can be set anywhere in the file except in a Section or Function&quot;<br />
<br />
They forget:<br />
<br />
...or macro...or...variables<br />
<br />
NSIS can run, but he can't walk...<br />
<br />
######################################################<br />
<br />
<br />
!include LogicLib.nsh<br />
<br />
outFile &quot;installer.exe&quot;<br />
<br />
!define LANGUAGE_DETECT_SIMULATION &quot;franÃ§ais&quot;<br />
<br />
!define FRENCH_CAPTION &quot;MyFrenchCaption&quot;<br />
<br />
!define ENGLISH_CAPTION &quot;MyEnglishCaption&quot;<br />
<br />
Caption &quot;TEMP&quot;<br />
<br />
<br />
<br />
!macro test<br />
<br />
 ${If} ${LANGUAGE_DETECT_SIMULATION} == &quot;franÃ§ais&quot;<br />
 <br />
 Caption ${FRENCH_CAPTION}<br />
<br />
${Else}<br />
<br />
 Caption ${ENGLISH_CAPTION}<br />
<br />
${EndIf}<br />
<br />
!macroend<br />
<br />
<br />
section<br />
;<br />
sectionEnd<br />
<br />
<br />
Function .onInit<br />
<br />
!insertmacro test<br />
<br />
FunctionEnd<br />
<br />
######################################################<br />
<br />
Obviously Don't Work<br />
<br />
<br />
Bye My GUI with a automatic language detect :(<br />
<br />
<br />
PS: At .onInit event the dialog windows is not draw, this<br />
<br />
limitation have no sens for me...<br />
<br />
<br />
The other solution,<br />
<br />
Dynamically change the contents of the GUI<br />
<br />
with GetDlgItem,SendMessage,ect...it not easy beause<br />
<br />
the .onGUIInit event<br />
<br />
overwrite our settings,<br />
<br />
Ok with a little timer for the first page<br />
<br />
but we have no events for the next pages<br />
<br />
SylBou</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">26th March 2009, 06:02</div></div><div class="posttext">LingoSag,<br />
I think before you go too much further, you should take some time to read the documentation and look at the numerous sample scripts to get a good feel for NSIS before going full bore trying to create your own scripts.<br />
<br />
Also, posting several posts back to back usually just annoys people.  :( <br />
<br />
There are several resources available to help you--this forum, the wiki (http://nsis.sourceforge.net/Main_Page), and even your NSIS installation directory.  There's also a French (http://www.todae.fr/nsis/) support site that might be of some help.<br />
<br />
For your issues below, here's one article that might be of help:http://nsis.sourceforge.net/Language_Detection_From_Windows_UI_Language. There's also a sample file named 'languages.nsi' in ${NSISDIR}\examples that you might want to look it.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>