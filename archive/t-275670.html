<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Flashing Command Window, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Flashing Command Window NSIS Discussion" />
	
	<title> Flashing Command Window [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Flashing Command Window</div>
<hr />
<div class="pda"><a href="t-275670.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=275670">Flashing Command Window</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">10th August 2007, 10:37</div></div><div class="posttext">Hi<br />
<br />
When my installer starts I run an executable and that executable flashes up a command window. In addition, when I uninstall the same problems occurs on the same executable. <br />
<br />
This flashing does not affect the installation or whilst I am  uninstalling. However, it will be a nuisance to users.<br />
<br />
I have trawled the forum and found the ExecDos plug-in. Will this stop the flashing or is there anything I can use in NSIS that will alleviate this problem.<br />
<br />
Cheers,<br />
<br />
Paul</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">10th August 2007, 10:45</div></div><div class="posttext">ExecDos is ok, just try it.<br />
Also the included nsExec plugin.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">10th August 2007, 12:49</div></div><div class="posttext">Hi<br />
<br />
I am using ExecDos plug-in to prevent the command window from appearing whilst running an executable. Whilst installing this works perfectly, on my uninstall I need to wait before I commence. How is this done?<br />
<br />
The old way I was using the command:<br />
ExecWait &quot;$INSTDIR\Service\someExecutable.exe u&quot;<br />
Using ExecDocs I am using the command:<br />
<br />
ExecDos::exec /DETAILED /TIMEOUT=6000 &quot;Service\someExecutable.exe /u&quot;<br />
Pop $0 ; thread handle for 'wait'<br />
time to check process exit code (optional)<br />
ExecDos::wait $0<br />
<br />
<br />
The problem is that there is no waiting.<br />
<br />
Any ideas?<br />
<br />
Cheers,<br />
<br />
Paul</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">10th August 2007, 12:55</div></div><div class="posttext">I have just increased the TIMEOUT=8000 and that did the trick.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th August 2007, 12:57</div></div><div class="posttext">Don't use a time-out. That will just ensure your process is killed before it finishes its job.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">10th August 2007, 13:05</div></div><div class="posttext">OK, thanks for that. I have omitted the TIMEOUT as requested. However, I do not beleive that we waiting for the processto finish.<br />
<br />
Here is my code:<br />
<br />
<br />
DetailPrint &quot;Removing Service...&quot;<br />
ExecDos::exec /DETAILED &quot;$INSTDIR\Service\someExecutable.exe /u&quot;<br />
Pop $0 ; thread handle for 'wait'<br />
ExecDos::wait $0<br />
<br />
<br />
Do you know what is wrong?<br />
<br />
Cheers,<br />
<br />
Paul</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th August 2007, 13:09</div></div><div class="posttext">You are not using it correctly. The wait function is only used when you specify /ASYNC.<br />
<br />
You do not need to use ExecDos::wait with it omitted.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">10th August 2007, 13:20</div></div><div class="posttext">I am using the following code:<br />
<br />
<br />
DetailPrint &quot;Removing Service...&quot;<br />
ExecDos::exec /NOUNLOAD /ASYNC /DETAILED &quot;$INSTDIR\Service\${PHONE_SERVICE} /u&quot;<br />
Pop $0 ; thread handle for 'wait'<br />
ExecDos::wait $0<br />
<br />
<br />
In the docs is says:<br />
<br />
ASYNC<br />
Not waits for process exit. Use 'wait' call if you want to get exit code. (/NOUNLOAD is mandatory!)<br />
<br />
So I've included the /NOUNLOAD. The problem still exists as we are not waiting.<br />
<br />
Any further ideas?<br />
<br />
Paul</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th August 2007, 13:22</div></div><div class="posttext">Perhaps it is not actually executing the program?<br />
Try:<br />
ExecDos::exec /NOUNLOAD /ASYNC /DETAILED `&quot;$INSTDIR\Service\${PHONE_SERVICE}&quot; /u`<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">10th August 2007, 13:32</div></div><div class="posttext">On install the program installs itself into Windows Services, during uninstall the program uninstalls itself from Window services. It's definitely executing the program because after uninstall there is no program to view in Services.<br />
<br />
I have tried the line of code you have just given but to no avail.<br />
<br />
Any other ideas?<br />
<br />
Paul</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th August 2007, 13:36</div></div><div class="posttext">If it's executing then how do you know it's not waiting? Does the program take more than a few milliseconds to execute?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">10th August 2007, 13:43</div></div><div class="posttext">The executable gets deleted but it uses some DLL's that are being left behind despite being recursively deleted. The deletion occurs after the service has finished uninstalling.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">10th August 2007, 13:48</div></div><div class="posttext">To uninstall the program takes apprx 3000-4000 milliseconds.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">10th August 2007, 14:03</div></div><div class="posttext">Stu<br />
<br />
I have found the problem now. Thank you very much for your help. I appreciate it a lot.<br />
<br />
Regards;<br />
<br />
Paul</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">10th August 2007, 19:46</div></div><div class="posttext">Can we ask what the solution is? Others who may run into the same problem will like to know how to fix it...<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">14th August 2007, 17:13</div></div><div class="posttext">Sorry for the late reply,<br />
<br />
The problem was with the DLL's I think. I got given a new versions so I swapped them over with the old ones and it seemed to resolve the problem.<br />
<br />
However, The problem has come back, only this time I can't delete the executable but the DLL's have gone. Trust me this is driving me nuts.<br />
<br />
If I use the following line of code then all works well, e.g. the executable gets deleted and the uninstaller cleans up.<br />
<br />
ExecWait `&quot;$INSTDIR\Service\${PHONE_SERVICE}&quot; /u`<br />
<br />
However, I get the horrible flashing of the command window.<br />
<br />
If I use the following line instead:<br />
<br />
ExecDos::exec /NOUNLOAD /ASYNC /DETAILED `&quot;$INSTDIR\Service\${PHONE_SERVICE}&quot; /u`<br />
<br />
Then the executable does not get deleted, but there is no horrible flashing.<br />
<br />
Also from the command line if you type:<br />
<br />
start /?<br />
<br />
It says you can start a new application without starting a new window, so the command would look some thing like:<br />
<br />
start /B someProg.exe<br />
<br />
Then the application would have no flashing window, cool a?<br />
The problem is that I can't get it to work using<br />
<br />
ExecWait `&quot;start /B $INSTDIR\Service\${PHONE_SERVICE}&quot; /u`<br />
<br />
Any further help would be appreciated.<br />
<br />
Cheers,<br />
<br />
Paul</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">14th August 2007, 17:17</div></div><div class="posttext">Heres a fragment from my uninstaller:<br />
<br />
<br />
Section &quot;Uninstall&quot;<br />
  <br />
  ....<br />
  <br />
  DetailPrint &quot;Removing Service...&quot;<br />
  ExecWait `&quot;$INSTDIR\Service\${PHONE_SERVICE}&quot; /u`<br />
  ;ExecDos::exec /NOUNLOAD /ASYNC /DETAILED `&quot;$INSTDIR\Service\${PHONE_SERVICE}&quot; /u`<br />
<br />
  ....<br />
<br />
    <br />
  ; Recursively delete the contents of the following directories<br />
  ; and finally delete the directory.<br />
  RMDIR /r &quot;$INSTDIR\bin\&quot;<br />
  RMDIR /r &quot;$INSTDIR\Client&quot;<br />
  RMDIR /r &quot;$INSTDIR\JRE_v6&quot;<br />
  RMDIR /r &quot;$INSTDIR\Motorola&quot;<br />
  RMDIR /r &quot;$INSTDIR\Service&quot;<br />
  RMDIR /r &quot;$INSTDIR\Static&quot;<br />
  <br />
  ; Remove the installation directory.<br />
  RMDir &quot;$INSTDIR&quot;<br />
  <br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">14th August 2007, 17:42</div></div><div class="posttext">I don't think that ExecDoc works for me unless I put sleep 3000 on the next line.<br />
<br />
Cheers,<br />
<br />
Paul</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th August 2007, 17:43</div></div><div class="posttext">You're using /ASYNC.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>