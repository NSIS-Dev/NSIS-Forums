<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Dump Log to text file, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Dump Log to text file NSIS Discussion" />
	
	<title> Dump Log to text file [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Dump Log to text file</div>
<hr />
<div class="pda"><a href="t-290391.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=290391">Dump Log to text file</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">JHaigh</div><div class="date">17th April 2008, 10:02</div></div><div class="posttext">Hi,<br />
<br />
I've made my first simple script that essentially just copies some files since I don't have to do any real tricky installation. It just makes it look considerably more presentable than a batch file ;-)<br />
<br />
I used the function/script bit for dumping the log to a text file from the forum but it still doesn't happen. Obviously I'm doing something wrong but I can't think what it is. I'm guessing that either it's getting called at the wrong time or not at all. Could someone please give me a pointer as to what I'm doing wrong,<br />
<br />
I've summarised my script below;<br />
<br />
TIA<br />
<br />
Jonathan<br />
<br />
;start<br />
!if ${Project} == &quot;Project1&quot;<br />
Name &quot;Blah&quot;<br />
OutFile &quot;P:\Blah_Install.exe&quot;<br />
!endif<br />
<br />
!if ${Project} == &quot;Project2&quot;<br />
Name &quot;BlahBlah&quot;<br />
OutFile &quot;P:\Blah_Blah_Install.exe&quot;<br />
!endif<br />
<br />
;-------------------------------------------------------------------------------<br />
; Generic setup parameters for the installer<br />
<br />
Icon &quot;${NSISDIR}\Contrib\Graphics\Icons\arrow2-install.ico&quot;<br />
ShowInstDetails show<br />
SetOverwrite ON<br />
CRCCheck ON<br />
FileErrorText &quot;Can not write to file $\r$\n$0$\r$\n.&quot;<br />
InstType &quot;Full&quot;<br />
SetCompressor /SOLID lzma<br />
<br />
<br />
	!define LVM_GETITEMCOUNT 0x1004<br />
	!define LVM_GETITEMTEXT 0x102D<br />
<br />
<br />
; Use the Modern User Interface<br />
	!include MUI2.nsh<br />
<br />
;MUI Settings<br />
	!define MUI_ABORTWARNING<br />
		<br />
	!define MUI_ICON &quot;${NSISDIR}\Contrib\Graphics\Icons\arrow-install.ico&quot;<br />
	!define MUI_HEADERIMAGE<br />
	!define MUI_HEADERIMAGE_BITMAP &quot;${NSISDIR}\Contrib\Graphics\Header\nsis.bmp&quot;<br />
		<br />
	!define MUI_WELCOMEPAGE_TITLE_3LINES <br />
		<br />
	!define MUI_LICENSEPAGE_BGCOLOR /grey<br />
	!define MUI_LICENSEPAGE_CHECKBOX ;sets the checkbox before the I Agree button is un-greyed out<br />
		<br />
	!define MUI_INSTALLFILE_COLORS /windows<br />
<br />
<br />
;-------------------------------------------------------------------------------<br />
;Pages<br />
<br />
	!insertmacro MUI_PAGE_WELCOME<br />
	!insertmacro MUI_PAGE_LICENSE &quot;License.rtf&quot;<br />
	!insertmacro MUI_PAGE_COMPONENTS<br />
	!insertmacro MUI_PAGE_INSTFILES<br />
	!insertmacro MUI_PAGE_FINISH<br />
<br />
	!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
  <br />
;-------------------------------------------------------------------------------<br />
;Splash screen<br />
<br />
Function .onInit<br />
	var /GLOBAL &quot;Project&quot;<br />
<br />
	SetOutPath $TEMP<br />
	File /oname=splash.bmp &quot;C:\Program Files\NSIS\Contrib\Graphics\Splash\Splash.bmp&quot;<br />
	splash::show 1500 $TEMP\splash<br />
<br />
	Pop $0 ; $0 has '1' if the user closed the splash screen early,<br />
	 ; '0' if everything closed normally, and '-1' if some error occurred.<br />
	Delete $TEMP\splash.bmp<br />
FunctionEnd<br />
<br />
;-------------------------------------------------------------------------------<br />
;Installer Sections<br />
<br />
Section &quot;First File Set&quot;<br />
	SectionIn 1 RO<br />
	SetOutPath &quot;some path&quot;<br />
	File A_File<br />
<br />
	SetOutPath &quot;some other path&quot;<br />
	File Another_File<br />
SectionEnd<br />
<br />
Section &quot;Second File Set&quot;<br />
	SectionIn 1 RO<br />
	SetOutPath &quot;Yet Another Path&quot;<br />
	File /r /x not_this_file.dat A_Path\*.*<br />
	File Path\to some\executable\Exec.exe<br />
SectionEnd<br />
<br />
Section &quot;Last File Set&quot;<br />
	SectionIn 1 RO<br />
	SetOutPath &quot;more paths&quot;<br />
	File more_files<br />
SectionEnd<br />
<br />
;-------------------------------------------------------------------------------<br />
;Output Log<br />
<br />
Section &quot;-Output_log&quot;<br />
GetTempFileName $0<br />
Push $0<br />
Call DumpLog<br />
SectionEnd<br />
<br />
<br />
Function DumpLog<br />
  Exch $5<br />
  Push $0<br />
  Push $1<br />
  Push $2<br />
  Push $3<br />
  Push $4<br />
  Push $6<br />
<br />
  FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
  GetDlgItem $0 $0 1016<br />
  StrCmp $0 0 error<br />
  FileOpen $5 $5 &quot;w&quot;<br />
  StrCmp $5 0 error<br />
    SendMessage $0 ${LVM_GETITEMCOUNT} 0 0 $6<br />
    System::Alloc ${NSIS_MAX_STRLEN}<br />
    Pop $3<br />
    StrCpy $2 0<br />
    System::Call &quot;*(i, i, i, i, i, i, i, i, i) i \<br />
      (0, 0, 0, 0, 0, r3, ${NSIS_MAX_STRLEN}) .r1&quot;<br />
    loop: StrCmp $2 $6 done<br />
      System::Call &quot;User32::SendMessageA(i, i, i, i) i \<br />
        ($0, ${LVM_GETITEMTEXT}, $2, r1)&quot;<br />
      System::Call &quot;*$3(&amp;t${NSIS_MAX_STRLEN} .r4)&quot;<br />
      FileWrite $5 &quot;$4$\r$\n&quot;<br />
      IntOp $2 $2 + 1<br />
      Goto loop<br />
    done:<br />
      FileClose $5<br />
      System::Free $1<br />
      System::Free $3<br />
      Goto exit<br />
  error:<br />
    MessageBox MB_OK error<br />
  exit:<br />
    Pop $6<br />
    Pop $4<br />
    Pop $3<br />
    Pop $2<br />
    Pop $1<br />
    Pop $0<br />
    Exch $5<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">17th April 2008, 13:01</div></div><div class="posttext">Where are the two !define's that should be in the script?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JHaigh</div><div class="date">17th April 2008, 13:17</div></div><div class="posttext">second block in the Generic setup section.. <br />
<br />
I assume you mean the lines<br />
<br />
!define LVM_GETITEMCOUNT 0x1004<br />
!define LVM_GETITEMTEXT 0x102D<br />
<br />
<br />
Like I say I guess since it works for other people that I've got some or all of it in the wrong place is all.<br />
<br />
J</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JHaigh</div><div class="date">17th April 2008, 13:33</div></div><div class="posttext">OK, it's official, I'm too dumb to write scripts ;-/<br />
<br />
Figured (by looking at some other dumplog posts) that it helps if I take out the GetTempFilename bit and just specify a path\filename in the push line, now it works! I knd of expected it to pop up a notepad window with the contents of the log instead of just writing it but I guess I can just open the created file using nsexec or something similar. I might even be able to figure it out myself :-)))<br />
<br />
Thanks anyhow.<br />
<br />
J</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>