<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem with a long string, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem with a long string NSIS Discussion" />
	
	<title> Problem with a long string [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem with a long string</div>
<hr />
<div class="pda"><a href="t-234117.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=234117">Problem with a long string</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">27th December 2005, 17:55</div></div><div class="posttext">Hello all.<br />
<br />
I have a strange problem.  A co-worker asked me if I could make an exe that would simply copy the first line of a current text file into a new text file.  I said, no problem, and quickly put together an nsi file using Instructor's LineRead function.  (I also tried Afrow's Read from text file line number function too, and got the same problem).  My problem is this, this text file i'm reading from has very long lines, over 3400 characters.  I am using the long string build of NSIS 2.10, but am getting truncated output for both line read functions after character 1023.<br />
<br />
I can however just StrCpy my variable with a string (same string that's in Doc1.txt) that is over 3400 characters (see below), and that works just fine.  So I know my Long String build is working, but it seems that both line read functions I have tried still have the 1024 character limitation.  <br />
<br />
Any thoughts would be appreciated.  I have attached the &quot;Doc1.txt&quot; file, so you can compile the below code and recreate the problem.  Thanks all.<br />
<br />
<br />
Name LineMove<br />
OutFile LineMove.exe<br />
AutoCloseWindow True<br />
SilentInstall Silent<br />
<br />
Var Source<br />
Var String<br />
<br />
Section &quot;&quot;<br />
<br />
  StrCpy $Source Doc1.txt<br />
  <br />
  Push $Source<br />
  Push &quot;1&quot;<br />
  Call LineRead<br />
  Pop $String<br />
  MessageBox MB_OK &quot;$String&quot;<br />
  <br />
StrCpy $String &quot;abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefg\<br />
hijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcd\<br />
efghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyza\<br />
bcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwx\<br />
yzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstu\<br />
vwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqr\<br />
stuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmno\<br />
pqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijkl\<br />
mnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghi\<br />
jklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdef\<br />
ghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabc\<br />
defghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\<br />
abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvw\<br />
xyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrst\<br />
uvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopq\<br />
rstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmn\<br />
opqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijk\<br />
lmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefgh\<br />
ijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcde\<br />
fghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzab\<br />
cdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxy\<br />
zabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuv\<br />
wxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrs\<br />
tuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnop\<br />
qrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklm\<br />
nopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghij\<br />
klmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefg\<br />
hijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcd\<br />
efghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyza\<br />
bcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwx\<br />
yzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstu\<br />
vwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqr\<br />
stuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmno\<br />
pqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijkl\<br />
mnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghi\<br />
jklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdef\<br />
ghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabc\<br />
defghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\<br />
abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvw\<br />
xyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrst\<br />
uvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopq\<br />
rstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmn\<br />
opqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijk\<br />
lmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefgh\<br />
ijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcde\<br />
fghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz&quot;<br />
  <br />
  MessageBox MB_OK &quot;$String&quot;<br />
<br />
SectionEnd<br />
<br />
<br />
Function LineRead<br />
	Exch $1<br />
	Exch<br />
	Exch $0<br />
	Exch<br />
	Push $2<br />
	Push $3<br />
	Push $4<br />
	ClearErrors<br />
<br />
	IfFileExists $0 0 error<br />
	IntOp $1 $1 + 0<br />
	IntCmp $1 0 error 0 plus<br />
	StrCpy $4 0<br />
	FileOpen $2 $0 r<br />
	IfErrors error<br />
	FileRead $2 $3<br />
	IfErrors +3<br />
	IntOp $4 $4 + 1<br />
	Goto -3<br />
	FileClose $2<br />
	IntOp $1 $4 + $1<br />
	IntOp $1 $1 + 1<br />
	IntCmp $1 0 error error<br />
<br />
	plus:<br />
	FileOpen $2 $0 r<br />
	IfErrors error<br />
	StrCpy $3 0<br />
	IntOp $3 $3 + 1<br />
	FileRead $2 $0<br />
	IfErrors +4<br />
	StrCmp $3 $1 0 -3<br />
	FileClose $2<br />
	goto end<br />
	FileClose $2<br />
<br />
	error:<br />
	SetErrors<br />
	StrCpy $0 ''<br />
<br />
	end:<br />
	Pop $4<br />
	Pop $3<br />
	Pop $2<br />
	Pop $1<br />
	Exch $0<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">27th December 2005, 19:13</div></div><div class="posttext">NSIS docs states that &quot;strings are limited to 1024 characters&quot; and thus this doesn't depend on the special build string limitation. This could be a feature request though.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">27th December 2005, 19:22</div></div><div class="posttext">1023 was actually hard-coded in the source code. I've fixed it and attached a patch. Version 2.13 will contain this fix, as well as the next nightly build (http://nsis.sourceforge.net/nightly/nsis.zip). Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">27th December 2005, 19:24</div></div><div class="posttext">And updated the documentation. Thanks deguix.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">27th December 2005, 19:30</div></div><div class="posttext">Thank you so much for your help kichik.  I'm a little unsure how to implement this patch though, I'm guessing I would need to use it to re-compile the makensis.exe file correct?  I have not done that before, do you know when 2.13 will be released?  Sorry for the bother, thanks again for your help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">27th December 2005, 19:33</div></div><div class="posttext">Yes, you'd have to recompile. 2.13 will be released in about a month. The next nightly build will be built, well, this night. You can also write your own function to keep reading until it reaches a new line marker, the maximum string length or the end of the file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">27th December 2005, 19:38</div></div><div class="posttext">Good to know, thanks again for your help kichik.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>