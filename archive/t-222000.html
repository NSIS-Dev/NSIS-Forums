<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" MUI and .onGUIEnd, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  MUI and .onGUIEnd NSIS Discussion" />
	
	<title> MUI and .onGUIEnd [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  MUI and .onGUIEnd</div>
<hr />
<div class="pda"><a href="t-222000.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=222000">MUI and .onGUIEnd</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">ddod</div><div class="date">20th July 2005, 19:32</div></div><div class="posttext">It would seem that if I use the MUI I cannot add to the .onGUIEnd callback.  Is this true?  I tried to create my own and was told that it was already defined.  I assume this is becasue MUI needs to do quite a bit of clean up using this callback.<br />
<br />
However, I have some cleanup of my own that needs to be run regardless of what happens during the install (success, failure, cancel, etc.)<br />
<br />
Is there another way to do this or do I have to define my cleanup commands in multiple locations to cover myself?<br />
<br />
Thanks again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">20th July 2005, 19:42</div></div><div class="posttext">Are you possibly running your installer silently?  If so those GUI callback functions won't be called.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ddod</div><div class="date">20th July 2005, 19:53</div></div><div class="posttext">No it is a full graphical install. I am sure that the .onGUIEnd is being run by the MUI, I just don't seem to have access to add my own code to that particular function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dead_Overlord</div><div class="date">21st July 2005, 06:02</div></div><div class="posttext">I have this same question!<br />
<br />
For the &quot;.onGUIInit&quot; callback function i use the command:<br />
 <br />
!define MUI_CUSTOMFUNCTION_GUIINIT myguinitfunction<br />
<br />
But for the &quot;.onGUIEnd&quot; callback function i have no idea about how to add my own commands.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">21st July 2005, 16:47</div></div><div class="posttext">The MUI does not set the .onGUIEnd function. It must be another library.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ddod</div><div class="date">21st July 2005, 19:04</div></div><div class="posttext">I am not loading any other libraries.  But I am still getting hte error when I try to create the .onGUIEnd function that it is already defined.  MUI.nsh is the only thing I am loading.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">21st July 2005, 20:01</div></div><div class="posttext">Can you attach a minimal example that reproduces the problem?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ddod</div><div class="date">21st July 2005, 21:18</div></div><div class="posttext">Well I tried to create a simple script that caused the problem but couldn't.  SO I moved the .onGUIEnd function to the start of my script to see where the error would happen.  As I thought my function was defined first so I got an error when it tried to load it again.  Here is the error I got.<br />
<br />
Error: Function named &quot;.onGUIEnd&quot; already exists.<br />
Error in macro MUI_FUNCTION_GUIINIT on macroline 20<br />
Error in macro MUI_INSERT on macroline 11<br />
Error in macro MUI_LANGUAGEFILE_BEGIN on macroline 4<br />
!include: error in script: &quot;C:\Program Files\NSIS\Contrib\Modern UI\Language files\English.nsh&quot; on line 9<br />
Error in macro MUI_LANGUAGE on macroline 9<br />
<br />
So it is trying to define it again in the MUI when I run the following command<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
Is there a way around this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ddod</div><div class="date">21st July 2005, 21:27</div></div><div class="posttext">Well I just noticed that it is the UltraModernUI that is causing the problems.  I just switched it back to the MUI instead od UMUI and it works great.  <br />
<br />
So the next question is, since it looks like the UMUI is already implenting the .onGUIEnd function, is there any way to  add my own code to his?  (Unless anyone else has any suggestions for a place to run my cleanup code)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dead_Overlord</div><div class="date">22nd July 2005, 05:51</div></div><div class="posttext">To resolve it is simple!<br />
<br />
See the code in the file &quot;UMUI.nsh&quot; (use the Search or Find tool of your editor).<br />
<br />
Find the function &quot;.onGUIInit&quot;, you see the following code:<br />
<br />
   !ifdef MUI_CUSTOMFUNCTION_GUIINIT<br />
    Call &quot;${MUI_CUSTOMFUNCTION_GUIINIT}&quot;<br />
   !endif<br />
<br />
It accept the comand for a custom .onGUIInit function:<br />
<br />
   !define MUI_CUSTOMFUNCTION_GUIINIT myguiinit<br />
<br />
To create the command that point to your own code you need to write the file &quot;UMUI.nsh&quot;. Add the following lines inside the &quot;.onGUIEnd&quot; function that was already defined inside this file:<br />
<br />
   !ifdef MUI_CUSTOMFUNCTION_GUIEND<br />
    Call &quot;${MUI_CUSTOMFUNCTION_GUIEND}&quot;<br />
   !endif<br />
<br />
Inside the script that you want to use a custom .onGUIEnd, insert the following line:<br />
<br />
   !define MUI_CUSTOMFUNCTION_GUIEND myguiend<br />
<br />
And create the function:<br />
<br />
   Function myguiend<br />
   ...my own code...<br />
   functionend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ddod</div><div class="date">22nd July 2005, 15:25</div></div><div class="posttext">Thanks for th input.  I made the changes and everything compiled just fine.  However the function never seems to run.  MUI does not have a MUI_CUSTOMFUNCTION_GUIEND built into their program, could that be the problem?<br />
<br />
I get the following warning:<br />
<br />
  install function &quot;myguiend&quot; not referenced - zeroing code (286-288) out</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nsnb</div><div class="date">7th August 2008, 00:13</div></div><div class="posttext">Originally posted by ddod <br />
I get the following warning:<br />
<br />
  install function &quot;myguiend&quot; not referenced - zeroing code (286-288) out <br />
I am having the same exact problem with myGuiInit, which doesn't seem to be invoked at all (although the script compiles OK).<br />
<br />
I followed the instruction in C:\Program Files\NSIS\Docs\Modern UI 2\Readme.html:<br />
<br />
Interface functions provided by NSIS, like the .onGUIInit function and the page functions are automatically included by the Modern UI and filled with code to support new interface features. If you want to add additional code to these function, create a function with the custom script code in the script use the Modern UI functions call them.<br />
<br />
Example:<br />
<br />
!define MUI_CUSTOMFUNCTION_GUIINIT myGuiInit<br />
<br />
Function myGUIInit<br />
  ...<br />
FunctionEnd<br />
<br />
What am I doing wrong?<br />
<br />
Is the location of  !define MUI_CUSTOMFUNCTION_GUIINIT important?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">typhoon_bg</div><div class="date">25th August 2009, 18:22</div></div><div class="posttext">Yes, define it before<br />
<br />
!include &quot;MUI.nsh&quot;<br />
<br />
I had the same problem and it is now fixed.<br />
<br />
Cheers,<br />
Georgi</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>