<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Shared functions?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Shared functions? NSIS Discussion" />
	
	<title> Shared functions? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Shared functions?</div>
<hr />
<div class="pda"><a href="t-73972.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=73972">Shared functions?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Pomflain</div><div class="date">30th January 2002, 22:35</div></div><div class="posttext">What's the easiest way to write a function which is called in both the installer and uninstaller sections without just duplicating the code?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">31st January 2002, 09:23</div></div><div class="posttext">This is not possible, because when writing the uninstaller, the installer must exactly know what to include in the uninstaller. That's why every function in uninstaller should start with 'un.'<br />
<br />
So just duplicate code.<br />
<br />
Greetz, Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rainwater</div><div class="date">31st January 2002, 14:06</div></div><div class="posttext">If you really are desperate, you could probaly use includes by wrapping them around Function...FunctionEnd's.  But then you would have to have an include for each function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st January 2002, 15:21</div></div><div class="posttext">Or you could use macro instead of includes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rainwater</div><div class="date">31st January 2002, 17:13</div></div><div class="posttext">I never thought about macros (I guess cause I never use them).  But I guess this would be the perfect case for when you need to use them.<br />
<br />
Rob</div></div><hr />


<div class="post"><div class="posttop"><div class="username">superrock</div><div class="date">31st January 2002, 18:12</div></div><div class="posttext">Hi!<br />
<br />
I tried to use macros. But afterwards makensis (1.95) crashed.<br />
Maybe the script was too long ?<br />
<br />
So I did use an external filter program to duplicte on file. Both files are included afterwards.<br />
I used inst.function for the template and changed &quot;inst.&quot; to &quot;un.&quot; by my filter program. <br />
<br />
e.g Master script<br />
script1.nsi<br />
!include inc1.nsi<br />
!include inc1u.nsi<br />
.<br />
.<br />
e.g. include script &quot;inc1.nsi&quot;<br />
Function Inst.function1<br />
.<br />
.<br />
.<br />
FunctionEnd<br />
<br />
filtering:<br />
ffilt32 inc1.nsi inc1u.nsi -se &quot;inst.&quot; -ch &quot;un.&quot;<br />
<br />
Please use the attached filter program.<br />
<br />
Greetings,<br />
Andreas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pomflain</div><div class="date">31st January 2002, 20:35</div></div><div class="posttext">Yeah,  I know how each section needs to be different,  I've just been cleaning up my scripts and trying to make some things &quot;nicer.&quot;  Figured since I'm doing the exact same thing in some places I'd try to extract it and was wondering if there was a simple way to do it. Didn't notice there was the !macro section.  I suppose it doesn't help in the sense of having a shared function,  it'll just make it easier to duplicate the code in one place.<br />
<br />
Thanks for all the suggestions,  I'll use the macro for now because not only is it something that I'll be sharing between the installer and uninstaller,  I'll be sharing it across 9 scripts,  so I'll put it in my common script I'm including in them all.<br />
<br />
Thanks for the suggestions.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">felfert</div><div class="date">31st January 2002, 21:56</div></div><div class="posttext">Macros do help. See code snippet. Is there somewhere a place where we can collect includes? NSIS Projecthouse doesn't seem to be ready now.<br />
<br />
 -Fritz<br />
<br />
<br />
...<br />
<br />
!macro _util.both<br />
;<br />
; Usage:<br />
;<br />
;  call getNumColors<br />
;  pop $0<br />
;  MessageBox MB_OK &quot;Number of Bits per Pixel: $0&quot;<br />
;<br />
Function ${_UTIL_UNDOT}getNumColors<br />
  push &quot;getScreenColors&quot;<br />
  call ${_UTIL_UNDOT}_runDLL<br />
FunctionEnd<br />
<br />
;<br />
; Usage:<br />
;<br />
;  call getUserName<br />
;  pop $0<br />
;  MessageBox MB_OK &quot;Current user: $0&quot;<br />
;<br />
Function ${_UTIL_UNDOT}getUserName<br />
  push &quot;getUserName&quot;<br />
  call ${_UTIL_UNDOT}_runDLL<br />
FunctionEnd<br />
<br />
;<br />
; Usage:<br />
;<br />
;  call getPID<br />
;  pop $0<br />
;  MessageBox MB_OK &quot;Current process ID: $0&quot;<br />
;<br />
Function ${_UTIL_UNDOT}getPID<br />
  push &quot;getPID&quot;<br />
  call ${_UTIL_UNDOT}_runDLL<br />
FunctionEnd<br />
<br />
Function ${_UTIL_UNDOT}_removeDLL<br />
  Delete &quot;$TEMP\NSISutil.dll&quot;<br />
FunctionEnd<br />
<br />
Function ${_UTIL_UNDOT}_runDLL<br />
  IfFileExists &quot;$TEMP\NSISutil.dll&quot; ret<br />
  File &quot;/oname=$TEMP\NSISutil.dll&quot; &quot;${INCLUDES}\NSISutil.dll&quot;<br />
  !define _INIT_FUNC &quot;${_UTIL_UNDOT}_removeDLL&quot;<br />
  push &quot;${_UTIL_UNDOT}onUserAbort&quot;<br />
  !insertmacro ${_UTIL_UNDOT}multicallback.register_callback<br />
  !define _INIT_FUNC &quot;${_UTIL_UNDOT}_removeDLL&quot;<br />
  push &quot;${_UTIL_UNDOT}on${_UTIL_INST}Failed&quot;<br />
  !insertmacro ${_UTIL_UNDOT}multicallback.register_callback<br />
  !define _INIT_FUNC &quot;${_UTIL_UNDOT}_removeDLL&quot;<br />
  push &quot;${_UTIL_UNDOT}on${_UTIL_INST}Success&quot;<br />
  !insertmacro ${_UTIL_UNDOT}multicallback.register_callback<br />
ret:<br />
  exch $R0<br />
  CallInstDLL &quot;$TEMP\NSISutil.dll&quot; $R0<br />
  exch<br />
  pop $R0<br />
FunctionEnd<br />
<br />
!undef _UTIL_UNDOT<br />
!undef _UTIL_INST<br />
!macroend ; _util.both<br />
<br />
;<br />
; Duplicate the whole stuff with and without &quot;un.&quot; prefix<br />
;<br />
!define _UTIL_UNDOT &quot;&quot;<br />
!define _UTIL_INST &quot;Inst&quot;<br />
!insertmacro _util.both<br />
<br />
!ifdef NSIS_CONFIG_UNINSTALL_SUPPORT<br />
!define _UTIL_UNDOT &quot;un.&quot;<br />
!define _UTIL_INST &quot;Uninst&quot;<br />
!insertmacro _util.both<br />
!endif<br />
...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>