<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Detecting OS, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Detecting OS NSIS Discussion" />
	
	<title> Detecting OS [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Detecting OS</div>
<hr />
<div class="pda"><a href="t-268143.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=268143">Detecting OS</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">darshanaltekar</div><div class="date">21st March 2007, 12:10</div></div><div class="posttext">How can in my installer detect which OS it is currently running on. I want it prerticularly for Windows 2000 . Also how can i detect if SP 3 is installed or not.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgiusto</div><div class="date">21st March 2007, 12:30</div></div><div class="posttext">there is a plugin here: nsis.sourceforge.net/GetVersion_%28Windows%29_plug-in<br />
<br />
or you can use this function<br />
 ; GetWindowsVersion<br />
 ;<br />
 ; Based on Yazno's function, http://yazno.***********/powerpimpit/<br />
 ; Returns on top of stack<br />
 ;<br />
 ; Windows Version (95, 98, ME, NT x.x, 2000, XP, .NET Server)<br />
 ; or<br />
 ; '' (Unknown Windows Version)<br />
 ;<br />
 ; Usage:<br />
 ;   Call GetWindowsVersion<br />
 ;   Pop $R0<br />
 ;   ; at this point $R0 is &quot;NT 4.0&quot; or whatnot<br />
<br />
 Function GetWindowsVersion<br />
   Push $R0<br />
   Push $R1<br />
   ReadRegStr $R0 HKLM &quot;SOFTWARE\Microsoft\Windows NT\CurrentVersion&quot; CurrentVersion<br />
   StrCmp $R0 &quot;&quot; 0 lbl_winnt<br />
   ; we are not NT.<br />
   ReadRegStr $R0 HKLM SOFTWARE\Microsoft\Windows\CurrentVersion VersionNumber<br />
<br />
   StrCpy $R1 $R0 1<br />
   StrCmp $R1 '4' 0 lbl_error<br />
<br />
   StrCpy $R1 $R0 3<br />
<br />
   StrCmp $R1 '4.0' lbl_win32_95<br />
   StrCmp $R1 '4.9' lbl_win32_ME lbl_win32_98<br />
<br />
   lbl_win32_95:<br />
     StrCpy $R0 '95'<br />
   Goto lbl_done<br />
<br />
   lbl_win32_98:<br />
     StrCpy $R0 '98'<br />
   Goto lbl_done<br />
<br />
   lbl_win32_ME:<br />
     StrCpy $R0 'ME'<br />
   Goto lbl_done<br />
<br />
   lbl_winnt:<br />
<br />
     StrCpy $R1 $R0 1<br />
<br />
     StrCmp $R1 '3' lbl_winnt_x<br />
     StrCmp $R1 '4' lbl_winnt_x<br />
<br />
     StrCpy $R1 $R0 3<br />
<br />
     StrCmp $R1 '5.0' lbl_winnt_2000 lbl_error<br />
     StrCmp $R1 '5.1' lbl_winnt_XP lbl_error<br />
     StrCmp $R1 '5.2' lbl_winnt_dotNET lbl_error<br />
<br />
     lbl_winnt_x:<br />
       StrCpy $R0 &quot;NT $R0&quot; 6<br />
     Goto lbl_done<br />
<br />
     lbl_winnt_2000:<br />
       Strcpy $R0 '2000'<br />
     Goto lbl_done<br />
<br />
     lbl_winnt_XP:<br />
       Strcpy $R0 'XP'<br />
     Goto lbl_done<br />
<br />
     lbl_winnt_dotNET:<br />
       Strcpy $R0 '.NET Server'<br />
     Goto lbl_done<br />
<br />
   lbl_error:<br />
     Strcpy $R0 ''<br />
   lbl_done:<br />
   Pop $R1<br />
   Exch $R0<br />
 FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">21st March 2007, 12:46</div></div><div class="posttext">To detect Windows version plus service pack you may use this plugin by Afrow UK (http://nsis.sourceforge.net/GetVersion_%28Windows%29_plug-in).<br />
Otherwise there is the included header WinVer.nsh, find it into include folder under NSIS installation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ionut_y</div><div class="date">25th March 2007, 17:35</div></div><div class="posttext">The script above is great but needs some corrections.It doesn't detect XP,first line skip it to lbl_error<br />
<br />
<br />
StrCmp $R1 '5.0' lbl_winnt_2000 lbl_error<br />
StrCmp $R1 '5.1' lbl_winnt_XP lbl_error<br />
StrCmp $R1 '5.2' lbl_winnt_dotNET lbl_error<br />
<br />
<br />
<br />
StrCmp $R1 '5.0' lbl_winnt_2000 0<br />
StrCmp $R1 '5.1' lbl_winnt_XP 0<br />
StrCmp $R1 '5.2' lbl_winnt_dotNET lbl_error</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th March 2007, 14:35</div></div><div class="posttext">That script is very old.<br />
The latest one is at:<br />
http://nsis.sourceforge.net/Docs/AppendixC.html#C.5<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ionut_y</div><div class="date">26th March 2007, 17:00</div></div><div class="posttext">Originally posted by Afrow UK <br />
That script is very old.<br />
The latest one is at:<br />
http://nsis.sourceforge.net/Docs/AppendixC.html#C.5<br />
<br />
Stu  <br />
<br />
ok, thanks !</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>