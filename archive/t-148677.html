<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" abort when File skipped, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  abort when File skipped NSIS Discussion" />
	
	<title> abort when File skipped [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  abort when File skipped</div>
<hr />
<div class="pda"><a href="t-148677.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=148677">abort when File skipped</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">moredip</div><div class="date">9th September 2003, 19:01</div></div><div class="posttext">Hi all,<br />
<br />
So I only just started scripting with NSIS, so apologies in advance for dumb questions...<br />
<br />
I think I'm missing something really obvious here, but I've looked in the docs, FAQ, etc. to no avail.<br />
<br />
 run my script (included below) and some of the files can't be installed due to inadequate admin permissions. So far so good. But NSIS doesn't abort the installation, it just skips the files and continues. I can't work out how to tell NSIS that the files are essential to the install, so it should abort if they fail to install.<br />
<br />
Any ideas?<br />
<br />
TIA, <br />
<br />
Pete<br />
<br />
please attach large scripts next time. attached below :down:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th September 2003, 19:19</div></div><div class="posttext">NSIS sets the error flag if a file was skipped. To check that you need to use ClearErrors and IfErrors. But since you're using /r it will only check after all files are copied. If you know it will always fail if the user is not admin, why don't you check for it using UserInfo?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">moredip</div><div class="date">9th September 2003, 19:48</div></div><div class="posttext">So the best I can do is something like the following:<br />
<br />
&lt;---------SNIP-----------&gt;<br />
Section &quot;Install&quot;<br />
  ;Install Files<br />
  SetCompress off<br />
  SetOverwrite Try<br />
<br />
  ; A_Program Files<br />
  File /r &quot;C:\4DCInstaller\bin&quot;<br />
  IfErrors FileError<br />
<br />
  ; C_Config Files<br />
  File /r &quot;C:\4DCInstaller\config&quot;<br />
  IfErrors FileError<br />
<br />
  ; G_Imaging DLLs<br />
  SetOutPath $SYSDIR<br />
  File /r C:\4DCInstaller\img_dll\*.dll&quot;<br />
  IfErrors FileError<br />
<br />
;...<br />
;...<br />
<br />
  Goto FileEnd<br />
<br />
  FileError:<br />
  DetailPrint &quot;Could not install some files&quot;<br />
  SetDetailsView show<br />
  MessageBox MB_OK|MB_ICONSTOP|MB_TOPMOST &quot;Could not install some files&quot;<br />
  Abort<br />
  FileEnd:<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th September 2003, 19:52</div></div><div class="posttext">No, I think the best you can do is check for administrator privileges if you know it needs admin. The next best thing would be generating the File commands using another installer (very simple to make using FileOpen, FileWrite, FileClose, FindFirst, FindNext and FindClose) or another program, call it using !system and !include its output.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">moredip</div><div class="date">9th September 2003, 20:05</div></div><div class="posttext">I agree with you about checking for admin rights (I'm playing around with that right now), but I still want something to handle failures to some extent, even if that just means letting the user know.<br />
<br />
I don't think it's worth writing another binary and using !system etc. in my case, I think what I've got should be OK, at least for the moment.<br />
<br />
BTW, is it possible for File to fail if the user has admin rights? The only thing I can think of is invalid filenames.<br />
<br />
Cheers,<br />
<br />
Pete</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th September 2003, 20:09</div></div><div class="posttext">It can fail if the file is in use. In this case it will just skip the file because you've used SetOverwrite try. If you use SetOverwrite on it will ask the user what to do. You can also deny the user of the option to ignore and force him to abort or retry (latest CVS version - AllowSkipFiles (http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.2.1)).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">moredip</div><div class="date">9th September 2003, 21:18</div></div><div class="posttext">OK. <br />
<br />
Thanks for the help kichik :) I've got the admin check code working now, so I'm all set to start trying to figure out why my fsckin' app won't start in win98 :igor:<br />
<br />
Cheers,<br />
<br />
Pete</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>