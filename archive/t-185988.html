<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problems with /COMPONENTSONLYONCUSTOM, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problems with /COMPONENTSONLYONCUSTOM NSIS Discussion" />
	
	<title> Problems with /COMPONENTSONLYONCUSTOM [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problems with /COMPONENTSONLYONCUSTOM</div>
<hr />
<div class="pda"><a href="t-185988.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=185988">Problems with /COMPONENTSONLYONCUSTOM</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">flyakite</div><div class="date">9th July 2004, 09:26</div></div><div class="posttext">Alright I have searched and expirimented for the last 4 hours trying to get this to work right and I can't find a way.  I can get it to work 50% right but that's about it.<br />
<br />
<br />
I am creating an installer to install modified system files.  Originally I had 3 install types.  One install type installed all the common system files.  Another install type would just install shell32, and the 3rd would bring up a custom page allowing the user to just extract the files from the installer to a directory of their choice so they could modify them on their own.  It was all working using this method but the user could still choose components using the 3rd install type.<br />
<br />
Now, however, I've decided to just use the 3rd install type and the custom install type using /COMPONENTSONLYONCUSTOM so that the user can't choose components when using the extraction install type.<br />
<br />
<br />
Here's a condensed version of my code.  The goal is that when the &quot;Extract Files Only&quot; install type is chosen the components page disappears, then you hit next and you're given a page to choose the directory to extract the files to (THAT part works).  But, then I want it that when you pull the menu down and choose the Custom install type, it turns of the &quot;Extract&quot; section (I want to keep that section hidden) and won't show the custom page.  Whenever I choose the custom install type the extract section is still turned on and when I hit next it brings up the custom page dialog.<br />
<br />
Any help would be appreciated.<br />
<br />
<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
Page directory ExtractDir &quot;&quot; &quot;&quot;<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
;------------------------------------------<br />
;Install Types<br />
;------------------------------------------<br />
  InstType &quot;Extract Files Only&quot;<br />
  InstType /COMPONENTSONLYONCUSTOM<br />
<br />
<br />
;------------------------------------------<br />
;Section Extract Files<br />
;------------------------------------------<br />
    Section &quot;-EXTRACT&quot; Extract<br />
    SectionIn 1<br />
      SetOverwrite on<br />
      SetOutPath &quot;$INSTDIR&quot;<br />
      File /r &quot;*.*&quot;<br />
      Delete &quot;$OUTDIR\*.nsi&quot;<br />
      RMDir &quot;$OUTDIR\misc&quot;<br />
    SectionEnd<br />
<br />
    Function ExtractDir<br />
      ClearErrors<br />
      SectionGetFlags ${Extract} $R7<br />
      IntOp $R7 $R7 &amp; ${SF_SELECTED}<br />
      IntCmp $R7 ${SF_SELECTED} +2<br />
      Abort<br />
    FunctionEnd<br />
<br />
;------------------------------------------<br />
;Section Create Restore Point<br />
;------------------------------------------<br />
    Section &quot;Create Restore Point&quot; restorepoint<br />
      SetOutPath &quot;$TEMP&quot;<br />
      File &quot;misc\utilities\restorepoint.vbs&quot;<br />
      ExecShell open &quot;$TEMP\restorepoint.vbs&quot;<br />
      Sleep 3000<br />
    SectionEnd<br />
<br />
<br />
<br />
;------------------------------------------<br />
; Section Install shell32.dll<br />
;------------------------------------------<br />
    Section &quot;Shell32&quot; SHELL32<br />
      SetRebootFlag true<br />
      SetOutPath &quot;$SYSDIR&quot;<br />
      !insertmacro InstallFile &quot;shell32.dll&quot; &quot;$SYSDIR&quot;<br />
    SectionEnd<br />
.<br />
.<br />
.<br />
etc....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th July 2004, 09:57</div></div><div class="posttext">The custom installation type is not a type you can use with SectionIn. It is a type which allows the user to select whatever sections he or she wants. Therefore, the hidden &quot;-Extract&quot; section is not unselected when the user chooses the custom type.<br />
<br />
To avoid this, you can use GetCurInstType (http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.13.10) to check the selected installation type and unselect the first section or just add this condition to the ExtractDir function.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>