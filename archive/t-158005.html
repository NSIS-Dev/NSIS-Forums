<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Path Manipulation, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Path Manipulation NSIS Discussion" />
	
	<title> Path Manipulation [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Path Manipulation</div>
<hr />
<div class="pda"><a href="t-158005.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=158005">Path Manipulation</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">cosmic66</div><div class="date">29th November 2003, 13:55</div></div><div class="posttext">I'm using these functions (http://nsis.sourceforge.net/archive/viewpage.php?pageid=91) for path manipulation<br />
(thanks, KiCHiK :-)):<br />
<br />
I would like to add a function that will first check if a specific<br />
string is already defined in PATH, so it wouldn't add it again<br />
(the string I add is always: &quot;%FOO%\bin&quot;).<br />
<br />
Can anyone help me on how to do that?<br />
<br />
<br />
And when I use un.RemoveFromPath to remove a string from PATH, it<br />
leaves the semi-colon that it added in front of it in the PATH string.<br />
Is that done on purpose and is it not such a good idea to remove<br />
that one?<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th November 2003, 14:09</div></div><div class="posttext">The function checks if the directory is already there and doesn't add it if it is. If you want to check yourself anyway, simply read %PATH% using ReadEnvStr and only call the function if it's not there.<br />
<br />
The semicolon is not on purpose, but it doesn't really hurt. It's just an empty path that will be ignored. There is also this issue (http://forums.winamp.com/showthread.php?s=&amp;threadid=139857) which I should finally fix sometime...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th November 2003, 17:33</div></div><div class="posttext">Fixed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cosmic66</div><div class="date">30th November 2003, 14:50</div></div><div class="posttext">Thanks for your fix!<br />
<br />
<br />
One more question regarding the path manipulation:<br />
<br />
I add my path to PATH like so:<br />
<br />
  Push &quot;$INSTDIR\bin&quot;<br />
  Call AddToPath<br />
<br />
<br />
And I remove it in the uninstaller like so:<br />
<br />
<br />
  Push &quot;$INSTDIR\bin&quot;    <br />
  Call un.RemoveFromPath<br />
<br />
<br />
If I run the installer twice (with the same INSTDIR) it will add<br />
the same path to PATH twice.<br />
From how I understood your answer it shouldn't do that, should it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th November 2003, 16:06</div></div><div class="posttext">I was wrong, it doesn't check if the path is already there. You should check for it yourself using ReadEnvStr and the StrStr function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cosmic66</div><div class="date">30th November 2003, 21:28</div></div><div class="posttext">How do I get the PATH string for Windows 9x?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">30th November 2003, 21:33</div></div><div class="posttext">Use ReadEnvStr.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cosmic66</div><div class="date">11th December 2003, 11:20</div></div><div class="posttext">Hi,<br />
<br />
I'm having problems with checking PATH for a string.<br />
I just can't find the mistake, maybe someone can<br />
help me?<br />
<br />
The problem is when adding the string to PATH (AddToPath),<br />
I first would like to check if the string is already there.<br />
But the string is never found (StrStr always returns<br />
-1), although in there.<br />
<br />
I have attached my modified PathManipulation script.<br />
<br />
<br />
Thanks,<br />
<br />
Barbara</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th December 2003, 13:38</div></div><div class="posttext">There is an example of checking on the archive page now. Try it and let me know if it works for you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cosmic66</div><div class="date">11th December 2003, 16:00</div></div><div class="posttext">Thanks for the example, with your code I got it to work!<br />
<br />
I had another problem then which was that I'm writing and testing<br />
the installer without the actually data (those commands are added<br />
through scripts that I don't have access to yet) and thus<br />
$INSTDIR\bin was not created through my test installation.<br />
<br />
If you then call:<br />
GetFullPathName /SHORT $1 $1<br />
<br />
(where $1 is &quot;$INSTDIR\bin&quot; and the path doesn't exist, the error<br />
flag is set and $1 is empty.<br />
<br />
For completenes, this is the code that works for me now:<br />
<br />
<br />
<br />
<br />
ReadEnvStr $0 path<br />
Push &quot;$0;&quot;<br />
Push &quot;$INSTDIR\bin;&quot;<br />
Call StrStr<br />
Pop $2<br />
IntCmp $2 -1 addPath addPath<br />
StrCpy $1 &quot;$INSTDIR\bin&quot;<br />
GetFullPathName /SHORT $1 $1<br />
MessageBox MB_OK $1<br />
ReadEnvStr $0 path<br />
Push &quot;$0;&quot;<br />
Push &quot;$1;&quot;<br />
Call StrStr<br />
Pop $2<br />
IntCmp $2 -1 addPath addPath dontAdd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cosmic66</div><div class="date">16th December 2003, 12:50</div></div><div class="posttext">I have one remaining problem:<br />
<br />
I'm testing for a string in PATH as posted abough.<br />
<br />
If INSTDIR consists of spaces (such as &quot;MyApp 2&quot;), the<br />
string is not detected and added to PATH again.<br />
<br />
What can I do to solve this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th December 2003, 12:52</div></div><div class="posttext">Use the updated functions, they check it for, spaces or no spaces.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cosmic66</div><div class="date">16th December 2003, 13:40</div></div><div class="posttext">I have now updated the functions (from your archive page).<br />
<br />
If the installdir has spaces it works OK now.<br />
<br />
<br />
On uninstallation it messes up the PATH string though:<br />
<br />
The first entry on my box was:<br />
C:\Program Files\Microsoft Visual ...<br />
and after I uninstalled my SW my path was still in there but<br />
the start of the string was shortened to:<br />
\Microsoft Visual ...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th December 2003, 15:21</div></div><div class="posttext">Fixed, thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Thalion77</div><div class="date">6th April 2006, 09:41</div></div><div class="posttext">Where is the archive page? I would like to download the functions to manipulate the path variable.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">6th April 2006, 11:34</div></div><div class="posttext">The archive has been replaced by the wiki:<br />
<br />
http://nsis.sourceforge.net/Developer_Center<br />
<br />
Here are some links that might answer your question:<br />
<br />
http://nsis.sourceforge.net/Path_Manipulation<br />
<br />
http://nsis.sourceforge.net/Path_manipulation_with_all_users/current_user_selection_in_run-time</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>