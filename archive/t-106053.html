<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Determine if a file is in use, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Determine if a file is in use NSIS Discussion" />
	
	<title> Determine if a file is in use [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Determine if a file is in use</div>
<hr />
<div class="pda"><a href="t-106053.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=106053">Determine if a file is in use</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">o_cee</div><div class="date">19th September 2002, 18:21</div></div><div class="posttext">What would be the best way to determine if a file (.dll) is in use (by the shell) or not?<br />
<br />
Will FileOpen (W) always fail if the file is in use? Is that the quickest way?<br />
<br />
<br />
thanks<br />
<br />
o_cee</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th September 2002, 18:27</div></div><div class="posttext">As far as I know every shell DLL (COM as a matter of fact) has an exported function called DllCanUnloadNow. Use an external DLL to call it and see if it can be unloaded, which means it can be deleted (I think).<br />
<br />
http://msdn.microsoft.com/library/default.asp?url=/library/en-us/com/cmf_d2l_531z.asp</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o_cee</div><div class="date">20th September 2002, 09:19</div></div><div class="posttext">Seems very useful. I'll have to ask a friend to make a suitable dll for me since i don't code myself :)<br />
<br />
Thanks<br />
<br />
<br />
o_cee</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o_cee</div><div class="date">23rd September 2002, 06:48</div></div><div class="posttext">Could the new system.dll plugin be used for this? If yes, how?<br />
<br />
<br />
thanks<br />
<br />
o_cee</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">23rd September 2002, 09:50</div></div><div class="posttext">Yes, but I surely should develop a new documentation :)<br />
<br />
Ok. At first, you should use the latest CVS snapshot or snapshoted release (from sept.22), because the order of arguments changed in this release.<br />
<br />
There are two pathways: first does the direct check, while the second allows you to check if the dll available and contains the DllCanUnloadNow.<br />
<br />
1) System::FullCall &quot;shell32.dll?DllCanUnloadNow?i&quot; &quot;?0&quot;<br />
; Now you can do the check, for example with StrCmp<br />
<br />
shell32.dll should be replaced with your dll (it can include path).<br />
&quot;?0&quot; should be replaced with desired output register ('?s' for stack, '?n' for $n, '?N', where N='a'..o for $Rn).<br />
After that you can check it with StrCmp, for example<br />
StrCmp $0 0 Can Cant<br />
There is no error, S_OK==0 and S_CANCEL==1, so 0 return value means YES, you can :)<br />
<br />
2) System::FullAddr &quot;shell32.dll?DllCanUnloadNow?i&quot; &quot;?1&quot;<br />
Pop $0<br />
StrCmp $0 0 0 DllFound<br />
MessageBox MB_OK &quot;Dll not found or it contains no DllCanUnloadNow&quot;<br />
Quit ; Or whatever you want<br />
DllFound:<br />
System::Call $0<br />
; Now you can do the check, for example with StrCmp<br />
; And at last, if you are not going to confuse Windows<br />
System::Free $0<br />
<br />
All comments for previous section are the same... And be carefull, this code uses &quot;?1&quot; so you should check $1, not $0.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>