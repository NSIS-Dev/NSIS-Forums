<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Search for text in file?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Search for text in file? NSIS Discussion" />
	
	<title> Search for text in file? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Search for text in file?</div>
<hr />
<div class="pda"><a href="t-346638.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=346638">Search for text in file?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">v47</div><div class="date">29th July 2012, 11:23</div></div><div class="posttext">hello.<br />
<br />
just started to use NSIS, and I would like to do following:<br />
<br />
open &quot;settings.cfg&quot; in the $INSTDIR<br />
look for &quot;german&quot;, if found, copy german.cfg to $INSTDIR<br />
look for &quot;french&quot;, if found, copy french.cfg to $INSTDIR<br />
<br />
tried to play with this http://nsis.sourceforge.net/Search_for_text_in_file for a bit, but I'm totally lost (on the look for/if found part). help?<br />
<br />
thank you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">29th July 2012, 12:47</div></div><div class="posttext">You can probably use LineFind from filefunc.nsh. http://nsis.sourceforge.net/Docs/AppendixE.html#E.2.2</div></div><hr />


<div class="post"><div class="posttop"><div class="username">v47</div><div class="date">29th July 2012, 19:44</div></div><div class="posttext">any chance of an example?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">29th July 2012, 19:58</div></div><div class="posttext">There are many usage examples in the documentation I linked.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">T.Slappy</div><div class="date">30th July 2012, 06:24</div></div><div class="posttext">Is your config file INI based?<br />
ReadINIStr - http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.2.10</div></div><hr />


<div class="post"><div class="posttop"><div class="username">v47</div><div class="date">31st July 2012, 10:00</div></div><div class="posttext">no, it's a cfg, but it's just a renamed txt file. tried to look at those examples, but it's way too complicated for me - until now, all I had to do was check for files and move them accordingly, and this is the first time I have to do something more complicated.. I was hoping for something I could just copy &amp; paste, no luck I guess.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2012, 12:57</div></div><div class="posttext">T.Slappy wanted to know the format of the file. 'cfg' is just a generic extension for a configuration file, whereas an INI file has a very specific format. What does the actual format/contents look like?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">v47</div><div class="date">31st July 2012, 14:01</div></div><div class="posttext">no, it's just a text file with variables. no specific format.<br />
<br />
the plan I had was doing a text/string lookup in the file, and then using some if text/string exists function, just like I have been using IfFileExists for all the previous tasks, but I see no such thing here (with my very unskilled eye, anyway).<br />
<br />
maybe I should just make this user selectable and forget about it..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2012, 14:10</div></div><div class="posttext">no, it's just a text file with variablesWhat do you mean exactly?<br />
<br />
If there is no specific format, how can you look up a string? We cannot help you if we do not know what the format is.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">v47</div><div class="date">31st July 2012, 14:27</div></div><div class="posttext">inst.cfg, contents:<br />
install_path .\<br />
language english<br />
<br />
the problem is, the user can have either english, german or french in the language line, and some files that have to be copied over are language specific, and the installer needs to know when german or french is used as some extra files need to be copied over (english is not a problem, it's the default language so no extra files are needed).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2012, 14:29</div></div><div class="posttext">You should be able to use ConfigRead for this (it's in the manual).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">v47</div><div class="date">31st July 2012, 14:37</div></div><div class="posttext">I'll try, thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2012, 14:52</div></div><div class="posttext">Or you can use this code:FileOpen $R0 path\to\inst.cfg r<br />
${Do}<br />
<br />
  FileRead $R0 $R1<br />
  ${If} ${Errors}<br />
    ${Break}<br />
  ${EndIf}<br />
<br />
  StrCpy $R2 $R1 13<br />
  ${If} $R2 == `install_path `<br />
    StrCpy $CfgInstallPath $R1 `` 13<br />
    ${TrimNewLines} $CfgInstallPath $CfgInstallPath<br />
    ${Continue}<br />
  ${EndIf}<br />
<br />
  StrCpy $R2 $R1 9<br />
  ${If} $R2 == `language `<br />
    StrCpy $CfgLanguage $R1 `` 9<br />
    ${TrimNewLines} $CfgLanguage $CfgLanguage<br />
    ${Continue}<br />
  ${EndIf}<br />
<br />
${Loop}<br />
FileClose $R0Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">v47</div><div class="date">31st July 2012, 15:46</div></div><div class="posttext">ugh, I'm totally lost on this - can't figure your out your piece of code or what is the $var in ConfigRead supposed to do.<br />
<br />
guess I bit off more than I can chew.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2012, 16:00</div></div><div class="posttext">$var is what it says - a variable which receives the output/value. It can be one of NSIS's built in ones ($0-$9, $R0-$R9) or one you define yourself using the Var instruction. My code uses two variables $CfgInstallPath and $CfgLanguage which would need to be defined with the Var instruction.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">31st July 2012, 17:00</div></div><div class="posttext">two variables $CfgInstallPath and $CfgLanguage which would need to be defined with the Var instruction.<br />
Correction to avoid confusion: &quot;Need to be declared with the Var instruction.&quot; Defining is done with !define, which is completely different.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">v47</div><div class="date">1st August 2012, 12:09</div></div><div class="posttext">received help from a fellow forum member. adding the function he made, should anyone need something similar in the future:<br />
<br />
Function CheckLanguage<br />
	FileOpen $R0 &quot;$INSTDIR\install.cfg&quot; r<br />
	Var /GLOBAL CfgLanguage<br />
	${DO}<br />
		FileRead $R0 $R1<br />
		${If} ${Errors}<br />
			${Break}<br />
		${EndIf}<br />
		<br />
		StrCpy $R2 $R1 9<br />
		${If} $R2 == `language `<br />
			StrCpy $CfgLanguage $R1 `` 9<br />
			${Break}<br />
		${EndIf}<br />
	${Loop}<br />
	<br />
	${Switch} $CfgLanguage<br />
		${Case} 'english'<br />
			File /oname=install.cfg files\English_install.cfg<br />
		${Break}<br />
		<br />
		${Case} 'german'<br />
			File /oname=install.cfg files\German_install.cfg<br />
		${Break}<br />
<br />
		${Default}<br />
			File /oname=install.cfg files\English_install.cfg<br />
		${Break}<br />
	${EndSwitch}<br />
FunctionEnd<br />
<br />
thanks to everybody who helped. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">PoRtAbLe_StEaLtH</div><div class="date">28th October 2012, 06:13</div></div><div class="posttext">Or you can use this code:FileOpen $R0 path\to\inst.cfg r<br />
${Do}<br />
<br />
  FileRead $R0 $R1<br />
  ${If} ${Errors}<br />
    ${Break}<br />
  ${EndIf}<br />
<br />
  StrCpy $R2 $R1 13<br />
  ${If} $R2 == `install_path `<br />
    StrCpy $CfgInstallPath $R1 `` 13<br />
    ${TrimNewLines} $CfgInstallPath $CfgInstallPath<br />
    ${Continue}<br />
  ${EndIf}<br />
<br />
  StrCpy $R2 $R1 9<br />
  ${If} $R2 == `language `<br />
    StrCpy $CfgLanguage $R1 `` 9<br />
    ${TrimNewLines} $CfgLanguage $CfgLanguage<br />
    ${Continue}<br />
  ${EndIf}<br />
<br />
${Loop}<br />
FileClose $R0Stu<br />
<br />
<br />
How hard would it be to also get line number of found string?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">28th October 2012, 07:14</div></div><div class="posttext">Simply add a counter to the loop. Start at zero before ${Do}, then +1 just before you ${Loop}</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>