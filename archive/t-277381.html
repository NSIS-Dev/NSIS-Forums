<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Unicode, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Unicode NSIS Discussion" />
	
	<title> Unicode [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Unicode</div>
<hr />
<div class="pda"><a href="t-277381.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=277381">Unicode</a></p>
<hr />
<div id="pagenumbers"><b>Pages :</b>
[<b>1</b>]
<a href="t-277381-p-2.html">2</a>
<a href="t-277381-p-3.html">3</a>
</div>
<hr />

<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th September 2007, 11:41</div></div><div class="posttext">Jim Park has issued a patch to add Unicode support to NSIS. Currently it's a completely different build that can create nothing but Unicode installers (no Windows 9x support).<br />
<br />
Please help me test it for speedier integration.<br />
<br />
https://sourceforge.net/tracker/?func=detail&amp;atid=373087&amp;aid=1795257&amp;group_id=22049<br />
<br />
You can download a pre-built version from:<br />
<br />
http://www.scratchpaper.com/nsis-05-Sep-2007.cvs-unicode-setup.exe</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">15th September 2007, 14:23</div></div><div class="posttext">Thanks for posting that kichik.<br />
<br />
A few things to note.  The Unicode NSIS installer is COMPLETELY Unicode.  This means that your NSI script must also be Unicode (UTF-16LE).  This can easily be done by using Notepad.  Just change the encoding to &quot;Unicode&quot; and that will do it.<br />
<br />
Note that the plugins you may be relying on will not work unless they are also built with Unicode in mind.  This means that the access to the global stack that is used to transmit information back and forth from plugin to NSIS must contain Unicode (wchar_t) strings.<br />
<br />
*** Developers ***<br />
If you are a plugin author, it shouldn't be too difficult to make the changes.  You can take a look at what I did for the standard plugins that ship with NSIS. The source is here:<br />
<br />
http://www.scratchpaper.com/source.zip<br />
<br />
If you look at ExDLL, you will notice new functions that will help you with the translation of the stack as well.  For instance, if you DLL only cares about ASCII codesets, then you may not need to do much modifications at all.  It just needs to call the new functions that automatically translate the stack's strings from Unicode to ANSI and ANSI to Unicode.  But most likely, if you are dealing with user entered strings, you will need to make your DLL completely Unicode aware as well.<br />
<br />
The source uses TCHARs so you can target building both ANSI and Unicode versions of NSIS.  It is based on NSIS 2.29 with some bug fixes and minor tweaks.  If you are interested, the ANSI version of the binary built with the same source code is also here:<br />
<br />
http://www.scratchpaper.com/nsis-05-Sep-2007.cvs-setup.exe<br />
<br />
Please look at the tracker submission for more information about building the source yourself.  I developed on VS2005 and I would be surprised if it builds on the other platforms.  Even if they do, I did not change the SCONS config files for the other platforms to define _UNICODE and UNICODE which is what's needed for the source to be built as Unicode.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th September 2007, 21:45</div></div><div class="posttext">Source code link:<br />
<br />
http://www.scratchpaper.com/source.zip<br />
<br />
ANSI version link:<br />
<br />
http://www.scratchpaper.com/nsis-05-Sep-2007.cvs-setup.exe</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">18th September 2007, 04:42</div></div><div class="posttext">Is this will affect future versions? I mean I'm not a UNICODE fan, but if is it going to be...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">18th September 2007, 11:31</div></div><div class="posttext">Well, the niceness of this approach is that those who want the ANSI version for Win95/98/ME compatibility can use the ANSI version.  For those who need support of languages that only Unicode can provide can use the Unicode version.  It gives you a choice.  And we can give you that choice with one code base.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">HaydenDevlin</div><div class="date">19th September 2007, 14:09</div></div><div class="posttext">I have just adapted my installer to use this unicode version for a russian language installer, and everything seems fine in russian except for some reason the welcome page has loads of question marks instead of the correct characters of the introduction text. It's weird because all the other panels are fine. Does anyone know what is going on here?<br />
<br />
Cheers,<br />
<br />
Hayden Devlin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">20th September 2007, 13:26</div></div><div class="posttext">The introduction text should ALSO be Unicode.  So open it up in Notepad and then save as Unicode encoding.  That should work.  So remember EVERYTHING must be Unicode.  If you have an ASCII file, you need to make sure it's now UNICODE.  Hope this helps.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dienjd</div><div class="date">20th September 2007, 16:41</div></div><div class="posttext">Sounds great. One quick question: what happens when one of these builds gets run on 9x? Is it possible to detect in .onInit and show a MessageBox to the user, or would it just crash immediately? If the latter, then I guess the build could be wrapped by a non-Unicode build that does this detection and messaging.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dienjd</div><div class="date">20th September 2007, 17:48</div></div><div class="posttext">Originally posted by dienjd <br />
Sounds great. One quick question: what happens when one of these builds gets run on 9x? Is it possible to detect in .onInit and show a MessageBox to the user, or would it just crash immediately? If the latter, then I guess the build could be wrapped by a non-Unicode build that does this detection and messaging.  <br />
<br />
I decided to not be so lazy and just try for myself. I compiled Examples\bigtest.nsi and tried it on Windows 98. It crashed immediately, which is expected. However, there are ways to gracefully handle this, as I mentioned in my last post.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">21st September 2007, 00:43</div></div><div class="posttext">how about Microsoft Layer for Unicode on Win95/98/ME (MSLU)?<br />
<br />
http://www.microsoft.com.nsatc.net/globaldev/handson/dev/mslu_announce.mspx<br />
<br />
sounds easy to integrate.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">21st September 2007, 00:57</div></div><div class="posttext">yeah, but you have to ship the MSLU dll along with the installer</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">21st September 2007, 01:06</div></div><div class="posttext">well, at least nsis may get compiled against mslu, so it still works normal on win2k/xp/vista, but also MAY work on win95/98/me IF the user has mslu installed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dienjd</div><div class="date">21st September 2007, 15:56</div></div><div class="posttext">When converting ANSI files to Unicode, I've noticed that the conversion works fine with Notepad, but converting using Textpad or the iconv program on FreeBSD results in the Unicode file not working with Unicode NSIS. <br />
<br />
While testing this patched version of NSIS, I want to be able to automatically convert files as part of a build process instead of maintaining separate copies of the same files but just in different encodings. Notepad doesn't seem to have a command line interface other than 'notepad.exe filename.txt'. I guess I could make something that launches Notepad and hooks the window to do a Save As :)<br />
<br />
This isn't a big deal, but it would be nice to have. Anyone have ideas on how to do this other than the ugly window hooking method?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st September 2007, 16:03</div></div><div class="posttext">There are a few possible reasons. The first is conversion to a wrong charset. Even Unicode has multiple charsets available. Make sure you convert to UTF-16LE.<br />
<br />
Another reason could be a missing BOM. Try perpending the file content with FF FE (the actual bytes, not text).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">21st September 2007, 18:03</div></div><div class="posttext">My thoughts are exactly the same as kichik's.  Here's a little utility I wrote called a2u.exe that converts an ANSI codepage text file to Unicode.  You provide what codepage to use.  So it can be run regardless of your OS codepage setting.  So this will fit your bill in making this whole process automated.  (I didn't convert all the include files, example, etc., by hand, you know?)  It should also be helpful in converting your current NSIS scripts to Unicode as well.<br />
<br />
I included the source as well so you can modify it to work anyway you want.<br />
<br />
Look in http://www.scratchpaper.com/a2u.zip or I'm attaching the file here as well.<br />
<br />
Enjoy.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dienjd</div><div class="date">21st September 2007, 18:11</div></div><div class="posttext">Thanks for the utility and patch. The Unicode support will hopefully save me from having to use InstallShield!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Benski</div><div class="date">23rd September 2007, 03:22</div></div><div class="posttext">Jim - <br />
<br />
We'll give this thing a good workout soon.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Clammerz</div><div class="date">29th September 2007, 20:02</div></div><div class="posttext">Anymore news about this?<br />
<br />
Will it be integrated into the main NSIS branch someday? Any extreme rough timeframes if so? (something like 3 months, 6months a year, etc?)<br />
<br />
I suggest making this sticky since it's pretty important news.<br />
<br />
Thanks heaps for the patch work Jim. Your efforts are greatly appreciated.<br />
<br />
Sidenote question: If you are using the System plugin for API calls, will you have to use the Unicode calls, or can you use the normal ANSI calls too?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th September 2007, 20:58</div></div><div class="posttext">Should be integrated, no timeframes and System can already handle both ANSI and Unicode so nothing should change.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">1st October 2007, 08:48</div></div><div class="posttext">The only change made to System is that all the calls default to Unicode strings rather than ANSI strings.  So for example, if you specified MessageBox(...), then it will actualyl call MessageBoxW(...).  As long as you provide the right function signature, then the System will work as you expect.  I just had to rework some of the interfacing back and forth through the NSIS global stack but using it should be the same.<br />
<br />
You WANT to use the Unicode functions by default because while it will automatically convert Unicode strings to ANSI codepage and back when you call ANSI functions, you may actually lose vital information or get bad behavior if the user's computer's code page setting is different from what you'd expect.  And definitely things will not work if you are trying to provide an installer for a Unicode only language.<br />
<br />
If you are converting your script from the ANSI NSIS to Unicode, and you are using the System plugin, look for functions that are ANSI only.  Most of these end in &quot;A&quot;.  Change them to use Unicode.  Or just specify their &quot;TCHAR&quot; versions -- i.e. MessageBox instead of MessageBoxW or MessageBoxA.  Then the correct one will be picked up by your NSIS installer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">4th October 2007, 20:18</div></div><div class="posttext">Kichik, I was wondering, also, of what it would take for it to be incorporated into the NSIS trunk.  Since the source for Unicode NSIS can generate both Unicode and ANSI versions of NSIS, bug fixes in this version of the source will benefit both the Unicode and the ANSI version.  I would hate to see the Unicode NSIS code get orphaned.  If we wait much longer the code base for the NSIS and Unicode NSIS will diverge too much and someone's going to have to redo the 1.5 months of fulltime work to make it work again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th October 2007, 15:07</div></div><div class="posttext">As I see it, the first step is a completely separate build for Unicode (like 8192 string and logging builds) which will minimally affect the main build. Later, the compiler can start moving towards being able to create either type of installers. Finally, the stubs could be made common so ANSI will be automatically used on 9x and Unicode on any capable system.<br />
<br />
I, too, would hate to see the code gets orphaned, requiring more and more work with each passing version. To get to first step done and integrate it as a separate build, I'd want to make it as hassle free as possible. Currently it seems there are more than a few changes that'd require extra maintenance and will serve useful only for the Unicode build. All of the SConscript changes are good example. There is no need for duplication of examples and such - makensis.exe should be able to read ANSI scripts and differentiate Unicode scripts according to BOM.<br />
<br />
Another minor example is wininit.ini handling. Since that's only supported on 9x, the code could be completely removed for Unicode builds and there's no need for the conversions and Unicode specific code paths.<br />
<br />
Lines 716-726 in Source\exehead\util.c could be reduced to a cast to char*.<br />
<br />
NSIS Menu doesn't have to be Unicode. But I guess it'd be useful for translated packages of NSIS itself. In that case, it'd be easier to have wxUSE_UNICODE defined externally or according to _UNICODE instead of having two setup.h.<br />
<br />
In short, every #ifdef _UNICODE or separate Unicode file is more work down the line. I can't ask you to make all the changes, but that's what I'll do when I integrate it. I will probably do it gradually, but I'll definitly start with automatically generating the duplicate files or getting rid of the need for them.<br />
<br />
If you do, however, wish to help with this, I can create a branch for this in the soon-to-live SVN repository where you can check-in the changes. I will also do my best to sync it with trunk for every released version (which hopefully won't be too many).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th October 2007, 15:13</div></div><div class="posttext">Just had a look at Benski's Unicode branch and saw he used a nice trick to get around the CHAR4_TO_DWORD optimization - QTCHAR.<br />
<br />
http://nsis.cvs.sourceforge.net/nsis/NSIS/Source/exehead/Main.c?r1=1.71.2.1&amp;r2=1.71.2.2&amp;pathrev=UNICODE</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">11th October 2007, 04:29</div></div><div class="posttext">Actually, I disagree that the examples and NSIS include files should be generated from a single source for both.  Eventually, the number of languages supported for Unicode will continue to grow while the number ANSI languages have already stopped growing.  The common subset (e.g. Latin I) may be able to share a common source but even then there are things like System calls that will be subtly different for ANSI and Unicode.  Much like the C++ source itself, we may have to add #ifdef UNICODE or some equivalent into the NSIS scripts if we pursue having one source script for both.  But again, I imagine that the Unicode languages will continue to grow which will never have an ANSI counterpart.  And Win9x/ME OSes will continue to dwindle in significance.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th October 2007, 00:09</div></div><div class="posttext">But currently there are none and so it generates an unjustified work overhead. Updating an example requires updating two files. That's always a cause for nice little &quot;oops&quot; bugs.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">16th October 2007, 14:37</div></div><div class="posttext">That is true.  So for now, I do have that a2u.exe that I've uploaded here.  We can use it as part of the build process to take the ANSI scripts and convert them to Unicode ones for those which are easily derivable.  For those that do need hand tweaks (there may be a few), we can keep those separate.  For scripts that use the System plugin, for example, we need only use the API without the &quot;W&quot; or &quot;A&quot; as the suffix i.e. don't use MessageBoxA or MessageBoxW just MessageBox and the correct version will be picked up by the System plugin.  So I think it's quite possible to achieve a unified single source for most scripts.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">7th November 2007, 16:11</div></div><div class="posttext">I may have misunderstood your post.  If you mean that there are no languages that are Unicode-only, then here are some:<br />
1. Amharic<br />
2. Armenian<br />
3. Assamese (India)<br />
4. Bengali (India)<br />
5. Divehi (Maldives)<br />
6. Georgian<br />
7. Gujarati<br />
8. Hindi<br />
9. Inukitut (Canada, Syllabics) -- not the Latin-based one<br />
10. Kannada<br />
11. Khmer (Cambodia)<br />
12. Konkani<br />
13. Marathi<br />
14. Nepali<br />
15. Punjabi<br />
16. Sanskrit<br />
17. Sinhala (Sri Lanka)<br />
18. Telugu (India)<br />
<br />
The list is growing.  Also, many people including myself run apps localized to a different language than the codepage of the OS that they're running.  So the desire for Unicode support for an installer is there and the need is getting stronger.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th November 2007, 19:21</div></div><div class="posttext">There are none in NSIS. And even if language files are added for those, it still doesn't justify having every example in Unicode as most examples don't demonstrate multiple languages and those that do, usually do this with a small collection of languages.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AxelMock</div><div class="date">8th November 2007, 08:24</div></div><div class="posttext">Originally posted by kichik <br />
There are none in NSIS. And even if language files are added for those, it still doesn't justify having every example in Unicode as most examples don't demonstrate multiple languages and those that do, usually do this with a small collection of languages. <br />
<br />
Hi, <br />
<br />
I find the idea of a unicode capable NSIS compiler great.<br />
I've built an (standard NSIS)installer for network drivers which currently supports 25 languages, including 2 RTL languages.<br />
<br />
If we had to add some extra dialogs or messages all translation services would deliver unicode files. <br />
I haven't yet understood or found a detailed explanation of how to safely convert unicode texts into NSIS codepage-based strings.<br />
Being able to directly use unicode strings would significantly ease localization.<br />
<br />
In my work I normally use PERL and the automated generation of Windows driver .inf files (UTF-16) is done by PERL scripts.<br />
But NONE of the sources/templates, except for the NLS dependent parts (strings and readme files), are in UTF-16. As PERL uses UTF-8 internally  and ASCII is a real subset of UTF-8 there is no need to have program sources in UTF-16.<br />
When including a NLS file, which is in UTF-16, this is detected at read time. <br />
<br />
I don't know if the Microsoft C++ API only supports UTF-16, but I think it should not be a great problem to have a smart &quot;read file&quot; function which does detection and conversion, even if internally all is handled in UTF-16.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th November 2007, 17:04</div></div><div class="posttext">I don't know if the Microsoft C++ API only supports UTF-16, but I think it should not be a great problem to have a smart &quot;read file&quot; function which does detection and conversion, even if internally all is handled in UTF-16.They support both ANSI and UTF-16. There is even a function for determining if a buffer is Unicode or not. The standard even defines special markers for files that specify if they're ANSI, UTF-8, UTF-16LE or UTF-16BE. They are called BOMs.<br />
<br />
It shouldn't be too hard to make the compiler support both ANSI and UTF-16. But I'm just saying it won't serve too much of a purpose to have the examples in SVN in both ANSI and UTF-16. There are currently no examples whatsoever that need Unicode. If there will ever be, they can be specific to the Unicode build.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">8th November 2007, 20:45</div></div><div class="posttext">As I mentioned before, for the languages that have codepage support, I simply ran a a2u.exe to convert the ANSI script to the Unicode script.  I did not hand edit all of those.  I don't know 25 languages, after all. :)  So you could have one source file for each language and then GENERATE ANSI and Unicode versions of the example files.  So in essence, you never have &quot;oops&quot; mistakes because there is only one source.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">KrisAster</div><div class="date">8th November 2007, 21:10</div></div><div class="posttext">From your reply, Kichik, it seems as though there IS going to be a Unicode build of some form.  Is this correct?  Does that mean that this Unicode build is going to be integrated into the main release sometime soon?<br />
<br />
If so, that will be great.  I for one have need for an installer in one of the languages mentioned below (Georgian), and next year I may have need of one of the others.  PLUS, the benefits of not having to switch code-pages in order to have the install show up with intelligible text is also very nice.<br />
<br />
Additionally, how many people have tried this version of the installer?  I'd like some idea of how stable it is and how it is supported on different OSes.  My experience so far has been very good.  I was able to build my install with the version made available here without any changes to my script (other than saving the file in Unicode), and it is a pretty large script (1K lines).  I'm now in the process of localizing the Georgian version, and I'll make sure to post back with how successful the results were.<br />
<br />
Unicode seems to be the wave of the future, and I'll be really happy to see NSIS make the path available for those of us who want it.  After all, the product I'm shipping does not support any of the ANSI versions of Windows, and Microsoft doesn't support them anymore either.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th November 2007, 23:02</div></div><div class="posttext">KrisAster, there's no time frame and my bet won't be on soon.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">19th November 2007, 21:59</div></div><div class="posttext">For those using the Unicode version of NSIS, I took the latest 2.33 source and merged the changes onto the Unicode version.  The new binaries and source are posted to http://www.scratchpaper.com. Let me know if you find any problems with this release.  Also let me know if you find the Unicode version useful.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">21st November 2007, 16:39</div></div><div class="posttext">I modified the Unicode language files in the installer to contain vernacular names for the various languages.  So you can do something like this:<br />
http://www.scratchpaper.com/Unicode-NSIS-Propaganda.gif</div></div><hr />


<div class="post"><div class="posttop"><div class="username">havas</div><div class="date">24th November 2007, 12:52</div></div><div class="posttext">Thanks for this work. the unicode build works well.<br />
I'm chinese, and using japanese windows edition to study japanese. And really many chinese language only nsis setup bother me which can't display correctly on my system.<br />
Really great, hope this Unicode support feature will be merged into the official NSIS.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CodeSquid</div><div class="date">27th November 2007, 13:54</div></div><div class="posttext">Thanks for your patch, it seems to be working great.<br />
<br />
I'd love to see this included in the official source.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">12th December 2007, 20:48</div></div><div class="posttext">Unicode NSIS has been updated to support Georgian (a Unicode only language).  Updated Unicode Simplified Chinese language files.  Also fixed some bugs in<br />
Unicode Turkish language file and Unicode zip2exe.  Please give it a whirl and let me know if you see any more problems.  As always, the site is http://www.scratchpaper.com</div></div><hr />


<div class="post"><div class="posttop"><div class="username">prz</div><div class="date">14th December 2007, 15:54</div></div><div class="posttext">I'm trying to use your Unicode version. It works well until the use of some plugins.<br />
I tryed to convert the GetVersion plugin of AfroUK.<br />
I put your exDLL and recompiled with no success: the compiler give me some errors. I think that the problem is the definition of _UNICODE but I don't know where to put it (I don't know C++ and its compiling process).<br />
If someone tells me how to do it, I think I'm able to translate the others plugin I need for my installer.<br />
<br />
Thank you</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">15th December 2007, 18:09</div></div><div class="posttext">Well, it will be a bit difficult not knowing C++ if you want to convert other plugins.  But you could try downloading the source from the NSIS branch, then download the source from my site.  And you could compare the source files for a smaller plugin like LangDLL and see what the differences are.<br />
<br />
BTW, other than the GetVersion plugin, what other plugins do you use?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">prz</div><div class="date">17th December 2007, 07:15</div></div><div class="posttext">Yes, C++ isn't the perfect language to make small change for a person doesn't know it.<br />
Anyway I'll try to do it (is this the right time to study even the C++ :D ?).<br />
<br />
These are the plugins that I use in my installer:<br />
- GetVersion (to kown the Windows and IE versions and the OS architecture)<br />
- GetSize (to know the size of the data folder)<br />
- HwInfo (to know the processor name)<br />
- nsProcess (to kill a process before uninstalling)<br />
<br />
Bye</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CodeSquid</div><div class="date">17th December 2007, 07:42</div></div><div class="posttext">Yes, C++ isn't the perfect language to make small change for a person doesn't know it.<br />
No language is.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">prz</div><div class="date">17th December 2007, 09:27</div></div><div class="posttext">Originally posted by CodeSquid <br />
No language is.  <br />
<br />
You're right, but C++ isn't the easier one.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">prz</div><div class="date">17th December 2007, 09:37</div></div><div class="posttext">Originally posted by jimpark <br />
Well, it will be a bit difficult not knowing C++ if you want to convert other plugins.  But you could try downloading the source from the NSIS branch, then download the source from my site.  And you could compare the source files for a smaller plugin like LangDLL and see what the differences are.<br />
<br />
BTW, other than the GetVersion plugin, what other plugins do you use?  <br />
<br />
I converted GetVersion and works well only under ANSI version (like the original one). Can be the problem in the definition of _UNICODE (I don't find it)?<br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">prz</div><div class="date">17th December 2007, 12:42</div></div><div class="posttext">Originally posted by prz <br />
I converted GetVersion and works well only under ANSI version (like the original one). Can be the problem in the definition of _UNICODE (I don't find it)?<br />
<br />
Thanks  <br />
<br />
I added the _UNICODE string to the pre-processor strings, but the output of the plugin is the same of the ANSI version.<br />
something else to make a unicode version of the plugin?<br />
<br />
Bye</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sfidanza</div><div class="date">30th December 2007, 03:12</div></div><div class="posttext">Thanks for the great work on Unicode NSIS, and for hosting it. I just used it for an english/french/czech installer (and I should be adding more languages soon). It still needs to be more thoroughly tested but it seems to have worked fine. :)<br />
<br />
A note though: I didn't convert the install script itself to UTF16-LE (I did at first but NIS Edit wouldn't display it correctly). It worked anyway. It was completely ANSI, but ANSI is not a subset of UTF16 so I'm (happily) surprised.<br />
<br />
I consider Unicode as the way to go: displaying multiple or Unicode-only languages is more and more needed, and I'm really glad that NSIS is moving to complete Unicode support. :up:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">30th December 2007, 12:17</div></div><div class="posttext">Thank you for the kind words of encouragement.  I've never used NIS Edit but I take your word for it that it doesn't understand UTF16.  If you didn't convert the script to Unicode, perhaps the ANSI one was run and it created an ANSI installer?  One thing you could do is check that the ANSI one works first, then convert it to Unicode using notepad or a2u.exe and then create the installer again using the Unicode version.  If it worked for the ANSI it will most likely just work for the converted Unicode version (barring the use of 3rd party plugins that have not been converted to support Unicode.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sfidanza</div><div class="date">30th December 2007, 13:42</div></div><div class="posttext">Actually, the ANSI script was compiled with classic NSIS until now. It works correctly. But I wondered if making a unicode installer was possible, and found out about Unicode NSIS.<br />
I don't use any 3rd party plugin, only language files, which I converted to UTF16-LE. And I updated the link to the compiler in NIS Edit to Unicode NSIS. The only issue was that NIS Edit displays only the BOM of a unicode script.<br />
<br />
Classic NSIS wouldn't compile even the ANSI script (using unicode language files), but Unicode NSIS produces a working installer.<br />
<br />
However, I just compiled the Unicode script on Unicode NSIS, and did a byte-to-byte comparison of the 2 &quot;unicode&quot; .exe installer: they are indeed not exactly the same.<br />
I couldn't spot any difference by running them though, even with czech texts (usually requiring CP1250 while I use CP1252 myself). I'll have to test with russian or chinese.<br />
<br />
Anyway, I'll use the unicode script from now on to be on the safe side.<br />
I described everything here in case it is of some help to you. I'll be happy to make some more tests or give some more details if you wish.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">30th December 2007, 17:36</div></div><div class="posttext">What about making a Unicode version that supports both Windows 95/98/Me as well as Windows 2000/XP/Vista? I think it should be possible to have scripts and internal NSIS strings in Unicode but convert the user interface strings to ANSI for 95/98/Me.<br />
<br />
Because there is no simple one-to-one conversion of ANSI NSIS scripts to Unicode (multiple codepages can be used in a single file for e.g. LangStrings), we can just call it NSIS 3.0 and require scripts to be in Unicode.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">30th December 2007, 23:00</div></div><div class="posttext">Actually the problem is during the loading the exe and dynamic link time.  By using Unicode-based Win32 calls, the program fails to even run.  Not sure how to solve that except by distributing unicows.dll with the installer on Win9x.  But seriously, I think we should just drop Win9x support soon.  Looking at browser OS stats at http://www.w3schools.com/browsers/browsers_os.asp, only 1% of the web users use Win98.  And the demographic for users of products that ship with NSIS installers are probably netizens.  Every year that passes by, the need to support Win98 and therefore both ANSI and Unicode will dwindle.  We will eventually only need Unicode. :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">31st December 2007, 15:35</div></div><div class="posttext">Merged in 2.34 changes into the Unicode version of NSIS.  Go to the usual place: http://www.scratchpaper.com for the binaries and source.<br />
<br />
Added Pashtu support.  Thank you Zabeeh khan.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CodeSquid</div><div class="date">1st January 2008, 12:09</div></div><div class="posttext">I've tried to compile your patch on Linux but it utterly failed.<br />
<br />
Can you please update your patch so that it compiles on Linux?<br />
If you don't have Linux, you can download it from http://www.ubuntu.com/</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">1st January 2008, 13:10</div></div><div class="posttext">Originally posted by jimpark <br />
Actually the problem is during the loading the exe and dynamic link time. By using Unicode-based Win32 calls, the program fails to even run.<br />
It's possible to call these APIs on run-time depending on the Windows version. A framework for this method is already included in the NSIS source and is used for various functions that are not available in all Windows versions.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">1st January 2008, 14:18</div></div><div class="posttext">CodeSquid, it's not that I don't have Linux.  I did this project because of a need for a Unicode installer on Windows for the project I'm working on.  I'm giving the source back to the community as-is.  I'm only updating the code so that my code base doesn't go out of sync with the latest changes.  And I'm offering it to the public and especially the NSIS developer community so they can potentially use it to create an official Unicode version of NSIS.  And while there isn't such, the developers who need a Unicode solution for their installer will have something that works right now.  I could just update it internally and never let anyone else use it or see it but that would not be following the spirit of open source.  I don't have the time or resources to make sure  the source builds on Linux, Mac and whatever else NSIS usually can build on.  So if it's important to someone that the Unicode source builds on Linux or on the Mac, I hope that someone steps up to the plate and makes it work for those OSes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CodeSquid</div><div class="date">1st January 2008, 15:02</div></div><div class="posttext">I'd very much like this in the official NSIS code. Unfortunately I don't have the time to work on this either. :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">1st January 2008, 18:04</div></div><div class="posttext">I think it will require quite some effort to have combine a non-Unicode/Unicode version in the same source. This would also cause a lot of trouble with plug-ins. Having a major new release (NSIS 3.0) with only Unicode support and Unicode script files would probably be a better solution.<br />
<br />
If only Windows 2000 and later need to be supported, the current Unicode version is mostly complete (expect for some issues like Linux compilation). Windows 95/98/Me cannot be supported forever. Microsoft has  dropped support for all these versions some time ago, so there are also no more security fixes. The C++ runtime of Visual Studio 2008 doesn't even support them anymore.<br />
<br />
So maybe this would be the time to remove legacy stuff and introduce some breaking changes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">14th January 2008, 02:23</div></div><div class="posttext">I'd like to suggest support for UTF-8 scripts, with and without BOM. I exclusively do UTF-8 without a BOM, as I feel it hurts more than it helps: it only serves as identification (even though in almost all cases, you'd do just fine by assuming UTF-8, and using ANSI as a fallback), and excluding it allows for a neater handling by non-Unicode programs.<br />
<br />
If the file is BOM-less and contains invalid UTF-8, I think it should be read as ANSI and internally converted to Unicode for the actual installer. Such behavior would help reduce the effort needed to migrate installers to Unicode, as it should allow most existing scripts to continue compiling with no changes (as long as they don't use any plugins not supplied with NSIS).<br />
<br />
I do realize there's a potential problem when a file in a different codepage is included from the script. This could be solved in various ways, such as using a stack to keep track of codepage information. Whenever inclusion starts, the current info is pushed onto the stack. When inclusion stops, pop it back.<br />
<br />
Although there is a risk of incorrectly interpreting an ANSI script as UTF-8, it is extremely slim, due to the fact that it requires some very specific byte patterns as the only non-ASCII text in the entire script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">15th January 2008, 13:08</div></div><div class="posttext">The real crux of the problem is the conversion from ANSI to Unicode.  What codepage should you use?  Hopefully, the script has that information.  But even if it does, it may mean you have to parse a significant portion of the scripts to figure out which code page the text is in which means writing a lot of code that is not there currently.  Or I guess you could default to using the system codepage but that may not be the intent of the developer.  If someone develops a Chinese installer and gives it to someone who uses an English codepage on their machine, the same installer would produce junk characters on its messages.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">15th January 2008, 14:05</div></div><div class="posttext">Originally posted by jimpark <br />
Or I guess you could default to using the system codepage but that may not be the intent of the developer.  <br />
<br />
I'm not sure you understood me correctly, but my idea is to use the system codepage to convert it at compile-time; allowing us to minimize issues. It would likely be best to issue a warning about ANSI scripts being deprecated when it has to do this, so the developer knows to use UTF-8 or UTF-16 instead of relying on the system codepage.<br />
<br />
If someone develops a Chinese installer and gives it to someone who uses an English codepage on their machine, the same installer would produce junk characters on its messages.  <br />
<br />
As long as they only get the compiled installer, no problem, as it would have been handled by then. If they distribute the actual ANSI script, without realizing this change had happened, then yes, they'd have a problem, but this should not happen very frequently - even less if we issue that warning - and the fix is simple; that particular script just needs to be converted into a Unicode format.<br />
<br />
For installers creating a dynamic script, nothing prevents us from using UTF-8 as a default output codepage for file writing to minimize issues; as long as they are able to change it from the script (for when they need a specific codepage). Yes, that one would require a change, but you'd be affecting fewer scripts, thus easing migration.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">15th January 2008, 18:34</div></div><div class="posttext">Yes, I do understand you.  I am talking about the developers sharing scripts with different codepages set on their machines.  The problem you are trying to fix... which is converting their ANSI scripts to Unicode is trivial.  Open it up in notepad.exe and save as Unicode.  Or use the a2u.exe program I provided.  All the proposed changes you are talking about only saves the little tiny headache of converting your script once to Unicode.  The real problem is that people write scripts that are shared like libraries, like the language files.  They all still need to be converted to Unicode, whether UTF-8 or UTF-16 before they are shareable with others.  There's no way around that.  We can do some intelligent guessing as the NSIS program parses the ANSI scripts but it may not always be correct.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">15th January 2008, 20:28</div></div><div class="posttext">I don't think there is any possibility to convert existing scripts automatically.<br />
<br />
There is no way identify the codepage of a script file, the bytes just have a different character representation depending on the users codepage. Script files can even contain multiple codepages (for example, if language strings are combined in a single file).<br />
<br />
On run-time, texts that are sent to the dialogs can come from any source on the system, complete outside the installer itself. Again, no automatic conversion is possible. Things become even more complicated when external DLLs (including NSIS plug-ins) are called that return ANSI strings.<br />
<br />
Taking this all into account, I think the only realistic thing is to release a new major version that will be Unicode-only.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">15th January 2008, 20:50</div></div><div class="posttext">Of course not, and you're right - those scripts would need to be converted. But we're not going to get around such an issue no matter what we do; and I don't see it as a good idea to cause extra hassle for everyone writing non-English single-language installers, compared to causing a little more work for those that would actually benefit greatly from converting it to Unicode - at least not for the first official Unicode release.<br />
<br />
Also, are the amount of &quot;non-native-codepage&quot;-dependent scripts really that big? I'm under the impression that many people stick to the bundled stuff, which would already be Unicode, or have already switched to the Unicode build.<br />
<br />
EDIT: Good point, Joost - I hadn't considered external calls. Alright, never mind the ANSI then.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">17th January 2008, 11:05</div></div><div class="posttext">IMHO two article developers or NSIS script creators should read (I mean really READ...)<br />
<br />
http://www.microsoft.com/globaldev/handson/dev/mslu_announce.mspx<br />
<br />
http://www.joelonsoftware.com/articles/Unicode.html<br />
<br />
Note that this message is NOT to insult, it's purpose is to help getting Unicode support in a decent smooth upgrade path to NSIS. Lots of people have lots of good ideas but somehow we have to create it...that will mean some fierce pro/cons discussions. But take for example Jim Park's initiative, it is *great*, he got things rolling for Unicode for him because he has a need and just created his own build!<br />
<br />
It is also not that I personally still would support for Win9x/ME, but a lot of third pary software uses NSIS e.g. the Firefox installer on Win32, they are affected if there is an &quot;Only&quot; unicode build&quot; with no backwards compatibility layer.<br />
<br />
For those who do not know: &quot;kichik&quot; knows possibly the best what path to choose, and if he doesn't he still does ;) after all he does a major amount of the NSIS development.<br />
<br />
But I also see the points by Joost, Unicode only major release to avoid confusing people which NSIS to use, and after all still 2.x can be used for non Unicode releases.<br />
<br />
And for the plugins, most of them come with source, should we already ask the plugin creaters nicely to make them Unicode compatible if needed and not done so already?<br />
<br />
...so now MY first step will be, make the plugins I've created unicode compatible, even if not used yet...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">17th January 2008, 17:13</div></div><div class="posttext">Windows 95/98/Me support would require NSIS itself and all plug-ins to provide both an ANSI and a Unicode user interface. If external APIs are used to modify the interface, scripts would also have to check whether ANSI or Unicode is used and do the required conversions.<br />
<br />
All scripts need to updated anyway if NSIS uses Unicode internally, even if the user interface is still ANSI. The fact that an ANSI interface is still available would only improve backwards compatibility a little.<br />
<br />
Because this is all very complicated, I'm afraid we don't have the manpower to implement it within a reasonable time.<br />
<br />
Almost all new applications that are developed (e.g. Firefox 3) don't support 95/98/Me anymore. If legacy Windows versions still need to be supported for an installer, NSIS 2 can be used.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sfidanza</div><div class="date">17th January 2008, 17:30</div></div><div class="posttext">As an interested outsider here, I can say I would largely prefer having an officially maintained Unicode NSIS (NSIS3), with an unofficial ANSI legacy version (for example if new features would be backported to NSIS2). That is to say, of course, if a choice has to be made, since limited resources always push to make choices.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">17th January 2008, 17:33</div></div><div class="posttext">I think both NSIS 2 (ANSI) and NSIS 3 (Unicode) can remain official versions. However, we won't really have enough resources to backport features.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">17th January 2008, 21:47</div></div><div class="posttext">If we use TCHAR style macros in the C/C++ source, we can use one set of source files to generate both the ANSI and Unicode binaries.  I know some people don't like the use of TCHARs but that's the choice I made because of the convenience of having one common set of source files for both binaries.  So I know I can make changes to the source that will be reflected in both the ANSI and the Unicode versions. This should help in keeping NSIS ANSI and NSIS Unicode features in sync.<br />
<br />
The other problem is the script files -- it's painful keeping two sets of script files as kichik pointed out.  But I think most of the behavior enhancing script files are plain ASCII files which can easily be converted to Unicode and back to ANSI.<br />
<br />
The language files, however, I think we need to keep separate because the two sets will have to be different.  For one, the number of Unicode language files will be bigger than the ANSI.  In fact, it already is in my build.  And two, the Unicode script files can have the language name itself in its vernacular because the Unicode binaries can show them all at the same time.<br />
<br />
Consider the multi-language installer demo picture on my website.  It's a very powerful argument for being able to generate Unicode installers.  I know of one case where a software targeted to the Chinese audience had two installers -- one in Traditional Chinese and the other Simplified Chinese.  And they were able to use the NSIS Unicode multi-language installer to show the instructions / license agreement in both Traditional and Simplified at the same time.  That's over a billion people that can benefit from that sort of flexibility.  India also has a huge set of scripts for its languages.  With China and India together, you've got almost half of the world's population! :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">17th January 2008, 22:54</div></div><div class="posttext">A mixed ANSI/Unicode (ANSI on 95/98/Me and Unicode on NT/2000/XP/2003/Vista) stub is almost impossible as I pointed out, so building ANSI-only and Unicode-only stubs from the same source may indeed be a good option!<br />
<br />
If the compiler would automatically convert Unicode scripts to ANSI (using multiple codepages in a script if necessary, just like the situation is right now), language files and example scripts not using special features would be compatible with both versions (solving the issue kichik pointed out). A simple define (!ifdef UNICODE ...) can allow more advanced scripts (such as the Modern UI) to support both stubs. A script command (independent of the script encoding) can then be used to select what stubs should be used. <br />
<br />
We would need two folders for the plug-ins, because the ANSI stubs can only use ANSI plug-ins and the Unicode stubs can only use Unicode plug-ins. All standard NSIS plug-ins can of course support both (using the TCHAR thing).<br />
<br />
You'll have to ask kichik about his opinion. Maybe you can work on implementing Unicode in a different branch of the official NSIS SVN repository.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">high1</div><div class="date">12th February 2008, 08:50</div></div><div class="posttext">What about FileOpen function in Unicode version? If a file does not exist, does it create an ANSI or Unicode file? There should be a way of creating an Unicode file, and maybe there is, but I didn't find it. Sorry if my question is out of place here, but I did try general forum and got no replies.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">12th February 2008, 11:29</div></div><div class="posttext">Use FileOpen and use FileWriteUTF16LE.  If you want to write a BOM at the beginning of the file, you should be able to using FileWriteWord file_handle &quot;65279&quot; which is U+FEFF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">high1</div><div class="date">13th February 2008, 13:23</div></div><div class="posttext">Did that and it works perfect, thanks. However, if I try same approach with header I'm tinkering with to make it work with Unicode version of NSIS, I get garbage in file. I'm no expert in NSIS, but I have tried to find the cause of it, and I think that usage of FileJoin from TextFunc.nsh is causing the garbage in final file, since header uses that function to join two files. Files are utf16le, and here is a part of the function :<br />
<br />
<br />
define ${_TEXTFUNC_UN}FileJoin `!insertmacro ${_TEXTFUNC_UN}FileJoinCall`<br />
...<br />
FileOpen $3 $4 a<br />
IfErrors error<br />
FileSeek $3 -1 END<br />
FileRead $3 $5<br />
StrCmp $5 '$\r' +3<br />
StrCmp $5 '$\n' +2<br />
FileWrite $3 '$\r$\n'<br />
FileOpen $0 $1 r<br />
IfErrors error<br />
FileRead $0 $5<br />
IfErrors +3<br />
FileWrite $3 $5<br />
goto -3<br />
FileClose $0<br />
FileClose $3 <br />
...<br />
<br />
Maybe the bold part is causing problems? Should there be FileWriteUTF16LE and FileReadUTF16LE calls? Or maybe not, beacuse of the define? I tried to place UTF functions, but this function produces no file then. Any thoughts, Jim?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">13th February 2008, 14:07</div></div><div class="posttext">If you want this function to work for Unicode files, I think you'll have to create a Unicode version.  Copy the macro and as you suspected, you need to convert the FileRead and FileWrite calls to the UTF16LE versions.  You might have to open the files as binary as well.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">high1</div><div class="date">13th February 2008, 23:31</div></div><div class="posttext">Got it working. Thanks for all the help and sorry for bugging you. The function does not work with Unicode files - had to change calls, that was obviuos. But this script with UTF produces errors, and I am not sure why - so I had to do this:<br />
(changes are bolded).<br />
<br />
FileOpen $3 $4 a<br />
;IfErrors error <br />
FileSeek $3 -1 END<br />
FileRead $3 $5<br />
StrCmp $5 '$\r' +3<br />
StrCmp $5 '$\n' +2<br />
FileWrite $3 '$\r$\n'<br />
FileOpen $0 $1 r<br />
;IfErrors error<br />
ClearErrors<br />
FileReadUTF16LE $0 $5<br />
IfErrors +3<br />
FileWriteUTF16LE $3 $5<br />
goto -3<br />
FileClose $0<br />
FileClose $3<br />
<br />
The header in question is Advanced Uninstall Log, and I'm going to send changes to RedWine. I also had to change Serbian.nlf as UTF16LE is a pile of rubbish.<br />
This<br />
     <br />
should be, in fact, this<br />
      <br />
but I guess it's all Greek to you. :D<br />
Anyway, thanks, Jim - it sure is great to have a Unicode installer which produces Unicode log, and I can install in Unicode named folder, and uninstall files automatically.<br />
Going to send you correct Serbian.nlf.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">14th February 2008, 00:12</div></div><div class="posttext">I appreciate that.  Looking forward to getting those files.  It's good to know that the Unicode version of NSIS is actively being used.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">18th February 2008, 21:59</div></div><div class="posttext">NSIS Unicode has been updated to 2.35.  Please go to the usual spot to download the binaries and the modified source: http://www.scratchpaper.com.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">high1</div><div class="date">19th February 2008, 14:09</div></div><div class="posttext">Is there any particular reason why there are no registry entries at HKLM -&gt; Software -&gt; NSIS for VersionMajor and VersionMinor? ANSI release writes current release values there. Is there another way to get version of NSIS with which the script was compiled? <br />
Regards.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">19th February 2008, 15:29</div></div><div class="posttext">It's because I've been building without specifying revision number and build number.  I'm surprised you're the only one who brought this up.  Thank you.  The files have been updated on my site.  Now NSIS Unicode will put the version info under Software/NSIS/Unicode.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">high1</div><div class="date">19th February 2008, 18:49</div></div><div class="posttext">Thanks. I was using this to read the version of NSIS I've used for buliding the installer so noticed it was missing...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">3rd March 2008, 00:39</div></div><div class="posttext">Is there a way to detect if the compiler is unicode, meaning, is there a defined symbol like __NSIS_UNICODE__ in the unicode build? If not, you should add it so that 3rd party header files for stuff can support both ansi and unicode in one file</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">3rd March 2008, 14:17</div></div><div class="posttext">That's not a bad idea.  I will add it to the next version.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">3rd March 2008, 15:09</div></div><div class="posttext">I just made the tweak and modified the binary on my website to include the NSIS_UNICODE predefine for the Unicode build.  Enjoy.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Benski</div><div class="date">16th March 2008, 19:12</div></div><div class="posttext">7zip will not open the installer archive properly.  I get rubbish filenames.  Not sure if it's something that 7zip would need to fix, though.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th March 2008, 21:01</div></div><div class="posttext">7-zip expects a very specific format from the installer. One of its assumptions is that the string table is saved as ANSI. It's not such a faulty assumption when you add in the no-real-nsis-binary-specification factor.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">17th March 2008, 13:47</div></div><div class="posttext">So does the installer still work?  Is it just that a 3rd party app can't open the Unicode-NSIS generated file?  If so, then I don't think we can do much about that.  If the installer doesn't work with 7zip compression algorithm, that's something I can look into.  But the notion I had was that NSIS used those compression algorithms for its own nefarious purposes, not that it had to adhere to some binary format.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Benski</div><div class="date">17th March 2008, 17:52</div></div><div class="posttext">The installer works great.  It's just that I often use 7zip's ability to open the installer in order to extract the binaries for crash dump debugging.  Not a big deal, but I miss the feature :)  Maybe there's a way for the 7zip author to add special handling for Unicode NSIS.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Benski</div><div class="date">20th March 2008, 16:52</div></div><div class="posttext">A helpful hint to anyone converting their NSIS scripts to Unicode.  Be sure to change your System::Call stuff to use w. instead of t. for string types!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">20th March 2008, 17:04</div></div><div class="posttext">but is that the way it should work? The system plugin should probably be changed so that &quot;t&quot;=&quot;w&quot; in the unicode build and you can use &quot;a&quot; for forcing ansi strings. Should help keep things portable, but some stuff might break</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Benski</div><div class="date">20th March 2008, 18:10</div></div><div class="posttext">Yeah, I agree with that idea.  Although 'a' is already taken to be a shortcut for the chosen language</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">20th March 2008, 19:12</div></div><div class="posttext">&quot;a&quot; is not taken as a param type, only source/destination, but I'm not sure if the parser could handle using &quot;a&quot; for two different things. using @ might be a little weird, maybe &quot;z&quot; for zero terminated or whatever unless someone has a better idea<br />
<br />
OT: also, adding support for &quot;p&quot; for pointers might ease a future move to 64 bit</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sridhare</div><div class="date">2nd April 2008, 12:17</div></div><div class="posttext">Hello jimpark,<br />
<br />
Your unicode nsis has been of immense help to me. There seems to be a slight problem with the language selection dialog - the languages that aren't supported by the system also show up and I'm NOT using MUI_LANGDLL_ALLLANGUAGES .<br />
<br />
For example , I'm running the installer on Windows XP with English as the OS language (and I haven't installed the files required for displaying CJK languages). On running the installer , Japanese (actually garbled boxes) also appears in the drop down menu . <br />
<br />
It works as expected on my system where i have installed the files for Japanese i.e., both English and Japanese are displayed. <br />
<br />
It will be great if you can help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">2nd April 2008, 14:03</div></div><div class="posttext">I don't know of a way to enumerate all the supported language scripts on a given user's computer.  I can do it per locale or language but that's not sufficient since the user's computer is usually set to one language/locale but may be able to support scripts of other languages.  If someone knows how to list all the scripts supported by a given system, I think it's just a matter of calling GetStringScripts() and VerifyScripts().<br />
<br />
Anyway, this shouldn't be an issue--everyone should have the East Asian Language support turned on! :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">2nd April 2008, 14:45</div></div><div class="posttext">Unfortunately, those two methods don't exist on versions prior to Vista (and there, East Asian Language support is always turned on) - you can get support on XP SP2 and 2003 SP1, but that requires a separate download (and doesn't help with Win2000).<br />
<br />
You can use EnumSystemLocales (http://msdn2.microsoft.com/en-us/library/ms776334(VS.85).aspx)  with LCID_INSTALLED to check which locales are &quot;ready for use&quot; (if you know specifically which one to check for, you can just use IsValidLocale), or you could check the possible languages groups with IsValidLanguageGroup (http://msdn2.microsoft.com/en-us/library/ms776240(VS.85).aspx) and LGRPID_INSTALLED.<br />
<br />
However, all of this requires that you have a mapping between the languages and the locales (or language group) - I can't remember if that information is currently available to NSIS.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">2nd April 2008, 16:51</div></div><div class="posttext">I don't think it is available hence my initial thought to use GetStringScripts().  Which makes me think that may be the use of the native language to display the language name may not be a good idea.  Or maybe I should combine them together so that there's a legible English version of the name in the drop down menu along with it in the native script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sfidanza</div><div class="date">2nd April 2008, 20:28</div></div><div class="posttext">Couldn't it be a missing font issue, rather than an unsupported language?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">2nd April 2008, 21:08</div></div><div class="posttext">Technically, on NT-based OSes, it's ONLY a matter of a missing font (and to some degree, the version of Unicode they support), but that's why LCID_/LGRPID_INSTALLED should be used (instead of _SUPPORTED). Using that flag makes the operating system report if it has everything it needs to display a string based on a given locale.<br />
<br />
The problem is, checking against a specific font name is less than optimal, since their names may be localized (the japanese fonts MS Gothic and MS Mincho do that, to give examples), and Windows might know of a font you don't. That's why you need to check on the locale or language group, if you're going to filter on it - but to the best of my knowledge, no WinAPI function exists to detect locale, language group, or script for a given string (except those Jim already mentioned, which are only built into Vista and require a separate download for XP and 2003, therefore not really being usable here).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Benski</div><div class="date">10th April 2008, 23:35</div></div><div class="posttext">Latest 7-zip alpha build supports opening Unicode NSIS installers :up: <br />
<br />
http://sourceforge.net/forum/forum.php?thread_id=2000352&amp;forum_id=45797</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sridhare</div><div class="date">23rd April 2008, 10:29</div></div><div class="posttext">Our unicode-nsis installer calls a java program using nsExec and all the output from the java program gets directed into the scrolling text box. If we choose English for the installation language, everything in the text box looks fine , but when an exception stack trace is printed, a part of the stack trace gets cut off. If we choose Japanese for the installation language, weird characters are displayed in place of forward slashes. What could be the reason?<br />
<br />
I've hacked the RealProgress plugin source to get it working with the unicode-nsis. Could it be the reason for this behaviour? (seems unlikely though). I'm attaching a snapshot. <br />
Look at the second line in the image. It is actually supposed to be C:/PROGRA~1/Java/.. so on. But all &quot;/&quot; are replaced with some weird character. Similarly, both the stack traces are only partially displayed.<br />
Any help will be greatly appreciated. Thanks in advance.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">23rd April 2008, 11:02</div></div><div class="posttext">I can't say why it cuts off part of it, but the reason \ is replaced by the  sign is for historical reasons: Japan (and Korea) put their currency symbol in their code page back in the pre-Unicode days. When Unicode was introduced, it was believed that people were too used to seeing the currency symbol as the path separator, so they kept it that way. (There's no real &quot;right&quot; answer to that problem, so you can't really blame them, even if it does seem a bit foolish these days)<br />
<br />
As a result, all Japanese fonts (MS Gothic, etc.) show a Yen sign where the backslash is supposed to be, just like Korean fonts (GulimChe, etc.) show a Won sign ().</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">26th April 2008, 13:38</div></div><div class="posttext">sridhare, when an exception is thrown and the stack trace is printed by your Java app, there are potential problems with buffered IO that is probably causing the cutoff of the text output.  I don't know how much control over the IO you have with the Java program but you might want it to be unbuffered when outputting or at least flush the IO when it exits.  The other issue is that I think NSIS will also buffer the input as well so it will display everything if it thinks the IO has been closed or is flushed.<br />
<br />
BTW, I have not been able to work on the updates to the Unicode NSIS for a while.  I will be very busy until probably sometime in June.  My apologies.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sridhare</div><div class="date">29th April 2008, 09:58</div></div><div class="posttext">Thanks for all the response. This java exception stack trace cut off never happened when we were using (non-Unicode) NSIS. Are you saying that the buffering issue could arise in the Unicode NSIS ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">29th April 2008, 14:48</div></div><div class="posttext">No, there isn't anything different about how NSIS handles the IO buffers with Unicode.  When an exception happens, does the output look like junk?  I don't know how it is in Java but in C++, the exception strings need to be ASCII and I wonder if something similar is happening in Java.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sridhare</div><div class="date">26th May 2008, 08:53</div></div><div class="posttext">Originally posted by jimpark <br />
No, there isn't anything different about how NSIS handles the IO buffers with Unicode.  When an exception happens, does the output look like junk?  I don't know how it is in Java but in C++, the exception strings need to be ASCII and I wonder if something similar is happening in Java.  <br />
<br />
No, the output doesn't look like junk, but it gets displayed incompletely - This is the actual exception message that used to get displayed fine in the log window when I was using the official NSIS :<br />
<br />
<br />
INFO: Not started: http://localhost:80/identity<br />
java.net.ConnectException: Connection refused: connect<br />
	at java.net.PlainSocketImpl.socketConnect(Native Method)<br />
	at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:333)<br />
	at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:195)<br />
	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:182)<br />
	at java.net.Socket.connect(Socket.java:516)<br />
	at sun.net.NetworkClient.doConnect(NetworkClient.java:152)<br />
	at sun.net.www.http.HttpClient.openServer(HttpClient.java:365)<br />
	at sun.net.www.http.HttpClient.openServer(HttpClient.java:477)<br />
	at sun.net.www.http.HttpClient.&lt;init&gt;(HttpClient.java:214)<br />
	at sun.net.www.http.HttpClient.New(HttpClient.java:287)<br />
	at sun.net.www.http.HttpClient.New(HttpClient.java:299)<br />
	at sun.net.www.protocol.http.HttpURLConnection.getNewHttpClient(HttpURLConnection.java:795)<br />
	at sun.net.www.protocol.http.HttpURLConnection.plainConnect(HttpURLConnection.java:747)<br />
	at sun.net.www.protocol.http.HttpURLConnection.connect(HttpURLConnection.java:672)<br />
	at com.pramati.bfly.install.InstallOperations.getStatus(InstallOperations.java:335)<br />
	at com.pramati.bfly.install.InstallOperations.dasStatus(InstallOperations.java:190)<br />
	at com.pramati.bfly.install.BaseInitializer.start(BaseInitializer.java:301)<br />
	at com.pramati.bfly.install.offline.StandaloneInstaller.start(StandaloneInstaller.java:488)<br />
	at com.pramati.bfly.install.offline.StandaloneInstaller.start(StandaloneInstaller.java:475)<br />
	at com.pramati.izpack.DekohProcessPanel.invokeInstaller(DekohProcessPanel.java:479)<br />
	at com.pramati.izpack.DekohProcessPanel.installDekoh(DekohProcessPanel.java:346)<br />
	at com.pramati.izpack.DekohProcessPanel.access$300(DekohProcessPanel.java:43)<br />
	at com.pramati.izpack.DekohProcessPanel$2.run(DekohProcessPanel.java:262)<br />
<br />
<br />
Now, after switching to the Unicode NSIS, the same exception stack trace started appearing as follows!<br />
<br />
<br />
INFO: Not started: http://localhost:80/identity<br />
java.net.ConnectException: Connection refused: connect<br />
        nnection.java:747)<br />
<br />
<br />
Also, when this cut-off happens, it also swallows some other messages printed to the window after this stack trace. Having the full exception stack traces is very critical for debugging, it'd be great if you can be of help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">9th June 2008, 16:22</div></div><div class="posttext">Just released Unicode NSIS 2.37 which merges in the changes from the trunk into the Unicode build.  You can find it at the usual place: www.scratchpaper.com.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">9th June 2008, 18:18</div></div><div class="posttext">sridhare, try the new version to see if it fixes your issue.  If not, I do have another idea that might fix it.  So let me know.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">10th June 2008, 19:18</div></div><div class="posttext">sridhare, I found the bug and I've finally fixed it.  Sorry it took so long.  I didn't have any time to work on the Unicode NSIS until recently.  I just released new binaries and fixed source at the usual place.  http://www.scratchpaper.com  The version is 2.37.1.  Everyone should get this new one instead.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">23rd June 2008, 15:27</div></div><div class="posttext">Just released 2.37.2 which has an initial Vietnamese support thanks to Clytie Siddall of the OpenOffice translation team.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pabs</div><div class="date">4th July 2008, 17:49</div></div><div class="posttext">Whats the status of this Unicode branch? Ready to be merged into trunk?<br />
<br />
I ask because Debian would like to use it for our win32-loader program used to boot the Debian installer on Windows machines:<br />
<br />
http://bugs.debian.org/489218</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">4th July 2008, 18:47</div></div><div class="posttext">Because a Unicode build will break backwards compatibility with existing scripts, it will probably be a NSIS 3.0 release.<br />
<br />
However, Win9x support is still not avaialble. It is possible to add support for these platforms (even with the internal installer data being in Unicode) by converting the data back to ANSI for the user interface.<br />
<br />
The other option would be to completely drop support for Win9x in NSIS 3.x.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">4th July 2008, 19:56</div></div><div class="posttext">I would love to see the code get merged into the trunk as well, as I've mentioned many times already.<br />
<br />
As for Win9x support, it is not on my list of priorities.  I personally don't have a need for it since all the software we are shipping require Win2k+ anyway.  I think most developers have similar requirements nowadays.<br />
<br />
The &quot;unofficial&quot; status of the Unicode NSIS branch hasn't stopped high profile projects like Winamp, OpenOffice, Flickr, Filezilla, etc. from using it.  And in the near future Mozilla's products like Firefox and Thunderbird will use it as well (Unicode NSIS is already incorporated into their build environment since MozillaBuild 1.2). It just goes to show that there is definitely a need for an Open Source Unicode Installer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">4th July 2008, 19:59</div></div><div class="posttext">And I'll mention this point again as well.  My codebase generates both the Unicode version and the ANSI version that DOES run on Win9x.  So I really don't see what you can lose from adopting the codebase as-is and then working forward from there to make the Unicode version Win9x compliant via unicows.dll or some other method as mentioned by Joost.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">4th July 2008, 23:42</div></div><div class="posttext">I don't think it's a good idea to have an ANSI and a Unicode version at the same time. Many scripts will not be compatible with both versions, so this will cause a lot of confusion. And there is also the issue of plug-in compatibility.<br />
<br />
Regarding Win9x, we cannot use Unicows or something like that because this file does not exist on all systems. The only option for real Win9x support would be to create ANSI dialogs and convert the intenal Unicode data to ANSI based on the current code page. In this case, scripts, examples, plug-ins etc. will all use Unicode internally and there will be no compatibility issues.<br />
<br />
Personally I think it's OK to drop Win9x support in NSIS 3.0 (with NSIS 2.x still being available for Win9x users) and move to Unicode scripts. But I don't know whether other developers agree with this.<br />
<br />
I'd definately like to have Unicode support in the official version.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">5th July 2008, 00:50</div></div><div class="posttext">I see three potential options other than the one I have which is two versions of NSIS, meaning two sets of plugins (but one codebase) and two sets of scripts, which I concede can be unwieldy.<br />
<br />
1. One makensis.exe that can generate both an ANSI or a Unicode installer.  This means that there will still need to be two sets of plugins and exeheads, but potentially just one set of scripts.  If we go this route, I'd suggest that all scripts are Unicode.  If we start with ANSI codepage scripts, mixed scripts in a single file becomes very difficult if not impossible to support.  (Imagine a single string with mixed scripts.)  And we would alienate Unicode-only languages.<br />
<br />
2. We generate one exehead but with the ability to on-the-fly convert the internally stored Unicode strings to the ANSI codepage strings to call the ANSI Windows APIs on Win9x machines.  This requires that we have a small but portable implementation of wide string to multi-byte string conversion function.  Maybe we can leverage some code in the Wine project to do this.  But it does mean making the exehead and therefore the final installer to be bigger.  The plugins would also need to do this conversion as well since they would likely get the Unicode strings on the stack.  So this method requires more complexity in the exehead and the plugins.<br />
<br />
3. Drop ANSI support in NSIS 3.0 entirely.  We have one version of everything going forward, but we lose the Win9x support.  But as Joost mentioned, NSIS 2.0 can cover that small and rapidly shrinking market.  (The Win9x crowd is ~0.2% of the web surfing public according to w3school: http://www.w3schools.com/browsers/browsers_os.asp) <br />
<br />
I think the logical choice is 3.  But it isn't my decision.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">5th July 2008, 01:58</div></div><div class="posttext">Originally posted by jimpark <br />
<br />
2. ...This requires that we have a small but portable implementation of wide string to multi-byte string conversion function.  Maybe we can leverage some code in the Wine project to do this<br />
<br />
Win9x has support for a limited set of Wide API's out of the box, including WideCharToMultiByte IIRC<br />
<br />
<br />
Originally posted by jimpark <br />
<br />
3. ...according to w3school <br />
That is a dev specific site, yes, the % of people using 9x is small, but not THAT small<br />
<br />
<br />
I prefer option 1 myself, old scripts would stay in whatever ansi codepage they have always been in, unicode scripts would need a way to specify that they are unicode, with either a BOM or a nsis instruction at the top</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">5th July 2008, 17:46</div></div><div class="posttext">You might be right about the percentage of people using 9x being too small but I would still argue that around 1% is right.  Is there a different number you are aware of?<br />
<br />
I wouldn't mind getting option 1, either.  We might be able to do it by inserting both the Unicode and ANSI exehead into every installer (option controlled, of course).  It also means two copies of every plugin as well.  So your installer overhead would be 2x what is now if you wanted a &quot;Universal installer.&quot;<br />
<br />
Unfortunately, this change is not something I can do.  Time constraints are a problem for one.  But more importantly, it would fork the code too much and I wouldn't be able to maintain the code to be in sync with the main build.  It could easily end up being an abandoned fork.<br />
<br />
But we are all eager to see the main NSIS developers start work on an official Unicode version.  Is there any work going underway for this support currently?  If not, is there any tentative plans for Unicode support in the near future?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Benski</div><div class="date">5th July 2008, 23:27</div></div><div class="posttext">Personally, I see no reason to continue win9x development.  I know that kichik and other NSIS developers disagree, but the userbase has dropped off dramatically.  Based on winamp.com web stats, Winamp's win98/ME userbase went from 3% in 2006 to less than 1% by January 2007 which triggered us to drop support for the platform entirely.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sealite</div><div class="date">6th July 2008, 14:12</div></div><div class="posttext">I agree that developers should drop 9x support. It's like the idea of having 16bit/32bit software build few years before ;)<br />
<br />
Keeping the compatibility would require too much effort, effort that could be used other things.<br />
<br />
And if you don't trust you can make a survey, just don't forget to put the questions right ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">10th July 2008, 01:01</div></div><div class="posttext">If we want to continue Win9x support, the best option would be to have all scripts and plug-ins in Unicode but add support to the exehead to create ANSI dialogs on Win9x.<br />
<br />
If this is not possible, the scripts should move to Unicode anyway but there will be two sets of plug-ins and exeheads.<br />
<br />
However, it may indeed be better to drop Win9x support for NSIS 3.0.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">10th July 2008, 01:10</div></div><div class="posttext">the script should stay like they are, BOM for unicode files and no BOM means ansi, otherwise tricks played with !system that you include again will have to be unicode aswell, and the console is not unicode by default</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">10th July 2008, 01:21</div></div><div class="posttext">But then you also need two sets of langauge files etc., which will all be way to complicated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">10th July 2008, 03:13</div></div><div class="posttext">Originally posted by Joost Verburg <br />
But then you also need two sets of langauge files etc., which will all be way to complicated. <br />
<br />
You can't convert the lang file on the fly from ansi to unicode when you know the codepage ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">10th July 2008, 03:41</div></div><div class="posttext">You can, when you know the codepage.  You can't tell programmatically right now.  Some languages use two scripts and have two different language files.  The NLF files can be read and the codepage gotten but not the NSH files.  It would require that we add something in the NSH files to store the codepage.  Maybe a special comment?<br />
<br />
Also, no the console is not Unicode by default but outputs to the console through the stdlib will convert them to ANSI before displaying them on the console.  Hence, you really want to use the makensisw.exe to see the Unicode characters.<br />
<br />
All new scripts for the Unicode only NSIS should be UTF-16LE but we can make makensis.exe read ANSI scripts and 1. convert them to Unicode using the system codepage or 2. provide a parameter that provides the codepage to use to convert to Unicode.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">11th July 2008, 01:25</div></div><div class="posttext">But there are also scripts that contain strings with different code pages. This is impossible to convert to Unicode.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">11th July 2008, 01:46</div></div><div class="posttext">Yes.  I was looking at some just today.  They cannot be automatically converted.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th July 2008, 13:42</div></div><div class="posttext">There is nothing that can't be done. It's complicated, I'll give you that. But at the very minimum, we could have two string tables - ANSI and Unicode. Those strings that can't be translated could be saved in the ANSI table.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">11th July 2008, 16:54</div></div><div class="posttext">Okay, we are talking about the automation of the conversion of a script into Unicode.  There isn't a language that ANSI supports that Unicode cannot which I know you know but someone can misread your statement and think that.<br />
<br />
The complication comes in when a script has multiple ANSI codepage strings.  The strings themselves do not tell you what codepage they are encoded in.  But it may be possible if the script always explicitly uses the $LANGUAGE variable that we can deduce the codepage for conversion in makensis itself.  If someone just encodes a string in their native codepage and never says in the script what language it is in, then you really can't do anything except assume things like that it's the system default codepage which can be wrong.<br />
<br />
Where as the Unicode to ANSI conversion can be done if the ANSI codepage that supports the language exists, because the script is inherently implied in the Unicode codepoint.  So it's much safer to store the scripts as Unicode and then convert them to ANSI if desired and possible.<br />
<br />
So just to be clear:<br />
<br />
Unicode can encode a superset of the scripts that are supported by ANSI codepages.  Each codepoint implies a script.  Therefore, for any shared subset of scripts, a Unicode string can be converted to the ANSI codepage encoding.<br />
<br />
An ANSI codepage string does not imply any codepage / script.  So unless hints are given, we cannot automatically convert to Unicode.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th July 2008, 18:58</div></div><div class="posttext">Of course. And so the very minimum we can do is have two tables and have the ANSI table act as it does now. This way, you could still build these old scripts.<br />
<br />
Most language files already provide codepage identifiers and some string paths can give you a good enough hint on the codepage for the ANSI string. But as a first very basic solution, two tables is enough.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">11th July 2008, 20:54</div></div><div class="posttext">Can you clarify what you mean by two tables?  Do you mean that the installer executable will have two tables?  Then yes, I think that was the proposal -- two exeheads that accesses two different string tables.<br />
<br />
So we have this path:<br />
<br />
ANSI script generates:<br />
   1. best guess at Unicode string tables.<br />
   2. ANSI string tables.<br />
<br />
Unicode script generates:<br />
   1. Unicode string tables (of course).<br />
   2. ANSI string tables. (Multiple languages in the Unicode script will not work if they are meant to be shown together.  Not a big surprise because ANSI NSIS can't do this either.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th July 2008, 22:55</div></div><div class="posttext">I do mean two string tables in the installer executable. But there's no need for two different exeheads/stubs for the job. The ANSI table could simply be empty for installers generated from Unicode scripts.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">13th July 2008, 22:37</div></div><div class="posttext">And all variables will also be in ANSI when an ANSI script is compiled? Otherwise it won't be backwards compatible anyway.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vcoder</div><div class="date">15th July 2008, 03:10</div></div><div class="posttext">NSIS 2.38 released.<br />
What about Unicode version of NSIS 2.38? ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">15th July 2008, 19:47</div></div><div class="posttext">vcoder, I'm on vacation right now.  So I won't be on it for a few weeks. :) But I'm sure you can survive in the interim.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vcoder</div><div class="date">16th July 2008, 00:44</div></div><div class="posttext">Originally posted by jimpark <br />
vcoder, I'm on vacation right now.  So I won't be on it for a few weeks. :) But I'm sure you can survive in the interim.  <br />
<br />
Thank you for your response.<br />
<br />
Have a good vacation! :up:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vcoder</div><div class="date">16th July 2008, 07:03</div></div><div class="posttext">This script work well on ANSI version of NSIS and failed on Unicode version:<br />
<br />
<br />
OutFile &quot;GetVersion.exe&quot;<br />
<br />
!define File &quot;Resources.dll&quot;<br />
<br />
RequestExecutionLevel user<br />
<br />
Function .onInit<br />
	GetDllVersion &quot;${File}&quot; $R0 $R1<br />
	IntOp $R2 $R0 / 0x00010000<br />
	IntOp $R3 $R0 &amp; 0x0000FFFF<br />
	IntOp $R4 $R1 / 0x00010000<br />
	IntOp $R5 $R1 &amp; 0x0000FFFF<br />
	StrCpy $R1 &quot;$R2.$R3.$R4.$R5&quot;<br />
<br />
	FileOpen $0 &quot;$EXEDIR\Version.txt&quot; w<br />
	FileWrite $0 '!define Version &quot;$R1&quot;$\n'<br />
	FileClose $0<br />
;	MessageBox MB_OK &quot;$R1&quot;<br />
	Abort<br />
FunctionEnd<br />
<br />
Section<br />
SectionEnd<br />
<br />
<br />
Result file:<br />
ANSI: !define Version &quot;3.4.0.96&quot;<br />
Unicode: !def</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">16th July 2008, 18:53</div></div><div class="posttext">I'll look into it when I get back from vacation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">21st July 2008, 22:12</div></div><div class="posttext">I am back from vacation today.<br />
<br />
Just released Unicode NSIS 2.38.  Fixed vcoder's FileWrite bug as well.  And modified the Unicode Mongolian translation to use some characters that do not exist in the ANSI Cyrillic codepage as per request by the OpenOffice project.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">22nd July 2008, 16:50</div></div><div class="posttext">Just modified the System plugin so that the 't' type specifier acts like a TCHAR*, that is, it will be an ANSI string in the ANSI version of NSIS, but will act as a wide-char string (Unicode string) in the Unicode NSIS.<br />
<br />
I introduced an 'm' type specifier to specify an ANSI string.  Why 'm'?  Well, I can't do 'a' or 's'.  So 'm' stands for multi-byte string which ANSI strings can be (although, usually not).  Also 'm' looks like an upside down 'w' which stands for wide-char string. :)<br />
<br />
This means that the conversion from your ANSI NSI script to the Unicode one will be mostly straightforward file conversion unless you were naughty and used the ANSI Windows API specifically, such as MessageBoxA.  Some Windows API like GetProcAddress only take ANSI strings, so you should still look at your System calls carefully.<br />
<br />
The new version is dubbed 2.38.1.  You know where to get it.<br />
<br />
I've also added an FAQ page (http://www.scratchpaper.com/unicodensisfaq).  If there are any missing topics you'd like to see or there's some erroneous info, please e-mail me.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">22nd July 2008, 20:00</div></div><div class="posttext">there was already a feature request for this (http://sourceforge.net/tracker/index.php?func=detail&amp;aid=1961307&amp;group_id=22049&amp;atid=373088) would be great if you could submit a patch so the system plugin stays in sync</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">22nd July 2008, 20:32</div></div><div class="posttext">I didn't know there was already a feature request.  The feature request mentions 'z' as the potential type specifier. I did consider that but favored 'm'.  Can we settle with 'm'?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">22nd July 2008, 20:52</div></div><div class="posttext">BTW, I can't add the modified source to the feature request.  I can only submit comments.  (Permissions issue?)  Or do I have to submit a new patch request?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">23rd July 2008, 06:27</div></div><div class="posttext">yeah, go with 'm', and you would have to submit it as a patch, not sure why its not possible to attach files</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vcoder</div><div class="date">18th August 2008, 23:50</div></div><div class="posttext">We a waiting for Unicode version of NSIS 2.39...  ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">19th August 2008, 01:04</div></div><div class="posttext">I'll probably work on it this weekend.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ta2i4</div><div class="date">21st August 2008, 15:04</div></div><div class="posttext">This code work well on ANSI version of NSIS 2.38 and failed on Unicode 2.38.1 version:<br />
<br />
!define HAVE_UPX<br />
!ifdef HAVE_UPX<br />
   !packhdr tmpexe.tmp &quot;UPX --best -f -q -v --ultra-brute --all-methods --all-filters --compress-icons=0 tmpexe.tmp&quot;<br />
!endif</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">22nd August 2008, 11:45</div></div><div class="posttext">Have you tried packhdr just on its own to see whether it works on Unicode NSIS generated installers?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xbarns</div><div class="date">27th August 2008, 14:38</div></div><div class="posttext">I tried using a2u.exe on a Windows 2003 Server (SP1, Standard English) it gives me an error: &quot;This application has failed to start because the application configuration is incorrect. Reinstalling the application may fix this problem.&quot;<br />
<br />
It works fine on XP Pro. (SP2, German).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">27th August 2008, 15:42</div></div><div class="posttext">You most likely need a newer verison of the C++ redistributables installed: http://www.microsoft.com/downloads/details.aspx?FamilyID=200b2fd9-ae1a-4a14-984d-389c36f85647&amp;DisplayLang=en<br />
<br />
(If that doesn't work, try the 2008 one)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">27th August 2008, 22:31</div></div><div class="posttext">Well, if it is because of the redistributable, then it's a silly mistake on my part.  I tried rebuilding the project.  Can you try downloading a2u.zip and trying the executable inside it again?<br />
<br />
As for the Unicode NSIS update, I don't think it's happening this week.  I've got way too much other work to do.  Hopefully, next week some time.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xbarns</div><div class="date">28th August 2008, 07:56</div></div><div class="posttext">It works now,thanks a lot!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ta2i4</div><div class="date">29th August 2008, 14:18</div></div><div class="posttext">Have you tried packhdr just on its own to see whether it works on Unicode NSIS generated installers?<br />
This code I found in ansi-NSIS help file. I converted my ansi script file to unicode by a2u.exe and tried to compile it by unicode-NSIS. Result is error when part of code with UPX is processing.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">29th August 2008, 14:48</div></div><div class="posttext">Okay, so can you try calling UPX itself to see if it works on Unicode NSIS installers?  What does the errors say?  I just don't have a lot of time to work on Unicode NSIS these days, so you're going to have to help me find the problem a bit.<br />
<br />
- Jim</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ta2i4</div><div class="date">30th August 2008, 02:35</div></div><div class="posttext">I found this error on WinXP SP3. But in Vista SP1 the same error.<br />
<br />
This is report:<br />
Error name: APPCRASH<br />
Application name: makensis.exe<br />
Version: 0.0.0.0<br />
Time stamp of application: 4885ef1f<br />
File with error: makensis.exe<br />
Version: 0.0.0.0<br />
Time stamp of file: 4885ef1f<br />
Code of exception: c0000005<br />
Stack of exception: 00006c6b<br />
OS version: 6.0.6001.2.1.0.768.2<br />
Language: 1049<br />
Advanced info1: 8a1e<br />
Advanced info2: 9e3d13911997afb9af7c20e45db763b3<br />
Advanced info3: 3aba<br />
Advanced info4: 1beeb7f8f0c5e3f3f9c6c0f5ff97433e</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ta2i4</div><div class="date">30th August 2008, 02:41</div></div><div class="posttext">1. In script: CRCCheck off<br />
2. Generating installer with name 'example.exe' without code with UPX.<br />
3. Command line: upx -9 example.exe<br />
4. Installer is working! Files is copying to folders. But the error when uninstall.exe creating.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">30th August 2008, 06:06</div></div><div class="posttext">Is there a plugin you are using to get this UPX capability?  Or are you calling the UPX tool straight as part of your script?  I only support the default plugins that come with NSIS.  If you are using a third-party plugin, you will need to contact them for help or convert the third-party plugin to interface with the Unicode NSIS using Unicode strings.  It seems like either a plugin that has not been converted for Unicode support or an UPX issue.  Either way, I don't think I can help you in this case.  I apologize.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ta2i4</div><div class="date">30th August 2008, 17:51</div></div><div class="posttext">I calling the UPX tool straight as part of script.<br />
<br />
See in file NSIS.chm:<br />
&quot;NSIS Users Manual&quot; -&gt; &quot;Chapter 5: Compile Time Commands&quot; -&gt; &quot;5.1 Compiler Utility Commands&quot; -&gt; &quot;5.1.10 !packhdr&quot;<br />
<br />
Sorry, there is new code now. I will try the new code and will write the result here.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ta2i4</div><div class="date">31st August 2008, 15:26</div></div><div class="posttext">Same result.<br />
<br />
Script file contents:<br />
<br />
;...&lt;code before&gt;...<br />
page licensepage<br />
;...&lt;pages&gt;...<br />
<br />
!packhdr ....<br />
<br />
Section First<br />
 ;Some data<br />
SectionEnd<br />
;...&lt;code after&gt;...<br />
<br />
<br />
Output in makensis:<br />
;...&lt;code before&gt;...<br />
<br />
!packhdr<br />
<br />
Section First<br />
Its all! Why?<br />
Application error at this place.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jamescookmd</div><div class="date">4th September 2008, 23:54</div></div><div class="posttext">I'm an engineer on Second Life (www.secondlife.com).  We've been using NSIS for years and love it.<br />
<br />
Recently we've noticed that installers built with NSIS 2.39 (and earlier) fail to launch on east Asian systems when the path to the installer has a non-roman character in it.  For example, if a Korean user has a Windows username with Korean characters in it (_), and the installer is on the desktop, it fails to launch with the error:<br />
<br />
NSIS Error: Error launching installer<br />
<br />
I've noticed that I don't get this error if I build the installer using NSIS Unicode.<br />
<br />
Is this a known issue with the mainline NSIS?  Do I have to switch to NSIS Unicode if I want my Asian users to be able to run the installer off their desktops?<br />
<br />
Thanks,<br />
<br />
James Cook<br />
james@lindenlab.com</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">5th September 2008, 04:43</div></div><div class="posttext">If the user had used MBCS (ANSI codepage) for their path names, it might have worked.  But usually when Windows creates the User's documents and settings directory using the user name, that user name is going to be Unicode, not ANSI codepage, even if the operating system codepage is Korean in this case.  So that's why ANSI NSIS has trouble with it.  However, Unicode NSIS has no problems at all.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">5th September 2008, 08:38</div></div><div class="posttext">Not entirely true, Jim. In NTFS, all path names are Unicode (actually, this also applies to LFNs in FAT), so Windows will convert to ANSI when applications call the relevant *A-APIs. <br />
<br />
However, the ANSI codepage used is dependant on the setting selected for non-Unicode applications in Regional and Language settings in the Control Panel. If you've selected a codepage that doesn't contain the required characters, it'll fail to make a proper conversion because the unmapped characters are converted to a ?, which in turn means the path won't be found.<br />
<br />
Now, although I kind of doubt James posted the actual text in question, it would appear to contain 2 characters that aren't Korean (at least they appear as good old &quot;I don't know what this character looks like&quot; to me). That might indicate characters outside of CP949, the Korean codepage.<br />
<br />
(There's also an underscore, but that's in the 0-127 area, where they've only changed \ to  - just like CP932, Japanese, has  at that position.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">5th September 2008, 11:42</div></div><div class="posttext">Ah, thanks for the clarification Pidgeot.  So the user name issue then must be that people like to have their user names in their native language which naturally causes Unicode characters to be included into the desktop path which is something like c:\documents and settings\&lt;user name&gt;\desktop or on Vista c:\Users\&lt;user name&gt;\desktop.<br />
<br />
Now what if the system codepage is not Korean but the person still wanted to have a Korean user name?  How does the system convert that to codepage for NSIS to manipulate and back to Unicode?  I think that's also a legitimate issue.<br />
<br />
So perhaps recently, there was a change in NSIS which required that it needed to know where itself was not just where the user wanted to install the program.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">5th September 2008, 12:19</div></div><div class="posttext">Just to elaborate how it all works with an example:<br />
<br />
If the system codepage is not Korean, and you use ANSI functions to fetch a path containing Korean characters, you'll get a question mark in place of each non-convertable character.<br />
<br />
Having your username in your native language is usually not an issue, because you'll usually have the same language set for non-Unicode applications, and when you aren't using that language in path names, it's usually English anyway, which can be expressed in all code pages.<br />
<br />
To give an example, the issue can pop up if I (being a Danish user) wanted to run a Japanese non-Unicode program. Running it with the non-Unicode language set to Danish would result in mojibake for text, so I'll need to set it to Japanese to run that program.<br />
<br />
(There's a tool by Microsoft, called AppLocale, which can set this for a single application - and because changing the global setting requires a reboot, that's a good thing - but that's a different story.)<br />
<br />
If my username then included a Danish letter, such as , any non-Unicode application attempting to get the username would read that character as a question mark, because  does not exist in the Japanese codepage. The folder &quot;l&quot; (Eel) would thus become &quot;?l&quot; - but because the folder is called &quot;l&quot; and not &quot;?l&quot;, it can't access the folder.<br />
<br />
You might argue that it could try to guess - after all, ? is a wildcard - however, there are issues with that:<br />
<br />
1) If there are multiple matches (let's say we also have a folder named &quot;l&quot;, meaning beer), you don't know which one you're supposed to get. Acting differently in the case of &quot;only one match&quot; is not consistent behavior, so that's not that good of an idea.<br />
2) Strictly speaking, NTFS does allow a file to be called &quot;?l&quot; - the only character not really allowed is NUL, much like in Linux. Win32 adds several characters to the &quot;disallowed&quot; set due to backwards compatibility</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jamescookmd</div><div class="date">6th September 2008, 00:27</div></div><div class="posttext">Thanks for the details, guys.  I agree the issue is people with paths to the installer like C:\Documents and Settings\&lt;username-with-extended-chars&gt;\Desktop.  I presume this means I'm not doing anything wrong with my plain-old-NSIS installer?<br />
<br />
I wish there was a workaround for plain-NSIS because we've got it installed on a plethora of developer and build machines.<br />
<br />
Could it be because we're using CRC check?<br />
<br />
Can you guys think of a workaround other than switching to NSIS Unicode?<br />
<br />
James<br />
<br />
(I attached our installer script below in case you're curious.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">6th September 2008, 12:47</div></div><div class="posttext">I made a very small installer to test, and I get the same result with CRCCheck On and CRCCheck Off - so that's not it.<br />
<br />
Now, this is just my opinion, but I would probably go Unicode now. It's not something you can really avoid, since the Unicode branch will eventually be moved into the main build, so not doing it now would only postpone the migration.<br />
<br />
The alternative would probably be an addition to a readme or FAQ or whatever, with a guide on how to change to the appropriate codepage, or suggesting the workaround to place it in a path only containing ASCII.<br />
<br />
I'd like to stress again: The problem is not with paths that contain characters &lt;= U+007F, since those are unchanged in all Windows codepages (except the issue with \, but that one is handled gracefully). The problem is with characters that are &gt;= U+0080, and are not representable in the user's codepage.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jamescookmd</div><div class="date">6th September 2008, 15:22</div></div><div class="posttext">Thanks guys.  I really appreciate the help.  I think we'll switch the NSIS Unicode for the time being.<br />
<br />
Enjoy the coffee, Jim!  :-)<br />
<br />
James</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jamescookmd</div><div class="date">9th September 2008, 22:38</div></div><div class="posttext">I'm having another problem...  <br />
<br />
An installer built with NSIS Unicode 2.38.1 does not show the &quot;unpacking data: ##%&quot; dialog during load.  The same installer built with NSIS 2.39 does show the dialog.<br />
<br />
My installer is 21 MB compressed with LZMA, so the unpack takes a noticeable amount of time.  Is there a way to get that dialog back, or put up some other sort of progress display?<br />
<br />
Thanks,<br />
<br />
James</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">10th September 2008, 00:35</div></div><div class="posttext">Does that happen with any compression setting?  I'm imagining that it does.  And also, does it print anything at all like &quot;unpacking data:?&quot; or is there no analogous printed line at all?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jamescookmd</div><div class="date">10th September 2008, 01:01</div></div><div class="posttext">Jim,<br />
<br />
Should I run the installer from the command line to look for output?  I get no window open of any kind during unpack.  The first window I get is language select (from our .onInit() function).<br />
<br />
I've only tried it with SetCompressor /solid lzma<br />
<br />
Tomorrow in the office I'll try it with other compression settings.  Any particular ones to try?<br />
<br />
James<br />
<br />
(I attached the shell of our installer -- all the %%FOO%% sections are automatically populated with our lists of files.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jamescookmd</div><div class="date">10th September 2008, 01:40</div></div><div class="posttext">It doesn't look like installers print anything to the console -- running from the command line shows nothing.<br />
<br />
Also, I have the same problem (no &quot;unpacking&quot; dialog) with:<br />
SetCompressor zlib<br />
SetCompressor /solid zlib<br />
SetCompressor /solid bzip2<br />
<br />
Hope that helps.<br />
<br />
James</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">10th September 2008, 12:53</div></div><div class="posttext">A workaround could be to add all files in the right order in the solid archive (using ReserveFile). Then there will be no need to extract a lot of data at startup.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jamescookmd</div><div class="date">17th September 2008, 22:13</div></div><div class="posttext">Thanks for the suggestion, Joost.  I ended up reordering my .nsi script so all the functions are at the start of the file, followed by all the files.  We used to have the .onInit function at the end of the .nsi file, which I think was the cause of the slow unpack.  This seems to eliminate the startup delay that caused the &quot;unpacking data&quot; dialog to appear and solves my problem.<br />
<br />
I didn't see this documented anywhere -- does NSIS interleave the packed file data and the function definitions?  If so, it seems important to put all your user-written functions before the first big list of files.  Should that go in the docs somewhere?<br />
<br />
Jim, just so you know, NSIS Unicode definitely doesn't show the &quot;unpacking data&quot; dialog, though, even on slow unpacks.<br />
<br />
Thanks again, guys.  James</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vcoder</div><div class="date">15th October 2008, 02:12</div></div><div class="posttext">Are you going to update NSIS' Unicode version up to 2.40?<br />
There are some important (for me) improvements and bug fixes.<br />
<br />
Thank you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">15th October 2008, 03:09</div></div><div class="posttext">I'm currently at the busiest time of the year for development.  We have what we need right now as far as an installer is concerned so I'm not going to be able to update this any time soon.  I'm hoping if the NSIS guys are really going to support Unicode, they pick it up soon.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pabs</div><div class="date">28th October 2008, 01:21</div></div><div class="posttext">kichik, whats the status of this Unicode support? Needs reviewing? Needs something fixed? Debian folks are wanting this too.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pabs</div><div class="date">7th November 2008, 06:09</div></div><div class="posttext">I've been looking at the code changes just now.<br />
<br />
First thing that got me was all the ANSI/Unicode dirs all over the place with the files in UTF-16. I didn't think that is a good idea, so I converted all the Unicode directories into UTF-8 and looked at the differences between them.<br />
<br />
Based on that, here are some suggestions:<br />
<br />
Don't duplicate stuff that doesn't have non-ANSI characters in it.<br />
<br />
Where the only change between Unicode and ANSI is to re-encode the  (Copyright) symbol, just replace it with the word &quot;Copyright&quot;, since that is as legally valid as &quot;&quot;.<br />
<br />
Where differing parameters to System::Call are needed, add an !ifdef UNICODE or something.<br />
<br />
Some more comments:<br />
<br />
Don't add/remove whitespace where it isn't needed.<br />
<br />
Menu/images/Unicode/create_header.py isn't needed, Scripts/release.py does that stuff.<br />
<br />
Please don't include proprietary formats like Paint.NET in nsis, standardised PNG, BMP or ICO are best.<br />
<br />
For the languages, store everything in UTF-8 in the source code and convert to ANSI at makensis time if the user sets a specific code page (and error out if all the characters are not available in that CP). On Linux the iconv function can help and for people running makensis on Win9x the unicows library could be useful:<br />
<br />
http://libunicows.sourceforge.net/<br />
<br />
Switching to gettext style translations and the PO file format for translations might be useful too, dunno how well Windows supports it though.<br />
<br />
Use ISO 639-1 codes for language type instead of English words for the languages.<br />
<br />
For the Contrib/UIs, add ifdefs, compile them twice and install them into Unicode and ANSI directories. Alternatively makensis could detect a &quot;RichEdit20&quot; class and replace it with &quot;RichEdit20A&quot; or &quot;RichEdit20W&quot; as appropriate.<br />
<br />
Examples/Unicode/bigtest.nsi doesn't need to use the  character.<br />
<br />
Examples/Unicode/makensis.nsi doesn't need ANSI/Unicode in the registry/etc does it? Just make one version of makensis that does both ANSI and Unicode depending on a command-line switch or a script command. Same for a lot of other stuff.<br />
<br />
Will make some of these changes myself, look at the rest of the changes and add more comments.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jamescookmd</div><div class="date">7th November 2008, 06:19</div></div><div class="posttext">I just filed issue 2230926 related to NSIS 2.40 (and earlier) installers throwing an error on startup if the path to the installer contains wide characters.<br />
<br />
https://sourceforge.net/tracker/index.php?func=detail&amp;aid=2230926&amp;group_id=22049&amp;atid=373085 <br />
<br />
NSIS Unicode doesn't seem to have this problem.  I wonder if the parts of the Unicode patch that fix this issue could be ported over separately, or as an initial step.<br />
<br />
James<br />
james@lindenlab.com</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GoHa</div><div class="date">4th December 2008, 02:27</div></div><div class="posttext">Hello, I was using ANSI version of NSIS until I faced the issue with unicode user name. Then I found unicode nsis and it solve the issue.<br />
<br />
I just read though this entire thread, and now a bit confused. Looks like I was supposed to convert scripts to unicode?<br />
<br />
I did not converted my scripts to unicode, they are still ANSI. But installer now works fine with UNICODE user names, so, definitely, I compiled unicode version.<br />
<br />
Why I was able to compile ANSI scripts? Isnt it should be mandatory converted to UNICODE? <br />
<br />
I did nothing else but reinstalled NSIS and recompiled it under unicode NSIS. Looks like everything is fine.<br />
What I am missing?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">4th December 2008, 14:38</div></div><div class="posttext">What it does is try to convert the ANSI script to Unicode using the system's codepage.  That's probably okay if you are the only developer and you never change your system codepage to something else but technically this is incorrect.  In order to make your NSIS script portable, you should convert your script to UTF-16 (using notepad.exe, for instance).  If you don't, you might find that later down the line, users report that your installer produces junk text and you might not remember why.  It's simple to do, so just load it up with notepad and save as Unicode and save yourself future grief.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GoHa</div><div class="date">4th December 2008, 20:01</div></div><div class="posttext">Thanks. One more question, if you please.<br />
We are planning to do some localization.<br />
Question regarding existing language files: I've noticed, that with unicoed nsis you ship non-unicode language files. Correct?<br />
<br />
How non-unicode language files survive with unicode installer? What shell I do about it? We server like 9 languages, like Gernam, French, Spanish, Simplified Chinesse, Traditional Chiness, Korean, Dutch, Italian, Japanese, Portuguese.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">4th December 2008, 20:18</div></div><div class="posttext">No, the language files that come with Unicode NSIS are indeed Unicode. I'm not sure why you think that wasn't the case, unless you've been looking at the &quot;regular&quot; NSIS files.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GoHa</div><div class="date">4th December 2008, 20:55</div></div><div class="posttext">In unicode NSIS installation files in &quot;.\nsis\Contrib\Language files&quot; are not unicode. See attahcment.<br />
<br />
/edit: attachment deleted. I was looking into the wrong NSIS installation folder.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">4th December 2008, 21:21</div></div><div class="posttext">Those aren't the Unicode NSIS files. I've looked at the exact same files here (2.38.1-Unicode), and they are Unicode here.<br />
<br />
Note that, by default, Unicode NSIS installs itself into Program Files\NSIS\Unicode - it does not overwrite the ANSI NSIS files (but the context menu is changed to point to the Unicode NSIS instead). The path you give suggest you're looking at the ANSI NSIS files.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GoHa</div><div class="date">4th December 2008, 21:33</div></div><div class="posttext">Oops. Please disregard my last question, you were absolutely right, files are unicode. I was looking into the wrong NSIS installation folder. Sorry for the confusion.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GoHa</div><div class="date">5th December 2008, 02:00</div></div><div class="posttext">Is that possible to declare and use (as a plugin feed) ANSI string within UNICODE version of plugin?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">5th December 2008, 02:10</div></div><div class="posttext">Not really.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GoHa</div><div class="date">5th December 2008, 02:13</div></div><div class="posttext">Lazy to rewrite plugins...<br />
Do you know any encryption plugin that will work with unicode?<br />
Like sha1 or md5?<br />
stuck in this.. During the installation i have to verify downloaded package. Was easy under ANSI version.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">5th December 2008, 02:21</div></div><div class="posttext">NSIS installers already do CRC checks on themselves as I understand it.  If that's not good enough, you will have to port some plugin over to work with Unicode.  It's not too hard.  Look at how the standard plugins were ported.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jamescookmd</div><div class="date">5th December 2008, 07:14</div></div><div class="posttext">Jim,<br />
<br />
How hard do you think it would be for me to write a Unicode-path-to-installer patch for ANSI NSIS?  If I wrote it, do you think the mainline NSIS would accept it?<br />
<br />
The inability of ANSI NSIS installers to run from the Desktop and Download folders of Windows users with Unicode account names is a major blocker for us.  We use your Unicode version from www.scratchpaper.com, but it would be nice to stay up to date with the recent ANSI NSIS versions.<br />
<br />
I'm way too new to the NSIS code to attempt to update the Unicode NSIS version to the latest ANSI codebase.  But I might be able to hard-code all the file open commands to use the FunctionW() versions and convert the path to the installer to WCHAR.<br />
<br />
What do you think?<br />
<br />
James<br />
james@lindenlab.com</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">5th December 2008, 11:25</div></div><div class="posttext">James,<br />
<br />
I was no expert when I started.  I never heard of NSIS nor cared about installers until out of necessity I had to.  I just downloaded the source and dove right in.<br />
<br />
The problem of trying to make NSIS partially Unicode might be even harder than making NSIS completely Unicode.  For example, you'll need to be able to specify Unicode strings in the ANSI script files.  From a UI standpoint, there are a million ways to get the path strings from the user and all those paths need to be covered as well.  So supporting two methods of data entry support might be a very daunting task.<br />
<br />
And even if you were able to shoehorn it -- I don't know how easy it would be to keep it up-to-date.  And it probably won't be accepted by the mainline NSIS.<br />
<br />
There are two bright sides, though.  One, I'm starting to get freed up from my current project so I might be able to spare some time in the coming weeks to update the Unicode NSIS.  And two, the main NSIS project needs to adopt some strategy of supporting Unicode soon or it will really lose relevancy -- the only thing saving NSIS is that there is no other open source option.  But that can change.  Some big project out of necessity can create one that supports Unicode and that would be the end of NSIS.  If that happens, I'm not going to keep up Unicode NSIS.  I'll just adopt the new open source installer.<br />
<br />
- Jim</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">5th December 2008, 16:34</div></div><div class="posttext">There are other open source installers, Inno Setup etc.<br />
<br />
It would also be possible to create a plugin that can call ansi nsis plugins from the unicode build</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">5th December 2008, 22:06</div></div><div class="posttext">Inno Setup I believe is free but not open source.  They may have changed that recently.<br />
<br />
Also, I don't think they support Unicode either.<br />
<br />
I guess a plugin that calls ansi plugins might be doable, but it would not work in the general case.  How do you convert to ANSI?  Do you assume that the system default codepage is the right one?  That would be wrong on many machines.  And it won't help you if you went to the Unicode NSIS because you need Unicode in the first place.<br />
<br />
Really, if you need Unicode and you need a particular plugin, you really should create a Unicode version of the plugin.  It's not that hard.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">5th December 2008, 23:06</div></div><div class="posttext">http://cvs.jrsoftware.org/view/issrc/</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">6th December 2008, 01:04</div></div><div class="posttext">So they did open it up.  But Pascal?  They should have kept it closed. :)  Just kidding.  Still, no support for Unicode. :/</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">6th December 2008, 02:35</div></div><div class="posttext">Open it up? It has been open source for years</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">6th December 2008, 03:16</div></div><div class="posttext">Yes, it seems like you are correct, Anders.  They have been open source for years.  I misremembered reading somewhere that Inno Setup is free but not open source.  Maybe I was just remembering that there was no easy way to build the source.  You needed to purchase Delphi development tools from Borland.  Is there any free development tools that can build Inno Setup, currently?  Not that I care to learn Delphi or Object Pascal at the moment...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ehsanakhgari</div><div class="date">7th December 2008, 20:57</div></div><div class="posttext">Hi all,<br />
<br />
I'm trying to convert Firefox's installer from NSIS to Unicode NSIS.  I'm facing a problem which I don't know how to solve.<br />
<br />
When I build Firefox installer using Unicode NSIS, it appears that some of the images/strings/formattings don't make it into the final installer.  For example, the header and watermark which the Firefox installer uses do not appear on the screen; the welcome page strings don't show up, and formattings such as bold header for MUI pages are lost.<br />
<br />
I'm not really sure what causes the problems.  The same source files can be successfully built using NSIS 2.22 (which Mozilla uses by default).  I'm trying the Unicode NSIS version 2.33, but I have tried this with the latest version as well, without any luck.<br />
<br />
Any help is very much appreciated!<br />
<br />
Thanks!<br />
Ehsan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">8th December 2008, 11:24</div></div><div class="posttext">Are all the files you are using now UTF-16LE?  The NSI files as well as all the readme text files you are using should be UTF-16LE.  Make sure that's the case.  (You can use a2u.exe or notepad.exe to make the conversion.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ehsanakhgari</div><div class="date">8th December 2008, 11:51</div></div><div class="posttext">Yes, the text files are all encoded in UTF-16LE.  Do you have any ideas on what else could be wrong?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">8th December 2008, 23:11</div></div><div class="posttext">Are you generating these text files using a script of some kind?  I remembering looking at some of the Mozilla build stuff and it seems heavily scripted.  Any possibility that some of these files are generated files?  I've noticed that while Python and to some extent Perl does internally support Unicode strings, printing them out to a file needs to be done correctly or they get converted to ANSI inadvertently.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ehsanakhgari</div><div class="date">9th December 2008, 15:00</div></div><div class="posttext">Some of these text files are generated by a script, and some others are simply copied using cp.  All those files are in UTF-8 encoding.  For ANIS NSIS, we would use iconv to convert them to the correct code page, but with Unicode NSIS, I have used iconv to convert them to UTF-16LE.  I prepend the UTF-16LE BOM bytes to the files manually using a very simple Perl script:<br />
<br />
my $line;<br />
print &quot;\xFF\xFE&quot;; # UTF-16LE BOM mark<br />
while( $line = &lt;STDIN&gt; ) {<br />
  print &quot;$line&quot;;<br />
}<br />
<br />
I have opened all these files in Notepad++ and they all shown properly with the correct encoding.<br />
<br />
I assume I don't have to run the BMP files through iconv, right?<br />
<br />
Would you say that iconv's output might be different to that of your a2u program?  Does a2u support UTF-8 as the input format?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ehsanakhgari</div><div class="date">9th December 2008, 21:22</div></div><div class="posttext">Nevermind, I found out the problem.  In our nsi files, we were !defining MUI_INSERT, which, in newer versions of NSIS, caused the MUI_INSERT macro not to expand to anything useful.  Removing that !define did the trick!<br />
<br />
By the way, did I mention that Unicode NSIS is *awesome*?  Keep up the good work, Jim!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">10th December 2008, 03:58</div></div><div class="posttext">I'm glad things worked out.  Thank you for the encouragement.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CritterNYC</div><div class="date">22nd December 2008, 06:55</div></div><div class="posttext">Originally posted by jimpark <br />
Yes, it seems like you are correct, Anders.  They have been open source for years.  I misremembered reading somewhere that Inno Setup is free but not open source. <br />
<br />
This is partially right.  Inno Setup is free (as in money) and the source is available, but they are using a license that is not approved by OSI (opensource.org).  Inno Setup uses its own unique license:<br />
http://www.innosetup.com/files/is/license.txt<br />
<br />
The sticking point is point 3: &quot;All redistributions in binary form must retain all occurrences of the above copyright notice and web site addresses that are currently in place (for example, in the About boxes).&quot;<br />
<br />
This requirement doesn't appear to be compatible with the GPL and doesn't appear to exist in other OSI-approved open source licenses.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">22nd December 2008, 09:13</div></div><div class="posttext">I'm not sure if the actual installer itself has a about box, but the version info has a innosetup link in one of the extra items, no big deal IMHO (how far off topic are we now? :) )</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">3rd January 2009, 18:11</div></div><div class="posttext">I just wanted to inform everyone that I'm actively working on the Unicode port of 2.42.  I've got most of it done and working but I'm having a bit of trouble with the System plugin samples.  More code got turned into assembly code since 2.38 and I had brush up on my assembly code skills.  So expect a release sometime next week.<br />
<br />
Also, if anyone wants to help debug my System plugin woes, please drop me an e-mail and I can provide you with the latest code and binaries.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ehsanakhgari</div><div class="date">3rd January 2009, 22:23</div></div><div class="posttext">We'll be using Unicode NSIS 2.33 in Mozilla-based software installers.  What would we gain if we update Unicode NSIS to a newer version?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">4th January 2009, 13:12</div></div><div class="posttext">From what I can see (and others may feel free to chime in), they've made the writing of the install script easier.  For example, when you include an NSH file, you no longer need to declare all the macros you will you use.  When using a plugin, you no longer have to remember to put /NOUNLOAD.  When writing the uninstall section and using macros, you don't have to remember to put &quot;un&quot; in front of everything.  While this probably won't help you if you already have a working NSI script, for someone creating a new one, I can see how it can be a real benefit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">KrisAster</div><div class="date">5th January 2009, 15:29</div></div><div class="posttext">Pardon me for sounding like a broken record here, but um... Is there any plan for this Unicode branch to be incorporated into the trunk?<br />
<br />
Due to the sheer popularity of this thread (#1 in replies and views), it seems that I'm not the only one who is a user of this branch.  And, it also seems as though I'm not the only one a bit frustrated by the delay in the Unicode branch receiving the latest features added to NSIS.<br />
<br />
Some of the reasons first proffered for this not being added to the trunk when first released were due to the question of its stability, but inasmuch as nearly every major open source project is ALREADY using it (Winamp (the host of this site), Mozilla, Firezilla, Open Office), I think the question of its stability has been answered.<br />
<br />
NSIS Unicode works, and it works well.  I'd like to voice my request again to have regular builds of this from the NSIS site.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">6th January 2009, 16:03</div></div><div class="posttext">Hello folks.  Unicode NSIS 2.42 is now out.  Get your copy at http://www.scratchpaper.com.  If you find bugs, please let me know.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">8th January 2009, 14:24</div></div><div class="posttext">Well, it's been two days and now Unicode NSIS 2.42.1 is out.  My sincere thanks to everyone who reported bugs and worked with me to get the fixes done!  Go get the latest from http://www.scratchpaper.com.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">8th January 2009, 14:41</div></div><div class="posttext">Differences in 2.42.1<br />
<br />
I took the libery to add a few more features to this albeit short release.<br />
<br />
Added the ${NSIS_CHAR_SIZE} macro which will be 1 in ANSI and 2 in Unicode.  (This only exist in my versions of NSIS, but it would be nice to get into the trunk as well.)  This allows the installer developer to write code that uses IntOp to manipulate string pointers to do it the same way for both Unicode and ANSI scripts.<br />
<br />
I've also added System::StrAlloc which allocates strings of N characters not bytes.  This means that System::StrAlloc 1024 in ANSI will be 1024 bytes but in Unicode it will be 2048 bytes.<br />
<br />
Related to the above, I've made changes to the System plugin such that for &amp;tN and &amp;wN, it refers to N characters not bytes.  And I've made documentation changes in System.html to that affect.<br />
<br />
I've also changed the names of the shell commands to reflect which version of NSIS you will be compiling against.  So instead of getting the generic &quot;Compile NSIS Script&quot; in the context menu when you right click on an NSI file, now you get &quot;Compile Unicode NSIS Script&quot; or &quot;Compile ANSI NSIS Script&quot; or both if you have both installed.  You may have noticed that Unicode makensisw.exe is smart enough to try to convert an ANSI NSI file to Unicode and compile it anyway.  So if you are sure that your ANSI script needs no modifications, but just a file conversion to Unicode, then this is a nice feature.  But it can also be a source of confusion so by making the shell commands more descriptive, you'll know what you are getting.<br />
<br />
Enjoy.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">8th January 2009, 16:40</div></div><div class="posttext">I would suggest putting a SystemStrAlloc macro somewhere so that the ansi version can continue to call Alloc and save a couple of bytes in size</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">8th January 2009, 18:20</div></div><div class="posttext">Well, you might be surprised to find that adding the function did not grow System.dll by a single byte.  The code section grows in some increments and it just fits nicely into the space available.  And if you really want to fuss over bytes, if you compare my version of the ANSI System.dll, it's actually 512 bytes smaller.  And the Unicode version is the same size as the official one.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">9th January 2009, 14:24</div></div><div class="posttext">Auto conversion of text encodings:<br />
<br />
Here's basically what the Unicode NSIS does as far as auto-encoding/decoding of text types.<br />
<br />
<br />
  If the file has no BOM in the beginning, it assumes it's an ANSI text file.  (It will probably use the system codepage to convert it internally to UTF-16LE -- but I'm not sure about this.  It may just strip out anything beyond ASCII and replace them with '?').<br />
<br />
  If the file starts with a 16 bit encoding of the BOM (the usual kind 0xFEFF), it will treat the file as a UTF-16 file and correct it for endianness, internally storing everything as UTF-16LE.<br />
<br />
  If the file starts with an 8 bit encoding of the BOM (0xEF 0xBB 0xBF), then it treats the file as a UTF-8 file and not an ANSI file.  So those who desire to store their scripts in UTF-8, it's fine as long as it starts with a UTF-8 BOM.  I understand that it's not usual for UTF-8 files to have a BOM, but since in the Windows world ANSI/ASCII files are more prevalent than UTF-8, this is what I chose.  If people want UTF-8 to be the default, I'm open to that.  Just let me know what you opinion is.  Incidentally, notepad.exe, when saving files as UTF-8 will add a BOM to the start of the file for you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">9th January 2009, 15:42</div></div><div class="posttext">The way I would prefer codepage detection to work is like this:<br />
<br />
BOM Present: Use the corresponding encoding/codepage.<br />
No BOM present: Check to see if the file can be fully parsed as UTF-8 (that is, no invalid byte sequences exist). If this succeeds, then it is very safe to assume that the file is indeed UTF-8. If it fails, fall back to ANSI/system codepage. Although we could, at least in theory, try to figure out UTF-16/UTF-32 without a BOM, due to the nature of the files, I suggest not doing so (since they are exceedingly rare, unlike BOM-less UTF-8).<br />
<br />
To use this information efficiently, MakeNSISW should be able to perform this check (not only the actual MakeNSIS command-line compiler), and the command-line compiler should have a parameter to tell it the codepage in advance (or, at the very least, a parameter that tells it to skip the &quot;valid UTF-8&quot; check if no BOM is present). The parameter would probably be a good idea anyway, as it would more easily allow for a &quot;Always assume UTF-8 if encoding unknown&quot; option in MakeNSISW.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">9th January 2009, 15:50</div></div><div class="posttext">Well, there is no BOM for ANSI.  There never has been and never will be.  Basically, what we can do is make Unicode NSIS never work with ANSI with the exception of ASCII only scripts.  If there is no BOM, assume UTF-8.  If there is a BOM, assume UTF-16.  This is the only other option in my mind.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th January 2009, 19:25</div></div><div class="posttext">Older unix tools might not support BOM for UTF-8, but that's not our problem ;)<br />
<br />
If you really want UTF-8 without BOM, maybe makensis could check the first line for a comment like #NSIS: encoding=UTF-8</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">9th January 2009, 19:31</div></div><div class="posttext">Well, my guess is, if they don't like putting 3 bytes in front of their file, they will like having to put &quot;#NSIS: encoding=UTF-8&quot; even less.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th January 2009, 19:35</div></div><div class="posttext">but the header is just ascii text that any editor can write, you don't need any special support</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">9th January 2009, 20:18</div></div><div class="posttext">I think a lot of these guys are scripting their NSI files and so it's not a big deal to emit three bytes at the front.  If they are writing their scripts via a text editor, they may be able to simply save as UTF-8 and it may embed the BOM for them (e.g. notepad.exe does).  Or they may have a way to type hex codes: EF BB BF (decimal: 239 187 191).  For example in vim, I just do this command:<br />
<br />
<br />
:dig b: 239 o: 187 m: 191<br />
<br />
<br />
And then I hit 'i' to insert text and type their ctrl-k b: ctrl-k o: ctrl-k m:.  And there I have it.<br />
<br />
Or paste this guy: </div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">9th January 2009, 20:28</div></div><div class="posttext">Long post ahead...<br />
<br />
Originally posted by jimpark<br />
Well, there is no BOM for ANSI. There never has been and never will be.<br />
<br />
Well, no, but there doesn't need to be. I've yet to encounter an ANSI file (with characters &gt; 128) that could be mistaken for a BOM-less UTF-8 file, because the odds of an ANSI file not containing any invalid UTF-8 character sequences are astronomically low, due to the way UTF-8 works on a byte level: not only do all bytes &gt; 128 have to be placed together, but all bytes in the range 128-192 must be after a valid lead byte (194-244), and there has to be a very specific amount of high bytes following - it can be expressed as a very simple state machine that checks each byte (worst case executions-wise is that the file is UTF-8, so we end up running through the entire file, but even so, that process shouldn't take more than a second).<br />
<br />
That's why I prefer not having to choose between &quot;allow ANSI, but require UTF-8 BOM&quot; or &quot;disallow ANSI, always assume UTF-8&quot;, instead getting the best of both worlds by checking for UTF-8 validity if there is room for doubt: it generates the highest possible amount of backward compatibility, while still allowing people to save their UTF-8 the same way they've always been doing (That doesn't mean we can't issues a warning or something if they use an ANSI file, but that's still a hell of a lot better than temporarily breaking all existing scripts by forcing a conversion). Yes, it requires a bit of extra work to read the file into memory and checking it before starting the compilation, but I think the value in that feature would be pretty great compared to the time it takes to develop it. (Of course, that's easy for me to say, since I'm not likely to be the one programming it. :p )<br />
<br />
Basically, what we can do is make Unicode NSIS never work with ANSI with the exception of ASCII only scripts.<br />
<br />
I'd certainly prefer this to not supporting BOM-less UTF-8 (partially because I no longer use Notepad for editing scripts, but gVim, and having to remember to add the BOM will be a pain - particularly since not getting these useless BOMs is one of the reasons I switched), but see above.<br />
<br />
If there is no BOM, assume UTF-8. If there is a BOM, assume UTF-16.<br />
<br />
I assume you mean &quot;If there is a UTF-16 BOM&quot;. ;)<br />
<br />
This is the only other option in my mind.<br />
<br />
Originally posted by Anders <br />
Older unix tools might not support BOM for UTF-8, but that's not our problem ;)<br />
<br />
Except NSIS can do cross-compilation on *NIX systems and, to the best of my knowledge, most *NIX editors don't place a BOM unless explicitly told to (the only advantage is for identification, and most Unicode-aware tools try UTF-8 anyway, so no real benefit is observed).<br />
<br />
Forcing people to do this also means forcing them to change their usual editing routines beyond just having to select a different encoding - they need to know &quot;does my editor add a BOM&quot; (and how they can add it if it doesn't), and I think that could potentially put some people off from going with Unicode NSIS.<br />
<br />
If you really want UTF-8 without BOM, maybe makensis could check the first line for a comment like #NSIS: encoding=UTF-8  <br />
<br />
It's not really logical to have to force a Unicode-aware application to use Unicode like this. You don't have to use files with signatures for Notepad to recognize UTF-8, to give an example.<br />
<br />
This sort of thing could be more useful if extended to allow specifying non-Unicode code pages, such as sjis or big5, in which case Unicode NSIS would convert from that particular codepage, since that would allow Unicode NSIS compilation of an ANSI script on a random system - but I'm not convinced this is a relevant feature for very many people.<br />
<br />
Originally posted by jimpark<br />
For example in vim, I just do this command: &lt;snip&gt;<br />
<br />
Just a comment on this: check out :h bomb.<br />
<br />
Or paste this guy: <br />
<br />
If you use the same codepage as Jim, that is. ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">9th January 2009, 20:52</div></div><div class="posttext">Just a comment on this: check out :h bomb.<br />
<br />
<br />
Wow.  I did not know that.  Very cool.  Vim rocks.  Now, is there a universal font that is available in Vim that can work on a lot of different scripts?  For example, I'd love to see Arial Unicode work for me but I can't seem to choose that font for my guifontwide setting.  Is there a font like that out there that I can download and have it work for Vim or somehow get Arial Unicode to work?<br />
<br />
<br />
If you use the same codepage as Jim, that is. ;)<br />
<br />
<br />
True but everyone should have Latin-1 as their codepage!  What else could we possibly need? :p</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">9th January 2009, 21:29</div></div><div class="posttext">Originally posted by jimpark <br />
Wow.  I did not know that.  Very cool.  Vim rocks.  Now, is there a universal font that is available in Vim that can work on a lot of different scripts?  For example, I'd love to see Arial Unicode work for me but I can't seem to choose that font for my guifontwide setting.  Is there a font like that out there that I can download and have it work for Vim or somehow get Arial Unicode to work?<br />
<br />
The help file states that all GUI versions of Vim, with the sole exception of the GTK2 version (you might be able to compile a GTK2 version for yourself and use that, but even there), only allows monospaced fonts. Personally, since my editing is pretty much restricted to Danish, English and Japanese, I use MS Gothic: it contains all the characters I need (although not all of the non-CJK characters are particularly pretty). A Chinese font like SimHei would probably give better Kanji/Hanzi support, though, since the Chinese use a much larger set of characters (I haven't tested this, though...)<br />
<br />
We're getting pretty off-topic, though, so let's try to get back to NSIS... :blah:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ehsanakhgari</div><div class="date">9th January 2009, 23:29</div></div><div class="posttext">Another problem which we are facing in order to use Unicode NSIS in Mozilla is about InstallOptions INI files.  We use WriteINIStr, which seems to write the INI file as ANSI and convert to a Windows codepage on the fly.<br />
<br />
Is there any way to write Unicode INI files from within the Unicode NSIS, or any other similar effects?  Without this, our custom installer pages will not benefit from being Unicode...<br />
<br />
Thanks!<br />
Ehsan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">10th January 2009, 00:32</div></div><div class="posttext">Your best bet is to move to nsDialogs<br />
<br />
IIRC, NT will write unicode ini files if the .ini already has a UTF-16LE BOM</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">10th January 2009, 00:38</div></div><div class="posttext">http://blogs.msdn.com/michkap/archive/2006/09/15/754992.aspx<br />
<br />
..so I guess you can use the nsis FileOpen/FileWriteByte commands to write the unicode BOM before you use the ini functions</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">10th January 2009, 02:21</div></div><div class="posttext">Well, it actually wouldn't be too hard to support WriteINIStrUTF16LE.  And after thinking about Pidgeot's idea, and taking a moment to write the ValidateUTF8 function myself, I think it's probably best to not require a UTF-8 BOM. I'm starting to see a potential for 2.42.2 already.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">10th January 2009, 02:43</div></div><div class="posttext">I wonder if I shouldn't just make the INI files it generates as UTF-16LE instead of creating a new function.  I think Windows supports INI files as UTF-16LE with no problems.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">10th January 2009, 03:32</div></div><div class="posttext">I dug a little deeper about WriteINIStr and this is what I found.<br />
<br />
WriteINIStr uses WritePrivateProfileString() in kernel32.lib.  If you look at the documentation for this function it states: &quot;If the file was created using Unicode characters, the function writes Unicode characters to the file. Otherwise, the function writes ANSI characters.&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">10th January 2009, 04:56</div></div><div class="posttext">did I not already say this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">10th January 2009, 10:54</div></div><div class="posttext">You may have.  This thread is long and my memory is short.  Ah, I see your post now.  I just missed it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">13th January 2009, 04:34</div></div><div class="posttext">I've semi-secretly released a prototype to 2.42.2 which can read UTF-8 NSI files.  It does not require a UTF-8 BOM.  If it finds a BOM in the beginning of the file, it uses the BOM as a cue to how to read the file.  If it does not find a BOM, it checks the file to see if it looks like a valid UTF-8 file.  If it's valid UTF-8, the file is read as UTF-8 and internally converted to UTF-16LE so that it can call the Win32 API.  If it does not have a BOM and it does not validate as UTF-8, then it is opened as ANSI.  But if this latter thing happens, anything that is &gt; 0x7f probably gets converted to question marks.<br />
<br />
http://www.scratchpaper.com/nsis-2.42.2-Unicode-setup.exe<br />
<br />
So basically this version of NSIS officially supports:<br />
UTF-8<br />
UTF-16LE<br />
<br />
It may work with UTF-16BE with the BOM (I'm relying on Microsoft on this one).  But it does not work with UTF-32 of any endian flavor.  Not sure there's a big demand for it anyway.<br />
<br />
Let me know if you run into any problems.  If it looks solid, I will release it to the general public some time next week or so.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pabs</div><div class="date">14th January 2009, 02:25</div></div><div class="posttext">Now that it can use UTF-8, wouldn't it be best to use that everywhere instead of having ANSI and Unicode versions of almost every file? If so, please be sure to strip the BOM character from the beginning of each UTF-8 file.<br />
<br />
${NSIS_CHAR_SIZE} sounds like a bad idea, nsis shouldn't assume any specific size for characters - each character in UTF-8 can be multiple bytes long and same for UTF-16, that can have characters that are more than two bytes long. Only UCS-2 and UTF-32 have constant-sized characters.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">14th January 2009, 03:47</div></div><div class="posttext">you are missing the point with NSIS_CHAR_SIZE, some windows api structures have hardcoded buffer sizes (GetVersionEx etc.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">14th January 2009, 03:50</div></div><div class="posttext">Pabs, NSIS_CHAR_SIZE is the internal char size representation.  You absolutely need it.  Unicode NSIS does NOT internally store things as UTF-8.  It can read UTF-8 files but internally it works with strings as UTF-16LE which is the native Windows encoding of Unicode.<br />
<br />
Also UTF-8 is not a superset of ANSI.  UTF-8 is a superset of ASCII but as soon as you hit codepages, UTF-8 and ANSI are foreign to each other.  So anything with localizations cannot be shared.  But a lot of the NSH files and samples CAN be reduced.  You still have to read the code very carefully to see if they are strictly the same.  If it uses the System plugin, for example, the strings you allocate needs to be adjusted for Unicode vs. ANSI.  Unicode should be double the width.  They must call the appropriate API -- the wide versions vs. ANSI.  They must use the right messages -- sometimes there are two messages with the same #macro but different values for ANSI and Unicode because one message ID returns ANSI string values while the other returns UTF-16LE values.  Using things like System::StrAlloc, ${NSIS_CHAR_SIZE}, and ${NSIS_UNICODE} can help you write code that will port easily between the ANSI and Unicode NSIS but it will require quite a bit of care to make sure it is done right.<br />
<br />
Here's an example where it's not so simple to share the same code for both Unicode and ANSI NSIS.<br />
<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=300271<br />
<br />
Albeit, if you do the basic stuff only in your installer, you probably won't see these kinds of problems and keeping your installer just UTF-8 may be quite doable.  (If you don't have any localized strings in the NSI script and rely solely on the Language Files distributed by NSIS, then even non-Latin installer may be able to go this route.)<br />
<br />
If you really want to give it a try, please feel free.  One thing I've noted is that the further you stray from the trunk, the harder it is to merge the changes for each release.<br />
<br />
BTW, I definitely appreciate any help I can get.  So I do value your input (and enthusiasm).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pabs</div><div class="date">15th January 2009, 04:22</div></div><div class="posttext">OK, fair enough on the size thing.<br />
<br />
Are there any changes that can be merged now? Perhaps the conversion of the plugins/makensisw/etc to TCHAR instead of char?<br />
<br />
Is there a need to duplicate the .nsh, .nlf etc files? This creates a maintenance headache IMO.<br />
<br />
For example, the Unicode/ANSI versions of COPYING and nsisconf.nsh are identical after conversion to UTF-8. Same for the following directories containing Unicode &amp; ANSI versions: Contrib/zip2exe/ Contrib/InstallOptions/ Contrib/Splash/ Contrib/Banner/ Contrib/AdvSplash/ Contrib/BgImage/ Contrib/VPatch/ Contrib/Modern UI/ Contrib/MultiUser/ Contrib/UserInfo/ Contrib/StartMenu/ Contrib/nsDialogs/ Contrib/Modern UI 2/.<br />
<br />
I think it would be best to have one version of them (encoded in UTF-8 for compatibility with legacy text editors and Unix tools).<br />
<br />
The differences due to System::Call or structure/string sizes can be wrapped in !if ${NSIS_UNICODE} or similar.<br />
<br />
makensis can be made to convert .nlf &amp; .nsh strings to ANSI/UTF-16LE at runtime.<br />
<br />
Not sure how to deal with the Contrib/UIs/ differences, presumably you could set the class to RichEdit20, use a define of some sort or makensis could set the class at installer creation time.<br />
<br />
I think the differences in due to registry key names and stuff are gratuitous and not necessary.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">15th January 2009, 04:35</div></div><div class="posttext">I agree with you Pabs.  I'd like to see that done as well.  When they are the same, we should keep them the same.  Only fork them if they need to be different like the Language Files.<br />
<br />
One thing about the !if ${NSIS_UNICODE} checks are that I'm afraid it might unnecessarily make the scripts harder to read.  I know I hate it when I see a lot of #ifdef's in the C/C++ code.  Also, the !if ${NSIS_UNICODE} checks may bloat the resulting installer with extra code as well.  I'm not sure I like that.<br />
<br />
As for the NSIS source code, I'd still like to be able to generate both the Unicode and ANSI builds of NSIS until everyone decides that ANSI is dead.  Then we can do what the guys at PortableApps are thinking [1] -- eventually, wrap up a final build of ANSI NSIS for those writing installers for legacy systems and continue on with Unicode only. :)<br />
<br />
[1] http://portableapps.com/node/17291</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pabs</div><div class="date">19th January 2009, 12:36</div></div><div class="posttext">I was under the impression that !if was an installer-build-time statement like #ifdef in C, if it isn't, I mean whatever is available for installer-build-time statement conditionals.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pabs</div><div class="date">21st January 2009, 23:52</div></div><div class="posttext">Looking at the documentation, !if and !ifdef are exactly what is needed; they are conditional compilation, the ignored bits don't end up in the executable.<br />
<br />
There aren't that many differences between the Unicode and ANSI examples and include files in the Unicode NSIS for you to be worried about making them harder to read.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">30er</div><div class="date">22nd January 2009, 14:22</div></div><div class="posttext">Hi<br />
<br />
its my first post here ;)<br />
<br />
Anders + jimpark<br />
<br />
you did both a great job ;)<br />
<br />
BUUUUUUUUUUUUUT<br />
<br />
i use Anders UAC plugin together with your unicode nsis<br />
<br />
with the ANSI build everything works<br />
<br />
but in unicode mode... <br />
during install for all users:<br />
${UAC.RunElevatedAndProcessMessages}<br />
only opens an adminpassworddialog at first run of the setup :(<br />
<br />
if u start the setup again for all users u wont see that dialog anymore :(<br />
<br />
<br />
<br />
next problem is:<br />
if i call the uninstaller from the unicodebuild this line makes troubles:<br />
${UAC.U.Elevate.AdminOnly} &quot;${UNINSTALLER_NAME}&quot;<br />
<br />
error pops up:<br />
unable to elevate, error 05536<br />
<br />
<br />
hope u can help me :(<br />
<br />
ty<br />
<br />
<br />
Software:<br />
OS:   XP Pro<br />
NSIS: 2.42.1 ANSI + UNICODE (jimpark)<br />
UAC:  v0.0.10a - 20081004 (Anders)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">22nd January 2009, 21:34</div></div><div class="posttext">&quot;if u start the setup again for all users u wont see that dialog anymore&quot; does not make any sense, the UAC plugin does not save any state, so it should work the same every time. Can you explain what you mean by &quot;for all users&quot;?<br />
<br />
Could you post a minimal example script with these problems?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">30er</div><div class="date">23rd January 2009, 08:54</div></div><div class="posttext">Originally posted by Anders <br />
&quot;if u start the setup again for all users u wont see that dialog anymore&quot; does not make any sense, the UAC plugin does not save any state, so it should work the same every time. Can you explain what you mean by &quot;for all users&quot;?<br />
<br />
Could you post a minimal example script with these problems?  <br />
<br />
<br />
I took your UAC RealWorld example script<br />
there u show a dialog where u can choose between single user and ALL USER installation<br />
<br />
All user means -&gt; NEED ADMIN RIGHTS<br />
<br />
if a normal user choose that<br />
the admin PWD dialog pops up<br />
<br />
if i try this with ANSI build everything works<br />
I can start the setup as often as i want and i get allways this ADMINPWD dialog<br />
<br />
if i try the same script build with the UNICODE NSIS<br />
the dialog will only be showen at first start :(<br />
<br />
UAC::IsAdmin returns $0 &gt;=1 <br />
if i run it as normal user!<br />
<br />
thats the strange thing for the installation<br />
<br />
maybe you can contact me in skype<br />
ing30er<br />
<br />
than i can show u my script</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">23rd January 2009, 15:09</div></div><div class="posttext">I only see one version of the UAC.dll in the UAC plugin package.  UAC will need to be built linking to the Unicode NSIS library using the Unicode string NSIS stack.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">23rd January 2009, 23:58</div></div><div class="posttext">v0.0.10a is not the latest version (and like Jim said, you need to recompile for use with nsis unicode)<br />
<br />
I just tested the UAC RealWorld example and it worked fine (XP SP2 (non admin), NSISU 2.42.1)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">30er</div><div class="date">26th January 2009, 08:25</div></div><div class="posttext">....nsis.sourceforge.net/UAC_plug-in....<br />
<br />
i see u updated that page anders ;)<br />
<br />
last week it showed v0.0.10a ;)<br />
<br />
can u tell me how i can convert your UAC.dll to unicode build?<br />
<br />
sorry im noob in building dlls :(<br />
<br />
would be nice if u can put both dlls in your UAC.zip Anders<br />
<br />
or offer a unicode version<br />
<br />
that would be veeeeeeeeeeeeeeeery nice :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">26th January 2009, 08:36</div></div><div class="posttext">yeah I updated the page, but v0.0.11 has been on stashbox for months. To build the unicode version, just make sure UNICODE is defined (remove the comment in uac.h, or set the define in the project options)<br />
<br />
I am planning to include the unicode version in the &quot;official&quot; package, I just need to automate the build</div></div><hr />


<div class="post"><div class="posttop"><div class="username">30er</div><div class="date">27th January 2009, 08:50</div></div><div class="posttext">ok thx for your help<br />
<br />
pls tell us than if u have done your new release with the unicode build included ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">29th January 2009, 22:53</div></div><div class="posttext">I just released 2.42.3 which has support for UTF-8 with and without a BOM for all the NSI, NSH, and license files.  Enjoy.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pabs</div><div class="date">1st February 2009, 01:47</div></div><div class="posttext">What variable should be used in the .nsi/.nsh files? !ifdef NSIS_UNICODE? I'd like to commit the needed changes to the .nsh files that need to be different between Unicode and ANSI builds.<br />
<br />
PS: could you please post future versions as a patch against latest SVN rather than against the latest release?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pabs</div><div class="date">1st February 2009, 08:53</div></div><div class="posttext">I also think that the changes to the plugins and makensisw code could be committed now since we don't yet compile with _UNICODE defined. Would that be OK kichik?<br />
<br />
I note you use nsis_tchar.h instead of the Win32 tchar.h, why is that?<br />
<br />
No need to add your name to every file, just credits.but is enough.<br />
<br />
I notice you add some function documentation, please split stuff unrelated to the Unicode changes into other patches, so we can commit them earlier.<br />
<br />
In some cases you comment out string definitions or code and add new ones afterwards, please just replace the old ones with new ones.<br />
<br />
Please remove the ANSI/Unicode dirs and convert the files in the Unicode ones to UTF-8 without a BOM and have them replace the current ANSI files. Please also remove the related changes to the SConsripts.<br />
<br />
I'm unsure about the changes to the cross-platform tools, on Linux at least, we just use UTF-8 everywhere.<br />
<br />
Please don't refactor functions or add comments in the Unicode patch, but instead create a separate patch so we can commit that earlier.<br />
<br />
Best to not remove existing comments or change whitespace either, thats another change that is unrelated to the Unicode stuff.<br />
<br />
TypeLib.cpp seems to use PopStringW, doesn't it need to work in ANSI mode too?<br />
<br />
Don't need to add comments like // reviewed for unicode support.<br />
<br />
Don't need to add .aps files, ascii2utf16.py, Visual Studio 2008 directory, create_header.py, header-unicode.pdn, *.bat, zipsource.pl, modify_copyright.pl etc<br />
<br />
Docs don't need to link to the unicode-nsis website.<br />
<br />
s/th ANSI/the ANSI/ in intro.but<br />
<br />
history.but doesn't need to be changed.<br />
<br />
Scons directory should be named SCons.<br />
<br />
Why the MSVS_VERSION change in mstoolkit.py?<br />
<br />
2.42.3 fails to build under Debian, some of the errors:<br />
<br />
<br />
Using GNU tools configuration<br />
In file included from Contrib/Library/LibraryLocal/LibraryLocal.cpp:11:<br />
Contrib/Library/LibraryLocal/../../../Source/tstring.h:24:21: error: windows.h: No such file or directory<br />
In file included from Contrib/Library/LibraryLocal/LibraryLocal.cpp:10:<br />
Contrib/Library/LibraryLocal/../../../Source/Platform.h:692: error: 'TCHAR' does not name a type<br />
scons: *** [build/debug/Library/LibraryLocal/LibraryLocal.o] Error 1<br />
<br />
<br />
<br />
In file included from Source/manifest.h:22,<br />
                 from Source/build.h:30,<br />
                 from Source/build.cpp:26:<br />
Source/tstring.h:24:21: error: windows.h: No such file or directory<br />
In file included from Source/build.h:22,<br />
                 from Source/build.cpp:26:<br />
Source/strlist.h: In member function 'int SortedStringListND&lt;T&gt;::find(const TCHAR*, int, int, int, int*)':<br />
Source/strlist.h:377: error: there are no arguments to '_stricmp' that depend on a template parameter, so a declaration of '_stricmp' must be available<br />
Source/strlist.h:377: error: (if you use '-fpermissive', G++ will accept your code, but allowing the use of an undeclared name is deprecated)<br />
Source/strlist.h:385: error: there are no arguments to '_strnicmp' that depend on a template parameter, so a declaration of '_strnicmp' must be available<br />
In file included from Source/build.cpp:26:<br />
Source/build.h: At global scope:<br />
Source/build.h:99: error: 'TEXT' was not declared in this scope<br />
Source/build.cpp: In member function 'int CEXEBuild::add_string(const TCHAR*, int, WORD)':<br />
Source/build.cpp:461: error: '_strdup' was not declared in this scope<br />
Source/build.cpp: In member function 'int CEXEBuild::preprocess_string(TCHAR*, const TCHAR*, WORD)':<br />
Source/build.cpp:606: error: '_strdup' was not declared in this scope<br />
Source/build.cpp:615: warning: suggest parentheses around + or - in operand of &amp;<br />
Source/build.cpp:615: warning: suggest parentheses around + or - in operand of &amp;<br />
Source/build.cpp:647: error: '_strdup' was not declared in this scope<br />
Source/build.cpp: In member function 'int CEXEBuild::add_label(const TCHAR*)':<br />
Source/build.cpp:963: error: '_strdup' was not declared in this scope<br />
Source/build.cpp: In member function 'int CEXEBuild::add_function(const TCHAR*)':<br />
Source/build.cpp:1025: error: '_strnicmp' was not declared in this scope<br />
Source/build.cpp: In member function 'int CEXEBuild::add_section(const TCHAR*, const TCHAR*, int)':<br />
Source/build.cpp:1181: error: '_strnicmp' was not declared in this scope<br />
Source/build.cpp:1187: error: '_stricmp' was not declared in this scope<br />
Source/build.cpp: In member function 'void CEXEBuild::warning(const TCHAR*, ...)':<br />
Source/build.cpp:3253: error: '_vsnprintf' was not declared in this scope<br />
Source/build.cpp: In member function 'void CEXEBuild::warning_fl(const TCHAR*, ...)':<br />
Source/build.cpp:3274: error: '_vsnprintf' was not declared in this scope<br />
Source/build.cpp: In member function 'void CEXEBuild::ERROR_MSG(const TCHAR*, ...) const':<br />
Source/build.cpp:3298: error: '_vsnprintf' was not declared in this scope<br />
Source/strlist.h: In member function 'int SortedStringListND&lt;T&gt;::find(const TCHAR*, int, int, int, int*) [with T = uservarstring]':<br />
Source/uservars.h:76:   instantiated from here<br />
Source/strlist.h:377: error: '_stricmp' was not declared in this scope<br />
Source/strlist.h:385: error: '_strnicmp' was not declared in this scope<br />
scons: *** [build/debug/makensis/build.o] Error 1</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jimpark</div><div class="date">2nd February 2009, 11:26</div></div><div class="posttext">Pabs, I can see how without knowing the motivations for the changes I made, you might think I'm an ego maniac.  For example:<br />
<br />
No need to add your name to every file, just credits.but is enough. <br />
<br />
Don't need to add comments like // reviewed for unicode support. <br />
<br />
I used a Perl script to keep status on what files I've modified and which ones still need to be reviewed.  That string with my name in it is what the script looks for -- it was my own sign off that the file was finished.  It was natural to use my name in such a comment.  Those comments are still useful for me.  I'm not removing the comments.  But when they get into the official release, feel free to purge the comments.<br />
<br />
Don't need to add .aps files, ascii2utf16.py, Visual Studio 2008 directory, create_header.py, header-unicode.pdn, *.bat, zipsource.pl, modify_copyright.pl etc <br />
<br />
They are useful for me.  Most of these scripts are helper scripts.  If they are not useful for you, don't include them in your build.<br />
<br />
Docs don't need to link to the unicode-nsis website.<br />
<br />
If my stuff doesn't link to the unicode-nsis website, what will?  My site is the only place to get the Unicode source and build at the moment.<br />
<br />
history.but doesn't need to be changed. <br />
<br />
Ah, but it should have been changed even more.  It should be kept up to date with all the changes I've made and features I've added on top of what's happened in the official build.  I've just been too lazy to keep it up to date.<br />
<br />
Best to not remove existing comments or change whitespace either, thats another change that is unrelated to the Unicode stuff. <br />
<br />
I found that the files were inconsistent.  Some were saved as DOS text files, others Unix style files.  Same with white space.  I just made them consistent because I use one text editor and me touching the file made the diffs too different.  Again, it's a change I made to make updating the build with the changes of the official release easier.<br />
<br />
Please don't refactor functions or add comments in the Unicode patch, but instead create a separate patch so we can commit that earlier. <br />
<br />
You are just teasing me with future promises. :)  I refactor when my engineering sensibilities says I should.  (It's probably what happens when you work on something by yourself for 2 years.)  Personally, I think more refactoring and restructuring would do the source code good.  But again, I do this so it would help me to continue to update the build.<br />
<br />
Why the MSVS_VERSION change in mstoolkit.py? <br />
<br />
I made the change to be able to build on MSVS 2005 and later MSVS 2008.<br />
<br />
2.42.3 fails to build under Debian, some of the errors:  <br />
<br />
Sorry, I don't cross build on Debian.  It's difficult enough to get this working on MSVS and update the code every release all by myself.  So if you'd like to figure it out and let me know what needs to be changed, I'd appreciate it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">2nd February 2009, 13:10</div></div><div class="posttext">having been reading through this thread for some time, have to say that how jim is running the unicode package pretty much works fine as far as end-users are concerned and that really is the main thing overall. yes it'd be nice as pabs says to have patches, etc but considering the work done and other things that need to be changed there's not much point until it is decided for definite how things are going to go as an official unicode nsis package.<br />
<br />
with the thing about refactoring, i know kichik has done loads of that over the process of the nsis project so there's no real issue with it being done in a branched version of the code (as this ultimately is) and is no more different than the noobjs branch or the one justin did a few months back - is good to try things out especially in a side-project before/if it is rolled out into the main distro.<br />
<br />
-daz</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>