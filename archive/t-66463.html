<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Feature Request: info on installed components, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Feature Request: info on installed components NSIS Discussion" />
	
	<title> Feature Request: info on installed components [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Feature Request: info on installed components</div>
<hr />
<div class="pda"><a href="t-66463.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=66463">Feature Request: info on installed components</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">23rd November 2001, 08:38</div></div><div class="posttext">I would like to know which components have been<br />
selected before actually installing these components.<br />
<br />
Right now, I'm installing the components and at the<br />
end I'm checking which have been installed to pose<br />
some questions....<br />
<br />
I know it's not possible with current NSIS but maybe<br />
someone (Justin???) can help me solving this little<br />
problem, because I'm not a C-programmer so I cannot<br />
adapt the source code myself.<br />
<br />
Thx greatly,<br />
<br />
- :D Hendri :D -</div></div><hr />


<div class="post"><div class="posttop"><div class="username">felfert</div><div class="date">23rd November 2001, 11:15</div></div><div class="posttext">Ok, here is a patch for my hacked-up version. It's against version 1.67. With this patch applied, you'll get an NSIS which supports a variable $SECTIONS which is simply a string of all enabled section numbers. E.g. If you have 5 sections and the first and the<br />
last are enabled, the value is &quot;15&quot;.<br />
<br />
A usage example:<br />
<br />
Function IsSectionEnabled<br />
  exch $2<br />
  push $1<br />
  push $0<br />
  strlen $0 $SECTIONS<br />
loop:<br />
  IntOp $0 $0 - 1<br />
  IntCmp $0 -1 notfound<br />
  strcpy $1 $SECTIONS 1 $0<br />
  strcmp $1 $2 found loop<br />
notfound:<br />
  strcpy $2 0<br />
  goto return<br />
found:<br />
  strcpy $2 1<br />
return:<br />
  pop $0<br />
  pop $1<br />
  exch $2<br />
FunctionEnd<br />
<br />
Function Whatever<br />
  push 2<br />
  call IsSectionEnabled<br />
  exch $1<br />
  IntCmp $1 1 enabled 0 0<br />
  DoSomethingIfSection2IsNotEnabled<br />
  goto nomatch<br />
enabled:<br />
  DoSomethingIfSection2IsEnabled<br />
nomatch:<br />
  pop $1<br />
FunctionEnd<br />
<br />
<br />
Apart from that, this patch also includes the following additions (i'm too lazy to sort that out for now :p ):<br />
<br />
 Support for .onDlgPage callback as described here (http://forums.winamp.com/showthread.php?s=&amp;threadid=65787).<br />
 Support for &quot;ExecDLL&quot;, see syntax below.<br />
 <br />
<br />
ExecDLL Description<br />
<br />
Syntax:<br />
ExecDLL PathToDLL FunctionName ParameterString<br />
<br />
This loads the DLL specified in PathToDLL, and runs the function FunctionName of that DLL. This function must be exported of course, and declared like this:<br />
<br />
<br />
typedef struct {<br />
	HWND hMainWindow;<br />
	HWND HelpText;<br />
	int  CancelId;<br />
	int  BackId;<br />
	int  NextId;<br />
} tNSISparams;<br />
<br />
int fun(tNSISparams*, LPCSTR);<br />
<br />
<br />
On calling this function, params are set with the following<br />
values:<br />
tNSISparams:<br />
  hMainWindow = HWND of NSIS main window<br />
  HelpText (currently unused)<br />
  CancelId = ID of cancel button<br />
  BackId = ID of &quot;&lt; Back&quot; button<br />
  NextId = ID of &quot;Next &gt;&quot; button<br />
LPCSTR:<br />
  The value of ParameterString<br />
<br />
On return, the value returned by this function is pushed on the stack for evaluation in the script.<br />
<br />
How to apply this patch<br />
[list=1]<br />
 Get cygwin from here (http://sources.redhat.com/cygwin/).<br />
 In cygwin's bash shell, cd into the source directory<br />
 Run patch -p0 &lt; nsis-1.67misc.patch.txt<br />
[/list=1]<br />
<br />
Have fun<br />
 -Fritz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">24th November 2001, 14:29</div></div><div class="posttext">Fritz,<br />
<br />
I really thank you for your effort in answering my question.<br />
The problem is, I have run into problems trying to install<br />
CygWin, because I didn't know what to install and I didn't<br />
want to wait to download all components because I have a<br />
dial-up modem...<br />
<br />
And because I do not know anything about C or Unix, I'm not<br />
such a pro, I'm just an ordinary econometrician...<br />
<br />
I will search for some info on CygWin and download it somewhere<br />
and then I will try your patch!!!<br />
<br />
(But maybe Justin will have a new version of NSIS (1.68)<br />
with this variable $SECTIONS available by that time.)<br />
<br />
Thanks again,<br />
<br />
- :D Hendri :D -</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Hando</div><div class="date">26th November 2001, 16:31</div></div><div class="posttext">I've grabbed Cygwin and extracted Patch.exe and the cygwin1.dll into my NSIS source directory. I applied that patch by typing<br />
patch -p0 &lt; nsis-1.67misc.patch.txt <br />
in a DOS box but I get the following message:<br />
<br />
missing header for unified diff at line 5 of patch<br />
can't find file to patch at input line 5<br />
Perhaps you used the wrong -p or --strip option?<br />
The text leading up to this was:<br />
--------------------------<br />
|diff -urw /cygdrive/c/Programme/NSIS/Source/build.cpp ./build.cpp ---<br />
|/cygdrive/c/Programme/NSIS/Source/build.cpp Wed Nov 14 21:15:44 2001 +++<br />
|./build.cpp Mon Nov 19 08:48:12 2001 @@ -237,6 +237,7 @@ &quot;SYSDIR\0&quot; // 21<br />
|&quot;HWNDPARENT\0&quot; // 22 &quot;CMDLINE\0&quot; // 23 + &quot;SECTIONS\0&quot; // 24 ; const char *p=in;<br />
<br />
--------------------------<br />
File to patch:<br />
<br />
<br />
(The &quot;File to patch&quot; is a prompt for the filename)<br />
<br />
What am I doing wrong?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">felfert</div><div class="date">26th November 2001, 20:37</div></div><div class="posttext">The patch file gets corrupted when downloaded, because it is a text-file and the browser changes Unix-LF's to DOS CR/LF. I zipped it now to prevent this.<br />
<br />
Sorry<br />
 -Fritz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Hando</div><div class="date">27th November 2001, 15:19</div></div><div class="posttext">I should point out that I'm a complete novice when it comes to programming and VC++ so the following could very well be my own darn fault. Anyways, I did a reinstall of NSIS 1.67 and then applied the new patch from the .zip file. I got the following message:<br />
<br />
<br />
patching file `./build.cpp'<br />
patching file `./exehead/Ui.c'<br />
patching file `./exehead/exec.c'<br />
patching file `./exehead/exec.h'<br />
patching file `./exehead/fileform.h'<br />
patching file `./exehead/util.c'<br />
patching file `./script.cpp'<br />
Hunk #1 FAILED at 57.<br />
Hunk #2 succeeded at 1122 (offset -2 lines).<br />
1 out of 2 hunks FAILED -- saving rejects to ./script.cpp.rej<br />
patching file `./tokens.cpp'<br />
patching file `./tokens.h'<br />
<br />
<br />
<br />
I opened it up in Visual C++ (version 6.0) and built it - this gave me no errors so I thought maybe everything was fine. I then tried to run the proggy but a messagebox pops up saying &quot;Installer corrupted&quot;.<br />
<br />
Obviously something's screwed up here (whether its me or the patch or my attempts at compiling the code). so if anyone can help out it'd be much appreciated as I'd really like to try out Felfert's .onDlgPage callbacks.<br />
<br />
Failing that, maybe someone could post/email me a compiled makensis w/ these extensions.<br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">petersa</div><div class="date">29th November 2001, 08:59</div></div><div class="posttext">Originally posted by Smile2Me <br />
I would like to know which components have been<br />
selected before actually installing these components.Easily done. No patches or hacks or new versions required.<br />
<br />
Section 'Optional Section 1'<br />
<br />
; ask the questions here, and then add another section further down that does the installation.<br />
<br />
  StrCpy $0 !<br />
  MessageBox MB_OK|MB_ICONQUESTION 'Yould you like to answer some questions?'<br />
<br />
SectionEnd<br />
<br />
Section 'Optional Section 2'<br />
<br />
; ...<br />
  StrCpy $1 !<br />
<br />
SectionEnd<br />
<br />
Section -DoTheWork<br />
<br />
  StrCmp $0 ! 0 DoneOptionalSection1<br />
  ; all the stuff for Optional Section 1<br />
<br />
DoneOptionalSection1:<br />
<br />
  StrCmp $1 ! 0 DoneOptionSection2<br />
  ; all the stuff for Optional Section 2<br />
<br />
DoneOptionalSection2:<br />
<br />
SectionEndI have used this technique to remove components that have been unchecked, if the installer is run again after the program is installed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">29th November 2001, 20:56</div></div><div class="posttext">Thanks a lot Petersa,<br />
<br />
your solution work really great!<br />
<br />
thx again,<br />
<br />
- :D Hendri :D -</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nsfis</div><div class="date">30th November 2001, 07:35</div></div><div class="posttext">Petersa,<br />
<br />
your solution works, but...<br />
<br />
1) capacity in &quot;Space required&quot; field doesn't show correct values when you uncheck optional sections.<br />
2) takes one valuable variable (we have only 10 of them)<br />
<br />
So, ability to query if section is checked or not would be really useful.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">petersa</div><div class="date">30th November 2001, 11:14</div></div><div class="posttext">Hi nsfis,<br />
[list=1]<br />
 Easily fixed using the AddSize command.<br />
 No solution for that. Personally, though, I've never used all ten variables.<br />
[/list=1]Still, I agree that a feature like that would be useful because it would take away the need to write all that extra code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">s0mbre</div><div class="date">30th November 2001, 17:04</div></div><div class="posttext">Hi nsfis. :)<br />
<br />
If you want to save the registers ($0-$9), why not use registry keys as variables, e.g.:<br />
<br />
WriteRegStr HKLM SOFTWARE\MyApp &quot;Flag1&quot; &quot;1&quot;<br />
<br />
You can treat this much the same way you would a variable, you just have to ReadRegStr and do a StrCmp before using it. :)<br />
<br />
Section &quot;-checkflags&quot;<br />
<br />
ReadRegStr $0 HKLM SOFTWARE\MyApp &quot;Flag1&quot;<br />
<br />
;if flag is set, end this section<br />
StrCmp $0 &quot;1&quot; SkipSection<br />
<br />
;if flag is not set, go ahead with this section<br />
...<br />
<br />
SkipSection:<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">petersa</div><div class="date">3rd December 2001, 11:43</div></div><div class="posttext">That's actually quite a good idea!<br />
<br />
By putting stuff in a temporary key in the registry you can pretty much store all the information you need, and then remove it all with one command.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">s0mbre</div><div class="date">3rd December 2001, 21:17</div></div><div class="posttext">Thanks petersa, I'm homoured you consider it to be a good idea. :D<br />
<br />
I've been using simple one bit flags ever since I wrote assembly for the MC68000 in university. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DuaneJeffers</div><div class="date">4th December 2001, 01:54</div></div><div class="posttext">Has Everyone forgotten about IfFileExists????? OMFG!!!! No doubt it <br />
would mean alot of code, but it is much more easier than hacking NSIS with somewhat useful products. Simple Solution:<br />
<br />
Name MyApp<br />
OutFile MyApp.exe<br />
;blah<br />
;blah<br />
;blah (Normal install functions)<br />
<br />
Section &quot;MySection&quot;<br />
File App.exe<br />
SectionEnd<br />
<br />
Section &quot;Plugin 1&quot;<br />
File Plug.dll<br />
SectionEnd<br />
<br />
;If you have more than one file per section, <br />
; then add them then use the first file for<br />
; IfFileExists.<br />
<br />
Section -post<br />
IfFileExists &quot;Plug.dll&quot; 0 noplug<br />
; the zero is for going to the next line<br />
; 1 will also do<br />
RegDLL &quot;Plug.dll&quot;<br />
noplug:<br />
;Continue on with install functions.<br />
<br />
<br />
Now if that is hard to understand, sorry, but adding n-number lines Extra to see if someone has installed a certain section. Now if you have more items in the section, then just use the first file to check to see if the installer has installed the section, then do the appropriate code.<br />
<br />
-Duane</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">4th December 2001, 07:44</div></div><div class="posttext">Duane,<br />
<br />
original post:<br />
I would like to know which components have been<br />
selected before actually installing these components. <br />
So using IfFileExists does not apply here.<br />
<br />
But using the solution by Petersa and using AddSize and<br />
some registry keys, it works fine now!<br />
<br />
Thanks a lot all!<br />
<br />
Greetz.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Hando</div><div class="date">4th December 2001, 09:01</div></div><div class="posttext">I still haven't found a way to apply Felfert's patch and get it all working. Anyone had any luck or is just my inexperience?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>