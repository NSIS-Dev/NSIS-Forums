<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Migration from 2.41 to 2.42 failed, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Migration from 2.41 to 2.42 failed NSIS Discussion" />
	
	<title> Migration from 2.41 to 2.42 failed [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Migration from 2.41 to 2.42 failed</div>
<hr />
<div class="pda"><a href="t-301400.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=301400">Migration from 2.41 to 2.42 failed</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Theresias</div><div class="date">25th December 2008, 13:07</div></div><div class="posttext">First of all, once again thank you for an awesome tool which (once you put some work and thinking in your scripts) does exactly whats needed while being slim and simple for the end user. :up: <br />
<br />
Now to the part where I have to ask for help. ;) <br />
<br />
Even though we are using NSIS for a couple of years now, I have never come across a problem like this. My script works fine with NSIS 2.41 and it even compiles just fine with 2.42 but once you run it the installer claims to be &quot;incomplete/broken&quot;.<br />
<br />
Since there is no real run-time debugging, I frustrated myself with testing for quite a while and apparently this seems to be related to my installation directory or (which I think is more likely) the variables I am using to specify it. <br />
<br />
I have read the release notes for 2.42 and came across the part with the plugins as well as header functions and their declaration. Sadly I was not able to find any details on the header function part.<br />
<br />
P.S.: Please excuse me not posting the script itself since I am reluctant to do so, but if you want specific parts from it I am sure I can supply them.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">25th December 2008, 13:53</div></div><div class="posttext">It would help if you could narrow down the problem a bit, and maybe come up with a minimal example that reproduces the problem</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gbpa005</div><div class="date">25th December 2008, 16:02</div></div><div class="posttext">I have the same problem. I use Eclipse with EclipseNSIS, but compiling the scripts with HMNSIEdit as well generates corrupt installers (Vista). I tried several different installation scripts (absolutely standard installers without any special function): The compilation with 2.41 is absolutely fine and there is no error message with 2.42. When starting the installer, Vista comes up with a &quot;No valid Win32 application&quot;-Error message. Switching back to 2.41 solves the problem.<br />
If there is additional information, that I can give you (logs etc.), please let me know.<br />
<br />
Bye<br />
<br />
<br />
P.S.: A simple autogenerated sample script (EclipseNSIS), that as well causes the problem:<br />
<br />
# Auto-generated by EclipseNSIS Script Wizard<br />
# 25.12.2008 16:58:26<br />
<br />
Name &quot;My Application&quot;<br />
<br />
# General Symbol Definitions<br />
!define REGKEY &quot;SOFTWARE\$(^Name)&quot;<br />
<br />
# MUI Symbol Definitions<br />
!define MUI_ICON &quot;${NSISDIR}\Contrib\Graphics\Icons\modern-install-colorful.ico&quot;<br />
!define MUI_FINISHPAGE_NOAUTOCLOSE<br />
!define MUI_STARTMENUPAGE_REGISTRY_ROOT HKLM<br />
!define MUI_STARTMENUPAGE_NODISABLE<br />
!define MUI_STARTMENUPAGE_REGISTRY_KEY ${REGKEY}<br />
!define MUI_STARTMENUPAGE_REGISTRY_VALUENAME StartMenuGroup<br />
!define MUI_STARTMENUPAGE_DEFAULTFOLDER &quot;My Application&quot;<br />
!define MUI_UNICON &quot;${NSISDIR}\Contrib\Graphics\Icons\modern-uninstall-colorful.ico&quot;<br />
!define MUI_UNFINISHPAGE_NOAUTOCLOSE<br />
<br />
# Included files<br />
!include Sections.nsh<br />
!include MUI2.nsh<br />
<br />
# Variables<br />
Var StartMenuGroup<br />
<br />
# Installer pages<br />
!insertmacro MUI_PAGE_WELCOME<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
!insertmacro MUI_PAGE_STARTMENU Application $StartMenuGroup<br />
!insertmacro MUI_PAGE_INSTFILES<br />
!insertmacro MUI_PAGE_FINISH<br />
!insertmacro MUI_UNPAGE_CONFIRM<br />
!insertmacro MUI_UNPAGE_INSTFILES<br />
<br />
# Installer languages<br />
!insertmacro MUI_LANGUAGE German<br />
<br />
# Installer attributes<br />
OutFile setup.exe<br />
InstallDir &quot;$PROGRAMFILES\My Application&quot;<br />
CRCCheck on<br />
XPStyle on<br />
ShowInstDetails show<br />
InstallDirRegKey HKLM &quot;${REGKEY}&quot; Path<br />
ShowUninstDetails show<br />
<br />
# Installer sections<br />
Section -Main SEC0000<br />
    SetOutPath $INSTDIR<br />
    SetOverwrite on<br />
    File &quot;C:\Program Files\Eclipse\notice.html&quot;<br />
    WriteRegStr HKLM &quot;${REGKEY}\Components&quot; Main 1<br />
SectionEnd<br />
<br />
Section -post SEC0001<br />
    WriteRegStr HKLM &quot;${REGKEY}&quot; Path $INSTDIR<br />
    SetOutPath $INSTDIR<br />
    WriteUninstaller $INSTDIR\uninstall.exe<br />
    !insertmacro MUI_STARTMENU_WRITE_BEGIN Application<br />
    SetOutPath $SMPROGRAMS\$StartMenuGroup<br />
    CreateShortcut &quot;$SMPROGRAMS\$StartMenuGroup\Uninstall $(^Name).lnk&quot; $INSTDIR\uninstall.exe<br />
    !insertmacro MUI_STARTMENU_WRITE_END<br />
    WriteRegStr HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; DisplayName &quot;$(^Name)&quot;<br />
    WriteRegStr HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; DisplayIcon $INSTDIR\uninstall.exe<br />
    WriteRegStr HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; UninstallString $INSTDIR\uninstall.exe<br />
    WriteRegDWORD HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; NoModify 1<br />
    WriteRegDWORD HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; NoRepair 1<br />
SectionEnd<br />
<br />
# Macro for selecting uninstaller sections<br />
!macro SELECT_UNSECTION SECTION_NAME UNSECTION_ID<br />
    Push $R0<br />
    ReadRegStr $R0 HKLM &quot;${REGKEY}\Components&quot; &quot;${SECTION_NAME}&quot;<br />
    StrCmp $R0 1 0 next${UNSECTION_ID}<br />
    !insertmacro SelectSection &quot;${UNSECTION_ID}&quot;<br />
    GoTo done${UNSECTION_ID}<br />
next${UNSECTION_ID}:<br />
    !insertmacro UnselectSection &quot;${UNSECTION_ID}&quot;<br />
done${UNSECTION_ID}:<br />
    Pop $R0<br />
!macroend<br />
<br />
# Uninstaller sections<br />
Section /o -un.Main UNSEC0000<br />
    Delete /REBOOTOK $INSTDIR\notice.html<br />
    DeleteRegValue HKLM &quot;${REGKEY}\Components&quot; Main<br />
SectionEnd<br />
<br />
Section -un.post UNSEC0001<br />
    DeleteRegKey HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot;<br />
    Delete /REBOOTOK &quot;$SMPROGRAMS\$StartMenuGroup\Uninstall $(^Name).lnk&quot;<br />
    Delete /REBOOTOK $INSTDIR\uninstall.exe<br />
    DeleteRegValue HKLM &quot;${REGKEY}&quot; StartMenuGroup<br />
    DeleteRegValue HKLM &quot;${REGKEY}&quot; Path<br />
    DeleteRegKey /IfEmpty HKLM &quot;${REGKEY}\Components&quot;<br />
    DeleteRegKey /IfEmpty HKLM &quot;${REGKEY}&quot;<br />
    RmDir /REBOOTOK $SMPROGRAMS\$StartMenuGroup<br />
    RmDir /REBOOTOK $INSTDIR<br />
SectionEnd<br />
<br />
# Installer functions<br />
Function .onInit<br />
    InitPluginsDir<br />
FunctionEnd<br />
<br />
# Uninstaller functions<br />
Function un.onInit<br />
    ReadRegStr $INSTDIR HKLM &quot;${REGKEY}&quot; Path<br />
    !insertmacro MUI_STARTMENU_GETFOLDER Application $StartMenuGroup<br />
    !insertmacro SELECT_UNSECTION Main ${UNSEC0000}<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Theresias</div><div class="date">25th December 2008, 16:26</div></div><div class="posttext">Originally posted by Anders <br />
It would help if you could narrow down the problem a bit, and maybe come up with a minimal example that reproduces the problem  <br />
<br />
I'll try but since the whole script is rather complicated by now stripping it is not so easy. So far my guess is that the problem is related to directly or file operations in my case since it only happens when creating shortcuts or creating/copying to the installation directory.<br />
<br />
The exact error message in my case is &quot;BeschÃ¤digtes Installations-Programm: ungÃ¼ltiger Befehlscode&quot;, which resembles &quot;Damaged installation program: invalid operating code&quot;. Interesting though, the error occurs in different parts of the procedure depending on the operating system. On Windows Vista x64 is crashes earlier than for example Windows 98.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th December 2008, 23:34</div></div><div class="posttext">Can you attach an example of a corrupt installer? I need the executable itself, not the script. Also, I'd try disabling any anti-virus programs just to make sure it's not a problem with a false positive.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gbpa005</div><div class="date">26th December 2008, 08:29</div></div><div class="posttext">Here is an example: www.wolfgang.lenhard*******setup.exe</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th December 2008, 10:31</div></div><div class="posttext">gbpa005, it seems you're using old stubs with new plug-ins. Your stub doesn't have the new plug-in API in it. Are you sure you've properly installed everything? Try a complete uninstall and reinstall and make sure the NSIS folder is empty between them. Note that this will delete any special plug-ins you've installed into C:\Program Files\NSIS\Plugins, so back them up first.<br />
<br />
Theresias, your problem is even more bizarre and my best theory for it is the anti-virus. A compiled installer would help best at understanding this.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gbpa005</div><div class="date">26th December 2008, 14:48</div></div><div class="posttext">Hi Kichik,<br />
I did a complete reinstall of NSIS, but the problem stays the same: http://www.wolfgang.lenhard*******setup2.exe<br />
I did not install any plugins, just a clean installation from the sourceforge NSIS installer.<br />
<br />
Bye,<br />
  Wolfgang</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th December 2008, 18:10</div></div><div class="posttext">Your stubs are still from the old version. Make sure C:\Program Files\NSIS\Stubs is clean before you reinstall. The stubs should have the following md5 sums:f18bd2eba1b69083c7eea0e1f7080332 *bzip2<br />
3d72747ff56ee61e3703911ef6207905 *bzip2_solid<br />
116f5484e2b8e877d4115cb8af5df10f *lzma<br />
21b89230e9b293d8cdf1618da17f63b9 *lzma_solid<br />
f3885e2b42ee5b16289d12ff1790b48f *zlib<br />
7afcb25acd4f874a7fe6b29b90b9699c *zlib_solid</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gbpa005</div><div class="date">26th December 2008, 19:08</div></div><div class="posttext">I completely deleted the NSIS folder (and all stubs) before reinstalling and I tried so several times. Unless Vista is hiding something from me, the wrong stubs come with the current installer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th December 2008, 20:38</div></div><div class="posttext">I used the current installer to get those md5 sums. Maybe you're using stubs from a different folder by mistake. Try opening C:\Program Files\NSIS\makensisw.exe manually instead of using any shortcuts.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gbpa005</div><div class="date">28th December 2008, 18:38</div></div><div class="posttext">Ok, it was the usual Vista confusion. There had been a directory under VirtualStore, that contained the old stubs. This might pose a problem for a good number of people, who are updating from an older NSIS version. Deleting the folder &quot;VirtualStore\Program Files\NSIS&quot; solves the problem.<br />
<br />
Bye,<br />
  Wolfgang</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Theresias</div><div class="date">29th December 2008, 01:08</div></div><div class="posttext">kichik, I put our faulty installer online and sent you a link via PM. Thanks for taking the time to look into it.<br />
<br />
BTW: I'm very certain this is not anti-virus related since some of the test systems we are using are running in a virtual environment without any protection of some sort. Also haven't totally reinstalled NSIS yet as suggested with  gbpa005's problem, will try that tomorrow.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>