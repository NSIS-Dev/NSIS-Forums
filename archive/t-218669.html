<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Registry backup/restore, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Registry backup/restore NSIS Discussion" />
	
	<title> Registry backup/restore [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Registry backup/restore</div>
<hr />
<div class="pda"><a href="t-218669.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=218669">Registry backup/restore</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">11th June 2005, 23:50</div></div><div class="posttext">Greetings all,<br />
I want to create a registry backup function that will allow me to backup an entire registry key. (I haven't decided yet on whether I should try to make a REG file or invent my own INI file or some other data file.  For now, I'm just focusing on how to get the info out.)<br />
<br />
I know that I can use EnumRegKey and EnumRegValue to obtain a list of items and then use one of the WriteReg commands to enter it back in.  <br />
<br />
But, this is where it gets tricky:  <br />
How do I figure out what the data type is of the value I just read?  For example, I could be reading a binary value, a string value, and expanded string value, or a DWORD value, just to name a few common ones.  (I will need to know this before I try to write the value back in.)<br />
<br />
Does anyone know how I might accomplish this?  Or does anyone know of a tool or plugin that might help me accomplish this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">12th June 2005, 09:19</div></div><div class="posttext">ExecWait 'regedit /s &quot;C:\ExportToRegistry.reg&quot;'<br />
ExecWait 'regedit /e &quot;C:\ImportFromRegistry.reg&quot; HKEY_LOCAL_MACHINE\SOFTWARE\MyKey'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">12th June 2005, 16:01</div></div><div class="posttext">Thanks for this suggestion, Intructtor.  This looks to be exactly the thing I was looking for!  :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Chilli24</div><div class="date">31st July 2005, 16:14</div></div><div class="posttext">Hi...<br />
About this &quot;regedit /s&quot;<br />
It seems that it doesn't actually do a full backup. What I mean is:<br />
Let's I have 3 string values under a key.<br />
I make a backup using &quot;regedit /e&quot;<br />
If I delete a string value and then run &quot;regedit /s&quot;, it will restore it.<br />
But if instead of deleting it I add a forth string value, it will not delete this new entry, so I can have the original key.<br />
I hope it makes some sense and somebody can help me figure out how to have a reliable way of backing up registry.<br />
Thank you</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">31st July 2005, 18:22</div></div><div class="posttext">Actually, regedit /s will do a full backup - however, the backup doesn't work like you expect.<br />
<br />
The .reg file that is created contains a list of existing keys and values. When restored, these are added one by one, but any additional keys are not removed, as that would be insecure and could break software.<br />
<br />
If you want to remove everything not in your backup, you'd probably be best off finding the file where Windows stores its registry data. Though I'm not sure if it'll actually let you modify that file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">31st July 2005, 18:55</div></div><div class="posttext">Chilli24:<br />
Pigeot is correct in that a  REG file will only ADD or MODIFIY values that are specifically in that file.  A REG file will not modify any value that is not included in the reg file itself nor will it delete values.<br />
<br />
If you want to ensure that items get removed, you should first delete the main key before you merge the original file back in.  (For example, if you backed up the key HKLM\Software\Widgets Inc, then you should delete this entire key before merging in the original backup).<br />
<br />
Another way to go would be to find the items you want to save and then back them up one by one.  (The reason this didn't work for me was that I had no way to knowing exactly what what types of data might be included in the key I needed to backup.  But perhpas your situation is different.)<br />
<br />
And a few more good tips:<br />
1.  Before you start messing with the registry, it's good to first check to make sure that you have access to it.<br />
<br />
2.  Make sure you thoroughly test your install--you don't want to accidentally delete the wrong key as that could have disastrous results!<br />
<br />
EDIT:<br />
I was wrong about deleting.  It can be done with the proper syntax in a REG file.  Check this link out:<br />
http://support.microsoft.com/default.aspx?scid=kb;en-us;310516&amp;sd=tech</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">31st July 2005, 19:37</div></div><div class="posttext">Yes, but as you've probably seen, this method is not practical for removing all keys added later, as you need to enumerate each one by name. It will also require you to manually do this, as the Registry Editor doesn't do it for you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Chilli24</div><div class="date">1st August 2005, 13:06</div></div><div class="posttext">I've ended up in deleting the new entries &quot;manually&quot;. <br />
But, anyway, thanks for your help. I appreciate it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">2nd August 2005, 05:32</div></div><div class="posttext">regedit - special:<br />
<br />
/e = export<br />
/s = do it silent - can be used on import&amp;export<br />
/a = export als old fashioned win9x style (hidden switch, only NT systems / ascii-format)<br />
<br />
in a reg file:<br />
[-key] will delete a key<br />
[key] will add a key<br />
<br />
on export you should be sure that regedit.exe is closed otherwise all export will fail.<br />
<br />
  ;close regedit before export<br />
  GoTo Running2<br />
    <br />
  Exit2:<br />
    MessageBox MB_YESNO|MB_ICONEXCLAMATION &quot;${MUI_ABORTWARNING_TEXT}&quot; IDNO Running2<br />
    Quit<br />
<br />
  Running2:<br />
    FindWindow $R9 &quot;RegEdit_RegEdit&quot; &quot;&quot;<br />
    IntCmp $R9 0 NotRunning2<br />
      MessageBox MB_OKCANCEL|MB_ICONEXCLAMATION &quot;please close the windows registry\n      program (REGEDIT.EXE, REGEDT32.EXE) !&quot; IDCANCEL Exit2<br />
      GoTo Running2<br />
  NotRunning2:<br />
    Execwait '&quot;regedit.exe&quot; /e $path\regfile.reg HKEY_CURRENT_USER\Software\mysoftware'</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>