<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" deleting all installed files and folders without RmDir /r, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  deleting all installed files and folders without RmDir /r NSIS Discussion" />
	
	<title> deleting all installed files and folders without RmDir /r [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  deleting all installed files and folders without RmDir /r</div>
<hr />
<div class="pda"><a href="t-341288.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=341288">deleting all installed files and folders without RmDir /r</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">xlrotor</div><div class="date">27th January 2012, 07:52</div></div><div class="posttext">I like to use /r when installing my application, but not when uninstalling since that will also delete files I did not install (as often recommended on this forum).<br />
<br />
After looking at AdvUninstLog2.nsh and UninstallLog.nsh I decided to take a different approach to deleting only my installed files and not anything else.  Maybe this has been posted before, but I didn't come across it.<br />
<br />
Before compiling my NSIS script, I run the short Visual Basic program below to generate a nsh include file containing Delete and RmDir commands to remove everything from the user's computer.<br />
<br />
In my NSIS script I do the installing like as follows.  Here I am installing into Program Files and to the user's APPDATA folder.<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
  File /a &quot;Files\*.*&quot;<br />
  SetOutPath &quot;$INSTDIR\Network&quot;<br />
  File /a /r &quot;Files\Network\*.*&quot;<br />
  SetShellVarContext all  ;all means install for all users<br />
  SetOutPath &quot;$APPDATA\Xlrotor&quot;<br />
  File /a /r &quot;Files\Xlrotor\*.*&quot;<br />
<br />
The good part is that to uninstall all that is needed is:<br />
  SetShellVarContext all<br />
  !include &quot;DeleteInstalledFiles.nsh&quot;<br />
<br />
It doesn't win points for elegance, but it gets the the job done without much fuss.  I run the visual basic program in Excel, but I it could be run from any Office application or in a VB6 or .Net program, too, I suppose.  It only needs to be run once, or when the list of installed files changes.<br />
<br />
I hope somebody finds it useful.<br />
<br />
I wonder if a VB6 program could be run by the NSIS compiler when the script is compiled to update the include file before it is invoked later in the script.  Can that be done?<br />
<br />
Cheers,<br />
<br />
Brian in Austin Texas<br />
<br />
Sub do_it()<br />
    Close<br />
    Open ThisWorkbook.path &amp; &quot;\DeleteInstalledFiles.nsh&quot; For Output As #1<br />
    'I do the folders sort of in reverse order so the RmDir commands will delete subfolders before parent folders<br />
    ListFolder ThisWorkbook.path &amp; &quot;\Files\XLRotor&quot;, &quot;&quot;&quot;$APPDATA&quot;, True<br />
    ListFolder ThisWorkbook.path &amp; &quot;\Files\Network&quot;, &quot;&quot;&quot;$INSTDIR&quot;, False<br />
    ListFolder ThisWorkbook.path &amp; &quot;\Files&quot;, &quot;&quot;&quot;$INSTDIR&quot;, False<br />
    Close<br />
End Sub<br />
<br />
'If the folder structure is deeper than 2 levels, additional inner loops could be added.<br />
Sub ListFolder(path$, prefix$, Recurse As Boolean)<br />
Dim sFolderPath As String<br />
sFolderPath = path<br />
    Dim FS As New FileSystemObject<br />
    Dim FSfolder As Folder<br />
    Dim subfolder As Folder<br />
    Dim subsubfolder As Folder<br />
    Dim xFiles As Files<br />
    Dim oneFile As File<br />
    Dim i As Integer<br />
    <br />
    Set FSfolder = FS.GetFolder(sFolderPath)<br />
    For Each oneFile In FSfolder.Files<br />
        Print #1, &quot;Delete &quot; &amp; prefix &amp; Mid(oneFile.path, InStr(oneFile.path, &quot;\Files\&quot;) + 6) &amp; &quot;&quot;&quot;&quot;<br />
    Next oneFile<br />
    If Recurse Then<br />
        For Each subfolder In FSfolder.SubFolders<br />
            DoEvents<br />
            i = i + 1<br />
            For Each oneFile In subfolder.Files<br />
                Print #1, &quot;Delete &quot; &amp; prefix &amp; Mid(oneFile.path, InStr(oneFile.path, &quot;\Files\&quot;) + 6) &amp; &quot;&quot;&quot;&quot;<br />
            Next<br />
            For Each subsubfolder In subfolder.SubFolders<br />
                DoEvents<br />
                i = i + 1<br />
                For Each oneFile In subsubfolder.Files<br />
                    Print #1, &quot;Delete &quot; &amp; prefix &amp; Mid(oneFile.path, InStr(oneFile.path, &quot;\Files\&quot;) + 6) &amp; &quot;&quot;&quot;&quot;<br />
                Next<br />
                Print #1, &quot;RmDir  &quot; &amp; prefix &amp; Mid(subsubfolder.path, InStr(subsubfolder.path, &quot;\Files\&quot;) + 6) &amp; &quot;&quot;&quot;&quot;<br />
            Next subsubfolder<br />
            Print #1, &quot;RmDir  &quot; &amp; prefix &amp; Mid(subfolder.path, InStr(subfolder.path, &quot;\Files\&quot;) + 6) &amp; &quot;&quot;&quot;&quot;<br />
        Next subfolder<br />
    End If<br />
    Print #1, &quot;RmDir  &quot; &amp; prefix &amp; Mid(FSfolder.path, InStr(FSfolder.path, &quot;\Files&quot;) + 6) &amp; &quot;&quot;&quot;&quot;<br />
End Sub</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th January 2012, 10:55</div></div><div class="posttext">This is quite a common approach actually. You could in fact write a silent NSIS installer to generate the NSH too. To run it at build time, use !system or !execute using wscript.exe.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xlrotor</div><div class="date">28th January 2012, 13:58</div></div><div class="posttext">Thanks for the tip about !system and !execute, Stu.  Those will come in handy.<br />
<br />
I'm not surprised the VB approach is a common technique.  But it didn't turn up in my searches in the forum, which is why I posted a note about it.  Anyhow, on with the show.<br />
<br />
Cheers,<br />
<br />
Brian</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th January 2012, 14:13</div></div><div class="posttext">I mean generally, not necessarily using VB (NSIS is used most commonly).<br />
<br />
http://nsis.sourceforge.net/Invoking_NSIS_run-time_commands_on_compile-time<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>