<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" SetShellVarContext on-the-fly ?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  SetShellVarContext on-the-fly ? NSIS Discussion" />
	
	<title> SetShellVarContext on-the-fly ? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  SetShellVarContext on-the-fly ?</div>
<hr />
<div class="pda"><a href="t-308808.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=308808">SetShellVarContext on-the-fly ?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">nsnb</div><div class="date">23rd July 2009, 19:36</div></div><div class="posttext">Can I start a section with SetShellVarContext current Then change it later on (in same section) to  SetShellVarContext all Then change it again to SetShellVarContext current ?<br />
<br />
The goal is to place some shortcuts on the Start Menu of the Administrator only, then place some items on the Start Menu of All Users, then restore ShellVarContext back to current.<br />
<br />
I just tried that and it didn't work for me. So either there is an inherent limitation of which I didn't know or I am doing something wrong.<br />
<br />
If the latter, any idea what could possibly go wrong in simple code like this? <br />
SetShellVarContext all<br />
CreateShortCut &quot;${D_STARTMENU}\\MyApp.lnk&quot; &quot;myapp.exe&quot;<br />
SetShellVarContext current</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">23rd July 2009, 20:25</div></div><div class="posttext">Did you define D_STARTMENU somewhere?<br />
That define will not change based on SetShellVarContext.<br />
Use $SMPROGRAMS instead (See chapter 4.2.3 in the NSIS manual)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nsnb</div><div class="date">24th July 2009, 15:57</div></div><div class="posttext">Originally posted by jpderuiter <br />
Did you define D_STARTMENU somewhere?<br />
Yes I did. Thank you for the tip. I changed the above to:<br />
SetShellVarContext all <br />
CreateShortCut &quot;$SMPROGRAMS\${D_COMPANY}\${D_PRODUCT}\\MyApp.lnk&quot; &quot;$PROGRAMFILES\${D_COMPANY}\${D_PRODUCT}\\myapp.exe&quot; <br />
SetShellVarContext current<br />
But this still doesn't work.<br />
<br />
Interestingly enough, I have no such problem with SetOutPath.<br />
<br />
Did changing SetShellVarContext on the fly ever worked for anyone?<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nsnb</div><div class="date">24th July 2009, 16:18</div></div><div class="posttext">Update: If I change:<br />
CreateShortCut &quot;$SMPROGRAMS\${D_COMPANY}\${D_PRODUCT}\\MyApp.lnk&quot; &quot;$PROGRAMFILES\${D_COMPANY}\${D_PRODUCT}\\myapp.exe&quot; <br />
To: CreateShortCut &quot;$SMPROGRAMS\\MyApp.lnk&quot; &quot;$PROGRAMFILES\${D_COMPANY}\${D_PRODUCT}\\myapp.exe&quot; <br />
It works.<br />
<br />
Strange. I know that ${D_COMPANY} and ${D_PRODUCT} are defined and valid. Why is it behaving like this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nsnb</div><div class="date">24th July 2009, 16:31</div></div><div class="posttext">Problem solved. :) <br />
<br />
What was missing is the CreateDirectory statement before the CreateShortCut:<br />
CreateDirectory &quot;$SMPROGRAMS\${D_COMPANY}\${D_PRODUCT}&quot;<br />
jpderuiter, thank you again for the clue that led to the solution.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>