<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Set caption of a link control?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Set caption of a link control? NSIS Discussion" />
	
	<title> Set caption of a link control? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Set caption of a link control?</div>
<hr />
<div class="pda"><a href="t-258075.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=258075">Set caption of a link control?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">22nd October 2006, 13:42</div></div><div class="posttext">Hello all,<br />
<br />
I'm trying to set the caption of a link/hyperlink control (the one provided by InstallOptions).  The following does not work:<br />
<br />
<br />
SendMessage &lt;handle to the control&gt; ${WM_SETTEXT} 0 &quot;STR:http://whatever.net/&quot;<br />
<br />
<br />
I have verified that the control handle is correct by using..<br />
ShowWindow &lt;handle&gt; 0<br />
It disappears just fine.<br />
<br />
Note that for the specific application, I cannot modify the .ini file before the dialog is displayed - the caption of the link would be modified when the user presses a button (which does some fancy things and the appropriate caption is chosen from its results) on the same dialog as this link control.<br />
<br />
I'm probably missing something obvious - I'm just hoping that the obvious is -not- &quot;You cannot do that&quot;.<br />
<br />
Thanks in advance for any insights :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">22nd October 2006, 22:36</div></div><div class="posttext">Did you !include &quot;WinMessages.nsh&quot;? This is necessary to use &quot;${WM_SETTEXT}&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">23rd October 2006, 07:48</div></div><div class="posttext">yep... I'm using it on label controls and a button control, and it's working just fine on those.  Here's a sample script.  Note: this is with NSIS v2.06<br />
<br />
<br />
!include &quot;WinMessages.nsh&quot;<br />
<br />
Name &quot;&quot;<br />
OutFile &quot;Setup.exe&quot;<br />
<br />
Page Custom CustomPre CustomPost<br />
Page InstFiles<br />
<br />
Function .onInit<br />
  InitPluginsDir<br />
  File /oname=$PLUGINSDIR\test.ini test.ini<br />
FunctionEnd<br />
<br />
Function CustomPre<br />
  Push $R0<br />
  Push $R1<br />
  Push $R2<br />
<br />
    InstallOptions::initDialog /NOUNLOAD $PLUGINSDIR\test.ini<br />
    Pop $R0<br />
<br />
    GetDlgItem $R1 $R0 1200 ;1200 + Field number - 1<br />
<br />
    InstallOptions::show<br />
    Pop $R0<br />
<br />
  Pop $R2<br />
  Pop $R1<br />
  Pop $R0<br />
<br />
FunctionEnd<br />
<br />
Function CustomPost<br />
	ReadINIStr $0 &quot;$PLUGINSDIR\test.ini&quot; &quot;Settings&quot; &quot;State&quot;<br />
	IntCmp $0 0 _abort<br />
	IntCmp $0 1 _click<br />
	_click:<br />
	    GetDlgItem $0 $R0 1200<br />
		SendMessage $0 ${WM_SETTEXT} &quot;&quot; &quot;STR:FooBar&quot;<br />
	    GetDlgItem $0 $R0 1201<br />
		SendMessage $0 ${WM_SETTEXT} &quot;&quot; &quot;STR:http://nsis.sourceforge.net/&quot;<br />
	_abort:<br />
		Abort<br />
FunctionEnd<br />
<br />
Section &quot;Test&quot;<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">23rd October 2006, 10:44</div></div><div class="posttext">I forgot... content of test.ini:<br />
<br />
; Ini file generated by the HM NIS Edit IO designer.<br />
[Settings]<br />
NumFields=2<br />
<br />
[Field 1]<br />
Type=Button<br />
Text=push me<br />
Flags=NOTIFY<br />
Left=100<br />
Right=150<br />
Top=30<br />
Bottom=45<br />
<br />
[Field 2]<br />
Type=Link<br />
Text=Link<br />
Left=72<br />
Right=181<br />
Top=73<br />
Bottom=81</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">23rd October 2006, 12:33</div></div><div class="posttext">Oh... now I remember why that doesn't work. &quot;Link&quot; controls draw the text only when the dialog starts up. InstallOptions has custom drawing functions specific for this control. WM_SETTEXT needs to be handled by the plug-in for this control in order to support drawing it after it is changed using that message (AFAIK).<br />
<br />
I'm just hoping that the obvious is -not- &quot;You cannot do that&quot;.the obvious is that =(... and no workarounds...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">23rd October 2006, 13:16</div></div><div class="posttext">d'oh...<br />
<br />
Well I'm working on a work-around, and it works nearly perfectly, except for one thing - I need to change the focus from one control to another (any), or else if a user hits tab (as users invariably do), my link control pops back up and ruins my work-around.<br />
<br />
Now I know it involves WM_KILLFOCUS and WM_SETFOCUS (I think both, not 100% sure), but be darned if I have the skill to know what the lParam and wParam bits should be.  If you know, or just have a friendly pointer, please do type away :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">23rd October 2006, 13:28</div></div><div class="posttext">well, that should just be:<br />
<br />
<br />
SendMessage &lt;handle&gt; ${WM_KILLFOCUS|WM_SETFOCUS} 0 0<br />
<br />
<br />
Unfortunately, that link control refuses to lose focus.  Grrr. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">23rd October 2006, 13:36</div></div><div class="posttext">Alright, giving up.  Too many problems with that approach.<br />
<br />
Essentially I had a blank link control overlapping a label control.  The label control was colored blue so as to appear like a link.<br />
<br />
When the link control is pressed it, for reasons unknown to me, suddenly becomes opaque - so I have to re-show the label control.<br />
<br />
Then there's the bit about not allowing the link control to be tabbed to, storing a URL in the label control's State value (not in the link, or it'll actually act like a link), making the link instead issue a NOTIFY, and using that to open the actual URL.<br />
<br />
So far so good - where things go wrong:<br />
As soon as I use ExecShell, that darn link control refuses to lose focus.  Meaning that as soon as somebody alt-tabs back to the installer, or tabs from that control, my label has once again disappeared behind the link control that suddenly went opaque.<br />
Perhaps the above is fixable, perhaps not.<br />
<br />
The second issue is that if you mouseDown on the link control, then mouseUp outside of it, the link control still gets 'focus', turns opaque, but because you don't mouseUp on it, no NOTIFY is issued, and no chance is had to bring the label back to life. drat.<br />
<br />
So, my only option, it appears, is to use a Button control instead.  I guess I can still make its text blue :x</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">23rd October 2006, 13:37</div></div><div class="posttext">for the curious, here's the code up to the point where I'm giving up.<br />
<br />
.nsi<br />
<br />
!include &quot;WinMessages.nsh&quot;<br />
<br />
Name &quot;&quot;<br />
OutFile &quot;Setup.exe&quot;<br />
<br />
Page Custom CustomPre CustomPost<br />
Page InstFiles<br />
<br />
Function .onInit<br />
  InitPluginsDir<br />
  File /oname=$PLUGINSDIR\test.ini test.ini<br />
FunctionEnd<br />
<br />
Function CustomPre<br />
  Push $R0<br />
  Push $R1<br />
  Push $R2<br />
<br />
    InstallOptions::initDialog /NOUNLOAD $PLUGINSDIR\test.ini<br />
    Pop $R0<br />
<br />
	; Change the color of the text so it appears like a link<br />
    GetDlgItem $0 $R0 1202					; get the label control<br />
	ShowWindow $0 0         				; hide it<br />
	SetCtlColors $0 0x0000ff &quot;transparent&quot;	; change colors to blue on transparent<br />
	ShowWindow $0 1                         ; and show it<br />
<br />
    InstallOptions::show<br />
    Pop $R0<br />
<br />
  Pop $R2<br />
  Pop $R1<br />
  Pop $R0<br />
<br />
FunctionEnd<br />
<br />
Function CustomPost<br />
	ReadINIStr $0 &quot;$PLUGINSDIR\test.ini&quot; &quot;Settings&quot; &quot;State&quot;<br />
	IntCmp $0 0 _NEXT<br />
	IntCmp $0 1 _CNN<br />
	IntCmp $0 2 _NSIS<br />
	IntCmp $0 4 _link<br />
	_cnn:<br />
	    GetDlgItem $0 $R0 1202<br />
	    ShowWindow $0 0<br />
		SendMessage $0 ${WM_SETTEXT} &quot;&quot; &quot;STR:http://www.cnn.com/&quot;<br />
		WriteIniStr &quot;$PLUGINSDIR\test.ini&quot; &quot;Field 3&quot; &quot;State&quot; &quot;http://www.cnn.com/&quot;<br />
	    ShowWindow $0 1<br />
		Abort<br />
	_nsis:<br />
	    GetDlgItem $0 $R0 1202<br />
	    ShowWindow $0 0<br />
		SendMessage $0 ${WM_SETTEXT} &quot;&quot; &quot;STR:http://nsis.sourceforge.net/&quot;<br />
		WriteIniStr &quot;$PLUGINSDIR\test.ini&quot; &quot;Field 3&quot; &quot;State&quot; &quot;http://nsis.sourceforge.net/&quot;<br />
	    ShowWindow $0 1<br />
		Abort<br />
	_link:<br />
		ReadIniStr $0 &quot;$PLUGINSDIR\test.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
		ExecShell &quot;open&quot; $0<br />
	    GetDlgItem $0 $R0 1203<br />
		SendMessage $0 ${WM_KILLFOCUS} 0 0<br />
	    GetDlgItem $0 $R0 1200<br />
		SendMessage $0 ${WM_SETFOCUS} 0 0<br />
	    GetDlgItem $0 $R0 1202<br />
		ShowWindow $0 0<br />
		ShowWindow $0 1<br />
		Abort<br />
	_next:<br />
FunctionEnd<br />
<br />
Section &quot;Test&quot;<br />
SectionEnd<br />
<br />
<br />
test.ini<br />
<br />
[Settings]<br />
NumFields=4<br />
<br />
[Field 1]<br />
Type=Button<br />
Flags=NOTIFY<br />
Text=CNN<br />
Top=30<br />
Left=64<br />
Bottom=44<br />
Right=114<br />
<br />
[Field 2]<br />
Type=Button<br />
Flags=NOTIFY<br />
Text=NSIS<br />
Top=30<br />
Left=132<br />
Bottom=44<br />
Right=182<br />
<br />
[Field 3]<br />
Type=Label<br />
Flags=NOTABSTOP<br />
Text=http://www.cnn.com/<br />
State=http://www.cnn.com/<br />
Top=56<br />
Left=68<br />
Bottom=64<br />
Right=181<br />
<br />
[Field 4]<br />
Type=Link<br />
Flags=NOTABSTOP|NOTIFY<br />
Text=Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_Â_<br />
State=<br />
Top=56<br />
Left=68<br />
Bottom=64<br />
Right=177</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">23rd October 2006, 13:49</div></div><div class="posttext">actually.. come to think of it.  Is it possible to change button controls' borders?  If so - I suppose I could just get rid of the button control's 3D border.  For all intents and purposes, that should have it look like a plain ol' link control (as long as I make the text blue, too).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">23rd October 2006, 14:14</div></div><div class="posttext">excepting, of course, that you can't set the text color of a Button control? *sigh* :)<br />
<br />
I'll have to re-think this, or go with that iffy work-around after all.. hmm.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">23rd October 2006, 14:27</div></div><div class="posttext">generic link text &quot;Click here for more information&quot; with a varying URL (still by means of NOTIFY, so I can use the &quot;open in new browser window&quot; function) is going to have to be it, looks like.  Was hoping to show the actual URL on it so those who prefer typing it in, could.  Perhaps elsewhere in the dialog. Hrm.<br />
<br />
*kicks that link control* ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">23rd October 2006, 19:46</div></div><div class="posttext">You could use the ToolTips plug-in (http://nsis.sourceforge.net/ToolTips_plug-in) to show the address of the link when the user hovers the mouse on it. Also, the tooltip disappears after the user clicked on the link, which might be seen as a feature :) or as a problem :(...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">23rd October 2006, 21:51</div></div><div class="posttext">oooh.. good idea :)  tooltip that disappears after the user clicked on the link... hmm.. permanently? will have to play with it.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>