<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" An idea for a function, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  An idea for a function NSIS Discussion" />
	
	<title> An idea for a function [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  An idea for a function</div>
<hr />
<div class="pda"><a href="t-140228.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=140228">An idea for a function</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th June 2003, 21:18</div></div><div class="posttext">I was trying to find a way to copy a string to the Windows clipboard using the System plugin, but was unable to find a way (I'm no C++ programmer see!)<br />
I was wondering how this would be achieved?<br />
<br />
When I mean &quot;Windows clipboard&quot; I mean so that the user can do a Ctrl+V and the string is copied automatically (without the user doing a Ctrl+C before hand)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">26th June 2003, 21:40</div></div><div class="posttext">In think that there's a &quot;Message&quot; for that:<br />
See in the ${NSISDIR}\Include\WinMessages.nsh</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th June 2003, 22:00</div></div><div class="posttext">Ah ok.<br />
I have no idea what to do next however...<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">26th June 2003, 22:07</div></div><div class="posttext">Maybe with the &quot;SendMessage&quot; use it :weird:<br />
But, don't you need to reply that message?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">26th June 2003, 22:15</div></div><div class="posttext">System::Call 'user32::OpenClipboard(i 0)'<br />
     System::Call 'user32::EmptyClipboard()'<br />
     System::Call '*(&amp;t1024 &quot;Just a clipboard demo!&quot;) i.r0'<br />
     System::Call 'user32::SetClipboardData(i 1, i r0)'<br />
     System::Call 'user32::CloseClipboard()'<br />
     System::Free $0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th June 2003, 22:46</div></div><div class="posttext">Originally posted by Lobo Lunar <br />
Maybe with the &quot;SendMessage&quot; use it :weird:<br />
But, don't you need to reply that message?  <br />
<br />
Well duh.<br />
Thanks for the System dll way - that's the kind of way which I was trying to find.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">26th June 2003, 22:50</div></div><div class="posttext">Well...don't blame me for trying :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th June 2003, 22:58</div></div><div class="posttext">Now, how would I go about getting text from the clipboard into a string :)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">26th June 2003, 23:19</div></div><div class="posttext">System::Call 'user32::OpenClipboard(i 0)' <br />
System::Call 'user32::GetClipboardData(i 1) t .r0'<br />
System::Call 'user32::CloseClipboard()'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th June 2003, 23:31</div></div><div class="posttext">brainsucker, according to MSDN you are not supposed to free the memory of the clipboard data, and if allocated it should use GMEM_MOVEABLE. So the code should probably look like this:<br />
<br />
StrCpy $0 &quot;string to put in clipboard&quot;<br />
System::Call 'user32::OpenClipboard(i 0)' <br />
System::Call 'user32::EmptyClipboard()'<br />
StrLen $1 $0 <br />
System::Call 'kernel32::GlobalAlloc(i 2, i $1) i.r1' <br />
System::Call 'kernel32::lstrcpyA(i $1, t $0)'<br />
System::Call 'user32::SetClipboardData(i 1, i r1)' <br />
System::Call 'user32::CloseClipboard()'<br />
<br />
Also, SetClipboardData and CloseClipboard both return a value. Does System.dll default to int return value if nothing is specified?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">26th June 2003, 23:49</div></div><div class="posttext">MSDN: The application can read the data, but must not free the handle or leave it locked until the CloseClipboard function is called. (The application can access the data after calling CloseClipboard). <br />
&quot;Can access&quot; could mean 'free', imho.<br />
No considirations about GMEM_MOVEABLE, anyway your way is more correct, but my way works to :) for strings at least ;)<br />
<br />
Functions/Procedures return values in registers, and it doesn't matter how we process it... So if we don't specify return type system plugin just skips the converting step...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th June 2003, 23:56</div></div><div class="posttext">MSDN example (http://msdn.microsoft.com/library/en-us/winui/WinUI/WindowsUserInterface/DataExchange/Clipboard/UsingtheClipboard.asp?frame=true) doesn't free the memory, so I guess we shouldn't too. But it does something else that I have forgotten in my code, it uses GlobalLock. Complete code should be:<br />
<br />
StrCpy $0 &quot;string to put in clipboard&quot; <br />
System::Call 'user32::OpenClipboard(i 0)' <br />
System::Call 'user32::EmptyClipboard()' <br />
StrLen $1 $0 <br />
System::Call 'kernel32::GlobalAlloc(i 2, i $1) i.r1' <br />
System::Call 'kernel32::GlobalLock(i $1) i.r2'<br />
System::Call 'kernel32::lstrcpyA(i $2, t $0)' <br />
System::Call 'kernel32::GlobalUnlock(i $1)'<br />
System::Call 'user32::SetClipboardData(i 1, i r1)' <br />
System::Call 'user32::CloseClipboard()'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th June 2003, 10:27</div></div><div class="posttext">So, which are the final two scripts?<br />
I'd like to add them to the archive when I get back home...<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">27th June 2003, 12:49</div></div><div class="posttext">The last one is the final for copy. The only one that was supposed to be for paste is still the final ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th June 2003, 16:25</div></div><div class="posttext">Thanks!<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=338&amp;instances=0,11,122<br />
<br />
-Stu :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">2nd July 2003, 18:20</div></div><div class="posttext">I've missed some 'tips' in Kichik's script, the right version should look like:<br />
<br />
<br />
StrCpy $0 &quot;string to put in clipboard&quot; <br />
System::Call 'user32::OpenClipboard(i 0)' <br />
System::Call 'user32::EmptyClipboard()' <br />
StrLen $1 $0 <br />
IntOp $1 + 1<br />
System::Call 'kernel32::GlobalAlloc(i 2, i r1) i.r1' <br />
System::Call 'kernel32::GlobalLock(i r1) i.r2' <br />
System::Call 'kernel32::lstrcpyA(i r2, t r0)' <br />
System::Call 'kernel32::GlobalUnlock(i r1)' <br />
System::Call 'user32::SetClipboardData(i 1, i r1)' <br />
System::Call 'user32::CloseClipboard()'<br />
<br />
<br />
All changes of $n to rn are non fatal, beside the line with lstrcpy,<br />
where $0 shouldn't and couldn't work right.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>