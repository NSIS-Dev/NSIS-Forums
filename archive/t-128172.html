<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Remove shortcuts issue, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Remove shortcuts issue NSIS Discussion" />
	
	<title> Remove shortcuts issue [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Remove shortcuts issue</div>
<hr />
<div class="pda"><a href="t-128172.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=128172">Remove shortcuts issue</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">brv</div><div class="date">12th March 2003, 09:44</div></div><div class="posttext">Hello,<br />
<br />
I'm stucked with a remove shortcuts issue:<br />
<br />
If user A installs MyApp and user B removes it, I end up with user A having all shortcuts on his desktop and start menu undeleted. Any ideea how to fix this problem ?<br />
<br />
Thanks,<br />
Radu Ban</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">12th March 2003, 12:44</div></div><div class="posttext">SetShellVarContext all</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brv</div><div class="date">12th March 2003, 13:55</div></div><div class="posttext">Thanks for your reply.<br />
<br />
But what happens if both users A and B are power users? <br />
AFAIK, setting SetShellVarContext all will work only for administrative accounts.<br />
Also, deleting the links for &quot;all&quot; setting will delete it only if it was installed in the &quot;All Users&quot; path ...<br />
<br />
The only solution I come up is to save the $DESKTOP and $SMPROGRAMS used for installation in the registry under the uninstaller keys and to use them on uninstall instead of $DESKTOP and $SMPROGRAMS.<br />
<br />
Thanks,<br />
Radu Ban</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">12th March 2003, 13:58</div></div><div class="posttext">Using SetShellVarContext all automatically sets $SMPROGRAMS to the &quot;All Users&quot; path.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brv</div><div class="date">12th March 2003, 14:16</div></div><div class="posttext">Yes, but the settings for user A are saved in the user A profile not in the &quot;All Users&quot; path. The uninstaller will try to remove the settings from &quot;All Users&quot; and not remove the settings from user A profile ...<br />
<br />
Thanks,<br />
Radu Ban</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">12th March 2003, 14:27</div></div><div class="posttext">In this situation you should put the shortcuts in the &quot;All Users&quot; dir. B has probably no rights to delete A's files.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">flizebogen</div><div class="date">12th March 2003, 14:51</div></div><div class="posttext">;try this<br />
<br />
;in the installer<br />
<br />
ReadEnvStr $1 USERNAME<br />
<br />
;reads the username<br />
<br />
WriteIniStr $INSTDIR\settings.ini <br />
Common User &quot;$1&quot;<br />
<br />
;writes it to the ini file<br />
<br />
<br />
<br />
<br />
Section Uninstall<br />
ReadIniStr $1 $INSTDIR\settings.ini Common &quot;User&quot;<br />
ReadEnvStr $2 USERNAME<br />
<br />
Strcmp &quot;$1&quot; &quot;$2&quot; &quot;&quot; &quot;leave_uninst&quot;<br />
here goes the real uninstal stuff<br />
<br />
<br />
:leave_uninst<br />
MessageBox MB_OK &quot;The program was installed by $1 and can only be uninstalled with this User. Please Login as $1 and start uninstaller&quot;<br />
abort<br />
SectionEnd<br />
<br />
this is the only way i know to know both account names and compare them<br />
<br />
hope it helps</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brv</div><div class="date">12th March 2003, 14:54</div></div><div class="posttext">As I wrote, users A and B are both Power Users. User A can't install in the &quot;All Users&quot; profile because it has no administrative privileges. In this case the app will be invisible for user B since all the shortcuts are on user's A profile. However, the uninstall will be visible in the control panel, so if B removes it(and it can because it's also an Power User) is preferable to do a clean uninstall.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brv</div><div class="date">12th March 2003, 15:01</div></div><div class="posttext">Originally posted by flizebogen <br />
;try this<br />
<br />
;in the installer<br />
<br />
ReadEnvStr $1 USERNAME<br />
<br />
;reads the username<br />
<br />
WriteIniStr $INSTDIR\settings.ini <br />
Common User &quot;$1&quot;<br />
<br />
;writes it to the ini file<br />
<br />
<br />
<br />
<br />
Section Uninstall<br />
ReadIniStr $1 $INSTDIR\settings.ini Common &quot;User&quot;<br />
ReadEnvStr $2 USERNAME<br />
<br />
Strcmp &quot;$1&quot; &quot;$2&quot; &quot;&quot; &quot;leave_uninst&quot;<br />
here goes the real uninstal stuff<br />
<br />
<br />
:leave_uninst<br />
MessageBox MB_OK &quot;The program was installed by $1 and can only be uninstalled with this User. Please Login as $1 and start uninstaller&quot;<br />
abort<br />
SectionEnd<br />
<br />
this is the only way i know to know both account names and compare them<br />
<br />
hope it helps  <br />
<br />
Thanks for your reply. In the end I solved the problem by saving the $DESKTOP and $SMPROGRAMS in the registry<br />
under the uninstall key on install and read them back on uninstall so user B can do a clean remove. I have no intention to forbid user B to remove the application if he wants it - but I want an clean uninstall. <br />
<br />
Thanks,<br />
Radu Ban</div></div><hr />


<div class="post"><div class="posttop"><div class="username">flizebogen</div><div class="date">12th March 2003, 19:01</div></div><div class="posttext">i don't understand <br />
<br />
the uninstall section residents in HKLM but the normal user has no write permission to this key AFAIK. And in addition user A can not access the documents and settings folder of user b. I know there a exceptions but assumed that both users are USERS than a clean uninstall should fail</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th March 2003, 21:28</div></div><div class="posttext">You can also write the uninstall key in HKCU instead of HKLM. That way user B will not see it in his Add/Remove control panel.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>