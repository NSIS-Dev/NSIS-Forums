<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Timing issue using ExecWait in Uninstall section, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Timing issue using ExecWait in Uninstall section NSIS Discussion" />
	
	<title> Timing issue using ExecWait in Uninstall section [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Timing issue using ExecWait in Uninstall section</div>
<hr />
<div class="pda"><a href="t-303325.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=303325">Timing issue using ExecWait in Uninstall section</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">zoomzoom</div><div class="date">21st February 2009, 00:26</div></div><div class="posttext">hi all,<br />
<br />
i'm having a timing issue with ExecWait in the uninstall section.<br />
<br />
the first ExecWait calls the Apache Tomcat uninstaller. The second calls MSI to uninstall java.<br />
<br />
PROBLEM 1): ExecWait doesn't wait. Both the tomcat uninstaller and java uninstaller launches at the same time. I want tomcat to uninstall and when complete, then have the java uninstaller called, then RMDir the java directory.<br />
<br />
PROBLEM 2): Since both uninstallers are called at the same time, if i click 'ok' for both uninstallers, they complete successfully and then the ExecWait for java is called again!? it's as if ExecWait completed and then looped back ran the java uninstaller again...<br />
<br />
Thanks again in advance for your help!<br />
<br />
<br />
----The following is in the 'Section Uninstall'----<br />
<br />
;---CALL TOMCAT UNINSTALLER<br />
  ExecWait  'C:\Apache\Tomcat50\Uninstall.exe'            <br />
<br />
;---CALL JAVA UNINSTALLER<br />
  ExecWait 'MsiExec.exe /X{26A24AE4-039D-4CA4-87B4-2F83216011FF}'<br />
  RMDir &quot;C:\Convio\Java&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zoomzoom</div><div class="date">21st February 2009, 00:55</div></div><div class="posttext">So this might not be the best solution: <br />
but for removing the directories after the two (apache and java) uninstallers are complete, i placed my 'RMDir' lines within the 'Function un.onUninstSuccess' and used a messagebox (which displays behind the two uninstaller windows) as a delay. So, the Apache uninstaller/ Java uninstallers are running, when they finish user hits 'done' and then sees the messagebox they hit 'ok' and then the 'Apache' and 'Java' dir. are removed. <br />
<br />
Although RMDir &quot;$INSTDIR&quot; doesn't work (it's empty)...<br />
<br />
And i can't seem to figure out why the apache and tomcat installers get called simultaneously and twice?<br />
<br />
<br />
----<br />
Function un.onUninstSuccess<br />
  MessageBox MB_OK &quot;$(^Name) was successfully removed from your computer.&quot;<br />
  RMDir &quot;C:\Apache&quot;<br />
  RMDir &quot;C:\Java&quot;<br />
  RMDir &quot;$INSTDIR&quot;<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">21st February 2009, 01:11</div></div><div class="posttext">PROBLEM 1): ExecWait doesn't wait.<br />
<br />
If ExecWait doesn't wait, then this probably means:<br />
The executable you run (e.g. the Tomcat uninstaller) runs another executable and exits.<br />
NSIS only waits for the first process to terminate, it does NOT wait for any child processes!<br />
<br />
Also this is a common behavior of uninstallers:<br />
When you run &quot;uninstall.exe&quot; it will copy itself to %TEMP% and execute that copy.<br />
The copy will perform the actual uninstall, so the original &quot;uninstall.exe&quot; can be deleted.<br />
NSIS uninstallers work that way too!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zoomzoom</div><div class="date">21st February 2009, 01:17</div></div><div class="posttext">right. why the &quot;double call&quot;? so both ExecWait's get called (the tomcat uninstall is built with NSIS!), after they complete and i hit 'ok', the second ExecWait command is called again, prompting me if i want to uninstall java, then it fails if i hit 'ok' since java isn't present anymore...<br />
<br />
thanks!<br />
<br />
<br />
ExecWait 'C:\Apache\Tomcat50\Uninstall.exe'<br />
ExecWait 'MsiExec.exe /X{26A24AE4-039D-4CA4-87B4-2F83216011FF}'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zoomzoom</div><div class="date">21st February 2009, 01:20</div></div><div class="posttext">what about this:<br />
<br />
since 'Function un.onUninstSuccess; gets called after 'Uninstall section', i could call the tomcat uninstaller in the 'Uninstall section' then call the java uninstall in the 'Function un.onUninstSuccess'.... do you foresee any problems or a better way to do the above?<br />
<br />
thanks so much for the quick replies!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">21st February 2009, 02:32</div></div><div class="posttext">Originally posted by zoomzoom <br />
right. why the &quot;double call&quot;? <br />
<br />
As explained before: When you run the Uninstaller executable, it may launch another executable and then terminate immediately. Then only the child process is still running. But the process created by NSIS has terminated. Hence ExecWait will return! Many uninstallers work like that: As &quot;Uninstall.exe&quot; is usually located in the install folder, the uninstaller cannot remove the install folder, as long as &quot;Uninstall.exe&quot; is still running. Or in other words: The uninstaller cannot delete itself. To solve the problem: The uninstaller will copy itself (or some helper application) to %TEMP% and then exit. Now the second process (located in %TEMP%) will perform the actual uninstall. This way the entire install folder can be removed, including the &quot;Uninstaller.exe&quot; file, as that file isn't running any longer...<br />
<br />
I assume that Tomcat's uninstaller works exactly like that ;)<br />
<br />
<br />
Originally posted by zoomzoom <br />
what about this:<br />
<br />
since 'Function un.onUninstSuccess; gets called after 'Uninstall section', i could call the tomcat uninstaller in the 'Uninstall section' then call the java uninstall in the 'Function un.onUninstSuccess'.... do you foresee any problems or a better way to do the above?<br />
<br />
thanks so much for the quick replies!  <br />
<br />
I don't see the sense in this. Sounds like an ugly workaround.<br />
<br />
Better analyze the Tomcat uninstaller and find a method to call it in a proper way...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zoomzoom</div><div class="date">22nd February 2009, 06:55</div></div><div class="posttext">is it possible to do the equivalent of 'ExecWait' on a function call.<br />
<br />
for example: ExecWait FunctionBlah<br />
<br />
thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd February 2009, 07:08</div></div><div class="posttext">Call already does this. You actually can't do the opposite. There's no &quot;Exec FunctionBlah&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zoomzoom</div><div class="date">23rd February 2009, 19:25</div></div><div class="posttext">so the Tomcat uninstaller called 'nsexec' a couple times, thus the reason why 'execwait tomcatUninstaller' didn't wait.<br />
<br />
i ended up adding a function to uninstall tomcat (instead of calling the tomcat uninstaller). this was easy because apache makes their nsis script available, so i could see how they wrote the uninstall script and adapt it as needed.<br />
<br />
however, if i didn't have access to the tomcat script, i'm not sure how one would get around 'execwait' not working in this type of parent/child process scenario...<br />
<br />
thanks all for your help!!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>