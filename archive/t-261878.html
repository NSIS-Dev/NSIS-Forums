<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Batch file not recognizing the environment variable, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Batch file not recognizing the environment variable NSIS Discussion" />
	
	<title> Batch file not recognizing the environment variable [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Batch file not recognizing the environment variable</div>
<hr />
<div class="pda"><a href="t-261878.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=261878">Batch file not recognizing the environment variable</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">sandeepsirsgi</div><div class="date">16th December 2006, 05:40</div></div><div class="posttext">Hi,<br />
<br />
I am able to set the environment variable by using following following NSIS script.<br />
<br />
Push JAVA_HOME<br />
Push &quot;d:\JDK1.5&quot;<br />
Call WriteEnvStr<br />
<br />
After that i am running a batchfile using NSIS which is refering the JAVA_HOME to execute the batch.<br />
But the .bat file is not recognizing the environment variable JAVA_HOME.<br />
If i run that .bat file through command prompt then it's working.<br />
<br />
Can any one help me on that.<br />
<br />
Regards<br />
sandy</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th December 2006, 10:25</div></div><div class="posttext">Setting environment variables this way doesn't affect running processes. Use SetEnvironmentVariable (http://nsis.sourceforge.net/Setting_Environment_Variables_to_Active_Installer_Process) for that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sandeepsirsgi</div><div class="date">18th December 2006, 06:00</div></div><div class="posttext">I am running a batch file which is refering to JAVA_HOME and <br />
taking APP_HOME as classpath. I am able to set environment variable by using following NSIS script.<br />
<br />
Push JAVA_HOME<br />
Push &quot;d:\JDK1.5&quot;<br />
Call WriteEnvStr<br />
Push APP_HOME <br />
Push &quot;d:\application&quot;<br />
Call WriteEnvStr<br />
<br />
ReadEnvStr $R0 &quot;PATH&quot;<br />
StrCpy $R0 &quot;$R0;$TEMP2;$TEMP1&quot;<br />
SetEnv::SetEnvVar &quot;PATH&quot; &quot;$R0&quot;<br />
Exec  batchfile.bat<br />
<br />
Here $TEMP1 and $TEMP2 contains path to java_home <br />
and batch file respectively. When batch file is executed<br />
it's not able to recognize <br />
<br />
Still not able to execute batch file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">18th December 2006, 12:10</div></div><div class="posttext">Case 1.<br />
If you want to set an environment variable only for the installer process and its sub-processes use:<br />
!define JAVA_HOME &quot;d:\JDK1.5&quot;<br />
!define APP_HOME &quot;d:\application&quot;<br />
<br />
Section &quot;Add Env Var&quot;<br />
ReadEnvStr $R0 &quot;PATH&quot;<br />
messagebox mb_ok '$R0'<br />
StrCpy $R0 &quot;$R0;${JAVA_HOME};${APP_HOME}&quot;<br />
System::Call 'Kernel32::SetEnvironmentVariableA(t, t) i(&quot;PATH&quot;, R0).r2'<br />
ReadEnvStr $R0 &quot;PATH&quot;<br />
messagebox mb_ok '$R0'<br />
exec 'batchfile.bat'<br />
SectionEnd<br />
<br />
Case 2.<br />
If you want to set an environment variable that will stick for every other process and after reboots too...<br />
!define JAVA_HOME &quot;d:\JDK1.5&quot;<br />
!define APP_HOME &quot;d:\application&quot;<br />
<br />
!include WriteEnvStr.nsh<br />
<br />
Section &quot;Add Env Var&quot;<br />
  !ifdef ALL_USERS<br />
    !define ReadEnvStr_RegKey \<br />
       'HKLM &quot;SYSTEM\CurrentControlSet\Control\Session Manager\Environment&quot;'<br />
  !else<br />
    !define ReadEnvStr_RegKey 'HKCU &quot;Environment&quot;'<br />
  !endif<br />
<br />
  Push JAVA_HOME<br />
  Push '${JAVA_HOME}'<br />
  Call WriteEnvStr<br />
  Push APP_HOME<br />
  Push '${APP_HOME}'<br />
  Call WriteEnvStr<br />
<br />
ReadEnvStr $R0 &quot;PATH&quot;<br />
messagebox mb_ok '$R0'<br />
;ensure that is written valid for NT only<br />
ReadRegStr $0 ${ReadEnvStr_RegKey} 'JAVA_HOME'<br />
ReadRegStr $1 ${ReadEnvStr_RegKey} 'APP_HOME'<br />
StrCpy $R0 &quot;$R0;$0;$1&quot;<br />
;or just this<br />
;StrCpy $R0 &quot;$R0;${JAVA_HOME};${APP_HOME}&quot;<br />
System::Call 'Kernel32::SetEnvironmentVariableA(t, t) i(&quot;PATH&quot;, R0).r2'<br />
ReadEnvStr $R0 &quot;PATH&quot;<br />
messagebox mb_ok '$R0'<br />
writeuninstaller '$EXEDIR\uninst.exe'<br />
exec 'batchfile.bat'<br />
SectionEnd<br />
# ...<br />
Section uninstall<br />
  # remove the variable<br />
  Push JAVA_HOME<br />
  Call un.DeleteEnvStr<br />
  Push APP_HOME<br />
  Call un.DeleteEnvStr<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sandeepsirsgi</div><div class="date">8th January 2007, 04:38</div></div><div class="posttext">Sorry for late reply. <br />
It worked for me.<br />
<br />
<br />
Regards<br />
Sandeep</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>