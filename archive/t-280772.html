<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problems register COM DLL under Vista Buisness, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problems register COM DLL under Vista Buisness NSIS Discussion" />
	
	<title> Problems register COM DLL under Vista Buisness [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problems register COM DLL under Vista Buisness</div>
<hr />
<div class="pda"><a href="t-280772.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=280772">Problems register COM DLL under Vista Buisness</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">WKaa</div><div class="date">5th November 2007, 08:36</div></div><div class="posttext">I have to register a COM Dll during the installation.<br />
<br />
It is working under Windows 2000 and XP, but not under Vista.<br />
<br />
First I used:<br />
<br />
RegDLL &quot;$INSTDIR\MyDLL.dll&quot;<br />
<br />
<br />
Then I used:<br />
<br />
!insertmacro InstallLib REGDLLTLB NOTSHARED NOREBOOT_NOTPROTECTED &quot;MyDLL.dll&quot; &quot;$INSTDIR\MyDLL.dll&quot; &quot;$SYSDIR&quot;<br />
<br />
<br />
If I run the installation under vista a second time the dll will be registered.<br />
<br />
I think I feel confused and found no explanation. Does anybody has an idea?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th November 2007, 20:22</div></div><div class="posttext">Does it work if you manually register it using regsvr32?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">WKaa</div><div class="date">6th November 2007, 06:49</div></div><div class="posttext">No, even using regsvr32 is not working</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th November 2007, 17:52</div></div><div class="posttext">Then the problem is with the DLL itself.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">WKaa</div><div class="date">7th November 2007, 09:36</div></div><div class="posttext">Hello,<br />
<br />
thanks for your answer. The problem is not with the DLL itself. I checked this with several COMM DLLÂ´s, always the same.<br />
<br />
If you search in Google for &quot;regsvr32&quot; and &quot;Vista&quot; you will find a lot of people having problems to install a COM DLL under vista. <br />
<br />
The program I install is for users having low level skills using a PC. They are not able to switch off the &quot;UAC&quot;. IÂ´m still hunting for a solution.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th November 2007, 19:35</div></div><div class="posttext">If it's a general problem with registration of COM DLL files on Vista, I doubt this is the best place to look for an answer. You may get better responses from some COM development community. I don't have any idea what might go wrong with every COM DLL that'd cause it to work only on the second registration.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">WKaa</div><div class="date">8th November 2007, 06:30</div></div><div class="posttext">As I can read out from your answers you have no idea. Even it is a problem of vista the installer should help to solve this problem. I can see in the forum IÂ´m not the only one with this problem.<br />
<br />
An installer that is working only on several Operating systems is not helpful. Have you tested registering a COM DLL when the UAC is turned on?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th November 2007, 17:09</div></div><div class="posttext">No, I have no idea. NSIS works fine on every OS from 95 all the way to Vista. DLL registration works fine as well on all of those, even with UAC. You're describing a problem that affects registration of your COM DLL files on Vista with UAC with any installer and even with regsvr32.exe which comes with the OS. If you provide more details, I might be able to help, but with the current level of details, I can only offer you seek help from COM development community as the question is about COM DLL files and Vista in general.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">yilmaz</div><div class="date">28th April 2008, 04:28</div></div><div class="posttext">Hi guys<br />
First of all, the real problem is privilege issue.<br />
Looks like, NSIS, only permits 'admin's to use RegDLL. Please correct me if i am wrong. When we are on XP, this does not cause much problem, because, there is no user elevation thing in XP. However, when you are on Vista, in the installer, you need to specify the &quot;RequestExecutionLevel&quot; as &quot;admin&quot;.<br />
<br />
IF your installer is intended to be used by admins, then you don't have much problem. But if you want it to be used by non-admin users as well, then you are in trouble. (like me)<br />
<br />
I used to use InstallShield till now. Recently, i wanted to migrate to NSIS. Except this issue, i already migrated everything successfully. But this limitation makes me consider again. Because, we can  not assume, administrators are staying around non-admin users, and help them enter admin passwords when the installer asks them the password to elevate to admin.!!!  Hopefully, i am wrong, and there is already a solution for this in NSIS.<br />
Looking forward to your comments <br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th April 2008, 23:17</div></div><div class="posttext">You're wrong. NSIS doesn't care if you're an administrator or not when you use RegDLL.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">yilmaz</div><div class="date">29th April 2008, 03:04</div></div><div class="posttext">Then, why RegDLL is failing for non admin users, and is working for admins ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">yilmaz</div><div class="date">29th April 2008, 03:23</div></div><div class="posttext">well, i can guess your reply. You may say that this is not NSIS issue, but it is OS privilege issue. <br />
<br />
Let me clarify my real problem here, if you can give me an idea about how can it be solved in NSIS, i would highly appricate it.<br />
<br />
We have our own custom voice recognition DLL, and we want it to be installed as a plugin into users' machines regardless of user's role. In other words, we want a totally current user installation, even if the user is an administrator. So that, multiple users can work on the same machine without interfering each other. Since the installation involves registering the DLL, this makes this task troublesome. I was hoping that i can register the dll into HKEY_CURRENT_USER, rather than HKEY_LOCAL_MACHINE.<br />
<br />
However, REgdLL is always tries registering in HKLM eevn if the user is non admin. In that case, OS rejects the registration and installation fails.<br />
<br />
We need a solution for this , it can be any kind of hack or trick or a workaround solution, but we just want it to be installable by all users.<br />
<br />
Thanks for taking time and for your precious ideas. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">29th April 2008, 05:34</div></div><div class="posttext">Well, I assume you created this DLL, so just change DllRegisterServer to use HKCU\Software\Classes instead of HKCR, or if you want, you can create a DllRegisterServerNonAdmin export and use that (regdll allows you to specify the export used)<br />
<br />
If you don't control the dll, it's more tricky, but still possible (I did this for my custom iTunes install) you must map HKCR to HKCU\Software\Classes by calling RegCreateKeyEx + RegOverridePredefKey (with the system plugin) before registering the dll <br />
<br />
It is possible to install the typelib in the same way, can't remember exactly the steps required, but IIRC, you call some COM interface with the system plugin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">yilmaz</div><div class="date">29th April 2008, 05:53</div></div><div class="posttext">Thanks Anders<br />
Yes, we outsourced the DLL, but we have its source code<br />
This sounds a good solution. I will try that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ema</div><div class="date">27th August 2008, 12:44</div></div><div class="posttext">Hi,<br />
I have the same issue.<br />
<br />
Would it be possible to provide the snippet using System plugin?<br />
<br />
Thanks a lot</div></div><hr />


<div class="post"><div class="posttop"><div class="username">omeara55</div><div class="date">13th November 2008, 02:18</div></div><div class="posttext">Perhaps I just stumbled upon the same thing?<br />
<br />
http://forums.winamp.com/showthread.php?postid=2439880#post2439880</div></div><hr />


<div class="post"><div class="posttop"><div class="username">yilmaz</div><div class="date">13th November 2008, 03:02</div></div><div class="posttext">Actually, whatever i did , did not work for standard users. <br />
Finally, we came to understand that, on windows OS, especially on Vista, (and especially if UAC is ON), then it is almost impossible to do anything. Even if you can solve the the installer issue somehow, sure, you will bump into other problems. <br />
So, finally, we decided to assume that our users have admin account. Currently we have hundreds of thousands of users, and looks like, our assumption is OK, no complaints about it.<br />
If any one has a better idea, please let me know.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CLST58</div><div class="date">29th March 2011, 11:44</div></div><div class="posttext">Hi all,<br />
sorry that i dig out this Thread again, but i have a similar problem like WKaa.<br />
I'm trying to register two DirectShow filters in the end of my installation using this Code:<br />
<br />
ExecWait 'regsvr32.exe &quot;PGRDirectShowSource.ax&quot;'<br />
ExecWait 'regsvr32.exe &quot;PGRDirectShowDecoder.ax&quot;'<br />
<br />
but every times it fails with error: <br />
LoadLibrary(&quot;PGRDirectShowSource.ax&quot;) failed - The specified module could not be found<br />
If i run the installation a second time it works.<br />
The same happens using RegDLL and InstallLib.<br />
I have tried to solve this by using a batch file and call regsvr32 there ==&gt; same error.<br />
If i put a &quot;Pause&quot; Command at the beginning of the batch file and register both filters manually via Command Line it works without errors. Executing the batch file after the installation has finished works too.<br />
<br />
I'm using Windows XP Professional SP2 running in VirtualBox.<br />
<br />
Thanks for any help <br />
CLST58.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">29th March 2011, 13:39</div></div><div class="posttext">Maybe try full paths?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CLST58</div><div class="date">29th March 2011, 13:59</div></div><div class="posttext">The Problem is that the two filters (and all other dll's wich are needed to register the filters) are extracted/installed from another msi setup wich is called in my setup (not really nice i know...), for this reason i dont know where the dll exactly are. But the msi setup seems to make a setting wich tells regsvr32 where to find the filters and all other dll's. At least I can call &quot;regsvr32.exe PGRDirectShowSource.ax&quot; via command line after the msi setup and it searches automatically in the correct directory (i observed this using FileMon). However if NSIS calls regsvr32 at the same time.... or rather after i tried it manually... regsvr32 does not search in this directory. <br />
Any idea how i can tell regsvr32 where to search ?... maybe via environment variables ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th March 2011, 15:19</div></div><div class="posttext">You tell it by setting the working directory with SetOutPath. Also make sure you are running the correct regsvr32 (there are 64-bit and 32-bit versions but don't ask me if they are interchangeable for registering 32/64-bit assemblies; someone else may know).<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>