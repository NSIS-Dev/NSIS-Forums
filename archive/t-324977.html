<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Checking if a file exists, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Checking if a file exists NSIS Discussion" />
	
	<title> Checking if a file exists [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Checking if a file exists</div>
<hr />
<div class="pda"><a href="t-324977.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=324977">Checking if a file exists</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">17th December 2010, 11:04</div></div><div class="posttext">The installer I am creating patches some already installed software, as such I want it to check that a certain file exists before allowing it to continue, I have the following.....<br />
<br />
Page custom instcheckleave<br />
Function instcheckleave<br />
IfFileExists $INSTDIR\info.ini PathGood<br />
          Abort ; if $INSTDIR is not a valid program, don't let us run the patch<br />
    PathGood:<br />
FunctionEnd<br />
<br />
This code doesn't seem to let the user go any further, regardless of the file existing or not.  Where am I going wrong?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">17th December 2010, 11:17</div></div><div class="posttext">Calling abort in the pre callback will skip the page, so I don't see how the user can be stuck there no matter what</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">17th December 2010, 11:35</div></div><div class="posttext">Do you think it may be where I am calling it?  Here is the page before......<br />
<br />
Page custom page4 page4leave<br />
Function page4 <br />
!insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;page4&quot;<br />
!insertmacro MUI_INSTALLOPTIONS_READ $INSTDIR &quot;page4&quot; &quot;Field 1&quot; &quot;State&quot;<br />
FunctionEnd<br />
<br />
Page custom page4leave<br />
Function page4leave<br />
IfFileExists $INSTDIR\info.ini PathGood<br />
        MessageBox MB_ICONEXCLAMATION|MB_OK &quot;File does not exist&quot;<br />
          Abort ; <br />
    PathGood:<br />
FunctionEnd<br />
<br />
It just gives me the 'File Does not exist' message, even though it does</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">17th December 2010, 12:25</div></div><div class="posttext">Did you check what $INSTDIR actualy is?<br />
Maybe it's pointing to a wrong location.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">17th December 2010, 13:41</div></div><div class="posttext">The $INSTDIR should be correct, it works fine for the rest of the installation.  Everything looks like it should work correctly... strange</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">17th December 2010, 13:48</div></div><div class="posttext">To be sure, just call MessageBox MB_OK &quot;$INSTDIR\info.ini&quot;, and doublecheck if the file really exists.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">17th December 2010, 14:26</div></div><div class="posttext">First you do <br />
Page custom page4 page4leave<br />
<br />
And then you do<br />
Page custom page4leave<br />
<br />
This is not correct. Page4leave is a leave function, not a page function. You call it first as a leave function, but then tell NSIS to create a second page, with the same function...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">17th December 2010, 14:47</div></div><div class="posttext">Hmmm, it just displays a message saying $INSTDIR\info.ini<br />
<br />
Should it display the contents of info.ini?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">17th December 2010, 15:03</div></div><div class="posttext">MSG, I just spotted that :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">17th December 2010, 15:13</div></div><div class="posttext">Hmmm, it just displays a message saying $INSTDIR\info.ini<br />
<br />
Should it display the contents of info.ini?<br />
No, it should display the contents of the $INSTDIR variable. So it should look like &quot;C:\Program Files\YourApp\info.ini&quot;. $INSTDIR is a built-in variable, you cannot disable it (as far as I know). Are you sure you typed it correctly?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">17th December 2010, 15:20</div></div><div class="posttext">This is what I have after the changes and corrections I made, could the problem be that I am bypassing the normal installation directory and setting $INSTDIR from a custom page?<br />
<br />
Page custom page4 page4leave<br />
Function page4 <br />
!insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;page4&quot;<br />
!insertmacro MUI_INSTALLOPTIONS_READ $INSTDIR &quot;page4&quot; &quot;Field 1&quot; &quot;State&quot;<br />
FunctionEnd<br />
<br />
Function page4leave<br />
IfFileExists &quot;$INSTDIR\info.ini&quot; PathGood<br />
MessageBox MB_OK &quot;$INSTDIR\info.ini&quot;<br />
          Abort ; if $INSTDIR is not a valid program, don't let us run the patch<br />
    PathGood:<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">4th January 2011, 14:52</div></div><div class="posttext">Im still getting nowhere with this issue, do you think it could be that fact that I am setting INSTDIR from a custom page?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">4th January 2011, 14:58</div></div><div class="posttext">I have just put the following into the function<br />
<br />
 MessageBox MB_OK &quot;$INSTDIR&quot;<br />
<br />
And it displays nothing, but if I put the same into the function below then it displays the installation directory.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">4th January 2011, 15:02</div></div><div class="posttext">Managed to resolve it, I changed where it reads $INSTDIR to the leave function and things have started working....<br />
<br />
Page custom page4 page4leave<br />
Function page4 <br />
!insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;page4&quot;<br />
FunctionEnd<br />
<br />
Page custom page4leave<br />
!insertmacro MUI_INSTALLOPTIONS_READ $INSTDIR &quot;page4&quot; &quot;Field 1&quot; &quot;State&quot;<br />
Function page4leave<br />
IfFileExists $INSTDIR\info.ini PathGood<br />
        MessageBox MB_ICONEXCLAMATION|MB_OK &quot;File does not exist&quot;<br />
          Abort<br />
    PathGood:<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>