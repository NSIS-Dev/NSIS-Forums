<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Need some advice on slashconverting, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Need some advice on slashconverting NSIS Discussion" />
	
	<title> Need some advice on slashconverting [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Need some advice on slashconverting</div>
<hr />
<div class="pda"><a href="t-153189.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=153189">Need some advice on slashconverting</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">19th October 2003, 15:53</div></div><div class="posttext">Dear Guys -<br />
<br />
Can somebody help me on slashconverting? I have to open a file parse it through the slash-converting function (convert backslashes to normal slashes) and close it under the same name!<br />
<br />
I found this slash-converter here @ the archive (http://nsis.sourceforge.net/archive/nsisweb.php?page=155&amp;instances=0,11,122)  but didn't understood how to get it work...<br />
<br />
Thx in advance<br />
Mo</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th October 2003, 16:23</div></div><div class="posttext">Open the file, read a line, pass it to the function, write the output to another file, repeat until you've read the entire file, close both files and replace the old one with the new one.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">19th October 2003, 16:56</div></div><div class="posttext">So I can use this function? What I don't understood are the comments above:<br />
; Push $filenamestring (e.g. 'c:\this\and\that\filename.htm')<br />
; Push &quot;\&quot;<br />
; Call StrSlash<br />
; Pop $0<br />
; $0 == 'c:/this/and/that/filename.htm'<br />
<br />
Mo</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">19th October 2003, 17:08</div></div><div class="posttext">It's an example of usage.<br />
<br />
Push &quot;line that contains a \&quot;<br />
Push &quot;\&quot; ;Char to convert<br />
Call StrSplash<br />
Pop $R0 ;Or another variable<br />
;Now $R0 will contain the same string with \ converted to /<br />
<br />
You will have to use this function for the lines you read from the file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th October 2003, 17:08</div></div><div class="posttext">That file name is just an example of a string conatining backslashes. You should push the line you read from the file instead of that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">19th October 2003, 17:12</div></div><div class="posttext">Uuuhh,<br />
<br />
could please give me an example? I tried some things, but with no luck!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th October 2003, 17:13</div></div><div class="posttext">What's wrong with Joost's example?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">19th October 2003, 17:18</div></div><div class="posttext">I don't know the lines which have to be converted. This can vary from and I don't know the exact content to be converted, because these lines (with an $INSTDIR) are set with the installation process, so this depends on the path set by the user...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th October 2003, 17:26</div></div><div class="posttext">You're not supposed to push constant strings to that function, you're supposed to push it strings that you read from the file.<br />
<br />
If it's $INSTDIR that you're trying to convert, why not preconvert it? Just push $INSTDIR to that function and have your file replacement functions replace your file constants with the converted $INSTDIR instead of the original one.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">19th October 2003, 17:38</div></div><div class="posttext">Because I don't know how!<br />
<br />
I have one function for editing the file. This replaces some place holder with an installation path:<br />
Function ModibWebAdmin<br />
ClearErrors<br />
FileOpen $0 &quot;$INSTDIR\test.tmp.php&quot; &quot;r&quot;<br />
GetTempFileName $R0<br />
FileOpen $1 $R0 &quot;w&quot;<br />
loop:<br />
   FileRead $0 $2<br />
   IfErrors done<br />
   StrCmp $2 &quot;@@BINPATH@@$\r$\n&quot; 0 +3<br />
      FileWrite $1 &quot;define($\'BINPATH$\', $\'$INSTDIR\DB\FireBird\bin\$\');$\r$\n&quot;<br />
      Goto loop<br />
   StrCmp $2 &quot;@@TMPPATH@@$\r$\n&quot; 0 +3<br />
      FileWrite $1 &quot;define($\'TMPPATH$\', $\'$INSTDIR\DB\FireBird\tmp\$\');$\r$\n&quot;<br />
	  Goto loop<br />
   StrCmp $2 &quot;@@DEFAULTPATH@@$\r$\n&quot; 0 +3<br />
      FileWrite $1 &quot;define($\'DEFAULT_PATH$\',    $\'$INSTDIR\DB\FireBird\$\');$\r$\n&quot;<br />
	  Goto loop<br />
   FileWrite $1 $2<br />
      Goto loop<br />
done:<br />
   FileClose $0<br />
   FileClose $1<br />
   Delete &quot;$INSTDIR\test.tmp.php&quot;<br />
   Rename $R0 &quot;$INSTDIR\test.tmp1.php&quot;<br />
FunctionEnd<br />
<br />
But these replaced lines show the path with backslashes. Don't know why but these file (php-script) doesn't work with backslashes. So these lines should be converted. I would have prepared the file with '/' instead of '\', but I have no influence on the front part set through $INSTDIR ...<br />
<br />
So what was your idea on Push $INSTDIR? How can this be achieved?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th October 2003, 17:53</div></div><div class="posttext">Use this:<br />
<br />
Push $INSTDIR<br />
Push &quot;\&quot;<br />
Call StrSlash<br />
Pop $0<br />
<br />
$0 will contain the string you should use instead of $INSTDIR in the file replacement function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">19th October 2003, 17:56</div></div><div class="posttext">Okay I think I almost got it kichik :-D<br />
<br />
One last question:<br />
Push $INSTDIR<br />
Push &quot;\&quot;<br />
Call StrSlash<br />
Pop $0 <br />
<br />
Can this be used in a section (at any place), or do I have to make a seperate function out of it which has to be called with  Call FunctionName<br />
<br />
Mo!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th October 2003, 17:59</div></div><div class="posttext">It can be used anywhere you want as long as you know $INSTDIR will be set to the right value (after directory selection page) and that $0 will not change until the file replacement function is called.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">19th October 2003, 18:45</div></div><div class="posttext">I can't get it work...<br />
Could somebody review and correct it, pleeaaase<br />
<br />
Mo</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th October 2003, 19:17</div></div><div class="posttext">You are still using $INSTDIR in the Replace function. Use $R0 instead.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">19th October 2003, 19:22</div></div><div class="posttext">YEEEEAAAAAAHHHHHH !!!! :up: <br />
<br />
Got it!<br />
Thx Kichik (you rock!) great help!<br />
Mo<br />
:D<br />
<br />
P.S.: can the used variables be cleared at the end or do they have no effect on following functions and sections?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th October 2003, 19:25</div></div><div class="posttext">As long as you don't call that function again you can clear it. If you're worried you might need it sometime you can use Var to create a special variable just for it (assuming you're using the latest CVS version).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">19th October 2003, 19:49</div></div><div class="posttext">So best/safest would be <br />
 Var NAME_OF_VAR<br />
(in the beginning of the script)<br />
and than call it at the line<br />
Pop $NAME_OF_VAR<br />
Is that right?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th October 2003, 19:56</div></div><div class="posttext">Yes, and in the replacement function too. Replace $R0 with $NAME_OF_VAR.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">19th October 2003, 20:06</div></div><div class="posttext">So thx kichik: Your my man! :D</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>