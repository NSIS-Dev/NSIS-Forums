<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Uninstall Only Installed Files with excluded files, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Uninstall Only Installed Files with excluded files NSIS Discussion" />
	
	<title> Uninstall Only Installed Files with excluded files [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Uninstall Only Installed Files with excluded files</div>
<hr />
<div class="pda"><a href="t-253949.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=253949">Uninstall Only Installed Files with excluded files</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Gambler</div><div class="date">23rd August 2006, 20:55</div></div><div class="posttext">Hey guys,<br />
<br />
I'm trying to uninstall only installed files, I read the examples page already, and that code seems to work fine with one exception, you can't exclude files...  The wildcards work fine as they are recorded and included in the install.  Then when the uninstall happens the wild card is read back in again and the files are deleted.  However, you can't excude files.  It is very important that I exclude certain files from being installed.<br />
<br />
Can anybody think of an easy way to edit this code so that it will write out all the files I want excluding files I don't?<br />
<br />
<br />
!macro File FilePath FileName<br />
 IfFileExists &quot;$OUTDIR\${FileName}&quot; +2<br />
  FileWrite $UninstLog &quot;$OUTDIR\${FileName}$\r$\n&quot;<br />
 File &quot;${FilePath}${FileName}&quot;<br />
!macroend<br />
!define File &quot;!insertmacro File&quot;<br />
<br />
<br />
I need to use this macro with something like the following:<br />
${File} /x CVS /x foo.bar &quot;C:\myfiles\&quot; &quot;*.exe&quot;<br />
<br />
TIA -Greg</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th August 2006, 13:10</div></div><div class="posttext">You can generate the code to add the files and delete the files outside of the installer using a scripting language or even a NSIS installer. Have it search for the files using wildcards, write down a File instruction for the installation and a Delete instruction for the uninstallation and then include the results in your script using !include.<br />
<br />
This way, you could implement whichever logic you want, including file exclusion by name.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Gambler</div><div class="date">25th August 2006, 13:37</div></div><div class="posttext">Hey, thanks for the reply.<br />
<br />
That is actually the way I decided to implement it last night, and it works great, so...good suggestion!<br />
<br />
Thanks<br />
-Greg</div></div><hr />


<div class="post"><div class="posttop"><div class="username">krisbg</div><div class="date">12th March 2007, 17:32</div></div><div class="posttext">Hi! I am trying to do uninstall only of installed files too. Here is the code in my main install section. Note that I have copied the code from the File macro directly here.<br />
<br />
	FindFirst $0 $1 &quot;..\image\*.*&quot;<br />
	loop:<br />
		StrCmp $1 &quot;&quot; done<br />
		IfFileExists &quot;$OUTDIR\$1&quot; +2<br />
			FileWrite $UninstLog &quot;$OUTDIR\$1$\r$\n&quot;<br />
		File &quot;..\image\$1&quot;<br />
		FindNext $0 $1<br />
		Goto loop<br />
	done:<br />
<br />
So I get a compile-time error on the File instruction and it comes from the usage of $1 variable. If I put the name of a real file instead of it, it works. So I wonder is the problem that the File instruction is executed on compile time while all the other code like FindFirst and FindNext is executed on run time and that's why File instruction doesn't accept variables? If this is the problem how could I list all the files from a wildcard search in the uninstall log?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">12th March 2007, 19:04</div></div><div class="posttext">You may want to take a look at Advanced Uninstall Log (http://nsis.sourceforge.net/Advanced_Uninstall_Log_NSIS_Header)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">krisbg</div><div class="date">16th March 2007, 12:14</div></div><div class="posttext">Thanks a lot! This is what I needed. I wonder only what is the &quot;Install.exe&quot; for and can I live without it?:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">16th March 2007, 12:39</div></div><div class="posttext">Of course you can live without it!<br />
It is there only to automate the procedure of adding the header into NSIS\include directory, the examples into NSIS\examples directory and the readme into NSIS\Docs directory ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">krisbg</div><div class="date">16th March 2007, 15:22</div></div><div class="posttext">Thanks again!:)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>