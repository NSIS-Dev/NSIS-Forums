<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Calling a dll to encrypt a password, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Calling a dll to encrypt a password NSIS Discussion" />
	
	<title> Calling a dll to encrypt a password [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Calling a dll to encrypt a password</div>
<hr />
<div class="pda"><a href="t-181324.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=181324">Calling a dll to encrypt a password</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">rincewind</div><div class="date">27th May 2004, 12:25</div></div><div class="posttext">I'm trying to get my script to take input from a password box and then pass it to a dll which contains a function that encrypts it. The prototype for the (Delphi) function is this: function IDPEncryptPassword(P: PChar; var MaxLen: integer): LongBool;<br />
<br />
However, when the function returns it has not changed the original string, and the debug info prints this. The int I pass into the function has also not changed size (stays 1024). Could anyone please help me out with what I'm doing wrong? I'm an NSIS newbie and don't really have the skills to spot what I'm doing wrong (yet :). The relevant section is this:<br />
;the relevant dll's have been loaded just before this<br />
; read the entered value<br />
ReadIniStr $4 &quot;$PLUGINSDIR\userpass.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
WriteINIStr &quot;C:\Infront\IDP\IDP.ini&quot; &quot;Funccall&quot; &quot;Password before&quot; $4<br />
SetPluginUnload  alwaysoff<br />
StrCpy $5 ${NSIS_MAX_STRLEN}<br />
; just print out debug info<br />
WriteINIStr &quot;C:\Infront\IDP\IDP.ini&quot; &quot;Funccall&quot; &quot;intsize before&quot; $5<br />
<br />
/* This is the problem area!!! */<br />
System::Call 'IDPGenPwd::IDPEncryptPassword(t .r4, *i r5r5)i .r6'<br />
; This is where it's supposed to write the encrypted password<br />
WriteINIStr &quot;C:\Infront\IDP\IDP.ini&quot; &quot;IAS&quot; &quot;Password&quot; $4<br />
; Debug info<br />
WriteINIStr &quot;C:\Infront\IDP\IDP.ini&quot; &quot;Funccall&quot; &quot;Error code&quot; $6<br />
WriteINIStr &quot;C:\Infront\IDP\IDP.ini&quot; &quot;Funccall&quot; &quot;intsize&quot; $5<br />
SetPluginUnload manual<br />
System::Free 0<br />
<br />
Attached is the complete script. <br />
Any help is highly appreciated!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">28th May 2004, 01:19</div></div><div class="posttext">The input will always be returned if an output part doesn't return or if you don't specify to output a value. In this case, you used $5 as input.<br />
<br />
If you're expecting an output, you should put a &quot;.&quot; before the variable r5 (on System plugin call).<br />
<br />
Or if you're expecting an input and an output, you should put two variables (on System plugin call) with a &quot;.&quot; before the second one. I'll show what is my point with the correct code (I think, as you explained):<br />
<br />
System::Call 'IDPGenPwd::IDPEncryptPassword(t .r4, *i r5 .r5)i .r6'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rincewind</div><div class="date">28th May 2004, 08:17</div></div><div class="posttext">Originally posted by deguix <br />
The input will always be returned if an output part doesn't return or if you don't specify to output a value. In this case, you used $5 as input.<br />
<br />
If you're expecting an output, you should put a &quot;.&quot; before the variable r5 (on System plugin call).<br />
<br />
Or if you're expecting an input and an output, you should put two variables (on System plugin call) with a &quot;.&quot; before the second one. I'll show what is my point with the correct code (I think, as you explained):<br />
<br />
System::Call 'IDPGenPwd::IDPEncryptPassword(t .r4, *i r5 .r5)i .r6'  <br />
<br />
No, it's still not working. When the function now returns the variable r4 which is supposed to contain the encrypted password is blank. What I'm trying to do (in case it was a bit confusing) is to pass in r4 (the string to be converted), and a buffer, r5. When the function returns r4 has been encrypted by the function and r5 contains the length of the new [encrypted] string. What r5 does or doesn't contain isn't really important, just that r4 is converted properly.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th May 2004, 09:48</div></div><div class="posttext">That's not exact deguix. Please refer to the new System documentation:<br />
<br />
http://nsis.sf.net/System.html</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>