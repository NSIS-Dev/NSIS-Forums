<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" simple installer with MUI2 - some questions, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  simple installer with MUI2 - some questions NSIS Discussion" />
	
	<title> simple installer with MUI2 - some questions [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  simple installer with MUI2 - some questions</div>
<hr />
<div class="pda"><a href="t-331148.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=331148">simple installer with MUI2 - some questions</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Zamorro</div><div class="date">1st June 2011, 21:54</div></div><div class="posttext">Hallo togehter, i'm new with NSIS<br />
How to show a different text for titel and message in uninstaller page then in installer page<br />
by using MUI or MUI2?<br />
my current script<br />
<br />
<br />
;Include Modern UI<br />
!include &quot;MUI2.nsh&quot;<br />
;--------------------------------<br />
;General<br />
 ;Name and file<br />
  Name &quot;Install Alice and change GTAIV version7 into version4&quot;<br />
  OutFile &quot;Install-Alice.exe&quot;<br />
 ;Default installation folder<br />
  InstallDir &quot;C:\Program Files\Rockstar Games\Grand Theft Auto IV&quot;<br />
  ;Get installation folder from registry if available<br />
  InstallDirRegKey HKCU &quot;Grand Theft Auto IV&quot; &quot;&quot;<br />
 ;Request application privileges for Windows Vista<br />
  RequestExecutionLevel user<br />
;--------------------------------<br />
;Interface Settings<br />
!define MUI_ABORTWARNING<br />
;--------------------------------<br />
;Pages<br />
  !insertmacro MUI_PAGE_LICENSE &quot;${NSISDIR}\Docs\Modern UI\License.txt&quot;<br />
  !insertmacro MUI_PAGE_COMPONENTS<br />
  !insertmacro MUI_PAGE_DIRECTORY<br />
  !insertmacro MUI_PAGE_INSTFILES<br />
  <br />
  !insertmacro MUI_UNPAGE_CONFIRM<br />
  !insertmacro MUI_UNPAGE_INSTFILES<br />
  ;--------------------------------<br />
;Languages<br />
 !insertmacro MUI_LANGUAGE &quot;English&quot;<br />
;--------------------------------<br />
;Installer Sections<br />
Section &quot;Dummy Section&quot; SecDummy<br />
SetOutPath &quot;$INSTDIR&quot;<br />
 File  testtesttest.txt<br />
  ;Create uninstaller<br />
  WriteUninstaller &quot;$INSTDIR\Uninstall-Alice.exe&quot;<br />
SectionEnd<br />
<br />
;--------------------------------<br />
;Descriptions<br />
;Language strings<br />
  LangString DESC_SecDummy ${LANG_ENGLISH} &quot;A test section.&quot;<br />
;Assign language strings to sections<br />
  !insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br />
    !insertmacro MUI_DESCRIPTION_TEXT ${SecDummy} $(DESC_SecDummy)<br />
  !insertmacro MUI_FUNCTION_DESCRIPTION_END<br />
<br />
;--------------------------------<br />
;Uninstaller Section<br />
<br />
Section &quot;Uninstall&quot;<br />
<br />
Delete &quot;$INSTDIR\testtesttest.txt&quot; <br />
<br />
  Delete &quot;$INSTDIR\Uninstall-Alice.exe&quot;<br />
<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">2nd June 2011, 06:16</div></div><div class="posttext">1) I don't think the GTA4 regkeys will be in HKCU, because it installs to program files which requires admin access. Admin installers (should) write to HKLM. If it IS stored in HKCU, then it will be the admin's HKCU, so either way you need to elevate your installer. Use requestexecutionlevel admin and use the UserInfo plugin in .onInit to verify admin access.<br />
<br />
2) What text do you want to change? The &quot;Install Alice and change GTAIV version7 into version4&quot; title? You can't do that (easily). You should instead use a better name, like &quot;Alice GTAIV downgrader&quot;, and then put the longer &quot;Install Alice and etc etc&quot; as the component description.<br />
<br />
3) In the future please use pastebin or an attachment to share large pieces of code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Zamorro</div><div class="date">3rd June 2011, 07:54</div></div><div class="posttext">Thanks for fast reply, i left the MUI and made it now with default nsis ui as slim as possible<br />
<br />
my current script: alice install script / test (http://pastebin.com/b4CeMjBC)<br />
<br />
I want to allow the user to backup by uninstalling his custom files which he added<br />
so i added a MessageBox MB_YESNO with following commands by true:<br />
  CreateDirectory $DESKTOP\Alice<br />
  CopyFiles $INSTDIR\Alice\*.* $DESKTOP\Alice<br />
<br />
basicly it works but the Alice folder is unvisible on my Desktop<br />
i can find it by using a file manager<br />
and if the $INSTDIR\Alice folder contains more than 10 files it works as it should<br />
is my system buggy or what's wrong?<br />
<br />
off topic: how can i edit my submitted post?<br />
-----------<br />
edit<br />
i found now the edit icon for this post but not for my previous post</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">3rd June 2011, 15:07</div></div><div class="posttext">Sounds like a caching problem. Tried F5 on your desktop?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Zamorro</div><div class="date">3rd June 2011, 16:45</div></div><div class="posttext">Sounds like a caching problem. Tried F5 on your desktop?<br />
<br />
oh, yes, F5 helped to show it<br />
what's now the problem? my system or the uninstaller?<br />
maybe i should backup the files in $DOCUMENTS</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">3rd June 2011, 18:52</div></div><div class="posttext">oh, yes, F5 helped to show it<br />
what's now the problem? my system or the uninstaller?<br />
maybe i should backup the files in $DOCUMENTS<br />
<br />
$docs would probably be a better choice, yeah. As for the caching issue... No idea, really. Try a second system and see if you can reproduce the problem.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Zamorro</div><div class="date">3rd June 2011, 20:31</div></div><div class="posttext">Try a second system and see if you can reproduce the problem.that's an idea but when it happens on my system then it can also happen on another users system<br />
<br />
$docs would probably be a better choice, yeah. As for the caching issue... No idea, really. <br />
$docs ? or $DOCS ? the compiler doesn't accept it and it isn't written in the user manual<br />
is there a newer version than 2.46?<br />
<br />
My next problem is to check by uninstalling if the Alice folder contains files<br />
using wildcard IfFileExists $INSTDIR\Alice\*.* ask<br />
the unistaller choose allways ask no matter if there are files or if the folder is empty<br />
Section &quot;uninstall&quot;<br />
IfFileExists $INSTDIR\Backup\GTAIV-V7.exe next<br />
  MessageBox MB_OK &quot;GTAIV-V7.exe was not found in Backup folder&quot;<br />
  Quit<br />
next:<br />
IfFileExists $INSTDIR\Alice\*.* ask<br />
  Goto restore<br />
ask:<br />
MessageBox MB_YESNO &quot;do you want to backup the Alice scripts?&quot; IDYES true IDNO false<br />
true:<br />
  DetailPrint &quot;Alice scripts are saved at My Documents\Alice&quot;<br />
  CreateDirectory &quot;$DOCUMENTS\Alice&quot;<br />
  CopyFiles $INSTDIR\Alice\*.* $DOCUMENTS\Alice<br />
  Goto restore<br />
false:<br />
  DetailPrint &quot;All Alice scripts have been deleted&quot;<br />
restore:<br />
  Rename $INSTDIR\Backup\GTAIV-V7.exe $INSTDIR\GTAIV.exe<br />
  Delete &quot;$INSTDIR\testtesttest.txt&quot;<br />
  Delete &quot;$INSTDIR\uninstall-Alice.exe&quot;<br />
  RMDir /r /REBOOTOK &quot;$INSTDIR\Alice&quot;<br />
  RMDir /r /REBOOTOK &quot;$INSTDIR\Backup&quot;<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">3rd June 2011, 20:37</div></div><div class="posttext">$docs ? or $DOCS ?<br />
I was referring to the $DOCUMENTS variable.<br />
<br />
IfFileExists $INSTDIR\Alice\*.* ask<br />
the unistaller choose allways ask no matter if there are files or if the folder is empty<br />
That's because an empty subdirectory always contains . (current dir) and .. (parent dir). If the directory exists, dir\*.* will also exist.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Zamorro</div><div class="date">3rd June 2011, 21:47</div></div><div class="posttext">That's because an empty subdirectory always contains . (current dir) and .. (parent dir). If the directory exists, dir\*.* will also exist.<br />
shit, is there any method to check if the folder is empty?<br />
is it possible to get the filesize of an folder?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">3rd June 2011, 23:24</div></div><div class="posttext">http://nsis.sourceforge.net/Check_if_dir_is_empty<br />
<br />
or<br />
<br />
http://nsis.sourceforge.net/Locate_plugin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Zamorro</div><div class="date">4th June 2011, 06:14</div></div><div class="posttext">http://nsis.sourceforge.net/Check_if_dir_is_empty<br />
Thank you, that's cool and works fine<br />
I first found another method and want to discuss it just because of interest<br />
It requires<br />
!include &quot;FileFunc.nsh&quot;<br />
	${GetSize} &quot;$INSTDIR\Alice&quot; &quot;/S=0M&quot; $0 $1 $2<br />
	IfErrors 0 +3<br />
	MessageBox MB_OK &quot;error&quot;<br />
        Goto skip<br />
	StrCmp $0 0 0 +3<br />
	MessageBox MB_OK &quot;Directory is NOT empty&quot;<br />
	Goto skip<br />
	MessageBox MB_OK &quot;Directory is empty&quot;<br />
	skip:<br />
the code works as it should, if filesize $0 = 0 shows the MessageBox &quot;Directory is empty&quot;<br />
<br />
then i thought i could check for the amount of available files with $1<br />
StrCmp $1 0 0 +3<br />
but that won't work correct<br />
it shows allways the MessageBox &quot;Directory is empty&quot;<br />
<br />
Am i totally wrong or didn't i understand the StrCmp?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">T.Slappy</div><div class="date">4th June 2011, 06:56</div></div><div class="posttext">String are really hard comparable :)<br />
Some time ago there were some problems, but now they should be fixed.<br />
Anyway, try to use &quot;&quot; for strings: StrCmp $1 &quot;0&quot; 0 +3</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Zamorro</div><div class="date">4th June 2011, 14:09</div></div><div class="posttext">String are really hard comparable :)<br />
Some time ago there were some problems, but now they should be fixed.<br />
Anyway, try to use &quot;&quot; for strings: StrCmp $1 &quot;0&quot; 0 +3<br />
<br />
No, it also won't work, but anyway, i'll use the isEmptyDir function (http://nsis.sourceforge.net/Check_if_dir_is_empty)<br />
<br />
As last i want to check if there are *.asi files in $INSTDIR and found the Locate_plugin (http://nsis.sourceforge.net/Locate_plugin)<br />
I studied the LocateTest.nsi and ripped the neccesary part for my current LocateAsifiles.nsi:<br />
Name &quot;Locate asi files&quot;<br />
OutFile LocateAsi.exe<br />
!include &quot;Locate.nsh&quot;<br />
Section<br />
	GetTempFileName $1<br />
	FileOpen $2 $1 w<br />
	${locate::Open} &quot;$PROGRAMFILES\Rockstar Games\Grand Theft Auto IV&quot; &quot;/F=1 /D=0 /M=*.asi /B=1&quot; $R0<br />
	StrCmp $R0 0 0 loop<br />
	Quit<br />
	loop:<br />
	${locate::Find} $R0 $R1 $R2 $R3 $R4 $R5 $R6<br />
	StrCmp $R1 '' close<br />
	StrCmp $R4 '' 0 +3<br />
	FileWrite $2 'DIR:&quot;$R1&quot; [Created: $R5] [$R6]$\r$\n'<br />
	goto +2<br />
	FileWrite $2 '$R1 $\r$\n'<br />
	goto loop<br />
	close:<br />
	${locate::Close} $R0<br />
	${locate::Unload}<br />
	FileClose $2<br />
	Exec '&quot;notepad.exe&quot; &quot;$1&quot;'<br />
SectionEnd<br />
<br />
my question now, what should do this line?<br />
FileWrite $2 'DIR:&quot;$R1&quot; [Created: $R5] [$R6]$\r$\n'<br />
it looks like it should list empty files with DIR: in the beginning of the line<br />
but i couldn't imitate such a case<br />
i added a folder with name mist.asi and an empty textfile and renamed it as test.asi<br />
the folder was never listed and the empty file was allways listed without Dir: in the beginning</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th June 2011, 10:02</div></div><div class="posttext">Your assumption is wrong! That example is simply writing to a temp file (GetTempFileName) and then opening it afterwards (Exec notepad.exe). If you want to find out what is going on, how about running it! Also never stick a loop in a Section. The progress bar will jump back and forth and this heavily degrades code performance. You should move the code to a function and call that.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Zamorro</div><div class="date">10th June 2011, 13:04</div></div><div class="posttext">Your assumption is wrong! That example is simply writing to a temp file (GetTempFileName) and then opening it afterwards (Exec notepad.exe). If you want to find out what is going on, how about running it! Also never stick a loop in a Section. The progress bar will jump back and forth and this heavily degrades code performance. You should move the code to a function and call that.<br />
<br />
Stu<br />
I removed the FileWrite lines and added Rename $R1 $DOCUMENTS\AliceUninstfiles\$R3<br />
<br />
Thank YOUUU all<br />
I finished my script: Installing Alice and GTAIV-downgrade to GTAIV v5 (http://pastebin.com/AdNzhk5w)<br />
Is it allowed to give here the link to download Alice-Installer.exe?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>