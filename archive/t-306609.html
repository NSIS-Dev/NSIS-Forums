<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Call::DLL ???, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Call::DLL ??? NSIS Discussion" />
	
	<title> Call::DLL ??? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Call::DLL ???</div>
<hr />
<div class="pda"><a href="t-306609.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=306609">Call::DLL ???</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Inazad</div><div class="date">21st May 2009, 18:28</div></div><div class="posttext">HI there, <br />
<br />
I really need help for this section :<br />
<br />
<br />
Section -BD   <br />
	Call CreateDatabaseAndBasicData<br />
	<br />
	System::Call 'Crypto::GeneratePWDSecutityString(v) .EncryptionKey'<br />
	System::Call 'Crypto::EncodePWDEx(t,t) t(.BdUser,.EncryptionKey)'<br />
	System::Call 'Crypto::EncodePWDEx(t,t) t(.BdPass,.EncryptionKey)'<br />
	<br />
	WriteINIStr &quot;$PathIniFile\${IniFile}.INI&quot; &quot;sql&quot; &quot;Nom_Database&quot; $BdName<br />
	WriteINIStr &quot;$PathIniFile\${IniFile}.INI&quot; &quot;sql&quot; &quot;IP&quot; $BdHost<br />
	WriteINIStr &quot;$PathIniFile\${IniFile}.INI&quot; &quot;sql&quot; &quot;g&quot; $BdUser<br />
	WriteINIStr &quot;$PathIniFile\${IniFile}.INI&quot; &quot;sql&quot; &quot;e&quot; $BdPass<br />
	WriteINIStr &quot;$PathIniFile\${IniFile}.INI&quot; &quot;sql&quot; &quot;f&quot; $EncryptionKey<br />
	WriteINIStr &quot;$PathIniFile\${IniFile}.INI&quot; &quot;sql&quot; &quot;Type&quot; &quot;15632&quot;<br />
SectionEnd<br />
 <br />
<br />
My installer crashes and do not compile with these error log : <br />
<br />
<br />
Processed 1 file, writing output:<br />
Adding plug-ins initializing function... Done!<br />
Error: resolving install function &quot;Crypto::GeneratePWDSecutityString(v) .EncryptionKey&quot; in unnamed install section (1)<br />
Note: uninstall functions must begin with &quot;un.&quot;, and install functions must not<br />
Error - aborting creation process<br />
<br />
<br />
I'm waiting your answers!<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Inazad</div><div class="date">21st May 2009, 19:21</div></div><div class="posttext">Section -BD<br />
  Call CreateDatabaseAndBasicData<br />
  <br />
  File Crypto.dll<br />
  System::Call 'Crypto::GeneratePWDSecurityString(v) (v).EncryptionKey'<br />
  System::Call 'Crypto::EncodePWDEx(t, t) t(.BdUser, .EncryptionKey).BdUser'<br />
  System::Call 'Crypto::EncodePWDEx(t, t) t(.BdPass, .EncryptionKey).BdPass'<br />
<br />
SectionEnd<br />
<br />
There is the declaration of my dll' functions :<br />
<br />
string GeneratePWDSecurityString();<br />
string EncodePWDEx(string, string);<br />
<br />
My installers is crashing... Don't know why :( Do I have the good syntax because my code compiles well...<br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">21st May 2009, 20:36</div></div><div class="posttext">threads merged due to posting in the translation sub-forum as well.<br />
<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd May 2009, 10:32</div></div><div class="posttext">You have to quote that BdUser and EncryptionKey strings if they are strings. If those are actually variables, then replace them with one of the regular variables because that's all System supports.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Inazad</div><div class="date">22nd May 2009, 12:43</div></div><div class="posttext">Do you have an example ??<br />
<br />
Because I'm new in this and I want that section works..<br />
<br />
I wrote this line of code and my installer crashes :<br />
<br />
System::Call 'Crypto::EncodePWDEx(t, t) t(.BdUser, .EncryptionKey).BdUser'<br />
<br />
This line takes my var BdUser and EncryptionKey and encode it. I want the result back into BdUser.<br />
<br />
There is a way to check if our DLL is correctly builded ?<br />
<br />
Thanks,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">22nd May 2009, 14:39</div></div><div class="posttext">Like this:<br />
System::Call 'Crypto::EncodePWDEx(t, t) t(&quot;$BdUser&quot;, &quot;$EncryptionKey&quot;).s'<br />
Pop $BdUser<br />
<br />
But if that's a .NET dll then you have to call it using the CLR (http://nsis.sourceforge.net/Call_.NET_DLL_methods_plug-in) plugin.<br />
<br />
For the System plugin you can't just use .BdUser in there for the input/output - you can only use what is specified in the System plugin readme (like r0, R0 etc).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Inazad</div><div class="date">22nd May 2009, 14:49</div></div><div class="posttext">I wrote my dll in delphi with the Crypto' functions to encrypt data.<br />
<br />
Maybe its the code or maybe its the dll... how to know  ? :cry:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">22nd May 2009, 15:12</div></div><div class="posttext">I have edited my post above.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Inazad</div><div class="date">22nd May 2009, 15:17</div></div><div class="posttext">I have these lines in my code :<br />
Section -BD   <br />
	Call CreateDatabaseAndBasicData<br />
	<br />
	File &quot;Crypto.dll&quot;<br />
	<br />
	;System::Call 'Crypto::GeneratePWDSecutityString() .s'<br />
	<br />
	StrCpy $EncryptionKey &quot;oKQ2N0mLjxEX8WT4&quot;<br />
	;StrCpy $EncryptionKey &quot;&quot;<br />
	<br />
	System::Call 'Crypto::EncodePWDEx(t, t) t(&quot;$BdUser&quot;, &quot;$EncryptionKey&quot;).s'<br />
	Pop $BdUser<br />
	;System::Call 'Crypto::EncodePWDEx(t.BdPass, t.EncryptionKey) .BdPass's<br />
	;System::Call 'Crypto::EncodePWDEx(t.BdUser,t.EncryptionKey).r0'<br />
	<br />
	WriteINIStr &quot;$PathIniFile\${IniFile}.INI&quot; &quot;sql&quot; &quot;Nom_Database&quot; $BdName<br />
	WriteINIStr &quot;$PathIniFile\${IniFile}.INI&quot; &quot;sql&quot; &quot;IP&quot; $BdHost<br />
	WriteINIStr &quot;$PathIniFile\${IniFile}.INI&quot; &quot;sql&quot; &quot;g&quot; $BdUser<br />
	WriteINIStr &quot;$PathIniFile\${IniFile}.INI&quot; &quot;sql&quot; &quot;e&quot; $BdPass<br />
	WriteINIStr &quot;$PathIniFile\${IniFile}.INI&quot; &quot;sql&quot; &quot;f&quot; $EncryptionKey<br />
	WriteINIStr &quot;$PathIniFile\${IniFile}.INI&quot; &quot;sql&quot; &quot;Type&quot; &quot;15632&quot;<br />
SectionEnd<br />
<br />
Don't know if its the DLL or the code :mad: <br />
<br />
Do you have IM like MSN or Gaim ?<br />
<br />
THanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">22nd May 2009, 15:35</div></div><div class="posttext">Where is the dll being extracted to?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Inazad</div><div class="date">22nd May 2009, 15:49</div></div><div class="posttext">it in the same directory of the .nsi file...<br />
<br />
THere is a another place to put it ?<br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">22nd May 2009, 15:57</div></div><div class="posttext">No, I said where are you extracting to on the user's machine? You have no SetOutPath instruction in that code which is why I ask. You may be extracting it to a location that the System plugin doesn't look in.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Inazad</div><div class="date">22nd May 2009, 16:10</div></div><div class="posttext">There ??<br />
<br />
Section -Main	<br />
    SetOverwrite try    <br />
	SetShellVarContext all                                                      # Pour tous les utilisateurs<br />
	StrCpy $PathIniFile &quot;$AppData\${Company}\${ProjectGroup}\Instances\$TxtInstanceValue&quot;<br />
    SetOutPath &quot;$INSTDIR&quot;                                                       # Pour copier l'exÃ©cutable du service<br />
		File &quot;Z:\Application\PRD\${IniFile}.exe&quot;<br />
    <br />
    SetOutPath &quot;$INSTDIR\..\&quot;                                                   # Pour copier l'exÃ©cutable de configuration du service<br />
		File &quot;Z:\Application\PRD\${ConfFile}.exe&quot;		<br />
<br />
    SetOutPath $PathIniFile 													# Pour copier les fichiers ini<br />
		File &quot;${IniFile}.INI&quot;<br />
		<br />
	SetOutPath &quot;$AppData\${Company}\&quot;<br />
		File /r &quot;..\..\_Commun\Traduction\*.mo&quot;<br />
		<br />
	CreateShortCut &quot;$DESKTOP\${AppName}.lnk&quot; &quot;$INSTDIR\..\${ConfFile}.exe&quot; &quot;-s$TxtInstanceValue&quot;<br />
SectionEnd<br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Inazad</div><div class="date">22nd May 2009, 16:31</div></div><div class="posttext">This is the top of my code, maybe you'll find what you're searching for ???<br />
<br />
!define AppName 			&quot;Blf Agent Unistim&quot;<br />
!define ProjectGroup 		&quot;BlfAgent&quot;<br />
!define Company 			&quot;Komutel&quot;<br />
!define IniFile 			&quot;BlfAgent_Unistim&quot;<br />
!define ConfFile 			&quot;BlfAgent_Configuration&quot;<br />
<br />
!define ServiceName 		&quot;BlfAgentUnistim&quot;<br />
!define ServiceDescription 	&quot;Busy Lamp Field Service&quot;<br />
!define ServiceRegSearch    &quot;BlfAgent&quot;<br />
<br />
# Variables<br />
Var StartMenuGroup<br />
Var PathIniFile<br />
Var InstanceCount<br />
<br />
# General Symbol Definitions<br />
!define REGKEY &quot;SOFTWARE\${AppName}&quot;<br />
<br />
# MUI Symbol Definitions<br />
!define MUI_ICON &quot;${NSISDIR}\Contrib\Graphics\Icons\orange-install.ico&quot;<br />
!define MUI_FINISHPAGE_NOAUTOCLOSE<br />
!define MUI_STARTMENUPAGE_REGISTRY_ROOT HKLM<br />
!define MUI_STARTMENUPAGE_NODISABLE<br />
!define MUI_STARTMENUPAGE_REGISTRY_KEY &quot;${REGKEY}&quot;<br />
!define MUI_STARTMENUPAGE_REGISTRY_VALUENAME StartMenuGroup<br />
!define MUI_STARTMENUPAGE_DEFAULTFOLDER &quot;${AppName}&quot;<br />
!define MUI_UNICON &quot;..\Commun\App_Icons\sit-final.ico&quot;	<br />
!define MUI_UNFINISHPAGE_NOAUTOCLOSE<br />
!define MUI_LANGDLL_REGISTRY_ROOT HKLM<br />
!define MUI_LANGDLL_REGISTRY_KEY &quot;${REGKEY}&quot;<br />
!define MUI_LANGDLL_REGISTRY_VALUENAME InstallerLanguage<br />
<br />
# Included files<br />
!include Sections.nsh<br />
!include MUI2.nsh<br />
!include LogicLib.nsh<br />
!include nsDialogs.nsh<br />
;!include ..\Commun\Crypto.nsh<br />
!include ..\Commun\ServiceLib.nsh<br />
!include ..\Commun\frmInstance.nsh<br />
!include ..\Commun\frmUnInstance.nsh<br />
!include ..\Commun\frmMsde.nsh<br />
!include ..\Commun\frmConfigBd.nsh<br />
!include ..\Commun\frmUnistimConfig.nsh<br />
!include ..\Commun\SqlServerScriptBd.nsh<br />
<br />
#________Pages d'installation____________________________________________________________________________________________________<br />
!insertmacro MUI_PAGE_WELCOME<br />
Page custom  FrmInstanceShow	FrmInstanceClose<br />
Page Custom  frmMsdeShow        frmMsdeClose<br />
Page Custom  frmConfigBdShow    frmConfigBdClose	<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE JumpThisPage                  ;Fonction qui me permet de valider si j'exÃ©cute la page suivante<br />
	!insertmacro MUI_PAGE_DIRECTORY	<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE JumpThisPage                  ;Fonction qui me permet de valider si j'exÃ©cute la page suivante<br />
	!insertmacro MUI_PAGE_STARTMENU Application $StartMenuGroup	<br />
!insertmacro MUI_PAGE_INSTFILES<br />
Page custom  frmUnistimConfigServiceShow	frmUnistimConfigServiceClose<br />
!insertmacro MUI_PAGE_FINISH<br />
#___________________________________________________________________________________________________________________________<br />
<br />
#________Pages de dÃ©sinstallation__________________________________________________________________________________________________<br />
!insertmacro MUI_UNPAGE_CONFIRM<br />
UninstPage custom  un.FrmUnInstanceShow	un.FrmUnInstanceClose<br />
!insertmacro MUI_UNPAGE_INSTFILES<br />
#___________________________________________________________________________________________________________________________<br />
<br />
# Macro pour les langues<br />
!insertmacro MUI_RESERVEFILE_LANGDLL<br />
!insertmacro MUI_LANGUAGE English<br />
!insertmacro MUI_LANGUAGE French<br />
<br />
# Installer attributes<br />
Name &quot;${AppName}&quot;<br />
OutFile &quot;${AppName} Setup.exe&quot;<br />
InstallDir &quot;$PROGRAMFILES\${Company}\${ProjectGroup}\${AppName}\&quot;<br />
CRCCheck on<br />
XPStyle on<br />
ShowInstDetails show<br />
InstallDirRegKey HKLM &quot;${REGKEY}&quot; &quot;Path&quot;<br />
ShowUninstDetails show<br />
RequestExecutionLevel admin<br />
<br />
<br />
<br />
PS: Sorry for the post in double..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">22nd May 2009, 19:00</div></div><div class="posttext">Assuming SetOutPath &quot;$AppData\${Company}\&quot; was the last SetOutPath instruction then you're extracting Crypto.dll there too.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Inazad</div><div class="date">22nd May 2009, 20:38</div></div><div class="posttext">So if the Installer Create a Directory into C:\Program Files\ and the company name is Hello, I have to put my dll into :<br />
<br />
C:\Program Files\Hello ?<br />
<br />
Thanks,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd May 2009, 12:54</div></div><div class="posttext">Extract to $PLUGINSDIR. That's where the System plugin is so it'll find your dll when it's in the same folder.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Inazad</div><div class="date">23rd May 2009, 18:02</div></div><div class="posttext">OK I'll test it Monday, at my office.<br />
<br />
Can we specify an absolute path like :<br />
<br />
File &quot;Z:\Dev\Commun\Crypto.dll&quot;    ?<br />
<br />
Thanks for your support!<br />
<br />
JS</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Inazad</div><div class="date">25th May 2009, 14:49</div></div><div class="posttext">I've put the DLL into the $PLUGINSDIR of NSIS.<br />
<br />
I don't get error while installing but my DLL do not do his job correctly because I'm getting the string &quot;error&quot; in my INI file ....<br />
<br />
There is a way to track or debug a NSIS installer ???<br />
<br />
Thanks,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th May 2009, 16:46</div></div><div class="posttext">$PLUGINSDIR has nothing to do with the NSIS plugins folder.<br />
<br />
Try this:<br />
SetOutPath $PLUGINSDIR<br />
File Crypto.dll<br />
<br />
When you use the NSIS plugin call syntax such as System::Call or nsDialogs::Create NSIS actually includes the plugin DLL and extracts it at run-time to $PLUGINSDIR. If you look in your %TEMP% folder you will find a ns*.tmp folder with the DLL files in it. Having said that, for the System plugin to find the DLL you want to call, it either needs to be in PATH (i.e. $SYSDIR) or in the same folder as System.dll ($PLUGINSDIR). Hopefully that makes sense as I don't think you get it!<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Inazad</div><div class="date">25th May 2009, 16:49</div></div><div class="posttext">I've made an executable in Delphi who do the same as my dll...<br />
<br />
Now I just want to call the executable with this following string :<br />
<br />
$PathIniFile\${IniFile}.INI<br />
<br />
My executable name is : Cypher.exe<br />
<br />
Thanks to you.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>