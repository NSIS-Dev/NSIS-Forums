<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" 1.94 Uninstaller problem., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  1.94 Uninstaller problem. NSIS Discussion" />
	
	<title> 1.94 Uninstaller problem. [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  1.94 Uninstaller problem.</div>
<hr />
<div class="pda"><a href="t-72029.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=72029">1.94 Uninstaller problem.</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Pomflain</div><div class="date">15th January 2002, 17:16</div></div><div class="posttext">I've got a portion of code which reads the old registry and prompts to uninstall the old version if it's found.  Been using this since 1.61.  It was fine with 1.91,  but I just installed 1.94.  Now it says &quot;Error initializing uninstaller,&quot; when it tries to run the unistaller executable.  It gets this information from the registry key like this:<br />
<br />
ReadRegStr $9 HKEY_LOCAL_MACHINE &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\${PROGNAME}&quot; &quot;UninstallString&quot;<br />
<br />
ClearErrors<br />
<br />
	Sleep 500<br />
	Exec &quot;$9&quot;<br />
	IfErrors DisplayMsgBox Fin<br />
<br />
Just noticed it when I tried to uninstall a 1.94 built version,  but it didn't happen with the version that I last built,  which was with 1.91.<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pomflain</div><div class="date">17th January 2002, 20:42</div></div><div class="posttext">This problem seems to have cropped up in version 1.80.  No problems with 1.70,  but anything later than 1.80 and it happens.<br />
<br />
I've also noticed this odd UDebugOut.default which is always 0 bytes and has a somewhat random date.  Not sure if that's related,  but I can't use any of these later versions because I need to be able to spawn off the uninstaller from within an installer.  It would be nice if that was a standard option built into the compiler,  but I'll be perfectly happen if this can be fixed so it works ok again.<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rainwater</div><div class="date">17th January 2002, 20:54</div></div><div class="posttext">Don't you need to use ExecWait instead of Exec, to wait for the uninstaller to finish?<br />
<br />
Since all you are really doing is running the uninstaller exe, that would mean that the uninstaller is not working correctly.  Maybe you built the program with a version of NSIS that had a bug in the uninstaller.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pomflain</div><div class="date">17th January 2002, 21:00</div></div><div class="posttext">Originally posted by rainwater <br />
Don't you need to use ExecWait instead of Exec, to wait for the uninstaller to finish?<br />
<br />
Since all you are really doing is running the uninstaller exe, that would mean that the uninstaller is not working correctly.  Maybe you built the program with a version of NSIS that had a bug in the uninstaller. <br />
<br />
Yeah,  I can try that.  I wrote all that stuff 5 or 6 months ago and I know that ExecWait didn't do anything as far as having the uninstaller run first.  I'd prefer that behavior because occasionally someone will switch off the installer/uninstaller and then come back and run the installer first and the the uninstaller after and obviously you know what happens.  I'll try switching over to ExecWait,  but I don't think that's the problem.  Long time ago heard someone say something about rundll32 being part of it because on the 9x kernel and ME the uninstaller will almost always fail to launch in the fashion,  but it works if you do it &quot;normally.&quot;  Just need to have that check in there.  Tell all the users to make sure to go to the control panel and uninstall the app first,  but I also put that check in there again because I know that many of them won't uninstall it first.  I'll let you know what happens.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rainwater</div><div class="date">17th January 2002, 21:05</div></div><div class="posttext">You can always put the uninstaller stuff in your installer.  Make a required section that checks for the program and then remove, modify whatever you need to do.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pomflain</div><div class="date">17th January 2002, 21:15</div></div><div class="posttext">Hmm,  yeah that &quot;fixed&quot; the problem.  It doesn't wait until the uninstaller finishes,  so the behavior is still the same,  but it fixed the error with it says the uninstaller can't initialize.  So it appears to be a problem with ExecShell in 1.80+ versions.<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pomflain</div><div class="date">17th January 2002, 21:18</div></div><div class="posttext">You're probably wondering why I'm talking about ExecShell when the code says Exec above.  I pasted in the wrong portion,  the portion I pasted is for the 9x/ME versions where if the installer fails with ExecShell I have it sleep and try with Exec instead.<br />
<br />
Function .onInit<br />
<br />
	ClearErrors<br />
<br />
	ReadRegStr $9 HKEY_LOCAL_MACHINE &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\${PROGNAME}&quot; &quot;UninstallString&quot;<br />
	StrCmp $9 &quot;&quot; Clean PrevInst<br />
<br />
  Clean:<br />
	Goto InitDone<br />
<br />
  PrevInst:<br />
<br />
	ReadRegStr $8 HKEY_LOCAL_MACHINE &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\${PROGNAME}&quot; &quot;DisplayName&quot;<br />
	MessageBox MB_YESNO &quot;$8 found$\nUninstall this version?&quot; IDNO InitDone<br />
      		;ExecShell &quot;open&quot; &quot;$9&quot; SW_SHOWNORMAL<br />
      		ExecWait &quot;$9&quot;<br />
		;Abort ; causes installer to quit.<br />
<br />
	IfErrors InstErr InitDone<br />
  InstErr:<br />
	Call FailedUninst<br />
<br />
  InitDone:<br />
FunctionEnd<br />
<br />
That's what I had and as you can see I took out the ExecShell line and changed it to ExecWait and that fixed that portion of the problem.<br />
<br />
Sorry about that...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pomflain</div><div class="date">18th January 2002, 00:41</div></div><div class="posttext">Just noticed this,  when the uninstaller finishes,  I have it attempt to delete the directory where the files were installed.  I then have it try to delete the parent directory.  I've always known RMDir to fail if there are files or other directories nested inside the current directory.  The reason for attempting to delete the parent directory is because all the apps I have go into their own directory and if you no longer had an of the apps installed,  it should delete the main directory so everything is gone.<br />
<br />
Anyway,  I just noticed that it's no longer wanting to delete the current directory.  So,  I put in a messagebox to see if the variable was messed up some how,  and it wasn't.  However,  when I do that it correctly deletes the directory.  So I tried putting in a sleep instead,  but that didn't work either.  Any ideas on this problem?<br />
<br />
Thanks.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>