<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Start Menu variable not set in MUI Start Menu Leave ?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Start Menu variable not set in MUI Start Menu Leave ? NSIS Discussion" />
	
	<title> Start Menu variable not set in MUI Start Menu Leave ? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Start Menu variable not set in MUI Start Menu Leave ?</div>
<hr />
<div class="pda"><a href="t-255116.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=255116">Start Menu variable not set in MUI Start Menu Leave ?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">CrushBug</div><div class="date">8th September 2006, 22:58</div></div><div class="posttext">In NSIS 2.19<br />
<br />
I think that the MUI custom leave function for the Start Menu is not setting the variable specified. It does get set when the MUI Start Menu page is completely gone (after the custom leave function), but not in the function.<br />
<br />
eg. (subset of full installer)<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE LeaveFunction_StartMenuSelect<br />
!define MUI_STARTMENUPAGE_DEFAULTFOLDER &quot;Default&quot;<br />
!insertmacro MUI_PAGE_STARTMENU &quot;MainApp&quot; $StartMenuLocation<br />
<br />
Function LeaveFunction_StartMenuSelect<br />
<br />
MessageBox MB_OK $StartMenuLocation<br />
<br />
FunctionEnd<br />
<br />
And $StartMenuLocation keeps coming up blank/null/&quot;&quot;<br />
<br />
I found a similar report from 2003 - http://forums.winamp.com/showthread.php?threadid=140253 and I am wondering if this is an issue that hasn't been fixed yet or not properly reported. Anyone else seeing this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th September 2006, 01:19</div></div><div class="posttext">The StartMenu only pushes the result when its finished. There's no INI to update as with InstallOptions. You could get the text on your own calling GetWindowText using the System plug-in.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CrushBug</div><div class="date">9th September 2006, 23:00</div></div><div class="posttext">While I understand what you are saying and I am going to try the GetWindowText in a few minutes, this still seems like a bug to me.<br />
<br />
This kind of functionality exists in Dir Select page and I am able to fully and completly filter and edit all possible bad characters through the _LEAVE function.<br />
<br />
When I needed to filter bad characters in the Start Menu page, this page does not set the variable like it does in the Dir Select page. This functionality was expected because it works perfectly in Dir Select. Without it, I am unable to filter bad characters, although I should be able to now, using your GetWindowText suggestion.<br />
<br />
Would you reconsider this issue as a bug, or is it dead?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CrushBug</div><div class="date">10th September 2006, 00:26</div></div><div class="posttext">Tryint to get this to work, but I guess I don't know how to get the control ID for the MUI Start Menu edit box correctly<br />
FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
GetDlgItem $1 $0 1000<br />
I have tried 1000 and 1019 but no luck, or am I just totally off in the weeds?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CrushBug</div><div class="date">10th September 2006, 21:36</div></div><div class="posttext">OK, I have it all mostly working now. Here is what is going right:<br />
<br />
FindWindow $3 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
GetDlgItem $2 $3 1002  ; 1002 is the ID of the Start Menu Edit <br />
System::Call 'User32::GetWindowText(i $2, t .R0, i 256)'<br />
<br />
And $R0 ends up with the Start Menu that has been selected/typed in. I do my validation code after this, and once its all done, I re-write the edit box with:<br />
<br />
System::Call 'User32::SetWindowText(i $2, t &quot;$R0&quot;)'<br />
<br />
and call the abort if I want the user to fix the Start Menu path.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th September 2006, 08:49</div></div><div class="posttext">Originally posted by CrushBug <br />
Would you reconsider this issue as a bug, or is it dead? You could submit a bug report/feature request/patch. It would be best if the leave function would have the correct value, but as you can understand from my earlier explanation, there's a technical difficulty involved. A possible solution would be having the MUI use GetWindowsText on its own before calling your leave function.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>