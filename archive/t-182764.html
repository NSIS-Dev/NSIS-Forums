<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Go back after Page InstFiles, run the installer again, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Go back after Page InstFiles, run the installer again NSIS Discussion" />
	
	<title> Go back after Page InstFiles, run the installer again [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Go back after Page InstFiles, run the installer again</div>
<hr />
<div class="pda"><a href="t-182764.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=182764">Go back after Page InstFiles, run the installer again</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">petko</div><div class="date">9th June 2004, 06:27</div></div><div class="posttext">Hello,<br />
<br />
I am trying to write an installer with two pages, a custom page using InstallOptions and the page InstFiles. After installing/updating some stuff, I need it to go back, expecting the user to give another input data. The user can close the program by pressing the Cancel button on the first page.<br />
<br />
Unfortunately the Back button on the page InstFiles is disabled. The only working method that I found is Exec &quot;$CMDLINE&quot;:<br />
<br />
Function .onInstSuccess<br />
  Exec '$CMDLINE'<br />
FunctionEnd<br />
<br />
but this way the program closes and reopens, and has to decompress everything once again. Another solution would be to add some more pages:<br />
<br />
Page custom ShowCustom<br />
Page InstFiles<br />
Page custom ShowCustom<br />
Page InstFiles<br />
Page custom ShowCustom<br />
Page InstFiles<br />
<br />
but I don't want to have a limit - as the user may need to update one file or twenty-five.<br />
<br />
For this goal, the global label &quot;.onceagain:&quot; in ShowCustom, called by .onInstSuccess isn't working.<br />
<br />
The best thing would be to enable the &quot;Back&quot; button on the page InstFiles. Do you have any idea how it could be done? I would apreciate any other idea/method that would work.<br />
<br />
Thank you very much for your attention.<br />
Petko</div></div><hr />


<div class="post"><div class="posttop"><div class="username">petko</div><div class="date">9th June 2004, 09:30</div></div><div class="posttext">I also tried some trikcs I found here (http://nsis.sourceforge.net/archive/nsisweb.php?page=363&amp;instances=0,11), but maybe I'm still doing something wrong.<br />
<br />
<br />
Page InstFiles showInst<br />
<br />
function showInst<br />
  GetDlgItem $R0 $HWNDPARENT 3<br />
  EnableWindow $R0 1<br />
FunctionEnd<br />
<br />
This actually enables the &quot;Back&quot; button before the end of the installation, but when the text &quot;Completed&quot; appears, the button is disabled again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">9th June 2004, 10:46</div></div><div class="posttext">Hard situation here. You could create another installation just to enable the button, using Sleep and the lines of code to enable the button (only changing the hWnd by the real installer one which means that FindWindow $var &quot;#32770&quot; is necessary here). Run this second program before ending the installation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">petko</div><div class="date">9th June 2004, 13:52</div></div><div class="posttext">Thank you for the idea, but doesn't seem to work as expected. When I push the Back button, instead of returning to the first custom page, it runs again directly the page InstFiles. Here is the script for back.exe, called as 'Exec &quot;$PLUGINSDIR\back.exe $HWNDPARENT&quot;'<br />
<br />
!include &quot;WinMessages.nsh&quot;<br />
<br />
Name &quot;back&quot;<br />
OutFile &quot;back.exe&quot;<br />
<br />
Section main<br />
SectionEnd<br />
<br />
Function .onInit<br />
	sleep 500<br />
	call GetParameters<br />
	Pop $R0<br />
	<br />
	strCmp $R0 &quot;&quot; skip<br />
             GetDlgItem $R1 $R0 3<br />
             IsWindow $R1 0 skip<br />
                      EnableWindow $R1 1<br />
                      goto end<br />
       skip:<br />
            MessageBox MB_OK &quot;No valid window specified&quot;<br />
      end:<br />
      abort<br />
FunctionEnd<br />
Function GetParameters ;//as in the manual</div></div><hr />


<div class="post"><div class="posttop"><div class="username">petko</div><div class="date">9th June 2004, 14:14</div></div><div class="posttext">It works, finally, with an additional check how the page InstFiles is called:<br />
<br />
<br />
Page custom ShowCustom LeaveCustom<br />
Page InstFiles  showInst<br />
<br />
Function LeaveCustom<br />
         StrCpy $R9 1<br />
FunctionEnd<br />
function showInst<br />
       intcmp $R9 1 end<br />
              abort ;not coming from the first page<br />
       end:<br />
FunctionEnd<br />
Section main<br />
         StrCpy $R9 0<br />
; etc.<br />
<br />
Thank you very much, deguix, for the tip. :up:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Shorin</div><div class="date">7th July 2006, 15:40</div></div><div class="posttext">I was hoping such a simple task as making the page go back was simpler than making an external utility...<br />
<br />
Anybody have a better idea? (not requiring plugins?)<br />
<br />
- Also could someone please summarize this post and show the code that &quot;works&quot;. It's a little confusing here.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Shorin</div><div class="date">7th July 2006, 16:20</div></div><div class="posttext">Also I can't seem to get this working. It does what you said before. It goes directly to the instfiles page (annoying). I even put the changes in you said to. <br />
<br />
Also, I want back enabled only on error in installation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mr Inches</div><div class="date">7th July 2006, 16:25</div></div><div class="posttext">Try this:<br />
<br />
Use the Finish Page, but use the &quot;Run&quot; checkbox to be 'Run installation/again' option.<br />
Then use deguix's Goto To NSIS page function here (http://nsis.sourceforge.net/Go_to_a_NSIS_page) in the Run function that it calls, to return to the custom InstallOptions page.<br />
<br />
I have used a similar mechanism in an updater that updates multiple computers, so in my case the 'Run' box becomes an 'update another computer' box.<br />
<br />
Duncan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Shorin</div><div class="date">7th July 2006, 16:35</div></div><div class="posttext">I'm checking that out. Also I have gotten the code on this page working. &lt;I&gt;However&lt;/I&gt; There are several mistakes. <br />
'showInst' should really be a Pre function for INSTFILES page, not a show function. <br />
A bug that I ran into was that the top says &quot;Installation Aborted&quot;, and all the navigation buttons (except cancel) are disabled.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Shorin</div><div class="date">7th July 2006, 19:30</div></div><div class="posttext">I have a working, and correct solution!<br />
<br />
Uses deguix's RelGotoPage.<br />
<br />
;this helps us navigate between pages. Cannot be called from a section or section function. Only pre-show-post functions can be callers. Won't work otherwise.<br />
<br />
Function RelGotoPage   <br />
  Pop $R9<br />
  IntCmp $R9 0 0 Move Move<br />
    StrCmp $R9 &quot;X&quot; 0 Move<br />
      StrCpy $R9 &quot;120&quot;<br />
 <br />
  Move:<br />
  SendMessage $HWNDPARENT &quot;0x408&quot; &quot;$R9&quot; &quot;&quot;<br />
FunctionEnd<br />
<br />
;$GOBACK is a custom global variable. Should be initialized to 1, indicating success.<br />
<br />
Function LeaveInst ;LeaveInst is the leave function for INSTFILES.<br />
    ${If} $GOBACK == 0 ; this special variable GOBACK is 1 when we come a successful install. Its &quot;0&quot; if an error occured in the section install.<br />
        StrCpy $R9 &quot;&lt;--NUMBER OF PAGES TO NAVIGATE(+,-), YOUR VALUE--&gt;&quot; <br />
        Call RelGotoPage<br />
        Abort<br />
    ${EndIf}<br />
    Return<br />
FunctionEnd<br />
<br />
;If you encounter an error ANYWHERE (most likely in a section. Set GOBACK to 0 and Return immediately.<br />
; Aborting the section instead will cause all your navigation buttons to be disabled.<br />
; Note that your Descript text at the top will still say &quot;installing&quot; when you go back to that page. <br />
; I'm sure there is a way to fix this though.<br />
<br />
- A drawback I know will occur is that the sections after your section with an error will continue to install. I am not sure how to prevent this. Perhaps checking that error flag (GOBACK)  at the beginning of each section will tell us whether to install anything.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mr Inches</div><div class="date">8th July 2006, 00:03</div></div><div class="posttext">Shorin, sounds like you are on the right track.<br />
<br />
You need to remember that when using RelGotoPage, it does not reset any of the variables that may have changed during the first pass of your installer (this includes any built-in/standard ones too), so you need to do this explicitly. For example, I use the RealProgress plugin, so I need to remember to reset my progress counters and unload/load/reset the RealProgress plugin before jumping back pages. My updater only has one section so I haven't seen your behaviour with multiple sections.<br />
<br />
Also, petko, the problem of unpacking each run can be handled by unpacking for files into a directory in the $TEMP directory in the .onInit function, refer to your files during your install, and then remove them in the .onGUIEnd function.<br />
<br />
Duncan</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>