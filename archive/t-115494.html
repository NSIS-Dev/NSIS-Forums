<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" A little undocumented feature of NSIS, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  A little undocumented feature of NSIS NSIS Discussion" />
	
	<title> A little undocumented feature of NSIS [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  A little undocumented feature of NSIS</div>
<hr />
<div class="pda"><a href="t-115494.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=115494">A little undocumented feature of NSIS</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Mottel</div><div class="date">25th November 2002, 09:39</div></div><div class="posttext">As others have found as well, NSIS is proving to be a useful tool in ways unforseen by its designers.  I got sidetracked from writing an installer for a product that I'm still developing, to experimenting with the capabilities of NSIS -- which I have yet to fully master.  (It's a slow learning curve.)  It suddenly occurred to me that I could use NSIS to create something that I have always wanted -- an interpretive batch-file processor for Windows, which would read a plain-text input file and execute commands that it finds there.  (I used to be a DOS batch-file junkie back in the old days.)  I know there are other products out there that do this (e.g. Batchrun, http://www.outertech.com),  but not really well (IMO), so I am now trying to create one with NSIS that will have all the features I would like to see in such a utility. (Or the ones that I can successfully implement at any rate.)  It's interesting to watch this thing grow.  I'm calling it Batman.  (And, if no input file is specified on the command line, it looks for a file named Robin.bmn. :D )  If it amounts to anything worthwhile, I may post the results of my work here.  <br />
<br />
In the process of developing it, I discovered an obscure but interesting feauture of NSIS, documented below.  If anyone else finds this information useful, good luck to you.<br />
<br />
<br />
OpenFile:<br />
  ClearErrors<br />
  DetailPrint `Attempting to open input file ($7).`<br />
  FileOpen $9 $7 r<br />
  IfErrors OpenError ProcessFile<br />
<br />
ProcessFile:   ; -------   P R O C E S S I N G   I N P U T   F I L E   -------<br />
<br />
  DetailPrint `Input file ($7) opened. (Handle: $9)`<br />
  SetDetailsPrint TextOnly  ; We display the inputfile's name on the status<br />
  DetailPrint $7            ; line, where it will stay because subsequent<br />
  SetDetailsPrint ListOnly  ; command-logging is now to the listbox only.<br />
  StrCpy $9 `$9)  $7`     ; Explained below<br />
<br />
; The above line makes use of an undocumented feature of NSIS (a useful one -<br />
; not a bug) that deserves to be documented.  Once a file has been opened, it<br />
; is not necessary for internal operational purposes to retain the filename;<br />
; only the filehandle (stored here in $9) is required.  However, here, we want<br />
; to retain the filename for possible use later on in information displayed<br />
; for the benefit of the user.  (See explanation above where Subcaption 4 is<br />
; set.)  But why waste a variable to retain it if there is another way to do<br />
; so?  (Variables are at a premium here, because $R1 to $R9 are reserved for<br />
; use by the user.)  I discovered that it is possible to append the filename<br />
; (or other non-numeric text) to the variable holding the filehandle without<br />
; impeding file I/O operations.  It seems that once a valid filehandle is read<br />
; from the relevant variable by the internal I/O routines they (sensibly)<br />
; ignore other kinds of data that may be appended to the filehandle in that<br />
; variable.  This means that we can safely append other stuff there.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">25th November 2002, 13:56</div></div><div class="posttext">very good to know, the only problem is that you need to parse the handle now to get the file name back.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mottel</div><div class="date">25th November 2002, 14:16</div></div><div class="posttext">Yup! As they say, &quot;there's no such thing as a free lunch.&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">25th November 2002, 14:19</div></div><div class="posttext">hehe, how true is that!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th November 2002, 16:11</div></div><div class="posttext">Since a handle is just a pointer to some Windows structure, it's nothing but a number. NSIS variables are kept as strings, and to get a number it must convert them. When converting it stops on the first character it finds if in decimal mode.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dbareis</div><div class="date">26th November 2002, 09:52</div></div><div class="posttext">Hi,<br />
<br />
I could use NSIS to create something that I have always wanted -- an interpretive batch-file processor for Windows, which would read a plain-text input file and execute commands that it finds there. <br />
<br />
I must be missing something how is this different from a &quot;.bat&quot; or &quot;.cmd&quot; file?<br />
A simple batch file will work anywhere.<br />
NT/2000 and I assume XP have major (if cryptic) extensions which allow for quite complex processing...<br />
<br />
If if you don't mind installing software &quot;rexx&quot; is good and I don't know about older operating systems but VBSCRIPT/JAVASCRIPT/WSH is available on Windows 2000/XP.<br />
<br />
Bye,<br />
Dennis</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>