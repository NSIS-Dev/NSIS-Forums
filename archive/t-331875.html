<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" write path into ini, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  write path into ini NSIS Discussion" />
	
	<title> write path into ini [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  write path into ini</div>
<hr />
<div class="pda"><a href="t-331875.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=331875">write path into ini</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Zamorro</div><div class="date">25th June 2011, 09:37</div></div><div class="posttext">the user should be able to select a folder and the path should be written into an ini file<br />
my current script:<br />
edit<br />
Name writepath<br />
OutFile writepath.exe<br />
;InstallDir &quot;$PROGRAMFILES\Rockstar Games\Grand Theft Auto San Andreas&quot;<br />
Page directory<br />
Page custom writepath<br />
Page instfiles<br />
<br />
Section<br />
SetOutPath $INSTDIR<br />
GetFullPathName $0 ..<br />
SectionEnd<br />
<br />
Function writepath<br />
;WriteINIStr $DESKTOP\GTASA_Start.ini MOD-1 path $INSTDIR<br />
WriteINIStr $DESKTOP\GTASA_Start.ini MOD-1 path $0<br />
FunctionEnd<br />
<br />
Section<br />
	DetailPrint $0<br />
	DetailPrint $INSTDIR<br />
SectionEnd<br />
<br />
Now i have 2 problems:<br />
<br />
1. the installer writes only the content of $INSTDIR into ini but not the content of any other variable like $0<br />
Why?<br />
<br />
2. if i use InstallDir &quot;$PROGRAMFILES\Rockstar Games\Grand Theft Auto San Andreas&quot;<br />
for Page directory<br />
and choose then in the installer Page directory a folder which have another name than Grand Theft Auto San Andreas,<br />
for example: G:\1-Mod-Grand Theft Auto San Andreas<br />
then $INSTDIR returns G:\1-Mod-Grand Theft Auto San Andreas\Grand Theft Auto San Andreas<br />
It creates the folder of InstallDir as subfolder of the choosen directory<br />
How to prevent that?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">25th June 2011, 11:25</div></div><div class="posttext">1: Because you only write $INSTDIR to the ini file. You need to write $0 using a second WriteINIStr command. (What made you think that NSIS would write $0 to the ini file, when you never told it to do that?)<br />
<br />
<br />
2: It's all in the manual:  http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.1.21<br />
(Short version: try appending a \ to your installdir.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Zamorro</div><div class="date">25th June 2011, 11:49</div></div><div class="posttext">1: Because you only write $INSTDIR to the ini file. You need to write $0 using a second WriteINIStr command. (What made you think that NSIS would write $0 to the ini file, when you never told it to do that?)<br />
shure did i wrote<br />
WriteINIStr $DESKTOP\GTASA_Start.ini MOD-1 path $0<br />
but the installer don't write the content of $0<br />
so i removed this line from script<br />
and meanwhile added it again with edit button<br />
<br />
2: It's all in the manual:jep, a backslash at the end<br />
<br />
But Jesus, now i got the bigest problem<br />
I want to start the gta_sa.exe of San Andreas<br />
Exec '&quot;G:\Grand Theft Auto San Andreas\gta_sa.exe&quot;'<br />
Quit<br />
But it caused a heavy bug with message &quot;game must be closed&quot;<br />
I had to restart my pc to get it working again<br />
Is NSIS able to start a 3dGame?<br />
<br />
I tried then to make a shortcut<br />
CreateShortCut &quot;$DESKTOP\StartGTASA.lnk&quot; &quot;G:\Grand Theft Auto San Andreas\gta_sa.exe&quot; &quot;&quot; &quot;G:\Grand Theft Auto San Andreas\gta_sa.exe&quot; 0 SW_SHOWNORMAL ALT|CONTROL|F8<br />
But one info was missing: the folder name where the exe should run<br />
and this is the reason that the game doesn't start<br />
view the image of the shortcut properties:<br />
http://thumbnails47.imagebam.com/13797/7b6031137968661.jpg (http://www.imagebam.com/image/7b6031137968661)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">25th June 2011, 15:37</div></div><div class="posttext">shure did i wrote<br />
WriteINIStr $DESKTOP\GTASA_Start.ini MOD-1 path $0<br />
but the installer don't write the content of $0<br />
Check the contents of $0 using a messagebox.<br />
<br />
But one info was missing: the folder name where the exe should run<br />
and this is the reason that the game doesn't start<br />
It's all in the manual:  http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.3.4 (Hint: look for 'working directory').<br />
<br />
Is NSIS able to start a 3dGame?<br />
NSIS doesn't care what kind of exe it is. It just launches the exe. Since the shortcut doesn't work without a proper working directory, this is probably also the cause of the problem here. SetOutPath should do the trick here.<br />
<br />
By the way, my name isn't Jesus. Please address people properly.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Zamorro</div><div class="date">27th June 2011, 22:23</div></div><div class="posttext">Check the contents of $0 using a messagebox.<br />
works now<br />
<br />
NSIS doesn't care what kind of exe it is. It just launches the exe. Since the shortcut doesn't work without a proper working directory, this is probably also the cause of the problem here. SetOutPath should do the trick here.<br />
works with<br />
ExecShell &quot;open&quot; &quot;$gamerun&quot;<br />
<br />
Thanks for all<br />
just one last question<br />
<br />
i would like to get the DirRegKey for InstallDirRegKey HKLM &quot;Software\Rockstar Games\GTA San Andreas&quot; &quot;&quot;<br />
I allready asked somewhere regarding to GTA IV and got the answer:I don't think the GTA4 regkeys will be in HKCU, because it installs to program files which requires admin access. Admin installers (should) write to HKLM. If it IS stored in HKCU, then it will be the admin's HKCU, so either way you need to elevate your installer. Use requestexecutionlevel admin and use the UserInfo plugin in .onInit to verify admin access.<br />
i checked the UserInfo.nsi but don't know how it could help<br />
Then i installed the UAC plugin and tried that script:<br />
http://nsis.sourceforge.net/UAC_plug-in with !include UAC.nsh but the compiler dindn' accept this: UAC::RunElevated<br />
what is missing?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">28th June 2011, 05:59</div></div><div class="posttext">Please do not use the UAC plugin for something this simple. It's very complex to use, and you don't need it at all.<br />
<br />
Simply do:<br />
<br />
requestexecutionlevel admin<br />
<br />
function .onInit<br />
  UserInfo::GetAccountType<br />
  Pop $1<br />
  ${If} $1 != &quot;Admin&quot;<br />
    MessageBox MB_OK &quot;Requires admin!&quot;<br />
    quit<br />
  ${EndIf}<br />
functionend<br />
<br />
Note that if you only want to READ the regkey, you can just do that from a normal userlevel installer. But if the game was installed to Program Files for example and you want to *write* something there, then yes, admin access is a requirement.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>