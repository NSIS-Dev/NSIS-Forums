<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Install 6 programs., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Install 6 programs. NSIS Discussion" />
	
	<title> Install 6 programs. [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Install 6 programs.</div>
<hr />
<div class="pda"><a href="t-283930.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=283930">Install 6 programs.</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">netiad</div><div class="date">28th December 2007, 19:25</div></div><div class="posttext">Hello,<br />
<br />
I would like to install 6 programs using NSIS. I found the following code below.<br />
<br />
The original code is Snip #1. My changes are Snip #2. <br />
<br />
The original code installs two programs and sub programs. I just want to install 6 programs and no sub programs. <br />
<br />
//// Snip #1<br />
<br />
Name &quot;Multiple InstFiles&quot;<br />
OutFile &quot;multi-install.exe&quot;<br />
 <br />
!include MUI.nsh<br />
!include Sections.nsh<br />
 <br />
##===========================================================================<br />
## Modern UI Pages<br />
##===========================================================================<br />
 <br />
!insertmacro MUI_PAGE_WELCOME<br />
 <br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE SelectFilesCheck<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE ComponentsLeave<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
 <br />
## This is the title on the first Directory page<br />
!define MUI_DIRECTORYPAGE_TEXT_TOP &quot;$(MUI_DIRECTORYPAGE_TEXT_TOP_A)&quot;<br />
 <br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE SelectFilesA<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
!insertmacro MUI_PAGE_INSTFILES<br />
 <br />
## This is the title on the second Directory page<br />
!define MUI_DIRECTORYPAGE_TEXT_TOP &quot;$(MUI_DIRECTORYPAGE_TEXT_TOP_B)&quot;<br />
 <br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE SelectFilesB<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
!insertmacro MUI_PAGE_INSTFILES<br />
 <br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE DeleteSectionsINI<br />
!insertmacro MUI_PAGE_FINISH<br />
 <br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
 <br />
##===========================================================================<br />
## Language strings<br />
##===========================================================================<br />
 <br />
LangString NoSectionsSelected ${LANG_ENGLSH} &quot;You haven't selected any sections!&quot;<br />
 <br />
LangString MUI_DIRECTORYPAGE_TEXT_TOP_A ${LANG_ENGLSH} &quot;Setup will install \<br />
Program #1 in the following folder...&quot;<br />
LangString MUI_DIRECTORYPAGE_TEXT_TOP_B ${LANG_ENGLSH} &quot;Setup will install \<br />
Program #2 in the following folder...&quot;<br />
 <br />
##===========================================================================<br />
## Start sections<br />
##===========================================================================<br />
 <br />
## Sections Group 1<br />
SectionGroup /e &quot;Program #1&quot; PROG1 <br />
Section &quot;Main&quot; SEC1<br />
 ##All the files in Group 1 will be installed to the same location, $INSTDIR<br />
 SetOutPath &quot;$INSTDIR&quot;<br />
 ## Main files to install here<br />
 <br />
messagebox mb_ok sec1<br />
 <br />
SectionEnd<br />
 <br />
Section &quot;Other&quot; SEC2<br />
 ## Other files to install here<br />
 <br />
messagebox mb_ok sec2<br />
 <br />
SectionEnd<br />
 <br />
SectionGroupEnd<br />
 <br />
## Sections Group 2<br />
SectionGroup /e &quot;Program #2&quot; PROG2<br />
 <br />
Section &quot;Main&quot; SEC3<br />
 ##All the files in Group 2 will be installed to the same location, $INSTDIR<br />
 SetOutPath &quot;$INSTDIR&quot;<br />
 ## Main files to install here<br />
 <br />
messagebox mb_ok sec3<br />
 <br />
SectionEnd<br />
 <br />
Section &quot;Other&quot; SEC4<br />
 ## Other files to install here<br />
 <br />
messagebox mb_ok sec4<br />
 <br />
SectionEnd<br />
 <br />
SectionGroupEnd<br />
 <br />
##===========================================================================<br />
## Settings<br />
##===========================================================================<br />
 <br />
!define PROG1_InstDir    &quot;C:\PROG1&quot;<br />
!define PROG1_StartIndex ${PROG1}<br />
!define PROG1_EndIndex   ${SEC2}<br />
 <br />
!define PROG2_InstDir &quot;C:\PROG2&quot;<br />
!define PROG2_StartIndex ${PROG2}<br />
!define PROG2_EndIndex   ${SEC4}<br />
 <br />
##===========================================================================<br />
## Please don't modify below here unless you're a NSIS 'wiz-kid'<br />
##===========================================================================<br />
 <br />
## Create $PLUGINSDIR<br />
Function .onInit<br />
 InitPluginsDir<br />
FunctionEnd<br />
 <br />
## If user goes back to this page from 1st Directory page<br />
## we need to put the sections back to how they were before<br />
Var IfBack<br />
Function SelectFilesCheck<br />
 StrCmp $IfBack 1 0 NoCheck<br />
  Call ResetFiles<br />
 NoCheck:<br />
FunctionEnd<br />
 <br />
## Also if no sections are selected, warn the user!<br />
Function ComponentsLeave<br />
Push $R0<br />
Push $R1<br />
 <br />
 Call IsPROG1Selected<br />
  Pop $R0<br />
 Call IsPROG2Selected<br />
  Pop $R1<br />
 StrCmp $R0 1 End<br />
 StrCmp $R1 1 End<br />
  Pop $R1<br />
  Pop $R0<br />
 MessageBox MB_OK|MB_ICONEXCLAMATION &quot;$(NoSectionsSelected)&quot;<br />
 Abort<br />
 <br />
End:<br />
Pop $R1<br />
Pop $R0<br />
FunctionEnd<br />
 <br />
Function IsPROG1Selected<br />
Push $R0<br />
Push $R1<br />
 <br />
 StrCpy $R0 ${PROG1_StartIndex} # Group 1 start<br />
 <br />
  Loop:<br />
   IntOp $R0 $R0 + 1<br />
   SectionGetFlags $R0 $R1			# Get section flags<br />
    IntOp $R1 $R1 &amp; ${SF_SELECTED}<br />
    StrCmp $R1 ${SF_SELECTED} 0 +3		# If section is selected, done<br />
     StrCpy $R0 1<br />
     Goto Done<br />
    StrCmp $R0 ${PROG1_EndIndex} 0 Loop<br />
 <br />
 Done:<br />
Pop $R1<br />
Exch $R0<br />
FunctionEnd<br />
 <br />
Function IsPROG2Selected<br />
Push $R0<br />
Push $R1<br />
 <br />
 StrCpy $R0 ${PROG2_StartIndex}    # Group 2 start<br />
 <br />
  Loop:<br />
   IntOp $R0 $R0 + 1<br />
   SectionGetFlags $R0 $R1			# Get section flags<br />
    IntOp $R1 $R1 &amp; ${SF_SELECTED}<br />
    StrCmp $R1 ${SF_SELECTED} 0 +3		# If section is selected, done<br />
     StrCpy $R0 1<br />
     Goto Done<br />
    StrCmp $R0 ${PROG2_EndIndex} 0 Loop<br />
 <br />
 Done:<br />
Pop $R1<br />
Exch $R0<br />
FunctionEnd<br />
 <br />
## Here we are selecting first sections to install<br />
## by unselecting all the others!<br />
Function SelectFilesA<br />
 <br />
 # If user clicks Back now, we will know to reselect Group 2's sections for<br />
 # Components page<br />
 StrCpy $IfBack 1<br />
 <br />
 # We need to save the state of the Group 2 Sections<br />
 # for the next InstFiles page<br />
Push $R0<br />
Push $R1<br />
 <br />
 StrCpy $R0 ${PROG2_StartIndex} # Group 2 start<br />
 <br />
  Loop:<br />
   IntOp $R0 $R0 + 1<br />
   SectionGetFlags $R0 $R1				    # Get section flags<br />
    WriteINIStr &quot;$PLUGINSDIR\sections.ini&quot; Sections $R0 $R1 # Save state<br />
    !insertmacro UnselectSection $R0			    # Then unselect it<br />
    StrCmp $R0 ${PROG2_EndIndex} 0 Loop<br />
 <br />
 # Don't install prog 1?<br />
 Call IsPROG1Selected<br />
 Pop $R0<br />
 StrCmp $R0 1 +4<br />
  Pop $R1<br />
  Pop $R0<br />
  Abort<br />
 <br />
 # Set current $INSTDIR to PROG1_InstDir define<br />
 StrCpy $INSTDIR &quot;${PROG1_InstDir}&quot;<br />
 <br />
Pop $R1<br />
Pop $R0<br />
FunctionEnd<br />
 <br />
## Here we need to unselect all Group 1 sections<br />
## and then re-select those in Group 2 (that the user had selected on<br />
## Components page)<br />
Function SelectFilesB<br />
Push $R0<br />
Push $R1<br />
 <br />
 StrCpy $R0 ${PROG1_StartIndex}    # Group 1 start<br />
 <br />
  Loop:<br />
   IntOp $R0 $R0 + 1<br />
    !insertmacro UnselectSection $R0		# Unselect it<br />
    StrCmp $R0 ${PROG1_EndIndex} 0 Loop<br />
 <br />
 Call ResetFiles<br />
 <br />
 # Don't install prog 2?<br />
 Call IsPROG2Selected<br />
 Pop $R0<br />
 StrCmp $R0 1 +4<br />
  Pop $R1<br />
  Pop $R0<br />
  Abort<br />
 <br />
 # Set current $INSTDIR to PROG2_InstDir define<br />
 StrCpy $INSTDIR &quot;${PROG2_InstDir}&quot;<br />
 <br />
Pop $R1<br />
Pop $R0<br />
FunctionEnd<br />
 <br />
## This will set all sections to how they were on the components page<br />
## originally<br />
Function ResetFiles<br />
Push $R0<br />
Push $R1<br />
 <br />
 StrCpy $R0 ${PROG2_StartIndex}    # Group 2 start<br />
 <br />
  Loop:<br />
   IntOp $R0 $R0 + 1<br />
   ReadINIStr &quot;$R1&quot; &quot;$PLUGINSDIR\sections.ini&quot; Sections $R0 # Get sec flags<br />
    SectionSetFlags $R0 $R1				  # Re-set flags for this sec<br />
    StrCmp $R0 ${PROG2_EndIndex} 0 Loop<br />
 <br />
Pop $R1<br />
Pop $R0<br />
FunctionEnd<br />
 <br />
## Here we are deleting the temp INI file at the end of installation<br />
Function DeleteSectionsINI<br />
 Delete &quot;$PLUGINSDIR\Sections.ini&quot;<br />
 FlushINI &quot;$PLUGINSDIR\Sections.ini&quot;<br />
FunctionEnd<br />
<br />
<br />
<br />
<br />
///////////Snip #2<br />
<br />
Name &quot;Multiple InstFiles&quot;<br />
OutFile &quot;multi-install.exe&quot;<br />
<br />
!include MUI.nsh<br />
!include Sections.nsh<br />
<br />
##===========================================================================<br />
## Modern UI Pages<br />
##===========================================================================<br />
<br />
!insertmacro MUI_PAGE_WELCOME<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE SelectFilesCheck<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE ComponentsLeave<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
<br />
## This is the title on the first Directory page<br />
!define MUI_DIRECTORYPAGE_TEXT_TOP &quot;$(MUI_DIRECTORYPAGE_TEXT_TOP_A)&quot;<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE SelectFilesA<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
## This is the title on the second Directory page<br />
!define MUI_DIRECTORYPAGE_TEXT_TOP &quot;$(MUI_DIRECTORYPAGE_TEXT_TOP_B)&quot;<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE SelectFilesB<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE DeleteSectionsINI<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
##===========================================================================<br />
## Language strings<br />
##===========================================================================<br />
<br />
LangString NoSectionsSelected ${LANG_ENGLSH} &quot;You haven't selected any sections!&quot;<br />
<br />
LangString MUI_DIRECTORYPAGE_TEXT_TOP_A ${LANG_ENGLSH} &quot;Setup will install \<br />
Program #1 in the following folder...&quot;<br />
LangString MUI_DIRECTORYPAGE_TEXT_TOP_B ${LANG_ENGLSH} &quot;Setup will install \<br />
Program #2 in the following folder...&quot;<br />
<br />
##===========================================================================<br />
## Start sections<br />
##===========================================================================<br />
<br />
## Sections Group 1<br />
SectionGroup /e &quot;Program #1&quot; PROG1<br />
Section &quot;Main&quot; SEC1<br />
 ##All the files in Group 1 will be installed to the same location, $INSTDIR<br />
 SetOutPath &quot;$INSTDIR&quot;<br />
 ## Main files to install here<br />
<br />
messagebox mb_ok sec1<br />
<br />
SectionEnd<br />
<br />
;Section &quot;Other&quot; SEC2<br />
 ## Other files to install here<br />
<br />
;messagebox mb_ok sec2<br />
<br />
;SectionEnd<br />
<br />
SectionGroupEnd<br />
<br />
## Sections Group 2<br />
SectionGroup /e &quot;Program #2&quot; PROG2<br />
<br />
Section &quot;Main&quot; SEC3<br />
 ##All the files in Group 2 will be installed to the same location, $INSTDIR<br />
 SetOutPath &quot;$INSTDIR&quot;<br />
 ## Main files to install here<br />
<br />
messagebox mb_ok sec3<br />
<br />
SectionEnd<br />
<br />
;Section &quot;Other&quot; SEC4<br />
 ## Other files to install here<br />
<br />
;messagebox mb_ok sec4<br />
<br />
;SectionEnd<br />
<br />
SectionGroupEnd<br />
<br />
##===========================================================================<br />
## Settings<br />
##===========================================================================<br />
<br />
!define PROG1_InstDir    &quot;C:\PROG1&quot;<br />
!define PROG1_StartIndex ${PROG1}<br />
!define PROG1_EndIndex   ${SEC2}<br />
<br />
!define PROG2_InstDir &quot;C:\PROG2&quot;<br />
!define PROG2_StartIndex ${PROG2}<br />
!define PROG2_EndIndex   ${SEC4}<br />
<br />
##===========================================================================<br />
## Please don't modify below here unless you're a NSIS 'wiz-kid'<br />
##===========================================================================<br />
<br />
## Create $PLUGINSDIR<br />
Function .onInit<br />
 InitPluginsDir<br />
FunctionEnd<br />
<br />
## If user goes back to this page from 1st Directory page<br />
## we need to put the sections back to how they were before<br />
Var IfBack<br />
Function SelectFilesCheck<br />
 StrCmp $IfBack 1 0 NoCheck<br />
  Call ResetFiles<br />
 NoCheck:<br />
FunctionEnd<br />
<br />
## Also if no sections are selected, warn the user!<br />
Function ComponentsLeave<br />
Push $R0<br />
Push $R1<br />
Push $R2<br />
Push $R3<br />
Push $R4<br />
Push $R5<br />
<br />
 Call IsPROG1Selected<br />
  Pop $R0<br />
 Call IsPROG2Selected<br />
  Pop $R1<br />
 Call IsPROG3Selected<br />
  Pop $R2<br />
 Call IsPROG4Selected<br />
  Pop $R3<br />
 Call IsPROG5Selected<br />
  Pop $R4<br />
 Call IsPROG6Selected<br />
  Pop $R5<br />
 StrCmp $R0 1 End<br />
 StrCmp $R1 1 End<br />
 StrCmp $R2 1 End<br />
 StrCmp $R3 1 End<br />
 StrCmp $R4 1 End<br />
 StrCmp $R5 1 End<br />
  Pop $R5<br />
  Pop $R4<br />
  Pop $R3<br />
  Pop $R2<br />
  Pop $R1<br />
  Pop $R0<br />
 MessageBox MB_OK|MB_ICONEXCLAMATION &quot;$(NoSectionsSelected)&quot;<br />
 Abort<br />
<br />
End:<br />
Pop $R5<br />
Pop $R4<br />
Pop $R3<br />
Pop $R2<br />
Pop $R1<br />
Pop $R0<br />
FunctionEnd<br />
;-------------------------------------------------------------------------------<br />
Function IsPROG1Selected<br />
Push $R0<br />
Push $R1<br />
Push $R2<br />
Push $R3<br />
Push $R4<br />
Push $R5<br />
<br />
 StrCpy $R0 ${PROG1_StartIndex} # Group 1 start<br />
<br />
  Loop:<br />
   IntOp $R0 $R0 + 1<br />
   SectionGetFlags $R0 $R1			# Get section flags<br />
    IntOp $R1 $R1 &amp; ${SF_SELECTED}<br />
    StrCmp $R1 ${SF_SELECTED} 0 +3		# If section is selected, done<br />
     StrCpy $R0 1<br />
     Goto Done<br />
    StrCmp $R0 ${PROG1_EndIndex} 0 Loop<br />
<br />
 Done:<br />
Pop $R1<br />
Exch $R0<br />
FunctionEnd<br />
;-----------------------------------------------------------------------------------<br />
Function IsPROG2Selected<br />
Push $R0<br />
Push $R1<br />
<br />
 StrCpy $R0 ${PROG2_StartIndex}    # Group 2 start<br />
<br />
  Loop:<br />
   IntOp $R0 $R0 + 1<br />
   SectionGetFlags $R0 $R1			# Get section flags<br />
    IntOp $R1 $R1 &amp; ${SF_SELECTED}<br />
    StrCmp $R1 ${SF_SELECTED} 0 +3		# If section is selected, done<br />
     StrCpy $R0 1<br />
     Goto Done<br />
    StrCmp $R0 ${PROG2_EndIndex} 0 Loop<br />
<br />
 Done:<br />
Pop $R1<br />
Exch $R0<br />
FunctionEnd<br />
;------------------------------------------------------------------------------------<br />
## Here we are selecting first sections to install<br />
## by unselecting all the others!<br />
Function SelectFilesA<br />
<br />
 # If user clicks Back now, we will know to reselect Group 2's sections for<br />
 # Components page<br />
 StrCpy $IfBack 1<br />
<br />
 # We need to save the state of the Group 2 Sections<br />
 # for the next InstFiles page<br />
Push $R0<br />
Push $R1<br />
<br />
 StrCpy $R0 ${PROG2_StartIndex} # Group 2 start<br />
<br />
  Loop:<br />
   IntOp $R0 $R0 + 1<br />
   SectionGetFlags $R0 $R1				    # Get section flags<br />
    WriteINIStr &quot;$PLUGINSDIR\sections.ini&quot; Sections $R0 $R1 # Save state<br />
    !insertmacro UnselectSection $R0			    # Then unselect it<br />
    StrCmp $R0 ${PROG2_EndIndex} 0 Loop<br />
<br />
 # Don't install prog 1?<br />
 Call IsPROG1Selected<br />
 Pop $R0<br />
 StrCmp $R0 1 +4<br />
  Pop $R1<br />
  Pop $R0<br />
  Abort<br />
<br />
 # Set current $INSTDIR to PROG1_InstDir define<br />
 StrCpy $INSTDIR &quot;${PROG1_InstDir}&quot;<br />
<br />
Pop $R1<br />
Pop $R0<br />
FunctionEnd<br />
<br />
## Here we need to unselect all Group 1 sections<br />
## and then re-select those in Group 2 (that the user had selected on<br />
## Components page)<br />
Function SelectFilesB<br />
Push $R0<br />
Push $R1<br />
<br />
 StrCpy $R0 ${PROG1_StartIndex}    # Group 1 start<br />
<br />
  Loop:<br />
   IntOp $R0 $R0 + 1<br />
    !insertmacro UnselectSection $R0		# Unselect it<br />
    StrCmp $R0 ${PROG1_EndIndex} 0 Loop<br />
<br />
 Call ResetFiles<br />
<br />
 # Don't install prog 2?<br />
 Call IsPROG2Selected<br />
 Pop $R0<br />
 StrCmp $R0 1 +4<br />
  Pop $R1<br />
  Pop $R0<br />
  Abort<br />
<br />
 # Set current $INSTDIR to PROG2_InstDir define<br />
 StrCpy $INSTDIR &quot;${PROG2_InstDir}&quot;<br />
<br />
Pop $R1<br />
Pop $R0<br />
FunctionEnd<br />
<br />
## This will set all sections to how they were on the components page<br />
## originally<br />
Function ResetFiles<br />
Push $R0<br />
Push $R1<br />
<br />
 StrCpy $R0 ${PROG2_StartIndex}    # Group 2 start<br />
<br />
  Loop:<br />
   IntOp $R0 $R0 + 1<br />
   ReadINIStr &quot;$R1&quot; &quot;$PLUGINSDIR\sections.ini&quot; Sections $R0 # Get sec flags<br />
    SectionSetFlags $R0 $R1				  # Re-set flags for this sec<br />
    StrCmp $R0 ${PROG2_EndIndex} 0 Loop<br />
<br />
Pop $R1<br />
Pop $R0<br />
FunctionEnd<br />
<br />
## Here we are deleting the temp INI file at the end of installation<br />
Function DeleteSectionsINI<br />
 Delete &quot;$PLUGINSDIR\Sections.ini&quot;<br />
 FlushINI &quot;$PLUGINSDIR\Sections.ini&quot;<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th December 2007, 14:10</div></div><div class="posttext">So what's the problem?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>