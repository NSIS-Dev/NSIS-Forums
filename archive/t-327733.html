<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" only accept install directory if empty?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  only accept install directory if empty? NSIS Discussion" />
	
	<title> only accept install directory if empty? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  only accept install directory if empty?</div>
<hr />
<div class="pda"><a href="t-327733.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=327733">only accept install directory if empty?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">o___O</div><div class="date">23rd February 2011, 01:14</div></div><div class="posttext">I'm working on creating an installation package for a program in a community I'm in, first time working with NSIS in awhile. I came across the issue that I have a lot of files and so thus I'm using recursive method for File to install the files, but this creates the problem that I can't single out just the installation files during uninstallation. I've looked at a couple of solutions like Advanced Uninstall Log and it might work, but it does have the problem of some performance problems especially if there's a lot of files in the selected installation directory. I was trying to think of something that would be easy to implement primarily to avoid things like if the user decided to install directly to Programs Files or something as the documentation suggests that if a user did so and your script just used RMDir /r to remove it, it could wipe out all their files. So my idea outside of the logging scripts would be to simply check if a directory was empty before installation, and I'd prefer this method anyway, and prevent installation otherwise. I'm just getting into reviewing if something like this was possible but it doesn't appear to be easily done, anyone have any good examples or solutions for doing this? Any tips for how I can manage to safely handle the uninstallation process in my situation?<br />
<br />
BTW, current steps I'm at are trying to find a way to verify if a directory is empty, and finding a way to prevent the installer from advancing passed the directory page (using MUI2) if it's not. I also wonder why NSIS just doesn't have some more stringent safety checks or way of monitoring this built in, it would be extremely useful..<br />
<br />
<br />
Thank you...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">23rd February 2011, 07:20</div></div><div class="posttext">Many ways to do this. A short selection:<br />
1. There shouldn't be much of a performance penalty for using advanced log headers. Just use them.<br />
2. Create a leave function for the DIRECTORY page and do ${IfExists} &quot;$INSTDIR\*.*&quot; abort ${EndIf}<br />
3. Create an (NSIS) exe that lists all filenames in the build directories, then adds 'File ' in front of it etc, at the same time creating the same list with the Delete command. Use !system or !execute to launch that exe during build process. Then !include that exe's output, once in Section, once in unSection.<br />
4. Probably could do the same with a batch file that calls the compiler after building its include lists.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o___O</div><div class="date">24th February 2011, 22:40</div></div><div class="posttext">I ended up using ${DirState} which is included in FileFunc.nsh - doing a simply Leave function to check if it's &quot;Full&quot; or not, if so it Aborts.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>