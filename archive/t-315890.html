<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to delete files with /REBOOTOK and then remove the directory if empty ?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to delete files with /REBOOTOK and then remove the directory if empty ? NSIS Discussion" />
	
	<title> How to delete files with /REBOOTOK and then remove the directory if empty ? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to delete files with /REBOOTOK and then remove the directory if empty ?</div>
<hr />
<div class="pda"><a href="t-315890.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=315890">How to delete files with /REBOOTOK and then remove the directory if empty ?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">madden</div><div class="date">30th December 2009, 15:59</div></div><div class="posttext">Hello<br />
<br />
In my uninstaller I have to remove the installed application from a program group (under my company). That is for all of:<br />
 - directory and files<br />
 - start menu shortcuts and groups<br />
 - registry keys<br />
<br />
That is my files live in<br />
  $PROGRAMFILES\Company\Program Group\Program Name\<br />
the registry keys live in<br />
  HKCU\Software\Company\Program Group\Program Name\<br />
and the Start Menu Shortcuts live in<br />
  $SMPROGRAMS\Company\Program Group\Program Name\<br />
<br />
Now if after I remove my application the program group is left emtpy I want to also delete the program group directory.<br />
If after that the compnay directory (in Program Files) is left emtpy I want to delete that too.<br />
<br />
Problem is I delete files with /REBOOTOK flag so files might be still present even after my Delete instruction. How can I then check if the directory would be left emtpy after reboot, so I can RMDir /REBOOTOK ?<br />
<br />
Thank you,<br />
Timothy Madden</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">31st December 2009, 19:12</div></div><div class="posttext">Well, If I was making that installer, I would do the following<br />
<br />
1.- Uninstaller adds a Registry entry @ RunOnce<br />
2.- Use a tool that would uses this (http://nsis.sourceforge.net/Check_if_dir_is_empty).<br />
3.- You can also check again RmDir (http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.1.8), you can remove the folder if is empty.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">1st January 2010, 18:47</div></div><div class="posttext">madden, look here:<br />
http://nsis.sourceforge.net/Recursively_remove_empty_parent_directories</div></div><hr />


<div class="post"><div class="posttop"><div class="username">madden</div><div class="date">4th January 2010, 16:16</div></div><div class="posttext">I know how to check for emtpy directories and remove them as long as files are not in use. When files are in use and can not be deleted until reboot then the directory is now longer empty, although after reboot it will be !<br />
<br />
How would I put my uninstaller in RunOnce ? What if the user postpones the reboot and immediately re-installs the application ? Then after the reboot the app would be deleted by my RunOnce key !<br />
<br />
Thank you,<br />
Timothy Madden</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">4th January 2010, 16:40</div></div><div class="posttext">Maybe you can avoid having to use /REBOOTOK with something like this:<br />
http://nsis.sourceforge.net/LockedList_plug-in<br />
<br />
It's better to avoid that situation instead of inventing workarounds ;)<br />
<br />
Anyway: If the installer is registered in RunOnce to clean-up the folders after reboot, it still would only delete empty directories, right? Assuming that /REBOOTOK delted files are removed during the boot process before RunOnce applications are started. So if the user did re-install application between uninstall and reboot, nothing bad would happen...<br />
<br />
Or even uglier: Let your installer remove a pending clean-up from RunOnce, if present :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">madden</div><div class="date">4th January 2010, 18:04</div></div><div class="posttext">Excelent plug-in!<br />
Thank you.<br />
<br />
Looking for something like this I used KillProc to check if my executable is running while installing/uninstalling and killing it myself. But of course this would solve only most part of the problem and not all. LockedList is indeed the solution to my /REBOOTOK problem, but I still have the feeling it is possible to run into some system file that can not be so easily installed without /REBOOTOK ...<br />
<br />
Thank you,<br />
Timothy Madden</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>