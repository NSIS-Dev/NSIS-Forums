<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Incorrect Windows Version during Uninstallation, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Incorrect Windows Version during Uninstallation NSIS Discussion" />
	
	<title> Incorrect Windows Version during Uninstallation [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Incorrect Windows Version during Uninstallation</div>
<hr />
<div class="pda"><a href="t-304683.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=304683">Incorrect Windows Version during Uninstallation</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">pillairohit</div><div class="date">27th March 2009, 12:30</div></div><div class="posttext">Hi.<br />
<br />
I have an application that checks for the windows version during its installation &amp; un-installation.<br />
<br />
The logic used for finding the windows version is the same as in Windows_Version_Detection.<br />
<br />
I'm running Windows Vista SP1 and NSIS 2.44.<br />
<br />
During installation phase, the version is being detected correctly. <br />
<br />
However, the same function during un-installation is returning the version as Win XP.<br />
<br />
I even tried the methods used in Version_plug-in and NSIS-OS_plug-in but to no avail.<br />
<br />
I'm stuck @ this issue since quite a few days. I would really appreciate any help in this matter.<br />
<br />
Thanks &amp; regards.<br />
    Rohit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">27th March 2009, 15:46</div></div><div class="posttext">Have you set it to emulate WinXP? (Check the uninstaller.exe properties)<br />
<br />
If not, try using WinVer.nsh</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pillairohit</div><div class="date">31st March 2009, 10:22</div></div><div class="posttext">uninstaller.exe is not emulating XP, if thats what you mean by Compatibility Mode. <br />
Moreover, i'm using Winver.nsh. Its not working in the uninstallation phase.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">2nd April 2009, 11:09</div></div><div class="posttext">Have you tried with simple code?<br />
<br />
!addplugindir &quot;.&quot;<br />
!addincludedir &quot;.&quot;<br />
<br />
RequestExecutionLevel user<br />
<br />
!include &quot;nsDialogs.nsh&quot;<br />
!include &quot;winmessages.nsh&quot;<br />
!include &quot;logiclib.nsh&quot;<br />
<br />
!include &quot;winver.nsh&quot;<br />
<br />
OutFile &quot;test.exe&quot;<br />
<br />
Function .onInit<br />
FunctionEnd<br />
<br />
Section<br />
	${If} ${IsWin95}<br />
	    MessageBox MB_OK &quot;Windows 95&quot;<br />
	${ElseIf} ${IsWin98}<br />
	    MessageBox MB_OK &quot;Windows 98&quot;<br />
	${ElseIf} ${IsWinME}<br />
	    MessageBox MB_OK &quot;Windows ME&quot;<br />
	${ElseIf} ${IsWinNT4}<br />
	    MessageBox MB_OK &quot;Windows NT&quot;<br />
	${ElseIf} ${IsWin2000}<br />
	    MessageBox MB_OK &quot;Windows 2000&quot;<br />
	${ElseIf} ${IsWinXP}<br />
	    MessageBox MB_OK &quot;Windows XP&quot;<br />
	${ElseIf} ${IsWin2003}<br />
	    MessageBox MB_OK &quot;Windows 2003&quot;<br />
	${ElseIf} ${IsWinVista}<br />
	    MessageBox MB_OK &quot;Windows Vista&quot;<br />
	${ElseIf} ${IsWin2008}<br />
	    MessageBox MB_OK &quot;Windows 2008&quot;<br />
	${EndIf}<br />
	WriteUninstaller &quot;$DESKTOP\UninstallerTest.exe&quot;<br />
SectionEnd<br />
<br />
Section &quot;un.&quot;<br />
	${If} ${IsWin95}<br />
	    MessageBox MB_OK &quot;Windows 95&quot;<br />
	${ElseIf} ${IsWin98}<br />
	    MessageBox MB_OK &quot;Windows 98&quot;<br />
	${ElseIf} ${IsWinME}<br />
	    MessageBox MB_OK &quot;Windows ME&quot;<br />
	${ElseIf} ${IsWinNT4}<br />
	    MessageBox MB_OK &quot;Windows NT&quot;<br />
	${ElseIf} ${IsWin2000}<br />
	    MessageBox MB_OK &quot;Windows 2000&quot;<br />
	${ElseIf} ${IsWinXP}<br />
	    MessageBox MB_OK &quot;Windows XP&quot;<br />
	${ElseIf} ${IsWin2003}<br />
	    MessageBox MB_OK &quot;Windows 2003&quot;<br />
	${ElseIf} ${IsWinVista}<br />
	    MessageBox MB_OK &quot;Windows Vista&quot;<br />
	${ElseIf} ${IsWin2008}<br />
	    MessageBox MB_OK &quot;Windows 2008&quot;<br />
	${EndIf}<br />
SectionEnd<br />
<br />
<br />
( okay, not so simple - couldn't find a command to get -just- the windows string out of winver.nsh ? I must be blind.  Anyway, that's what the select/case is for. )</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pillairohit</div><div class="date">8th April 2009, 10:06</div></div><div class="posttext">Hi.<br />
<br />
Thanks for the sample code. The code works on it own. However, when i try to integrate the same code with my script, the un-installer still returns XP as the windows version.<br />
I even tried by calling the sample code by keeping it in a header file, and then calling it from my script.<br />
However, in all cases, the version being returned is XP. <br />
Is there any direction you may be able to point me, to find out what could be reason that my un-installer is still returning the incorrect version.<br />
<br />
Thanks and regards.<br />
   Rohit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">8th April 2009, 11:01</div></div><div class="posttext">haven't the foggiest, I'm afraid.. :\  unless something in your uninstaller is overwriting defines used by WinVer.nsh.<br />
<br />
If you can share the code of the uninstaller, that would be a tremendous help.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>