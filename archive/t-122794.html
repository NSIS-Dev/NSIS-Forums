<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS in multiuser env (XP/NT), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS in multiuser env (XP/NT) NSIS Discussion" />
	
	<title> NSIS in multiuser env (XP/NT) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS in multiuser env (XP/NT)</div>
<hr />
<div class="pda"><a href="t-122794.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=122794">NSIS in multiuser env (XP/NT)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">claudio</div><div class="date">25th January 2003, 22:15</div></div><div class="posttext">I am a newbie, so I am sorry for theese 2 stupid questions.<br />
<br />
1. What really does the &quot;XPStyle&quot; tag?<br />
<br />
2. I have the following script:<br />
<br />
<br />
[...]<br />
<br />
; The default installation directory<br />
InstallDir $PROGRAMFILES\xxxxxxxx<br />
<br />
; Registry key <br />
InstallDirRegKey HKLM SOFTWARE\xxxxxxxx &quot;Install_Dir&quot;<br />
<br />
[...]<br />
<br />
<br />
  ; Set output path to the installation directory.<br />
  SetOutPath $INSTDIR<br />
<br />
  ; Put file there<br />
  file &quot;qqqqqqqq&quot;<br />
  file &quot;wwwwwwww&quot;<br />
  file &quot;eeeeeeee&quot;<br />
<br />
  ; Write the installation path into the registry<br />
  WriteRegStr HKLM SOFTWARE\xxxxxxxx &quot;Install_Dir&quot; &quot;$INSTDIR&quot;<br />
<br />
  ; Write the uninstall keys for Windows<br />
  WriteRegStr HKLM \<br />
&quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\xxxxxxxx&quot; \<br />
&quot;DisplayName&quot; &quot;xxxxxxxx&quot;<br />
  WriteRegStr HKLM \<br />
&quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\xxxxxxxx&quot; \<br />
&quot;UninstallString&quot; '&quot;$INSTDIR\uninstall.exe&quot;'<br />
  WriteUninstaller &quot;uninstall.exe&quot;<br />
<br />
  ;  menu<br />
  SetOutPath $INSTDIR    <br />
  CreateDirectory &quot;$SMPROGRAMS\xxxxxxxx&quot;<br />
  CreateShortCut &quot;$SMPROGRAMS\xxxxxxxx\xxxxxxxx.lnk&quot; \<br />
&quot;$INSTDIR\xxxxxxxx.EXE&quot;<br />
  CreateShortCut &quot;$SMPROGRAMS\xxxxxxxx\Help and Docs.lnk&quot; \<br />
&quot;$INSTDIR\xxxxxxxx.HTM&quot;<br />
<br />
  ;  shortcut<br />
  SetOutPath $INSTDIR  <br />
  CreateShortCut &quot;$DESKTOP\title.lnk&quot; &quot;$INSTDIR\xxxxxxxx.exe&quot;<br />
  CreateShortCut &quot;$SMSTARTUP\title.lnk&quot; &quot;$INSTDIR\xxxxxxxx.exe&quot;<br />
  CreateShortCut &quot;$QUICKLAUNCH\title.lnk&quot; &quot;$INSTDIR\xxxxxxxx.exe&quot;<br />
<br />
SectionEnd<br />
<br />
The script put a shortcut in the desktop, in the startup folder and into the<br />
quick launch. Works fine in a single user enviroment, like w95/w98 and ME.<br />
<br />
How I can do the same shortcuts in a multiuser enviroment like XP and W2K?<br />
<br />
I understood I should use &quot;SetShellVarContext&quot; but the way it is not <br />
so clear in my reading the docs.<br />
<br />
Thanks for any help</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">26th January 2003, 03:25</div></div><div class="posttext">Ok, about your questions:<br />
<br />
1. XPStyle is when you installer ran into a XP OS, get the current XP theme from the end-user... XPStyle on/off<br />
<br />
2.- I don't know about the shorcuts from all users for XP, but read the manual in ${NSISDIR}\Docs ... It explains all about that...<br />
<br />
Good luck :up: :p</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th January 2003, 08:39</div></div><div class="posttext">SetShellVarContext sets an installer flag (at runtime) which tells the installer wheather to get the current user's folder, or all users' folder. It affects the values of $SMPROGRAMS, $SMSTARTUP, $DESKTOP, $STARTMENU and $QUICKLAUNCH.<br />
<br />
Try this little piece of code on Windows NT/2000/XP:<br />
<br />
SetShellVarContext current #the default<br />
StrCpy $0 $SMPROGRAMS<br />
SetShellVarContext all<br />
StrCpy $1 $SMPROGRAMS<br />
MessageBox MB_OK &quot;$0$\r$\n$1&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">26th January 2003, 09:15</div></div><div class="posttext">No question is stupid, since you don't know the answer and we're glad to help you.<br />
But could you leave the filenames and such in the script? It would make reading it a lot easier. If it's a long script, you can attach it to the post instead of pasting all the code in it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">claudio</div><div class="date">27th January 2003, 13:34</div></div><div class="posttext">tanks to all people for the help</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mike7373</div><div class="date">20th April 2003, 08:30</div></div><div class="posttext">kichik, your code is great! Thanks!<br />
<br />
What about folder permissions and registering DLLs to all users on XP/2000?<br />
<br />
I have an app the creates files in its own folder, and I get file access errors if I switch users on Win 2K server.  I believe this is because the folders creadted during the installation only grant access to the person installing.  Is there any way to set permissions to Everyone when installing?<br />
<br />
I also have problems with DLLs.  Is there a way to register a DLL to all users?  When I switch users and run my app, I get the infamous &quot;MS Office trying to install crap...&quot; dialog, which is quite odd, since my app has NOTHING to do with Office whatsoever.<br />
<br />
You guys are great!  Any help is appreciated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">20th April 2003, 10:11</div></div><div class="posttext">I don't know about the folder permissions, but as far as I know, registered DLL's are always available for all users.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mike7373</div><div class="date">20th April 2003, 12:39</div></div><div class="posttext">WOW, thanks for the quick reply!<br />
<br />
Maybe it's the folder permission (security) that is denying access to the DLL then.  Is that possible?<br />
<br />
For example, user Bob installs a program which contains activex DLLs in the app path. Only Bob has full access to the app path, according to the security/permission settings on the folder. Later, user John logs in and tries to run the program.  Does Windows deny access to the DLLs since he doesn't have full permissions in the app's folder?<br />
<br />
Thanks again</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th April 2003, 16:56</div></div><div class="posttext">There is a new plug-in in the Archive that sets access controls. Give it a shot:<br />
http://nsis.sourceforge.net/archive/viewpage.php?pageid=212<br />
<br />
As far as I know you need to be logged on as an adminstrator user to register DLLs for all users.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mike7373</div><div class="date">22nd April 2003, 20:26</div></div><div class="posttext">The AccessControl.dll was just what I needed.<br />
<br />
You guys totally rock and NSIS lives up to its name of not sucking!<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mike7373</div><div class="date">2nd May 2003, 08:12</div></div><div class="posttext">Hi kichik-<br />
<br />
I have two testers running XP.  The AccessControl.dll worked great on one computer, but the other got the following error:<br />
<br />
Cannot build new access controllist. Error code: 1332<br />
<br />
Any ideas?  Or maybe tbf can help, if he's listening.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">krisbg</div><div class="date">4th February 2004, 11:39</div></div><div class="posttext">Hi there!<br />
I have the following problem: I want to install to all users so I use:<br />
	SetShellVarContext all<br />
at the very beginning of my first install and uninstall sections inside which I copy the shortcuts. The problem is that when I install the product under one windows user which has administrator rights, and then I log as another windows user, the quick launch icon is not present (but all other icons are there...).<br />
Any idea why is it happening and how to fix it?<br />
<br />
I create the shortcuts with CreateShortCut after I use SetShellVarContext all...<br />
Thanks in advance!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th February 2004, 13:34</div></div><div class="posttext">The quick launch bar doesn't have an all users folder.<br />
<br />
mike7373, I have no idea. I would have suggseted you contact the author of the plug-in, but many have already tried and failed :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">krisbg</div><div class="date">4th February 2004, 14:23</div></div><div class="posttext">Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JoeAcunzo</div><div class="date">21st January 2005, 21:50</div></div><div class="posttext">Hi mike7373,<br />
<br />
I also have some users of my install reporting this error with this AccessControl plugin - &quot;Cannot build new access control list Error Code 1332 Error code: 1332&quot;.<br />
<br />
Did you ever solve the problem?<br />
<br />
Joe A.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JoeAcunzo</div><div class="date">21st January 2005, 22:24</div></div><div class="posttext">I found the problem.  I was using the Windows group &quot;Users&quot;, and the customers having trouble where not using the English version of Windows, thus this group is NOT called &quot;Users&quot;.  The solution is to use the SID, in my case &quot;(S-1-5-32-545)&quot; for the &quot;Users&quot; group.<br />
<br />
Joe A.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">krisbg</div><div class="date">7th February 2005, 14:22</div></div><div class="posttext">Hello again!<br />
Now I have a problem with win98. I run the installer and install to all users (is it possible at all with win 98?) so the installer runs ok. Then when I uninstall, the shortcut on the desktop remains there. I put a message box to see what is the value of $DESKTOP variable so during the installation time it was: &quot;c:\windows\all users\desktop&quot; while during the uninstallation it was: &quot;c:\windows\desktop&quot;. So what am I supposed to do? I'm thinking about checking during install time if the OS is win95/98 and forcing it to run only for the current user or the other solution: during uninstall time to check again for win 95/98 and to delete &quot;manually&quot; the shortcut from &quot;windwos\all users\desktop&quot; but I think both methods are a &quot;patcher's&quot; methods (especially the second one) and I wonder if there is a better one?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th February 2005, 19:45</div></div><div class="posttext">krisbg, see:<br />
<br />
http://sourceforge.net/tracker/index.php?func=detail&amp;aid=1008632&amp;group_id=22049&amp;atid=373085<br />
<br />
Please open new threads instead of appending to unrelated threads.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">krisbg</div><div class="date">15th February 2005, 17:51</div></div><div class="posttext">sorry, i thought it was connected to this topic! and 10x for the reply!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>