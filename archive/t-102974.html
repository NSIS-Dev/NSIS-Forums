<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem with SetShellVarContext (1.98), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem with SetShellVarContext (1.98) NSIS Discussion" />
	
	<title> Problem with SetShellVarContext (1.98) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem with SetShellVarContext (1.98)</div>
<hr />
<div class="pda"><a href="t-102974.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=102974">Problem with SetShellVarContext (1.98)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Lactobacillus</div><div class="date">1st September 2002, 10:37</div></div><div class="posttext">Hello,<br />
<br />
SetShellVarContext all<br />
CreateDirectory &quot;$SMPROGRAMS\Der Clou! Win32&quot;creates for me C:\Windows\Temp\Der Clou! Win32 on Windows 98 (it works fine on XP), isn't SetShellVarContext supposed to fall back to the local directory if the global one doesn't exist?<br />
<br />
Thanks!<br />
Lactobacillus</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">1st September 2002, 11:51</div></div><div class="posttext">I've just had a look at the latest 2.0a7 code (I'll check 1.98 in a minute and post back here) and if SetShellVarContext is set to current it will ignore the first seven characters of the folder name it is looking for when matching in the registry. This has the effect of taking a name like &quot;Common Start Menu&quot; and matching instead &quot;Start Menu&quot; (I say this so that you can check if this mechanism wouldn't work based on your registry content, it looks under HKEY_LOCAL_MACHINE at Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders).<br />
<br />
If SetShellVarContext is set to all it and it cannot find the desired folder under that key in the registry it will try current mode. If that also fails it will fall back to your $TEMP directory.<br />
<br />
In 1.98 the intent of the code seems to be the same, there is a slight optimisation in 2.0a7 over 1.98 but the logic is identical.<br />
<br />
Therefore I have to conclude that either your registry strings under that key in the registry are not what the developers expected, or else the code is working perfectly and is falling back to the last option, the $TEMP dir (or there is a bug in the code relating to the value of $SMPROGRAMS.. I don't have time to investigate that far but I'm sure KiCHiK will amaze us when he answers :D - no pressure KiCHiK :P)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st September 2002, 12:00</div></div><div class="posttext">This a bug with 1.98. It has been fixed in one of the 2.0aX version. Download the latest 2.0a7 and it should work.<br />
<br />
Or, if you wish to still use 1.98 you can change Source\exehead\util.c. Function queryShellFolders, where it says myRegGetStr(f?HKEY_LOCAL_MACH... just change g_all_user_var_flag to f and recompile. I don't know the exact line number because I don't have the source code of 1.98 infront of me, but if this is an option for you (you have a compiler), I can look it up for you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">1st September 2002, 12:01</div></div><div class="posttext">Doh! That wasn't an amazing reply KiCHiK :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st September 2002, 12:04</div></div><div class="posttext">Thank you, thank you. I am here all night :D I really am... :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">1st September 2002, 12:18</div></div><div class="posttext">Ahha I see KiCHiK - I missed that blasted first ?: test against g_all_user_var_flag. I'll build a new 1.98 for Lactobacillus and post the url to it here.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st September 2002, 12:22</div></div><div class="posttext">Yes, those g_all_user_var_flag are slippery aren't they? :D<br />
I am sure he will find your compiled version very useful :up:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">1st September 2002, 12:24</div></div><div class="posttext">Download a 1.98 build of makensis.exe that contains the fix mentioned by KiCHiK - this is built by me, it is *not* official in anyway. <br />
http://www.clantpa.co.uk/nsis/hosted/makensis198withssvcfix.exe<br />
<br />
or a zipped version (of just the exe) is here (http://www.clantpa.co.uk/nsis/hosted/makensis198withssvcfix.zip)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Lactobacillus</div><div class="date">1st September 2002, 12:39</div></div><div class="posttext">You guys are posing so fast, when I finished compiling NSIS I saw that Sunjammer provided a download of the fixed version ;)<br />
<br />
However: Thanks a lot! I am looking forward to switch to the latest 2.0x code once it's out of alpha/beta state.<br />
<br />
Lactobacillus</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>