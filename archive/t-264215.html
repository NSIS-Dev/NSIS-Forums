<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Uninstaller taking out system files, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Uninstaller taking out system files NSIS Discussion" />
	
	<title> Uninstaller taking out system files [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Uninstaller taking out system files</div>
<hr />
<div class="pda"><a href="t-264215.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=264215">Uninstaller taking out system files</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">tcfred</div><div class="date">23rd January 2007, 15:16</div></div><div class="posttext">The two files comdlg32.ocx and msstdfmt.dll are required for VB6 and also are in the deployment package for my prog.<br />
Thanks to the Nuttall VB6 to NIS Converter, I am as far as I am but these two files are not being incremented on install apparantly.  <br />
<br />
in the install section.....<br />
ReadRegDWord $Version HKLM &quot;Software\VBGenerator\Pgm&quot; Version<br />
IfErrors new_installation      &lt;errors? why not 0&gt;<br />
StrCpy $ISeeIt 1<br />
new_installation....<br />
!insertmacro InstallLib REGDLL $ISeeIt REBOOT_PROTECTED \<br />
&quot;Support\COMDLG32.OCX&quot; &quot;$SysDir\COMDLG32.OCX&quot; &quot;$SysDir&quot;<br />
..and for MSSTDFMT.DLL<br />
<br />
then in the Uninstall section....<br />
!insertmacro UnInstallLib REGDLL SHARED REBOOT_PROTECTED &quot;$SysDir\COMDLG32.OCX&quot;<br />
..and for MSSTDFMT.DLL<br />
<br />
The removal details show the DLL and OCX each being unregistered and then deleted.<br />
<br />
A leg up on this will be greatly appreciated.<br />
tcfred</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">23rd January 2007, 15:24</div></div><div class="posttext">Do you properly delete that registry key in the uninstaller? If it stays there, future installers will not increment the share count because they'd think an installer for an older version has already done so for them.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tcfred</div><div class="date">23rd January 2007, 18:52</div></div><div class="posttext">The uninstall registry folder was in fact intact after the uninstallation process.  Should the Uninstaller section have this line added? <br />
 DeleteRegKey HKLM &quot;Software\\Micr...\Uninstall\MyProg&quot;<br />
...to get rid of the folder that remains?<br />
There is also a curious line in the UnInstall details window &quot;Could not find symbol: DllUnregisterServer.  <br />
<br />
tcfred</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">23rd January 2007, 19:01</div></div><div class="posttext">Yes, you must use DeleteRegKey in the uninstaller.<br />
<br />
The DllUnregisterServer line means you've tried to unregister a DLL that doesn't require registration.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tcfred</div><div class="date">23rd January 2007, 19:11</div></div><div class="posttext">Outstanding.  I will fix it up tonight.  Thank you for your kind assist.<br />
<br />
tcfred</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tcfred</div><div class="date">24th January 2007, 06:07</div></div><div class="posttext">I ran Uninstaller from Add/Remove<br />
MSSTDFMT.DLL, COMDLG32.OCX were again removed from System32 folder.<br />
<br />
Add/Remove entry is eliminated. OK<br />
Registery folders properly removed.<br />
StartMenu /MyProg folder is still present but is empty.<br />
Program Files /MyProg folder contains only uninstaller. <br />
_____________<br />
Reboot<br />
StartMenu folder still there &amp; empty<br />
Program Files/MyProg folder still there with uninstaller.<br />
_____________<br />
I can't see anything in the code that would cause the 2 files to get removed but I am assuming that the installmacros would increment the file count for the 2 DLLs.  Could it be that my problem is really with the VB6 Service Pack 6 installation that I am doing to replace the 2 files, and this is not incrementing the related registry from 0 to 1 so when I remove my program, the system thinks that my prog is the only one using them?  <br />
<br />
My script is attached if you could see anything else or can see why the SM folder and Program File folder/ uninstaller are not deleting.<br />
<br />
I'm getting this gradually.  <br />
<br />
tcfred</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">24th January 2007, 06:15</div></div><div class="posttext">StartMenu folder still there &amp; empty<br />
Program Files/MyProg folder still there with uninstaller.Did you add at the bottom of uninstall section, <br />
RmDir &quot;$SMPROGRAMS\Myprog&quot;<br />
Delete &quot;$INSTDIR\unistaller.exe&quot;<br />
RmDir &quot;$INSTDIR&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th January 2007, 09:22</div></div><div class="posttext">tcfred, it's probably because previous uninstallers have already eliminated the reference count for those files. After installing your application again, manually increment the reference count. Then, when you uninstall, the files won't be removed because the reference count won't yet be zero.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>