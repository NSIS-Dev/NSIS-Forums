<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" The Custom Page Leave Function, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  The Custom Page Leave Function NSIS Discussion" />
	
	<title> The Custom Page Leave Function [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  The Custom Page Leave Function</div>
<hr />
<div class="pda"><a href="t-270867.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=270867">The Custom Page Leave Function</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">kgobel</div><div class="date">8th May 2007, 22:53</div></div><div class="posttext">Hello,<br />
I have a product key verification in my custom page leave function....which works great....unless the end user tries to exit the installer...it will give an invalid serial key message to the user and not let them exit.<br />
<br />
Is there a way to determine if the user pushed the next button, or the Close/Cancel button?  If so how?<br />
<br />
Thanks<br />
Kyle</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">9th May 2007, 05:04</div></div><div class="posttext">Sounds like error leave function, a code snippet would be helpful.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kgobel</div><div class="date">9th May 2007, 09:36</div></div><div class="posttext">Sure,<br />
This is my page leave function <br />
<br />
Function RegLeave<br />
;Grab the Registration ID user entered in textbox<br />
ReadINIStr ${varInput} &quot;$PLUGINSDIR\REG.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
<br />
;Check the web to see if the code is good<br />
InetLoad::load /post &quot;code=${varInput}&quot; &quot;http://www.metroeguide.net/registration/Registration.aspx&quot; &quot;reg.htm&quot; /slient &quot;&quot;<br />
;load the contents of the downloaded file into the var $3<br />
FileOpen $2 &quot;reg.htm&quot; &quot;r&quot;<br />
FileRead $2 $3<br />
FileClose $2<br />
<br />
${If} $3 == 'INVALID'<br />
MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Invalid Product Key&quot;<br />
Abort<br />
${EndIf}<br />
<br />
${If} $3 == 'TOOMANY'<br />
MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Product Key used too many times.  Please call 800-405-2100&quot;<br />
Abort<br />
${EndIf}<br />
<br />
${If} $3 == 'SUCCESS'<br />
goto serialOK<br />
${EndIf}<br />
<br />
<br />
serialOK:<br />
FunctionEnd<br />
<br />
The webpage that is the Registration ID is posted to returns 1 of 3 things....either 'INVALID' if no key is entered, or it's an incorrect registration key...'TOOMANY' if the key has been used more than 3 times, and 'SUCCESS' if the key is good.  When the user hits the close button...the function I think is run, and it POSTs to the website, which returns INVALID (no key entered)..and doesn't let the installer exit.<br />
<br />
The way I see it is, the installer is actually doing nothing wrong...It sees it's about to leave the page (when the user presses cancel) so it runs the function...the registration page (the asp page) obviously returns INVALID key....I'm not sure how to really get around it, unless somehow I could tell if the user tried to close the application, or press the next button</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">9th May 2007, 10:47</div></div><div class="posttext">Next button is 0, e.g. ReadINIStr $0 &quot;$PLUGINSDIR\test.ini&quot; &quot;Settings&quot; &quot;State&quot;<br />
You may want to take a look at included example testnotify.nsi</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kgobel</div><div class="date">9th May 2007, 11:17</div></div><div class="posttext">Thank you very much Red Wine for your quick replys.<br />
<br />
It seems...the Back button, the Install button, and the Cancel button....are all 0's...I did a <br />
<br />
ReadINIStr $0 &quot;$PLUGINSDIR\REG.ini&quot; &quot;Settings&quot; &quot;State&quot;<br />
MessageBox MB_OK $0<br />
<br />
and all the buttons returned 0, I believe they are all 0 because none of them are defined in my REG.ini.<br />
<br />
I also tried disabling the Install Button, (infact tried to disable every button) with no luck...<br />
I tried <br />
<br />
GetDlgItem $1 $HWNDPARENT 1<br />
EnableWindow $1 0<br />
<br />
from ID 1 to about 10, it seems to have no effect.<br />
I am using the ExperienceUI...could this be a problem?<br />
<br />
Any other Ideas?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">9th May 2007, 11:25</div></div><div class="posttext">How do you know that they are all 0? The Leave function is only executed when you click Next (unless this is not the case in ExperienceUI)!<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kgobel</div><div class="date">9th May 2007, 11:38</div></div><div class="posttext">Good to hear from you Stu!<br />
<br />
I think I must have another problem them...my Leave Function seems to be executing when I press the Back...The Install...and the Cancel button...<br />
<br />
<br />
I guess that only happens when I have this in my script<br />
<br />
  !define XPUI_ABORTWARNING<br />
<br />
I suppose it will be fine without it, but it is kindof nice to give the user a chance to 'not cancel' the installation...Do you know of a way I can have the Abort Warning enabled, without the leave function executing everytime a button is clicked?<br />
<br />
<br />
Thanks again for your reply</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">9th May 2007, 11:58</div></div><div class="posttext">I suspect this is a specific bug of XPUI,<br />
do you mind give a try to your entire script with MUI?<br />
I guess would be nice for all of us to know about.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">9th May 2007, 23:51</div></div><div class="posttext">I think what makes XPUI a bit unique is the way it handles aborts.<br />
<br />
From the XPUI docs, when XPUI_ABORTWARNING should be set with a value of either TRUE or FALSE.  (The default is false).<br />
<br />
Also if you've defined an abort page, you may find this helpful (also from XPUI docs):<br />
<br />
If you have an Abort Page in your installer, you may want to use an automatic abort warning in order to make the Abort page trigger properly. If you aren't using the ExperienceUI's built-in abort warning system, you can insert the following function to properly invoke the Abort page.<br />
<br />
Function .onUserAbort<br />
  StrCmp $NOABORTWARNING 1 CloseMe<br />
  MessageBox MB_YESNO|MB_ICONQUESTION &quot;Are you sure you want to cancel Setup?&quot; IDNO NoAbort<br />
  # any custom code you want before the Abort page is called here...<br />
  !insertmacro XPUI_USERABORT<br />
  NoAbort:<br />
  Abort<br />
  CloseMe:<br />
  # any custom code you want before the installer exits here...<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>