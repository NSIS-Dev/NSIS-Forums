<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to detect a file is locked when deleting a file, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to detect a file is locked when deleting a file NSIS Discussion" />
	
	<title> How to detect a file is locked when deleting a file [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to detect a file is locked when deleting a file</div>
<hr />
<div class="pda"><a href="t-268664.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=268664">How to detect a file is locked when deleting a file</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">JamesKiller</div><div class="date">30th March 2007, 19:28</div></div><div class="posttext">Hi All,<br />
<br />
When I try to delete a file during the uninstallation, just like some .dll, .exe files. If they are still in use or rights issues, I couldn't delete them.<br />
When trying to overwrite the files, i couldn't overwrite them?<br />
how can I detect them? and how to solve?<br />
Any thoughts?<br />
<br />
<br />
James</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th March 2007, 20:09</div></div><div class="posttext">Use the Library macros.<br />
<br />
http://nsis.sourceforge.net/Docs/AppendixB.html</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JamesKiller</div><div class="date">30th March 2007, 22:13</div></div><div class="posttext">coulde you give me an example????<br />
Thank you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th March 2007, 22:17</div></div><div class="posttext">That page contains examples.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JamesKiller</div><div class="date">30th March 2007, 22:42</div></div><div class="posttext">IfFileExists &quot;$INSTDIR\MyApp.exe&quot; 0 new_installation ;Replace MyApp.exe with your application filename<br />
   StrCpy $ALREADY_INSTALLED 1<br />
 new_installation:<br />
<br />
 !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_NOTPROTECTED dllname.dll $SYSDIR\dllname.dll $SYSDIR<br />
hmmmm<br />
if i have 20 files, i should write them like above 20 times?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th March 2007, 22:47</div></div><div class="posttext">If your DLL files are not shared, there is no need for anything but the InstallLib macro. Instead of $ALREADY_INSTALLED, use NOTSHARED. If they are shared, do the test just once, keep the value in $ALREADY_INSTALLED and just add more InstallLib lines.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JamesKiller</div><div class="date">30th March 2007, 23:18</div></div><div class="posttext">If a file is locked, how can i get the error message?<br />
If the istaller has error, how can I display error message, I mean NSIS error message..<br />
Iferrors 0<br />
MessageBox MB_OK error_message(NSIS message,not my own message)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JamesKiller</div><div class="date">30th March 2007, 23:21</div></div><div class="posttext">-------------------<br />
on the link you gave to me, it says it can:<br />
***<br />
Windows File Protection checks<br />
***<br />
How to checks, if file protected, how can show message?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th March 2007, 23:21</div></div><div class="posttext">If a file is locked the error flag will be set and, if you've enabled reboot, the reboot flag will also be set. There's no message, just a state of failure to delete or replace the file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th March 2007, 23:22</div></div><div class="posttext">Files installed by your application are most probably not protected. Only system files are protected by WFP.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JamesKiller</div><div class="date">30th March 2007, 23:47</div></div><div class="posttext">when I run in windows mode (not silent mode, it will show the file is in use. However, run in silent mode . it won't show the error message.....<br />
I am expecting the error message in the silent mode.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th March 2007, 23:59</div></div><div class="posttext">What error message? The Library macros show no error message. if you're talking about the normal error message for when a file can't be overwritten, then on silent mode it takes the default action of skipping the file or aborting if AllowSkipFiles is set to off.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JamesKiller</div><div class="date">31st March 2007, 00:10</div></div><div class="posttext">Yeah. You are right.<br />
The error message is like &quot; Error opening file for writing:<br />
c:\myapp.dll .....&quot;<br />
Can I get this error message in silent mode. If I can't, can I set an error flag for this copying file error?<br />
<br />
Thank you for your help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JamesKiller</div><div class="date">31st March 2007, 00:12</div></div><div class="posttext">Or before getting this error message, can I pop up an message like &quot;myApp.dll is in use, can't copy this file!&quot;, then I can exit the installer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st March 2007, 10:01</div></div><div class="posttext">The error flag is already set when this message appears. You can try deleting the file and checking the error flag to avoid this message on non-silent mode.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JamesKiller</div><div class="date">31st March 2007, 18:46</div></div><div class="posttext">How can set the error flag? which error flag?<br />
<br />
Thank you....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">31st March 2007, 19:13</div></div><div class="posttext">clearerrors<br />
delete &quot;file.bla&quot;<br />
iferrors error_routine<br />
;no errors<br />
<br />
;error<br />
error_routine:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">31st March 2007, 19:23</div></div><div class="posttext">Regarding to the uninstaller, if you're using MUI, you may add the MUI_UNPAGE_FINISH and for every suspected delete instruction, add the switch /REBOOTOK.<br />
If file(s) failed to delete, the finish page should appear with reboot checkboxes.<br />
Without MUI_UNPAGE_FINISH you may check in function un.onUninstSuccess the reboot flag (IfRebootFlag), and if is set pop up a message about.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">31st March 2007, 21:24</div></div><div class="posttext">From experience - reboots are not necessary in most cases.<br />
it only need some brain and an idea to replace/rename<br />
files. the reboot only do the cleanup.<br />
- push the filename<br />
- call replacing routine:<br />
<br />
-- delete file -&gt; on success return<br />
-- unregister file <br />
-- delete file -&gt; on success return<br />
-- rename file<br />
-- delete renamed file -&gt; on success return<br />
-- delete renamed file on reboot<br />
-- return<br />
<br />
- copy new file<br />
- reset reboot flag (we dont really need it)<br />
<br />
normally user dont work on windows system files so that a reboot is a must</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JamesKiller</div><div class="date">1st April 2007, 03:56</div></div><div class="posttext">Thank you all for help. I will test it up. Hopefully, i can fix the bug we have.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">3rd April 2007, 10:30</div></div><div class="posttext">Wrote: &quot;Can I get this error message in silent mode.&quot;??<br />
<br />
&quot;silent&quot; = no UI interaction nothing displayed only error(result codes)<br />
<br />
&quot;un-attended&quot;= Display of progress but no UI interaction<br />
<br />
&quot;regular&quot;= UI interaction and Display of progress</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>