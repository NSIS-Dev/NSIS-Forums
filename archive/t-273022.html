<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problems with SQL Server Express in installation, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problems with SQL Server Express in installation NSIS Discussion" />
	
	<title> Problems with SQL Server Express in installation [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problems with SQL Server Express in installation</div>
<hr />
<div class="pda"><a href="t-273022.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=273022">Problems with SQL Server Express in installation</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">trust11</div><div class="date">18th June 2007, 14:40</div></div><div class="posttext">Hi all: <br />
Im new in all this and i dont know how can i do this.<br />
im trying to install SQL Server and restore a database with problems.  <br />
First of all i install the version 2.0 of Compact Framework:<br />
<br />
SetOverwrite on <br />
SetOutPath &quot;$INSTDIR&quot; <br />
File &quot;dotnetfx.exe&quot; <br />
ExecWait '$INSTDIR\dotnetfx.exe /Q /C:&quot;install.exe /noaspupgrade /q&quot;' <br />
<br />
Then i install the SQL Server Express:<br />
<br />
File &quot;SQLEXPR_ESN.EXE&quot; <br />
ExecWait '$INSTDIR\SQLEXPR.EXE /qb ADDLOCAL=ALL INSTANCENAME=MSSQLSERVER SECURITYMODE=SQL SAPWD=onix SQLAUTOSTART=1 DISABLENETWORKPROTOCOLS=0' <br />
<br />
And after this i try to restore the database: <br />
<br />
nsExec::Exec osql -E -Q &quot;RESTORE FILELISTONLY FROM DISK = '$INSTDIR\BD.bak'&quot; <br />
nsExec::Exec osql -E -Q &quot;restore database BD from disk='$INSTDIR\BD.bak' WITH NORECOVERY, MOVE 'BD' TO 'C:\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\Data\BD.MDF', MOVE 'BD_Log' TO 'C:\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\Data\BD_Log.LDF'&quot; <br />
<br />
I think that im installing the first two things OK but it doesnt restore the database. <br />
Can you help me please????</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">18th June 2007, 14:45</div></div><div class="posttext">Try to reading here (http://www.winamp-es.com/foros/viewtopic.php?t=3959) first and if doesn't help I'm sure here are people that know more :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">trust11</div><div class="date">18th June 2007, 14:52</div></div><div class="posttext">Sorry about it :( <br />
There few people help and i thought that here maybe someone could help me.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgiusto</div><div class="date">18th June 2007, 15:11</div></div><div class="posttext">Are you sure that sql express installs OSQL? the new command line interface is sqlcmd.<br />
You can also try to use the MSSQL plugin. You find it at the plugins page on official nsis site.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">trust11</div><div class="date">18th June 2007, 16:05</div></div><div class="posttext">Hi sgiusto:<br />
Im trying the MSSQL plugin but i cant get it working. This is the code im using. <br />
Do you know what im doing bad?<br />
<br />
MSSQL_OLEDB::SQL_Logon /NOUNLOAD &quot;&quot;(local)\MSSQLSERVER&quot; &quot;sa&quot; &quot;onix&quot;<br />
MSSQL_OLEDB::SQL_Execute /NOUNLOAD &quot;RESTORE FILELISTONLY FROM DISK = '$INSTDIR\BD.bak'&quot;<br />
MSSQL_OLEDB::SQL_Execute /NOUNLOAD &quot;restore database BD from disk='$INSTDIR\BD.bak' WITH NORECOVERY, MOVE 'BD' TO 'C:\Archivos de programa\Microsoft SQL Server\MSSQL.1\MSSQL\Data\BD.mdf', MOVE 'BD_Log' TO 'C:\Archivos de programa\Microsoft SQL Server\MSSQL.1\MSSQL\Data\BD_Log.ldf'&quot;<br />
MSSQL_OLEDB::SQL_Logout</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">18th June 2007, 17:46</div></div><div class="posttext">MSSQL_OLEDB::SQL_Logon /NOUNLOAD &quot;&quot;(local)\MSSQLSERVER&quot; &quot;sa&quot; &quot;onix&quot;<br />
<br />
You have an additional quote at the begining</div></div><hr />


<div class="post"><div class="posttop"><div class="username">chivalri</div><div class="date">18th June 2007, 20:24</div></div><div class="posttext">I had this same problem.  Part of the problem is that the path environment is not set for the system to find osql (or sqlcmd for that matter) until after your installer closes.<br />
<br />
I spent well over a full day trying to figure this out.  Eventually, I found that if I called the osql using the full path, the command ran as expected.  I think that sqlcmd is faster than osql but both work.<br />
<br />
Try something like this<br />
&lt;code&gt;<br />
ExecWait '$TEMP\SQLEXPR.EXE /qb sapwd=password disablenetworkprotocols=0 securitymode=SQL INSTANCENAME=MSSQLSERVER ADDLOCAL=SQL_Engine'<br />
ExecWait '&quot;$PROGRAMFILES\Microsoft SQL Server\90\Tools\Binn\osql&quot; -U sa -P password -i &quot;$PATHTO\mysqlfile.sql&quot;'<br />
&lt;/code&gt;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">trust11</div><div class="date">19th June 2007, 08:31</div></div><div class="posttext">Hi chivalri:<br />
Ive tried the code you said and when it says :<br />
&quot;Didnt found the stored procedure TAPE&quot;<br />
And dont do anything.<br />
<br />
Can you help me please?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">trust11</div><div class="date">19th June 2007, 08:33</div></div><div class="posttext">This is the code ive used:<br />
<br />
ExecWait '&quot;$PROGRAMFILES\Microsoft SQL Server\90\Tools\Binn\osql&quot; -U sa -P onix -i &quot;$INSTDIR\BD.sql&quot;'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th June 2007, 10:10</div></div><div class="posttext">Where is the .exe?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">trust11</div><div class="date">19th June 2007, 10:20</div></div><div class="posttext">Which .exe Afrow UK ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th June 2007, 10:48</div></div><div class="posttext">You are trying to execute &quot;osql&quot; without the .exe.<br />
Yes this would work in command prompt, but not here.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Swapan Das</div><div class="date">21st December 2007, 10:14</div></div><div class="posttext">Dear trust11 &amp; Everybody,<br />
<br />
I'm stuck with the same issue. After installing Sql Express from NSIS, I want to run sqlcmd from nsis script so that I can make the login password for user 'sa' blank. But I'm unable to execute that and the reasons are unknown to me but must be in the same lines as discussed in this thread.<br />
<br />
Can anyone please let me know the exact command to be given in NSIS Script to run sqlcmd ( from $PROGRAMFILES\Microsoft SQL Server\90\Tools\Binn\SQLCMD.EXE) to alter the password for the user sa. The sql query file (AlterLoginPswd.sql):<br />
ALTER LOGIN sa WITH PASSWORD= '',CHECK_EXPIRATION=OFF,CHECK_POLICY=OFF<br />
<br />
Regards,<br />
<br />
<br />
[ps.:Its a little bit urgent, bear with me please]</div></div><hr />


<div class="post"><div class="posttop"><div class="username">meaningoflights</div><div class="date">5th January 2008, 05:48</div></div><div class="posttext">[ps.:Its a little bit urgent, bear with me please] [/B] <br />
<br />
<br />
Here, here!! Its sad because there isn't a solid example out there..<br />
<br />
Hi All,<br />
<br />
I too am in an really bad position, marketing jumped the gun and now mgt are going to kick my arse if I cant write an installer before advertisements come out.. ! arrhhhh!<br />
<br />
To test the installation, I am using a program called MojoPac.com on a external HDD, instead of VMware so I'm not sure if thats the root cause.<br />
<br />
<br />
Problem<br />
============<br />
Run the following script, it doesn't install WindowsInstaller3.1, or .Net2.0 or SQLExpress. <br />
<br />
Here is the log it produces:<br />
Windows Version Analysis<br />
Windows Version Determined<br />
Windows Permission Analysis<br />
Windows Permission Determined<br />
Windows Installer Analysis<br />
Windows Installer complete<br />
.Net Analysis<br />
SQL Server Analysis<br />
Checking for existing SQL Server Instance<br />
SQL Server Analysis Completed<br />
<br />
<br />
Cause<br />
===========<br />
Maybe because MojoPac uses the host OS???  I cant install on my local PC cos I have SQL Ent edition, Win 3.1 and .Net 2 already installed.<br />
<br />
Resolution<br />
===========<br />
I'm in process of getting VM ware setup on a scsi disk.<br />
<br />
Please help me guys, thanks in advance, its heaps urgent! :) :) :)    <br />
<br />
<br />
Here are the references I found to make this script<br />
<br />
http://nsis.sourceforge.net/NSISLog_plug-in<br />
<br />
http://www.johnsadventures.com/archives/2005/11/my_installer_fixation_and_nsis.html<br />
<br />
http://nsis.sourceforge.net/Installing_the_Microsoft_.NET_Framework<br />
<br />
http://msdn2.microsoft.com/en-us/library/ms144259.aspx<br />
<br />
http://blogs.msdn.com/sanchan/archive/2006/05/28/609097.aspx<br />
<br />
http://forums.winamp.com/showthread.php?threadid=275340&amp;highlight=run+sql+script<br />
<br />
HEre's the script <br />
<br />
<br />
!include WinVer.nsh<br />
!include x64.nsh<br />
<br />
XPStyle on<br />
<br />
;funky little splash fade in effect!<br />
Function .onInit<br />
        # the plugins dir is automatically deleted when the installer exits<br />
        InitPluginsDir<br />
        File /oname=$PLUGINSDIR\splash.bmp &quot;c:\myprog\logo.bmp&quot;<br />
<br />
        #optional<br />
        #File /oname=$PLUGINSDIR\splash.wav &quot;C:\myprog\sound.wav&quot;<br />
<br />
        ;MessageBox MB_OK &quot;Fading&quot;<br />
<br />
        advsplash::show 4000 600 400 -1 $PLUGINSDIR\splash<br />
<br />
        Pop $0          ; $0 has '1' if the user closed the splash screen early,<br />
                        ; '0' if everything closed normal, and '-1' if some error occured.<br />
        Delete $PLUGINSDIR\csplash.bmp    <br />
FunctionEnd<br />
<br />
<br />
<br />
; HM NIS Edit Wizard helper defines<br />
!define PRODUCT_NAME &quot;REPLACE_WITH_APP_NAME&quot;<br />
!define PRODUCT_VERSION &quot;3.0&quot;<br />
!define PRODUCT_PUBLISHER &quot;REPLACE_WITH_APP_NAME&quot;<br />
!define PRODUCT_WEB_SITE &quot;http://www.REPLACE_WITH_YOUR_WEBSITE.com&quot;<br />
!define PRODUCT_DIR_REGKEY &quot;Software\Microsoft\Windows\CurrentVersion\App Paths\REPLACE_WITH_APP_NAME CE.exe&quot;<br />
!define PRODUCT_UNINST_KEY &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot;<br />
!define PRODUCT_UNINST_ROOT_KEY &quot;HKLM&quot;<br />
<br />
; MUI 1.67 compatible ------<br />
!include &quot;MUI.nsh&quot;<br />
<br />
; MUI Settings<br />
!define MUI_ABORTWARNING<br />
!define MUI_ICON &quot;${NSISDIR}\Contrib\Graphics\Icons\modern-install.ico&quot;<br />
!define MUI_UNICON &quot;${NSISDIR}\Contrib\Graphics\Icons\modern-uninstall.ico&quot;<br />
<br />
!define BRANDINGTEXT &quot;REPLACE_WITH_APP_NAME Pty Ltd&quot;<br />
<br />
; Welcome page<br />
!insertmacro MUI_PAGE_WELCOME<br />
; License page<br />
!define MUI_LICENSEPAGE_RADIOBUTTONS<br />
!insertmacro MUI_PAGE_LICENSE &quot;..\License.rtf&quot;<br />
; Directory page<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
; Instfiles page<br />
!insertmacro MUI_PAGE_INSTFILES<br />
; Finish page<br />
!define MUI_FINISHPAGE_RUN &quot;$INSTDIR\REPLACE_WITH_APP_NAME.exe&quot;<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
; Uninstaller pages<br />
!insertmacro MUI_UNPAGE_INSTFILES<br />
<br />
; Language files<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
<br />
; MUI end ------<br />
<br />
<br />
<br />
<br />
<br />
;==================================<br />
<br />
!macro CHECK_MIN_WIN_VER<br />
var /GLOBAL WIN_VER_PASSED ;Win98?<br />
var /GLOBAL WIN_SERVICEPACK_PASSED ;Win2kSP3<br />
var /GLOBAL SQL_SERVICEPACK_PASSED ;Win2kSP4,Win2k3SP1,WinXPSP2<br />
StrCpy $WIN_VER_PASSED â€œ1?<br />
StrCpy $WIN_SERVICEPACK_PASSED â€œ1?<br />
StrCpy $SQL_SERVICEPACK_PASSED â€œ1?<br />
<br />
ReadRegDWORD $R0 HKLM &quot;System\CurrentControlSet\Control\Windows&quot; &quot;CSDVersion&quot;<br />
IntOp $R0 $R0 / 256 ;get service pack major version<br />
<br />
nsislog::log &quot;$INSTDIR\install.log&quot; &quot;Windows Version Analysis&quot;<br />
<br />
${If} ${IsWin2000}<br />
${If} $R0 &lt; â€œ3? ; SP3<br />
StrCpy $WIN_SERVICEPACK_PASSED â€œ0?<br />
${ElseIf} $R0 &lt; â€œ4? ; SP4<br />
StrCpy $SQL_SERVICEPACK_PASSED â€œ0?<br />
${EndIf}<br />
${ElseIf} ${IsWin2003}<br />
${If} $R0 &lt; â€œ1? ; SP1<br />
StrCpy $SQL_SERVICEPACK_PASSED â€œ0?<br />
${EndIf}<br />
${ElseIf} ${IsWinXP}<br />
${If} $R0 &lt; â€œ2? ; SP2<br />
StrCpy $SQL_SERVICEPACK_PASSED â€œ0?<br />
${EndIf}<br />
${ElseIf} ${AtMostWin2000}<br />
StrCpy $WIN_VER_PASSED â€œ0?<br />
${EndIf}<br />
<br />
nsislog::log &quot;$INSTDIR\install.log&quot; &quot;Windows Version Determined&quot;<br />
<br />
!macroend<br />
<br />
<br />
;==================================<br />
<br />
<br />
<br />
<br />
!macro CHECK_ADMIN_RIGHTS<br />
<br />
nsislog::log &quot;$INSTDIR\install.log&quot; &quot;Windows Permission Analysis&quot;<br />
<br />
var /GLOBAL USER_ADMIN_PASSED ;Administrator<br />
StrCpy $USER_ADMIN_PASSED â€œ1?<br />
userInfo::getAccountType<br />
pop $0<br />
${If} $0 != â€œAdminâ€<br />
StrCpy $USER_ADMIN_PASSED â€œ0?<br />
${EndIf}<br />
<br />
nsislog::log &quot;$INSTDIR\install.log&quot; &quot;Windows Permission Determined&quot;<br />
!macroend<br />
<br />
!macro MSI_INSTALL installer_path<br />
<br />
nsislog::log &quot;$INSTDIR\install.log&quot; &quot;Windows Installer Analysis&quot;<br />
;install msi version 3<br />
GetDllVersion â€œ$SYSDIR\msi.dllâ€ $1 $2<br />
IntOp $3 $1 / 0Ã—00010000<br />
IntOp $4 $1 &amp; 0Ã—0000FFFF<br />
;IntOp $5 $2 / 0Ã—00010000<br />
;IntOp $6 $2 &amp; 0Ã—0000FFFF<br />
StrCpy $0 â€˜$3.$4'<br />
IntCmp $0 â€œ3.1? MSI_NO_INSTALL MSI_INSTALL<br />
MSI_INSTALL: ;may be 3.0 or 3.1<br />
SetDetailsPrint both<br />
DetailPrint &quot;Updating Windows Installer&quot;<br />
SetDetailsPrint none<br />
<br />
ExecWait &quot;${installer_path}\WindowsInstaller-KB893803-v2-x86.exe /quiet /norestart&quot;<br />
<br />
Sleep 2000 ; wait for a 2 seconds<br />
;!insertmacro EXEC_SUBINSTALLER â€œWindows Installer 3.1? \<br />
;â€˜â€${installer_path}\WindowsInstaller-KB893803-v2-x86.exeâ€ /quiet /norestartâ€™<br />
MSI_NO_INSTALL:<br />
<br />
nsislog::log &quot;$INSTDIR\install.log&quot; &quot;Windows Installer complete&quot;<br />
<br />
!macroend<br />
<br />
<br />
;==================================<br />
<br />
<br />
<br />
<br />
!macro NET_INSTALL installer_path<br />
<br />
nsislog::log &quot;$INSTDIR\install.log&quot; &quot;.Net Analysis&quot;<br />
<br />
;Check for framework 2.0â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“<br />
StrCpy $1 â€œ0?<br />
ReadRegDword $1 HKLM &quot;SOFTWARE\Microsoft\NET Framework Setup\NDP\v2.0.50727&quot; &quot;Install&quot;<br />
;MessageBox MB_OK $1<br />
${If} $1 == â€œâ€<br />
${If} ${RunningX64}<br />
<br />
<br />
StrCpy $9 '&quot;${installer_path}\netfx64.exe&quot; /q /c:&quot;install.exe /qb /noaspupgrade&quot;'<br />
${Else}<br />
StrCpy $9 '&quot;${installer_path}\dotnetfx2.0.exe&quot; /q /c:&quot;install.exe /qb /noaspupgrade&quot;'<br />
${EndIf}<br />
<br />
SetDetailsPrint both<br />
DetailPrint &quot;Installing .Net Framework&quot;<br />
nsislog::log &quot;$INSTDIR\install.log&quot; &quot;Installing .Net 2.0&quot;<br />
<br />
SetDetailsPrint none<br />
;!insertmacro EXEC_SUBINSTALLER â€œMicrosoft .Net Framework 2.0? $9<br />
ExecWait $9<br />
<br />
nsislog::log &quot;$INSTDIR\install.log&quot; &quot;Installation of .Net 2.0 complete&quot;<br />
<br />
${EndIf}<br />
<br />
<br />
!macroend<br />
<br />
<br />
<br />
<br />
;==================================<br />
<br />
<br />
<br />
<br />
<br />
!macro IS_SQL_INSTALLED instance_name<br />
;original version returned a 1..<br />
;!macro IS_SQL_INSTALLED instance_name ;return<br />
nsislog::log &quot;$INSTDIR\install.log&quot; &quot;SQL Server Analysis&quot;<br />
<br />
;original version returned a 1 or 0..<br />
;strcpy ${return} â€œ0?<br />
<br />
StrCpy $0 â€œ0?<br />
<br />
ReadRegStr $0 HKLM &quot;SOFTWARE\Microsoft\Microsoft SQL Server\${instance_name}\MSSQLServer\CurrentVersion\&quot; &quot;CurrentVersion&quot;<br />
${If} $0 != â€œâ€ ;should = 9.if 2005 8. if 2000<br />
<br />
!insertmacro SQL_INSTALL $INSTDIR &quot;REPLACE_WITH_APP_NAME&quot; &quot;passw0rd&quot; &quot;$PROGRAMFILES\Microsoft SQL Server&quot;<br />
<br />
nsExec::ExecToLog '&quot;$INSTDIR\CreateDatabase.cmd&quot; &quot;REPLACE_WITH_APP_NAME&quot; &quot;REPLACE_WITH_APP_NAME&quot; &quot;$INSTDIR\CreateDatabase.sql&quot;'<br />
<br />
;strcpy ${return} â€œ1?<br />
${EndIf}<br />
!macroend<br />
<br />
<br />
;==================================<br />
<br />
<br />
<br />
<br />
!macro SQL_INSTALL installer_path instance_name password install_dir<br />
<br />
nsislog::log &quot;$INSTDIR\install.log&quot; &quot;Checking for existing SQL Server Instance&quot;<br />
<br />
;Check for existing instance<br />
AddSize 358400<br />
ReadRegStr $0 HKLM &quot;SOFTWARE\Microsoft\Microsoft SQL Server\${instance_name}\MSSQLServer\CurrentVersion\&quot; &quot;CurrentVersion&quot;<br />
${If} $0 == â€œâ€ ;should = 9.if 2005 8. if 2000<br />
;!insertmacro EXEC_SUBINSTALLER â€œMicrosoft SQL Server 2005 Express Editionâ€ \<br />
;â€˜â€${installer_path}\SQLEXPR.exeâ€ /settings ${settings_file} -q /norebootchk /qb reboot=ReallySuppress addlocal=all INSTANCENAME=${instance_name} SAPWD=${password} INSTALLSQLDIR=â€${install_dir} SCCCHECKLEVEL=IncompatibleComponents:1;MDAC25Version:0â€â€˜<br />
<br />
nsislog::log &quot;$INSTDIR\install.log&quot; &quot;Installing SQL Server&quot;<br />
<br />
${If} ${IsWin2000}<br />
ExecWait &quot;${installer_path}\SQLEXPR.exe -q /norebootchk /qn reboot=ReallySuppress addlocal=all INSTANCENAME=${instance_name} SAPWD=${password} INSTALLSQLDIR=${install_dir} SQLBROWSERACCOUNT=NT AUTHORITY\SYSTEM SQLACCOUNT=NT AUTHORITY\SYSTEM AGTACCOUNT=NT AUTHORITY\SYSTEM ASACCOUNT=NT AUTHORITY\SYSTEM RSACCOUNT=NT AUTHORITY\SYSTEM SQLBROWSERAUTOSTART=1 SQLAUTOSTART=1 AGTAUTOSTART=1 ASAUTOSTART=0 RSAUTOSTART=0 SECURITYMODE=SQL DISABLENETWORKPROTOCOLS=0 ERRORREPORTING=1 SQMREPORTING=0 ENABLERANU=0 ADDUSERASADMIN=0&quot;<br />
${Else}<br />
ExecWait &quot;${installer_path}\SQLEXPR.exe -q /norebootchk /qn reboot=ReallySuppress addlocal=all INSTANCENAME=${instance_name} SAPWD=${password} INSTALLSQLDIR=${install_dir} SQLBROWSERACCOUNT=NT AUTHORITY\NETWORK SERVICE SQLACCOUNT=NT AUTHORITY\NETWORK SERVICE AGTACCOUNT=NT AUTHORITY\NETWORK SERVICE ASACCOUNT=NT AUTHORITY\NETWORK SERVICE RSACCOUNT=NT AUTHORITY\NETWORK SERVICE SQLBROWSERAUTOSTART=1 SQLAUTOSTART=1 AGTAUTOSTART=1 ASAUTOSTART=0 RSAUTOSTART=0 SECURITYMODE=SQL DISABLENETWORKPROTOCOLS=0 ERRORREPORTING=1 SQMREPORTING=0 ENABLERANU=0 ADDUSERASADMIN=0&quot;<br />
<br />
;troubleshooting change qn to qb<br />
;ExecWait &quot;${installer_path}\SQLEXPR.exe -q /norebootchk /qb reboot=ReallySuppress addlocal=all INSTANCENAME=${instance_name} SAPWD=${password} INSTALLSQLDIR=${install_dir} SQLBROWSERACCOUNT=NT AUTHORITY\NETWORK SERVICE SQLACCOUNT=NT AUTHORITY\NETWORK SERVICE AGTACCOUNT=NT AUTHORITY\NETWORK SERVICE ASACCOUNT=NT AUTHORITY\NETWORK SERVICE RSACCOUNT=NT AUTHORITY\NETWORK SERVICE SQLBROWSERAUTOSTART=1 SQLAUTOSTART=1 AGTAUTOSTART=1 ASAUTOSTART=0 RSAUTOSTART=0 SECURITYMODE=SQL DISABLENETWORKPROTOCOLS=0 ERRORREPORTING=1 SQMREPORTING=0 ENABLERANU=0 ADDUSERASADMIN=0&quot;<br />
<br />
${EndIf}<br />
<br />
   ;ExecWait 'net start mssql$$$REPLACE_WITH_APP_NAME'<br />
   Sleep 10000 ; wait for a 10 seconds<br />
${EndIf}<br />
<br />
<br />
nsislog::log &quot;$INSTDIR\install.log&quot; &quot;SQL Server Analysis Completed&quot;<br />
<br />
!macroend<br />
<br />
<br />
<br />
;==================================<br />
<br />
<br />
Name &quot;${PRODUCT_NAME} ${PRODUCT_VERSION}&quot;<br />
OutFile &quot;Setup.exe&quot;<br />
InstallDir &quot;$PROGRAMFILES\REPLACE_WITH_APP_NAME&quot;<br />
InstallDirRegKey HKLM &quot;${PRODUCT_DIR_REGKEY}&quot; &quot;&quot;<br />
ShowInstDetails show<br />
ShowUnInstDetails show<br />
<br />
Section &quot;MainSection&quot; SEC01<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
  SetOverwrite ifnewer<br />
  File &quot;..\REPLACE_WITH_APP_NAME CE.exe&quot;<br />
  CreateDirectory &quot;$SMPROGRAMS\REPLACE_WITH_APP_NAME&quot;<br />
  CreateShortCut &quot;$SMPROGRAMS\REPLACE_WITH_APP_NAME\REPLACE_WITH_APP_NAME.lnk&quot; &quot;$INSTDIR\REPLACE_WITH_APP_NAME.exe&quot;<br />
  CreateShortCut &quot;$DESKTOP\REPLACE_WITH_APP_NAME.lnk&quot; &quot;$INSTDIR\REPLACE_WITH_APP_NAME.exe&quot;<br />
  File &quot;..\CSHttpClient.dll&quot;<br />
  File &quot;..\m4usms.dll&quot;<br />
  File &quot;..\TimeSync.exe&quot;<br />
<br />
<br />
<br />
;add the windows installer, .net 2.0, sql express exe's to the InstallDirectory<br />
<br />
;The 64 or 32 bit switch<br />
File &quot;..\Components\dotnetfx2.0.exe&quot;<br />
;File &quot;..\Components\netfx64.exe&quot;<br />
File &quot;..\Components\WindowsInstaller-KB893803-v2-x86.exe&quot;<br />
File &quot;..\Components\SQLEXPR.exe&quot;<br />
File &quot;..\Components\CreateDatabase.cmd&quot;<br />
File &quot;..\Components\CreateDatabase.sql&quot;<br />
<br />
<br />
!insertmacro CHECK_MIN_WIN_VER<br />
<br />
!insertmacro CHECK_ADMIN_RIGHTS<br />
<br />
!insertmacro MSI_INSTALL $INSTDIR<br />
<br />
!insertmacro NET_INSTALL $INSTDIR<br />
<br />
!insertmacro IS_SQL_INSTALLED &quot;REPLACE_WITH_APP_NAME&quot;<br />
<br />
Delete &quot;$INSTDIR\dotnetfx2.0.exe&quot;<br />
;File &quot;..\Components\netfx64.exe&quot;<br />
Delete &quot;$INSTDIR\WindowsInstaller-KB893803-v2-x86.exe&quot;<br />
Delete &quot;$INSTDIR\SQLEXPR.exe&quot;<br />
Delete &quot;$INSTDIR\CreateDatabase.cmd&quot;<br />
Delete &quot;$INSTDIR\CreateDatabase.sql&quot;<br />
<br />
SectionEnd<br />
<br />
<br />
Section -AdditionalIcons<br />
  WriteIniStr &quot;$INSTDIR\${PRODUCT_NAME}.url&quot; &quot;InternetShortcut&quot; &quot;URL&quot; &quot;${PRODUCT_WEB_SITE}&quot;<br />
  CreateShortCut &quot;$SMPROGRAMS\REPLACE_WITH_APP_NAME\Website.lnk&quot; &quot;$INSTDIR\${PRODUCT_NAME}.url&quot;<br />
  CreateShortCut &quot;$SMPROGRAMS\REPLACE_WITH_APP_NAME\Uninstall.lnk&quot; &quot;$INSTDIR\uninst.exe&quot;<br />
SectionEnd<br />
<br />
Section -Post<br />
  WriteUninstaller &quot;$INSTDIR\uninst.exe&quot;<br />
  WriteRegStr HKLM &quot;${PRODUCT_DIR_REGKEY}&quot; &quot;&quot; &quot;$INSTDIR\REPLACE_WITH_APP_NAME CE.exe&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayName&quot; &quot;$(^Name)&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;UninstallString&quot; &quot;$INSTDIR\uninst.exe&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayIcon&quot; &quot;$INSTDIR\REPLACE_WITH_APP_NAME CE.exe&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayVersion&quot; &quot;${PRODUCT_VERSION}&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;URLInfoAbout&quot; &quot;${PRODUCT_WEB_SITE}&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;Publisher&quot; &quot;${PRODUCT_PUBLISHER}&quot;<br />
SectionEnd<br />
<br />
<br />
Function un.onUninstSuccess<br />
  HideWindow<br />
  MessageBox MB_ICONINFORMATION|MB_OK &quot;$(^Name) was successfully removed from your computer.&quot;<br />
FunctionEnd<br />
<br />
Function un.onInit<br />
  MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 &quot;Are you sure you want to completely remove $(^Name) and all of its components?&quot; IDYES +2<br />
  Abort<br />
FunctionEnd<br />
<br />
Section Uninstall<br />
  Delete &quot;$INSTDIR\${PRODUCT_NAME}.url&quot;<br />
  Delete &quot;$INSTDIR\uninst.exe&quot;<br />
  Delete &quot;$INSTDIR\TimeSync.exe&quot;<br />
  <br />
  Delete &quot;$INSTDIR\REPLACE_WITH_APP_NAME.exe&quot;<br />
<br />
RMDir &quot;$INSTDIR\Styles&quot;<br />
<br />
  RMDir &quot;$SMPROGRAMS\REPLACE_WITH_APP_NAME&quot;<br />
  RMDir &quot;$INSTDIR&quot;<br />
<br />
  DeleteRegKey ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot;<br />
  DeleteRegKey HKLM &quot;${PRODUCT_DIR_REGKEY}&quot;<br />
  SetAutoClose true<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Swapan Das</div><div class="date">5th January 2008, 08:12</div></div><div class="posttext">Dear meaningoflights, thanks a lot for your source code.<br />
I've somehow overcome the issue of installation of sql express 2005. But there are lot of things to learn from your code. Please just confirm that the code you've pasted here is running without a single error. Right now I'm into a different project will definitely have a go with your coding in near future.<br />
<br />
Thanks once again...<br />
Regards,<br />
Swapan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">meaningoflights</div><div class="date">5th January 2008, 20:38</div></div><div class="posttext">G'day Swapan,<br />
<br />
I can confirm it runs without a single error, I had to do the following fixes:<br />
<br />
<br />
This line:<br />
IntCmp $0 â€œ3.1? MSI_NO_INSTALL MSI_INSTALL MSI_NO_INSTALL<br />
<br />
This line:<br />
;StrCpy $1 â€œ0?<br />
;ReadRegDword $1 HKLM &quot;SOFTWARE\Microsoft\NET Framework Setup\NDP\v2.0.50727? &quot;Install&quot;<br />
;${If} $1 != â€œ1?<br />
<br />
;${registry::Read} &quot;HKEY_LOCAL_MACHINE\Software\Microsoft\NET Framework Setup\NDP\v2.0.50727&quot; &quot;SP&quot; $R0 $R1<br />
;${If} $R1 == &quot;&quot;<br />
<br />
ReadRegStr $R1 HKLM &quot;SOFTWARE\Microsoft\NET Framework Setup\NDP\v2.0.50727&quot; &quot;Install&quot;<br />
${If} $R1 == &quot;&quot;<br />
<br />
<br />
<br />
<br />
This line  (in two places):<br />
;ReadRegStr $0 HKLM &quot;SOFTWARE\Microsoft\Microsoft SQL Server\${instance_name}\MSSQLServer\CurrentVersion\&quot; &quot;CurrentVersion&quot;<br />
;${If} $0 != â€œ9â€ ;should = 9.if 2005 8. if 2000<br />
<br />
;${registry::Read} &quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\${instance_name}\MSSQLServer\CurrentVersion&quot; &quot;CurrentVersion&quot; $R0 $R1<br />
;${If} $R1 == &quot;&quot;<br />
<br />
ReadRegStr $R1 HKLM &quot;SOFTWARE\Microsoft\Microsoft SQL Server\${instance_name}\MSSQLServer\CurrentVersion&quot; &quot;CurrentVersion&quot;<br />
${If} $R1 == &quot;&quot;<br />
<br />
<br />
<br />
To use the cmd and sql files refer to this post:<br />
http://forums.winamp.com/showthread.php?threadid=275340&amp;highlight=run+sql+script<br />
<br />
Tip: Make sure the SQL Instance name is shorter than 16 chars.<br />
<br />
For the complete script, the original one I found posted by Scott Moore here:<br />
http://www.JeremyThompson.Net/Rocks/Unattended WinInstaller, SQL, .Net NSIS installtion script.txt<br />
<br />
http://www.JeremyThompson.Net</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Swapan Das</div><div class="date">7th January 2008, 08:06</div></div><div class="posttext">Originally posted by meaningoflights <br />
<br />
Tip: Make sure the SQL Instance name is shorter than 16 chars.<br />
 <br />
<br />
Thanks for the detailed &amp; prompt reply. Right now I'm creating my own instance name in this format:<br />
<br />
[computer name]\[my instance name]<br />
<br />
e.g: SERVER\SWAPANLABSSE<br />
<br />
(where SERVER=computer name; SWAPANLABSSE=the instance name I want to create in user's system]<br />
<br />
&quot;SWAPANLABSSE&quot; is already 12 chars.+ computer name will definitely cross 16 chars., but this is working and use install SSE and with this instance name. Please clarify on this issue of instance name's max.length.<br />
<br />
Regards,<br />
Swapan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">meaningoflights</div><div class="date">8th January 2008, 03:33</div></div><div class="posttext">G'day mate,<br />
<br />
Your instance name is shorter than 16 chars (dont add the PC name too), as per the requirements set out in BOL:<br />
<br />
<br />
Named instance <br />
Choose this option to create a new named instance. Bear in mind the following when naming an instance of SQL Server:<br />
<br />
Instance names are not case sensitive.<br />
<br />
Instance names cannot contain the terms &quot;Default,&quot; &quot;MSSQLServer,&quot; or other reserved keywords. If a reserved keyword is used in an instance name, a Setup error will occur.<br />
<br />
**Instance names are limited to 16 characters.<br />
<br />
<br />
JEzza<br />
I'm still testing, finally setup VM ware with Win2000,XP and Vista, hurraaaay</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>