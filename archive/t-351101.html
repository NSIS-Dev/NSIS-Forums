<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Choosing Between 2 Registry Path Options, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Choosing Between 2 Registry Path Options NSIS Discussion" />
	
	<title> Choosing Between 2 Registry Path Options [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Choosing Between 2 Registry Path Options</div>
<hr />
<div class="pda"><a href="t-351101.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=351101">Choosing Between 2 Registry Path Options</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">n4gix</div><div class="date">2nd November 2012, 00:12</div></div><div class="posttext">I need to ask the customer to choose between installing our product to FSX or Prepar3D. Both programs have Registry Keys...<br />
<br />
It seems like a simple enough task, but so far I've found nothing remotely similar in any of the documentation, examples, or even searching this forum.<br />
<br />
I am using &quot;MUI2.nsh&quot; just for sake of information.<br />
<br />
Desired binary dialog:<br />
==================<br />
To which of these simulator programs do you wish to install this product?<br />
[ ] FSX<br />
[ ] Prepar3D<br />
==================<br />
<br />
if FSX<br />
InstallDirRegKey HKLM &quot;Software\Microsoft\Microsoft Games\flight simulator\10.0&quot; SetupPath<br />
InstallDir &quot;$PROGRAMFILES\Microsoft Games\Microsoft Flight Simulator X\&quot;<br />
<br />
else if Prepar3D<br />
InstallDirRegKey HKLM &quot;Software\LockheedMartin\Prepar3D&quot; SetupPath<br />
InstallDir &quot;$PROGRAMFILES\Prepar3D\&quot;<br />
<br />
Name &quot;${PRODUCT_NAME} ${PRODUCT_VERSION}&quot;<br />
OutFile &quot;MilViz_F86_vR1.121026.exe&quot;<br />
<br />
ShowInstDetails hide<br />
<br />
Section &quot;MainSection&quot; SEC01<br />
<br />
  SetOverwrite on<br />
  SetOutPath &quot;$INSTDIR\Sound\MilViz&quot;<br />
  File &quot;F:\Installer Build Folders\F86 Build Folder\Sound\MilViz\*.*&quot;<br />
<br />
;...snipped remainder of file for brevity...<br />
<br />
SectionEnd<br />
<br />
Section -Post<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">2nd November 2012, 02:34</div></div><div class="posttext">If the key and value specified by InstallDirRegKey exists it is copied to $instdir before any of your code runs, if you need something more advanced you have to do it yourself.<br />
<br />
If you want check/radiobuttons on the components page/custom page to change $instdir you must do it with ReadRegStr</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">2nd November 2012, 06:10</div></div><div class="posttext">Simply readregstr the proper value into $INSTDIR in your option page's leave function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n4gix</div><div class="date">2nd November 2012, 18:22</div></div><div class="posttext">Thank you both for your replies, which I'm sure are excellent suggestions. While I am not inexperienced with coding logic, I am completely ignorant of this scripting language and its myriad options, nor quite honestly do I have any &quot;free time&quot; to devote to learning enough to answer my own question... :(<br />
<br />
The problem -which it appears that I have not made clear enough- is that I have no idea whatever how to create this dialog page to begin with, nor how to integrate it into my existing installer script...<br />
<br />
Desired binary dialog page:<br />
==================<br />
To which of these simulator programs do you wish to install this product?<br />
[ ] FSX<br />
[ ] Prepar3D<br />
==================<br />
<br />
<br />
As it exists now, the customer can manually use the Browse option to search for and select the install path for his/her FSX or Prepar3D root folder, but I'd prefer to save them from that effort by simply allowing them to choose one or the other from a simple dialog page.<br />
<br />
This part is pseudo-code to illustrate the desired logic. At the moment, I have to build two separate installers for each of the two target simulator programs and comment out (;) the two opposite lines, which seems to be very inefficient and clumsy:<br />
<br />
<br />
;if FSX<br />
InstallDirRegKey HKLM &quot;Software\Microsoft\Microsoft Games\flight simulator\10.0&quot; SetupPath<br />
InstallDir &quot;$PROGRAMFILES\Microsoft Games\Microsoft Flight Simulator X\&quot;<br />
<br />
;else if Prepar3D<br />
;InstallDirRegKey HKLM &quot;Software\LockheedMartin\Prepar3D&quot; SetupPath<br />
;InstallDir &quot;$PROGRAMFILES\Prepar3D\&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">2nd November 2012, 19:54</div></div><div class="posttext">Read the tutorial (http://nsis.sourceforge.net/Docs/nsDialogs/Readme.html) on nsDialogs; then you can create a custom page with two radio buttons. In the exit (leave) function you will read the button states and can perform the if/else (${IF} / ${Else} / ${EndIf} ) logic to set the installation directory and registry keys.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n4gix</div><div class="date">2nd November 2012, 20:08</div></div><div class="posttext">Read the tutorial (http://nsis.sourceforge.net/Docs/nsDialogs/Readme.html) on nsDialogs; then you can create a custom page with two radio buttons. In the exit (leave) function you will read the button states and can perform the if/else (${IF} / ${Else} / ${EndIf} ) logic to set the installation directory and registry keys.<br />
<br />
Actually, I did just that yesterday afternoon. Unfortunately, I didn't find any help there either. Simply trying to add any of the examples to my existing script caused a compiler error.<br />
<br />
I'll give it another go though. Maybe this time it'll work out for me. :igor:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n4gix</div><div class="date">2nd November 2012, 23:54</div></div><div class="posttext">Okay, I've made some progress, but I cannot figure out how to select only one of the two options. I was hoping that the ${if} statement would work, but obviously I've not got it correct yet:<br />
<br />
XPStyle on<br />
Var Dialog<br />
Var Label<br />
Var Text<br />
Var Text_State<br />
Var Checkbox<br />
Var Checkbox2<br />
Var Checkbox_State<br />
Var Checkbox2_State<br />
<br />
Page custom nsDialogsPage nsDialogsPageLeave<br />
<br />
Function nsDialogsPage<br />
<br />
	nsDialogs::Create 1018<br />
	Pop $Dialog<br />
<br />
	${If} $Dialog == error<br />
		Abort<br />
	${EndIf}<br />
<br />
	${NSD_CreateLabel} 0 0 100% 12u &quot;Please Choose Your Simulator Version!&quot;<br />
	Pop $Label<br />
<br />
	${NSD_CreateCheckbox} 0 20u 100% 10u &quot;&amp;FSX&quot;<br />
	Pop $Checkbox<br />
	<br />
	${NSD_CreateCheckbox} 0 40u 100% 10u &quot;&amp;Prepar3D&quot;<br />
	Pop $Checkbox2<br />
<br />
	${If} $Checkbox2_State == ${BST_CHECKED}<br />
		${NSD_Uncheck} $Checkbox<br />
	${EndIf}<br />
<br />
        nsDialogs::Show<br />
<br />
FunctionEnd<br />
<br />
Function nsDialogsPageLeave<br />
<br />
	${NSD_GetText} $Text $Text_State<br />
	${NSD_GetState} $Checkbox $Checkbox_State<br />
	MessageBox MB_OK &quot;You Chose:$\n$\n$Checkbox_State $\n$\n$Checkbox2_State&quot;<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">redxii</div><div class="date">3rd November 2012, 00:22</div></div><div class="posttext">Use ${NSD_CreateRadioButton} instead, since you say only one option can be selected. Also you didn't get the state of 'Checkbox2' and you don't have an item named &quot;Text&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n4gix</div><div class="date">3rd November 2012, 00:33</div></div><div class="posttext">Use ${NSD_CreateRadioButton} instead, and you didn't get the state of 'Checkbox2'.<br />
<br />
I did change already to the RadioButton. Now the problem is that this script won't allow me to use the InstallDirRegKey... within the Function... :eek:<br />
<br />
Error: command InstallDirRegKey not valic in Function<br />
<br />
<br />
Function nsDialogsPageLeave<br />
<br />
        ${NSD_GetState} $RadioButton $RadioButton_State<br />
        ${NSD_GetState} $RadioButton2 $RadioButton2_State<br />
        <br />
        ${If} $RadioButton_State == 1<br />
                InstallDirRegKey HKLM &quot;Software\Microsoft\Microsoft Games\flight simulator\10.0&quot; SetupPath<br />
                InstallDir &quot;$PROGRAMFILES\Microsoft Games\Microsoft Flight Simulator X\&quot;<br />
	${EndIf}<br />
<br />
        ${If} $RadioButton2_State == 1<br />
              InstallDirRegKey HKLM &quot;Software\LockheedMartin\Prepar3D&quot; SetupPath<br />
              InstallDir &quot;$PROGRAMFILES\Prepar3D\&quot;<br />
        ${EndIf}<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">redxii</div><div class="date">3rd November 2012, 00:41</div></div><div class="posttext">You can't use InstallDirRegKey or InstallDir in a function/section.<br />
<br />
Use ReadRegStr to read the key to change $INSTDIR.  For example:<br />
<br />
ReadRegStr $INSTDIR HKLM &quot;Software\LockheedMartin\Prepar3D&quot; SetupPath</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n4gix</div><div class="date">3rd November 2012, 01:03</div></div><div class="posttext">You can't use InstallDirRegKey or InstallDir in a function/section.<br />
<br />
Use ReadRegStr to read the key to change $INSTDIR.  For example:<br />
<br />
ReadRegStr $INSTDIR HKLM &quot;Software\LockheedMartin\Prepar3D&quot; SetupPath<br />
<br />
Thank you so very much! That was the final bit that was holding me back... <br />
<br />
Now my Radio Buttons are correctly selecting the install path and I can move on. Pity it took so long, but since every project uses this same template, I won't have to mess with it again.<br />
<br />
While I have attention though, could someone explain how to use this?<br />
<br />
Page license<br />
<br />
I have a license text file already that I've been using with this function from HM NIS Edit&quot;:<br />
<br />
  !insertmacro MUI_PAGE_LICENSE &quot;F86_License.txt&quot;<br />
<br />
It would simply look nicer to have it in better integrated with the nsDialogs if possible. :p<br />
<br />
In case someone else as &quot;slow&quot; as myself happens to need this, here is the completed script:<br />
<br />
XPStyle on<br />
Var Dialog<br />
Var Label<br />
Var RadioButton<br />
Var RadioButton2<br />
Var RadioButton_State<br />
Var RadioButton2_State<br />
<br />
Page custom nsDialogsPage nsDialogsPageLeave<br />
;Page license<br />
<br />
Function nsDialogsPage<br />
<br />
	nsDialogs::Create 1018<br />
	Pop $Dialog<br />
<br />
	${If} $Dialog == error<br />
		Abort<br />
	${EndIf}<br />
<br />
	${NSD_CreateLabel} 0 0 100% 12u &quot;Please Choose Your Simulator Version!&quot;<br />
	Pop $Label<br />
<br />
	${NSD_CreateRadioButton} 0 20u 100% 10u &quot;&amp;FSX&quot;<br />
	Pop $RadioButton<br />
	<br />
	${NSD_CreateRadioButton} 0 40u 100% 10u &quot;&amp;Prepar3D&quot;<br />
	Pop $RadioButton2<br />
<br />
        nsDialogs::Show<br />
<br />
FunctionEnd<br />
<br />
Function nsDialogsPageLeave<br />
<br />
	${NSD_GetState} $RadioButton $RadioButton_State<br />
        ${NSD_GetState} $RadioButton2 $RadioButton2_State<br />
        <br />
        ${If} $RadioButton_State == 1<br />
              ReadRegStr $INSTDIR HKLM &quot;Software\Microsoft\Microsoft Games\flight simulator\10.0&quot; SetupPath<br />
	${EndIf}<br />
<br />
        ${If} $RadioButton2_State == 1<br />
              ReadRegStr $INSTDIR HKLM &quot;Software\LockheedMartin\Prepar3D&quot; SetupPath<br />
        ${EndIf}<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n4gix</div><div class="date">3rd November 2012, 01:32</div></div><div class="posttext">Nevermind the previous. I found that this works well enough for my purposes...<br />
<br />
 PageEx license<br />
   LicenseData F86_License.txt<br />
   LicenseForceSelection checkbox<br />
 PageExEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">3rd November 2012, 04:16</div></div><div class="posttext">Most of the MUI page macros are wrappers around the built-in NSIS pages and they can be configured with the MUI defines listed in the MUI readme, in your case MUI_LICENSEPAGE_CHECKBOX</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>