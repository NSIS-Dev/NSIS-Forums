<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" search users for folder and delete it, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  search users for folder and delete it NSIS Discussion" />
	
	<title> search users for folder and delete it [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  search users for folder and delete it</div>
<hr />
<div class="pda"><a href="t-290045.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=290045">search users for folder and delete it</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Dogfundays</div><div class="date">11th April 2008, 16:16</div></div><div class="posttext">Hi, I have a folder that may be under any user in c:\Documents and Settings. I am looking for a way that searches for this folder and then deletes it. <br />
<br />
I have searched the web and found oneway that you need VB but I can't use VB here. Any ideas? <br />
<br />
Thanks for your time,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Daniel James</div><div class="date">11th April 2008, 17:46</div></div><div class="posttext">Originally posted by Dogfundays <br />
Hi, I have a folder that may be under any user in c:\Documents and Settings. I am looking for a way that searches for this folder and then deletes it. <br />
Have you looked at the Locate function in FileFuncs.nsh? You can use that to search for the directory, and then delete it with RmDir in the callback.<br />
<br />
There's also a 'Locate' plug-in, which you may or may not prefer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dogfundays</div><div class="date">11th April 2008, 18:59</div></div><div class="posttext">Thanks I'm looking into it now.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th April 2008, 19:16</div></div><div class="posttext">Might be easier to use EnumRegKey to look at users in HKLM\Software\Microsoft\Windows NT\CurrentVersion\ProfileList<br />
<br />
Also, I would not hard code C:\Documents and Settings as it may be different. Read from HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList ProfilesDirectory to get the path set for the machine.<br />
<br />
Use ExpandEnvStrings on results.<br />
<br />
You could also get the Documents and Settings path and locate the directories using FindFirst, FindNext, FindClose (IMO using Locate is a little bit much if you just want to locate a sub-directory under these folders).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Daniel James</div><div class="date">13th April 2008, 18:32</div></div><div class="posttext">Originally posted by Afrow UK <br />
Might be easier to use EnumRegKey to look at users in HKLM\Software\Microsoft\Windows NT\CurrentVersion\ProfileList<br />
<br />
You're right :o I misread the question (as &quot;a folder that may be under any folder in c:\Documents and Settings&quot;).<br />
<br />
Also, I would not hard code C:\Documents and Settings as it may be different. Read from HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList ProfilesDirectory to get the path set for the machine.<br />
Yes. $PROFILE will get the right directory name for the machine, but your way is still probably easier.<br />
<br />
You could also get the Documents and Settings path and locate the directories using FindFirst, FindNext, FindClose (IMO using Locate is a little bit much if you just want to locate a sub-directory under these folders).<br />
<br />
I'm not so sure about that ... You need to find each user's home directory and then look inside it for the named directory that you want to delete. Locate does it in one hit, but requires a callback. Not much to choose between them, I'd say (though using the registry is easier).<br />
<br />
Locate is certainly the easiest way if you're looking for a directory with a given name that you know is at some arbitrary location in the tree but you don't know where or at what depth (which is how I misread the question).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dogfundays</div><div class="date">14th April 2008, 14:54</div></div><div class="posttext">This is the path that we are trying to locate.<br />
<br />
C:\Documents and Settings\%Users%\Dir <br />
<br />
Once we find the directory we would like to delete it the problem is the searching for the directory I have tried locate but I do not have a good handle on it. <br />
One problem is I'm new to NISI and the learning curve is getting in the way.<br />
<br />
Thanks for the help,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dogfundays</div><div class="date">14th April 2008, 19:13</div></div><div class="posttext">Here is what I have so far. The problem is that it will not find the directory but will find everything inside the dir that has an extension (${Locate} &quot;C:\&quot; &quot;D=1 /L=F /M=AutoShutdown.* /S=1K&quot;) The AutoShutdown I have tried with and with out the .* <br />
<br />
Does anyone see the problem?<br />
<br />
Name &quot;Output&quot;<br />
OutFile &quot;Output.exe&quot;<br />
<br />
!include &quot;FileFunc.nsh&quot;<br />
!insertmacro Locate<br />
<br />
Section<br />
${Locate} &quot;C:\&quot; &quot;D=1 /L=F /M=AutoShutdown.* /S=1K&quot; &quot;remove&quot;<br />
	<br />
<br />
IfErrors 0 +2<br />
MessageBox MB_OK &quot;Error&quot; IDOK +2<br />
MessageBox MB_OK &quot;$$R0=$R0&quot;<br />
SectionEnd<br />
<br />
Function remove<br />
# $R9=&quot;C:\Documents and Settings\%Users%\AutoShutdown&quot;<br />
# $R8=&quot;C:\&quot;<br />
# $R7=&quot;c:\AutoShutdown&quot;<br />
# $R6=&quot;5&quot;<br />
StrCpy $R0 $R9<br />
	<br />
Delete '$R0$\n$\nFind next' +2<br />
;MessageBox MB_YESNO '$R0$\n$\nFind next?' IDYES +2<br />
StrCpy $0 StopLocate<br />
<br />
Push $0<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>