<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Calculate Size of Unpacked 7z Archive, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Calculate Size of Unpacked 7z Archive NSIS Discussion" />
	
	<title> Calculate Size of Unpacked 7z Archive [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Calculate Size of Unpacked 7z Archive</div>
<hr />
<div class="pda"><a href="t-286081.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=286081">Calculate Size of Unpacked 7z Archive</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">NinjaHippie</div><div class="date">1st February 2008, 06:20</div></div><div class="posttext">The other day I encountered the #12345 error for exceeding the 2Gb installer file size limit. Searching around the forums I found that the common solution to this problem is to store the data in an archive separate from the installer executable, and unpack it during the install.<br />
<br />
I found this works well using the 7zip command line approach (which is detailed in other topics on the forum).<br />
<br />
The problem with this solution however is that the &quot;required space&quot; display does not take into account the size of the data in the external archive.<br />
<br />
As a solution, I've written a little python script to calculate the size of the archive, and replace a predefined string (&quot;%data_size%&quot;) in the nsis script with this value:<br />
<br />
<br />
os.system( &quot;7z l -slt archive.7z &gt; size_data.txt&quot; )<br />
<br />
file_ = open( &quot;size_data.txt&quot;, &quot;rt&quot; )<br />
data = file_.read()<br />
file_.close()<br />
os.remove( &quot;size_data.txt&quot; )<br />
<br />
l = data.split(&quot;\nSize = &quot;)<br />
total = 0<br />
for i in range( len(l) ):<br />
    if i &gt; 0:   # The first item is useless<br />
        total += int(l[i].split(&quot;\nPacked Size&quot;)[0])<br />
total /= 1024 # Convert to Kilobytes<br />
print total<br />
<br />
versionedInstFile = open( &quot;Versioned Installer.nsi&quot;, &quot;rt&quot; )<br />
versionedInstStr = versionedInstFile.read()<br />
versionedInstFile.close()<br />
<br />
versionedInstStr = versionedInstStr.replace( &quot;%data_size%&quot;, str(total) )<br />
<br />
f = open( &quot;Versioned Installer.nsi&quot;, &quot;wt&quot; )<br />
f.write( versionedInstStr )<br />
f.close()<br />
<br />
<br />
Here's the relevant part of the nsis script:<br />
<br />
Section &quot;yay&quot; SecYay<br />
  ...<br />
  AddSize %data_size%<br />
SectionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>