<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to check if components list is visible?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to check if components list is visible? NSIS Discussion" />
	
	<title> How to check if components list is visible? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to check if components list is visible?</div>
<hr />
<div class="pda"><a href="t-275188.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=275188">How to check if components list is visible?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">davide.chiesa</div><div class="date">31st July 2007, 17:49</div></div><div class="posttext">Hi everybody,<br />
<br />
I'm using the statement<br />
<br />
InstType /COMPONENTSONLYONCUSTOM<br />
<br />
in a setup script and I need to perform an action only if the components list is visible in the components page. Is there a way to test this with a function?<br />
<br />
Thanks.<br />
DD</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2007, 18:06</div></div><div class="posttext">You could check if the combo box contains the item with CB_FINDSTRINGEXACT:<br />
http://msdn2.microsoft.com/en-us/library/ms673148.aspx<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">davide.chiesa</div><div class="date">1st August 2007, 03:26</div></div><div class="posttext">Thank you for your reply, but I still need some help to understand it (sorry): could you show me an example in which I  can get a flag in a variable indicating whether components list is visible or not?<br />
Thanks again.<br />
DD</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">1st August 2007, 07:43</div></div><div class="posttext">Using the available instructions that would be possible only when there is user's action by checking/uncheching components in custom installation, otherwise you'd need to go as Stu suggested.<br />
Hence, this example partially working:<br />
!include logiclib.nsh<br />
<br />
outfile 'test.exe'<br />
<br />
InstType Typical<br />
InstType /COMPONENTSONLYONCUSTOM<br />
<br />
page components<br />
page instfiles<br />
<br />
section 'section one' sec01<br />
sectionin 1 <br />
sectionend<br />
<br />
section 'section two' sec02<br />
sectionin 1 <br />
sectionend<br />
<br />
section 'section three' sec03<br />
sectionin 1<br />
sectionend<br />
<br />
Function .onSelChange<br />
GetCurInstType $R0<br />
${If} $R0 == ${NSIS_MAX_INST_TYPES}<br />
MessageBox MB_OK '$R0'<br />
${EndIf}<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">davide.chiesa</div><div class="date">1st August 2007, 10:20</div></div><div class="posttext">Thank you very much. I tried this way first, but it's not a solution, because if the components list is displayed with the check boxes set in any standard section configuration I don't get the &quot;32&quot; value I need, but the section number instead. So unless the user alters some check box I can't know whether the components list is visible or not...<br />
What I'd need is to query the list control through some message related to its visibility state, but I don't know such a message.<br />
I'm sorry, I don't understand how to apply Stu's suggestion to my case. In which way checking for the presence of a string in the combo list can help me to determine whether components list is available?<br />
Thanks again for any help.<br />
DD</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st August 2007, 11:23</div></div><div class="posttext">Following the million examples and according to that page :),<br />
<br />
!include WinMessages.nsh<br />
FindWindow $R0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
GetDlgItem $R0 $R0 1017<br />
SendMessage $R0 ${CB_FINDSTRINGEXACT} -1 &quot;STR:Search for me case insensitively&quot; $R0<br />
At which point, $R0 is the index of the item or -1 otherwise.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">davide.chiesa</div><div class="date">1st August 2007, 16:04</div></div><div class="posttext">Stu, it took me a little to understand what I had to do, but when I thought I could use WM_GETTEXT to retrieve the user's selection from the combo box, your suggestion became clearer.<br />
The following code does the work perfectly. I hope it can be useful to post it here.<br />
Thanks.<br />
DD.<br />
<br />
<br />
         push              $R2<br />
         push              $R1<br />
         push              $R0<br />
<br />
         /* ... */<br />
<br />
         FindWindow $R0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
         GetDlgItem $R0 $R0 1017<br />
         System::Call &quot;User32::GetWindowText(i $R0, t .R1, i 256)&quot;<br />
         SendMessage $R0 ${CB_FINDSTRINGEXACT} -1 &quot;STR:$R1&quot; $R1<br />
         SendMessage $R0 ${CB_GETCOUNT} 0 0 $R2<br />
         IntOp $R2 $R2 - 1<br />
         IntCmp $R1 $R2 +2<br />
            MessageBox MB_OK &quot;Do whatever needed if this is not a custom install.&quot; <br />
         #end<br />
<br />
         /* ... */<br />
<br />
         pop               $R0<br />
         pop               $R1<br />
         pop               $R2</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st August 2007, 16:56</div></div><div class="posttext">Are you basically checking if the last item is selected then?<br />
Why not just send CB_GETCURSEL and compare the value to CB_GETCOUNT-1?<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>