<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" ${DriveSpace} and some strange values, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  ${DriveSpace} and some strange values NSIS Discussion" />
	
	<title> ${DriveSpace} and some strange values [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  ${DriveSpace} and some strange values</div>
<hr />
<div class="pda"><a href="t-321543.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=321543">${DriveSpace} and some strange values</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">orecchionebruno</div><div class="date">10th August 2010, 14:37</div></div><div class="posttext">Hi I'm sorry to write again for same problem, but I don't know how solve this problem. May some one can help me.<br />
<br />
I encounter a strange problem with some value returned by ${DriveSpace}.<br />
<br />
- I get any free space values and this values are corrected. So I get space of my C:\, E:\, D:\, H:\, etc. and any values are corrected<br />
- If I compare any values that I get by ${DriveSpace}, the conditions actions ${If} works correctly ONLY with an exception. The exception is with my E:\ value.<br />
<br />
What I want to say that a script as this, works with any drive excepeted with my &quot;E:\&quot;:<br />
<br />
${GetRoot} $MYPATH1 $1<br />
${DriveSpace} &quot;$1\&quot; &quot;/D=F /S=B&quot; $1<br />
<br />
${GetRoot} $MYPATH2 $2<br />
${DriveSpace} &quot;$2\&quot; &quot;/D=F /S=B&quot; $2&quot;<br />
<br />
${If} &quot;$MYPATH1 &quot; U&gt;= &quot;$MYPATH2&quot;<br />
MessageBox MB_OK &quot;PATH1 &gt;= PATH2&quot;<br />
${Else}<br />
MessageBox MB_OK &quot;PATH1 &lt; PATH2&quot;<br />
${EndIf}<br />
<br />
Any one have a suggestion to solve this problem? <br />
<br />
Thanksss<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">10th August 2010, 20:16</div></div><div class="posttext">You know you're performing an Unsigned Integer comparison between the paths you specify ($MYPATH1 and $MYPATH2), right?  I would suspect that you'd want to perform that comparison between the drive sizes returned by ${DriveSpace}, which you're storing in $1 and $2</div></div><hr />


<div class="post"><div class="posttop"><div class="username">orecchionebruno</div><div class="date">11th August 2010, 10:05</div></div><div class="posttext">Hi Animaether, I'm sorry upper I made a mistake translating my variables. I correct the script, but the problem that I wrote is that happens.<br />
<br />
${GetRoot} $MYPATH1 $1<br />
${DriveSpace} &quot;$1\&quot; &quot;/D=F /S=B&quot; $FreeSpace1<br />
<br />
${GetRoot} $MYPATH2 $2<br />
${DriveSpace} &quot;$2\&quot; &quot;/D=F /S=B&quot; $FreeSpace2<br />
<br />
${If} &quot;$FreeSpace1&quot; U&gt;= &quot;$FreeSpace2&quot;<br />
MessageBox MB_OK &quot;PATH1 &gt;= PATH2&quot;<br />
${Else}<br />
MessageBox MB_OK &quot;PATH1 &lt; PATH2&quot;<br />
${EndIf}<br />
<br />
Regarding the reason to use Unsigned Integer comparison with free space, this is because I obtain different results with other drives if I use it or not. <br />
<br />
For example if I compare C:\ and D:\ free space (..and both are hard disk), the comparison with Unsigned Integerworks correctly but doens't work correclty with E:\. But I make same comparison without Unsigned Integer, the good result is with E:\ but is wrong with D:\.<br />
<br />
In any case, the values that DriveSpace get are apparently correct so I mean that I can read right free space if I put that values on MessageBox. The problem is only with comparison.<br />
<br />
Now I'm reading this your suggestion:<br />
http://forums.winamp.com/showthread.php?t=321260&amp;highlight=%24{DriveSpace}<br />
and I want change way to get the free space and to compare as in that example:<br />
System::Int64Op $2 &gt; $0<br />
<br />
thankss again, I write my results<br />
Ciaoo<br />
<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">11th August 2010, 10:19</div></div><div class="posttext">Regarding the reason to use Unsigned Integer comparison with free space, this is because I obtain different results with other drives if I use it or not. <br />
<br />
For example if I compare C:\ and D:\ free space (..and both are hard disk), the comparison with Unsigned Integerworks correctly but doens't work correclty with E:\. But I make same comparison without Unsigned Integer, the good result is with E:\ but is wrong with D:\.<br />
This is an incredibly wrong reason to use Uint compare. You should use Uint compare when you have two Uints. If you have signed ints, you should obviously use signed int compare. It sounds to me like you don't know what kind of ints you have, at all. Figure that out first, THEN you'll know whether you should compare them as ints or as Uints.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">orecchionebruno</div><div class="date">11th August 2010, 10:37</div></div><div class="posttext">Thanks MSG,<br />
<br />
in effect I don't know wich values I have... :)<br />
<br />
I just get any values from {DriveSpace} and I started to use &quot;Unsigned Integer comparison&quot; for the problem that I wrote upper.<br />
<br />
So what could be the problem using {DriveSpace} values?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">orecchionebruno</div><div class="date">11th August 2010, 11:24</div></div><div class="posttext">I've found where is the problem and it looks works...<br />
<br />
if I get size in &quot;Byte&quot; the comparison give me the problem that wrote upper BUT if I get values in &quot;KiloBytes&quot; everything works.<br />
<br />
So, now the question is &quot;the problem are the quantity of numbers&quot;?<br />
<br />
PS: I forgot I used {DriveSpace}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">orecchionebruno</div><div class="date">11th August 2010, 11:25</div></div><div class="posttext">Figure that out first, THEN you'll know whether you should compare them as ints or as Uints.<br />
<br />
sorry but in my language &quot;figure&quot; could means different words so I didn't understood what you mean with this sentence.. can you please explain me this again?<br />
<br />
Thankss</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">11th August 2010, 12:41</div></div><div class="posttext">To figure something out = to find out, to learn, to investigate.<br />
<br />
First you need to know what kind of int you have (signed or unisigned, etc), THEN you can know how to use them.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th August 2010, 13:29</div></div><div class="posttext">I'm not sure why either are you are worried about the type of integer comparison test to perform in this case. Unless you've got negative disk space (lol) then you can do an unsigned integer comparison. The unsigned integer comparison here is purely to ignore the sign if one exists. Are you confusing the data type with the comparison? In NSIS integers are just strings; there are no int/uint data types.<br />
<br />
Edit: Also how about displaying the actual values in a message box? You may find that you need to do a 64-bit unsigned integer test if the value is too big.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">orecchionebruno</div><div class="date">11th August 2010, 15:46</div></div><div class="posttext">so signed and unsigned means positive or negative numbers?<br />
<br />
I write a better way this test:<br />
<br />
Drive | free space<br />
C:\ = 417290768 kb = 427305746432 byte<br />
D:\ = 443209756 kb = 453846790144 byte<br />
E:\ = 2616004 kb = 2678788096 byte<br />
H:\ = 164932 kb = 168890368 byte<br />
<br />
Method 1:<br />
<br />
section &quot;test&quot;<br />
  StrCpy $0 'C:\'<br />
;  StrCpy $1 'D:\'<br />
  StrCpy $1 'E:\'<br />
;  StrCpy $1 'H:\'<br />
<br />
  System::Call 'kernel32::GetDiskFreeSpaceExA(t, *l, *l, *l) i(r0,.r2,,.)'<br />
  System::Int64Op $2 / 1024 ;convert value in KiloByte<br />
  Pop $2<br />
  StrCpy $4 $2<br />
<br />
  System::Call 'kernel32::GetDiskFreeSpaceExA(t, *l, *l, *l) i(r1,.r2,,.)'<br />
  System::Int64Op $2 / 1024 ;convert value in KiloByte<br />
  Pop $2<br />
  StrCpy $5 $2<br />
<br />
${If} $4 U&lt; $5<br />
   MessageBox MB_OK &quot;$4 &lt; $5&quot;<br />
${Else}<br />
   MessageBox MB_OK &quot;$4 &gt; $5&quot;<br />
${EndIf}<br />
sectionend<br />
<br />
Method 2:<br />
<br />
section &quot;test&quot;<br />
  StrCpy $1 'C:\'<br />
;  StrCpy $1 'D:\'<br />
  StrCpy $1 'E:\'<br />
;  StrCpy $1 'H:\'<br />
<br />
<br />
;${DriveSpace} &quot;$0\&quot; &quot;/D=F /S=B&quot; $4 ;retrieves value in byte<br />
;${DriveSpace} &quot;$1\&quot; &quot;/D=F /S=B&quot; $5 ;retrieves value in byte<br />
${DriveSpace} &quot;$0\&quot; &quot;/D=F /S=K&quot; $4 ;retrieves value in Kilobyte<br />
${DriveSpace} &quot;$1\&quot; &quot;/D=F /S=K&quot; $5 ;retrieves value in Kilobyte<br />
<br />
${If} $4 U&lt; $5<br />
   MessageBox MB_OK &quot;$4 &lt; $5&quot;<br />
${Else}<br />
   MessageBox MB_OK &quot;$4 &gt; $5&quot;<br />
${EndIf}<br />
sectionend<br />
<br />
I made this test, and with both methods in conditional script I've obtained this result:<br />
<br />
With &quot;${If} $4 U&lt; $5&quot;:<br />
417290768 &gt; 443209756 works (also with &gt;= , &lt;, &lt;=)<br />
417290768 &gt; 2616004 Works<br />
417290768 &gt; 164932 Works<br />
<br />
427305746432 &gt; 453846790144 Works<br />
427305746432 &gt; 2678788096 Doesn't work<br />
427305746432 &gt; 168890368 Works <br />
<br />
With &quot;${If} $4 &lt; $5&quot;:<br />
417290768 &gt; 443209756 Works (also with &gt;= , &lt;, &lt;=)<br />
417290768 &gt; 2616004 Works<br />
417290768 &gt; 164932 Works<br />
<br />
427305746432 &gt; 453846790144 Doesn't work<br />
427305746432 &gt; 2678788096 works<br />
427305746432 &gt; 168890368 Works</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">11th August 2010, 16:21</div></div><div class="posttext">so signed and unsigned means positive or negative numbers?<br />
No. Google can tell you the difference between a signed and unsigned int.<br />
<br />
Afrow UK is right of course, it shouldn't really matter in this case. The reason why you're seeing different behavior between int and uint compare is that your numbers overflow the 32 bits available to NSIS (you'll find out why this is once you learn the difference between signed and unsigned, btw).<br />
<br />
You need to compare with 64 bits precision. You can do this with the system plugin (Int64Op command).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">orecchionebruno</div><div class="date">11th August 2010, 16:38</div></div><div class="posttext">Are you confusing the data type with the comparison? In NSIS integers are just strings; there are no int/uint data types.<br />
<br />
yes I am, but why If do this, teh condition say that $4 &lt; $5?: <br />
<br />
section &quot;test&quot;<br />
  StrCpy $4 427305746432<br />
  StrCpy $5 453846790144<br />
<br />
  ${If} $4 &lt; $5<br />
     MessageBox MB_OK &quot;True: $4 &lt; $5&quot;<br />
  ${Else}<br />
     MessageBox MB_OK &quot;False: $4 &gt; $5&quot;<br />
  ${EndIf}<br />
sectionend<br />
<br />
<br />
You may find that you need to do a 64-bit unsigned integer test if the value is too big.<br />
<br />
<br />
Sorry.. what I have to do? :D if you mean to do the test &quot;64-bit integer tests&quot; and &quot;Unsigned integer tests&quot; included in LogicLib.nsi, I dot it and I passed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">orecchionebruno</div><div class="date">11th August 2010, 16:41</div></div><div class="posttext">You need to compare with 64 bits precision. You can do this with the system plugin (Int64Op command).<br />
<br />
thanks now I try ...and I search</div></div><hr />


<div class="post"><div class="posttop"><div class="username">orecchionebruno</div><div class="date">11th August 2010, 17:38</div></div><div class="posttext">Thankss this way does what I expected:<br />
System::Int64Op $4 &lt; $5</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>