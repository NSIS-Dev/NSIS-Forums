<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Repeating fails, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Repeating fails NSIS Discussion" />
	
	<title> Repeating fails [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Repeating fails</div>
<hr />
<div class="pda"><a href="t-354910.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=354910">Repeating fails</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Niharika1588</div><div class="date">22nd January 2013, 18:18</div></div><div class="posttext">Hi, I want the files to be downloaded only if the user selects the file name by marking the checkbox (File name : Something). If the user doesn't select the checkbox it prompts for a message sayng &quot;Do you want to quit?&quot; If the user enters NO, then it should take to the same screen where the user will be asked to to enter his choice again.<br />
<br />
The problem is , if the user marks the checkbox first time itself everything works fine. If not the user doesn't mark the checkbox initially, later comes back and marks the checkbox. The program isn't able to identify it.<br />
<br />
I don't know the exact reason but I assume it is due the flow of program i..e initially it is done sequentially but later we are using call function to execute them.<br />
<br />
Here is my code, please let me know if you have any suggestions.<br />
<br />
/*To reduce the complexity I commented/removed the files 2 download n uninstall */<br />
<br />
!include MUI.nsh<br />
!include LogicLib.nsh<br />
!include WinMessages.nsh<br />
!include FileFunc.nsh<br />
!include nsDialogs.nsh<br />
<br />
!insertmacro MUI_LANGUAGE English<br />
<br />
DirText &quot;Please choose a directory to which you'd like to install this application.&quot;<br />
<br />
Name &quot;HUD Systems&quot;<br />
OutFile &quot;Rewrite.exe&quot;<br />
<br />
installDir &quot;C:\work\H&quot;<br />
<br />
<br />
Page custom nsDialogsWelcome <br />
Page custom nsDialogsWelcome1 nsDialogsWelcome1Leave<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
Page custom show<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
XPStyle on<br />
<br />
Var Dialog<br />
Var Label<br />
Var Text<br />
Var Text_State<br />
Var Checkbox<br />
Var Checkbox_State<br />
Var one<br />
<br />
Function .onInit<br />
	 ${NSD_SetState} $Checkbox_State ${BST_UNCHECKED}<br />
FunctionEnd<br />
<br />
Function nsDialogsWelcome<br />
<br />
	nsDialogs::Create 1044<br />
	Pop $DIALOG<br />
	<br />
	${If} $Dialog == error<br />
		Abort<br />
	${EndIf}<br />
	<br />
	${NSD_CreateLabel} 7u 7u 100% 100% &quot;Welcome &quot;<br />
	Pop $Label<br />
<br />
	${NSD_CreateLabel} 11u 14u 95% 100% &quot;Creating a label&quot;<br />
	Pop $Label<br />
<br />
	nsDialogs::Show<br />
FunctionEnd<br />
<br />
<br />
Function nsDialogsWelcome1<br />
<br />
 ${NSD_SetState} $Checkbox_State ${BST_UNCHECKED}<br />
<br />
<br />
	nsDialogs::Create 1018<br />
	Pop $Dialog<br />
	<br />
	${If} $Dialog == error<br />
		Abort<br />
	${EndIf}<br />
<br />
	${NSD_CreateLabel} 0 0 100% 12u &quot;Hello, welcome to nsDialogs!&quot;<br />
	Pop $Label<br />
<br />
	${NSD_CreateCheckbox} 0 30u 100% 10u &quot;Something&quot;<br />
	Pop $Checkbox<br />
<br />
;	${NSD_SetState} $Checkbox_State $Checkbox<br />
	${If} $Checkbox_State == ${BST_CHECKED}<br />
		${NSD_Check} $Checkbox<br />
	${EndIf}<br />
<br />
	nsDialogs::Show<br />
<br />
FunctionEnd<br />
<br />
Function nsDialogsWelcome1Leave<br />
<br />
	${NSD_GetState} $Checkbox $Checkbox_State<br />
MessageBox MB_OK &quot;The values is $Checkbox_State&quot;<br />
FunctionEnd<br />
<br />
Function show ; &quot;All zip files&quot; <br />
show1:<br />
${If} $Checkbox_State == ${BST_CHECKED}<br />
<br />
IfFileExists &quot;$INSTDIR\*.*&quot; 0 Createdir<br />
  MessageBox MB_YESNO &quot;Do you want to override this file??&quot;  IDNO no<br />
  SetOutPath &quot;$INSTDIR\deliverables&quot;<br />
 ; File client_9_6_0_0.zip<br />
  ;WriteUninstaller $INSTDIR\Uninstall.exe<br />
  ;ZipDLL::extractall &quot;$INSTDIR\deliverables&quot;\deploy_9_6_0_0.zip&quot; &quot;$INSTDIR&quot;<br />
  Goto End<br />
<br />
no:<br />
MessageBox MB_YESNO &quot;You do not want to override the files, so quitting??&quot; IDNO no1<br />
Quit<br />
<br />
no1:<br />
Goto show1<br />
<br />
CreateDir:<br />
  MessageBox MB_OK &quot;Folder does not exists, sorry we cannot copy the files.&quot;<br />
  Quit<br />
 ${Else}<br />
  MessageBox MB_YESNO &quot;You didn't select any files. Do you want to quit??&quot; IDNO no2<br />
  Quit<br />
  <br />
no2:<br />
MessageBox MB_YESNO &quot;You want to go back and select files?&quot; IDNO Q<br />
Call nsDialogsWelcome1<br />
Call nsDialogsWelcome1Leave<br />
Call show<br />
${EndIf}<br />
 <br />
Q:<br />
Quit<br />
<br />
End:<br />
FunctionEnd <br />
<br />
Section &quot;ABC&quot;<br />
Strcpy $one 0<br />
SectionEnd<br />
 <br />
Section &quot;Uninstall&quot;<br />
RMDir $INSTDIR<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">22nd January 2013, 20:20</div></div><div class="posttext">You cannot call a page function manually. You can only page creation functions with the page custom command.<br />
<br />
To get back to the page, call 'abort' in the page's leave function. So in your case, move your messageboxes to the leave function, and call abort if the user wants to go back to the page.<br />
<br />
(Notice that your second messagebox is kind of stupid. You first ask 'quit yes/no', then if the user selects no twice, you still quit anyway. You should simply say 'please select some files', then call abort immediately. If the user wants to quit, he/she can click the Cancel button.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Niharika1588</div><div class="date">23rd January 2013, 16:48</div></div><div class="posttext">Yeah I tried. But it's just quitting the program.<br />
<br />
What I had done is modified the lines as shown below (just adding Abort and commenting the rest) :<br />
<br />
no2:<br />
Abort<br />
;MessageBox MB_YESNO &quot;You want to go back and select files?&quot; IDNO Q<br />
;Call nsDialogsWelcome1<br />
;Call nsDialogsWelcome1Leave<br />
;Call show<br />
<br />
I want the program to go back to the screen with checkbox and if checkbox is marked it should update it's value to 1, indicating that the user needs to download the file</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">23rd January 2013, 18:19</div></div><div class="posttext">I already told you, you need to call abort in the leave function, not in the show function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Niharika1588</div><div class="date">23rd January 2013, 20:36</div></div><div class="posttext">Oh sorry I didn't go through it properly.<br />
That worked thank you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">24th January 2013, 09:48</div></div><div class="posttext">No problem. :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>