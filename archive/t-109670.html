<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" substitute stings in files, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  substitute stings in files NSIS Discussion" />
	
	<title> substitute stings in files [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  substitute stings in files</div>
<hr />
<div class="pda"><a href="t-109670.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=109670">substitute stings in files</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">13th October 2002, 18:17</div></div><div class="posttext">I want to make nsis open a file, look for a string, and substitute that for another one of different lenth. I am trying to work with those file commands but I can't make them do what I want, could anyone help me? thanks:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th October 2002, 18:49</div></div><div class="posttext">Have a look at this example:<br />
http://www.clantpa.co.uk/nsis/wiki/index.php/FileRead<br />
<br />
Instead of:<br />
StrCmp $2 &quot;line to replace$\r$\n&quot; 0 +2<br />
FileWrite $1 &quot;replacement of line$\r$\n&quot;<br />
Goto loop<br />
<br />
use StrReplace and place the result in the new file.<br />
<br />
StrStr -&gt; StrReplace. Sorry, mixed those two up.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Freeman II</div><div class="date">15th October 2002, 03:00</div></div><div class="posttext">Invalid command: ReadFile<br />
Error in script &quot;C:\Program Files\NSIS\Test\test1.nsi&quot; on line 72 -- aborting creation process<br />
<br />
<br />
I tested your example but got this error message? any idea?<br />
line 72:    ReadFile $0 $2</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th October 2002, 15:58</div></div><div class="posttext">Please attach large scripts next time. Script attached here.<br />
<br />
ReadFile should be FileRead.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">15th October 2002, 16:38</div></div><div class="posttext">kichik, it worked nicely for me.<br />
<br />
It's nice piece of code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Freeman II</div><div class="date">16th October 2002, 06:20</div></div><div class="posttext">kichik, I changed it to FileRead and it worked. However it not only replaced that line but the whole file.<br />
---original----file.txt---<br />
asdfjskdfja<br />
line to replace<br />
asdfsadf<br />
-------eof------------<br />
<br />
---result----file.txt<br />
<br />
replaced line<br />
-------eof------------<br />
<br />
----what is should be---<br />
asdfjskdfja<br />
replaced line<br />
asdfsadf<br />
-------------------------<br />
<br />
any idea what was wrong here?<br />
<br />
Also, if you have some spare time;) could you give me an example of how to replace multiple strings.<br />
ex:<br />
<br />
find: x123 replace:y123<br />
find: zsdf replace:1232<br />
<br />
Thanks for the help!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">16th October 2002, 15:06</div></div><div class="posttext">This is the script I finally use. <br />
<br />
I can assure you that it works with NSIS v1.98.<br />
<br />
It can replace two strings in a file. As you can see is as simple as adding a nested StrCmp.<br />
<br />
Another change is that instead of telling NSIS to jump two lines I added two new Labels. The original script didn't work.<br />
<br />
I put a dash in the name of the section to make it a hidden section.<br />
<br />
<br />
Here's the Section I use:<br />
<br />
<br />
Section &quot;-Change File&quot;<br />
  !define ENCINI &quot;$INSTDIR\file2change.txt&quot;<br />
  FileOpen $0 &quot;${ENCINI}&quot; r<br />
  GetTempFileName $R0<br />
  FileOpen $1 $R0 w<br />
  loop: <br />
  FileRead $0 $2<br />
  IfErrors done<br />
  StrCmp $2 &quot;first line to replace$\r$\n&quot; igual dife<br />
    igual:<br />
    FileWrite $1 &quot;replacement of first line$\r$\n&quot;<br />
    Goto loop<br />
    dife:<br />
    StrCmp $2 &quot;second line to replace$\r$\n&quot; igual2 dife2<br />
    igual2:<br />
    FileWrite $1 &quot;replacement of second line$\r$\n&quot;<br />
    Goto loop<br />
    dife2:<br />
  FileWrite $1 $2<br />
  Goto loop<br />
  done: <br />
  FileClose $0<br />
  FileClose $1<br />
  Delete &quot;${ENCINI}&quot;<br />
  CopyFiles /SILENT $R0 &quot;${ENCINI}&quot;<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th October 2002, 16:04</div></div><div class="posttext">StrCmp $2 &quot;line to replace$\r$\n&quot; 0 +2<br />
<br />
should be:<br />
<br />
StrCmp $2 &quot;line to replace$\r$\n&quot; 0 +3<br />
<br />
I think I fixed that once... =/<br />
I will reupload the script in that thread (http://forums.winamp.com/showthread.php?s=&amp;postid=630801) so it will work if anyone else tries it ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Freeman II</div><div class="date">17th October 2002, 00:31</div></div><div class="posttext">Thanks for the help, the code works great. Last question, do you know why the script generates a tmp file in the tmp dir?<br />
ex: nst37.tmp<br />
<br />
<br />
done:<br />
   FileClose $0<br />
   FileClose $1<br />
   Delete &quot;file.txt&quot; <br />
   CopyFiles /SILENT $R0 &quot;$INSTDIR\file.txt&quot;<br />
<br />
isn't it suppose to be deleted?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th October 2002, 13:38</div></div><div class="posttext">Add Delete $R0 after CopyFiles. I have updated the thread again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">19th October 2002, 14:28</div></div><div class="posttext">For the benefit of other users, I suggest to add an exemple of this in the nsis package.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pviton</div><div class="date">19th October 2002, 19:57</div></div><div class="posttext">(Completely new to nsis, so please bear with me)<br />
<br />
I notice that the answers here seem to deal with replacing a whole line of text with another. Is it possible to replace a portion of a line with some specified text? eg read a line from a file, and if it contains the string XXXX replace XXXX by YY?<br />
<br />
(Reason: I have an application that needs to create lots of batch files. These files have placeholders for user information (the replace strings), which would be supplied by the user when she installs. Is this a reasonable/possible thing to do using nsis?)<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th October 2002, 20:11</div></div><div class="posttext">http://www.clantpa.co.uk/nsis/wiki/index.php/SubstringReplacementScript<br />
<br />
This script should do the trick. Just go line by line like the ReadFile script does and instead of comparing the line to a string, use this function on it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pinku41</div><div class="date">19th October 2002, 20:17</div></div><div class="posttext">Ignore the post plz... by the time i posted my ques...it was already answered above.. :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">20th October 2002, 12:37</div></div><div class="posttext">Is there a way to use wildcards in the StrCmp instruction? because sometimes the line is not exactly the same but nsis has to replace it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th October 2002, 18:00</div></div><div class="posttext">I doubt this can be done easily using NSIS scripting. If it is not always the same you will have to search for the parts that are the same using StrStr from functions.htm.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>