<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" RichEdit with nsDialogs?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  RichEdit with nsDialogs? NSIS Discussion" />
	
	<title> RichEdit with nsDialogs? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  RichEdit with nsDialogs?</div>
<hr />
<div class="pda"><a href="t-288129.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=288129">RichEdit with nsDialogs?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">vbguy</div><div class="date">8th March 2008, 01:04</div></div><div class="posttext">I can't seem to figure out how to add a RichEdit control with nsDialogs. I've tried<br />
<br />
nsDialogs::CreateControl /NOUNLOAD RICHEDIT_CLASS ${WS_VISIBLE}|${WS_CHILD}|${WS_TABSTOP}|${WS_VSCROLL}|${ES_MULTILINE}|${ES_WANTRETURN} ${__NSD_Text_EXSTYLE} 0 10u 100% 90u ''<br />
<br />
Pop $txtLicense<br />
<br />
But nothing shows. I tried looking at the MUI2 header files, but those are no cakewalk to read. I also glanced at the nsDialogs source files, but that lead me no closer to an answer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">8th March 2008, 08:01</div></div><div class="posttext">RICHEDIT_CLASS is not the real name, try &quot;RICHEDIT&quot; or &quot;RichEdit20A&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbguy</div><div class="date">8th March 2008, 08:18</div></div><div class="posttext">Thanks, RichEdit20A worked.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bradharding</div><div class="date">11th March 2008, 08:15</div></div><div class="posttext">Hi!<br />
<br />
Now that I know how to create a richedit control using nsDialogs - thanks for that - how would I go about loading an .rtf file into the control using the system plugin?<br />
<br />
Thanks in advance.<br />
<br />
Brad.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">11th March 2008, 11:04</div></div><div class="posttext">http://forums.winamp.com/showthread.php?postid=1812482#post1812482</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bradharding</div><div class="date">11th March 2008, 11:27</div></div><div class="posttext">Thanks for your response, Anders.<br />
<br />
The thread you've linked to though has example code that, as best as I can tell, only streams text into the control. Is there any [easy] way to load an actual Rich Text File into the control? I've tried googling for a Windows API command that can do it, but with no luck...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">11th March 2008, 11:37</div></div><div class="posttext">its the same message (http://msdn2.microsoft.com/en-us/library/bb774302(VS.85).aspx )<br />
<br />
just use SF_RTF (2)<br />
<br />
and easy? there is no such thing when the system plugin is involved ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bradharding</div><div class="date">11th March 2008, 11:45</div></div><div class="posttext">Thanks again! I'll give it a go.... :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbguy</div><div class="date">11th March 2008, 12:51</div></div><div class="posttext">I just use this to load the RTF data. The article states '.txt' files, but RTF are just text files with funky formatting.<br />
<br />
http://nsis.sourceforge.net/External_License_file<br />
<br />
Also, if you want a thin border on the RichEdit box, just use the WS_EX_STATICEDGE flag instead of __NSD_Text_EXSTYLE.<br />
<br />
Here's the full code I use:<br />
<br />
;License textbox (rich text)<br />
<br />
nsDialogs::CreateControl /NOUNLOAD &quot;RichEdit20A&quot;  ${WS_VISIBLE}|${WS_CHILD}|${WS_CLIPSIBLINGS}|${WS_TABSTOP}|${ES_READONLY}|${WS_VSCROLL}|${ES_MULTILINE}|${ES_WANTRETURN} ${WS_EX_STATICEDGE} 0 10u 100% 90u ''<br />
<br />
Pop $txtLicense<br />
	<br />
;load the license from file<br />
!insertmacro addLicense</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bradharding</div><div class="date">11th March 2008, 22:36</div></div><div class="posttext">Thanks for your help, vbguy! Here's my code:<br />
<br />
  <br />
  nsDialogs::CreateControl /NOUNLOAD &quot;RichEdit20A&quot; ${WS_VISIBLE}|${WS_CHILD}|\<br />
    ${WS_TABSTOP}|${WS_VSCROLL}|${ES_MULTILINE}|\<br />
    ${ES_WANTRETURN} ${WS_EX_STATICEDGE} 0 15u 100% 80u &quot;&quot;<br />
  Pop $CONTROL<br />
  File &quot;/oname=$PLUGINSDIR\Readme.rtf&quot; &quot;Resources\Readme.rtf&quot;<br />
  System::Call &quot;kernel32::CreateFile(t '$PLUGINSDIR\Readme.rtf', i ${GENERIC_READ}, \<br />
    i ${FILE_SHARE_READ}, i 0, i ${OPEN_EXISTING}, i 0, i 0) i .r0&quot;<br />
  System::Call &quot;kernel32::GetFileSize(i r0, i 0) i .r1&quot;<br />
  MessageBox MB_OK &quot;$1&quot;<br />
  IntOp $1 $1 + 1<br />
  System::Alloc $1<br />
  Pop $2<br />
  System::Call &quot;kernel32::ReadFile(i r0, i r2, i r1, *i .r3, i 0)&quot;<br />
  System::Call &quot;kernel32::CloseHandle(i r0)&quot;<br />
  SendMessage $CONTROL ${WM_SETTEXT} $CONTROL $2<br />
  System::Free $2<br />
 <br />
<br />
Unfortunately, it doesn't display all of the RTF file. I'm guessing this is because of the value that GetFileSize returns, and the additional bytes used for the formatting of the RTF file. I tried using EM_STREAMIN as Anders suggested, but I'm completely lost with that bit of code.... Any further ideas?<br />
<br />
Brad.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbguy</div><div class="date">11th March 2008, 22:52</div></div><div class="posttext">You need to replace the hwnd to point to your added text box (or rich text box):<br />
<br />
<br />
Var txtLicense ;textbox handle<br />
Var LicFile ;pointer to the license file in memory<br />
<br />
!macro addLicense<br />
	${If} $LicFile == &quot;&quot;<br />
		ClearErrors<br />
		System::Call 'kernel32::CreateFile(t &quot;$PLUGINSDIR\\EULA.rtf&quot;, i 0x80000000, i 1, i 0, i 3, i 0, i 0) i .r0'<br />
		IfErrors exit<br />
		<br />
		;allocate memory for the file<br />
		System::Call 'kernel32::GetFileSize(i r0, i 0) i .r1'<br />
		System::Alloc $1<br />
		Pop $2<br />
		<br />
		;read the file into memory<br />
		System::Call 'kernel32::ReadFile(i r0, i r2, i r1, *i .r3, i 0)'<br />
		System::Call 'kernel32::CloseHandle(i r0)'<br />
		<br />
		Push $2			;Push the License memory location to stack<br />
		Pop $LicFile ;Pop the License memory loc to the variable LicFile<br />
	${EndIf}<br />
	<br />
	;White background, black text<br />
	SetCtlColors $txtLicense 0x000000 0x00FFFFFF<br />
	<br />
	SendMessage $txtLicense ${WM_SETTEXT} 0 $LicFile<br />
<br />
	exit:<br />
!macroend<br />
<br />
<br />
<br />
Then, deallocate the memory when the installer closes:<br />
<br />
<br />
Function .onGUIEnd<br />
	System::Free $LicFile ;clear the memory allocated for the license file<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">11th March 2008, 23:01</div></div><div class="posttext">vbguy: you can't use WM_SETTEXT, it seems to work for some simple rtf files, but not everything</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bradharding</div><div class="date">11th March 2008, 23:11</div></div><div class="posttext">Thanks for your help guys.<br />
<br />
Anders, any chance you could give us some example code that streams an .rtf file into a richtext control using EM_STREAMIN? Please? Before I lose any more hair? :eek:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">11th March 2008, 23:39</div></div><div class="posttext">no, can't make it work, I end up with the same problem as WM_SETTEXT, the file will not load 100%</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbguy</div><div class="date">11th March 2008, 23:41</div></div><div class="posttext">Originally posted by Anders <br />
vbguy: you can't use WM_SETTEXT, it seems to work for some simple rtf files, but not everything  <br />
<br />
You're right, it would likely fail if embedded images. I'd also like to see an example using streaming (if you have time).<br />
<br />
Edit: Where in the MUI2 code is the RTF data loaded for the standard license page? Is it done using a C/C++ plugin, or is the file loaded using NSIS code?<br />
<br />
Couldn't we just hijack the default code and apply it to the newly created RichEdit box?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bradharding</div><div class="date">12th March 2008, 00:20</div></div><div class="posttext">Fixed! It's always something simple that's causing the problem isn't it?<br />
<br />
All you have to do is use EM_EXLIMITTEXT to set the size of the rich text control!<br />
<br />
  ; Show the License.<br />
  nsDialogs::CreateControl /NOUNLOAD &quot;RichEdit20A&quot; ${WS_VISIBLE}|${WS_CHILD}|${WS_TABSTOP}|${WS_VSCROLL}|${ES_MULTILINE}|\<br />
    ${ES_WANTRETURN} ${WS_EX_STATICEDGE} 0 15u 100% 80u &quot;&quot;<br />
  Pop $CONTROL<br />
  File &quot;/oname=$PLUGINSDIR\${GNU_GENERAL_PUBLIC_LICENSE}.rtf&quot; &quot;Resources\${GNU_GENERAL_PUBLIC_LICENSE}.rtf&quot;<br />
  System::Call &quot;kernel32::CreateFile(t '$PLUGINSDIR\${GNU_GENERAL_PUBLIC_LICENSE}.rtf', i ${GENERIC_READ}, \<br />
    i ${FILE_SHARE_READ}, i 0, i ${OPEN_EXISTING}, i 0, i 0) i .r0&quot;<br />
  System::Call &quot;kernel32::GetFileSize(i r0, i 0) i .r1&quot;<br />
  IntOp $1 $1 + 1<br />
  System::Alloc $1<br />
  Pop $2<br />
  System::Call &quot;kernel32::ReadFile(i r0, i r2, i r1, *i .r3, i 0)&quot;<br />
  System::Call &quot;kernel32::CloseHandle(i r0)&quot;<br />
  SendMessage $CONTROL ${EM_EXLIMITTEXT} 0 $1<br />
  SendMessage $CONTROL ${WM_SETTEXT} 0 $2<br />
  System::Free $2</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">12th March 2008, 00:55</div></div><div class="posttext">that changes nothing, thats only the length, even a rtf file less than 300bytes will not load, atleast not for me</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bradharding</div><div class="date">12th March 2008, 00:59</div></div><div class="posttext">That's strange. The RTF file I'm using is about 58Kb. Without sending that EM_EXLIMITTEXT message, it wouldn't display the last quarter of the file. With the message, it displays it fine.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbguy</div><div class="date">12th March 2008, 01:02</div></div><div class="posttext">Originally posted by Anders <br />
that changes nothing, thats only the length, even a rtf file less than 300bytes will not load, atleast not for me  <br />
<br />
I just tested your file with the WM_SETTEXT method, and it works for me (even without EM_EXLIMITTEXT message).<br />
<br />
Thanks, bradharding, for finding that flag.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">12th March 2008, 01:30</div></div><div class="posttext">alright, I think this works<br />
!define SF_RTF 2<br />
!define EM_STREAMIN 1097<br />
!define EM_EXLIMITTEXT 1077<br />
Function lic<br />
FileOpen $4 &quot;test.rtf&quot; r<br />
FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
GetDlgItem $0 $0 1000<br />
SendMessage $0 ${EM_EXLIMITTEXT} 0 0x7fffffff<br />
System::Get /NoUnload &quot;(i, i .R0, i .R1, i .R2) iss&quot;<br />
Pop $2<br />
System::Call /NoUnload &quot;*(i 0, i 0, k r2) i .r3&quot;<br />
System::Call /NoUnload &quot;user32::SendMessage(i r0, i ${EM_STREAMIN}, i ${SF_RTF}, i r3) i.s&quot;<br />
loop:<br />
	Pop $0<br />
	StrCmp $0 &quot;callback1&quot; 0 done<br />
	System::Call /NoUnload &quot;kernel32::ReadFile(i $4, i $R0, i $R1, i $R2, i 0)&quot;<br />
	Push 0 # callback's return value<br />
	System::Call /NoUnload &quot;$2&quot;<br />
	goto loop <br />
done:<br />
System::Free $2<br />
System::Free $3<br />
FileClose $4<br />
FunctionEnd<br />
<br />
the code is a little bit longer than the WM_SETTEXT code, but it does not alloc the whole file at once, and does not know or care about the filesize at all</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbguy</div><div class="date">12th March 2008, 02:13</div></div><div class="posttext">Originally posted by Anders <br />
alright, I think this works<br />
<br />
the code is a little bit longer than the WM_SETTEXT code, but it does not alloc the whole file at once, and does not know or care about the filesize at all<br />
<br />
Sweet. Now that all this is known, maybe someone can submit it for inclusion into the nsDialogs.nsh header.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th March 2008, 20:37</div></div><div class="posttext">You should.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbguy</div><div class="date">17th March 2008, 20:10</div></div><div class="posttext">Originally posted by kichik <br />
You should.<br />
<br />
I meant to include it as a built-in part of the nsDialogs. I could include it with my own nsDialogs.nsh file, but I'd just overwrite it the next time I updated to a newer official version.<br />
<br />
Also, I think the community would benefit by having all the RichEdit particulars figured out in the nsDialogs.nsh.<br />
<br />
I didn't mean to belittle your work.<br />
<br />
If you were implying that I should do the work, then I would be glad to. I have just a couple of questions, though: <br />
<br />
1. On what version of nsDialogs.nsh do I base my work? The latest svn version, or the latest &quot;stable&quot; version?<br />
<br />
2. In what form do I post the results? A patch file or the full file?<br />
<br />
3. Where do I post the results? Here, or is there another NSIS developer forum?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th March 2008, 20:19</div></div><div class="posttext">I misread it as &quot;maybe I should submit it for inclusion&quot; and wanted to encourage you to do so by letting you know I will include it in the next version.<br />
<br />
If you wish to make the change and submit it, you should base your work on the latest nsDialogs.nsh from Subversion. But even if you don't, this is not a fundamental change, so a patch for 2.35's version won't be hard to apply.<br />
<br />
The best way is to submit a patch to patch tracker (http://sourceforge.net/tracker/?group_id=22049&amp;atid=373087), but a full file would work as well.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grundic</div><div class="date">12th May 2009, 12:45</div></div><div class="posttext">I made a test file:<br />
<br />
<br />
!include nsDialogs.nsh<br />
!include LogicLib.nsh<br />
<br />
<br />
OutFile test.exe<br />
<br />
Var Dialog<br />
Var txtLicense<br />
<br />
<br />
Page custom nsDialog<br />
<br />
Function nsDialog<br />
        nsDialogs::Create 1018<br />
	Pop $Dialog<br />
<br />
	${If} $Dialog == error<br />
		Abort<br />
	${EndIf}<br />
	<br />
	nsDialogs::CreateControl /NOUNLOAD RichEdit20A  ${WS_VISIBLE}|${WS_CHILD}|${WS_TABSTOP}|${WS_VSCROLL}|${ES_MULTILINE}|${ES_WANTRETURN} ${__NSD_Text_EXSTYLE} 0 10u 100% 90u ''<br />
        Pop $txtLicense<br />
<br />
        call lic<br />
	nsDialogs::Show<br />
	<br />
	<br />
FunctionEnd<br />
<br />
!define SF_RTF 2<br />
!define EM_STREAMIN 1097<br />
;!define EM_EXLIMITTEXT 1077<br />
Function lic<br />
         MessageBox MB_OK &quot;Inside function&quot;<br />
	FileOpen $4 &quot;test.rtf&quot; r<br />
	FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
	GetDlgItem $0 $0 1000<br />
	SendMessage $0 ${EM_EXLIMITTEXT} 0 0x7fffffff<br />
	System::Get /NoUnload &quot;(i, i .R0, i .R1, i .R2) iss&quot;<br />
	Pop $2<br />
	System::Call /NoUnload &quot;*(i 0, i 0, k r2) i .r3&quot;<br />
	System::Call /NoUnload &quot;user32::SendMessage(i r0, i ${EM_STREAMIN}, i ${SF_RTF}, i r3) i.s&quot;<br />
	loop:<br />
		Pop $0<br />
		StrCmp $0 &quot;callback1&quot; 0 done<br />
		System::Call /NoUnload &quot;kernel32::ReadFile(i $4, i $R0, i $R1, i $R2, i 0)&quot;<br />
		Push 0 # callback's return value<br />
		System::Call /NoUnload &quot;$2&quot;<br />
		goto loop<br />
	done:<br />
	System::Free $2<br />
	System::Free $3<br />
	FileClose $4<br />
FunctionEnd<br />
<br />
Section<br />
       <br />
SectionEnd<br />
 <br />
<br />
But nothing was shown in RichEdit. What am I doing wrong?<br />
Also, anybody say how can I show custom text in RichEdit without using RTF file? <br />
<br />
Thanks in advance!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grundic</div><div class="date">22nd May 2009, 11:36</div></div><div class="posttext">Okay, I find a way to display RTF with aforementioned code. But now I got another problem: if I go back to page with custom RTF, then nothing is shown is RichEdit. I've found, that <br />
<br />
		Pop $0 ; &lt;--- HERE!<br />
		MessageBox MB_OK $0<br />
		StrCmp $0 &quot;callback1&quot; 0 done<br />
		System::Call /NoUnload &quot;kernel32::ReadFile(i $4, i $R0, i $R1, i $R2, i 0)&quot;<br />
		Push 0 # callback's return value<br />
		System::Call /NoUnload &quot;$2&quot;<br />
		goto loop<br />
 <br />
<br />
Pop $0 returns 0  :cry: <br />
<br />
Can anybody help me to solve this issue?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grundic</div><div class="date">23rd May 2009, 09:01</div></div><div class="posttext">I've found an other way to solve my problem<br />
<br />
<br />
...<br />
...<br />
...<br />
<br />
Page custom CreatePageFinish<br />
<br />
...<br />
...<br />
...<br />
<br />
Function CreatePageFinish<br />
<br />
   <br />
    nsDialogs::Create /NOUNLOAD 1018<br />
    Pop $DIALOG<br />
<br />
    nsDialogs::CreateControl /NOUNLOAD RichEdit20A  ${WS_VISIBLE}|${WS_CHILD}|${WS_TABSTOP}|${WS_VSCROLL}|${ES_MULTILINE}|${ES_WANTRETURN}|${ES_READONLY} ${__NSD_Text_EXSTYLE} 0 0 100% 140 ''<br />
    Pop $RICHEDIT<br />
<br />
    CustomLicense::LoadFile &quot;License.rtf&quot; $RICHEDIT<br />
    ;Call LoadLicense<br />
            <br />
    ### Radiobuton: auto install ###<br />
	${NSD_CreateRadioButton} 1 180 450 15 &quot;Qick insall&quot;<br />
	Pop $RADIO_AUTO<br />
	${NSD_CreateRadioButton} 1 210 450 15 &quot;Custom install&quot;<br />
	Pop $RADIO_MANUAL<br />
<br />
    nsDialogs::Show<br />
FunctionEnd<br />
 <br />
<br />
Hope, it'll help someone.<br />
Here is link to the plugin: http://nsis.sourceforge.net/CustomLicense_plug-in ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">23rd May 2009, 21:50</div></div><div class="posttext">for what it's worth - I think the actual problem is that callback1 rolls over to callback2 the next time your page is generated.<br />
<br />
I'm not sure if there's an appropriate method to prevent that, but you can always make the &quot;callback1&quot; check more dynamic by Pop'ing it into a var first, then Push'ing it back onto the stack, and then compare against that var.<br />
<br />
Here's a function + macro + define (I'll post to wiki after review from smarter people):<br />
<br />
<br />
/* Check if LoadRTFincluded is defined so that LoadRTF can't be included twice */<br />
!ifndef LoadRTFincluded<br />
<br />
/*<br />
    Defines used by LoadRTF<br />
*/<br />
!ifndef SF_RTF<br />
    !define SF_RTF 2<br />
!endif<br />
!ifndef EM_STREAMIN<br />
    !define EM_STREAMIN 1097<br />
!endif<br />
!ifndef EM_EXLIMITTEXT<br />
    !define EM_EXLIMITTEXT 1077<br />
!endif<br />
<br />
/*<br />
    LoadRTF Main Function<br />
    Inserted via macro for Installer vs Uninstaller<br />
<br />
    Loads an RTF file into a RichEdit20a control<br />
<br />
    Thanks to Anders for all the heavy work<br />
    Define/Macro/Functionfication and a CallbackN tweak by Animaether<br />
<br />
    Usage:<br />
        Push Path-to-RTF-file<br />
        Push HWND-of-RichEdit20A-control<br />
        Call LoadRTF<br />
<br />
        -or for uninstallers-<br />
        Call un.LoadRTF<br />
*/<br />
!macro LoadRTFfunc Un<br />
Function ${Un}LoadRTF<br />
                            ; RichEdit20A.hwnd RTFilePath.string<br />
    Exch $0                 ; $0 RTFilePath.string                  ; $0 = RichEdit20A.hwnd<br />
    Exch                    ; RTFilePath.string $0<br />
    Exch $1                 ; $1 $0                                 ; $1 = RTFilePath.string<br />
    Push $2                 ; $2 $1 $0                              ; $2 : Callback address<br />
    Push $3                 ; $3 $2 $1 $0                           ; $3 : EDITSTREAM structure<br />
    Push $4                 ; $4 $3 $2 $1 $0                        ; $4 : callbackN identifier from System plugin to check against<br />
    Push $R0                ; $R0 $4 $3 $2 $1 $0                    ; $R0 : Buffer that receives data from ReadFile()<br />
    Push $R1                ; $R1 $R0 $4 $3 $@ $1 $0                ; $R1 : Maximum number of bytes to read using ReadFile()<br />
    Push $R2                ; $R2 $R1 $R0 $4 $3 $@ $1 $0            ; $R2 : Number of bytes actually read using ReadFile()<br />
<br />
    SendMessage $0 ${EM_EXLIMITTEXT} 0 0x7fffffff<br />
<br />
    System::Get &quot;(i, i .R0, i .R1, i .R2) iss&quot;<br />
    Pop $2<br />
<br />
    System::Call &quot;*(i 0, i 0, k r2) i .r3&quot;<br />
    System::Call &quot;user32::SendMessage(i r0, i ${EM_STREAMIN}, i ${SF_RTF}, i r3) i.s&quot;<br />
    Pop $4<br />
    Push $4<br />
<br />
    ClearErrors<br />
    FileOpen $1 &quot;$1&quot; r                                              ; $1 = RTFile.handle<br />
    _loop:<br />
        Pop $0                                                      ; $0 = callbackN identifier from System plugin.<br />
        StrCmp $0 &quot;$4&quot; 0 _done        ; check if System plugin's callbackN matches the stored callbackN<br />
        System::Call &quot;kernel32::ReadFile(i $1, i $R0, i $R1, i $R2, i 0)&quot;<br />
        Push 0 # callback's return value<br />
        System::Call &quot;$2&quot;<br />
        goto _loop<br />
    _done:<br />
    FileClose $1<br />
    System::Free $3<br />
    System::Free $2<br />
<br />
                            ; $R2 $R1 $R0 $4 $3 $2 $1 $0<br />
    Pop $R2                 ; $R1 $R0 $4 $3 $2 $1 $0<br />
    Pop $R1                 ; $R0 $4 $3 $2 $1 $0<br />
    Pop $R0                 ; $4 $3 $2 $1 $0<br />
    Pop $4                  ; $3 $2 $1 $0<br />
    Pop $3                  ; $2 $1 $0<br />
    Pop $2                  ; $1 $0<br />
    Pop $1                  ; $0<br />
    Pop $0                  ; -empty-<br />
FunctionEnd<br />
!macroend<br />
!insertmacro LoadRTFfunc &quot;&quot;<br />
!insertmacro LoadRTFfunc &quot;un.&quot;<br />
<br />
/*<br />
    LoadRTF Ease of use functions.<br />
<br />
    Simplifies usage of LoadRTF.<br />
<br />
    Usage:<br />
        ${LoadRTF} &quot;Path-to-RTF-file&quot; HWND-of-RichEdit20A-control<br />
        -or for uninstallers-<br />
        ${un.LoadRTF} &quot;Path-to-RTF-file&quot; HWND-of-RichEdit20A-control<br />
*/<br />
!macro LoadRTF file hwnd<br />
    Push &quot;${file}&quot;<br />
    Push ${hwnd}<br />
    Call LoadRTF<br />
!macroend<br />
!define LoadRTF `!insertmacro LoadRTF`<br />
<br />
!macro un.LoadRTF file hwnd<br />
    Push &quot;${file}&quot;<br />
    Push ${hwnd}<br />
    Call un.LoadRTF<br />
!macroend<br />
!define un.LoadRTF `!insertmacro LoadRTF.un`<br />
<br />
/* define LoadRTFincluded so that LoadRTF can't be included twice */<br />
!define LoadRTFincluded<br />
<br />
!endif<br />
<br />
<br />
Usage is pretty simple.  Presuming you have the above saved in &quot;LoadRTF.nsh&quot;:<br />
<br />
!addplugindir &quot;.&quot;<br />
!addincludedir &quot;.&quot;<br />
<br />
!include &quot;nsDialogs.nsh&quot;<br />
!include &quot;winmessages.nsh&quot;<br />
!include &quot;logiclib.nsh&quot;<br />
!include &quot;MUI2.nsh&quot;<br />
<br />
!include &quot;LoadRTF.nsh&quot;<br />
<br />
OutFile &quot;test.exe&quot;<br />
<br />
var dialog<br />
var hwnd<br />
var null<br />
<br />
Page custom null ; just for testing<br />
Page custom test<br />
Page custom null ; just for testing<br />
<br />
Function .onInit<br />
    InitPluginsDir<br />
FunctionEnd<br />
<br />
var RichEditControl<br />
Function test<br />
    nsDialogs::Create 1018<br />
        Pop $dialog<br />
<br />
    nsDialogs::CreateControl &quot;RichEdit20A&quot; \<br />
        &quot;${DEFAULT_STYLES}|${WS_TABSTOP}|${WS_VSCROLL}|${ES_MULTILINE}|${ES_READONLY}&quot; \<br />
        &quot;${WS_EX_WINDOWEDGE}|${WS_EX_CLIENTEDGE}&quot; \<br />
        0 0 100% 100% &quot;&quot;<br />
<br />
        Pop $RichEditControl<br />
        SetOutPath &quot;$PLUGINSDIR&quot;<br />
        File &quot;helloworld.rtf&quot;<br />
        ${LoadRTF} &quot;$PLUGINSDIR\helloworld.rtf&quot; $RichEditControl<br />
<br />
    nsDialogs::Show<br />
FunctionEnd<br />
<br />
Function null<br />
    nsDialogs::Create 1018<br />
        Pop $dialog<br />
<br />
    ${NSD_CreateLabel} 0 0 100% 8% &quot;Dummy page.&quot;<br />
        Pop $null<br />
<br />
    nsDialogs::Show<br />
FunctionEnd<br />
<br />
Section<br />
SectionEnd<br />
<br />
<br />
*crosses fingers*</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grundic</div><div class="date">25th May 2009, 10:53</div></div><div class="posttext">I've found more easy way (see my next post) to fix probkem with RTF.<br />
But thanks anyway :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">25th May 2009, 12:14</div></div><div class="posttext">I know - it's just there for completeness sake and for those who can't, or don't want to, rely on plugins :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">chetanphanse</div><div class="date">1st July 2013, 16:32</div></div><div class="posttext">I want to show some rich text in a Label that does not come from any file. Soemthing like<br />
<br />
This is bold and this is in italics and this is underlined.<br />
The text gets generated dynamically at run time, so i cant use multiple controls. Kindly suggest how can I achieve this<br />
thanks for your help</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>