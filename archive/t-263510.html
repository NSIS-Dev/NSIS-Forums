<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Store reboot flag - but where?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Store reboot flag - but where? NSIS Discussion" />
	
	<title> Store reboot flag - but where? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Store reboot flag - but where?</div>
<hr />
<div class="pda"><a href="t-263510.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=263510">Store reboot flag - but where?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">stb</div><div class="date">12th January 2007, 12:04</div></div><div class="posttext">Hi,<br />
<br />
I want to improve behaviour when reboot on install is required. Therefore I want to store the reboot flag state at the end of installation somewhere.<br />
<br />
My application can then read this entry and show the user a warning that he has to reboot first (for example).<br />
<br />
But I want that stored reboot state to be removed/changed when the user reboots the machine.<br />
<br />
I know of three possibilities:<br />
<br />
a) I create a small file which removes the stored reboot flag. This can be called by &quot;RunOnce&quot; registry key.<br />
<br />
b) I create a file &quot;has_to_reboot&quot; e.g. in INSTDIR and let Windows delete this file on startup (using mechanism similar to &quot;Delete /Rebootok&quot;).<br />
<br />
c) I use a kernel mutex. This is not stored to disk at all. Seems this is a more elegant solution.<br />
<br />
Currently I tend to use &quot;c)&quot; because it should be even safer than the disk-stored solutions.<br />
<br />
Does anyone see a problem using &quot;c)&quot; or has a better idea?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">12th January 2007, 14:19</div></div><div class="posttext">You can call RegCreateKeyEx with the system plugin and use the REG_OPTION_VOLATILE flag</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">12th January 2007, 15:46</div></div><div class="posttext">I can't see where is the big deal.<br />
If reboot is mandatory, just skip the finish page and make your installer look like most IS installers.<br />
See the attached example,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stb</div><div class="date">12th January 2007, 18:15</div></div><div class="posttext">Forcing reboot is bad, even with msgbox before. IMHO<br />
<br />
As said before I want to _improve_ my installer / user experience. ;-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">13th January 2007, 10:56</div></div><div class="posttext">I want to _improve_ my installer / user experience.Ah! forgive me, I wasn't focused to this point of view, I was just focused to the practical side :)<br />
Sounds great user experience!<br />
Forcing reboot is bad, even with msgbox before.Seems that none told that to IS developers thru past 10 years, in several IS versions!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">13th January 2007, 19:20</div></div><div class="posttext">Originally posted by stb <br />
I want to store the reboot flag state at the end of installation somewhere.<br />
<br />
My application can then read this entry and show the user a warning that he has to reboot first (for example).<br />
<br />
But I want that stored reboot state to be removed/changed when the user reboots the machine.<br />
 <br />
I suggest you have the installer write the current boottime to a registry key where you have your other application information stored. (If your application doesn't have any registry info, create a key under HKEY_LOCAL_MACHINE\SOFTWARE\your_company\your_application). Then when your application starts it checks the boottime against that key and (if necessary) alerts the user that they must reboot before running the app. If they have rebooted, you could delete the registry key and won't need to check it again for future executions of your app. <br />
<br />
Microsoft says the boottime can be determined by running &quot;net statistics server&quot; (http://support.microsoft.com/kb/555737) and scan the string produced for the line starting &quot;Statistics since&quot;. On my system (XP SP2) that value looks like it matches the registry string in HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Prefetcher\StartTime. If that value is good for other versions of Windows, you might be able to read that instead of doing the &quot;nsExec::ExecToStack&quot; with the Net command and parsing through the output.<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stb</div><div class="date">14th January 2007, 14:51</div></div><div class="posttext">@demiller9: Thanks for contributing another method. I think it is more error-prone than the other solutions. <br />
<br />
IMHO kernel mutex is the best one: It is quite easy to use, has no problem with windows versions, does not store anything to the disk and does use widely used techniques (so MS will less probably disable it or insert bugs into it). The only draw back I can see is the kernel mutex format for Multi processor machines on Win2003 and higher (this &quot;Global\&quot; thing) -- so one has to make a differentiation between old (95) and new (2003) Windows versions. But I'm getting quite theoretical here...<br />
<br />
@Red Wine: Sorry for flaming a bit, but IMO InstallShield is no ideal. Not for this reboot thing and not for many other reasons. It may be practical for the developer to make a simple &quot;MsgBox + Reboot&quot; command. The only advantage I can see is: you can be very sure the user reboots before executing the software. But I can see grave disadvantages:<br />
<br />
- What about silent installation? Silent reboot? :-(<br />
<br />
- Most users do not really read those texts and messages on the screen because we (developers) show to much silly and superfluous texts -- especially in installers. Many people just click on &quot;next&quot; buttons.<br />
<br />
- There are some users who do work with their machine. They have documents open and maybe shutdown/reboot their machine very seldom. They like software which can be installed and run directly. They might expect your installer to perform this way. And if a reboot is required they would like to continue working and try the new software later (e.g. next day). Please be aware that there are end users who will lose their work due to &quot;forced&quot; reboots.<br />
<br />
Have a look at the WinXp security update: If you install those updates they almost always require a reboot. If you decline to reboot at once the message will minimize to tray. IMHO this is good. Every 15 minutes the message box will popup again. IMHO this is crap. I want to decide for myself when to reboot. It's funny that Microsoft needs multiple weeks, monthes or years to create a patch, and that it takes something like a month to get deployed but when it is on the machine you have to decline rebooting every 15 minutes.<br />
<br />
Nevertheless: Thanks for all contributions.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">14th January 2007, 15:11</div></div><div class="posttext">Yeah, after all &quot;do it the way like&quot; is the entire meaning of Nullsoft Scriptable Install System!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>