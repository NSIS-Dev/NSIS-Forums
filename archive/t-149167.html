<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Copy file - Register dll - Shared counter, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Copy file - Register dll - Shared counter NSIS Discussion" />
	
	<title> Copy file - Register dll - Shared counter [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Copy file - Register dll - Shared counter</div>
<hr />
<div class="pda"><a href="t-149167.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=149167">Copy file - Register dll - Shared counter</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">ACEMCP</div><div class="date">14th September 2003, 12:07</div></div><div class="posttext">I tried to rewrite sunjammers code about &quot;Upgrade a DLL&quot; (http://nsis.sourceforge.net/archive/nsisweb.php?page=21&amp;instances=0,11)... His prg snippet is an macro, but I want to write Function if possible because I have to install lot of dll... I added more functionality, shared files counter handler from Add a shared DLL (http://nsis.sourceforge.net/archive/nsisweb.php?page=18&amp;instances=0,11)<br />
<br />
First, I Push the parameters from the macro, then I pop the parameters, and do what I need from the function.<br />
<br />
I am using this include file for this functionality:<br />
<br />
attach large scripts. attached below :down:<br />
<br />
If I try to compile i got a next error message:<br />
GetDLLVersionLocal: error reading version info from &quot;$LOCALFILE&quot;<br />
!include: error in script: &quot;Include\Installer.nsi&quot; on line 52<br />
Error in script &quot;E:\Fejlesztes\ACE Mega CoDecS Pack\ACE Mega CoDecS Pack.nsi&quot; on line 6 -- aborting creation process<br />
<br />
I think error caused by $LOCALFILE variable, because If I remmark this line, the compiler stops next where $LOCALFILE appear...<br />
What I did wrong?<br />
Please help me!<br />
<br />
Best regards,<br />
ACEMCP</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">14th September 2003, 12:15</div></div><div class="posttext">I wrote that macro.<br />
<br />
You are mising up run-time and compile time. GetDLLVersionLocal gets the version of a DLL on the compiler system (the DLL that will be included), so you can never use a run-time variable.<br />
<br />
Always increasing the shared item count is also not a good idea. For example, it should not be increased when reinstalling.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th September 2003, 12:21</div></div><div class="posttext">Do not copy and paste large scripts, attach them. This helps the forum stay clean and easy to read. The forum provides a vast database of questions and answers regarding NSIS, so it's important it stays clean and easy to read so users may easily find the answer they are looking for.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ACEMCP</div><div class="date">14th September 2003, 12:48</div></div><div class="posttext">Sorry kichik!<br />
<br />
Dear Joost!<br />
Are there any way to solve this problem? I want to use this intelligent update feature for about 200 dlls. I think macro method makes the installer lot bigger.<br />
How can I determine users run as installer or reinstaller? Enough to watch HKLM\Software\${PRODUCT} exist or there are another better sollution?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">14th September 2003, 13:01</div></div><div class="posttext">Indeed, checking files or registry keys is a good solution.<br />
<br />
You should use compile-time defines for GetDLLVersionLocal.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">blayde</div><div class="date">14th September 2003, 13:03</div></div><div class="posttext">Yeah, you could store it in the reg' and remove the entry at uninstall.  you chould also check if the file(s) your installing already exist and need replacing.<br />
<br />
eg<br />
http://nsis.sourceforge.net/Docs/AppendixC.html#C.4</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ACEMCP</div><div class="date">14th September 2003, 13:20</div></div><div class="posttext">So I have to build dll table with define command like this:<br />
!define aaadll aaa.dll<br />
!define baadll baa.dll<br />
etc<br />
to add all the filename information to the script? Then I can use it compile time?Is it a right sollution? Or macro the whole Upgrade a DLL - at about 200 times?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ACEMCP</div><div class="date">20th September 2003, 15:02</div></div><div class="posttext">Dear Joost!<br />
I switched back to macro, because using function this are is an stupid move :o)<br />
<br />
I tried to add more functionality: Register dll, Shared counter <br />
<br />
Register dll already implemented, but I may help for shared file counter:<br />
there are a variable:<br />
var INSTALLCOUNT<br />
<br />
in the begening of installation:<br />
<br />
  ReadRegDWORD $INSTALLCOUNT HKLM &quot;Software\${PRODUCT}&quot; &quot;Installer Counter&quot; ; increase for every installation<br />
                                                                            ; decreased every uninstallation<br />
  IntOp $INSTALLCOUNT $INSTALLCOUNT + 1<br />
  WriteRegDWORD HKLM &quot;Software\${PRODUCT}&quot; &quot;Installer Counter&quot; $INSTALLCOUNT<br />
<br />
I increase every time,<br />
<br />
(of course deinstallation remove at all)<br />
<br />
When I installing files, I use this method<br />
If file non exist shared dll counter be 1<br />
If file exist but my program first installed (Installer Counter==1) shared dll counter Increased by 1<br />
If file exist but my program already installed (Installer Counter&gt;1) No increment.<br />
If file exist and no (or 0) value of shared dll counter, the shared dll counter be 2.<br />
Uninstall:<br />
Uninstallation always decrease counter, and file and counter removed if reached 0...<br />
<br />
This is the right sollution? Or you have better one?<br />
<br />
ACEMCP</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">20th September 2003, 15:08</div></div><div class="posttext">For the shared DLL count, a separate function is available. You should also call it on a new installion (check whether installion files or registry keys exist).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ACEMCP</div><div class="date">20th September 2003, 15:18</div></div><div class="posttext">But what is the matter if files exist but the file's sharedDLLs counter is 0 or non exist?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>