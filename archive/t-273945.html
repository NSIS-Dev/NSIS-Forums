<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Refresh *.ini, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Refresh *.ini NSIS Discussion" />
	
	<title> Refresh *.ini [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Refresh *.ini</div>
<hr />
<div class="pda"><a href="t-273945.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=273945">Refresh *.ini</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">aemik</div><div class="date">6th July 2007, 08:20</div></div><div class="posttext">Hello,<br />
<br />
I have following problem...<br />
<br />
I have a costum MUI Page with a list of some software that have to be installed.<br />
I check some Reg Strings to see if the software is installed or not. When the software is not installed you can click a button and install it now.<br />
<br />
Now I need a refresh button for this costum page, to show that the software is now installed. Is this possible???</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th July 2007, 10:22</div></div><div class="posttext">When the page is already displayed, you cannot edit the INI. InstallOptions won't reload the INI while the page is showing. You'd have to use Windows messages or instructions like ShowWindow and EnableWindow to edit the page. How exactly does the page show the software is installed?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aemik</div><div class="date">6th July 2007, 10:41</div></div><div class="posttext">The page looks like this:<br />
<br />
Software 1    &quot;not installed&quot;     Button (Install now)<br />
Software 2    &quot;installed&quot;         Button (disabled)<br />
Software 3    &quot;installed&quot;         Button (disabled)<br />
<br />
When I click on the Installbutton I can install the software. <br />
I need a refresh function to show that the software is now installed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th July 2007, 10:44</div></div><div class="posttext">But what is &quot;software 1 installed&quot;? Is it a label? If it is, simply get its HWND by reading it from the INI and send it WM_SETTEXT. See Examples\InstallOptions\testnotify.nsi for a working example of such an operation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aemik</div><div class="date">6th July 2007, 11:18</div></div><div class="posttext">&quot;Software 1&quot; is a label<br />
&quot;not installed&quot; is a label<br />
&quot;Button (Install now)&quot; is a button</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th July 2007, 11:23</div></div><div class="posttext">Then modify the second label using SendMessage as explained above.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aemik</div><div class="date">6th July 2007, 11:33</div></div><div class="posttext">I dont undertstand winmessages.nsh. What is it good for?? Ive read the docu but i dont know how to use these commands.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th July 2007, 11:57</div></div><div class="posttext">It contains definitions like WM_SETTEXT.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Galatea</div><div class="date">8th November 2007, 16:06</div></div><div class="posttext">I have nearly the same problem, i try to do some checks and want to disply it by checkboxes.<br />
<br />
but its only updated on the end of the function.<br />
Its it possible to get a refresh of the UI after the send message command?<br />
<br />
<br />
Function CustomLeave<br />
GetDlgItem $R0 $HWNDPARENT 1<br />
EnableWindow $R0 0<br />
   readinistr $2 '$PLUGINSDIR\systemcheck.ini' 'Field 4' 'HWND'<br />
   SendMessage $2 ${BM_SETCHECK} 1 0<br />
   Sleep 1000<br />
<br />
   readinistr $2 '$PLUGINSDIR\systemcheck.ini' 'Field 5' 'HWND'<br />
   SendMessage $2 ${BM_SETCHECK} 1 0<br />
   Sleep 1000<br />
...<br />
...<br />
EnableWindow $R0 1<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th November 2007, 17:22</div></div><div class="posttext">That piece of code looks fine and should update the display by checking the check boxes. There must be something else in the script preventing it from actually happening. Attach the complete script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Galatea</div><div class="date">9th November 2007, 08:59</div></div><div class="posttext">!insertmacro MUI_PAGE_WELCOME<br />
Page custom CustomShow CustomLeave<br />
!insertmacro MUI_PAGE_LICENSE License.rtf<br />
.<br />
.<br />
.<br />
Function CustomShow <br />
    GetDlgItem $R0 $HWNDPARENT 1<br />
    SendMessage $R0 ${WM_SETTEXT} 1 &quot;STR:Check&quot;<br />
    !insertmacro MUI_HEADER_TEXT &quot;System Check&quot; &quot;Checking System requirements&quot;<br />
    !insertmacro INSTALLOPTIONS_DISPLAY &quot;systemcheck.ini&quot; <br />
FunctionEnd<br />
<br />
Function CustomLeave<br />
  GetDlgItem $R0 $HWNDPARENT 1<br />
  EnableWindow $R0 0<br />
  ;TODO check WinVersion<br />
<br />
   readinistr $2 '$PLUGINSDIR\systemcheck.ini' 'Field 4' 'HWND'<br />
   SendMessage $2 ${BM_SETCHECK} 1 0<br />
   Sleep 1000<br />
<br />
  ;TODO check browser<br />
   readinistr $2 '$PLUGINSDIR\systemcheck.ini' 'Field 5' 'HWND'<br />
   SendMessage $2 ${BM_SETCHECK} 1 0<br />
   Sleep 1000<br />
<br />
    !insertmacro IsUserAdmin $0<br />
    IntCmp $0 1 Ok AdminWarning<br />
    AdminWarning:<br />
        MessageBox MB_OK &quot;You have no administration rights on this PC$\nAsk the Administrator for more information.&quot;<br />
        Abort<br />
    OK:<br />
        readinistr $2 '$PLUGINSDIR\systemcheck.ini' 'Field 6' 'HWND'<br />
        SendMessage $2 ${BM_SETCHECK} 1 0<br />
   Sleep 1000<br />
	MessageBox MB_OK &quot;DEBUG:STOP&quot;<br />
EnableWindow $R0 1<br />
FunctionEnd<br />
<br />
systemcheck.ini:<br />
[Settings]<br />
NumFields=6<br />
<br />
[Field 1]<br />
Type=Label<br />
Left=107<br />
Top=73<br />
Right=187<br />
Bottom=82<br />
Text=Administrator rights<br />
<br />
[Field 2]<br />
Type=Label<br />
Left=107<br />
Top=52<br />
Right=187<br />
Bottom=61<br />
Text=Browser (IE 7)<br />
<br />
[Field 3]<br />
Type=Label<br />
Left=107<br />
Top=33<br />
Right=187<br />
Bottom=42<br />
Text=Windows Version<br />
<br />
[Field 4]<br />
Type=CheckBox<br />
Left=91<br />
Top=32<br />
Right=107<br />
Bottom=42<br />
Flags=DISABLED|NOTIFY<br />
<br />
[Field 5]<br />
Type=CheckBox<br />
Left=91<br />
Top=52<br />
Right=107<br />
Bottom=62<br />
Flags=DISABLED|NOTIFY<br />
<br />
[Field 6]<br />
Type=CheckBox<br />
Left=91<br />
Top=72<br />
Right=107<br />
Bottom=82<br />
Flags=DISABLED|NOTIFY<br />
<br />
The checkboxes are disabled, they should be only statusdisplay, not selectabel by user.<br />
Also on enabled they will not updated after setting, seperate labels so the text is black instead of greyout.<br />
<br />
Macro &quot;IsUserAdmin&quot; is copied from http:// nsis.sourceforge.net /Check_if_the_current_user_is_an_Administrator<br />
<br />
The window will be updated at the end of function, when the Messagebox is displayed, <br />
but i need a update before every sleep</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th November 2007, 10:37</div></div><div class="posttext">You can't both sleep and update the screen. The function must return in order for the message loop to process drawing of the dialog.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Galatea</div><div class="date">9th November 2007, 12:48</div></div><div class="posttext">thanx for the fast answer.<br />
<br />
If I return after the first check i need another user interaction, is it possible to triger it automatical again? so i can count it how often it is called and jumps out after last loop.<br />
<br />
or any other idea how to implements a step-by-step display without interaction?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">9th November 2007, 13:20</div></div><div class="posttext">You would really need to write a plug-in in C/C++ to do this. For example, create a dialog in your Visual Studio designer and then modify it asynchronously in another thread at run time. This is basically how the LockedList plug-in works with a dynamically updated list box.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>