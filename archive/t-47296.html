<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem: Win2k/WinXP registry changes, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem: Win2k/WinXP registry changes NSIS Discussion" />
	
	<title> Problem: Win2k/WinXP registry changes [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem: Win2k/WinXP registry changes</div>
<hr />
<div class="pda"><a href="t-47296.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=47296">Problem: Win2k/WinXP registry changes</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Uhop</div><div class="date">17th April 2001, 00:29</div></div><div class="posttext">Here goes obligatory &quot;I love NSIS!&quot; :). It is great! I tried several tools and this one is the best for small downloadable components. It is lightweight, feature rich, easy to use for developer, and intuitive for end user. Did I mention it produces really small code? ;)<br />
<br />
Now it goes.<br />
<br />
Win2k/WinXP has a significant change in registry handling: HKLM/HKCU pairing is introduced. MSDN article The HKEY_CLASSES_ROOT Key (http://msdn.microsoft.com/library/psdk/winbase/regapi_18l5.htm) shows how it is done (automatically) for HKCR.<br />
<br />
Some other parts of HKLM/HKCU are paired as well. The idea is: if user doesn't have permission to change HKLM entries, he/she can do it in HKCU. In this case it will be introduced on per user basis instead of global change.<br />
<br />
E.g., it is possible to set up ActiveX for specific user without admin privileges (==poor corporate user). All you got to do is to use HKCU\Software\Classes instead of HKLM/Software/Classes and so on. Well, it is covered by HKCR.<br />
<br />
The same goes for Uninstall information. Use HKCU\Software\Microsoft\Windows\CurrentVersion\Uninstall instead of HKLM\ditto. It works all right on Win2k/WinXP. It works (?!) on NT4. It doesn't work on Win9X (95-ME).<br />
<br />
Problem: I need some way to fall back to HKCU root, if I was not able (OS limitation? security? user's desire?) to use HKLM.<br />
<br />
Q&amp;D solution I made: I wrote a program, which creates file, if there is no corresponding key in HKLM and we are running Win2k/WinXP. I use it like this:<br />
<br />
<br />
; Cleanup uninstall registry<br />
DeleteRegKey HKEY_LOCAL_MACHINE &quot;Software\Microsoft\Windows\CurrentVersion\<br />
   Uninstall\Sample&quot;<br />
DeleteRegKey HKEY_CURRENT_USER &quot;Software\Microsoft\Windows\CurrentVersion\<br />
   Uninstall\Sample&quot;<br />
; Write uninstall registry<br />
WriteRegStr HKEY_LOCAL_MACHINE &quot;Software\Microsoft\Windows\CurrentVersion\<br />
   Uninstall\Sample&quot; &quot;DisplayName&quot; &quot;Sample&quot;<br />
WriteRegStr HKEY_LOCAL_MACHINE &quot;Software\Microsoft\Windows\CurrentVersion\<br />
   Uninstall\Sample&quot; &quot;UninstallString&quot; <br />
   '&quot;$INSTDIR\uninstall.exe&quot;'<br />
; work around Win2k/WinXP security<br />
SetOutPath &quot;$TEMP&quot;<br />
File Reg2K.exe<br />
ExecWait '&quot;$TEMP\Reg2K.exe&quot; Sample &quot;$TEMP\sample.flag&quot;'<br />
Delete &quot;$TEMP\Reg2K.exe&quot;<br />
IfFileExists &quot;$TEMP\sample.flag&quot; 0 3<br />
WriteRegStr HKEY_CURRENT_USER &quot;Software\Microsoft\Windows\CurrentVersion\<br />
   Uninstall\Sample&quot; &quot;DisplayName&quot; &quot;Sample&quot;<br />
WriteRegStr HKEY_CURRENT_USER &quot;Software\Microsoft\Windows\CurrentVersion\<br />
   Uninstall\Sample&quot; &quot;UninstallString&quot; <br />
   '&quot;$INSTDIR\uninstall.exe&quot;'<br />
Delete &quot;$TEMP\sample.flag&quot;<br />
Nop<br />
<br />
<br />
Something like that. Drawbacks of this solution: It is inelegant, it carries extra code, if tomorrow I need to pair other parts of registry, I need to enhance my program, when my program starts it flickers (?). I would prefer to use scripting to do checking.<br />
<br />
Proposal #1: make OS version available to script.<br />
Proposal #2: make available status of last WriteRegStr operation.<br />
Proposal #3: we need some way to test registry keys for existence.<br />
<br />
Question: is it possible to run programs in background without showing window? It should be an argument of Exec/ExecWait.<br />
<br />
Maybe it is resolved already in upcoming versions.<br />
<br />
Thanks,<br />
<br />
Uhop</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>