<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Retrieving window handle from a plugin, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Retrieving window handle from a plugin NSIS Discussion" />
	
	<title> Retrieving window handle from a plugin [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Retrieving window handle from a plugin</div>
<hr />
<div class="pda"><a href="t-210055.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=210055">Retrieving window handle from a plugin</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">rsegal</div><div class="date">10th March 2005, 21:18</div></div><div class="posttext">I need to get the window handle to one of the controls on one of the pages in my installer.  I'm thinking the correct way to do this is to get the window handle in script, set a user variable to hold that value then call my plugin function querying that variable in code with a call to getuservariable.  <br />
<br />
This doesn't seem to be working but I am not comletely convinced of that yet.  Here is what I've discovered so far.  The call to getuservariable in my plugin does return some kind of valid memory address.  I can type cast this value to an HWND which as I understand things is what my variable should be holding although it is returned as a &quot;char *&quot;.  Once casted the HWND still appears to have a valid memory address but when I call any functions to query info about the window from within the plugin I get garbage information, it's all completely wrong which makes me think I don't actually have a valid window handle.  Thoughts, suggestions and questions are most welcome.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th March 2005, 21:28</div></div><div class="posttext">There is no need to save the HWND in any variable. The first plug-in function parameter is hwndParent which is exactly the same as $HWNDPARENT.<br />
<br />
getuservariable returns strings. You need to use atoi to convert the string to a number before using it as a handle.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rsegal</div><div class="date">10th March 2005, 22:47</div></div><div class="posttext">There is no need to save the HWND in any variable. The first plug-in function parameter is hwndParent which is exactly the same as $HWNDPARENT.<br />
<br />
Oh kichik you're so smart.  Indeed you are correct, thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rsegal</div><div class="date">11th March 2005, 16:58</div></div><div class="posttext">Ok so I can get the window handle of any control from within the plugin.  Now I also need to get the device context for a specific control.  That seems to be done with a call to GetDC passing the window handle of the control I need to modify.  The DC I am returned does seem to be valid however after getting the DC any function I use to apply changes to that DC doesn't seem to do anything.  Specifically I've been using the TextOut function which you can read about here...<br />
<br />
http://msdn.microsoft.com/library/default.asp?url=/library/en-us/gdi/fontext_5yd0.asp<br />
<br />
Only it doesn't seem to do anything when I use it.  I'm working my way through trying to figure out why I can't see any text on screen after calling this function but if anyone has any hints/tips please feel free to post.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th March 2005, 10:31</div></div><div class="posttext">Subclass the window and use TextOut in WM_PAINT.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">12th March 2005, 17:40</div></div><div class="posttext">Something simple like &lt;marquee&gt; 30 ms repaint is also possible, see attachment. Do not forget to put dll to plug-ins folder. Have fun. If this is interesting for big installations, I can write a plug-in with a full set of parameters including text color, size, target rect., speed, type (arial, verdana), movement direction (top or right), what else ;)<br />
Tested on XP only.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">12th March 2005, 21:05</div></div><div class="posttext">@Takhir: Did you use &quot;AnimateWindow&quot; or something like that to get that result?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">13th March 2005, 06:33</div></div><div class="posttext">@deguix: No, direct draw to dialog window :)<br />
<br />
   while(!terminate)<br />
   {<br />
      if(--textPos + sz.cx &lt; rc.left)<br />
         textPos = rc.right;<br />
      hDc = GetDC(childwnd); // client area dc<br />
//      TextOut(hDc, textPos, rc.top, marquee, strlen(marquee));<br />
      SetBkColor(hDc, bkColor);<br />
      SetTextColor(hDc, textColor);<br />
      SelectObject(hDc, (HGDIOBJ)hFont);<br />
      ExtTextOut(hDc, textPos, rc.top, ETO_CLIPPED | ETO_OPAQUE, &amp;rc, marquee, strlen(marquee), NULL);<br />
      ReleaseDC(childwnd, hDc);<br />
      Sleep(20);<br />
   }</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rsegal</div><div class="date">14th March 2005, 16:34</div></div><div class="posttext">Originally posted by kichik <br />
Subclass the window and use TextOut in WM_PAINT.  <br />
Thanks for the feedback everyone.  kichik I am slighly unsure at what point you mean to subclass that window.  Would this be something like creating a CWnd subclass within my plugin initializing it to have the window handle that I retrieve from the installer and handling the WM_PAINT message there?  Maybe I'm totally off track.<br />
<br />
Originally posted by Takhir <br />
Something simple like &lt;marquee&gt; 30 ms repaint is also possible, see attachment. Do not forget to put dll to plug-ins folder. Have fun. If this is interesting for big installations, I can write a plug-in with a full set of parameters including text color, size, target rect., speed, type (arial, verdana), movement direction (top or right), what else <br />
Tested on XP only.<br />
Some cool stuff Takhir, do you have source available for Marquee? I'd love to take a look at that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">14th March 2005, 18:59</div></div><div class="posttext">Neighbour thread ;) http://forums.winamp.com/showthread.php?s=&amp;threadid=210286</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rsegal</div><div class="date">14th March 2005, 20:19</div></div><div class="posttext">Originally posted by Takhir <br />
Neighbour thread ;) http://forums.winamp.com/showthread.php?s=&amp;threadid=210286  <br />
<br />
Sweet.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th March 2005, 18:32</div></div><div class="posttext">Subclassing a window (http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/userex/subclassingcontrols.asp) is what I was referring to.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>