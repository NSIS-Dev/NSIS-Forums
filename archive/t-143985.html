<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" read key  and action if have a value, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  read key  and action if have a value NSIS Discussion" />
	
	<title> read key  and action if have a value [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  read key  and action if have a value</div>
<hr />
<div class="pda"><a href="t-143985.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=143985">read key  and action if have a value</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">moxo</div><div class="date">29th July 2003, 11:10</div></div><div class="posttext">i have a product in two part, i can install separately in two computer but if i install on same computer, in install section i need to read a key read said me the path where one of my part had installed and after i use this path in directory page of install. If this key is not present i use the path by default.<br />
my problem is: i don't know use  the function if in NSIS.<br />
<br />
my key<br />
ReadRegStr HKCU &quot;Software\${MUI_PRODUCT}\part1&quot; &quot;&quot; ${pathpart1}<br />
and if not present, i want to use InstallDir &quot;$PROGRAMFILES\${MUI_PRODUCT}<br />
<br />
i have the same problem in uninstall section a want to read a key, if a key is present i don't want delete the main folder, and if is not present i want to call a fonction who uninstall another product.<br />
thanks for your help</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">29th July 2003, 13:40</div></div><div class="posttext">Not exacly certain about the uninstall part but as for the installer you should first set the $INSTDIR to the path you want to use if the other part is not installed and then use the 'InstallDirRegKey' command to overwrite the path if the specified key exists.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th July 2003, 13:42</div></div><div class="posttext">Well, firstly you set InstallDir &quot;$PROGRAMFILES\${MUI_PRODUCT}&quot;<br />
<br />
Now,<br />
ReadRegStr $R0 HKCU &quot;Software\${MUI_PRODUCT}\part1&quot; &quot;&quot; ${pathpart1}<br />
StrCmp $R0 &quot;&quot; +2<br />
 StrCpy $INSTDIR $R0<br />
<br />
Is this what you want?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">29th July 2003, 13:45</div></div><div class="posttext">Afrow UK, is it not easier to use 'InstallDirRegKey' function?<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">moxo</div><div class="date">29th July 2003, 16:09</div></div><div class="posttext">thanks for your help<br />
i 'm trying and i said you tomorrow what solution i used.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">moxo</div><div class="date">30th July 2003, 13:07</div></div><div class="posttext">i try this<br />
ReadRegStr $R5 HKCU &quot;Software\${MUI_PRODUCT}&quot; &quot;Pathproduct&quot;<br />
IfErrors 0 suite<br />
InstallDir &quot;$R5&quot;<br />
Goto next<br />
<br />
suite:<br />
InstallDir &quot;$PROGRAMFILES\${MUI_PRODUCT}&quot;<br />
goto next<br />
<br />
next:<br />
InstallDirRegKey HKCU &quot;Software\${MUI_PRODUCT}&quot; &quot;&quot;<br />
<br />
i have this error<br />
Can't add entry, no section or function is open!<br />
<br />
so i add this in function .oninit<br />
now i have error<br />
command InstallDir not valid in function.<br />
<br />
How can i put the path what i store in registry with previous install in directory page.<br />
<br />
i thinks i have done a bad explication.<br />
in my product i have to part in one side i have the client and the other side i have the server. i can install server and clietn in same computer or in separately computers.<br />
my client side is installed in a sub folder &quot;client&quot; (for server it s in a subfolder &quot;server&quot;. the main folder is the product folder.<br />
I want when i install for example my client side to put a registry key who said me where are my product, like: HKCU &quot;Software\${MUI_PRODUCT}&quot; &quot;Pathproduct&quot;<br />
and other key with my path client like<br />
HKCU &quot;Software\${MUI_PRODUCT}\Client&quot; &quot;PathClient&quot; in this key i have <br />
PathProduct\client (i thinks is more easy for updtade)<br />
<br />
Now if i install server side (or client side for update).<br />
i want my install check if this key exist HKCU &quot;Software\${MUI_PRODUCT}&quot; &quot;Pathproduct&quot;<br />
in directory page i want it propose the path of product and after the serverside is installed in subfoler server.<br />
but if this key doesn't exist, the directory page propose me the default path $PROGRAMFILES\${MUI_PRODUCT}.<br />
<br />
i hope now i have done a good explication :)<br />
thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2003, 13:14</div></div><div class="posttext">Your stuff needs to go into a section/function.<br />
<br />
e.g. use onInit to execute your cmds on initialisation<br />
<br />
Function .onInit<br />
ReadRegStr $R5 HKCU &quot;Software\${MUI_PRODUCT}&quot; &quot;Pathproduct&quot; <br />
IfErrors 0 suite <br />
InstallDir &quot;$R5&quot; <br />
Goto next <br />
<br />
suite: <br />
InstallDir &quot;$PROGRAMFILES\${MUI_PRODUCT}&quot; <br />
goto next <br />
<br />
next: <br />
InstallDirRegKey HKCU &quot;Software\${MUI_PRODUCT}&quot; &quot;&quot;<br />
FunctionEnd<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">30th July 2003, 13:37</div></div><div class="posttext">InstallDir won't work in a function to assign a path inside a function you sould use StrCpy $INSTDIR &quot;your_path&quot; <br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">moxo</div><div class="date">30th July 2003, 14:58</div></div><div class="posttext">InstallDirRegKey won't work in a function.<br />
i tried the function but i don't use InstallDirRegKey.<br />
in my first installation, in directory page, by defalut i have :<br />
c:\program files\myproduct.<br />
i choose, c:\bin\myproduct. my product(serverside) is installed in c:\bin\myproduct\server.<br />
<br />
now if i install again server side of if i install the first installation of client side, in directory page i have again <br />
c:\program files\myproduct and no c:\bin\myproduct.<br />
why doctor???<br />
thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2003, 15:25</div></div><div class="posttext">You will have to make your own registry key to store the InstallDir value, instead of using InstDirRegKey.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">moxo</div><div class="date">30th July 2003, 16:25</div></div><div class="posttext">in the install, i had created<br />
<br />
!define pathsrv &quot;$INSTDIR\server&quot;<br />
WriteRegStr HKCU &quot;Software\${MUI_PRODUCT}&quot; &quot;Pathproduct&quot; $INSTDIR<br />
and<br />
WriteRegStr HKCU &quot;Software\${MUI_PRODUCT}\server&quot; &quot;&quot; ${pathsrv}<br />
<br />
and for me the $INSTDIR is the path i have define in directory page in the first time.<br />
but it's no good</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2003, 16:31</div></div><div class="posttext">Can you post your script so I can understand what you are trying to achieve?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">moxo</div><div class="date">31st July 2003, 09:59</div></div><div class="posttext">in the client side, only this variable change<br />
MUI_PRODUCT = client<br />
MUI_VERSION = v2.0<br />
FOLD_INST = client<br />
PATH_SRV = $INSTDIR\${FOLD_INST}<br />
so i have two problem when i install the client side(or for update server side) i want the program go to read if regkey HKCU &quot;Software\${COMPANY}&quot; &quot;PathComp&quot; exist and if is good i want the directory page show me the value of this key (it's the $INSTDIR of first install) and if is not good directory page show me $PROGRAMFILES\${COMPANY}.<br />
my other problem is uninstall, i have noticed the directory page of unistallation show me the path ${PATH_SRV}\${FOLD_INST}, so i have for example c:\program files\my company\server\server and i want c:\program files\my company\server.<br />
thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2003, 10:35</div></div><div class="posttext">Ok, heres what should be done [from what I have read].<br />
Use in uninstall section.<br />
<br />
ReadRegStr $R0 HKCU &quot;Software\${COMPANY}&quot; &quot;PathComp&quot;<br />
StrCmp $R0 &quot;&quot; 0 is_present ;jump to<br />
<br />
ReadRegStr $R0 HKCU &quot;Software\${COMPANY}\${FOLD_INST}&quot; &quot;PathSrv&quot;<br />
## do stuff here for non present reg entry ##<br />
<br />
Goto done<br />
is_present:<br />
## do stuff here for presnt reg entry ##<br />
<br />
done:<br />
<br />
I noticed this should be changed:<br />
execwait '$SYSDIR\msiexec.Exe /i $EXEDIR\access-2000\osp.msi TRANSFORMS=&quot;$EXEDIR\access-2000\osp.MST&quot; /qb-'<br />
<br />
to<br />
ExecWait '&quot;$SYSDIR\msiexec.exe&quot; /i &quot;$EXEDIR\access-2000\osp.msi&quot; TRANSFORMS=&quot;$EXEDIR\access-2000\osp.MST&quot; /qb-'<br />
<br />
Else, this execute would fail if $SYSDIR or $INSTDIR had spaces in it.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">moxo</div><div class="date">31st July 2003, 13:16</div></div><div class="posttext">thanks a lot for your help.<br />
i hope to help you one day.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>