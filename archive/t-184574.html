<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Space needed on multiple directory pages, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Space needed on multiple directory pages NSIS Discussion" />
	
	<title> Space needed on multiple directory pages [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Space needed on multiple directory pages</div>
<hr />
<div class="pda"><a href="t-184574.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=184574">Space needed on multiple directory pages</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">KrYpT</div><div class="date">25th June 2004, 22:22</div></div><div class="posttext">I am currently trying to use two directory pages, one to choose where to install the program files, and another for data files. This works fine, but the &quot;Space required&quot; box in the bottom left (using MUI if it matters) shows the same amount in both cases.<br />
<br />
A couple possible solutions that I don't know how to implement (or if they'll work):<br />
<br />
1. Hide the &quot;Space required&quot; label altogether on the data directory page..... but I think it'll still check for the amount of space needed by the program files.<br />
<br />
2. Place hidden (automatically skipped) components pages between the directory pages to enable different sections. I don't have any components pages as it stands (I only have one section), if that makes any difference.<br />
<br />
3. Use InstallOptions to create a similar dialog without the label. I can't figure out how to update the &quot;Space available&quot; label when the directory is changed though.<br />
<br />
Thanks in advance for any help,<br />
Geoff</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th June 2004, 22:42</div></div><div class="posttext">You can hide the labels on the second components page using FindWindow, GetDlgItem and ShowWindow. To make it ignore the required space you can use DirVerify.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">KrYpT</div><div class="date">26th June 2004, 00:04</div></div><div class="posttext">I got it to ignore the required space using DirVerify. That part works great. Thanks. (BTW, in the docs it says DirVerify is set globally, not as part of PageEx, but no problem)<br />
<br />
The hiding of the label seems to be a bit of a problem though. Here's my code:<br />
<br />
<br />
Function DataDirectoryShowFunc<br />
<br />
  FindWindow $0 &quot;#32770&quot; &quot;&quot;<br />
  GetDlgItem $1 $0 1023     ; 1023 = IDC_SPACEREQUIRED<br />
  ShowWindow $1 0           ; 0 = SW_HIDE<br />
<br />
FunctionEnd<br />
<br />
I think it might be hiding the window, then immediately showing it again after this function. Any good way to get around that? (Is moving it offscreen possible/intelligent?)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th June 2004, 10:05</div></div><div class="posttext">Where does it say it's global?<br />
<br />
Replace the FindWindow line with:FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT</div></div><hr />


<div class="post"><div class="posttop"><div class="username">KrYpT</div><div class="date">27th June 2004, 05:40</div></div><div class="posttext">Good call on the $HWNDPARENT thing. Apparently I was foiled by a word wrap :rolleyes:. It works now, many thanks.<br />
<br />
In the NSIS User Manual (that I got with 2.0 Final), under 4.5.2 Page Options, it seems to say that the only two things you can use specifically in a directory selection PageEx block are DirVar and DirText. Apparently that's not the case.<br />
<br />
Also, when you click them from there, it takes you to 4.8.1 General Attributes, which seem to be mostly &quot;global&quot; settings (ChangeUI and CRCCheck) and some which are specifically noted as being used only in a PageEx block (DirVar). Maybe a note should be added to DirVerify as well to say that it can only be used inside of PageEx.<br />
<br />
I also happened to find something called SpaceTexts, which kind of looked like it might have been the right way to do this. It seems odd to me, though, that you can only disable both texts at once, and not specify one or the other.<br />
<br />
Anyways, I think NSIS is great, and the service on the forum is amazing. Can't thank you enough for the effort you're putting in.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st July 2004, 18:26</div></div><div class="posttext">Oh right, it's only listed under 4.5.2 in the latest CVS version.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ImmortAlex</div><div class="date">7th September 2004, 08:26</div></div><div class="posttext">Is there any chances that developers will add ability to set &quot;space required&quot; field in directory page?<br />
I wrote installer, that unpack contents into two different directory: all sections except one into $INSTDIR and one section into another dir, very possibly situated on another drive. Both directories are selected by user (two MUI_PAGE_DIRECTORY macros in script).<br />
Currently I have only ability to turn off space check (DirVerify off), hide label (SpaceTexts none) and leave users in the dark of ignorance. If I don't did so, they will have incorrect requirements in both directory pages and even possibly incorrectly grayed &quot;Next&quot; button.<br />
<br />
BTW, looking for answers for my questions I begin to understand whole structure of NSIS code :) For example, for this question I find lines in exehead\Ui.c:<br />
total = sumsecsfield(size_kb);<br />
if ((unsigned int)available &lt; (unsigned int)total)<br />
      error = NSIS_INSTDIR_NOT_ENOUGH_SPACE;<br />
<br />
<br />
<br />
That's the core of my trouble: total is function-local int variable...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th September 2004, 21:03</div></div><div class="posttext">You can change each section's size requirement with SectionSetSize.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ImmortAlex</div><div class="date">8th September 2004, 02:41</div></div><div class="posttext">Yes, I know. But it will looks like:<br />
1. Before showing dialog with selection main directory I must turn off (or set size to zero) that section, which must install into additional directory. And then first directory page will show and check correct installation size.<br />
2. Before showing dialog with selection additional directory I must turn off (or set size to zero) all sections except one which must install into this directory.<br />
<br />
While first operation is simple to implement, second is complex, at least I dont know easy way to save and restore state of bunch of section.<br />
<br />
Hmm... I suddenly understand that setting section size to zero will not affect installation process! And I don't need to return it to actual state! So, is there any way to loop over all sections with for-like cycle? Because my installer has a lot of sections (except this pecular installed separately), and will have even more in future, and I don't want to insert a lot of SetSectionSize in my script and not forget insert even more in future.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th September 2004, 18:09</div></div><div class="posttext">Define a dummy section which will be the last section. Loop from 0 to its id to go over all sections.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ImmortAlex</div><div class="date">10th September 2004, 02:50</div></div><div class="posttext">Also SectionSetSize set error flag if index is out of bound, and it's enough.<br />
<br />
But I forgot that user can press Back button... So I need to return actual sizes to sections in component's page pre-function. I need arrays in NSIS script!<br />
<br />
I think it's simpler to rewrite directory page for me using InstallOptions :)<br />
<br />
Anyway, thanks.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>