<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Page validation problem, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Page validation problem NSIS Discussion" />
	
	<title> Page validation problem [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Page validation problem</div>
<hr />
<div class="pda"><a href="t-128620.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=128620">Page validation problem</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th March 2003, 12:25</div></div><div class="posttext">If the user enters a directory with 'quake2' in it, and has the 'Use Quake2 directory rename function' CheckBox selected, then it comes up with an error message telling the user that you cnnot have both.<br />
I need it to go back to the custom page after clicking OK.<br />
If I call the custom page function, it instead jumps a page ahead instead of going back to the custom page.<br />
<br />
How can I get it to go back a page?<br />
<br />
<br />
-Stuart</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">16th March 2003, 13:38</div></div><div class="posttext">I'm not sure I understand the question.<br />
<br />
Do you mean:<br />
You have a custom page which gets some input and if the input is not correct a message box is shown. When the message box is closed you want to go back to the custom page, so the user can enter new data. You have tried to do this by calling the function which creates the custom page again, but the installer shows the next page in the sequence instead?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th March 2003, 14:11</div></div><div class="posttext">Yes.<br />
<br />
I'm a bit more awake now.<br />
<br />
<br />
-Stuart</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">16th March 2003, 14:27</div></div><div class="posttext">My solution is to do the input validation within the function that creates the custom page. If the input data is ok, you exit from the function. If the input data is not ok, you display a suitable message then re-display the custom page and let the user try again.<br />
<br />
The following skeleton code shows this idea:<br />
<br />
Function MyCustomPage<br />
<br />
  ; The &quot;ioA.ini&quot; file defines the custom page controls<br />
<br />
loop:<br />
  !insertmacro MUI_INSTALLOPTIONS_DISPLAY_RETURN &quot;ioA.ini&quot;<br />
  Pop $R0<br />
<br />
  StrCmp $R0 &quot;cancel&quot; exit_from_this_page<br />
  StrCmp $R0 &quot;back&quot; exit_from_this_page<br />
<br />
  ; use MUI_INSTALLOPTIONS_READ lines to access and check the user input<br />
<br />
  ; if input Ok, goto exit_from_this_page, if data is not OK goto bad_data<br />
<br />
bad_data:<br />
  MessageBox MB_OK &quot;Sorry! Input data is not valid. Please enter new data&quot;<br />
  Goto loop<br />
<br />
exit_from_this_page:<br />
FunctionEnd<br />
<br />
<br />
Hope this helps,<br />
Brian</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th March 2003, 15:30</div></div><div class="posttext">The trouble is, I'm not using any of the Modern UI IO commands, just the standard way with Page Custom etc<br />
I shall look in the MUI code for how they have gone back a page.<br />
<br />
-Stuart</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">16th March 2003, 16:10</div></div><div class="posttext">The one way to go back to a other page is &quot;use two pages in one&quot;.<br />
<br />
Example:<br />
<br />
<br />
Function MyCustomPage<br />
<br />
  ;Code that will execute before the first page show.<br />
<br />
  ;Display first page<br />
  InstallOptions::dialog &quot;inifile.ini&quot;<br />
  Pop $R0<br />
<br />
  StrCmp $R0 &quot;success&quot; 0 End<br />
<br />
  ;Code that will execute after the first page, and before the second.<br />
<br />
  ;Display second page<br />
  !insertmacro MUI_INSTALLOPTIONS_DISPLAY_RETURN &quot;inifile.ini&quot;<br />
  Pop $R0<br />
<br />
  StrCmp $R0 &quot;success&quot; 0 End<br />
<br />
  ;Code that will execute after the second page has showed.<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th March 2003, 16:42</div></div><div class="posttext">I shall try it thanks :)<br />
<br />
-Stuart</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th March 2003, 16:58</div></div><div class="posttext">Have a look at (exactly what pengyou said without the MUI):<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=77&amp;instances=0,64</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">16th March 2003, 17:08</div></div><div class="posttext">Sorry if I confused you by using MUI code (so far I've only used the MUI stuff). Here is my example, rewritten to use non-MUI code.<br />
<br />
Function MyCustomPage<br />
<br />
loop:<br />
  InstallOptions::dialog &quot;$PLUGINSDIR\demo.ini&quot;<br />
  Pop $R0<br />
<br />
  StrCmp $R0 &quot;cancel&quot; exit_from_this_page<br />
  StrCmp $R0 &quot;back&quot; exit_from_this_page<br />
<br />
  ReadINIStr $R1 &quot;$PLUGINSDIR\demo.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
  ReadINIStr $R2 &quot;$PLUGINSDIR\demo.ini&quot; &quot;Field 5&quot; &quot;State&quot;<br />
  StrCmp $R1 $R2 bad_data exit_from_this_page<br />
<br />
bad_data:<br />
  MessageBox MB_OK &quot;Sorry! Input data is not valid. Please enter new data&quot;<br />
  Goto loop<br />
<br />
exit_from_this_page:<br />
FunctionEnd<br />
<br />
The function which creates the custom page will repeatedly display the page until the data entered by the user passes the validation test(s).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th March 2003, 17:20</div></div><div class="posttext">Here is what I now have...<br />
<br />
Function SetCustom #Custom Page<br />
  Top:<br />
  !insertmacro MUI_HEADER_TEXT $(MUI_TEXT_DIRECTORY_TITLE) $(MUI_TEXT_DIRECTORY_SUBTITLE)<br />
<br />
	InstallOptions::dialog &quot;$9\map-compiler\settings\map-compiler_dir.ini&quot;<br />
<br />
  Call CustomInstFiles<br />
<br />
  ReadINIStr $0 &quot;$9\map-compiler\settings\map-compiler.ini&quot; &quot;PageStatus&quot; &quot;Value&quot;<br />
  StrCmp $0 &quot;Success&quot; End Top<br />
  End:<br />
<br />
	WriteINIStr &quot;$9\map-compiler\settings\map-compiler.ini&quot; &quot;PageStatus&quot; &quot;Value&quot; &quot;Success&quot;<br />
<br />
	StrCmp 0 $R7 WthYes WthNo<br />
	 WthYes:<br />
	  StrCpy $R7 1<br />
	 WthNo:<br />
FunctionEnd<br />
<br />
And then this for the validation function...<br />
<br />
Function CustomInstFiles<br />
	WriteINIStr &quot;$9\map-compiler\settings\map-compiler.ini&quot; &quot;PageStatus&quot; &quot;Value&quot; &quot;Success&quot;<br />
<br />
	ReadINIStr $1 &quot;$9\map-compiler\settings\map-compiler_dir.ini&quot; &quot;Field 4&quot; &quot;State&quot;<br />
	IfFileExists &quot;$1\*.*&quot; +3<br />
	MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Warning: The main game directory path you have specified ($1) does not exist.$\nPlease validate the path.&quot;<br />
	WriteINIStr &quot;$9\map-compiler\settings\map-compiler.ini&quot; &quot;PageStatus&quot; &quot;Value&quot; &quot;Failure&quot;<br />
<br />
	ReadINIStr $1 &quot;$9\map-compiler\settings\map-compiler_dir.ini&quot; &quot;Field 6&quot; &quot;State&quot;<br />
	IfFileExists &quot;$1&quot; +3<br />
	MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Warning: The map file that you have specified ($1) does not exist.$\nPlease validate the path.&quot;<br />
	WriteINIStr &quot;$9\map-compiler\settings\map-compiler.ini&quot; &quot;PageStatus&quot; &quot;Value&quot; &quot;Failure&quot;<br />
<br />
	ReadINIStr $1 &quot;$9\map-compiler\settings\map-compiler_dir.ini&quot; &quot;Field 8&quot; &quot;State&quot;<br />
	IfFileExists &quot;$1\*.*&quot; +4<br />
	MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Warning: The out directory path you have specified ($1) does not exist.$\nAfrow UK's Map-Compiler will create the directory anyway.&quot;<br />
	WriteINIStr &quot;$9\map-compiler\settings\map-compiler.ini&quot; &quot;PageStatus&quot; &quot;Value&quot; &quot;Failure&quot;<br />
	CreateDirectory &quot;$1&quot;<br />
<br />
	ReadINIStr $1 &quot;$9\map-compiler\settings\map-compiler_settings.ini&quot; &quot;Field 7&quot; &quot;State&quot;<br />
	IfFileExists &quot;$1\*.*&quot; +3<br />
	MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Warning: The Quake2 directory path you have specified ($1) does not exist.$\nPlease validate the path.&quot;<br />
	WriteINIStr &quot;$9\map-compiler\settings\map-compiler.ini&quot; &quot;PageStatus&quot; &quot;Value&quot; &quot;Failure&quot;<br />
<br />
	ReadINIStr $1 &quot;$9\map-compiler\settings\map-compiler_settings.ini&quot; &quot;Field 10&quot; &quot;State&quot;<br />
	IfFileExists &quot;$1\*.*&quot; +3<br />
	MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Warning: The Quake2 base directory path you have specified ($1) does not exist.$\nPlease validate the path.&quot;<br />
	WriteINIStr &quot;$9\map-compiler\settings\map-compiler.ini&quot; &quot;PageStatus&quot; &quot;Value&quot; &quot;Failure&quot;<br />
<br />
	FindWindow $1 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
	GetDlgItem $1 $1 1016<br />
	CreateFont $2 &quot;Fixedsys&quot; &quot;6&quot; &quot;40&quot;<br />
	SendMessage $1 ${WM_SETFONT} $2 0<br />
FunctionEnd<br />
<br />
<br />
Works great :)<br />
<br />
-Stuart</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>