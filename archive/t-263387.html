<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" my &quot;old&quot; setup and Vista, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  my &quot;old&quot; setup and Vista NSIS Discussion" />
	
	<title> my &quot;old&quot; setup and Vista [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  my &quot;old&quot; setup and Vista</div>
<hr />
<div class="pda"><a href="t-263387.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=263387">my &quot;old&quot; setup and Vista</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">coco_vc</div><div class="date">10th January 2007, 15:45</div></div><div class="posttext">Hi all,<br />
<br />
I have a setup that I used for Win2k and WinXP without issues. Now I gave it a try with Windows Vista and I noticed the following issue (when running it when logged in as a user from the admin group):<br />
- NSIS runs an exe called instlsp.exe that installs an LSP (layered service provider) and this exe installs successfully the LSP.<br />
- if for the exact same user I manually run the instlsp.exe, the LSP doesn't get installed, b/c I get &quot;access denied&quot; for some functions.<br />
<br />
As far as I read about the changes in Vista for an LSP, the desired behavior is indeed that only the build-in admin is able to install an LSP, so it's normal that by manually running the instlsp.exe the LSP installation fails. What I can't understand, and maybe someone could explain, is how can NSIS successfully run this exe? Actually, not only is able to successfully run instlsp.exe, which when ran manually fails, but also can write into Program Files, which seems to normally not be possible. How can NSIS do that?<br />
<br />
Please note that:<br />
- I use NSIS version 2.18 .<br />
- I didn't specifically said &quot;Run as administrator&quot;, but just double-click the setup.exe.<br />
- I didn't use the &quot;RequestExecutionLevel&quot; in my script.<br />
- I have no manifest that specifies privileges whatsoever for no exe.<br />
- in the script I check if the user is admin by using the following code:<br />
<br />
!macro checkAdminAndTakeAction UN<br />
Function ${UN}checkAdminAndTakeAction<br />
  ClearErrors<br />
  UserInfo::GetAccountType<br />
  Pop $1<br />
  StrCmp $1 &quot;Admin&quot; done_checkAdminAndTakeAction 0<br />
    ; we need to show a multilanguage msgbox and b/c this function is called also in .onInit where we can't show<br />
    ;   by default multilanguage msgboxes, do the switch (the language is set by NSIS once the .onInit is finished, so in .onInit we need this switch)<br />
    !insertmacro language_define $0 NEED_TO_BE_ADMIN<br />
    MessageBox MB_ICONEXCLAMATION|MB_OK $0 /SD IDOK<br />
    ; log this<br />
    FileWrite $FileHandle &quot;$0\n&quot;<br />
    Quit ; quit the whole installer<br />
done_checkAdminAndTakeAction:<br />
FunctionEnd<br />
!macroend<br />
<br />
<br />
Thanks in advance,<br />
Viv</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th January 2007, 21:15</div></div><div class="posttext">Vista automatically runs NSIS installers as administrator, even with the manifest. It recognizes you're running an installer and automatically kicks UAC in action. The manifest can change that behavior, but without it you're always ran as administrator.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">coco_vc</div><div class="date">12th January 2007, 10:35</div></div><div class="posttext">Ah, ok, thx for the info.<br />
<br />
Viv</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>