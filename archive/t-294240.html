<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSISList: Simple List Plugin, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSISList: Simple List Plugin NSIS Discussion" />
	
	<title> NSISList: Simple List Plugin [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSISList: Simple List Plugin</div>
<hr />
<div class="pda"><a href="t-294240.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=294240">NSISList: Simple List Plugin</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">10th July 2008, 02:53</div></div><div class="posttext">Hello :)<br />
<br />
I have created a very simple List plugin, namely NSISList.<br />
<br />
Well, I know there already is NSISArray, but find it a bit complex to use.<br />
Also coding myself makes more fun than using existing plugins :D <br />
<br />
Currently only one instance (one list at a time) is supported.<br />
And it's not documented yet, although the example should be self-explaining.<br />
<br />
Bug reports welcome...<br />
<br />
Edit (Afrow UK):<br />
Attachment removed. Download from http://nsis.sourceforge.net/NSISList_plug-in#Download.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pospec</div><div class="date">10th July 2008, 06:23</div></div><div class="posttext">Why do we need another plugin as there is NSISArray?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">10th July 2008, 09:16</div></div><div class="posttext">As far I can say, this appears pretty different than nsis array, but even if there's not noticeable difference I prefer to have more than one options.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dbach</div><div class="date">10th July 2008, 14:32</div></div><div class="posttext">@LoRd_MuldeR<br />
<br />
Call it Alpha as long as it isn't feature complete. ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">10th July 2008, 15:11</div></div><div class="posttext">Okay, I have added support for multiple lists. You can now create as many lists as you like. Each list is created with a (unique) name and you can use this name to access the list later. Also the missing &quot;Insert&quot; operation has been added, so you can insert items at a specified position now...<br />
<br />
Edit (Afrow UK):<br />
Attachment removed. Download from http://nsis.sourceforge.net/NSISList_plug-in#Download.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">10th July 2008, 15:35</div></div><div class="posttext">Sorry, just found a bug in the &quot;Insert&quot; operation. Inserting with an improper index could cause the installer to crash! Now the index will be clipped to the bounds of the list, so inserting with an invalid index won't cause crash anymore.<br />
<br />
See the example for details...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">10th July 2008, 16:39</div></div><div class="posttext">That's an absolutely interesting plugin my Lord ;) and it's getting better as I can see.<br />
<br />
When I'll have time, I will try to implement it with <br />
Advanced Uninstall Log (http://nsis.sourceforge.net/Advanced_Uninstall_Log_NSIS_Header), it seems it would eliminate the  disadvantage of throwing the list several times.<br />
<br />
Nice job whatsoever :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">10th July 2008, 17:15</div></div><div class="posttext">Thanks for your reply :)<br />
<br />
1. Added &quot;Index&quot; command to return the index of an item<br />
2. Added &quot;AllRev&quot; command to push all items onto the stack, in reverse order<br />
3. Moved the includes to a separate file<br />
4. Added a &quot;Torture Test&quot; for NSISList</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">10th July 2008, 19:16</div></div><div class="posttext">Added &quot;Load&quot; and &quot;Save&quot; to load/save a list directly from a plain text file.<br />
See the example installer...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">10th July 2008, 22:02</div></div><div class="posttext">Right another update: I re-enabled single instance support. So if you don't want to mess around with several lists, you can simply use the &quot;default&quot; list now. This list is identified with an empty string &quot;&quot;, it doesn't need to be created and it cannot be destroyed. The default list will be created implicitly when then plugin is loaded and it will be destroyed automatically when the plugin is unloaded.<br />
<br />
See the example installer, as always...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">11th July 2008, 14:56</div></div><div class="posttext">I think it should be feature complete now:  Added &quot;Set&quot; (change value of existing item), &quot;Exch&quot; (exchange two items by their indexes) and &quot;Move&quot; (move item by it's index). Also some code clean-up was done. In case no major bugs are discovered, I'd call that one finished. Writing some docs now...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">11th July 2008, 15:58</div></div><div class="posttext">First attempt to create some docs ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">12th July 2008, 19:45</div></div><div class="posttext">Final version has been released on the Wiki page:<br />
http://nsis.sourceforge.net/NSISList_plug-in<br />
<br />
Have fun :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">12th July 2008, 19:59</div></div><div class="posttext">Nice job LoRd_MuldeR, and the docs too. Would be somehow possible to decrease the dll size?<br />
<br />
edit: sorry, I forgot the obvious :) THANKS!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">12th July 2008, 20:16</div></div><div class="posttext">Originally posted by Red Wine <br />
Would be somehow possible to decrease the dll size?  <br />
<br />
Nope. The DLL is created with Delphi and internally I use a TStringList to store all the strings. This means I need to include the &quot;Classes&quot; Unit, which contains the TStringList type. I tried to copy and paste the TStringList code to my own file, so I don't need to include the entire &quot;Classes&quot; Unit and all of it's dependencies. But TStringList is derived from TStrings which again is derived from some other Object I cannot remember now. Also a lot of other Types are involved at different locations, which I'd need to copy as well. So in the end I'd end up with a copy of &quot;Classes&quot; in my own file. That makes no sens and it makes the code ugly and hard to maintain. Since TStringList is very powerful and my entire plugin depends on it, I think I'll keep it the way it is. You can of course pack the plugin DLL with UPX to make it smaller. But then your installer might actually become bigger, because &quot;packed&quot; files compress worse...<br />
<br />
BTW: Is there any way to overcome the 100 KB upload limit?<br />
<br />
<br />
[EDIT]<br />
<br />
If anybody owns a newer (or older) version of Delphi than mine, that is Delphi 7 Professional, he/she could try to compile my sources and see if that makes the DLL any bigger/smaller. Also Lazarus might be worth a try...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">12th July 2008, 20:25</div></div><div class="posttext">Uhm, Lazarus fails at one of the NSIS API functions :cry: <br />
<br />
Error message is &quot;project1.lpr(61,25) Error: Illegal qualifier&quot;<br />
<br />
function PopString(): string;<br />
var<br />
  th: pstack_t;<br />
begin<br />
  if integer(g_stacktop^) &lt;&gt; 0 then begin<br />
    th := g_stacktop^;<br />
    Result := PChar(@th.text); // &lt;- ERROR HERE !!!<br />
    g_stacktop^ := th.next;<br />
    GlobalFree(HGLOBAL(th));<br />
  end;<br />
end;<br />
<br />
Any idea how I could fix this?<br />
<br />
This is not my own code, it's from the NSIS plugin example code for Delphi...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">12th July 2008, 20:29</div></div><div class="posttext">Okay!<br />
I guess you may overcome the 100 kb limit if you split your package ;)<br />
I'm testing the examples right now... I'd say you should change the name to Advanced List Plugin to get closer ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">12th July 2008, 20:36</div></div><div class="posttext">I just tinkered with the code and I actually made it compile with Lazarus. The resulting DLL was more than 1 MB in size! Either my Lazarus compiler settings are completely wrong or it creates even bigger binaries than Delphi. Also the DLL crashed with my example installer. That most probably is because I modified the API code wrongly...<br />
<br />
<br />
Splitting a 200 KB file :weird: <br />
<br />
I'll keep on an external mirror then ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">12th July 2008, 21:39</div></div><div class="posttext">Removed the compiled examples from the download, now it's 61 KB in size ;)<br />
http://nsis.sourceforge.net/NSISList_plug-in#Download</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">16th July 2008, 12:45</div></div><div class="posttext">NSISList Plugin (2008-07-16)<br />
This update adds Map (http://en.wikipedia.org/wiki/Associative_array) support to the NSISList plugin :)<br />
<br />
The map is implemented in the header file, using only native List functions.<br />
See the &quot;Examples\NSISList\NSISList_Map.nsi&quot; for info!<br />
<br />
http://nsis.sourceforge.net/NSISList_plug-in#Download</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pospec</div><div class="date">16th July 2008, 12:57</div></div><div class="posttext">Just curious - why do you use Lazarus? Isn't Delphi more &quot;windows native&quot;?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">16th July 2008, 13:01</div></div><div class="posttext">Originally posted by pospec <br />
Just curious - why do you use Lazarus? Isn't Delphi more &quot;windows native&quot;?  <br />
<br />
I don't use Lazarus ;)<br />
<br />
In fact I own a copy of Delphi 7 Professional and I use it for all my projects.<br />
One problem with Delphi is, that it creates huge DLL/EXE files, compared to plain C.<br />
Well, Delphi's standard library is really nice, but it's not &quot;lightweight&quot; at all.<br />
<br />
I tried Lazarus in the hope it will produce a smaller DLL, but the opposite was the case!<br />
It produced a file bigger than 1 MB, Delphi's DLL was only ~100 KB in size.<br />
<br />
On the one hand, 100 KB still is pretty big for such a simple plugin!<br />
On the other hand, we live in the Mircosoft.NET time now :igor:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">17th July 2008, 01:39</div></div><div class="posttext">Okay, if I strip the Lazarus DLL then it's only 150 KB in size :D<br />
Well, that's still bigger than Delphi's DLL so I'll stick to Delphi for compiling!<br />
<br />
Nevertheless the sources for Lanczos are included in the download.<br />
Hopefully somebody can fix them to work...<br />
<br />
Having an alternative compiler can never be wrong ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pospec</div><div class="date">10th December 2008, 10:53</div></div><div class="posttext">Hi LoRd_MuldeR again!<br />
<br />
Map implemetation is nice. However, I'd like to have more functions (simillar to List object - e.g. Count, First, Last and so on).<br />
<br />
Do you think that you'll add these functionalities or should I DIY?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pospec</div><div class="date">10th December 2008, 12:06</div></div><div class="posttext">Another question - documentation reads following:<br />
${List.Unload} (...) This function will unload the NSISList plugin, destroy ALL lists including all of their items and release all memory used by NSISList.<br />
<br />
Do I have to call List.Destroy then? It seems that calling List.Unload once for an instance is enough.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mattm591</div><div class="date">27th May 2009, 15:33</div></div><div class="posttext">Thanks for this plugin, the map support is very useful.<br />
<br />
I just have a couple of queries/requests.<br />
<br />
Firstly, is there a way I can get this plugin to send error messages to a variable instead of displaying a message box.<br />
<br />
Secondly, is there a way I can test to see if a map is already created. I create one in a function that needs to be available in other functions, but if a page is returned to it tries to recreate the map which causes an error box to appear.<br />
<br />
If there is a way to do the first thing I guess that would solve the second thing as I could just check the error message after calling create.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">28th May 2009, 19:08</div></div><div class="posttext">Originally posted by pospec <br />
Hi LoRd_MuldeR again!<br />
<br />
Map implemetation is nice. However, I'd like to have more functions (simillar to List object - e.g. Count, First, Last and so on).<br />
<br />
Do you think that you'll add these functionalities or should I DIY?  <br />
<br />
A map is an unordered data structure. Elements are referenced via their keys. There is no &quot;first&quot; or &quot;last&quot; element.<br />
Internally a map consists of two (ordered) lists, but you should not rely on that (internal) implementation!<br />
<br />
Originally posted by pospec <br />
Another question - documentation reads following:<br />
${List.Unload} (...) This function will unload the NSISList plugin, destroy ALL lists including all of their items and release all memory used by NSISList.<br />
<br />
Do I have to call List.Destroy then? It seems that calling List.Unload once for an instance is enough.  <br />
<br />
Calling it once is sufficient. ALL your lists (and maps) will be gone.<br />
<br />
<br />
Originally posted by mattm591 <br />
Thanks for this plugin, the map support is very useful.<br />
<br />
I just have a couple of queries/requests.<br />
<br />
Firstly, is there a way I can get this plugin to send error messages to a variable instead of displaying a message box. <br />
<br />
This is not implemented. But when using the Plugin properly, you should not encounter any error messages.<br />
The error messages are intended to indicate serious problems to NSIS developers...<br />
<br />
Originally posted by mattm591 <br />
Thanks for this plugin, the map support is very useful.<br />
<br />
Secondly, is there a way I can test to see if a map is already created. I create one in a function that needs to be available in other functions, but if a page is returned to it tries to recreate the map which causes an error box to appear.<br />
<br />
If there is a way to do the first thing I guess that would solve the second thing as I could just check the error message after calling create.  <br />
<br />
No you can't. Make sure you create the map only once!<br />
<br />
For example use the .onInit function to create all lists/maps that are referenced on the global scope.<br />
You can also use a global var to check whether the map was already created...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">valentin.istrate</div><div class="date">20th March 2013, 11:25</div></div><div class="posttext">Hello,<br />
<br />
I created a new NSISList DLL which works with NSIS Unicode. I needed NSISList it for one of my projects but I saw that it doesn't work with Unicode strings.<br />
<br />
The attachment contains the source code and DLL. The project is compiled using Delphi 2007 Professional. I didn't change the Lazarus sources.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">20th March 2013, 12:18</div></div><div class="posttext">Thanks for sharing! Could you add it to the wiki page, too?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">valentin.istrate</div><div class="date">20th March 2013, 12:25</div></div><div class="posttext">If LoRd_MuldeR agrees, I will do that. I'm waiting for a PM reply</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">20th March 2013, 13:49</div></div><div class="posttext">The wiki is for everyone, please add it. As long as you don't claim credit for the original work, there's no reason not to.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">20th March 2013, 16:07</div></div><div class="posttext">If LoRd_MuldeR agrees, I will do that. I'm waiting for a PM reply<br />
<br />
Sure. Thanks for making a Unicode version!<br />
<br />
I could not make a Unicode version, because I only own a license for Delphi 7.0, which is a lost case for Unicode support (yeah, there is a WideString type, but almost all VCL classes don't support it, so you'd have to re-write the complete VCL).</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>