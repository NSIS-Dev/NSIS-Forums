<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" ExecCmd plug-in, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  ExecCmd plug-in NSIS Discussion" />
	
	<title> ExecCmd plug-in [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  ExecCmd plug-in</div>
<hr />
<div class="pda"><a href="t-236277.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=236277">ExecCmd plug-in</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">24th January 2006, 11:33</div></div><div class="posttext">Long ago Joost Verburg wrote about WM_CHAR possibility for console windows, this appeared again few days ago http://forums.winamp.com/showthread.php?s=&amp;postid=1846930#post1846930 , so I updated ExecDos and suddenly found mysqladmin and gnupg problems solved :) New ExecCmd attached to this post. 'Test' dll version allows to see console window.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">25th January 2006, 07:43</div></div><div class="posttext">Good news: wiki page (http://nsis.sourceforge.net/ExecCmd_plug-in); 'ComSpec /C' now appeares at the beginning of the command line (so you don't need to use it in script), but do not forget quotes; /TIMEOUT bug fixed; new /TEST key - displays console window (for debugging); tested on XP - 2003.<br />
Bad news - Win98 problem, console window appeares with toolbar, so I need to find another way to launch application on old systems or to write enhanced code for child console search.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cmenzi</div><div class="date">10th September 2007, 08:00</div></div><div class="posttext">I have the following procedure to execute in background with execcmd. <br />
<br />
ExecCmd::exec /SYNC '&quot;$TEMP\nativeImage\ngen.exe&quot; install &quot;$INSTDIR\xxx.exe&quot;'<br />
<br />
When I use the same cmd-line with ExecWait it works perfectly,  but the cmd-window appears. How can I use ExecCmd to generate native images in background, withour cmd-window?<br />
<br />
When I use /TEST the window appears but only for a 10th of second. When I add &quot;&gt; log.log&quot; to the cmd-line, the is created but it is empty.<br />
<br />
Any suggestion?<br />
<br />
thx</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">10th September 2007, 08:06</div></div><div class="posttext">Might be better to use ExecDos in your situation. And no SYNC option, /ASYNC only, but this require ExecDos::wait after this. For simple situations (short calls) just remove this option at all.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cmenzi</div><div class="date">10th September 2007, 08:21</div></div><div class="posttext">Thanks a lot.<br />
<br />
Now it works as I want.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starrider78</div><div class="date">13th September 2007, 19:33</div></div><div class="posttext">Is there any way to echo the command line program's standard output to the installer log?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">14th September 2007, 06:58</div></div><div class="posttext">http://nsis.sourceforge.net/ExecDos_plug-in offers a lot of output targets.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">16th November 2007, 15:18</div></div><div class="posttext">how can i run this command in cmd.exe:<br />
<br />
sfc /purgecache</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th November 2007, 15:27</div></div><div class="posttext">ExecDos::exec `sfc /purgecache`<br />
Pop $R0 # exit code<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th March 2008, 20:12</div></div><div class="posttext">Hmm I have found that ExecDos doesn't push blank lines to the stack with /TOSTACK. Also if the program outputs an empty string (or in effect, no text) then you also don't get anything on the stack.<br />
<br />
This is usually ok but when you need to check this value this is a problem.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">27th March 2008, 12:39</div></div><div class="posttext">Yes, Stu, this is 'by design'./* supress empty lines */<br />
if(iStack &gt; 0)<br />
...I can agree that empty lines should be pushed to stack as well, but I have not ideas what to push if no output at all (what means 'empty string'?). If no output from application, exit code can help, not 'empty string'.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th March 2008, 15:45</div></div><div class="posttext">In other words, if the program is a command line application and outputs nothing, maybe we should push an empty string.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">27th March 2008, 16:24</div></div><div class="posttext">This case there is no difference with the only &quot;\n&quot; output. Just keep stack empty and check Pop error.<br />
Pops a string off of the stack into user variable $x. If the stack is empty, the error flag will be set.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JoeSam</div><div class="date">19th March 2009, 13:21</div></div><div class="posttext">Erm i have a noob qn (just learnt NSIS yesterday), ExecCmd doesn't seem to work for paths with spaces in them.<br />
<br />
E.g. $PROGRAMFILES\program can't work because of &quot;Program Files&quot; but &quot;C:\program&quot; can.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">19th March 2009, 13:28</div></div><div class="posttext">'&quot;path2exe&quot; params' should work</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">19th March 2009, 13:32</div></div><div class="posttext">make sure you encase paths with spaces in quotes?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ocstjf</div><div class="date">5th June 2009, 22:14</div></div><div class="posttext">In my Function un.onInit I've got:<br />
<br />
  InitPluginsDir<br />
  ExecCmd::exec '&quot;$INSTDIR\bin\RtiDeleteUserData.bat&quot;' &quot;&quot;<br />
<br />
I'm using ExecCmd instead of just ExecShell because I need it to wait, and I'm using ExecCmd instead of ExecWait because I don't want to see a console window.  It worked great for INSTDIR=C:\Program Files\RTI but not for INSTDIR=C:\Program Files (x86)\RTI.  If I use /TEST, the console screen flashes too fast to see what's wrong.  It's ever getting to run my .bat file, I know that, because that has a PAUSE in it.  I know I have the source, and I could build a debug version etc etc, but: anyone have any quicker suggestions?   Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">5th June 2009, 22:43</div></div><div class="posttext">If it's only used temporary to delete some data, why don't you place the batch file in another 'simple' location, like c:\temp, run it from there and delete the batch file afterwards.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ocstjf</div><div class="date">5th June 2009, 22:53</div></div><div class="posttext">Wow, thanks for the quick reply!  It's a fairly complex bat file installed with the product.  As I understand it, to copy a file w/i NSIS I have to ReadFile/WriteFile.  I figured if I'm going to go to that trouble I might as well re-implement the bat file logic within NSIS.  Or am I missing something?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">6th June 2009, 09:33</div></div><div class="posttext">I'm not sure what you mean with &quot;As I understand it, to copy a file w/i NSIS I have to ReadFile/WriteFile&quot;.<br />
<br />
You can add a batch file to your installer like any file, extract it to a temp folder and run it from there.File /oname=$TEMP\RtiDeleteUserData.bat RtiDeleteUserData.bat<br />
SetOutPath $TEMP<br />
ExecWait '&quot;$TEMP\RtiDeleteUserData.bat&quot;'<br />
SetOutPath $INSTDIRBut if you want to have everything in your script, it will be at least more readable if you do it with NSIS commands instead of creating the batch file at runtime.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">6th June 2009, 09:49</div></div><div class="posttext">Ah, of course, you're using it in an uninstaller.<br />
Sorry.<br />
<br />
But you can use CopyFiles to copy the batch file:CopyFiles $INSTDIR\bin\RtiDeleteUserData.bat $TEMP\RtiDeleteUserData.bat<br />
SetOutPath $TEMP<br />
ExecWait '&quot;$TEMP\RtiDeleteUserData.bat&quot;'<br />
SetOutPath $INSTDIR</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ocstjf</div><div class="date">6th June 2009, 18:07</div></div><div class="posttext">Originally posted by jpderuiter <br />
...But you can use CopyFiles to copy the batch file <br />
<br />
Doh!  Not sure how I missed that.  That might solve some other issues for me, too. Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Blatantuk</div><div class="date">5th November 2009, 14:41</div></div><div class="posttext">Hi all,<br />
<br />
I am hoping someone can give some advise on the problem I'm having with the installer I'm writing. I have decided I need to use ExecDos or ExecCmd as I need to perform a console operation without showing a Cmd window.<br />
<br />
the command I am actually trying to perfom is this:<br />
<br />
<br />
[PATH]\mysqladmin.exe --defaults-file=[PATH]\my-small****f --user=root --password=root variables | find &quot;basedir&quot; | find &quot;[EXPECTEDBASEDIR]&quot;<br />
<br />
<br />
The purpose is to launch mysqladmin and find the basedir from the variables output, and thus checking that it is the expected basedir. IE it is OUR mysql server that is running.<br />
<br />
So the expected NSIS code is:<br />
<br />
<br />
;Assuming ${MYSQL} contains the relative path to the mysql directory<br />
<br />
ExecCmd::exec '${MYSQL}\bin\mysqladmin.exe --defaults-file=${MYSQL}\bin\my-small****f --user=root --pass=root variables | find  &quot;basedir&quot; | find &quot;[EXPECTEDBASEDIR]&quot;'<br />
<br />
<br />
This works fine when the mysqlserver is up (returns 0 to stack if ffound, 1 otherwise. And also returns 1 as expected if the mysqlserver is not running.<br />
<br />
However if the ****f file is configured to listen to a port number that is already in a listening state (for example 80 or any port Apache is running on), mysqladmin hangs for a long period of time.<br />
<br />
No problem, thats why we have the /TIMEOUT switch! so the new code is this:<br />
<br />
;Assuming ${MYSQL} contains the relative path to the mysql directory<br />
<br />
ExecCmd::exec /TIMEPOUT=10000 '${MYSQL}\bin\mysqladmin.exe --defaults-file=${MYSQL}\bin\my-small****f --user=root --pass=root variables | find  &quot;basedir&quot; | find &quot;[EXPECTEDBASEDIR]&quot;'<br />
<br />
<br />
And sure enought the timeout works and pops a nice -8 return value. however there is a problem. After performing the above command and returning from the exec call, the processes (mysqladmin.exe, and 2 instances of find.exe) continue to run and not cease like expected with ExecCmd...<br />
<br />
With testing, if I run the cmd with just mysqladmin (removing the 2 calls to find and the 2 pipes) then ExecCmd kills mysqladmin.exe correctly, but not when the output is piped to another app (in this case find)<br />
<br />
can anyone help solve this issue?<br />
<br />
I cant just leave mysqladmin to timeout and die on its own as the situation can arise where the installer completes but there are still child processes running, which may need to be re-used, and which is against our coding guidelines and is very poor practice. <br />
<br />
I do hope someone can help!<br />
<br />
Many thanks in advance,<br />
<br />
Danny</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Blatantuk</div><div class="date">5th November 2009, 14:42</div></div><div class="posttext">seems the forum has changed my configuration file extension ([dot]cnf) to ****f, sorry about that!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ChocJunkie</div><div class="date">14th December 2009, 15:00</div></div><div class="posttext">While struggeling with the probelm described in thread &quot;Execute diskpart&quot; (http://forums.winamp.com/showthread.php?threadid=315341), I came to notice, nsExec::exec changes my stack if it failes (return code 1).<br />
Before I'm calling the function, I push a string onto the stack. After calling the function and popping its return code, the value I'm popping from stack has been changed to 0.<br />
<br />
I've tried around and figured out, the ExecCmd::exec seems to mix up the stack:<br />
<br />
Let's assume, before calling the function, my stack looks like:<br />
  A<br />
  B<br />
  C<br />
<br />
- Now, I'm calling the ExecCmd::exec and getting as return: 1.<br />
- My next pop brings me &quot;B&quot; and the next pop &quot;C&quot;.<br />
<br />
It seems to me, that ExecCmd::exec absorbs my &quot;A&quot;.<br />
<br />
<br />
So far my problem description. I hope someone can understand my gibberish.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ChocJunkie</div><div class="date">14th December 2009, 15:21</div></div><div class="posttext">Ok, I've tested at a point where ExexCmd::exec ends successfully. It also absorbs the first value on stack.<br />
<br />
Summary: ExecCmd::exec pops the first entry from stack.<br />
<br />
It would be great, if someone could fix that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">14th December 2009, 16:51</div></div><div class="posttext">ExecCmd::exec requires at least 2 parameters. Use &quot;&quot; for empty stdin string.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>