<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" The license file does not open the hyperlinks!!!, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  The license file does not open the hyperlinks!!! NSIS Discussion" />
	
	<title> The license file does not open the hyperlinks!!! [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  The license file does not open the hyperlinks!!!</div>
<hr />
<div class="pda"><a href="t-322291.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=322291">The license file does not open the hyperlinks!!!</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">manasi1128</div><div class="date">9th September 2010, 10:59</div></div><div class="posttext">The license.rtf file does not open the hyperlinks....after it gets loaded in the installer ......any idea like wat might b the possible reason.....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">9th September 2010, 11:24</div></div><div class="posttext">Seems that this is not supported in License page:<br />
http://forums.winamp.com/showthread.php?t=291304</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">10th September 2010, 18:51</div></div><div class="posttext">Hyperlinks are supported in License page.<br />
However, make sure you put the full URL visible in the text. Not a hyperlink hidden behind another text.<br />
<br />
If it still doesn't work, are you using Unicode NSIS or custom dialog resources ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">manasi1128</div><div class="date">16th September 2010, 05:40</div></div><div class="posttext">I'm using custom dialogs</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">16th September 2010, 07:56</div></div><div class="posttext">http://forums.winamp.com/showthread.php?t=290291</div></div><hr />


<div class="post"><div class="posttop"><div class="username">manasi1128</div><div class="date">17th September 2010, 10:07</div></div><div class="posttext">I went thru the above url earlier also but not gettin the part of handling WM_NOTIFY event......tried a lot but cud'nt settle down on anything....instead got more confused...can anyone display an example?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">17th September 2010, 10:38</div></div><div class="posttext">http://nsis.sourceforge.net/Docs/nsDialogs/Readme.html#ref-onnotify</div></div><hr />


<div class="post"><div class="posttop"><div class="username">manasi1128</div><div class="date">17th September 2010, 10:44</div></div><div class="posttext">yup tried dat....but dont know why it is not working...following is the code..plz let me know if any thing is wrong<br />
.................<br />
............... <br />
        File /oname=$PLUGINSDIR\amex-license$RANDNUM.rtf ..\cpp\bin\amex-license.rtf  #Manasi--Replaced $TEMP with $PLUGINSDIR----Fix for Bug #8928<br />
        <br />
	nsDialogs::CreateControl /NOUNLOAD &quot;RichEdit20A&quot; ${ES_READONLY}|${WS_VISIBLE}|${WS_CHILD}|${WS_TABSTOP}|${WS_VSCROLL}|${ES_MULTILINE}|${ES_WANTRETURN} ${WS_EX_STATICEDGE} 0 80 100% 130u ''<br />
 	Pop $LICENSE<br />
 	<br />
	FileOpen $4 &quot;$PLUGINSDIR\amex-license$RANDNUM.rtf&quot; r  #Manasi--Replaced $TEMP with $PLUGINSDIR----Fix for Bug #8928.<br />
<br />
	StrCpy $0 $LICENSE<br />
	<br />
	SendMessage $LICENSE ${EM_EXLIMITTEXT}|${EM_AUTOURLDETECT}|${EM_SETEVENTMASK}|${ENM_LINK} 0 0x7fffffff<br />
<br />
	; set EM_AUTOURLDETECT to detect URL automatically<br />
	;Do not detect the links<br />
	SendMessage $LICENSE 1115 1 0<br />
<br />
 nsDialogs::OnNotify /NOUNLOAD $LICENSE click<br />
	System::Get /NoUnload &quot;(i, i .R0, i .R1, i .R2) iss&quot;<br />
	Pop $2<br />
	System::Call /NoUnload &quot;*(i 0, i 0, k r2) i .r3&quot;<br />
......................<br />
.........................</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">17th September 2010, 10:51</div></div><div class="posttext">What is 'click' in the OnNotify call?<br />
You should use a variable with the FunctionAddress of the Callback function there.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">manasi1128</div><div class="date">17th September 2010, 11:01</div></div><div class="posttext">click is a function to be called on WM_NOTIFY event<br />
<br />
I tried  GetFunctionAddress $0 Click before the onnotify call.....but it results in blank richtext.......<br />
not getting any example on net where the On_botify eevent is handled... :cry:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">17th September 2010, 11:29</div></div><div class="posttext">When you use EM_SETEVENTMASK to set the ENM_LINK event on the RichEdit control, that control will send an EN_LINK notification via WM_NOTIFY to the control's -parent-.. in this case, the inner dialog used by nsDialogs.<br />
<br />
Unfortunately, setting up an NSD_OnNotify on that hwnd doesn't seem to work.. the function supplied is never called, at least.. but maybe I'm doing something stupid.<br />
<br />
Using the WndSubClass plugin to catch events on it instead does work, and I can see it grabbing the WM_NOTIFY and detecting clicks (different lparam), but the actual notification sent, in wparam, has a value of 1200.. rather than that of EN_LINK (1803).  So I'm not sure what's going on there.<br />
Edit: Ah - I had a typo somewhere.  The EN_LINK does work off of the RichEdit itself - but you'll need to poke at the ENLINK (see below) to figure out whether the user clicked the link or just moused over the thing.  Funs.<br />
<br />
Then again.. if you then read further into how this is then handled further... the lparam is a pointer to an ENLINK structure.  That ENLINK structure has an MNHDR and a bunch of information... none of which are particularly directly useful (i.e. none contain the link clicked as a nice string).  Instead, you get to poke about at the charrange structure instead... getting the start/end from that.  Then you have to poke at the RichEdit control once again to get the actual text at that start/end range before you have something you could use to open a browser with.<br />
<br />
You'd be much easier off just using the built-in license page if you must have the clickable links inside the text... do you have a particular reason for not using a custom one instead?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">manasi1128</div><div class="date">17th September 2010, 11:44</div></div><div class="posttext">actually the license page is customised to have print and save button also some other additional stuff goes on dat dialog so the the custom dialog feasible here</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">17th September 2010, 12:16</div></div><div class="posttext">actually the license page is customised to have print and save button also some other additional stuff goes on dat dialog so the the custom dialog feasible here<br />
I'm guessing you mean that your custom page has an extra print and save button, rather than the license page.  However, you could modify the actual license page using a resource editor, and then work with those buttons.  The ButtonEvent plugin is an older example of doing something like that:<br />
http://nsis.sourceforge.net/ButtonEvent_plug-in</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">17th September 2010, 16:39</div></div><div class="posttext">Well.. I've got it working with a custom page anyway.<br />
<br />
Edit: Resolved the getting of the text thing.. obviously I need to specify the number of characters I want to retrieve from the buffer specified.  Whoops.<br />
<br />
Here 'tis in all its glory:<br />
<br />
!addincludedir &quot;.&quot;<br />
!addplugindir &quot;.&quot;<br />
!include &quot;nsDialogs.nsh&quot;<br />
!include &quot;LogicLib.nsh&quot;<br />
!include &quot;WinMessages.nsh&quot;<br />
!include &quot;LoadRTF.nsh&quot;<br />
OutFile &quot;$%temp%\temp.exe&quot;<br />
<br />
Section<br />
SectionEnd<br />
<br />
!define /math EM_AUTOURLDETECT ${WM_USER} + 91<br />
!define /math EM_SETEVENTMASK ${WM_USER} + 69<br />
!define /math EM_GETTEXTRANGE ${WM_USER} + 75<br />
<br />
!define ENM_LINK 0x04000000<br />
!define EN_LINK 0x070B<br />
<br />
Page Custom customPage<br />
<br />
Var dialog<br />
Var hwnd<br />
Var null<br />
<br />
Var myRichEdit<br />
<br />
Function customPage<br />
  nsDialogs::Create 1018<br />
  Pop $dialog<br />
  ${If} $dialog == error<br />
    Abort<br />
  ${EndIf}<br />
<br />
  nsDialogs::CreateControl &quot;RichEdit20A&quot; ${ES_READONLY}|${WS_VISIBLE}|${WS_CHILD}|${WS_TABSTOP}|${WS_VSCROLL}|${ES_MULTILINE}|${ES_WANTRETURN} ${WS_EX_STATICEDGE} 0 0 100% 100% ''<br />
  Pop $myRichEdit<br />
<br />
  /* Automatically turn tect with protocol handlers into links */<br />
  SendMessage $myRichEdit ${EM_AUTOURLDETECT} 1 0<br />
  /* Make the RichEdit control report events related to links */<br />
  SendMessage $myRichEdit ${EM_SETEVENTMASK} 0 ${ENM_LINK}<br />
<br />
  /* Set up a callback for WM_NOTIFY messages */<br />
  ${NSD_OnNotify} $myRichEdit myNotify<br />
<br />
  /* Load an RTF file into the control */<br />
  ${LoadRTF} &quot;test.rtf&quot; $myRichEdit<br />
<br />
  nsDialogs::Show<br />
FunctionEnd<br />
<br />
Function myNotify<br />
  Pop $hwnd /* Calling hwnd - should be our richedit.  Check against if you use more than 1 on a page. */<br />
  Pop $1 /* The message being sent.  There's several (mouse over richedit, mouse over link, etc.).  We only care about one. */<br />
  Pop $2 /* Data within the message, for later parsing. */<br />
  <br />
  /* We only care about events related to hyperlinks. */<br />
  ${If} $1 = ${EN_LINK}<br />
    /* Get the data */<br />
    System::Call &quot;*$2(i.r0, i.r1, i.r2, i.r3, i.r4, i.r5, i.r6, i.r7)&quot;<br />
    /* For debugging and such, sets the 3 important message bits in the Branding text area<br />
    GetDlgItem $0 $HWNDPARENT 1028<br />
    SendMessage $0 ${WM_SETTEXT} 0 &quot;STR:$3|$4|$5&quot; */<br />
    ${If} $3 = ${WM_LBUTTONUP}<br />
      /* Calculate number of characters from End - Start ranges */<br />
      IntOp $0 $7 - $6<br />
      /* Allocate a buffer for the text.  No StrAlloc in the released System plugin... */<br />
      System::Call &quot;*(&amp;t$0) i.R0&quot;<br />
      <br />
      /* Create a new TEXTRANGE structure  (chrg CHARRANGE, lpstrText LPSTR) */<br />
      System::Call &quot;*(i$6, i$7, i$R0) i.r1&quot;<br />
      /* Call EM_GETTEXTRANGE */<br />
      SendMessage $myRichEdit ${EM_GETTEXTRANGE} 0 $1 $2<br />
      <br />
      /* Get text out of buffer.. */<br />
      System::Call &quot;*$R0(&amp;t$0.r2)&quot;<br />
      MessageBox MB_OK &quot;Link text: $2&quot;<br />
      <br />
      /* Free memory */<br />
      System::Free $1<br />
      System::Free $0<br />
    ${EndIf}<br />
  ${EndIf}<br />
FunctionEnd<br />
<br />
<br />
Probably still doing a few things wrong, but it seems to work anyway.<br />
<br />
Edit 2: LoadRTF.nsh is from...<br />
http://forums.winamp.com/showthread.php?threadid=288129<br />
...gotta remember to stick that into a wiki page later today &gt;_&lt;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">17th September 2010, 19:41</div></div><div class="posttext">argh. that wasn't the 'edit' button.<br />
<br />
LoadRTF.nsh is now from http://nsis.sourceforge.net/LoadRTF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">17th September 2010, 21:15</div></div><div class="posttext">Looks like there's an intermittent crash from my lack of space for the terminating null char (err.. I think).<br />
<br />
old<br />
<br />
      /* Calculate number of characters from End - Start ranges */<br />
      IntOp $0 $7 - $6<br />
      /* Allocate a buffer for the text.  No StrAlloc in the released System plugin... */<br />
      System::Call &quot;*(&amp;t$0) i.R0&quot;<br />
<br />
<br />
new<br />
<br />
      /* Calculate number of characters from End - Start ranges */<br />
      IntOp $0 $7 - $6<br />
      /* Add one */<br />
      IntOp $0 $0 + 1<br />
      /* Allocate a buffer for the text.  No StrAlloc in the released System plugin... */<br />
      System::Call &quot;*(&amp;t$0) i.R0&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">manasi1128</div><div class="date">20th September 2010, 06:02</div></div><div class="posttext">thanx a tonne dude u made my day!!!!......dat worked now atleast i can capture the onnotify event.... :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">manasi1128</div><div class="date">20th September 2010, 06:19</div></div><div class="posttext">n dis link was veryy helpful for opening the url in new window...<br />
http://nsis.sourceforge.net/Open_link_in_new_browser_window</div></div><hr />


<div class="post"><div class="posttop"><div class="username">manasi1128</div><div class="date">20th September 2010, 08:17</div></div><div class="posttext">one last quastion...den i'm done with the license custom page stuff..... :)<br />
<br />
the rtf file that i'm loading in the richtext control has table of contents in it......so is it possible to acheive that indexing after loading the file in installer??...as in 'go to Top' etc.....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">20th September 2010, 14:53</div></div><div class="posttext">the rtf file that i'm loading in the richtext control has table of contents in it......so is it possible to acheive that indexing after loading the file in installer??...as in 'go to Top' etc.....<br />
I... guess you could if you really wanted to.  I'm starting to think (once again) that a Browser control would be more appropriate here.. then you can just stick HTML in there with all its inherent goodness.<br />
http://nsis.sourceforge.net/NsWeb_plug-in<br />
Might be able to glean from the source what code is used and use System plugin calls instead, but no real need.. the plugin is fairly small.<br />
<br />
But, again, if you really wanted to.. there's an EM_FINDTEXT that you could use as a quasi-anchored link (i.e. you click the link, it searches for the correct subsection with the same string, perhaps, further down the document.. would have to be unique, of course) and gives you the beginning/ending char index... then there's EM_EXSETSEL which you can use to select that range (or just select the position at the beginning of that range), combined with EM_SCROLLCARET which scrolls the caret (which should now be at the selecton) into view.<br />
( there's also an EM_SETSCROLLPOS, but that takes pixels and I haven't the foggiest how one might get from char index to client-doc pixel coords there. )<br />
<br />
But, once more.. Browser control might be better for your exact purposes? ( though the question about links in RTFs has come up several times before, so they'll always have this thread :) )</div></div><hr />


<div class="post"><div class="posttop"><div class="username">manasi1128</div><div class="date">21st September 2010, 05:37</div></div><div class="posttext">thnx dude......now gotta do R&amp;D on dis stuff........</div></div><hr />


<div class="post"><div class="posttop"><div class="username">manasi1128</div><div class="date">21st September 2010, 06:21</div></div><div class="posttext">in the hyperlink case the autodetecturl message makes the link clickable.....wat should i do in dis case....i mean the the table of contents is not clickable.....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">21st September 2010, 13:16</div></div><div class="posttext">well that's another reason a browser control might be better ;)<br />
Although you can set a link on a standard bit of text, the RichEdit control doesn't appear to recognize them straight out of OpenOffice.org re-saved through Wordpad, and inserts the URL behind the linked text.. I think that requires a change to RichEdit 4.1).  There's some more SendMessage craziness that -might- set a link on a given selection, but that drops you back to specifying which text should be linked in your installer code.. and I have no idea if that -would- work (haven't tested.. EM_GETCHARFORMAT SF_SELECTED / CFE_LINK | CFM_LINK / EM_SETCHARFORMAT SF_SELECTED ).<br />
<br />
One completely hacky way would be to just stick http:// in front of the table-of-content items and make that a tiny-sized font (I think the smallest size you can set directly is 1) and hope nobody thinks that silly ;)  Although you could combine that with the above by finding all instances of http:// and hide them entirely through WM_SETCHARFORMAT.<br />
<br />
Really, though, Rich Text Files aren't meant for this sort of thing.. hyperlinks were hacked on by MSFT by popular demand.. but you shouldn't expect HTML-like behavior from an RTF :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>