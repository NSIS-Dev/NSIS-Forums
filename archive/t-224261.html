<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" AddToPath bug?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  AddToPath bug? NSIS Discussion" />
	
	<title> AddToPath bug? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  AddToPath bug?</div>
<hr />
<div class="pda"><a href="t-224261.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=224261">AddToPath bug?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">dblock</div><div class="date">19th August 2005, 14:50</div></div><div class="posttext">I am trying to use AddToPath.<br />
<br />
1. If PATH is not set for the user AddToPath returns an error. Is this a known bug? Am I doing something wrong?<br />
<br />
2. Is there a way to use the current function to set path in HKLM?<br />
<br />
3. It looks like if the PATH is in the current environment it will not be added. It may have been a leftover from some other process (previous aborted installation?), but not added to the registry. This is probably wrong.<br />
<br />
Thx<br />
dB.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th August 2005, 16:23</div></div><div class="posttext">How does it return an error? AddToPath already sets the variable in the registry, if running on NT. I don't understand. What do you mean by the current environement? How can a variable be left over from another process?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dblock</div><div class="date">19th August 2005, 16:48</div></div><div class="posttext">I'll try to be more clear ;)<br />
<br />
1. It fails and sets an error. I didn't dig into why.<br />
<br />
2. There're two sets of PATHs in Windows, your personal path and the system path. It sets the personal path. I want to set the system path.<br />
<br />
3. Let me describe a better real world scenario. <br />
- I have an installer that does AddToPath c:\foobar. <br />
- I already have c:\foobar in HKCU, but the installer sets path in HKLM. <br />
- My current environment is a combination of HKLM and HKCU, hence the installer will never set the HKLM path, which is wrong.<br />
<br />
Thx<br />
dB.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th August 2005, 16:56</div></div><div class="posttext">The function wasn't designed so you can use IfErrors to check for errors after it ran. How exactly does it fail? Does it just set the error flag? Does it write the new value to the registry but doesn't notify about the change? Does it skip writing the new value at all? Define ALL_USERS before including the header file. It's a combination of both and because of that, you already have that path in the PATH variable. That's why it doesn't add it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dblock</div><div class="date">19th August 2005, 21:22</div></div><div class="posttext">Thanks for the replies.<br />
<br />
1. How exactly am I supposed to check for errors? The functions sets the error flag. It does not write the value to the registry.<br />
<br />
2. I have to also add a path to HKCU. I can't have both I presume. I guess I'll have to fork that function...<br />
<br />
3. Well this seems plain wrong from what the installer is trying to accomplish. I need to set the path for all users, not just for the current user installing the application.<br />
<br />
Thx<br />
dB.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th August 2005, 22:12</div></div><div class="posttext">You're not supposed to. I didn't think of this issue when I wrote it. As for the problem again, I realized I don't really understand it. What do you mean by the PATH not being set? I originally thought you meant the PATH key doesn't exist in the registry key, but that shouldn't be a problem. Indeed, you can't have both. You can create two copies of the header with different function names. I think there's also a function in the Wiki that accepts this setting on the stack and not as a define. It might be for general environment variables though and not PATH specifically. Then remove the check :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>