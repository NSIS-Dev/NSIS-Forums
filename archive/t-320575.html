<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" nsProcess and x64 Solution, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  nsProcess and x64 Solution NSIS Discussion" />
	
	<title> nsProcess and x64 Solution [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  nsProcess and x64 Solution</div>
<hr />
<div class="pda"><a href="t-320575.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=320575">nsProcess and x64 Solution</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">underline</div><div class="date">6th July 2010, 18:25</div></div><div class="posttext">Hi all,<br />
<br />
After some tests with x64 OS (XP and 7) I see that only nsProcess plugin (thanks to Instructor) is able to find processes for x64 applications installed and running from &quot;Program Files&quot; and not from &quot;Program Files (x64)&quot;. You can test it easy by installing &quot;WinRAR 64bits&quot; then try to find the running process name &quot;WinRAR.exe&quot;. Only nsProcess plugin is able to find it. All other FindProcess plugins will fail.<br />
<br />
Now my issue:<br />
<br />
Inside my script I use this function:<br />
<br />
http://nsis.sourceforge.net/Get_a_list_of_running_processes<br />
<br />
but now I see that this also fail inside x64 OS. Can anyone update or modify this function or maybe create a new one capable to get a list of running processes also inside x64 OS as this one only works in x86 (32bit) OS?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th July 2010, 21:14</div></div><div class="posttext">That uses some API's that will fail with 64-bit processes among others (namely GetModuleBaseName). A lot of plug-ins use the exact same API's and fail for the same reason.<br />
<br />
There are 4 options that I can think of:<br />
1. Use EnumProcesses (http://msdn.microsoft.com/en-us/library/ms682629%28v=VS.85%29.aspx) to get an array of process id's followed by an OpenProcess with PROCESS_QUERY_INFORMATION and then a GetModuleFileNameEx (http://msdn.microsoft.com/en-us/library/ms683197%28VS.85%29.aspx).<br />
2. Use NtQuerySystemInformation (http://msdn.microsoft.com/en-us/library/ms724509%28VS.85%29.aspx) with SystemProcessInformation to get an (undocumented) SYSTEM_PROCESS_INFORMATION struct (see http://processhacker.sourceforge.net/hacking/structs.php - the MSDN page does not document the entire struct) - Instructor's nsProcess plug-in uses this on Windows 2000+.<br />
3. Use the WmiInspector::Request plug-in function with the Win32_Process class (http://msdn.microsoft.com/en-us/library/aa394372%28VS.85%29.aspx).<br />
4. Write a .NET DLL (the System.Diagnostics.Process.GetProcesses() (http://msdn.microsoft.com/en-us/library/1f3ys1f9.aspx) method is what you need) and call it using the CLR plug-in.<br />
<br />
All of the above only work on Windows 2000 and above. 1 and 2 can be done using the System plug-in directly or in a DLL and called using the System plug-in.<br />
<br />
Perhaps I'll add this as another utility function to LockedList, but first can I enquire why you need a list of all processes?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">underline</div><div class="date">7th July 2010, 11:55</div></div><div class="posttext">Hi Afrow<br />
<br />
I needed a list of all running processes to check some incompatible processes with my app but now is fixed as I just search only for incompatible processes using nsProcess plugin instead getting first a list of all running processes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th July 2010, 13:17</div></div><div class="posttext">Just to end this topic I have added an EnumProcesses function to LockedList which allows processes to be enumerated using a callback function. I have also added a FindProcess function which works on x64.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>