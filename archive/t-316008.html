<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Deleting a registry key from HKLM in vista w/ UAC, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Deleting a registry key from HKLM in vista w/ UAC NSIS Discussion" />
	
	<title> Deleting a registry key from HKLM in vista w/ UAC [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Deleting a registry key from HKLM in vista w/ UAC</div>
<hr />
<div class="pda"><a href="t-316008.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=316008">Deleting a registry key from HKLM in vista w/ UAC</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">taxilian</div><div class="date">4th January 2010, 23:40</div></div><div class="posttext">I've been using NSIS for awhile with no problems, but the last week or two I have been completely defeated.<br />
<br />
I recently discovered that our COM registration occasionally writes to HKLM instead of HKCU, due to some legacy code that we didn't realize was active.  The problem with that is that under certain circumstances, the CLSID is still registered in HKLM and thus installs to HKCU aren't detected until it is deleted from HKLM.<br />
<br />
So, I set my installer to request elevation if it detects that the registry key is there.  No errors, everything says it's working, but the key doesn't get deleted.  So, I set &quot;RequestEexecutionLevel admin&quot;; no luck.  Tried running the installer explicitely as Administrator; no luck.<br />
<br />
I have used the DeleteRegKey NSIS function, SHDeleteKey windows API function, and the RegDeleteTree windows API function introduced in Vista.  None of them work.  I can write to or delete from anywhere else in the registry except HKLM/SOFTWARE/Classes/CLSID; HKCU doesn't seem to even work, and HKCR accesses HKCU/SOFTWARE/Classes.<br />
<br />
I'm completely running out of ideas; it looks like perhaps the registry virtualization is messing me up, but I can't figure out how to fix it.  I am always setting RequestExecutionLevel.<br />
<br />
Any ideas?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">meaningoflights</div><div class="date">6th January 2010, 11:34</div></div><div class="posttext">I feel your pain.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">meaningoflights</div><div class="date">8th January 2010, 11:31</div></div><div class="posttext">have u made any progress? do you have access to the source code of the COM component? where you can put a condition to take care of it in there for vista users</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>