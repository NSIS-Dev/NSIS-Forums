<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" SetShellVarContext, other than current and all?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  SetShellVarContext, other than current and all? NSIS Discussion" />
	
	<title> SetShellVarContext, other than current and all? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  SetShellVarContext, other than current and all?</div>
<hr />
<div class="pda"><a href="t-240831.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=240831">SetShellVarContext, other than current and all?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">longoja</div><div class="date">14th March 2006, 19:01</div></div><div class="posttext">I am creating a .exe that is pushed to a machine, and then installed.  However the system that pushes it and fires off the .exe, is admin.  I would like to create shortcuts for a specific user.<br />
<br />
I know you can use SetShellVarContext, but only for &quot;all&quot; and &quot;current&quot;.  This does me no good.<br />
<br />
Is there a way to create shortcuts for a specific user?<br />
<br />
Let's say you have users<br />
<br />
admin<br />
joe<br />
lisa<br />
default<br />
<br />
How would I create a shortcut for just one of them?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th March 2006, 20:15</div></div><div class="posttext">Assuming you want the desktop as an example, the simplest solution would be assuming the directory is in C:\Documents and Settings. But the language can change, so you can use &quot;$APPDATA\..\Desktop&quot;. However, the user's profile can be somewhere else, or the desktop's directory could be named differently. So, you can use EnumUsersReg (http://nsis.sourceforge.net/EnumUsersReg), or some variant of it, to load the registry of the user and read the value from &quot;HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders\Desktop&quot;. This value can be missing because the user hasn't logged on yet, or hasn't used the folder in question. To be sure, you can run your installer as the user, or manually use SHGetFolderPath (http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/functions/shgetfolderpath.asp), passing it a token of the user. But for the token to exist, you need to log on the user and for that you need an interactive installation or the password of the user.<br />
<br />
The best solution would probably be mounting the user's registry and setting your installer to run on start-up. You could also run a thin client that'd connect to your server with a named pipe so you can use ImpersonateNamedPipeClient (http://msdn.microsoft.com/library/en-us/secauthz/security/impersonatenamedpipeclient.asp) and CreateProcessAsUser (http://msdn.microsoft.com/library/en-us/dllproc/base/createprocessasuser.asp) to run the installer on the user's behalf. If you need administrator rights in the installer, you could use SHGetFolderPath (http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/functions/shgetfolderpath.asp) with the impersonation token in your server and pass the result to the installer on the command line.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>