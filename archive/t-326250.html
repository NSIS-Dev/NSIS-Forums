<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem sending string arg to DLL function, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem sending string arg to DLL function NSIS Discussion" />
	
	<title> Problem sending string arg to DLL function [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem sending string arg to DLL function</div>
<hr />
<div class="pda"><a href="t-326250.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=326250">Problem sending string arg to DLL function</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">yotambarzilay</div><div class="date">20th January 2011, 16:07</div></div><div class="posttext">Hey all, <br />
I need some assistant.<br />
I'm calling a DLL function from an NSIS script. The function takes a char* as an argument. However, when I send a string to the DLL function, I only get the first char of the string.<br />
<br />
Here's the call to the function:<br />
Processes::KillParentProcess &quot;chrome&quot;<br />
<br />
I get the string in the DLL by using popstring(char* str)<br />
<br />
To debug, I used a message box and only got &quot;c&quot; instead of &quot;chrome&quot;<br />
<br />
I'd really appreciate some input on this</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rebot</div><div class="date">15th April 2011, 22:40</div></div><div class="posttext">I'm having the same issue....anybody have any advice? Popstring is returning only the first character from the string parameter.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th April 2011, 23:09</div></div><div class="posttext">Are you using Unicode NSIS with a non-unicode DLL or maybe vice-versa?<br />
<br />
Some code would help too.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rebot</div><div class="date">15th April 2011, 23:27</div></div><div class="posttext">Unicode NSIS with Unicode RealProgress plugin.<br />
<br />
From the call to plugin: <br />
 RealProgress::DetailProgress /NOUNLOAD 30 40<br />
<br />
Debugging the plugin code...in the function<br />
<br />
int popstring(TCHAR *str, int len)<br />
{<br />
  stack_t *th;<br />
<br />
  if (!g_stacktop || !*g_stacktop) return 1;<br />
  th=(*g_stacktop);<br />
  lstrcpyn(str, th-&gt;text, len);<br />
  *g_stacktop=th-&gt;next;<br />
  GlobalFree((HGLOBAL)th);<br />
  return 0;<br />
}<br />
<br />
str is returning '3' (as opposed to '30') when called from the DetailProgress function...<br />
<br />
extern &quot;C&quot;<br />
void __declspec(dllexport) DetailProgress(HWND hWndParent, int string_size, <br />
                                      TCHAR *variables, stack_t **stacktop,<br />
                                      extra_parameters *extra)<br />
{<br />
  g_hWndParent=hWndParent;<br />
<br />
  EXDLL_INIT();<br />
  {<br />
    TCHAR szParam[8];<br />
<br />
    // Attempt to get a parameter.<br />
    if (popstring(szParam, 8) == 0)<br />
    {<br />
	  <br />
          //szParam evaluated at this point is '3' <br />
          //MessageBox(hWndParent, szParam, &quot;Add szParam&quot;, MB_OK);          <br />
<br />
          // Get the number of details to be printed.<br />
          g_iProgressBarAdd = str2int(szParam);<br />
		<br />
          .<br />
          .<br />
          etc.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th April 2011, 23:37</div></div><div class="posttext">Are you definitely using Unicode character set in the plug-in? Sounds to me like you aren't because a Unicode '3' would be an ASCII '3' padded with a leading NULL byte thereby terminating the string as a single ASCII character.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th April 2011, 23:39</div></div><div class="posttext">I should probably elaborate a bit more:<br />
<br />
* Check you have Unicode selected in Properties (that one is too obvious I know)<br />
* Check you have since done a Clean/Rebuild<br />
* Are you using the Unicode pluginapi.lib and header?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rebot</div><div class="date">16th April 2011, 01:09</div></div><div class="posttext">Yes. Unicode versions of all.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th April 2011, 10:30</div></div><div class="posttext">Well I'll need more than that. Attach the files including the vcxproj.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rebot</div><div class="date">18th April 2011, 18:43</div></div><div class="posttext">vcproj file can be found here (http://pastebin.com/PUTBNvT5)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th April 2011, 19:21</div></div><div class="posttext">I said files including the vcproj. I can't build without all the files.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rebot</div><div class="date">29th April 2011, 01:26</div></div><div class="posttext">Plugin files can be found below:<br />
<br />
RealProgress.cpp (http://dl.dropbox.com/u/27630314/RealProgress/RealProgress.cpp)<br />
RealProgress.vcproj (http://dl.dropbox.com/u/27630314/RealProgress/RealProgress.vcproj)<br />
RealProgress.dsp (http://dl.dropbox.com/u/27630314/RealProgress/RealProgress.dsp)<br />
RealProgress.sln (http://dl.dropbox.com/u/27630314/RealProgress/RealProgress.sln)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th April 2011, 10:41</div></div><div class="posttext">I can't see any reference to the Unicode plug-in API in there. You should really use that. For an example, look at my Aero plug-in which has both ANSI and Unicode plug-in APIs bundled and a build configuration for each. Also if you use the plug-in API you get myatoi and myatou so you don't need to use CRT (which you want to avoid).<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>