<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Issues with  Find* commands, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Issues with  Find* commands NSIS Discussion" />
	
	<title> Issues with  Find* commands [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Issues with  Find* commands</div>
<hr />
<div class="pda"><a href="t-119226.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=119226">Issues with  Find* commands</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Bud-froggy</div><div class="date">27th December 2002, 22:13</div></div><div class="posttext">Ok, im lost.<br />
Im using the modern UI and set up a custom page.<br />
Now, this custom page is given a directory, and then searches for all folders in the directory.  It then displays all the folders on the custom page.<br />
Now, this function works fine with my computer, but one of my guinea pigs has reported that the FindFirst and FindNext functions, when given a valid directory containing subdirectories, returns '.', '..' and then reports that there is nothing else.<br />
<br />
Now, I was messing around with the installer on my system, and if go thru the process until my custom page, and hit back, bringing me to the 'choose installation dir', then next right away (still giving it a good dir), then it skips the entire custom page and goes to the installation, even though it worked the first time around.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">27th December 2002, 23:36</div></div><div class="posttext">Have you used FindClose?<br />
Is the custom page callback function called?<br />
Are you sure your guinea pig has files in that directory?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Bud-froggy</div><div class="date">28th December 2002, 14:53</div></div><div class="posttext">Originally posted by kichik <br />
Have you used FindClose?<br />
Yes...<br />
<br />
Is the custom page callback function called?<br />
As in:<br />
Page custom SetCustomMod &quot;$(TEXT_IO_PAGETITLE)&quot;<br />
?<br />
yes<br />
<br />
Are you sure your guinea pig has files in that directory? <br />
Certain... I even ftp'ed in and double checked....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th December 2002, 14:55</div></div><div class="posttext">Can you please attach the script?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Bud-froggy</div><div class="date">28th December 2002, 21:48</div></div><div class="posttext">Originally posted by kichik <br />
Can you please attach the script? <br />
<br />
The custom function starts at line 318...<br />
Thanks =)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th December 2002, 22:18</div></div><div class="posttext">I can't test it because I don't have ioMod.ini. Can you please attach that too?<br />
<br />
A few things I have noticed from reading the script:<br />
  You are using File* to write into INI files, that's not a good idea. WriteIniStr and friends (http://nsis.sourceforge.net/Docs/Chapter3.html#3.7.2) are much much safer as you don't need to strugle with line breaks, offsets and searching for fields.<br />
  You are using Push (number) Pop $var instead of just StrCpy $var (number)<br />
  You are using:<br />
FileWrite $R1 &quot;[Field &quot;<br />
FileWrite $R1 $R8<br />
Instead of the shorter:<br />
FileWrite $R1 &quot;[Field $R8]&quot;<br />
  You have two warnings because you didn't use !insertmacro MUI_PAGECOMMAND_WELCOME but defined MUI_WELCOMEPAGE, and because you defined MUI_UNINSTALLER but didn't use WriteUninstaller.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Bud-froggy</div><div class="date">29th December 2002, 10:57</div></div><div class="posttext">I maintain that the code is still in dev which accounts for all the hideous commands =)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th December 2002, 17:33</div></div><div class="posttext">I am pretty sure the problem is with the coding, the errors and warning I have mentioned above. When I ran the installer the first time I got to the custom page it showed Text=Something a lot of times and when I pressed back and then forward again it just skipped it... The IO distortion is caused by mis-using File* and the skipping by mis-checking something there:<br />
<br />
IntOp $R8 $R8 - 1 #already loaded for next field<br />
IntCmp $R8 1 NoMod</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Bud-froggy</div><div class="date">30th December 2002, 19:14</div></div><div class="posttext">Originally posted by kichik <br />
I am pretty sure the problem is with the coding, the errors and warning I have mentioned above.<br />
I had removed those before uplaoding it for a second time with the ioMod.ini file...<br />
<br />
When I ran the installer the first time I got to the custom page it showed Text=Something a lot of times and when I pressed back and then forward again it just skipped it... The IO distortion is caused by mis-using File* and the skipping by mis-checking something there:<br />
<br />
IntOp $R8 $R8 - 1 #already loaded for next field<br />
IntCmp $R8 1 NoMod <br />
<br />
I dont see how this could be an issue.<br />
The varibale is initialized to 2, meaning that we should start writing to Field 2 in the ioMod.ini... <br />
If the installer encouters a valid directory, it will increment the varibale.  At the end, i subtract 1 from it, because i add one at the end of every filewrite toioMod.ini, and if it is equal to 1, its value was never changed, since it was initialized to 2.  In this case, I create a new field on my custom page, and output some text telling the user that (s)he did not select a valid directory... <br />
<br />
Now, I rewrote everything so that it uses the cute little ini functions (a waste if you ask me, but if it makes you happy...), but the problem persists.  I tested it on a friends system with some dummy files, and the process failed miserably.  It did not detect any of the valid directories, AND it did not write the error report to the custom page either... In fact, it skipped the custom page entirely.  I looked at the ioMod.ini file in the $PLUGINSDIR directory, and it was untouched...<br />
<br />
I am off on vacation right now, so I cant do a full test and what not, but I will as soon as i get back.  In the meantime, please find attached the script as well as the ioMod.ini file...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st December 2002, 15:49</div></div><div class="posttext">It wasn't a waste at all, you just forgot to add one thing, &quot;$PLUGINSDIR\&quot; ;)<br />
<br />
Everywhere you have used WriteIniStr you forgot to add &quot;$PLUGINSDIR\&quot;. After I have added this it works perfectly fine for me.<br />
<br />
You may also want to only write the INI once so the installer won't have search for the canidates more than once, and so the IO page will &quot;remember&quot; what option was last selected.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Bud-froggy</div><div class="date">31st December 2002, 17:21</div></div><div class="posttext">I added that yesterday and started testing...<br />
<br />
Try this: run the installer the first time, then let it idle on the custom page.  If you then launch a new instance, the installer will skip the custom page all together and go to the installation part....<br />
<br />
I will continue testing once i get home becuase i feel as though i cannot concentrate here...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st December 2002, 17:46</div></div><div class="posttext">This error can be fixed by adding ClearErrors before the FindFirst command in SetCustomMod, line ~340. This means that a error has occured above which you have not checked. It's always a good idea to clear the error flag before you call a command that might set the error flag which you would like to later check.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">1st January 2003, 01:47</div></div><div class="posttext">In case you haven't found it already, the following line towards the start of Function SetCustomMod has a typo File /oname=$PLUGINSDIRS\ioMod.ini ioMod.ini should be $PLUGINSDIR (without trailing S).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Bud-froggy</div><div class="date">2nd January 2003, 02:13</div></div><div class="posttext">which suprisingly does not matter since I open the the correct file a little later, and perform the writes from there.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>