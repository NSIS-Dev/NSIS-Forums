<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How convert string to UTF-8?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How convert string to UTF-8? NSIS Discussion" />
	
	<title> How convert string to UTF-8? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How convert string to UTF-8?</div>
<hr />
<div class="pda"><a href="t-255670.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=255670">How convert string to UTF-8?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Karfax2</div><div class="date">17th September 2006, 13:41</div></div><div class="posttext">I get path of application data directory by variable $APPDATA and I need write this string in XML file (I use XML NSIS plugin v1.7). Code like this:<br />
<br />
${xml::LoadFile} &quot;test.xml&quot; $0<br />
${xml::GotoPath} &quot;/a/c/m&quot; $0<br />
${xml::SetText} &quot;$APPDATA\sdc\Logs\&quot; $0<br />
${xml::SaveFile} &quot;test_saved.xml&quot; $0<br />
${xml::Unload}<br />
<br />
But $APPDATA may contented symbols of win1251 code page (russian language), and XML file must be in UTF-8 encoding.<br />
<br />
How correctly write strin in xml-file?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">17th September 2006, 16:43</div></div><div class="posttext">Name &quot;Output&quot;<br />
OutFile &quot;Output.exe&quot;<br />
<br />
Section<br />
	Push &quot;ï¿½_ÑƒÑÑÐºÐ¸Ð¹&quot;         #Input text<br />
	Push &quot;1251&quot;            #Input text code page (multi byte)<br />
	Push &quot;65001&quot;           #Output text code page (multi byte)<br />
	Call ConvertMultiByte<br />
	Pop $0                 #Output text<br />
<br />
	MessageBox MB_OK '$$0={$0}'<br />
SectionEnd<br />
<br />
<br />
Function ConvertMultiByte<br />
	Exch $2<br />
	Exch<br />
	Exch $1<br />
	Exch<br />
	Exch 2<br />
	Exch $0<br />
	Exch 2<br />
	Push $3<br />
	Push $4<br />
	Push $5<br />
	Push $6<br />
	Push $7<br />
<br />
	StrLen $3 $0<br />
	IntOp $3 $3 + 1<br />
	IntOp $4 $3 * 2<br />
	IntOp $5 $3 * 3<br />
<br />
	System::Alloc /NOUNLOAD $4<br />
	Pop $6<br />
	System::Call /NOUNLOAD 'kernel32::MultiByteToWideChar(i $1, i 0, t r0, i r3, i r6, i r3)'<br />
<br />
	System::Alloc /NOUNLOAD $5<br />
	Pop $7<br />
	System::Call /NOUNLOAD 'kernel32::WideCharToMultiByte(i $2, i 0, i r6, i r3, i r7, i r5, i 0, i 0)'<br />
<br />
	System::Call /NOUNLOAD '*$7(&amp;t${NSIS_MAX_STRLEN} .r0)'<br />
	System::Free /NOUNLOAD $6<br />
	System::Free $7<br />
<br />
	Pop $7<br />
	Pop $6<br />
	Pop $5<br />
	Pop $4<br />
	Pop $3<br />
	Pop $2<br />
	Pop $1<br />
	Exch $0<br />
FunctionEnd<br />
<br />
Edit:<br />
Working fine now :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Karfax2</div><div class="date">18th September 2006, 10:53</div></div><div class="posttext">Thx. It's work.<br />
<br />
One more question. How it is possible to converte a txt-file in UTF-8?<br />
<br />
In my code many lines which need to be converted. And consequently it is easier to write all of them in a file, and converte this file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">18th September 2006, 13:55</div></div><div class="posttext">http://nsis.sourceforge.net/Unicode_files_conversion_plugin</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>