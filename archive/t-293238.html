<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Dll function isn't called on Vista 64-bit, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Dll function isn't called on Vista 64-bit NSIS Discussion" />
	
	<title> Dll function isn't called on Vista 64-bit [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Dll function isn't called on Vista 64-bit</div>
<hr />
<div class="pda"><a href="t-293238.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=293238">Dll function isn't called on Vista 64-bit</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">BuilderBob</div><div class="date">17th June 2008, 12:24</div></div><div class="posttext">Hello,<br />
I have an external dll function that i want to call from nsis. It works on any Win 32bit, but not on Vista 64-bit.<br />
<br />
I added a MessageBox as the first line of the dll function, but didn't see it, so even the first line isn't reached.<br />
<br />
I checked that the nsis installer knows exactly where the dll is with a MessageBox in the installer. Checked ok.<br />
<br />
Is there a known bug and workaround for this? Should I have special definitions in the dll source code?<br />
<br />
<br />
<br />
SetCompressor lzma<br />
<br />
OutFile .\Setup.exe<br />
<br />
Name &quot;Setup&quot;<br />
RequestExecutionLevel admin<br />
<br />
SilentInstall silent<br />
<br />
!Include LogicLib.nsh<br />
<br />
<br />
Section<br />
	StrCpy $0 &quot;$PROGRAMFILES\ExistingDir\Existing.dll&quot;<br />
	System::Call &quot;$0::FuncWithInt(i) v(4.).. ? u&quot;<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BuilderBob</div><div class="date">17th June 2008, 14:46</div></div><div class="posttext">I made a small non-silent test installer that only calls the dll and got the attached error.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th June 2008, 18:49</div></div><div class="posttext">Are you sure it's in C:\Program Files (x86) and not C:\Program Files?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BuilderBob</div><div class="date">18th June 2008, 09:19</div></div><div class="posttext">Yes, I checked the path with a MessageBox.<br />
The annoying fact (but also one that saves me right now) is that doing it in WISE works. Also, writing in WISE only the part that calls the dll, and executing it from NSIS, works.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th June 2008, 15:12</div></div><div class="posttext">Try adding the `e' flag to the System::Call flags (right after that last `u') and pop the error code. It might shed some light on the issue. But if it's only on x64 it really sounds like a bad path. Try having NSIS check it for you with ${If} ${FileExists}.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nonubik</div><div class="date">27th June 2008, 16:10</div></div><div class="posttext">I have the same problem. My code is:<br />
<br />
${DisableX64FSRedirection}<br />
  MessageBox MB_OK &quot;$INSTDIR\Mydll.dll&quot;<br />
  IfFileExists &quot;$INSTDIR\Mydll.dll&quot; 0 +2<br />
  MessageBox MB_OK &quot;yes&quot;<br />
  System::Call '$INSTDIR\MyDll.dll::Run(t `&quot;$INSTDIR\Myexe.exe&quot;`) i.r1 ?e'<br />
  Pop $1<br />
  MessageBox MB_OK &quot;$INSTDIR\Myexe.exe&quot;<br />
  MessageBox MB_OK $1<br />
  ${EnableX64FSRedirection}<br />
<br />
As you can see, lots of Message boxes. All shows Mydll.dll in its place, C:\Program Files\..etc and it's really there, not in C:\Program Files(x86)\<br />
I also have the 'yes' message box, so the file is there, as for the error, it's 0.<br />
<br />
My guess is that the exported function from dll it's not even called. In x86 it works just fine.<br />
<br />
I also suspect that's because internally System::Call does a LoadLibrary, GetProcAddress and then calls the function. But from an x86 process (i.e. the installer) you cannot load an x64 dll (Mydll.dll).<br />
<br />
Does System::Call use LoadLibrary and the rest?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mani95</div><div class="date">30th June 2008, 22:37</div></div><div class="posttext">Originally posted by BuilderBob <br />
Yes, I checked the path with a MessageBox.<br />
The annoying fact (but also one that saves me right now) is that doing it in WISE works. Also, writing in WISE only the part that calls the dll, and executing it from NSIS, works.  <br />
<br />
Even it works very fine in InstallAware also, which has excellent 32/64 bit support and vista compliancy.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">30th June 2008, 22:45</div></div><div class="posttext">Originally posted by mani95 <br />
Even it works very fine in InstallAware also, which has excellent 32/64 bit support and vista compliancy. <br />
mani95 don't you know any better way to make money instead of advertising InstallAware (sucks) here in nsis discussion forums?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>