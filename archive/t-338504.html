<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" macro params return garbage, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  macro params return garbage NSIS Discussion" />
	
	<title> macro params return garbage [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  macro params return garbage</div>
<hr />
<div class="pda"><a href="t-338504.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=338504">macro params return garbage</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">NOCaut</div><div class="date">30th November 2011, 09:43</div></div><div class="posttext">correctly whether I put significance from the macro?<br />
<br />
!macro ConfigReadFrom _FILE _ENTRY _RESULT<br />
StrCpy ${_RESULT} $0	<br />
Pop ${_RESULT}<br />
MessageBox MB_OK $0 <br />
MessageBox MB_OK ${_RESULT} // 8.0.2342..<br />
<br />
!macroend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">30th November 2011, 11:37</div></div><div class="posttext">You're copying $0 into ${_Result}. You probably want to do it the other way around.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NOCaut</div><div class="date">30th November 2011, 11:39</div></div><div class="posttext">$0 -is my result. how i can get this param<br />
<br />
!insertmacro ConfigReadFrom &quot;Filename&quot; &quot;prm&quot; $R0<br />
 messagebox MB_OK $R0 // garbage</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NOCaut</div><div class="date">30th November 2011, 11:46</div></div><div class="posttext">!macro ConfigReadFrom _FILE _ENTRY _RESULT <br />
!define _LPrefix L${__LINE__}	<br />
	StrCpy $0 &quot;&quot;<br />
	StrCpy $1 &quot;&quot;<br />
	StrCpy ${_RESULT} &quot;&quot;<br />
	StrCpy $0 ${_FILE} <br />
	StrCpy $1 ${_ENTRY} 	<br />
	ClearErrors<br />
 <br />
	FileOpen $2 $0 r<br />
	IfErrors ${_LPrefix}error<br />
	StrLen $0 $1<br />
	StrCmp $0 0 ${_LPrefix}error<br />
 <br />
	${_LPrefix}readnext:<br />
	FileRead $2 $3<br />
	IfErrors ${_LPrefix}error<br />
	StrCpy $4 $3 $0<br />
	StrCmp $4 $1 0 ${_LPrefix}readnext<br />
	StrCpy $0 $3 '' $0<br />
	StrCpy $4 $0 1 -1<br />
	StrCmp $4 '$\r' +2<br />
	StrCmp $4 '$\n' 0 ${_LPrefix}close<br />
	StrCpy $0 $0 -1<br />
	goto -4<br />
 <br />
	${_LPrefix}error:<br />
	SetErrors<br />
	StrCpy $0 ''<br />
 <br />
	${_LPrefix}close:<br />
	FileClose $2 	<br />
	<br />
	StrCpy ${_RESULT} $0<br />
	Pop ${_RESULT}	<br />
!undef _LPrefix		  	<br />
!macroend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">30th November 2011, 12:59</div></div><div class="posttext">The problem lies in the pop command at the end. You're popping something off the stack, while nothing has been pushed onto the stack first! So you're popping data that belongs to some other function. So it's not very strange that it's garbage, don't you agree?<br />
<br />
You should remove the pop command entirely.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NOCaut</div><div class="date">30th November 2011, 13:54</div></div><div class="posttext">Thank work is good twice. when i call 3 not work. What is wrong?<br />
!macro ConfigReadFrom _FILE _ENTRY<br />
!define _LPrefix L${__LINE__}   <br />
Exch $0<br />
...<br />
Exch $0<br />
!undef _LPrefix               <br />
!macroend  <br />
<br />
!insertmacro ConfigReadFrom &quot;Filename&quot; &quot;prm&quot;<br />
Pop $0<br />
 messagebox MB_OK $R0 // garbage</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NOCaut</div><div class="date">30th November 2011, 14:17</div></div><div class="posttext">i rewrite this code from function http://nsis.sourceforge.net/ConfigRead to macro</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">30th November 2011, 15:12</div></div><div class="posttext">Still wrong. If you want to back up the contents of $0, you should first push $0, and at the end pop $0.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NOCaut</div><div class="date">30th November 2011, 15:34</div></div><div class="posttext">ok i tray</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>