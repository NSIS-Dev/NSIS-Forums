<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" ReadRegStr - Section choice?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  ReadRegStr - Section choice? NSIS Discussion" />
	
	<title> ReadRegStr - Section choice? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  ReadRegStr - Section choice?</div>
<hr />
<div class="pda"><a href="t-144807.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=144807">ReadRegStr - Section choice?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">tatsudoshi</div><div class="date">5th August 2003, 16:55</div></div><div class="posttext">I need to make my installer do 1 of 2 things:<br />
<br />
1.: Either do an automated check and set the InstallDir to that or<br />
2.: Have the user choose 1 of 2 install options and it then need to check if the choice is valid.<br />
<br />
My script is now at the 2.nd choice, but I'd much rather like it if it was the 1.st option my install used. My code is right now like this:<br />
<br />
<br />
DirText \<br />
  &quot;If HL / CS directory is not found, please choose the right directory :&quot;<br />
<br />
InstallDirRegKey HKLM Software\xes InstallDir<br />
<br />
Function .onInit<br />
ReadRegStr $0 HKCU &quot;Software\Valve\Half-Life\&quot; &quot;InstallPath&quot;<br />
;ReadRegStr $0 HKCU &quot;Software\Valve\Counter-Strike&quot;<br />
FunctionEnd<br />
<br />
InstallDir \cstrike<br />
<br />
SubSection /e &quot;Choose MOD or Retail Counter-strike&quot;<br />
<br />
  Section &quot;Retail&quot;<br />
    ReadRegStr $INSTDIR HKCU &quot;Software\Valve\Counter-Strike&quot; InstallPath<br />
  SectionEnd<br />
  Section &quot;MOD&quot;<br />
    ReadRegStr $INSTDIR HKCU &quot;Software\Valve\Half-Life&quot; InstallPath<br />
  SectionEnd<br />
<br />
SubSectionEnd<br />
<br />
..but this really doesn't work, as you might be able to see. Any help would be greatly appriciated. (Sorry for spelling errors)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th August 2003, 17:05</div></div><div class="posttext">You can check if the read values are correct or not by doing:<br />
ReadRegStr $INSTDIR HKCU &quot;Software\Valve\Counter-Strike&quot; InstallPath<br />
 StrCmp $INSTDIR &quot;&quot; 0 +3<br />
ReadRegStr $INSTDIR HKCU &quot;Software\Valve\Half-Life&quot; InstallPath<br />
 StrCmp $INSTDIR &quot;&quot; +2<br />
 IfFileExists &quot;$INSTDIR\*.*&quot; 0 +2<br />
MessageBox MB_OK|MB_ICONEXCLAMATION &quot;You do not have Half-Life installed!$\r$\nSetup will not continue!&quot;<br />
Abort<br />
<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th August 2003, 17:07</div></div><div class="posttext">To only allow one component being selected from a group of 2, have a look at Examples\one-section.nsi.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tatsudoshi</div><div class="date">5th August 2003, 18:08</div></div><div class="posttext">So I don't need InstallDir at all, right? Is the code you made a &quot;choose&quot; or &quot;automated&quot; code? It needs to be in a section or function right?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tatsudoshi</div><div class="date">5th August 2003, 18:26</div></div><div class="posttext">So this code would requier the user to choose a directory and it would check the path.. can't it just read the regstr at load or start of installer so the user don't have to do anything other then choose to install it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th August 2003, 20:41</div></div><div class="posttext">InstallDir will set the directory on the Directory page, unless it is changed in a function before the user reaches the Directory page.<br />
<br />
My code can indeed be used in the .onInit function, then it will set the InstallDir depending on what the registry keys retreaved were.<br />
<br />
I have made changes so that if both registry values are blank, then it will use the defined InstallDir from compile-time.<br />
<br />
<br />
Function .onInit<br />
Push $INSTDIR ;save compile-time value<br />
ReadRegStr $INSTDIR HKCU &quot;Software\Valve\Counter-Strike&quot; InstallPath<br />
 StrCmp $INSTDIR &quot;&quot; 0 +3<br />
ReadRegStr $INSTDIR HKCU &quot;Software\Valve\Half-Life&quot; InstallPath<br />
 StrCmp $INSTDIR &quot;&quot; +2<br />
 IfFileExists &quot;$INSTDIR\*.*&quot; noreturn<br />
Pop $INSTDIR ;return compile-time value<br />
noreturn:<br />
FunctionEnd<br />
<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tatsudoshi</div><div class="date">5th August 2003, 20:47</div></div><div class="posttext">Yes now it works! Thank you so very much =D You'v made my day for sure! Thanks again.<br />
<br />
Just for the fun of it, what is the difrence of:<br />
StrCmp $INSTDIR &quot;&quot; 0 +3<br />
and<br />
StrCmp $INSTDIR &quot;&quot; +2<br />
?<br />
What I don't uderstand is the 0. What does it do and why is there no 0 in the 2.nd line?<br />
<br />
If the InstallDir is Counter-Strike it will not find the path. Only the Half-Life str works :|</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th August 2003, 21:30</div></div><div class="posttext">You need to look at the NSIS Documentation on relative and label jumps.<br />
Also look up StrCmp.<br />
<br />
+3 means jump 3 commands from the current command.<br />
0 means continue from current command to next command.<br />
0 would be the same as using +1.<br />
-2 would jump backwards 2 commands.<br />
<br />
A label is used for the last bit to jump over the Pop $INSTDIR, because relative jumps do not work on Pop, or a number of other commands.<br />
<br />
Well, looking at the ReadRegStr's you are using HKCU (Current User) and I think you should use HKLM (Local Machine)<br />
<br />
Also, if you have the Software\Valve\Counter-Strike registry root there, but the value is incorrect (the dir specified does not exist), then it will use the Half-Life value instead (and if that does not exist, then the compile-time InstallDir value will be used instead).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th August 2003, 21:32</div></div><div class="posttext">It's a better idea to use this function just to push the user towards using the right install directory.<br />
So, displaying the directory page no matter what is a good idea...<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tatsudoshi</div><div class="date">5th August 2003, 21:35</div></div><div class="posttext">Well in my RegDB I have:<br />
HKEY_CURRENT_USER\Software\Valve\_Half-Life &quot;InstallPath&quot; D:\Half-Life<br />
and<br />
HKEY_CURRENT_USER\Software\Valve\Counter-Strike &quot;InstallPath&quot; D:\Counter-Strike<br />
If I rename the HL key to _Half-Life, so only the CS key is valid, the installer does not find it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th August 2003, 21:45</div></div><div class="posttext">Function .onInit<br />
Push $INSTDIR ;save compile-time value<br />
ReadRegStr $INSTDIR HKCU &quot;Software\Valve\Counter-Strike&quot; InstallPath<br />
MessageBox MB_OK &gt;$INSTDIR&lt;<br />
 StrCmp $INSTDIR &quot;&quot; 0 +3<br />
ReadRegStr $INSTDIR HKCU &quot;Software\Valve\Half-Life&quot; InstallPath<br />
MessageBox MB_OK &gt;$INSTDIR&lt;<br />
 StrCmp $INSTDIR &quot;&quot; +2<br />
 IfFileExists &quot;$INSTDIR\*.*&quot; noreturn<br />
Pop $INSTDIR ;return compile-time value<br />
noreturn:<br />
FunctionEnd<br />
<br />
<br />
Try this, notice I've added messagebox's in which will display the installpath values.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th August 2003, 21:46</div></div><div class="posttext">Does the actual path D:\counter-strike exist on your hard drive?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tatsudoshi</div><div class="date">5th August 2003, 21:49</div></div><div class="posttext">Originally posted by Afrow UK <br />
Well, looking at the ReadRegStr's you are using HKCU (Current User) and I think you should use HKLM (Local Machine)<br />
<br />
Also, if you have the Software\Valve\Counter-Strike registry root there, but the value is incorrect (the dir specified does not exist), then it will use the Half-Life value instead (and if that does not exist, then the compile-time InstallDir value will be used instead).<br />
<br />
-Stu <br />
<br />
As you can see I have the right key's and I don't think valve will listen to me, asking them to put there install info at HKLM insted of HKCU ;P</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tatsudoshi</div><div class="date">5th August 2003, 21:53</div></div><div class="posttext">LoL I made it folder at the Key link and now it works fine.. just shows how much I know ;P</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th August 2003, 21:55</div></div><div class="posttext">Btw, what is in the installer, mod or map? :)<br />
<br />
I used to play Half-Life, CS, DoD before my PC got reformatted.<br />
Now I play and make maps for D-Day: Normandy (Quake2)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tatsudoshi</div><div class="date">5th August 2003, 21:57</div></div><div class="posttext">It's a cs script ala nextwish but a lot more complex, if I may say so my self :)<br />
You can tjek out www.x-systems.dk tomorrow to dl it and see what's the fuss is about.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>