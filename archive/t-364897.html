<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Need help with per user installer that needs admin for one section, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Need help with per user installer that needs admin for one section NSIS Discussion" />
	
	<title> Need help with per user installer that needs admin for one section [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Need help with per user installer that needs admin for one section</div>
<hr />
<div class="pda"><a href="t-364897.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=364897">Need help with per user installer that needs admin for one section</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jaredub</div><div class="date">28th June 2013, 21:59</div></div><div class="posttext">Hello. <br />
<br />
I am developing an installer for a per-user app that gets installed into $PROFILE. It has to be per-user to prevent multiple instances running from the same IP address. The app has a distributed architecture in which a main process launches sub-processes and various command line tools. <br />
<br />
This would be easy to do, just run as user and write to HKCU, user profile, etc. Except, I am using SimpleFC (firewall plugin) to add firewall rules for our app. This requires elevation to write to HKLM. If the installer runs elevated (with UAC plugin), the all of the installed files are owned by admin which breaks the application, since it cannot run many of the subprocs it needs to. <br />
<br />
So, my question is, how do I request a higher execution level for only one area or section of the installer and uninstaller? Or, would it be better to use the UAC plugin and run everything but the firewall exceptions as user(this would be messy)?<br />
<br />
I can provide code, clarification, or anything else. Any and all help is greatly appreciated. <br />
<br />
Thanks in advance.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">T.Slappy</div><div class="date">1st July 2013, 07:51</div></div><div class="posttext">There are 2 options:<br />
1) Split your installer into two: one run as user, second as elevated user<br />
2) Run installer elevated and for unelevated parts of installer use ShellExecAsUser (http://nsis.sourceforge.net/ShellExecAsUser_plug-in) or any other similar plug-in.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jaredub</div><div class="date">1st July 2013, 17:04</div></div><div class="posttext">1) Split your installer into two: one run as user, second as elevated user<br />
<br />
<br />
Thanks for the response. I ended up finding this solution on my own and implemented a small, silent installer that takes care of the firewall rules and leaves everything else alone. I realized there are not many solutions for this problem, but many for the opposite. <br />
<br />
I did run into one problem. It seemed that if i put the uninstaller for the sub-installer anywhere except the root directory of the app it would fail on execution. Any ideas?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">2nd July 2013, 07:53</div></div><div class="posttext">You're probably using the $INSTDIR variable in your uninstaller. In the uninstaller, $INSTDIR contains simply the directory where uninstall.exe is located. So in essence, it's the same as $EXEDIR.<br />
<br />
This is why you should always verify in un.oninit that uninstall.exe hasn't been moved to, say, c:\windows or something. You'd end up deleting the wrong files. I simply check for some marker files with specific filenames, and throw a warning if something seems wrong.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>