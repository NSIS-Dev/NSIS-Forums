<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Restore SQL database help, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Restore SQL database help NSIS Discussion" />
	
	<title> Restore SQL database help [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Restore SQL database help</div>
<hr />
<div class="pda"><a href="t-268089.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=268089">Restore SQL database help</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">duMonaro</div><div class="date">20th March 2007, 06:54</div></div><div class="posttext">sorry guys i'm a noob. How do you restore a database with NSIS and where do i place the code?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgiusto</div><div class="date">21st March 2007, 10:22</div></div><div class="posttext">you should use you SQL command line utility to execute a sqlscript<br />
to run your SQL command line utility you can use the ExecWait statement<br />
If you are using MSSQL on windows machines you can use the MSSQL plugin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">duMonaro</div><div class="date">22nd March 2007, 01:48</div></div><div class="posttext">I saw this code on one of the forum questions but it doesnt seem like something i'd use in NSIS code.<br />
<br />
___________________________<br />
::SET VARIABLES<br />
set DBNAME=NAMEOFDATABASEBEINGRESTORED<br />
set DBDIRECTORY=C:\Program Files\Microsoft SQL Server\MSSQL\Data<br />
<br />
TITLE Restoring %DBNAME% Database<br />
<br />
::PUT DATABASE IN SINGLE USER MODE TO ALLOW RESTORE<br />
osql -E -d master -Q &quot;alter database %DBNAME% set single_user with rollback immediate&quot;<br />
<br />
::RESTORE DATABASE<br />
osql -E -d master -Q &quot;restore database %DBNAME% from disk='%~dp0\%DBNAME%.bak' WITH MOVE '%DBNAME%_Data' TO '%DBDIRECTORY%\%DBNAME%_Data.MDF', MOVE '%DBNAME%_Log' TO '%DBDIRECTORY%\%DBNAME%_Log.LDF'&quot;<br />
<br />
::GRANT PERMISSION TO ASPNET USER<br />
osql -E -d %DBNAME% -Q &quot;sp_grantdbaccess '%COMPUTERNAME%\ASPNET'&quot;<br />
osql -E -d %DBNAME% -Q &quot;sp_addrolemember 'db_owner', '%COMPUTERNAME%\ASPNET'&quot;<br />
<br />
::RESTORE TO MULTI USER<br />
osql -E -d master -Q &quot;alter database %DBNAME% set multi_user&quot;<br />
<br />
exit</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgiusto</div><div class="date">22nd March 2007, 10:09</div></div><div class="posttext">Your example comes from a batch file I think.<br />
NSIS code would be something like:<br />
MSSQL_OLEDB::SQL_Logon /NOUNLOAD &quot;$SQLSERVER&quot; &quot;$SQLUSER&quot; &quot;$SQLPASSWORD&quot;<br />
MSSQL_OLEDB::SQL_Execute /NOUNLOAD &quot;alter database $DBNAME set single_user with rollback immediate&quot;<br />
MSSQL_OLEDB::SQL_Execute /NOUNLOAD &quot;restore database $DBNAME from disk='${PATH}\${DBNAME}.bak' WITH MOVE '${DBNAME}_Data' TO '${DATADIR}\${DBNAME}_Data.MDF', MOVE '${DBNAME}_Log' TO '${DATADIR}\${DBNAME}_Log.LDF'&quot;<br />
MSSQL_OLEDB::SQL_Execute /NOUNLOAD &quot;alter database ${DBNAME} set multi_user&quot;<br />
<br />
You need MSSQL Plugin and replace variables as appropriate</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>