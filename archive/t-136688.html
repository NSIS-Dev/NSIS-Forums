<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Random Pick, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Random Pick NSIS Discussion" />
	
	<title> Random Pick [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Random Pick</div>
<hr />
<div class="pda"><a href="t-136688.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=136688">Random Pick</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">26th May 2003, 16:12</div></div><div class="posttext">i'm having an .ini file that looks like this<br />
<br />
[Section]<br />
n0=value 1<br />
n1=value 2<br />
n2=value 3<br />
etc.<br />
<br />
i have an nsis script that counts the number of n's in this .ini. is there a clever function to pick a random n?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DOCa Cola</div><div class="date">26th May 2003, 16:21</div></div><div class="posttext">here<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=65679&amp;highlight<br />
i am using that way to get a random number too, but it only brings one 'random' number per application run<br />
<br />
DOCa Cola</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">26th May 2003, 17:22</div></div><div class="posttext">i read this thread before i posted this... i found it a bit weird :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DOCa Cola</div><div class="date">26th May 2003, 17:23</div></div><div class="posttext">yea, but it works actually :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th May 2003, 20:55</div></div><div class="posttext">So,<br />
<br />
StrCpy $0 $HWNDPARENT 1 -1<br />
<br />
Edit: It's not very good, and always outputs the same digit if you use it lots of times in the same installer.<br />
I will find another way for generating random numbers.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th May 2003, 21:10</div></div><div class="posttext">The best thing I could use was GetFileTime of GetTempFileName<br />
<br />
Usage:<br />
Call MakeRandomNum<br />
Pop $R0<br />
<br />
$R0 = random number<br />
<br />
Function MakeRandomNum<br />
Push $R0<br />
Push $R1<br />
Push $R2<br />
 GetTempFileName $R0<br />
 GetFileTime $R0 $R1 $R2<br />
   SetDetailsPrint none<br />
 Delete $R0<br />
   SetDetailsPrint both<br />
  StrCpy $R0 $R2 1 -1<br />
Sleep 500<br />
Pop $R2<br />
Pop $R1<br />
Exch $R0<br />
FunctionEnd<br />
<br />
Just put some Sleep 1000 between calls if you want to get random numbers many times within one installer.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MoNKi</div><div class="date">26th May 2003, 23:15</div></div><div class="posttext">Try this:<br />
<br />
<br />
OutFile &quot;Random.exe&quot;<br />
Name &quot;Random&quot;<br />
<br />
; Usage:<br />
; 	Push Seed (or previously generated number)<br />
;	Call RandomNumber<br />
;       Pop Generated Random Number<br />
Function RandomNumber<br />
	Exch $R0<br />
	<br />
	IntOp $R0 $R0 * &quot;13&quot;<br />
	IntOp $R0 $R0 + &quot;3&quot;<br />
	IntOp $R0 $R0 % &quot;1048576&quot; ; Values goes from 0 to 1048576 (2^20)<br />
<br />
	Exch $R0<br />
FunctionEnd<br />
<br />
Section &quot;&quot;<br />
	Push $HWNDPARENT  ;Seed<br />
Loop:<br />
	Call RandomNumber<br />
	Pop $R0<br />
	MessageBox MB_YESNO $R0 IDNO +3<br />
	Push $R0 ;The new seed<br />
	Goto Loop<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">27th May 2003, 00:46</div></div><div class="posttext">That works too, well with a little changes... :up:<br />
<br />
OutFile &quot;Random.exe&quot;<br />
Name &quot;Random&quot;<br />
<br />
; Usage:<br />
; 	Push Seed (or previously generated number)<br />
;	Call RandomNumber<br />
;       Pop Generated Random Number<br />
Function RandomNumber<br />
	Exch $R0<br />
	<br />
	IntOp $R0 $R0 * &quot;13&quot;<br />
	IntOp $R0 $R0 + &quot;3&quot;<br />
	IntOp $R0 $R0 % &quot;1048576&quot; ; Values goes from 0 to 1048576 (2^20)<br />
<br />
	Exch $R0<br />
FunctionEnd<br />
<br />
Function .onInit<br />
Push $HWNDPARENT  ;Seed<br />
Loop:<br />
	Call RandomNumber<br />
	Pop $R0<br />
	MessageBox MB_YESNO &quot;Random number: $R0 $\r$\nCreate another one?&quot; IDNO +3<br />
	Push $R0 ;The new seed<br />
	Goto Loop<br />
Abort<br />
FunctionEnd<br />
<br />
Section &quot;&quot;<br />
;I'm a ghost, boo	<br />
SectionEnd<br />
<br />
<br />
BTW: monki has post... :D ;)<br />
Good script, dude<br />
:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">23rd September 2003, 14:59</div></div><div class="posttext">lobo's script always picks the same numbers in the same order.<br />
<br />
monki's script generates random numbers, but they repeat until one restarts the application.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">23rd September 2003, 16:20</div></div><div class="posttext">maybe we can get a real random function as plugin by someone? :P<br />
<br />
i figured, the two examples above work worse, the lower the maximum is.<br />
<br />
[edit]i simply raised the maximum by 1 and hope the function will never ever be the max (which it hasnt been yet).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">23rd September 2003, 16:38</div></div><div class="posttext">You have to generate a better seed by combining time, date, uptime, HWND etc.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DOCa Cola</div><div class="date">23rd September 2003, 20:18</div></div><div class="posttext">maybe someone can convert a number generator from the Blitz++ source to a nsis plugin? :)<br />
just an idea<br />
http://sourceforge.net/projects/blitz/<br />
<br />
DOCa Cola</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MoNKi</div><div class="date">23rd September 2003, 20:59</div></div><div class="posttext">A new code, now you can set a max value for the random number, is only a test and I know that needs a cleanup. Only has a problem, if you set the Max value to 100 (or 10,1000,10000,...), for example, the number 100 has the same probability that the group (0-99):<br />
<br />
Probability of 100 = 1/2<br />
Probability of numbers from 0 to 99 = (1/2)/100<br />
<br />
But if you set the max at 99 (9,999,9999,9999,...) all the numbers has the same probability.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MoNKi</div><div class="date">23rd September 2003, 21:39</div></div><div class="posttext">Last version, I think all works ok. Generates a number between 0 and Max</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lzandman</div><div class="date">23rd September 2003, 21:46</div></div><div class="posttext">I've just created a NSIS plugin called nsRandom, based on Borland Delphi 7's Random() function, that can do the trick. It can return random values in a specified range or return values between 0 and 1.<br />
<br />
Download it here (http://home.studenten.net/~wowleon/nsRandom.zip). An example NSI-script is included. Please comment on it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">23rd September 2003, 21:51</div></div><div class="posttext">Is it not possible to make the plug-in a little smaller? Using C something like this will have a size of about 3 KB.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lzandman</div><div class="date">23rd September 2003, 22:29</div></div><div class="posttext">Originally posted by Joost Verburg <br />
Is it not possible to make the plug-in a little smaller? Using C something like this will have a size of about 3 KB. Yeah, I know. I'll try to get it done in VC++, but I currently don't have Visual Studio installed. I'll keep it in mind though :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">23rd September 2003, 23:11</div></div><div class="posttext">System::Call 'kernel32::GetTickCount() i.r0'<br />
<br />
will place to r0 a number of ms since OS uptime (DWORD value).<br />
<br />
if ms precision is not enough for you, use the following: (that value will never repeat, but it is int64, so use Int64Op to work with it).<br />
<br />
System::Call 'kernel32::QueryPerformanceCounter(*l.r0)'<br />
<br />
anyway both solution will add ~6 kb compressed :) sorry :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DOCa Cola</div><div class="date">23rd September 2003, 23:13</div></div><div class="posttext">Originally posted by Joost Verburg <br />
Is it not possible to make the plug-in a little smaller? Using C something like this will have a size of about 3 KB.  <br />
beside that it works really nice :)<br />
thx!<br />
<br />
DOCa Cola</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th September 2003, 16:14</div></div><div class="posttext">There is a script on the NSIS archive that generates a random number from 0-9.<br />
It is based upon GetFileTime, so is not officially random.<br />
<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=367&amp;instances=0,11<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lzandman</div><div class="date">24th September 2003, 16:47</div></div><div class="posttext">Originally posted by DOCa Cola <br />
beside that it works really nice :)<br />
thx!<br />
<br />
DOCa Cola You're welcome :)<br />
<br />
The NSIS developers want every part of NSIS to be as small as possible. Unfortunately that doesn't work when you are programming in Delphi. Delphi generated exe/dll's are usually bigger than those created using VC++. But I prefer Delphi over VC++.<br />
<br />
Personally I don't care about this size thing, because my installers are always several megabytes big, so a plugin of 150 kB isn't that much of a problem. :D<br />
<br />
But Joost is right that the nsRandom plugin is quite big considering it's rather limited functionality.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th September 2003, 19:59</div></div><div class="posttext">Indeed, 150kb's is nothing nowadays (well, for non-56k users anyway!)<br />
<br />
Thanks so much for plugin support!<br />
<br />
-Stu :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lzandman</div><div class="date">24th September 2003, 21:26</div></div><div class="posttext">I've just created an NSIS Archive page (http://nsis.sourceforge.net/archive/nsisweb.php?page=412&amp;instances=0,32) for nsRandom.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">24th September 2003, 23:12</div></div><div class="posttext">Can't leave happily without pushing system idea ;)<br />
Push Max, call random, pop value. example:<br />
<br />
    Push 100<br />
    call Random<br />
    Pop $0<br />
    MessageBox MB_OK &quot;Random $0&quot;<br />
<br />
Function Random<br />
    Exch $0<br />
    Push $1<br />
    System::Call 'kernel32::QueryPerformanceCounter(*l.r1)'<br />
    System::Int64Op $1 % $0<br />
    Pop $0<br />
    Pop $1<br />
    Exch $0<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>