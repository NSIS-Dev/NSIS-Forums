<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" install vs. upgrade, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  install vs. upgrade NSIS Discussion" />
	
	<title> install vs. upgrade [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  install vs. upgrade</div>
<hr />
<div class="pda"><a href="t-279396.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=279396">install vs. upgrade</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">irun5k</div><div class="date">19th October 2007, 11:05</div></div><div class="posttext">So, I've been reviewing the faqs, user manual, and forums for a few hours now and am not finding the answer I was hoping for.<br />
<br />
My installer needs to do a detect to determine if the software is already installed, in which case we'll treat the install as an upgrade as opposed to a full install.<br />
<br />
If during init I determine that an older version is already installed, I'd like to <br />
-show the license<br />
-show a page saying we're ready to do an upgrade<br />
-do the install with specific sections<br />
<br />
If no prior version exists, I want to <br />
-show the license<br />
-show the component selection page<br />
-collect install location<br />
-do the install<br />
<br />
So the trick is that in one case (new install) I want to render the component page with one set of available sections, and in the other case (upgrade) I want to skip just about everything and install a hidden section.  I do not want to use InstType for this because the user isn't getting a choice in the matter.  Skipping the pages, although a little messy, can be done with aborts.<br />
<br />
The question is, can I conditionally drive sections- i.e. only sections a, b, and c should be rendered as available choices on the component page, but if I don't show the component page, I should section d?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th October 2007, 22:46</div></div><div class="posttext">To hide/show sections use SectionSetText. A section with empty text is not displayed on the components page. You can also dynamically set sections to readonly by adding the SF_RO flag with Sections.nsh's SetSectionFlag.<br />
<br />
You can also completely skip the page:<br />
<br />
http://nsis.sourceforge.net/Skipping_Pages</div></div><hr />


<div class="post"><div class="posttop"><div class="username">irun5k</div><div class="date">20th October 2007, 23:46</div></div><div class="posttext">Thanks for the reply-<br />
<br />
I've tried setting setting the section flags to deselect a hidden section during init, but it doesn't seem to work.  Even if I deselect the hidden section using the flags, it still gets installed.<br />
<br />
Am I doing something wrong or is there no way at runtime to decide whether to install or skip a hidden section?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th October 2007, 23:48</div></div><div class="posttext">You've probably put the .onSelChange function before the definition of the sections. The section index define is only set once the Section line is processed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">irun5k</div><div class="date">21st October 2007, 00:00</div></div><div class="posttext">To be more clear, here is what I'm doing:<br />
<br />
<br />
Section /o -Shortcut shortcut<br />
    CreateShortCut &quot;$DESKTOP\B-Gallery 3.lnk&quot; &quot;$INSTDIR\bgallery.exe&quot; <br />
SectionEnd<br />
<br />
Function .onInit<br />
    SectionSetFlags ${shortcut} 0<br />
FunctionEnd<br />
<br />
<br />
It seems to me like by clearing all the flags, the section should be deselected since that bit isn't set.  However, this code always results in the shortcut being installed.  My sole goal here is to skip this section based on setting something in .onInit.  I think maybe I'm misunderstanding something but I'm not sure what :igor: <br />
<br />
P.S. using NSIS 2.31</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st October 2007, 00:05</div></div><div class="posttext">You said earlier that you're using InstType. Hidden sections are marked as they belong to all installation types by default. You'd need to specify a certain installation type with SectionIn, set its flags after the components page, skip it in the section code itself or use SectionSetInstTypes to make belong to no installation type.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>