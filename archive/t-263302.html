<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Basket 'o bugs, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Basket 'o bugs NSIS Discussion" />
	
	<title> Basket 'o bugs [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Basket 'o bugs</div>
<hr />
<div class="pda"><a href="t-263302.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=263302">Basket 'o bugs</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">wacaveman</div><div class="date">9th January 2007, 04:44</div></div><div class="posttext">Hello.  I am trying to do what I think is something simple, but I am having the most difficult problems.<br />
<br />
Firstly, I am just trying to test to see if a file exists which has some install parameters in it, so I do:<br />
${GetOptions} &quot;$R0&quot; &quot;/INI=&quot; $R1<br />
${If} ${FileExists} $R1 ;this always fails with a relative path<br />
<br />
So, how do I get around the limitation of having to use an absolute path?  Well, we try to get the current directory, using ${GetExePath}, and I have !include FileFunc.nsh, but I get an error Invalid command: ${GetExePath}.  I am using version 2.2.2, so I am not sure what the deal is.<br />
<br />
So, the next problem I have, is when I pass in multiple options on the command line, win32.installer.exe /INI=C:\od4\DON\install\settings.ini -silent -path=c:\usr\local\bin\test, I am having problems getting option values out using ${GetOption} &quot;$R0&quot; &quot;/INI=&quot; $R1.<br />
<br />
Now, $R1=C:\od4\DON\install\settings.ini -silent -path=c:\usr\local\bin\test, so all of my settings are basically junked out.  I didn't see anything close to what I am looking for in the examples -- if someone could point me in the right direction, it would save me a lot of time.<br />
<br />
Anyway, this is just the top layer in my basket 'o bugs.  Any/all help is appreciated.  If any changes to the NSIS interface could make these items easier to deal with, that would be great to add to the next feature list, too.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">9th January 2007, 05:13</div></div><div class="posttext">So, how do I get around the limitation of having to use an absolute path? Well, we try to get the current directory, using ${GetExePath}, and I have !include FileFunc.nsh, but I get an error Invalid command: ${GetExePath}. I am using version 2.2.2, so I am not sure what the deal is.<br />
Did you remember !insertmacro GetExePath<br />
 http://nsis.sourceforge.net/Docs/AppendixE.html#E.1.9<br />
<br />
<br />
 So, the next problem I have, is when I pass in multiple options on the command line, win32.installer.exe /INI=C:\od4\DON\install\settings.ini -silent -path=c:\usr\local\bin\test, I am having problems getting option values out using ${GetOption} &quot;$R0&quot; &quot;/INI=&quot; $R1.<br />
win32.installer.exe /INI=C:\od4\DON\install\settings.ini -silent /path=c:\usr\local\bin\test<br />
${GetOptions} &quot;$R0&quot; &quot;/INI=&quot; $R1<br />
http://nsis.sourceforge.net/Docs/AppendixE.html#E.1.12</div></div><hr />


<div class="post"><div class="posttop"><div class="username">wacaveman</div><div class="date">9th January 2007, 19:41</div></div><div class="posttext">Wow, awesome help.  Someone should consider adding !insertmacro GetExePath to all of the examples in the help.  I would have never searched through the documentation that long.  And, I guess in the end it wasn't a help anyway, because it just returned an temp directory anyway.  Argh.  I guess I will need to dick around with that for a few hours to figure where I can snag the path so it will return the correct path so I can feed it into my IfFileExists call.  Is there any way to make IfFileExists work when a simple filename like test.ini is used as the argument?  Seems to me like a simple request, but I have wasted a ton of time trying to get this to work.  Maybe the documentation should state that only absolute paths work for this function, if this is the case.<br />
<br />
I am still lost trying to figure out the GetOptions function.  I am staring at the examples, seeing that it looks identical to what I have, and wondering what I am doing wrong.  Does order matter?  Can I use / and - interchangeably? I don't feed in any quotations, so why doesn't it truncate after the first parameter?<br />
<br />
How do I build the equivalent of the case statement?  It looks like all of the options go into the first parameter -- do I have to keep repeating it?  What if I have a lot of parameters, and then want to add just one?<br />
<br />
      ${GetOptions} &quot;$R0&quot; &quot;/INI=&quot; $R1<br />
      MessageBox MB_OK &quot;Here we are $R1...&quot;<br />
;This prints Here we are C:\od4\DON\install\settings.ini -silent -path=c:\usr\local\bin\test..., when the input is:<br />
;/ini=C:\od4\DON\install\settings.ini -silent -path=c:\usr\local\bin\test<br />
      ${Unless} ${Errors}<br />
...snip...<br />
      ;do a bunch of processing if we have an ini file<br />
...snip...<br />
      ${EndUnless}<br />
      MessageBox MB_OK &quot;Just after EndUnless.&quot;<br />
    ${Else}<br />
      MessageBox MB_OK &quot;detected -ms option $R1.&quot;<br />
      ; Support for the deprecated -ms command line argument. The new command<br />
      ; line arguments are not supported when -ms is used.<br />
      SetSilent silent<br />
    ${EndIf}<br />
; this crap is all hopelessly broken...<br />
;    ${GetOptions} &quot;$R0&quot; &quot;-ira&quot; $R1<br />
;    ${If} ${!Errors}<br />
;      MessageBox MB_OK &quot;detected -ira option $R1.&quot;<br />
;    ${EndIf}<br />
;    ${GetOptions} &quot;$R0&quot; &quot;-ma&quot; $R1<br />
;    ${If} ${!Errors}<br />
;      MessageBox MB_OK &quot;detected -ma option $R1.&quot;<br />
;    ${EndIf}<br />
<br />
Oh, I just found silent.nsi somewhere in the online documentation.  I would like to recommend putting that in the example scripts page.  I am not sure if it works, and can't recall how I found it, but it seems like it is what I am looking for.<br />
<br />
Thanks again for the tips,<br />
<br />
-Kevin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">9th January 2007, 19:56</div></div><div class="posttext">Well, you define &quot;/&quot; as separator, so GetOptions gets the options from this separator until the next &quot;/&quot;.<br />
This is the way it works.<br />
${GetOptions} 'file.ext /INI=file.ini /silent /path=&lt;path&gt;' '/INI=' '$R1'<br />
<br />
EDIT:<br />
When you call IfFIleExists without a given path, obviously the installer looks for the file in the current directory, either where it's running, or, where the SetOutPath is pointed. So, when you call IfFileExists to look for a file on some other location you need to provide the full path. This call would never search the entire system for a file or files.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">wacaveman</div><div class="date">10th January 2007, 00:01</div></div><div class="posttext">So, what you are saying is that my GetOptions problem is probably mixing / and -?  I will have to try to see what I get out of it.<br />
<br />
I am not sure what to say about IfFileExists.  I am running it in the same directory, and it is unable to find it.  I actually use a batch file to execute it -- the batch file, the install executable, and the ini file are all in the same directory.  If I add the fully qualified path to the batch file, it will work fine.<br />
<br />
As a note -- I am trying to tweak the install for firefox. It may be possible that they are doing some funny compression, which might explain why all of the directories are in temp folders.  I find it hard to believe that they tweak it so hard I can't figure out what directory the thing is starting from, though.<br />
<br />
The switching of - and / for the options is a mix of old-installer/new-installer conventions, which I was hoping to maintain for backwards compatibility.<br />
<br />
Thanks again,<br />
<br />
-Kevin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">10th January 2007, 00:16</div></div><div class="posttext">Check the following attached example about get options,<br />
about firefox this thread might be of your interest,<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=262535<br />
I am not sure what to say about IfFileExists. I am running it in the same directory, and it is unable to find it.<br />
In this case the call should be,<br />
IfFileExists '$EXEDIR\file.ext'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">10th January 2007, 00:38</div></div><div class="posttext">Just added to the attached test the IfFileExists issue :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>