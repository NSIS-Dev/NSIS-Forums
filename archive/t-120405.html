<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" .onNextPage / forcing selection, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  .onNextPage / forcing selection NSIS Discussion" />
	
	<title> .onNextPage / forcing selection [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  .onNextPage / forcing selection</div>
<hr />
<div class="pda"><a href="t-120405.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=120405">.onNextPage / forcing selection</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">honold</div><div class="date">7th January 2003, 00:04</div></div><div class="posttext">below is my hack to warn a user and select all components (there are 4) if they unselect them all and attempt to install.<br />
<br />
is this the right way to do it?  it works, but i can tell by doing a mb_ok that it's doing this literally EVERY NEXT PAGE.<br />
<br />
i also observed when i would print the values of $0/$1/$2/$3 if the components were selected they would yield 3/5/5/1 respectively.  what is with the different values?<br />
<br />
while my solution works, it is not elegant in the fact that it warns the user, they click ok, and then their screen shows all their options unselected - but they're actually all forcefully selected.  going back a screen and returning will show this.  right now a developer install has all 4 components selected.  if they unselect all 4 and attempt to install, it warns them, then puts them back at the component selection screen - with all the checkboxes visibly unchecked and 'custom' selected as the install type.<br />
<br />
so...<br />
<br />
what's with the numbers?<br />
is this the right way to do this?<br />
if this is the right way to do this, how do i 'refresh' the screen to show the components have all been forcefully selected?<br />
<br />
Function .onNextPage<br />
  SectionGetFlags 1 $0<br />
  SectionGetFlags 2 $1<br />
  SectionGetFlags 3 $2<br />
  SectionGetFlags 4 $3<br />
  IntCmp 0 $0 end unselected1 end<br />
  unselected1:<br />
  IntCmp 0 $1 end unselected2 end<br />
  unselected2:<br />
  IntCmp 0 $2 end unselected3 end<br />
  unselected3:<br />
  IntCmp 0 $3 end unselected4 end<br />
  unselected4:<br />
  MessageBox MB_OK|MB_ICONSTOP &quot;You must select at least 1 component!&quot;<br />
  SectionSetFlags 1 0x80000000<br />
  SectionSetFlags 2 0x80000000<br />
  SectionSetFlags 3 0x80000000<br />
  SectionSetFlags 4 0x80000000<br />
  abort 0<br />
  end:<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th January 2003, 14:36</div></div><div class="posttext">The right way to do it is using .onSelChange. There is an example in the archive: http://nsis.sourceforge.net/archive/nsisweb.php?page=36&amp;instances=0,11.<br />
<br />
As for the numbers, do you have more then one installation type (InstType)? If you do then the section flags in NSIS 1.98 are composed from install types too. Every install type gets a bit and it's on if the section is in that install type.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">honold</div><div class="date">7th January 2003, 17:04</div></div><div class="posttext">i had actually transplanted the info using http://forums.winamp.com/showthread.php?s=&amp;postid=582586#post582586 and http://nsis.sourceforge.net/archive/nsisweb.php?page=36&amp;instances=0,11<br />
<br />
unfortunately, i lack the aptitude to figure out how to modify your initial post to suit my needs.  i am not a programmer, and i have no mathematics background.  the intop &amp; and intop | are totally lost on me, but i suspect that even if i did understand the operations the rest of it wouldn't make sense.<br />
<br />
while a handout would be nice, i'm not expecting one, and my solution does 'work' for now.  it is a situation that will only arise when somebody actually unselects everything and attempts to proceed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th January 2003, 17:21</div></div><div class="posttext">The problem with your code is that you didn't check that .onNextPage is called after the components page (needs to be counted, example in Contrib\InstallOptions\test.nsi) and that you change the selection and then abort the page moving. NSIS 1.98 doesn't support the latter as you have noticed, if you just warn and not set it should be OK.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">honold</div><div class="date">7th January 2003, 17:36</div></div><div class="posttext">i was reticent about switching to 2.0 simply because of the issue documented at http://forums.winamp.com/showthread.php?s=&amp;postid=827047#post827047 , but that now appears to be resolved.<br />
<br />
after disabling enabledbitmap/disabledbitmap and enabled xpstyle everything looks nice and works the same (minus the .onnextpage, which appears to have been deprecated).  i'll try mucking around with it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th January 2003, 17:40</div></div><div class="posttext">The Pages section (http://nsis.sourceforge.net/Docs/Chapter3.html#3.5) in the docs should you you replace .onNextPage.<br />
Before you ask, there is no way to abort the moving to another page currently. It will be implemented sometime before the final version of NSIS 2.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">honold</div><div class="date">7th January 2003, 17:44</div></div><div class="posttext">ok, so i SHOULDN'T switch to nsis2 then?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th January 2003, 17:47</div></div><div class="posttext">If you want to display a message box if the user selected non of them, then no. You can always use a variant of the one-section example to force the user to select a minimum of one section if you do want to use 2.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">honold</div><div class="date">7th January 2003, 20:58</div></div><div class="posttext">by simply importing the nsis2 'must choose one' code, it's complaining that the sec* variables are undefined<br />
when i try to compile: &quot;unknown variable &quot;{sec1}&quot; detected, ignoring<br />
<br />
below is my main body nsi.  the copied stuff is included via static.nsi<br />
<br />
!include defaults.nsi<br />
!include static.nsi<br />
!include functions.nsi<br />
<br />
Section -<br />
  Call ExtractHelpers<br />
  Call CheckForPreviousInstallation<br />
  Call CheckForValidOS<br />
  Call EvalSilentInstall<br />
  Call DeleteHelpers<br />
SectionEnd<br />
<br />
Section &quot;Hivemind Service&quot; sec1<br />
SectionIn 1 2<br />
  Call ExtractHelpers<br />
  !insertmacro ExtractServices<br />
  Call InstallServices<br />
  Call TestServices<br />
  Call AskStartHiveNow<br />
  Call UpdateRuntime<br />
  Call AddToPath<br />
  Call DeleteHelpers<br />
SectionEnd<br />
<br />
Section &quot;Administration Utilities&quot; sec2<br />
SectionIn 1 3<br />
  !insertmacro ExtractUtils<br />
SectionEnd<br />
<br />
Section &quot;Documentation&quot; sec3<br />
SectionIn 1 3<br />
  !insertmacro ExtractDocs<br />
SectionEnd<br />
<br />
Section &quot;Software Development Kit&quot; sec4<br />
SectionIn 1<br />
  !insertmacro ExtractSDK<br />
SectionEnd<br />
<br />
Section &quot;&quot;<br />
  Call CreateUninstaller<br />
  Call RebootIfNeeded<br />
SectionEnd<br />
<br />
Section Uninstall<br />
  Call un.InstallWarning<br />
  Call un.ExtractHelpers<br />
  Call un.InstallServices<br />
  Call un.InstallAll<br />
  Call un.DeleteHelpers<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th January 2003, 21:02</div></div><div class="posttext">As sec1, sec2, etc. are defines, you can't use them before they are defined in the Section statement. Therefore the section control code must come after the sections code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">honold</div><div class="date">7th January 2003, 21:21</div></div><div class="posttext">sorry about all this hassle...<br />
<br />
okay, so i put the stuff in stuff.nsi and i included it at the bottom of my main nsi<br />
<br />
everything compiles fine now, but it doesn't appear to work.<br />
<br />
i put a messagebox $1 in onselchange before sectiongetflags $1 $0, and it yields '1' every time.<br />
<br />
isn't the sectiongetflags pulling from section $1, which is defined in oninit's initial strcpy?  how is it passing the value of $1 from one function to another?  i thought these were independent to the functions.<br />
<br />
at any rate, $1 is constantly 1 in my situation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th January 2003, 23:13</div></div><div class="posttext">Please attach the script (don't copy it to the thread, it's getting too big) and I will have a look at it when I get back tomorrow.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">honold</div><div class="date">8th January 2003, 00:31</div></div><div class="posttext">attached.  thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th January 2003, 14:41</div></div><div class="posttext">I should have probably told you that the section flags values have changed too... The new ones are:<br />
<br />
!define SF_SELECTED   1<br />
!define SF_SUBSEC     2<br />
!define SF_SUBSECEND  4<br />
!define SF_BOLD       8<br />
!define SF_RO         16<br />
!define SF_EXPAND     32<br />
<br />
!define SECTION_OFF   0xFFFFFFFE</div></div><hr />


<div class="post"><div class="posttop"><div class="username">honold</div><div class="date">9th January 2003, 17:13</div></div><div class="posttext">indeed, that makes quite a difference<br />
<br />
almost there, but not quite...<br />
<br />
the installer now starts the component page with sec1 (XXX service) unchecked and the default install mode as 'custom' - the rest are checked.  i can toggle sec2/sec3/sec4 but clicking on sec1 yields nothing.<br />
<br />
judging by the size estimate, sec1 is PERMANENTLY unselected.  any ideas?  while i'm using the example that had one required section and 4 toggles, i only have those 4 toggles, named appropriately.  i would think the absence of the required section wouldn't cause anything.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th January 2003, 20:10</div></div><div class="posttext">OK, as you are not the first to ask this I have added this to the example:<br />
<br />
This example demonstrates how to control section selection It allows only one of the four optional section to be selected at any given time.<br />
<br />
Please note that the initial value will not be what you expect it to be if you are are using InstType because InstType is taken into consideration after the .onInit, where the initial state is set, executes.<br />
To use this code with InstType you will either have to specify you first InstType to match the initial value you set in .onInit (only StrCpy $1 ${sec1} is important in this case because the other set the section and that will be done by InstType), or set the initial section selection from .onSelChange when it is called for the first time.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>