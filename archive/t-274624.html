<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" need help regarding the installer  with serialkey check, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  need help regarding the installer  with serialkey check NSIS Discussion" />
	
	<title> need help regarding the installer  with serialkey check [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  need help regarding the installer  with serialkey check</div>
<hr />
<div class="pda"><a href="t-274624.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=274624">need help regarding the installer  with serialkey check</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Veerugadde</div><div class="date">19th July 2007, 17:03</div></div><div class="posttext">Hai,<br />
     <br />
     With some knowledge , i tried an approach of building installer with with 3 steps in process.<br />
<br />
  first, checking for the active internet connection and will abort the process without connection.<br />
<br />
   secondly,checking the ip address of the client system to be within the required IP address range.On success need to move to serialkey check.<br />
<br />
  Here user needs to enter the given serial key and will check  over the server after posting the key.But for time being only comparing locally.Installer is working until IP address check and the serial keycheck  is not working. Please help me out <br />
<br />
<br />
   I am posting the code below:<br />
<br />
; MUI 1.67 compatible ------<br />
!include MUI.nsh<br />
!include LogicLib.nsh<br />
!include defines.nsh<br />
!include sampleIP.nsh<br />
<br />
; MUI Settings<br />
!define MUI_ABORTWARNING<br />
!define MUI_ICON &quot;${NSISDIR}\Contrib\Graphics\Icons\orange-install.ico&quot;<br />
;!define MUI_ICON &quot;${NSISDIR}\Contrib\Graphics\Icons\modern-install.ico&quot;<br />
XPStyle on<br />
<br />
; Reserve files<br />
 ReserveFile &quot;validateSerial.ini&quot;<br />
!insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br />
<br />
;pages<br />
<br />
; Welcome page<br />
!insertmacro MUI_PAGE_WELCOME<br />
Page custom SerialPageShow SerialPageLeave<br />
Page custom validateSerial<br />
; Instfiles page<br />
!insertmacro MUI_PAGE_INSTFILES<br />
; Finish page<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
<br />
; Language files<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
<br />
; MUI end ------<br />
<br />
Name &quot;${PRODUCT_NAME} ${PRODUCT_VERSION}&quot;<br />
OutFile &quot;AppDeploy.exe&quot;<br />
InstallDir &quot;$DESKTOP&quot;<br />
ShowInstDetails show<br />
<br />
Function .onInit<br />
<br />
call ConnectInternet<br />
<br />
FunctionEnd<br />
<br />
<br />
<br />
Section -InstallerSettings<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
  SetOverwrite ifnewer<br />
  Call SetMarquee<br />
SectionEnd<br />
<br />
<br />
<br />
Function ConnectInternet<br />
<br />
   Push $R0<br />
<br />
     ClearErrors<br />
     Dialer::AttemptConnect<br />
     IfErrors noie3<br />
<br />
     Pop $R0<br />
     StrCmp $R0 &quot;online&quot; connected<br />
       MessageBox MB_OK|MB_ICONSTOP &quot;Cannot connect to the internet.&quot;<br />
       Quit ;This will quit the installer.<br />
             ;You might want to add your own error handling.<br />
<br />
     noie3:<br />
<br />
     ; IE3 not installed<br />
     MessageBox MB_OK|MB_ICONINFORMATION \<br />
     &quot;Please connect to the internet now.&quot;<br />
<br />
     connected:<br />
<br />
   Pop $R0<br />
<br />
 FunctionEnd<br />
<br />
Function SetMarquee<br />
  FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
  GetDlgItem $0 $0 1004<br />
  System::Call user32::GetWindowLong(ir0,i-16)i.r1<br />
  IntOp $1 $1 | 8 # PBS_MARQUEE<br />
  System::Call user32::SetWindowLong(ir0,i-16,ir1)<br />
  IntOp $1 ${WM_USER} + 10<br />
  SendMessage $0 $1 1 200 $2<br />
FunctionEnd<br />
<br />
<br />
Section -IPCheck<br />
Internet::GetLocalHostIP ${VAR_1}<br />
push $1<br />
call ValidateIP<br />
  ${If} ${Errors}<br />
    MessageBox MB_OK|MB_ICONINFORMATION &quot;Your IP address: $1 and INVAILD&quot;<br />
    Quit<br />
  ${Else}<br />
    MessageBox MB_OK|MB_ICONINFORMATION &quot;IP Address is vaild and will continue with installation process&quot;<br />
    !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;validateSerial.ini&quot;<br />
    Call SerialPageShow<br />
    <br />
  ${EndIf}<br />
<br />
SectionEnd<br />
<br />
Function SerialPageShow<br />
!insertmacro MUI_HEADER_TEXT &quot;Enter Serial Code&quot; &quot;Enter the software serial code to continue.&quot;<br />
<br />
PassDialog::Dialog Serial \<br />
/HEADINGTEXT 'Please enter the serial code located on the software CD case...' \<br />
/CENTER \<br />
/BOXDASH 12 70 4 '' \<br />
/BOXDASH 92 70 4 '' \<br />
/BOXDASH 172 70 4 '' \<br />
/BOXDASH 252 70 4 '' \<br />
/BOX 332 70 4 ''<br />
<br />
Pop $R0 # success, back, cancel or error<br />
FunctionEnd<br />
<br />
Function SerialPageLeave<br />
<br />
## Pop values from stack<br />
Pop $R1<br />
Pop $R2<br />
Pop $R3<br />
Pop $R4<br />
Pop $R5<br />
<br />
;!insertmacro MUI_HEADER_TEXT &quot;Validating...&quot; &quot;Please Wait&quot;<br />
;!insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;validateSerial.ini&quot;<br />
<br />
;MessageBox MB_OK &quot;Break1&quot;<br />
<br />
FunctionEnd<br />
<br />
<br />
Function ValidateSerial<br />
<br />
StrCmp $R1 '1BH6' +3<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Please enter vaild serial number!&quot;<br />
  Abort<br />
<br />
StrCmp $R2 '2Y6M0' +3<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Please enter vaild serial number!&quot;<br />
  Abort<br />
<br />
StrCmp $R3 'SL5H' +3<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Please enter vaild serial number!&quot;<br />
  Abort<br />
<br />
StrCmp $R4 'MSU6' +3<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Please enter vaild serial number!&quot;<br />
  Abort<br />
<br />
StrCmp $R5 'U1M3' SerialOK<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot; Please enter vaild serial number!&quot;<br />
  Abort<br />
SerialOK:<br />
FunctionEnd<br />
<br />
<br />
Section  -Prerequisites<br />
<br />
  SetOutPath $INSTDIR<br />
  MessageBox MB_YESNO &quot;Install the python open source package?&quot; /SD IDYES IDNO endNetCF<br />
    File &quot;python.msi&quot;<br />
    ExecWait '&quot;msiexec&quot; /i &quot;$INSTDIR\python.msi&quot;'<br />
  endNetCF:<br />
    <br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th July 2007, 17:41</div></div><div class="posttext">You can't have Call SerialPageShow in there.<br />
To skip the PassDialog page, call Abort in it's show function.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Veerugadde</div><div class="date">19th July 2007, 19:08</div></div><div class="posttext">Hello Stu,<br />
<br />
          I had removed the call serial page from that section. Here the problem is that the installer is that starting with IPcheck and directly going on with installation process.<br />
<br />
   I need to go serialkey check after the success of IP Check only. On success of serialCheck installation process should start.Will those functions need to be called from any other sections?<br />
<br />
thanks,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th July 2007, 19:16</div></div><div class="posttext">Like I said, to skip a custom page call Abort in it's show function. You cannot call these functions yourself, but only let NSIS call them using the Page instruction.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Veerugadde</div><div class="date">19th July 2007, 20:37</div></div><div class="posttext">Hello Stu,<br />
<br />
           Thanks alot..i changed the code and got minor problem where the order of checking is changed.<br />
<br />
As i said first want to check with internet connection check and IP range from which needs to go for serialkey check.But installer starts with serial keycheck and on success of check going for IP check followed by installation.<br />
<br />
changed code is below:<br />
<br />
!include MUI.nsh<br />
!include LogicLib.nsh<br />
!include defines.nsh<br />
!include sampleIP.nsh<br />
<br />
; MUI Settings<br />
!define MUI_ABORTWARNING<br />
!define MUI_ICON &quot;${NSISDIR}\Contrib\Graphics\Icons\orange-install.ico&quot;<br />
;!define MUI_ICON &quot;${NSISDIR}\Contrib\Graphics\Icons\modern-install.ico&quot;<br />
XPStyle on<br />
<br />
;pages<br />
<br />
; Welcome page<br />
!insertmacro MUI_PAGE_WELCOME<br />
#Custom pages<br />
Page custom SerialPageShow SerialPageLeave<br />
; Instfiles page<br />
!insertmacro MUI_PAGE_INSTFILES<br />
; Finish page<br />
!insertmacro MUI_PAGE_FINISH<br />
; Language files<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
; MUI end ------<br />
<br />
Name &quot;${PRODUCT_NAME} ${PRODUCT_VERSION}&quot;<br />
OutFile &quot;AppDeploy.exe&quot;<br />
InstallDir &quot;$DESKTOP&quot;<br />
ShowInstDetails show<br />
<br />
Function .onInit<br />
<br />
call ConnectInternet<br />
<br />
FunctionEnd<br />
<br />
Section -SETTINGS<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
  SetOverwrite ifnewer<br />
  Call SetMarquee<br />
SectionEnd<br />
<br />
<br />
;Page custom validateSerial<br />
Function SerialPageShow<br />
ReserveFile &quot;validateSerial.ini&quot;<br />
!insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br />
!insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;validateSerial.ini&quot;<br />
!insertmacro MUI_HEADER_TEXT &quot;Enter Serial Code&quot; &quot;Enter the software serial code to continue.&quot;<br />
<br />
PassDialog::Dialog Serial \<br />
/HEADINGTEXT 'Please enter the serial code located on the software CD case...' \<br />
/CENTER \<br />
/BOXDASH 12 70 4 '' \<br />
/BOXDASH 92 70 4 '' \<br />
/BOXDASH 172 70 4 '' \<br />
/BOXDASH 252 70 4 '' \<br />
/BOX 332 70 4 ''<br />
<br />
<br />
Pop $R0 # success, back, cancel or error<br />
FunctionEnd<br />
<br />
Function SerialPageLeave<br />
<br />
## Pop values from stack<br />
Pop $R1<br />
Pop $R2<br />
Pop $R3<br />
Pop $R4<br />
Pop $R5<br />
<br />
;!insertmacro MUI_HEADER_TEXT &quot;Validating...&quot; &quot;Please Wait&quot;<br />
;!insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;validateSerial.ini&quot;<br />
<br />
;MessageBox MB_OK &quot;Break1&quot;<br />
<br />
StrCmp $R1 '1234' +3<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Please enter vaild serial number!&quot;<br />
  Abort<br />
<br />
StrCmp $R2 '5678' +3<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Please enter vaild serial number!&quot;<br />
  Abort<br />
<br />
StrCmp $R3 '9098' +3<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Please enter vaild serial number!&quot;<br />
  Abort<br />
<br />
StrCmp $R4 '7654' +3<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Please enter vaild serial number!&quot;<br />
  Abort<br />
<br />
StrCmp $R5 '3210' +3<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot; Please enter vaild serial number!&quot;<br />
  Abort<br />
FunctionEnd<br />
<br />
Function ConnectInternet<br />
   Push $R0<br />
<br />
     ClearErrors<br />
     Dialer::AttemptConnect<br />
     IfErrors noie3<br />
<br />
     Pop $R0<br />
     StrCmp $R0 &quot;online&quot; connected<br />
       MessageBox MB_OK|MB_ICONSTOP &quot;Cannot connect to the internet.&quot;<br />
       Quit ;This will quit the installer.<br />
             ;You might want to add your own error handling.<br />
<br />
     noie3:<br />
<br />
     ; IE3 not installed<br />
     MessageBox MB_OK|MB_ICONINFORMATION \<br />
     &quot;Please connect to the internet now.&quot;<br />
<br />
     connected:<br />
<br />
   Pop $R0<br />
<br />
FunctionEnd<br />
<br />
Function SetMarquee<br />
  FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
  GetDlgItem $0 $0 1004<br />
  System::Call user32::GetWindowLong(ir0,i-16)i.r1<br />
  IntOp $1 $1 | 8 # PBS_MARQUEE<br />
  System::Call user32::SetWindowLong(ir0,i-16,ir1)<br />
  IntOp $1 ${WM_USER} + 10<br />
  SendMessage $0 $1 1 200 $2<br />
FunctionEnd<br />
<br />
Section -IPCheck<br />
Internet::GetLocalHostIP ${VAR_1}<br />
push $1<br />
call ValidateIP<br />
  ${If} ${Errors}<br />
    MessageBox MB_OK|MB_ICONINFORMATION &quot;Your IP address: $1 and INVAILD&quot;<br />
    Quit<br />
  ${Else}<br />
    MessageBox MB_OK|MB_ICONINFORMATION &quot;IP Address is vaild and will continue with installation process&quot;<br />
    ;!insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;validateSerial.ini&quot;<br />
    <br />
  ${EndIf}<br />
<br />
SectionEnd<br />
<br />
Section  -Prerequisites<br />
<br />
  SetOutPath $INSTDIR<br />
  MessageBox MB_YESNO &quot;Install the python open source package?&quot; /SD IDYES IDNO endNetCF<br />
    File &quot;python.msi&quot;<br />
    ExecWait '&quot;msiexec&quot; /i &quot;$INSTDIR\python.msi&quot;'<br />
  endNetCF:<br />
    <br />
SectionEnd<br />
<br />
Please help me out with verfication of the code.As you said i dont want to skip custom page(serialcheck) until verified.<br />
<br />
Thanks alot.<br />
<br />
Appreciate your help..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th July 2007, 20:46</div></div><div class="posttext">So you want to first validate the user's IP address and then ask them for the serial?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Veerugadde</div><div class="date">19th July 2007, 20:59</div></div><div class="posttext">Stu,<br />
<br />
        Ya  i want to validate users IP address and on the success need to move on for serial check . <br />
<br />
Thanks,<br />
<br />
Veeeru</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th July 2007, 21:15</div></div><div class="posttext">Right. I see you've put your IP address check in a section... Sections are executed on the InstFiles page, which you have after your custom page.<br />
<br />
You need to move it into the custom page function. Also, you've got ${If} ${Errors} in there, but no ClearErrors before you call the ValidateIP function.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Veerugadde</div><div class="date">19th July 2007, 22:21</div></div><div class="posttext">Hello Stu,<br />
<br />
          Thanks alot, Could you please tell me how to write an .ini file for that IP check section for changing in to custom page.<br />
<br />
    <br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th July 2007, 22:26</div></div><div class="posttext">You want the user to enter their IP address or something?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Veerugadde</div><div class="date">19th July 2007, 22:38</div></div><div class="posttext">No.. user will not enter any IP address. I am trying to get their IP address using Internet plugin and comparing that with required range by calling the validationIP function written in .nsh file.<br />
<br />
   So can you give some idea regarding how to change in to IPcheck section in to custom page.<br />
<br />
<br />
Thanks alot</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th July 2007, 23:01</div></div><div class="posttext">You don't need a custom page then if you don't want any user input. Just put it in the show function of your serial page.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Veerugadde</div><div class="date">19th July 2007, 23:15</div></div><div class="posttext">Stu,<br />
<br />
    Thanks alot and really appreciate your help..yaa its sorted out.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th July 2007, 23:23</div></div><div class="posttext">No problem. If you need any modifications or if you have any suggestions for the PassDialog plug-in let me know.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>