<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Interface UserInfo with another installer, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Interface UserInfo with another installer NSIS Discussion" />
	
	<title> Interface UserInfo with another installer [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Interface UserInfo with another installer</div>
<hr />
<div class="pda"><a href="t-204218.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=204218">Interface UserInfo with another installer</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">SoundScape_2910</div><div class="date">8th January 2005, 00:27</div></div><div class="posttext">Hello evrybody,<br />
<br />
I have some programming questions about the NSIS plugin UserInfo. I am trying to interface this DLL with Installer VISE so that when the installer initialises, the type of user (Admin,User,Power User, e.t.c.) can be determined. Does anyone know who wrote UserInfo plugin and how I can contact him? Thanks in advance!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th January 2005, 01:38</div></div><div class="posttext">I wrote it. Take a look at Source\exehead\exec.c line 909 (case EW_REGISTERDLL: ) to see how it's called. The source code to the plug-in itself is available in Contrib\UserInfo.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">8th January 2005, 02:06</div></div><div class="posttext">this should get you started: http://www.elists.org/pipermail/delphi/2002-December/022392.html<br />
<br />
edit: hah, the browser window was open for more than an hour, forgot to click submit, guess this is useless now...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SoundScape_2910</div><div class="date">10th January 2005, 00:34</div></div><div class="posttext">kichik,<br />
<br />
I didn't quite understand the part &quot;Take a look at Source\exehead\exec.c line 909 (case EW_REGISTERDLL to see how it's called&quot;. Sorry! Where can I find it? Also, I am aware about the source code of UserInfo, I studied it. The problem is this: The help file of Installer VISE says the following about interfacing an external DLL:<br />
<br />
To build an external code dll follow these steps.<br />
<br />
An external code .dll file is a Windows dynamic library with at least one procedure exported. That procedure must look like this:<br />
<br />
extern &quot;C&quot; LONG CALLBACK ViseEntry(LONG lParam1, LPCSTR lpParam2, DWORD dwReserved)<br />
<br />
This is the entry procedure that will be called by the setup program. (See &quot;Creating External Code for Installer VISE Installers&quot; below for more details.)<br />
<br />
Your external code file must be 32-bit. You can copy the skeleton project in the ExtCodes folder and use it as a starting point. This example code displays a simple message box to the user.<br />
<br />
Creating External Code for Installer VISE Installers<br />
<br />
In order to interface with an Installer VISE installer, your external code must have a main entry point as follows:<br />
<br />
extern &quot;C&quot; LONG CALLBACK ViseEntry(LONG lParam1, LPCSTR lpParam2, DWORD dwReserved)<br />
<br />
If you need access to information returned by calling the external code (beyond simple success or failure), your code source must also include the following class definition:<br />
<br />
class CViseEntryData<br />
<br />
{<br />
<br />
public:<br />
<br />
HWND m_hwndMain; 	// Main window handle<br />
HWND m_hwndProgress; 	// Progress dialog window handle<br />
BOOL m_bUninstall; 	// Uninstaller flag<br />
LPCSTR m_lpszUninstallLogFile; 	// Uninstall log file path<br />
LPCSTR m_lpszTempDir; 	// Installer VISEâ€™s temp directory path<br />
HINSTANCE m_hinst; 	// Instance handle of the VISE dll<br />
char m_szInstallerName[_MAX_PATH]; 	// Name of the installer<br />
// eSellerate shopping cart data<br />
LONG m_nShoppingCartCount; 	// Number of items in the shopping cart<br />
<br />
LPCSTR m_lpShoppingCartSKU[64]; 	// Array to list SKU IDs corresponding to <br />
	// items in the shopping cart<br />
LPCSTR m_lpShoppingCartID[64]; 	// Array to list Product IDs corresponding <br />
	// to items in the shopping cart<br />
// eSellerate serial number data<br />
LONG m_nSerialNumberCount; 	// Number of serial numbers issued<br />
LPCSTR m_lpSerialNumberID[64]; 	// Array to list Product IDs corresponding <br />
	// to listed serial numbers<br />
LPCSTR m_lpSerialNumber[64]; 	// Array to list serial numbers<br />
<br />
LPCSTR m_lpSerialNumberKey[64]; 	// Array to list Name-based Keys <br />
	// corresponding to listed serial numbers<br />
// eSellerate file location data<br />
LONG m_nFileLocationCount; 	// Number of files downloaded<br />
LPCSTR m_lpFileLocationID[64]; 	// Array to list Product IDs corresponding <br />
	// to downloaded files<br />
<br />
LPCSTR m_lpFileLocation[64]; 	// Array to list locations of downloaded<br />
	// files<br />
<br />
};<br />
<br />
In order to correctly format the information defined in the CViseEntryData class, your external code must include the following line:<br />
<br />
CViseEntryData* pViseEntryData = (CViseEntryData*)dwReserved;<br />
<br />
You may then access the CViseEntryData class information in your external code using the following convention:<br />
<br />
pViseEntryData-&gt;m_lpszTempDir;<br />
<br />
<br />
Now, how can I use the above code in UserInfo? Which function should I call in the &quot;extern &quot;C&quot; LONG CALLBACK ViseEntry(LONG lParam1, LPCSTR lpParam2, DWORD dwReserved)&quot; function?<br />
<br />
Thanks in advance!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th January 2005, 10:43</div></div><div class="posttext">The file Source\exehead\exec.c can be found in the folder where you've installed NSIS.<br />
<br />
I suggest you copy the code in GetAccountType from UserInfo.c into your ViseEntry and adjust it to fit. Calling GetAccountType from ViseEntry is a mess not worth getting into.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>