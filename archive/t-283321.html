<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Scheduled Tasks on Vista, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Scheduled Tasks on Vista NSIS Discussion" />
	
	<title> Scheduled Tasks on Vista [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Scheduled Tasks on Vista</div>
<hr />
<div class="pda"><a href="t-283321.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=283321">Scheduled Tasks on Vista</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Coolblu77</div><div class="date">17th December 2007, 15:25</div></div><div class="posttext">I'm currently using the Scheduled Task Plugin http://nsis.sourceforge.net/Scheduled_Tasks,<br />
 this works very well on WindowsXP machines.<br />
But on Vista machines the install wizard crashes the first time its ran, and the second time I get the returned value that the task already exists.<br />
I have looked under C:\Windows\Tasks and found the tasks I'm trying to add are there with the .job extension.<br />
But these do not work.<br />
<br />
From reading MSDN I see that Vista uses Task Scheduler v2.0 where'as previous versions of Windows used Task Scheduler v1.0.<br />
<br />
Does anyone have any script code or plugins that will create a task for Vista using the Task Scheduler v2.0 ?<br />
<br />
Or am I going to have to read more about NSIS to try to do this myself (that's gonna take ages).<br />
<br />
Thanks to anyone that can help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th December 2007, 20:08</div></div><div class="posttext">For a quick solution, it'd probably be simplest to write a plug-in that'd add the task. Base it on Examples\Plugin. If not, that script will have to be fixed so it works on Vista as well.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BSOD2600</div><div class="date">8th March 2009, 10:15</div></div><div class="posttext">Ok, I realize it's an old thread...<br />
<br />
Anyone made any headway on this issue yet?  The script http://nsis.sourceforge.net/Scheduled_Tasks hasn't been updated nor any plugins made (that I'm aware of).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">8th March 2009, 21:45</div></div><div class="posttext">The Vista v2 api has a flag called TASK_COMPATIBILITY_V1, so I assume the old api should still work. Could there be a bug with the code on the wiki?<br />
<br />
Quoting AmitavaS - MSFT (http://blogs.msdn.com/amitava/) @ http://social.msdn.microsoft.com/Forums/en-US/windowscompatibility/thread/76db84f6-abae-46db-be93-337d371d6756/<br />
<br />
The ItaskScheduler 1.0 Interface is supported in Server 2008, and Vista. However, the tasks used by Vista and Server 2008 are accessed through the Itask Scheduler 2.0 Interface. Which means that manually scheduled tasks will not enumerate or appear when using the 1.0 interface.<br />
<br />
<br />
This of course does not mean it actually works.<br />
<br />
What if you try using at.exe from XP on Vista?<br />
<br />
If it turns out that the v1 api is broken on Vista, then someone will need to write a v2 version</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BSOD2600</div><div class="date">8th March 2009, 22:19</div></div><div class="posttext">Originally posted by Anders <br />
What if you try using at.exe from XP on Vista? <br />
Yes, my NSIS code regarding creating a scheduled task, which works on Windows 2000, XP, 2003 does not appear to work on Vista x86.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">8th March 2009, 22:37</div></div><div class="posttext">I was not talking about NSIS code there, I'm talking about AT.EXE that ships with XP. Take a copy of it from XP and try it on Vista</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BSOD2600</div><div class="date">8th March 2009, 22:45</div></div><div class="posttext">Oh the old AT command.  I'm using the NSIS scheduled task code because the AT command doesn't provide me enough options/configuration that I need.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th March 2009, 03:01</div></div><div class="posttext">well, at this point we just need to know if the v1 api works or not</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BSOD2600</div><div class="date">9th March 2009, 04:19</div></div><div class="posttext">Just tested.  Yes, Vista x86 still comes with the AT command and it does work.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BSOD2600</div><div class="date">9th March 2009, 09:08</div></div><div class="posttext">After some more digging, seems Vista has a new tool to manage the scheduled tasks: schtasks.<br />
<br />
Also, since now one can export/import Scheduled tasks via XML files, I should be able to accomplish what I need. Export an XML file, use NSIS to modify various fields and then re-import via schtasks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th March 2009, 20:06</div></div><div class="posttext">Originally posted by BSOD2600 <br />
Just tested.  Yes, Vista x86 still comes with the AT command and it does work.  I know it does, but I wanted you to COPY at.exe from XP and try that version on a Vista machine</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BSOD2600</div><div class="date">9th March 2009, 21:11</div></div><div class="posttext">Originally posted by Anders <br />
I know it does, but I wanted you to COPY at.exe from XP and try that version on a Vista machine  <br />
Alright, copied over the XP AT.exe to Vista. Verified with sysinternals process monitor that it used the XP AT.exe to successfully create a scheduled task.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Coolblu77</div><div class="date">11th March 2009, 17:04</div></div><div class="posttext">I probably should have replied to this ages ago.<br />
<br />
I don't know if the Scheduled Task plugin has been changed, and I don't know anything about AT.exe (so I'm not really helping at all here).<br />
<br />
But the way I got my tasks created was to get the Windows Version (http://nsis.sourceforge.net/Get_Windows_version), if it was &quot;Vista&quot; then I created the task using SchTasks.exe, else I used the Plugin.<br />
<br />
SchTasks appears to be able to configure tasks with the same options that TaskScheduler in Control Panel can.<br />
<br />
<br />
For anyone who comes across this thread and is interested, here's my SchTasks code to create a task that runs every day at a specified time:<br />
 StrCpy $strCmdLine &quot;SCHTASKS /Create /RU UserName /RP Password /SC DAILY /TN TaskName \<br />
/TR $\&quot;'$INSTDIR\File.exe'$\&quot; /ST $strStartHour:$strStartMin /SD 01/01/2008 /IT /F /MO 1&quot;<br />
<br />
nsExec::Exec '$strCmdLine'<br />
Pop $0<br />
StrCpy $cmdLineResult $0 1 0<br />
StrCmp $cmdLineResult &quot;0&quot; Cmd2Success CmdFailed</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>