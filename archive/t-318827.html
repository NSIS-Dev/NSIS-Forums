<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Uninstall runs but doesn't delete open programs, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Uninstall runs but doesn't delete open programs NSIS Discussion" />
	
	<title> Uninstall runs but doesn't delete open programs [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Uninstall runs but doesn't delete open programs</div>
<hr />
<div class="pda"><a href="t-318827.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=318827">Uninstall runs but doesn't delete open programs</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jrenbaum</div><div class="date">30th April 2010, 22:18</div></div><div class="posttext">Does anyone know of a way to help nsis deal with open programs during the uninstall process?<br />
<br />
If the application installed by our nsis installer is open when the uninstaller is run, then the uninstaller completes without error, but the application.jar file that was open is left behind and the application is still running.  <br />
<br />
If I try to manually delete the jar file while the application is running I get a window pop-up that says:<br />
<br />
&quot;Cannot delete application: It is being used by another person or program. Close any programs that might be using the file and try again.&quot;<br />
<br />
I would like to have nsis pop-up a message like this when it tries to uninstall an open program, rather than skipping it and claiming that all is well.<br />
<br />
Alternatively, nsis could kill the application before uninstalling, but as the application is a jar file the Windows Task Manager and wmic commands simply shows the process as &quot;javaw.exe&quot; which makes it hard to kill since there may be other java applications running on the user's machine. <br />
<br />
This problem occurs on XP and Windows7 (at a minimum). Any help will be appreciated.<br />
<br />
Jay</div></div><hr />


<div class="post"><div class="posttop"><div class="username">redxii</div><div class="date">1st May 2010, 00:41</div></div><div class="posttext">You can try a executable wrapper for Java. First two results are for JSmooth and j4launch.<br />
<br />
http://jsmooth.sourceforge.net/<br />
http://launch4j.sourceforge.net/<br />
<br />
That should allow you to identify your program and kill it/or ask the user to close it first.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st May 2010, 10:38</div></div><div class="posttext">You have two options that I can think of:<br />
<br />
1. Use the LockedList plug-in to either show its dialog or use the IsFileLocked function to test if your files are locked.<br />
2. Simply use the /rebootok switch on your Delete instructions thus requiring the user to reboot.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">1st May 2010, 16:35</div></div><div class="posttext">Personally, I use nsisDDE (http://wiz0u.free.fr/prog/nsisDDE) to send a Dynamic Data Exchange (DDE) message to my application to ask it to exit by itself.<br />
This is possible with the applications that implements a DDE server with an Exit or Quit function (like Microsoft apps and probably others, or it's easy to do if you code the application under MFC)<br />
This way, the application exits smoothly, saving its state or even asking the user, rather than forcibly kill the running application.<br />
<br />
I don't know if it solves your specific request however, as your program is under Java.<br />
(Looking on Google, there are a few DDE wrappers for Java available)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jrenbaum</div><div class="date">3rd May 2010, 18:46</div></div><div class="posttext">So I was able to implement the LockedList plugin fairly easily and my installer now checks for the appropriate locked file on both install and uninstall. The problem I have now is that during the uninstall the LockedList plugin consistantly misses the locked file when initially run. If I say next, then back to get to the LockList plugin again, it searches for and finds the locked file which is definitely there. When I then kill the application, LockList correctly updtes and states that no files are open. <br />
<br />
Any ideas as to why it would lie on the first attemp?<br />
<br />
Jay</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd May 2010, 19:37</div></div><div class="posttext">Some basic code that reproduces the issue would be helpful.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jrenbaum</div><div class="date">3rd May 2010, 19:50</div></div><div class="posttext">Stu,<br />
<br />
Here is the code I was using:<br />
<br />
Function LockedListShow<br />
<br />
  !insertmacro MUI_HEADER_TEXT `Locked File Dialog` `Checking if the ${LINK_NAME} application is running. If so, it should be closed prior to running the installer.`<br />
<br />
  LockedList::AddFile &quot;$INSTDIR\${PRODUCT_LINK}.jar&quot;<br />
  LockedList::Dialog /ignore ``<br />
  Pop $R0<br />
<br />
FunctionEnd<br />
<br />
Function un.LockedListShow<br />
<br />
  !insertmacro MUI_HEADER_TEXT `Locked File Dialog` `Checking if the ${LINK_NAME} application is running. If so, it must be closed for the Uninstaller to run properly.`<br />
<br />
  LockedList::AddFile &quot;$INSTDIR\${PRODUCT_LINK}.jar&quot;<br />
  LockedList::Dialog /ignore ``<br />
  Pop $R0<br />
<br />
FunctionEnd<br />
<br />
Called via:<br />
<br />
!insertmacro MUI_PAGE_WELCOME<br />
;Page Custom LockedListShow       <br />
Page Custom LicensePage           <br />
!insertmacro MUI_PAGE_COMPONENTS<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
!insertmacro MUI_PAGE_INSTFILES<br />
;UninstPage Custom un.LockedListShow<br />
!insertmacro MUI_UNPAGE_CONFIRM<br />
!insertmacro MUI_UNPAGE_INSTFILES<br />
<br />
With a little more searching on the nsis forums I found the following:<br />
 http://nsis.sourceforge.net/Check_whether_your_application_is_running_during_uninstallation<br />
<br />
This allowed me to correctly determine if the application is running and abort if true. This seems to work very well and doesn't allow the user to continue anyway which the LockedList seems to allow.<br />
<br />
Thanks,<br />
<br />
Jay</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd May 2010, 20:17</div></div><div class="posttext">Using the /ignore switch allows the user to continue. I will put your bug on my TODO list.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jrenbaum</div><div class="date">3rd May 2010, 20:21</div></div><div class="posttext">Stu,<br />
<br />
Thanks for the response.<br />
<br />
Jay</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd May 2010, 21:56</div></div><div class="posttext">I cannot reproduce the problem. Can you produce a buildable script for me?<br />
<br />
This is the one I am using to test (attached).<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>