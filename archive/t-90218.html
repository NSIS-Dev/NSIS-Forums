<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Prompting for a destination folder for shortcuts, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Prompting for a destination folder for shortcuts NSIS Discussion" />
	
	<title> Prompting for a destination folder for shortcuts [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Prompting for a destination folder for shortcuts</div>
<hr />
<div class="pda"><a href="t-90218.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=90218">Prompting for a destination folder for shortcuts</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Zaraza</div><div class="date">6th June 2002, 22:10</div></div><div class="posttext">In most installers, the user has the option to override the default folder where the shortcuts get placed by displaying a list of all the available folders under Start-&gt;Programs.<br />
<br />
is there any way to accomplish this in NSIS? I can't find any code for this, are there maybe some DLL extensions for this?<br />
<br />
It's not a critical feature, but one of those &quot;nice to have&quot; things...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">7th June 2002, 07:39</div></div><div class="posttext">You could try to build this with InstallOptions. The problem: we cannot retrieve the directory structure of the StartMenu using NSIS. You would need to build a DLL for that. The output of this DLL should be the argument of a &quot;DropList&quot; or &quot;ListBox&quot; in InstOpts.<br />
<br />
It's possible, but not with standard NSIS code.<br />
<br />
Good luck,<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th June 2002, 14:36</div></div><div class="posttext">Couldn't the folder listing be accomplished using FindFirst, FindNext and FindClose using some kind of recursive function. To identify folders you should use IfFileExists. Write all the folders you find into the ini file and it is ready to be displayed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">7th June 2002, 14:59</div></div><div class="posttext">Hmmm, yes, could be used of course, but there will be an additional problem (as we also encounter with InstallShield and Wise). Since for example in Win2K every user has its own path for the startmenu. Some users (like me :)) just collect all shortcuts into their own startmenu and clearing the &quot;All user&quot; startmenu. So this is empty, no folders found. So we need some additional programming first to ask the user which folder (&quot;User&quot; or &quot;All users&quot;) to use and then we can search that path and display the ini.<br />
<br />
Concluding, possible (contrary to my first belief, please do not punish me, I cannot be almighty or all-knowing).<br />
<br />
Good luck,<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Zaraza</div><div class="date">7th June 2002, 15:09</div></div><div class="posttext">I am fighting enough with InstallOptions :) <br />
<br />
Let me skip this functionality altogether then...the users can move it wherever they want later...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">7th June 2002, 16:48</div></div><div class="posttext">Zaraza,<br />
<br />
I'll post an example script tomorrow. Check this thread again then.<br />
<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pjw62</div><div class="date">7th June 2002, 19:13</div></div><div class="posttext">hmmm... here is something I wrote a while ago before InstallOptions came out I think (or at least before it was made into a dll).  As it is, it isn't particularly impressive (but now works, I think the last time I posted a link, I forgot to include the actuall DLL :)), but someone could use the code and hack it up a bit.<br />
<br />
I can't remember what it does for WinNT start menus..<br />
<br />
(attached).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pjw62</div><div class="date">7th June 2002, 19:22</div></div><div class="posttext">Actually, looking over the source code for it, it is extremely ugly.  I cant believe I ever wrote that!<br />
<br />
A couple of notes;<br />
Check the dll was loaded (I haven't had time to check, but I presume the error flag is set)<br />
** request; can dll plugins get a ptr to the error flag/<br />
Check the dlg was created (by popping, checking [and pushing, if it does not equal 0]).<br />
And no, it is not necessary to extract and delete the dll and resource script everytime it is used.. only at the onInit, abort etc.<br />
If the dlg was created, make sure you dealloc.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">8th June 2002, 09:02</div></div><div class="posttext">Here's the script I promised to upload. It uses MultIni4 by Dave Laundon (and a bit by me). See this (http://forums.winamp.com/showthread.php?s=&amp;threadid=85673) thread. The pity is that the components of a CustomPage cannot interact. Now people need to retype a selected dir if they want to create a subdir. But it works.<br />
<br />
Good luck, greetz,<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">8th June 2002, 09:03</div></div><div class="posttext">Sorry, forgot the actual script...<br />
<br />
Here's the attachment.<br />
<br />
<br />
I found a bug in the script: forgot to Pop $0 before returning if the user did not type or select a dir. Solved now.<br />
<br />
<br />
<br />
The code by pjw62 solves the problem of non-interacting components and can be implemented in multini4, but to be honest, the setting up the .res file might be a problem.<br />
<br />
<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pjw62</div><div class="date">8th June 2002, 13:06</div></div><div class="posttext">If creating resource files is a problem for people with out the MS Dev studio/resource compiler etc,  I think Borland has a free 'resource workshop' available.<br />
<br />
ALso, I was thinking that a better way to implement additional pages etc would be to still use resource files (they are nice and easy to layout and design) would be to have it is as an optional #define on compiling makensis, then we could do things like going backwards and forwards, checking etc more cleanly with callbacks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">10th June 2002, 07:27</div></div><div class="posttext">PJW62,<br />
<br />
I searched the Borland site, I couldn't find a free resource workshop. Please post a hyperlink to it so everyone can start using your nice utility.<br />
<br />
Thanks, greetz,<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Lion King</div><div class="date">11th June 2002, 16:32</div></div><div class="posttext">http://linux20368.dn.net/protools/utilities.htm<br />
<br />
or http://protools.cjb.net/ if the link above doesn't work<br />
<br />
resource workshop is a 16 bit app, wouldn't resource hacker work also?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">12th June 2002, 09:33</div></div><div class="posttext">Well, I tested the construction with .res files, but I'm not happy with the results. It seems that the control loads the startmenu of the current user only, so we cannot choose to install shortcuts for all users with this control.<br />
To install for all users, we cannot ask to choose a dir. So we're back where we started. In that case, use my solution in NSIS. It has a minor drawback, but it is compatible to multiple users.<br />
<br />
Another drawback is that it doesn't work properly from functions (so implementation in MultIni4 becomes impossible). I couldn't yet figure out why, but when clicking cancel in the ExDlg, .onUserAbort isn't even called. So 'dealloc' and deletion of the dll becomes impossible. (So files remain on harddisk, installer remains resistent as a process...) It works from a section quit well, but then we cannot integrate it in the 'first part of the installer', where user input is requested.<br />
<br />
Maybe pjw62 can solve these bugs for us?<br />
<br />
Check my code, but be warned! Do not compile and run the script!<br />
<br />
Good luck with it, greetz,<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pjw62</div><div class="date">12th June 2002, 18:13</div></div><div class="posttext">Yes, thanks for pointing that out Smile2Me..  I think I need to sort out this bug before anyone uses this.<br />
<br />
I've got a Nuclear Physics and Cosmology exam tomorrow, so I dont think I'll be looking at it tonight ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">12th June 2002, 20:42</div></div><div class="posttext">Ok, we'll wait for it. If this bug is solved, it would be a great contribution! Please try your new version with my script and you will easily see if it works.<br />
<br />
Good luck with your exam.<br />
<br />
Greetz,<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">21st June 2002, 11:31</div></div><div class="posttext">Sunjammer has created a modified InstOpts which allows for communication of components. It is called targetting. So, the problem described above has been solved and this is now a fully working demo. Please remind (as you can find in the zip too) that the modified IO is a beta version!<br />
<br />
Please refer to the NSIS Database (http://www.clantpa.co.uk/nsis/wiki) to keep your script up to date, since we expect some nice modifications of IO to come in the near future.<br />
<br />
Have fun, greetz,<br />
-Hendri.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>