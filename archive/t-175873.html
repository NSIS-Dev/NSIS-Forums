<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Directory Listing in NSIS, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Directory Listing in NSIS NSIS Discussion" />
	
	<title> Directory Listing in NSIS [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Directory Listing in NSIS</div>
<hr />
<div class="pda"><a href="t-175873.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=175873">Directory Listing in NSIS</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">dasein</div><div class="date">8th April 2004, 20:42</div></div><div class="posttext">Hello,<br />
<br />
Is there a way to get a directory listing into a variable? There is a random directory generated by Thunderbird's createprofile option that I need to install some files into.<br />
<br />
I've tried to use this line:<br />
nsExec::Exec 'dir &quot;$APPDATA\Thunderbird\Profiles\default&quot;'<br />
but this gives me &quot;error&quot; in the stack.<br />
<br />
Is there some easier way to do this?<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">8th April 2004, 21:13</div></div><div class="posttext">To enumerate directories you have to use FindFirst, FindNext and FindClose.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dasein</div><div class="date">8th April 2004, 21:42</div></div><div class="posttext">Ah... Thank you very much. I didn't know the Find commands included directories and not just files.<br />
<br />
Thanks again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">26th June 2006, 04:10</div></div><div class="posttext">very old question, i needed that hint, here the result<br />
<br />
Function findfile0<br />
  Delete &quot;$EXEDIR\\foldlist.ini&quot;<br />
  Delete &quot;$EXEDIR\\filelist.ini&quot;<br />
  StrCpy $R7 &quot;1&quot;<br />
  StrCpy $R8 &quot;0&quot;<br />
  StrCpy $R9 &quot;0&quot;<br />
  StrCpy $SEARCHDIR $EXEDIR ; &lt;-- modify directory (from input or fixed)<br />
  Push $SEARCHDIR<br />
  Call findfile2<br />
  Call findfile1<br />
FunctionEnd<br />
<br />
<br />
Function findfile1<br />
findfile1_loop:<br />
  ReadINIStr $3 &quot;$EXEDIR\\foldlist.ini&quot; subdirs $R7<br />
  StrCmp $3 &quot;&quot; findfile1_done<br />
    Push $3<br />
    Call findfile2<br />
    IntOp $R7 $R7 + 1<br />
    IntCmp $R7 $R8 0 0 findfile1_done<br />
  Goto findfile1_loop<br />
findfile1_done:<br />
FunctionEnd<br />
<br />
<br />
Function findfile2<br />
Pop $2<br />
FindFirst $0 $1 &quot;$2\\*.*&quot;<br />
findfile2_loop:<br />
  StrCmp $1 &quot;&quot; findfile2_done<br />
  StrCmp $1 &quot;.&quot; findfile2_loop02<br />
  StrCmp $1 &quot;..&quot; findfile2_loop02<br />
  IfFileExists &quot;$2\\$1\\*.*&quot; 0 findfile2_loop01<br />
    Call subdir<br />
    Goto findfile2_loop02<br />
  findfile2_loop01:<br />
  Call filewrite<br />
  findfile2_loop02:<br />
  FindNext $0 $1<br />
  Goto findfile2_loop<br />
findfile2_done:<br />
FunctionEnd<br />
<br />
<br />
Function subdir<br />
  IntOp $R8 $R8 + 1<br />
  WriteINIStr &quot;$EXEDIR\\foldlist.ini&quot; subdirs $R8 $2\\$1<br />
FunctionEnd<br />
<br />
Function filewrite<br />
  IntOp $R9 $R9 + 1<br />
  WriteINIStr &quot;$EXEDIR\\filelist.ini&quot; filelist $R9 $2\\$1<br />
FunctionEnd<br />
<br />
<br />
The idea behind:<br />
- search starting folder and grab all files (filelist.ini)<br />
- write subfolders into foldlist.ini<br />
- then readout foldlist.ini and grab files and folders again<br />
<br />
$R9 is filelist-pointer<br />
$R8 is folderlist-pointer<br />
$R7 is helper-pointer<br />
<br />
$R8 raises and when $R7 &gt; $R8 (or $3 is empty) the end of the folder list was reached.<br />
<br />
modify function &quot;filewrite&quot; as you wish (other output format eg.)<br />
<br />
HTH</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>