<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" InstallOptions error, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  InstallOptions error NSIS Discussion" />
	
	<title> InstallOptions error [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  InstallOptions error</div>
<hr />
<div class="pda"><a href="t-289845.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=289845">InstallOptions error</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">GrecKo</div><div class="date">8th April 2008, 05:39</div></div><div class="posttext">I have encountered some problems with a custom page in my installer, i first tried it without any file in my sections<br />
( ;File ...  instead of File ... :) ) and every things worked perfectly :cool: ,<br />
but when i re add the files i want my installer to decompress, the custom page take about 1 minute to appear<br />
and when i finally set my preferences (thanks to checkboxes textbox ...)and clik Next it does install the whole thing<br />
but does not execute the code of the custom page leave function :confused: .<br />
<br />
Here is my code :<br />
<br />
;Include Modern UI v2<br />
!include &quot;MUI2.nsh&quot;<br />
;Include a Logic Library<br />
!include &quot;LogicLib.nsh&quot;<br />
;Inculde Install Options for the custom pages<br />
!include &quot;InstallOptions.nsh&quot;<br />
<br />
...<br />
...<br />
<br />
;Interface Settings<br />
<br />
!define MUI_ICON install\cstrike.ico<br />
!define MUI_HEADERIMAGE<br />
!define MUI_HEADERIMAGE_BITMAP install\logo.bmp<br />
!define MUI_WELCOMEFINISHPAGE_BITMAP install\logov.bmp<br />
!define MUI_COMPONENTSPAGE_CHECKBITMAP install\simple-round2.bmp<br />
!define MUI_ABORTWARNING<br />
!define MUI_COMPONENTSPAGE_SMALLDESC<br />
<br />
;Pages<br />
<br />
!insertmacro MUI_PAGE_WELCOME<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
Page custom ParamAsk ParamSet<br />
!insertmacro MUI_PAGE_INSTFILES<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
;Sections<br />
<br />
...<br />
...<br />
<br />
;My Custom page :<br />
<br />
Function ParamAsk<br />
  !insertmacro MUI_HEADER_TEXT &quot;Choisissez les rÃ©glagles de Counter-Strike Insalan&quot; &quot;Choisissez ici les options que vous voulez activer pour Counter-Strike&quot;<br />
  !insertmacro INSTALLOPTIONS_EXTRACT &quot;options.ini&quot;<br />
  !insertmacro INSTALLOPTIONS_DISPLAY &quot;options.ini&quot;<br />
FunctionEnd<br />
<br />
Function ParamSet<br />
  !insertmacro INSTALLOPTIONS_READ $R1 &quot;options.ini&quot; &quot;Field 1&quot; &quot;State&quot;<br />
  !insertmacro INSTALLOPTIONS_READ $R2 &quot;options.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
  !insertmacro INSTALLOPTIONS_READ $R3 &quot;options.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
  !insertmacro INSTALLOPTIONS_READ $R4 &quot;options.ini&quot; &quot;Field 4&quot; &quot;State&quot;<br />
  !insertmacro INSTALLOPTIONS_READ $R5 &quot;options.ini&quot; &quot;Field 5&quot; &quot;State&quot;<br />
  !insertmacro INSTALLOPTIONS_READ $R6 &quot;options.ini&quot; &quot;Field 6&quot; &quot;State&quot;<br />
  !insertmacro INSTALLOPTIONS_READ $R7 &quot;options.ini&quot; &quot;Field 7&quot; &quot;State&quot;<br />
<br />
  FileOpen $0 $INSTDIR\parms.ini w<br />
  ${If} $R1 == 1<br />
    FileWrite $0 &quot;-noforcemspd$\r$\n&quot;<br />
  ${EndIf}<br />
  ${If} $R2 == 1<br />
    FileWrite $0 &quot;-noforcemaccel$\r$\n&quot;<br />
  ${EndIf}<br />
  ${If} $R3 == 1<br />
    FileWrite $0 &quot;-noforcemparms$\r$\n&quot;<br />
  ${EndIf}<br />
  ${If} $R4 == 1<br />
    FileWrite $0 &quot;-freq 75$\r$\n&quot;<br />
  ${EndIf}<br />
  ${If} $R5 == 1<br />
    FileWrite $0 &quot;-freq 100$\r$\n&quot;<br />
  ${EndIf}<br />
  FileWrite $0 $R6<br />
  FileClose $0<br />
  <br />
  ${If} $R7 == 1<br />
    WriteRegBin HKCU &quot;Control Panel\Mouse&quot; &quot;SmoothMouseXCurve&quot; &quot;000000000000000000a0000000000000004001000000000000800200000000000000050000000000&quot;<br />
    WriteRegBin HKCU &quot;Control Panel\Mouse&quot; &quot;SmoothMouseYCurve&quot; &quot;000000000000000066a6020000000000cd4c050000000000a0990a00000000003833150000000000&quot;<br />
  ${EndIf}<br />
FunctionEnd <br />
<br />
And here is my installoptions file :<br />
<br />
; Ini file generated by the HM NIS Edit IO designer.<br />
[Settings]<br />
NumFields=15<br />
<br />
[Field 1]<br />
Type=Checkbox<br />
Text=-noforcemspd<br />
Left=20<br />
Right=85<br />
Top=15<br />
Bottom=25<br />
<br />
[Field 2]<br />
Type=Checkbox<br />
Text=-noforcemaccel<br />
Left=20<br />
Right=85<br />
Top=25<br />
Bottom=35<br />
<br />
[Field 3]<br />
Type=Checkbox<br />
Text=-noforcemparms<br />
Left=20<br />
Right=85<br />
Top=35<br />
Bottom=45<br />
<br />
[Field 4]<br />
Type=Checkbox<br />
Text=-freq 75<br />
Left=20<br />
Right=85<br />
Top=50<br />
Bottom=60<br />
<br />
[Field 5]<br />
Type=Checkbox<br />
Text=-freq 100<br />
Left=20<br />
Right=85<br />
Top=60<br />
Bottom=70<br />
<br />
[Field 6]<br />
Type=Text<br />
Left=20<br />
Right=90<br />
Top=75<br />
Bottom=85<br />
<br />
[Field 7]<br />
Type=Checkbox<br />
Text=Supprimer l'accÃ©lÃ©ration souris de windows.<br />
Left=20<br />
Right=170<br />
Top=110<br />
Bottom=120<br />
<br />
[Field 8]<br />
Type=Label<br />
Text=ParamÃ¨tres de lancement de Counter-Strike :<br />
Left=0<br />
Right=160<br />
Top=0<br />
Bottom=10<br />
<br />
[Field 9]<br />
Type=Label<br />
Text=DÃ©sactive la modification de la vitesse de la souris par Half-life.<br />
Left=100<br />
Right=326<br />
Top=17<br />
Bottom=25<br />
<br />
[Field 10]<br />
Type=Label<br />
Text=Idem pour l'accÃ©lÃ©ration de la souris.<br />
Left=100<br />
Right=338<br />
Top=26<br />
Bottom=35<br />
<br />
[Field 11]<br />
Type=Label<br />
Text=Idem pour l'attribution des touches de la souris.<br />
Left=100<br />
Right=371<br />
Top=36<br />
Bottom=45<br />
<br />
[Field 12]<br />
Type=Label<br />
Text=Force le taux de rafraichissement de l'Ã©cran ï¿½_ 75 Hertz.<br />
Left=100<br />
Right=302<br />
Top=52<br />
Bottom=60<br />
<br />
[Field 13]<br />
Type=Label<br />
Text=Force le taux de rafraichissement de l'Ã©cran ï¿½_ 100 Hertz.<br />
Left=100<br />
Right=306<br />
Top=61<br />
Bottom=70<br />
<br />
[Field 14]<br />
Type=Label<br />
Text=Rentrez ici vos paramÃ¨tres de lancement de CS personalisÃ©s.<br />
Left=100<br />
Right=357<br />
Top=75<br />
Bottom=100<br />
<br />
[Field 15]<br />
Type=Label<br />
Text=ParamÃ¨tres de Windows :<br />
Left=2<br />
Right=80<br />
Top=95<br />
Bottom=105<br />
<br />
I don't understant why is this working when my sections are empty, and not when i put files in my sections ... <br />
<br />
Thank you for your help ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GrecKo</div><div class="date">8th April 2008, 22:52</div></div><div class="posttext">No ones know why ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th April 2008, 23:18</div></div><div class="posttext">You need a ReserveFile instruction in there.<br />
<br />
Edit: See section 5 in the Modern UI manual.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GrecKo</div><div class="date">8th April 2008, 23:31</div></div><div class="posttext">Ok, thanks a lot, i din't make the link between this and my problem.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GrecKo</div><div class="date">10th April 2008, 04:34</div></div><div class="posttext">I added a ReserveFile &quot;options.ini&quot; at the beginning of my script, but it still doesn t work whith Solid Lzma (take a while to show the page), and when i remove the flag solid, it shows the custom page correctly but do not always do what's it has to do (ie Writing in $INSTDIR\parms.ini some text) ...<br />
However i think my script for writing in the file is quite simple, is it ?<br />
<br />
Still don't understand :S</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">10th April 2008, 05:55</div></div><div class="posttext">Regarding to custom pages, I think it's advised to use either MUI along with InstallOptions or MUI2 along with nsDialogs.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GrecKo</div><div class="date">10th April 2008, 12:54</div></div><div class="posttext">In fact, i don't tink my actual problem is due to my CustomPage, but it might be because of it creates a file in the installdir before the whole installation, so maybe it's deleted (:eek:) or the script doesn't have the time to create it, because just after my leave custompage it's the instfiles page.<br />
<br />
Just making a suggestion  :) .<br />
<br />
PS : i'm rewriting the script with nsDialogs in order to check it out.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GrecKo</div><div class="date">11th April 2008, 03:06</div></div><div class="posttext">OK, I solved my problem, it was not due to the custom page but it was caused by the fact that nsis (With FileOpen) seems to not work with opening a file in a a inexistant folder (ig. creating a file in a new folder),it actually creates the folder but it does not create the file.<br />
<br />
So I put my piece of script which create this file at the end of the installation(when the folder already exists) with the function &quot;.onInstSuccess&quot;.<br />
<br />
C ya :cool:</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>