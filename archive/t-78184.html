<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to delete 'Locked Files'?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to delete 'Locked Files'? NSIS Discussion" />
	
	<title> How to delete 'Locked Files'? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to delete 'Locked Files'?</div>
<hr />
<div class="pda"><a href="t-78184.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=78184">How to delete 'Locked Files'?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">dTomoyo</div><div class="date">4th March 2002, 00:19</div></div><div class="posttext">how to delete 'locked files'?<br />
<br />
I found a source from CodeGuru.<br />
<br />
but, I'm not skilled VC++.<br />
<br />
How embed to NSIS 1.96 source?<br />
<br />
<br />
/*<br />
Note: 1. SE_DEBUG privilege must be enabled. <br />
      2. The function works with every kind of HANDLE<br />
      3. It will bother the remote process :)<br />
      4. The handles will be invalid after you closed <br />
         them remotely<br />
*/<br />
<br />
//Close a handle in a remote process<br />
DWORD CloseRemoteHandle( DWORD processID, HANDLE handle )<br />
{<br />
 HANDLE ht = 0;<br />
 DWORD rc = 0;<br />
	<br />
 _tprintf( _T(&quot;Closing handle in process #%d ... &quot;), <br />
          processID );<br />
<br />
 // open the process<br />
 HANDLE hProcess = OpenProcess( PROCESS_CREATE_THREAD <br />
                                | PROCESS_VM_OPERATION <br />
                                | PROCESS_VM_WRITE <br />
                                | PROCESS_VM_READ, <br />
                                FALSE, processID );<br />
	<br />
 if ( hProcess == NULL )<br />
 {<br />
  rc = GetLastError();<br />
  _tprintf( _T(&quot;OpenProcess() failed\n&quot;) );<br />
  return rc;<br />
 }<br />
<br />
 // load kernel32.dll<br />
 HMODULE hKernel32 = LoadLibrary( _T(&quot;kernel32.dll&quot;) );<br />
<br />
 // CreateRemoteThread()<br />
 ht = CreateRemoteThread( <br />
  hProcess, <br />
  0, <br />
  0, <br />
  (DWORD(__stdcall *)(void*))GetProcAddress(hKernel32,&quot;CloseHandle&quot;),<br />
  handle, <br />
  0, <br />
  &amp;rc );<br />
	<br />
 if ( ht == NULL )<br />
 {<br />
  //Something is wrong with the privileges, <br />
  //or the process doesn't like us<br />
  rc = GetLastError();<br />
  _tprintf( _T(&quot;CreateRemoteThread() failed\n&quot;) );<br />
  goto cleanup;<br />
 }<br />
<br />
 switch ( WaitForSingleObject( ht, 2000 ) )<br />
 {<br />
  case WAIT_OBJECT_0:<br />
   //Well done<br />
   rc = 0;<br />
   _tprintf( _T(&quot;Ok\n&quot;), rc );<br />
  break;<br />
	<br />
  default:<br />
   //Oooops, shouldn't be here<br />
   rc = GetLastError();<br />
   _tprintf( _T(&quot;WaitForSingleObject() failed\n&quot;) );<br />
   goto cleanup;<br />
  break;<br />
 }<br />
<br />
 cleanup:<br />
 //Closes the remote thread handle<br />
 CloseHandle( ht );<br />
<br />
 //Free up the kernel32.dll<br />
 if ( hKernel32 != NULL)<br />
  FreeLibrary( hKernel32 );<br />
<br />
 //Close the process handle<br />
 CloseHandle( hProcess );<br />
	<br />
 return rc;<br />
}<br />
<br />
<br />
Source code by Zoltan Csizmadia.<br />
<br />
original source url : http://www.codeguru.com/files/ForceDel.shtml</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>