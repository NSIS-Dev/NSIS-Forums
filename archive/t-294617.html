<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" ExecShell with normal rights from within an elevated installer?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  ExecShell with normal rights from within an elevated installer? NSIS Discussion" />
	
	<title> ExecShell with normal rights from within an elevated installer? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  ExecShell with normal rights from within an elevated installer?</div>
<hr />
<div class="pda"><a href="t-294617.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=294617">ExecShell with normal rights from within an elevated installer?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">psyki</div><div class="date">16th July 2008, 15:50</div></div><div class="posttext">Hi,<br />
<br />
I have the following problem:<br />
My installer needs to run with administrator rights in Vista (elevated) because it needs to write file in the program files directory.<br />
<br />
I did that by adding the following line:<br />
<br />
RequestExecutionLevel highest <br />
<br />
However.<br />
At the end of my installer, I'd like to run an executable as a normal, non-elevated user.<br />
<br />
I start a process as follows:<br />
<br />
ExecShell &quot;&quot; &quot;explorer.exe&quot; <br />
<br />
Why do I want this?<br />
Well.<br />
If you run explorer in elevated mode, you won't be able to drag and drop files to it from non-elevated explorer windows.<br />
<br />
Very annoying.<br />
<br />
So, is there a simple way to run a process unelevated from within an elevated installer?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">psyki</div><div class="date">16th July 2008, 16:24</div></div><div class="posttext">Hmmmz.<br />
I suspect I could do this with the UAC plugin, but it seems like a whole workaround for just the one line of code, no?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">16th July 2008, 19:03</div></div><div class="posttext">yeah, the UAC plugin was created to solve this problem, but it is a pain in the ass to use. Did you try ExecShell &quot;explore&quot; &quot;$instdir&quot; (Should open a new explorer window as non admin, atleast that works on pre Vista)?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">psyki</div><div class="date">17th July 2008, 08:32</div></div><div class="posttext">The code I put above, was an example.<br />
<br />
I don't want to open explorer.<br />
I want to open my own application (and that one needs to open explorer, which is giving me the dragdrop issues)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">psyki</div><div class="date">17th July 2008, 10:32</div></div><div class="posttext">Found a working, easy solution, using a 3d party dll, but hey.<br />
<br />
If anyone else should come across this problem:<br />
<br />
The 3d party dll, with source and a good explanation can be found here:<br />
<br />
CodeProject source files (http://www.codeproject.com/KB/vista-security/RunNonElevated.aspx) <br />
<br />
Since regular links don't seem to work:<br />
http://www.codeproject.com/KB/vista-security/RunNonElevated.aspx <br />
<br />
In NSIS, it's easy to use as well.<br />
I've attached a sample NSIS installer, that does nothing but start explorer, non-elevated, from withing an elevated installer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">17th July 2008, 14:21</div></div><div class="posttext">Originally posted by psyki <br />
<br />
CodeProject source files (http://www.codeproject.com/KB/vista-security/RunNonElevated.aspx) <br />
 That dll injects code into another process that MIGHT be there to do its dirty stuff, not exactly clean. The UAC plugin supports elevation on 2000 and later, not just Vista unlike that code</div></div><hr />


<div class="post"><div class="posttop"><div class="username">psyki</div><div class="date">17th July 2008, 15:36</div></div><div class="posttext">On non-vista machins, it will just do shell execute, as expected.<br />
<br />
My only worry with it, is that a servicepack might block it.<br />
<br />
And i don't see the UAC plugin as clean either.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">17th July 2008, 20:24</div></div><div class="posttext">Originally posted by psyki <br />
On non-vista machins, it will just do shell execute, as expected.<br />
 How is that as expected, you can run into the same sort of trouble on 2000/XP as with Vista(Not D&amp;D tho, but other issues)<br />
<br />
Originally posted by psyki <br />
<br />
And i don't see the UAC plugin as clean either.  No, its not exactly clean, but at least it follows the MS guideline on how to do this with a inner and outer process</div></div><hr />


<div class="post"><div class="posttop"><div class="username">psyki</div><div class="date">18th July 2008, 10:51</div></div><div class="posttext">The only issue I have with the administrator permissions is that explorer doesn't allow me to dragdrop.<br />
<br />
And that only happens on Vista.<br />
So I don't need to catch it specifically for 2000, xp, ...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">18th July 2008, 11:01</div></div><div class="posttext">then you are missing the whole point, the problem on older systems (and on vista with non admin elevation with another account) is that any process you start runs as the admin, and not the &quot;logged in&quot; user. Granted, with explorer, this is unlikely since its probably already running (and in the default config) but if its not, or its set up to use one process per cabinet window, explorer will end up running as the wrong user</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>