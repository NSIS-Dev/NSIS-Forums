<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Script not working..., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Script not working... NSIS Discussion" />
	
	<title> Script not working... [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Script not working...</div>
<hr />
<div class="pda"><a href="t-143644.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=143644">Script not working...</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th July 2003, 12:16</div></div><div class="posttext">; OpenFileName defenition<br />
     !define stOPENFILENAME '(&amp;l4, i, i 0, i, i 0, i 0, i 0, t, i \<br />
        ${NSIS_MAX_STRLEN}, t, i ${NSIS_MAX_STRLEN}, t, t, i, \<br />
        &amp;i2, &amp;i2, t, i 0, i 0, i 0) i'<br />
        <br />
     ; Prepare filter sting<br />
     System::Call '*(&amp;t19 &quot;Zip files&quot;, &amp;t6 &quot;*.zip&quot;, &amp;t16 \<br />
        &quot;Zip files&quot;, &amp;t4 &quot;*.zip&quot;, &amp;i1 0) i.r0'<br />
     ; Prepare OpenFileName structure with other options<br />
     System::Call '*${stOPENFILENAME}(, $HWNDPARENT,, r0,,,,&quot;&quot;,,&quot;&quot;,, \<br />
       i 0, &quot;Select zip file to install&quot;, 0xA01800,,,,,,) .r1'<br />
<br />
     ; OpenFileName Dialog<br />
     System::Call 'comdlg32::GetOpenFileNameA(i r1) i .r2'<br />
     ; You could check r2 for zero value - this will indicate<br />
     ; the user pressed the cancel button<br />
<br />
     ; Retrieve selected file path   <br />
     System::Call '*$1${stOPENFILENAME}(,,,,,,,.r3)'<br />
     ; just a demo<br />
     MessageBox MB_OK 'Result $2, Filename &quot;$3&quot;'<br />
      <br />
     ; Free used memory<br />
     System::Free $1<br />
     System::Free $0<br />
<br />
<br />
This is a script that brainsucker made for me, but it isn't working quite right.<br />
The &quot;*.zip&quot; bit that is meant to show only zip files is not working - *.* show instead.<br />
<br />
Can anyone fix this for me?<br />
<br />
Thanks<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">27th July 2003, 16:21</div></div><div class="posttext">Have you considered using InstallOptions2 with a FileRequest control using a filter to restrict the FileOpen window to only showing Zip files (&quot;Filter=ZIP Files|*.zip&quot;) ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th July 2003, 17:25</div></div><div class="posttext">The whole perpose of this script is to open the dialog in a Section.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">27th July 2003, 17:41</div></div><div class="posttext">Sorry my answer was of no use to you: your original message did not mention how the script fragment was being used.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd August 2003, 10:33</div></div><div class="posttext">Try replacing:<br />
<br />
System::Call '*(&amp;t19 &quot;Zip files&quot;, &amp;t6 &quot;*.zip&quot;, &amp;t16 &quot;Zip files&quot;, &amp;t4 &quot;*.zip&quot;, &amp;i1 0) i.r0'<br />
<br />
<br />
with:<br />
<br />
System::Call '*(&amp;t10 &quot;Zip files&quot;, &amp;t6 &quot;*.zip&quot;, &amp;t10 &quot;Zip files&quot;, &amp;t6 &quot;*.zip&quot;, &amp;i1 0) i.r0'<br />
<br />
Notice that I have changed the number after every &amp;t to match the number of the characters in the string + 1.<br />
<br />
If that doesn't work try removing the second pair of &quot;Zip files&quot;, &quot;*.zip&quot;. Maybe Windows doesn't like it when you specify the same thing twice.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd August 2003, 12:06</div></div><div class="posttext">I put it in twice because the first pair didn't do anything (original script).<br />
<br />
I will check this new one out, thanks.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th August 2003, 11:19</div></div><div class="posttext">I have made a function out of this, which can be found here:<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=375&amp;instances=0,11,211<br />
<br />
I have allowed users to Push different Flags for use, but I'm not sure what the different flags need to be seperated with.<br />
<br />
Anyone know?<br />
<br />
Thanks<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th August 2003, 11:36</div></div><div class="posttext">Now, here is the DirRequest function by brainsucker:<br />
<br />
Function DirRequest<br />
        System::Store &quot;s r8r9&quot;<br />
<br />
        ; Get callback<br />
        System::Get  '(i.s, i.s, i.s, i.s) i ss'<br />
        pop     $0<br />
        <br />
        ; BrowseInfo structure<br />
        System::Call '*(i $HWNDPARENT, i 0, t &quot;&quot;, t r9, i 0x45, k r0, i, i) i.r1'<br />
        System::Call 'shell32::SHBrowseForFolderA(i r1) i.s'<br />
ShBrowse:<br />
        Pop $2<br />
        StrCmp $2 &quot;callback1&quot; 0 ExitBrowse<br />
<br />
        System::Store &quot;s r3r4r5r6&quot;<br />
        ; BFMM_INITIALIZED ?<br />
        IntCmp $4 1 0 exit exit<br />
        ; yes, set the starting dir<br />
        System::Call 'user32::SendMessageA(i $3, i 1126, i 1, t r8) i'<br />
         System::Store &quot;r2r3r4r5r6&quot;<br />
         System::Call &quot;$0&quot; 0<br />
exit:<br />
        ; Restore<br />
        System::Store &quot;l&quot;<br />
        System::Call &quot;$0&quot; 0<br />
        Goto ShBrowse<br />
<br />
ExitBrowse:<br />
        ; free used resources<br />
        System::Free $0        <br />
        System::Free $1<br />
<br />
        ; now we should determine folder name from given PIDL<br />
        System::Call 'shell32::SHGetPathFromIDListA(i $2, t &quot;&quot; r3)'<br />
<br />
        ; IMalloc-&gt;Free work<br />
        ; Get the pointer to interface<br />
        System::Call 'shell32::SHGetMalloc(*i . r4)'<br />
        ; Get the pointer to interface VTABLE<br />
        System::Call '*$4(i.r7)'<br />
        ; Get the pointer to IMalloc-&gt;Free<br />
        System::Call '*$7(&amp;t20, i.r5)'<br />
        ; Call Free method<br />
        System::Call '::$5(i r2)'<br />
<br />
        System::Store &quot;p3 l&quot;<br />
FunctionEnd<br />
<br />
The line...<br />
System::Call 'shell32::SHBrowseForFolderA(i r1) i.s'<br />
...crashes the installer everytime.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">3rd September 2003, 13:20</div></div><div class="posttext">Afrow UK: have you solved you problem with dirrequest?<br />
updated versions included. BrowseForFolderNew - no startup folder.<br />
Source - attached. You'll probably need updated exehead to use them.<br />
Use:<br />
<br />
     push       &quot;Select folder Demo&quot;<br />
     push       &quot;d:\Program files&quot; ; startup folder<br />
     call       BrowseForFolder<br />
     pop        $0<br />
     MessageBox MB_OK &quot;Selected folder '$0'&quot;<br />
<br />
     push       &quot;Select folder Demo small&quot;<br />
     call       BrowseForFolderNew<br />
     pop        $0<br />
     MessageBox MB_OK &quot;Selected folder '$0'&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd September 2003, 16:26</div></div><div class="posttext">The new script also crashes; after clicking OK after selecting the folder.<br />
This happens on my Windows XP system, not sure about Windows 98 (not able to test).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd September 2003, 16:28</div></div><div class="posttext">Ok, I'll need latest CVS first...<br />
<br />
Thanks<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">4th September 2003, 00:00</div></div><div class="posttext">Sorry Afrow. I don't think the latest CVS will help. No one of NSIS developers updated NSIS exehead code yet (as I know). If it will became critical for you I can send you updated makensis compiled from latest CVS and my changes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">24th November 2006, 22:19</div></div><div class="posttext">One heck of an old thread - perhaps FileRequest doesn't work under XP? Not sure.<br />
<br />
Basically I was hoping to make use of this function to pop up a file browsing dialog that would show hidden files/folders.  (DialogsEx doesn't support it - d'oh) But even the sample code in the WiKi seems to do zilch and returns a null value.<br />
<br />
I get the following values for the usual variables just before the function starts popping the originals:<br />
<br />
$0 = &lt;null&gt;<br />
$1 = 1430240<br />
$2 = error<br />
$3 = &lt;null&gt;<br />
$4 = (&amp;l4, i, i 0, i, i 0, i 0, i 0, t, i 1024, t, i 1024, t, t, i, &amp;i2, &amp;i2, t, i 0, i 0, i 0) i<br />
$5 = Zip Files (*.zip)<br />
$6 = *.zip<br />
$7 = All Files (*.*)<br />
$8 = *.*<br />
$9 = Select Zip file to install<br />
<br />
$R0 = 18<br />
$R1 = 6<br />
$R2 = 16<br />
$R3 = 4<br />
$R4 = open<br />
$R5 = 0xA01800<br />
$R6 = &lt;null&gt;<br />
$R7 = &lt;null&gt;<br />
$R8 = &lt;null&gt;<br />
$R9 = &lt;null&gt;<br />
<br />
<br />
Any clues or &quot;oops - silly us, change 'this' to 'that'&quot; would be appreciated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">24th November 2006, 22:31</div></div><div class="posttext">nevermind - the first thing I tried was getting rid of the $R4 in the call to comdlg32 and, out of habit more than anything, spelled it &quot;GetOpenFileName&quot;.  Immediately, things worked.<br />
<br />
Then I thought &quot;well why wouldn't that $R4 insert?&quot; before I realized that it did.  Except it inserted &quot;open&quot; and thus the call was &quot;GetopenFileName&quot;.<br />
<br />
Oops? :P<br />
<br />
I'll adjust the wiki in a moment.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">24th November 2006, 22:37</div></div><div class="posttext">Only to hit the next problem - it's not showing me the hidden files/folders. :(<br />
<br />
I tried passing...<br />
<br />
	Push &quot;0xA01800,0x10000000&quot;<br />
<br />
and<br />
<br />
	Push &quot;0x10000000&quot;<br />
<br />
<br />
Neither worked.  Am I missing something else?<br />
<br />
Edit:<br />
<br />
I also tried the flag &quot;0x00000200&quot; for multi-select, and it fails to work if passed as:<br />
<br />
	Push &quot;0xA01800,0x00000200&quot;<br />
<br />
<br />
but works when using:<br />
<br />
<br />
	Push &quot;0x00000200&quot;<br />
<br />
<br />
So double-checked with the hidden files one - but still no luck.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">25th November 2006, 14:27</div></div><div class="posttext">I believe that the flags should be OR'ed together, not listed with commas between them: 0x10A01800. (And for multiselect, 0xA01A00). My commdlg.h file (From Visual C++, 6.0) doesn't show a flag for hidden files, are you sure the 0x10000000 is correct?<br />
<br />
When I open a dialog for files with my editor (Crimson Editor) or with Firefox, it automatically includes hidden files. I can see 'thumbs.db' which has 'HSA' attributes. Did you try changing the dialog view type to 'detail' and adding the attribute column to the view? (right click on the detail view column header and select the columns you want).<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">26th November 2006, 03:55</div></div><div class="posttext">Originally posted by demiller9 <br />
I believe that the flags should be OR'ed together, not listed with commas between them: 0x10A01800.<br />
I had tried that as well, to no avail.<br />
<br />
Originally posted by demiller9 My commdlg.h file (From Visual C++, 6.0) doesn't show a flag for hidden files, are you sure the 0x10000000 is correct?[/B]<br />
As sure as I can be..  The flags are listed in the WiKi page on this.  A quick Google search I had done at the time just in case that hex code was incorrect seemed to confirm it should be fine (MSDN lists it at... http://msdn2.microsoft.com/en-us/library/ms646839.aspx )<br />
<br />
Originally posted by demiller9 <br />
When I open a dialog for files with my editor (Crimson Editor) or with Firefox, it automatically includes hidden files.<br />
Are you sure that is not because you have explorer set to show hidden folders/files by default?<br />
FireFox 1.5 isn't showing me the hidden file either.  Perhaps its location is important..<br />
c:\documents and settings\myUsername\My Documents\somefile.jpg<br />
<br />
somefile.jpg as the attributes: archive, hidden<br />
<br />
Originally posted by demiller9 <br />
Did you try changing the dialog view type to 'detail' and adding the attribute column to the view?<br />
Yeah, that does nothing either.  That just changes how things are displayed, not what files are displayed, I'm afraid.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>