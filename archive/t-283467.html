<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Execute command line tool, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Execute command line tool NSIS Discussion" />
	
	<title> Execute command line tool [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Execute command line tool</div>
<hr />
<div class="pda"><a href="t-283467.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=283467">Execute command line tool</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Swapan Das</div><div class="date">20th December 2007, 08:31</div></div><div class="posttext">Dear All,<br />
<br />
I want to execute certain sql query using sqlcmd command line tool. Please let me know how to execute the following command directly from nsis, without calling from a batch file and using nsExec::Exec<br />
<br />
SQLCMD -S . -E  -o Output1.Txt -Q &quot;ALTER LOGIN sa WITH PASSWORD= '',  CHECK_EXPIRATION=OFF, CHECK_POLICY=OFF&quot;<br />
<br />
<br />
Regards,<br />
Swapan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Swapan Das</div><div class="date">20th December 2007, 09:16</div></div><div class="posttext">Plz. note that the total command of SQLCMD is in a single line.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">wongbego</div><div class="date">20th December 2007, 11:59</div></div><div class="posttext">Hi,<br />
<br />
this is what I use to start Oracle SQLPlus with SQL commands in a SQL file and put all out put in the details.<br />
<br />
Perhaps it can help you.<br />
<br />
<br />
<br />
    SetOutPath &quot;$TEMP&quot;<br />
    File &quot;drop_schema_for_restore.sql&quot;<br />
    <br />
    #Exec the SQLPLUS command. Use drop database schema. <br />
    #$oracleSqlplus contains absolute path of the sqlplus.exe<br />
    nsExec::ExecToLog /OEM '&quot;$oracleSqlplus&quot; -L $oracleUserPassword &quot;@$TEMP\drop_schema_for_restore.sql&quot;'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Swapan Das</div><div class="date">20th December 2007, 14:32</div></div><div class="posttext">wongbego Thanks for the reply.<br />
But I don't want to use any external file (batch or sql query file) for this, any way out?<br />
<br />
Regards,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Swapan Das</div><div class="date">21st December 2007, 09:02</div></div><div class="posttext">Why the following is not working from command prompt (cmd.exe). The file does exists in the supplied path and the path is correct also.<br />
<br />
C:\Program Files\Microsoft SQL Server\90\Tools\Binn\SQLCMD.EXE<br />
<br />
It gives error:<br />
'C:\Program' is not recognized as an internal or external command, operable program or batch file.<br />
<br />
<br />
And in NSIS Script I've done this:<br />
  ReadRegStr $R1 HKLM &quot;SOFTWARE\Microsoft\Microsoft SQL Server\90\Tools\ClientSetup&quot; &quot;SQLPath&quot;<br />
<br />
  ReadRegStr $R2 HKLM &quot;SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName&quot; &quot;ComputerName&quot;<br />
   FileOpen &quot;$R0&quot; &quot;Login.txt&quot; &quot;w&quot;<br />
   FileWrite &quot;$R0&quot; &quot;ALTER LOGIN sa WITH PASSWORD= '',CHECK_EXPIRATION=OFF,CHECK_POLICY=OFF$\r$\n&quot;<br />
   FileClose &quot;$R0&quot;<br />
<br />
       nsExec::Exec &quot;cmd /C $R1\Binn\SQLCMD -S $R2\MYSSE -E -o LoginError.Log -i Login.txt&quot;<br />
<br />
(MYSSE is my sql express instance name which already exists)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">meaningoflights</div><div class="date">14th January 2008, 19:06</div></div><div class="posttext">I woke up this morning at 3:30am, couldn't sleep! My setup fails to execute the cmd file, just like yours!!!<br />
<br />
<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=182096&amp;highlight=nsExecExecToLog<br />
<br />
<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=276438&amp;highlight=nsExecExecToLog<br />
<br />
<br />
I just tried this and it didn't work 1st go. <br />
<br />
System::Call 'kernel32.dll::WinExec(t &quot;mysql.bat&quot;, i 0) i.r0'<br />
<br />
Let me know your results too mate? Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">14th January 2008, 19:18</div></div><div class="posttext">Swapan Das:<br />
<br />
'C:\Program' is not recognized &lt;&lt; space in filename, use doublequotes (&quot;) nsExec::Exec 'cmd.exe /c &quot;c:\foo space.exe&quot; /param'<br />
<br />
meaningoflights:<br />
AFAIK, WinExec just calls CreateProcess, so you might aswell use the Exec nsis command</div></div><hr />


<div class="post"><div class="posttop"><div class="username">meaningoflights</div><div class="date">14th January 2008, 19:30</div></div><div class="posttext">I'm trying to suss it. Getting a little bit further.<br />
<br />
From my findings it appears cmd.exe doesn't like the path specified with the cmd  file or enclosing the cmd file with quotes. See the 3 tests here:<br />
<br />
http://jeremythompson.net/Rocks/persoimages/pleasehelp.jpg <br />
<br />
<br />
How come Swapan &amp; I cant get the cmd file to execute, but everyone else can using a path to their cmd file with quotes (eg &quot;$TEMP\a.cmd&quot; or &quot;$INSTALLDIR\a.cmd&quot;) ???<br />
<br />
<br />
nsExec::ExecToLog 'cmd.exe /C &quot;$INSTDIR\CreateDatabase.cmd&quot; &quot;PCName\InstanceName&quot; &quot;DbName&quot; &quot;$INSTDIR\BackUpFile&quot;'<br />
<br />
<br />
Thanks in advance</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">14th January 2008, 20:59</div></div><div class="posttext">try <br />
cmd /C if 1==1 &quot;c:\somepath\foo.cmd&quot; &quot;bar&quot; &quot;baz&quot;<br />
<br />
or<br />
cmd /C &quot;&quot;c:\somepath\foo.cmd&quot; &quot;bar&quot; &quot;baz&quot;&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Swapan Das</div><div class="date">15th January 2008, 05:48</div></div><div class="posttext">Right now I'm not stucked with this issue. But after remaining clueless I had to take support of an external sql file which I didn't wished to do so. What I did and worked for me is given below:<br />
<br />
   ReadRegStr $R1 HKLM &quot;SOFTWARE\Microsoft\Microsoft SQL Server\90\Tools\ClientSetup&quot; &quot;SQLPath&quot;<br />
   FileOpen &quot;$R0&quot; &quot;AlterLoginPswd.sql&quot; &quot;w&quot;<br />
   FileWrite &quot;$R0&quot; &quot;ALTER LOGIN sa WITH PASSWORD= '',CHECK_EXPIRATION=OFF,CHECK_POLICY=OFF$\r$\n&quot;<br />
   FileClose &quot;$R0&quot;<br />
   ${If} ${FileExists} $R1\Binn\SQLCMD.EXE<br />
        Sleep 3000<br />
        nsExec::Exec '&quot;$PROGRAMFILES\Microsoft SQL Server\90\Tools\Binn\SQLCMD.EXE&quot; -S $DataBaseServerName -E -o AlterLogin.Log -i &quot;AlterLoginPswd.sql&quot;'<br />
        Sleep 3000<br />
   ${ELSE}<br />
       MessageBox MB_ICONEXCLAMATION|MB_OK &quot;SQLCMD.EXE not found at pre-defined path, trying to run from current path..&quot;<br />
        Sleep 3000<br />
       nsExec::Exec '&quot;SQLCMD.EXE&quot; -S $DatabaseServerName -E -o AlterLogin.Log -i &quot;AlterLoginPswd.sql&quot;'<br />
       Sleep 3000<br />
   ${Endif}<br />
<br />
Perhaps the &quot;Sleep&quot; is not required here. Let me know if it could've been done in more better and accurate way.<br />
<br />
Regards,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">meaningoflights</div><div class="date">15th January 2008, 07:33</div></div><div class="posttext">Anders, I cant thank you enough. <br />
<br />
I discovered the root cause, the cmd file did this: <br />
<br />
BAD:<br />
 sqlcmd -S &quot;%Instance%&quot; -b -v Database=&quot;%Database%&quot; SQLPath=&quot;&quot; BackUpPath=&quot;%BackUpPath%&quot; -i CreateDataBase.sql<br />
<br />
GOOD:<br />
sqlcmd -S &quot;%Instance%&quot; -b -v Database=&quot;%Database%&quot; SQLPath=&quot;&quot; BackUpPath=&quot;%BackUpPath%&quot; -i &quot;%SQLFilePath%&quot;<br />
<br />
Thanks again Anders.<br />
<br />
<br />
<br />
Swapan Das if your not right as rain, shout out. <br />
<br />
It was a pleasure to work with you guys on this issue.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Swapan Das</div><div class="date">24th January 2008, 06:54</div></div><div class="posttext">Then what exactly would be the one line command to execute :<br />
ALTER LOGIN sa WITH PASSWORD= '',CHECK_EXPIRATION=OFF,CHECK_POLICY=OFF<br />
<br />
with the help of SQLCMD and nsExec::Exec ?<br />
<br />
meaningoflights will be kind enough to pass the exact command so that I can straight way check it otherwise I'll stick to my method, which I've mentioned in my previous post.<br />
<br />
Regards,</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>