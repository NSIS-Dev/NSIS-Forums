<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Registry API plugin/function help, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Registry API plugin/function help NSIS Discussion" />
	
	<title> Registry API plugin/function help [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Registry API plugin/function help</div>
<hr />
<div class="pda"><a href="t-223031.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=223031">Registry API plugin/function help</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">31st July 2005, 23:54</div></div><div class="posttext">This thread started as a result of http://forums.winamp.com/showthread.php?s=&amp;threadid=218669<br />
<br />
I have an idea that I wanted to try to implement in my own function using API calls to Advapi32.dll based on info from MSDN (http://msdn.microsoft.com/library/default.asp?url=/library/en-us/sysinfo/base/registry_functions.asp).<br />
<br />
I'd like to use API calls instead of REGEDIT to import/export because of the fact that differnt versions REGEDIT export differently.  If I could use API calls, I could keep the process consistant without having to use a lot of OS checks.  (I'd also have more registry handling options available to me in case I needed to use them.)  Plus since I'm not well-versed in C++, I thought this might offer a simple solution<br />
<br />
However, this is where I'm having problems:<br />
I'm trying to call RegOpenKeyEx, but am having some problems. Here's what I got so far.  (I'm using Stardock an example just becuase it was something I had in my registry already):<br />
strcpy $3 &quot;SOFTWARE\Stardock&quot;<br />
System::Call 'Advapi32::RegOpenKeyEx(i 0x80000002,t r3,i 0,i 0xF003F,i .r1)i .r2'<br />
DetailPrint 'Result: $2'<br />
DetailPrint 'Handle: $1'<br />
<br />
I'm getting an error code 87 returned an no reg key handle.<br />
(FYI: The main hive handle values I found at the bottom of  this site (http://www.windowsitlibrary.com/Content/595/1.html).)<br />
<br />
I'm hoping that someone will be able to point me in the right direction.  (If I can figure out this function then I should be able to figure out the rest.<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">1st August 2005, 01:30</div></div><div class="posttext">From MSDN:<br />
<br />
Return Values<br />
If the function succeeds, the return value is ERROR_SUCCESS.<br />
<br />
If the function fails, the return value is a nonzero error code defined in Winerror.h. You can use the FormatMessage function with the FORMAT_MESSAGE_FROM_SYSTEM flag to get a generic description of the error.<br />
<br />
Assuming I'm looking at the right place in Winerror.h, this is what it says:<br />
<br />
//<br />
// MessageId: ERROR_INVALID_PARAMETER<br />
//<br />
// MessageText:<br />
//<br />
//  The parameter is incorrect.<br />
//<br />
#define ERROR_INVALID_PARAMETER          87L    // dderror<br />
<br />
<br />
EDIT: Correct me if I'm wrong, but if I read the System plug-in documentation correctly, you need to prefix a variable with an asterisk to use a pointer to it instead. I think that's your problem - the fifth parameter of the function should be a pointer to your variable.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">1st August 2005, 03:30</div></div><div class="posttext">Hey, thanks for the tip!  I'll give that a try.<br />
<br />
PS:  Where did you find WinError.h?  Is that included with the NSIS source code or is it somewhere else?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">1st August 2005, 04:13</div></div><div class="posttext">It's in MSDN. Search for it, it should be the first result you find. The full name of the page is &quot;Winerror.h [Protocol]&quot;.<br />
<br />
If you have a local copy of MSDN, you'll probably have most luck if you search online, my local installation of MSDN (from the VS2005 beta 2) doesn't find it - though that may be because I don't have the C/C++ of the beta installed, and therefore no C/C++ documentation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">1st August 2005, 06:33</div></div><div class="posttext">hmm... still no luck on getting the function call to work.  I'll try more tomorrow...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>