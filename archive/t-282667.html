<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Anyway to tidy this up?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Anyway to tidy this up? NSIS Discussion" />
	
	<title> Anyway to tidy this up? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Anyway to tidy this up?</div>
<hr />
<div class="pda"><a href="t-282667.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=282667">Anyway to tidy this up?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">5th December 2007, 06:16</div></div><div class="posttext">I think this works but it just doesn't look right the +3 0  look wrong<br />
<br />
!macro FileTrans DIR File<br />
IfFileExists &quot;$INSTDIR\${DIR}\${File}&quot; +3 0<br />
CreateDirectory &quot;$INSTDIR\${DIR}\&quot;<br />
CopyFiles /Silent &quot;$9${DIR}\${File}&quot; &quot;$INSTDIR\${DIR}\${File}&quot;<br />
!macroend<br />
<br />
Basically if the file exist it should skip create dir and copy file and carry on to the next !insertmacro FileTrans &quot;blah&quot; &quot;blah&quot;<br />
<br />
And obviously if the file doesn't exist it should copy the file from CD to the install dir<br />
<br />
But is the code right or wrong? If not do I use Logiclib.nsh and use ${if} and so on, something like this<br />
<br />
!macro FileTrans DIR File<br />
${If} ${FileExists} &quot;$INSTDIR\${DIR}\${File}&quot;<br />
???What goes here though??? <br />
${Else}<br />
CreateDirectory &quot;$INSTDIR\${DIR}\&quot;<br />
CopyFiles /Silent &quot;$9${DIR}\${File}&quot; &quot;$INSTDIR\${DIR}\${File}&quot;<br />
${EndIf}<br />
!macroend<br />
<br />
Would someone be willing to tidy the code up please to state if its right please<br />
<br />
Thank You</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">5th December 2007, 11:02</div></div><div class="posttext">you can leave it empty, but its probably better to flip the if and use ${Unless} instead of ${If}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">5th December 2007, 14:18</div></div><div class="posttext">That's doing the opposite of what I would like it to do<br />
<br />
That's saying because the file exist it creates a dir and copies the file<br />
<br />
I want it to see if the files exists, if it exists it skips copying the files from the CD to install dir<br />
<br />
<br />
I've just had another thought could I do this and how<br />
<br />
If the file exists in the folder<br />
copy the file to a backup folder<br />
but<br />
if the file doesn't exist in the folder<br />
copy the file from the cd to the folder<br />
<br />
How would I go about doing this, some visible code would be greatly appreciated not just a reference to the manual<br />
<br />
Thank you<br />
<br />
[Edit]<br />
<br />
This should work wont it?<br />
<br />
!macro FileTrans DIR File<br />
IfFileExists &quot;$INSTDIR\${DIR}\${File}&quot; 0 +3<br />
CreateDirectory &quot;$INSTDIR\${BackupDir}\${DIR}\&quot;<br />
CopyFiles /Silent &quot;$INSTDIR\${DIR}\${File}&quot; &quot;$INSTDIR\${BackupDir}\${DIR}\${File}&quot;<br />
${if} ${FileExists} &quot;$INSTDIR\${DIR}\${File}&quot;<br />
${Else}<br />
CreateDirectory &quot;$INSTDIR\${DIR}\&quot;<br />
CopyFiles /Silent &quot;$9${DIR}\${File}&quot; &quot;$INSTDIR\${DIR}\${File}&quot;<br />
${EndIf}<br />
!macroend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Rafik</div><div class="date">5th December 2007, 16:19</div></div><div class="posttext">Do just like Anders said before:<br />
<br />
${If} Something<br />
   A<br />
${Else}<br />
   B<br />
${EndIf}<br />
<br />
Can be also written as:<br />
<br />
${Unless} Something<br />
   B<br />
${Else}<br />
   A<br />
${EndUnless}<br />
<br />
Greets<br />
RafaÅ‚</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">5th December 2007, 17:22</div></div><div class="posttext">Ahh!!<br />
<br />
I had it<br />
<br />
${Unless} Something<br />
B<br />
${Else}<br />
A<br />
${EndIf}<br />
<br />
So I was wrong<br />
<br />
but This doesn't work the way I want it to either<br />
<br />
${Unless} Something<br />
B<br />
${Else}<br />
A<br />
${EndUnless}<br />
<br />
So I'm sticking with<br />
<br />
!macro FileTrans DIR File<br />
${if} ${FileExists} &quot;$INSTDIR\${DIR}\${File}&quot;<br />
${Else}<br />
CreateDirectory &quot;$INSTDIR\${DIR}\&quot;<br />
CopyFiles /Silent &quot;$9${DIR}\${File}&quot; &quot;$INSTDIR\${DIR}\${File}&quot;<br />
${EndIf}<br />
!macroend<br />
<br />
with the added addition of <br />
<br />
!macro FileTrans DIR File<br />
IfFileExists &quot;$INSTDIR\${DIR}\${File}&quot; 0 +3<br />
CreateDirectory &quot;$INSTDIR\${BackupDir}\${DIR}\&quot;<br />
CopyFiles /Silent &quot;$INSTDIR\${DIR}\${File}&quot; &quot;$INSTDIR\${BackupDir}\${DIR}\${File}&quot;<br />
${if} ${FileExists} &quot;$INSTDIR\${DIR}\${File}&quot;<br />
${Else}<br />
CreateDirectory &quot;$INSTDIR\${DIR}\&quot;<br />
CopyFiles /Silent &quot;$9${DIR}\${File}&quot; &quot;$INSTDIR\${DIR}\${File}&quot;<br />
${EndIf}<br />
!macroend<br />
<br />
I've tested it a few time now and it works for what I want it to do, which is<br />
<br />
If file exist<br />
copy file to backup<br />
if the file doesn't exist<br />
copy file from CD to install dir<br />
<br />
So what's the difference between ${Unless} and ${If} ?<br />
<br />
There is no explanation in the manual</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Rafik</div><div class="date">5th December 2007, 17:47</div></div><div class="posttext">Howdy again<br />
<br />
${Unless} means literally ${IfNot} but of course there is no ${IfNot} in logicLib, anyway logicLib is much better than assembler-like Gotos.<br />
<br />
You may rewrite your macro a bit, like following:<br />
<br />
!macro FileTrans DIR File<br />
   ${If} IfFileExists &quot;$INSTDIR\${DIR}\${File}&quot;<br />
      CreateDirectory &quot;$INSTDIR\${BackupDir}\${DIR}\&quot;<br />
      CopyFiles /Silent &quot;$INSTDIR\${DIR}\${File}&quot; &quot;$INSTDIR\${BackupDir}\${DIR}\${File}&quot;<br />
   ${Else}<br />
      CreateDirectory &quot;$INSTDIR\${DIR}\&quot;<br />
      CopyFiles /Silent &quot;$9${DIR}\${File}&quot; &quot;$INSTDIR\${DIR}\${File}&quot;<br />
   ${EndIf}<br />
!macroend<br />
<br />
or using ${Unless} other way around:<br />
<br />
!macro FileTrans DIR File<br />
   ${Unless} IfFileExists &quot;$INSTDIR\${DIR}\${File}&quot;<br />
      CreateDirectory &quot;$INSTDIR\${DIR}\&quot;<br />
      CopyFiles /Silent &quot;$9${DIR}\${File}&quot; &quot;$INSTDIR\${DIR}\${File}&quot;<br />
   ${Else}<br />
      CreateDirectory &quot;$INSTDIR\${BackupDir}\${DIR}\&quot;<br />
      CopyFiles /Silent &quot;$INSTDIR\${DIR}\${File}&quot; &quot;$INSTDIR\${BackupDir}\${DIR}\${File}&quot;<br />
   ${EndUnless}<br />
!macroend<br />
<br />
Hope I didn't mess anything :-)<br />
<br />
Greets<br />
RafaÅ‚</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">5th December 2007, 19:42</div></div><div class="posttext">Ok thanks I'll try both<br />
<br />
Thanks again<br />
<br />
Nope get an error<br />
<br />
!insertmacro: macro &quot;_If&quot; requires 4 parameter(s), passed 3!<br />
<br />
It'll be to do with this line<br />
<br />
${If} IfFileExists &quot;$INSTDIR\${DIR}\${File}&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th December 2007, 21:35</div></div><div class="posttext">IfFileExists is not a LogicLib macro, it's a built command. You are looking for ${FileExists}.!macro FileTrans DIR File<br />
${Unless} ${FileExists} &quot;$INSTDIR\${DIR}\${File}&quot;<br />
  CreateDirectory &quot;$INSTDIR\${DIR}&quot;<br />
  CopyFiles /Silent &quot;$9${DIR}\${File}&quot; &quot;$INSTDIR\${DIR}\${File}&quot;<br />
${EndIf}<br />
!macroend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">5th December 2007, 22:20</div></div><div class="posttext">Ok then is there a way to incorporate the highlighted part any better or is it ok as it is? It works as it should<br />
<br />
<br />
<br />
!macro FileTrans DIR FILE<br />
IfFileExists &quot;$INSTDIR\${DIR}\${FILE}&quot; 0 +3<br />
CreateDirectory &quot;$INSTDIR\${BACKDIR}\${DIR}\&quot;<br />
CopyFiles /Silent &quot;$INSTDIR\${DIR}\${FILE}&quot; &quot;$INSTDIR\${BACKDIR}\${DIR}\${FILE}&quot;<br />
${Unless} ${FileExists} &quot;$INSTDIR\${DIR}\${FILE}&quot;<br />
CreateDirectory &quot;$INSTDIR\${DIR}&quot;<br />
CopyFiles /Silent &quot;$9${DIR}\${FILE}&quot; &quot;$INSTDIR\${DIR}\${FILE}&quot;<br />
${EndIf}<br />
!macroend<br />
<br />
Thanks to both of you</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Rafik</div><div class="date">5th December 2007, 22:55</div></div><div class="posttext">Ok, this time without stupid mistakes:<br />
<br />
!macro FileTrans DIR File<br />
${If} ${FileExists} &quot;$INSTDIR\${DIR}\${File}&quot;<br />
CreateDirectory &quot;$INSTDIR\${BackupDir}\${DIR}\&quot;<br />
CopyFiles /Silent &quot;$INSTDIR\${DIR}\${File}&quot; &quot;$INSTDIR\${BackupDir}\${DIR}\${File}&quot;<br />
${Else}<br />
CreateDirectory &quot;$INSTDIR\${DIR}\&quot;<br />
CopyFiles /Silent &quot;$9${DIR}\${File}&quot; &quot;$INSTDIR\${DIR}\${File}&quot;<br />
${EndIf}<br />
!macroend<br />
<br />
or using ${Unless} other way around:<br />
<br />
!macro FileTrans DIR File<br />
${Unless} ${FileExists} &quot;$INSTDIR\${DIR}\${File}&quot;<br />
CreateDirectory &quot;$INSTDIR\${DIR}\&quot;<br />
CopyFiles /Silent &quot;$9${DIR}\${File}&quot; &quot;$INSTDIR\${DIR}\${File}&quot;<br />
${Else}<br />
CreateDirectory &quot;$INSTDIR\${BackupDir}\${DIR}\&quot;<br />
CopyFiles /Silent &quot;$INSTDIR\${DIR}\${File}&quot; &quot;$INSTDIR\${BackupDir}\${DIR}\${File}&quot;<br />
${EndUnless}<br />
!macroend<br />
<br />
Should work now. <br />
Greets RafaÅ‚</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>