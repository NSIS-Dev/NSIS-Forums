<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Is Read equiv to WriteRegExpandStr available?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Is Read equiv to WriteRegExpandStr available? NSIS Discussion" />
	
	<title> Is Read equiv to WriteRegExpandStr available? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Is Read equiv to WriteRegExpandStr available?</div>
<hr />
<div class="pda"><a href="t-228715.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=228715">Is Read equiv to WriteRegExpandStr available?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">l_d_allan</div><div class="date">18th October 2005, 18:26</div></div><div class="posttext">I'm trying to figure out how to invoke WordPad, which afaik isn't necessarily in the same place for older o/s.<br />
<br />
In the registry, it is associated with .wri files, so that seems like a way to get the full path to its executable:<br />
<br />
HKLM\SOFTWARE\Classes\SystemFileAssociations\.wri\open\command<br />
<br />
However, this is of type REG_EXPAND_SZ, and I don't see how to use the equivalent of ReadRegExpandStr. Is this available somehow or other?<br />
<br />
Is there a better way to do this? This seems pretty flawed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th October 2005, 21:14</div></div><div class="posttext">ReadRegStr can handle REG_EXPAND_SZ. You can then use ExpandEnvStrings to expand the strings in it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">l_d_allan</div><div class="date">19th October 2005, 14:06</div></div><div class="posttext">This seems to work ... but I'd appreciate feedback if this is a naive, flawed approach ... and whether there is a simpler, better solution. <br />
<br />
I'm assuming that all o/s install WordPad. It first tries \App Paths\WORDPAD.EXE, and if not found, tries the SystemFileAssociations\.wri<br />
<br />
(also, is there a &quot;trim&quot; or &quot;left&quot; function to remove any spaces at the end of a string? ... )<br />
<br />
<br />
Var WordPadExePath<br />
Var WordPadExePathLong<br />
Var WordPadExeExpPath<br />
<br />
Section /o &quot;Try WordPad (provide both full path)&quot;<br />
  ExecWait '&quot;$WordPadExeExpPath $INSTDIR\RtfExample.rtf&quot;'<br />
SectionEnd<br />
<br />
Function .onInit<br />
  ReadRegStr $WordPadExePath HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\WORDPAD.EXE&quot; &quot;&quot;<br />
  StrCmp $WordPadExePath &quot;&quot; TryWriAssociation WordPadExeResolved<br />
  TryWriAssociation:<br />
  ReadRegStr $WordPadExePathLong HKLM &quot;SOFTWARE\Classes\SystemFileAssociations\.wri\shell\open\command&quot; &quot;&quot;<br />
  StrCpy $WordPadExePath $WordPadExePathLong -5 # Has &quot;%1&quot; at end<br />
  WordPadExeResolved:<br />
  ExpandEnvStrings $WordPadExeExpPath $WordPadExePath<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th October 2005, 14:23</div></div><div class="posttext">Here is the code simplified:<br />
ReadRegStr $WordPadExePath HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\WORDPAD.EXE&quot; &quot;&quot;<br />
 StrCmp $WordPadExePath &quot;&quot; 0 GotWordPadPath<br />
<br />
  ReadRegStr $R1 HKLM &quot;SOFTWARE\Classes\SystemFileAssociations\.wri\shell\open\command&quot; &quot;&quot;<br />
  StrCpy $WordPadExePath $R1 -5 # Has &quot;%1&quot; at end<br />
<br />
GotWordPadPath:<br />
<br />
ExpandEnvStrings $WordPadExePath $WordPadExePath<br />
<br />
You really shouldn't create more global variables than necessary but use existing pre-defined variables where possible to save on memory on run-time. This now only uses $WordPadExePath.<br />
<br />
Rather than remove the %1 off the end with StrCpy you could use this function (http://nsis.sourceforge.net/wiki/GetInQuotes:_Get_string_from_between_quotes) which may be safer.<br />
Also, this function (http://nsis.sourceforge.net/wiki/Remove_leading_and_trailing_whitespaces_from_a_string) removes leading and trailing white space from strings.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th October 2005, 14:27</div></div><div class="posttext">ReadRegStr $WordPadExePath HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\WORDPAD.EXE&quot; &quot;&quot;<br />
 StrCmp $WordPadExePath &quot;&quot; 0 +2<br />
ReadRegStr $WordPadExePath HKLM &quot;SOFTWARE\Classes\SystemFileAssociations\.wri\shell\open\command&quot; &quot;&quot;<br />
<br />
ExpandEnvStrings $WordPadExePath $WordPadExePath<br />
<br />
Push $WordPadExePath<br />
 Call GetInQuotes<br />
Pop $WordPadExePath<br />
<br />
<br />
This code uses GetInQuotes. You won't need to trim anything after using this.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">l_d_allan</div><div class="date">19th October 2005, 16:02</div></div><div class="posttext">Thanks for the links.<br />
<br />
You really shouldn't create more global variables than necessary but use existing pre-defined variables where possible to save on memory on run-time. This now only uses $WordPadExePath. <br />
<br />
Not meaning to be unappreciative or argumentative, but I was curious how much difference this made. My tendency is to be VERY verbose, and the use of $0, $1, $R0, and $R1 has always struck me as very &quot;old school&quot; from the Fortran days.<br />
<br />
Anyway, I did a &quot;before&quot; and &quot;after&quot;. Memory usage of an application is hardly an &quot;exact science&quot;, but my impression is that you can get a pretty good idea by watching the TaskManager while minimizing the app, then restoring it. This &quot;strips&quot; off the common dll's and is closer to your actual &quot;working set&quot;.<br />
<br />
Verbose: 36,692 bytes. Memory usage started at 1042kb and grew to 2960kb as the installer progressed (sections left unchecked)<br />
<br />
Concise: 37,676 bytes. Memory usage started at 1048kb and grew to 2980kb as the installer progressed (sections left unchecked)<br />
<br />
I would be the first to acknowledge that I am not at all an nsis expert, and these measurements may be naive or inaccurate (YMMV ... your milage may vary).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">19th October 2005, 17:09</div></div><div class="posttext">My tendency is to be VERY verbose, and the use of $0, $1, $R0, and $R1 has always struck me as very &quot;old school&quot; from the Fortran days. <br />
<br />
What you can do is !define more verbose names for the default variables.<br />
e.g.,<br />
<br />
!define MY_DESCRIPTIVE_VARIABLE_NAME $R0<br />
<br />
Then use ${DESCRIPTIVE_VARIABLE_NAME} whenever you need $R0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th October 2005, 19:35</div></div><div class="posttext">With the default options, each variable uses an extra 1KB of memory.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">25th October 2005, 11:32</div></div><div class="posttext">Just a small side remark Not all O/S need to have wordpad. In e.g .W98 You can select small install, or individually select NOT to install workpad. Ik know it is a little nitpicking fro my side but you asked, all OS's, the answer is no.<br />
<br />
an alternative idea for you to create a filedisplayer with NSIS and have this in the temp folder to display your texts.<br />
<br />
If your software is for an expected targetgoup of you it not so important, but as soon as your release software &quot;in the wild&quot; it is the best strategy NOT to relay on anything on the customers PC exept the basic OS.<br />
<br />
A good way to test is to buy a old e.g. 300Mhz PIII with 64 MB PC and use this as sole test PC.<br />
<br />
With e.g. Diskmagic put back the Clean OS fileimage of choice after every testruns.<br />
<br />
A virtual machine is also possible but less representative.<br />
<br />
Success.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nsismonk</div><div class="date">25th October 2005, 14:17</div></div><div class="posttext">Equivalent of Wordpad.exe in older versions of windows is Write.exe (hence the extension .wri), and IIRC it's been available since windows 3.0.<br />
<br />
But I suggest you invoke &quot;explorer.exe somedoc.wri&quot; to open it, so leave it to windows shell to figure out how to open a file.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>