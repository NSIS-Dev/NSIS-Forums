<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" JVM detection routine?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  JVM detection routine? NSIS Discussion" />
	
	<title> JVM detection routine? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  JVM detection routine?</div>
<hr />
<div class="pda"><a href="t-74166.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=74166">JVM detection routine?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">ctran@yahoo.com</div><div class="date">1st February 2002, 21:46</div></div><div class="posttext">Anyone willing to share a jvm detection/prompt routine?  I use the one by Tomcat team but that doesn't work in all cases.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DarkLord23</div><div class="date">19th February 2002, 13:47</div></div><div class="posttext">up i'm interested!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">spaetz</div><div class="date">20th February 2002, 15:36</div></div><div class="posttext">This is what I use, if there are additional/improved version I'd be highly interested as well...<br />
<br />
Function DetectJava<br />
# this function detects Sun Java from registry and calls the JavaFind utility otherwise<br />
<br />
  # This is the first time we run the JavaFind<br />
  StrCpy $5 &quot;No&quot;<br />
<br />
StartCheck:<br />
  # First get the installed version (if any) in $2<br />
  # then get the path in $6<br />
<br />
  StrCpy $0 &quot;SOFTWARE\JavaSoft\Java Runtime Environment&quot;<br />
  # Get JRE installed version<br />
  ReadRegStr $2 HKLM $0 &quot;CurrentVersion&quot;<br />
  StrCmp $2 &quot;&quot; DetectTry2<br />
<br />
  # Get JRE path<br />
  ReadRegStr $6 HKLM &quot;$0\$2&quot; &quot;JavaHome&quot;<br />
  StrCmp $6 &quot;&quot; DetectTry2<br />
  <br />
  #We seem to have a JRE now<br />
  Goto GetJRE<br />
  <br />
 DetectTry2:<br />
  # we did not get a JRE, but there might be a SDK installed<br />
  StrCpy $0 &quot;Software\JavaSoft\Java Development Kit&quot;<br />
  # Get JRE installed version<br />
  ReadRegStr $2 HKLM $0 &quot;CurrentVersion&quot;<br />
  StrCmp $2 &quot;&quot; RunJavaFind<br />
<br />
  # Get JRE path<br />
  ReadRegStr $6 HKLM &quot;$0\$2&quot; &quot;JavaHome&quot;<br />
  StrCmp $6 &quot;&quot; RunJavaFind<br />
  <br />
 GetJRE:<br />
  StrCpy $3 &quot;$6\bin\java.exe&quot;<br />
  StrCpy $4 &quot;$6\bin\javaw.exe&quot;<br />
<br />
  # Check if files exists and write paths<br />
  IfFileExists $3 0 RunJavaFind<br />
  WriteINIStr &quot;$INSTDIR\FLaunch.ini&quot; &quot;Freenet Launcher&quot; &quot;JavaExec&quot; $3<br />
  IfFileExists $4 0 RunJavaFind<br />
  WriteINIStr &quot;$INSTDIR\FLaunch.ini&quot; &quot;Freenet Launcher&quot; &quot;Javaw&quot; $4<br />
<br />
  # Jump to the end if we did the Java recognition correctly<br />
  Goto End<br />
<br />
 RunJavaFind:<br />
 <br />
  !ifdef embedJava<br />
    # Install Java runtime only if not found<br />
    DetailPrint &quot;Lauching Sun's Java Runtime Environment installation...&quot;<br />
    SetOutPath &quot;$TEMP&quot;<br />
    File ${JAVAINSTALLER}<br />
    ExecWait &quot;$TEMP\${JAVAINSTALLER}&quot;<br />
    Delete &quot;$TEMP\${JAVAINSTALLER}&quot;<br />
    Goto StartCheck<br />
 !else<br />
  # opening download page<br />
  MessageBox MB_YESNO &quot;I did not find Sun's Java Runtime Environment which is needed for Freenet.$\r$\nHit 'Yes' to open the download page for Java (http://java.sun.com),$\r$\n'No' to cancel the installation.&quot; IDYES GetJava<br />
  Abort<br />
  <br />
 GetJava:<br />
  # Open the download page for Sun's Java<br />
  ExecShell &quot;open&quot; &quot;http://javasoft.com/&quot;<br />
  Sleep 5000<br />
  MessageBox MB_OKCANCEL &quot;Press OK to continue the Freenet installation AFTER having installed Java,$\r$\nCANCEL to abort the installation.&quot; IDOK StartCheck<br />
  Abort<br />
!endif<br />
<br />
 AbortJava:<br />
  MessageBox MB_OK|MB_ICONSTOP &quot;I still can't find any Java interpreter. Did you really installed the JRE?$\r$\nInstallation will now stop.&quot;<br />
  Abort<br />
  <br />
End:<br />
  # Restore $0, $2, $5 and $6<br />
  Pop $6<br />
  Pop $5<br />
  Pop $2<br />
  Pop $0<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">remm</div><div class="date">24th February 2002, 18:49</div></div><div class="posttext">I got a *lot* of feedback on that subject, and although auto-detecting with the registry is quite nice, many people want to specify the JDK to use using a JAVA_HOME env variable.<br />
<br />
Also, many JDKs don't set the normal keys, so it creates lots of problems to rely only on the registry.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">irun5k</div><div class="date">13th May 2003, 05:20</div></div><div class="posttext">Seems like the best way to do this is to have a screen similar to InstallAnywhere that lists all detected JVMs (from registry) and then gives the option for a more advanced JVM search for &quot;orphaned&quot; JVMs, which are common on developer machines... just the /jre file system with no registry entries.<br />
<br />
I'm game for trying to write such a component but I've only last week written my first short NSIS install script so I'd probably need some guidance to get me going.  I'm assuming such a component can be written an &quot;plugged in&quot;, right?<br />
<br />
Anybody interested in helping me give this a shot?  NSIS, with such a feature, would have to be the absolute preferred way of all time to install Java apps on Win32.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">13th May 2003, 09:15</div></div><div class="posttext">Sure, plugins are easy to write and there are example plugins in the NSIS/Contrib directory. ExDLL is the directory containing the basic template for a plugin (examples given in Delphi and C code). I'm not that sure how easy it is to show your own window from a plugin but I'm pretty sure it can be done (I think the NSISUpdate program does it).<br />
<br />
Thing is I think you could write this without a plugin, just a script that checks for registry entries and maybe scan the disk and then uses an InstallOptions page to show the results.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">irun5k</div><div class="date">13th May 2003, 15:04</div></div><div class="posttext">Thanks for the input- after some review I think you are probably right- this can probably be done more easily and made equally as reusable with InstallOptions which I will dive into now.  <br />
<br />
I'm sure I'll be back at some point with some questions.<br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th May 2003, 11:00</div></div><div class="posttext">You can save some time if you use LangDLL. LangDLL doesn't really care if you give it a language id or the path to Java. If you don't like the dialog showing as a combobox you can just change the resources and recompile.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pcristip</div><div class="date">15th May 2003, 08:18</div></div><div class="posttext">Check the nsis archive<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=162&amp;instances=0,110<br />
<br />
Chris</div></div><hr />


<div class="post"><div class="posttop"><div class="username">irun5k</div><div class="date">15th May 2003, 13:58</div></div><div class="posttext">Okay,<br />
<br />
Now that I've gotten into this, I don't think I can accomplish what I wanted with what I have available.<br />
<br />
The screen below gives three functions- <br />
<br />
1. auto detected JVMs, presumably from the registry and perhaps a java.exe in the system path.<br />
<br />
2. user requestable more intesive auto-discovery.  This involves browsing the file system for other JVMs.  An extra step here is to pull back the version from the JVM when it is found.  There may be a way to check a .dll, but if all else failed, one could exec &quot;java.exe -version&quot; and capture the system out.<br />
<br />
3. faster, direct discovery.  Let the user point you right at a JRE or JDK directory via a file chooser if they know where it is and save themselves the misery of waiting for the entire file system to be scanned.  Again, in this case the version needs to be extacted from the JDK they specified.<br />
<br />
This seems like more that could be done with the basic script or InstallOptions.<br />
<br />
    http://b-gallery******shot.jpg</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>