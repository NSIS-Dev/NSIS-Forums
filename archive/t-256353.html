<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Read In two differnt files, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Read In two differnt files NSIS Discussion" />
	
	<title> Read In two differnt files [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Read In two differnt files</div>
<hr />
<div class="pda"><a href="t-256353.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=256353">Read In two differnt files</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">solwolf</div><div class="date">27th September 2006, 22:46</div></div><div class="posttext">I am needing the ReadFileLine to be able to handle 2 differnt txt files.  if this helps both files will be the same length (same amount of lines) and i need to read in one line from one files and then read on the same line of the other one so that i can compare them.<br />
<br />
*******Visual Example*******<br />
<br />
textfile1.txt            <br />
 someextrafile.exe<br />
 temp/somefile.exe<br />
 home/picture.jpg<br />
 <br />
<br />
<br />
textfile2.txt <br />
 someextrafile.exe<br />
 temp\somefile.exe<br />
 home\picture.jpg<br />
 <br />
<br />
need that so i can link to a webpage with one and also know the structure on the windows machine.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">solwolf</div><div class="date">28th September 2006, 01:04</div></div><div class="posttext">ok so i rewrote the function ReadFileLine to accept 2 differnt files.  See Attachment for Function ReWrite <br />
<br />
Usage for the file:<br />
<br />
StrCpy &quot;5&quot; $R0; set the length of files<br />
StrCpy $1 0;reset the linecount<br />
<br />
Loop:<br />
Intop $1 $1 + 1   ;Sets line number to be read below<br />
StrCmp $1 $R0 End ;End of File<br />
	<br />
Push $1 ;line number to read from<br />
Push &quot;text1.txt&quot; ;First text file to read<br />
Push &quot;text2.txt&quot; ;2nd text file to read<br />
Call ReadFileLine2<br />
Pop $0 ;output from file 2<br />
Pop $1 ;Output from file 1<br />
  ;;;Put some code of your own here;;;<br />
Goto Loop<br />
<br />
<br />
Hope this helps someone out there.  if it was aready written somewhere else sorry i couldn't find it.<br />
<br />
-Solwolf</div></div><hr />


<div class="post"><div class="posttop"><div class="username">solwolf</div><div class="date">28th September 2006, 01:09</div></div><div class="posttext">Can anyone see why this would continue to repeat these 3 lines : <br />
&quot;hope it gets here&quot;<br />
&quot;file.exe TimeStamp 1&quot;<br />
&quot;file.exe TimeStamp 2&quot;<br />
(note no print out after Timestamp1 or 2)<br />
***$R4 prints out C:\myProgram\temp\file.exe****<br />
<br />
<br />
StrCpy $R4 $EXEDIR$0 ;String 2 output<br />
IfFileExists $R4 0 +2<br />
MessageBox MB_OK|MB_ICONINFORMATION &quot;hope not here&quot;<br />
;Goto Loop<br />
MessageBox MB_OK|MB_ICONINFORMATION &quot;hope it gets here&quot;<br />
<br />
GetFileTime &quot;$R4&quot; $R5 $R6<br />
MessageBox MB_OK|MB_ICONINFORMATION &quot;$R4 TimeStamp 1 $R5&quot;<br />
MessageBox MB_OK|MB_ICONINFORMATION &quot;$R4 TimeStamp 2 $R6&quot;<br />
		<br />
Goto Loop</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dandaman32</div><div class="date">28th September 2006, 03:23</div></div><div class="posttext">Note: I'm on the terminal server right now, which is Linux, so I don't have access to the NSIS manual, and I always forget which order the parameters go in FileRead. Sorry. If this code doesn't work, try swapping the variables in both FileRead commands.<br />
<br />
FileOpen $0 &quot;$INSTDIR\path\to\File 1&quot; r<br />
FileOpen $1 &quot;$INSTDIR\path\to\File 2&quot; r<br />
loop:<br />
  ClearErrors<br />
  FileRead $2 $0<br />
  IfErrors done<br />
  FileRead $3 $1<br />
  IfErrors done<br />
  StrCmp $2 $3 Match NoMatch<br />
  Match:<br />
    ; Code to run if both lines are the same<br />
    Goto loop<br />
  NoMatch:<br />
    ; Code to run if the lines are different<br />
    Goto loop<br />
done:<br />
FileClose $1<br />
FileClose $0<br />
<br />
-dandaman32</div></div><hr />


<div class="post"><div class="posttop"><div class="username">solwolf</div><div class="date">28th September 2006, 04:23</div></div><div class="posttext">yeah that seems like another way to pull 2 different files but that wasn't my problem.... <br />
<br />
my problem was that i Had<br />
<br />
<br />
StrCpy &quot;5&quot; $R0; set the length of files<br />
StrCpy $1 0;reset the linecount<br />
<br />
Loop:<br />
Intop $1 $1 + 1   ;Sets line number to be read below<br />
StrCmp $1 $R0 End ;End of File<br />
	<br />
Push $1 ;line number to read from<br />
Push &quot;text1.txt&quot; ;First text file to read<br />
Push &quot;text2.txt&quot; ;2nd text file to read<br />
Call ReadFileLine2<br />
Pop $0 ;output from file 2<br />
Pop $1 ;Output from file 1<br />
<br />
StrCpy $R3 $1 12 -12 ;outputs timestamp from file 1<br />
StrCpy $R4 $EXEDIR$0 ;String 2 output<br />
IfFileExists $R4 0 +2<br />
MessageBox MB_OK|MB_ICONINFORMATION &quot;hope not here&quot;<br />
;Goto Loop<br />
MessageBox MB_OK|MB_ICONINFORMATION &quot;hope it gets here&quot;<br />
<br />
GetFileTime &quot;$R4&quot; $R5 $R6<br />
MessageBox MB_OK|MB_ICONINFORMATION &quot;$R4 TimeStamp 1 $R5&quot;<br />
MessageBox MB_OK|MB_ICONINFORMATION &quot;$R4 TimeStamp 2 $R6&quot;<br />
		<br />
Goto Loop<br />
<br />
<br />
i set little msgboxes through out the program to see if i was getting the right files and such. (which all returned what i was wanting them to) File two outputs a windows formated directory and File one has the Http version of the file and the timestamp from the most recent file.<br />
<br />
so i attach it to the exedir and get the absolute path to that file on the computer and i run iffileexsists before i do anything with it cause if it isn't there then i just download a new one.  if it is there then i compare the timestamp of that file that is located on their computer.  if different then i download a new one.  <br />
<br />
**but before i started putting in download statments i just poped up messages which didn't display anything for the timestamp.  and it was looping infinitly through the iffileexsists section (see post #3 above)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">solwolf</div><div class="date">29th September 2006, 16:24</div></div><div class="posttext">if this helps any this is what is going on in my program and once i toss in a display after my inetload it is saying &quot;File Open Error&quot; i tried looking through the stack and i was getting OK being stored in stack so i thought it was from the inets above (which work!) so i just poped off the variable each time i called it but it still sticks on first file.  if you need to see what the variables are printing out just leave a post i can toss in a few boxes and print out here what it is saying i really need to work so i can get back to tweaking my game.<br />
<br />
<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
;;;;;;;;;;;;;Functions ;;;;;;;;;;;;;<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
Function LineSum<br />
 Start:<br />
  Exch $0<br />
  Push $1<br />
  Push $2<br />
  ClearErrors<br />
  IfFileExists $0 0 Error<br />
  StrCpy $2 0<br />
  FileOpen $0 $0 r<br />
  IfErrors Error<br />
  FileRead $0 $1<br />
  IfErrors +3<br />
  IntOp $2 $2 + 1<br />
  Goto -3<br />
  FileClose $0<br />
  StrCpy $0 $2<br />
  Goto End<br />
Error:<br />
  SetErrors<br />
  StrCpy $0 ''<br />
End:<br />
  Pop $2<br />
  Pop $1<br />
  Exch $0<br />
FunctionEnd<br />
<br />
Function ReadFileLine2<br />
 Intialize:<br />
   Exch $0 ;file<br />
   Exch<br />
   Exch $1 ;file 2<br />
   Exch 2<br />
   Exch $2<br />
   Push $3<br />
   Push $4<br />
   Push $5<br />
Open:	<br />
   FileOpen $3 $0 r<br />
   FileOpen $4 $1 r<br />
   StrCpy $5 0<br />
Loop:<br />
   IntOp $5 $5 + 1<br />
   ClearErrors<br />
   FileRead $3 $0<br />
   FileRead $4 $1<br />
   IfErrors +2<br />
   StrCmp $5 $2 0 Loop<br />
   FileClose $3<br />
   FileClose $4<br />
End:<br />
   Pop $5<br />
   Pop $4<br />
   Pop $3<br />
   Pop $2<br />
   Exch $1<br />
   Exch<br />
   Exch $0<br />
FunctionEnd<br />
<br />
Function ConnectInternet<br />
 Start:<br />
   Push $R0<br />
   ClearErrors<br />
 Check:  <br />
   Dialer::AttemptConnect<br />
   IfErrors NoIE3<br />
   Pop $R0<br />
   StrCmp $R0 &quot;online&quot; Connected<br />
   MessageBox MB_OK|MB_ICONSTOP &quot;Cannot connect to the internet.&quot;<br />
   Quit <br />
 NoIE3:  <br />
   MessageBox MB_OK|MB_ICONINFORMATION &quot;Please connect to the internet now.&quot;<br />
 Connected:<br />
   Pop $R0<br />
FunctionEnd<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
;;;;;;;;;;;;;Sections ;;;;;;;;;;;;;;;;;;;;<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
<br />
Section<br />
 CheckForGame:<br />
   IfFileExists &quot;$EXEDIR\game.exe&quot; CheckConnection EoF<br />
 CheckConnection:<br />
   Call ConnectInternet<br />
 GetNewIni:<br />
    InetLoad::load &quot;http://www.awebsitethatdoesntexsist.com/game/update.ini&quot; &quot;$EXEDIR\update.ini&quot;<br />
    Pop $0<br />
    InetLoad::load &quot;http://www.awebsitethatdoesntexsist.com/game/winupdate.ini&quot; &quot;$EXEDIR\winupdate.ini&quot;<br />
    Pop $0<br />
 GetTotalLines:<br />
    Push &quot;update.ini&quot;<br />
    Call LineSum<br />
    Pop $R0 ;line count of file<br />
 ResetCounter:<br />
    StrCpy $1 0<br />
 NextLine:<br />
    IntOp $1 $1 + 1   ;increment Count<br />
    StrCmp $1 $R0 EoF <br />
    Push $1 ;line # from counter<br />
    Push &quot;update.ini&quot; ;file 1<br />
    Push &quot;winupdate.ini&quot; ;file 2<br />
    Call ReadFileLine2<br />
    Pop $0 ;output from file 1<br />
    Pop $1 ;Output from file 2<br />
    StrCpy $R2 $1 12 -12 ;Newest Timestamp<br />
    StrCpy $R3 $1 -13 ;http format<br />
    StrCpy $R4 $EXEDIR$0 ;windows format<br />
 CheckForFile:	<br />
    IfFileExists $R4 ValidateFile NoFileFound<br />
 NoFileFound:<br />
    InetLoad::load /popup &quot;http://www.awebsitethatdoesntexsist.com/game/$R3&quot; &quot;$R4&quot; /END<br />
    Pop $0<br />
    StrCmp $0 &quot;OK&quot; DownloadOk<br />
    MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Download Error, click OK to abort installation - $0&quot; /SD IDOK<br />
    Abort<br />
 DownloadOk:<br />
    Goto NextLine<br />
 ValidateFile:			<br />
    GetFileTime &quot;$R4&quot; $R5 $R6<br />
    MessageBox MB_OK|MB_ICONINFORMATION &quot;$R4 TimeStamp 1 $R5&quot;<br />
    MessageBox MB_OK|MB_ICONINFORMATION &quot;$R4 TimeStamp 2 $R6&quot;<br />
    Goto NextLine<br />
 EoF:<br />
    Exec &quot;$EXEDIR\game.exe&quot;<br />
    Delete &quot;$EXEDIR\update.ini&quot;<br />
    Delete &quot;$EXEDIR\winupdate.ini&quot;<br />
    Quit<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th September 2006, 17:27</div></div><div class="posttext">Check the value of $R4 with a MessageBox.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">solwolf</div><div class="date">29th September 2006, 17:37</div></div><div class="posttext">Right before &quot;CheckForFile:&quot; $R4 it has C:\my Program\game\game.exe<br />
<br />
<br />
$R3 has just plain game.exe<br />
**which is what it should be.<br />
<br />
*** I also check it after inetload to see if for somereason they were getting cleared in teh process and they still had their values as expected</div></div><hr />


<div class="post"><div class="posttop"><div class="username">solwolf</div><div class="date">29th September 2006, 17:39</div></div><div class="posttext">and $R3 is just plain game.exe<br />
<br />
**Note i tried deleteing this post<br />
 but didn't have rights to.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th September 2006, 18:26</div></div><div class="posttext">Make sure the folder &quot;C:\my Program\game&quot; is present so that files can be written into the folder.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">solwolf</div><div class="date">29th September 2006, 18:46</div></div><div class="posttext">yeah they are present because i am using the $EXEDIR<br />
<br />
StrCpy $R4 $EXEDIR$0 ;windows format</div></div><hr />


<div class="post"><div class="posttop"><div class="username">solwolf</div><div class="date">29th September 2006, 18:59</div></div><div class="posttext">really don't know why this would be the problem but i ran another message box and i did XXXXXXX$R4'XXXXXXXXX' and it kicked the last Xs to the next line denoting a space afterwords so i went and hard coded it and it would download so it is diffently the destination directory.<br />
**i hard coded $EXEDIR\game.exe<br />
<br />
this is my line in the ini file that i pull from and parse:<br />
game.exe 1159226184 (no space after the timestamp)<br />
and i use this line of code to parse just the file:<br />
StrCpy $R3 $1 -13<br />
<br />
IS that the reason why i am getting a space because i only count 10 places of numbers and 1 space after exe so i guess maybe i should put -11 playing with the numbers now....<br />
<br />
-Solwolf</div></div><hr />


<div class="post"><div class="posttop"><div class="username">solwolf</div><div class="date">29th September 2006, 19:01</div></div><div class="posttext">maybe if there was a trim function i could just use that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">solwolf</div><div class="date">29th September 2006, 21:11</div></div><div class="posttext">Success!<br />
<br />
<br />
   StrCpy $R2 $1 12 -12 ;Newest Timestamp<br />
   StrCpy $R3 $1 -13 ;http format<br />
   StrCpy $R4 $EXEDIR$0 ;windows format<br />
<br />
<br />
and once i played with them awhile i figured out that this code was trimming all the space except the timestamp one<br />
<br />
<br />
   StrCpy $2 $1 12 -12  ;Newest Timestamp with spaces at end<br />
   StrCpy $R2 $2 -2 ;filtered spaces for timestamp<br />
   StrCpy $R3 $1 -13 ;http format<br />
   StrCpy $R4 $EXEDIR$0 -2 ;windows format<br />
<br />
<br />
And now it works!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>