<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Why does RMDir /r fail to delete folder?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Why does RMDir /r fail to delete folder? NSIS Discussion" />
	
	<title> Why does RMDir /r fail to delete folder? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Why does RMDir /r fail to delete folder?</div>
<hr />
<div class="pda"><a href="t-328577.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=328577">Why does RMDir /r fail to delete folder?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">nsnb</div><div class="date">17th March 2011, 18:22</div></div><div class="posttext">I am either getting senile or stupider by the moment, or both. For the life of me, I can't figure out why the following doesn't succeed:<br />
<br />
SetOutPath $DESKTOP 	; deflect current working directory from RMDir target<br />
RMDir /r  '&quot;C:\Documents and Settings\Admin\Application Data\My App&quot;'<br />
<br />
<br />
True, &quot;C:\Documents and Settings\Admin\Application Data\My App&quot; is not empty, but I thought that's what /r is for.<br />
<br />
What others reason could explain that?<br />
<br />
(I am using NSIS 2.45 on Windows XP SP3.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">17th March 2011, 18:45</div></div><div class="posttext">Try FileMon or Process Monitor and see what the error is...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nsnb</div><div class="date">17th March 2011, 18:56</div></div><div class="posttext">Thanks! I just tried FileMon and the only failure reported is:<br />
<br />
1:51:24 PM	svchost.exe:1052	OPEN	C:\WINDOWS\Prefetch\CLEANMYAPPDIR-SETUP.EXE-0E4B9029.pf	FILE NOT FOUND	Options: Open  Access: All<br />
	<br />
<br />
I am trying to use 'RMDir /r' in an install section and this is where it fails.<br />
<br />
Same exact instructions in '-un.post' section succeed.<br />
<br />
Could that be related?<br />
If so, how?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nsnb</div><div class="date">17th March 2011, 19:32</div></div><div class="posttext">Interesting. When I replace<br />
RMDir /r '&quot;C:\Documents and Settings\Admin\Application Data\My App&quot;' <br />
<br />
With:<br />
  ReadEnvStr $varCOMSPEC COMSPEC<br />
  nsExec::Exec '&quot;$varCOMSPEC&quot; /C rmdir /Q /S &quot;C:\Documents and Settings\Admin\Application Data\My App&quot;'<br />
<br />
It works.<br />
<br />
This is baffling.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">17th March 2011, 19:34</div></div><div class="posttext">There has to be more filemon output than just the prefetch line, your filter could be wrong, try just *. But, I'm guessing your problem is actually the quotes, just use RMDir /R &quot;c:\path&quot;, you don't need to pack the double quotes in single quotes...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nsnb</div><div class="date">17th March 2011, 19:49</div></div><div class="posttext">Anders, you are king. You were right in both:<br />
<br />
1. The single quotes posed a problem (I tried without them before, but being confused I panicked, added them and forgot to removed them).<br />
<br />
2. The FileMon filter that I specified didn't take into account the truncation of the process name and so it filtered too much.<br />
<br />
It turns out that there was a process running in that folder that I was trying to delete. The nsExec version succeeded because I took care of existing the process beforehand. Once I did the same for NSIS's RmDir and used only one set of quotes, the operation succeeded.<br />
<br />
Thank you Anders!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">17th March 2011, 21:51</div></div><div class="posttext">For future reference, when you execute something you should pack the whole command line in single quotes with the application (and any other path that can contain spaces in double quotes): '&quot;c:\some path\myapp.exe&quot; /param' and you do this because of the &quot;c:\Program.exe&quot; vs &quot;c:\Program Files\foo.exe&quot; problem (Get this wrong and &quot;c:\Program.exe&quot; gets executed with &quot;Files\foo.exe&quot; as its parameter, this is also a security problem)<br />
<br />
Instructions that only take a single path don't have this problem...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>