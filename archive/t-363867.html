<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to work with ntfs streams, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to work with ntfs streams NSIS Discussion" />
	
	<title> How to work with ntfs streams [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to work with ntfs streams</div>
<hr />
<div class="pda"><a href="t-363867.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=363867">How to work with ntfs streams</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Nothuman</div><div class="date">15th June 2013, 08:09</div></div><div class="posttext">Hello everyone. Can you help me with NTFS-streams in NSIS, please? I can't understand how to write something in the stream.<br />
<br />
!macro CreateNtfsStream sHandle sPath sName<br />
  System::Call 'Kernel32::CreateFile(t, i, i, i, i, i, i) i (&quot;${sPath}:${sName}&quot;, 0xC0000000, 7, 0, 2, 0x80, 0) .s'<br />
   Pop ${sHandle} <br />
!macroend <br />
!define CreateNtfsStream &quot;!insertmacro CreateNtfsStream&quot;<br />
<br />
!macro WriteNtfsStream sHandle sPath sName sText<br />
  ...<br />
!macroend<br />
!define WriteNtfsStream &quot;!insertmacro WriteNtfsStream&quot;<br />
<br />
!macro DeleteNtfsStream sHandle sPath sName<br />
  Push '${sPath}:${sName}'<br />
   System::Call 'Kernel32::DeleteFile((t) i (s)) .s'<br />
    Pop ${sHandle}<br />
!macroend<br />
!define DeleteNtfsStream &quot;!insertmacro DeleteNtfsStream&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">15th June 2013, 22:33</div></div><div class="posttext">Once you have a handle you can just write to it with WriteFile, you probably don't even need the system plugin to open or delete, just use the normal instructions.<br />
<br />
That syntax for delete looks wrong, it is Kernel32::DeleteFile(t)i AKA Kernel32::DeleteFile(ts)i.s and it returns != 0 on success, not a handle...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Nothuman</div><div class="date">17th June 2013, 17:03</div></div><div class="posttext">Thanks for the reply.<br />
<br />
you can just write to it with WriteFile<br />
I tried, but i'm newbie in NSIS coding, and i cant write correct code syntax. That's why I ask for help.<br />
<br />
Kernel32::DeleteFile(ts)i.s and it returns != 0 on success, not a handle...<br />
It's just a variable name, but I'll keep that in my mind ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">18th June 2013, 16:15</div></div><div class="posttext">I tried, but i'm newbie in NSIS coding, and i cant write correct code syntax. That's why I ask for help.<br />
<br />
The manual has code examples for most commands:<br />
http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.5.8</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Nothuman</div><div class="date">18th June 2013, 18:33</div></div><div class="posttext">MSG, i will tried use FileWrite function. She is not able to record the stream.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Nothuman</div><div class="date">19th June 2013, 15:56</div></div><div class="posttext">MSG, thanks for reminding me about that. I tried again, but differently way:<br />
!macro WriteNtfsStream sOutput sPath sName sValue<br />
  System::Call 'Kernel32::CreateFile(t, i, i, i, i, i, i) i (&quot;${sPath}:${sName}&quot;, 0xC0000000, 7, 0, 2, 0x80, 0)i.s'<br />
   Pop $1<br />
   ClearErrors<br />
   FileWrite $1 '${sValue}'<br />
    IfErrors +1 +3<br />
     StrCpy ${sOutput} 0<br />
     Goto +2<br />
     StrCpy ${sOutput} 1<br />
    Pop ${sOutput}<br />
   System::Call 'kernel32::CloseHandle(i $1)'<br />
!macroend<br />
!define WriteNtfsStream '!insertmacro WriteNtfsStream'<br />
This is work fine, but one problem is left. Characters such as ض recorded as ?. Any ideas? I'm using NSIS 2.46 (Unicode).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">20th June 2013, 02:44</div></div><div class="posttext">This is work fine, but one problem is left. Characters such as ض recorded as ? .<br />
<br />
It is converted to a narrow string using the active codepage (Machine specific). If you want to write UTF16LE the fork should have a function to write out UCS2 characters at least, going outside the BMP is probably not supported. Writing UTF8 cannot be done without calling kernel32::WideCharToMultiByte and then calling kernel32::WriteFile...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>