<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" System::Call dll is not working, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  System::Call dll is not working NSIS Discussion" />
	
	<title> System::Call dll is not working [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  System::Call dll is not working</div>
<hr />
<div class="pda"><a href="t-268986.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=268986">System::Call dll is not working</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">inim</div><div class="date">5th April 2007, 06:56</div></div><div class="posttext">I wrote a DLL file. And I want to call during some installation process.<br />
<br />
But it doesn't work. I searched and read some article about that, but I couldn't get it work.<br />
<br />
I made my DLL file by Visual Studio 6. There are 1 public class and 1 function. A class has 1 public methods and 1 private method.<br />
<br />
this is my nsi file.<br />
<br />
Name &quot;dllTest2&quot;<br />
OutFile &quot;dllTest2.exe&quot;<br />
ShowInstDetails show<br />
<br />
Section<br />
SetPluginUnload alwaysoff<br />
SetOutPath &quot;$TEMP\ttt&quot;<br />
File MyDll.dll<br />
System::Call &quot;MyDll::ttt()i .r8&quot;<br />
System::Call 'MyDll::test(i &quot;1&quot;, i &quot;2&quot;) i .r1'<br />
DetailPrint &quot;After Calling: $1&quot;<br />
DetailPrint &quot;After Calling: $8&quot;<br />
SetPluginUnload manual<br />
SectionEnd<br />
<br />
<br />
nsi file and dll file are placed in same folder.<br />
<br />
The compile is ok, but the message is always &quot;error&quot;.<br />
<br />
After run the exe file, mydll.dll is in $TEMP\ttt folder. but I think dll call is not happened.<br />
<br />
I need your help. How do I call mydll? Should I do anything else to call dll function?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dienjd</div><div class="date">5th April 2007, 16:00</div></div><div class="posttext">Try extracting your dll to $PLUGINSDIR instead of $TEMP\ttt. system.dll will be in $PLUGINSDIR and expects your plugin to be there also.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">inim</div><div class="date">6th April 2007, 02:50</div></div><div class="posttext">Originally posted by dienjd <br />
Try extracting your dll to $PLUGINSDIR instead of $TEMP\ttt. system.dll will be in $PLUGINSDIR and expects your plugin to be there also.  <br />
<br />
I fixed my nsi file as you've suggested and some line added like this.<br />
<br />
DetailPrint &quot;After Calling: $PLUGINSDIR&quot;<br />
<br />
$PLUGINSDIR is changed when I execute exe file. But when I go that folder, there is not my dll file. There's System.dll file only. What's wrong? I have no idea.<br />
<br />
What should I do?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">6th April 2007, 03:51</div></div><div class="posttext">Hi inim, you are almost close to your task...try this:<br />
<br />
Name &quot;dllTest2&quot;<br />
OutFile &quot;dllTest2.exe&quot;<br />
ShowInstDetails show<br />
<br />
Section<br />
SetPluginUnload alwaysoff<br />
SetOutPath &quot;$TEMP\ttt&quot;<br />
!addplugindir &quot;./&quot; ; if you plugin is the same dir as you .nsi<br />
System::Call &quot;MyDll::ttt(v) i .r8&quot; ;note changes<br />
System::Call 'MyDll::test(i 1, i 2) i .r1' ;note changes<br />
DetailPrint &quot;After Calling: $1&quot;<br />
DetailPrint &quot;After Calling: $8&quot;<br />
SetPluginUnload manual<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">inim</div><div class="date">6th April 2007, 07:15</div></div><div class="posttext">Originally posted by Joel <br />
Hi inim, you are almost close to your task...try this:<br />
<br />
Name &quot;dllTest2&quot;<br />
OutFile &quot;dllTest2.exe&quot;<br />
ShowInstDetails show<br />
<br />
Section<br />
SetPluginUnload alwaysoff<br />
SetOutPath &quot;$TEMP\ttt&quot;<br />
!addplugindir &quot;./&quot; ; if you plugin is the same dir as you .nsi<br />
System::Call &quot;MyDll::ttt(v) i .r8&quot; ;note changes<br />
System::Call 'MyDll::test(i 1, i 2) i .r1' ;note changes<br />
DetailPrint &quot;After Calling: $1&quot;<br />
DetailPrint &quot;After Calling: $8&quot;<br />
SetPluginUnload manual<br />
SectionEnd<br />
  <br />
<br />
I fixed the code, but it didn't work. I wonder it works though there's no path to my dll file. Does &quot;!addplugindir&quot; make it possible? Anyway, there's no files where the outPath that I specified. However when I add a line &quot;File mydll.dll&quot; there is my dll.<br />
<br />
I have a question. Is it possible that my dll file is not correct? It was just made by app. wizard of VS 6.0. But I tested it by calling from console program.<br />
<br />
I downloaded the tutorial and read some articles, but I can't make my app. work as I wished.<br />
<br />
Anyway I really appreciate your suggestion.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">6th April 2007, 15:03</div></div><div class="posttext">Is it possible that my dll file is not correct? It was just made by app. wizard of VS 6.0. But I tested it by calling from console program.<br />
<br />
Can we see your compiled DLL? Something is not right.<br />
!addplugindir will scan the given directory for plugins, so you can call them as you want.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th April 2007, 16:53</div></div><div class="posttext">You could just convert your plugin into an NSIS plugin and call it like that. You wouldn't need to use the System plugin then and if you're not using it elsewhere in your script you'll save some space (not that it matters too much anyway).<br />
<br />
Theres a plugin example called ExDll included with the latest NSIS bundle (or source code bundle).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">inim</div><div class="date">7th April 2007, 02:58</div></div><div class="posttext">Originally posted by Joel <br />
Can we see your compiled DLL? Something is not right.<br />
 <br />
<br />
This code is mydll.h. And I attached MyDll.dll. <br />
<br />
#ifdef MYDLL_EXPORTS<br />
#define MYDLL_API __declspec(dllexport)<br />
#else<br />
#define MYDLL_API __declspec(dllimport)<br />
#endif<br />
<br />
class MYDLL_API CMyDll {<br />
public:<br />
	CMyDll(void);<br />
	int test(int, int);<br />
};<br />
<br />
extern MYDLL_API int nMyDll;<br />
<br />
MYDLL_API int ttt(void);<br />
<br />
Anything wrong? :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">inim</div><div class="date">7th April 2007, 03:08</div></div><div class="posttext">Originally posted by Afrow UK <br />
Theres a plugin example called ExDll included with the latest NSIS bundle (or source code bundle).<br />
 <br />
<br />
I found it! But I can't understand right now. :eek:  In fact I have very poor experience about win32 programming. I'll try to understand it. Thanks!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">7th April 2007, 15:27</div></div><div class="posttext">Dude!<br />
<br />
Your are using C++ and there's a few words to put in each function to be exported:<br />
<br />
extern &quot;C&quot; void test(...)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">inim</div><div class="date">10th April 2007, 02:03</div></div><div class="posttext">When I compile my nsi file, the log message is quite different from what other usual dll file is included.<br />
<br />
This is right log.<br />
 - System::Alloc<br />
 - System::Call<br />
 - System::Copy<br />
 - System::Free<br />
 - System::Get<br />
 - System::Int64Op<br />
 - System::Store<br />
<br />
And this is unrecognizing message-when mydll is included.<br />
 - MyDll::??0CMyDll@@QAE@XZ<br />
 - MyDll::??4CMyDll@@QAEAAV0@ABV0@@Z<br />
 - MyDll::?nMyDll@@3HA<br />
 - MyDll::?test@CMyDll@@QAEHHH@Z<br />
<br />
<br />
well....I'll try to find the solution. However if you give me some advice or the answer, I'll really appreciate your help. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">10th April 2007, 02:07</div></div><div class="posttext">See my last post, you read it, right?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">inim</div><div class="date">10th April 2007, 02:33</div></div><div class="posttext">Originally posted by Joel <br />
See my last post, you read it, right?  <br />
<br />
Ah....I see. I forgot to add 'extern &quot;C&quot;' in front of function and did it only class. ;; My function is working!<br />
<br />
I really thank your help!<br />
<br />
By the way I have 1 more question. Can't I use class methods? If I add 'extern &quot;C&quot;' in front of member method, log message is still understandable.<br />
<br />
extern &quot;C&quot; int CMyDll::test(int x, int y)<br />
{<br />
	return x+y;<br />
}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">10th April 2007, 17:56</div></div><div class="posttext">I don't know...maybe...you'll have to try it :)<br />
And if you gonna try it, don't forget to see 4.11.2 Disabling Plug-in Unloading and 4.8.2.9 SetPluginUnload</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">10th April 2007, 18:56</div></div><div class="posttext">you can probably export a static class function, but not a normal class method, there would be no this pointer, nsis plugin exports are cdecl and not thiscall</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>