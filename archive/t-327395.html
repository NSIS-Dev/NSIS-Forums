<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" [NSISdl] Check downloaded files by some sort of hash, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  [NSISdl] Check downloaded files by some sort of hash NSIS Discussion" />
	
	<title> [NSISdl] Check downloaded files by some sort of hash [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  [NSISdl] Check downloaded files by some sort of hash</div>
<hr />
<div class="pda"><a href="t-327395.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=327395">[NSISdl] Check downloaded files by some sort of hash</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Oddsodz</div><div class="date">16th February 2011, 05:40</div></div><div class="posttext">Hello all.<br />
<br />
Well today I got asked a question about my installer.  &quot;What sort of file checking have you in place for the files that get downloaded in your installer&quot;<br />
<br />
And to that I had no answer as I have not added any.  So I best get something in place.<br />
<br />
Here we go.<br />
<br />
If you at my .nsi file attached below.  You will see that at line 280 to line 286 I use NSISdl to download 7 &quot;prpack.7z&quot; files.<br />
<br />
I Then have my installer unpack the files in to the folders that they need to go. <br />
<br />
Now what I wish is for some sort of file checking system in place to make sure that the files have downloaded correctly and match a hash that I have already made (not sure how yet).  This way I can then insure that the &quot;prpack.7z&quot; files are not corrupted downloading in anyway before unpacking.<br />
<br />
Hope this make since.<br />
<br />
Anyway.  Can anybody point me to the right department?  I Have trolled around the forums for a few hours now.  And I have failed to fined the right answers. <br />
<br />
Hope somebody can help me out and thanks for taking the time to read.<br />
<br />
Oddsodz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">16th February 2011, 06:28</div></div><div class="posttext">Have you tried googling for 'nsis md5'?<br />
<br />
Also, 7z will already CRC the files upon extraction. If the extraction succeeds, you can be reasonably sure that the files were downloaded correctly.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Oddsodz</div><div class="date">16th February 2011, 16:05</div></div><div class="posttext">Yes. I Did do just that.  But it says on the plugin page that it is to <br />
Generates a md5 value from either a string or contents of specified file.<br />
<br />
So it does not &quot;Not check a md5&quot; I think.  But I maybe just too dump to see<br />
<br />
But the info about the contents of the &quot;7z&quot; files is good to know. Thanks for that. But it is the &quot;.7z&quot; files I want to check before they get unpacked</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">16th February 2011, 19:39</div></div><div class="posttext">So it does not &quot;Not check a md5&quot; I think.  But I maybe just too dump to see<br />
...What? You want the plugin to NOT check the md5? :igor:<br />
<br />
Anyway, the md5 plugin does exactly what you need. It calculates the md5hash of a file. You can use strcmp to verify the hash to the official value. (Hint: If you want the installer to be able to verify the 7z file *without* knowing the md5sum at compiletime, you can create a php script that returns the md5hash of the on-server file. Get that using an internet plugin and you'll know what the 7z file hash should be.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Oddsodz</div><div class="date">16th February 2011, 21:07</div></div><div class="posttext">...What? You want the plugin to NOT check the md5? :igor:<br />
<br />
Opps,  Looks like I was typing late at night and got that wrong.<br />
<br />
What I meant was that the page said that it was for &quot;Generating&quot; and not &quot;Checking&quot; MD5s.  Anyway.  It don't matter.  My spelling is bad anyway.<br />
<br />
So you say this will do the trick.  Now comes the cruxs.  I have no clue what you mean by &quot;strcmp&quot;.  Sure I know it some sort of code command.  But what I forgot to add in my 1st post was that I am a right noob in NSIS.  As bad as this is going to sound,  I Am going to need a &quot;Noobs&quot; guide.   Do you happen to have any links to more up to date pages on the matter?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th February 2011, 22:48</div></div><div class="posttext">1. Download the 7z file using inetc (or NSISdl).<br />
2. Download the hash using inetc/NSISdl to a plain text file in $PLUGINSDIR.<br />
3. Hash the 7z file using the MD5 plug-in.<br />
4. Read the hash from the file in $PLUGINSDIR (FileOpen+FileRead+FileClose).<br />
5. Compare the two hashes (you can use StrCmp (RTFM) or ${If} a == b).<br />
<br />
Hopefully that will help you.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>