<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Going from a 32-Bit installer to a 64-Bit installer, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Going from a 32-Bit installer to a 64-Bit installer NSIS Discussion" />
	
	<title> Going from a 32-Bit installer to a 64-Bit installer [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Going from a 32-Bit installer to a 64-Bit installer</div>
<hr />
<div class="pda"><a href="t-301724.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=301724">Going from a 32-Bit installer to a 64-Bit installer</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">5th January 2009, 13:26</div></div><div class="posttext">Hi Everyone,<br />
<br />
I have an installer that installs correctly to 32-Bit machines. I need to be able to install our application onto 64-Bit machines. I have searched the forums regarding this and have found out the following:<br />
<br />
NSIS is a 32-bit installer.<br />
<br />
NSIS developers would like to make a 64-bit installer but have no time. Below are issues related to 32-Bit installers and 64-Bit machines.<br />
<br />
â€¢ 32-Bit installers will run on a 64-bit machines (e.g. x86-64)<br />
â€¢ On a 64-bit machine NSIS will run as a 32-Bit process.<br />
â€¢ 32-Bit processes can only load 32-Bit DLLs, they cannot load 64-Bit DLLs.<br />
â€¢ 64-Bit procesess can only load 64-Bit DLLs, they cannot load 32-Bit DLLs.<br />
â€¢ Itâ€™s impossible to call 64-Bit plugins from a 32-Bit installer.<br />
â€¢ Itâ€™s impossible to call 32-Bit plugins from a 64-Bit installer.<br />
<br />
NSIS notes<br />
<br />
â€¢ To determine the version of the OS and architecture have a look in the following directories:<br />
<br />
1. NSIS\Include\WinVer.nsh<br />
2. NSIS\Include\x64.nsh<br />
     	 <br />
Example using x64.nsh<br />
<br />
${If} ${RunningX64}<br />
    MessageBox MB_OK &quot;running on x64&quot;<br />
${EndIf}<br />
<br />
<br />
There is also a plugin which can be found here:<br />
http://nsis.sourceforge.net/GetVersion_(Windows)_plug-in<br />
<br />
â€¢ On Windows 64-bit you have two copies of HKLM\Software. One for 32-bit applications and one for 64-bit applications. You can access both from NSIS using SetRegView.      <br />
<br />
â€¢ 64-Bit <br />
<br />
InstallDir &quot;$PROGRAMFILES64\${APPNAME}&quot;<br />
SetRegView 64<br />
<br />
<br />
â€¢ 32_Bit<br />
<br />
InstallDir &quot;$PROGRAMFILES\${APPNAME}&quot;<br />
SetRegView 32<br />
<br />
<br />
Is there anything that I am missing? Are there any pitfalls that I should look out for.  <br />
<br />
What is good practice from the following:<br />
(1) Have 1 script that does the lot (32-Bit &amp; 64Bit)<br />
(2) Have 2 scripts one for each.<br />
Any further ideas would be appreciated.<br />
<br />
Thanks guys.<br />
<br />
Regards<br />
<br />
Paul</div></div><hr />


<div class="post"><div class="posttop"><div class="username">umeca74</div><div class="date">6th January 2009, 17:11</div></div><div class="posttext">i'd say you have it figured out ok<br />
<br />
here's what I've done to have 32/64 bit from a single NSI source:<br />
<br />
!define WIN64; comment out for 32 bit<br />
<br />
<br />
within Function .onInit<br />
<br />
<br />
; check if we are running under WOW64<br />
; since NSIS is always 32 bit it would mean that we are on 64 bit windows<br />
!include &quot;x64.nsh&quot;<br />
${If} ${RunningX64}<br />
!ifdef WIN64<br />
	SetRegView 64<br />
	;${DisableX64FSRedirection} not required?<br />
!else<br />
	MessageBox MB_YESNO|MB_ICONQUESTION|MB_DEFBUTTON2 'There is a specific 64 bit xplorerÂ² version$\r$\nFor details click http://zabkat.com/x2-64bit.htm $\r$\nProceed with 32 bit installation anyway?' IDYES noprob<br />
	Quit<br />
noprob:<br />
!endif<br />
${Else}<br />
!ifdef WIN64<br />
	MessageBox MB_OK|MB_ICONSTOP 'This is the 64 bit xplorerÂ² installer$\r$\nPlease download the 32 bit version from http://zabkat.com/ $\r$\nClick Ok to quit Setup.'<br />
	Quit<br />
!endif<br />
${EndIf}<br />
<br />
;manually set $instdir<br />
!ifdef WIN64<br />
	strcpy $INSTDIR &quot;$PROGRAMFILES64\zabkat\xplorer2&quot;<br />
!else<br />
	strcpy $INSTDIR &quot;$PROGRAMFILES\zabkat\xplorer2&quot;<br />
!endif<br />
<br />
<br />
I have the 64 bit executables in a different folder so there is a !ifdef WIN64 to copy the right files too. I chose to have separate installers for 32 and 64 bit (albeit controlled by a single NSI)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RDaneel</div><div class="date">7th January 2009, 21:14</div></div><div class="posttext">Just to generalize the model a bit, consider my case: I have a 32 bit app AND a Shell extension that work together.  Just running the existing NSIS installer on, say, Vista x64, results in a 32 bit install of the app AND the Shell extension... which is to say that the Shell extension does not *appear* to have installed at all!<br />
<br />
In reality, this is just illustrating the fact that the &quot;normal&quot; Windows Explorer-based Shell UI is 64 bit in this environment.  So while the installer in fact completed successfully, the Shell extension part was installed only for the 32 bit version of the Shell (yes, it is still there).<br />
<br />
SO, for cases like this, one needs to build and install BOTH 32 and 64 bit versions of one's Shell extension, even if your actual app is itself still 32 bit... and yes, having the 64 bit Shell extension invoke the 32 bit app works fine, as (at least for me) this will be across a process boundary, so the &quot;mixing&quot; of 32 and 64 bit components is fine.<br />
<br />
As to how this relates to my [32 bit] NSIS installer, I just need to have &quot;32-on-64&quot; conditional code as illustrated by the OP that will arrange to add the installation of the 64 bit version of my Shell extension when running in a 64 bit environment.<br />
<br />
Finally, for those who don't think this is all fairly twisted already, consider that if I eventually have a 64 bit version of my APP, it will most likely need to also install both the 32 and 64 bit versions of my Shell extension. :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>