<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" autouninstall, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  autouninstall NSIS Discussion" />
	
	<title> autouninstall [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  autouninstall</div>
<hr />
<div class="pda"><a href="t-151128.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=151128">autouninstall</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">SGI</div><div class="date">1st October 2003, 17:36</div></div><div class="posttext">I have my autouninstall...but when Im running the autouninstaller there is the install window behind him ready.<br />
I want to start the new installation only if is unistalled the old program and stop the installation (new program), if they dont accept the upgrade/cancell.<br />
Thank you<br />
<br />
ReadRegStr $1 HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PROD_NAME}&quot;  &quot;uninstallstring&quot;<br />
    StrCmp $1 &quot;&quot; cont<br />
    StrCmp $0 &quot;&quot; done<br />
cont:<br />
  HideWindow<br />
  MessageBox MB_OKCANCEL|MB_ICONEXCLAMATION \<br />
  &quot;This wizard will autouninstall the ${PROD_NAME}. $\n$\nIt is strongly recommended that you uninstall manually any previous versions of  \<br />
 ${PROD_NAME} 2.5.${VER_MINOR}$\n$\nClick `OK` to install or `Cancel` to cancel this upgrade.&quot; \<br />
  IDOK uninst<br />
  Abort<br />
<br />
uninst:<br />
  ClearErrors<br />
  ExecWait '&quot;$INSTDIR\uninstall.exe&quot; /S_?=$INSTDIR'<br />
<br />
done:<br />
  BringToFront</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st October 2003, 17:45</div></div><div class="posttext">If you want to close the installer that runs the uninstaller, use <br />
Exec '&quot;$INSTDIR\uninstall.exe&quot; /S_?=$INSTDIR'<br />
Quit<br />
<br />
You could pass a command-line parameter to the uninstaller to be read in the uninstaller to re-run the installer when the uninstall is complete.<br />
<br />
E.g.<br />
In installer .onInit<br />
Exec '&quot;$INSTDIR\uninstall.exe&quot; /S_?=$INSTDIR yes'<br />
Quit<br />
<br />
In uninstaller<br />
Section Uninstall<br />
...<br />
Call GetParameters<br />
Pop $R0<br />
StrCmp $R0 &quot;/S_?=$INSTDIR yes&quot; 0 noQuit<br />
Exec installer.exe<br />
Quit<br />
noQuit:<br />
SectionEnd<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">1st October 2003, 18:31</div></div><div class="posttext">You'd better send the filename of the installer, because the user might have renamed the file.<br />
<br />
See http://nsis.sourceforge.net/archive/nsisweb.php?page=427</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st October 2003, 18:42</div></div><div class="posttext">Ah yes!<br />
Thinking about it now, it's probably easier to write the extra parameters to a temp ini file or to the registry, so that a string function isn't required to get hold of the sent command-line parameters.<br />
<br />
E.g.<br />
In installer .onInit<br />
Call GetEXEName<br />
Pop $R0<br />
WriteINIStr &quot;$TEMP\myinstaller.tmp&quot; &quot;Installer&quot; &quot;InstallerEXE&quot; &quot;$EXEDIR\$R0&quot;<br />
Exec '&quot;$INSTDIR\uninstall.exe&quot; /S_?=$INSTDIR'<br />
Quit<br />
<br />
In uninstaller<br />
Section Uninstall<br />
... <br />
IfFileExists &quot;$TEMP\myinstaller.tmp&quot; 0 noQuit<br />
ReadINIStr $R0 &quot;$TEMP\myinstaller.tmp&quot; &quot;Installer&quot; &quot;InstallerEXE&quot;<br />
Exec &quot;$R0&quot;<br />
Delete &quot;$TEMP\myinstaller.tmp&quot;<br />
Quit <br />
noQuit: <br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">1st October 2003, 18:45</div></div><div class="posttext">I think using the command line is a good solution.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st October 2003, 20:07</div></div><div class="posttext">A simpler solution would be reading the uninstaller's return value. As stated in C.2 Error Levels (http://nsis.sourceforge.net/Docs/AppendixC.html#C.2), the uninstaller will return 1 if the process failed. Read it using the second parameter of ExecWait. For example:<br />
<br />
ExecWait '&quot;$INSTDIR\uninstall.exe&quot; _?=$INSTDIR' $0<br />
StrCmp $0 0 goodToGo<br />
Abort<br />
goodToGo:<br />
<br />
BTW, you have an error in your call to the uninstaller. It seems as you've tried to make the uninstaller silent but missed a space after the /S parameter. I have removed it in my example because you've talked about the user clicking the cancel button, which is impossible if the uninstaller is silent.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">1st October 2003, 20:16</div></div><div class="posttext">But in that case the installer keeps running. The command line is used to send the installer filename.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st October 2003, 20:19</div></div><div class="posttext">The installer should wait for the uninstaller if using _?=$INSTDIR on the command line.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">1st October 2003, 20:25</div></div><div class="posttext">Yes, but it keeps running. It's nicer to close it until the uninstallation has completed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st October 2003, 20:29</div></div><div class="posttext">HideWindow takes care of that, it shouldn't even show on the taskbar. And if this is used in .onInit, there is nothing to worry about anyway.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SGI</div><div class="date">2nd October 2003, 18:55</div></div><div class="posttext">I never had a moment to try your script &quot;help&quot;.<br />
But thank you ....I'll let you know when I have free time.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SGI</div><div class="date">9th October 2003, 05:06</div></div><div class="posttext">I tried your script and I have in thefollowing problem:<br />
this is my script MUI_STARTMENUPAGE_DEFAULTFOLDER &quot;${PROD_NAME}&quot;<br />
and I have the name of the &quot;OutFile&quot; myinstaller1122.ex be carefull no all name of the outfile ....missing letter e. <br />
So far..this is working great if the users dont change the name of the installer:<br />
ReadRegStr $1 HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PROD_NAME}&quot;  &quot;uninstallstring&quot;<br />
    StrCmp $1 &quot;&quot; cont<br />
    StrCmp $0 &quot;&quot; done<br />
cont:<br />
  HideWindow<br />
  MessageBox MB_OKCANCEL|MB_ICONEXCLAMATION \<br />
  &quot;This wizard will autouninstall the ${PROD_NAME}. $\n$\nIt is strongly recommended that you uninstall manually any previous versions of  \<br />
 ${PROD_NAME} 2.5.${VER_MINOR}$\n$\nClick `OK` to install or `Cancel` to cancel this upgrade.&quot; \<br />
  IDOK uninst<br />
  Abort<br />
uninst:<br />
  ClearErrors<br />
  ExecWait '&quot;$INSTDIR\uninstall.exe&quot; _?=$INSTDIR' $0<br />
StrCmp $0 0 goodToGo<br />
Abort<br />
goodToGo:<br />
done:<br />
  BringToFront<br />
I have two choices :<br />
-First: the users are unable to change the name.<br />
-Second: find to do exactly what we want (best choice).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th October 2003, 12:02</div></div><div class="posttext">What does the name of the installer has to do with this? You don't execute it. What exactly do you mean by &quot;find to do exactly what we want (best choice).&quot;?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SGI</div><div class="date">9th October 2003, 14:12</div></div><div class="posttext">I used Afrow Uk script and I have the name of the installer myinstaller1122.ex(&quot;OutFile&quot;) and there I need my ${PROD_NAME}<br />
MUI_STARTMENUPAGE_DEFAULTFOLDER &quot;${PROD_NAME}&quot; <br />
<br />
And what I mean &quot;about&quot; find to do exactly what we want (best choice). is to allow the users to change the name of the installer and autouninstall it.<br />
But I found another problem: if the users changed the name of the previous version the new installer (with autouninstall) doesnt work.<br />
Probably the best way is not to allow to change the name.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th October 2003, 14:18</div></div><div class="posttext">You don't need Afrow's functions anymore. The code in your last post should be enough.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SGI</div><div class="date">9th October 2003, 15:20</div></div><div class="posttext">Thank you Kichik im thinking to use your code...is great.<br />
And going to &quot;not allow to change the name&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SGI</div><div class="date">9th October 2003, 17:45</div></div><div class="posttext">Btw I forgot to tell you ...I wrote that error on the Afrow UK on my installer to try to fix or see if is only a my problem.<br />
I resolved my problem  , with your script , but the forum is for all people no just for my script.<br />
Thank you again for your patience.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SGI</div><div class="date">12th October 2003, 07:00</div></div><div class="posttext">Sorry Im back again....the autouninstaller was always triggered<br />
even if no prior version of the program was installed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th October 2003, 12:00</div></div><div class="posttext">Please attach the entire script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SGI</div><div class="date">12th October 2003, 14:46</div></div><div class="posttext">Thank you shoot the file....:(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SGI</div><div class="date">12th October 2003, 14:47</div></div><div class="posttext">Sorry and thank you again...in the other post I attached the ini file.<br />
<br />
 Link to INi file (http://forums.winamp.com/showthread.php?threadid=152357&amp;goto=newpost)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th October 2003, 14:55</div></div><div class="posttext">There is no place in the script where you actually write to HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PROD_NAME}&quot; &quot;UninstallString&quot;. If you don't write anything there, the script won't be able to read anything from there. You should also write this key so your uninstaller would be listed in the Add/Remove control panel. See Appendix C - &quot;Add uninstall information to Add/Remove Programs&quot; for more information.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>