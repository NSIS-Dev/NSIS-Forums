<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" how to get system drive letter, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  how to get system drive letter NSIS Discussion" />
	
	<title> how to get system drive letter [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  how to get system drive letter</div>
<hr />
<div class="pda"><a href="t-317086.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=317086">how to get system drive letter</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">heinkoi459</div><div class="date">17th February 2010, 20:58</div></div><div class="posttext">Hi, how can I get the system drive letter to complete this InstallDir &quot;_:\MyFolder\&quot;<br />
<br />
I know that 'ReadEnvStr $0 SYSTEMDRIVE' can do it but only in 'Section or Function'. So the 'InstallDir' is in declaration.<br />
<br />
Thank you!<br />
<br />
Guillaume</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rsvargas</div><div class="date">18th February 2010, 17:07</div></div><div class="posttext">you can put it on the .onInit Function.<br />
<br />
I've created a page so the user can choose the drive in which he wants to install. like this (showing only relevant parts):<br />
<br />
<br />
!include &quot;FileFunc.nsh&quot;<br />
!insertmacro GetDrives<br />
<br />
Var drives<br />
<br />
Function .onInit<br />
  StrCpy $drives &quot;&quot;<br />
  ${GetDrives} &quot;HDD&quot; &quot;GenerateDrivesString&quot;<br />
  File /oname=$PLUGINSDIR\\Drive.ini &quot;Drive.ini&quot;<br />
  WriteINIStr &quot;$PLUGINSDIR\\Drive.ini&quot; &quot;Field 2&quot; &quot;ListItems&quot; &quot;$drives&quot;<br />
FunctionEnd<br />
<br />
Function GenerateDrivesString<br />
  StrCmp $drives &quot;&quot; 0 +2<br />
  StrCpy $drivesState &quot;$9&quot;<br />
  StrCmp $drives &quot;&quot; +2<br />
  StrCpy $drives &quot;$drives|&quot;<br />
  StrCpy $drives &quot;$drives$9&quot;<br />
  Push $0<br />
FunctionEnd<br />
<br />
<br />
Function ShowDrive<br />
  WriteINIStr &quot;$PLUGINSDIR\\Drive.ini&quot; &quot;Field 1&quot; &quot;Text&quot; &quot;Select drive&quot;<br />
  InstallOptions::initDialog /NOUNLOAD &quot;$PLUGINSDIR\\Drive.ini&quot;<br />
  Pop $0<br />
  InstallOptions::show<br />
  Pop $0<br />
FunctionEnd<br />
<br />
Function LeaveDrive<br />
  ReadINIStr $0 &quot;$PLUGINSDIR\\Drive.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
  StrCpy $INSTDIR &quot;$0\\MyDirectory&quot;<br />
FunctionEnd<br />
<br />
<br />
<br />
and, of course, you need the Drive.ini file<br />
<br />
[Settings]<br />
NumFields=2<br />
<br />
[Field 1]<br />
Type=Label<br />
Text=Select which drive to install<br />
Left=84<br />
Right=256<br />
Top=49<br />
Bottom=57<br />
<br />
[Field 2]<br />
Type=DropList<br />
Text=DropList<br />
State=C:<br />
ListItems=A:|B:|C:|D:|E:|F:|G:|H:|I:|J:|K:|L:|M:|N:|O:|P:|Q:|R:|S:|T:|U:|V:|W:|X:|Y:|Z:<br />
Left=84<br />
Right=212<br />
Top=62<br />
Bottom=76</div></div><hr />


<div class="post"><div class="posttop"><div class="username">heinkoi459</div><div class="date">19th February 2010, 17:53</div></div><div class="posttext">Hi, when I compile there are an error on this line 'File /oname=$PLUGINSDIR\Drive.ini Drive.ini' (File: &quot;Drive.ini&quot; -&gt; no files found.)  So I search on Web but there are nothing interesting to solve this problem.<br />
<br />
Thank you<br />
<br />
Guillaume</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rsvargas</div><div class="date">19th February 2010, 17:59</div></div><div class="posttext">You need to create a file called Drive.ini with the following contents and put it in the same folder of your .nsi script.<br />
<br />
Originally posted by rsvargas <br />
<br />
<br />
[Settings]<br />
NumFields=2<br />
<br />
[Field 1]<br />
Type=Label<br />
Text=Select which drive to install<br />
Left=84<br />
Right=256<br />
Top=49<br />
Bottom=57<br />
<br />
[Field 2]<br />
Type=DropList<br />
Text=DropList<br />
State=C:<br />
ListItems=A:|B:|C:|D:|E:|F:|G:|H:|I:|J:|K:|L:|M:|N:|O:|P:|Q:|R:|S:|T:|U:|V:|W:|X:|Y:|Z:<br />
Left=84<br />
Right=212<br />
Top=62<br />
Bottom=76</div></div><hr />


<div class="post"><div class="posttop"><div class="username">heinkoi459</div><div class="date">19th February 2010, 18:29</div></div><div class="posttext">Greet but I have another stupid error in this line 'StrCpy $drivesState &quot;$9&quot; ' (Usage: StrCpy $(user_var: output) str [maxlen] [startoffset]). So what I have to do to solve this?!<br />
<br />
Thank you again<br />
<br />
Guillaume</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rsvargas</div><div class="date">19th February 2010, 18:37</div></div><div class="posttext">You need to declare the variable, you can add<br />
Var drivesState<br />
just below the line with<br />
Var drives<br />
<br />
Or you can just delete the line which refers to this variable...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">heinkoi459</div><div class="date">19th February 2010, 20:42</div></div><div class="posttext">Okay, but in 'InstallDir &quot;_\imagem\PSadmin\&quot;' (at declaration what I have to put in '_' to have the right drive letter?)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th February 2010, 00:39</div></div><div class="posttext">Just use a variable in InstallDir.<br />
<br />
Var SystemDrive<br />
InstallDir `$SystemDrive\some\dir`<br />
<br />
You just have to use ReadEnvStr $SystemDrive SYSTEMDRIVE in .onInit.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">heinkoi459</div><div class="date">24th February 2010, 19:50</div></div><div class="posttext">It didn't work, there are no letter it appear like that: /my/folder</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rsvargas</div><div class="date">24th February 2010, 19:51</div></div><div class="posttext">Can you post the portion of your code that try to fetch the drive letter?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">heinkoi459</div><div class="date">24th February 2010, 20:15</div></div><div class="posttext">!define APPNAME &quot;NAME&quot;<br />
!define APPNAMEANDVERSION &quot;VERSION&quot;<br />
<br />
Var SystemDrive<br />
<br />
; Main Install settings<br />
Name &quot;${APPNAMEANDVERSION}&quot;<br />
InstallDir &quot;$SystemDrive\\MY\\PATH\&quot;<br />
InstallDirRegKey HKLM &quot;Software\${APPNAME}&quot; &quot;&quot;<br />
OutFile &quot;C:\\Install.exe&quot;<br />
!define PROGPATH &quot;$SystemDrive\\\MY\&quot;<br />
<br />
RequestExecutionLevel admin<br />
<br />
; Modern interface settings<br />
!include &quot;MUI.nsh&quot;<br />
!include &quot;WinMessages.nsh&quot;<br />
!include &quot;FileFunc.nsh&quot; <br />
<br />
; MUI Welcome page on 3 lines<br />
!define MUI_WELCOMEPAGE_TITLE_3LINES<br />
<br />
; MUI Settings / Icons<br />
!define MUI_ICON &quot;${NSISDIR}\Contrib\Graphics\Ent\Icons\Ent.ico&quot;<br />
!define MUI_UNICON &quot;${NSISDIR}\Contrib\Graphics\Ent\Icons\Ent.ico&quot;<br />
 <br />
; MUI Settings / Header<br />
!define MUI_HEADERIMAGE<br />
!define MUI_HEADERIMAGE_RIGHT<br />
!define MUI_HEADERIMAGE_BITMAP &quot;${NSISDIR}\Contrib\Graphics\Ent\Header\Header.bmp&quot;<br />
!define MUI_HEADERIMAGE_UNBITMAP &quot;${NSISDIR}\Contrib\Graphics\Ent\Header\Header.bmp&quot;<br />
 <br />
; MUI Settings / Wizard<br />
!define MUI_WELCOMEFINISHPAGE_BITMAP &quot;${NSISDIR}\Contrib\Graphics\Ent\Wizard\Wizard.bmp&quot;<br />
!define MUI_UNWELCOMEFINISHPAGE_BITMAP &quot;${NSISDIR}\Contrib\Graphics\Ent\Wizard\Wizard.bmp&quot;<br />
<br />
;!define MUI_WELCOMEPAGE_TITLE '${WELCOME_TITLE}'<br />
!insertmacro MUI_PAGE_WELCOME<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
!insertmacro MUI_PAGE_INSTFILES<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
!insertmacro MUI_UNPAGE_CONFIRM<br />
!insertmacro MUI_UNPAGE_INSTFILES<br />
<br />
; Set languages (first is default language)<br />
;!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
!insertmacro MUI_LANGUAGE &quot;French&quot;<br />
!insertmacro MUI_RESERVEFILE_LANGDLL<br />
<br />
!insertmacro GetDrives <br />
<br />
; ******************************************************************************************************<br />
; * INSTALL<br />
; ******************************************************************************************************<br />
Section &quot;NAME&quot; Section1<br />
<br />
	; Set Section properties<br />
	SetOverwrite on<br />
<br />
	; Set Section Files and Shortcuts<br />
	SetOutPath &quot;$INSTDIR\&quot;<br />
	File &quot;..\Name.exe&quot;<br />
	File &quot;..\LIB.jar&quot;<br />
	<br />
	SetOutPath &quot;$INSTDIR\images\&quot;<br />
	File &quot;..\images\*.*&quot;;<br />
	<br />
	SetOutPath &quot;$INSTDIR\images\_icons\&quot;<br />
	File &quot;..\images\icons\*.*&quot;;<br />
	<br />
	SetOutPath &quot;$INSTDIR\images\right\&quot;<br />
	File &quot;..\images\right\*.*&quot;;<br />
	<br />
	SetOutPath &quot;$INSTDIR\lang\&quot;<br />
	File &quot;..\lang\fr.xml&quot;<br />
	<br />
	SetOutPath &quot;$INSTDIR\reports\&quot;<br />
	File &quot;..\reports\*.rpt&quot;<br />
	<br />
	SetOutPath &quot;$INSTDIR\tmp\&quot;<br />
	<br />
	; menu dÃ©marrer<br />
	CreateDirectory &quot;$SMPROGRAMS\MY\PATH&quot;<br />
	CreateShortCut &quot;$SMPROGRAMS\MY\PATH\NAME.lnk&quot; &quot;$INSTDIR\NAME.exe&quot;<br />
	CreateShortCut &quot;$SMPROGRAMS\MY\PATH\Uninstall.lnk&quot; &quot;$INSTDIR\uninstall.exe&quot;<br />
<br />
SectionEnd<br />
<br />
; ******************************************************************************************************<br />
; * FINISH SECTION<br />
; ******************************************************************************************************<br />
Section -FinishSection<br />
<br />
	WriteRegStr HKLM &quot;Software\${APPNAME}&quot; &quot;&quot; &quot;$INSTDIR&quot;<br />
	WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPNAME}&quot; &quot;DisplayName&quot; &quot;${APPNAME}&quot;<br />
	WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPNAME}&quot; &quot;UninstallString&quot; &quot;$INSTDIR\uninstall.exe&quot;<br />
	<br />
	WriteUninstaller &quot;$INSTDIR\uninstall.exe&quot;<br />
	<br />
SectionEnd<br />
<br />
; Modern install component descriptions<br />
!insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br />
!insertmacro MUI_DESCRIPTION_TEXT ${Section1} &quot;Jesus love bacon&quot;<br />
!insertmacro MUI_FUNCTION_DESCRIPTION_END<br />
<br />
; ******************************************************************************************************<br />
; * UNINSTALL<br />
; ******************************************************************************************************<br />
Section Uninstall<br />
	<br />
	;Remove from registry...<br />
	DeleteRegKey HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPNAME}&quot;<br />
	DeleteRegKey HKLM &quot;SOFTWARE\${APPNAME}&quot;<br />
	<br />
	;Remove the Main Folder<br />
	RMDir /r &quot;$INSTDIR\&quot;<br />
	RMDir &quot;${IMAGEMPATH}&quot;<br />
	<br />
	; Delete Shortcuts<br />
	Delete &quot;$SMPROGRAMS\MY\PATH\NAME.lnk&quot;<br />
	Delete &quot;$SMPROGRAMS\MY\PATH\Uninstall.lnk&quot;<br />
<br />
	RMDir &quot;$SMPROGRAMS\MY\PATH&quot;<br />
	RMDir &quot;$SMPROGRAMS\MY&quot;<br />
SectionEnd<br />
<br />
Function .onInit <br />
	ReadEnvStr $SystemDrive SYSTEMDRIVE<br />
FunctionEnd <br />
<br />
When I Install the program, in Installation folde it write: \MY\PATH, so I when the lettre _:\MY\PATH<br />
<br />
Thank yout guys<br />
<br />
PS: there are missing somes &quot;\&quot; just don't take care about it<br />
<br />
Guillaume</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rsvargas</div><div class="date">24th February 2010, 20:51</div></div><div class="posttext">Try moving the <br />
<br />
<br />
InstallDir &quot;$SystemDrive\MY\PATH\&quot; <br />
<br />
<br />
statement to the .onInit function. The .onInit function should be like this:<br />
<br />
<br />
Function .onInit <br />
    ReadEnvStr $SystemDrive SYSTEMDRIVE <br />
    InstallDir &quot;$SystemDrive\\MY\\PATH\\&quot; <br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th February 2010, 21:46</div></div><div class="posttext">You're right. InstallDir is being evaluated while $SystemDrive is still empty.<br />
<br />
Instead just use this in .onInit:<br />
Function .onInit<br />
  ReadEnvStr $R0 SYSTEMDRIVE<br />
  StrCpy $INSTDIR `$R0\MY\PATH\`<br />
FunctionEnd<br />
<br />
@ rsvargas:<br />
InstallDir is a compile time instruction. It is not valid within a Function or Section.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rsvargas</div><div class="date">24th February 2010, 21:58</div></div><div class="posttext">@Afrow UK<br />
My bad, I use the StrCpy $INSTDIR way to set the directory in my installers, and didn't remember that the InstallDir directive would not work in a function, thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">heinkoi459</div><div class="date">4th March 2010, 14:36</div></div><div class="posttext">Thank you really much Afrow UK :D</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>