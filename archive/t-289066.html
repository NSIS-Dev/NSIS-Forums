<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Vista: Desktop icon is not removed, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Vista: Desktop icon is not removed NSIS Discussion" />
	
	<title> Vista: Desktop icon is not removed [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Vista: Desktop icon is not removed</div>
<hr />
<div class="pda"><a href="t-289066.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=289066">Vista: Desktop icon is not removed</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Lenge</div><div class="date">26th March 2008, 14:32</div></div><div class="posttext">Hello world,<br />
<br />
I am doing the first Vista tests with an NSIS installer that works perfectly on 2000 and XP. I noticed that on Vista, the uninstaller does remove the start menu shortcuts, but not the desktop icon. (I only use 'all users' shortcuts.)<br />
<br />
Searching the NSIS pages, I found two essential hints:<br />
* Use &quot;RequestExecutionLevel admin&quot;<br />
* Use &quot;SetShellVarContext all&quot; at both install and uninstall<br />
<br />
I did both, but still the desktop icon is not removed on Vista. Shortened code sample:...<br />
RequestExecutionLevel admin<br />
...<br />
Section<br />
  ...<br />
  SetShellVarContext all<br />
  SetOutPath &quot;$SMPROGRAMS\MyApp&quot;<br />
  CreateShortcut &quot;MyApp.lnk&quot; &quot;$INSTDIR\MyApp.exe&quot;<br />
  SetOutPath $DESKTOP<br />
  CreateShortcut &quot;MyApp.lnk&quot; &quot;$INSTDIR\MyApp.exe&quot;<br />
SectionEnd<br />
...<br />
Section Uninstall<br />
  ...<br />
  SetShellVarContext all<br />
  RmDir /r /REBOOTOK &quot;$SMPROGRAMS\MyApp&quot;<br />
  Delete &quot;$DESKTOP\MyApp.lnk&quot; # &lt;-- Does not work on Vista<br />
SectionEndWhat the heck am I doing wrong?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mauvecloud</div><div class="date">26th March 2008, 15:12</div></div><div class="posttext">Even if you delete the shortcut, the icon isn't immediately removed from a Vista desktop. It remains until you refresh the desktop (or restart the computer).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Lenge</div><div class="date">26th March 2008, 15:15</div></div><div class="posttext">Hmmm... strange, it does work well under 2000/XP.<br />
<br />
Is there a way to trigger such a refresh from within the NSIS uninstaller to make the icon actually disappear?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mauvecloud</div><div class="date">26th March 2008, 15:34</div></div><div class="posttext">http://nsis.sourceforge.net/Refresh_Desktop shows two ways to do that, though I haven't personally confirmed yet that it will clear the shortcut off the desktop.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Lenge</div><div class="date">27th March 2008, 16:40</div></div><div class="posttext">I have just tried - triggering a refresh does actually make the icon disappear.<br />
<br />
Thanks for the hint!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>