<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" SetShellVarContext user, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  SetShellVarContext user NSIS Discussion" />
	
	<title> SetShellVarContext user [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  SetShellVarContext user</div>
<hr />
<div class="pda"><a href="t-306000.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=306000">SetShellVarContext user</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">OmidH</div><div class="date">3rd May 2009, 21:40</div></div><div class="posttext">Hi all,<br />
<br />
I'd like to know if it is possible to set : &quot;SetShellVarContext current&quot; when I need to execute the installer with admin rights (but from an &quot;normal&quot; useraccount).<br />
The Problem is, when setting &quot;SetShellVarContext current&quot; and executing with admin privilegs the $SMSTARTUP  (for example) is the Startup dir of the admin and not the one of the user, who executes the installer with admin rights.<br />
<br />
Is there a sollution for this Problem?<br />
<br />
Thanks in advance,<br />
<br />
Omid</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">3rd May 2009, 22:07</div></div><div class="posttext">check out the UserInfo plugin (comes with NSIS).  With it you can get the original user account credentials as well as the current user account credentials.  That way you can detect that a User has 'Run As' your installer as admin (or elevated via UAC in Vista).<br />
<br />
How to go from there, though... not sure.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">3rd May 2009, 23:49</div></div><div class="posttext">Originally posted by Animaether <br />
check out the UserInfo plugin (comes with NSIS).  With it you can get the original user account credentials as well as the current user account credentials.  That way you can detect that a User has 'Run As' your installer as admin (or elevated via UAC in Vista).<br />
 <br />
<br />
that is not true, UserInfo does not give you that info. UserInfo can tell you if the current PROCESS or current USER is a member of the admin group or whatever, but its not related to UAC at all, its related to Deny Group SID on a Token (talking about GetAccountType vs GetOriginalAccountType here)<br />
<br />
anyways, you can use the UAC plugin to pull this off, but you should understand that doing this is not &quot;correct&quot;. If your script contains RequestExecutionLevel admin, then you are doing a &quot;all users&quot; install and you should only use SetShellVarContext all</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">4th May 2009, 12:36</div></div><div class="posttext">hurr.. so that only works the other way around; admin with the installer requesting level 'user'?<br />
(<br />
# On Vista with UAC, for example, this is not the same value when running<br />
# with `RequestExecutionLevel user`. GetOriginalAccountType will return<br />
# &quot;admin&quot; while GetAccountType will return &quot;user&quot;.<br />
)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">4th May 2009, 14:55</div></div><div class="posttext">@Animaether: It has NOTHING to do with UAC, forget about it. You will see it on XP if you right-click and choose run-as, then check the protect my computer option (NSIS does not even run with it checked IIRC, but thats another story) The protect my computer option uses the SaferAPI behind the scenes, so it applies to others using that API also, or if they are building a token by hand and adding deny SID's on their own<br />
<br />
Try using my SaferAPI plugin and check the security tab of a process in Process Explorer, run the nsis app as admin, look at its child spawned by the safer api, it will have a DENY Admin SID in its process token (or http://www.devdebug.members.winisp.net/images/msdnblog/ProcessonVistaAdministratororuser_B834/1038917470_c1dd9e97b9_o.png if you are lazy)<br />
<br />
Older versions of the UserInfo plugin will report someone with a deny admin SID as admin, that function now has Original in the name and the other function calls the correct api on 2000 and later and is able to handle deny SID's<br />
<br />
For more info:<br />
http://blogs.msdn.com/aaron_margosis/archive/2004/09/10/227727.aspx<br />
http://msdn.microsoft.com/en-us/library/aa446583.aspx<br />
http://blogs.msdn.com/larryosterman/archive/2004/09/01/224051.aspx#225519</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">4th May 2009, 22:06</div></div><div class="posttext">slightly misleading in the user info example, then - thanks for the info, Anders - will peruse :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">OmidH</div><div class="date">9th May 2009, 09:37</div></div><div class="posttext">thanks guys for your responds.<br />
I will do the installation for all users.<br />
<br />
regards,<br />
<br />
Omid</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>