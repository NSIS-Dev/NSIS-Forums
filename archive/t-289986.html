<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" RMDir Bug?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  RMDir Bug? NSIS Discussion" />
	
	<title> RMDir Bug? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  RMDir Bug?</div>
<hr />
<div class="pda"><a href="t-289986.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=289986">RMDir Bug?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">hungryOrb</div><div class="date">10th April 2008, 17:04</div></div><div class="posttext">hi,<br />
erm when using:<br />
<br />
RMDir /r &quot;$INSTDIR&quot;<br />
<br />
the uninstaller starts deleting the Program Files folder, even if the app is not installed there. My small experience suggests to me that $INSTDIR does not carry the correct path to the uninstaller. It was suggested to me to put the $INSTDIR path into the registry at install time, and then extract it later. I'll post some results ;]<br />
<br />
Edit1: Oh two things to note: <br />
1) My uninstaller is placed inside ProgramFiles.<br />
2) and the default install is Program Files</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">10th April 2008, 17:25</div></div><div class="posttext">$INSTDIR=the folder the uninstaller is started from</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th April 2008, 17:27</div></div><div class="posttext">First you need to save the value of $INSTDIR in the registry, preferably with your Add/Remove registry (InstallLocation). Uninstalling that way is dangerous anyway but have a look at this page:<br />
http://nsis.sourceforge.net/Validating_$INSTDIR_before_uninstall<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">hungryOrb</div><div class="date">11th April 2008, 11:00</div></div><div class="posttext">Thanks Stu :D That's extremely helpful :O <br />
I have no choice but to use 'RMDIR /r' on account of the update (new) files being missed in the uninstaller. I know personally, I like to see absolutely no trace of things that have been chosen for uninstall as well :]<br />
'RMDIR /r' seems safe, as long as the INSTDIR can be located accurately ;] Half of my adobe folder has taken a hit, but I never liked Adobe Reader much anyways xD<br />
<br />
&lt;3@Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">hungryOrb</div><div class="date">11th April 2008, 12:01</div></div><div class="posttext">Stu, having looked at the page a lot, I've picked up on the type of validation being used, but when trying to use a similar setup, I find myself lost in placing the macro :/ It doesn't like to sit outside a section or function, but it doesn't seem to want to sit inside my onInit function either :/<br />
I guess I'm just clueless on how to attach the macro to the Directory Page. I've been looking in the manual, and will continue to, but if there is some magic words that could be said, I'd be happy to include them in a sharing of my experience as a whole when the installer finishes- that is, to help other beginners ;]</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th April 2008, 12:19</div></div><div class="posttext">It goes at the top of your uninstall section after getting the value of $INSTDIR. You can miss most of it off except the bit that checks if your application folder is appended to the end if you like (the !define ...)<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">hungryOrb</div><div class="date">11th April 2008, 12:42</div></div><div class="posttext">Oh thanks!<br />
With this lot:<br />
<br />
----------------------------<br />
Function un.onInit<br />
  ReadRegStr $R0 HKLM &quot;Software\VB and VBA Program Settings\${PRODUCT_NAME}\Main&quot; &quot;InstPathHere&quot;<br />
  <br />
  !define CHECK_PATH &quot;\${PRODUCT_NAME}&quot;<br />
StrLen $R1 &quot;${CHECK_PATH}&quot;<br />
StrCpy $R2 $INSTDIR &quot;&quot; -$R1<br />
StrCmp $R2 &quot;${CHECK_PATH}&quot; +3<br />
  MessageBox MB_YESNO|MB_ICONQUESTION &quot;Unrecognised uninstall path. Continue anyway?&quot; IDYES +2<br />
  Abort<br />
  <br />
  ;MessageBox MB_OK &quot;Registry: InstPathHere = $R0&quot;<br />
  MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 &quot;Are you sure you want to completely remove $(^Name)? Connectors will not be removed.&quot; IDYES +2<br />
  Abort<br />
FunctionEnd<br />
----------------------------<br />
<br />
--= I cant extract the name of the chosen folder of install right? because I don't know how many characters its going to be? So the validation will mostly just check the default folder name right? And at this point, the INSTDIR, is where the uninst.exe is sitting, so simply replace with $R0?<br />
<br />
And ehm. Although I've seen countless examples, at the end of a string comparison (?) the +2/+3 jump to certain points right? I'm just confused on where they jump to.. :|<br />
<br />
Thanks for helping so much Stu, you probably would prefer to spend time doing better stuff than spoon-feeding but I appreciate it muchly :]</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th April 2008, 15:07</div></div><div class="posttext">No, replace $R0 with $INSTDIR on your ReadRegStr line.<br />
Assuming you always append your default install folder to the end of your install path on install, this code will work fine.<br />
Yes you can use this to validate the path on install as well.<br />
<br />
There is a section in the manual regarding relative jumps.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">hungryOrb</div><div class="date">14th April 2008, 10:29</div></div><div class="posttext">Thanks Stu :] Although I cannot use $INSTDIR, because I put the uninstaller in a different directory to the main app. I think the installer is as complete as it can get for now :)<br />
<br />
There are holes, but, they are only dangerous if a user decides to rename an important folder to the name of the INSTDIR or messes with registry. If it was totally safe, there'd be no excitement though right? ^.^</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>