<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" DumpLog produces empty file, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  DumpLog produces empty file NSIS Discussion" />
	
	<title> DumpLog produces empty file [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  DumpLog produces empty file</div>
<hr />
<div class="pda"><a href="t-228975.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=228975">DumpLog produces empty file</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">ffletch2</div><div class="date">21st October 2005, 15:51</div></div><div class="posttext">I have tried calling the DumpLog function (provided in the manual) from inside of all of my already exising sections as well as creating a new hidden section and calling it from there like this:<br />
Section &quot;-a hidden section&quot;<br />
Push &quot;file.log&quot;<br />
Call DumpLog<br />
SectionEnd<br />
<br />
No matter what I do it always produces an empty log file.  What am I doing wrong or missing?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st October 2005, 15:54</div></div><div class="posttext">Are you sure it creates the file you're looking at? Try specifying a full path so you'll be sure which file it updates.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ffletch2</div><div class="date">21st October 2005, 16:00</div></div><div class="posttext">I tried several different paths as well as several different names.  It does produce file in the location I tell it to but the file is always empty.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st October 2005, 16:12</div></div><div class="posttext">Is that section the first section? Is your installer running in silent mode? Can you attach a complete example? It's a guessing game without a complete example.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ffletch2</div><div class="date">21st October 2005, 16:19</div></div><div class="posttext">Sorry about that.  Sample is attached.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st October 2005, 16:28</div></div><div class="posttext">You're calling DumpLog on your second section. Nothing is printed to log at that point. Call it on the last section when everything is already printed to the log.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ffletch2</div><div class="date">21st October 2005, 16:40</div></div><div class="posttext">Ok, that worked - thanks.<br />
<br />
2 related questions:<br />
- I'd like to write other information either to that log or to the log window like the date and time of install.  Is there an quick way to make that happen?<br />
- I'd also like to capture the uninstall information to that file.  Is there an easy way to do that?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st October 2005, 16:51</div></div><div class="posttext">Open this file as it's opened in the function and add whatever information you want into it (using FileOpen, FileWrite and FileClose).<br />
<br />
This function might help:<br />
http://nsis.sourceforge.net/wiki/Simple_write_text_to_file<br />
<br />
To dump the uninstaller log, simply call that function for the uninstaller as well. Make sure you change the file open mode from &quot;w&quot; to &quot;a&quot; so it appends instead of replacing.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ffletch2</div><div class="date">21st October 2005, 20:13</div></div><div class="posttext">I have it writing the log to a file.  And I am able to append information to the end of the file using the WriteToFile function.  I switched the write mode to &quot;a&quot; in the DumpLog function in hopes of appending to the file.  It appears that what its doing is writing to the same place in the file leaving everything below what it wrote intact.  So if the file says this:<br />
<br />
log start<br />
line2<br />
line3<br />
line4<br />
log stop<br />
my extra text<br />
<br />
After I uninstall then install again, it then says this:<br />
<br />
log start<br />
line2<br />
line3<br />
line4<br />
log stop<br />
my extra text<br />
my extra text<br />
<br />
So it doesn't appear to be apending, it appears to be putting a pointer at the beginning of the file, writing the log out and if there is anything left if the file after the pointer (which is at the end of the log output) that stays.  Is there a way to make the file look like this:<br />
<br />
log start<br />
line2<br />
line3<br />
line4<br />
log stop<br />
my extra text<br />
&lt;2nd install&gt;<br />
log start<br />
line2<br />
line3<br />
line4<br />
log stop<br />
my extra text</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st October 2005, 20:15</div></div><div class="posttext">You should also seek to the end of the file after opening it in append mode. Use:FileSeek $0 0 ENDWhere $0 should be the open file handle, of course.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ffletch2</div><div class="date">24th October 2005, 14:12</div></div><div class="posttext">Ok so I have everything working but the uninstaller portion.  In the past, I have just named all functions that I'm using in the uninstaller by un.&lt;function name&gt;.  However in this case I have a function that needs to be used elsewhere.  Is there a way to refer to the same function in both uninstall and non-uninstall sections (without simply copying the function and renaming it)?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th October 2005, 14:21</div></div><div class="posttext">Put the function's code inside a macro and then insert that macro into two functions, one for the installer and one for the uninstaller.!macro funccode UN<br />
Function ${UN}func<br />
# ... some code...<br />
FunctionEnd<br />
!macroend<br />
<br />
!insertmacro funccode &quot;&quot;<br />
!insertmacro funccode &quot;un.&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ffletch2</div><div class="date">24th October 2005, 14:59</div></div><div class="posttext">Ok, got that working.  Note that I had to remove Function and EndFunction from within the macro to make it work.  So using your example it worked when I made it look like this:<br />
<br />
!macro funccode UN<br />
# ... some code...<br />
!macroend<br />
<br />
!insertmacro funccode &quot;&quot;<br />
!insertmacro funccode &quot;un.&quot;<br />
<br />
<br />
Neat idea by the way.<br />
<br />
Now my problem is, I call the GetTime Macro in order to write the time to the uninstall log file.  This works fine in the installer, but it coughs in the uninstaller because it contains stuff that doesn't start with &quot;un.&quot;.  I tried the same trick as above but didn't work.  Any ideas?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th October 2005, 16:24</div></div><div class="posttext">!macro IncludeGetTime UN<br />
Function ${UN}GetTime<br />
...<br />
FunctionEnd<br />
!macroend<br />
<br />
!insertmacro IncludeGetTime &quot;&quot;<br />
!insertmacro IncludeGetTime &quot;un.&quot;<br />
<br />
!macro GetTime ...<br />
Call GetTime<br />
Pop ...<br />
!macroend<br />
<br />
!macro un.GetTime ...<br />
Call un.GetTime<br />
Pop ...<br />
!macroend<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ffletch2</div><div class="date">24th October 2005, 16:36</div></div><div class="posttext">Actually, I found un.GetTime and called it instead.<br />
<br />
Thanks (again) guys for the help.  I've got it all working how I want it now.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>