<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Delete user created Sub-folders keeping files in the $INSTDIR, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Delete user created Sub-folders keeping files in the $INSTDIR NSIS Discussion" />
	
	<title> Delete user created Sub-folders keeping files in the $INSTDIR [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Delete user created Sub-folders keeping files in the $INSTDIR</div>
<hr />
<div class="pda"><a href="t-263445.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=263445">Delete user created Sub-folders keeping files in the $INSTDIR</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Swapan Das</div><div class="date">11th January 2007, 08:14</div></div><div class="posttext">Hi!<br />
<br />
I've come up with an un-installer issue where I'll not remove the main $INSTDIR but have to keep some files,have to delete some files,have to delete certain installer created sub-folders. Upto now its ok, but there is one peculiar condition now. There are certain sub-folders which are created by the software/user, and are not known to the Installer. How to delete those particular unknown sub-folders. I cannot pass the command :<br />
  RMDir /r /REBOOTOK $INSTDIR<br />
as this will delete all the files,sub-folders, deleting my files and sub-folders which I intend to retain after the uninstall is performed.<br />
<br />
Please note I can delete individual files like :<br />
  Delete &quot;$INSTDIR\MyApp.exe&quot;<br />
and not pass wild card like:<br />
  Delete &quot;$INSTDIR\*.*&quot;<br />
This will safe-guard of keeping the files I want to. But then simultaneously how can I remove the user/software created sub-folders?<br />
<br />
Hope I was able to make to the situation clear!<br />
<br />
Looking for Red Wine,Bruno or anyone of you who knows the solution for it.<br />
<br />
With regards,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">11th January 2007, 09:04</div></div><div class="posttext">I guess you probably know the names of the folders created by the software/user, so the easiest way is to add these folders to the uninstall section, e.g.<br />
<br />
RmDir '$INSTDIR\a_folder_created_by_the_software/user'<br />
or if they are not empty,<br />
RmDir /r '$INSTDIR\a_folder_created_by_the_software/user'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Swapan Das</div><div class="date">11th January 2007, 10:36</div></div><div class="posttext">Boss then I would not have asked this question. These sub-folders are unknown to me. It will be a different ball game, if try to do it by accessing the SQL database, to a particular table to locate for those folders. The bundled software keeps the records in one of its table in a SQL database. I want to do it through NSIS.<br />
<br />
The issue is to retain some of my known sub-folders, and delete all the unknown sub-folders. Any idea?<br />
<br />
Regards,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">11th January 2007, 10:53</div></div><div class="posttext">then you should use at the end of your uninstall section the un.locate function in order to locate directories within $INSTDIR.<br />
See NSIS manual http://nsis.sourceforge.net/Docs/AppendixE.html#E.1</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Swapan Das</div><div class="date">11th January 2007, 11:41</div></div><div class="posttext">Thanks a lot. Yeah it seems to be useful reference material. Though it will be not that easy I think.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">11th January 2007, 12:01</div></div><div class="posttext">It wouldn't worth if it would be easy :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Swapan Das</div><div class="date">16th January 2007, 11:27</div></div><div class="posttext">Hi!<br />
<br />
Sorry for this late post.<br />
To delete the empty folders, I'm trying with this code.But its not working:<br />
<br />
!insertmacro Locate<br />
<br />
Section &quot;Uninstall&quot;<br />
  ;... my all codes for uninstall first<br />
  ;... finally<br />
  call un.LocateEmptyFolders<br />
SectionEnd<br />
<br />
Function un.LocateEmptyFolders<br />
	StrCpy $R2 0<br />
	StrCpy $R3 0<br />
	loop:<br />
	StrCpy $R1 0<br />
	${Locate} &quot;C:\MyAppFolder&quot; &quot;/L=DE&quot; &quot;un.DeleteEmptyFolders&quot;<br />
	IntOp $R3 $R3 + 1<br />
	IntOp $R2 $R2 + $R1<br />
	StrCmp $R0 StopLocate +2<br />
	StrCmp $R1 0 0 loop<br />
	IfErrors 0 +2<br />
FunctionEnd<br />
<br />
Function un.DeleteEmptyFolders<br />
	RMDir $R9<br />
	IntOp $R1 $R1 + 1<br />
	goto end<br />
	cancel:<br />
	StrCpy $R0 StopLocate<br />
	end:<br />
	Push $R0<br />
FunctionEnd<br />
<br />
Compilation is giving the following error:<br />
Call must be used with function names starting with &quot;un.&quot; in the uninstall section.<br />
Usage: Call function_name | [:label_name]</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">16th January 2007, 12:21</div></div><div class="posttext">Try !insertmacro un.Locate<br />
Also you may open the included FileFunc.nsh and examine the required definitions for installer/uninstaller :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Swapan Das</div><div class="date">16th January 2007, 12:32</div></div><div class="posttext">Oh! forgot to tell that I did used:<br />
!insertmacro un.Locate<br />
<br />
but its not working.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Swapan Das</div><div class="date">16th January 2007, 12:43</div></div><div class="posttext">I'll check the documetation and will check the code.<br />
<br />
Is it I've to use:<br />
	${un.Locate} &quot;C:\MyAppFolder&quot; &quot;/L=DE&quot; &quot;un.DeleteEmptyFolders&quot;<br />
<br />
Let me try and get back!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">16th January 2007, 12:47</div></div><div class="posttext">Name &quot;My Application&quot;<br />
OutFile 'test.exe'<br />
LicenseData '${NSISDIR}\License.txt'<br />
LicenseBkColor 0xFFFFFF<br />
InstallDir '$PROGRAMFILES\$(^name)'<br />
<br />
!include FileFunc.nsh<br />
!insertmacro un.locate<br />
 <br />
Page License<br />
Page Directory<br />
Page InstFiles<br />
<br />
Section &quot;boo&quot;<br />
       SetOutPath '$INSTDIR'<br />
       CreateDirectory '$INSTDIR\boo'<br />
       CreateDirectory '$INSTDIR\boo\boo1'<br />
       CreateDirectory '$INSTDIR\alter boo'<br />
       CreateDirectory '$INSTDIR\alter boo\alter boo1'<br />
       WriteUninstaller '$INSTDIR\uninstall.exe'<br />
SectionEnd<br />
<br />
Section UnInstall<br />
	StrCpy $R2 0<br />
	StrCpy $R3 0<br />
<br />
	loop:<br />
	StrCpy $R1 0<br />
	${un.Locate} &quot;$INSTDIR&quot; &quot;/L=DE&quot; &quot;un.LocateCallBack&quot;<br />
	IntOp $R3 $R3 + 1<br />
	IntOp $R2 $R2 + $R1<br />
	StrCmp $R0 StopLocate +2<br />
	StrCmp $R1 0 0 loop<br />
<br />
	IfErrors 0 +2<br />
	MessageBox MB_OK 'error' IDOK +2<br />
	MessageBox MB_OK '$R2 directories were removed$\n$R3 loops'<br />
SectionEnd<br />
<br />
Function un.LocateCallBack<br />
	MessageBox MB_YESNOCANCEL 'Delete empty &quot;$R9&quot;?' IDNO end IDCANCEL cancel<br />
	RMDir $R9<br />
	IntOp $R1 $R1 + 1<br />
	goto end<br />
<br />
	cancel:<br />
	StrCpy $R0 StopLocate<br />
<br />
	end:<br />
	Push $R0<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Swapan Das</div><div class="date">16th January 2007, 13:14</div></div><div class="posttext">Thanks once again Red Wine!<br />
<br />
So its ${un.Locate} , what I assumed is to be used here. My coding has not given any error during compilation this time.<br />
<br />
But yours code is much cleaner. I wanted it automated, without any user interference so I didn't added the Message Box.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">16th January 2007, 13:21</div></div><div class="posttext">But yours code is much cleaner.Actually the code is from the included examples :) (thanks goes to Instructor)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>