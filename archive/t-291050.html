<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" File Request Return Value in nsdialogs, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  File Request Return Value in nsdialogs NSIS Discussion" />
	
	<title> File Request Return Value in nsdialogs [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  File Request Return Value in nsdialogs</div>
<hr />
<div class="pda"><a href="t-291050.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=291050">File Request Return Value in nsdialogs</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">canute</div><div class="date">30th April 2008, 03:25</div></div><div class="posttext">I'm using a custom dialog with nsdialogs to get the user to select a file. Im using a file request text box with a browse button for this. Im also using a variable to hold and remember the state of the text box with the user selects a file using the browse button. My problem occurs when the user cancels browsing for the file instead of selecting it. In this case it's supposed to return a blank value &quot;&quot;. But instead it returns a random number sometimes. Here are the relevant parts of the script ... <br />
<br />
<br />
Function InstallSelect<br />
nsDialogs::Create /NOUNLOAD 1018<br />
Pop $PathForInstallDialog<br />
<br />
${If} $PathForInstallDialog == error<br />
        MessageBox MB_ICONSTOP|MB_OK &quot;Error drawing dialog. Please try Setup again.&quot; /SD IDOK<br />
        Quit<br />
${EndIf}<br />
<br />
; Create Controls<br />
${NSD_CreateGroupBox} 0 0 100% 100% &quot;&quot;<br />
Pop $PathForInstallGroupBox<br />
<br />
${NSD_CreateLabel} 10u 17u 280u 24u &quot;Please select the install file, and click next to continue&quot;<br />
Pop $PathForInstallLabel<br />
<br />
${NSD_CreateFileRequest} 10u 86u 260u 12u $PathForInstallFileRequestState<br />
Pop $PathForInstallFileRequest<br />
<br />
${NSD_CreateBrowseButton} 275u 86u 15u 12u &quot;...&quot;<br />
Pop $PathForInstallFileBrowse<br />
GetFunctionAddress $0 OnBrowseForFile<br />
nsDialogs::OnClick /NOUNLOAD $PathForInstallFileBrowse $0<br />
<br />
nsDialogs::Show ;Display the dialog<br />
FunctionEnd<br />
<br />
<br />
Function OnBrowseForFile<br />
<br />
        nsDialogs::SelectFileDialog /NOUNLOAD &quot;open&quot; &quot;&quot; &quot;All files (*.*)|*.*&quot;<br />
        Pop $0<br />
        StrCpy $PathForInstallFileRequestState $0<br />
        ${NSD_SetText} $PathForInstallFileRequest $PathForInstallFileRequestState<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">{_trueparuex^}</div><div class="date">30th April 2008, 13:01</div></div><div class="posttext">Yes the problem is that when the file request is canceled nsDialogs doesn't push anything on the stack. The random numbers you get is the next value from the stack (probably a HWND of some control).<br />
<br />
You can workaround this problem by using something like this...<br />
<br />
Function OnBrowseForFile<br />
<br />
; Push something on the stack.<br />
Push ?<br />
nsDialogs::SelectFileDialog /NOUNLOAD &quot;open&quot; &quot;&quot; &quot;All files (*.*)|*.*&quot;<br />
Pop $0<br />
; if &quot;?&quot; is still on the top of the stack file request was canceled and we skip the rest of the code.<br />
StrCmp $0 ? canceled<br />
StrCpy $PathForInstallFileRequestState $0<br />
${NSD_SetText} $PathForInstallFileRequest $PathForInstallFileRequestState<br />
; nsDialogs pushed something on the stack so we still need to pop the &quot;?&quot; of the stack.<br />
Pop $0<br />
canceled:<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">canute</div><div class="date">30th April 2008, 15:59</div></div><div class="posttext">Ah, silly of me not to realize that. Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd May 2008, 00:08</div></div><div class="posttext">That'd be a bug and should be properly reported.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>