<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Possible macro bug?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Possible macro bug? NSIS Discussion" />
	
	<title> Possible macro bug? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Possible macro bug?</div>
<hr />
<div class="pda"><a href="t-204053.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=204053">Possible macro bug?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">mattwilkinson</div><div class="date">6th January 2005, 10:20</div></div><div class="posttext">I have written a macro to unregister my activex exe's and then delete them. However there seems to be a problem. where the macro is called but the delete line is never reached: This is the macro:<br />
<br />
!macro UnRegActiveXEXEDel sPathAndApp<br />
  <br />
    Exec '&quot;${sPathAndApp}&quot; /unregserver'<br />
    IfErrors 0 +2    <br />
      DetailPrint &quot;Error UnRegistering ${sPathAndApp}&quot;<br />
      <br />
    Delete &quot;${sPathAndApp}&quot;<br />
    <br />
!macroend  <br />
<br />
<br />
I then call it using:<br />
  !insertmacro UnRegActiveXEXEDel &quot;$INSTDIR\VCTTools\Type003\AirBag.exe&quot;<br />
<br />
But in the uninstall list box only the 'exec' line is called and therefore displayed. If I change the IfErrors line to 0 +1 then the Error message is always displayed so the code is passing through. <br />
<br />
Can anyone shed any light on what might be wrong, or is it a bug?<br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th January 2005, 11:25</div></div><div class="posttext">Works fine for me. It is possible no message ie being displayed because the file can not be found.<br />
<br />
BTW, you are missing a ClearErrors instruction before Exec.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobGrant</div><div class="date">6th January 2005, 11:27</div></div><div class="posttext">Weeerrll...so basically your question is more to do with the delete command than the macro? You might want to be clever and try using the /REBOOTOK flag like so:<br />
<br />
<br />
Delete /REBOOTOK &quot;${sPathAndApp}&quot;<br />
<br />
<br />
and then either waiting for the installer to finish (in which case if the file needs to be deleted on reboot because it is locked then the system will prompt you) or (in production) use this (http://nsis.sourceforge.net/archive/viewpage.php?pageid=378) to check whether it needs to be rebooted and flash up an appropriate warning message. Or something.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobGrant</div><div class="date">6th January 2005, 11:29</div></div><div class="posttext">Oh er, I assume you've tried like MessageBox MB_OK &quot;${sPathAndApp}&quot; to check the file exists that way. You can even use the built-in IfFileExists command. Good, eh?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mattwilkinson</div><div class="date">6th January 2005, 11:46</div></div><div class="posttext">To try and answer in order. I currently have a whole host of commands to unregister the exe's and then a load more to delete them:<br />
<br />
Exec '&quot;$INSTDIR\VCTTools\Type003\AirBag.exe&quot; /unregserver'<br />
.<br />
.<br />
.<br />
Exec '&quot;$INSTDIR\VCTTools\Type003\StartNisn.exe&quot; /unregserver'<br />
<br />
Delete &quot;$INSTDIR\VCTTools\Type003\AirBag.exe&quot;<br />
.<br />
.<br />
.<br />
Delete &quot;$INSTDIR\VCTTools\Type003\StartNisn.exe&quot;<br />
<br />
This as it stands works ok, but what I wanted to do was combine these two into one macro so that if any changes need to be made then it is in one place instead of two. When I used the macro, the delete doesn't work. So the answer to the file exists question is yes it does exist.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobGrant</div><div class="date">6th January 2005, 11:52</div></div><div class="posttext">Ok, so it is something to do with the order in which things happen? Whereas before you were unregistering all before deleting, now you are deleting some before others are unregistered. Could it be that still-registered exes are preventing the deletion of a newly-unregistered exe?<br />
<br />
If this doesn't help you could do something like have a macro which unregisters and then places the file&amp;path on the stack, with say a $counter variable, then when all of the unregistering has been done simply call a function which unwinds the stack $counter number of times, deleting each thing it finds on it. <br />
<br />
Or something...<br />
<br />
BTW how is Stoke? You aren't a million miles away from me :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th January 2005, 12:02</div></div><div class="posttext">Try using ExecWait instead of Exec so NSIS will wait until the executable finishes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobGrant</div><div class="date">6th January 2005, 12:10</div></div><div class="posttext">Oh heh it could just be that, lol!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobGrant</div><div class="date">6th January 2005, 12:21</div></div><div class="posttext">Having said that, that's quite alot slower than all of the unregs being performed with Exec (i.e. slightly more in parallel), and perhaps just having the final unreg performed with ExecWait (assuming roughly standard time taken to unreg).<br />
<br />
ExecWaiting all of them will slow it down cos it's being done in strict serial.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mattwilkinson</div><div class="date">6th January 2005, 12:44</div></div><div class="posttext">ExecWait seems to be the answer to my prayers. I must have still been unregistering it when I tried to delete it and so failed - no message is displayed in the list box to say it has even been called though which is what confused me!<br />
<br />
Thanks for the help.<br />
<br />
BTW I'm don't mind that the uninstall is slow - that is a small price to pay!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th January 2005, 19:28</div></div><div class="posttext">You could always print a message in the InstFiles window with DetailPrint...<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>