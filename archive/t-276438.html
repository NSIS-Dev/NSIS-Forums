<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" What's wrong with my code? (MSDE, osql), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  What's wrong with my code? (MSDE, osql) NSIS Discussion" />
	
	<title> What's wrong with my code? (MSDE, osql) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  What's wrong with my code? (MSDE, osql)</div>
<hr />
<div class="pda"><a href="t-276438.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=276438">What's wrong with my code? (MSDE, osql)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">govmust</div><div class="date">25th August 2007, 15:03</div></div><div class="posttext">I'm making installer that needs to install MSDE, start service and then run a script to make a database and fill it with data.<br />
I test and create a code on a same computer using multiboot (primary C: for coding , secondary D: for testing). Both are WinXP SP2, secondary has almost nothing installed (os, drivers, winrar, av &amp; trueimage so I can have a clean system in 10mins).<br />
<br />
So far my code is:<br />
...<br />
ExecWait '&quot;MSDE2000A\Setup.exe&quot; /wait /qn+ SAPWD=$DBPASS INSTANCENAME=BLA SECURITYMODE=SQL'<br />
...<br />
ExecWait &quot;net start MSSQL$BLA&quot;<br />
...<br />
SetOutPath $INSTDIR<br />
File script.sql<br />
...<br />
ExecWait '&quot;osql -U $DBUSER -P $DBPASS -S $COMPNAME\BLA -i $INSTDIR\script.sql -o $INSTDIR\script.rpt&quot;' $0<br />
...<br />
That last line is problem.<br />
<br />
If run on a clean system (secondary) it installs msde, runs service and fails to execute script.<br />
If I try it in command prompt everything is fine (I've put a bunch of messageboxes so I can check what has happend). I'm sure it something silly but after hours of testing I just don't see it.<br />
HELP PLEASE?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">25th August 2007, 15:12</div></div><div class="posttext">You probably need to put the path in as well as the extension.<br />
<br />
; Read the path for osql, put it in $1<br />
ExecWait '&quot;$1\osql.exe&quot; -U $DBUSER -P $DBPASS -S $COMPNAME\BLA -i $INSTDIR\script.sql -o $INSTDIR\script.rpt' $0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">govmust</div><div class="date">25th August 2007, 15:23</div></div><div class="posttext">Hmm...<br />
Thanks for that fast reply.<br />
<br />
Don't think that is the problem since in earlier version I used:<br />
<br />
ExecWait &quot;scm.exe -Action 1 -Service MSSQL$BLA -silent 2&quot;<br />
<br />
instead of <br />
<br />
ExecWait &quot;net start MSSQL$BLA&quot;<br />
<br />
and it worked. AFAIK both scm.exe and osql are part of msde.<br />
Still, its worth a try.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgiusto</div><div class="date">25th August 2007, 23:23</div></div><div class="posttext">Have you spaces in $INSDIR? If so you shuld put it in quotes.<br />
Consider using nsExec::ExecToLog instead of execwait so to get the output of OSQL and check it<br />
Consider also to replace OSQL with MSSQL_OLEDB plugin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">govmust</div><div class="date">27th August 2007, 08:32</div></div><div class="posttext">Thanks for all your help.<br />
It worked!<br />
Problem was in paths just like JasonFriday13 said:<br />
After testing, code now looks like:<br />
...<br />
ExecWait &quot;$UTILPATH\scm.exe -Action 1 -Service MSSQL$BLA -silent 2&quot;<br />
...<br />
ExecWait '&quot;$UTILPATH\osql&quot; -U$DBUSER -P $DBPASS -S $COMPNAME\BLA -i $INSTDIR\1_Tables.sql -o $INSTDIR\1_Tables.rpt' $0<br />
...<br />
<br />
sgiusto, I've considered using your plugin but decided not to because off:<br />
Excecutes a SQL query contained in a file<br />
     &lt;scriptfile&gt; - Path to file containing the script to execute (max 60000 bytes)<br />
In final version of installer I have 4 scripts totaling 2.75MB :D</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>