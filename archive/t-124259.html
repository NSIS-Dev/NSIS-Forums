<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How do i cal and exe to run?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How do i cal and exe to run? NSIS Discussion" />
	
	<title> How do i cal and exe to run? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How do i cal and exe to run?</div>
<hr />
<div class="pda"><a href="t-124259.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=124259">How do i cal and exe to run?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">logoguy</div><div class="date">7th February 2003, 21:22</div></div><div class="posttext">I am trying to install a bat and some files to a temp directory and then run the bat and then after the bat has benn completed delete the temp files (i dont mind if they stay there but it would help if they could be deleted).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th February 2003, 21:34</div></div><div class="posttext">I would go with nsExec. It will wait for the batch and prevent a DOS window from coming up. Depending on what function you call it will log the output to the install log, or push it to the stack.<br />
<br />
For example:<br />
<br />
GetTempFileName $0<br />
File /oname=$0 mybatch.bat<br />
nsExec::execToLog $0<br />
Delete $0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">logoguy</div><div class="date">7th February 2003, 21:42</div></div><div class="posttext">okay that was spanish to me. I dont understand i am not a coder (hardware guy) Can you simlify that for me. Ir could you show me the code/command i wouold type into a text file for a nsis script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th February 2003, 21:48</div></div><div class="posttext">I did exactly that... GetTempFileName etc.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">logoguy</div><div class="date">7th February 2003, 21:50</div></div><div class="posttext">I can see that but am i able to use that in the nsis file and if so how do i place it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th February 2003, 21:52</div></div><div class="posttext">A section.<br />
<br />
For example:<br />
<br />
Section &quot;run my batch file&quot;<br />
# copy above code here<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">logoguy</div><div class="date">7th February 2003, 22:05</div></div><div class="posttext">okay did that and here is the ouput from the compiled install<br />
---------<br />
Output folder: C:\temp<br />
Extract: patch.exe<br />
Extract: run.bat<br />
Extract: simcity4-NA.RTP<br />
Extract: Readme.txt<br />
Extract: C:\DOCUME~1\CHRIS~1.CHR\LOCALS~1\Temp\nst34.tmp<br />
Could not find symbol: execToLog<br />
Completed<br />
---------<br />
<br />
And here is the script<br />
---------<br />
; example1.nsi<br />
;<br />
; This script is perhaps one of the simplest NSIs you can make. All of the<br />
; optional settings are left to their default settings. The installer simply <br />
; prompts the user asking them where to install, and drops a copy of makensisw.exe<br />
; there. <br />
;<br />
<br />
; The name of the installer<br />
Name &quot;Simcity4 patch installer&quot;<br />
<br />
; The file to write<br />
OutFile &quot;patcher.exe&quot;<br />
<br />
; The default installation directory<br />
InstallDir C:\temp<br />
<br />
; The text to prompt the user to enter a directory<br />
DirText &quot;This will place the patch files on your computer. Choose a directory&quot;<br />
<br />
; The stuff to install<br />
Section &quot;ThisNameIsIgnoredSoWhyBother?&quot;<br />
  ; Set output path to the installation directory.<br />
  SetOutPath $INSTDIR<br />
  ; Put file there<br />
  File patch.exe<br />
  File run.bat<br />
  File simcity4-NA.RTP<br />
  File Readme.txt<br />
SectionEnd ; end the section<br />
Section &quot;running batch&quot;<br />
GetTempFileName $0<br />
File /oname=$0 run.bat<br />
nsExec::execToLog $0<br />
SectionEnd<br />
<br />
; eof<br />
-------<br />
<br />
What am i doing wrong?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th February 2003, 22:09</div></div><div class="posttext">OK, you are probably using b0 and not the latest CVS version. There was a bug that caused NSIS to be syntax sensitive on function names so you'll need to replace nsExec::execToLog with nsExec::ExecToLog.<br />
<br />
And please attach large scripts next time, it makes the forum easier to read.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">logoguy</div><div class="date">7th February 2003, 22:16</div></div><div class="posttext">okay it did not post ne errors but it did not give me a a log nor did it pop up run the bat file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th February 2003, 22:23</div></div><div class="posttext">I don't understand. What do you mean by &quot;pop up run the bat file.&quot;? Did it not run the batch file or only didn't pop up something? It is not supposed to pop up anything, it is supposed to copy any output from the batch file to the installer log. If the batch file doesn't have any output it won't nothing in the log. Did the batch file do his job or not?<br />
<br />
A possible problem might be that the batch file assumes a certain current directory. The current directory of the installer is the directory in which it started. In the next version (that will hopefully come out tomorrow) there will be an option to change the current directory.<br />
<br />
For now, if this is indeed the problem, you dynamically write the batch file from NSIS using FileOpen, FileWrite and FileClose.<br />
<br />
But first try to give the batch file a .bat extension. Use:<br />
<br />
GetTempFileName $0<br />
Delete $0<br />
StrCpy $0 &quot;$0.bat&quot;<br />
File /oname=$0 mybatch.bat<br />
nsExec::ExecToLog $0<br />
Delete $0<br />
<br />
Instead of the code above.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">logoguy</div><div class="date">7th February 2003, 22:26</div></div><div class="posttext">okay the bat file is being extracted to the dorevtory with the rest of the files (in this i case i have it set to &quot;c:\temp&quot; i think it is not finding th bat to run how do i set the directory of the bat. I am thinking it has something to do with the &quot;gettempfilename&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th February 2003, 22:33</div></div><div class="posttext">Can you please attach the batch file? I just want to make sure it is really needed to set the current directory.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">logoguy</div><div class="date">7th February 2003, 22:35</div></div><div class="posttext">umm it is one line, it is a command line app that has to run to open and use this other file that patches simcity4. and what i need to do is just run the bat file in the directory that all the files were extracted to.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th February 2003, 22:39</div></div><div class="posttext">OK, then here is what you should use:<br />
<br />
GetTempFileName $0<br />
Delete $0<br />
StrCpy $0 &quot;$0.bat&quot;<br />
FileOpen $1 $0 &quot;w&quot;<br />
FileWrite $1 &quot;@echo off$\r$\n&quot;<br />
StrCpy $2 $TEMP 2<br />
FileWrite $1 &quot;$2$\r$\n&quot;<br />
FileWrite $1 &quot;cd $TEMP$\r$\n&quot;<br />
FileWrite $1 &quot;simcity4patcher.exe$\r$\n&quot;<br />
FileClose $1<br />
nsExec::ExecToLog $0<br />
Delete $0<br />
<br />
Replace simcity4patcher.exe with the right file name and you're set.<br />
<br />
This piece of code create a new batch file that CDs to the $TEMP directory and launches the file from there. This will make sure it runs from the right current directory.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">logoguy</div><div class="date">7th February 2003, 22:43</div></div><div class="posttext">I am running an exe that has to ahve commands all i need is to launch a file that is extracted. I think ur going a little ober board.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th February 2003, 22:48</div></div><div class="posttext">OK, you can always try to just extract the file, and use ExecWait on it. Earlier you said it was looking for files in his current directory, this way he won't find them. Trying never hurts though :P<br />
<br />
Try:<br />
<br />
SetOutPath $TEMP\SimCityPatcher<br />
File patcher.exe<br />
File otherfiles.dat<br />
#... more files<br />
ExecWait $TEMP\patcher.exe<br />
RMDir /R $TEMP\SimCityPatcher<br />
<br />
If it says it can't find the files you'll have to do it with the code above.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">logoguy</div><div class="date">7th February 2003, 22:53</div></div><div class="posttext">Isnt there just a snipet that lets me launch a file from a specific directory (or in this case the one the files were installed to)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th February 2003, 22:57</div></div><div class="posttext">Until tomorrow's version that's the code above. Didn't ExecWait work?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">logoguy</div><div class="date">7th February 2003, 22:59</div></div><div class="posttext">okay, got it with the execwait command now how do i log what happend in the commmand promt.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th February 2003, 23:02</div></div><div class="posttext">To get the output into the log use nsExec::ExecToLog instead of ExecWait.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">logoguy</div><div class="date">7th February 2003, 23:20</div></div><div class="posttext">-------<br />
Output folder: C:\temp<br />
Extract: patch.exe<br />
Extract: run.bat<br />
Extract: simcity4-NA.RTP<br />
Extract: Readme.txt<br />
'run.bat' is not recognized as an internal or external command,<br />
operable program or batch file.<br />
Completed<br />
--------<br />
that is what it gave me when i used the &quot;nsExec::ExecToLog&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th February 2003, 23:22</div></div><div class="posttext">Use nsExec::ExecToLog on the exe too, not the batch file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">logoguy</div><div class="date">7th February 2003, 23:24</div></div><div class="posttext">I am not trying to launch the exe the bat file does that there is not need to launch the exe it will just flach the program and what is used for and exit (it is a command line prog)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th February 2003, 23:29</div></div><div class="posttext">Did ExecWait work with the batch file or the exe?<br />
Why don't you want to run the exe? You said that the batch file only calls the exe anyway, so why not let nsExec do it?<br />
<br />
It will all be a lot easier if you ZIP the batch file and the script and attach them here.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">logoguy</div><div class="date">7th February 2003, 23:33</div></div><div class="posttext">the batch it worked great with the batch</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th February 2003, 23:35</div></div><div class="posttext">Are you sure you have added $TEMP to the batch name? Because according to the error it searches for just run.bat and not $TEMP\run.bat.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">logoguy</div><div class="date">7th February 2003, 23:37</div></div><div class="posttext">i mean the ExecWait worked great witht he patch.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">logoguy</div><div class="date">7th February 2003, 23:38</div></div><div class="posttext">I decided not to put the bat file in a temp dorectory. I decide to just run it from the directory i extracted it too.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th February 2003, 23:39</div></div><div class="posttext">And did you add $TEMP?<br />
<br />
Can you please attach the batch file?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">logoguy</div><div class="date">7th February 2003, 23:43</div></div><div class="posttext">The script calls a prompt that runs the exe and a command atached. Cuz the exe cant be run with out the command to do what it has to do with this other file. I am not just calling an exe from the command promt it is a comand line tool that cant be run with out the being in a command prompt or a bat. I no this is all confusing to you i am sorry this seems so vauge.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">logoguy</div><div class="date">7th February 2003, 23:52</div></div><div class="posttext">This is the bat (it is a txt cuz it wont let me upload a file with the bat extension) it is one line.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th February 2003, 00:05</div></div><div class="posttext">Good, now that we have the batch file I can tell you you don't need it. Just use:<br />
<br />
nsExec::ExecToLog '&quot;$TEMP\patch.exe&quot; &quot;$TEMP\simcity4-NA.RTP&quot;'<br />
<br />
NSIS can pass on command line arguments, you don't need no batch file for that. The above line should work.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">logoguy</div><div class="date">8th February 2003, 00:42</div></div><div class="posttext">It is working thank you so much</div></div><hr />


<div class="post"><div class="posttop"><div class="username">logoguy</div><div class="date">8th February 2003, 00:48</div></div><div class="posttext">how do i launch a readme?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th February 2003, 12:26</div></div><div class="posttext">Use ExecShell. For example:<br />
<br />
ExecShell open &quot;$INSTDIR\readme.html&quot;<br />
<br />
If you are using the Modern UI read its readme there is a better way.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>