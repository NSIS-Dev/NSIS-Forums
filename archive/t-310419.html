<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Help: Custom Page with MUI not working, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Help: Custom Page with MUI not working NSIS Discussion" />
	
	<title> Help: Custom Page with MUI not working [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Help: Custom Page with MUI not working</div>
<hr />
<div class="pda"><a href="t-310419.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=310419">Help: Custom Page with MUI not working</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">File077</div><div class="date">21st August 2009, 05:05</div></div><div class="posttext">For some reason, my custom page doesn't run.<br />
<br />
<br />
I know it is allot of code, but please take a look.<br />
<br />
The point is they could have 2 totally different install types, so I want a screen before the directory choice that says:<br />
RadioButton &quot;Default Installation (this user)&quot;<br />
RadioButton &quot;All Users (--nohomedir)&quot;<br />
Then depending on what they choose, I will have a better chance of pre-deterining the install path using the registration keys.<br />
<br />
This is a work in progress, so messy, but here we have it..<br />
<br />
http://nsis.pastebin.com/m52ae8546  Line 179<br />
I also tried.<br />
http://nsis.pastebin.com/m4d2fca04 Line 170 and 179<br />
<br />
Current code compiles, but I am in the middle of trying:<br />
<br />
/******************************************************************************<br />
;NSIS Modern User Interface<br />
;Copyright 2004-2009 Josh Lee<br />
; Special thanks to Bob Gneu for helping with the Registry Key logic of UT3<br />
;--------------------------------<br />
<br />
-1 Compressor Setings<br />
-2 User Over-ridable Config<br />
-3 Constants<br />
-4 Registry Information<br />
-5 Variable Decleration<br />
-6 Pages<br />
-7 Language Definition<br />
-8 Section Over-rides<br />
-8.5  Page Overrides (after sections for variable def.)<br />
-9 Function Decleration<br />
******************************************************************************/<br />
<br />
!include &quot;MUI2.nsh&quot;<br />
!include FileFunc.nsh<br />
!include &quot;StrFunc.nsh&quot;<br />
${StrRep}<br />
<br />
;=== Runtime Switches<br />
SetCompress 			Auto<br />
SetCompressor 			/SOLID lzma<br />
SetCompressorDictSize 	32<br />
SetDatablockOptimize 	On<br />
XPStyle 				on<br />
CRCCheck    			on<br />
AutoCloseWindow 		True<br />
;Request application privileges for Windows Vista<br />
RequestExecutionLevel 	user<br />
###############################################################################<br />
###############################################################################<br />
# Begin Config<br />
;--------------------------------<br />
;General<br />
<br />
	;Name and file<br />
	 NAME &quot;Unreal Tournament 3 - Jailbreak&quot;<br />
	!define VERSION &quot;Alpha9&quot;<br />
	!define SHORTNAME &quot;JB_${VERSION}&quot;<br />
	!define UNINSTALLER &quot;Uninstall_Jailbreak.exe&quot;<br />
	; Version of installer in X.X.X.X format (requried by NSIS2 MUI)<br />
	!define JAILBREAK_INSTALLER_VERSION &quot;1.0.0.0&quot;<br />
	<br />
	; Installer File name<br />
	OutFile &quot;${SHORTNAME}_Installer.exe&quot;<br />
	<br />
	 ;Default installation folder<br />
    InstallDir &quot;$DOCUMENTS\My Games\Unreal Tournament 3\UTGame\Published\CookedPC&quot;<br />
	<br />
	; images<br />
	;=== Icon &amp; Stye ===<br />
	!define AP_ICON &quot;required_files\JBIcon.ico&quot;<br />
	!define LOGO &quot;required_files\logo.bmp&quot;<br />
<br />
	;=== BEGIN: BASIC INFORMATION<br />
	!define NAME &quot;Unreal Tournament 3 - Jailbreak x&quot;<br />
	!define Caption &quot;${NAME} - Installer&quot;<br />
	;=== Program Icon<br />
	Icon &quot;${AP_ICON}&quot;<br />
	!define STARTMENUFOLDER &quot;Unreal Tournament 3\PlanetJailbreak.com&quot;<br />
	!define DEFAULT_DESTINATION &quot;${InstallDir}&quot;<br />
	!define CHECKRUNNING &quot;UT3.exe&quot;<br />
	!define CLOSENAME &quot;Unreal Tournament 3&quot;<br />
	!define PRODUCT_WEB_SITE &quot;http://www.PlanetJailbreak.com&quot;<br />
	!define INSTALLERCOMMENTS &quot;For additional details, visit PlanetJailbreak.com xxx:todo&quot;<br />
	!define INSTALLERADDITIONALTRADEMARKS &quot;Jailbreak is a Trademark of PlanetJailbreakâ„¢&quot; ;end this entry with a period and a space if used<br />
	!define INSTALLERLEGALCOPYRIGHT &quot;PlanetJailbreakâ„¢ and contributors.&quot;<br />
	!define LICENSEAGREEMENT &quot;required_files\JBLicense.txt&quot;<br />
	!define PRODUCT_COMPANY &quot;PlanetJailBreak.com&quot;<br />
	!define PRODUCT_UNINST_KEY 		&quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_COMPANY}&quot;<br />
	!define	PRODUCT_UNINST_ROOT_KEY &quot;HKLM&quot;<br />
	!define MESSAGE_INTRO		&quot;UT3 Jailbreak has been installed.&quot;<br />
	!define MESSAGE_SIGNATURE 	&quot;$\n$\nFor further assistance please use the forums at PlanetJailbreak.com. $\n$\n- UT3 Jailbreak | Project Lead - Wormbo&quot;<br />
	!define SUCCESS_MESSAGE 	&quot;${MESSAGE_INTRO} $\n$\nThere are shortcuts available to you in your installation directory. ${MESSAGE_SIGNATURE}&quot;<br />
	!define FAILURE_MESSAGE 	&quot;${MESSAGE_INTRO} $\n$\nUnfortunately your UT3 installation was not found in the registry. ${MESSAGE_SIGNATURE}&quot;<br />
	;Interface Settings<br />
	;=== Header Icon<br />
    !define MUI_ICON &quot;${AP_ICON}&quot;<br />
	!define MUI_ABORTWARNING<br />
	!define MUI_WELCOMEFINISHPAGE_BITMAP &quot;${LOGO}&quot;<br />
	!define MUI_PAGE_CUSTOMFUNCTION_LEAVE LeaveDirectory<br />
	<br />
	;Get installation folder from registry if available<br />
	InstallDirRegKey HKCU &quot;Software\Jailbreak&quot; &quot;&quot;<br />
	# Command Line<br />
	!define UT3_BINARY_LOC 				&quot;Binaries\UT3.exe&quot;<br />
	!define STEAM_UT3_DIR               &quot;\steamapps\common\unreal tournament 3\&quot;<br />
<br />
	!define UT3_CMD_OPTIONS 			&quot;-mod=..\Jailbreak -solomod&quot;<br />
<br />
	!define EDITOR_LNK  				&quot;UnrealED - Jailbreak.lnk&quot;<br />
	!define GAME_LNK 					&quot;Play Jailbreak.lnk&quot;<br />
# End Config<br />
###############################################################################<br />
###############################################################################<br />
# Begin Constants<br />
;--------------------------------------------------------------------------------------------------------------------<br />
#  Branding Variables<br />
;!include &quot;required_files\constants.nsh&quot;<br />
	BrandingText &quot;${INSTALLERLEGALCOPYRIGHT}&quot;<br />
	VIProductVersion &quot;${JAILBREAK_INSTALLER_VERSION}&quot;<br />
	VIAddVersionKey ProductName &quot;${NAME}&quot;<br />
	VIAddVersionKey Comments &quot;${INSTALLERCOMMENTS}&quot;<br />
	VIAddVersionKey PRODUCT_COMPANY &quot;${PRODUCT_COMPANY}&quot;<br />
	VIAddVersionKey ProductWebsite &quot;${PRODUCT_WEB_SITE}&quot;<br />
	VIAddVersionKey Website &quot;${PRODUCT_WEB_SITE}&quot;<br />
	VIAddVersionKey LegalCopyright &quot;${INSTALLERLEGALCOPYRIGHT}&quot;<br />
	VIAddVersionKey FileDescription &quot;${NAME}&quot;<br />
	VIAddVersionKey FileVersion &quot;${VERSION}&quot;<br />
	VIAddVersionKey ProductVersion &quot;${VERSION}&quot;<br />
	VIAddVersionKey InternalName &quot;${NAME}&quot;<br />
	VIAddVersionKey LegalTrademarks &quot;${INSTALLERADDITIONALTRADEMARKS}&quot;<br />
	VIAddVersionKey OriginalFilename &quot;${FILENAME}.paf.exe&quot;<br />
	VIAddVersionKey PlanetJailbreak.comInstallerVersion &quot;${JAILBREAK_INSTALLER_VERSION}&quot;<br />
# End Constants<br />
###############################################################################<br />
###############################################################################<br />
# Begin  Registry Information<br />
;--------------------------------------------------------------------------------------------------------------------<br />
#  Registry Key Variables<br />
;!include &quot;required_files\registry_keys.nsh&quot;<br />
<br />
;--------------------------------<br />
<br />
	# UT3 CU Registry Keys<br />
	!define INSTALL_CU_KEY_UNK1_32 		&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{C019D439-E7F8-49EB-85FA-6D0C8CCBDA23}&quot;<br />
	!define INSTALL_CU_KEY_UNK2_32 		&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{A007C579-B78D-4FDE-A85A-16987A251E53}&quot;<br />
	!define INSTALL_CU_KEY_UNK3_32 		&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{FDBBAF14-5ED8-49B7-A5BE-1C35668B074D}&quot;<br />
	!define INSTALL_CU_KEY_UNK4_32 		&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{69082C6E-1944-4EAD-B119-06DCBF492C3F}&quot;<br />
	!define INSTALL_CU_KEY_US_WIN_32 	&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{BFA90209-7AFF-4DB6-8E4B-E57305751AD7}&quot;<br />
	!define INSTALL_CU_KEY_UNK1_64 		&quot;SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{C019D439-E7F8-49EB-85FA-6D0C8CCBDA23}&quot;<br />
	!define INSTALL_CU_KEY_UNK2_64 		&quot;SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{A007C579-B78D-4FDE-A85A-16987A251E53}&quot;<br />
	!define INSTALL_CU_KEY_UNK3_64 		&quot;SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{FDBBAF14-5ED8-49B7-A5BE-1C35668B074D}&quot;<br />
	!define INSTALL_CU_KEY_UNK4_64 		&quot;SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{69082C6E-1944-4EAD-B119-06DCBF492C3F}&quot;<br />
	!define INSTALL_CU_KEY_US_WIN_64 	&quot;SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\InstallShield_{BFA90209-7AFF-4DB6-8E4B-E57305751AD7}&quot;<br />
<br />
	# UT3 LM Registry Keys<br />
	!define INSTALL_LM_KEY_UNK1_32 		&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{C019D439-E7F8-49EB-85FA-6D0C8CCBDA23}&quot;<br />
	!define INSTALL_LM_KEY_UNK2_32 		&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{A007C579-B78D-4FDE-A85A-16987A251E53}&quot;<br />
	!define INSTALL_LM_KEY_UNK3_32 		&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{FDBBAF14-5ED8-49B7-A5BE-1C35668B074D}&quot;<br />
	!define INSTALL_LM_KEY_UNK4_32 		&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{69082C6E-1944-4EAD-B119-06DCBF492C3F}&quot;<br />
	!define INSTALL_LM_KEY_US_WIN_32 	&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{BFA90209-7AFF-4DB6-8E4B-E57305751AD7}&quot;<br />
	!define INSTALL_LM_KEY_UNK1_64 		&quot;SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\{C019D439-E7F8-49EB-85FA-6D0C8CCBDA23}&quot;<br />
	!define INSTALL_LM_KEY_UNK2_64 		&quot;SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\{A007C579-B78D-4FDE-A85A-16987A251E53}&quot;<br />
	!define INSTALL_LM_KEY_UNK3_64 		&quot;SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\{FDBBAF14-5ED8-49B7-A5BE-1C35668B074D}&quot;<br />
	!define INSTALL_LM_KEY_UNK4_64 		&quot;SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\{69082C6E-1944-4EAD-B119-06DCBF492C3F}&quot;<br />
	!define INSTALL_LM_KEY_US_WIN_64 	&quot;SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\{BFA90209-7AFF-4DB6-8E4B-E57305751AD7}&quot;<br />
	# Steam Registry Keys<br />
	!define INSTALL_KEY_STEAM      		&quot;Software\Valve\Steam&quot;<br />
<br />
<br />
# End Registry Information<br />
###############################################################################<br />
###############################################################################<br />
# Begin Variable Decleration<br />
;--------------------------------------------------------------------------------------------------------------------<br />
;Variables<br />
Var StartMenuFolder 	<br />
# End Variable Decloration<br />
###############################################################################<br />
###############################################################################<br />
# Begin Pages<br />
;--------------------------------------------------------------------------------------------------------------------<br />
;Pages<br />
	; Installer Pages<br />
	!define MUI_CUSTOMFUNCTION_GUIINIT CustomPageFunction<br />
<br />
	!define MUI_WELCOMEPAGE_TITLE &quot;Unreal Tournament 3 - Jailbreak&quot;<br />
	!insertmacro MUI_PAGE_WELCOME<br />
<br />
	!ifdef LICENSEAGREEMENT<br />
		!define MUI_LICENSEPAGE_CHECKBOX<br />
	!insertmacro MUI_PAGE_LICENSE &quot;${NSISDIR}\Docs\Modern UI\License.txt&quot;<br />
	!endif<br />
	Page custom CustomPageFunction <br />
	!insertmacro MUI_PAGE_COMPONENTS<br />
	!insertmacro MUI_PAGE_DIRECTORY<br />
	<br />
	;!define MUI_STARTMENUPAGE_REGISTRY_ROOT &quot;HKCU&quot; <br />
	;!define MUI_STARTMENUPAGE_REGISTRY_KEY &quot;Software\Jailbreak&quot; <br />
	;!define MUI_STARTMENUPAGE_REGISTRY_VALUENAME &quot;Start Menu Folder&quot;<br />
		!define MUI_STARTPAGE_TITLE &quot;Test&quot;<br />
	!insertmacro MUI_PAGE_STARTMENU Application $StartMenuFolder<br />
  <br />
  <br />
	!insertmacro MUI_PAGE_INSTFILES<br />
	<br />
		!define MUI_FINISHPAGE_TITLE &quot;Jailbreak&quot;<br />
	!insertmacro MUI_PAGE_FINISH<br />
		!define MUI_FINISHPAGE_TEXT &quot;$(finish)&quot;<br />
	; Un-installer Pages<br />
	!insertmacro MUI_UNPAGE_CONFIRM<br />
	!insertmacro MUI_UNPAGE_INSTFILES<br />
# End Pages<br />
Function CustomPageFunction<br />
  !insertmacro MUI_HEADER_TEXT &quot;Page Title&quot; &quot;Subtitle&quot;<br />
  ;!insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;${LICENSEAGREEMENT}&quot;<br />
FunctionEnd<br />
<br />
<br />
###############################################################################<br />
###############################################################################<br />
# Begin Language Definition<br />
;--------------------------------------------------------------------------------------------------------------------<br />
;Language Selection Dialog Settings<br />
	;Remember the installer language<br />
	!define MUI_LANGDLL_REGISTRY_ROOT &quot;HKCU&quot; <br />
	!define MUI_LANGDLL_REGISTRY_KEY &quot;Software\Jailbreak&quot; <br />
	!define MUI_LANGDLL_REGISTRY_VALUENAME &quot;Installer Language&quot;<br />
;--------------------------------------------------------------------------------------------------------------------<br />
;Languages<br />
;!include &quot;required_files\language_setup.nsh&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;English&quot; ;first language is the default language<br />
	 /*<br />
	  !insertmacro MUI_LANGUAGE &quot;French&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;German&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Spanish&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;SpanishInternational&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;SimpChinese&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;TradChinese&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Japanese&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Korean&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Italian&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Dutch&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Danish&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Swedish&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Norwegian&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;NorwegianNynorsk&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Finnish&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Greek&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Russian&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Portuguese&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;PortugueseBR&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Polish&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Ukrainian&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Czech&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Slovak&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Croatian&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Bulgarian&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Hungarian&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Thai&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Romanian&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Latvian&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Macedonian&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Estonian&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Turkish&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Lithuanian&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Slovenian&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Serbian&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;SerbianLatin&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Arabic&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Farsi&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Hebrew&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Indonesian&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Mongolian&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Luxembourgish&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Albanian&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Breton&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Belarusian&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Icelandic&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Malay&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Bosnian&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Kurdish&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Irish&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Uzbek&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Galician&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Afrikaans&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Catalan&quot;<br />
	  !insertmacro MUI_LANGUAGE &quot;Esperanto&quot;<br />
*/<br />
<br />
		;LangString welcome ${LANG_ENGLISH} &quot;This wizard will guide you through the installation of ${NAME}.\r\n\r\nIf you are upgrading an existing installation of ${NAME}, please close UT3 before proceeding.\r\n\r\nClick Next to continue.&quot;<br />
		LangString finish ${LANG_ENGLISH} &quot;${NAME} has been installed on your device.\r\n\r\nClick Finish to close this wizard.&quot;<br />
		LangString runwarning ${LANG_ENGLISH} &quot;Please close all instances of ${CLOSENAME} and then click OK.  Jailbreak Mod can not be upgraded while it is running.&quot;<br />
		LangString invaliddirectory ${LANG_ENGLISH} &quot;The destination folder you selected is invalid.  Please choose a valid folder.&quot;<br />
		LangString notenoughspace ${LANG_ENGLISH} &quot;The device you have selected to install to does not have enough free space for Jailbreak.&quot;<br />
;	LangString required ${LANG_ENGLISH} &quot;required&quot;<br />
		;LangString checkforplatform ${LANG_ENGLISH} &quot;Checking for previous install of Jailbreak&quot;<br />
		;LangString refreshmenu ${LANG_ENGLISH} &quot;Refreshing Jailbreak Menu&quot;<br />
<br />
!insertmacro MUI_RESERVEFILE_LANGDLL<br />
!insertmacro MUI_RESERVEFILE_LANGDLL<br />
# End Language Definition<br />
###############################################################################<br />
;--------------------------------------------------------------------------------------------------------------------<br />
;Reserve Files<br />
  <br />
  ;If you are using solid compression, files that are required before<br />
  ;the actual installation should be stored first in the data block,<br />
  ;because this will make your installer start faster.<br />
  <br />
###############################################################################<br />
###############################################################################<br />
# Begin Section Over-rides<br />
;--------------------------------<br />
;Installer Sections<br />
<br />
Section &quot;!Jailbreak (required)&quot; section_jailbreak_main<br />
SectionIn RO<br />
	SetOutPath $INSTDIR<br />
<br />
	;Store installation folder<br />
	WriteRegStr HKCU &quot;Software\Jailbreak&quot; &quot;&quot; $INSTDIR<br />
<br />
<br />
<br />
	# Begin copying necessary files over<br />
	;File /oname=$OUTDIR\readme.txt 		readme.txt<br />
	;File /oname=$OUTDIR\changelog.txt 	changelog.txt<br />
<br />
  	# CustomChars<br />
  	;CreateDirectory 	$OUTDIR\Screenshots<br />
<br />
  	;CreateDirectory 	$OUTDIR\Splash<br />
<br />
	;SetOutPath $INSTDIR\Splash<br />
	;File /oname=$OUTDIR\Splash.bmp 							..\..\Trunk\Splash\Splash.bmp<br />
	;File /oname=$OUTDIR\EdSplash.bmp 						..\..\Trunk\Splash\EdSplash.bmp<br />
<br />
	# Maps<br />
	CreateDirectory 	$INSTDIR\Maps<br />
	# Localization<br />
 	CreateDirectory 	$INSTDIR\Localization<br />
 	CreateDirectory 	$INSTDIR\Localization\DEU<br />
 	CreateDirectory 	$INSTDIR\Localization\ESN<br />
 	CreateDirectory 	$INSTDIR\Localization\FRA<br />
 	CreateDirectory 	$INSTDIR\Localization\INT<br />
 	CreateDirectory 	$INSTDIR\Localization\ITA<br />
<br />
	SetOutPath $INSTDIR\Localization<br />
<br />
    ; Write Uninstaller information<br />
<br />
	WriteUninstaller &quot;$INSTDIR\${UNINSTALLER}&quot;<br />
<br />
	WriteRegStr &quot;${PRODUCT_UNINST_ROOT_KEY}&quot; &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayName&quot; &quot;${NAME}&quot;<br />
	WriteRegStr &quot;${PRODUCT_UNINST_ROOT_KEY}&quot; &quot;${PRODUCT_UNINST_KEY}&quot; &quot;UninstallString&quot; &quot;$INSTDIR\${UNINSTALLER}&quot;<br />
	WriteRegStr &quot;${PRODUCT_UNINST_ROOT_KEY}&quot; &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayVersion&quot; &quot;${VERSION}&quot;<br />
	WriteRegStr &quot;${PRODUCT_UNINST_ROOT_KEY}&quot; &quot;${PRODUCT_UNINST_KEY}&quot; &quot;URLInfoAbout&quot; &quot;${PRODUCT_WEB_SITE}&quot;<br />
	WriteRegStr &quot;${PRODUCT_UNINST_ROOT_KEY}&quot; &quot;${PRODUCT_UNINST_KEY}&quot; &quot;Publisher&quot; &quot;${PRODUCT_COMPANY}&quot;<br />
	WriteRegStr &quot;${PRODUCT_UNINST_ROOT_KEY}&quot; &quot;${PRODUCT_UNINST_KEY}&quot; &quot;Install Date&quot; &quot;${__TIMESTAMP__}&quot;<br />
	    #######################################################################<br />
		# Sub Section Start Menu Begin<br />
		;!include &quot;required_files\start_menu.nsh&quot;<br />
		;Call setStartFolder<br />
		!insertmacro MUI_STARTMENU_WRITE_BEGIN Application<br />
<br />
			SetOutPath 			$INSTDIR<br />
<br />
		    # Get the path to the UT3 binary<br />
<br />
			<br />
			<br />
			WriteIniStr 		&quot;$INSTDIR\${PRODUCT_COMPANY}.url&quot; &quot;InternetShortcut&quot; &quot;URL&quot; &quot;${PRODUCT_WEB_SITE}&quot;<br />
			CreateDirectory 	&quot;$SMPROGRAMS\$StartMenuFolder&quot;<br />
			CreateShortCut 		&quot;$SMPROGRAMS\$StartMenuFolder\Website.lnk&quot; &quot;$INSTDIR\${PRODUCT_COMPANY}.url&quot;<br />
			CreateShortCut 		&quot;$SMPROGRAMS\$StartMenuFolder\Uninstall.lnk&quot; &quot;$INSTDIR\${UNINSTALLER}&quot;<br />
<br />
<br />
			ClearErrors<br />
<br />
			# Check Current User keys first<br />
			ReadRegStr $0 HKCU &quot;${INSTALL_CU_KEY_UNK1_32}&quot; 			'InstallLocation'<br />
		    IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
				ReadRegStr $0 HKCU &quot;${INSTALL_CU_KEY_UNK2_32}&quot; 		'InstallLocation'<br />
		    IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
				ReadRegStr $0 HKCU &quot;${INSTALL_CU_KEY_UNK3_32}&quot; 		'InstallLocation'<br />
			IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
				ReadRegStr $0 HKCU &quot;${INSTALL_CU_KEY_UNK4_32}&quot; 		'InstallLocation'<br />
			IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
				ReadRegStr $0 HKCU &quot;${INSTALL_CU_KEY_US_WIN_32}&quot; 	'InstallLocation'<br />
			IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
				ReadRegStr $0 HKCU &quot;${INSTALL_CU_KEY_UNK1_64}&quot; 		'InstallLocation'<br />
			IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
				ReadRegStr $0 HKCU &quot;${INSTALL_CU_KEY_UNK2_64}&quot; 		'InstallLocation'<br />
			IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
				ReadRegStr $0 HKCU &quot;${INSTALL_CU_KEY_UNK3_64}&quot; 		'InstallLocation'<br />
			IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
				ReadRegStr $0 HKCU &quot;${INSTALL_CU_KEY_UNK4_64}&quot; 		'InstallLocation'<br />
			IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
				ReadRegStr $0 HKCU &quot;${INSTALL_CU_KEY_US_WIN_64}&quot; 	'InstallLocation'<br />
			IfErrors 0 CheckFiles<br />
		    	ClearErrors # Check the Local Machine keys<br />
				ReadRegStr $0 HKLM &quot;${INSTALL_LM_KEY_UNK1_32}&quot; 		'InstallLocation'<br />
		    IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
				ReadRegStr $0 HKLM &quot;${INSTALL_LM_KEY_UNK2_32}&quot; 		'InstallLocation'<br />
		    IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
				ReadRegStr $0 HKLM &quot;${INSTALL_LM_KEY_UNK3_32}&quot; 		'InstallLocation'<br />
			IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
				ReadRegStr $0 HKLM &quot;${INSTALL_LM_KEY_UNK4_32}&quot; 		'InstallLocation'<br />
			IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
				ReadRegStr $0 HKLM &quot;${INSTALL_LM_KEY_US_WIN_32}&quot; 	'InstallLocation'<br />
			IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
				ReadRegStr $0 HKLM &quot;${INSTALL_LM_KEY_UNK1_64}&quot; 		'InstallLocation'<br />
			IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
				ReadRegStr $0 HKLM &quot;${INSTALL_LM_KEY_UNK2_64}&quot; 		'InstallLocation'<br />
			IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
				ReadRegStr $0 HKLM &quot;${INSTALL_LM_KEY_UNK3_64}&quot; 		'InstallLocation'<br />
			IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
				ReadRegStr $0 HKLM &quot;${INSTALL_LM_KEY_UNK4_64}&quot; 		'InstallLocation'<br />
			IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
				ReadRegStr $0 HKLM &quot;${INSTALL_LM_KEY_US_WIN_64}&quot; 	'InstallLocation'<br />
			IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
		    	ReadRegStr $0 HKCU &quot;${INSTALL_KEY_STEAM}&quot; 			'SteamPath'<br />
			IfErrors 0 CheckFiles<br />
		    	ClearErrors<br />
		    	ReadRegStr $0 HKLM &quot;${INSTALL_KEY_STEAM}&quot; 			'InstallPath'<br />
			IfErrors 0 CheckFiles<br />
			    GOTO SkipShortcuts<br />
<br />
			CheckFiles:<br />
<br />
			${StrRep} $0 &quot;$0&quot; &quot;/&quot; &quot;\&quot;<br />
			IffileExists &quot;$0Binaries\UT3.exe&quot; CreateShortcuts 0<br />
		  	IffileExists &quot;$0\steamapps\common\unreal tournament 3\Binaries\UT3.exe&quot; 0 SkipShortcuts<br />
<br />
		    CreateSteamShortcuts:<br />
		    	# Startup Menu Shortcuts<br />
				;CreateShortCut &quot;$SMPROGRAMS\Gneu\Project: White\${EDITOR_LNK}&quot; 	&quot;$0${STEAM_UT3_DIR}${UT3_BINARY_LOC}&quot; &quot;editor ${UT3_CMD_OPTIONS}&quot;<br />
		  		;CreateShortCut &quot;$SMPROGRAMS\Gneu\Project: White\${GAME_LNK}&quot; 	&quot;$0${STEAM_UT3_DIR}${UT3_BINARY_LOC}&quot; &quot;${UT3_CMD_OPTIONS}&quot;<br />
<br />
		        # Install Directory Shortcuts<br />
				;CreateShortCut &quot;$INSTDIR\${EDITOR_LNK}&quot; 	&quot;$0${STEAM_UT3_DIR}${UT3_BINARY_LOC}&quot; &quot;editor ${UT3_CMD_OPTIONS}&quot;<br />
		  		;CreateShortCut &quot;$INSTDIR\${GAME_LNK}&quot; 		&quot;$0${STEAM_UT3_DIR}${UT3_BINARY_LOC}&quot; &quot;${UT3_CMD_OPTIONS}&quot;<br />
<br />
				MessageBox MB_OK &quot;${SUCCESS_MESSAGE}&quot;<br />
<br />
		    	GoTo Done<br />
		    CreateShortcuts:<br />
				# Startup Menu Shortcuts<br />
				;CreateShortCut &quot;$SMPROGRAMS\Gneu\Project: White\${EDITOR_LNK}&quot; 	&quot;$0Binaries\UT3.exe&quot; &quot;editor ${UT3_CMD_OPTIONS}&quot;<br />
		  		;CreateShortCut &quot;$SMPROGRAMS\Gneu\Project: White\${GAME_LNK}&quot; 	&quot;$0Binaries\UT3.exe&quot; &quot;${UT3_CMD_OPTIONS}&quot;<br />
<br />
		        # Install Directory Shortcuts<br />
				;CreateShortCut &quot;$INSTDIR\${EDITOR_LNK}&quot; 	&quot;$0${UT3_BINARY_LOC}&quot; &quot;editor ${UT3_CMD_OPTIONS}&quot;<br />
		  		;CreateShortCut &quot;$INSTDIR\${GAME_LNK}&quot; 		&quot;$0${UT3_BINARY_LOC}&quot; &quot;${UT3_CMD_OPTIONS}&quot;<br />
<br />
				MessageBox MB_OK &quot;${SUCCESS_MESSAGE}&quot;<br />
				GoTo Done<br />
<br />
		    SkipShortcuts:<br />
		    	MessageBox MB_OK &quot;${FAILURE_MESSAGE}&quot;<br />
<br />
			Done:<br />
			;Create shortcuts<br />
<br />
		!insertmacro MUI_STARTMENU_WRITE_END<br />
		# End Sub Section Start Menu<br />
		#######################################################################<br />
		<br />
SectionEnd<br />
<br />
Section &quot;Jailbreak Maps&quot; section_maps<br />
	SetOutPath $INSTDIR<br />
SectionEnd<br />
<br />
;Assign descriptions to sections<br />
!insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br />
	!insertmacro MUI_DESCRIPTION_TEXT ${section_jailbreak_main} &quot;Jailbreak Mod.&quot;<br />
	!insertmacro MUI_DESCRIPTION_TEXT ${section_maps} &quot;Jailbreak Maps.&quot;<br />
!insertmacro MUI_FUNCTION_DESCRIPTION_END<br />
<br />
;--------------------------------<br />
;Uninstaller Section<br />
<br />
Section &quot;Uninstall&quot;<br />
  Delete &quot;$INSTDIR\${UNINSTALLER}&quot;<br />
  RMDir &quot;$INSTDIR&quot;<br />
  DeleteRegKey /ifempty HKCU &quot;Software\Jailbreak&quot;<br />
SectionEnd<br />
# End Section Over-rides<br />
###############################################################################<br />
###############################################################################<br />
# Begin Function Decleration<br />
;!include &quot;required_files\functions.nsh&quot;<br />
	;--------------------------------<br />
	;Installer Functions<br />
<br />
	Function .onInit<br />
		InitPluginsDir<br />
        File /oname=$PLUGINSDIR\splash.bmp &quot;${LOGO}&quot;<br />
						;delay   fadein   fadeout<br />
		advsplash::show 2000 1000 1000 -1 $PLUGINSDIR\splash<br />
<br />
		Pop $0 <br />
        Delete $PLUGINSDIR\splash.bmp<br />
		<br />
		!insertmacro MUI_LANGDLL_DISPLAY<br />
		Call setStartFolder<br />
	FunctionEnd<br />
<br />
<br />
	;--------------------------------<br />
	;Uninstaller Functions<br />
<br />
	Function un.onInit<br />
	  !insertmacro MUI_UNGETLANGUAGE<br />
	FunctionEnd<br />
<br />
	Function LeaveDirectory<br />
		GetInstDirError $0<br />
		;=== Does it already exist? (upgrade)<br />
		IfFileExists &quot;$INSTDIR\Jailbreak.u&quot; &quot;&quot; CheckInstallerError<br />
			;=== Check if app is running?<br />
			StrCmp ${CHECKRUNNING} &quot;NONE&quot; CheckInstallerError<br />
				FindProcDLL::FindProc &quot;${CHECKRUNNING}&quot;<br />
				StrCmp $R0 &quot;1&quot; &quot;&quot; CheckInstallerError<br />
					MessageBox MB_OK|MB_ICONINFORMATION &quot;$(runwarning)&quot;<br />
					Abort<br />
		CheckInstallerError:<br />
			${Switch} $0<br />
			    ${Case} 0 ;=== Valid directory and enough free space<br />
					${Break}<br />
			    ${Case} 1<br />
					MessageBox MB_OK &quot;$(invaliddirectory)&quot;<br />
					Abort<br />
					${Break}<br />
			    ${Case} 2<br />
					IfFileExists &quot;$INSTDIR&quot; &quot;&quot; NotEnoughSpaceNoUpgrade ;=== Is upgrade<br />
						SectionGetSize ${section_jailbreak_main} $1 ;=== Space Required for App<br />
						${GetRoot} &quot;$INSTDIR&quot; $2<br />
						${DriveSpace} &quot;$2\&quot; &quot;/D=F /S=K&quot; $3 ;=== Space Free on Device<br />
						${GetSize} &quot;$INSTDIR&quot; &quot;/M=*.* /S=0K /G=1&quot; $4 $5 $6 ;=== Current installation size<br />
						IntOp $7 $3 + $4 ;=== Space Free + Current Install Size<br />
<br />
				    NotEnoughSpaceNoUpgrade:<br />
						MessageBox MB_OK &quot;$(notenoughspace)&quot;<br />
						Abort<br />
					${Break}<br />
			${EndSwitch}<br />
	FunctionEnd<br />
<br />
	Function  setStartFolder<br />
		StrCpy $StartMenuFolder &quot;${STARTMENUFOLDER}&quot;<br />
	FunctionEnd<br />
# End Function Decleration<br />
###############################################################################</div></div><hr />


<div class="post"><div class="posttop"><div class="username">File077</div><div class="date">21st August 2009, 09:31</div></div><div class="posttext">Never mind, I figured that part out.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>