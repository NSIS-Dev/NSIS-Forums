<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Strange Behaviour with .onVerifyInstDir, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Strange Behaviour with .onVerifyInstDir NSIS Discussion" />
	
	<title> Strange Behaviour with .onVerifyInstDir [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Strange Behaviour with .onVerifyInstDir</div>
<hr />
<div class="pda"><a href="t-203987.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=203987">Strange Behaviour with .onVerifyInstDir</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">wbarthol</div><div class="date">5th January 2005, 21:30</div></div><div class="posttext">I am writing an installer to replace an executable that already exists and to ensure the user chooses the correct directory I am using onVerifyInstDir to check that the executable to be replaced already exists.<br />
<br />
However, although in the install directory browse popup the OK button enables and disables correctly, the Install button on the main dialog only enables if you choose the default install directory, if you choose an alternate directory that contains the executable to be replaced the Install button remains disabled.<br />
<br />
Here is the entire script:<br />
<br />
Name &quot;Uploader SP1&quot;<br />
OutFile &quot;UploaderSP1.exe&quot;<br />
<br />
InstallDir $PROGRAMFILES\Uploader<br />
<br />
Page directory<br />
Page instfiles<br />
<br />
Section &quot;&quot;<br />
  SetOutPath $INSTDIR<br />
  File &quot;Uploader.exe&quot;<br />
SectionEnd<br />
<br />
Function .onVerifyInstDir<br />
    IfFileExists $INSTDIR\Uploader.exe PathGood<br />
        Abort ;<br />
PathGood:<br />
FunctionEnd<br />
<br />
<br />
Any suggestions on what I'm doing wrong?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">5th January 2005, 22:05</div></div><div class="posttext">Try using quotes, like this:<br />
<br />
IfFileExists &quot;$INSTDIR\Uploader.exe&quot; PathGood</div></div><hr />


<div class="post"><div class="posttop"><div class="username">wbarthol</div><div class="date">5th January 2005, 22:11</div></div><div class="posttext">I have tried quoting everything and that didn't work. I just worked out what's happening:<br />
<br />
$INSTDIR is $PROGRAMFILES\Uploader, if you then browse for a directory that contains Uploader.exe (for example C:\Test) the OK button in the Browse box is enabled but when you click OK instead of putting C:\Test in the directory text box it is putting C:\Test\Uploader, it is as if it is appending the static part of $INSTDIR. Is this a bug?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">5th January 2005, 23:13</div></div><div class="posttext">Is this a bug?No, this is explainied in the Users Manual<br />
<br />
http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.1.21<br />
<br />
Here is a relevant extract from that section:<br />
<br />
&quot;Note that the part of this string following the last \ will be used if the user selects 'browse', and may be appended back on to the string at install time (to disable this, end the directory with a \ (which will require the entire parameter to be enclosed with quotes)&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">wbarthol</div><div class="date">5th January 2005, 23:18</div></div><div class="posttext">Thanks, works a treat.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>