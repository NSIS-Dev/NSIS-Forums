<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Plugin &amp; Stack, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Plugin &amp; Stack NSIS Discussion" />
	
	<title> Plugin &amp; Stack [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Plugin &amp; Stack</div>
<hr />
<div class="pda"><a href="t-291309.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=291309">Plugin &amp; Stack</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">freeDB_man</div><div class="date">5th May 2008, 14:38</div></div><div class="posttext">i need my plugin to be able to read to the NSIS stack as well as to write to the NSIS stack.<br />
<br />
How do I do this? I am using C++.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">5th May 2008, 14:50</div></div><div class="posttext">http://nsis.svn.sourceforge.net/viewvc/nsis/NSIS/trunk/Contrib/ExDLL/</div></div><hr />


<div class="post"><div class="posttop"><div class="username">freeDB_man</div><div class="date">5th May 2008, 14:55</div></div><div class="posttext">I know about exdll. How do I use that header to read &amp; write to the stack?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">{_trueparuex^}</div><div class="date">5th May 2008, 16:24</div></div><div class="posttext">popstring() and pushstring()</div></div><hr />


<div class="post"><div class="posttop"><div class="username">freeDB_man</div><div class="date">5th May 2008, 16:43</div></div><div class="posttext">You mean like this:<br />
<br />
pushstring(&quot;1&quot;);<br />
<br />
and<br />
<br />
var = popstring();</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th May 2008, 19:14</div></div><div class="posttext">No, not like this. pushstring() is correct, but popstring() receives a buffer into which the string from the stack is written. It must be the size passed to your function as string_size.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">freeDB_man</div><div class="date">5th May 2008, 19:46</div></div><div class="posttext">pushstring() is not working with my plugin. Is there anything specific I must add to it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">5th May 2008, 20:08</div></div><div class="posttext">you must call the exdll.h macro, EXDLL_INIT() inside your exported function</div></div><hr />


<div class="post"><div class="posttop"><div class="username">freeDB_man</div><div class="date">5th May 2008, 20:39</div></div><div class="posttext">I get this error:<br />
<br />
<br />
D:\Development Tools\Scripts\C++\dll\TG tests\tsts\mytestlibrary.cc: In function<br />
 `void Create()':<br />
D:\Development Tools\Scripts\C++\dll\TG tests\tsts\mytestlibrary.cc:9: error: `s<br />
tring_size' undeclared (first use this function)<br />
D:\Development Tools\Scripts\C++\dll\TG tests\tsts\mytestlibrary.cc:9: error: (E<br />
ach undeclared identifier is reported only once for each function it appears in.<br />
)<br />
D:\Development Tools\Scripts\C++\dll\TG tests\tsts\mytestlibrary.cc:9: error: `s<br />
tacktop' undeclared (first use this function)<br />
D:\Development Tools\Scripts\C++\dll\TG tests\tsts\mytestlibrary.cc:9: error: `v<br />
ariables' undeclared (first use this function)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">freeDB_man</div><div class="date">6th May 2008, 15:54</div></div><div class="posttext">I have given up. There should be a &quot;how to create a plugin in the NSIS manual&quot;<br />
<br />
Can anybody tell me how to use exdll? I have a function called Create in my dll and all I need is to be able to access the NSIS stack and read &amp; write to the stack.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">l0k1</div><div class="date">6th May 2008, 16:04</div></div><div class="posttext">If you use only pop and push just add<br />
<br />
<br />
<br />
/******************************************************************************<br />
/* Defines																	  *<br />
******************************************************************************/<br />
// for NSIS stack<br />
#define EXDLL_INIT()				\<br />
{									\<br />
	g_stacktop		= stacktop;		\<br />
	g_variables		= variables;	\<br />
	g_stringsize	= string_size;	\<br />
}<br />
#define	MAX_STRLEN	1024<br />
/******************************************************************************<br />
/* NSIS stack structure														  *<br />
******************************************************************************/<br />
typedef struct _stack_t {<br />
	struct	_stack_t *next;<br />
	char	text[MAX_STRLEN];<br />
} stack_t;<br />
/******************************************************************************<br />
/* Global values															  *<br />
******************************************************************************/<br />
// for NSIS stack<br />
stack_t			**g_stacktop;<br />
char			*g_variables;<br />
unsigned int	g_stringsize;<br />
/******************************************************************************<br />
* FUNCTION NAME: pushstring													  *<br />
*     PARAMETER: STR														  *<br />
*		PURPOSE: Removes the element from the top of the NSIS stack and puts  *<br />
*				 it in the buffer.											  * <br />
*		 RETURN: TRUE if stack is empty, FALSE if value is loaded.			  *<br />
******************************************************************************/<br />
int popstring(char *str)<br />
{<br />
	stack_t *th;<br />
<br />
	if (!g_stacktop || !*g_stacktop) return 1;<br />
<br />
	th=(*g_stacktop);<br />
	lstrcpy(str,th-&gt;text);<br />
	*g_stacktop = th-&gt;next;<br />
	GlobalFree((HGLOBAL)th);<br />
<br />
	return 0;<br />
}<br />
/******************************************************************************<br />
* FUNCTION NAME: pushstring													  *<br />
*	  PARAMETER: STR														  *<br />
*		PURPOSE: Adds an element to the top of the NSIS stack				  * <br />
******************************************************************************/<br />
void pushstring(const char *str)<br />
{<br />
	stack_t *th;<br />
<br />
	if (!g_stacktop) return;<br />
	<br />
	th=(stack_t*)GlobalAlloc(GPTR, sizeof(stack_t)+g_stringsize);<br />
	lstrcpyn(th-&gt;text,str,g_stringsize);<br />
	th-&gt;next=*g_stacktop;<br />
	<br />
	*g_stacktop=th;<br />
}<br />
<br />
<br />
<br />
Don't forget to add an entry point with<br />
<br />
<br />
extern &quot;C&quot;<br />
void __declspec(dllexport) TheNameOfMyExternalFunction(HWND hwndParent, int string_size, char *variables, stack_t **stacktop)<br />
<br />
<br />
And to push result in your function ;)<br />
<br />
To use in NSIS<br />
<br />
myDLL::TheNameOfMyExternalFunction param1 param2 etc.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">freeDB_man</div><div class="date">6th May 2008, 16:23</div></div><div class="posttext">OK. It works now. Thanks</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>