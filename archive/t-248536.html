<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Validation, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Validation NSIS Discussion" />
	
	<title> Validation [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Validation</div>
<hr />
<div class="pda"><a href="t-248536.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=248536">Validation</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">kgobel</div><div class="date">12th June 2006, 16:16</div></div><div class="posttext">Hi, I have a custom page that asks for registration info, if the user enters the wrong stuff, a message box comes up and says &quot;incorrect registration ID&quot;<br />
<br />
...the problem is..when the user clicks the cancel button...it asks if they want to exit...they click Yes, but then for some reason it seems the validation function is run again, and that message box comes up...and won't let them exit unless they click back</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th June 2006, 17:39</div></div><div class="posttext">Let me guess...<br />
<br />
Page Custom ShowFunc LeaveFunc<br />
<br />
You are validating the page in the ShowFunc when it must be done in the LeaveFunc. The LeaveFunc is only called when the user clicks Next.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kgobel</div><div class="date">13th June 2006, 15:34</div></div><div class="posttext">Actually it's<br />
Page custom RegistrationPage CheckID<br />
<br />
CheckID is the validation code, I'm using that ExperienceUI, but I didn't think that would have anything to do it with it.    ..It also only occurs when you enter an invalid key once, and then try to exit.  If you simply go to the registration page..and click cancel..it exits...but if you go to the page, enter an invalid key..try it (displays error)...then try to exit...it won't let you.<br />
<br />
I am using a custom made .dll for this? could this be the reason?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th June 2006, 15:41</div></div><div class="posttext">Did you make your own plugin to display this page?<br />
<br />
Edit: In plugin DLL's you need to do validation when the WM_NOTIFY_OUTER_NEXT message is sent to the window procedure.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kgobel</div><div class="date">13th June 2006, 16:18</div></div><div class="posttext">thanks alot for helping me out Afro UK<br />
<br />
hrmmmm...<br />
<br />
I have a function in my DLL called check, all it does is check to see if the CD KEY is valid from a webserver, and returns a string telling if it's correct or incorrect..<br />
<br />
<br />
  SetPluginUnload  alwaysoff ;don't know what this means<br />
  System::Call 'Dll::CheckID(t, i) i(&quot;${REGID}&quot;, &quot;4&quot;) .r0'<br />
  System::Free 0<br />
  SetPluginUnload  manual ;nor this...read it in a tut on wiki<br />
<br />
<br />
So I'm guessing the WM_NOTIFY_OUTER_NEXT doesn't apply to me here right?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th June 2006, 16:20</div></div><div class="posttext">Ah I see. No it doesn't.<br />
Would you be able to post the code in question?<br />
If not then you can send it via PM.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kgobel</div><div class="date">13th June 2006, 16:40</div></div><div class="posttext">I always feel embarressed to post my code, but here we go..<br />
<br />
<br />
Function CheckID<br />
<br />
  ReadINIStr ${TEMP1} &quot;$PLUGINSDIR\reg.ini&quot; &quot;Field 4&quot; &quot;State&quot;<br />
 <br />
  SetPluginUnload  alwaysoff<br />
  System::Call 'Dll::CheckID(t, i) i(&quot;${TEMP1}&quot;, &quot;4&quot;) .r0'<br />
<br />
  StrCmp $0 &quot;1&quot; done<br />
  StrCmp $0 &quot;2&quot; incorrect<br />
  StrCmp $0 &quot;3&quot; toomany<br />
  System::Free 0<br />
  SetPluginUnload  manual<br />
  <br />
  Goto done<br />
  <br />
  incorrect:<br />
  MessageBox MB_ICONEXCLAMATION|MB_OK &quot;Incorrect Registration ID&quot;<br />
  Abort<br />
  <br />
  toomany:<br />
  MessageBox MB_ICONEXCLAMATION|MB_OK &quot;This Registration ID has been used too many times.  Please call 800-999-9999&quot;<br />
  Abort<br />
<br />
  done:<br />
  <br />
FunctionEnd<br />
<br />
<br />
I realize this is probably very inefficent with and terrible practice with these goto statements (might be the cause of the problem) but I can't seem to get the !if statements to work properly when using StrCmp as it doesn't seem to return true or false..it GOTOs somewhere if it's equal or GOTOs somewhere if it's not equal...so by all means if someone could post a better way, that would be great.<br />
<br />
I can also post the rest if you don't think that this function is the cause of the problem..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th June 2006, 17:19</div></div><div class="posttext">Try this:<br />
<br />
Function CheckID<br />
<br />
  ReadINIStr ${TEMP1} &quot;$PLUGINSDIR\reg.ini&quot; &quot;Field 4&quot; &quot;State&quot;<br />
<br />
  System::Call /NOUNLOAD 'Dll::CheckID(t, i) i(&quot;${TEMP1}&quot;, &quot;4&quot;) .r0'<br />
<br />
  StrCmp $0 &quot;1&quot; done<br />
  StrCmp $0 &quot;2&quot; incorrect<br />
  StrCmp $0 &quot;3&quot; toomany<br />
  <br />
  incorrect:<br />
  MessageBox MB_ICONEXCLAMATION|MB_OK &quot;Incorrect Registration ID&quot;<br />
  Abort<br />
  <br />
  toomany:<br />
  MessageBox MB_ICONEXCLAMATION|MB_OK &quot;This Registration ID has been used too many times.  Please call 800-999-9999&quot;<br />
  Abort<br />
<br />
  done:<br />
  <br />
FunctionEnd<br />
<br />
<br />
LogicLib uses Goto and labels behind the scenes, so your code is already as good as it can possibly be :)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kgobel</div><div class="date">13th June 2006, 19:25</div></div><div class="posttext">Still same thing.  I push cancel..it gives me a confirmation box.  I click 'yes I want to exit' and then it gives me the error message (the exact error message it would as if I clicked next)..<br />
<br />
I'm wondering why the validation function is even running when I push Cancel?  There isn't a way I can dig a bit deaper in here and actually handle the button events can I?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th June 2006, 20:24</div></div><div class="posttext">Perhaps you could attach your entire script (as a file attachment) as there must be something else at fault here.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">galil</div><div class="date">13th June 2006, 20:50</div></div><div class="posttext">Function CheckID<br />
<br />
  ReadINIStr $0 &quot;$PLUGINSDIR\reg.ini&quot; &quot;Settings&quot; &quot;State&quot;<br />
  StrCmp $0 0 0 done<br />
<br />
  ReadINIStr ${TEMP1} &quot;$PLUGINSDIR\reg.ini&quot; &quot;Field 4&quot; &quot;State&quot;<br />
<br />
  System::Call /NOUNLOAD 'Dll::CheckID(t, i) i(&quot;${TEMP1}&quot;, &quot;4&quot;) .r0'<br />
<br />
  StrCmp $0 &quot;1&quot; done<br />
  StrCmp $0 &quot;2&quot; incorrect<br />
  StrCmp $0 &quot;3&quot; toomany<br />
  <br />
  incorrect:<br />
  MessageBox MB_ICONEXCLAMATION|MB_OK &quot;Incorrect Registration ID&quot;<br />
  Abort<br />
  <br />
  toomany:<br />
  MessageBox MB_ICONEXCLAMATION|MB_OK &quot;This Registration ID has been used too many times.  Please call 800-999-9999&quot;<br />
  Abort<br />
<br />
  done:<br />
  <br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th June 2006, 20:54</div></div><div class="posttext">That's just Function CheckID...<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">galil</div><div class="date">13th June 2006, 20:58</div></div><div class="posttext">Originally posted by Afrow UK <br />
That's just Function CheckID... <br />
... which performs check only if &quot;Next&quot; is pressed, and not every time the page leave is triggered.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th June 2006, 21:00</div></div><div class="posttext">Yes, but that isn't the entire script. There's nothing wrong with that function.<br />
<br />
If you do not wish to post your entire script then you can E-mail it to me at afrowuk at tiscali dot co dot uk.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">13th June 2006, 21:40</div></div><div class="posttext">I think I had the same problem at one time with XPUI.<br />
<br />
If memory serves me, when using ExperienceUI and using an XPUI_ABORTWARNING, you must also include an abort page.  (Have a look at the documentation.)<br />
<br />
If not using XPUI_ABORTWARNING, then you must use code such as this to close the install when the user clicks on cancel:<br />
<br />
Function .onUserAbort<br />
  StrCmp $NOABORTWARNING 1 CloseMe<br />
  MessageBox MB_YESNO|MB_ICONQUESTION &quot;Are you sure you want to cancel Setup?&quot; IDNO NoAbort<br />
  # any custom code you want before the Abort page is called here...<br />
  !insertmacro XPUI_USERABORT<br />
  NoAbort:<br />
  Abort<br />
  CloseMe:<br />
  # any custom code you want before the installer exits here...<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">galil</div><div class="date">13th June 2006, 22:00</div></div><div class="posttext">Originally posted by Afrow UK <br />
Yes, but that isn't the entire script. There's nothing wrong with that function.<br />
<br />
If you do not wish to post your entire script then you can E-mail it to me at afrowuk at tiscali dot co dot uk.<br />
<br />
-Stu <br />
<br />
WTF dude. I'm not the one asking question.<br />
I posted a solution.<br />
As for &quot;nothing wrong&quot;, well, if that function is set as custom leave, unless you add the additional check to see what invoked it, it would try to calculate the ID every time it's invoked (including when user press the Cancel button, and when any control, which has notify flag set, has it's state changed).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">13th June 2006, 23:22</div></div><div class="posttext">lol Afrow UK must mean the question was for kgobel, not for galil.<br />
<br />
One thing I have noticed:<br />
ReadINIStr ${TEMP1} &quot;$PLUGINSDIR\reg.ini&quot; &quot;Field 4&quot; &quot;State&quot;<br />
<br />
System::Call /NOUNLOAD 'Dll::CheckID(t, i) i(&quot;${TEMP1}&quot;, &quot;4&quot;) .r0'<br />
Shouldn't ${TEMP1} be a variable? Because this is refering to a define. Try using a variable instead, like $1:<br />
ReadINIStr $1 &quot;$PLUGINSDIR\reg.ini&quot; &quot;Field 4&quot; &quot;State&quot;<br />
<br />
System::Call /NOUNLOAD 'Dll::CheckID(t, i) i(.r1, &quot;4&quot;) .r0'<br />
This is probably the first time I have troubleshooted a problem with the system plugin, and the first time I have read the system documentation :) .</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th June 2006, 23:32</div></div><div class="posttext">galil, the Leave function is only called when the user clicks the Next button (or as you rightly say, if the NOTIFY flag is used on a control).<br />
<br />
Jason, I think kgobel is just using TEMP1 as a define for a variable, much like MUI used to use !define MUI_TEMP1 $0 before the Var instruction was introduced.<br />
<br />
I've never used XPUI so I'm with Comperio now :)<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>