<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" accessing registry under Vista, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  accessing registry under Vista NSIS Discussion" />
	
	<title> accessing registry under Vista [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  accessing registry under Vista</div>
<hr />
<div class="pda"><a href="t-282680.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=282680">accessing registry under Vista</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Rafik</div><div class="date">5th December 2007, 13:42</div></div><div class="posttext">Howdy<br />
<br />
I'm writing an updater to download data files in background while my game is running. Updater is working as admin using:<br />
<br />
RequestExecutionLevel admin <br />
<br />
Updater first runs game exe with:<br />
<br />
Exec '&quot;$INSTDIR\${GAME_EXEC_DIR}\${GAME_EXEC}&quot; &quot;${GAME_RUN_PARAM}&quot;'<br />
<br />
then starts downloads and during download it writes to HKLM registry information about finished files, something like that:<br />
<br />
!define REGKEY_VER_PROGRESS &quot;Software\${COMPANY}\${PRODUCT_NAME}\.Progress&quot;<br />
<br />
WriteRegStr HKLM &quot;${REGKEY_VER_PROGRESS}&quot; $fileGameID &quot;1&quot;<br />
<br />
To my surprise, my game can't see or read registry strings created by Updater. I can see them in regedit, but my game can not? Worse if for test purpose my game writes/creates string with existing but invisible name, in regedit i can see that there are two values with the same name? What is going on? I'm sure that has something to do with Vista, but how to combat this? <br />
That's what I want in short:<br />
run updater as an admin to may change files in &quot;Program Files&quot; and at the same time create string visible from my game running with user privileges.<br />
What should I do?<br />
<br />
Greets <br />
RafaÅ‚</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th December 2007, 18:44</div></div><div class="posttext">Do both the installer and the game have a Vista manifest? It sounds like you get redirected to another hive, though I can't remember any compatibility tweak that'd do this for HKLM. Make sure both the game and the installer run with the same &quot;vista tweak mode&quot; by giving them both manifests.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">skullcruncha</div><div class="date">5th December 2007, 18:48</div></div><div class="posttext">You might find more suprises with Vista and the registry and also files in certain folders like &quot;Program Files&quot;. Vista has introduced symbolic links on both the file system and registry. If a particular user updates an installed program only that user can see the updates.<br />
<br />
It may be that if your user is not an admin and the updater runs as an admin, the game (running under the user account) won't be able to see the registry (and maybe file) edits that were made by an admin.<br />
<br />
Try running the game as admin, then running your update process and see if the game can see the registry edits then. If so you know it's vista's new symbolic link/account permission feature that is preventing the user account from seeing the admin edits.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Rafik</div><div class="date">5th December 2007, 22:44</div></div><div class="posttext">Thanks for answers.<br />
I'm using old Visual C++ 6.0 and as far as I know it's not supplied with any manifest tools. Someone maybe knows where can I get one?<br />
I'm quite confused (and tired) with unpredictable(at least for me) Vista behaviours. But unfortunately need my app working under Vista too.<br />
I was wondering about using some *.ini to keep informations about updates. That's because my game has free read access to files in &quot;Program Files&quot; even these written by Updater. I will investigate this idea further but looks like one worth a try.<br />
<br />
Thanks again, I must say that I like convenience and simplicity of NSIS very much, too bad that it's still not quite &quot;Vista ready&quot;. Actually I think that fault is rather on Microsoft's side and plain stupid idea of common registry file - a thing visibly not prepared for real multiuser system.<br />
<br />
Greets RafaÅ‚</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>