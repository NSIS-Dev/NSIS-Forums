<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" What's wrong with my string?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  What's wrong with my string? NSIS Discussion" />
	
	<title> What's wrong with my string? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  What's wrong with my string?</div>
<hr />
<div class="pda"><a href="t-196659.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=196659">What's wrong with my string?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">moop</div><div class="date">17th October 2004, 05:34</div></div><div class="posttext">I'm using the  ReplaceInFile (http://nsis.sourceforge.net/archive/nsisweb.php?page=318&amp;instances=0,11,311) script from the Archive.  It works fine, except when I insert the string I actually want to use... i.e. the tests I run work fine... but as soon as I insert the actual string I want to replace, it dies.<br />
<br />
I don't think my syntax is wrong, since I am able, earlier in my installer script, to insert my string (the same one!) into that file.<br />
<br />
Here is the text I want inserted:<br />
user_pref(&quot;network.protocol-handler.external.deusex&quot;, true);<br />
this is what I am entering into my installer:<br />
      !insertmacro ReplaceInFile &quot;$PROFILE\Application Data\Mozilla\Firefox\$1\user.js&quot; &quot;$\r$\nuser_pref($\&quot;network.protocol-handler.external.deusex$\&quot;, true);&quot; &quot;replacement_text&quot;<br />
<br />
(yes that's all one line)<br />
...and this is the error I get when I compile:<br />
<br />
<br />
<br />
!insertmacro: ReplaceInFile<br />
Push: $PROFILE\Application Data\Mozilla\Firefox\$1\user.js<br />
Push expects 1 parameters, got 3.<br />
Usage: Push string<br />
Error in macro ReplaceInFile on macroline 2<br />
Error in script &quot;moop.nsi&quot; on line 300 -- aborting creation process <br />
<br />
So... it appears to think that my string is OKAY when I use the same exact string earlier in the file... but somehow now, through this ReplaceInFile script, it gets misinterpreted?<br />
<br />
I have re-tested it without using the !insertmacro command, instead inserting the parameters line-by-line using Push and Call (as ReplaceInFile does)... still nothing.<br />
<br />
Help?:igor:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">17th October 2004, 10:39</div></div><div class="posttext">Dump the macro and use:<br />
<br />
Push &quot;$PROFILE\Application Data\Mozilla\Firefox\$1\user.js&quot;<br />
Push &quot;$\r$\nuser_pref($\&quot;network.protocol-handler.external.deusex$\&quot;, true);&quot;<br />
Push &quot;replacement_text&quot;<br />
 Call RIF<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">moop</div><div class="date">17th October 2004, 12:46</div></div><div class="posttext">Originally posted by Afrow UK <br />
Dump the macro and use:<br />
<br />
Push &quot;$PROFILE\Application Data\Mozilla\Firefox\$1\user.js&quot;<br />
Push &quot;$\r$\nuser_pref($\&quot;network.protocol-handler.external.deusex$\&quot;, true);&quot;<br />
Push &quot;replacement_text&quot;<br />
 Call RIF<br />
<br />
-Stu  <br />
<br />
My last paragraph.  Did that.  ;)  Nothing.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">razor_x</div><div class="date">17th October 2004, 12:53</div></div><div class="posttext">I think your macro is failing because you have quotes inside of quotes..this == another string.You can also use strcpy and copy that whole string to a variable,then call that variable in the macro.<br />
<br />
strcpy $2 &quot;path&quot;<br />
strcpy $3 &quot;string to search&quot;<br />
strcpy $4 &quot;replacement text&quot;<br />
<br />
!insertmacro ReplaceInFile &quot;$2&quot; &quot;$3&quot; &quot;$4&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">moop</div><div class="date">17th October 2004, 13:50</div></div><div class="posttext">Originally posted by razor_x <br />
I think your macro is failing because you have quotes inside of quotes..this == another string.You can also use strcpy and copy that whole string to a variable,then call that variable in the macro.<br />
<br />
strcpy $2 &quot;path&quot;<br />
strcpy $3 &quot;string to search&quot;<br />
strcpy $4 &quot;replacement text&quot;<br />
<br />
!insertmacro ReplaceInFile &quot;$2&quot; &quot;$3&quot; &quot;$4&quot;  <br />
<br />
Okay, I just tested that, and it doesn't seem to work.  Here is what I included:<br />
<br />
        strcpy $7 &quot;$PROFILE\Application Data\Mozilla\Firefox\$1\user.js&quot;<br />
        strcpy $8 &quot;$\r$\nuser_pref($\&quot;network.protocol-handler.external.deusex$\&quot;, true);&quot;<br />
        strcpy $9 &quot;fwargh&quot;<br />
        !insertmacro ReplaceInFile &quot;$7&quot; &quot;$8&quot; &quot;$9&quot;<br />
<br />
And although it compiled without errors, my file (user.js) was left unchanged.  I included a DetailPrint in my script so I could see what was assigned to each variable, and this is what it said:<br />
<br />
$7 is C:\Documents and Settings\Moop\Application Data\Mozilla\Firefox\Profiles\e8x86j94.default\user.js<br />
$8 is <br />
user_pref(&quot;network.protocol-handler.external.deusex&quot;, true);<br />
$9 is fwargh<br />
$R0 is Profiles\e8x86j94.default<br />
<br />
<br />
Any thoughts?  Is this a limitation of the engine?  Is it a bug?<br />
<br />
This part of my script is just &quot;clean-up&quot; code - meaning I'm erasing the line from the user's user.js file if they have already run the installer previously.  I'm guessing that's relatively amateurish, but this is my first installer, and that's okay.  ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">17th October 2004, 14:13</div></div><div class="posttext">!insertmacro ReplaceInFile &quot;$PROFILE\Application Data\Mozilla\Firefox\$1\user.js&quot; '$\r$\nuser_pref($\&quot;network.protocol-handler.external.deusex$\&quot;, true);' &quot;replacement_text&quot;<br />
<br />
does this work?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">razor_x</div><div class="date">17th October 2004, 14:21</div></div><div class="posttext">The macro is fine.I think your folder may be &quot;Read Only&quot;....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">moop</div><div class="date">17th October 2004, 15:06</div></div><div class="posttext">Yathosho:<br />
  I get <br />
!insertmacro: ReplaceInFile<br />
Push: $PROFILE\Application Data\Mozilla\Firefox\$1\user.js<br />
Push expects 1 parameters, got 3.<br />
Usage: Push string<br />
Error in macro ReplaceInFile on macroline 2<br />
Error in script &quot;moop.nsi&quot; on line 300 -- aborting creation process during compilation.  <br />
<br />
razor_x:<br />
  I had SetFileAttributes on user.js to NORMAL - and as I mentioned in the top post, I am able to add that text to the file if the text doesn't exist... but I can't subtract/replace it.  I am using the exact same string, too... cut &amp; paste, looked it over, read the documents on quotes and symbols...  this all seems very odd to me.  Odd enough that I might consider it a bug if I didn't first think it was my inexperience.<br />
<br />
:(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">17th October 2004, 15:12</div></div><div class="posttext">The macro is the problem - it uses &quot;&quot; and the search string includes &quot;&quot;.<br />
<br />
One way to solve this is to use Push &quot;$PROFILE\Application Data\Mozilla\Firefox\$1\user.js&quot;<br />
Push '$\r$\nuser_pref(&quot;network.protocol-handler.external.deusex&quot;, true);'<br />
Push &quot;fwargh&quot;<br />
Call RIF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">razor_x</div><div class="date">17th October 2004, 15:27</div></div><div class="posttext">I solved it like this...my example<br />
<br />
strcpy $0  &quot;D:\Documents and Settings\mysettings\Application Data\Mozilla\Firefox\Profiles\default.cvn\prefs.js&quot;<br />
strcpy $1 '&quot;network.protocol-handler.external.deusex&quot;' ;we add the string inside a string to a variable(note the extra single quotes)<br />
strcpy $2 &quot;user_pref($1, true);&quot; ;add that variable to the string to search<br />
strcpy $3 &quot;&quot; ;delete the string<br />
<br />
!insertmacro ReplaceInFile &quot;$0&quot; &quot;$2&quot; &quot;$3&quot;<br />
<br />
macro works fine...guess yours would look something like this..with the correct variable for the path of course</div></div><hr />


<div class="post"><div class="posttop"><div class="username">moop</div><div class="date">17th October 2004, 16:24</div></div><div class="posttext">Originally posted by pengyou <br />
The macro is the problem - it uses &quot;&quot; and the search string includes &quot;&quot;.<br />
<br />
One way to solve this is to use Push &quot;$PROFILE\Application Data\Mozilla\Firefox\$1\user.js&quot;<br />
Push '$\r$\nuser_pref(&quot;network.protocol-handler.external.deusex&quot;, true);'<br />
Push &quot;fwargh&quot;<br />
Call RIF <br />
<br />
No dice... even without the macro, and the single-quote syntax, it just doesn't work.  Should I post the whole script as a file here, or maybe just that section?<br />
<br />
The mystery of the stubborn string grows.  :p<br />
<br />
Edit:  Ohh ty razor, I'll test that now.<br />
<br />
Edit2:  Oh just noticed - do NOT edit your prefs.js file, razor_x... bad things.  The user.js file will be read into Firefox just like prefs.js, but without messing up your whole Firefox setup (I eventually backed up my bookmarks, history, and extensions, and un/re-installed Firefox... man what a pain, until I found out editing user.js works just the same without the chaos).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">razor_x</div><div class="date">17th October 2004, 16:47</div></div><div class="posttext">Edit2: Oh just noticed - do NOT edit your prefs.js file, razor_x... bad things. The user.js file will be read into Firefox just like prefs.js, but without messing up your whole Firefox setup (I eventually backed up my bookmarks, history, and extensions, and un/re-installed Firefox... man what a pain, until I found out editing user.js works just the same without the chaos). <br />
<br />
this cant hurt as long as the browser is open while editing..closing the browser will overwrite the file with the previous settings.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>