<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Retrieving Primary Domain from Multiple domain computer, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Retrieving Primary Domain from Multiple domain computer NSIS Discussion" />
	
	<title> Retrieving Primary Domain from Multiple domain computer [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Retrieving Primary Domain from Multiple domain computer</div>
<hr />
<div class="pda"><a href="t-232128.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=232128">Retrieving Primary Domain from Multiple domain computer</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Kappaphi189</div><div class="date">28th November 2005, 21:32</div></div><div class="posttext">Hope someone can help with this one. <br />
<br />
I have a program for a multiple domain company, IE; ABC, 123, USA domains. <br />
<br />
The program will be used in all domains, but since we have a problem with Cross domain membership, we have a service account setup for each domain. Domain ABC, Domain 123, and Domain USA. <br />
<br />
I have the ServiceLib plugin and I am able to successfully install the program (and service) in windows but ONLY when I manually place the DOMAIN name into the user field, IE ABC\administrator. <br />
<br />
What I would like to do, is pull the primary domain (or rather the domain that the PC is a member of) and insert into the script so that they ONE script can be used for mulitple domains. <br />
<br />
Might sound easy, I haven't found anything on google or in the forums yet. I know that I might pull this variable from the registry (which Im trying to stay away from) or could I use a WMI/API call to get the primary Domain?<br />
<br />
Any help will be appreciated. Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">29th November 2005, 18:49</div></div><div class="posttext">Don't know if this will help, but could you read the Environmental Variable &quot;USERDOMAIN&quot;?<br />
<br />
Like this:<br />
<br />
ReadEnvStr $1 &quot;USERDOMAIN&quot;<br />
<br />
Sorry if I'm way off, just thought I would throw that out there.  Good luck.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Kappaphi189</div><div class="date">29th November 2005, 22:18</div></div><div class="posttext">Yes, but I think the problem with reading the environment variable is that it returns the user's domain... so, if I am logged on as a local adminstrator, it will return the PCs name. Or.. If I am logged on to another domain, it doesnt pull the primary domain of the PC.<br />
<br />
I can try this. <br />
<br />
How do I read the variable and then use later in the script? Just reference $1?<br />
<br />
Thanks--</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bhaelochon</div><div class="date">29th November 2005, 22:30</div></div><div class="posttext">Originally posted by Kappaphi189 <br />
How do I read the variable and then use later in the script? Just reference $1? <br />
Yup:<br />
ReadEnvStr $1 &quot;USERDOMAIN&quot;<br />
MessageBox MB_OK &quot;The domain is '$1'.&quot;<br />
This displays a message box with the message: The domain is 'MYDOMAIN'.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Kappaphi189</div><div class="date">29th November 2005, 22:38</div></div><div class="posttext">Thanks. <br />
<br />
I'll try that out and see what I can develop. <br />
<br />
Whats the code for reading from the Registry? READRgstr?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">29th November 2005, 22:38</div></div><div class="posttext">Per the User Manual:<br />
<br />
4.9.2.11 ReadRegDWORD<br />
user_var(output) root_key sub_key name<br />
Reads a 32 bit DWORD from the registry into the user variable $x. Valid values for root_key are listed under WriteRegStr. The error flag will be set and $x will be set to an empty string (&quot;&quot; which is 0) if the DWORD is not present. If the value is present, but is not a DWORD, it will be read as a string and the error flag will be set.<br />
<br />
ReadRegDWORD $0 HKLM Software\NSIS VersionBuild<br />
4.9.2.12 ReadRegStr<br />
user_var(output) root_key sub_key name<br />
Reads from the registry into the user variable $x. Valid values for root_key are listed under WriteRegStr. The error flag will be set and $x will be set to an empty string (&quot;&quot;) if the string is not present. If the value is present, but is of type REG_DWORD, it will be read and converted to a string and the error flag will be set.<br />
<br />
ReadRegStr $0 HKLM Software\NSIS &quot;&quot;<br />
DetailPrint &quot;NSIS is installed at: $0&quot;</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>