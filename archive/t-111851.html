<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS does not delete a file that is told to delete, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS does not delete a file that is told to delete NSIS Discussion" />
	
	<title> NSIS does not delete a file that is told to delete [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS does not delete a file that is told to delete</div>
<hr />
<div class="pda"><a href="t-111851.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=111851">NSIS does not delete a file that is told to delete</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">28th October 2002, 19:10</div></div><div class="posttext">Well, I have a bit of a problem here. I tell nsis to delete a file and he does not delete it.:eek: It's a file that will be created while running the installation and the user has the choice beforehand to choose if the file will remain or not.<br />
<br />
Well, I attach a zip with the program, the nsi file and a folder that is needed to run the program.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th October 2002, 19:30</div></div><div class="posttext">Try using the latest CVS version, it works for me when I compile it with it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">28th October 2002, 23:50</div></div><div class="posttext">and the exe included, does work for you?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th October 2002, 14:15</div></div><div class="posttext">The included EXE doesn't delete the file, the EXE I compiled using the latest CVS version does.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">29th October 2002, 18:02</div></div><div class="posttext">I am trying to do something in this CVS folder (http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/nsis/NSIS/) but downloading makensis.exe and makensisw.exe and try to compile gives error on line 1.<br />
<br />
Let's see if you can help me another bit.:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rainwater</div><div class="date">29th October 2002, 19:05</div></div><div class="posttext">Originally posted by n0On3 <br />
I am trying to do something in this CVS folder (http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/nsis/NSIS/) but downloading makensis.exe and makensisw.exe and try to compile gives error on line 1.<br />
<br />
Let's see if you can help me another bit.:) <br />
<br />
Download the snapshot.  The link to it is in my signature.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th October 2002, 19:05</div></div><div class="posttext">http://forums.winamp.com/showthread.php?s=&amp;threadid=102204</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">30th October 2002, 00:50</div></div><div class="posttext">well, I've downloaded the snapshot and installed it. And then make a new compilation, and then run it, and then find that that ini file is still there:( <br />
<br />
Sometimes just the file remains there. Sometimes it appears after two seconds (more or less) of clicking on &quot;Close&quot;.<br />
<br />
<br />
I attached a zip with nsi, new compilation and that log folder.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th October 2002, 14:14</div></div><div class="posttext">The compiled installer inside your ZIP file deletes the file for me.<br />
What OS are you using?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">30th October 2002, 14:36</div></div><div class="posttext">I am using Win98SE.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th October 2002, 15:31</div></div><div class="posttext">On Windows 98 it happens to me too, I will look into it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">30th October 2002, 16:04</div></div><div class="posttext">Thanks.<br />
<br />
Sometimes the .ini appears clearly after those .csv files, which in the script are created after the .ini.<br />
<br />
Maybe the problem is that the file to delete is created in the same installation. <br />
<br />
Another thing is that I didn't find how to create the file, so I used FileOpen directly.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th November 2002, 15:41</div></div><div class="posttext">OK, here is what I think happens:<br />
I think that when you call WriteINIStr Windows delays write it. That means, it writes to the file whenever it feels like it, or before someone wants to read from it.<br />
In your case you always write just before you delete it, and you don't read in between, so Windows delays the writing.<br />
Windows 95/98/Me: The DeleteFile function deletes a file even if it is open for normal I/O or as a memory-mapped file. To prevent loss of data, close files before attempting to delete them.<br />
So after you have already deleted it, Windows' WriteINIStr remembers it needed to write something and it recreates the file for it. What you need to do is to flush the file buffers before you delete it using:<br />
WriteINIStr &quot;${TMP}&quot; &quot;&quot; &quot;&quot; &quot;&quot;<br />
<br />
It worked for me 10 out of 10 times so I guess I am correct :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">6th November 2002, 18:22</div></div><div class="posttext">I understand that I have to write that line just before deleting the ini file.<br />
<br />
I tried but It didn't work, could you upload the modified ini with a compile that works for you?<br />
<br />
Thanks:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th November 2002, 18:28</div></div><div class="posttext">There it is.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">7th November 2002, 04:04</div></div><div class="posttext">Sorry, but it didn't work. The file is still there.<br />
<br />
It deletes the file when making a pause with messagebox.<br />
<br />
In the first try the ini appeared after presssing F5.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">8th November 2002, 00:36</div></div><div class="posttext">ok kichik, I am your worst nightmare.:eek: <br />
<br />
That makensis you gave me does indeed delete the ini, but when working it keeps it at zero bytes, for easy deleting, of course.:) <br />
<br />
<br />
I attach the compiled script, the script and logs, as always.:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th November 2002, 11:16</div></div><div class="posttext">Oops... Fixed that in the latest CVS version. You will have to compile again.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>