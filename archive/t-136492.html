<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Search the hard drive, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Search the hard drive NSIS Discussion" />
	
	<title> Search the hard drive [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Search the hard drive</div>
<hr />
<div class="pda"><a href="t-136492.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=136492">Search the hard drive</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th May 2003, 19:47</div></div><div class="posttext">Ok, well here is as far as I have managed to go today.<br />
<br />
Push &quot;&quot;<br />
Push C:\<br />
 Call SearchDir<br />
<br />
I'm not sure what I can do next, just try and get further.<br />
<br />
<br />
Function SearchDir<br />
 Exch $0 ;dir<br />
 Exch<br />
 Exch $1 ;file<br />
 Push $2<br />
 Push $3<br />
 Push $4<br />
 Push $5<br />
 Push $6<br />
 Push $R0 ;temp file<br />
 Push $R1 ;ini no's<br />
 Push $R2 ;ini no's<br />
 ClearErrors<br />
<br />
  StrCpy $R1 0<br />
  StrCpy $R2 0<br />
<br />
  # Open temp file<br />
  GetTempFileName $R0<br />
<br />
  # Remove \ from end (if any)<br />
  StrCpy $2 $0 1 -1<br />
  StrCmp $2 \ 0 +2<br />
  StrCpy $0 $0 -1<br />
<br />
  # Get first file or directory name<br />
  ClearErrors<br />
  FindFirst $2 $3 &quot;$0\*&quot;<br />
  IfErrors end1<br />
<br />
  # Check if file name = directory name<br />
  IfFileExists &quot;$0\$3\*&quot; 0 loop1<br />
  WriteINIStr $R0 &quot;Directory Tree&quot; &quot;Value 1&quot; &quot;$0\$3&quot;<br />
   IntOp $R1 $R1 + 1<br />
<br />
loop1:<br />
  # Keep looking for file or directory name<br />
  ClearErrors<br />
  FindNext $2 $3<br />
  IfErrors end1<br />
<br />
  # Check if file name = directory name<br />
  IfFileExists &quot;$0\$3\*&quot; 0 loop1<br />
   IntOp $R1 $R1 + 1<br />
  WriteINIStr $R0 &quot;Directory Tree&quot; &quot;Value $R1&quot; &quot;$0\$3&quot;<br />
Goto loop1<br />
end1:<br />
<br />
  StrCpy $R1 0<br />
<br />
loop_main:<br />
  StrCpy $R2 0<br />
<br />
  IntOp $R1 $R1 + 1<br />
  ReadINIStr $4 $R0 &quot;Directory Tree&quot; &quot;Value $R1&quot;<br />
  StrCmp $4 &quot;&quot; done<br />
<br />
  # Get first file or directory name<br />
  ClearErrors<br />
  FindFirst $2 $3 &quot;$4\*&quot;<br />
  IfErrors end1<br />
<br />
  # Check if file name = directory name<br />
  IfFileExists &quot;$3\*&quot; 0 loop1<br />
  WriteINIStr $R0 &quot;Directory Tree&quot; &quot;Value $R1 1&quot; &quot;$4\$3&quot;<br />
   IntOp $R2 $R2 + 1<br />
<br />
loop2:<br />
  # Keep looking for file or directory name<br />
  ClearErrors<br />
  FindNext $2 $3<br />
  IfErrors loop_main<br />
<br />
  # Check if file name = directory name<br />
  IfFileExists &quot;$4\$3\*&quot; 0 loop2<br />
   IntOp $R2 $R2 + 1<br />
  WriteINIStr $R0 &quot;Directory Tree&quot; &quot;Value $R1 $R2&quot; &quot;$4\$3&quot;<br />
Goto loop2<br />
<br />
done:<br />
  # Delete temp file<br />
  ;Delete $R0<br />
ExecShell open $R0<br />
 Pop $R2<br />
 Pop $R1<br />
 Pop $R0<br />
 Pop $6<br />
 Pop $5<br />
 Pop $4<br />
 Pop $3<br />
 Pop $2<br />
 Pop $1<br />
 Exch $0<br />
FunctionEnd<br />
<br />
<br />
It doesn't even output anything yet.<br />
The first push will be for the file to search for and the output will be the path to the found file or error if no file was found.<br />
<br />
I have a lot more to do, and this is very hard to do!<br />
<br />
-Stu :o</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">24th May 2003, 20:56</div></div><div class="posttext">I've tried your function, and is very interesting.<br />
<br />
I put a MessageBox MB_OK '&quot;Value $R1 $R2&quot; &quot;$4\$3&quot;' after the   WriteINIStr $R0 &quot;Directory Tree&quot; &quot;Value $R1 $R2&quot; &quot;$4\$3&quot;.<br />
<br />
But this only search in a folder, and subfolder (i.e. C:\Windows\Menu Iniciar), it don't go in the subfolders of subfolder (like C:\Windows\Menu Iniciar\Programas) and do not search for the file or folder yet.<br />
<br />
So the next things to do are:<br />
<br />
1)The first thing to do now is to put a code to detect the file before of the code to detect the subfolders (using FindFirst). And if it is in that folder, goto done, and return the value to user.<br />
<br />
2)The second thing is, if the file is not detected, put the error flag, and return no value to user (clear with StrCpy $var &quot;&quot;), to do this you will have to change the IfErrors end1, to IfErrors error, and put 'SetErrors' and 'StrCpy $var &quot;&quot;' after the label Error without these single quotes.<br />
<br />
3)Third, the most difficult, is the detection of the subfolders of folder, of folder, of folder, of folder, of folder, of folder, of folder, of folder, of folder, of folder. (i.e. C:\Windows\Menu Iniciar\Programas\Acess√≥rios\Jogos\Meu Jogo\Sites do Meu Jogo\Suporte\Nome da Empresa\Link 1.lnk).<br />
<br />
And to do this, you have to make loop, on loop9, on loop8, on loop7, on loop6, on loop5, on loop4, on loop3, on loop2, on loop1. So this function will be very big. I don't know if exist a better way than using this (I tried to do this on &quot;Advanced File Size Function, Folder Size Example&quot; using the subfolders, but because the example was too big, I didn't put it at Archive).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th May 2003, 22:22</div></div><div class="posttext">I thought that there was no limmit to the ammount of subdirectories?<br />
<br />
If there is a limit, then I could finish this function now.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">24th May 2003, 22:45</div></div><div class="posttext">Yes, have a limit. Now the limit of your funtion is 3, (C:\Program Files\NSIS).<br />
<br />
Add support to more one subdirectory, is to copy the loop, and paste in the location that will work on this loop, the drawbacks of this is that the function will be big, very big, and can use different variables, so it is not too good.<br />
<br />
Have another way to do this, but is complicated to understand, and is much difficult to do, but economize space and is unlimited!<br />
<br />
In example, C:/Program Files/NSIS, the function detected that the Program Files is the first (1), repeat the code using now the result of this first search (and the code to search in this subfolder), now have three folders, Common Files (1 1), NSIS (1 2) and Winamp (1 3). The first to be searched is Common Files, so it will use the result of the FindNext to repeat the code (and to use the code to search in this subfolder), now using the C:/Program Files/Common Files, the function found nothing here, so will return to the previous result to repeat the code, the next is NSIS, and are what I'm looking so will end the repeatable code and return the result to user.<br />
<br />
I will study on this. On the next Saturday I will post the complete function for you here. Or if not, I will say the reason. OK?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th May 2003, 23:46</div></div><div class="posttext">I know what I need to do next, but if you want to do it, I don't mind!<br />
I shall have another go at it, and see how it goes.<br />
<br />
-Stu :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">25th May 2003, 16:51</div></div><div class="posttext">I've nearly cracked this now. I've attached a script which scans a given path for files (wildcards allowed), e.g. find notepad.* in d:/winnt/ or whatever.<br />
<br />
It's almost finished. The results of the search are stored in a string ($6) and have the form :-<br />
<br />
&gt;dirpath|file|file|file|&gt;dirpath|file<br />
<br />
Where the files are matches found in the dirpath specified, e.g.<br />
<br />
&gt;d:/winnt/|notepad.exe|&gt;d:/winnt/system32/|notepad.exe<br />
<br />
You just then need to walk the string, splitting on the &quot;|&quot; character. Any time a file starts with &gt; you know it's really a directory name and not a file.<br />
<br />
I don't have time to finish this right now. I will do later if no-one else beats me to it.<br />
<br />
The attached script prints out the results as it goes for debug purposes. You could of course insert your action code where the debug prints out and not worry about the contents of $6... that's up to you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">25th May 2003, 17:16</div></div><div class="posttext">Comments:<br />
<br />
- Your version, Sunjammer is good, it found 1 file in the C:\Windows that have Notepad* and more 3 in Help subfolder and 1 in Applog subfolder of Windows folder, you are really in the right way!<br />
<br />
- But have a drawback, it's 5x slow than searching with the Windows Search.<br />
<br />
- It don't use much memory, useful for slower computes (I don't know if this is a quality, because that exist much computer that have much RAM), and give the exact results that is given on the Windows Search!<br />
<br />
Is really very good, I'm watching to be finished to use in my programs!<br />
<br />
But I will make a alternative version of Search Files based on the AfrowUK work, that is a good start, only some changes to make it perfect!<br />
<br />
I tested now using MakeNSIS*, and again, give the same results than the Windows Search!<br />
<br />
Download and post the comments!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">25th May 2003, 21:42</div></div><div class="posttext">Made with the base of the Sunjammer and AfrowUK functions, now I will show the power of my function Search File (or Folder). See the qualities of this function (test yet, not finished, I will try to finish today):<br />
<br />
- Now suport folder search, Search for the WINAMP folder or NSIS folder!<br />
- Is 1.7 X more quickly than the Windows Searcher!<br />
- Use the maximum memory of your computer for the search!<br />
- This code economize the $6 and $R0 variables.<br />
- Some Fixes.<br />
<br />
Try now, and comment what you think (but is a debug test, I'm now tring to complete it, and I'm in the right way)!<br />
<br />
This file, show how to detect Winamp folder. It will detect the Start Menu Folder of the Winamp, and the Winamp itself. You can use the function Advanced Search in String to get the value before the &quot;|&quot; and after, and use the command &quot;IfFileExists&quot; to detect if one of these strings is located the Winamp.exe for each string. So you will can find the real Winamp path!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th May 2003, 22:18</div></div><div class="posttext">I think it looks like my script is working ok!<br />
However, it takes a very long time to find a file in say 5 subdirectories!<br />
<br />
It uses an ini file to write and then read the dir values.<br />
You can find the ini file as %TEMP%\files.lst<br />
<br />
Script attached.<br />
<br />
I'm trying it out now.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th May 2003, 22:29</div></div><div class="posttext">Wow, that script works incredibly fast!<br />
I think it works similar to mine, but I see that it does not write to a log.<br />
I'm trying to figure out how it works!<br />
<br />
GJ, and put it on the archive!<br />
<br />
-Stu :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th May 2003, 23:00</div></div><div class="posttext">You can do it without recursion too, relaying only on the stack which will allow a far more extensive use of memory and will be faster because there are less operations.<br />
<br />
The attached script found in less than 3 seconds the file requested and finished running on 10GB of files, 28,000 files, in less than 10 seconds.<br />
<br />
Adapted from Justin's script:<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=65535&amp;highlight=findfirst<br />
<br />
BTW, if you want to make it run really fast you can write a plug-in to do the job. This will skip all of the NSIS processing.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th May 2003, 23:38</div></div><div class="posttext">deguix, FindFirst $2 $3 &quot;C:\something\*.&quot; doesn't find all sub directories. It won't find a directry named test.test for example. You should use:<br />
<br />
IfFileExists &quot;C:\something\*.*&quot; isDir notDir<br />
<br />
to test if a given path points to a directory.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">26th May 2003, 04:06</div></div><div class="posttext">&quot;BTW, if you want to make it run really fast you can write a plug-in to do the job. This will skip all of the NSIS processing.&quot;<br />
<br />
First, I don't want to be really fast, only that searches with a clean code, and I don't use any compilers, only the NSIS one.<br />
<br />
&quot;FindFirst $2 $3 &quot;C:\something\*.&quot; doesn't find all sub directories.&quot;<br />
<br />
Second, I will fix this at Wednesday at night.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th May 2003, 13:33</div></div><div class="posttext">Is anyone going to make an archive page out of this or should I?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st June 2003, 16:41</div></div><div class="posttext">I'll take that as a no...<br />
<br />
http://nsis.sourceforge.net/archive/viewpage.php?pageid=266</div></div><hr />


<div class="post"><div class="posttop"><div class="username">banaman8d</div><div class="date">2nd June 2003, 16:46</div></div><div class="posttext">When trying to write an update tool, I needed something like the examples you all wrote, except that I wanted to have a function called with the directory or file that was found.<br />
<br />
For instance, my update tool works over a Novell network share (a mapped drive on our network) and scans the deploy dir (like your find functions). The difference was that when I found a file, I compared it to a file in the installation directory and overwrote if the mod-time was newer, also if it was a dll or ocx register it if the dll version is newer. For directories, did the same.<br />
<br />
The find code should really be macro-ized so that you can run code on the searched files/dirs while searching - this makes the code more generic and more useful. Please don't shoot me for saying that!<br />
<br />
UPDATE: SORRY, just read the archive and you have done this... well done.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd June 2003, 16:51</div></div><div class="posttext">Heh, never mind :)<br />
<br />
The version I have put on that Archive page has a callback function that is called for every file found. The callback function can also stop the search. The function should work on a network share too because it gets a directory to search in as a parameter.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">banaman8d</div><div class="date">3rd June 2003, 05:13</div></div><div class="posttext">I have modified the script (only a couple lines of code) so that it is more general. The implications of this are potentially slower searches for people using this for finding a single file, with the benefit of having the ability to do whatever the user wants for every file in the search when necessary.<br />
<br />
I have included the modified version of Kichik's script on the archive page, that now searches for multiple versions of a file (and could do much more).<br />
<br />
This makes the scripts resemble POSIX scandir().</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">3rd June 2003, 09:49</div></div><div class="posttext">Here is my version of Search File, these are the qualities:<br />
<br />
- You can search by any folder or file in the hard drive, cdroms...<br />
- You can include subfolders in the search or not.<br />
- Have a option to show the results by Message Boxes and/or Detail Prints too, for each found file or folder.<br />
- By result, the function return the files found string, and the number of files found.<br />
- And a other to refine the result str (hehe)!<br />
- 1.7 x more quickly (than the normal Windows Search) if you don't use the folders with dot, 5.0 x more slowly if you use with dots (it's a drawback, this occur because the files have extension, so will search for every file, and detect if this is a file or directory).<br />
- This is a FUNCTION, without using your valuable variables (uses but return the original ones back)!<br />
<br />
Future Plans:<br />
<br />
- Put a option to stop to first file found (for those that want only to search one file).<br />
- Make a macro for all the function, to easily the work to copy the function, and to call it.<br />
- Make the Advanced Search For File, to search files with the size, modification date, or searching files for a text (will be more slow, and big, because search for every file information, with several functions in one).<br />
<br />
I will fix tomorrow the comments, I don't put any comments how to use it, and I don't have time now<br />
<br />
Here is my version of Search File Function:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd June 2003, 09:53</div></div><div class="posttext">Thanks banaman8d, I have added a link in the archive page.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">4th June 2003, 09:36</div></div><div class="posttext">OK! Some fixes and comments now about the pushes! (good code to detect folders with dot is your, Kichik, it have the same velocity of my without dot!)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">didava</div><div class="date">29th May 2007, 10:39</div></div><div class="posttext">plz hellp<br />
<br />
i con Search the hard drive For Delete<br />
<br />
for Example <br />
<br />
Search For .txt<br />
<br />
find &gt;<br />
<br />
&gt;&gt;&gt; Delete or partition Drive Delete <br />
<br />
 :rolleyes: <br />
<br />
POSSIBLE mack for me</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th May 2007, 11:52</div></div><div class="posttext">http://nsis.sourceforge.net/RecFind:_Recursive_FindFirst%2C_FindNext%2C_FindClose<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">didava</div><div class="date">29th May 2007, 12:54</div></div><div class="posttext">THANKS Afrow UK<br />
<br />
IMPOSSIBILITY</div></div><hr />


<div class="post"><div class="posttop"><div class="username">didava</div><div class="date">29th May 2007, 13:15</div></div><div class="posttext">${GetDrives} &quot;[Option]&quot; &quot;Function&quot;<br />
&quot;[Option]&quot;      ; [FDD+HDD+CDROM+NET+RAM]<br />
                ;   FDD    Floppy Disk Drives<br />
                ;   HDD    Hard Disk Drives <br />
                ;   CDROM  CD-ROM Drives<br />
                ;   NET    Network Drives<br />
                ;   RAM    RAM Disk Drives<br />
                ;<br />
                ; [ALL]<br />
                ;   Find all drives by letter (default)<br />
                ;<br />
&quot;Function&quot;      ; Callback function when found<br />
<br />
Function &quot;Function&quot;<br />
	; $9    &quot;drive letter&quot;  (a:\ c:\ ...)<br />
	; $8    &quot;drive type&quot;    (FDD HDD ...)<br />
<br />
	; $R0-$R9  are not used (save data in them).<br />
	; ...<br />
<br />
	Push $var    ; If $var=&quot;StopGetDrives&quot; Then exit from function<br />
FunctionEnd<br />
<br />
for Example<br />
<br />
${locate::Open} &quot;j:\&quot; &quot;/F=1 /D=1 /S=,Kb /T=,Creation delete/M=*.nsi /SD=NAME /B=1&quot; $R0<br />
<br />
Search For only .nsi file for delete<br />
<br />
THANKS</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>