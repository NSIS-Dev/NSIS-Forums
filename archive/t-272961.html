<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" servicelib doesn't work with uninstall functions, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  servicelib doesn't work with uninstall functions NSIS Discussion" />
	
	<title> servicelib doesn't work with uninstall functions [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  servicelib doesn't work with uninstall functions</div>
<hr />
<div class="pda"><a href="t-272961.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=272961">servicelib doesn't work with uninstall functions</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">MidnightJava</div><div class="date">17th June 2007, 06:07</div></div><div class="posttext">I'm following the instructions for using servicelib, but the !define doesn't seem to get defined, for some reason.<br />
<br />
From an uninstaller section, I call the following function:<br />
<br />
Function un.uninstallServices<br />
    !undef UN<br />
    !define UN &quot;.un&quot;<br />
    <br />
    #if client service running, stop it<br />
    !insertmacro SERVICE &quot;running&quot; &quot;rcb_Client&quot; &quot;action=stop;&quot;<br />
FunctionEnd <br />
<br />
But I get the following error on the !insertmacro line above:<br />
<br />
Call must be used with function names starting with &quot;un.&quot; in the uninstall section.<br />
Usage: Call function_name | [:label_name]<br />
Error in macro SERVICE on macroline 4<br />
Error in script &quot;C:\Documents and Settings\Mark\My Documents\Eclipse\RemoteClipBoard\rcb_setup.nsi&quot; on line 469 -- aborting creation process<br />
<br />
And by looking at line 4 of the SERVICE macro in servicelib.nsh<br />
<br />
!macro SERVICE ACTION NAME PARAM<br />
    Push '${ACTION}'<br />
    Push '${NAME}'<br />
    Push '${PARAM}'<br />
    Call ${UN}Service &lt;-- blows up here<br />
  !macroend <br />
<br />
It would appear that the !define had no effect.<br />
<br />
What am I missing??</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">17th June 2007, 09:17</div></div><div class="posttext">You should do it like this:<br />
  !macro SERVICE UN ACTION NAME PARAM<br />
    Push '${ACTION}'<br />
    Push '${NAME}'<br />
    Push '${PARAM}'<br />
    Call ${UN}Service<br />
  !macroend<br />
<br />
!insertmacro SERVICE &quot;un.&quot; &quot;running&quot; &quot;rcb_Client&quot; &quot;action=stop;&quot;<br />
!insertmacro SERVICE &quot;&quot; &quot;running&quot; &quot;rcb_Client&quot; &quot;action=stop;&quot;<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th June 2007, 20:08</div></div><div class="posttext">The correct usage is actually:Push &quot;action&quot;<br />
Push &quot;name&quot;<br />
Push &quot;param&quot;<br />
Call un.Service<br />
Pop $0 ;response</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MidnightJava</div><div class="date">17th June 2007, 20:28</div></div><div class="posttext">The servicelib documentation mentions two methods, equivalent to what Kichik and Afrow UK have suggested. However, the instructions in the comments of servicelib.nsh for invoking from the uninstaller seem to be incorrect.<br />
<br />
For method 1 (Kichik's post) the instructions say to call Service (not un.Service), and the call to un.Service or Service is handled internal to Service, depending on the defined value of UN. Likewise with method 2, there is no UN parameter when inserting the macro SERVICE, and the define for UN is used instead.<br />
<br />
Does the documentation for servicelib (and the change to SERVICE to add the UN parameter) need to be corrected? I'm using Version 1.4 Dec 7 2006, which was what I found by searching this site.<br />
<br />
Also is there some scope rule for defines being violated the way I attempted to run this? It seems that using !define UN should have worked.<br />
<br />
Thanks for your help. The script is working as needed.<br />
<br />
-Mark</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>