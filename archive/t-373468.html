<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Bug when installing for non-admin user (?), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Bug when installing for non-admin user (?) NSIS Discussion" />
	
	<title> Bug when installing for non-admin user (?) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Bug when installing for non-admin user (?)</div>
<hr />
<div class="pda"><a href="t-373468.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=373468">Bug when installing for non-admin user (?)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">ilanle</div><div class="date">3rd November 2013, 10:28</div></div><div class="posttext">Hey guys, <br />
<br />
I am not quite sure whether this is a bug or desired functionality...<br />
I am using the variable $LOCALAPPDATA when installing an app.<br />
<br />
I am requesting administrator permissions when installing ( RequestExecutionLevel admin<br />
 )<br />
<br />
I noticed something weird: when installing for a user which is not the admin, I get a popup requesting the administrator password. That's fine, only that I later find that the app was installed on the admin's profile instead of the current user's profile.<br />
<br />
How come?<br />
<br />
Ilan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">4th November 2013, 02:43</div></div><div class="posttext">RequestExecutionLevel admin: Install to $ProgramFiles and HKLM (Don't forget &quot;SetShellVarContext all&quot;)<br />
<br />
RequestExecutionLevel user: Install to $[Local]Appdata and HKCU (&quot;SetShellVarContext current&quot; is the default)<br />
<br />
If you mix and match you will run into issues, when elevating with UAC you can end up running as the &quot;wrong user&quot; etc.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ilanle</div><div class="date">4th November 2013, 06:47</div></div><div class="posttext">Thank you,<br />
<br />
1. Can you further elaborate on the difference between the admin execution level and the user execution level? Maybe I don't really need the admin execution level..<br />
<br />
2. You say if I use the admin level, then everything should be installed in the $ProgramFiles folder? Not using appData folder at all ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">4th November 2013, 20:13</div></div><div class="posttext">1) If you need to install a driver, NT service or write to HKLM/system files then you need to be elevated, otherwise it really depends on how you want your installer to operate (Machine/All users vs Single User/&quot;Just Me&quot; type of installs)<br />
<br />
2) If you use RequestExecutionLevel admin and the user is not admin then they have to elevate with a (different) admin user and the installer process then runs as that admin user and all per-user folders in the profile belong to that admin user and not the &quot;correct user&quot;.<br />
<br />
If you are doing a all users install and your application needs some per-user data in %appdata% based on some template then you should store that template data in the all users appdata (SetShellVarContext all + $appdata) or in $programfiles and when the application runs for the first time it should copy the data it needs to %appdata%...<br />
<br />
<br />
RequestExecutionLevel just changes the exe manifest that controls UAC operation when starting the program. This is not NSIS specific so you can read more about UAC on MSDN:<br />
<br />
http://msdn.microsoft.com/en-us/library/bb530410.aspx<br />
http://msdn.microsoft.com/en-us/library/aa905330.aspx<br />
http://msdn.microsoft.com/en-us/library/vstudio/bb384608.aspx<br />
http://technet.microsoft.com/en-us/library/00d04415-2b2f-422c-b70e-b18ff918c281<br />
http://msdn.microsoft.com/en-us/magazine/cc163486.aspx</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>