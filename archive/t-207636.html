<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Changing the location of install.log, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Changing the location of install.log NSIS Discussion" />
	
	<title> Changing the location of install.log [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Changing the location of install.log</div>
<hr />
<div class="pda"><a href="t-207636.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=207636">Changing the location of install.log</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Chilli24</div><div class="date">13th February 2005, 09:22</div></div><div class="posttext">Hi. I'm using the special build with logging enabled to compile my script. All is ok except the fact that everytime the install.log file is created in the $INSTDIR. Is it possible to change that location? I want the install.log to be created in a specific folder that I will create.<br />
I've tried<br />
SetOutPath &quot;$INSTDIR\$backupFolder&quot;<br />
Rename &quot;$INSTDIR\install.log&quot; '$INSTDIR\$backupFolder\install.log'<br />
but it doesn't work.<br />
Also is it possible to change the name of the file? I want it to be MyFile.log.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th February 2005, 13:22</div></div><div class="posttext">While your installer is running, the log file will obviously be locked for writing. This is why Rename isn't working. Just use<br />
Rename /REBOOTOK &quot;$INSTDIR\install.log&quot; &quot;$INSTDIR\$backupFolder\install.log&quot;<br />
so that it's moved on restart.<br />
<br />
Also, are you using a variable $backupFolder to store the backup folder name? Does the user have the option to change that folder name, or does it stay the same throughout the script.<br />
If it stays the same, then you'd be waisting memory on run-time. Not that it matters much, but it's good practice for programs to use as little memory on run-time as possible.<br />
You should use a !define backupFolder &quot;Backup&quot;. Then use ${backupFolder} in your script.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Chilli24</div><div class="date">13th February 2005, 13:36</div></div><div class="posttext">I don't yhink that the log file is locked for  writing because previous to that command I inserted LogSet off. So the install.log file should be free to handle now. Also to move the file after reboot doesn't help me. Because if the isntaller runs twice before reboot, all the actions are logged in the same install.log file. That's why I don't want to use /REBOOTOK. So taking into consideration that LogSet is off, how can I :<br />
- rename the file install.log  to, let's say MyProgram.log<br />
- how can I moved it into a folder without rebooting?<br />
P.S. Thanks hor the hint with $backupFolder</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th February 2005, 15:14</div></div><div class="posttext">How about making a test script which has LogSet on, then off, and then display a MessageBox (just to pause install).<br />
Then you could try and delete install.log to see if it's still locked or not.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th February 2005, 18:39</div></div><div class="posttext">The log file is only closed when the installer closes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Chilli24</div><div class="date">16th February 2005, 07:10</div></div><div class="posttext">OK. But how can I tell the installer to put the log file in another location, different form $INSTDIR like it is by default ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th February 2005, 07:13</div></div><div class="posttext">You can't without changing the source.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Chilli24</div><div class="date">16th February 2005, 07:33</div></div><div class="posttext">Ok. Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mr.hanky</div><div class="date">9th February 2006, 17:55</div></div><div class="posttext">Here is the last thing I do.<br />
<br />
    CopyFiles /silent &quot;$INSTDIR\install.log&quot; &quot;${MYLOGDIR}\N-2.log&quot;<br />
    Delete /REBOOTOK &quot;$INSTDIR\install.log&quot;<br />
<br />
<br />
*** EDIT ***<br />
Just noticed how old this was.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mtconleyuk</div><div class="date">20th September 2012, 09:59</div></div><div class="posttext">The log file is only closed when the installer closes.<br />
<br />
Is this really true? From the 2.46 code, it looks like handling of a LogSet Off will cause ExecuteEntry() to call log_write(1), which will call CloseHandle(fp) and set &lt;fp&gt; to INVALID_HANDLE_VALUE. That seems as though it should close the file. Is this not right?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th September 2012, 10:24</div></div><div class="posttext">You are right. They probably changed it at some point. After LogSet off, the handle is closed and the file can be renamed even with the installer still running.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mtconleyuk</div><div class="date">20th September 2012, 16:31</div></div><div class="posttext">Is there some condition under which LogSet On would fail to open the file in the specified location? I have code that looks basically like the following:<br />
<br />
LogSet Off<br />
Push $INSTDIR<br />
StrCpy $INSTDIR &quot;$myLogDir&quot;<br />
LogSet On<br />
LogText &quot;Hi there.&quot;<br />
Pop $INSTDIR<br />
<br />
and on some occasions this will wind up writing the install.log file into the original $INSTDIR folder, not the one I specified! I've stared at the source code, but I can't see any reason why this would happen.<br />
<br />
One possible clue is that when this happens, the installer is running with elevated permissions, using UAC::RunElevated. Again, though, I don't see why this should be a problem.<br />
<br />
Any thoughts?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th September 2012, 17:21</div></div><div class="posttext">Once you have used LogSet the path is now set for the log. Your LogSet off needs to be removed.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>