<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Automatic uninstall, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Automatic uninstall NSIS Discussion" />
	
	<title> Automatic uninstall [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Automatic uninstall</div>
<hr />
<div class="pda"><a href="t-66750.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=66750">Automatic uninstall</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">26th November 2001, 19:19</div></div><div class="posttext">I'm trying to construct the following:<br />
<br />
My setup detects whether or not it has been installed already<br />
and gives a message about this observation. If the user chooses<br />
not to overwrite (so make a backup) then my setup copies everything<br />
it can discover in $INSTDIR to $TEMP and calls the uninstall of the<br />
previous (installed) version. If this uninstall was succesful, the<br />
setup continues installing the new version.<br />
<br />
2 problems:<br />
<br />
1) is there a way to execute the uninstall &quot;silently&quot;? Normally the<br />
uninstall contains things like &quot;You're uninstalling!!! Continue???&quot;.<br />
Can the new setup shut these things down at runtime and run the<br />
uninstall silently?<br />
<br />
2) the setup executes the uninstall using ExecWait, but it actually<br />
doesn't wait for the uninstall to be closed. The setup just continues<br />
and (obviously) observes that uninstall was not succesfull. How can I<br />
get the install to wait for the uninstall?<br />
<br />
<br />
thx, greetz,<br />
<br />
- :D Hendri :D -</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">28th November 2001, 17:02</div></div><div class="posttext">does nobody have an answer to my questions above???<br />
<br />
Please help me out...<br />
<br />
Thx,<br />
<br />
- :D Hendri :D -</div></div><hr />


<div class="post"><div class="posttop"><div class="username">justin</div><div class="date">29th November 2001, 03:02</div></div><div class="posttext">If the uninstaller was generated with 1.7b2 or later, you can do this:<br />
<br />
ExecWait '&quot;$INSTDIR\uninst.exe&quot; /S _=$INSTDIR'<br />
Delete $INSTDIR\uninst.exe ; the uninstaller won't be able to delete itself when run above.<br />
<br />
<br />
And that will silently uninstall and wait. The /S switch will be ignored on earlier uninstallers, but the uninstaller will be executed and waited for though.<br />
<br />
-Justin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">29th November 2001, 06:36</div></div><div class="posttext">Thx Justin!<br />
<br />
I'll try your solution.<br />
<br />
Greetz,<br />
<br />
- :D Hendri :D -</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">30th November 2001, 08:05</div></div><div class="posttext">Still a question about this silent uninstall:<br />
<br />
How to detect at runtime that my uninstall is run silently?<br />
The problem: the /S parameter disappears from the commandline<br />
at run time, so I cannot check this...<br />
<br />
My Uninstall has to know this to be able block usermessages like<br />
MessageBox MB_YESNO &quot;You are uninstalling! Continue?&quot;<br />
<br />
Thx,<br />
<br />
- :D Hendri :D -</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">30th November 2001, 22:02</div></div><div class="posttext">When the uninstaller has _=$INSTDIR passed to it you should find that the problem of other parameters going missing will stop. The uninstaller normally copies to and relaunches itself from the $TEMP directory, but the presence of the _= parameter fools it into thinking this has already happened.<br />
<br />
Btw, here's a general purpose function I use for getting parameters from the command-line that hopefully might be useful.; GetNextParm<br />
;   Processes the next parameter, which may be quoted, from the string on the<br />
;   top of the stack.<br />
; Usage:<br />
;   Push &lt;parameters&gt;<br />
;   Call GetNextParm<br />
;   Pop &lt;next parameter&gt;<br />
;   Pop &lt;remaining parameters&gt;<br />
Function GetNextParm<br />
  Exch $0<br />
  Push $1<br />
  Push $9<br />
  Push $8<br />
  StrCpy $1 &quot;&quot;<br />
<br />
; Trim leading space<br />
TrimLeading:<br />
  StrCpy $9 $0 1<br />
  StrCmp $9 &quot;&quot; Done<br />
  StrCmp $9 '&quot;' DelimitQuote<br />
  StrCmp $9 &quot; &quot; &quot;&quot; DelimitSpace<br />
  StrCpy $0 $0 &quot;&quot; 1<br />
  Goto TrimLeading<br />
<br />
; Begin a quote-delimited parameter<br />
DelimitQuote:<br />
  StrCpy $0 $0 &quot;&quot; 1<br />
  Goto CopyParm<br />
<br />
; Begin a space-delimited parameter<br />
DelimitSpace:<br />
  StrCpy $9 &quot; &quot;<br />
<br />
; Extract the parameter<br />
CopyParm:<br />
  StrCpy $8 $0 1<br />
  StrCmp $8 &quot;&quot; Done<br />
  StrCpy $0 $0 &quot;&quot; 1<br />
  StrCmp $8 $9 Done<br />
  StrCpy $1 $1$8<br />
  Goto CopyParm<br />
<br />
Done:<br />
  Pop $8<br />
  Pop $9<br />
  Exch $1<br />
  Exch<br />
  Exch $0<br />
  Exch<br />
FunctionEnd<br />
e.g.  Push $CMDLINE<br />
  Call GetNextParm<br />
  Pop $0 ; exe name<br />
  StrCpy $9 &quot;&quot; ; /S flag<br />
<br />
ParmsLoop:<br />
  Call GetNextParm<br />
  Pop $0<br />
  StrCmp $0 &quot;&quot; ParmsDone ; No more parms<br />
  StrCpy $1 $0 2<br />
  StrCmp $1 &quot;_=&quot; ParmsDone ; No more /useful/ parms<br />
  StrCmp $0 &quot;/S&quot; ParmSlashS<br />
  Goto ParmsLoop<br />
<br />
ParmSlashS:<br />
  StrCpy $9 &quot;Y&quot;<br />
  Goto ParmsLoop<br />
<br />
ParmsDone:<br />
  Pop $0 ; Tidy the stack<br />
  StrCmp $9 &quot;Y&quot; Silent NotSilent<br />
etc...<br />
Good luck :) <br />
<br />
Dave.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">2nd December 2001, 08:20</div></div><div class="posttext">Thx Dave,<br />
<br />
your solution (GetNextParm) work great!<br />
<br />
Besides that I would like to inform you about the fact that the<br />
solution by Justin (with /S parameter and deleting uninstall after<br />
the actual uninstall) doesn't work on slow machines (like mine).<br />
<br />
After ExecWait returns, Windows hasn't really shut down the program,<br />
so we cannot delete it. Use something like:<br />
<br />
code:-----------------------------------------------------------------<br />
ExecWait '&quot;$INSTDIR\uninst.exe&quot; /S _=$INSTDIR'<br />
Sleep 500 ; wait for the uninstall to close<br />
Delete $INSTDIR\uninst.exe ; the uninstaller won't be able to delete itself when run above.<br />
----------------------------------------------------------------------<br />
<br />
This works fine on my machine!<br />
<br />
Good luck, thx again Dave, greetz,<br />
<br />
- :D Hendri :D -</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>