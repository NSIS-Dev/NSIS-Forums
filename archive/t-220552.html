<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" RMDir  not deleting root install folder, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  RMDir  not deleting root install folder NSIS Discussion" />
	
	<title> RMDir  not deleting root install folder [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  RMDir  not deleting root install folder</div>
<hr />
<div class="pda"><a href="t-220552.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=220552">RMDir  not deleting root install folder</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">GFORCE100</div><div class="date">3rd July 2005, 15:39</div></div><div class="posttext">I've just recompiled the installer code using NSIS 2.07 instead of 2.05 but for some reason the uninstaller doesn't allow deleting the root install folder.<br />
<br />
I don't recall having this error in NSIS 2.05.<br />
<br />
I'm using the below code to delete the install folders:<br />
<br />
;**************************************************************************************************<br />
;Delete files created upon installation<br />
;**************************************************************************************************<br />
<br />
;Delete &quot;$INSTDIR\Icons\*.*&quot;<br />
;Delete &quot;$INSTDIR\Help\*.*&quot;<br />
;Delete &quot;$INSTDIR\*.*&quot;<br />
<br />
;**************************************************************************************************<br />
;Delete folders created upon installation <br />
;**************************************************************************************************<br />
RMDir /r &quot;$INSTDIR&quot;<br />
<br />
<br />
Also in the script I have:<br />
<br />
**************************************************************************************************<br />
;Installer default installation folder<br />
;**************************************************************************************************<br />
InstallDir &quot;$PROGRAMFILES\xxx.yyy\zzz www 2006&quot;<br />
<br />
What's going wrong? All sub-folders get deleted just not the root install folder.<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">3rd July 2005, 16:04</div></div><div class="posttext">Windows not deletes application's current folder, so you should remove /SetOutPath $INSTALLDIR/ if this presents and not required in uninstaller (full paths in most cases) or change it before RMDir /SetOutPath ../.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GFORCE100</div><div class="date">3rd July 2005, 16:14</div></div><div class="posttext">Originally posted by Takhir <br />
Windows not deletes application's current folder, so you should remove /SetOutPath $INSTALLDIR/ if this presents and not required in uninstaller (full paths in most cases) or change it before RMDir /SetOutPath ../.  <br />
<br />
Hmmm<br />
<br />
I haven't changed any code (just names of files/folders) since when I compiled it with NSIS 2.05 so why suddenly does one need to take a different approach?<br />
<br />
I don't have SetOutPath $INSTALLDIR in my uninstaller section.<br />
<br />
I'm thinking it must be something to do with InstallDir being a two level folder (i.e. xxx\yyy). In such case it's deleting the sub folder (yyy) but not the root folder (xxx).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GFORCE100</div><div class="date">4th July 2005, 15:09</div></div><div class="posttext">Any other ideas anyone?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">4th July 2005, 16:23</div></div><div class="posttext">NSIS Documentation:<br />
Note that the current working directory can not be deleted. The current working directory is set by SetOutPath. <br />
Why you use (RMDir /r &quot;$INSTDIR&quot;)? Try this:<br />
SetOutPath &quot;$TEMP&quot;<br />
Delete &quot;$INSTDIR\Icons\*.*&quot;<br />
Delete &quot;$INSTDIR\Help\*.*&quot;<br />
Delete &quot;$INSTDIR\*.*&quot;<br />
RMDir &quot;$INSTDIR&quot;orSetOutPath &quot;$TEMP&quot;<br />
RMDir /r &quot;$INSTDIR&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GFORCE100</div><div class="date">7th July 2005, 17:59</div></div><div class="posttext">I changed it to what's below in the uninstaller sectio but the root installation folder still exists after I've run the uinstaller.<br />
<br />
It's content gets deleted, just not the root folder hence it's always left empty.<br />
<br />
SetOutPath &quot;$TEMP&quot;<br />
RMDir /r &quot;$INSTDIR&quot;<br />
<br />
This is confusing, I could swear it worked fine with NSIS 2.05 :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th July 2005, 18:15</div></div><div class="posttext">Try Sleep 1000 before it.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GFORCE100</div><div class="date">7th July 2005, 18:47</div></div><div class="posttext">Originally posted by Afrow UK <br />
Try Sleep 1000 before it.<br />
<br />
-Stu  <br />
<br />
Put in the sleep and no change.<br />
<br />
I'm beginning to scratch out the remaining hair I have :)<br />
<br />
I don't get it because neither is it a protected folder or a hidden or a system one.<br />
<br />
Below is my uninstall code, all works except the root folder delete:<br />
<br />
*******************<br />
<br />
;--------------------------------<br />
;UNINSTALLER SECTIONS #############################################################################<br />
<br />
<br />
;/////////////////////////////////////////////////////////<br />
Section &quot;Uninstall&quot;<br />
;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\<br />
<br />
;**************************************************************************************************<br />
;Delete files created upon installation<br />
;**************************************************************************************************<br />
<br />
;Delete &quot;$INSTDIR\Icons\*.*&quot;<br />
;Delete &quot;$INSTDIR\Help\*.*&quot;<br />
;Delete &quot;$INSTDIR\*.*&quot;<br />
<br />
;**************************************************************************************************<br />
;Delete folders created upon installation <br />
;**************************************************************************************************<br />
<br />
Sleep 1000 <br />
SetOutPath &quot;$TEMP&quot;<br />
RMDir /r &quot;$INSTDIR&quot;<br />
<br />
;**************************************************************************************************<br />
;Delete Start Menu links<br />
;**************************************************************************************************<br />
<br />
!insertmacro MUI_STARTMENU_GETFOLDER Application $R0<br />
    <br />
Delete &quot;$SMPROGRAMS\$R0\${STARTMENU_LINK_APP_NAME}.lnk&quot;<br />
Delete &quot;$SMPROGRAMS\$R0\${STARTMENU_LINK_APP_UNINSTALL}.lnk&quot;<br />
Delete &quot;$SMPROGRAMS\$R0\${STARTMENU_LINK_APP_HELP}.lnk&quot;<br />
<br />
Delete &quot;$QUICKLAUNCH\${STARTMENU_LINK_APP_NAME}.lnk&quot;<br />
  <br />
;Delete empty start menu parent diretories<br />
StrCpy $R0 &quot;$SMPROGRAMS\$R0&quot;<br />
 <br />
RMDir $R0<br />
 <br />
ClearErrors<br />
<br />
;**************************************************************************************************<br />
;Delete created registry keys<br />
;**************************************************************************************************<br />
DeleteRegKey HKLM &quot;Software\xxx.yyy&quot;<br />
DeleteRegKey HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\xxx.yyy zzz www 2006&quot;<br />
DeleteRegValue HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Run&quot; &quot;yyy www 2006&quot;<br />
<br />
SectionEnd<br />
<br />
;/////////////////////////////////////////////////////////<br />
Section &quot;-un.Uninstall VB6 runtimes&quot;<br />
;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\<br />
 <br />
	!insertmacro UnInstallLib REGDLL SHARED NOREMOVE &quot;$SYSDIR\msvbvm60.dll&quot;<br />
	!insertmacro UnInstallLib REGDLL SHARED NOREMOVE &quot;$SYSDIR\oleaut32.dll&quot; <br />
	!insertmacro UnInstallLib REGDLL SHARED NOREMOVE &quot;$SYSDIR\olepro32.dll&quot;<br />
	!insertmacro UnInstallLib REGDLL SHARED NOREMOVE &quot;$SYSDIR\comcat32.dll&quot; <br />
	!insertmacro UnInstallLib DLL    SHARED NOREMOVE &quot;$SYSDIR\asycfilt.dll&quot;<br />
	!insertmacro UnInstallLib TLB    SHARED NOREMOVE &quot;$SYSDIR\stdole2.tlb&quot;<br />
 <br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th July 2005, 18:49</div></div><div class="posttext">No hidden files in it?<br />
What about after a reboot with /rebootok?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GFORCE100</div><div class="date">7th July 2005, 19:06</div></div><div class="posttext">Originally posted by Afrow UK <br />
No hidden files in it?<br />
What about after a reboot with /rebootok?<br />
<br />
-Stu  <br />
<br />
You suggesting I force users to reboot after uninstallation? NSIS 2.05 worked fine.<br />
<br />
I'm going to checkt this now but I don't think it can be anything to do with the &quot;.&quot; in the folder name.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GFORCE100</div><div class="date">7th July 2005, 19:08</div></div><div class="posttext">I've also specified the install DIR as a three stage folder as below, but this is normal right?<br />
<br />
InstallDir &quot;$PROGRAMFILES\xxx.yyy\zzz www 2006&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GFORCE100</div><div class="date">7th July 2005, 19:10</div></div><div class="posttext">Well it's not the &quot;.&quot; in the folder name that's for sure, just checked! :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ParallaxTZ</div><div class="date">7th July 2005, 19:17</div></div><div class="posttext">I think you'll need a RMDirUp function that recursively removes any empty parent folders.<br />
<br />
I'll try to write one up and post it.  I have this same issue.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th July 2005, 19:41</div></div><div class="posttext">RMDir /r should do that. I just tried it and had no problems (2.07).<br />
<br />
Edit: No I'm not saying you must get the user to restart after uninstall. I'm asking you if it works after a reboot.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ParallaxTZ</div><div class="date">7th July 2005, 20:21</div></div><div class="posttext">Neither &quot;RMDir /r $INSTDIR&quot; or &quot;RMDir /r /REBOOTOK $INSTDIR&quot; remove the empty parent directories for me, before OR after a reboot.<br />
<br />
This is what I came up with and works fine:<br />
<br />
Function un.RMDirUP<br />
         !define RMDirUP '!insertmacro RMDirUPCall'<br />
<br />
         !macro RMDirUPCall _PATH<br />
                push '${_PATH}'<br />
                Call un.RMDirUP<br />
         !macroend<br />
<br />
         ; $0 - current folder<br />
         ClearErrors<br />
<br />
         Exch $0<br />
         ;DetailPrint &quot;ASDF - $0\..&quot;<br />
         RMDir &quot;$0\..&quot;<br />
         <br />
         IfErrors Skip<br />
         ${RMDirUP} &quot;$0\..&quot;<br />
         Skip:<br />
         <br />
         Pop $0<br />
<br />
FunctionEnd<br />
<br />
<br />
Use:<br />
<br />
  RMDir /r &quot;$INSTDIR&quot;<br />
  ${RMDirUP} &quot;$INSTDIR&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GFORCE100</div><div class="date">7th July 2005, 20:36</div></div><div class="posttext">Added the code above but where it calls it the compiler isn't very happy:<br />
<br />
Section: &quot;Uninstall&quot;<br />
RMDir: /r &quot;$INSTDIR&quot;<br />
Invalid command: ${RMDirUP}<br />
Error in script &quot;C:\XXX\YYY\Install\Install_NSIS\Setup.nsi&quot; on line 264 -- aborting creation process<br />
<br />
<br />
All I did was put in the below as mentioned above:<br />
<br />
RMDir /r &quot;$INSTDIR&quot;<br />
${RMDirUP} &quot;$INSTDIR&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ParallaxTZ</div><div class="date">7th July 2005, 20:38</div></div><div class="posttext">Before the Uninstall section you need to include that function I posted as well.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GFORCE100</div><div class="date">7th July 2005, 20:44</div></div><div class="posttext">Geez I feel really stupid for asking the last question because I remembered the answer the second I read &quot;You need....&quot;, I think it's showing I haven't been using NSIS for a while, :)<br />
<br />
Anyway compiled and it now deletes the root folder so all in all excellent!<br />
<br />
Thanks so much for getting this ironed out, :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>