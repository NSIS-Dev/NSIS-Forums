<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to write a UTF-8 file, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to write a UTF-8 file NSIS Discussion" />
	
	<title> How to write a UTF-8 file [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to write a UTF-8 file</div>
<hr />
<div class="pda"><a href="t-342377.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=342377">How to write a UTF-8 file</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">David Pi</div><div class="date">18th February 2012, 15:11</div></div><div class="posttext">Hi everyone.<br />
<br />
I'm working on this for a whole day, but still couldn't find the answer. This is my problem:<br />
<br />
1. I need to write a UTF-8 config file with nsis. <br />
<br />
2. I'm using NSIS Unicode.<br />
<br />
3. I've tried this code:<br />
<br />
    FileOpen $0 $EXEDIR\CONFIG.PATH w<br />
    FileWrite $0 $EXEDIR<br />
    FileClose $0<br />
<br />
    This create a ANSI file.<br />
<br />
4. I've tried FileWriteUTF16LE. It create a UTF-16LE file.<br />
<br />
5. Finally I found a solution: Write a ANSI file. Then use the Unicode plugin (http://nsis.sourceforge.net/Unicode_plug-in) to convent that file to UTF-8. But that is a ansi plugin, it's a bit complex to use in NSIS Unicode. So I don't think that is a good idea.<br />
<br />
Could someone tell me how to directly write a UTF-8 file in NSIS? Use WinAPI or something?<br />
<br />
Great appreciate.<br />
<br />
<br />
David Pi</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th February 2012, 11:52</div></div><div class="posttext">Unicode NSIS must be translating the string to ANSI before passing it to WriteFile. Try calling WriteFile directly using the System plug-in.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">David Pi</div><div class="date">20th February 2012, 12:01</div></div><div class="posttext">Thank you very much. This explained my question. But how to directly call WriteFile? Any examples? I know little about System Plugin.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th February 2012, 12:08</div></div><div class="posttext">Try a search.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">20th February 2012, 13:44</div></div><div class="posttext">You have to perform some steps with the system plugin:<br />
0 allocate byte buffer<br />
1 WideCharToMultiByte to convert from UTF16 to UTF8<br />
2 kernel32::WriteFile to write the converted buffer</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>