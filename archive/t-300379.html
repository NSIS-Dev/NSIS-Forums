<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Writing to HKLM in Vista, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Writing to HKLM in Vista NSIS Discussion" />
	
	<title> Writing to HKLM in Vista [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Writing to HKLM in Vista</div>
<hr />
<div class="pda"><a href="t-300379.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=300379">Writing to HKLM in Vista</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">xbarns</div><div class="date">27th November 2008, 15:26</div></div><div class="posttext">Hello everyone,<br />
<br />
i try writing to HKLM\Software\...... with one of my installers, i have defined<br />
<br />
RequestExecutionLevel admin<br />
<br />
but it does not work, UAC is disabled on my machine. <br />
<br />
Anyone know a quick workaround?<br />
<br />
Btw. here is what i use to test <br />
<br />
<br />
; example1.nsi<br />
;<br />
; This script is perhaps one of the simplest NSIs you can make. All of the<br />
; optional settings are left to their default settings. The installer simply <br />
; prompts the user asking them where to install, and drops a copy of example1.nsi<br />
; there. <br />
<br />
;--------------------------------<br />
<br />
; The name of the installer<br />
Name &quot;Example1&quot;<br />
<br />
; The file to write<br />
OutFile &quot;example1.exe&quot;<br />
<br />
; The default installation directory<br />
InstallDir $DESKTOP\Example1<br />
<br />
; Request application privileges for Windows Vista<br />
RequestExecutionLevel admin<br />
<br />
;--------------------------------<br />
<br />
; Pages<br />
<br />
Page directory<br />
Page instfiles<br />
<br />
;--------------------------------<br />
<br />
; The stuff to install<br />
Section &quot;&quot; ;No components page, name is not important<br />
<br />
  ; Set output path to the installation directory.<br />
  SetOutPath $INSTDIR<br />
  <br />
  ; Put file there<br />
  File example1.nsi<br />
<br />
  WriteRegStr HKLM &quot;Software\My Company\My Software&quot; &quot;String Value&quot; &quot;dead beef&quot;<br />
<br />
  <br />
SectionEnd ; end the section<br />
<br />
<br />
Thanks in advance<br />
xBarns</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nsnb</div><div class="date">27th November 2008, 15:52</div></div><div class="posttext">Call IsUserAdmin in your .onInit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xbarns</div><div class="date">27th November 2008, 16:23</div></div><div class="posttext">Well just so i can say i have done it, i have done that, it confirmed that the logged on user is an Administrator, but it still cannot write to HKLM\Software.....<br />
<br />
Any other ideas?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">27th November 2008, 16:24</div></div><div class="posttext">This is a bug in vista, when UAC is off and you are running as non-admin, elevation does not work. So you can check in oninit and display a message, or you can use the UAC plugin to elevate, it has built in manual elevation to work around this bug</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xbarns</div><div class="date">27th November 2008, 16:34</div></div><div class="posttext">This is a bug in vista, when UAC is off and you are running as non-admin, elevation does not work. <br />
<br />
UAC is off but I AM an admin.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nsnb</div><div class="date">27th November 2008, 16:37</div></div><div class="posttext">Do you have in your sections the following?<br />
SetShellVarContext all</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xbarns</div><div class="date">27th November 2008, 16:47</div></div><div class="posttext">Do you have in your sections the following?      quote:SetShellVarContext all <br />
<br />
for writing to the registry ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">27th November 2008, 17:15</div></div><div class="posttext">If you are admin, nothing should be stopping you from writing to HKLM, you could try Process Monitor from sysinternals and see if it gives you any clues (ERROR_ACCESS_DENIED etc)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xbarns</div><div class="date">27th November 2008, 17:35</div></div><div class="posttext">Wow, thanks for the tip, i now know where it writes my entries, it seems since i am on a Vista 64-bit Machine that it &quot;reflects&quot; registry entries from 32-bit apps to:<br />
<br />
HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\My Company\My Software<br />
<br />
and here MS says why:<br />
<br />
http://support.microsoft.com/?scid=kb%3Ben-us%3B305097&amp;x=15&amp;y=19 <br />
<br />
Nice to know, but that redirector seems to work, at least it reads from there also without any manual intervention.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">27th November 2008, 18:53</div></div><div class="posttext">SetRegView might be of help</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>