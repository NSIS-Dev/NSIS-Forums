<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" IfKeyExists??, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  IfKeyExists?? NSIS Discussion" />
	
	<title> IfKeyExists?? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  IfKeyExists??</div>
<hr />
<div class="pda"><a href="t-143600.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=143600">IfKeyExists??</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">26th July 2003, 00:25</div></div><div class="posttext">Is there a built-in function for &quot;IfKeyExists&quot;? If not, I think I'm going to attempt to make a function for that...and maybe others would like it as well. But, remember, I'm a beginner, so my way may not be the best way......it will just be A way. Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">26th July 2003, 00:30</div></div><div class="posttext">No I don't think that there is a function for this.  You might find EnumRegKey usefull in creating that function.<br />
<br />
Vytautas<br />
<br />
BTW If you need any help in creating it just ask;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">26th July 2003, 02:46</div></div><div class="posttext">I looked into creating IfKeyExists, but it looks like it's only worth making if it can be a built-in function...like IfFileExists...at least from what I know.<br />
<br />
In other words, WITHOUT being a built-in function, the call would look like this:<br />
Push $0<br />
Push $1<br />
Push $2<br />
Push $3<br />
Push $R0 'Return Value<br />
Call IfKeyExists<br />
Pop $3<br />
Pop $2<br />
Pop $1<br />
Pop $0<br />
StrCmp $R0 &quot;&quot; 0 ItExists<br />
  MessageBox &quot;Key Does Not Exist&quot;<br />
  GoTo Done<br />
ItExists:<br />
  MessageBox &quot;Key Exists&quot;<br />
Done:<br />
Pop $R0<br />
<br />
Or, you could simply use (I think this is how it's used):<br />
Push $R0<br />
EnumRegKey $R0 HKCU &quot;Software\Package&quot; &quot;Version&quot; &quot;0&quot;<br />
StrCmp $R0 &quot;&quot; 0 ItExists<br />
  MessageBox &quot;Key Does Not Exist&quot;<br />
  GoTo Done<br />
ItExists:<br />
  MessageBox &quot;Key Exists&quot;<br />
Done:<br />
Pop $R0<br />
<br />
OR...if it were built-in:<br />
IfKeyExists HKCU &quot;Software\Package&quot; &quot;Version&quot; 0 ItExists<br />
  MessageBox &quot;Key Does Not Exist&quot;<br />
  GoTo Done<br />
ItExists:<br />
  MessageBox &quot;Key Exists&quot;<br />
Done:<br />
<br />
What does everyone else think???</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">26th July 2003, 03:45</div></div><div class="posttext">I created a macro to do this, well almost, you can find it here. (http://nsis.sourceforge.net/archive/viewpage.php?pageid=307) After you insert this macro you should pop the result of the stack and check to see if it was found.<br />
<br />
I tried to create a macro which can jump to a label depending on the result however I could not figure out how to make the last parameter of the macro optional, any ideas?<br />
<br />
Hope this helps, BTW your code for EnumRegKey would not work, it will generate an infinate loop, you should increment the index every time you check for the next key.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th July 2003, 11:35</div></div><div class="posttext">There's an error.<br />
You have used Found for a jump instead of FoundMe<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th July 2003, 11:39</div></div><div class="posttext">What do yo umean by this?<br />
<br />
I tried to create a macro which can jump to a label depending on the result however I could not figure out how to make the last parameter of the macro optional, any ideas?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">26th July 2003, 13:23</div></div><div class="posttext">I tried this code and it worked but only if both labels are specified!insertmacro IfKeyExists &quot;ROOT&quot; &quot;KeyToCheckIn&quot; &quot;KeyToCheck&quot; &quot;GOTO_Here_IF_FOUND&quot; &quot;GOTO_Here_IF_NOT_FOUND&quot; I would like the last label to be optional like in similar function calls.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">26th July 2003, 13:26</div></div><div class="posttext">Originally posted by Afrow UK <br />
There's an error.<br />
You have used Found for a jump instead of FoundMe<br />
<br />
-Stu  Thanks, fixed that error.<br />
<br />
:o Vytautas :o</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th July 2003, 13:42</div></div><div class="posttext">Ah I don't really know.<br />
I didn't even know you could do jumps with InsertMacro's!<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">26th July 2003, 13:50</div></div><div class="posttext">I'm not sure you're supposed to but I tried and jumps to labels seemed to work.  Relative jumps would need heavy modification so probably are not a good idea.  You see the jumps work because !insertmacro code just does a copy&amp;paste of the macro into the script, not literally but effectively.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th July 2003, 16:10</div></div><div class="posttext">Ah yes I was thinking about that.<br />
Also, surely if you wanted people to use your code more than once in the same script then you should gave each label a specific name eg.<br />
<br />
FoundMe${BLAH}<br />
<br />
Have a look at how Modern UI uses Macro's and maybe that will help you find it out.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">27th July 2003, 05:18</div></div><div class="posttext">Thanks, I didn't think to test this macro more than once in the script.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">27th July 2003, 16:51</div></div><div class="posttext">Is there a built-in function for &quot;IfKeyExists&quot;?<br />
Wouldn't this do the job?<br />
ClearErrors<br />
ReadINIStr $4 &quot;$EXEDIR\\Settings.ini&quot; &quot;Settings&quot; &quot;Search String&quot;<br />
IfErrors &quot;&quot; cont<br />
MessageBox MB_OK `problems, problems!`<br />
cont:<br />
<br />
changing the ini for the registry</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">28th July 2003, 00:10</div></div><div class="posttext">Not quite, your solution will work with values NOT keys.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">28th July 2003, 12:49</div></div><div class="posttext">keys means branches, isn't it?<br />
<br />
in that case you can check for the default value every key has, isn't it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">28th July 2003, 13:20</div></div><div class="posttext">Yes, but most registry keys have blank, not set, dafault values so that function would not find those keys.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">30th July 2003, 03:24</div></div><div class="posttext">mmmm... I suppose that blank default values don't set the error flag to true.<br />
<br />
mmmm... I tested with this existant and empty key and doesn't report an error<br />
  ClearErrors<br />
  ReadRegStr $5 HKCR &quot;.art\\ShellEx&quot; &quot;&quot;<br />
  Iferrors &quot;&quot; noter<br />
    MessageBox MB_OK &quot;error&quot;<br />
  noter:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">30th July 2003, 03:55</div></div><div class="posttext">I tried both your code and the following code to a key that does not exist and both showed the message box.ClearErrors<br />
  ReadRegStr $5 HKCR &quot;.art\ShellEx.test&quot; &quot;&quot;<br />
  Iferrors &quot;&quot; noter<br />
    MessageBox MB_OK &quot;error&quot;<br />
  noter: It seems to me that the error flag is set if the value is not set and also if the value does not exist and is therefore not very usefull for the function we need here.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">30th July 2003, 19:02</div></div><div class="posttext">oh, I don't understand now.<br />
<br />
In my computer if the &quot;(Default)&quot; value is  &quot;(value not set)&quot; then the messagebox it's not showed.<br />
<br />
I am using win98se and I attach a snapshot of the registry when I use that piece of code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd August 2003, 21:58</div></div><div class="posttext">The error flag is set for ReadRegStr when the key can not be opened (security, not found or anything else), the value doesn't exist or can't be queried (again security, not found or anything else) or if the type of the value is wrong (not of type string).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">18th August 2003, 20:08</div></div><div class="posttext">sorry, I read this many times, and can't conclude if the idea I give is valid or not.<br />
<br />
It's still seems to me that is valid.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">18th August 2003, 21:18</div></div><div class="posttext">This below isn't sufficient to do it? (I don't know if the code below works because I don't have a personal computer, nor NSIS)<br />
<br />
EnumRegKey $0 HKLM &quot;Software/NSIS&quot; 0<br />
IfErrors 0 +3<br />
  StrCpy $0 0<br />
  Goto +2<br />
StrCpy $0 1<br />
<br />
Please, someone test it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">19th August 2003, 01:07</div></div><div class="posttext">deguix, the last parameter of the EnumRegKey is the index of the entry to check and thus it should be incremented otherwise it will either only check the first key or create an infinate loop.<br />
<br />
So the last '0' should be replaced with a variables which is incremented until the required key is found or all of the keys are search through.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">19th August 2003, 01:35</div></div><div class="posttext">You want to know if have keys inside the key, or want to know if it exist or not?<br />
<br />
(hey, my signature style is being copied by some users in this forum! My signature is going to be famous by this way!)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">19th August 2003, 03:23</div></div><div class="posttext">So does the EnumRegKeys function return the root key before it's subkeys?  I did not find that in the documentation &amp; can not check you code at this moment.  Will get back as soon as I can check it out although I dought it will work as expected.<br />
<br />
Vytautas<br />
<br />
PS Your idea for the signiture was really good.  Thanks ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">19th August 2003, 04:36</div></div><div class="posttext">ok, I am completely lost on this subject.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">19th August 2003, 14:18</div></div><div class="posttext">Doesn't the function in my archive pages work for you???<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AnalogKid</div><div class="date">13th November 2003, 20:19</div></div><div class="posttext">Right after the EnumRegKey call you put a colon on the goto label, which causes a 'couldn't resolve the label' compile-time error.<br />
<br />
<br />
&quot;${Index}-Loop:&quot;<br />
        ; Check for Key<br />
        EnumRegKey $R0 ${ROOT} &quot;${MAIN_KEY}&quot; &quot;$R1&quot;<br />
        StrCmp $R0 &quot;&quot; &quot;${Index}-False:&quot;<br />
<br />
<br />
that StrCmp line should read ... <br />
<br />
StrCmp $R0 &quot;&quot; &quot;${Index}-False&quot;<br />
<br />
<br />
I like your method, but it doesn't seem to work for me -- I haven't had luck with EnumRegKey and ReadRegStr either. Here's an example where I use a key that I know exists (looking at it in RegEdit):<br />
<br />
<br />
Function Sample<br />
  !insertmacro KeyExists HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\Adobe Acrobat 5.0&quot; &quot;DisplayName&quot;<br />
  Pop $R0<br />
  IntCmp $R0 0 EndSample EndSample 0<br />
<br />
  ;...code to handle stuff when we find the key ...<br />
  MessageBox MB_OK &quot;Wow it found it!&quot;<br />
  <br />
  EndSample:<br />
FunctionEnd<br />
<br />
<br />
... I never see the dialog box, even though I know the key exists. I figure that at least 1 other person in this forum will have Acrobat 5 (reader) installed, so if you can make the above code work on your system as-is then my machine is horked somehow. If there's a mistake, please let me know where I went wrong! <br />
<br />
NSIS 2.0b4, Win2K Pro ... <br />
<br />
Thanks!!<br />
<br />
AnalogKid<br />
=^{D}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">13th November 2003, 23:02</div></div><div class="posttext">Originally posted by Vytautas <br />
Doesn't the function in my archive pages work for you???<br />
<br />
Vytautas  <br />
<br />
Oh, sorry, I didn't read your reply. I was lost on the discussion, I haven't tried your function.<br />
<br />
I just couldn't understand why my idea does not work. :mad: :weird:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">13th November 2003, 23:20</div></div><div class="posttext">Right after the EnumRegKey call you put a colon on the goto label, which causes a 'couldn't resolve the label' compile-time error.  Thanks, fixed.<br />
<br />
As for the other problem.  'DisplayName' is NOT a key, keys appear as folders in regedit, so thats why the function does not work.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AnalogKid</div><div class="date">14th November 2003, 09:00</div></div><div class="posttext">Yes, sorry, I figured out what was wrong right about the same time I woke up and went home ... EnumRegValue is what I really wanted rather than EnumRegKey ;-)<br />
<br />
Thanks for the cool fn/macro and the ideas with the self-generating labels. I've never tried that before -- didn't know it would work ;-)<br />
<br />
I love these forums ... I get so much inspiration sometimes just by glancing through 'em!<br />
<br />
AnalogKid<br />
=^{D}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">14th November 2003, 09:51</div></div><div class="posttext">Originally posted by Vytautas <br />
As for the other problem.  'DisplayName' is NOT a key, keys appear as folders in regedit, so thats why the function does not work. <br />
<br />
I still don't understand.<br />
<br />
ClearErrors<br />
  ReadRegStr $5 HKCR &quot;.art\ShellEx.test&quot; &quot;&quot;<br />
  Iferrors &quot;&quot; noter<br />
    MessageBox MB_OK &quot;error&quot;<br />
  noter:<br />
This checks for the &quot;(Default)&quot; name which something every key (folder ;)) has.<br />
<br />
The only fault I can imagine is what kichik says: that the error flag could be triggered when it can't be opened because of security or can't be queried.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">14th November 2003, 11:47</div></div><div class="posttext">Although every key has that entry it is not set, e.g. is Null, and therefore NSIS sets the error flag as if the entry did not exist.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cherdeg</div><div class="date">18th April 2008, 15:41</div></div><div class="posttext">Hi,<br />
<br />
I try to use your macro to check for a certain registry key, this is my code:<br />
<br />
[...]<br />
	;Check if the standard Cygwin Registry keys exist (x32)<br />
	!insertmacro IfKeyExists HKLM &quot;SOFTWARE\Cygnus Solutions\Cygwin\mounts v2&quot; &quot;cygdrive flags&quot;<br />
	Pop $R0<br />
	IntCmp $R0 0 DoInstall ByReg ByReg<br />
	;Check if the standard Cygwin Registry keys exist (x64)<br />
	!insertmacro IfKeyExists HKLM &quot;SOFTWARE\Wow6432Node\Cygnus Solutions\Cygwin\mounts v2&quot; &quot;cygdrive flags&quot;<br />
	Pop $R0<br />
	IntCmp $R0 0 DoInstall ByReg ByReg<br />
	<br />
	;This is the label to jump to if a registy key is found<br />
	ByReg:<br />
	MessageBox MB_ICONSTOP &quot;RegistryKeys for Cygwin exist on this machine. Please first remove any installation of cygwin and then restart this installer...&quot;<br />
	Quit<br />
	<br />
	;This is the label to jump to if Cygwin is not installed yet.<br />
	DoInstall:<br />
[...]<br />
<br />
Why wouldn't it jump to ByReg if the key is found?<br />
<br />
Please help - I'm lost...<br />
<br />
Regards,<br />
<br />
Chris</div></div><hr />


<div class="post"><div class="posttop"><div class="username">PoRtAbLe_StEaLtH</div><div class="date">24th June 2012, 17:25</div></div><div class="posttext">Hi,<br />
<br />
I try to use your macro to check for a certain registry key, this is my code:<br />
<br />
[...]<br />
	;Check if the standard Cygwin Registry keys exist (x32)<br />
	!insertmacro IfKeyExists HKLM &quot;SOFTWARE\Cygnus Solutions\Cygwin\mounts v2&quot; &quot;cygdrive flags&quot;<br />
	Pop $R0<br />
	IntCmp $R0 0 DoInstall ByReg ByReg<br />
	;Check if the standard Cygwin Registry keys exist (x64)<br />
	!insertmacro IfKeyExists HKLM &quot;SOFTWARE\Wow6432Node\Cygnus Solutions\Cygwin\mounts v2&quot; &quot;cygdrive flags&quot;<br />
	Pop $R0<br />
	IntCmp $R0 0 DoInstall ByReg ByReg<br />
	<br />
	;This is the label to jump to if a registy key is found<br />
	ByReg:<br />
	MessageBox MB_ICONSTOP &quot;RegistryKeys for Cygwin exist on this machine. Please first remove any installation of cygwin and then restart this installer...&quot;<br />
	Quit<br />
	<br />
	;This is the label to jump to if Cygwin is not installed yet.<br />
	DoInstall:<br />
[...]<br />
<br />
Why wouldn't it jump to ByReg if the key is found?<br />
<br />
Please help - I'm lost...<br />
<br />
Regards,<br />
<br />
Chris<br />
<br />
<br />
you have 2 'ByReg'.<br />
<br />
it should be:<br />
IntCmp $R0 0 DoInstall ByReg<br />
<br />
Also.. if you're checking x64 reg key.. use SetRegView 64.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th June 2012, 22:16</div></div><div class="posttext">And use LogicLib instead of IntCmp.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>