<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" UninstallDir, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  UninstallDir NSIS Discussion" />
	
	<title> UninstallDir [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  UninstallDir</div>
<hr />
<div class="pda"><a href="t-135659.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=135659">UninstallDir</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">veekee</div><div class="date">17th May 2003, 09:22</div></div><div class="posttext">Hi<br />
<br />
Seems that bug has not been noticed yet.<br />
<br />
When using WriteUninstaller, the uninstaller can be created in any place. The problem is that the unnstall path used during unsinatll is based on the path of the uninstaller.<br />
So, if my uninstaller is copied to win directory, i won't be able to uninstall anything because INSTDIR will be initialized with a wrong value..<br />
<br />
One solution would be to be abe to use a command like UninstallDirRegKey ;)<br />
<br />
Regards<br />
<br />
Julien</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">17th May 2003, 12:55</div></div><div class="posttext">How about writing the $INSTDIR of the installer to the registry, and then in the uninstaller, simply read the $INSTDIR from the registry.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th May 2003, 13:19</div></div><div class="posttext">It's not a bug, it's by design and it is known.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deritrus</div><div class="date">21st November 2004, 22:27</div></div><div class="posttext">Hi kichik,<br />
<br />
I'm using NSIS 2.02 and I noticed this behaviour is still occuring.<br />
<br />
From my perspective, it would make sense for the uninstaller to use the &quot;true&quot; value of $INSTDIR as defined in the installer. I believe the uninstaller should work regardless of which directory it resides in, the same way the installer works regardless of what directory it resides in when it is executed.<br />
<br />
Consider the case of a user manually moving (by accident or on purpose) the uninstaller to a different directory. By having the uninstaller use the &quot;true&quot; value of $INSTDIR as defined in the installer, the uninstaller will continue to operate correctly.<br />
<br />
Furthermore, in the case when WriteUninstaller doesn't place the uninstaller in the installer's $INSTDIR directory, I don't believe the uninstaller should have to rely on workarounds such as reading an &quot;InstallLocation&quot; value hidden in the registry or in an .INI file, both of which could be deleted, leaving the uninstaller effectively crippled because it is not located in the &quot;correct&quot; directory.<br />
<br />
You mentioned this behaviour is by design. To let me understand your point of view, could you please explain your reasoning why you think the uninstaller should behave this way by design?<br />
<br />
Thanks!<br />
<br />
Shayne</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">23rd November 2004, 19:00</div></div><div class="posttext">It behaves this way so it'll be self contained by default and won't write anything, anywhere. And lets not forget the cool fact that it allows you to move the entire installation directory without having to reinstall.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deritrus</div><div class="date">23rd November 2004, 19:40</div></div><div class="posttext">Thanks for your reply! Okay, I can see your point.<br />
<br />
Now my rebuttal. And then I shall let the issue rest.<br />
<br />
Consider the following case. Someone writes an installer that puts the software in $PROGRAMFILES and the uninstaller in $WINDIR (like Firefox, for example). This person, unaware of the behaviour of $INSTDIR in the uninstaller, wrote the following code.<br />
<br />
<br />
InstallDir &quot;$PROGRAMFILES\MyApp&quot;<br />
<br />
Section<br />
  CreateDirectory &quot;$INSTDIR&quot;<br />
  File &quot;MyApp.exe&quot;<br />
  WriteUninstaller &quot;$WINDIR\Uninst.exe&quot;<br />
SectionEnd<br />
<br />
Section Uninstall<br />
  RMDir /r &quot;$INSTDIR&quot;<br />
  Delete &quot;$WINDIR\Uninst.exe&quot;<br />
SectionEnd<br />
<br />
<br />
Thinking $INSTDIR refers to the location in $PROGRAMFILES, the person believes the uninstaller will delete the software. But instead most of their OS gets killed. (Of course, using &quot;RMDir /r&quot; at any time is a risky game and should be avoided.)<br />
<br />
At the very least, I'd recommend adding to the documentation (http://nsis.sourceforge.net/Docs/Chapter4.html#4.2.2) a note about the $INSTDIR behaviour in the uninstaller.<br />
<br />
Thanks again!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">23rd November 2004, 20:13</div></div><div class="posttext">Lots of bad things can happen if you misuse any command, even Goto.<br />
<br />
I have added more information about it to the documentation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deritrus</div><div class="date">23rd November 2004, 22:32</div></div><div class="posttext">Especially Goto! :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th November 2004, 16:38</div></div><div class="posttext">Goto is very destructive. For example, this one will most certainly crash the installer:OutFile bla.exe<br />
Name bla<br />
Section<br />
Goto +1000<br />
SectionEndThis one will cause an infinte loop (the message box is there just so you can stop if you try it):Name bla<br />
OutFile bla.exe<br />
<br />
Function test<br />
Goto +2<br />
FunctionEnd<br />
<br />
Section<br />
MessageBox MB_YESNO &quot;stop?&quot; IDYES stop<br />
Call test<br />
stop:<br />
SectionEndAnd last but not least, this will erase all of the files in C:\Program Files (if you remove the comment from RMDir /R, of course):Name bla<br />
OutFile bla.exe<br />
<br />
Function test<br />
Pop $0<br />
StrCmp $0 bla +5<br />
MessageBox MB_OK &quot;didn't push bla&quot;<br />
# some commands that someone<br />
# commented. unfortunately, he/she<br />
# forgot to update the jump<br />
FunctionEnd<br />
<br />
Section<br />
Push bla<br />
Call test<br />
MessageBox MB_OK &quot;RMDir /R $$PROGRAMFILES&quot;<br />
#RMDir /R $PROGRAMFILES<br />
SectionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>