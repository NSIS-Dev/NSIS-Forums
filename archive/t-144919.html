<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" gethostbyname - machine name, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  gethostbyname - machine name NSIS Discussion" />
	
	<title> gethostbyname - machine name [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  gethostbyname - machine name</div>
<hr />
<div class="pda"><a href="t-144919.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=144919">gethostbyname - machine name</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Olomite</div><div class="date">6th August 2003, 17:45</div></div><div class="posttext">Does anyone have a NSIS utility that will get the host name of the machine?<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th August 2003, 17:47</div></div><div class="posttext">If you find a Windows API function that can do this you can use System.dll to call it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Olomite</div><div class="date">6th August 2003, 18:57</div></div><div class="posttext">Can you elaborate or this a little more?  Or point me to a similar example that uses an API call so I can use it as a template?<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th August 2003, 19:02</div></div><div class="posttext">For more information about the System.dll plug-in have a look in Contrib\System. Examples can be found by searching System::Call in the Archive (http://nsis.sf.net/archive) and in this forum. There are also some examples in Appendix C of the documentation in the latest CVS version.<br />
<br />
All of this is said assuming you're using NSIS 2.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">6th August 2003, 22:15</div></div><div class="posttext">514 in this script means required version 2.2 of windows sockets. Lower version doesn't work at my winxp. BTW there is error at C.5 paragraph of the documentation: call at the script should look like<br />
System::Call 'CondMgr::CmGetHotSyncExecPath(t, *i) i(.r0, r1r1).r2'<br />
or the script will never get the actual path length (djc should think better ;) joking of course :) <br />
Also the phrase 'There is one final wrinkle: placing a period/dot ('.') in front of a System.dll variable means 'makes no change to source' and it appears to be used everywhere except where a pointer is returned.' shows no sense to me... <br />
<br />
P.S. Ohh. Almost forgotten :) The script:<br />
<br />
     System::Alloc 400<br />
     pop $2<br />
     System::Call 'ws2_32::WSAStartup(i 514, i r2) i .r3'<br />
     System::Call 'ws2_32::gethostname(t .r0, i ${NSIS_MAX_STRLEN}) i .r1'<br />
     System::Call 'ws2_32::WSACleanup() i .r4'<br />
     System::Free $2<br />
     MessageBox MB_OK &quot;WSA startup result $3, WSA cleanup result $4, gethostname result $1, hostname $0&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Olomite</div><div class="date">6th August 2003, 22:27</div></div><div class="posttext">wahooo! Thanks so much.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">6th August 2003, 22:30</div></div><div class="posttext">Opps. It seems you wanted another thing... ;)<br />
<br />
     System::Alloc 400<br />
     pop $2<br />
     System::Call 'ws2_32::WSAStartup(i 514, i r2) i .r3'<br />
     System::Call 'ws2_32::gethostname(t .r0, i ${NSIS_MAX_STRLEN}) i .r1'<br />
     System::Call 'ws2_32::getaddrinfo(t &quot;www.google.com&quot;, t &quot;80&quot;, i 0, *i .r5) i.r6'<br />
     System::Call '*$5(i,i,i,i,i,i,i.r8)'  ; get sockaddr address from addr info structure<br />
     System::Call '*$8(&amp;i2, &amp;i2, &amp;i1.R0, &amp;i1.R1, &amp;i1.R2, &amp;i1.R3)' ;get IP address from sockaddr structure<br />
     System::Call 'ws2_32::freeaddrinfo(i r5)'<br />
     System::Call 'ws2_32::WSACleanup() i .r4'<br />
     System::Free $2<br />
     MessageBox MB_OK &quot;WSA results ($3, $1, $6, $4), hostaddr $R0.$R1.$R2.$R3&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dëëjayz</div><div class="date">9th September 2003, 15:08</div></div><div class="posttext">This code is exactly what I need, but I wonder why I got an error for the getaddrinfo, return IP 0.0.0.0? I pasted exactly the code!<br />
gethostname does work.<br />
<br />
thanks for any help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">9th September 2003, 16:03</div></div><div class="posttext">huh sorry, get addr info works on XP/Server2003 only.<br />
<br />
Microsoft Note:  The gethostbyname function has been deprecated by the introduction of the getaddrinfo function. Developers creating Windows Sockets 2 applications are urged to use the getaddrinfo function instead of gethostbyname.<br />
<br />
Cool, they are pushing developers to develop applications incompatible with previous windows version.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dëëjayz</div><div class="date">9th September 2003, 16:12</div></div><div class="posttext">Good to know ;)... Well how should I do to get the IP on previous windows station with gethostbyname?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">9th September 2003, 17:32</div></div><div class="posttext">Sorry. my memory is playng dirty games ;) Here it is (use one of the variants and remove the other).<br />
<br />
     System::Alloc 400<br />
     pop $R0<br />
     System::Call 'ws2_32::WSAStartup(i 0x202, i R0)'<br />
     System::Call 'ws2_32::gethostbyname(t &quot;www.google.com&quot;) i.R1'<br />
     System::Call '*$R1(&amp;v12,*i.R2)'<br />
<br />
     ; now there are 2 variants: <br />
<br />
     ; variant a - gets R4 as ip-addr<br />
     System::Call '*$R2(i.R3)'<br />
     System::Call 'ws2_32::inet_ntoa(i R3) t.R4'<br />
<br />
     ; variant b - gets R4 as 4 ip-addr bytes<br />
     System::Call '*$R2(&amp;i1.R5,&amp;i1.R6,&amp;i1.R7,&amp;i1.R8)'<br />
<br />
     ; clear everything anyway<br />
     System::Call 'ws2_32::WSACleanup()'<br />
     System::Free $R0<br />
<br />
     MessageBox MB_OK &quot;hostaddr $R4, or bytes $R5.$R6.$R7.$R8&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dëëjayz</div><div class="date">9th September 2003, 17:37</div></div><div class="posttext">Work perfectly ;) thank you much! 8-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">coopey247</div><div class="date">11th September 2003, 20:21</div></div><div class="posttext">What if I want to get the IP of the machine I am running the program on without entering the host name?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dëëjayz</div><div class="date">11th September 2003, 20:51</div></div><div class="posttext">Here what I have done... getting the hostname myself...<br />
<br />
  System::Alloc 400<br />
  pop $R0<br />
  System::Call 'ws2_32::WSAStartup(i 0x202, i R0)'<br />
  System::Call 'ws2_32::gethostname(t .r0, i ${NSIS_MAX_STRLEN}) i .r1'<br />
  System::Call 'ws2_32::gethostbyname(t &quot;$0&quot;) i.R1'<br />
  System::Call '*$R1(&amp;v12,*i.R2)'<br />
<br />
  System::Call '*$R2(i.R3)'<br />
  ; now there are 2 variants:<br />
  ; variant a - gets R4 as ip-addr<br />
  System::Call 'ws2_32::inet_ntoa(i R3) t.R4'<br />
<br />
  ; variant b - gets R4 as 4 ip-addr bytes<br />
  System::Call '*$R2(&amp;i1.R5,&amp;i1.R6,&amp;i1.R7,&amp;i1.R8)'<br />
<br />
  ; clear everything anyway<br />
  System::Call 'ws2_32::WSACleanup()'<br />
  System::Free $R0<br />
<br />
  MessageBox MB_OK &quot;hostname $0, hostaddr $R4, or bytes $R5.$R6.$R7.$R8&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yurik</div><div class="date">29th June 2005, 10:13</div></div><div class="posttext">Unfortunately, the latest scripts are crashing in case I've enter 'www.google,com' (',' instead of '.').<br />
How to prevent this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yurik</div><div class="date">29th June 2005, 10:27</div></div><div class="posttext">OK, it seems that one should check $R1 after gethostbyname and return failure result in case it is 0.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>