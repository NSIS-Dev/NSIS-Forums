<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Installer does not close, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Installer does not close NSIS Discussion" />
	
	<title> Installer does not close [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Installer does not close</div>
<hr />
<div class="pda"><a href="t-275118.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=275118">Installer does not close</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">slyrax</div><div class="date">30th July 2007, 08:01</div></div><div class="posttext">Hi,<br />
i think i need a little help with problem :)<br />
Im trying to make an .nsi to repack firefox for a silent install.<br />
The install-process works fine but after that the setup process does not<br />
end. Its still in the Task-List.<br />
<br />
Im using NSIS for the first time, maybe someone has an idea what is wrong. <br />
<br />
Thanks<br />
SL<br />
<br />
<br />
<br />
; Silent Installer<br />
 <br />
 <br />
; Set compression level to LZMA - smaller file<br />
SetCompressor /SOLID LZMA<br />
<br />
; Initiallization<br />
!define PRODUCT_NAME &quot;Firefox Silent Deploy&quot;<br />
!define PRODUCT_VERSION &quot;2.0.0.5&quot;<br />
!define LVM_GETITEMCOUNT 0x1004<br />
!define LVM_GETITEMTEXT 0x102D<br />
!define LogFileName &quot;Firefox.log&quot;<br />
<br />
; Some variables<br />
Var INSTALL_DIR<br />
<br />
; Include Libraries<br />
!include &quot;MUI.nsh&quot;<br />
!include &quot;WinMessages.nsh&quot;<br />
<br />
; MUI Settings<br />
!define MUI_ABORTWARNING<br />
!define MUI_ICON &quot;Firefox_Setup\Icon\Firefox.ico&quot;<br />
!define MUI_COMPONENTSPAGE_NODESC &quot;true&quot;<br />
<br />
; Welcome page<br />
!insertmacro MUI_PAGE_WELCOME<br />
; Components page<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
; Instfiles page<br />
!insertmacro MUI_PAGE_INSTFILES<br />
; Finish page<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
; Language files<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
; MUI end ------<br />
<br />
Name &quot;${PRODUCT_NAME} ${PRODUCT_VERSION}&quot;<br />
OutFile &quot;Firefox-2.0.0.5-silent-install.exe&quot;<br />
InstallDir &quot;$TEMP\Firefox&quot;<br />
<br />
<br />
<br />
ShowInstDetails nevershow ; can change this to 'hide' or 'show'<br />
<br />
<br />
SectionGroup &quot;Main Program&quot; SEC01<br />
<br />
	Section # &quot;Installer&quot;<br />
		DetailPrint &quot;Deploying Main Firefox Installer&quot;<br />
		SetOutPath &quot;$INSTDIR&quot;<br />
		SetOverwrite on<br />
<br />
; Unpack the Installer<br />
<br />
		IfSilent 0 +4<br />
		StrCpy $R2 &quot;Unpacking Firefox Installer&quot;<br />
		Push $R2<br />
		Call WriteBannerBottom<br />
		ExecWait &quot;$EXEDIR\Firefox_Setup.exe&quot;<br />
<br />
; Execute the Main Firefox Installer<br />
<br />
		IfSilent 0 +4<br />
		StrCpy $R2 &quot;Installing Firefox&quot;<br />
		Push $R2<br />
		Call WriteBannerBottom<br />
		ExecWait &quot;$TEMP\Firefox\setup.exe -ms&quot;<br />
<br />
; Get the short name for the INSTALL_DIR variable<br />
<br />
	GetFullPathName /SHORT $INSTALL_DIR &quot;$PROGRAMFILES\Mozilla Firefox&quot;<br />
	SectionEnd<br />
<br />
	<br />
SectionGroupEnd<br />
<br />
<br />
<br />
Section # &quot;PostInstall&quot;<br />
<br />
<br />
; Dump the Installer Log to a log-file<br />
<br />
	IfSilent +5 0<br />
	CreateDirectory $WINDIR\Logs<br />
	SetOutPath $WINDIR\Logs<br />
	Push ${LogFileName}<br />
	Call DumpLog<br />
	; Remove temporary files<br />
	SetOutPath $TEMP<br />
	RMDir /r $TEMP\Firefox<br />
	RMDir /r $TEMP\ns_temp<br />
SectionEnd<br />
<br />
; Section descriptions<br />
!insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br />
!insertmacro MUI_DESCRIPTION_TEXT ${SEC01} &quot;Main Program&quot;<br />
!insertmacro MUI_FUNCTION_DESCRIPTION_END<br />
<br />
; Functions<br />
<br />
Function .onInit<br />
	; Set installer mode to silent (remove the next line if you want to invoke the installer with the /S switch from the command prompt)<br />
	SetSilent silent<br />
	IfSilent 0 +2<br />
	Banner::show /NOUNLOAD /set 76 &quot;Firefox Deployment&quot; &quot;Initializing ...&quot;<br />
	; Extract the Installer Files<br />
	SetOutPath &quot;$INSTDIR&quot;<br />
		IfSilent 0 +4<br />
		StrCpy $R2 &quot;Expanding Installer Files&quot;<br />
		Push $R2<br />
		Call WriteBannerBottom<br />
	File /r &quot;Firefox_Setup\*.*&quot;<br />
	; Read settings from INI file<br />
FunctionEnd<br />
<br />
Function DumpLog<br />
  Exch $5<br />
  Push $0<br />
  Push $1<br />
  Push $2<br />
  Push $3<br />
  Push $4<br />
  Push $6<br />
<br />
  FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
  GetDlgItem $0 $0 1016<br />
  StrCmp $0 0 error<br />
  FileOpen $5 $5 &quot;w&quot;<br />
  StrCmp $5 0 error<br />
    SendMessage $0 ${LVM_GETITEMCOUNT} 0 0 $6<br />
    System::Alloc ${NSIS_MAX_STRLEN}<br />
    Pop $3<br />
    StrCpy $2 0<br />
    System::Call &quot;*(i, i, i, i, i, i, i, i, i) i \<br />
      (0, 0, 0, 0, 0, r3, ${NSIS_MAX_STRLEN}) .r1&quot;<br />
    loop: StrCmp $2 $6 done<br />
      System::Call &quot;User32::SendMessageA(i, i, i, i) i \<br />
        ($0, ${LVM_GETITEMTEXT}, $2, r1)&quot;<br />
      System::Call &quot;*$3(&amp;t${NSIS_MAX_STRLEN} .r4)&quot;<br />
      FileWrite $5 &quot;$4$\r$\n&quot;<br />
      IntOp $2 $2 + 1<br />
      Goto loop<br />
    done:<br />
      FileClose $5<br />
      System::Free $1<br />
      System::Free $3<br />
      Goto exit<br />
  error:<br />
    MessageBox MB_OK error<br />
  exit:<br />
    Pop $6<br />
    Pop $4<br />
    Pop $3<br />
    Pop $2<br />
    Pop $1<br />
    Pop $0<br />
    Exch $5<br />
FunctionEnd<br />
	<br />
<br />
Function WriteBannerBottom<br />
	Banner::getWindow /NOUNLOAD<br />
	Pop $1<br />
	GetDlgItem $2 $1 1030<br />
	SendMessage $2 ${WM_SETTEXT} 1 &quot;STR:$R2&quot;<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2007, 11:05</div></div><div class="posttext">Can you identify which one of the two does not close?<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>