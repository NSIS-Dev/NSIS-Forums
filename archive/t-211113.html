<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" VersionCheckNew testing, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  VersionCheckNew testing NSIS Discussion" />
	
	<title> VersionCheckNew testing [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  VersionCheckNew testing</div>
<hr />
<div class="pda"><a href="t-211113.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=211113">VersionCheckNew testing</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">22nd March 2005, 19:28</div></div><div class="posttext">I've tried and tested the function so many times, but there's always one version string comparison kind that gets through with false results.<br />
<br />
The last update to the function was to compare each digit of the numbers between the dots one by one. However, recently Daijoubu reported that it would fail on 7 &amp; 10. This is because it would compare 7 with 1 and immediately think the 1st one was larger! I've fixed the problem now (which has made the function even bigger!)<br />
<br />
I was wondering if anyone could test the function more for me, which is here:<br />
http://nsis.sourceforge.net/archive/edit.php?pageid=533&amp;instances=0,757<br />
<br />
If you find one that fails, post it here so I can see it.<br />
<br />
Cheers<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">23rd March 2005, 09:10</div></div><div class="posttext">Probably Afrow UK mean:<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=757&amp;instances=0,11,122,754</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">23rd March 2005, 09:58</div></div><div class="posttext">(which has made the function even bigger!)<br />
It's because there is check per digit per number and many exceptions. I choose other way - digits capacity in VersionCompare. I don't found any false results in  VersionCheckNew (v4).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd March 2005, 12:55</div></div><div class="posttext">Ah yeh, sorry I posted link to edit :)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">28th March 2005, 10:10</div></div><div class="posttext">${VersionCheckNew} &quot;91.1.1.1&quot; &quot;101.1.1.1&quot; $R0$R0=&quot;1&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th March 2005, 20:02</div></div><div class="posttext">Thanks Instructor. I found that problem a few days ago too and I think it's fixed now. It took me a few hours, but I thought of a new solution which should fix all the problems.<br />
Uploaded as v5<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">29th March 2005, 09:22</div></div><div class="posttext">Very bad that you don't trying to see what do others :(<br />
<br />
<br />
P.S.${VersionCheckV5} &quot;1.001&quot; &quot;1.0&quot; $R0$R0=&quot;2&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th March 2005, 11:15</div></div><div class="posttext">Thanks fixed.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">7th June 2005, 13:08</div></div><div class="posttext">Version &quot;1.00&quot; is newer than &quot;1.0&quot;. Is it supposed to be?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th June 2005, 13:11</div></div><div class="posttext">I'd just use Instructors VersionCompare :p<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">7th June 2005, 13:33</div></div><div class="posttext">Another question (general).<br />
Why &quot;1.1.1.1&quot; not equal to &quot;1.1.1.01&quot;?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th June 2005, 13:57</div></div><div class="posttext">Because 01 is older than 1, as we go up in 01, 02, 03, to 1. 1 would be counted as &quot;10&quot;.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">7th June 2005, 14:12</div></div><div class="posttext">Than, if I include in script<br />
VIProductVersion &quot;1.1.0.001&quot;<br />
VIAddVersionKey &quot;LegalCopyright&quot; 'Ltd.'<br />
VIAddVersionKey &quot;FileDescription&quot; &quot;Test file&quot;<br />
VIAddVersionKey &quot;FileVersion&quot; &quot;1.1.0.001&quot;<br />
<br />
And use GetDllVersion - version will be 1.1.0.1. Why?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th June 2005, 14:17</div></div><div class="posttext">NSIS treats 001 in a variable as 1 (when using IntOp)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">7th June 2005, 20:15</div></div><div class="posttext">Because 01 is older than 1, as we go up in 01, 02, 03, to 1. 1 would be counted as &quot;10&quot;.My opinion is that, the extra zeros in versions are just to show how the author organizes his versions. I think, zeros should be ignored if they are on the left of the number. Example: 1.01 = 1.00001. By this reasoning, I think Afrow UK is wrong in saying that 1.01 is older than 1.1, because it's like giving the extra digit a separation mark, like the &quot;.&quot;. With Afrow's idea, what would be newer: 1.00, 1.0 or 1?<br />
<br />
To make a version comparasion with only numbers, it's a matter of comparing the numbers inside the four groups w/ IntCmp, nothing more (and logically converting those numbers to be supported as decimal by NSIS, because 001 is considered as an octal number).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">8th June 2005, 08:30</div></div><div class="posttext">I think, zeros should be ignored if they are on the left of the number. Example: 1.01 = 1.00001. By this reasoning, I think Afrow UK is wrong in saying that 1.01 is older than 1.1, because it's like giving the extra digit a separation mark, like the &quot;.&quot;.Afrow UK isn't wrong:<br />
1.01 != 1.00001, because 1.01 != 1.10<br />
In your words NSIS 2.01 = NSIS 2.1 (it will be I hope :) )</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">8th June 2005, 11:43</div></div><div class="posttext">My opinion is that, the extra zeros in versions are just to show how the author organizes his versions. I think, zeros should be ignored if they are on the left of the number. Example: 1.01 = 1.00001. By this reasoning, I think Afrow UK is wrong in saying that 1.01 is older than 1.1, because it's like giving the extra digit a separation mark, like the &quot;.&quot;.<br />
I am subscribe to this opinion.<br />
<br />
2Instructor<br />
Afrow UK isn't wrong:<br />
1.01 != 1.00001, because 1.01 != 1.10<br />
In your words NSIS 2.01 = NSIS 2.1 (it will be I hope :))<br />
I don't agree. NSIS 2.01 has full version number 2.0.1, NSIS 2.1 wil be - 2.1.0.<br />
In your words 1 kg 1000 times greater than 0001 kg.:):D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">8th June 2005, 12:23</div></div><div class="posttext">What sense give to the program version 1.01, if the same is 1.1? I saw only one reason: if number 1.01 compared with 1.1 it will be older :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">8th June 2005, 12:37</div></div><div class="posttext">I agree there is IMHO no sense in versioning 1.02<br />
This is for me v1.0.2.x<br />
Versioning scheme as I see it...<br />
<br />
A.B.C.D<br />
<br />
A = Product Major Version<br />
B = Product Feature Release<br />
C = Product Release incrementeal ID<br />
D = Fix/Test/Debug/ for short the Build number<br />
<br />
Example for a e.g. wordprocessor:<br />
<br />
0.x = Initial development<br />
1.0.0.0 = Initial Debug Release<br />
1.0.0.57 = 57th testing build<br />
1.0.1.1 = Initial &quot;official&quot; build<br />
1.0.1.33 = 33rd fix for the official build<br />
1.0.2.1 = Second &quot;official&quot; build including all bug fixes<br />
1.1.1.278 = Now we have a spell checker<br />
1.2.1.45 = And a thesaurus.<br />
2.0.1.352 = And we introduced Linux compatibility because we built it with Kylix :)<br />
<br />
Use this structure internally, it works very well. A customer needs to know A.B for features, A.B.C for fixes to features, and we use D internally for testing/debugging and emergency fixes for when taxes don't add up.<br />
<br />
Success to everyone to streamline the versioning of your releases.<br />
<br />
Emin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">10th June 2005, 16:06</div></div><div class="posttext">normally its used this way:<br />
major.minor.release.build<br />
<br />
for most open source projects:<br />
1.0.0.xxx - first public release<br />
1.1.0.1 - first beta for 1.2 release<br />
1.2.0.xxx - second public release<br />
1.9.xx.xxx - beta releases for 2.0 RC<br />
2.0.0.xxx - second major version, means bigger changes.<br />
<br />
and so on ...<br />
the last number (&quot;build&quot;) is increased everytime a new beta/release is build and reset everytime the releasenumber changes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NHOCSUNG</div><div class="date">10th June 2005, 23:46</div></div><div class="posttext">you try this ... i didn't find any problem<br />
<br />
!insertmacro STRFUNC_DEFFUNC VersionCheck<br />
  !define VersionCheck_List `ResultVar|CurVersion|CmpVersion`<br />
  !define VersionCheck_TypeList `Output 0 1 2|Text|Text`<br />
  !macro `FUNCTION_STRING_UnVersionCheck`<br />
    !undef UnVersionCheck<br />
    !insertmacro FUNCTION_STRING_VersionCheck<br />
  !macroend<br />
<br />
!macro FUNCTION_STRING_VersionCheck<br />
    !insertmacro STRFUNC_FUNC `VersionCheck` `2004 - 2005 Tu Tong - Based on functions by Tu Tong`<br />
<br />
      Exch $R0<br />
      Exch<br />
      Exch $R1<br />
      Exch<br />
      Push $R2<br />
      Push $R3<br />
      Push $R4<br />
      Push $R5<br />
      Push $R6<br />
      Push $R7<br />
      <br />
      StrCmp $R0 &quot;&quot; error 0<br />
      StrCmp $R1 &quot;&quot; error 0<br />
      <br />
      StrCmp $R0 $R1 sameversion 0<br />
<br />
      ClearErrors<br />
      loop:<br />
        IfErrors sameversion<br />
        StrCmp $R0 &quot;&quot; sameversion<br />
        StrCmp $R1 &quot;&quot; sameversion<br />
<br />
        StrCpy $R4 $R0<br />
        GetLabelAddress $R7 return<br />
          Goto parse<br />
        return:<br />
        StrCpy $R6 $R3<br />
        StrCpy $R0 $R4<br />
<br />
        StrCpy $R4 $R1<br />
        GetLabelAddress $R7 return1<br />
          Goto parse<br />
        return1:<br />
        StrCpy $R5 $R3<br />
        StrCpy $R1 $R4<br />
<br />
        IntCmp $R6 $R5 0 olderversion newerversion<br />
        Goto loop<br />
<br />
      parse:<br />
      StrCpy $R2 0<br />
      StrLen $R5 $R4<br />
      parseloop:<br />
        StrCpy $R3 $R4 1 $R2<br />
        StrCmp $R3 &quot;.&quot; parsecpy 0<br />
        IntCmp $R5 $R2 parsecpy parsecpy 0<br />
        IntOp $R2 $R2 + 1<br />
        Goto parseloop<br />
<br />
      parsecpy:<br />
      StrCpy $R3 $R4 $R2<br />
<br />
      IntOp $R5 $R5 - $R2<br />
      IntOp $R2 $R2 + 1<br />
      StrCpy $R4 $R4 $R5 $R2<br />
      Goto $R7<br />
<br />
      newerversion:<br />
        StrCpy $R0 &quot;2&quot;<br />
        Goto checkdone<br />
<br />
      sameversion:<br />
        StrCpy $R0 &quot;0&quot;<br />
        Goto checkdone<br />
<br />
      olderversion:<br />
        StrCpy $R0 &quot;1&quot;<br />
        Goto checkdone<br />
<br />
      error:<br />
        StrCpy $R0 &quot;&quot;<br />
<br />
      checkdone:<br />
      ClearErrors<br />
<br />
<br />
      Pop $R7<br />
      Pop $R6<br />
      Pop $R5<br />
      Pop $R4<br />
      Pop $R3<br />
      Pop $R2<br />
      Pop $R1<br />
      Exch $R0<br />
<br />
      ;------------------------<br />
      ;End<br />
<br />
    FunctionEnd<br />
<br />
  !macro FUNCTION_STRING_VersionCheck_Call ResultVar CurVersion CmpVersion<br />
    !verbose push<br />
    !verbose 4<br />
    !echo `$ {VersionCheck} &quot;${ResultVar}&quot; &quot;${CurVersion}&quot; &quot;${CmpVersion}&quot;`<br />
    !verbose pop<br />
<br />
    Push `${CurVersion}`<br />
    Push `${CmpVersion}`<br />
    Call VersionCheck<br />
    Pop `${ResultVar}`<br />
  !macroend<br />
  !macro FUNCTION_STRING_UnVersionCheck_Call ResultVar CurVersion CmpVersion<br />
    !verbose push<br />
    !verbose 4<br />
    !echo `$ {UnVersionCheck} &quot;${ResultVar}&quot; &quot;${CurVersion}&quot; &quot;${CmpVersion}&quot;`<br />
    !verbose pop<br />
<br />
    Push `${CurVersion}`<br />
    Push `${CmpVersion}`<br />
    Call un.VersionCheck<br />
    Pop `${ResultVar}`<br />
  !macroend<br />
<br />
  !macroend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">11th June 2005, 04:10</div></div><div class="posttext">It's better for you to post a normal function, because UseFunc (old StrFunc) is being developed, so this function would need to be changed to adapt to future newer versions.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NHOCSUNG</div><div class="date">24th August 2005, 21:50</div></div><div class="posttext">okay deguix i'll post normal function<br />
<br />
here my update<br />
<br />
Function VersionCheck<br />
      Exch $R1<br />
      Exch<br />
      Exch $R0<br />
      Exch<br />
      Push $R2<br />
      Push $R3<br />
      Push $R4<br />
      Push $R5<br />
      Push $R6<br />
<br />
      ${If} $R0 == &quot;&quot;<br />
      ${OrIf} $R1 == &quot;&quot;<br />
        Goto Error<br />
      ${EndIf}<br />
<br />
      StrCmp $R0 $R1 sameversion<br />
      <br />
      StrCpy $R4 $R0<br />
      Call :complete<br />
      StrCpy $R0 $R4<br />
      <br />
      StrCpy $R4 $R1<br />
      Call :complete<br />
      StrCpy $R1 $R4<br />
      <br />
      Goto compare<br />
      <br />
      complete:<br />
      StrCpy $R6 0<br />
      StrCpy $R2 0<br />
      StrLen $R5 $R4<br />
      ${Do}<br />
        StrCpy $R3 $R4 1 $R2<br />
        ${If} $R3 == &quot;.&quot;<br />
          IntOp $R6 $R6 + 1<br />
        ${EndIf}<br />
        ${IfThen} $R2 &gt;= $R5 ${|} ${ExitDo} ${|}<br />
        IntOp $R2 $R2 + 1<br />
      ${Loop}<br />
      <br />
      ${Select} $R6<br />
        ${Case} 0<br />
          StrCpy $R4 &quot;$R4.0.0.0&quot;<br />
        ${Case} 1<br />
          StrCpy $R4 &quot;$R4.0.0&quot;<br />
        ${Case} 2<br />
          StrCpy $R4 &quot;$R4.0&quot;<br />
        ${CaseElse}<br />
          StrCpy $R4 &quot;$R4&quot;<br />
      ${EndSelect}<br />
      Return<br />
      <br />
      compare:<br />
      ClearErrors<br />
      Loop:<br />
        IfErrors sameversion<br />
        StrCmp $R0 &quot;&quot; sameversion<br />
        StrCmp $R1 &quot;&quot; sameversion<br />
        <br />
        StrCpy $R4 $R0<br />
        Call :parse<br />
        StrCpy $R6 $R3<br />
        StrCpy $R0 $R4<br />
<br />
        StrCpy $R4 $R1<br />
        Call :parse<br />
        StrCpy $R5 $R3<br />
        StrCpy $R1 $R4<br />
        <br />
        IntCmp $R6 $R5 0 olderversion newerversion<br />
      Goto Loop<br />
<br />
      parse:<br />
      StrCpy $R2 0<br />
      StrLen $R5 $R4<br />
      ${Do}<br />
        StrCpy $R3 $R4 1 $R2<br />
        ${IfThen} $R3 == &quot;.&quot; ${|} ${ExitDo} ${|}<br />
        ${IfThen} $R2 &gt;= $R5 ${|} ${ExitDo} ${|}<br />
        IntOp $R2 $R2 + 1<br />
      ${Loop}<br />
<br />
      StrCpy $R3 $R4 $R2<br />
<br />
      IntOp $R5 $R5 - $R2<br />
      IntOp $R2 $R2 + 1<br />
      StrCpy $R4 $R4 $R5 $R2<br />
      Return<br />
<br />
      olderversion:<br />
        StrCpy $R0 &quot;2&quot;<br />
        Goto checkdone<br />
        <br />
      newerversion:<br />
        StrCpy $R0 &quot;1&quot;<br />
        Goto checkdone<br />
<br />
      sameversion:<br />
        StrCpy $R0 &quot;0&quot;<br />
        Goto checkdone<br />
<br />
      error:<br />
        StrCpy $R0 &quot;&quot;<br />
<br />
      checkdone:<br />
      ClearErrors<br />
<br />
      Pop $R6<br />
      Pop $R5<br />
      Pop $R4<br />
      Pop $R3<br />
      Pop $R2<br />
      Pop $R1<br />
      Exch $R0<br />
<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>