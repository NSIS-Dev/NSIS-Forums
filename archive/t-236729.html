<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to Detect Other Windows Logons, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to Detect Other Windows Logons NSIS Discussion" />
	
	<title> How to Detect Other Windows Logons [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to Detect Other Windows Logons</div>
<hr />
<div class="pda"><a href="t-236729.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=236729">How to Detect Other Windows Logons</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">JoeAcunzo</div><div class="date">30th January 2006, 16:15</div></div><div class="posttext">During an install, is there a way to detect if there are other Window users logged into the machine?  I want to prevent installation if there are other users logged on.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st January 2006, 18:43</div></div><div class="posttext">You can write a plug-in that'd use WTSEnumerateSessions (http://msdn.microsoft.com/library/en-us/termserv/termserv/wtsenumeratesessions.asp) or call it using the System plug-in.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JoeAcunzo</div><div class="date">31st January 2006, 22:05</div></div><div class="posttext">Yep, I've started down that path already.  I wrote a small C++ program to experiment with WTSEnumerateSessions, which works nicely.<br />
<br />
Unfortunately, it will be a bit of a pain in NSIS due to the memory pointer it returns to an array of structures.  Can you point me to any sample NSIS code that does something similar (use a pointer to walk an array of structs)?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">goldy1064</div><div class="date">31st January 2006, 23:44</div></div><div class="posttext">In the plugin you already wrote, just add another function that can return the appropriate data you need to the installer via the NSIS stack.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd February 2006, 10:44</div></div><div class="posttext">You said you wanted to find out if another user is logged on, there's no need to return an array to the script for that. Have the plug-in check if there's more than one session and return a simple string.<br />
<br />
If you want to return an array anyway, check out:<br />
<br />
http://nsis.sourceforge.net/Enumerate_CD-ROM_Drives</div></div><hr />


<div class="post"><div class="posttop"><div class="username">M-Force</div><div class="date">12th November 2007, 18:33</div></div><div class="posttext">Hi JoeAcunzo,<br />
<br />
I try to figure out as well if other users are logged on to the system at install time.<br />
<br />
Could you please post your solution how to detect if multiple users are logged on.<br />
<br />
Thank you very much for your help.<br />
<br />
M.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">22nd November 2007, 15:16</div></div><div class="posttext">Hello<br />
<br />
I try to figure out as well if other users are logged on to the system at install time.<br />
<br />
Could you please post your solution how to detect if multiple users are logged on.<br />
i need it thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">23rd November 2007, 09:09</div></div><div class="posttext">BUMP</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">26th November 2007, 20:53</div></div><div class="posttext">Ok i try my best to fine solution and as my little knowledge in scripting i was not successes man in this case<br />
<br />
i read whole of forum<br />
and wiki and read me and hep file<br />
<br />
as i don't want to create new topic with the same tile so decide to pop up this old topic the only one that discuss about detecting multiuser login in one system<br />
<br />
what i need exactly?<br />
<br />
i need a solution to detect if another user except current user are log in to the system or not and if it is force them to log off<br />
<br />
i know all of you are busy but i will wait for your answer because i can;t down anything else i am newbie in everything :(<br />
<br />
any help...<br />
any little suggestion...<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th November 2007, 23:23</div></div><div class="posttext">I supplied the answer in my first reply.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">5th December 2007, 21:44</div></div><div class="posttext">please explain more how can i call  WTSEnumerateSessions with system?<br />
<br />
is there more simple way to detect if a user is log in or not? :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th December 2007, 21:54</div></div><div class="posttext">!include LogicLib.nsh<br />
#...<br />
System::Call 'wtsapi32::WTSEnumerateSessions(i 0, i 0, i 1, *i .r0, *i .r1) i .r2'<br />
${If} $2 != 0<br />
	${If} $1 != 1<br />
		MessageBox MB_OK &quot;more than one user logged in&quot;<br />
	${EndIf}<br />
	System::Call 'wtsapi32::WTSFreeMemory(i r0)'<br />
${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">5th December 2007, 22:30</div></div><div class="posttext">thank you very much<br />
and worked for me<br />
but how can i forced the other users log of after detecting other users are log in?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">5th December 2007, 22:59</div></div><div class="posttext">sorry i try it vut dowsent work correctly<br />
in your cod wht is $2?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th December 2007, 23:24</div></div><div class="posttext">$2 is zero for me as it should always be.<br />
<br />
WTSLogoffSession can be used to logoff sessions.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">8th December 2007, 16:22</div></div><div class="posttext">you said:<br />
WTSLogoffSession can be used to log off sessions.<br />
<br />
I used a shutdown plug in for force current user to log off<br />
but if i understand right i can use WTSLogoffSession for forcing other user to log off. am i in true way?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th December 2007, 16:25</div></div><div class="posttext">Yes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">9th December 2007, 10:37</div></div><div class="posttext">i c. so which parameter do i need to work on it?<br />
hServer<br />
ppSessionInfo<br />
pCount<br />
<br />
adn how tell this function to log off other user?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">9th December 2007, 13:33</div></div><div class="posttext">WTSEnumerateSessions  (http://msdn2.microsoft.com/en-us/library/aa383833.aspx) will give you an array of WTS_SESSION_INFO (http://msdn2.microsoft.com/en-us/library/aa383864.aspx) structures and each one contains a SessionId for a given active session. Use kichik's code for the WTSEnumerateSessions function but do not call the WTSFreeMemory function before you extract the info you need from the structures that reside in $0.<br />
Then call the WTSLogoffSession  (http://msdn2.microsoft.com/en-us/library/aa383836.aspx) with one of the extracted SessionIds in order to logoff that session ...<br />
Hope this helps ...<br />
CF</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>