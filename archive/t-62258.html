<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Crash by using more than 508 Files?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Crash by using more than 508 Files? NSIS Discussion" />
	
	<title> Crash by using more than 508 Files? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Crash by using more than 508 Files?</div>
<hr />
<div class="pda"><a href="t-62258.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=62258">Crash by using more than 508 Files?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">MarcRene</div><div class="date">11th October 2001, 18:35</div></div><div class="posttext">Hello all,<br />
<br />
just tried to compile a script which should unpack a lot of .gif Files. The first 508 Files work quite fine, but at the 509th file I get:<br />
<br />
File: &quot;ga791111.gif&quot; [compress]Internal compiler error #12345: GrowBuf realloc(1<br />
4339796) failed.<br />
<br />
Note: you may have one or two (large) stale temporary file(s)<br />
left in your temporary directory (Generally this only happens on Windows 9x).<br />
MakeNSIS done - hit enter to close...<br />
<br />
Any ideas?<br />
<br />
Thanx,<br />
Marc</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DuaneJeffers</div><div class="date">11th October 2001, 21:47</div></div><div class="posttext">Well, How many gifs and how much space do they take up?? I know that Gifs cannot be compressed that much because they are compressed. I know NSIS has a overhead of 2GB<br />
<br />
<br />
From Nullsoft.com<br />
No practical limits on number of files, size of files, etc. (2GB maximum installer size)<br />
<br />
.<br />
So, if the Size of the gifs go over this amount, then you are screwed. If not, then I don't know what to tell you.<br />
<br />
-Duane</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MarcRene</div><div class="date">12th October 2001, 05:55</div></div><div class="posttext">Originally posted by DuaneJeffers <br />
[B]Well, How many gifs and how much space do they take up?? I know that Gifs cannot be compressed that much because they are compressed. I know NSIS has a overhead of 2GB<br />
<br />
It's a collection of Garfield-Comics *grin*<br />
The amount of data is below 12 MB, so it should work easily...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">justin</div><div class="date">12th October 2001, 06:22</div></div><div class="posttext">Hmm, tell us about your system. What OS/how much memory/how much hard disk you have free.<br />
<br />
-J</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MarcRene</div><div class="date">12th October 2001, 07:02</div></div><div class="posttext">Okay, sytem description:<br />
<br />
Windows 98 1st Edition (german)<br />
Free Space on system drive: 4 GB<br />
Free Space on Drive, where nsis is compiled: 3 GB<br />
Memory: 512 MB<br />
CPU: Intel P-III 1GHz<br />
<br />
The Files are stored in d:\comics\garfield, splitted in subdirectories 1978, 1979, 1980..... 2001. The &quot;main part&quot; of my  nsis-file is <br />
<br />
  SetOutPath $INSTDIR\1978<br />
  File &quot;1978\*.gif&quot;<br />
<br />
  SetOutPath $INSTDIR\1979<br />
  File &quot;1979\*.gif&quot;<br />
<br />
  SetOutPath $INSTDIR\1980<br />
  File &quot;1980\*.gif&quot;<br />
<br />
Exactly at 1979\ga111079.gif it aborts with the mentioned error. <br />
<br />
I've tried this some month ago and yesterday with the current release version - same result :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">justin</div><div class="date">12th October 2001, 08:41</div></div><div class="posttext">Very odd. I've build very large installers with many thousands of files, without problems. Can you send me a ZIP With everything to test? Basically based on the error message you sent, there is a call to realloc() that fails, which should only really happen when you run out of memory. Perhaps I should put a check for realloc() failing, and do a seperate malloc/memcpy/free.. I guess I should do that anyway, since realloc seems to blow. email me at justin@nullsoft.com, and I'll send you an update to test.<br />
<br />
-Justin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MarcRene</div><div class="date">12th October 2001, 10:34</div></div><div class="posttext">Many thanks for sending me this update; I'll try it this evening at home... (sadly, I don't have the files here at my day job) <br />
<br />
if the problem still occurs, I'll be glad to sent you the complete files.<br />
<br />
I'm quite curious :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MarcRene</div><div class="date">12th October 2001, 18:25</div></div><div class="posttext">Okay, it's me again. The patched version produces the same error, so I tried several things. It is NOT the number of files, packing 800 Files with length 1 Byte works perfect. And moving all the data to drive c:\ didn't change anything.<br />
<br />
If one deletes several files (doesn't seem to be depending on WHICH files), the remaining ones can be packed into the nsis exe.<br />
<br />
So I put the files on a web server and send the URL to Justin :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">justin</div><div class="date">12th October 2001, 19:27</div></div><div class="posttext">I got your RARs... And I had no problems making the installer. :/<br />
But this is in Win2k, I will try it in win98. OK Windows 98 fails! yay!<br />
<br />
I determined it's some feature of the way win98's realloc/malloc() work, so I made it call realloc() less (and potentially waste more memory, but hey) and it works.<br />
<br />
I've put a new makensis.exe for you to test at http://1014.org/shiz/makensis.exe<br />
<br />
Let me know if that fixes, and I'll do 1.57 tonight with those (and possibly other, like BrandingText) changes.<br />
<br />
-Justin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MarcRene</div><div class="date">12th October 2001, 21:00</div></div><div class="posttext">Yes, it works!!! Great! Many thanx!<br />
<br />
-Marc</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LordZamiel</div><div class="date">17th October 2001, 01:07</div></div><div class="posttext">Okie, when I try to &quot;Compile NSI&quot;, it runs for a goodly long time (I'm frankly not sure how many files, nor how many MB are actually processed, but it's a lot - 500+ files and prolly as many MB) it dies out with the message:<br />
<br />
Internal compiler error #12345: error mmapping datablock to 483489655.<br />
<br />
Note: you may have one or two (large) stale temporary file(s)<br />
left in your temporary directory (Generally this only happens on Windows 9x).<br />
MakeNSIS done - hit enter to close...<br />
<br />
Ick...  So I checked the docs, but no troubleshooting section..  Checked the webpage, no help there either, read (ok, you caught me, skimmed, maybe even breezed through) the forum &amp; didn't see a reference to this particular problem..<br />
<br />
I tried NSIS v1.55 first, after I got this error, I upgraded to v1.58 - same problem...  If I rearrange the files/sections, it still explodes after the same general length of time, and the &quot;483489655&quot; changes on each recompile..  I'm at my wit's end here.  I gotta get this thing finished by the 30th (ok, I admit, all this panic is over my little brother's birthday) ;)<br />
<br />
System Info:<br />
AMD K6-2 450mhz<br />
128MB PC-100 SDRAM<br />
20GB HDD, ~12GB Free<br />
Windows 98<br />
<br />
You can stop laughing at my pathetic lil box ;-)<br />
<br />
Thanks in Advance..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">justin</div><div class="date">17th October 2001, 03:45</div></div><div class="posttext">483489655 means 483MB. Which is pretty decent sized. My guess is that Windows 98 may have issues with creating 483mb memory mapped files. The system may be low on address space (the compiler needs to map the whole datablock in at once, unfortunately). With a 500mb installer, it may make more sense to store some of the data in other files, or try using Windows 2000 (or NT4, or some other OS that supports large amounts of memory better than Win98).<br />
<br />
update: I duplicated this on my winME box. Freakin' win9x. OK well what I'm thinking I may do is make the compiler only map in parts at a time, which would enable this to work on win9x, but the downside would be when the installs got very large, datablock optimizations would be VERY slow (and should be disabled). Let me know if there's really interest in this (making 500mb+ installers on win9x).<br />
<br />
-Justin<br />
<br />
<br />
Originally posted by LordZamiel <br />
Okie, when I try to &quot;Compile NSI&quot;, it runs for a goodly long time (I'm frankly not sure how many files, nor how many MB are actually processed, but it's a lot - 500+ files and prolly as many MB) it dies out with the message:<br />
<br />
Internal compiler error #12345: error mmapping datablock to 483489655.<br />
<br />
Note: you may have one or two (large) stale temporary file(s)<br />
left in your temporary directory (Generally this only happens on Windows 9x).<br />
MakeNSIS done - hit enter to close...<br />
<br />
Ick...  So I checked the docs, but no troubleshooting section..  Checked the webpage, no help there either, read (ok, you caught me, skimmed, maybe even breezed through) the forum &amp; didn't see a reference to this particular problem..<br />
<br />
I tried NSIS v1.55 first, after I got this error, I upgraded to v1.58 - same problem...  If I rearrange the files/sections, it still explodes after the same general length of time, and the &quot;483489655&quot; changes on each recompile..  I'm at my wit's end here.  I gotta get this thing finished by the 30th (ok, I admit, all this panic is over my little brother's birthday) ;)<br />
<br />
System Info:<br />
AMD K6-2 450mhz<br />
128MB PC-100 SDRAM<br />
20GB HDD, ~12GB Free<br />
Windows 98<br />
<br />
You can stop laughing at my pathetic lil box ;-)<br />
<br />
Thanks in Advance..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LordZamiel</div><div class="date">17th October 2001, 04:01</div></div><div class="posttext">Thanks for the info - I'll try breaking the (large) sections up into seperate installers &amp; see if I can come up with something that works :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">locnar42</div><div class="date">25th October 2001, 04:31</div></div><div class="posttext">Originally posted by justin <br />
<br />
update: I duplicated this on my winME box. Freakin' win9x. OK well what I'm thinking I may do is make the compiler only map in parts at a time, which would enable this to work on win9x, but the downside would be when the installs got very large, datablock optimizations would be VERY slow (and should be disabled). Let me know if there's really interest in this (making 500mb+ installers on win9x).<br />
<br />
-Justin<br />
<br />
 <br />
<br />
I would hate to see something that affects the performance on NT/2000 so if you do make this change, can you do it in a way which only negatively affects 9x boxes?  I haven't used a 9x box for development work (other than testing) in years and would hate to lose optimizations when working on larger packages where they could really prove helpful.<br />
<br />
just my opinion though.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">justin</div><div class="date">25th October 2001, 10:35</div></div><div class="posttext">Originally posted by locnar42 <br />
<br />
<br />
I would hate to see something that affects the performance on NT/2000 so if you do make this change, can you do it in a way which only negatively affects 9x boxes?  I haven't used a 9x box for development work (other than testing) in years and would hate to lose optimizations when working on larger packages where they could really prove helpful.<br />
<br />
just my opinion though. <br />
<br />
I agree. Screw win9x =)<br />
<br />
-Justin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Koen van de Sande</div><div class="date">25th October 2001, 21:13</div></div><div class="posttext">Not completely :rolleyes: because I need it on my PC to play Worms which won't run on W2k :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LordZamiel</div><div class="date">30th October 2001, 10:28</div></div><div class="posttext">Okie, I've been meaning to post this for a while now, but haven't been around a 'puter when the notion struck..  I finally did get that 600+MB installer working:<br />
<br />
<br />
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-<br />
Output: &quot;TAX_Setup.exe&quot;<br />
Install: 6 sections (2 required, 1 divider).<br />
Install: 1003 instructions (24072 bytes), 20095 byte string table.<br />
<br />
EXE header size:             36864 / 36864 bytes<br />
Install code+strings:        44523 / 44523 bytes<br />
Install data:            607771040 / 607771040 bytes<br />
CRC (0xE348E135):                4 / 4 bytes<br />
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-<br />
Total size:              607852431 / 607852431 bytes (100.0%)<br />
<br />
MakeNSIS done - hit enter to close...<br />
<br />
<br />
I used &quot;SetCompress off&quot; and &quot;SetDatablockOptimize off&quot; and it worked fine (and MUCH quicker than before) and only increased the file size slightly (most of the files were already in a compressed format).<br />
<br />
I hope this can prove useful to anyone else out there trying to make insanely large NSIS installers under 9x/ME ;-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mark_Ive</div><div class="date">5th June 2002, 16:36</div></div><div class="posttext">Hi all i am getting this error message on windows 2000 and really need a fix for this problem asap<br />
<br />
Internal compiler error #12345: error mmapping datablock to 35776217.<br />
<br />
Note: you may have one or two (large) stale temporary file(s)<br />
left in your temporary directory (Generally this only happens on Windows 9x).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bryan986</div><div class="date">4th August 2003, 00:51</div></div><div class="posttext">Originally posted by Mark_Ive <br />
Hi all i am getting this error message on windows 2000 and really need a fix for this problem asap<br />
<br />
Internal compiler error #12345: error mmapping datablock to 35776217.<br />
<br />
Note: you may have one or two (large) stale temporary file(s)<br />
left in your temporary directory (Generally this only happens on Windows 9x).  <br />
<br />
Same error here (different datablock of course)<br />
<br />
windows xp<br />
<br />
207 files, 27 folders, 897mb</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th August 2003, 11:09</div></div><div class="posttext">See http://forums.winamp.com/showthread.php?s=&amp;threadid=123323</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>