<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Loops and Sections., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Loops and Sections. NSIS Discussion" />
	
	<title> Loops and Sections. [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Loops and Sections.</div>
<hr />
<div class="pda"><a href="t-248636.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=248636">Loops and Sections.</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Database</div><div class="date">13th June 2006, 19:03</div></div><div class="posttext">I'm trying to make a code that checks the registry for information, such as the name and the location of files. How can I make the installer create a section for each key it finds, with the name ripped from the registry?<br />
<br />
My code currectly: <br />
 Function .onInit<br />
StrCpy $number 1<br />
start:<br />
ReadRegStr $0 HKLM &quot;Software\MATY Auto Installer\Sec$number&quot; &quot;Name&quot;<br />
Pop $0<br />
StrCmp $0 &quot;success&quot; ok<br />
  Goto end<br />
ok:<br />
StrCpy $number $number+1<br />
Goto start<br />
end:<br />
 FunctionEnd<br />
 <br />
How can I do this?<br />
<br />
Thanks,<br />
<br />
Database</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th June 2006, 19:08</div></div><div class="posttext">You cannot create Sections dynamically.<br />
You could instead, however, display a list with the EmbeddedLists plugin (on Wiki).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Database</div><div class="date">13th June 2006, 19:12</div></div><div class="posttext">Thanks, but this probably won't help. What I am trying to do as a whole, is set up an installer to detect new files on a server, and offer them for download.<br />
<br />
Any ideas?<br />
Thanks,<br />
<br />
Database</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th June 2006, 13:44</div></div><div class="posttext">You could create a pool of invisible sections that you'd use show for each registry key. The number of sections will be limited but you'll be able to dynamically &quot;create&quot; sections.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th June 2006, 17:33</div></div><div class="posttext">I've done this many a time. I wrote a number of programs in NSIS with dialogs for selecting files for download. The list of files was stored as plain text on a server and downloaded when the program was ran.<br />
I always just used an InstallOptions list box control, but for future projects I can use EmbeddedLists either with a checked list box, or a tree view control with check boxes (almost identical to the one on the NSIS Components page).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Database</div><div class="date">17th June 2006, 10:43</div></div><div class="posttext">Wow, very useful. The problem is that I need the file with the file locations to be seperate from the installer, so it can be easily updated every time the installer is run.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Database</div><div class="date">17th June 2006, 10:49</div></div><div class="posttext">Another thing: Can you elaborate on how you did the list of files, and how you got the installer to read them?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">17th June 2006, 11:44</div></div><div class="posttext">List of files:<br />
http://hmd.hostileintent.org/swupdata/scripts/swupdata.txt<br />
<br />
To read from the file, used FileOpen, FileRead and FileClose.<br />
Files are downloaded with the InetLoad plugin.<br />
<br />
Edit: this is called SwUpdata, which is at http://swupdata.sf.net<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Database</div><div class="date">17th June 2006, 12:17</div></div><div class="posttext">Wow, very cool. I'm using an INI file again now... I'll probably do the same thing as you've done :)<br />
<br />
-Data</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Database</div><div class="date">17th June 2006, 12:31</div></div><div class="posttext">OK, I'm trying to create a loop for this, so it loops through and propogates the sections with the names, descriptinos, and locations of the files.<br />
<br />
This is the code so far for the whole program:<br />
<br />
Var number<br />
Var number2<br />
<br />
Name &quot;${PRODUCT_NAME} ${PRODUCT_VERSION}&quot;<br />
OutFile &quot;Setup.exe&quot;<br />
InstallDir &quot;$PROGRAMFILES\MATY Auto Updater&quot;<br />
InstallDirRegKey HKLM &quot;${PRODUCT_DIR_REGKEY}&quot; &quot;&quot;<br />
ShowInstDetails show<br />
<br />
 Function .onInit<br />
ReadINIStr $0 $EXEDIR\settings.ini Sec$number Name<br />
SectionSetText SEC$number2 $0<br />
 FunctionEnd<br />
<br />
Section &quot;&quot; SEC01<br />
ReadINIStr $1 $EXEDIR\settings.ini Sec00 Location<br />
NSISdl::download $1 $exedir\temp\$0.zip<br />
CreateDirectory $INSTDIR\abortbedmaking<br />
SectionEnd<br />
<br />
Section &quot;&quot; SEC02<br />
ReadINIStr $1 $EXEDIR\settings.ini Sec01 Location<br />
NSISdl::download $1 $exedir\temp\$0.zip<br />
CreateDirectory $INSTDIR\abortbedmaking<br />
SectionEnd<br />
<br />
Section &quot;&quot; SEC03<br />
ReadINIStr $1 $EXEDIR\settings.ini Sec02 Location<br />
NSISdl::download $1 $exedir\temp\$0.zip<br />
CreateDirectory $INSTDIR\abortbedmaking<br />
SectionEnd<br />
<br />
Section -Extract<br />
IfFileExists $exedir\temp\abortbedmaking.zip a b<br />
a:<br />
nsisunz::UnzipToLog &quot;$exedir\temp\abortbedmaking.zip&quot; &quot;$instdir\abortbedmaking&quot;<br />
Pop $0<br />
StrCmp $0 &quot;success&quot; b<br />
DetailPrint &quot;$0&quot; ;print error message to log<br />
b:<br />
<br />
SectionEnd<br />
<br />
Section -Post<br />
  Sleep 5000<br />
  WriteRegStr HKLM &quot;${PRODUCT_DIR_REGKEY}&quot; &quot;&quot; &quot;$INSTDIR\AppMainExe.exe&quot;<br />
  Delete $exedir\temp\*.*<br />
SectionEnd<br />
<br />
; Section descriptions<br />
!insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br />
ReadINIStr $2 $EXEDIR\settings.ini Sec00 Description<br />
  !insertmacro MUI_DESCRIPTION_TEXT ${SEC01} $2<br />
!insertmacro MUI_FUNCTION_DESCRIPTION_END<br />
<br />
-Data</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>