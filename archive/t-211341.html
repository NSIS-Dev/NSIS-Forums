<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" WinVer and variables troubles (+), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  WinVer and variables troubles (+) NSIS Discussion" />
	
	<title> WinVer and variables troubles (+) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  WinVer and variables troubles (+)</div>
<hr />
<div class="pda"><a href="t-211341.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=211341">WinVer and variables troubles (+)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Faith Healer</div><div class="date">25th March 2005, 13:15</div></div><div class="posttext">Good day everybody :)<br />
<br />
I'm using NSIS not for long time (less than 4 months), often read this NSIS-related forum, read docs + using search (maybe miss something), etc.<br />
<br />
I use NSIS for my MirandaIM pack installer, which globaly (for full installation) detects Windows version and depending on it installs needed/proper files.<br />
I decided to advance/modify/optimize code, but got some troubles which I can't resolve, feeling dumb :(<br />
<br />
So, I have files:<br />
tabsrmm.dll<br />
tabsrmm_unicode.dll<br />
tabsrmm_icons_faith_brq_2k.dll<br />
tabsrmm_icons_faith_brq_xp.dll<br />
<br />
so, I need to copy files:<br />
* if WinVer is unknown then copy<br />
tabsrmm.dll + tabsrmm_icons_faith_brq_2k.dll (but without &quot;_2k&quot; in the name)<br />
* if WinVer is Win2k then copy<br />
tabsrmm_unicode.dll + tabsrmm_icons_faith_brq_2k.dll (without &quot;_2k&quot; in the name)<br />
if WinVer is WinXP/2k3 then copy<br />
tabsrmm_unicode.dll + tabsrmm_icons_faith_brq_xp.dll (without &quot;_xp&quot; in the name)<br />
<br />
my code is<br />
Function .onInit<br />
   ReadRegStr $WinVer HKLM &quot;SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion&quot; CurrentVersion<br />
	StrCmp $WinVer &quot;5.0&quot; win2k<br />
	StrCmp $WinVer &quot;5.1&quot; winxp<br />
	StrCmp $WinVer &quot;5.2&quot; winxp<br />
<br />
	 StrCpy $icons &quot;2k&quot;<br />
	 StrCpy $unicode &quot;&quot;<br />
		 Goto endwinver<br />
<br />
		win2k:<br />
	StrCpy $icons &quot;2k&quot;<br />
	StrCpy $unicode &quot;_unicode&quot;<br />
		 Goto endwinver<br />
<br />
		winxp:<br />
	StrCpy $icons &quot;xp&quot;<br />
	StrCpy $unicode &quot;_unicode&quot;<br />
		endwinver:<br />
FunctionEnd<br />
Section &quot;tabSRMM v0.9.9.9&quot; SecTabSRMM<br />
	SectionIn 1 2 3<br />
	SetOverwrite on<br />
	SetOutPath &quot;$INSTDIR\\Plugins&quot;<br />
	File &quot;..\\Plugins\\tabsrmm${unicode}.dll&quot;<br />
	File /oname=tabsrmm_icons.dll &quot;..\\Icons\\tabsrmm_icons\\tabsrmm_icons_faith_brq_${icons}.dll&quot;<br />
SectionEnd<br />
<br />
And it doesn't works - when I'm compilate this it complains:<br />
File: &quot;..\Icons\tabsrmm_icons\tabsrmm_icons_faith_brq_${icons}.dll&quot; -&gt; no files found.<br />
in fact that files<br />
tabsrmm_icons_faith_brq_2k.dll<br />
tabsrmm_icons_faith_brq_xp.dll<br />
exist<br />
<br />
Thank you for any help :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th March 2005, 14:18</div></div><div class="posttext">You're getting confused with run-time and compile-time commands.<br />
<br />
You need to do the checks inside your section, and jump over File calls for certain conditions.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Faith Healer</div><div class="date">25th March 2005, 15:25</div></div><div class="posttext">Hmmm... Looks like I don't understand :(<br />
So, how to make it work globally, not only in one section...<br />
It would be excellent to get short example (or hint) of it :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">std</div><div class="date">27th March 2005, 20:39</div></div><div class="posttext">but, Afrow UK, is it really no way to use runtime string substitution for this case?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">27th March 2005, 20:43</div></div><div class="posttext">No, there is no way. The compiler can't guess every possible value the runtime variable might have and compress all of the matching files.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Faith Healer</div><div class="date">28th March 2005, 05:32</div></div><div class="posttext">kichik, but I've defined exactly:<br />
<br />
     StrCpy $icons &quot;2k&quot; <br />
     StrCpy $unicode &quot;&quot; <br />
         Goto endwinver <br />
<br />
        win2k: <br />
    StrCpy $icons &quot;2k&quot; <br />
    StrCpy $unicode &quot;_unicode&quot; <br />
         Goto endwinver <br />
<br />
        winxp: <br />
    StrCpy $icons &quot;xp&quot; <br />
    StrCpy $unicode &quot;_unicode&quot;<br />
<br />
:)))<br />
so, $icons can have 2 values = &quot;2k&quot; or &quot;xp&quot;, $unicode can have only 2 values too - &quot;&quot; (empty) and &quot;_unicode&quot;.<br />
<br />
I totaly dislike old my code:<br />
1st var:<br />
Section &quot;tabSRMM 0.9.9.91&quot; tabsrmm<br />
    SectionIn 1 2 3<br />
    SetOutPath &quot;$INSTDIR\\Plugins&quot;<br />
    SetOverwrite on<br />
    File &quot;..\\Plugins\\smileyadd.dll&quot;<br />
     ReadRegStr $R0 HKLM &quot;SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion&quot; CurrentVersion<br />
        StrCmp $R0 '5.0' unicode<br />
        StrCmp $R0 '5.1' unicode<br />
        StrCmp $R0 '5.2' unicode<br />
<br />
				File &quot;..\Plugins\tabsrmm.dll&quot;<br />
					Goto tabicons<br />
<br />
					unicode:<br />
				File &quot;..\Plugins\tabsrmm_unicode.dll&quot;<br />
					Goto tabicons<br />
<br />
			tabicons:<br />
     ReadRegStr $R0 HKLM &quot;SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion&quot; CurrentVersion<br />
        StrCmp $R0 '5.1' xpicons<br />
        StrCmp $R0 '5.2' xpicons<br />
<br />
				File /oname=tabsrmm_icons.dll &quot;..\Icons\tabsrmm_icons\tabsrmm_icons_faith_brq_2k.dll&quot;<br />
					Goto endtabsrmm<br />
<br />
					xpicons:<br />
				File /oname=tabsrmm_icons.dll &quot;..\Icons\tabsrmm_icons\tabsrmm_icons_faith_brq_xp.dll&quot;<br />
					Goto endtabsrmm<br />
						endtabsrmm:<br />
SectionEnd<br />
<br />
2nd var:<br />
Section &quot;tabSRMM 0.9.9.91&quot; tabsrmm<br />
    SectionIn 1 2 3<br />
    SetOutPath &quot;$INSTDIR\\Plugins&quot;<br />
    SetOverwrite on<br />
    File &quot;..\\Plugins\\smileyadd.dll&quot;<br />
     ReadRegStr $R0 HKLM &quot;SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion&quot; CurrentVersion<br />
        StrCmp $R0 '5.0' win2k<br />
        StrCmp $R0 '5.1' winxp<br />
        StrCmp $R0 '5.2' winxp<br />
<br />
				File &quot;..\Plugins\tabsrmm.dll&quot;<br />
				File /oname=tabsrmm_icons.dll &quot;..\Icons\tabsrmm_icons\tabsrmm_icons_faith_brq_2k.dll&quot;<br />
					Goto endtabsrmm<br />
<br />
					win2k:<br />
				File &quot;..\Plugins\tabsrmm_unicode.dll&quot;<br />
				File /oname=tabsrmm_icons.dll &quot;..\Icons\tabsrmm_icons\tabsrmm_icons_faith_brq_2k.dll&quot;<br />
					Goto endtabsrmm<br />
<br />
					winxp:<br />
				File &quot;..\Plugins\tabsrmm_unicode.dll&quot;<br />
				File /oname=tabsrmm_icons.dll &quot;..\Icons\tabsrmm_icons\tabsrmm_icons_faith_brq_xp.dll&quot;<br />
						endtabsrmm:<br />
SectionEnd<br />
<br />
So, maybe fix/add it in NSIS to work with it? :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th March 2005, 07:25</div></div><div class="posttext">No such feature will be added to NSIS. As I've said in the previous reply, the compiler can't guess which values the runtime variable will contain. For all it knows, the runtime variable can depend on the user's host name.<br />
<br />
Best you can do is create a macro and insert it three times with different parameters.!macro install srmm_postfix icons_postfix<br />
File &quot;..Plugins\tabsrmm_${srmm_postfix}.dll&quot;<br />
File /oname=tabsrmm_icons.dll &quot;tabsrmm_icons_${icons_postfix}.dll&quot;<br />
!macroend<br />
!insertmacro install &quot;&quot; &quot;&quot;<br />
!insertmacro install &quot;unicode&quot; &quot;2k&quot;<br />
!insertmacro install &quot;unicode&quot; &quot;xp&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Faith Healer</div><div class="date">28th March 2005, 07:37</div></div><div class="posttext">sad then :(<br />
<br />
thank you very much for the macro, I'll try it :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>