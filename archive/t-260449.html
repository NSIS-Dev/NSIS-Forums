<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Downloading and executing vcredist_x86.exe if necessary, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Downloading and executing vcredist_x86.exe if necessary NSIS Discussion" />
	
	<title> Downloading and executing vcredist_x86.exe if necessary [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Downloading and executing vcredist_x86.exe if necessary</div>
<hr />
<div class="pda"><a href="t-260449.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=260449">Downloading and executing vcredist_x86.exe if necessary</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Olaf van der Spek</div><div class="date">26th November 2006, 18:52</div></div><div class="posttext">Hi,<br />
<br />
I've got a VC8/2005 app that requires certain DLLs. Those can be installed with vcredist_x86.exe, but that exe is 2.5 mbyte.<br />
Is there a way to check whether the DLLs are already installed and only download/install them if they're not?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">26th November 2006, 19:55</div></div><div class="posttext">ifFileExists can help you..also check nsisdl</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">26th November 2006, 20:22</div></div><div class="posttext">Olaf van der Spek - you may also need to download and install Windows Installer 3.1. I recently ran into a need to install the vcredist_x86 you mention, and it pops up an error (&quot;1723&quot;) if the system doesn't have WI 3.1. And you'll need to set the switches to block the reboots that both of them want to do.<br />
<br />
If you do search for the file(s), be aware that they install do different locations on different versions of the operating system. (That's why they were released as an executable instead of a simpler merge module.)<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Olaf van der Spek</div><div class="date">26th November 2006, 21:50</div></div><div class="posttext">I don't like to hard-code paths. Maybe just trying to load the DLLs and checking whether that succeeds is better.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ranahimal</div><div class="date">30th November 2006, 12:38</div></div><div class="posttext">I have same problem regarding vcredist_x86.exe.<br />
I want to check and install it if necessary...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Adion</div><div class="date">30th November 2006, 15:22</div></div><div class="posttext">I am also looking for a solution for this.<br />
At first I tried to see if it would be possible to install the relevant files myself, but it seems very difficult to get them to register correctly.<br />
So the vcredist_x86.exe also seems the only solution, but I can find 4 instances of msvcr80.dll on my computer, so I also don't know how to check for it being installed correctly.<br />
<br />
I would asume though that one version of vcredist_x86.exe only installs one version of msvcr80.dll, so chances are that the location for that specific version will always be the same and can be checked for.<br />
Anyone has an idea how to find out which version will be in there though?<br />
<br />
I also didn't know about Windows Installer. Which version is installed on a standard windows xp installation?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">30th November 2006, 16:03</div></div><div class="posttext">I check the registry value HKLM Microsoft\Windows\CurrentVersion\Uninstall\{A49F249F-0C91-497F-86DF-B2585E8E76B7}\DisplayName to see if the redistributable package has been installed. If that value exists then I don't install either exe.<br />
<br />
The switches for installing Windows Installer 3.1 would be &quot;WindowsInstaller-KB893803-v2-x86.exe /quiet /norestart&quot; and the switches for the redistributable &quot;VCRedist_x86.exe /Q&quot;<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Olaf van der Spek</div><div class="date">30th November 2006, 18:31</div></div><div class="posttext">Originally posted by demiller9 <br />
I check the registry value HKLM Microsoft\Windows\CurrentVersion\Uninstall\{A49F249F-0C91-497F-86DF-B2585E8E76B7}\DisplayName to see if the redistributable package has been installed. If that value exists then I don't install either exe.<br />
 <br />
Does that work on XP x64? IA64? Vista?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">30th November 2006, 18:51</div></div><div class="posttext">Originally posted by Olaf van der Spek <br />
Does that work on XP x64? IA64? Vista?  <br />
I don't have any of those OS so I can't answer your question.<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">30th November 2006, 18:54</div></div><div class="posttext">I though that you were developers ;)<br />
<br />
Don't you guys need MSVCP80.DLL and MSVCR80.DLL?<br />
<br />
Find them, if isnot present....download the redist installer...<br />
<br />
There are tons of examples of about this tasks...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Adion</div><div class="date">30th November 2006, 18:59</div></div><div class="posttext">The problem is of course that you need to be sure of their location.<br />
Just searching the complete system dir may be slow, and if the version is not correct I think it may even refuse to use that version, so I'm not sure if it is actually that simple :)<br />
<br />
I would suppose that the registry check would work on other versions of windows as well, since it's always the x86 version you are installing. I'll try if I can check that tomorrow on Vista 64-bit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">30th November 2006, 19:20</div></div><div class="posttext">Originally posted by Adion <br />
The problem is of course that you need to be sure of their location.<br />
Just searching the complete system dir may be slow, and if the version is not correct I think it may even refuse to use that version, so I'm not sure if it is actually that simple :)<br />
 <br />
Not necesary, because you'll search for a specific file...<br />
<br />
See codeproject article (http://www.codeproject.com/cpp/vcredists_x86.asp).<br />
<br />
It's so simple... I don't know wny the mambo-jumbo thingy :p</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Adion</div><div class="date">11th December 2006, 14:32</div></div><div class="posttext">The codeproject article also suggests to try and load a dll to see if the runtimes are already installed.<br />
In the NSIS documentation I did find out how to call a function from a dll, but I have found nothing about error handling.<br />
Does anyone know how to check if calling a function failed?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">11th December 2006, 17:44</div></div><div class="posttext">Perhaps this code example would be helpful to detect if the runtimes are installed and check the required version.<br />
OutFile &quot;locate_msvcp80.exe&quot;<br />
ShowInstDetails show<br />
<br />
!include &quot;FileFunc.nsh&quot;<br />
!include &quot;WordFunc.nsh&quot;<br />
<br />
!insertmacro Locate<br />
!insertmacro VersionCompare<br />
<br />
!define DLL_VER &quot;8.00.50727.42&quot;<br />
<br />
Section<br />
<br />
	StrCpy $1 $WINDIR 3<br />
	${Locate} &quot;$1&quot; &quot;/L=F /M=MSVCP80.DLL /S=0B&quot; &quot;LocateCallback&quot;<br />
<br />
	IfErrors 0 +2<br />
	MessageBox MB_OK &quot;Error&quot; <br />
	MessageBox MB_OK '$$R0==$R0'<br />
<br />
SectionEnd<br />
<br />
Function LocateCallback<br />
<br />
	MoreInfo::GetProductVersion &quot;$R9&quot;<br />
	Pop $0<br />
<br />
        ${VersionCompare} &quot;$0&quot; &quot;${DLL_VER}&quot; $R1<br />
<br />
        StrCmp $R1 0 0 new<br />
        messagebox mb_ok 'Found file at location $R9.$\r$\n \<br />
        Installed version is $0 required version is ${DLL_VER}. Versions are equal.' idok end<br />
<br />
      new:<br />
        StrCmp $R1 1 0 old<br />
        messagebox mb_ok 'Found file at location $R9.$\r$\n \<br />
         Installed version is $0 required version is ${DLL_VER}. Installed version is newer.' idok end<br />
<br />
      old:<br />
        StrCmp $R1 2 0 end<br />
        messagebox mb_ok 'Found file at location $R9.$\r$\n \<br />
         Installed version is $0 required version is ${DLL_VER}. Installed version is older.' idok end<br />
<br />
     end:<br />
	StrCpy &quot;$0&quot; StopLocate<br />
	Push &quot;$0&quot;<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Adion</div><div class="date">11th December 2006, 18:12</div></div><div class="posttext">Thanks, I just found the IfErrors function though, so I'm going to test if that works as expected first.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Adion</div><div class="date">14th December 2006, 21:27</div></div><div class="posttext">IfErrors does not seem to catch errors when executing System::Call.<br />
After checking the output, it seems you can check for an output by comparing the return value of the dll call.<br />
Maybe this behaviour should be added to the documentation of the System::Call function?<br />
This seemed to be working for me:<br />
  ;Install runtime<br />
  System::Call 'mydll::aTestFunction() i .r0'<br />
  StrCmp $0 &quot;error&quot; 0 +3<br />
  File &quot;vcredist_x86.exe&quot;<br />
  Exec '&quot;$INSTDIR\vcredist_x86.exe&quot; /q'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">azerger</div><div class="date">8th January 2007, 19:53</div></div><div class="posttext">Look at this example:<br />
http://msdn2.microsoft.com/en-us/library/ms235291(VS.80).aspx<br />
<br />
I'm trying the &quot;Deploying Visual C++ library DLLs as private assemblies&quot;  example.  So far with no luck though!<br />
<br />
I have a win32 app and I just need these dll's, this is the correct way according to MS.  Going the path of running the installer etc. is thwart with problems for the end user installations.  If you can get this way to work, let me know.<br />
<br />
Thanks,<br />
Art</div></div><hr />


<div class="post"><div class="posttop"><div class="username">arif.ali.syed</div><div class="date">4th March 2010, 15:14</div></div><div class="posttext">Originally posted by Red Wine <br />
Perhaps this code example would be helpful to detect if the runtimes are installed and check the required version.<br />
OutFile &quot;locate_msvcp80.exe&quot;<br />
ShowInstDetails show<br />
<br />
!include &quot;FileFunc.nsh&quot;<br />
!include &quot;WordFunc.nsh&quot;<br />
<br />
!insertmacro Locate<br />
!insertmacro VersionCompare<br />
<br />
!define DLL_VER &quot;8.00.50727.42&quot;<br />
<br />
Section<br />
<br />
	StrCpy $1 $WINDIR 3<br />
	${Locate} &quot;$1&quot; &quot;/L=F /M=MSVCP80.DLL /S=0B&quot; &quot;LocateCallback&quot;<br />
<br />
	IfErrors 0 +2<br />
	MessageBox MB_OK &quot;Error&quot; <br />
	MessageBox MB_OK '$$R0==$R0'<br />
<br />
SectionEnd<br />
<br />
Function LocateCallback<br />
<br />
	MoreInfo::GetProductVersion &quot;$R9&quot;<br />
	Pop $0<br />
<br />
        ${VersionCompare} &quot;$0&quot; &quot;${DLL_VER}&quot; $R1<br />
<br />
        StrCmp $R1 0 0 new<br />
        messagebox mb_ok 'Found file at location $R9.$\r$\n \<br />
        Installed version is $0 required version is ${DLL_VER}. Versions are equal.' idok end<br />
<br />
      new:<br />
        StrCmp $R1 1 0 old<br />
        messagebox mb_ok 'Found file at location $R9.$\r$\n \<br />
         Installed version is $0 required version is ${DLL_VER}. Installed version is newer.' idok end<br />
<br />
      old:<br />
        StrCmp $R1 2 0 end<br />
        messagebox mb_ok 'Found file at location $R9.$\r$\n \<br />
         Installed version is $0 required version is ${DLL_VER}. Installed version is older.' idok end<br />
<br />
     end:<br />
	StrCpy &quot;$0&quot; StopLocate<br />
	Push &quot;$0&quot;<br />
<br />
FunctionEnd  <br />
<br />
While Compiling this code with latest version of MakeNSISW 2.3<br />
<br />
I got following compilation error <br />
<br />
!insertmacro: macro &quot;LocateCall&quot; requires 3 parameter(s), passed 5!<br />
<br />
<br />
Apart from that I have another query ....<br />
<br />
Say Microsoft has release 3 version of CRT for CRT8.<br />
I know that if an application need v1 of CRT and if v2 or v3 is there that would work ....<br />
<br />
but what if there is no version of CRT8 at all and <br />
there is CRT9 ..will my app work with that ? <br />
<br />
Was i clear? Say i have developed an app with VS 2008 Sp1...<br />
<br />
now suppose in future if somebody tries my app... he/she doens;t have VC++ 2008 SP1 runtime but have VC++ 2010 or VC++ 2012  runtime .... will that support my app theoritically.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">arif.ali.syed</div><div class="date">5th March 2010, 19:11</div></div><div class="posttext">Can anybody help me compile this code</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kalverson</div><div class="date">14th November 2012, 12:42</div></div><div class="posttext">You could roll your own.  Here is a helpful link I used.<br />
http://blogs.msdn.com/b/astebner/archive/2009/01/29/9384143.aspx</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>