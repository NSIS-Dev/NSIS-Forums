<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Install supported from Local Drive Only, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Install supported from Local Drive Only NSIS Discussion" />
	
	<title> Install supported from Local Drive Only [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Install supported from Local Drive Only</div>
<hr />
<div class="pda"><a href="t-320781.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=320781">Install supported from Local Drive Only</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Squirre1</div><div class="date">13th July 2010, 21:56</div></div><div class="posttext">Does anyone have any recommendations as to how I can run checks in a NSIS package to see if the install is run from a local drive. I have an installer that has some issues if it is run from across the network since there is a NIC wrapper that is installed..<br />
<br />
Thanks...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th July 2010, 22:59</div></div><div class="posttext">Use GetDrives (http://nsis.sourceforge.net/GetDrives) and validate $INSTDIR against it.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Squirre1</div><div class="date">4th November 2010, 18:40</div></div><div class="posttext">For anyone ever looking for how to do this, this is the following piece I used... The benefit of the below code is that I use NSIS as a wrapper for installers and on some the reset the network interface. If the installation is ran from a network source, it breaks the connection back to the source EXE causing a lockup. This forces the user to run the installation from a local source...<br />
<br />
Thanks and sorry for the late response Afrow, finally got around to working on this...<br />
<br />
!verbose 2<br />
<br />
Name &quot;Non Net Drive Example&quot;<br />
OutFile &quot;NonNet.exe&quot;<br />
ShowInstDetails show<br />
RequestExecutionLevel user<br />
<br />
!include &quot;FileFunc.nsh&quot;<br />
!include &quot;LogicLib.nsh&quot;<br />
<br />
Var STR_HAYSTACK<br />
Var STR_NEEDLE<br />
Var STR_CONTAINS_VAR_1<br />
Var STR_CONTAINS_VAR_2<br />
Var STR_CONTAINS_VAR_3<br />
Var STR_CONTAINS_VAR_4<br />
Var STR_RETURN_VAR<br />
<br />
Function StrContains<br />
  Exch $STR_NEEDLE<br />
  Exch 1<br />
  Exch $STR_HAYSTACK<br />
  ; Uncomment to debug<br />
  ;MessageBox MB_OK 'STR_NEEDLE = $STR_NEEDLE STR_HAYSTACK = $STR_HAYSTACK '<br />
    StrCpy $STR_RETURN_VAR &quot;&quot;<br />
    StrCpy $STR_CONTAINS_VAR_1 -1<br />
    StrLen $STR_CONTAINS_VAR_2 $STR_NEEDLE<br />
    StrLen $STR_CONTAINS_VAR_4 $STR_HAYSTACK<br />
    loop:<br />
      IntOp $STR_CONTAINS_VAR_1 $STR_CONTAINS_VAR_1 + 1<br />
      StrCpy $STR_CONTAINS_VAR_3 $STR_HAYSTACK $STR_CONTAINS_VAR_2 $STR_CONTAINS_VAR_1<br />
      StrCmp $STR_CONTAINS_VAR_3 $STR_NEEDLE found<br />
      StrCmp $STR_CONTAINS_VAR_1 $STR_CONTAINS_VAR_4 done<br />
      Goto loop<br />
    found:<br />
      StrCpy $STR_RETURN_VAR $STR_NEEDLE<br />
      Goto done<br />
    done:<br />
   Pop $STR_NEEDLE ;Prevent &quot;invalid opcode&quot; errors and keep the<br />
   Exch $STR_RETURN_VAR<br />
FunctionEnd<br />
<br />
!macro _StrContainsConstructor OUT NEEDLE HAYSTACK<br />
  Push &quot;${HAYSTACK}&quot;<br />
  Push &quot;${NEEDLE}&quot;<br />
  Call StrContains<br />
  Pop &quot;${OUT}&quot;<br />
!macroend<br />
<br />
!define StrContains '!insertmacro &quot;_StrContainsConstructor&quot;'<br />
<br />
Section<br />
  ${GetDrives} &quot;ALL&quot; &quot;Example3&quot;<br />
#	MessageBox MB_OK &quot;$EXEPATH&quot;<br />
#	MessageBox MB_OK &quot;Type of drive $R1 is $R0&quot;<br />
  ${If} $R0 != &quot;HDD&quot;<br />
    ${AndIf} $R0 != &quot;CDROM&quot;<br />
    ${AndIf} $R0 != &quot;RAM&quot;<br />
    ${AndIf} $R0 != &quot;FDD&quot;<br />
    MessageBox MB_OK &quot;This installation is being ran from an unsupported install source&quot;<br />
  ${EndIf}<br />
SectionEnd<br />
<br />
Function Example3<br />
  ${StrContains} $R1 $9 $EXEPATH<br />
#  MessageBox MB_OK &quot;$9: $8&quot;<br />
  ${If} $R1 == $9<br />
    StrCpy $R0 $8 # Drive Type<br />
    StrCpy $0 StopGetDrives<br />
  ${EndIf}<br />
  Push $0<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>