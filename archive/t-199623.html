<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Progress message dialog box 'unpacking data' doesnt show before setup loads, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Progress message dialog box 'unpacking data' doesnt show before setup loads NSIS Discussion" />
	
	<title> Progress message dialog box 'unpacking data' doesnt show before setup loads [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Progress message dialog box 'unpacking data' doesnt show before setup loads</div>
<hr />
<div class="pda"><a href="t-199623.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=199623">Progress message dialog box 'unpacking data' doesnt show before setup loads</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">evilvoice</div><div class="date">19th November 2004, 02:51</div></div><div class="posttext">Hi there,<br />
<br />
I have made an installer which is 50 MB compressed and upon execution it show the message box &quot;please wait while setup is loading... Initilizing setup 15 % &quot; <br />
<br />
but the main thing is it doesnt show the other progress message box &quot;please wait while setup is loading... unpacking data 20 % &quot;<br />
<br />
My installer takes around 20 secs to unpack and doesnt show this mesaage while unpacking. I know it shows this msg as it showed it in my previous versions but not the latest. <br />
<br />
20 secs without anything on the screen by the installer makes people think their system has hanged as mouse moves slowly too due to high CPU usage while unpacking.<br />
<br />
For some reason I cant get the Splash screen to work too.<br />
<br />
heres my .oninit code :<br />
<br />
<br />
<br />
&quot;Function .onInit<br />
	Call CheckSP2<br />
	<br />
	SetOutPath $TEMP<br />
	File /oname=splash.bmp &quot;files\data\splash.bmp&quot;<br />
  <br />
	advsplash::show 5000 600 400 -1 &quot;$TEMP\splash.bmp&quot;<br />
	Pop $0          ; $0 has '1' if the user closed the splash screen early, '0' if everything closed normal, and '-1' if some error occured.<br />
<br />
	Push $0<br />
<br />
	!insertmacro MUI_LANGDLL_DISPLAY<br />
	<br />
	SetOutPath $PLUGINSDIR<br />
<br />
	WriteINIStr &quot;$PLUGINSDIR\ioFile2.ini&quot; &quot;Settings&quot; &quot;NumFields&quot; &quot;1&quot;<br />
<br />
	WriteINIStr &quot;$PLUGINSDIR\ioFile2.ini&quot; &quot;Field 1&quot; &quot;Type&quot; &quot;Droplist&quot;<br />
	WriteINIStr &quot;$PLUGINSDIR\ioFile2.ini&quot; &quot;Field 1&quot; &quot;Flags&quot; &quot;NOTIFY&quot;<br />
	WriteINIStr &quot;$PLUGINSDIR\ioFile2.ini&quot; &quot;Field 1&quot; &quot;Left&quot; &quot;10&quot;<br />
	WriteINIStr &quot;$PLUGINSDIR\ioFile2.ini&quot; &quot;Field 1&quot; &quot;Right&quot; &quot;-122&quot;<br />
	WriteINIStr &quot;$PLUGINSDIR\ioFile2.ini&quot; &quot;Field 1&quot; &quot;Top&quot; &quot;84&quot;<br />
	WriteINIStr &quot;$PLUGINSDIR\ioFile2.ini&quot; &quot;Field 1&quot; &quot;ListItems&quot; &quot;$9&quot;<br />
	WriteINIStr &quot;$PLUGINSDIR\ioFile2.ini&quot; &quot;Field 1&quot; &quot;State&quot; &quot;$filename&quot;<br />
	<br />
	File &quot;bassmod.dll&quot;<br />
	File /nonfatal &quot;music\*.xm&quot;<br />
	File /nonfatal &quot;music\*.mod&quot;<br />
	<br />
	Push &quot;*.xm&quot;<br />
	Call ListFiles <br />
	Push &quot;*.mod&quot;<br />
	Call ListFiles <br />
	<br />
	Call CreateMODPage<br />
	<br />
	Call BASSMOD_Init<br />
	Call BASSMOD_MusicLoad<br />
	Call BASSMOD_MusicGetName<br />
	Call BASSMOD_MusicPlay<br />
FunctionEnd<br />
<br />
Function CheckSP2<br />
      ReadRegStr $R3 HKLM &quot;SOFTWARE\Microsoft\Windows NT\CurrentVersion&quot; CSDVersion <br />
				StrCmp &quot;$R3&quot; &quot;Service Pack 2&quot; 0 +2 <br />
				Return <br />
      MessageBox MB_OK &quot;You do not have Windows XP Service Pack 2 installed.$\n$\n Make sure to choose the 'Extract Files Only' install type on the components page.&quot; <br />
FunctionEnd&quot;<br />
<br />
<br />
Could someone tell me what to do here?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bluenet</div><div class="date">19th November 2004, 06:45</div></div><div class="posttext">Using ReserveFile</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilvoice</div><div class="date">19th November 2004, 10:11</div></div><div class="posttext">Could u tell me how to go about it? I saw it in the manual but it kinda confused me.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilvoice</div><div class="date">19th November 2004, 10:38</div></div><div class="posttext">The splash screen deosnt really matter to me, I just want the inbuilt Progress message box &quot;please wait while setup is loading... UNPACKING DATA 20 %&quot; to come back. <br />
<br />
why has that gone away?<br />
<br />
Is it because of the new version of Nsis 2.02?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th November 2004, 11:39</div></div><div class="posttext">It should show. I don't know why it doesn't show anymore, I'll check it out.<br />
<br />
In any case, you really should use ReserveFile so your setup will load faster.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilvoice</div><div class="date">19th November 2004, 11:56</div></div><div class="posttext">The only part effecting the unpacking data msg box would be in the .oninit function right?<br />
<br />
Do you have Nsis 2.0 ? I would like to compile with that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th November 2004, 12:01</div></div><div class="posttext">Yes, .onInit should be the only function that affects the showing of that dialog. NSIS 2.0 can be downloaded from the project page:<br />
<br />
http://sf.net/projects/nsis</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th November 2004, 12:47</div></div><div class="posttext">OK, I have looked at it and found out that everything works as should. When using solid compression, the dialog will show. Solid compression is enabled by default for bzip2 and lzma.<br />
<br />
The problem with your script is that you extract very large files in .onInit. That's a bad idea. If you're doing that, you should at least use the Banner plug-in to show a message to the user.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilvoice</div><div class="date">19th November 2004, 13:25</div></div><div class="posttext">The banner plug in replaces this dialog, but I think as this dialog isnt being shown, it wont show the banner too.<br />
<br />
I would still like to have the orignal dialog over the banner as it shows the progress. <br />
<br />
Is there a way I can get the dialog back?<br />
<br />
and you said having the files unpack at .oninit is a bad idea. Is there a way to change that? like can I have it unpack the selected components only at the install page?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th November 2004, 13:30</div></div><div class="posttext">It will show the banner, if you use it.<br />
<br />
You can use solid compression (SetCompressor bzip2 or SetCompressor lzma) to get back the dialog.<br />
<br />
To unpack the files only in the install page, unpack them in a section. Each visible section is a component in the components page, and only the selected components will execute the code in their sections.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilvoice</div><div class="date">19th November 2004, 14:04</div></div><div class="posttext">This part of code is already there in my script :<br />
<br />
SetCompressor lzma ;7-Zip<br />
SetCompress force <br />
SetDatablockOptimize on<br />
SetCompressorDictSize 64<br />
<br />
I do have quite a few sections and Subsections. How do I make it unpack in sections if selected?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th November 2004, 14:31</div></div><div class="posttext">Use the File command in the sections to have it unpack the files in the sections. For example:Section<br />
File test.exe<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilvoice</div><div class="date">19th November 2004, 19:13</div></div><div class="posttext">Thanx.. will look into implementing that.<br />
<br />
But how do I get the splash screen to show up? <br />
<br />
What is the reason for that dialog not showing up? If for some reason I cant use the 'file' command with the other command (upgradefile) im already using.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilvoice</div><div class="date">19th November 2004, 19:15</div></div><div class="posttext">Would using Reservefile get it back or just speed up the loading process?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th November 2004, 19:48</div></div><div class="posttext">Just speeds up the loading process as it puts your files at the top of the 'files to extract' list.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th November 2004, 20:03</div></div><div class="posttext">To get the progress dialog back, you need to use solid compression. You must have overriden the lzma setting later in the script or using MakeNSISw.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilvoice</div><div class="date">19th November 2004, 20:16</div></div><div class="posttext">Im sure I've not overridden the lzma compression later in the script.<br />
<br />
or using MakeNSISw What did u mean here?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th November 2004, 20:19</div></div><div class="posttext">MakeNSISw has an option to override the compression. It is also possible you've downloaded the special build with solid compression disabled. To make sure you haven't, run makensis with the /HDRINFO switch and look for NSIS_BZIP2_COMPRESS_WHOLE. If it's there, you don't have the special build.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilvoice</div><div class="date">19th November 2004, 20:50</div></div><div class="posttext">I typed makensis /hrdinfo in command prompt got some error.<br />
<br />
Or am I doing something wrong here?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th November 2004, 20:53</div></div><div class="posttext">It's /HDRINFO not /HRDINFO. You've mised up D and R.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilvoice</div><div class="date">19th November 2004, 20:59</div></div><div class="posttext">yes 'NSIS_BZIP2_COMPRESS_WHOLE' is there</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th November 2004, 21:11</div></div><div class="posttext">And what about MakeNSISw? What is set in Tools-&gt;Settings?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilvoice</div><div class="date">19th November 2004, 21:24</div></div><div class="posttext">&quot;defined in script/compiler default&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th November 2004, 21:33</div></div><div class="posttext">Did it show the dialog when you tried it with 2.0?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilvoice</div><div class="date">19th November 2004, 21:33</div></div><div class="posttext">Should I send you my script so you can have a look why the dialog doesnt show? Its quite small, wouldnt take you a minute to go through it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilvoice</div><div class="date">19th November 2004, 21:34</div></div><div class="posttext">Yes, but with a slightly different script</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th November 2004, 21:39</div></div><div class="posttext">Yes, send in the script. I'll the files too so I can compile it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilvoice</div><div class="date">19th November 2004, 21:42</div></div><div class="posttext">Do u use msn? I'll send them to you over msn</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th November 2004, 21:44</div></div><div class="posttext">No. Send to kichik @ users dot sourceforge dot net.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilvoice</div><div class="date">19th November 2004, 21:50</div></div><div class="posttext">The files are pretty big, and theres more to this before compiling. If we cud do this over and messenger u use, it wud be better.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilvoice</div><div class="date">19th November 2004, 21:52</div></div><div class="posttext">You could block and delete me right after we get through this.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th November 2004, 21:55</div></div><div class="posttext">I don't use it. If it's too big, upload it somewhere or find someway to reproduce it using standard files (include some big DLLs from Windows, for example).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilvoice</div><div class="date">19th November 2004, 22:13</div></div><div class="posttext">sent ya a PM</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th November 2004, 15:21</div></div><div class="posttext">It turns out the &quot;unpacking&quot; progress dialog didn't show because of the usage of BGGradient. This happens because the unpacking dialog won't show if the NSIS dialog was already created. The gradient background window pretends to be the dialog for so it can be used as the parent of splash screens. Since it is created before .onInit, anything extract in .onInit won't have the &quot;unpacking&quot; dialog.<br />
<br />
I have made the gradient background window stop pretending to be the dialog window. The background window is hidden while processing .onInit anyway so the script can make the installer silent without the window flashing.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilvoice</div><div class="date">28th November 2004, 01:25</div></div><div class="posttext">kichik, in my installer script I have used the setreboot flag, but even then at the finish page it doesnt show the option to reboot now or later. Could you have a look at it :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th November 2004, 18:58</div></div><div class="posttext">I have already deleted the script, so I can't test it on it. Try creating a minimal example reproducing the example. If you won't find the problem while creating the script, attach it and someone will surely be able to help.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>