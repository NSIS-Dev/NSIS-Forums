<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Disabling Next Btn on Custom Page, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Disabling Next Btn on Custom Page NSIS Discussion" />
	
	<title> Disabling Next Btn on Custom Page [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Disabling Next Btn on Custom Page</div>
<hr />
<div class="pda"><a href="t-258644.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=258644">Disabling Next Btn on Custom Page</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">RossW</div><div class="date">31st October 2006, 02:59</div></div><div class="posttext">I've searched the forum and found some generic info on hiding a button, but I cannot get it to work on a custom page:<br />
<br />
Page custom CustomPage<br />
.<br />
.<br />
.<br />
ReserveFile ${CustomPageINI}<br />
!insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br />
.<br />
.<br />
.<br />
Function CustomPage<br />
!insertmacro MUI_HEADER_TEXT &quot;$(TEXT_IO_TITLE)&quot; &quot;$(TEXT_IO_SUBTITLE)&quot;<br />
!insertmacro MUI_INSTALLOPTIONS_DISPLAY ${CustomPageINI}<br />
<br />
(some logic check here)<br />
GetDlgItem $0 $HWNDPARENT 1<br />
ShowWindow $0 ${SW_HIDE}<br />
<br />
EndFunction<br />
<br />
I know everything else work because the custom page does indeed display, but the Next button (nor any others I've tried) is hidden by the above code.<br />
<br />
Help!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">31st October 2006, 03:24</div></div><div class="posttext">Instead of the following line: &quot;GetDlgItem $0 $HWNDPARENT 1&quot;, you should use the HWND key from the specific field found in the INI file using the ReadINIFile instruction as follows:<br />
<br />
ReadINIFile $out_var &quot;ini_file.ini&quot; &quot;Field #&quot; &quot;HWND&quot;<br />
<br />
Where &quot;#&quot; stands for the field number of the specific control.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">31st October 2006, 08:13</div></div><div class="posttext">deguix: is that new?  In my version of installoptions, no such HWND value is written out, and I most certainly -do- have to pop the hwnd of the inner dialog after initializing the installoptions dialog, and then use &quot;GetDialogItem $var $popped_hwnd index(1200+item-1)&quot; to get at the control inside the installoptions dialog.<br />
<br />
RossW - do either as deguix said (if your stuff matches his), or read the installoptions docs carefully on customizing the dialogs and whatnot.<br />
<br />
The 'Next' button is actually outside of the InstallOptions inner dialog.  You can hide it by using:<br />
<br />
  GetDlgItem $0 $HWNDPARENT 1<br />
  ShowWindow $0 0<br />
<br />
<br />
Before you initialize/show/create the installoptions dialog.  Note that you can't hide it -after- the dialog is shown/created in the function that creates it.  You can, of course, unhide the button again in the page's leave function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RossW</div><div class="date">31st October 2006, 13:17</div></div><div class="posttext">I tried <br />
<br />
ShowWindow $0 0<br />
<br />
but that didn't work, either. For standar pages, it appears you can use the above by defining MUI_PAGE_CUSTOMFUNCTION_PRE function, but what can I do for a custom page?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">31st October 2006, 13:42</div></div><div class="posttext">really no different.. sample files:<br />
<br />
test.ini<br />
<br />
; Ini file generated by the HM NIS Edit IO designer.<br />
[Settings]<br />
NumFields=2<br />
<br />
[Field 1]<br />
Type=Button<br />
Text=This button to be disabled<br />
Flags=NOTIFY<br />
Left=80<br />
Right=170<br />
Top=17<br />
Bottom=32<br />
<br />
[Field 2]<br />
Type=Button<br />
Text=Show Next button<br />
Flags=NOTIFY<br />
Left=92<br />
Right=158<br />
Top=33<br />
Bottom=49<br />
<br />
<br />
.nsi file<br />
<br />
!include &quot;WinMessages.nsh&quot;<br />
<br />
Name &quot;&quot;<br />
OutFile &quot;Setup.exe&quot;<br />
<br />
var hwnd<br />
<br />
Page Custom ShowCustom LeaveCustom<br />
<br />
Page InstFiles<br />
<br />
Section &quot;Test&quot;<br />
<br />
SectionEnd<br />
<br />
Function .onInit<br />
	InitPluginsDir<br />
	File /oname=$PLUGINSDIR\test.ini test.ini<br />
FunctionEnd<br />
<br />
Function ShowCustom<br />
	GetDlgItem $0 $HWNDPARENT 1<br />
	ShowWindow $0 0<br />
<br />
	InstallOptions::initDialog /NOUNLOAD &quot;$PLUGINSDIR\test.ini&quot;<br />
	Pop $hwnd<br />
<br />
	GetDlgItem $0 $hwnd 1200<br />
	EnableWindow $0 0<br />
<br />
	InstallOptions::show<br />
	Pop $0<br />
FunctionEnd<br />
<br />
Function LeaveCustom<br />
	ReadINIStr $0 &quot;$PLUGINSDIR\test.ini&quot; &quot;Settings&quot; &quot;State&quot;<br />
<br />
	IntCmp $0 0 _next<br />
	IntCmp $0 2 0 _abort<br />
		GetDlgItem $0 $HWNDPARENT 1<br />
		ShowWindow $0 1<br />
<br />
	_abort:<br />
	    Abort<br />
<br />
	_next:<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RossW</div><div class="date">31st October 2006, 14:16</div></div><div class="posttext">My .ini file doen't have a listing for the 'Next' button - I'm trying to disable/hide the standard one.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">31st October 2006, 14:28</div></div><div class="posttext">the source above doesn't have a &quot;Next&quot; button either - it hides/unhides the standard one.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RossW</div><div class="date">31st October 2006, 15:40</div></div><div class="posttext">I guess I'm confused by your .ini file - what are those 2 fields for?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">31st October 2006, 16:15</div></div><div class="posttext">they're just examples.. the first button gets disabled by the script by..<br />
<br />
	GetDlgItem $0 $hwnd 1200<br />
	EnableWindow $0 0<br />
<br />
<br />
The Next button gets hidden before that by..<br />
<br />
	GetDlgItem $0 $HWNDPARENT 1<br />
	ShowWindow $0 0<br />
<br />
<br />
Presumably, you'd want to make the Next button visible again at some point, depending either on user input, or a variable, or somesuch.  The example does it by user input - namely clicking that second button..<br />
<br />
	IntCmp $0 2 0 _abort<br />
		GetDlgItem $0 $HWNDPARENT 1<br />
		ShowWindow $0 1<br />
<br />
<br />
If you just copy/paste them into files and compile it all, it'll make itself much clearer %)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RossW</div><div class="date">31st October 2006, 16:22</div></div><div class="posttext">Do I need<br />
<br />
!include &quot;WinMessages.nsh&quot;<br />
<br />
in order to use ShowWindow? Maybe that was my problem ...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st October 2006, 16:32</div></div><div class="posttext">Only if you're using the constants like ${SW_HIDE}. You're not so you don't need to include WinMessages.nsh<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">31st October 2006, 17:34</div></div><div class="posttext">yeah, sorry.. remnant from my template :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RossW</div><div class="date">31st October 2006, 20:29</div></div><div class="posttext">Animaether - will your example work in MUI? I implemented my custom page based on the documentation in the Modern UI Readme and the ModernUI examples; it looks totally different than yours (e.g. ReserveFile ${CustomPageINI})</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RossW</div><div class="date">1st November 2006, 01:11</div></div><div class="posttext">For anyone who's interested, the order is important:<br />
<br />
        ; This code hides the Next button<br />
        GetDlgItem $0 $HWNDPARENT 1<br />
        ShowWindow $0 0<br />
<br />
        !insertmacro MUI_HEADER_TEXT &quot;$(TEXT_IO_TITLE)&quot; &quot;$(TEXT_IO_SUBTITLE)&quot;<br />
        !insertmacro MUI_INSTALLOPTIONS_DISPLAY ${CustomPageINI}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RossW</div><div class="date">1st November 2006, 20:25</div></div><div class="posttext">While testing I discovered that if I disable the Next button on my custom page (because th prerequisite check turned up a missing dependency), if I click the Back btn to return to the Welcome page the Next btn is still invisible! To get around this, I had to add a custom function to the Welcome page using MUI_PAGE_CUSTOMFUNCTION_SHOW that does this:<br />
<br />
GetDlgItem $0 $HWNDPARENT 1<br />
ShowWindow $0 1</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">1st November 2006, 22:05</div></div><div class="posttext">Yep.. the order is important, as noted before ;)<br />
<br />
<br />
Before you initialize/show/create the installoptions dialog. Note that you can't hide it -after- the dialog is shown/created in the function that creates it. You can, of course, unhide the button again in the page's leave function.<br />
<br />
Your other point is a good one as well, and I'm glad you figured that out :)  Happy NSIS'ing!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st November 2006, 22:18</div></div><div class="posttext">There's no need to add code to the welcome page callback functions. The code after the InstallOptions call (MUI_INSTALLOPTIONS_DISPLAY) is always executed, even if the Back button was clicked. You can re-enable the button there. GetDlgItem $0 $HWNDPARENT 1<br />
ShowWindow $0 0<br />
<br />
!insertmacro MUI_HEADER_TEXT &quot;$(TEXT_IO_TITLE)&quot; &quot;$(TEXT_IO_SUBTITLE)&quot;<br />
!insertmacro MUI_INSTALLOPTIONS_DISPLAY ${CustomPageINI}<br />
<br />
ShowWindow $0 8 # ${SW_SHOW}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">3rd November 2006, 13:15</div></div><div class="posttext">I think that's &quot;there's no need ... in this case&quot;?  Basically what's happening there is that you're re-showing the Next button (8 is SW_SHOWNA?) -after- the dialog is displayed.  So although it isn't currently shown, the next time the dialog is refreshed it'll be back.<br />
<br />
But should a user have code -on- that dialog that hides the Next button again (for whatever reason), and -then- clicks the Back button, the Next button will happily remain hidden.  So in terms of coding practices, wouldn't it be best to make sure the button is visible on the welcome page by means of a pre-fuction for the welcome page?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd November 2006, 13:25</div></div><div class="posttext">If you want the button to remain hidden even after the user goes back from the page into the welcome page, so be it. But I don't believe that's the case. And so, it'd be best if the code will be self-contained in the page. If it's on the welcome page, it won't work once you move the page to another location. If, for example, you add another page between the welcome page and this custom page, it won't have the Next button visible or enabled. The user will have to go back to the welcome page in order to get the Next button back.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">3rd November 2006, 13:50</div></div><div class="posttext">I'm not quite sure I'm following you... but let's try with a few examples..<br />
<br />
Say I'm on the custom page, and I hide the Next button by means of some piece of code on that custom page's Leave function.<br />
Now I press the &quot;Back&quot; button.  Whatever page I go back to that came before this Custom page will not not show the &quot;Next&quot; button.<br />
<br />
So in whatever page I would go &quot;Back&quot; to, I would have to make sure that the &quot;Next&quot; button does become visible.<br />
<br />
Now you mention that &quot;what if there is a page in-between?&quot;.  Sadly, -that- page would have to have that same &quot;Next&quot; button-showing code.<br />
<br />
You are right in that ideally the code to restore the &quot;Next&quot; button would be on the Custom page.  Unfortunately, however, the &quot;Back&quot; button doesn't register in the Leave function - so it can't be done there.<br />
<br />
Thoughts?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd November 2006, 13:54</div></div><div class="posttext">Exactly, it can't be done in the leave function. That's why I suggested to put it in the custom page show function. Notice the code is located after MUI_INSTALLOPTIONS_DISPLAY. There's no reason to require other pages to be aware of the custom's page games with the Next button.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">3rd November 2006, 14:50</div></div><div class="posttext">err... I see now where I made an assumption I shouldn't have &gt;_&lt;<br />
<br />
I thought the following code would execute immediately:<br />
<br />
	MessageBox MB_OK &quot;A&quot;<br />
	InstallOptions::dialog &quot;$PLUGINSDIR\test.ini&quot;<br />
	MessageBox MB_OK &quot;B&quot;<br />
<br />
While in reality, &quot;B&quot; messagebox doesn't get displayed until the custom dialog is closed (by means of Next, Back, etc.).<br />
<br />
My mistake.  Now to go and take advantage of that.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>