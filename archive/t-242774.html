<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problems adding Path variable, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problems adding Path variable NSIS Discussion" />
	
	<title> Problems adding Path variable [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problems adding Path variable</div>
<hr />
<div class="pda"><a href="t-242774.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=242774">Problems adding Path variable</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Thalion77</div><div class="date">6th April 2006, 12:00</div></div><div class="posttext">Hello!<br />
<br />
I want to add a path to the path environment variable in order to call executables without defining the whole path.<br />
<br />
I use the code sample at:<br />
<br />
http://nsis.sourceforge.net/Path_Manipulation<br />
<br />
But those lines don't really work as I would like to have. Indeed, the path variable is going to be added. BUT: If I again call ReadEnvStr $1 PATH, my set path variable is not found in $1. If I call my installer several times without rebooting the computer, the path variable is added several times due to ReadEnvStr $1 PATH. I have to reboot the machine to get the right path informations. It seems, that SendMessage ${HWND_BROADCAST} ${WM_WININICHANGE} 0 &quot;STR:Environment&quot; /TIMEOUT=5000 does not refresh the system correctly. What can be done to refresh the system without rebooting? I use NSIS 2.14.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Thalion77</div><div class="date">6th April 2006, 12:16</div></div><div class="posttext">I found out that the following lines<br />
<br />
WriteRegExpandStr ${WriteEnvStr_RegKey} &quot;PATH&quot; $3<br />
SendMessage ${HWND_BROADCAST} ${WM_WININICHANGE} 0 &quot;STR:Environment&quot; /TIMEOUT=5000<br />
<br />
do not immediately activate the new set path.<br />
<br />
So if you set a path and then execute an executable without path, that will not work.<br />
<br />
e.g.<br />
SendMessage ${HWND_BROADCAST} ${WM_WININICHANGE} 0 &quot;STR:Environment&quot; /TIMEOUT=5000<br />
Exec 'InstallAppCmd.exe' # FAILES!!!<br />
but<br />
Exec 'C:\Program Files\InstallAppCmd.exe'  # works!!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th April 2006, 10:50</div></div><div class="posttext">The SendMessage line only updates explorer.exe. If you execute your installer from an application that doesn't update itself due to that broadcast message, like another installer, your installer will not see the updated environment variable. To set the environment variables of the current process, you can use the first method described in Setting Environment Variables (http://nsis.sourceforge.net/Setting_Environment_Variables). When setting the variables for the current process, every process executed from it will inherit the new variables. However, they will not be set on the entire system and will be forgotten when the process exits.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>