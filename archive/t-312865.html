<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Scheduled Tasks - How to create some with if &amp; else?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Scheduled Tasks - How to create some with if &amp; else? NSIS Discussion" />
	
	<title> Scheduled Tasks - How to create some with if &amp; else? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Scheduled Tasks - How to create some with if &amp; else?</div>
<hr />
<div class="pda"><a href="t-312865.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=312865">Scheduled Tasks - How to create some with if &amp; else?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Panarchy</div><div class="date">23rd September 2009, 04:30</div></div><div class="posttext">Hello<br />
<br />
I'm trying to implement some Scheduled Tasks.<br />
<br />
These are for backups, and link to .bat scripts.<br />
<br />
There are two kind of Batch scripts in-use;<br />
 One that backs-up data to the I:\ drive<br />
 One that backs up data to the N:\ drive[/list=1] <br />
I'll include both scripts within the one NSIS installer. All servers have an I:\ drive, however only about half of them have the N:\ drive. Here is an idiosyncratic-programming way of showing you what I'd like;<br />
If N:\ exists, extract nDrive-Script.bat to the Backup-Scripts directory else extract iDrive-Script.bat to the Backup-Scripts directory.<br />
Can you please give me an example script which;<br />
[list] Extracts the batch files based on existing directories<br />
 Installs them as Scheduled Tasks which run at a certain specified time &amp; date<br />
Thanks in advance,<br />
<br />
Panarchy<br />
<br />
BTW: Backup-Scripts folder is located in T:\Backup-Scripts</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">23rd September 2009, 07:50</div></div><div class="posttext">To check if the drive exist, you can use IfFileExists, or ${If} ${FileExists} with the LogicLib header.<br />
For scheduled tasks:<br />
http://nsis.sourceforge.net/Scheduled_Tasks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Panarchy</div><div class="date">23rd September 2009, 22:54</div></div><div class="posttext">I have written some code, below which SHOULD do the first part (everything but install the new Scheduled Tasks).<br />
<br />
http://pastebin.com/f9bcd502<br />
<br />
I can't get the aforementioned code to compile correctly. :(<br />
<br />
Here is the output of the compiler;<br />
<br />
http://codepad.org/YuaKjt4o<br />
<br />
Please help me fix the script.<br />
<br />
Thanks in advance,<br />
<br />
Panarchy</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">24th September 2009, 06:51</div></div><div class="posttext">Err... The compiler is already telling you what is wrong.<br />
'Error: could not resolve label &quot;PastIBackupsCheck&quot; in function &quot;.onInit&quot;'<br />
<br />
You tell it to go to a label that doesn't exist.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Panarchy</div><div class="date">25th September 2009, 02:54</div></div><div class="posttext">Thanks, I found a better example online, and it is now this;<br />
<br />
Function .onInit<br />
IfFileExists &quot;I:\Backups&quot; 0 continue<br />
		MessageBox MB_YESNO|MB_ICONQUESTION &quot;Does I:\Backups exist?&quot; IDYES true IDNO continue<br />
true:<br />
!macro ExtractiBackupScripts ToDir<br />
    SetOutPath `${ToDir}`<br />
	File &quot;Contig.exe&quot;<br />
	File &quot;Defrag.cmd&quot;<br />
	File &quot;NTBackup.cmd&quot;<br />
   !macroend<br />
!insertmacro ExtractiBackupScripts &quot;T:\Backup-Scripts\&quot;<br />
<br />
continue:<br />
   !macro ExtractnBackupScripts ToDir<br />
    SetOutPath `${ToDir}`<br />
	File &quot;Contig.exe&quot;<br />
	File &quot;NTBackup-2009.cmd&quot;<br />
   !macroend<br />
!insertmacro ExtractnBackupScripts &quot;T:\Backup-Scripts\&quot;<br />
<br />
FunctionEnd<br />
<br />
Which seems to work fine... however I'd like to remove the prompt, and make it continue automatically based on existence of the drive letter/directory.<br />
<br />
Also I'll need to add the Scheduled Tasks... which from the looks of things is very confusing. Hopefully I won't have to end up with &quot;ExecWait&quot;ing a Batch!!!<br />
<br />
Please tell me how I can fix up my function.<br />
<br />
Thanks in advance,<br />
<br />
Panarchy<br />
<br />
EDIT;<br />
<br />
Might of fixed it with:<br />
<br />
Section /o &quot;N:\Backups detected&quot; nBackups_detected<br />
nBackupsExists:<br />
  SectionGetFlags &quot;${nBackups_detected}&quot; $0<br />
  IntOp $0 $0 | ${SF_SELECTED}<br />
  SectionSetFlags &quot;${nBackups_detected}&quot; $0<br />
MessageBox MB_OK nBackups<br />
   !macro ExtractnBackupscripts ToDir<br />
    SetOutPath `${ToDir}`<br />
	File &quot;Contig.exe&quot;<br />
	File &quot;Defrag.cmd&quot;<br />
	File &quot;NTBackup.cmd&quot;<br />
   !macroend<br />
!insertmacro ExtractnBackupscripts &quot;T:\Backup-Scripts&quot;<br />
<br />
PastnBackupsCheck:<br />
   !macro ExtractiBackupScripts ToDir<br />
    SetOutPath `${ToDir}`<br />
	File &quot;Contig.exe&quot;<br />
	File &quot;NTBackup-2009.cmd&quot;<br />
   !macroend<br />
!insertmacro ExtractiBackupScripts &quot;T:\Backup-Scripts\c&quot;<br />
<br />
SectionEnd<br />
<br />
<br />
EDIT2: Ended up fixing the issue, now just need to work out how to add Scheduled Tasks...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Panarchy</div><div class="date">25th September 2009, 06:53</div></div><div class="posttext">They ended up not wanting it, so I've got a half-finished script here. Works perfectly, however doesn't install any Scheduled Tasks.<br />
<br />
Enjoy ;)<br />
<br />
Panarchy<br />
<br />
!include Sections.nsh<br />
<br />
Name Scheduled Backups<br />
OutFile &quot;Scheduled Backups.exe&quot;<br />
InstallDir &quot;T:\Backup-Scripts&quot;<br />
<br />
XPStyle on<br />
<br />
Page components<br />
<br />
Page instfiles<br />
ShowInstDetails show<br />
<br />
Section &quot;Backup Scripts&quot;<br />
  !macro ExtractBackupScripts ToDir<br />
    SetOutPath `${ToDir}`<br />
	File &quot;Contig.exe&quot;<br />
	File &quot;Defrag.cmd&quot;<br />
	File &quot;NTBackup-2009.cmd&quot;<br />
	File &quot;NTBackup.cmd&quot;<br />
  !macroend<br />
SectionEnd<br />
; The following section removes old Scheduled Tasks<br />
Section<br />
!macro GetCleanDir INPUTDIR<br />
  ; ATTENTION: USE ON YOUR OWN RISK!<br />
  ; Please report bugs here: http://stefan.bertels.org/<br />
  !define Index_GetCleanDir 'GetCleanDir_Line${__LINE__}'<br />
  Push $R0<br />
  Push $R1<br />
  StrCpy $R0 &quot;${INPUTDIR}&quot;<br />
  StrCmp $R0 &quot;&quot; ${Index_GetCleanDir}-finish<br />
  StrCpy $R1 &quot;$R0&quot; &quot;&quot; -1<br />
  StrCmp &quot;$R1&quot; &quot;\&quot; ${Index_GetCleanDir}-finish<br />
  StrCpy $R0 &quot;$R0\&quot;<br />
${Index_GetCleanDir}-finish:<br />
  Pop $R1<br />
  Exch $R0<br />
  !undef Index_GetCleanDir<br />
!macroend<br />
 <br />
!macro RemoveFilesAndSubDirs DIRECTORY<br />
  !define Index_RemoveFilesAndSubDirs 'RemoveFilesAndSubDirs_${__LINE__}'<br />
 <br />
  Push $R0<br />
  Push $R1<br />
  Push $R2<br />
 <br />
  !insertmacro GetCleanDir &quot;${DIRECTORY}&quot;<br />
  Pop $R2<br />
  FindFirst $R0 $R1 &quot;$R2*.*&quot;<br />
${Index_RemoveFilesAndSubDirs}-loop:<br />
  StrCmp $R1 &quot;&quot; ${Index_RemoveFilesAndSubDirs}-done<br />
  StrCmp $R1 &quot;.&quot; ${Index_RemoveFilesAndSubDirs}-next<br />
  StrCmp $R1 &quot;..&quot; ${Index_RemoveFilesAndSubDirs}-next<br />
  IfFileExists &quot;$R2$R1\*.*&quot; ${Index_RemoveFilesAndSubDirs}-directory<br />
  ; file<br />
  Delete &quot;$R2$R1&quot;<br />
  goto ${Index_RemoveFilesAndSubDirs}-next<br />
${Index_RemoveFilesAndSubDirs}-directory:<br />
  ; directory<br />
  RMDir /r &quot;$R2$R1&quot;<br />
${Index_RemoveFilesAndSubDirs}-next:<br />
  FindNext $R0 $R1<br />
  Goto ${Index_RemoveFilesAndSubDirs}-loop<br />
${Index_RemoveFilesAndSubDirs}-done:<br />
  FindClose $R0<br />
 <br />
  Pop $R2<br />
  Pop $R1<br />
  Pop $R0<br />
  !undef Index_RemoveFilesAndSubDirs<br />
!macroend<br />
!insertmacro RemoveFilesAndSubDirs &quot;$WINDIR\tasks\&quot;<br />
SectionEnd<br />
; The above section removes all Scheduled Tasks<br />
<br />
Function .onInit<br />
IfFileExists &quot;I:\&quot; 0 continue<br />
		MessageBox MB_OKCANCEL|MB_ICONQUESTION &quot;I've cheated the Message box with this, right?&quot; IDOK true IDNO continue<br />
true:<br />
!macro ExtractiBackupScripts ToDir<br />
    SetOutPath `${ToDir}`<br />
	File &quot;Contig.exe&quot;<br />
	File &quot;Defrag.cmd&quot;<br />
	File &quot;NTBackup.cmd&quot;<br />
   !macroend<br />
!insertmacro ExtractiBackupScripts &quot;T:\Backup-Scripts&quot;<br />
<br />
continue:<br />
   !macro ExtractnBackupScripts ToDir<br />
    SetOutPath `${ToDir}`<br />
	File &quot;Contig.exe&quot;<br />
	File &quot;NTBackup-2009.cmd&quot;<br />
   !macroend<br />
!insertmacro ExtractnBackupScripts &quot;T:\Backup-Scripts&quot;<br />
<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>