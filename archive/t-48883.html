<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Set DEFAULT installation Dir (conditionally), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Set DEFAULT installation Dir (conditionally) NSIS Discussion" />
	
	<title> Set DEFAULT installation Dir (conditionally) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Set DEFAULT installation Dir (conditionally)</div>
<hr />
<div class="pda"><a href="t-48883.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=48883">Set DEFAULT installation Dir (conditionally)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">dbareis</div><div class="date">4th May 2001, 02:38</div></div><div class="posttext">Hi,<br />
<br />
Currrently I have a product whose default installation directory defaults to &quot;C:\PROGRAM FILES\SITECOPY&quot;.<br />
<br />
What I want is to set it to &quot;C:\PROGRAM FILES\SITECOPY&quot; if the user is on Windows NT/2000 (and probably XP) and to &quot;C:\SC&quot; if on DOS versions (95/98/ME).  I want this to be the default that is shown in the choose directory dialog so the user can still place the files where they wish.<br />
<br />
Can someone please tell me how I can do this.<br />
<br />
Thanks for any help,<br />
Dennis</div></div><hr />


<div class="post"><div class="posttop"><div class="username">justin</div><div class="date">4th May 2001, 06:29</div></div><div class="posttext">Sure, just add the following lines to your .nsi file:<br />
<br />
<br />
Function .onInit<br />
  ReadRegStr $0 HKLM &quot;Software\Microsoft\Windows NT\CurrentVersion&quot; SystemRoot<br />
  StrCmp $0 &quot;&quot; 0 NoWin9x<br />
    StrCpy $INSTDIR C:\SC<br />
  NoWin9x:<br />
FunctionEnd<br />
<br />
<br />
What this does it check for HKLM\Software\Microsoft\Windows NT\CurrentVersion\SystemRoot, and if it is not empty, it knows it is on Windows NT, and skips the StrCpy line.<br />
<br />
Note that if you also want to use InstallDirRegKey (to let the user upgrade easily), and don't want to overwrite that install dir if the user is upgrading, you can use something like:<br />
<br />
<br />
Function .onInit<br />
  StrCmp $INSTDIR &quot;C:\Program Files\SITECOPY&quot; 0 NoWin9x<br />
  ReadRegStr $0 HKLM &quot;Software\Microsoft\Windows NT\CurrentVersion&quot; SystemRoot<br />
  StrCmp $0 &quot;&quot; 0 NoWin9x<br />
    StrCpy $INSTDIR C:\SC<br />
  NoWin9x:<br />
FunctionEnd<br />
<br />
<br />
Which will only change $INSTDIR if the default (C:\program files\SITECOPY) is used..<br />
<br />
-Justin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dbareis</div><div class="date">4th May 2001, 10:29</div></div><div class="posttext">Excellent, thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dbareis</div><div class="date">5th May 2001, 01:11</div></div><div class="posttext">Hi Justin,<br />
<br />
I was thinking about your response, it solved my main problem (works very well - thanks) but it would be nice if all the main options such as &quot;DirText&quot; could also be accessed as variables. And please if you do this either add $COMSPEC or access to environment variables in general.....<br />
<br />
Bye<br />
Dennis</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>