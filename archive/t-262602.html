<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" File owner &amp; permission, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  File owner &amp; permission NSIS Discussion" />
	
	<title> File owner &amp; permission [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  File owner &amp; permission</div>
<hr />
<div class="pda"><a href="t-262602.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=262602">File owner &amp; permission</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">dogo</div><div class="date">28th December 2006, 15:10</div></div><div class="posttext">Hello forum, <br />
<br />
I have got a big problem with NSIS.<br />
<br />
I use AdvReplaceInFile (http://nsis.sourceforge.net/More_advanced_replace_text_in_file) to replace some strings in my file I would like to change.<br />
This works great. After all actions I set my file permissions with AccessControll Plugin (http://nsis.sourceforge.net/AccessControl_plug-in), but the permissions and the file owner will not be set correctly.<br />
<br />
I suppose so that the temporary file (that will be copied over original) that will be created with AdvReplaceInFile (http://nsis.sourceforge.net/More_advanced_replace_text_in_file)  does not get the file permissions from AccessControll Plugin (http://nsis.sourceforge.net/AccessControl_plug-in).<br />
<br />
Is there any workaround or something I does not know ?!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th December 2006, 10:37</div></div><div class="posttext">Did you try setting the privileges after calling AdvReplaceInFile?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dogo</div><div class="date">29th December 2006, 12:17</div></div><div class="posttext">Hello kichik, <br />
<br />
yes of course, first I replace in some files, after that I<br />
change the file privileges.<br />
<br />
The strange thing is that all files which were not substituted with some new text have the privileges I set. All with replaced text contain privileges like new created files within this account installer run in.<br />
<br />
Greetings, <br />
<br />
Wolfgang.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th December 2006, 12:33</div></div><div class="posttext">Well, usually what this kind of functions do is create a new file and write the new data into it. You could either change that script to create the file in the correct folder, or do the replacement in another file and later manually copy the contents into the old file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dogo</div><div class="date">29th December 2006, 12:59</div></div><div class="posttext">Hello kichik, <br />
<br />
I think this will do what I want, but isn`t it a little bit strange that the <br />
AccessControl Plugin (http://nsis.sourceforge.net/AccessControl_plug-in) will not change new file attributes which are (should ?) created befor changing attributes ?<br />
<br />
This seems to be a bug for me. :cry:<br />
Looks like NSIS will copy the temporary files at the end of the installer <br />
over my orginal ? :weird: <br />
<br />
The question for me is, if this is an NSIS or an Plugin problem.<br />
<br />
Greetings,<br />
<br />
Wolfgang.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th December 2006, 13:19</div></div><div class="posttext">Looks like NSIS will copy the temporary files at the end of the installer over my orginal?As I said, that's what those replacement scripts usually do. It's a problem with the script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dogo</div><div class="date">29th December 2006, 13:36</div></div><div class="posttext">Hello kichik, <br />
<br />
yes that is right, but the replacement script calls the rename statement within his replace function. Shouldn`t NSIS rename the file when this statment is called !? For me looks this like NSIS renaming all files at the end of the install time. But not at this time where rename is called !? I am a little bit confused now.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th December 2006, 13:41</div></div><div class="posttext">Rename renames immediately. The problem is that the temporary files it renames is either created in the temporary folder and therefore gets a different set of privileges, or the destination file has privileges different than even those of the folder that contains it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dogo</div><div class="date">29th December 2006, 14:21</div></div><div class="posttext">Hi, <br />
<br />
but shouldn`t work set file privileges as expected in your case ?!<br />
I am right that renames copy the temp file to my $INSTDIR ?<br />
<br />
Flow Diagram:<br />
<br />
OriginalFile -&gt; ReplaceFunctionCall() -&gt; CreateTempFile -&gt;<br />
WriteReplacementInTempFile -&gt; DeleteOriginal -&gt; RenameTempFile -&gt; <br />
DeleteTempFile -&gt; setFilePrivileges<br />
<br />
NSIS Script:<br />
<br />
...<br />
; Original File for String Replace.<br />
<br />
File &quot;/oname=$INSTDIR\filename.txt&quot; &quot;.\filename.txt&quot;<br />
<br />
; Starting String Replacment.<br />
<br />
!insertmacro AdvReplaceInFile &quot;$INSTDIR\filename.txt&quot; &quot;abc&quot; &quot;xyz&quot; all all<br />
<br />
<br />
; User is existing in Windows XP Environment.<br />
; This should now change my file privileges on my file which<br />
; should be the file in which the strings are replaced,<br />
; But it is not.<br />
<br />
AccessControl::GrantOnFile  &quot;$INSTDIR\filename.txt&quot; &quot;Apache&quot; &quot;FullAccess&quot;<br />
AccessControl::SetFileOwner &quot;$INSTDIR\filename.txt&quot; &quot;Apache&quot;<br />
AccessControl::SetFileGroup &quot;$INSTDIR\filename.txt&quot; &quot;ApacheGroup&quot;<br />
...<br />
<br />
This seems to be a bug for me.<br />
Is there any workaround instead of truncate my original file and copy content of temp file ?!<br />
<br />
Greetings, <br />
<br />
Wolfgang.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th December 2006, 14:44</div></div><div class="posttext">I haven't looked into AdvReplaceInFile, but your flow diagram describes what most of those functions do, so it's probably right. As I said, you have two options. The first, and simpler, is changing that function so it'd create the temporary file in $INSTDIR and not $TEMP. This way, it'll get the attributes of $INSTDIR automatically. Your second option is not to rename at all and manually copy the contents of the file.<br />
<br />
However, if all that is wrong is the file owner, you might have a problem with that AccessControl call and all you need to do is fix it. Make sure that call works on the file itself, without calling AdvReplaceInFile.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>