<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" how to backup files during installation ?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  how to backup files during installation ? NSIS Discussion" />
	
	<title> how to backup files during installation ? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  how to backup files during installation ?</div>
<hr />
<div class="pda"><a href="t-218978.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=218978">how to backup files during installation ?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jerder</div><div class="date">15th June 2005, 18:47</div></div><div class="posttext">Hi everybody,<br />
I am writing an installer with NSIS the first time, and am encountering the problem of backing up files during install before they are replaced with new files by the installer. <br />
The installer uses the file command to install complete<br />
directory trees similiar to :<br />
<br />
 File   /r &quot;C:\Installer\dir1&quot;<br />
<br />
But I found no possibility to specify any kind of backup of files. <br />
<br />
Any help welcome !<br />
-jerder</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mæster</div><div class="date">15th June 2005, 21:15</div></div><div class="posttext">http://nsis.sourceforge.net/archive/viewpage.php?pageid=314</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jerder</div><div class="date">16th June 2005, 17:53</div></div><div class="posttext">Originally posted by Mæster <br />
http://nsis.sourceforge.net/archive/viewpage.php?pageid=314  <br />
<br />
this will work. But does it mean I can't<br />
use the /r switch of the File command then ?<br />
-jerder</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mæster</div><div class="date">16th June 2005, 22:45</div></div><div class="posttext">But does it mean I can't<br />
use the /r switch of the File command then ?<br />
 <br />
Yes, I think you could not use the /r switch. If you would like to backup all files of a specific folder you have to make your own macro/function to do that. Maybe something like the following (untested!) ...<br />
<br />
!macro BackupDir SOURCE_DIR BACKUP_TO<br />
 ; SOURCE_DIR = Source Directory<br />
 ; BACKUP_TO = Backup Directory<br />
 ; INSTDIR = Destination Directory<br />
 ; $R0 = handle from the search function<br />
 ; $R1 = current file<br />
<br />
  FindFirst $R0 $R1 &quot;${SOURCE_DIR}\*.*&quot;<br />
  strcmp $R1 &quot;&quot; EndBackup ;Source Dir does not exist<br />
<br />
  loop:<br />
       Strcmp $R1 &quot;&quot; EndBackup<br />
       StrCmp $R1 &quot;.&quot; next<br />
       StrCmp $R1 &quot;..&quot; next<br />
       IfFileExists &quot;${SOURCE_DIR}\$R1\*.*&quot; next<br />
       ; Backup File<br />
       !insertmacro BackupFile $INSTDIR $R1 ${BACKUP_TO}<br />
       ; install new version<br />
       File &quot;${SOURCE_DIR}\$R1&quot;<br />
  next:<br />
       FindNext $R0 $R1<br />
  Goto loop<br />
<br />
  EndBackup:<br />
  FindClose $R0<br />
!macroend<br />
<br />
Example:<br />
Section &quot;Install Files&quot;<br />
!insertmacro BackupDir &quot;C:\MyProject\Install Source&quot; &quot;$INSTDIR\backup&quot;<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">17th June 2005, 17:43</div></div><div class="posttext">Mæster you're confusing run-time with compile-time.<br />
The loop will be executed on run-time but you need to compress the files on compile-time.<br />
<br />
This page (http://nsis.sourceforge.net/archive/viewpage.php?pageid=594) shows how you can invoke NSIS run-time commands at compile-time by creating a seperate installer to execute.<br />
You can use this to recursively loop through a folder:<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=985&amp;instances=0,11,211<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mæster</div><div class="date">17th June 2005, 21:45</div></div><div class="posttext">Mæster you're confusing run-time with compile-time. <br />
Argh - you are right, what a stupid mistake.<br />
<br />
Another attemt to include many files/directories whithout naming each file in the scrip is to include them as an already compiled archive (zip) and to put that archive at runtime to a temp folder. You could use the zip-plugin to extract them in the temp folder. Now you have a source and a destination folder and you could use the loop (the code above has to be fixed a bit to do that) to &quot;backup-install&quot; them.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>