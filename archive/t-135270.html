<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" $INSTDIR does not initialize in .onInit function at runtime, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  $INSTDIR does not initialize in .onInit function at runtime NSIS Discussion" />
	
	<title> $INSTDIR does not initialize in .onInit function at runtime [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  $INSTDIR does not initialize in .onInit function at runtime</div>
<hr />
<div class="pda"><a href="t-135270.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=135270">$INSTDIR does not initialize in .onInit function at runtime</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">vtsaran</div><div class="date">13th May 2003, 19:01</div></div><div class="posttext">Hello, listers!<br />
I am at a loss.<br />
I have two almost identical scripts. In both of them I initialize $instdir at compile time. Then, in the .onInit I have:<br />
<br />
IfFileExists &quot;$INSTDIR\myfiles*.*&quot; Jump_if_Good Jump_If_Bad<br />
<br />
but $INSTDIR does not initialize and installer behaves as though the files are not found. If I substitute $INSTDIR with an actual directory, then everything works fine.<br />
The interesting thing is that the function which initializes the $INSTDIR at compile time is exactly the same in both scripts.<br />
<br />
Do you have any idea about the possible causes of this misbehavior?<br />
<br />
Thanks,<br />
Victor</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rsegal</div><div class="date">13th May 2003, 19:31</div></div><div class="posttext">It would be helpful to see the function that initializes $INSTDIR</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">13th May 2003, 20:57</div></div><div class="posttext">attach script, dude :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th May 2003, 11:24</div></div><div class="posttext">$INSTDIR is set before .onInit if InstallDir and/or InstallDirRegKey are specified.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vtsaran</div><div class="date">14th May 2003, 16:04</div></div><div class="posttext">Hello, guys!<br />
OK, here goes the script.<br />
Regards,<br />
Vic</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">14th May 2003, 16:11</div></div><div class="posttext">I find you error:<br />
<br />
InstallDir &quot;$INSTDIR&quot;<br />
<br />
The above line is wrong, is should:<br />
<br />
InstallDir &quot;$PROGRAMFILES\${MUI_PRODUCT}&quot; ;or another you want</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vtsaran</div><div class="date">14th May 2003, 16:36</div></div><div class="posttext">Well, it works in another script. Plus I want my $INSTDIR to be generated at runtime depending on the conclutions drawn from reading appropriate registry keys.<br />
Regards,<br />
Victor</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">14th May 2003, 17:01</div></div><div class="posttext">$INSTDIR contains the installation directory &quot;variable&quot;<br />
from one of these three:<br />
1. From the registry using the InstallDirRegKey.<br />
2. When you use the InstallDir.<br />
3. When the user use the Browse button the change the Installation path.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th May 2003, 17:34</div></div><div class="posttext">Here's how it works:<br />
InstallDir &quot;$PROGRAMFILES\Jeff&quot;<br />
$INSTDIR=&quot;C:\Program Files\Jeff&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vtsaran</div><div class="date">14th May 2003, 17:51</div></div><div class="posttext">Thank you everybody. I can't believe how unattentive I was. There was a typing error in the line<br />
<br />
InstallDirRegKey HKLM &quot;Software\${MUI_PRODUCT}&quot; &quot;Install_Dir&quot;<br />
<br />
I accidentally omitted a quote.<br />
So the following reads correct and works fine.<br />
<br />
InstallDir &quot;$INSTDIR&quot;<br />
InstallDirRegKey HKLM &quot;Software\${MUI_PRODUCT}&quot; &quot;Install_Dir&quot;<br />
<br />
Now my $INSTDIR is defined at run time.<br />
<br />
Regards,<br />
Vic</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th May 2003, 20:44</div></div><div class="posttext">Your code is still wrong. The InstallDir sets $INSTDIR if InstallDirRegKey fails. You set something to itself when it's empty. It only works for you because the registry key is there, once it's gone you'll get an empty one instead. If you do want an empty $INSTDIR if the registry key is not there then you just don't need InstallDir.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">14th May 2003, 21:16</div></div><div class="posttext">I have this and it works:<br />
<br />
InstallDirRegKey HKLM &quot;Software\${MUI_PRODUCT}&quot; &quot;Install_Dir&quot; <br />
InstallDir &quot;C:\path&quot; <br />
<br />
This isnÂ´t right: InstallDir &quot;$INSTDIR&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vtsaran</div><div class="date">19th May 2003, 21:03</div></div><div class="posttext">OK, but then I don't understand something. How would I change $INSTDIR at run time? A very basic scenario: my installation directory will change depending on the version of another application installed. If I declare some path for InstallDir, then I have to stick with it. That's not what I want.<br />
My current scenario works because if there is no InstallRegKey for my application, then I assume it was never installed on this computer, otherwise, I check for existence of certain files.<br />
<br />
Regards,<br />
Vic</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">19th May 2003, 21:08</div></div><div class="posttext">In the Nsis Manual check for &quot;SetOutPath&quot; instruction.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vtsaran</div><div class="date">19th May 2003, 21:11</div></div><div class="posttext">Hello,<br />
Kichik, you were right, I grant. I took out the line <br />
<br />
InstallDir &quot;$INSTDIR&quot;<br />
<br />
and it still works the same. I think I understand my mistake now.<br />
Thanks everybody.<br />
<br />
Regards,<br />
Vic</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st May 2003, 13:04</div></div><div class="posttext">Just to make sure everybody understand, this is how it works:<br />
<br />
 Installer starts<br />
 The value specified using InstallDir is copied to $INSTDIR<br />
 The value specified using InstallDirRegKey (if found) is copied to $INSTDIR<br />
 .onInit is called, and later everything else<br />
<br />
You can change $INSTDIR wherever you want in the script with worrying about InstallDir and InstallDirRegKey. Those just give the initial values.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>