<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Uninstaller + UAC plugin + Vista = confusion, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Uninstaller + UAC plugin + Vista = confusion NSIS Discussion" />
	
	<title> Uninstaller + UAC plugin + Vista = confusion [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Uninstaller + UAC plugin + Vista = confusion</div>
<hr />
<div class="pda"><a href="t-277801.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=277801">Uninstaller + UAC plugin + Vista = confusion</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">23rd September 2007, 16:49</div></div><div class="posttext">After using the UAC plugin to make my installer work properly when run on Vista, I updated the uninstaller to also use the UAC plugin. But the uninstaller did not work properly when it was started by a &quot;standard&quot; user on Vista.<br />
<br />
The problem is that when a &quot;standard&quot; user runs the uninstaller via the Vista equivalent of &quot;Add/Remove Programs&quot; Vista runs it as an administrator right from the start (i.e. it ignores the RequestExecutionLevel setting). This means the UAC plugin does not start the second process.<br />
<br />
I have found that if I create a Start Menu shortcut to my uninstaller and use that from a &quot;standard&quot; account then the UAC plugin will create the second process because Vista pays attention to the RequestExecutionLevel setting in this case.<br />
<br />
Am I doing something wrong or will I just have to tell my users to use the Start Menu to uninstall the program?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">23rd September 2007, 18:40</div></div><div class="posttext">If you write the uninstall entry in HKCU it does not elevate, when you write to HKLM, it is a all-users type install and you should probably be prepared to handle any user uninstalling it.<br />
<br />
If you add two dwords to your uninstall entry in HKLM:<br />
NoElevateOnModify=1<br />
NoRemove=1<br />
<br />
you sort of get the desired effect, only problem is that the UI now calls it change instead of uninstall<br />
<br />
Unless MS provides another dword for uninstall to disable elevation, there is probably nothing you can do (too late for RTM)<br />
<br />
The UAC plugin was mostly designed for install use, not the uninstaller (Solve the run checkbox problem on the finish page)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">23rd September 2007, 18:49</div></div><div class="posttext">Thank you for the helpful reply. I'll try your suggestion.<br />
<br />
I have found the UAC plugin very useful, thanks for creating it!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">29th March 2010, 19:17</div></div><div class="posttext">I tried to use Anders' trick, only to find that clicking 'Change' in Add/Remove Programs wouldn't launch the uninstaller at all. Instead it displayed some generic error. Together with Anders I've found the solution:<br />
<br />
You need to add a ModifyPath regstring to the HKLM uninstall key. You can probably skip the usual UninstallString, in this case. So it'd look something like:<br />
<br />
NoElevateOnModify=1<br />
NoRemove=1<br />
ModifyPath=&quot;$INSTDIR\uninstall.exe&quot;<br />
<br />
<br />
Hope this helps someone someday.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">323846</div><div class="date">30th April 2010, 10:13</div></div><div class="posttext">YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES YES <br />
<br />
<br />
Thanks! Thats it!<br />
<br />
Note: You'll need UninstallString, otherwise your program won't show up in the Add/Remove programs dialog of the control panel ...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DolphinSandwich</div><div class="date">12th November 2010, 06:07</div></div><div class="posttext">You need to add a ModifyPath regstring to the HKLM uninstall key. You can probably skip the usual UninstallString, in this case. So it'd look something like:<br />
NoElevateOnModify=1<br />
NoRemove=1<br />
ModifyPath=&quot;$INSTDIR\uninstall.exe&quot;<br />
Hope this helps someone someday.<br />
Almost, though much of the help is in some sort of imprecise pseudocode, so I have to admit, I can't really see a practical way around this.<br />
<br />
When I write the uninstaller, I don't have easy access to the uninstall key.<br />
I write something like this: WriteUninstaller $INSTDIR\Uninstaller.exe<br />
<br />
Is this suggestion, then, meant to say that we determine what the key is (with no help from any apis or existing libraries), write some code to write to that registry, taking care to set NoRemove/ModifyPath. <br />
<br />
ie are you suggesting the answer you've given, translates to something like this:<br />
WriteRegStr HKLM $0 &quot;NoElevateOnModify&quot; 1<br />
...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">12th November 2010, 06:13</div></div><div class="posttext">Is this suggestion, then, meant to say that we determine what the key is (with no help from any apis or existing libraries), write some code to write to that registry, taking care to set NoRemove/ModifyPath. <br />
<br />
ie are you suggesting the answer you've given, translates to something like this:<br />
WriteRegStr HKLM $0 &quot;NoElevateOnModify&quot; 1<br />
...<br />
<br />
No, the solution is to write those regstrings during installation, not in the uninstaller. When you add your uninstaller to the Add/Remove Programs list, you write an UninstallString, DisplayName and DisplayIcon entry to &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\YouAppName&quot;, right? That's when you also add the NoElevateOnModify and NoRemove entries.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DolphinSandwich</div><div class="date">15th November 2010, 00:47</div></div><div class="posttext">Right I see.<br />
Something like this:<br />
<br />
WriteRegStr HKLM ${ControlPanelKey} &quot;NoElevateOnModify&quot; 1    <br />
WriteRegStr HKLM ${ControlPanelKey} &quot;NoRemove&quot; 1</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>