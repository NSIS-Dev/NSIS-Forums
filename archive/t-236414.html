<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Easy one for you Pros, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Easy one for you Pros NSIS Discussion" />
	
	<title> Easy one for you Pros [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Easy one for you Pros</div>
<hr />
<div class="pda"><a href="t-236414.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=236414">Easy one for you Pros</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">dive2xs</div><div class="date">26th January 2006, 08:02</div></div><div class="posttext">Ok I have been searching but it is getting late, and I have not been able to adapt the examples and get them to work.<br />
<br />
Here is what i need.<br />
<br />
I have 2 programs that do the same thing. The Ethernet version has 1 exe file we will call &quot;A&quot;.  The serial version needs 2 exe files we will cal &quot;B&quot; &amp; &quot;C&quot;.  However &quot;B&quot; and &quot;C&quot; are both requires fr the second version they can be installed on two seperate computers.   <br />
<br />
I need to allow the following 4 options.<br />
<br />
Install &quot;A&quot; only<br />
<br />
Install &quot;B&quot; only<br />
<br />
Install &quot;C&quot; only<br />
<br />
or<br />
<br />
Install &quot;B&quot; and &quot;C&quot; only</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">26th January 2006, 15:48</div></div><div class="posttext">see Sections.nsh :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dive2xs</div><div class="date">27th January 2006, 01:11</div></div><div class="posttext">OK this is what I have and where I am stumped.<br />
<br />
<br />
;Installer Sections<br />
<br />
   Section /o &quot;Ethernet Connection&quot; Sec1<br />
   SectionEnd<br />
<br />
 SectionGroup &quot;Serial Connection&quot; Sec2<br />
<br />
   Section /o &quot;Server&quot; Sec3<br />
   SectionEnd<br />
<br />
   Section /o &quot;Client&quot; Sec4<br />
   SectionEnd<br />
<br />
 SectionGroupEnd<br />
<br />
;--------------------------------<br />
;Functions<br />
<br />
Function .onSelChange<br />
<br />
    !insertmacro StartRadioButtons $1<br />
       !insertmacro RadioButton ${Sec1}<br />
       !insertmacro RadioButton ${Sec2}<br />
       !insertmacro RadioButton ${Sec3}<br />
       !insertmacro RadioButton ${Sec4}<br />
    !insertmacro EndRadioButtons<br />
<br />
FunctionEnd<br />
<br />
<br />
So the problem is if the user selects the serial connection and then changes to select the Ethernet version, one of the serial components stay selected.<br />
<br />
So the only allowable options should be <br />
<br />
Sec1 or Sec2(Sec3+Sec4) or Sec3 or Sec4.<br />
<br />
The second problem I noticed is if you de-select one of the Serial subgroups and try to reselect it, it basically flip flops.  The only way to reselect it is to select the ethernet version and then select the serial version again.<br />
<br />
Any and all help is greatly appreciated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">27th January 2006, 14:37</div></div><div class="posttext">You shouldn't put Sec2 in the radio buttons list because it's a section group.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dive2xs</div><div class="date">27th January 2006, 17:42</div></div><div class="posttext">OK, but that does not make any change in the behavior of the buttons.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th January 2006, 10:46</div></div><div class="posttext">RadioButtons will not work here. You'll need some custom code to do it. I'll make some for you later today when I get back from January shopping :)<br />
<br />
Sorry I haven't replied to your Private Messages either. It was my 18th birthday on Friday and I tend to stay away from the computer on and around my birthdays ;)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dive2xs</div><div class="date">28th January 2006, 21:47</div></div><div class="posttext">Hey no problem. I appreciate the help, Happy 18th!  Do you get to enjoy spirits at that age in England?<br />
<br />
If so, Congrats and I would be jealous if I was 18 again!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th January 2006, 10:30</div></div><div class="posttext">Yep you can legally drink at 18 here in the UK!<br />
Try this compilable script:<br />
<br />
!include MUI.nsh<br />
!include Sections.nsh<br />
OutFile dive2xs.exe<br />
<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
!insertmacro MUI_LANGUAGE English<br />
<br />
Var T<br />
<br />
;Installer Sections<br />
<br />
   Section /o &quot;Ethernet Connection&quot; Sec1<br />
   SectionEnd<br />
<br />
 SectionGroup &quot;Serial Connection&quot; SecGrp1<br />
<br />
   Section /o &quot;Server&quot; Sec2<br />
   SectionEnd<br />
<br />
   Section /o &quot;Client&quot; Sec3<br />
   SectionEnd<br />
<br />
 SectionGroupEnd<br />
<br />
Function .onInit<br />
 StrCpy $T 0<br />
FunctionEnd<br />
<br />
Function .onSelChange<br />
Push $R0<br />
<br />
 SectionGetFlags ${Sec1} $R0<br />
 IntOp $R0 $R0 &amp; ${SF_SELECTED}<br />
 StrCmp $R0 ${SF_SELECTED} 0 NoUnselectSec1<br />
 StrCmp $T ${Sec1} NoUnselectSec1<br />
  StrCpy $T ${Sec1}<br />
  !insertmacro UnselectSection ${SecGrp1}<br />
 Goto End<br />
 NoUnselectSec1:<br />
<br />
 SectionGetFlags ${Sec2} $R0<br />
 IntOp $R0 $R0 &amp; ${SF_SELECTED}<br />
 StrCmp $R0 ${SF_SELECTED} 0 NoUnselectSec2<br />
 StrCmp $T ${Sec2} NoUnselectSec3<br />
  StrCpy $T ${Sec2}<br />
 Goto UnselectSec1<br />
 NoUnselectSec2:<br />
<br />
 SectionGetFlags ${Sec3} $R0<br />
 IntOp $R0 $R0 &amp; ${SF_SELECTED}<br />
 StrCmp $R0 ${SF_SELECTED} 0 NoUnselectSec3<br />
 StrCmp $T ${Sec3} NoUnselectSec3<br />
  StrCpy $T ${Sec3}<br />
 UnselectSec1:<br />
  !insertmacro UnselectSection ${Sec1}<br />
 NoUnselectSec3:<br />
<br />
 End:<br />
<br />
Pop $R0<br />
FunctionEnd<br />
<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dive2xs</div><div class="date">29th January 2006, 18:55</div></div><div class="posttext">Man, You rock!  Where can I make a donation?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dive2xs</div><div class="date">30th January 2006, 03:16</div></div><div class="posttext">Can I bother you for another need.  I would be happy to compensate you...<br />
<br />
I need the ability if the choose the Sec2 I need to record an option in the registry.<br />
<br />
    WriteRegStr HKLM SOFTWARE\program &quot;ComPort&quot; &quot;comx&quot;<br />
<br />
However I need them to specify which com port they are using. and then modify the &quot;comx&quot; to linke &quot;com5&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th January 2006, 08:48</div></div><div class="posttext">Uhm, that won't be necessary but if you're offering I don't mind :) Paypal: bikube at tiscali.co.uk<br />
<br />
For getting user input you can use my PassDialog plugin which has a basic dialog with a single input box. Something like this:<br />
<br />
<br />
LangString ${LANG_ENGLISH} BAD_PORT_NUM &quot;Please enter a valid port number!&quot;<br />
<br />
Page Custom GetPort GetPortLeave<br />
<br />
Function GetPort<br />
 PassDialog::Dialog inputbox /HEADINGTEXT &quot;Enter port number...&quot; /GROUPTEXT &quot;Serial number&quot;<br />
 Pop $R0 # success, back, cancel, error<br />
FunctionEnd<br />
<br />
Function GetPortLeave<br />
 Pop $R0 # User input string.<br />
<br />
 # User entered nothing!<br />
 StrCmp $R0 &quot;&quot; 0 +3<br />
  MessageBox MB_OK|MB_ICONSTOP $(BAD_PORT_NUM)<br />
  Abort<br />
<br />
 # Check that string is number only.<br />
 Push &quot;0123456789&quot;<br />
 Push $R0<br />
  Call StrCSpn<br />
 Pop $R1<br />
 StrCmp $R1 &quot;&quot; +3<br />
  MessageBox MB_OK|MB_ICONSTOP $(BAD_PORT_NUM)<br />
  Abort<br />
<br />
 # Write port number to registry.<br />
 WriteRegStr HKLM &quot;SOFTWARE\program&quot; &quot;ComPort&quot; &quot;com$R1&quot;<br />
<br />
FunctionEnd<br />
<br />
You need the StrCSpnReverse (http://nsis.sourceforge.net/StrCSpn%2C_StrCSpnReverse:_Scan_strings_for_characters#StrCSpnReverse) function for this code too.You can download my PassDialog plugin from: http://nsis.sf.net/File:PassDialog.zip<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dive2xs</div><div class="date">30th January 2006, 19:29</div></div><div class="posttext">SO how do I make it so this only works when the server (Sec2) is selected.<br />
<br />
Otherwise it looks good.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dive2xs</div><div class="date">30th January 2006, 19:37</div></div><div class="posttext">Also got this warning:<br />
 LangString &quot;BAD_PORT_NUM&quot; is not set in language table of language English</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th January 2006, 21:10</div></div><div class="posttext">Oops sorry, LangString parameters order was incorrect. Should be:<br />
LangString BAD_PORT_NUM ${LANG_ENGLISH} &quot;Please enter a valid port number!&quot;<br />
<br />
To only show the dialog if Sec2 is selected, simply jump over the plugin call:<br />
Function GetPort<br />
 SectionGetFlags ${Sec2} $R0<br />
 IntOp $R0 $R0 &amp; ${SF_SELECTED}<br />
 StrCmp $R0 ${SF_SELECTED} 0 SkipPage <br />
  PassDialog::Dialog inputbox /HEADINGTEXT &quot;Enter port number...&quot; /GROUPTEXT &quot;Serial number&quot;<br />
  Pop $R0 # success, back, cancel, error<br />
 SkipPage:<br />
FunctionEnd<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dive2xs</div><div class="date">30th January 2006, 22:19</div></div><div class="posttext">Thanks</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>