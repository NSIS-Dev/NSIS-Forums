<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" variable in dos, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  variable in dos NSIS Discussion" />
	
	<title> variable in dos [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  variable in dos</div>
<hr />
<div class="pda"><a href="t-223783.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=223783">variable in dos</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Tupsan</div><div class="date">11th August 2005, 15:48</div></div><div class="posttext">Hi,<br />
<br />
Is there any way to make a viariable of NSIS also work in a dos command line. Here is an example of my issue.<br />
<br />
____________________________________________________________<br />
<br />
ShowInstDetails show<br />
Name &quot;xxxxxxxxxx&quot;<br />
OutFile &quot;xxxxxxxxxx&quot;<br />
XPStyle on<br />
<br />
;---- Initialen wegschrijven ----<br />
!include &quot;dialogs.nsh&quot;<br />
Function .onInit<br />
<br />
	# Params:<br />
	# 1) Title: &quot;xxxxx&quot;<br />
	# 2) Caption: none<br />
	# 3) InitText: (enter owner code)<br />
	# 4) Max: 3<br />
	# 5) Button1: default<br />
	# 6) Button2: default<br />
	# 7) Return: $0<br />
${InputTextBox} &quot;xxxxx&quot; &quot;Please, enter xxx &quot; &quot;&quot; &quot;2&quot; &quot;&quot; &quot;&quot; 1<br />
<br />
FunctionEnd<br />
<br />
Section<br />
<br />
	# See if the user inputs something:<br />
	${if} $1 == &quot;${NULL}&quot;<br />
	DetailPrint &quot;Operation was canceled!&quot;<br />
	${else}<br />
	FileOpen $0 c:\temp.txt &quot;a&quot;<br />
	FileSeek $0 0 END<br />
	FileWrite $0 &quot;$1&quot;<br />
	FileClose $0<br />
	${endif}<br />
<br />
SectionEnd<br />
<br />
wath I want now is, run a command line where can use the variable $1. For example: alter.exe file.txt &quot;xxx&quot; &quot;$1&quot;<br />
This means I search in the file.txt for the word &quot;xxx&quot; and i will replace is with the value of variable &quot;$1&quot;<br />
<br />
Brgd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th August 2005, 15:57</div></div><div class="posttext">There are functions in the NSIS Wiki to replace text in a file:<br />
http://nsis.sourceforge.net/wiki/Category:Text_Files_Manipulation_Functions<br />
<br />
To run programs, use Exec, ExecWait or nsExec::Exec (which hides the window too).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Tupsan</div><div class="date">12th August 2005, 15:56</div></div><div class="posttext">Hi thx for the information but i don't get is done. Can you please explain me how to use the Replace function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th August 2005, 16:18</div></div><div class="posttext">This function has many examples:<br />
http://nsis.sourceforge.net/wiki/More_advanced_replace_text_in_file<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Tupsan</div><div class="date">16th August 2005, 16:56</div></div><div class="posttext">Hi Afro UK, still not clear for me. On the page you say I can find a few examples buth what do I need to do with the whole function AdvReplaceInFile. Do I need to copy it and make it an AdvReplaceInFile.nsh file. Please help me because I don't get it. Thx Tupsan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th August 2005, 18:50</div></div><div class="posttext">Just put the function in you script.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Tupsan</div><div class="date">18th August 2005, 10:35</div></div><div class="posttext">Hi, <br />
<br />
I've found out how it works. I have one small problem. When I compile the script i don't get errors only when I run the program I get an error. I've attachet the error. Here is my code. Can you help me.<br />
____________________________________________________________<br />
<br />
;---- Algemene Configuratie ----<br />
<br />
Name &quot;Config.nt&quot;<br />
OutFile &quot;config_nt.exe&quot;<br />
SilentInstall &quot;Normal&quot;<br />
DetailsButtonText Details<br />
<br />
;---- Algemene Configuratie ----<br />
<br />
Section<br />
<br />
       Push 40                  ;text to replace<br />
       Push 120                 ;replace with<br />
       Push $SYSDIR\Config.nt   ;file where to replace<br />
            Call AdvReplaceInFile<br />
<br />
SectionEnd<br />
<br />
;------- Replace Function -------<br />
<br />
Function AdvReplaceInFile<br />
Exch $0 ;file to replace in<br />
Exch<br />
Exch $1 ;number to replace after<br />
Exch<br />
Exch 2<br />
Exch $2 ;replace and onwards<br />
Exch 2<br />
Exch 3<br />
Exch $3 ;replace with<br />
Exch 3<br />
Exch 4<br />
Exch $4 ;to replace<br />
Exch 4<br />
Push $5 ;minus count<br />
Push $6 ;universal<br />
Push $7 ;end string<br />
Push $8 ;left string<br />
Push $9 ;right string<br />
Push $R0 ;file1<br />
Push $R1 ;file2<br />
Push $R2 ;read<br />
Push $R3 ;universal<br />
Push $R4 ;count (onwards)<br />
Push $R5 ;count (after)<br />
Push $R6 ;temp file name<br />
<br />
  GetTempFileName $R6<br />
  FileOpen $R1 $0 r ;file to search in<br />
  FileOpen $R0 $R6 w ;temp file<br />
   StrLen $R3 $4<br />
   StrCpy $R4 -1<br />
   StrCpy $R5 -1<br />
<br />
loop_read:<br />
 ClearErrors<br />
 FileRead $R1 $R2 ;read line<br />
 IfErrors exit<br />
<br />
   StrCpy $5 0<br />
   StrCpy $7 $R2<br />
<br />
loop_filter:<br />
   IntOp $5 $5 - 1<br />
   StrCpy $6 $7 $R3 $5 ;search<br />
   StrCmp $6 &quot;&quot; file_write2<br />
   StrCmp $6 $4 0 loop_filter<br />
<br />
StrCpy $8 $7 $5 ;left part<br />
IntOp $6 $5 + $R3<br />
IntCmp $6 0 is0 not0<br />
is0:<br />
StrCpy $9 &quot;&quot;<br />
Goto done<br />
not0:<br />
StrCpy $9 $7 &quot;&quot; $6 ;right part<br />
done:<br />
StrCpy $7 $8$3$9 ;re-join<br />
<br />
IntOp $R4 $R4 + 1<br />
StrCmp $2 all file_write1<br />
StrCmp $R4 $2 0 file_write2<br />
IntOp $R4 $R4 - 1<br />
<br />
IntOp $R5 $R5 + 1<br />
StrCmp $1 all file_write1<br />
StrCmp $R5 $1 0 file_write1<br />
IntOp $R5 $R5 - 1<br />
Goto file_write2<br />
<br />
file_write1:<br />
 FileWrite $R0 $7 ;write modified line<br />
Goto loop_read<br />
<br />
file_write2:<br />
 FileWrite $R0 $R2 ;write unmodified line<br />
Goto loop_read<br />
<br />
exit:<br />
  FileClose $R0<br />
  FileClose $R1<br />
<br />
   SetDetailsPrint none<br />
  Delete $0<br />
  Rename $R6 $0<br />
  Delete $R6<br />
   SetDetailsPrint both<br />
<br />
Pop $R6<br />
Pop $R5<br />
Pop $R4<br />
Pop $R3<br />
Pop $R2<br />
Pop $R1<br />
Pop $R0<br />
Pop $9<br />
Pop $8<br />
Pop $7<br />
Pop $6<br />
Pop $5<br />
Pop $4<br />
Pop $3<br />
Pop $2<br />
Pop $1<br />
Pop $0<br />
FunctionEnd<br />
____________________________________________________________</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Tupsan</div><div class="date">18th August 2005, 10:49</div></div><div class="posttext">Hi all, <br />
<br />
Just forget the last post. I find out wath the problem was. <br />
<br />
Thx anyway</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>