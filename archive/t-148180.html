<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" WriteUninstaller and BZIP2 - bad combo, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  WriteUninstaller and BZIP2 - bad combo NSIS Discussion" />
	
	<title> WriteUninstaller and BZIP2 - bad combo [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  WriteUninstaller and BZIP2 - bad combo</div>
<hr />
<div class="pda"><a href="t-148180.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=148180">WriteUninstaller and BZIP2 - bad combo</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Mad Doggie</div><div class="date">5th September 2003, 03:28</div></div><div class="posttext">I have created a number of NSIS installers in the 15-20MB range, compressed using BZIP2. The &quot;raw&quot; install data is in the 220MB range.<br />
<br />
I've found that the WriteUninstaller instruction forces the installer to extract all of the data, which takes a while to do since there's 200MB+ to write. I've used ReserveFile judiciously as early in the installer as I can, and it only seems to want to do this when the WriteUninstaller instruction is executed.<br />
<br />
I tried making the Uninstall section the 1st or 2nd section before all of the data, but no difference. Why is this?<br />
<br />
Cheers!<br />
<br />
Luke</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mad Doggie</div><div class="date">5th September 2003, 03:32</div></div><div class="posttext">One other note - it only started doing this when I ported my installer to the Modern UI.<br />
<br />
Luke</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">5th September 2003, 07:48</div></div><div class="posttext">Did you check the reserve file info in the Modern UI Readme and used these macros?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th September 2003, 11:16</div></div><div class="posttext">It happens because the uninstaller data is written after processing the script. It can't predict ahead how big the uninstaller block will be, so it can't allocate enough space in the installer block before compilation starts.<br />
<br />
Why not just put the WriteUninstaller command in the last section?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mad Doggie</div><div class="date">5th September 2003, 14:31</div></div><div class="posttext">OK, I'll make the section that writes the uninstaller the last one and we'll see what happens. FWIW, I'm using the following MUI reserve file macros:<br />
<br />
MUI_RESERVEFILE_SPECIALINI<br />
MUI_RESERVEFILE_INSTALLOPTIONS<br />
MUI_RESERVEFILE_SPECIALBITMAP<br />
<br />
I'm not sure if it's the reservefiles because I don't get an issue until the WriteInstaller command....<br />
<br />
Cheers!<br />
<br />
Luke</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th September 2003, 15:01</div></div><div class="posttext">Those only reserve files, if you'd really want to put the WriteUninstaller on top you should have reserved the uninstaller datablock. But you can't know its size ahead, so it can't be done.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mad Doggie</div><div class="date">5th September 2003, 15:39</div></div><div class="posttext">I tried putting the WriteUninstaller in the last section, but no luck either. I started a build before I left for the office, and the difference was that I didn't use the MUI for the uninstaller pages, just the installer part.<br />
<br />
I noticed that when I switched to MUI, the uninstaller block was reported to grow from ~4K to ~50K. I'm not sure why, but I don't really care too much since the UI of the uninstall doesn't concern me. I never had this pre-MUI, so maybe the uninstaller size makes a difference.<br />
<br />
Gawd, it's a royal pain compressing 220MB each time. :(<br />
<br />
Cheers!<br />
<br />
Luke</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th September 2003, 15:45</div></div><div class="posttext">Can you attach the script?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mad Doggie</div><div class="date">5th September 2003, 16:05</div></div><div class="posttext">Originally posted by kichik <br />
Can you attach the script?  <br />
<br />
Sure, when I get home around 6 ET. It's got the basic sections, with three or four includes of common functions and installer attributes.<br />
<br />
Thanks for your prompt reponse!<br />
<br />
Luke</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mad Doggie</div><div class="date">5th September 2003, 22:47</div></div><div class="posttext">Originally posted by kichik <br />
Can you attach the script?  <br />
<br />
OK - here it is.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th September 2003, 23:08</div></div><div class="posttext">What do checkComponent, checkFSSound, checkFSUIPC and checkURL do? Do they add any files?<br />
<br />
Just to clarify, you're saying that WriteUninstaller re-reads the entire installer data block, re-extracting your 200MB of files even after all of the files were extracted during installation. Is that right?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mad Doggie</div><div class="date">6th September 2003, 03:07</div></div><div class="posttext">Originally posted by kichik <br />
Just to clarify, you're saying that WriteUninstaller re-reads the entire installer data block, re-extracting your 200MB of files even after all of the files were extracted during installation. Is that right?  <br />
<br />
The Macros check for a file on disk or a registry entry, and selectively disable/enable some sections. They don't write any files. All they do are ReadRegStr, IfFileExists and GetDLLVersion.<br />
<br />
Actually, here's an interesting bit - the installer doesn't actually extract itself on load. It takes a touch longer to load than before, but it doesn't have the &quot;checking installer....&quot; little dialog box when it CRC checks itsself, and doesn't extract itself on load.<br />
<br />
I don't understand the innards of MUI, but I can say that the installer behaves differently than it did before MUI was added in areas I didn't expect. (Of course, it could just be that I'm not using b3 anymore, too.)<br />
<br />
Thanks again for your help. Do you have anyone else that's cramming 220+ MB into an installer?<br />
<br />
Cheers!<br />
<br />
Luke</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th September 2003, 09:36</div></div><div class="posttext">The checking installer window for the CRC check was broken in a certain CVS veresion. Which version (or from which date) of makensis.exe are you using?<br />
<br />
MUI adds some files to the installer. It adds InstallOptions.dll, some bitmaps, some INI files and StartMenu.dll if you're using it. If the script is not ordered right or the reserve macros are not used some of those files may be tacked to the end of the data block forcing the installer to run through the entire data block to get them which takes time. In case of whole compression (used by default with bzip2) it needs to decompress the data as it goes too which makes it even slower.<br />
<br />
If you encouter more UI or script delays because of decompression please tell us and we'll see what can be improved.<br />
<br />
As for other people with large installers, try some from this (http://forums.winamp.com/showthread.php?s=&amp;threadid=123323) thread. That issue hasn't been resolved yet, but I do have the plans ready for the next version.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>