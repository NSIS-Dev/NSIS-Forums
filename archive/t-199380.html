<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Winamp plugin installer, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Winamp plugin installer NSIS Discussion" />
	
	<title> Winamp plugin installer [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Winamp plugin installer</div>
<hr />
<div class="pda"><a href="t-199380.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=199380">Winamp plugin installer</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">awacs.mod</div><div class="date">16th November 2004, 07:54</div></div><div class="posttext">Hi everybody. <br />
I got a little problem with writing an installer for a winamp5 plugin.<br />
I used the example-code that nsis brought with it and changed all i saw and understood to get my plugin installed.<br />
<br />
As far as I see, the installer copies my &lt;vis_test.dll&gt; into the correct directory, but i'm not sure, if the entry into winamp.ini is correct.<br />
<br />
The fact is, that winamp does not discover my plugin.<br />
<br />
Could someone please check my code and tell me, what is wrong and/or tell me what i have to change to make my plugin run in winamp.<br />
<br />
Thanx in advance for all serious answers.<br />
<br />
Greetz, Awacs.<br />
<br />
I use the following nsis-code:<br />
<br />
; waplugin.nsi<br />
;<br />
; This script will generate an installer that installs a Winamp 2 plug-in.<br />
;<br />
; This installer will automatically alert the user that installation was<br />
; successful, and ask them whether or not they would like to make the <br />
; plug-in the default and run Winamp.<br />
<br />
;--------------------------------<br />
<br />
; Uncomment the next line to enable auto Winamp download<br />
; !define WINAMP_AUTOINSTALL<br />
<br />
; The name of the installer<br />
Name &quot;Test Plug-in&quot;<br />
<br />
; The file to write<br />
OutFile &quot;vis_test_installer.exe&quot;<br />
<br />
; The default installation directory<br />
InstallDir $PROGRAMFILES\Winamp<br />
<br />
; detect winamp path from uninstall string if available<br />
InstallDirRegKey HKLM \<br />
                 &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\Winamp&quot; \<br />
                 &quot;UninstallString&quot;<br />
<br />
; The text to prompt the user to enter a directory<br />
DirText &quot;Please select your Winamp path below (you will be able to proceed when Winamp is detected):&quot;<br />
# currently doesn't work - DirShow hide<br />
<br />
; automatically close the installer when done.<br />
AutoCloseWindow true<br />
<br />
; hide the &quot;show details&quot; box<br />
ShowInstDetails nevershow<br />
<br />
;--------------------------------<br />
<br />
;Pages<br />
<br />
Page directory<br />
Page instfiles<br />
<br />
;--------------------------------<br />
<br />
; The stuff to install<br />
<br />
Section &quot;&quot;<br />
<br />
!ifdef WINAMP_AUTOINSTALL<br />
  Call MakeSureIGotWinamp<br />
!endif<br />
<br />
  Call QueryWinampVisPath<br />
  SetOutPath $1<br />
<br />
  ; File to extract<br />
  File &quot;D:\BA\Studienarbeit\Projekt\Ergebnisse\vis_test.dll&quot;<br />
<br />
  ; prompt user, and if they select no, go to NoWinamp<br />
  MessageBox MB_YESNO|MB_ICONQUESTION \<br />
             &quot;The plug-in was installed. Would you like to run Winamp now with TinyVis as the default plug-in?&quot; \<br />
             IDNO NoWinamp<br />
    WriteINIStr &quot;$INSTDIR\Winamp.ini&quot; &quot;Winamp&quot; &quot;visplugin_name&quot; &quot;vis_test.dll&quot;<br />
    WriteINIStr &quot;$INSTDIR\Winamp.ini&quot; &quot;Winamp&quot; &quot;visplugin_num&quot; &quot;0&quot;<br />
    Exec '&quot;$INSTDIR\Winamp.exe&quot;'<br />
  NoWinamp:<br />
  <br />
SectionEnd<br />
<br />
;--------------------------------<br />
<br />
Function .onVerifyInstDir<br />
<br />
!ifndef WINAMP_AUTOINSTALL<br />
<br />
  ;Check for Winamp installation<br />
<br />
  IfFileExists $INSTDIR\Winamp.exe Good<br />
    Abort<br />
  Good:<br />
<br />
!endif ; WINAMP_AUTOINSTALL<br />
<br />
FunctionEnd<br />
<br />
Function QueryWinampVisPath ; sets $1 with vis path<br />
<br />
  StrCpy $1 $INSTDIR\Plugins<br />
  ; use DSPDir instead of VISDir to get DSP plugins directory<br />
  ReadINIStr $9 $INSTDIR\winamp.ini Winamp VisDir <br />
  StrCmp $9 &quot;&quot; End<br />
  IfFileExists $9 0 End<br />
    StrCpy $1 $9 ; update dir<br />
  End:<br />
  <br />
FunctionEnd<br />
<br />
!ifdef WINAMP_AUTOINSTALL<br />
<br />
Function GetWinampInstPath<br />
<br />
  Push $0<br />
  Push $1<br />
  Push $2<br />
  ReadRegStr $0 HKLM \<br />
     &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\Winamp&quot; \ <br />
     &quot;UninstallString&quot;<br />
  StrCmp $0 &quot;&quot; fin<br />
<br />
    StrCpy $1 $0 1 0 ; get firstchar<br />
    StrCmp $1 '&quot;' &quot;&quot; getparent <br />
      ; if first char is &quot;, let's remove &quot;'s first.<br />
      StrCpy $0 $0 &quot;&quot; 1<br />
      StrCpy $1 0<br />
      rqloop:<br />
        StrCpy $2 $0 1 $1<br />
        StrCmp $2 '&quot;' rqdone<br />
        StrCmp $2 &quot;&quot; rqdone<br />
        IntOp $1 $1 + 1<br />
        Goto rqloop<br />
      rqdone:<br />
      StrCpy $0 $0 $1<br />
    getparent:<br />
    ; the uninstall string goes to an EXE, let's get the directory.<br />
    StrCpy $1 -1<br />
    gploop:<br />
      StrCpy $2 $0 1 $1<br />
      StrCmp $2 &quot;&quot; gpexit<br />
      StrCmp $2 &quot;\&quot; gpexit<br />
      IntOp $1 $1 - 1<br />
      Goto gploop<br />
    gpexit:<br />
    StrCpy $0 $0 $1<br />
<br />
    StrCmp $0 &quot;&quot; fin<br />
    IfFileExists $0\winamp.exe fin<br />
      StrCpy $0 &quot;&quot;<br />
  fin:<br />
  Pop $2<br />
  Pop $1<br />
  Exch $0<br />
  <br />
FunctionEnd<br />
<br />
Function MakeSureIGotWinamp<br />
<br />
  Call GetWinampInstPath<br />
  <br />
  Pop $0<br />
  StrCmp $0 &quot;&quot; getwinamp<br />
    Return<br />
    <br />
  getwinamp:<br />
  <br />
  Call ConnectInternet ;Make an internet connection (if no connection available)<br />
  <br />
  StrCpy $2 &quot;$TEMP\Winamp Installer.exe&quot;<br />
  NSISdl::download http://download.nullsoft.com/winamp/client/winamp281_lite.exe $2<br />
  Pop $0<br />
  StrCmp $0 success success<br />
    SetDetailsView show<br />
    DetailPrint &quot;download failed: $0&quot;<br />
    Abort<br />
  success:<br />
    ExecWait '&quot;$2&quot; /S'<br />
    Delete $2<br />
    Call GetWinampInstPath<br />
    Pop $0<br />
    StrCmp $0 &quot;&quot; skip<br />
    StrCpy $INSTDIR $0<br />
  skip:<br />
  <br />
FunctionEnd<br />
<br />
Function ConnectInternet<br />
<br />
  Push $R0<br />
    <br />
    ClearErrors<br />
    Dialer::AttemptConnect<br />
    IfErrors noie3<br />
    <br />
    Pop $R0<br />
    StrCmp $R0 &quot;online&quot; connected<br />
      MessageBox MB_OK|MB_ICONSTOP &quot;Cannot connect to the internet.&quot;<br />
      Quit<br />
    <br />
    noie3:<br />
  <br />
    ; IE3 not installed<br />
    MessageBox MB_OK|MB_ICONINFORMATION &quot;Please connect to the internet now.&quot;<br />
    <br />
    connected:<br />
  <br />
  Pop $R0<br />
  <br />
FunctionEnd<br />
<br />
!endif ; WINAMP_AUTOINSTALL</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">16th November 2004, 14:53</div></div><div class="posttext">Did you close Winamp before installing plugin?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">awacs.mod</div><div class="date">16th November 2004, 23:12</div></div><div class="posttext">Sure.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>