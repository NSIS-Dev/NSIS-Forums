<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" ExecWait runs in wrong context?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  ExecWait runs in wrong context? NSIS Discussion" />
	
	<title> ExecWait runs in wrong context? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  ExecWait runs in wrong context?</div>
<hr />
<div class="pda"><a href="t-327449.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=327449">ExecWait runs in wrong context?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">blh83</div><div class="date">16th February 2011, 20:47</div></div><div class="posttext">I am attempting to rename a dll that was incorrectly placed into the System32 directory by AdvancedInstaller (&quot;Advanced&quot; is not the word I would use; there's a reason I switched to NSIS).  I have no problems with the renaming if I launch a command line manually.  If I use the Rename command in NSIS I have no success.  So I tried using either &quot;Exec&quot; &quot;ExecWait&quot; or &quot;nsExec::Exec&quot; in order to run the command 'ren'  (eg nsExec::Exec '&quot;ren&quot; file file.old').  Again nothing happens.  <br />
<br />
Therefore I ran the following<br />
<br />
ReadEnvStr $R0 COMSPEC<br />
Exec '&quot;$R0&quot; start cmd.exe'<br />
<br />
so that I could interact with the command prompt spawned by the installer.  If I search for the dll in the System32 directory, it can't find it even though in Windows Explorer it is clearly there.  Doing a directory list in the command prompt doesn't show the dll in the list.  This gives the impression that the command prompt being launched from the installer is not launching as a normal command prompt does if launched manually. <br />
<br />
For the heck of it I tried running 'setshellvarcontext' to 'current' (which is admin in my case) with no success.  Are there any ideas as to why I can't rename the dll from the installer but have no problems when launching a command prompt normally?  They should behave the same right?  Thanks in advance for any input.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">16th February 2011, 21:08</div></div><div class="posttext">Exec* runs child process in the same context as the installer.<br />
<br />
Are you on x64?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">blh83</div><div class="date">16th February 2011, 22:20</div></div><div class="posttext">Oh I see what you are saying.  Yes I am on an x64 machine.  Is there a way to get around the 32-bit 64-bit issue when launching the command or running Exec?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th February 2011, 22:44</div></div><div class="posttext">If Rename isn't working then you probably forgot to disable WOW64 file system redirection. Use DisableX64FSRedirection from x64.nsh.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">blh83</div><div class="date">16th February 2011, 23:59</div></div><div class="posttext">Thank you very much Afrow, that was what I needed.  The 32-bit 64-bit issue that Anders was eluding to is still a question for me, however, that is likely a can of worms.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">17th February 2011, 00:12</div></div><div class="posttext">There's a 32-bit version of cmd.exe too. You would have executed that instead.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>