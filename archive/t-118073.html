<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" replacing a str, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  replacing a str NSIS Discussion" />
	
	<title> replacing a str [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  replacing a str</div>
<hr />
<div class="pda"><a href="t-118073.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=118073">replacing a str</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">michiel</div><div class="date">16th December 2002, 14:44</div></div><div class="posttext">I need a script or function that searches an string on each line of an file and replaces that string to another string. And the file is not an *.ini file <br />
<br />
Can someone help me with this</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">16th December 2002, 14:56</div></div><div class="posttext">http://forums.winamp.com/showthread.php?s=&amp;threadid=109670</div></div><hr />


<div class="post"><div class="posttop"><div class="username">michiel</div><div class="date">16th December 2002, 16:03</div></div><div class="posttext">replacing $INSTDIR for ServerRoot as an string that mutiple times must be done help!!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rarefluid</div><div class="date">16th December 2002, 21:38</div></div><div class="posttext">I would do it that way :<br />
<br />
-open the file (source)<br />
-open another file (target)<br />
-while you don't find the string, copy the characters to the new file<br />
-if you encounter the string, write the string you want as a replacement to the target file, and start reading from the sourcefile after the end of the string you encountered...<br />
-do that until you have reached the end of the sourcefile...<br />
<br />
--&gt; It uses a lot of strcmp's and you should maybe come up with a good string searching or mathing routine...<br />
<br />
KIM</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">16th December 2002, 21:41</div></div><div class="posttext">A string search function has been included in the NSIS 2 documentation (Useful functions appendix).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rarefluid</div><div class="date">16th December 2002, 21:51</div></div><div class="posttext">I don't think it is very good for this purpose, but you could modify it...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">michiel</div><div class="date">17th December 2002, 09:22</div></div><div class="posttext">Originally posted by rarefluid <br />
I would do it that way :<br />
<br />
-open the file (source)<br />
-open another file (target)<br />
-while you don't find the string, copy the characters to the new file<br />
-if you encounter the string, write the string you want as a replacement to the target file, and start reading from the sourcefile after the end of the string you encountered...<br />
-do that until you have reached the end of the sourcefile...<br />
<br />
--&gt; It uses a lot of strcmp's and you should maybe come up with a good string searching or mathing routine...<br />
<br />
KIM <br />
<br />
Can you give me an example because i am just a beginner and i don't get the point with the third and the fourth thing what to do?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rarefluid</div><div class="date">17th December 2002, 17:11</div></div><div class="posttext">So here it is. More like brute force... ;-)<br />
<br />
<br />
;I didn't check if this compiles, and I guess it won't.<br />
;But you'll get the idea...<br />
;It is VERY unefficient, but I wanted to keep it easy.<br />
;it saves no variables to the stack and so on...<br />
Function read_file<br />
   FileOpen $R9 &quot;sourcefilename&quot; &quot;r&quot;<br />
   StrCpy $R8 0 ;position in sourcefile<br />
<br />
   FileOpen $R7 &quot;targetfilename&quot; &quot;w&quot;<br />
<br />
   Strcpy $R1 &quot;stringtosearchfor&quot;<br />
   StrLen $R0 $R1   ;get length of searchstring<br />
   StrCpy $R2 $R1 1 ;get first character of searchstring<br />
<br />
   Strcpy $R4 &quot;replacementstring_xyz&quot;<br />
   <br />
   goto searchloop<br />
writechar:<br />
   FileWrite $R7 $R6<br />
searchloop:<br />
   Fileread $R9 $R6 1           ;read character from file<br />
   IntOp $R8 $R8 + 1            ;increase position counter<br />
   StrCmp $R6 &quot;&quot; &quot;&quot; fileend     ;have we reached the end of the file?<br />
   StrCmp $R6 $R2 &quot;&quot; writechar  ;compare character to first character from searchstring<br />
                             ;HERE, the first character of the string has been found!<br />
   IntOp $R8 $R8 - 1            ;decrease position<br />
   FileSeek $R9 -1 CUR          ;seek back in file<br />
   FileRead $R9 $R5 $R0         ;Read string with length of search string from file<br />
   StrCmp $R5 $R1 found         ;is the string there in the file?<br />
                             ;HERE, the string has NOT been found<br />
   Intop $R8 $R8 + 1            ;increase original position +1<br />
   FileSeek $R9 $R8             ;seek original position +1 in file<br />
   goto writechar               ;and continue searching<br />
;HERE, the string has been found!<br />
found:<br />
   FileWrite $R7 $R4            ;write replacement string to file<br />
   IntOp $R8 $R8 + $R0          ;set file postition to<br />
   Intop $R8 $R8 + 1            ;1 character behind the string we've found<br />
   goto searchloop<br />
                             ;HERE, the end of the file has been reached<br />
fileend:<br />
   FileClose $R7<br />
   FileClose $R9<br />
FunctionEnd<br />
<br />
<br />
So, after this you have a new file &quot;targetfilename&quot; which contains the strings &quot;searchstring&quot; replaced by &quot;replacementstring_xyz&quot;.<br />
Hope it helps you!<br />
<br />
P.S. : If you have a file with CRLF (linebreaks), you may want to do this differently, but i guess it will still work...<br />
<br />
KIM</div></div><hr />


<div class="post"><div class="posttop"><div class="username">michiel</div><div class="date">20th December 2002, 16:29</div></div><div class="posttext">thanks It worked</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dsvedchenko</div><div class="date">9th January 2003, 10:07</div></div><div class="posttext">some rework and no register are modified<br />
<br />
#Function Replace String in File<br />
#     Push &quot;&lt;File with string to replace&gt;&quot;<br />
#     Push &quot;old string&quot;<br />
#     Push &quot;new string&quot;<br />
#     Call ReplaceInFile<br />
#<br />
#It is VERY unefficient, but I wanted to keep it easy.<br />
#it saves no variables to the stack and so on...<br />
Function ReplaceInFile<br />
  Push $R4<br />
  Push $R1<br />
  Push $R3<br />
  Exch 5<br />
  Pop  $R3<br />
  Exch 3<br />
  Pop  $R1<br />
  Exch 1<br />
  Pop  $R4<br />
  Push $R0<br />
  Push $R2<br />
  Push $R5<br />
  Push $R6<br />
  Push $R7<br />
  Push $R8<br />
  Push $R9<br />
  FileOpen $R9 $R3 &quot;r&quot;<br />
  StrCpy $R8 0 #position in sourcefile<br />
  GetTempFileName $R0<br />
  Push $R0<br />
  FileOpen $R7 $R0 &quot;w&quot;<br />
  StrLen $R0 $R1 #get length of searchstring<br />
  StrCpy $R2 $R1 1 #get first character of searchstring<br />
<br />
  goto searchloop<br />
  writechar:<br />
  FileWrite $R7 $R6<br />
  searchloop:<br />
  Fileread $R9 $R6 1 #read character from file<br />
  IntOp $R8 $R8 + 1 #increase position counter<br />
  StrCmp $R6 &quot;&quot; fileend #have we reached the end of the file?<br />
  StrCmp $R6 $R2 &quot;&quot; writechar #compare character to first character from searchstring<br />
  #HERE, the first character of the string has been found!<br />
  IntOp $R8 $R8 - 1 #decrease position<br />
  FileSeek $R9 -1 CUR #seek back in file<br />
  FileRead $R9 $R5 $R0 #Read string with length of search string from file<br />
<br />
  StrCmp $R5 $R1 found #is the string there in the file?<br />
  #HERE, the string has NOT been found<br />
  Intop $R8 $R8 + 1 #increase original position +1<br />
  FileSeek $R9 $R8 #seek original position +1 in file<br />
  goto writechar #and continue searching<br />
  #HERE, the string has been found!<br />
  found:<br />
  FileWrite $R7 $R4 #write replacement string to file<br />
  IntOp $R8 $R8 + $R0 #set file postition to<br />
  #BUG ###Intop $R8 $R8 + 1 #1 character behind the string we've found<br />
  goto searchloop<br />
  #HERE, the end of the file has been reached<br />
  fileend:<br />
  FileClose $R7<br />
  FileClose $R9<br />
  Pop $R0<br />
  CopyFiles /FILESONLY $R0 $R3<br />
  Pop $R9<br />
  Pop $R8<br />
  Pop $R7<br />
  Pop $R6<br />
  Pop $R5<br />
  Pop $R2<br />
  Pop $R0<br />
  Pop $R4<br />
  Pop $R1<br />
  Pop $R3<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>