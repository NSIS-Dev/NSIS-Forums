<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" DEP checking/enabling/disabling, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  DEP checking/enabling/disabling NSIS Discussion" />
	
	<title> DEP checking/enabling/disabling [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  DEP checking/enabling/disabling</div>
<hr />
<div class="pda"><a href="t-270520.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=270520">DEP checking/enabling/disabling</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">ocueed</div><div class="date">2nd May 2007, 20:18</div></div><div class="posttext">Can anyone help me with issue. How I can check if DEP is enable, after that to disable it during the installation or something like that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd May 2007, 19:44</div></div><div class="posttext">!define PF_NX_ENABLED 12<br />
<br />
System::Call kernel32::IsProcessorFeaturePresent(i${PF_NX_ENABLED})i.r0<br />
<br />
${If} $0 != 0<br />
  DetailPrint &quot;NX enabled&quot;<br />
${Else}<br />
  DetailPrint &quot;NX disabled&quot;<br />
${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">congtak</div><div class="date">29th October 2007, 01:24</div></div><div class="posttext">in system-&gt;Advanced-&gt;Performance-&gt;Settings -&gt; Data Execution Prevention.<br />
There are two options :<br />
- Turn on dep for essential windows programs and services only.<br />
- Turn on dep for all programs and services except those I select:<br />
<br />
How to check which one is currently selected using NSIS ?<br />
I need my installer to change this setting to the first option. (dep for essential windows.. only).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">29th October 2007, 02:11</div></div><div class="posttext">There are actually four DEP modes; AlwaysOn, AlwaysOff, OptIn, or OptOut.<br />
<br />
I think the setting might be stored in boot.ini on XP (maybe in the registry aswell) and you could probably find out with bcdedit(or whatever its called) on Vista</div></div><hr />


<div class="post"><div class="posttop"><div class="username">congtak</div><div class="date">29th October 2007, 03:08</div></div><div class="posttext">Thanks for the quick reply..<br />
I'm quite new to installer &amp; not very familiar with windows registry.<br />
Where is the boot.ini located? &amp; what's the name of the entry in the windows registry?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">29th October 2007, 03:30</div></div><div class="posttext">I don't know if there is a registry entry, that was just a guess.<br />
<br />
for boot.ini you probably have to so something like:<br />
ReadEnvStr $0 SystemDrive<br />
MessageBox mb_ok &quot;$0\boot.ini&quot;<br />
<br />
on vista, I have no idea, just call BCDEdit with nsExec probably<br />
<br />
You need to reboot to disable DEP I think, why not fix the code that has DEP issues instead?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">congtak</div><div class="date">29th October 2007, 03:41</div></div><div class="posttext">It's just that in the installer spec for the software says that DEP's setting could prevent the software from running the windows services installed. That's why i need to make sure the DEP is set to the one windows programs &amp; services only.<br />
I still have no idea which part of the software that depends on this setting :P..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Istaria</div><div class="date">10th April 2012, 23:45</div></div><div class="posttext">Just thought I'd reply with what I wrote using the latest version of the Windows XP SP3 and higher check:<br />
<br />
  !define DEP_SYSTEM_POLICY_TYPE_ALWAYSOFF 0 ; disabled<br />
  !define DEP_SYSTEM_POLICY_TYPE_ALWAYSON 1  ; always on, ignore white list<br />
  !define DEP_SYSTEM_POLICY_TYPE_OPTIN 2     ; only windows components<br />
  !define DEP_SYSTEM_POLICY_TYPE_OPTOUT 3    ; on, use white list<br />
<br />
  ; take note that XP SP3 and earlier do not have this function, and return result is &quot;error&quot;<br />
  System::Call kernel32::GetSystemDEPPolicy()i.r0<br />
  ;MessageBox MB_OK &quot;DEP is: $0&quot;<br />
<br />
  StrCmp $0 &quot;error&quot; skipDEP<br />
  IntCmp $0 ${DEP_SYSTEM_POLICY_TYPE_ALWAYSOFF} skipDEP<br />
  IntCmp $0 ${DEP_SYSTEM_POLICY_TYPE_OPTIN} skipDEP<br />
<br />
  MessageBox MB_OK &quot;DEP is currently enabled.&quot;<br />
 <br />
  skipDEP:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">11th April 2012, 02:20</div></div><div class="posttext">; take note that XP SP3 and earlier do not have this function, and return result is &quot;error&quot;<br />
 <br />
<br />
I'm guessing there is some undocumented function that can be used on XP.SP2 and 2003 (See http://www.hanselman.com/blog/TheWeeklySourceCode33MicrosoftOpenSourceInsideGoogleChrome.aspx and http://www.uninformed.org/?v=2&amp;a=4 for details about setting per process DEP on these systems)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">11th April 2012, 03:28</div></div><div class="posttext">Might work, might crash (And would only be valid on XP.SP2 and 2003.SP1+ (x86))<br />
System::Call '*2147353301(&amp;i1.r7)'<br />
DetailPrint Policy=$7</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DO_Visser</div><div class="date">12th April 2012, 06:22</div></div><div class="posttext">;Get The DataExecutionPrevention Setting.<br />
ReadRegDword $0 HKLM &quot;SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\NoExecuteState&quot; &quot;LastNoExecuteRadioButtonState&quot;<br />
<br />
;Value              Description<br />
;----------------- ------------------------------------------------------------------<br />
;0x000036BC(14012) DEP Is Enabled For Essential Windows Programs And Services Only.<br />
;0x000036BD(14013) DEP Is Enabled For All Programs And Services Except Those Seleced.<br />
;Blank             Setting Not Found, Add Program Anyway, Just To be Sure.<br />
<br />
;Check If Data Execution Prevention Is Enabled.<br />
${Select} $0<br />
    ${Case} &quot;14012&quot;<br />
        ;Do Not Alter Registry Without Systems Adminstrator Consent.<br />
        ;Enable DEP.<br />
        ;WriteRegDWord HKLM &quot;SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\NoExecuteState&quot; &quot;LastNoExecuteRadioButtonState&quot; 0x000036BD<br />
        ;Add Your .exe To The Data Execution Prevention List.<br />
        ;WriteRegStr HKLM &quot;SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Layers&quot; &quot;$EXE_DIR\$EXE_NAME&quot; &quot;DisableNXShowUI&quot;<br />
    ${Case} &quot;14013&quot;<br />
        ;Add Your .exe To The Data Execution Prevention List.<br />
        WriteRegStr HKLM &quot;SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Layers&quot; &quot;$EXE_DIR\$EXE_NAME&quot; &quot;DisableNXShowUI&quot;<br />
    ${CaseElse}<br />
        ;Add Your .exe To The Data Execution Prevention List In Case It Is Enabled Later On.<br />
        WriteRegStr HKLM &quot;SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Layers&quot; &quot;$EXE_DIR\$EXE_NAME&quot; &quot;DisableNXShowUI&quot;<br />
${EndSelect}</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>