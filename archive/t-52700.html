<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Install as a System Service, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Install as a System Service NSIS Discussion" />
	
	<title> Install as a System Service [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Install as a System Service</div>
<hr />
<div class="pda"><a href="t-52700.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=52700">Install as a System Service</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">spanky</div><div class="date">16th June 2001, 13:06</div></div><div class="posttext">I would like to add an option to install an executable as a system service.  I am quite sure this would be done through the registry but I am not sure where this is done.<br />
<br />
I would also like the option to appear only if the user is running Windows NT.  Is it possible to hide sections based on string values?  I have not been able to get this to work.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">arundel</div><div class="date">23rd June 2001, 19:20</div></div><div class="posttext">I just had a quick look at my registry and the path for the WinNT/W2K system services is:<br />
HKLM, SYSTEM\Services<br />
<br />
A good example of a W2K System Service which uses it's own executable is e.g. Telnet (TlntSvr).<br />
Have a look at the structure and you should be able to put up a new service with NSIS.<br />
<br />
For more information about Winows System Services goto:<br />
http://msdn.microsoft.com/library/<br />
and search for system services.<br />
<br />
I'm not sure what you mean by &quot;hide sections based on string values&quot;. If you mean that you would like to create a section which does not show up in the install-options just create a Section called &quot;&quot;.<br />
<br />
If you need to detect the Windows Version of a system I recommend the following address:<br />
<br />
http://www.firehose.net/free/nsis/functions.html<br />
<br />
Good luck!;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Edgewize</div><div class="date">24th June 2001, 01:01</div></div><div class="posttext">Unfortunately, section hiding/disabling is done at compile time and not runtime.  So you can't have certain sections be only for Win9x or WinNT.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">arundel</div><div class="date">24th June 2001, 02:15</div></div><div class="posttext">So you want to have s.th. like Section &quot;Install as System Service&quot; which does only appear when the user's OS is NT or W2K or whatever...<br />
<br />
Perhaps this will work:<br />
<br />
Section .onInit<br />
Call GetWindowsVersion<br />
<br />
StrCmp $0 'NT' 2 lbl_doIT ''<br />
StrCmp $0 '2000' lbl_doIT ''<br />
<br />
;The $0 Value will be assigned by the<br />
;GetWindowsVersion from <br />
;http://www.firehose.net/free/nsis/functions.html#GetWindows<br />
;Version<br />
<br />
StrCpy $1 &quot;&quot;<br />
Goto lbl_end<br />
<br />
lbl_doIT:<br />
StrCpy $1 'Install as System Service'<br />
<br />
lbl_end:<br />
<br />
SectionEnd<br />
<br />
<br />
Section $1<br />
StrCmp $1 'Install as System Service' '' lbl_skip<br />
<br />
BLABLA...<br />
<br />
lbl_skip:<br />
SectionEnd<br />
<br />
Could this work? Depends on if NSIS first collects all the Sections (then $1 will be unassigned and the section won't install even if your OS is NT/W2K) or if it does Section .oninit before that (which then should work).<br />
<br />
I'm not quite sure. Just give it a try!<br />
<br />
P.S.:<br />
Otherwise you'll just have to allow every-OS-user to select this Section (Install as System Service) for installation and before all the stuff in the section make a GetWindowsVersion detect and if the OS is not NT/W2K just skip the Section with an explanation, like MessageBox MB_OK &quot;Only Windows NT/2000 users can install a system service&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Edgewize</div><div class="date">24th June 2001, 06:28</div></div><div class="posttext">Sections are created at compile-time, unfortunately, and variables and functions are assigned at runtime.  So the only way to do it is to have the section be visible all the time, and simply have it do nothing if the target computer isn't NT.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>