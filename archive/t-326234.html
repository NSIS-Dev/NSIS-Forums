<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Global HotKey Plugin with global hook, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Global HotKey Plugin with global hook NSIS Discussion" />
	
	<title> Global HotKey Plugin with global hook [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Global HotKey Plugin with global hook</div>
<hr />
<div class="pda"><a href="t-326234.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=326234">Global HotKey Plugin with global hook</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">sanghoang04</div><div class="date">20th January 2011, 08:55</div></div><div class="posttext">I have write a hotkey plugin using global hook WH_KEYBOARD_LL. In my dll plugin I have callback KeyboardProc (normally, get Ctrl+Shift+Q), NSIS function SetHotKey (SetWindowsHookEx), and DllMain (with g_hInstance on DLL_PROCESS_ATTACH, UnHookWindowsHookEx on DLL_PROCESS_DETACH).<br />
In my script, I call SetHotKey, but seem it's not working, when i try dumpstate plugin - dumpstate::debugger right after SetHotKey call, debugger window display, at that time, I press combine keys (Ctrl+Shift+Q), wow it working. Now know it, I see somewhere in msdn say that one of these function (i don't remember) must in process message queue to hook working, so it seem my nsis plugin not get into nsis message. So anyone can have any solution for this, or can have another HotKey plugin? (I use this plugin in silent mode).<br />
<br />
<br />
<br />
Ps: I'm not English man, so my English not good.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th January 2011, 13:39</div></div><div class="posttext">Just use RegisterHotKey (http://msdn.microsoft.com/en-us/library/ms646309%28v=vs.85%29.aspx):#define HOTKEY_ID 1<br />
<br />
RegisterHotKey(NULL, HOTKEY_ID, MOD_CONTROL | MOD_ALT | MOD_SHIFT, 'K');<br />
<br />
while (!fDone)<br />
{<br />
  MSG msg;<br />
  if (PeekMessage(&amp;msg, NULL, 0, 0, PM_REMOVE) &amp;&amp; msg.message == WM_HOTKEY)<br />
  {<br />
    // do something here<br />
  }<br />
}<br />
<br />
UnregisterHotKey(NULL, HOTKEY_ID);You should only create your own message loop if extra-&gt;exec_flags-&gt;silent is set. Otherwise you can subclass the outer window (hwndParent). Also if you use your own message loop you can set fDone to TRUE yourself when the PluginCallback is called and msg == NSPIM_UNLOAD.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sanghoang04</div><div class="date">21st January 2011, 00:03</div></div><div class="posttext">Thank. I see that function, just i don't know it can set for silent mode or not. I'll try it myself.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st January 2011, 16:22</div></div><div class="posttext">if (extra-&gt;exec_flags-&gt;silent)<br />
  extra-&gt;RegisterPluginCallback(g_hInstance, PluginCallback);Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">21st January 2011, 16:25</div></div><div class="posttext">SetWindowsHookEx is not the way you normally register a hotkey, there is a specific hotkey api you should use...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st January 2011, 16:30</div></div><div class="posttext">SetWindowsHookEx is not the way you normally register a hotkey, there is a specific hotkey api you should use...RegisterHotKey is the one I use and that seems to work nicely (Windows 2000 and above).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">21st January 2011, 16:37</div></div><div class="posttext">(Windows 2000 and above).<br />
 MSDN lies, it works on win95 etc When MSDN says 2000 it often means any 32bit OS</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st January 2011, 16:41</div></div><div class="posttext">MSDN lies, it works on win95 etc When MSDN says 2000 it often means any 32bit OSAh awesome that's good to know thanks :)<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>