<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" makensis scons build failing on linux, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  makensis scons build failing on linux NSIS Discussion" />
	
	<title> makensis scons build failing on linux [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  makensis scons build failing on linux</div>
<hr />
<div class="pda"><a href="t-254343.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=254343">makensis scons build failing on linux</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">carlosc</div><div class="date">28th August 2006, 20:22</div></div><div class="posttext">Can someone please advise me how to get around the following build issue on linux:<br />
<br />
nsis-2.19-src]$ scons SKIPSTUBS=all SKIPPLUGINS=all SKIPUTILS=all SKIPMISC=all NSIS_CONFIG_CONST_DATA_PATH=no<br />
scons: Reading SConscript files ...<br />
Delete(&quot;nsis-28-Aug-2006.cvs&quot;)<br />
Delete(&quot;.instdist&quot;)<br />
Delete(&quot;.test&quot;)<br />
Using GNU tools configuration<br />
Checking for linker flag $MAP_FLAG... (cached) no<br />
Checking for linker flag -s... (cached) no<br />
Checking for linker flag $MAP_FLAG... (cached) no<br />
Checking for linker flag -s... (cached) no<br />
Checking for memcpy requirement... (cached) yes<br />
Checking for memset requirement... (cached) yes<br />
Checking for linker flag -pthread... (cached) no<br />
Checking for __BIG_ENDIAN__... (cached) yes<br />
Checking for main() in C library gdi32... (cached) no<br />
Checking for main() in C library user32... (cached) no<br />
Checking for main() in C library pthread... (cached) no<br />
Checking for main() in C library stdc++... (cached) no<br />
Checking for main() in C library iconv... (cached) no<br />
Checking for main() in C library dl... (cached) no<br />
Checking for main() in C library gdi32... (cached) no<br />
Checking for main() in C library iconv... (cached) no<br />
Checking for main() in C library user32... (cached) no<br />
Checking for main() in C++ library cppunit... (cached) no<br />
scons: done reading SConscript files.<br />
scons: Building targets ...<br />
g++ -o build/release/makensis/build.o -c -O2 -Wall -D__BIG_ENDIAN__ -D_WIN32_IE=0x0500 Source/build.cpp<br />
g++ -o build/release/makensis/lang.o -c -O2 -Wall -D__BIG_ENDIAN__ -D_WIN32_IE=0x0500 Source/lang.cpp<br />
g++ -o build/release/makensis/makenssi.o -c -O2 -Wall -D__BIG_ENDIAN__ -D_WIN32_IE=0x0500 Source/makenssi.cpp<br />
g++ -o build/release/makensis/script.o -c -O2 -Wall -D__BIG_ENDIAN__ -D_WIN32_IE=0x0500 Source/script.cpp<br />
g++ -o build/release/makensis/makensis build/release/makensis/build.o build/release/makensis/clzma.o build/release/makensis/crc32.o build/release/makensis/DialogTemplate.o build/release/makensis/dirreader.o build/release/makensis/fileform.o build/release/makensis/growbuf.o build/release/makensis/lang.o build/release/makensis/lineparse.o build/release/makensis/makenssi.o build/release/makensis/mmap.o build/release/makensis/Plugins.o build/release/makensis/ResourceEditor.o build/release/makensis/ResourceVersionInfo.o build/release/makensis/script.o build/release/makensis/ShConstants.o build/release/makensis/strlist.o build/release/makensis/tokens.o build/release/makensis/util.o build/release/makensis/writer.o build/release/makensis/bzip2/blocksort.o build/release/makensis/bzip2/bzlib.o build/release/makensis/bzip2/compress.o build/release/makensis/bzip2/huffman.o build/release/makensis/7zip/7zGuids.o build/release/makensis/7zip/Common/CRC.o build/release/makensis/7zip/7zip/Compress/LZ/LZInWindow.o build/release/makensis/7zip/7zip/Compress/LZMA/LZMAEncoder.o build/release/makensis/7zip/7zip/Common/OutBuffer.o build/release/makensis/7zip/7zip/Compress/RangeCoder/RangeCoderBit.o build/release/makensis/7zip/Common/Alloc.o build/release/makensis/zlib/deflate.o build/release/makensis/zlib/trees.o<br />
build/release/makensis/clzma.o(.text+0x67d): In function `CLZMA::End()':<br />
: undefined reference to `pthread_detach'<br />
build/release/makensis/clzma.o(.text+0x6b8): In function `CLZMA::End()':<br />
: undefined reference to `pthread_join'<br />
collect2: ld returned 1 exit status<br />
scons: *** [build/release/makensis/makensis] Error 1<br />
scons: building terminated because of errors.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th August 2006, 00:19</div></div><div class="posttext">The tests are cached, so I'll take a wild guess and say you've moved the entire directory from another machine which has pthreads in glibc to a machine that has a separate pthread library. Try building from a clean source tree.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">carlosc</div><div class="date">29th August 2006, 02:24</div></div><div class="posttext">I'm guessing (not knowing much about scons) that the reason they are cached is because I reran the scons build script.  But I got the same result when I built initially after downloading the sources.  BTW, if I add &quot;-pthread&quot; to the linker line makensis is linked successfully.  What does that say about what scons is (or is not) doing with regards to setting pthread linking correctly?<br />
<br />
Thanks<br />
Carlos</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th August 2006, 08:37</div></div><div class="posttext">It means the -pthread test failed incorrectly. Could you attach the config.log file generated for a clean build?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">carlosc</div><div class="date">29th August 2006, 13:44</div></div><div class="posttext">Attached is the confg.log file that was generated when I reran the scons build.  If this is not what you wanted please send me the exact build line you want me to run to generate the config.log you need.  <br />
<br />
Note:  to make it work I copied/pasted the g++ as follows:<br />
<br />
[nsis-2.19-src] $&gt;g++ -pthread -o build/release/makensis/makensis build/release/makensis/build.o build/release/makensis/clzma.o build/release/makensis/crc32.o build/release/makensis/DialogTemplate.o build/release/makensis/dirreader.o build/release/makensis/fileform.o build/release/makensis/growbuf.o build/release/makensis/lang.o build/release/makensis/lineparse.o build/release/makensis/makenssi.o build/release/makensis/mmap.o build/release/makensis/Plugins.o build/release/makensis/ResourceEditor.o build/release/makensis/ResourceVersionInfo.o build/release/makensis/script.o build/release/makensis/ShConstants.o build/release/makensis/strlist.o build/release/makensis/tokens.o build/release/makensis/util.o build/release/makensis/writer.o build/release/makensis/bzip2/blocksort.o build/release/makensis/bzip2/bzlib.o build/release/makensis/bzip2/compress.o build/release/makensis/bzip2/huffman.o build/release/makensis/7zip/7zGuids.o build/release/makensis/7zip/Common/CRC.o build/release/makensis/7zip/7zip/Compress/LZ/LZInWindow.o build/release/makensis/7zip/7zip/Compress/LZMA/LZMAEncoder.o build/release/makensis/7zip/7zip/Common/OutBuffer.o build/release/makensis/7zip/7zip/Compress/RangeCoder/RangeCoderBit.o build/release/makensis/7zip/Common/Alloc.o build/release/makensis/zlib/deflate.o build/release/makensis/zlib/trees.o</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th August 2006, 13:54</div></div><div class="posttext">That's the file and the command line doesn't matter in this case, but I need it after a clean build. SCons must run only once after the source tree is completely cleaned so config.log won't be overwritten. In the log you've attached, it doesn't show the results of the real configuration test because it's cached.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">carlosc</div><div class="date">29th August 2006, 14:28</div></div><div class="posttext">Can you please tell me which command I should run to generate the config.log file you need?  I've ran &quot;scons --clean&quot; but it still shows cached.  Which configuration should I delete that keeps this cache information?<br />
<br />
Thanks<br />
Carlos</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th August 2006, 14:29</div></div><div class="posttext">scons doesn't have a clean command for that, you need to clean it yourself. The easiest method is simply to delete the folder and extract the files again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">carlosc</div><div class="date">29th August 2006, 16:16</div></div><div class="posttext">Hmm, it built OK this time.  So if I'm to guess at what happened, originally when I first built the thing I didn't use any arguments in the scons command line.  I then read that I should only build makensis (not the plugins) and I then used the arguments per the doc.  Perhaps the first attempt cached some invalid options.<br />
<br />
Thanks<br />
Carlos</div></div><hr />


<div class="post"><div class="posttop"><div class="username">moenk</div><div class="date">8th November 2006, 14:46</div></div><div class="posttext">Originally posted by kichik It means the -pthread test failed incorrectly. (...) <br />
Hi there! I have a very similar problem trying to build nsis 2.21 on Solaris. scons SKIPSTUBS=all SKIPPLUGINS=all SKIPUTILS=all SKIPMISC=all NSIS_CONFIG_CONST_DATA_PATH=no <br />
ends up somewhere with: <br />
g++ -o build/release/makensis/makensis -pthread build/release/makensis/build.o (...)<br />
g++: unrecognized option `-pthread'<br />
scons: done building targets. I modified SConstruct as follows:#defenv = Environment()<br />
defenv = Environment(CXX = 'g++')<br />
defenv.Replace(CXXVERSION = '3.3.2') <br />
One more error is: Checking for linker flag -s... ld.so.1: conftest_2: fatal: libstdc++.so.5: open failed: No such file or directory<br />
Killed<br />
no<br />
Checking for linker flag -s... ld.so.1: conftest_5: fatal: libstdc++.so.5: open failed: No such file or directory<br />
Killed<br />
no<br />
<br />
And in the conf.log it reads: <br />
file /user/moe/src/nsis-2.21-src/SCons/utils.py,line 72:<br />
	Configure(confdir = .sconf_temp)<br />
scons: Configure: Checking for linker flag -pthread... <br />
.sconf_temp/conftest_8.c &lt;-<br />
  |<br />
  |			int main() {<br />
  |				return 0;<br />
  |			}<br />
  |		<br />
gcc -o .sconf_temp/conftest_8.o -c -O2 -Wall .sconf_temp/conftest_8.c<br />
.sconf_temp/conftest_8.c:5:1: warning: no newline at end of file<br />
gcc -o .sconf_temp/conftest_8 -pthread .sconf_temp/conftest_8.o<br />
gcc: unrecognized option `-pthread'<br />
scons: Configure: yes<br />
Do you have any idea what's wrong here? <br />
<br />
TIA,<br />
MOENK</div></div><hr />


<div class="post"><div class="posttop"><div class="username">moenk</div><div class="date">8th November 2006, 15:40</div></div><div class="posttext">One more thing: <br />
Do I definately need a XCompiler? <br />
I cannot imagine, that putting &quot;my&quot; new makensis into a precompiled zip for win32 will work on SAPRC? At the moment, when running ./makensis nothing happens at all :rolleyes: <br />
Sorry, but the documentation (http://nsis.sourceforge.net/Docs/AppendixG.html#G.3) is not very detailled for building on POSIX ... <br />
<br />
Again, Thanks,<br />
MOENK<br />
<br />
PS: I got rid of the &quot;-pthread&quot; - message after changing conf/gnu<br />
#conf.CheckLinkFlag('-pthread')<br />
Is that ok ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th November 2006, 19:11</div></div><div class="posttext">In your case, the -pthread actually succeeded on accident. But that's OK as it's ignored by gcc if it's not supported.<br />
<br />
The config.log part you took and the output piece do not match. You've pasted the output of the -s test and the log for the -pthread test.<br />
<br />
As the documentation says, you don't need a cross-compiler. You can just drop makensis into the precompiled zip for win32. The fact that ./makensis fails is probably because of unaligned memory access (http://sourceforge.net/tracker/index.php?func=detail&amp;aid=1470826&amp;group_id=22049&amp;atid=373085) because you're trying to run on SPARC. If the wrong files are present, it'll tell you, so that's not the problem.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>