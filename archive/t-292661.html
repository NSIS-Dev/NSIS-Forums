<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Upgrade busy dll by UnInstallLib and then InstallLib, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Upgrade busy dll by UnInstallLib and then InstallLib NSIS Discussion" />
	
	<title> Upgrade busy dll by UnInstallLib and then InstallLib [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Upgrade busy dll by UnInstallLib and then InstallLib</div>
<hr />
<div class="pda"><a href="t-292661.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=292661">Upgrade busy dll by UnInstallLib and then InstallLib</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">BuilderBob</div><div class="date">3rd June 2008, 08:59</div></div><div class="posttext">!Include Library.nsh<br />
!define LIBRARY_IGNORE_VERSION<br />
!define LIBRARY_COM<br />
<br />
OutFile &quot;.\TestUpgrade.exe&quot;<br />
<br />
Section<br />
  SetOutPath &quot;C:\Test&quot;<br />
<br />
  !insertmacro UnInstallLib REGDLL NOTSHARED REBOOT_NOTPROTECTED &quot;$OutDir\test.dll&quot;<br />
  !insertmacro InstallLib   REGDLL NOTSHARED REBOOT_NOTPROTECTED &quot;.\newTest.dll&quot; &quot;$OutDir\test.dll&quot; $TEMP<br />
SectionEnd<br />
<br />
<br />
I have an installer for an Internet Explorer toolbar, and the objective here is to make its upgrade visible on new IE tabs and windows instead of waiting for restart in case IE is open.<br />
<br />
I saw that UnInstallLib of Library.nsh moves the busy dll somewhere else, so I thought a call to InstallLib will re-register the toolbar's new dll. It's not. Instead it will register the new dll on reboot.<br />
<br />
A second run of the installer will register the new dll.<br />
<br />
- Does this have to do with the UNIQUE id of the installer-run, used by Library.nsh?<br />
- Is there a workaround?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th June 2008, 10:49</div></div><div class="posttext">If you want to avoid a reboot, you'll have to code the move-and-switch code yourself by renaming the file, installing the new one and deleting the old one.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BuilderBob</div><div class="date">18th August 2008, 12:26</div></div><div class="posttext">I came back to this problem after a while. I can rename the busy dll manually from windows explorer, but when using the Rename NSIS command it sets the error flag. I have admin permissions. OS is Vista.<br />
Anyone knows what's that difference and how to rename the busy dll with NSIS script?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BuilderBob</div><div class="date">18th August 2008, 12:55</div></div><div class="posttext">Sorry, what I'm trying is to GetTempFileName and then rename the dll to that name. When I use a hardcoded name of non-existent file it works.<br />
<br />
So now I just need to figure how to get a temp name and rename the dll to it without failure.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BuilderBob</div><div class="date">18th August 2008, 13:34</div></div><div class="posttext">My solution now is to GetTempFileName and then Delete it, and only then rename to it. Other then creating a temp folder name (I can't find anything that does that already) it's the simplest solution i can think of and it will work most of the time.<br />
In the reeeeealy rare case it won't work, everything will happen on reboot. Ok by me :).</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>