<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem with Cancel button, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem with Cancel button NSIS Discussion" />
	
	<title> Problem with Cancel button [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem with Cancel button</div>
<hr />
<div class="pda"><a href="t-246303.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=246303">Problem with Cancel button</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">blue_harvester</div><div class="date">16th May 2006, 17:28</div></div><div class="posttext">On the first page of my installer I ask the user to select the installation directory of another piece of dependent software. The installer then checks if a certain file within this directory exists. If it exists the installation will continue. If it doesn't exist an MB_OK message box will be displayed and the user can then re-enter the installation directory.<br />
<br />
Here is the code:<br />
<br />
Function MainScreen1<br />
<br />
    try_again:<br />
        !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;Main_Screen_1.ini&quot;<br />
<br />
        !insertmacro MUI_INSTALLOPTIONS_READ $var_FL_INSTALL_DIR &quot;Main_Screen_1.ini&quot; &quot;Field 4&quot; &quot;State&quot;<br />
<br />
        IfFileExists $var_FL_INSTALL_DIR\config\policy finish not_installed<br />
<br />
    not_installed:<br />
        MessageBox MB_OK|MB_ICONSTOP  &quot;The software is not installed in the specified directory.&quot; IDOK try_again<br />
    <br />
    finish:<br />
<br />
FunctionEnd<br />
<br />
<br />
However, if the user hits Cancel when the incorrect directory is currently selected the &quot;Are you sure you want to quit setup?&quot; message box appears, which is all well and good, but when Yes is clicked the &quot;The software is not installed in the specified directory.&quot; message box gets displayed!!<br />
<br />
How do I get round this? Is there a best practice way of doing this sort of thing?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">16th May 2006, 17:55</div></div><div class="posttext">you need to set up a validation custom function, you can't use the same IO function as show and leave.<br />
your code is an infinite loop, don't you see it?<br />
<br />
you may want to refer to included IO examples.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">blue_harvester</div><div class="date">16th May 2006, 19:23</div></div><div class="posttext">Originally posted by Red Wine <br />
you need to set up a validation custom function, you can't use the same IO function as show and leave.<br />
your code is an infinite loop, don't you see it?<br />
<br />
you may want to refer to included IO examples. <br />
Yeah I see the infinite loop it's just I wanted to know if there was a way around it. I'll have a look at the included IO examples like you suggest.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">16th May 2006, 19:37</div></div><div class="posttext">page custom MainScreen1_show MainScreen1_leave <br />
<br />
Function MainScreen1_show<br />
 <br />
        !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;Main_Screen_1.ini&quot;<br />
<br />
FunctionEnd <br />
Function MainScreen1_leave<br />
<br />
        !insertmacro MUI_INSTALLOPTIONS_READ $var_FL_INSTALL_DIR &quot;Main_Screen_1.ini&quot; &quot;Field 4&quot; &quot;State&quot;<br />
<br />
        IfFileExists $var_FL_INSTALL_DIR\config\policy finish not_installed<br />
<br />
    not_installed:<br />
        MessageBox MB_OK|MB_ICONSTOP  &quot;The software is not installed in the specified directory.&quot; IDOK 0<br />
    Abort<br />
    finish:<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">blue_harvester</div><div class="date">22nd May 2006, 09:36</div></div><div class="posttext">This worked a charm, thanks for your help Red Wine. Sorry only getting back to you now!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">22nd May 2006, 09:39</div></div><div class="posttext">you welcome, glad if I can help :-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">22nd May 2006, 10:24</div></div><div class="posttext">It might be a good idea to check `$var_FL_INSTALL_DIR\config\policy\*.*`. This will perform a directory check rather than a file check (policy could be a file and therefore the directory path would be invalid).<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>