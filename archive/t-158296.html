<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Last installation directory.., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Last installation directory.. NSIS Discussion" />
	
	<title> Last installation directory.. [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Last installation directory..</div>
<hr />
<div class="pda"><a href="t-158296.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=158296">Last installation directory..</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">ritesh</div><div class="date">2nd December 2003, 11:15</div></div><div class="posttext">Hello<br />
<br />
By nsis script allows my app to be installed in \program files\etc.....<br />
<br />
if a user has installed in some differnt directory and has an upgraded version of my software. how can i know where is the last installation so that by default i can show him the old directory?<br />
<br />
need to add anything in the script...<br />
<br />
Ritesh</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd December 2003, 12:11</div></div><div class="posttext">You simply write $INSTDIR to the registry and use InstallDirRegKey so the next installation will be able to read it. See Examples\example2.nsi for an example. All of the MUI examples in Examples\Modern UI example this too.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">treehousetim</div><div class="date">2nd December 2003, 19:35</div></div><div class="posttext">Here is a quick macro I use for this...<br />
it requires two entries in the .onInit and .onInstSuccess functions...<br />
<br />
<br />
!Macro InstallLocationReg Root SubKey Key Default<br />
  Push $9<br />
  ReadRegStr $9 ${Root} ${SubKey} ${Key}<br />
  StrCmp $9 &quot;&quot; 0 +3<br />
  StrCpy $INSTDIR ${Default}<br />
  Goto +2<br />
  StrCpy $INSTDIR $9<br />
  Pop $9<br />
!MacroEnd<br />
<br />
Function .onInit<br />
  !insertmacro InstallLocationReg HKCU &quot;SOFTWARE\Company\My\Software&quot; &quot;InstallDir&quot; &quot;$PROGRAMFILES\My\Software&quot;<br />
FunctionEnd<br />
<br />
Function .onInstSuccess<br />
  WriteRegStr HKCU &quot;SOFTWARE\Company\My\Software&quot; &quot;InstallDir&quot; $INSTDIR<br />
FunctionEnd<br />
<br />
<br />
<br />
You also don't need to put an InstallDir &quot;install/dir&quot; in your script anywhere.<br />
<br />
-Tim</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd December 2003, 19:58</div></div><div class="posttext">Why use that macro when you have InstallDirRegKey?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">treehousetim</div><div class="date">2nd December 2003, 20:09</div></div><div class="posttext">hmm.... i don't remember, but I'm pretty sure I had a good reason!<br />
<br />
lol<br />
<br />
:)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>