<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Issues with 32/64bit install creation!, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Issues with 32/64bit install creation! NSIS Discussion" />
	
	<title> Issues with 32/64bit install creation! [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Issues with 32/64bit install creation!</div>
<hr />
<div class="pda"><a href="t-322692.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=322692">Issues with 32/64bit install creation!</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jean_1234</div><div class="date">24th September 2010, 10:34</div></div><div class="posttext">Hi, <br />
<br />
I'm currently trying to write an install which will hopefully determine if the OS is 32bit or 64bit and install certain files into specific locations accordingly. Some of the files are driver/inf/cat files for installing a USB device, which is done by DPInst. <br />
<br />
I'm having 2 issues which I would love help with. the 1st in the following code : <br />
!include WinVer.nsh<br />
<br />
Section &quot;MainSection&quot; SEC01<br />
GetVersion::WindowsPlatformArchitecture<br />
 Pop $R0<br />
 DetailPrint &quot;Detected a $R0 bit windows architecture&quot;<br />
  !if &quot;$R0&quot; == &quot;32&quot;<br />
     InstallDir &quot;$PROGRAMFILES\Blah\Jeans Drivers&quot;<br />
 !else<br />
    InstallDir &quot;$PROGRAMFILES\Blah\Jeans Drivers 32&quot;<br />
 !endif<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
  SetOverwrite ifnewer<br />
SectionEnd<br />
<br />
but I get<br />
Error: command InstallDir not valid in Section<br />
Error in script : &quot;C:\NSISSourceFiles\driver_script.nsi&quot; on line 71 -- aborting creation process<br />
<br />
This error seems to reflect back to the InstallDir after the !else line?!? (i.e. that's the line that turns red when I double click on the error)<br />
<br />
Any suggestions??</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th September 2010, 10:59</div></div><div class="posttext">1. You're confusing !if and ${If}.<br />
2. Use !include x64.nsh and ${If} ${RunningX64} (no need for my plug-in).<br />
3. Use StrCpy $INSTDIR. InstallDir is a compile time instruction and cannot be used in functions or sections.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jean_1234</div><div class="date">24th September 2010, 11:52</div></div><div class="posttext">I had thought that alright but I got an error from that too so changed it! <br />
<br />
This is what I had initially...right up the top, before any &quot;Section&quot; heading...<br />
 <br />
${If} ${RunningX64}<br />
InstallDir &quot;$PROGRAMFILES64\Blah\Jeans Drivers&quot;<br />
${Else}<br />
InstallDir &quot;$PROGRAMFILES\Blah\Jeans Drivers&quot;<br />
${EndIf} <br />
<br />
That gives...<br />
Error in macro _RunningX64 on macroline 2<br />
Error in macto _If on macroline 9<br />
Error in script &quot;C:\NSISSourceFiles\driver_script.nsi&quot; on line 48 -- aborting creation process</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th September 2010, 12:42</div></div><div class="posttext">You're missing the actual error.<br />
<br />
Edit: You can't use LogicLib outside a function/section. It's for run time, not compile time! Use my 1-3 in my first post.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jean_1234</div><div class="date">24th September 2010, 13:02</div></div><div class="posttext">Sorry - and I'm not even blonde!! :)<br />
<br />
the error is <br />
Error: Can't add entry, no section or function is open!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jean_1234</div><div class="date">24th September 2010, 14:52</div></div><div class="posttext">Ok - I guess what I'm getting at is &quot;Is there an easy way to determine what InstallDir should be at runtime? based on whether the user is running on a 32bit or 64bit machine?&quot; <br />
<br />
Thanks! :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">24th September 2010, 15:00</div></div><div class="posttext">You can use StrCpy $instdir &quot;$programfiles\foo\bar&quot; in .onInit</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jean_1234</div><div class="date">24th September 2010, 15:03</div></div><div class="posttext">Bingo!! Thanks!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th September 2010, 19:40</div></div><div class="posttext">I already said that in my first post (minus the use of .onInit mind).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jean_1234</div><div class="date">27th September 2010, 10:38</div></div><div class="posttext">Thank you both! I have that part sorted! :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>