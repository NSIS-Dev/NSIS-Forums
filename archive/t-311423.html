<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" CreateShortCut vs. Vista SP1 and SP2, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  CreateShortCut vs. Vista SP1 and SP2 NSIS Discussion" />
	
	<title> CreateShortCut vs. Vista SP1 and SP2 [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  CreateShortCut vs. Vista SP1 and SP2</div>
<hr />
<div class="pda"><a href="t-311423.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=311423">CreateShortCut vs. Vista SP1 and SP2</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">CrushBug</div><div class="date">3rd September 2009, 00:08</div></div><div class="posttext">I wanted to post this in case it might help someone else. I was having a problem creating shortcuts under Vista SP1 and NSIS 2.45. I was going crazy and when we changed to a Vista SP2 box, the exact same code worked. Here is the code snippet<br />
<br />
<br />
SetOutPath &quot;$INSTDIR&quot;<br />
SetShellVarContext all<br />
${LogWrite} 'creating shortcut &quot;$SMPROGRAMS\$StartMenuLocation\${SAFE_PRODUCT_NAME}.lnk&quot; &quot;$ProgramLocation${PRODUCT_MAINEXE}&quot;'<br />
ClearErrors<br />
CreateShortCut &quot;$SMPROGRAMS\$StartMenuLocation\${SAFE_PRODUCT_NAME}.lnk&quot; &quot;$ProgramLocation${PRODUCT_MAINEXE}&quot;<br />
${If} ${Errors}<br />
    ${LogWrite} &quot; - error creating shortcut&quot;<br />
${EndIf}<br />
<br />
<br />
That code under SP1 gives and error, under SP2, it works. <br />
<br />
The exploded paths from the log are:<br />
<br />
Doesn't work:<br />
<br />
[Wednesday Sep 02 15:09:00 2009] creating shortcut &quot;C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Creator\Creator.lnk&quot; &quot;C:\Program Files\Creator\Creator.exe&quot;<br />
[Wednesday Sep 02 15:09:00 2009]  - error creating shortcut<br />
<br />
Works:<br />
<br />
[Wednesday Sep 02 15:48:45 2009] creating shortcut &quot;C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Creator\Creator.lnk&quot; &quot;C:\Program Files\Creator\Creator.exe&quot;<br />
<br />
Does anyone know anything more about this wierdness?<br />
<br />
In the end, I kind of need to support Vista SP1 so I am still looking for a workaround.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">3rd September 2009, 00:29</div></div><div class="posttext">First off, you are running as admin right? (RequestExecutionLevel admin)<br />
<br />
Also, the folder &quot;Creator&quot; ($StartMenuLocation) needs to exist before you create the shortcut.<br />
<br />
You could also monitor the installer with Process Monitor from MS/Sysinternals and see if/why a file operation fails</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CrushBug</div><div class="date">3rd September 2009, 00:50</div></div><div class="posttext">Originally posted by Anders <br />
First off, you are running as admin right? (RequestExecutionLevel admin) <br />
Correct.<br />
Also, the folder &quot;Creator&quot; ($StartMenuLocation) needs to exist before you create the shortcut. <br />
Correct the folder in this case was successfully created in the code line right before this.<br />
You could also monitor the installer with Process Monitor from MS/Sysinternals and see if/why a file operation fails<br />
Yeah, I will try and poke around more and see if I can narrow it down.<br />
<br />
It's really weird.<br />
<br />
edit: folder creation clarity</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">3rd September 2009, 14:40</div></div><div class="posttext">I think the CreateShortCut command fails if the shortcut already exists and it is marked Read-Only so I always change the attributes before updating the shortcut.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CrushBug</div><div class="date">3rd September 2009, 16:26</div></div><div class="posttext">Originally posted by pengyou <br />
I think the CreateShortCut command fails if the shortcut already exists and it is marked Read-Only so I always change the attributes before updating the shortcut.  <br />
I wish, but we are not talking about existing shortcuts nor anything to do with read-only.<br />
<br />
Both are QA test systems with no traces of the program on them before installation. The only discernible difference between the two systems is SP1 and SP2. Tragically, we don't have any more SP1 systems around to verify this on, but it is 100% reproducible on the systems we have.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CrushBug</div><div class="date">3rd September 2009, 18:27</div></div><div class="posttext">Added comedy value:<br />
<br />
We just updated the QA box from SP1 to SP2 and the shortcuts work. Same computer and software, just an SP change.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>