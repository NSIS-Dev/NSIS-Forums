<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Building NSIS for various compiler (VC6,VC7,VC8...), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Building NSIS for various compiler (VC6,VC7,VC8...) NSIS Discussion" />
	
	<title> Building NSIS for various compiler (VC6,VC7,VC8...) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Building NSIS for various compiler (VC6,VC7,VC8...)</div>
<hr />
<div class="pda"><a href="t-318254.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=318254">Building NSIS for various compiler (VC6,VC7,VC8...)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">9th April 2010, 01:08</div></div><div class="posttext">I am really having a hard time having SCons build NSIS source for various compilers on my machine where VC6, VC7 (VC++ Toolkit 2003), VC8 (VC++ Express 2005) are installed.<br />
If I run SCons without any changes, it compiles perfectly with VC8. Now I'd like to run it with other compilers.<br />
<br />
I tried a lot of various thing and option switches, or even tried to tweak SConstruct, but I get various type of errors, most of the time before it even starts compiling!<br />
Here are some examples of the errors I get:<br />
AttributeError: SConsEnvironment instance has no attribute 'Program':<br />
  File &quot;D:\Prog\extern\NSIS\SCons\Config\ms&quot;, line 67:<br />
    if not conf.TryLink(libcptest % 'no change', '.cpp'):<br />
  File &quot;C:\Programs\Python26\Lib\site-packages\scons-1.3.0\SCons\SConf.py&quot;, line 618:<br />
    return self.TryBuild(self.env.Program, text, extension )<br />
Checking for C library zdll... no<br />
Checking for C library z... no<br />
zlib (win32) is missing!<br />
scons: done reading SConscript files.<br />
scons: Building targets ...<br />
scons: *** [build\release\AdvSplash\AdvSplash.dll] AttributeError : 'NoneType' object has no attribute '__dict__'<br />
<br />
So my question is:<br />
How to make this work?! Was someone able to achieve that on a single machine?<br />
What is the set of environment variables needed for each compiler?<br />
I have already:<br />
MSDevDir=C:\Program Files\Microsoft Visual Studio\Common\MSDev98<br />
VCToolkitInstallDir=C:\Program Files\Microsoft Visual C++ Toolkit 2003\<br />
VS80COMNTOOLS=C:\Program Files\Microsoft Visual Studio 8\Common7\Tools\<br />
ZLIB_W32=D:\Prog\extern\zlib<br />
How to force SCons into using a specific compiler?<br />
I already tried forcing values like:<br />
defenv['MSVS_VERSION'] = &quot;6.0&quot;<br />
defenv[&quot;MSVS&quot;] = {&quot;VERSION&quot;: &quot;6.0&quot;}<br />
defenv[&quot;MSVC_VERSION&quot;] = &quot;6.0&quot;<br />
in SConstruct, without success... checking the effect with a print defenv.Dump()<br />
Is the only solution to not have compilers in the standard installation path in order for SCons not to find those compilers?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th April 2010, 12:23</div></div><div class="posttext">I used to be able to compile with VC6 and SCons 0.98 just fine, now with the need for a updated SCons (Why??) it no longer compiles without problems.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">9th April 2010, 16:14</div></div><div class="posttext">I use Python 2.6 and SCons 1.3.0 ...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th April 2010, 17:07</div></div><div class="posttext">I'm using VC6 SP5+PP and PlatformSDK2003Feb, IIRC the new scons screws up the include directory order for me so I had to override the include and lib dirs in my scons command</div></div><hr />


<div class="post"><div class="posttop"><div class="username">f0rt</div><div class="date">10th April 2010, 19:15</div></div><div class="posttext">The following patch should allow you to select a specific Microsoft compiler.<br />
See also www.scons.org/wiki/MsvsMultipleVersions<br />
<br />
<br />
Index: SConstruct<br />
===================================================================<br />
--- SConstruct	(revision 6046)<br />
+++ SConstruct	(working copy)<br />
@@ -151,6 +151,7 @@<br />
 opts.Add(('PATH', 'A colon-separated list of system paths instead of the default - TEMPORARY AND MAY DEPRECATE', None))<br />
 opts.Add(('TOOLSET', 'A comma-separated list of specific tools used for building instead of the default', None))<br />
 opts.Add(BoolVariable('MSTOOLKIT', 'Use Microsoft Visual C++ Toolkit', 'no'))<br />
+opts.Add(EnumVariable('MSVS_VERSION', 'MS Visual C++ version', os.environ.get('MSVS_VERSION'), allowed_values=('6.0', '7.0', '7.1', '8.0', '8.0Exp', '9.0', '9.0Exp', '10.0', '10.0Exp')))<br />
 opts.Add(BoolVariable('CHMDOCS', 'Build CHM documentation, requires hhc.exe', hhc))<br />
 opts.Add(PathVariable('APPEND_CPPPATH', 'Additional paths to search for include files', None))<br />
 opts.Add(PathVariable('APPEND_LIBPATH', 'Additional paths to search for libraries', None))<br />
<br />
<br />
After you applied the patch you would either set the MSVS_VERSION environment variable or provide MSVS_VERSION as option to scons.<br />
<br />
For example to select &quot;Microsoft Visual C++ 2008 Express Edition&quot;:<br />
<br />
set MSVS_VERSION=9.0Exp<br />
scons<br />
<br />
or<br />
<br />
scons MSVS_VERSION=9.0Exp<br />
<br />
<br />
scons 1.2.0 has difficulties to detect the Platform SDK installed with VC++ 2008 Express Edition. So in that case you would need to upgrade to scons 1.3.0.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">10th April 2010, 20:27</div></div><div class="posttext">f0rt, I have been telling you for weeks now, VC6 SP5+PP and PlatformSDK2003Feb is the &quot;default&quot; setup and it is currently broken, so can you please fix it, or revert to older scons? I can't remember if it was you or Wizou that made 1.x a requirement, but something broke when that change was made, either with scons itself or our build script</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">13th April 2010, 19:22</div></div><div class="posttext">If I change from scons 1.3 to 1.2, my VC6 setup builds, so I guess my problem is with scons itself. So, somebody (f0rt?) should file a bug with scons about platform sdk detection (I know they have done some changes there)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">14th April 2010, 01:26</div></div><div class="posttext">mmmh using f0rt changes, I was able to compile under VC6<br />
<br />
and then moving from scons 1.3.0 to 1.2.0, I was able to compile under MSToolkit VC2003, but no longer under VC6 !<br />
<br />
grrrr!<br />
<br />
(at least, it teaches us that if Nightly builds are made under MSToolkit 2003, they should use SCons 1.2.0)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>