<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Get File Size, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Get File Size NSIS Discussion" />
	
	<title> Get File Size [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Get File Size</div>
<hr />
<div class="pda"><a href="t-216918.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=216918">Get File Size</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">MichaelFlya</div><div class="date">24th May 2005, 16:30</div></div><div class="posttext">I need to Get the File Size of a File and Set it<br />
to the Installation &quot;Space Required:&quot; Operation.<br />
<br />
File or Files.<br />
<br />
I have an Installer that Does Copy and Renaming<br />
Operations and Currently the  Installer just shows<br />
as 0.0KB .....<br />
<br />
-MichaelFlya-</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">24th May 2005, 18:29</div></div><div class="posttext">If you need get file size: Getting File Size (http://nsis.sourceforge.net/archive/nsisweb.php?page=212&amp;instances=0,11,211)<br />
<br />
If you need get file size or directory size: GetSize (http://nsis.sourceforge.net/archive/nsisweb.php?page=597&amp;instances=0,11,211)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ilya31</div><div class="date">25th May 2005, 00:01</div></div><div class="posttext">I was using your GetSize script, I had few questions about it. <br />
<br />
I am calling GetSize function using this syntax: <br />
 <br />
Section CaclSize<br />
       ${GetSize} &quot;$EXEDIR&quot; &quot;/M=*.* /S= /G=1&quot; size sumFiles sumDirect<br />
       IfErrors 0 +2<br />
       MessageBox MB_Ok &quot;Space Error&quot;<br />
SectionEnd<br />
<br />
I am getting Invalid command: ${GetSize} error. When I call GetSize function. Why do you call this function using ${GetSize} ... syntax as opposed to Call GetSize...? <br />
<br />
How do I pass results that I get with GetSize function to Components MUI page so that Space required will not be 0.0KB but will change to the result I get with GetSize function?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">25th May 2005, 09:27</div></div><div class="posttext">1. In &quot;GetSize&quot; Archive Page is written: If function used without header then put function in script before call it<br />
<br />
2. This script is actual then you don't know the size of install data, otherwise rather manual write size in script.<br />
Name &quot;Output&quot;<br />
OutFile &quot;Output.exe&quot;<br />
InstallDir &quot;$EXEDIR&quot;<br />
<br />
!define MUI_CUSTOMFUNCTION_GUIINIT GuiInit<br />
!include &quot;MUI.nsh&quot;<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
!include &quot;FileFunc.nsh&quot;<br />
!insertmacro GetSize<br />
<br />
<br />
PageEx Directory<br />
	PageCallbacks '' DirectoryShow ''<br />
PageExEnd<br />
<br />
Page instfiles<br />
<br />
<br />
Function DirectoryShow<br />
	FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
	GetDlgItem $1 $0 1050  ;// Control ID 1023-&gt;1050 (${NSISDIR}\Contrib\UIs\modern.exe)<br />
	SendMessage $1 ${WM_SETTEXT} 1 &quot;STR:Space required: $R0Mb&quot;<br />
FunctionEnd<br />
<br />
Function GuiInit<br />
	Banner::show /NOUNLOAD /set 76 &quot;Analizing install data&quot; &quot;Please wait...&quot;<br />
	${GetSize} &quot;$EXEDIR&quot; &quot;/S=0M&quot; $R0 $R1 $R2<br />
	Banner::destroy<br />
	ShowWindow $HWNDPARENT 2<br />
FunctionEnd<br />
<br />
Section<br />
SectionEnd<br />
Script use header (http://forums.winamp.com/attachment.php?s=&amp;postid=1680197)<br />
<br />
<br />
Attachment - modern.exe with changed control ID 1023-&gt;1050:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th May 2005, 11:22</div></div><div class="posttext">In other words, GetSize is a !define which turns ${GetSize} into !insertmacro GetSize which inturn calls the GetSize Function.<br />
<br />
If you don't have !define GetSize before you use ${GetSize} you get the compile error which you described.<br />
<br />
We use commands like ${GetSize} because it converts function calls into a single line of code which doesn't need !insertmacro either (just looks neater).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MichaelFlya</div><div class="date">25th May 2005, 12:30</div></div><div class="posttext">I Got &quot;Get one File Size&quot; to Work, but With no<br />
Luck on Setting it to the Space Requirement,<br />
Well At least Correctly Anyway. Here is some<br />
of what I was thinking, but still no Luck.<br />
<br />
<br />
Name &quot;Output&quot;<br />
OutFile &quot;Output.exe&quot;<br />
InstallDir &quot;$EXEDIR&quot;<br />
<br />
!define MUI_CUSTOMFUNCTION_GUIINIT GuiInit<br />
!include &quot;MUI.nsh&quot;<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
Page directory<br />
Page instfiles<br />
<br />
Function GuiInit<br />
  Push &quot;$EXEDIR\modern.exe&quot;<br />
  Call FileSizeNew<br />
  Pop $0<br />
 MessageBox MB_OK &quot;$0&quot;<br />
!define Sizetext &quot;File size: $0 bytes.&quot;<br />
FunctionEnd<br />
<br />
SpaceTexts &quot;${Sizetext}&quot;<br />
<br />
Section<br />
;Set Permanently (Not What I want)<br />
AddSize 7<br />
<br />
;But Instead use This If It Were Possible<br />
;AddSize $0<br />
;or<br />
;AddSize ${Sizetext}<br />
SectionEnd<br />
<br />
Function FileSizeNew<br />
  Exch $0<br />
  Push $1<br />
  FileOpen $1 $0 &quot;r&quot;<br />
  FileSeek $1 0 END $0<br />
  FileClose $1<br />
  Pop $1<br />
  Exch $0<br />
FunctionEnd<br />
<br />
<br />
I Wish it were Simple Enough to just use Addsize.<br />
<br />
-MichaelFlya-</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th May 2005, 13:58</div></div><div class="posttext">AddSize is a compile-time instruction. Use SectionSetSize and SectionGetSize for run-time.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MichaelFlya</div><div class="date">25th May 2005, 15:19</div></div><div class="posttext">How Would I use SectionSetSize and<br />
SectionGetSize Properly in my Script<br />
that I have posted?<br />
<br />
-MichaelFlya-</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th May 2005, 15:26</div></div><div class="posttext">Change Section to Section &quot;&quot; mySection<br />
Then SectionSetSize ${mySection} &quot;size_in_kb&quot;<br />
Or you could just use 0 instead of ${mySection} (0 is the Section's index.)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MichaelFlya</div><div class="date">26th May 2005, 15:18</div></div><div class="posttext">Great, I finally got it to pass the results to the<br />
Space Required: Field. However It is in Bytes<br />
not KB. The below is the working Script. How<br />
do I get it to be in KB not Bytes?<br />
<br />
<br />
Name &quot;Output&quot;<br />
OutFile &quot;Output.exe&quot;<br />
InstallDir &quot;$EXEDIR&quot;<br />
<br />
!define MUI_CUSTOMFUNCTION_GUIINIT GuiInit<br />
!include &quot;MUI.nsh&quot;<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
Page directory<br />
Page instfiles<br />
<br />
Section &quot;&quot; mySection<br />
SectionEnd<br />
<br />
Function GuiInit<br />
  Push &quot;$EXEDIR\AnotherProgram.exe&quot;<br />
  Call FileSizeNew<br />
  Pop $0<br />
SectionSetSize ${mySection} &quot;$0&quot;<br />
FunctionEnd<br />
<br />
Function FileSizeNew<br />
  Exch $0<br />
  Push $1<br />
  FileOpen $1 $0 &quot;r&quot;<br />
  FileSeek $1 0 END $0<br />
  FileClose $1<br />
  Pop $1<br />
  Exch $0<br />
FunctionEnd<br />
<br />
<br />
-MichaelFlya-</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th May 2005, 19:58</div></div><div class="posttext">Divide it by 1024...<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MichaelFlya</div><div class="date">27th May 2005, 14:31</div></div><div class="posttext">Thanks Afrow Uk. That Helped !!!!<br />
<br />
<br />
  Pop $0<br />
  IntOp $0 $0 / 1024<br />
SectionSetSize ${mySection} &quot;$0&quot;<br />
<br />
<br />
Altho It's Showing about 1 Number off most<br />
of the time on the Last Digit...Comparing<br />
with Windows.... But Close Enough.. Thanks.<br />
<br />
-MichaelFlya-</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th May 2005, 15:37</div></div><div class="posttext">I'm guessing that would be because IntOp will always round to the nearest whole number whereas in Windows it will always round up for file sizes.<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>