<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" addtopath function doesnt add all_users, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  addtopath function doesnt add all_users NSIS Discussion" />
	
	<title> addtopath function doesnt add all_users [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  addtopath function doesnt add all_users</div>
<hr />
<div class="pda"><a href="t-257963.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=257963">addtopath function doesnt add all_users</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">20th October 2006, 17:10</div></div><div class="posttext">I made a booboo on my last installer than overwrote the allusers path so i need to make a patch for my future installer.  so i only want to add it to the path if it isn't in there, that way it wont add multiple strings of it.<br />
<br />
i want to add it to: HKEY_LOCAL_MACHINE &quot;SYSTEM\CurrentControlSet\Control\Session Manager\Environment&quot; &quot;Path&quot;<br />
<br />
in the beginning of the code i do this:<br />
<br />
!define ALL_USERS<br />
<br />
!include &quot;WinMessages.NSH&quot;<br />
!include &quot;AddToPath.nsh&quot;<br />
<br />
<br />
later on i do this:<br />
<br />
  Push &quot;%SystemRoot%\System32\WBEM&quot;<br />
  Call AddToPath<br />
<br />
it doesn't add it into the environment variables.<br />
<br />
what am i doing wrong?<br />
would this check automatically if it isnt in the path already or do i need to use StrStr to search?<br />
<br />
thanks<br />
<br />
also when the program gets uninstalled i still want to keep the path change present as i overwrote a system path that is required by winders.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th October 2006, 17:21</div></div><div class="posttext">AddToPath checks if the path exists at all and if it already exists in the user's PATH variable. If the folder doesn't exist, or already present in PATH, it won't do anything.<br />
<br />
Nothing will be done in the uninstaller unless you call un.RemoveFromPath.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">20th October 2006, 17:27</div></div><div class="posttext">okay...but i dont have &quot;%SystemRoot%\System32\WBEM&quot; in my path and it isnt being added.<br />
<br />
i do have other entries in the path just not that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th October 2006, 17:37</div></div><div class="posttext">%SystemRoot%\System32\WBEM is not a valid path, so it doesn't exist as far as AddToPath is concerned. You should use $SYSDIR or ExpandEnvStrings.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">20th October 2006, 17:48</div></div><div class="posttext">Oh Ho!!!   Todah Rabah!!!!!!<br />
<br />
But, i just re-ran the installer and now that string was added a second time so now i have two C:\windows\system32\wbem listed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">20th October 2006, 20:06</div></div><div class="posttext">any idea?  i am unsure how to use StrStr to check if it is there already though.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">20th October 2006, 20:40</div></div><div class="posttext">well i got around it doing it like this and it seems to work.<br />
<br />
ReadRegStr $1 HKLM \<br />
  &quot;SYSTEM\CurrentControlSet\Control\Session Manager\Environment&quot; Path<br />
  Push $1<br />
  Push &quot;wbem&quot;<br />
  Call StrStr<br />
  Pop $R0<br />
<br />
  StrCmp $R0 &quot;&quot; true false<br />
  <br />
  true:<br />
  ; the item isnt here so add it now<br />
  Push &quot;$sysdir\wbem&quot;<br />
  Call AddToPath<br />
  Goto End<br />
  <br />
  false:<br />
  ;nothing to do today, hurray!<br />
  Goto End</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>