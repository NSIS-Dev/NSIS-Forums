<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Delete and/or RMDir, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Delete and/or RMDir NSIS Discussion" />
	
	<title> Delete and/or RMDir [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Delete and/or RMDir</div>
<hr />
<div class="pda"><a href="t-174639.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=174639">Delete and/or RMDir</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">YooperNC</div><div class="date">29th March 2004, 22:44</div></div><div class="posttext">I'm using the latest full release of NSIS, 2.0.  My installer creates a directory that isn't in or near the $INSTDIR.  When I go to Delete files from that directory or when I try to RMDir that directory, nothing happens.  No ErrorFlags are set.  I have tried just about everything.  I even went so far as to store the created directory in the registry and read it back out during Uninstall.  I posted a MessageBox to myself, verifying that the string is correct.<br />
<br />
Has anyone else seen this?  Is it a known problem?  Or is it &quot;Operator Error&quot;.  There's not much to see in my script, but if you want some pieces cut out of my installer, let me know, and I'll be happy to post them here.<br />
<br />
Any and all help would be greatly appreciated.  Thanks!<br />
<br />
Dave</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">30th March 2004, 03:19</div></div><div class="posttext">RMDir - 2 possibilities:Without /r [as a parameter], the directory will only be removed if it is completely empty.If /REBOOTOK is specified [as a paramenter], and the directory cannot be overwritten, then the directory will be deleted when the system reboots... [so] the reboot flag will be set [but not the error flag].<br />
<br />
Delete - 2 possibilities:The error flag is not set from trying to delete a file that does not exist.If /REBOOTOK is specified and the file cannot be deleted then the file is deleted when the system reboots... [so] the reboot flag will be set.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pol</div><div class="date">30th March 2004, 10:37</div></div><div class="posttext">Hello,<br />
<br />
I have made a simple perl sript to list all files of your project with RMDir and Delete instructions.<br />
<br />
This is very usefull if your project have a lot of files (more than 2000 in my case) and if you want to make a clean and complete uninstall.<br />
<br />
The result is saved in a separate file. You will need to add <br />
!include &quot;uninstall.nsh&quot;<br />
in your uninstall secion<br />
<br />
The uninstall.nsh will look like this:<br />
<br />
Delete &quot;$INSTDIR\webdav\tomcat.gif&quot;<br />
Delete &quot;$INSTDIR\webdav\tomcat-power.gif&quot;<br />
Delete &quot;$INSTDIR\webdav\index.html&quot;<br />
Delete &quot;$INSTDIR\webdav\WEB-INF\web.xml&quot;<br />
RMDir &quot;$INSTDIR\webdav\WEB-INF&quot;<br />
RMDir &quot;$INSTDIR\webdav&quot;<br />
Delete &quot;$INSTDIR\tomcat-docs\index.html&quot;<br />
RMDir &quot;$INSTDIR\tomcat-docs&quot;<br />
...<br />
<br />
Philippe</div></div><hr />


<div class="post"><div class="posttop"><div class="username">YooperNC</div><div class="date">30th March 2004, 14:04</div></div><div class="posttext">Nowhere in the documentation do I see a &quot;/REBOOTOK&quot; for RMDir.  Also, I have tried all combinations of &quot;RMDir /r ...&quot;, &quot;Delete /REBOOTOK ...&quot;, etc., and nothing has worked.  Even after rebooting the OS, the files are still there.  I get the subdirectory from the registry just fine with:<br />
<br />
  ReadRegStr $R6 HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${MUI_PRODUCT_NAME}&quot; \<br />
	&quot;UninstallVideoLoc&quot;<br />
<br />
I've tried:<br />
<br />
   Delete &quot;$R6\*.*&quot;<br />
   Delete /REBOOTOK &quot;$R6\*.mpg&quot; ; still there after reboot<br />
   RMDir /r &quot;$R6&quot;<br />
   RMDir /r $R6  ; thinking the quotes were causing a problem<br />
<br />
I am able to remove other directories, namely $INSTDIR, but this one is being stubborn.  My collegues and I are stumped.  Has anyone else had luck removing files that are not in the $INSTDIR (for example)?  If so, can you share some insight?  Thanks!<br />
<br />
Dave</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">30th March 2004, 14:28</div></div><div class="posttext">Hmmm... nowhere... What NSIS version are you using?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">30th March 2004, 15:54</div></div><div class="posttext">YooperNC wrote:<br />
<br />
&gt;&gt;I'm using the latest full release of NSIS, 2.0.&lt;&lt;<br />
&gt;&gt;Nowhere in the documentation do I see a &quot;/REBOOTOK&quot; for RMDir.&lt;&lt;<br />
<br />
From the NSIS 2.0 manual:<br />
<br />
4.9.1.8 RMDir<br />
[/r|/REBOOTOK] directory_name<br />
Remove the specified directory (which should be a full path). Without /r, the directory will only be removed if it is completely empty. If /r is specified, the directory will be removed recursively, so all directories and files in the specified directory will be removed. If /REBOOTOK is specified, and the directory cannot be overwritten, then the directory will be deleted when the system reboots -- if the directory will be removed on a reboot, the reboot flag will be set. The error flag is set if the directory cannot be removed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">YooperNC</div><div class="date">30th March 2004, 20:27</div></div><div class="posttext">Ok. Now I see that /REBOOKOK was added to RMDir. Thanks for the clarification.<br />
<br />
But that still doesn't help me out. Like I said, I've tried all manner of combinations and permutations of the parameters, and nothing gets rid of these files. At one point, I noticed that the files contained within this directory were &quot;Read-Only&quot;. However, removing this attribute made no difference.<br />
<br />
Could it be a problem that I'm running on Windows XP? (I could blame Bill Gates, then)<br />
<br />
I could always just tell the user to delete the files after Uninstallation is complete, but I'd rather not.<br />
<br />
Thanks to all for your time.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">30th March 2004, 20:34</div></div><div class="posttext">It should work fine. Please post relevant script code and details.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">YooperNC</div><div class="date">31st March 2004, 21:34</div></div><div class="posttext">Here's the script that I'm executing:<br />
<br />
ReadRegStr $R6 HKLM \<br />
&quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${MUI_PRODUCT_NAME}&quot; \<br />
&quot;UninstallVideoLoc&quot;<br />
RMDir /r $R6<br />
Sleep &quot;200&quot;<br />
<br />
I've placed a MessageBox between the ReadRegStr and the RMDir, so I know that $R6 has exactly what I expect in it. I have also tried this:<br />
<br />
ReadRegStr $R6 HKLM \<br />
&quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${MUI_PRODUCT_NAME}&quot; \<br />
&quot;UninstallVideoLoc&quot;<br />
Delete /REBOOTOK &quot;$R6\*.*&quot;<br />
Sleep &quot;200&quot;<br />
<br />
Each time, the files are still there.  $R6 is:<br />
<br />
C:\Video Files\test<br />
<br />
This subdirectory contains the following files:<br />
<br />
b281_20021230_162454.mpg<br />
b281_20030103_124700.mpg<br />
b281_20030109_142723.mpg<br />
b281_20030225_095223.mpg<br />
b281_20030226_102234.mpg<br />
c122_20021222_090342.mpg<br />
c353_20030305_161208.mpg<br />
c353_20030309_000920.mpg<br />
c353_20030309_004436.mpg<br />
<br />
There's nothing wrong with this directory string that I can tell. And the files are nothing more than random video files varying in size from 19KB to 102KB. They are not read-only, so no use asking that question.<br />
<br />
I've also placed &quot;ClearErrors&quot; and &quot;IfErrors&quot; around the RMDir and Delete commands, but no errors are set. It just goes along thinking that it did its job.<br />
<br />
We're all stumped here. This problem defies logic and reason. If you have some time and like solving tough problems, feel free to create a subdirectory like the one above, fill it with some files, and put those script lines in your Uninstall section. I'd be very interested to hear your results. Thanks!<br />
<br />
Dave</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">31st March 2004, 21:58</div></div><div class="posttext">The files are either in use or you have a wrong directory name.<br />
<br />
Try to add it manually (without the registry key) and make sure the directory is valid.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd April 2004, 05:17</div></div><div class="posttext">That registry key probably contains a line break, quotes or a space. UseMessageBox MB_OK *$R6*and make sure nothing is between the unquoted path and the asterisks.<br />
<br />
A similar case is presend in the FAQ:<br />
http://nsis.sourceforge.net/support/faq_item/?id=19&amp;backPID=15&amp;tx_faq_faq=20</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>