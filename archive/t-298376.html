<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem with a path and a var, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem with a path and a var NSIS Discussion" />
	
	<title> Problem with a path and a var [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem with a path and a var</div>
<hr />
<div class="pda"><a href="t-298376.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=298376">Problem with a path and a var</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">DJScorpion</div><div class="date">7th October 2008, 11:11</div></div><div class="posttext">Hi community!<br />
<br />
i want to make an installer for every plugin / addin which we release.<br />
<br />
When the installer runs it should get the content of the following registry path:<br />
HKLM SOFTWARE\MESAP\Mesap4\Directories &quot;UIMdb&quot;<br />
<br />
And of course... it works.. when i test it i get the directory of the software (f.e. C:\Program Files\Mesap4\).<br />
<br />
So now the problem is, that i have to put files in to these folder.<br />
The following problem:<br />
<br />
	ReadRegStr $MesapDir HKLM SOFTWARE\MESAP\Mesap4\Directories &quot;UIMdb&quot;  ...to get the path into $MesapDir<br />
<br />
	StrCpy $UninstallExe &quot;$MesapDirUninstall - $AddInName.exe&quot;  ...to create the uninstaller.<br />
<br />
	RegDLL &quot;$MesapDir$DllFile.dll&quot;  ...to register the copied dll-files.<br />
<br />
But of course all these phrases doesn't work!<br />
What do i have to do to make it work? $MesapDir\*rest* doesn't work because there are two backslashes... :-(<br />
<br />
can anyone help please?<br />
greetz, scorpion<br />
<br />
PS: german is also ok (or much better!)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">7th October 2008, 19:42</div></div><div class="posttext">I started thinking it was the $MespaDir variable, but then realized you never said what $DllFile.dll was set to.  I'll bet you have it starting with a backslash.  Fix that and it should fix your issue.  (or remove the trailing backslash from $MespaDir).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DJScorpion</div><div class="date">8th October 2008, 08:44</div></div><div class="posttext">$DllFile is not the only thing which needs the $MesapDir variable.<br />
Its also needed for the startmenu shortcut etc.<br />
<br />
But how can i remove the \ of the path inside of $MesapDir?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">8th October 2008, 15:20</div></div><div class="posttext">here's one way:<br />
!include logiclib<br />
!include WordFunc.nsh<br />
!insertmacro WordReplace<br />
...<br />
<br />
ReadRegStr $MesapDir HKLM SOFTWARE\MESAP\Mesap4\Directories &quot;UIMdb&quot; <br />
${WordReplace} &quot;$MesapDir&quot; &quot;\&quot; &quot;&quot; &quot;-1&quot; $MesapDir</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DJScorpion</div><div class="date">8th October 2008, 17:01</div></div><div class="posttext">I guess you mean this:<br />
<br />
!include logiclib.nsh<br />
<br />
But when i try to compile the script i get the following log:<br />
<br />
<br />
MakeNSIS v2.39 - Copyright 1995-2008 Contributors<br />
See the file COPYING for license details.<br />
Credits can be found in the Users Manual.<br />
<br />
Processing config: <br />
Processing plugin dlls: &quot;C:\Program Files\NSIS\Plugins\*.dll&quot;<br />
 - AdvSplash::show<br />
 - Banner::destroy<br />
 - Banner::getWindow<br />
 - Banner::show<br />
 - BgImage::AddImage<br />
 - BgImage::AddText<br />
 - BgImage::Clear<br />
 - BgImage::Destroy<br />
 - BgImage::Redraw<br />
 - BgImage::SetBg<br />
 - BgImage::SetReturn<br />
 - BgImage::Sound<br />
 - Dialer::AttemptConnect<br />
 - Dialer::AutodialHangup<br />
 - Dialer::AutodialOnline<br />
 - Dialer::AutodialUnattended<br />
 - Dialer::GetConnectedState<br />
 - InstallOptions::dialog<br />
 - InstallOptions::initDialog<br />
 - InstallOptions::show<br />
 - LangDLL::LangDialog<br />
 - Math::Script<br />
 - NSISdl::download<br />
 - NSISdl::download_quiet<br />
 - Splash::show<br />
 - StartMenu::Init<br />
 - StartMenu::Select<br />
 - StartMenu::Show<br />
 - System::Alloc<br />
 - System::Call<br />
 - System::Copy<br />
 - System::Free<br />
 - System::Get<br />
 - System::Int64Op<br />
 - System::Store<br />
 - TypeLib::GetLibVersion<br />
 - TypeLib::Register<br />
 - TypeLib::UnRegister<br />
 - UserInfo::GetAccountType<br />
 - UserInfo::GetName<br />
 - UserInfo::GetOriginalAccountType<br />
 - VPatch::GetFileCRC32<br />
 - VPatch::GetFileMD5<br />
 - VPatch::vpatchfile<br />
 - nsDialogs::Create<br />
 - nsDialogs::CreateControl<br />
 - nsDialogs::CreateItem<br />
 - nsDialogs::GetUserData<br />
 - nsDialogs::OnBack<br />
 - nsDialogs::OnChange<br />
 - nsDialogs::OnClick<br />
 - nsDialogs::OnNotify<br />
 - nsDialogs::SelectFileDialog<br />
 - nsDialogs::SelectFolderDialog<br />
 - nsDialogs::SetRTL<br />
 - nsDialogs::SetUserData<br />
 - nsDialogs::Show<br />
 - nsExec::Exec<br />
 - nsExec::ExecToLog<br />
 - nsExec::ExecToStack<br />
<br />
!define: &quot;MUI_INSERT_NSISCONF&quot;=&quot;&quot;<br />
<br />
Changing directory to: &quot;P:\Mesap Setup TEST\NSIS\AddIn-Setups\TempFiles&quot;<br />
<br />
Processing script file: &quot;P:\Mesap Setup TEST\NSIS\AddIn-Setups\TempFiles\MPD ControlPanel.nsi&quot;<br />
SetCompress: force<br />
SetCompressor: /SOLID lzma<br />
Name: &quot;Mesap 4 AddIn Installation&quot;<br />
OutFile: &quot;MPD ControlPanel.exe&quot;<br />
XPStyle: on<br />
!include: &quot;C:\Program Files\NSIS\Include\LogicLib.nsh&quot;<br />
!include: closed: &quot;C:\Program Files\NSIS\Include\LogicLib.nsh&quot;<br />
!include: &quot;C:\Program Files\NSIS\Include\WordFunc.nsh&quot;<br />
!define: &quot;WORDFUNC_INCLUDED&quot;=&quot;&quot;<br />
!include: closed: &quot;C:\Program Files\NSIS\Include\WordFunc.nsh&quot;<br />
!insertmacro: WordReplace<br />
!insertmacro: end of WordReplace<br />
Page: instfiles<br />
UninstPage: uninstConfirm<br />
UninstPage: instfiles<br />
VIAddVersionKey: &quot;ProductName&quot; &quot;M4AddIn011&quot;<br />
VIAddVersionKey: &quot;Comments&quot; &quot;Setup fÃ¼r MPD ControlPanel&quot;<br />
VIAddVersionKey: &quot;CompanyName&quot; &quot;Seven2one GmbH&quot;<br />
VIAddVersionKey: &quot;LegalCopyright&quot; &quot;Seven2one GmbH&quot;<br />
VIAddVersionKey: &quot;FileDescription&quot; &quot;MPD ControlPanel&quot;<br />
Var: &quot;AddInName&quot;<br />
Var: &quot;DllFile&quot;<br />
Var: &quot;MesapDir&quot;<br />
Var: &quot;UninstallExe&quot;<br />
Function: &quot;.onInit&quot;<br />
ReadRegStr $MesapDir HKLM\SOFTWARE\MESAP\Mesap4\Directories\UIMdb<br />
!insertmacro: WordReplaceCall<br />
!insertmacro: end of WordReplaceCall<br />
StrCpy $AddInName &quot;MPD ControlPanel&quot; () ()<br />
StrCpy $DllFile &quot;M4AddIn011&quot; () ()<br />
StrCpy $UninstallExe &quot;$MesapDir\Uninstall - $AddInName.exe&quot; () ()<br />
FunctionEnd<br />
Function: &quot;un.onInit&quot;<br />
ReadRegStr $MesapDir HKLM\SOFTWARE\MESAP\Mesap4\Directories\UIMdb<br />
!insertmacro: WordReplaceCall<br />
Call must be used with function names starting with &quot;un.&quot; in the uninstall section.<br />
Usage: Call function_name | [:label_name]<br />
Error in macro WordReplaceCall on macroline 7<br />
Error in script &quot;P:\Mesap Setup TEST\NSIS\AddIn-Setups\TempFiles\MPD ControlPanel.nsi&quot; on line 39 -- aborting creation process</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">9th October 2008, 00:29</div></div><div class="posttext">yes, I did mean LogicLib.nsh.  (my bad)<br />
<br />
And the error is that you are trying to use this in the uninstall section.  (When I read your original post, I thought you were in the install section.  But your error log shows you are in the uninstall function un.onInit)<br />
<br />
To use WordReplace in an uninstaller place a &quot;un.&quot; in front. <br />
<br />
So &quot;!insertmacro WordReplace&quot; becomes &quot;!insertmacro un.WordReplace&quot;<br />
and<br />
&quot;${WordReplace}&quot; becomes &quot;${un.WordReplace}&quot;.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>