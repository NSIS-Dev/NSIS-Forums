<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" MUI Invalid Languge File English, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  MUI Invalid Languge File English NSIS Discussion" />
	
	<title> MUI Invalid Languge File English [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  MUI Invalid Languge File English</div>
<hr />
<div class="pda"><a href="t-330545.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=330545">MUI Invalid Languge File English</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">texaspapa</div><div class="date">12th May 2011, 00:15</div></div><div class="posttext">I am trying to get a test installer to work and get an error telling me that the language file is invalid.   See below for details.   <br />
<br />
<br />
I get this error if I include either of these lines in the test program:<br />
<br />
<br />
  1) LoadLanguageFile &quot;${NSISDIR}\Contrib\Language files\English.nlf&quot;<br />
<br />
   2) !insertmacro MUI_LANGUAGE English<br />
<br />
Code is including mui2.nsh.<br />
<br />
I do not get this when I remove the line.  This occurs with the build from Jan 26, 2011 available on the developers page.  Does anyone know if there are issues with the language files?  Has something changed related to language file formats since NSIS 2.46?<br />
<br />
Test program works with the released version 2.46.<br />
<br />
<br />
Compile output:<br />
<br />
Exch($3,0)<br />
FunctionEnd<br />
!insertmacro: end of FUNCTION_STRING_StrTok<br />
!define: &quot;MUI_ABORTWARNING&quot;=&quot;&quot;<br />
!define: &quot;MUI_ICON&quot;=&quot;\\h02264-pc\e$\Downloads\Programs\nsis\nsis-26-Jan-2011.cvs\Contrib\Graphics\T-System\TSystemEV.ico&quot;<br />
!define: &quot;MUI_UNICON&quot;=&quot;\\h02264-pc\e$\Downloads\Programs\nsis\nsis-26-Jan-2011.cvs\Contrib\Graphics\T-System\TSystemEV.ico&quot;<br />
!define: &quot;MUI_COMPONENTSPAGE_NODESC&quot;=&quot;&quot;<br />
!define: &quot;MUI_WELCOMEFINISHPAGE_BITMAP&quot;=&quot;\\h02264-pc\e$\Downloads\Programs\nsis\nsis-26-Jan-2011.cvs\Contrib\Graphics\T-System\T_Logo_Dialog2.bmp&quot;<br />
!define: &quot;MUI_FINISHPAGE_NOAUTOCLOSE&quot;=&quot;&quot;<br />
!insertmacro: MUI_PAGE_WELCOME<br />
!insertmacro: end of MUI_PAGE_WELCOME<br />
!insertmacro: MUI_PAGE_INSTFILES<br />
!insertmacro: end of MUI_PAGE_INSTFILES<br />
!insertmacro: MUI_PAGE_FINISH<br />
!insertmacro: end of MUI_PAGE_FINISH<br />
!insertmacro: MUI_UNPAGE_INSTFILES<br />
!insertmacro: end of MUI_UNPAGE_INSTFILES<br />
!insertmacro: MUI_LANGUAGE<br />
Error: Invalid language file.<br />
Error in macro MUI_LANGUAGE on macroline 9<br />
Error in script &quot;D:\dev\v40_work\Installer\testing\Test.nsi&quot; on line 118 -- aborting creation process</div></div><hr />


<div class="post"><div class="posttop"><div class="username">T.Slappy</div><div class="date">12th May 2011, 05:37</div></div><div class="posttext">Did you include MUI2 before !insertmacro MUI_LANGUAGE English ??<br />
Sometimes the right order is needed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">texaspapa</div><div class="date">12th May 2011, 17:26</div></div><div class="posttext">Yes msi2 is included before any mui statements.  msi2.nsh is the first file included.<br />
<br />
This is strange as the same nsi file builds using the 2.46 version of nsis.<br />
<br />
From what I can tell the current code Lang.cpp is checking for version 5 and  language files all have version 6.  Even the English NSIS 2.46 Language file is version 6.<br />
<br />
<br />
<br />
// NSIS Language File parser<br />
LanguageTable * CEXEBuild::LoadLangFile(char *filename) {<br />
  FILE *f = FOPEN(filename, &quot;r&quot;);<br />
  if (!f) {<br />
    ERROR_MSG(&quot;Error: Can't open language file - \&quot;%s\&quot;!\n&quot;,filename);<br />
    return 0;<br />
  }<br />
<br />
  // Check header<br />
  char buf[NSIS_MAX_STRLEN];<br />
  buf[0] = SkipComments(f);<br />
  fgets(buf+1, NSIS_MAX_STRLEN, f);<br />
<br />
  if (strncmp(buf, &quot;NLF v&quot;, 5)) {<br />
    ERROR_MSG(&quot;Error: Invalid language file.\n&quot;);<br />
    return 0;<br />
  }</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th May 2011, 17:45</div></div><div class="posttext">No it's not checking for version 5. That is just telling it to only check the first 5 characters of buf (strncmp). Just use NSIS 2.46.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">texaspapa</div><div class="date">12th May 2011, 18:43</div></div><div class="posttext">You are correct.  Code is only comparing 5 bytes.  I still get the &quot;Invalid Language File &quot; error with the build from Jan 26th.<br />
<br />
The 2.46 build is not working for me. I am trying to install on Windows 2008 (64-bit). Installer works on Windows Server 2003 (32-bit). When I run my installer it exits about half way through.  I then ran my installer under Application Verifier and windbg.  Application Verifier caught and aborted the installer the first time nsexec is invoked.  This error occurs immediately when running the installer with Application Verifier. Turns out that nsexec.c ExecScript code corrupts memory on 64-bit system. This problem is fixed with current version of nsexec.c.  This is why I am trying to get an updated nsis build!<br />
<br />
I first checked out the latest NSIS source from SVN. After building NSIS I am not able to build any nsi file.   So I thought that I would try the  build from January 26 since it was available on the NSIS download page.  With the Jan 26th build I get &quot;Invalid Language File&quot; when I build ANY nsi file including the languages.nsi file under examples. <br />
<br />
Once I get past this issue, I will be able to resume debugging my installer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th May 2011, 18:55</div></div><div class="posttext">You could use ExecDos instead? I have tested and modified that to work correctly on x64.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">texaspapa</div><div class="date">12th May 2011, 19:48</div></div><div class="posttext">thanks! I will look into ExecDos.  Did you use the 2.46 build on a 64 bit OS when you used ExecDos?<br />
<br />
I am now able to build the languages.nsi file using the build from January 26. It turns out that that build is built without UNICODE but that language files are saved as UTC-8 files.  I saved the language files as ASCII files and can now build with no Invalid Language File errors.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th May 2011, 20:59</div></div><div class="posttext">The new NSIS version is meant to handle ANSI/Unicode duality but it's probably still work in progress. For that reason I would stick to 2.46 which has been tried and tested. You should always use stable releases in general, unless you are seeking for bad customer feedback ;). Yes we use 2.46.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>