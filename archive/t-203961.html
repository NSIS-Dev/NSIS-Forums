<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Hide/skip standard MUI pages at runtime, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Hide/skip standard MUI pages at runtime NSIS Discussion" />
	
	<title> Hide/skip standard MUI pages at runtime [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Hide/skip standard MUI pages at runtime</div>
<hr />
<div class="pda"><a href="t-203961.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=203961">Hide/skip standard MUI pages at runtime</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">DavidScheffel</div><div class="date">5th January 2005, 13:34</div></div><div class="posttext">Hi there,<br />
<br />
I'm looking for an way to prevent installing new versions into an different directory than an eventually existing one.<br />
<br />
BTW NSIS has the same problem. If you run an setup with same version than the one installed, NSIS will allow you to change the installation destination. Which will leave the old installation without uninstalling.<br />
<br />
I think hiding the the pages MUI_PAGE_DIRECTORY and MUI_PAGE_STARTMENU would be an reliable solution. But is this possible at all?<br />
<br />
I found an script in this forum that should hide an startmenu page. Maybe this aproach could be used to hide/skip other pages as well. Unfortunately I don't understand what this script is doing although I'm a expericed C++ developer. Could someone explain it to me?<br />
<br />
Thanks<br />
//David <br />
<br />
!define GetSectionSelection &quot;!insertmacro GET_SECTION_SELECTION&quot;<br />
!macro	GET_SECTION_SELECTION  SECTION<br />
	Push		$1<br />
	SectionGetFlags	${SECTION}  $1<br />
	IntOp		$1  $1 &amp; 1<br />
	Exch		$1<br />
!macroend<br />
[...]<br />
	!define		MUI_STARTMENUPAGE_NODISABLE<br />
	!define		MUI_PAGE_CUSTOMFUNCTION_PRE  PreStartmenu<br />
	!insertmacro	MUI_PAGE_STARTMENU  &quot;smid&quot;  $SMDIR<br />
[...]<br />
Section	&quot;$(lsSec_Startmenu)&quot;  siStartmenu<br />
SectionEnd<br />
[...]<br />
Function	PreStartmenu<br />
	${GetSectionSelection}	${siStartmenu}<br />
	Pop		$0<br />
	StrCmp		$0  0  0  +2<br />
	Abort<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">5th January 2005, 14:15</div></div><div class="posttext">Yes , it is possible.  You just add function that does the check and then call abort.  In the example below it is assumed that $9 was already set depending on if there was a previous install which you could check many different ways.<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE &quot;SkipIfPreviousInstall&quot;<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
...<br />
Function SkipIfPreviousInstall<br />
<br />
  IntCmp $9 1 0 +2<br />
     Abort<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DavidScheffel</div><div class="date">5th January 2005, 14:24</div></div><div class="posttext">Thanks scully, but I actually want to allow installing over an existing installation. With restriction that the install directory must be the same. Therefore I'd like to hide the directory and the startmenu page in this case.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">5th January 2005, 14:26</div></div><div class="posttext">That's what this does.  I use it to hide the Directory page myself if the user already has a previous install and they are upgrading.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DavidScheffel</div><div class="date">5th January 2005, 14:28</div></div><div class="posttext">Oh I didn't realize that. Sorry. I'll try it right away.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DavidScheffel</div><div class="date">5th January 2005, 14:49</div></div><div class="posttext">Hi scully! Thanks. That's indeed what I was looking for. There's just one problem left: If the skip those two pages the installation will begin already after the license page.<br />
<br />
I think I should inform the user about that and change the caption of button or display an custom page.<br />
<br />
I could use an abort before the custom page if the &quot;upgrade&quot;-flag is not set (normal condition), right?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">5th January 2005, 15:08</div></div><div class="posttext">You could do that.  I use a confirmation dialog at the end that is actually always there.  It shows what type of install they are doing and it will note an upgrade if that is the case. The confirmation dialog also shows them where it is going to install to and the start menu folder along with some other stuff.  It gets pretty bare when you don't really prompt the user for anything during an upgrade.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th January 2005, 15:13</div></div><div class="posttext">You can also change the next button text to &quot;Install&quot; manually. You can do that using GetDlgItem and SendMessage with WM_SETTEXT. If you search the forum for WM_SETTEXT, you should find some examples.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DavidScheffel</div><div class="date">5th January 2005, 15:31</div></div><div class="posttext">Thanks for your numerous replies. You have been a big help!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">soltrain</div><div class="date">2nd March 2005, 01:32</div></div><div class="posttext">this code is bomb, just used it in my upgrade/install script. thanks!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>