<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" A better integration of InstallOptions, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  A better integration of InstallOptions NSIS Discussion" />
	
	<title> A better integration of InstallOptions [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  A better integration of InstallOptions</div>
<hr />
<div class="pda"><a href="t-65787.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=65787">A better integration of InstallOptions</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">felfert</div><div class="date">16th November 2001, 08:20</div></div><div class="posttext">Hi again,<br />
<br />
Playing more with InstallOptions, i got the idea that having it running in between some dialog pages of NSIS would be better than running it int some install section. So here is my (very small) hack for NSIS1.65 (attached as unified diff) which adds the following new feature:<br />
<br />
You now can declare a Function named .onDlgPage which gets called whenever the user switches to the next (or previous) page of the installer. Before calling this function, NSIS pushes 2 integers, previous_page_nr and new_page_nr on the stack which of course have to be popped within that function. The first dialog page (copyright) is 0, and so on. When the installer displays the first time, previous_page_nr is -1.<br />
<br />
Having this new feature, i now can use the following script snippet to &quot;hook&quot; an additional dialog in between the component selection page and the installdir selection page (just as an example):<br />
<br />
<br />
Function .onDlgPage<br />
  exch $0<br />
  exch<br />
  exch $1<br />
  ; MessageBox MB_OK &quot;.onDlgPage called, arg0=$0, arg1=$1&quot;<br />
  IntCmp $0 1 0 nomatch nomatch<br />
  IntCmp $1 2 0 nomatch nomatch<br />
  call SelectProgramGroup<br />
nomatch:<br />
  pop $1<br />
  pop $0<br />
FunctionEnd<br />
<br />
Function SelectProgramGroup<br />
  push $OUTDIR<br />
  SetOutPath $TEMP<br />
  File /oname=browsegroup.ini browsegroup.txt<br />
  File InstallOptions.exe<br />
  WriteINIStr &quot;$TEMP\browsegroup.ini&quot; Settings ParentWnd $HWNDPARENT<br />
  WriteINIStr &quot;$TEMP\browsegroup.ini&quot; &quot;Field 1&quot; Text &quot;$SMPROGRAMS&quot;<br />
  ExecWait &quot;$TEMP\InstallOptions $TEMP\browsegroup.ini&quot;<br />
  pop $OUTDIR<br />
  ReadINIStr $9 $TEMP\browsegroup.ini Results 1<br />
  ;MessageBox MB_OK &quot;IO finished, returned $9&quot;<br />
FunctionEnd<br />
<br />
<br />
The (currently very poor) browsegroup.txt looks like this:<br />
<br />
<br />
[Settings]<br />
Title=&quot;Program group&quot;<br />
Caption=&quot;Select a group to install shortcuts in.&quot;<br />
ParentWnd=0<br />
NumFields=1<br />
<br />
[Field 1]<br />
Type=DirRequest<br />
Text=<br />
MaxLen=1024<br />
MinLen=2<br />
Left=20<br />
Top=60<br />
Right=400<br />
Bottom=85<br />
<br />
<br />
BTW:<br />
In the NSIS1.65 source distribution, some library settings for<br />
Debug are missing: For makenssi, add version.lib and for exehead, add<br />
comctl32.lib<br />
<br />
Ciao<br />
 -Fritz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">felfert</div><div class="date">16th November 2001, 08:58</div></div><div class="posttext">... have to quote myself:<br />
<br />
Originally posted by felfert <br />
[B]Hi again,<br />
<br />
Playing more with InstallOptions, ....<br />
<br />
<br />
How to apply this patch:<br />
<br />
1. You need the &quot;patch&quot; program for that.<br />
1a. Get cygwin at http://sources.redhat.com/cygwin/<br />
or<br />
1b. put the source-tree and the patch on a Linux-Box<br />
<br />
2. cd into the toplevel Source direcory<br />
3. Unzip the zipfile there<br />
4. run patch -p1 &lt; nsis1.65-onDlgPage.patch<br />
<br />
Ciao<br />
 -Fritz</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>