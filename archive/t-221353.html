<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" define function on-demand?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  define function on-demand? NSIS Discussion" />
	
	<title> define function on-demand? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  define function on-demand?</div>
<hr />
<div class="pda"><a href="t-221353.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=221353">define function on-demand?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">13th July 2005, 14:08</div></div><div class="posttext">I'm just trying to clean up my code a bit.  I like to wrap my own functions in an NSH file that I can !include when I need them using macros and return varaibles.  (I find this much more convenient than using stack commands within a section or function.)<br />
<br />
My list of functions (and NSH files) keeps growing.  I'd like to take the ones I use most often and put then into a single NSH file.  However, I might not use every single function declared in an NSH file.  <br />
<br />
I'd like to know if anyone has any tricks of defining a function &quot;on demand&quot;. In other words, I want to automatically create a function only when needed.  I thought perhaps I could encapsulate the function within &quot;!ifdef&quot; statements, but I'm not sure if that's the right way to go.<br />
<br />
Here's an example of a basic NSH file layout that I currently use.  Any advice would be appreciated.  Thanks!<br />
______________________________________________________<br />
!macro MyFunc Return_var Input_var<br />
   push ${Input_var}<br />
   Call MyFunc<br />
   Pop ${Return_var}<br />
!macroend<br />
<br />
!define CoolFunction &quot;!insertmacro MyFunc&quot;<br />
<br />
Function MyFunc<br />
  Exch $0<br />
  push $1<br />
  ; do stuff with $0<br />
  ; store result in $1<br />
  exch $1<br />
  exch<br />
  pop $0<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">13th July 2005, 14:32</div></div><div class="posttext">it would definitely be nicer if one could push instructions to a function in a php-like way.<br />
<br />
Call MyFunc ${1} ${2} ${3}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">13th July 2005, 16:12</div></div><div class="posttext">That's what StrFunc/UseFunc, and Instructor's header files do. The best of them would be UseFunc, because function calls and the functions themselves have less instructions than the others.<br />
<br />
Just look at the call to StrCase now:<br />
<br />
<br />
  !macro ${_FuncCall} ResultVar String Type<br />
  ${_UseFunc_FuncCall_Start}<br />
    ${UseFunc_Echo} `$ {${_Un}${_Name}} &quot;${ResultVar}&quot; &quot;${String}&quot; &quot;${Type}&quot;`<br />
    Push `${String}`<br />
    Push `${Type}`<br />
    Call `${_Un2}${_Name}`<br />
    Pop `${ResultVar}`<br />
  ${_UseFunc_FuncCall_End}<br />
  !macroend<br />
<br />
<br />
This call is suitable for both installer and uninstaller. The echo line is optional.<br />
<br />
Or I could use your example function to create one with UseFunc. It would be built like this:<br />
<br />
<br />
${_UseFunc_DefHeader} `Cool` `NSIS Cool Functions Header File` `1` `0` `` `` `2005 Comperio`<br />
<br />
${_UseFunc_DefFunc} `Function` `CoolFunction Function` `1` `0` `` `` `2005 Comperio`<br />
<br />
  !macro ${_FuncCall} Return_var Input_var<br />
  ${_UseFunc_FuncCall_Start}<br />
    ${UseFunc_Echo} `$ {${_Un}${_Name}} &quot;${Return_var}&quot; &quot;${Input_var}&quot;`<br />
    Push `${Input_var}`<br />
    Call `${_Un2}${_Name}`<br />
    Pop `${Return_var}`<br />
  ${_UseFunc_FuncCall_End}<br />
  !macroend<br />
<br />
  !macro ${_Func}<br />
  ${_UseFunc_Func_Start}<br />
    Exch $0<br />
    push $1<br />
    ; do stuff with $0<br />
    ; store result in $1<br />
    exch $1<br />
    exch<br />
    pop $0<br />
  ${_UseFunc_Func_End}<br />
  !macroend<br />
<br />
<br />
I'm just not sure if the version and credits should be necessary. Those are only used when the internal echo message when a function is included, and to create new defines just for the version and the credits.<br />
<br />
You see there that the header has the prefix name for all its functions called &quot;Cool&quot;. If you have a function called &quot;Function&quot;, you would have the final function name as &quot;CoolFunction&quot;. Also, the name of the function is used for all its posterior uses: there is no need to put it several times. You can also use the ${_Name} define for this.<br />
<br />
The function can be included the same way as you did with StrFunc. ${CoolFunction} outside functions and sections for function definition, ${CoolFunction} &quot;Return_var&quot; &quot;Input_var&quot; inside sections or functions. Any function definition is only added to the size of the installer if you call it first.<br />
<br />
I'll release it to public soon as it has a documentation.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>