<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" String terminated with 2 NULLs, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  String terminated with 2 NULLs NSIS Discussion" />
	
	<title> String terminated with 2 NULLs [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  String terminated with 2 NULLs</div>
<hr />
<div class="pda"><a href="t-293355.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=293355">String terminated with 2 NULLs</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Brian234</div><div class="date">19th June 2008, 18:17</div></div><div class="posttext">Hello. I'm creating an installer for my WinAmp plugin. One of the things I need to do is write a REG_MULTI_SZ string to the registry, and I was able to do this, but I'm concerned I'm hiding a potential bug.<br />
<br />
The problem is the string that I pass into the call is NULL terminated, but the MSDN docs for RegSetKeyValueA require me to have two NULLs at the end of the string to signify the actual end of the buffer.<br />
<br />
I can't figure out how to create such a string - the NSIS parser doesn't seem to support '\0' as an escape character.<br />
<br />
For now, I'm telling RegSetKeyValueA that my buffer is one byte bigger than it actually is, and this happens to work because a second NULL happens to follow my NULL terminated string, but that is just luck and I figure sometime somewhere this will fail.<br />
<br />
Is there a way to embed additional NULLs in my string? Is there a way to define my string as a hex array?<br />
<br />
Thanks,<br />
Brian</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">19th June 2008, 18:52</div></div><div class="posttext">1. I think if you call the instructions provided by NSIS to write a string to the registry (e.g. WriteRegStr or WriteRegExpandStr), NSIS will automatically append the required NULL chars, so you don't need to pass them explicitly.<br />
<br />
2. You can call WriteRegBin to write a block of binary data to the registry. This data has to be provided as a hexadecimal string.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brian234</div><div class="date">19th June 2008, 19:06</div></div><div class="posttext">Thanks for the info. I assume WriteRegStr, WriteRegExpandStr, and WriteRegBin create values of type REG_SZ, REG_EXPAND_SZ, and REG_BINARY respectively.<br />
<br />
Unfortunately, I need the resulting value to be of type REG_MULTI_SZ because the application that will act on these values will fail if the type isn't correct.<br />
<br />
Thanks,<br />
Brian</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">19th June 2008, 19:17</div></div><div class="posttext">If you feel unsure you may try the registry plugin:<br />
<br />
http://nsis.sourceforge.net/Registry_plug-in</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brian234</div><div class="date">19th June 2008, 21:34</div></div><div class="posttext">Thanks for the link! It looks like that will solve the problem, but I'm going to try to solve it without requiring another DLL.<br />
<br />
It looks like NSIS zeros out local buffers of a larger size than what you request before each use, so I'm probably safe as is, but I'm going to use a silly trick as a 'just-in-case'.<br />
<br />
I StrCpy a 40 byte string to $8 in one call (so the 40th element will be NULL terminated), then use a 2nd StrCpy to copy in a 39 byte string to $8 (so now the 39th and 40th elements are now NULL).<br />
<br />
It works, but again, I think NSIS is solving my problem and my silly trick is redundant.<br />
<br />
Thanks,<br />
Brian</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">19th June 2008, 21:57</div></div><div class="posttext">this is undefined behavior (could change at any time) <br />
<br />
The proper way to do this would be to use the system plugin (allocate a structure, and call the registry)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>