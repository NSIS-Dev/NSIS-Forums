<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Need help on detecting if Adobe AIR is installer, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Need help on detecting if Adobe AIR is installer NSIS Discussion" />
	
	<title> Need help on detecting if Adobe AIR is installer [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Need help on detecting if Adobe AIR is installer</div>
<hr />
<div class="pda"><a href="t-282982.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=282982">Need help on detecting if Adobe AIR is installer</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">razor7</div><div class="date">10th December 2007, 17:59</div></div><div class="posttext">Hello...iÂ´m trying to make an installer that is capable to detect if Adobe AIR is installed...<br />
<br />
Looked into the registry and have found two keys that holds the Adobe Air data.<br />
<br />
[HKEY_CLASSES_ROOT\Installer\Products\D51CF99160E2EB743BAEAC80F6BC49FC]<br />
[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Installer\Products\D51CF99160E2EB743BAEAC80F6BC49FC]<br />
<br />
both with the same data in each.<br />
<br />
So i have found this code to detect the path and version of Adobe Flash IE Plugin<br />
<br />
<br />
Name &quot;Output&quot;<br />
OutFile &quot;Output.exe&quot;<br />
<br />
!include &quot;FileFunc.nsh&quot;  <br />
!insertmacro GetFileVersion<br />
<br />
Section<br />
	ReadRegStr $0 HKLM &quot;SOFTWARE\Classes\Installer\Products\D51CF99160E2EB743BAEAC80F6BC49FC&quot; &quot;ProductName&quot;<br />
	IfErrors notinst<br />
	${GetFileVersion} '$0' $1<br />
	IfErrors notinst<br />
<br />
	MessageBox MB_OK '$$0={$0}$\n$$1={$1}' IDOK end<br />
<br />
	notinst:<br />
	MessageBox MB_OK 'Macromedia Flash Player component for IE is not found, Valor $$0=$0'<br />
<br />
	end:<br />
SectionEnd <br />
<br />
And if you see...iÂ´m trying to read that Key, but the awful result is an empty string ans the error set to true<br />
<br />
I have included the key export to reg file for you to see...<br />
<br />
Please advise.<br />
<br />
Thanks a lot!<br />
<br />
EDIT: I dont know whit the attachment is gone...<br />
<br />
Here is the registry export.<br />
<br />
<br />
Windows Registry Editor Version 5.00<br />
<br />
[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Installer\Products\D51CF99160E2EB743BAEAC80F6BC49FC]<br />
&quot;ProductName&quot;=&quot;Adobe Integrated Runtime (AIR)&quot;<br />
&quot;PackageCode&quot;=&quot;99E592108416019478501F9180E3C1ED&quot;<br />
&quot;Language&quot;=dword:00000409<br />
&quot;Version&quot;=dword:01000005<br />
&quot;Assignment&quot;=dword:00000001<br />
&quot;AdvertiseFlags&quot;=dword:00000184<br />
&quot;InstanceType&quot;=dword:00000000<br />
&quot;AuthorizedLUAApp&quot;=dword:00000000<br />
&quot;Clients&quot;=hex(7):3a,00,00,00,00,00<br />
@=&quot;&quot;<br />
<br />
[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Installer\Products\D51CF99160E2EB743BAEAC80F6BC49FC\SourceList]<br />
&quot;PackageName&quot;=&quot;setup.msi&quot;<br />
&quot;LastUsedSource&quot;=hex(2):6e,00,3b,00,31,00,3b,00,43,00,3a,00,5c,00,44,00,4f,00,\<br />
  43,00,55,00,4d,00,45,00,7e,00,31,00,5c,00,4d,00,61,00,72,00,74,00,69,00,6e,\<br />
  00,5c,00,4c,00,4f,00,43,00,41,00,4c,00,53,00,7e,00,31,00,5c,00,54,00,65,00,\<br />
  6d,00,70,00,5c,00,41,00,49,00,52,00,32,00,39,00,2e,00,74,00,6d,00,70,00,5c,\<br />
  00,00,00<br />
<br />
[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Installer\Products\D51CF99160E2EB743BAEAC80F6BC49FC\SourceList\Media]<br />
&quot;1&quot;=&quot;;&quot;<br />
<br />
[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Installer\Products\D51CF99160E2EB743BAEAC80F6BC49FC\SourceList\Net]<br />
&quot;1&quot;=hex(2):43,00,3a,00,5c,00,44,00,4f,00,43,00,55,00,4d,00,45,00,7e,00,31,00,\<br />
  5c,00,4d,00,61,00,72,00,74,00,69,00,6e,00,5c,00,4c,00,4f,00,43,00,41,00,4c,\<br />
  00,53,00,7e,00,31,00,5c,00,54,00,65,00,6d,00,70,00,5c,00,41,00,49,00,52,00,\<br />
  32,00,39,00,2e,00,74,00,6d,00,70,00,5c,00,00,00</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">10th December 2007, 18:38</div></div><div class="posttext">Forgive me if I miss something, I see you're attempting to read the value of ProductName which is Adobe Integrated Runtime (AIR) and call the function ${GetFileVersion} to get the version of what?<br />
<br />
However, those registry records, obviously they are related to windows installer, you should find records related to adobe.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">razor7</div><div class="date">10th December 2007, 21:02</div></div><div class="posttext">Hello..thanks for the advise...<br />
<br />
The line ${GetFileVersion} was there in the original script,<br />
obviously i dont want to get the file version.<br />
<br />
Also, since adobe AIR is so new, i dont know were it places the registry entryes...So the only key that has some sense to check his availability is that two keys.<br />
<br />
Perhaps, the error i get is that i can not read the key, the value is an empty string and the error state is set to true...<br />
<br />
Please advise.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th December 2007, 21:27</div></div><div class="posttext">The registry path SOFTWARE\Classes\Installer\Products\D51CF99160E2EB743BAEAC80F6BC49FC appears to be incorrect according to your reg file.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">razor7</div><div class="date">10th December 2007, 22:43</div></div><div class="posttext">Hello guys...<br />
<br />
Sorry if iÂ´m wrong, but i still donÂ´t get it...So please advise if iÂ´m wrong...<br />
<br />
I think if i use this sentence<br />
ReadRegStr $0 HKLM &quot;SOFTWARE\Classes\Installer\Products\D51CF99160E2EB743BAEAC80F6BC49FC&quot; &quot;ProductName&quot;<br />
<br />
I can read this value &quot;Adobe Integrated Runtime (AIR)&quot; stored in the entry &quot;ProductName&quot; of this branch &quot;HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Installer\Products\D51CF99160E2EB743BAEAC80<br />
F6BC49FC&quot;<br />
<br />
Thanks in advise...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">10th December 2007, 23:29</div></div><div class="posttext">for me this works:<br />
ReadRegDWORD $0 HKCU &quot;Software\Microsoft\Installer\Products\XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&quot; &quot;Version&quot;<br />
<br />
however, the part where i put XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX is different to what you posted, so this might be randomly created by the installer. i think the registry plugin can locate keys in the registry. however, the GetFileVersion function is meant to work with files, if i'm not mistaken. that'S why i was reading the version key instead, but the result leaves me somewhat clueless (maybe you can read more from it?)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">10th December 2007, 23:43</div></div><div class="posttext">this can't be the only registry entry it creates, does it create a normal uninstall entry in HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">10th December 2007, 23:47</div></div><div class="posttext">Name &quot;Output&quot;<br />
OutFile &quot;Output.exe&quot;<br />
<br />
!include &quot;FileFunc.nsh&quot;<br />
!insertmacro &quot;Locate&quot;<br />
<br />
Section<br />
        ${Locate} &quot;$LOCALAPPDATA\Adobe AIR\Versions&quot; &quot;/L=D&quot; &quot;found&quot;<br />
; whatever you want to use the result for here	<br />
SectionEnd<br />
<br />
Function found<br />
	 MessageBox MB_OK &quot;Version is $R7&quot;<br />
	 <br />
	 Push $0<br />
FunctionEnd<br />
<br />
try this</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">10th December 2007, 23:49</div></div><div class="posttext">Originally posted by Anders <br />
this can't be the only registry entry it creates, does it create a normal uninstall entry in HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\? <br />
<br />
was the first thing i looked for, i also searched the registry for 'adobe air'. when i checked using beta 1 there was no such entry, now that i upgraded to beta 2 there is one! so detecting the version remains a problem with beta 1 users, but the script above should work for those.<br />
<br />
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\Adobe AIR<br />
<br />
having said that.. good nite! :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">razor7</div><div class="date">11th December 2007, 00:35</div></div><div class="posttext">I solved this way...<br />
<br />
<br />
Function &quot;GetAIRVER&quot;<br />
  !define AIRVer &quot;1.0.5.53310&quot; ; Version necesaria de AIR<br />
<br />
  GetDllVersion &quot;$COMMONFILES\Adobe AIR\Versions\1.0.5\Adobe AIR.dll&quot; $R0 $R1<br />
  IntOp $R2 $R0 / 0x00010000<br />
  IntOp $R3 $R0 &amp; 0x0000FFFF<br />
  IntOp $R4 $R1 / 0x00010000<br />
  IntOp $R5 $R1 &amp; 0x0000FFFF<br />
  ; StrCmp $R2 &quot;0&quot; +3 0<br />
  StrCpy $1 &quot;$R2.$R3.$R4.$R5&quot;<br />
<br />
  StrCmp $1 ${AIRVer} verCorrecta verIncorrecta<br />
<br />
  verIncorrecta:<br />
    MessageBox MB_YESNO|MB_ICONQUESTION &quot;Es nesesario instalar archivos adicionales. $\r$\nSi desea continuar ahora, presione el boton Si$\r$\ny luego haga click en el boton que dice I Agree.&quot; IDYES Instalar<br />
    Abort<br />
<br />
  Instalar:<br />
    ExecWait &quot;dependencias\air_b2_win_100107.exe&quot;<br />
<br />
  verCorrecta:<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">12th December 2007, 09:21</div></div><div class="posttext">you should consider that your script will not work with future versions of air</div></div><hr />


<div class="post"><div class="posttop"><div class="username">razor7</div><div class="date">12th December 2007, 14:44</div></div><div class="posttext">Hello....<br />
Yes that is right, i have cosidered to make a logic structure for comparing each number, but i have to finish the installer.<br />
<br />
So i will try to implement it in the future.<br />
<br />
Thanks a lot.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>