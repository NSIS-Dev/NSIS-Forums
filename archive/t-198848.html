<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Win98 and sysadmin check, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Win98 and sysadmin check NSIS Discussion" />
	
	<title> Win98 and sysadmin check [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Win98 and sysadmin check</div>
<hr />
<div class="pda"><a href="t-198848.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=198848">Win98 and sysadmin check</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">grahama</div><div class="date">10th November 2004, 00:30</div></div><div class="posttext">This code works in 2000 and XP but fails in Windows 98<br />
<br />
System::Call &quot;kernel32::GetModuleHandle(t 'shell32.dll') i .s&quot;<br />
System::Call &quot;kernel32::GetProcAddress(i s, i 680) i .r0&quot;<br />
System::Call &quot;::$0() i .r0&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grahama</div><div class="date">10th November 2004, 05:32</div></div><div class="posttext">;continued<br />
; So, is the the user the admin or not ?<br />
strcmp $0 1 admin notAdmin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">10th November 2004, 06:16</div></div><div class="posttext">from msdn:<br />
Minimum DLL Version	shell32.dll version 5.0 or later	<br />
Minimum operating systems	Windows 2000<br />
<br />
anyway, there is no such thing as admin on Win9x, just skip the whole check on 95/98/ME</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">10th November 2004, 06:31</div></div><div class="posttext">UserInfo plugin code about Win9x :)<br />
<br />
    if (GetVersion() &amp; 0x80000000) // Not NT<br />
    {<br />
      group = &quot;Admin&quot;;<br />
    }<br />
<br />
Another home grown way I used - important thing is not admin group but if I can write registry (and Program files)<br />
<br />
;Hand made admin checkout<br />
Function .onInit<br />
  WriteRegStr HKLM &quot;${REG_UNINST}&quot; &quot;TestString&quot; &quot;Some text&quot;<br />
  IfErrors 0 cleanValue<br />
  MessageBox MB_OK &quot;This application must be installed by an administrator.$\nClick 'OK' to terminate the installation.&quot;<br />
  Abort<br />
cleanValue:<br />
  DeleteRegValue HKLM &quot;${REG_UNINST}&quot; &quot;TestString&quot;<br />
 FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grahama</div><div class="date">10th November 2004, 19:22</div></div><div class="posttext">many many thanks Takhir and Anders :)<br />
I am in my 6th week of PC system stuff as I come from the Mac world<br />
It is a totally different universe and this list has really helped to demystify all the new jargon<br />
For those who are following the thread, I changed DeleteRegValue to DeleteRegKey to trash the 'test' key as to leave no trace</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">10th November 2004, 19:57</div></div><div class="posttext">I had in mind to use this node for uninstall settings, but you are right - user can cancel installation, so key deletion is better.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>