<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Need help with UI Mod, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Need help with UI Mod NSIS Discussion" />
	
	<title> Need help with UI Mod [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Need help with UI Mod</div>
<hr />
<div class="pda"><a href="t-158179.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=158179">Need help with UI Mod</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">1st December 2003, 05:27</div></div><div class="posttext">I'm trying to modify one page in Modern UI.  I have added an extra control to the required dialog.  I just need a hint of how to modify the contents of it from the installer itself.<br />
<br />
Any help will be greatly appreaciated.<br />
<br />
Vytautas :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dejano</div><div class="date">1st December 2003, 06:21</div></div><div class="posttext">First use command:<br />
  ReserveFile &quot;my_page.ini&quot;  <br />
then in .onInit function use :<br />
  !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;my_page.ini&quot;<br />
then from your script modify &quot;my_page.ini&quot; before call your custom page, like this:<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;my_page.ini&quot; &quot;Field #&quot; &quot;Value Name&quot; &quot;Value&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">1st December 2003, 06:25</div></div><div class="posttext">I think that you misunderstood me.  I am trying to add an image control below the progress bar in the install page.  I used a resource hacker to add the control however I cannot seem to be able to specify the image file for the control.  I have tried the 'SetBrandingImage' command but it does not seem to function as I expected.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st December 2003, 12:46</div></div><div class="posttext">SetBrandingImage doesn't work for the inner dialog. For that you have to call LoadImage and send STM_SETIMAGE yourself.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">1st December 2003, 22:35</div></div><div class="posttext">I tried this code but there seems to be some error as it does not work :cry:   StrCpy $1 &quot;C:\Program Files\NSIS\Contrib\Graphics\Header\modern-header.bmp&quot;<br />
  FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
  GetDlgItem $0 $0 &quot;1028&quot;<br />
  System::Call &quot;user32::LoadImage(i 0, t r1, i ${IMAGE_BITMAP}, i 0, i 0, i ${LR_LOADFROMFILE}) i .r5&quot;<br />
  dumpstate::debug<br />
  SendMessage $0 ${STM_SETIMAGE} ${IMAGE_BITMAP} $5  It's probably somethink extremely simple that I just overlooked but I just can't seem to be able to figgure this out.<br />
<br />
NOTE: dumpstate shows that $0 contains the required info but $5 is always '0'<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st December 2003, 22:47</div></div><div class="posttext">Add the ?e switch to System::Call to find out what the error is. For example:<br />
<br />
System::Call &quot;user32::SetWindowText(i 0, i 0) ?e&quot;<br />
Pop $0<br />
DetailPrint $0<br />
<br />
should print out 1400 which is the error code ERROR_INVALID_WINDOW_HANDLE. You can get the description for the error code from WinError.h or using this program (http://www.gregorybraun.com/MSWinErr.html). There is also the program that comes with VC.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">1st December 2003, 22:56</div></div><div class="posttext">Thanks although my installer generates error 2.  Which was because I did not check to see if the file was there. After fixing that problem the error code is 0, but the image still won't display.<br />
<br />
Vytautas<br />
<br />
PS. If you would like I can attach a copy of the modified UI file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st December 2003, 23:00</div></div><div class="posttext">Does $0 have the right value? Try setting its background color to make sure.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">1st December 2003, 23:11</div></div><div class="posttext">If this is the code to change the background color to white then it did not work.  BTW where should I put this code, PRE / SHOW functions or in a section itself? SetCtlColors $0 FFFFFF FF0000 Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st December 2003, 23:14</div></div><div class="posttext">The show function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">1st December 2003, 23:35</div></div><div class="posttext">OK, so it seems that its not getting the right HWND.  How do I fix that?  I used a couple of resource editors and they both say that the bitmap control is there.  I have changed the control ID and tried the script again.  Then the script used a different ID that the one in the exe file $0 was '0' but when I changed the script to match the ID it showed up a normal value.<br />
<br />
Are you sure that one can change the background color of an image control?<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ibartel</div><div class="date">2nd December 2003, 09:11</div></div><div class="posttext">Hello,<br />
<br />
i recently had the same problem. This is my working macro (looks kinda similiar to yours):<br />
<br />
<br />
!define LR_LOADFROMFILE     0x0010<br />
!define LR_CREATEDIBSECTION 0x2000<br />
!define STM_SETIMAGE        370<br />
!define IMAGE_BITMAP        0<br />
!define sysLoadImage        &quot;user32::LoadImageA(i, t, i, i, i, i) i&quot;<br />
!define sysDeleteObject     &quot;gdi32::DeleteObject(i) i&quot;<br />
<br />
!macro DisplayImage IMG_NAME<br />
	Push $0<br />
	Push $1<br />
	GetTempFileName $1<br />
	File /oname=$1 &quot;${IMG_NAME}&quot;<br />
        FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
        GetDlgItem $0 $0 1100<br />
        System::Call '${sysLoadImage} (0, s, ${IMAGE_BITMAP}, 0, 0, ${LR_CREATEDIBSECTION}|${LR_LOADFROMFILE}) .r6' &quot;$1&quot;<br />
        SendMessage $0 ${STM_SETIMAGE} ${IMAGE_BITMAP} $6<br />
        System::Call &quot;${sysDeleteObject} (r6)&quot;<br />
	Delete $1<br />
	Pop $1<br />
	Pop $0<br />
!macroend<br />
<br />
<br />
hope this helps.<br />
<br />
kind regards,<br />
Ingo Bartel</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd December 2003, 12:05</div></div><div class="posttext">Are you sure that one can change the background color of an image control?Yes. I have just tested it again on the MUI welcome page and it worked.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">2nd December 2003, 23:03</div></div><div class="posttext">thanks ibartel, you macro worked for me.  Just a note though you should Push &amp; Pop $6<br />
<br />
kickik what is the best way to modify the UI exe file.  I noticed that some of the Modern UI mods are only for that particular page and they do not seem to modify the main UI file.  How do I do that?<br />
<br />
Vytautas :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">3rd December 2003, 05:37</div></div><div class="posttext">OK, just spotted a little problem with this approach.  It appears that the image get wiped out if the installer loses focus, e.g. get minimised and restored or another windows dragged over the top of it.<br />
<br />
Any ideas on how to fix this?<br />
<br />
Vytautas :eek:<br />
<br />
OT: I just noticed that some topics have a black dot on the icon, what's that all about?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd December 2003, 11:36</div></div><div class="posttext">You can modify just certain dialogs and then load them in using ChangeUI IDD_LICENSE | IDD_DIR | IDD_SELCOM | etc. instead of loading all of them.<br />
<br />
The image is probably wiped because you delete the image object before its usage has finished. Delete it after you replace it, not after you set it.<br />
<br />
The black dot signifies threads you've posted in.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">3rd December 2003, 12:39</div></div><div class="posttext">Yep that was the probl;em with the disapearing images, working on a modified macro to fix this problem.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">4th December 2003, 03:44</div></div><div class="posttext">Macro Updated, see the archive page.<br />
<br />
Should I use ChangeUI if using MUI and if so do I need to delete the other dialogs from the exe file since it did not work for me.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th December 2003, 13:49</div></div><div class="posttext">Well, the MUI has some defines to change the UI, but none change only the instfiles page. I think it would be best if you tell the user to put ChangeUI IDD_INSTFILES at the end of the script, or at least after the page macros.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">13th February 2004, 00:12</div></div><div class="posttext">Sorry to revisit an old thread, but I was wondering if there was a similar command that allowed to specify a JPEG rather than a BMP file.  <br />
<br />
Bitmaps are rather large and it seems a waste of space when it could be smaller as a JPEG.  Unless i'm way off track JPEGs have better compression than BMPs compressed with normal compression algorithms like BZIP2 or LZMA.<br />
<br />
Vytautas</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>