<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Structured parameter, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Structured parameter NSIS Discussion" />
	
	<title> Structured parameter [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Structured parameter</div>
<hr />
<div class="pda"><a href="t-267244.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=267244">Structured parameter</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">fabpolli</div><div class="date">6th March 2007, 12:05</div></div><div class="posttext">Hi, I have a C++ DLL with 2 params, one is structured. I call my function with System:<br />
System::Call 'MyLib::NfoUsr(t &quot;OReally&quot;, t .r1)'<br />
My lib fill r1 with a structure like this:<br />
struct Vendor<br />
	char Name<br />
	char Surname<br />
	char Address<br />
	int Products<br />
after library calling I use:<br />
System::Call &quot;*$1(&amp;t .r2, &amp;t .r3, &amp;t .r4, i .r5)&quot;<br />
but only $2 is filled with information.<br />
<br />
The DLL fill data with strcpy(vendor-&gt;Name, sNfo.Name);<br />
<br />
Please help me, best regard</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">6th March 2007, 19:42</div></div><div class="posttext">your struct string members probably are char*Foo or char Foo[somesize] and not just a single char<br />
<br />
There is an example that allocates/calls/reads a struct in /NSIS/Docs/System/System.html (in the FAQ part)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th March 2007, 20:10</div></div><div class="posttext">If it's a pointer to a string and not the string itself, remove the ampersands. If not, specify the string sizes after `&amp;t`.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fabpolli</div><div class="date">7th March 2007, 15:05</div></div><div class="posttext">Tanks for your suggestions, but I still have the problem.<br />
I try to explain with more details. <br />
In MyLib I have this structured param:<br />
<br />
struct Vendor     			<br />
{<br />
    char sName[52];<br />
    char sSurname[36];<br />
    char sAddress[32];<br />
    char sCity[4];<br />
    char sZIP[8];<br />
    char sIDKey[20];<br />
    char sLabel[32];<br />
    char sKey[12];<br />
	long lNumber; //4 BYTES<br />
}<br />
<br />
This structure is filled with strcpy(vendor-&gt;Name, sNfo.Name);<br />
<br />
This is a snip of NSIS code:<br />
Pop $1<br />
Pop $0<br />
System::Call 'MyLib::Open() i .r1'<br />
System::Alloc 200<br />
System::Call &quot;*(t, t, t, t, t, t, t, t, i)t.r0&quot;<br />
--------<br />
System::Call 'MyLib::NfoUsr(t &quot;OReally&quot;, t .r0)'<br />
;Dumpstate::debug<br />
System::Call &quot;*$0(t .r1, t .r2, t .r3, t .r4, t .r5, t .r6, t .r7, t .r8, i .r9)&quot;<br />
Dumpstate::debug<br />
------<br />
System::Call 'MyLib::Usr(t &quot;OReally&quot;, t .r1, t .r2)'<br />
Dumpstate::debug<br />
<br />
In the first call (NfoUsr) I have only a result in $0 with or without dimension of param, instead in the second one (Usr) MyLib return<br />
all param correctly filled up.<br />
In an other post I have read that in some cases it is necessary to split the strings with the null terminator (\0),<br />
but I have not found no commands for this function. Could be this my problem?<br />
Excuse me but I am a little new to the program NSIS.<br />
Tanks you for the time that yoy dedicate to me, best regards</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th March 2007, 19:16</div></div><div class="posttext">Well, those are not string pointers and you must therefore append their size to `&amp;t`.System::Call *(&amp;t52, &amp;t36 ...)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>