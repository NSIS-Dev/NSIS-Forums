<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Maximum size of stack items., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Maximum size of stack items. NSIS Discussion" />
	
	<title> Maximum size of stack items. [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Maximum size of stack items.</div>
<hr />
<div class="pda"><a href="t-142417.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=142417">Maximum size of stack items.</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">mgillespie</div><div class="date">16th July 2003, 17:54</div></div><div class="posttext">I have a plugin DLL I wrote in C++, and it works a treat.  It's quite a complex dll, and I want it to keep a log of it's actions, and any problems, and pass that back to the install script to log (I am using the optional enhanced logging).<br />
<br />
The my DLL logfile does get quite large (a few KB).<br />
<br />
This kinda works, but the log gets truncated.  I have checked my code, and it seems to be putting it onto the stack OK, but the install engine is not retrieving it all, and truncates it.<br />
<br />
Is this a known limitatation?  Are they any other ways of doing this?<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th July 2003, 18:02</div></div><div class="posttext">Are you trying to put it all in one line? If so, then that must be the problem because NSIS uses wsprintf to format the log string. But wsprintf is limited to 1024. NSIS strings are also limited to 1024 bytes by default and so are stack items.<br />
<br />
Try splitting it to a few lines, that should probably do the trick.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mgillespie</div><div class="date">16th July 2003, 18:18</div></div><div class="posttext">I build the string up as 1 big logfile with \n newline chars to seperate eash log item, when the function finished, I stick the complete log onto the stack and pop it back off from within the script.<br />
<br />
Is this correct?<br />
<br />
Or are you suggesting that I stick each log item on the stack indivudually and keep track of how many items there are, pass that back and then pop them off 1 by 1?  (could be hairy)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th July 2003, 18:24</div></div><div class="posttext">It's not correct. What you've said is your only option, unless you want to increase the stack item size. But it's not recommended because it would just waste memory and to ensure it's enough you'd have to waste a lot.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th July 2003, 18:25</div></div><div class="posttext">It's the only way, because if you're string is longer than 1024 chars, then when you pop it off the stack into NSIS (as a variable) then it will be chopped down to 1024 strlen.<br />
You will have to write each line to the stack one by one.<br />
<br />
A good thing to do is to write &quot;:end:&quot; to the stack as the last string.<br />
Then you can keep popping off the stack in NSIS, until the Popped string is :end: to signify to stop popping.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th July 2003, 18:27</div></div><div class="posttext">It's actually chopped when pushed. Stack items have constant size.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mgillespie</div><div class="date">16th July 2003, 21:43</div></div><div class="posttext">Well I kinda got things working now.  I modified my plugin source to add all the log items to the stack, at the start of the DLL code (after popping off any passed in params), I add my ENDLOG flag.  My problem is now, is that the log is in reverse order. Is there a simple way to reverse it, should I do it script side, or plugin cpp side?<br />
<br />
Thanks.<br />
<br />
 ;/////////////////////////////////////////////////////////////////////<br />
;//<br />
;// Section    - WritePluginLog<br />
;//<br />
;// Description - pulls all the entries backwards off the stack<br />
;//               until it finds the end (start) of the Plugin log.<br />
;//<br />
;/////////////////////////////////////////////////////////////////////	<br />
Function &quot;WritePluginLog&quot;<br />
	StartPopping:<br />
	Pop $R6<br />
	StrCmp $R6 &quot;ENDLOG:&quot; NoMore OutputDebug<br />
	OutputDebug:<br />
	LogText $R6<br />
	Goto StartPopping<br />
	NoMore:<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th July 2003, 21:47</div></div><div class="posttext">Doing it on the plug-in side would probably be easier because you can simply change pushstring to make the stack act as a queue. The source of pushstring is in ExDLL.h.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>