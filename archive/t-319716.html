<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" COM DLL registration, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  COM DLL registration NSIS Discussion" />
	
	<title> COM DLL registration [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  COM DLL registration</div>
<hr />
<div class="pda"><a href="t-319716.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=319716">COM DLL registration</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">ender_shadow</div><div class="date">6th June 2010, 15:59</div></div><div class="posttext">Dear NSIS gods...<br />
<br />
I am relatively new to NSIS, but have managed (with the help of the great wiki) build a decent installation of the product I am responsible for.<br />
<br />
However, I encountered a strange problem, I am relatively sure that it's only on Windows Vista and Windows 7.. The problem deals with the registration of a COM DLL.<br />
<br />
Part of the product I am responsible for includes a COM DLL which has to be registered as part of the installation. I use the internal NSIS command RegDLL (If memory serves) to register the DLL. However, on Windows 7, only for the first time you install the software, this fails... I have a workaround solution for this, so when you run the software it checks if the component is registered, and if not, registers it itself, however, I would prefer a solution through the install.<br />
<br />
During my digging around I stumbled upon the following text:<br />
<br />
&quot;Note that DLLs &amp; OCXs sometimes fail to register automatically at install time because they depend on a newer version of some runtime library (msvcrt.dll and msvcp60.dll being common culprits). These can't yet be upgraded because it's being used by the installer itself, so registration will fail and if it's not storing the result to DllRegisterServer (or just shelling to regsvr32 /s) you won't notice until you launch the app.&quot;<br />
<br />
This is from: http://www.fredshack.com/docs/nsis.html<br />
<br />
Now, I assume that this is a known issue with NSIS, the question is, does anyone have a good solution to this as part of NSIS itself? or is my solution the best that currently be achieved?<br />
<br />
Many thanks<br />
<br />
AP</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">6th June 2010, 16:50</div></div><div class="posttext">NSIS and the official plugins do not depend on any runtime dll's (Except the native windows api dll's of course) (Are you using 3rd party plugins?)<br />
<br />
Run http://www.dependencywalker.com/ on the dll you want to register (on a clean system) and see if there are any missing dependency's. You could also try to register the dll manually; run cmd.exe, run regsvr32 c:\path\your.dll<br />
<br />
And just to make sure, we are talking x86 and not x64 Win7?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ender_shadow</div><div class="date">6th June 2010, 16:57</div></div><div class="posttext">Hi Anders,<br />
<br />
Thanks for the really quick reply...<br />
<br />
I'll start from the end :) yes, you are correct, it's an x86 (i.e. 32 bit) machine.<br />
<br />
Registering the DLL manually works fine each time (as I stated, that's my workaround), which makes it seems strange that it's some dependancy that I'm missing... also, since this does not happen on an XP machine, it doesn't seem like that's the case...<br />
<br />
I am using 3rd party plugins, but nothing that's related to registering a COM DLL... if you'll note the quote I gave, it specifically states the situation I am facing... so, from your reply, I assume that you never encountered this situation...<br />
<br />
Some more information about my install - I also deploy (and install) the VC++ redistributable... could this by the root cause of the problem?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">6th June 2010, 21:53</div></div><div class="posttext">You could try running Process Monitor (http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx) during the install... (Might want to add MessageBox before and after you register the dll in your .nsi so you can start/stop monitoring with minimal useless output)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ender_shadow</div><div class="date">7th June 2010, 06:56</div></div><div class="posttext">Hi Anders,<br />
<br />
Just to make sure, what you're saying is that because the VC++ redistributable is still running, that's what is screwing up my COM registration? If so, that's an interesting direction, which I haven't considered, but since they are both in two separate sections wouldn't that protect me?<br />
<br />
Also, the section that registers the COM dll is done before the VC++ redist... might that be the cause?<br />
<br />
Many thanks again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">7th June 2010, 07:28</div></div><div class="posttext">I don't know what the problem is, but it would be helpful to know if loading a dll is the problem, or something else</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ender_shadow</div><div class="date">8th June 2010, 07:52</div></div><div class="posttext">Hi Anders, thank you for your advice, I will try and see how it pans out.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>