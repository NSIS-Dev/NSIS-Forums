<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" nsExec, Possible ExecWait functionality?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  nsExec, Possible ExecWait functionality? NSIS Discussion" />
	
	<title> nsExec, Possible ExecWait functionality? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  nsExec, Possible ExecWait functionality?</div>
<hr />
<div class="pda"><a href="t-180398.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=180398">nsExec, Possible ExecWait functionality?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">zimsms</div><div class="date">18th May 2004, 16:47</div></div><div class="posttext">Hello Everyone,<br />
<br />
I am using a compiled NSIS Script as a makefile to build installers branded for specific companies. The problem I am having concerns making this script work with a nightly build system.<br />
<br />
The problem I am having is that nsExec::Exec, nsExec::ExecToLog and nsExec::ExecToStack, do not wait for the called process to end before returning. This means that the files, even though the build may be successful, will not exist until the compilation has ended, with the downside of the build system thinking they weren't created logging it as an error and continuing.<br />
<br />
Are there plans to build an nsExec::ExecWait functionality into nsExec, or is there a way I can get around this? It really would be a nice feature for the plugin.<br />
<br />
Cheers!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">18th May 2004, 19:32</div></div><div class="posttext">Are you sure? They should all wait for the process to finish.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zimsms</div><div class="date">18th May 2004, 20:14</div></div><div class="posttext">Positive. If I have a compiled nsis script running through a command shell like the following:<br />
<br />
<br />
make /S<br />
<br />
<br />
that calls another nsis script using nsExec::Exec; ie:<br />
<br />
<br />
nsExec::Exec '&quot;${NSISDIR}\makensis.exe&quot; $Cmds $Defs &quot;$EXEDIR\$SCRIPT&quot;'<br />
<br />
<br />
the prompt immediately returns, and eventually, after the source compiles the new binaries will exist. What I'd like is the prompt to wait until the executable is actually built before exiting.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">18th May 2004, 21:13</div></div><div class="posttext">And what about ExecToLog? That one should put all output in the log before it continues.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zimsms</div><div class="date">18th May 2004, 21:22</div></div><div class="posttext">I never see a log at all, when running one in the other.....I had posted that odd behaviour earlier..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">19th May 2004, 03:09</div></div><div class="posttext">Post your computer Windows version and what NSIS version you're using for better questions answering in this case.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">19th May 2004, 10:04</div></div><div class="posttext">And a minimal example that reproduces the problem. Maybe the application you are using starts another process.<br />
<br />
Note that in this case makensis.exe is probably doing nothing because you should add a backslash after ${NSISDIR}.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zimsms</div><div class="date">19th May 2004, 13:52</div></div><div class="posttext">Microsoft Windows XP [Version 5.1.2600] With all patches to date 20040519.<br />
<br />
NSIS v2.0 (About 2 weeks after Final, since there were two bugs you guys fixed for me) My executable is dated March 30, 2004.<br />
<br />
I have include the example as requested, follow the contained readme.txt.<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">19th May 2004, 16:23</div></div><div class="posttext">Do you get the same behavior when running another application or only when running makensis?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zimsms</div><div class="date">19th May 2004, 16:36</div></div><div class="posttext">Just makensis....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zimsms</div><div class="date">20th May 2004, 13:33</div></div><div class="posttext">Status?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pompo500</div><div class="date">20th May 2004, 13:57</div></div><div class="posttext">JOOST/1.0 STATUS 430 &quot;BORED AND FORGOT&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th May 2004, 20:59</div></div><div class="posttext">nsExec does wait, it's the prompt that doesn't for make.exe because it's not a console application. For example, try using nsExec on make.exe /S.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zimsms</div><div class="date">25th May 2004, 16:30</div></div><div class="posttext">Well, make.exe was built using NSIS. Is there a way I can make it a console app, so that it will wait as I expect?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">s793016</div><div class="date">25th May 2004, 16:43</div></div><div class="posttext">Try run it through START.EXE<br />
<br />
<br />
StrCpy $1 $Windir<br />
StrCpy $2 '$Sysdir\cmd.exe'<br />
IfFileExists '$Windir\START.EXE' +3<br />
 StrCpy $1 '$Windir\Command'<br />
 StrCpy $2 '$1.com'<br />
<br />
nsexec::EXEC '&quot;$2&quot; /c &quot;$1\start.exe&quot; /wait &quot;${NSISDir}\make.exe&quot; /bla /bla'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th May 2004, 18:00</div></div><div class="posttext">Originally posted by zimsms <br />
Well, make.exe was built using NSIS. Is there a way I can make it a console app, so that it will wait as I expect? Only if you intend to make console only (always silent). That would require recompiling without the visible option in config.h and as console application (one of VC's settings). It would be simpler to use start.exe as s793016 mentioned, but outside of an installer and in a batch file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zimsms</div><div class="date">26th May 2004, 15:25</div></div><div class="posttext">The Start command specifies the following:<br />
<br />
When executing an application that is a 32-bit GUI application, CMD.EXE does not wait for the application to terminate before returning to the command prompt.  This new behavior does NOT occur if executing within a command script.<br />
<br />
So start cannot be used since nsis compiles as a 32-bit GUI application.<br />
<br />
I have resolved this issue by creating a console based app in Visual C#. Only a few lines that monitor the make.exe process and force a wait until the process has finished.<br />
<br />
I've included the C# source below. Note this will only work on a machine with the .NET Framework installed, as my build machine does.<br />
<br />
Be sure to create a C# Console Based Application, you may need to modify the namespace appropriately.<br />
<br />
<br />
using System;<br />
using System.Diagnostics;<br />
using System.ComponentModel;<br />
<br />
<br />
namespace ExecWait<br />
{<br />
	/// &lt;summary&gt;<br />
	/// Summary description for Class1.<br />
	/// &lt;/summary&gt;<br />
	class Execute<br />
	{<br />
		/// &lt;summary&gt;<br />
		/// The main entry point for the application.<br />
		/// &lt;/summary&gt;<br />
		[STAThread]<br />
		static void Main(string[] args)<br />
		{<br />
            System.Diagnostics.Process myProcess = new System.Diagnostics.Process();<br />
			myProcess.StartInfo.FileName = &quot;Make.exe&quot;;<br />
			myProcess.StartInfo.Arguments = &quot;/S&quot;;<br />
			myProcess.Start();<br />
 <br />
            myProcess.Wait*****it();			<br />
		}<br />
	}<br />
}</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>