<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Help with dlls, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Help with dlls NSIS Discussion" />
	
	<title> Help with dlls [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Help with dlls</div>
<hr />
<div class="pda"><a href="t-154746.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=154746">Help with dlls</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">j27lee</div><div class="date">31st October 2003, 23:05</div></div><div class="posttext">Hi all, <br />
<br />
I'm trying to call an external dll to validate a CD Key and am not sure the dll is even getting called.  Is there a way to test this?<br />
<br />
The dll returns a 1 if the key is valid and a 0 if it is invalid.  Here's the section that deals with this.<br />
<br />
  SetOutPath $INSTDIR\dll             <br />
  File bin\KeyCheck.dll                   <br />
<br />
  StrCpy $0 &quot;1234567812345678&quot;<br />
<br />
  MessageBox MB_OK &quot;CDKEY: $0&quot;<br />
  System::Call &quot;KeyCheck::isCDKeyValid(t r0) i r1&quot;<br />
  MessageBox MB_OK &quot;RETURN_CODE after: $1&quot;<br />
<br />
If I run this, I get a MB with &quot;RETURN_CODE: &quot;.  So I'm not sure if the dll is even being called.  The interface is this:<br />
<br />
INTERFACE bool isCDKeyValid(const char * cdKey);<br />
<br />
any help would be appreciated!<br />
<br />
Thanks,<br />
<br />
James</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st October 2003, 23:18</div></div><div class="posttext">You forgot the dot before r1. Use:<br />
<br />
System::Call &quot;KeyCheck::isCDKeyValid(t r0) i .r1&quot;<br />
<br />
That dot tells System.dll to ignore the input for the return value (which you should always do beacuse there is no need for input for something that doesn't take any) and treat $1 as the output for the return value.<br />
<br />
BTW, why not create a NSIS plug-in? It would be much easier to use. There are template for more than one programming language in Contrib\ExDLL.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">j27lee</div><div class="date">31st October 2003, 23:33</div></div><div class="posttext">Thanks kichik,<br />
<br />
When I add the dot before r1, I get &quot;RETURN_CODE after: error&quot;.  There is one parameter (r0) unless I'm using this wrong.  I noticed a change in syntax from &quot;System::Call &quot;CondMgr::isCDKeyValid(t) i(.r0) .r1&quot; to the current syntax.  Am I more off base than I think?<br />
<br />
Is there any way to determine the error? or is that a function of the boolean type?<br />
<br />
As for plugins, I haven't tried, but figured I would try with the dll as it existed.  How would the implementation differ?  Can they still be used as dlls from other apps?<br />
<br />
Thanks,<br />
<br />
james</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st October 2003, 23:58</div></div><div class="posttext">If you are using NSIS b3 try adding another SetOutPath line (there is a bug with the current directory setting code). If you are using the latest CVS version, make sure the exported name is exactly the one used in the script. Use Dependency Walker to make sure.<br />
<br />
There is no difference between (t)i (.r0) .r1 and (t .r0) i .r1. It's just System.dll allowing you to override the parameters with another set. It's useful if one wants to define a function using !define. For Example:<br />
<br />
!define MyFunc &quot;MyDLL::MyFunc (t 'default string', i, i 4)&quot;<br />
System::Call &quot;${MyFunc} ('another string', 3, )&quot;<br />
<br />
As for the NSIS plug-in, you will be able to keep the other function. You will just need to add another function that NSIS can call that will be a wrapper for the original function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">j27lee</div><div class="date">3rd November 2003, 18:41</div></div><div class="posttext">Thanks for your help kichik... i think i understand the whole thing a bit better now.  In my case, turns out the dll was to blame.<br />
<br />
Thanks again,<br />
<br />
James</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>