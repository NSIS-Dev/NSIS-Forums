<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Find string offset in exe or dll, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Find string offset in exe or dll NSIS Discussion" />
	
	<title> Find string offset in exe or dll [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Find string offset in exe or dll</div>
<hr />
<div class="pda"><a href="t-272038.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=272038">Find string offset in exe or dll</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Rolando</div><div class="date">31st May 2007, 03:19</div></div><div class="posttext">I was searching for a function that can give me the offset in where a string can be found inside a exe/dll file and came across this (http://nsis.sourceforge.net/Find_a_string_in_an_e.g._exe_or_dll_file). Now that function seems to do the job quite well, only it doesn't give me the hexadecimal or decimal offset of where the string I searched for is found. Is there anyway to do that?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">31st May 2007, 08:14</div></div><div class="posttext">Push &quot;C:\Program Files\NSIS\makensis.exe&quot;<br />
Push &quot;KERNEL32&quot;<br />
Push 0	; offset to start<br />
Call BinStrSearch<br />
Pop $1  ; address of string or 0 if not found<br />
<br />
I use the code shown above to call BinStrSearch; I've just added it to the Wiki (http://nsis.sourceforge.net/BinStrSearch) since I can't find the original function at the moment.<br />
<br />
It will return the decimal offset, but you can convert it to hex with a single statement:Pop $1<br />
IntFmt $1 &quot;0x%04x&quot; $1<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Rolando</div><div class="date">31st May 2007, 12:15</div></div><div class="posttext">well thanks for that, but the weird thing is that using SearchByteFile (http://nsis.sourceforge.net/Find_a_string_in_an_e.g._exe_or_dll_file) I do find the string but I can't know the offset however, using BinStrSearch (http://nsis.sourceforge.net/BinStrSearch) returns 0 for the same string, meaning it's not found.<br />
<br />
Isn't it possible to modify the first function and make it return the offset?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st May 2007, 13:45</div></div><div class="posttext">I shall re-write that function is it doesn't always work with the offset (or -1) as the output.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st May 2007, 14:02</div></div><div class="posttext">Try this:<br />
<br />
Function SearchBinaryFile<br />
Exch $R0 # file<br />
Exch<br />
Exch $R1 # search<br />
Push $R2<br />
Push $R3<br />
Push $R4<br />
Push $R5<br />
Push $R6<br />
<br />
  StrLen $R2 $R1<br />
  ClearErrors<br />
  FileOpen $R3 $R0 r<br />
  IfErrors error<br />
  StrCpy $R0 0<br />
<br />
  read:<br />
    StrCpy $R6 ``<br />
    StrCpy $R4 0<br />
    read_string:<br />
      ClearErrors<br />
        FileReadByte $R3 $R5<br />
      IfErrors error<br />
      IntFmt $R5 %c $R5<br />
      StrCpy $R6 $R6$R5<br />
      IntOp $R4 $R4 + 1<br />
    StrCmp $R4 $R2 0 read_string<br />
<br />
    StrCmp $R6 $R1 done<br />
      IntOp $R0 $R0 + 1<br />
      FileSeek $R3 $R0 SET<br />
      Goto read<br />
<br />
  error:<br />
    StrCpy $R0 -1<br />
    Goto +2<br />
  done:<br />
    FileClose $R3<br />
<br />
Pop $R6<br />
Pop $R5<br />
Pop $R4<br />
Pop $R3<br />
Pop $R2<br />
Pop $R1<br />
Exch $R0 # offset or -1<br />
FunctionEnd<br />
<br />
<br />
Usage:<br />
<br />
Push &quot;string&quot;<br />
Push &quot;path\to\file.ext&quot;<br />
  Call SearchBinaryFile<br />
Pop $R0 # offset / -1<br />
<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>