<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" output files altered by language selection, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  output files altered by language selection NSIS Discussion" />
	
	<title> output files altered by language selection [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  output files altered by language selection</div>
<hr />
<div class="pda"><a href="t-215009.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=215009">output files altered by language selection</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">cri_ned</div><div class="date">5th May 2005, 13:52</div></div><div class="posttext">Hi, <br />
<br />
I'm sorry to bug you all with this new topic, but I am a newbie and I didn't quite understand the other posts about this.<br />
<br />
The problem I have is that I need to split my installer according to the language selected by the user during .oninit.<br />
I am using:<br />
<br />
Function .onInit<br />
<br />
  !insertmacro MUI_LANGDLL_DISPLAY<br />
<br />
FunctionEnd<br />
<br />
After the language is selected by the user I need to have different sections for each language selection. The problem I have is that I do not know how to recognize the language the user has selected, so that it will point to a section or another. Thanks a lot for the help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">5th May 2005, 13:55</div></div><div class="posttext">you can query the $LANGUAGE (http://nsis.sourceforge.net/Docs/Chapter4.html#4.2.3) variable</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cri_ned</div><div class="date">5th May 2005, 14:00</div></div><div class="posttext">Thanks for the quick reply. any help on how I could do that, because I didn't get much from that link (I read it over and over again before, thanks... )</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">5th May 2005, 14:10</div></div><div class="posttext">What is it mean<br />
After the language is selected by the user I need to have different sections for each language selection.<br />
Is you want different sections names or other?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cri_ned</div><div class="date">5th May 2005, 14:17</div></div><div class="posttext">What I mean is that when a language is selected, my program will install different files. Each language has something different, so I can't install the whole package, I need the option in the installer...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">5th May 2005, 14:24</div></div><div class="posttext">You can use in section:<br />
<br />
StrCmp $LANGUAGE 1033 0 ruslang<br />
  ... install some english files ....<br />
ruslang:<br />
StrCmp $LANGUAGE 1049 0 germanlang<br />
  ... install some russian files ....<br />
germanlang:<br />
StrCmp $LANGUAGE 1031 0 otherlang<br />
  ... install some german files ....<br />
otherlang:<br />
<br />
<br />
ADD:<br />
All languages ID you can find using MakeLangID-tool or in language files.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cri_ned</div><div class="date">5th May 2005, 14:42</div></div><div class="posttext">Thanks a lot. It helped me, and it now works.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th May 2005, 16:01</div></div><div class="posttext">Make sure you put some Goto's in there so it doesn't go through the whole StrCmp group:<br />
<br />
StrCmp $LANGUAGE 1033 0 ruslang<br />
  ... install some english files ....<br />
Goto End<br />
ruslang:<br />
StrCmp $LANGUAGE 1049 0 germanlang<br />
  ... install some russian files ....<br />
Goto End<br />
germanlang:<br />
StrCmp $LANGUAGE 1031 0 otherlang<br />
  ... install some german files ....<br />
Goto End<br />
otherlang:<br />
<br />
End:<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th May 2005, 18:02</div></div><div class="posttext">Or simply use the LogicLib:!include LogicLib.nsh<br />
#...<br />
${Switch} $LANGUAGE<br />
  ${Case} ${LANG_ENGLISH}<br />
    File en.txt<br />
	${Break}<br />
  ${Case} ${LANG_FRENCH}<br />
    File fr.txt<br />
    ${Break}<br />
  ${Case} ${LANG_HEBREW}<br />
    File he.txt<br />
    ${Break}<br />
${EndSwitch}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cri_ned</div><div class="date">10th May 2005, 14:05</div></div><div class="posttext">Thanks, I think I'll write the whole thing again. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cri_ned</div><div class="date">16th May 2005, 13:57</div></div><div class="posttext">Hey, I have one more question. <br />
<br />
My installer uses in .onInit some message boxes. How can I alter them using the language selection? I already used langstring and  added a message for each language, but it won't display in .onInit. <br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">16th May 2005, 14:55</div></div><div class="posttext">Originally posted by cri_ned <br />
 I already used langstring and  added a message for each language, but it won't display in .onInit. <br />
 <br />
Messageboxes didn't display or they displayed but with not correct language?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cri_ned</div><div class="date">16th May 2005, 15:00</div></div><div class="posttext">Messageboxes are displayed, but are in the default language, in English. I wondered if I could change that. I tried adding a section, but the message box did not display...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">16th May 2005, 15:09</div></div><div class="posttext">This problem was discussed. In .onInit you can compare $LANGUAGE with language id.<br />
Try this (http://forums.winamp.com/showthread.php?s=&amp;threadid=147907&amp;highlight=messagebox+oninit) and this (http://forums.winamp.com/showthread.php?s=&amp;threadid=213079&amp;highlight=messagebox+multilanguage) links.<br />
And try to search for forum with &quot;MessageBox&quot; and &quot;multilanguage&quot; or &quot;.onInit&quot; for more examples.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cri_ned</div><div class="date">6th June 2005, 16:00</div></div><div class="posttext">Could someone please help me on how to use this piece of code for my situation? I need to choose the language from the command line, but I don't quite get how to use the code.<br />
<br />
 ; GetParameters<br />
 ; input, none<br />
 ; output, top of stack (replaces, with e.g. whatever)<br />
 ; modifies no other variables.<br />
 <br />
 Function GetParameters<br />
 <br />
   Push $R0<br />
   Push $R1<br />
   Push $R2<br />
   Push $R3<br />
   <br />
   StrCpy $R2 1<br />
   StrLen $R3 $CMDLINE<br />
   <br />
   ;Check for quote or space<br />
   StrCpy $R0 $CMDLINE $R2<br />
   StrCmp $R0 '&quot;' 0 +3<br />
     StrCpy $R1 '&quot;'<br />
     Goto loop<br />
   StrCpy $R1 &quot; &quot;<br />
   <br />
   loop:<br />
     IntOp $R2 $R2 + 1<br />
     StrCpy $R0 $CMDLINE 1 $R2<br />
     StrCmp $R0 $R1 get<br />
     StrCmp $R2 $R3 get<br />
     Goto loop<br />
   <br />
   get:<br />
     IntOp $R2 $R2 + 1<br />
     StrCpy $R0 $CMDLINE 1 $R2<br />
     StrCmp $R0 &quot; &quot; get<br />
     StrCpy $R0 $CMDLINE &quot;&quot; $R2<br />
   <br />
   Pop $R3<br />
   Pop $R2<br />
   Pop $R1<br />
   Exch $R0<br />
 <br />
 FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">6th June 2005, 16:59</div></div><div class="posttext">Put in .onInit<br />
<br />
Call GetParameters<br />
Pop $R0<br />
${Switch} $R0<br />
  ${Case} &quot;english&quot;<br />
    StrCpy $Language ${LANG_ENGLISH}<br />
	${Break}<br />
  ${Case} &quot;french&quot;<br />
    StrCpy $Language ${LANG_FRENCH}<br />
    ${Break}<br />
${EndSwitch}<br />
<br />
Add ${Case} &quot;...&quot; for other languages.<br />
Command line must beoutfile.exe language</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cri_ned</div><div class="date">7th June 2005, 08:15</div></div><div class="posttext">Thanks glory. Should I leave the getparams function like that, or do I have to make it look like the piece of code you sent me? I'm sorry to bug you, but I'm quite a noob... :confused:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">7th June 2005, 12:27</div></div><div class="posttext">As i understand - this is function from NSIS docs. So put function's code into your script and include my code into .onInit function. Don't forget include LogicLib.nsh if it is not present.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th June 2005, 14:00</div></div><div class="posttext">Small typo: !include LogicLib.nsh<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cri_ned</div><div class="date">7th June 2005, 14:57</div></div><div class="posttext">Hi, thanks to all for the replies. Now I'm facing a different problem. It will only install in English, and it won't write the registry key for the language.<br />
<br />
I use this code:<br />
<br />
StrCmp $LANGUAGE 1033 0 ruslang<br />
... install some english files ....<br />
Goto End<br />
ruslang:<br />
StrCmp $LANGUAGE 1049 0 germanlang<br />
... install some russian files ....<br />
Goto End<br />
germanlang:<br />
StrCmp $LANGUAGE 1031 0 otherlang<br />
... install some german files ....<br />
Goto End<br />
otherlang:<br />
<br />
End:<br />
<br />
, from Stu (thanks btw)<br />
<br />
Also, in order to write the reg key for the uninstaller I use:<br />
<br />
  !define MUI_LANGDLL_REGISTRY_ROOT &quot;HKCU&quot;<br />
  !define MUI_LANGDLL_REGISTRY_KEY &quot;something...&quot;<br />
  !define MUI_LANGDLL_REGISTRY_VALUENAME &quot;Installer Language&quot;<br />
.<br />
<br />
The code for the command line selection is:<br />
<br />
Call GetParameters<br />
<br />
Pop $R0<br />
${Switch} $R0<br />
<br />
  ${Case} &quot;en&quot;<br />
    StrCpy $Language ${LANG_ENGLISH}<br />
	${Break}<br />
<br />
  ${Case} &quot;fr&quot;<br />
    StrCpy $Language ${LANG_FRENCH}<br />
    ${Break}<br />
<br />
and some other languages, written just the same way<br />
${EndSwitch}<br />
<br />
<br />
in other words, I'm stuck again. <br />
<br />
Ps, I did !include LogicLib.nsh</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cri_ned</div><div class="date">8th June 2005, 08:19</div></div><div class="posttext">Ok, it now works. I wasn't waiting for the installer to do what it was supposed to. <br />
<br />
The only problem I've got left is with the registry. It won't write the language in which it is installed, and when uninstalling it will ask for a selection...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cri_ned</div><div class="date">7th July 2005, 14:22</div></div><div class="posttext">Is it possible to also add a rule in which case if there is no parameter, the default value would be to install in English? Because at this point if I use no parameter it will install in the default windows language... and I don't want it to act like this.... Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">7th July 2005, 15:24</div></div><div class="posttext">Instead  this rule<br />
 ${Case} &quot;en&quot;<br />
StrCpy $Language ${LANG_ENGLISH}<br />
${Break}<br />
<br />
you can use<br />
<br />
${Default}<br />
StrCpy $Language ${LANG_ENGLISH}<br />
${Break}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th July 2005, 15:25</div></div><div class="posttext">Call GetParamaters<br />
 Pop $R0<br />
 StrCmp $R0<br />
  StrCpy $LANGUAGE ${LANG_ENGLISH}<br />
<br />
<br />
As for the registry, there's Modern UI Examples which do this for you.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cri_ned</div><div class="date">11th July 2005, 15:03</div></div><div class="posttext">Hi, thanks for the quick help.<br />
<br />
The problem with the uninstall is that if I leave !insertmacro MUI_UNGETLANGUAGE it will use the default windows language. If I comment it, it will ask for the language it should display. I cannot get it to write in the registry the language key, as explained in the Modern UI examples...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">11th July 2005, 15:16</div></div><div class="posttext">MUI_UNGETLANGUAGE should use register keys specified with MUI_LANGDLL_REGISTRY_ROOT, MUI_LANGDLL_REGISTRY_KEY, MUI_LANGDLL_REGISTRY_VALUENAME defines.<br />
<br />
Add:<br />
Maybe you do not save them during installation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cri_ned</div><div class="date">12th July 2005, 12:15</div></div><div class="posttext">I already have   <br />
<br />
!define MUI_LANGDLL_REGISTRY_ROOT &quot;HKCU&quot;<br />
!define MUI_LANGDLL_REGISTRY_KEY &quot;the software location...&quot;<br />
!define MUI_LANGDLL_REGISTRY_VALUENAME &quot;Installer Language&quot;<br />
<br />
The problem is it doesn't save them... does it matter if this code is before the get params function?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">12th July 2005, 13:16</div></div><div class="posttext">These defines should be set before inserting the installation page macro.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cri_ned</div><div class="date">12th July 2005, 13:24</div></div><div class="posttext">Yup, it's before. And it still doesn't write it in the registry... Could it be because of the fact that I'm choosing the language with this code?<br />
<br />
Call GetParameters<br />
<br />
Pop $R0<br />
${Switch} $R0<br />
<br />
${Case} &quot;en&quot;<br />
StrCpy $Language ${LANG_ENGLISH}<br />
${Break}<br />
<br />
${Case} &quot;fr&quot;<br />
StrCpy $Language ${LANG_FRENCH}<br />
${Break}<br />
<br />
and some other languages, written just the same way<br />
${EndSwitch}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th July 2005, 14:00</div></div><div class="posttext">Could you write a cut down script which causes this problem?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">12th July 2005, 14:03</div></div><div class="posttext">Try to change ${Case} &quot;en&quot; -&gt; ${Default}.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cri_ned</div><div class="date">13th July 2005, 10:26</div></div><div class="posttext">Well I have the begining of the script, with some dfines, including some variables of my own, for when specific situations occur, like:<br />
<br />
!define AFFILIATE_STRING &quot;something...&quot;<br />
<br />
!define ENGLISH_LANGUAGE<br />
!define FRENCH_LANGUAGE<br />
!define GERMAN_LANGUAGE<br />
!define SPANISH_LANGUAGE<br />
!define DUTCH_LANGUAGE<br />
!define DANISH_LANGUAGE<br />
!define SWEDISH_LANGUAGE<br />
(I am not always using all the languages)<br />
<br />
!define SILENT_BUILD<br />
<br />
<br />
after this I have:<br />
<br />
  !define MUI_LANGDLL_REGISTRY_ROOT &quot;HKCU&quot;<br />
  !define MUI_LANGDLL_REGISTRY_KEY &quot;something...&quot;<br />
  !define MUI_LANGDLL_REGISTRY_VALUENAME &quot;Installer Language&quot;<br />
<br />
After that are the name and all, and the get params as seen here, as long with the on init part of getparams:<br />
<br />
in oninit I have this:<br />
<br />
!ifdef SILENT_BUILD<br />
Call GetParameters<br />
<br />
Pop $R0<br />
${Switch} $R0<br />
<br />
  ${Default}<br />
    StrCpy $Language ${LANG_ENGLISH}<br />
    ${Break}<br />
<br />
  ${Case} &quot;/fr&quot;<br />
    StrCpy $Language ${LANG_FRENCH}<br />
    ${Break}<br />
<br />
  ${Case} &quot;/de&quot;<br />
    StrCpy $Language ${LANG_GERMAN}<br />
    ${Break}<br />
<br />
  ${Case} &quot;/es&quot;<br />
    StrCpy $Language ${LANG_SPANISH}<br />
    ${Break}<br />
<br />
  ${Case} &quot;/nl&quot;<br />
    StrCpy $Language ${LANG_DUTCH}<br />
    ${Break}<br />
<br />
  ${Case} &quot;/dk&quot;<br />
    StrCpy $Language ${LANG_DANISH}<br />
    ${Break}<br />
<br />
  ${Case} &quot;/se&quot;<br />
    StrCpy $Language ${LANG_SWEDISH}<br />
    ${Break}<br />
<br />
${EndSwitch}<br />
<br />
!endif<br />
<br />
The install part works ok, I don't have any errors or anything. The problem is with the uninstall.<br />
<br />
in un.oninit I have this as the first line:<br />
<br />
!insertmacro MUI_UNGETLANGUAGE<br />
.<br />
<br />
If left like this, it will ask to pick the language. If commented, it will use the default windows language, not the one picked for the install.<br />
<br />
That is where I have the problem...<br />
<br />
Thanks a lot for the help.<br />
Cristi</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cri_ned</div><div class="date">19th July 2005, 11:42</div></div><div class="posttext">Hi, <br />
<br />
Me again :)<br />
<br />
any ideea, or is it something like a bug?<br />
<br />
I still haven't found out why it doesn't write the registry key.<br />
<br />
thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">19th July 2005, 13:14</div></div><div class="posttext">Can you attach whole script?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cri_ned</div><div class="date">21st July 2005, 09:16</div></div><div class="posttext">Hi,<br />
<br />
I'm sorry I didn't put the script. I have to make a shorter version of it. Just to let you know, I found a fix for the problem by working around it, and reading a different registry key that my program allready put there, in order to know the language. I used this code:<br />
<br />
  ReadRegStr $0 HKCU Software\... &quot;Language&quot;<br />
<br />
${If} $0 S== &quot;en&quot;<br />
StrCpy $LANGUAGE ${LANG_ENGLISH}<br />
${Else}<br />
<br />
   ${If} $0 S== &quot;fr&quot;<br />
   StrCpy $LANGUAGE ${LANG_FRENCH}<br />
   ${Else}<br />
<br />
    ${If} $0 S== &quot;se&quot;<br />
    StrCpy $LANGUAGE ${LANG_SWEDISH}<br />
    ${Else}<br />
<br />
     ${If} $0 S== &quot;de&quot;<br />
     StrCpy $Language ${LANG_GERMAN}<br />
     ${Else}<br />
<br />
      ${If} $0 S== &quot;es&quot;<br />
      StrCpy $Language ${LANG_SPANISH}<br />
      ${Else}<br />
<br />
       ${If} $0 S== &quot;nl&quot;<br />
       StrCpy $Language ${LANG_DUTCH}<br />
       ${Else}<br />
<br />
        ${If} $0 S== &quot;dk&quot;<br />
        StrCpy $Language ${LANG_DANISH}<br />
        ${Else}<br />
<br />
         ${If} $0 S== &quot;it&quot;<br />
         StrCpy $Language ${LANG_ITALIAN}<br />
         ${Else}<br />
         ${EndIf}<br />
        ${EndIf}<br />
       ${EndIf}<br />
      ${EndIf}<br />
     ${EndIf}<br />
    ${EndIf}<br />
   ${EndIf}<br />
${EndIf}<br />
<br />
and the uninstaller works in what language I need. I'll put the shorter script later this week, in order to let you guys check if it is a bug or something because of me. :)<br />
<br />
Cristi</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">21st July 2005, 11:10</div></div><div class="posttext">Simple comment.<br />
Instead combination ${Else} ${If} you can use ${ElseIf} and close it with one ${EndIf}.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cri_ned</div><div class="date">6th September 2005, 13:37</div></div><div class="posttext">Hi all,<br />
<br />
I have a new problem. I use a page that is from an ini. It has some text, which I need to be able to display according to the language of the installer. Is there a way to use those pages in a similar manner to this:<br />
<br />
LicenseLangString license ${LANG_ITALIAN} &quot;D:\...\license.txt&quot; ?<br />
<br />
Thanks a lot for the help guys. I don't know where my installer would be without you. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th September 2005, 13:52</div></div><div class="posttext">You need to write the language string to the INI file on run-time with WriteINIStr:<br />
<br />
WriteINIStr &quot;$PLUGINSDIR\ioFile.ini&quot; &quot;Field #&quot; &quot;Text&quot; &quot;$(license)&quot;<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">15th September 2005, 16:29</div></div><div class="posttext">Multilingual example in Moreinfo<br />
<br />
Multilingual example in Moreinfo plugin. Multi language in an easy extensible way in one of the demos. Will solve a lot of multilanguage language problems.<br />
The &quot;CustomLanguageDemo&quot; Fully shows the power of getting the OS GUI language. I the demo a good example of how custompage localization works and could be implemented.<br />
<br />
See the Wikipage<br />
<br />
http://nsis.sourceforge.net/wiki/MoreInfo_plug-in<br />
<br />
Or take a look in:<br />
<br />
http://forums.winamp.com/showthread...hlight=moreinfo<br />
<br />
Just try the &quot;CustomLanguageDemo&quot; demo included.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>