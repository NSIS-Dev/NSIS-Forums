<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" installer crash when launching Windows Explorer when MUI_PAGE_INSTFILES is displayed, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  installer crash when launching Windows Explorer when MUI_PAGE_INSTFILES is displayed NSIS Discussion" />
	
	<title> installer crash when launching Windows Explorer when MUI_PAGE_INSTFILES is displayed [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  installer crash when launching Windows Explorer when MUI_PAGE_INSTFILES is displayed</div>
<hr />
<div class="pda"><a href="t-281837.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=281837">installer crash when launching Windows Explorer when MUI_PAGE_INSTFILES is displayed</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">bobics</div><div class="date">20th November 2007, 20:36</div></div><div class="posttext">Hi,<br />
<br />
I'm displaying MUI_PAGE_INSTFILES as the last page of my installer.  Before I click the &quot;Close&quot; button, if I *manually* launch Windows Explorer (e.g. via the start menu or Windows-e), the installer executable crashes.<br />
<br />
The error message is a typical program crash dialog, &quot;setup.exe has encountered a problem and needs to close.&quot;  If I click for more info it doesn't tell me much (ModName: unknown).<br />
<br />
After upgrading to NSIS 2.33, I still see the problem.  When I create a simple default installer with MUI dialogs, I don't see this problem.  With an older version of my setup I don't see this problem either, and I'm pretty sure I didn't change anything in the NSIS script since then (I was on NSIS 2.31 but wasn't able to repro with a simple script either).  I was able to repro this problem on several machines.<br />
<br />
Any ideas / suggestions before I start stripping out lines from my 2000+ line script?<br />
<br />
Thanks,<br />
-bobics</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th November 2007, 21:17</div></div><div class="posttext">It's probably a plug-in which is loaded in .onInit or .onGUIInit and isn't properly disabled before the installer exits. Start by striping those lines to see who's at fault.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bobics</div><div class="date">28th November 2007, 23:39</div></div><div class="posttext">After quite a bit of scrambling I got lucky and found that a DLL I'm registering during the install process is causing the NSIS installer to crash.<br />
<br />
This particular DLL is (statically, I think) loading gdiplus.dll during registration.  I used a dependency tool (depends.exe) to monitor the installer process and saw that GDIPLUS.DLL is unloaded after registration.<br />
<br />
Later, when I move the installer window around after it has completed the install, it crashes.  I believe this is because NSIS is using gdiplus.dll.  Now, my opinion is that I'm doing something wrong in the self-registration code of the DLL where I'm unloading gdipluss.dll while it is still being used by the installer (when I say 'I' I mean my developer).<br />
<br />
Can anyone more experienced with self registering DLLs give me some advice?<br />
<br />
Thanks,<br />
-bobics</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bobics</div><div class="date">28th November 2007, 23:43</div></div><div class="posttext">Also, my current workaround that works is to use regsvr32 instead of UnRegDLL / InstallLib.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th November 2007, 17:00</div></div><div class="posttext">NSIS isn't using gdiplus.dll. Registration is nothing but calling DllRegisterServer. What makes you think gdiplus.dll is the culprit?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bobics</div><div class="date">29th November 2007, 19:24</div></div><div class="posttext">While in some ways I am shooting in the dark here, here are a few things in particular I've noticed that seem to hint at gdiplus:<br />
<br />
- Between a Friday build where we didn't see the problem and a Monday build where we did see the crash, very little has changed in our application except adding of the gdiplus depedency.<br />
- Once when I saw the crash, there was an error message pointing to &quot;GDI Plus Window&quot;.<br />
- If I just wait on the final installer page there is no crash until either A) I start moving the installer window around or B) open up another window of a different app while the installer is running.  This makes me think it's a UI related problem since nothing in the script is running at this point.<br />
<br />
Take these bullets in combination with there being no crash when using regsvr32.exe and the fact that the installer code has not changed.<br />
<br />
Of course, at this point this is still basically speculation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bobics</div><div class="date">29th November 2007, 19:26</div></div><div class="posttext">Also, you're right, NSIS doesn't use gdiplus.dll... I did some investigation and when I don't register our DLL, gdiplus.dll is never loaded by the installer.  user32.dll (which NSIS does use) does point to gdiplus.dll but as a delay-load module that never is referenced, which shouldn't cause a problem.<br />
<br />
So it is a mystery to me.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th November 2007, 19:59</div></div><div class="posttext">I'd start by getting a stack trace of the crash using windbg and some symbols.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>