<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Adding lines after a specific string in an ini, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Adding lines after a specific string in an ini NSIS Discussion" />
	
	<title> Adding lines after a specific string in an ini [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Adding lines after a specific string in an ini</div>
<hr />
<div class="pda"><a href="t-156247.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=156247">Adding lines after a specific string in an ini</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Trestkon</div><div class="date">15th November 2003, 00:44</div></div><div class="posttext">I realize that other people have asked similar questions, but I'm finding I'm having a very hard time wrapping my head around this one.  I can figure out everything else I need to do for my installer, but this one has left me in the dark.<br />
<br />
Also, I know that the standard reply is:<br />
<br />
Use FileOpen, FileWrite, FileRead and FileClose. See the Archive for examples. <br />
<br />
But I'm having some troubles with that:(<br />
<br />
I should also note that the files I'm working on is not a REAL .ini, the game (DeusEx) just has it named that way, but .ini commands such as WriteINIStr still work:)<br />
<br />
So about halfway down in the files there is the following:<br />
<br />
[Core.System]<br />
PurgeCacheDays=30<br />
SavePath=..\Save<br />
CachePath=..\Cache<br />
CacheExt=.uxx<br />
Paths=..\TNM\Music\*.u<br />
Paths=..\TNM\Maps\*.dx<br />
Paths=..\TNM\Textures\*.utx<br />
Paths=..\TNM\Sounds\*.uax<br />
Paths=..\TNM\Music\*.umx<br />
<br />
And I want to modify it so that I have this:<br />
<br />
[Core.System]<br />
PurgeCacheDays=30<br />
SavePath=..\Save<br />
CachePath=..\Cache<br />
CacheExt=.uxx<br />
Paths=..\Music\*.u<br />
Paths=..\Maps\*.dx<br />
Paths=..\Textures\*.utx<br />
Paths=..\Sounds\*.uax<br />
Paths=..\Music\*.umx<br />
<br />
Any help would be greatly appreciated:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th November 2003, 09:32</div></div><div class="posttext">There are many string manipulation functions on the NSIS Archive:<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=311&amp;instances=0,11<br />
<br />
You will need to create a new function basing it upon them.<br />
I'd write you one myself, but I cannot currently.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th November 2003, 15:21</div></div><div class="posttext">You can use the one that replaces strings in the file and replace &quot;Paths=..\TNM\&quot; with &quot;Paths=..\&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Trestkon</div><div class="date">15th November 2003, 16:36</div></div><div class="posttext">Hmm, looking at my post, I can see I was a little more tired than I thought.  I actually have to ADD allof the TNM lines, so it would look like so:<br />
<br />
[Core.System] <br />
PurgeCacheDays=30 <br />
SavePath=..\Save <br />
CachePath=..\Cache <br />
CacheExt=.uxx <br />
Paths=..\TNM\Music\*.u <br />
Paths=..\TNM\Maps\*.dx <br />
Paths=..\TNM\Textures\*.utx <br />
Paths=..\TNM\Sounds\*.uax <br />
Paths=..\TNM\Music\*.umx <br />
Paths=..\Music\*.u <br />
Paths=..\Maps\*.dx <br />
Paths=..\Textures\*.utx <br />
Paths=..\Sounds\*.uax <br />
Paths=..\Music\*.umx <br />
<br />
<br />
I tried the string replacing bit, but it overwrites the old ones with my new ones (which it's obviously supposed to do:p) So I'll check out that link right now.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">15th November 2003, 17:11</div></div><div class="posttext">INI files should not have duplicate names, add numbers or something else.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Trestkon</div><div class="date">15th November 2003, 17:13</div></div><div class="posttext">Ya, as I said, it's a core game file, so really, the programmers just decided to give it a .ini extention.  In actual fact, it's just a text file they renamed to make it seem more important.<br />
<br />
I looked into http://nsis.sourceforge.net/archive...&amp;instances=0,11  which does search for strings in a file, but it also loops all the way through.  What I want to do it run a search loop until it find a certain line, and then insert a new line (so I dont' overwrite the lines following it) and write in my new paths.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">15th November 2003, 18:10</div></div><div class="posttext">I think the easier method is to read every line of the file, search for the line and then write everything back, including the new line.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Trestkon</div><div class="date">15th November 2003, 18:18</div></div><div class="posttext">Originally posted by Joost Verburg <br />
I think the easier method is to read every line of the file, search for the line and then write everything back, including the new line.  <br />
<br />
Eeep, this is starting to sound quite complicated:eek:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">15th November 2003, 18:38</div></div><div class="posttext">It's not that difficult. Use the NSIS file commands to read the lines and then write everything back to the file. When writing back, write 2 lines when you found a certain line.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Trestkon</div><div class="date">15th November 2003, 18:45</div></div><div class="posttext">Originally posted by Joost Verburg <br />
It's not that difficult. Use the NSIS file commands to read the lines and then write everything back to the file. When writing back, write 2 lines when you found a certain line.  <br />
<br />
I'll...try.  My NSIS skills are somewhat on the noobish side, but we'll see.<br />
<br />
Bah, I have no clue:(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Trestkon</div><div class="date">16th November 2003, 17:35</div></div><div class="posttext">Well, I've been poking around the archives, and I found a script to replace a line of text in the file.  My thinking is that I can modify it to search out the line before the place where I want to add in my extra stuff, and then have it replace that line with itself, and my extra lines, like this:<br />
<br />
CacheExt=.uxx  &lt;--Searches for this line<br />
Paths=..\System\*.u<br />
Paths=..\Textures\*.utx<br />
Paths=..\Sounds\*.uax<br />
Paths=..\Music\*.umx<br />
<br />
<br />
And I have it replace that line with:<br />
<br />
CacheExt=.uxx<br />
Paths=..\TNM\System\*.u<br />
Paths=..\TNM\Maps\*.dx<br />
Paths=..\TNM\Textures\*.utx<br />
Paths=..\TNM\Music\*.umx<br />
Paths=..\TNM\Sounds\*.umx<br />
Paths=..\System\*.u<br />
Paths=..\Textures\*.utx<br />
Paths=..\Sounds\*.uax<br />
Paths=..\Music\*.umx<br />
<br />
I tried modifying the script that I found to do what I want.  I really don't need it to loop, as there is only one occurance of &quot;CacheExt=.uxx&quot; in the file, but to be honest, I couldn't figure out which part of the loop I needed to keep.  I would greatly appreciate it if some kind soul could have a look at my code and point out my errors.<br />
<br />
Cheers!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th November 2003, 19:33</div></div><div class="posttext">That script has a few errors:<br />
<br />
1. If you want to stretch an instruction line on more than one line you should put a backslash at the end of the line. Not closing the quotes is not enough.<br />
<br />
2. You are both writing and reading to the same file. When writing to a file it doesn't push the next lines to the bottom, it just overrides them. You should read from one file and write to another. Once that is done, you copy the new file over.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Trestkon</div><div class="date">16th November 2003, 20:42</div></div><div class="posttext">Well, thanks to kichik, I'm getting closer:)  I found a script in the archives that basically does what I want, but it's leaving me with a blank file, instead of adding the lines to TNM.ini</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th November 2003, 20:55</div></div><div class="posttext">Almost there, you just mixed up some variables along the way. $6 with $2 to be exact.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Trestkon</div><div class="date">16th November 2003, 22:20</div></div><div class="posttext">Works like a dream!!  Thanks so much guys, I appreciate it:D</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>