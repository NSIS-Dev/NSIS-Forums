<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" backup macro?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  backup macro? NSIS Discussion" />
	
	<title> backup macro? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  backup macro?</div>
<hr />
<div class="pda"><a href="t-117747.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=117747">backup macro?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Bizzy</div><div class="date">13th December 2002, 17:18</div></div><div class="posttext">How to script a backup? I did a search in this forum and found a few examples, but I couldn't fit them to my case (I'm not a programmer :( ).<br />
<br />
I'm trying to make an installer for a game modification. It includes loadsa files (~1000) that goes to various subdirectories in gamedir\data\ .End-user possibly has other mods installed, so my installer must backup files that will be replaced. Problem is, I don't know exactly which files user already has. What macro could do the trick (before overwriting any file, copy/move the original to gamedir\modbckup\ )?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th December 2002, 19:24</div></div><div class="posttext">What's wrong with this one:<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=113987&amp;highlight=backup<br />
?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Bizzy</div><div class="date">13th December 2002, 22:26</div></div><div class="posttext">You mean dis one?<br />
<br />
<br />
!macro BackupAndExtract DIR FILE<br />
  SetOutPath &quot;$INSTDIR\${DIR}&quot;<br />
  IfFileExists &quot;$OUTDIR\${FILE}&quot; 0 +3<br />
    CreateDirectory &quot;$INSTDIR\backup\${DIR}&quot;<br />
    Rename &quot;$OUTDIR\${FILE}&quot; &quot;$INSTDIR\backup\${DIR}\${FILE}&quot;<br />
  File &quot;&lt;insert app dir here&gt;\${DIR}\${FILE}&quot;<br />
!macroend<br />
<br />
!insertmacro BackupAndExtract &quot;&quot; &quot;Core.dll&quot;<br />
!insertmacro BackupAndExtract &quot;subfolder&quot; &quot;AnotherDLL.dll&quot;<br />
<br />
<br />
So I'll have to add manually<br />
!insertmacro BackupAndExtract &quot;subfolder&quot; &quot;file.xxx&quot; <br />
for each of 1000 files? That's nuts!<br />
Or is there some other way?<br />
<br />
PS: I'm sorry for being so n00bish, but well, I am n00bie :rolleyes: . Started to use NSIS yesterday. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th December 2002, 22:34</div></div><div class="posttext">Well, you will, in some way or another, have to tell NSIS to check all the files and backup them if needed. If you don't mind backing up files that might not get overwritten you can just use CopyFiles to copy the entire directory somewhere else. If you want to backup just files that are to be overwritten you will have to write a script that will create another script with all of the File commands in it. You should do this using FindFirst, FindNext, FindClose, FileOpen and FileWrite. You will have to loop through all the files you want to add and write !insertmacro to the new script file for each and every one of them (about 10 lines of a loop, not so hard).<br />
<br />
PS: I'm sorry for being so n00bish, but well, I am n00bie. Started to use NSIS yesterday. <br />
<br />
That's OK, keep asking until you understand.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>