<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Delay between INSTFILES and FINISHPAGE, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Delay between INSTFILES and FINISHPAGE NSIS Discussion" />
	
	<title> Delay between INSTFILES and FINISHPAGE [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Delay between INSTFILES and FINISHPAGE</div>
<hr />
<div class="pda"><a href="t-262594.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=262594">Delay between INSTFILES and FINISHPAGE</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">BrightSoul</div><div class="date">28th December 2006, 11:17</div></div><div class="posttext">Hello,<br />
I wrote a simple install script with no custom pages and no custom .ini files.<br />
This is the problem: immediately after all the files have been copied by the INSTFILES page, the &quot;Finish&quot; button becomes available but it takes another 3-4 seconds before the FINISHPAGE appears. This is troublesome because the users may click the Finish button before having a chance to choose whether they want to run the application or not by (un)checking a checkbox I put in the finish page. I also put a secondary checkbox in the finish page that lets the users decide if they want a desktop shortcut or not.<br />
<br />
I tried messing with these two lines of code putting them here and there but with no results:<br />
<br />
ReserveFile &quot;${NSISDIR}\Contrib\Modern UI\ioSpecial.ini&quot;<br />
!insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br />
<br />
<br />
<br />
Here is some code inside my install script:<br />
<br />
; Instfiles page<br />
!insertmacro MUI_PAGE_INSTFILES<br />
; Finish page<br />
!define MUI_FINISHPAGE_RUN<br />
!define MUI_FINISHPAGE_RUN_TEXT &quot;Create a shortcut&quot;<br />
!define MUI_FINISHPAGE_RUN_FUNCTION &quot;lnkdesktop&quot;<br />
!define MUI_FINISHPAGE_SHOWREADME<br />
!define MUI_FINISHPAGE_SHOWREADME_TEXT &quot;Run ${PRODUCT_NAME}&quot;<br />
!define MUI_FINISHPAGE_SHOWREADME_FUNCTION &quot;runfile&quot;<br />
Function &quot;runfile&quot;<br />
Exec &quot;$INSTDIR\${PRODUCT_EXECUTABLE}&quot;<br />
FunctionEnd<br />
Function &quot;lnkdesktop&quot;<br />
CreateShortCut &quot;$DESKTOP\${PRODUCT_NAME}.lnk&quot; &quot;$INSTDIR\${PRODUCT_EXECUTABLE}&quot; &quot;&quot; &quot;$INSTDIR\${PRODUCT_EXECUTABLE}&quot; 0<br />
FunctionEnd<br />
!insertmacro MUI_PAGE_FINISH</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th December 2006, 10:36</div></div><div class="posttext">Does it work if you don't use solid compression? Could you attach a complete script reproducing this problem?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BrightSoul</div><div class="date">29th December 2006, 12:53</div></div><div class="posttext">Originally posted by kichik <br />
Does it work if you don't use solid compression?  <br />
I tried different compression algorithms, both solid and non-solid but the delay is always there.<br />
<br />
Originally posted by kichik <br />
Could you attach a complete script reproducing this problem?  <br />
It's not script-dependant since I experience the delay even with the example script Examples\Modern UI\WelcomeFinish.nsi<br />
If I build that example as-is, I get 1 second delay. When I add these two lines to make the checkboxes appear:<br />
<br />
<br />
  !define MUI_FINISHPAGE_SHOWREADME<br />
  !define MUI_FINISHPAGE_RUN<br />
<br />
<br />
the delay increases to 2-3 seconds.<br />
I attach my script file but please note that the delay occurs even with the example scripts provided with the NSIS installation. You may not be able to notice the delay if you have a fast CPU. Mine is a 1 Ghz AMD Duron and the delay is pretty evident.<br />
<br />
If I can give my opinion, this is all due to the fact that the Finish button is set to &quot;enabled&quot; on the &quot;INSTFILES Page Unload&quot; event rather than on the &quot;FINISHPAGE Page Loaded&quot; event.<br />
<br />
Here's a recap of what's going on.<br />
<br />
Step #1: Files are being copied. Note that all the buttons are disabled during this phase.<br />
http://www.doppioslash.it/misc/nsis/step1.gif <br />
<br />
Step #2: All files have been copied. Immediately, the Finish button becomes enabled. The Cancel button is still disabled!! The finish page won't appear for another 2-4 seconds.<br />
http://www.doppioslash.it/misc/nsis/step2.gif <br />
<br />
Step #3: The finish page finally appears. This is the moment when the Cancel button becomes enabled. The whole problem would be solved if you also enabled the Finish button at this time, not earlier.<br />
http://www.doppioslash.it/misc/nsis/step3.gif <br />
<br />
Thanks for support.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">29th December 2006, 22:03</div></div><div class="posttext">The Installer Attributes (http://nsis.sourceforge.net/Docs/Chapter4.html#4.8) AutoCloseWindow doesn't help?<br />
Nor User Interface Instructions (http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.14) SetAutoClose?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BrightSoul</div><div class="date">30th December 2006, 08:32</div></div><div class="posttext">Originally posted by Red Wine <br />
The Installer Attributes (http://nsis.sourceforge.net/Docs/Chapter4.html#4.8) AutoCloseWindow doesn't help?<br />
Nor User Interface Instructions (http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.14) SetAutoClose?  <br />
<br />
Nope, none of them is helping :( <br />
Also tried to set them to false but that didn't solve the problem either. After all the files have been installed, the user clicks &quot;Next &gt;&quot; and the history repeats. The finish button appears immediately, the finish page after 2-3 seconds.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th December 2006, 08:33</div></div><div class="posttext">Custom pages use INI files, which are not the fastest method of data management available. However, 2-3 seconds even in the simplest case is not normal. I'd take a wild guess and say you have an anti-virus that's getting in your way.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BrightSoul</div><div class="date">30th December 2006, 08:44</div></div><div class="posttext">It is true that my PC is slow and seriously needs a format C:, but the point is:<br />
<br />
- I can't predict the computer specs my users will run the installer on;<br />
- The Cancel button gets enabled at the right time, why the Finish button doesn't?<br />
<br />
<br />
I'd like to point out that, of course, this is just a minor problem. In the end, if there is no solution, It won't really matter :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">30th December 2006, 09:30</div></div><div class="posttext">Hmm... what about setting up a custom page just before the InstFiles page in order to collect info about shortcuts (see image below about what I mean) and leave the finish page only with run 'myapp.exe'? As you noticed above, that'd decrease the delay to 1 sec...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BrightSoul</div><div class="date">30th December 2006, 09:39</div></div><div class="posttext">I'm gonna try that soon, thanks for the advice.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th December 2006, 10:06</div></div><div class="posttext">- I can't predict the computer specs my users will run the installer on;<br />
- The Cancel button gets enabled at the right time, why the Finish button doesn't?The cancel button is already disabled by the instfiles page and enabled by InstallOptions (the plug-in behind the finish page) itself. The Next button, on the other hand, is enabled by the paging system before InstallOptions is even called. You should submit a bug report (http://sourceforge.net/tracker/?group_id=22049&amp;atid=373085) about it, so it can be fixed some day.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">30th December 2006, 10:56</div></div><div class="posttext">I added 2 custom functions (PRE and SHOW) on Finish Page.<br />
As I'm not able to reproduce the refered problem in my machine,<br />
I added a sleep in the PRE function in order to simulate the problem.<br />
When there is only the sleep command in the PRE function the next button appears<br />
while the FInish Page does not appear.<br />
Then I added code to disable the button and enable it again in SHOW function.<br />
Could these 2 functions solve the refered by BrightSoul problem?<br />
  !insertmacro MUI_PAGE_INSTFILES<br />
  !define MUI_PAGE_CUSTOMFUNCTION_PRE btndisable<br />
  !define MUI_PAGE_CUSTOMFUNCTION_SHOW btnenable<br />
  !insertmacro MUI_PAGE_FINISH<br />
<br />
the functions (sleep serves the simulation purpose)<br />
;Finish Page functions<br />
function btndisable<br />
getdlgitem $R0 $HWNDPARENT 1<br />
enablewindow $R0 0<br />
sleep 6000<br />
functionend<br />
<br />
function btnenable<br />
getdlgitem $R0 $HWNDPARENT 1<br />
enablewindow $R0 1<br />
functionend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BrightSoul</div><div class="date">1st January 2007, 20:06</div></div><div class="posttext">Awesome!<br />
Thank you Red Wine, that did the trick.<br />
Also, I submitted a bug report as suggested by kichik.<br />
<br />
Happy new year everyone!  :)<br />
Thanks for the great support-</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">1st January 2007, 20:48</div></div><div class="posttext">You're welcome! Nothing impossible when you're NSIS-ing :-)<br />
Happy new year to you too!<br />
Happy new year amici Italiani!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>