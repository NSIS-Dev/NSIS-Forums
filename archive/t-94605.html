<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" DeleteRegKey, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  DeleteRegKey NSIS Discussion" />
	
	<title> DeleteRegKey [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  DeleteRegKey</div>
<hr />
<div class="pda"><a href="t-94605.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=94605">DeleteRegKey</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">rio</div><div class="date">15th July 2002, 13:11</div></div><div class="posttext">Hello Everybody,<br />
<br />
during my installation I want to delete a key in <br />
<br />
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Enum\USB<br />
<br />
This works fine under Win98 and WinME with the commant:<br />
<br />
DeleteRegKey   HKEY_LOCAL_MACHINE &quot;Enum\USB\Vid_074d&amp;Pid_3556&quot;<br />
<br />
<br />
under Win2000 with the command:<br />
DeleteRegKey   HKEY_LOCAL_MACHINE &quot;System\CurrentControlSet\Enum\USB\Vid_074d&amp;Pid_3556&quot;<br />
i´ve got following problem:<br />
even logged in as administrator, i don´t have authorisation to<br />
delete a key in the registry. (On a new / clean W2k)<br />
:cry:<br />
now my question is:<br />
is there any possibility to change authorisation during<br />
an installation with NSIS ?<br />
<br />
hope anybody can help me<br />
best regards<br />
rio</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">15th July 2002, 16:43</div></div><div class="posttext">You would also get this problem on NT I expect since both use a &quot;proper&quot; security model and protect system resources. No ordinary user will be allowed to delete that key, only an administrator will be able to. Therefore, as is the case with many installers, the user running the installer will need to be a local administrator.<br />
<br />
A process cannot elevate it's only permission level, that would bypass the security model. A user (and processes run by that user) only has the permissions that they have been granted by an administrator (or other user with sufficient permissions)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rio</div><div class="date">16th July 2002, 07:57</div></div><div class="posttext">Hi Sunjammer,<br />
<br />
the problem is, even logged in as administrator I can´t delete<br />
the reg key. The authorisations in the registry for administrators are set to &quot;read only&quot; on a new win2k (I don´t have tested it under NT). Only a user &quot;system&quot; ?!? have permission to write  :igor: <br />
The funny about is that I can change the authorisation level to &quot;full access&quot; (as administrator). If I change the authorisation level the installer will work fine. Now I want do this automatically without<br />
change authorisation levels manually. Can I change the levels within the installer (when the user is an administrator of course), or is there an other way to delete registry keys.<br />
<br />
greetings<br />
rio</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">16th July 2002, 12:49</div></div><div class="posttext">The thing is I have to wonder why you want to do this. The key you want to change is deliberately not accessible by default because only the system account (ie. device drivers running as system, and the kernel itself) should ever touch that part of the registry.<br />
<br />
Anyway, what you are really asking is &quot;Is there an NSIS function that can change the security setting of a registry key&quot; - answer = No.<br />
<br />
I wrote a tiny extension DLL for someone a while back that removed all security on a registry key (that is explicitly what that person wanted) which might be of use to you (download it (http://www.clantpa.co.uk/nsis/x18regkeyV0.0.zip)), but to be honest I think if you go around changing the security of that key on a system your installer is running on you'd better have a very good reason.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rio</div><div class="date">23rd July 2002, 08:13</div></div><div class="posttext">@Sunjammer<br />
<br />
thank you for your help, <br />
:) <br />
Now I have found a correct way to solve my problem.<br />
rio<br />
:D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">23rd July 2002, 09:07</div></div><div class="posttext">If it's something that other people would find useful please post your solution here (or PM me and I'll mention it in my archive).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rio</div><div class="date">23rd July 2002, 09:16</div></div><div class="posttext">Your solution unfortunatly don´t solve my problem with registry access. So I used the W2k DDK to build an &quot;quiet&quot; exe who do my installation, and start this exe from NSIS which also do a versionchecking of windows. <br />
<br />
<br />
rio</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>