<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" nsdialogs - Any way to override/get a callback on the &lt;Cancel&gt; button?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  nsdialogs - Any way to override/get a callback on the &lt;Cancel&gt; button? NSIS Discussion" />
	
	<title> nsdialogs - Any way to override/get a callback on the &lt;Cancel&gt; button? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  nsdialogs - Any way to override/get a callback on the &lt;Cancel&gt; button?</div>
<hr />
<div class="pda"><a href="t-292138.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=292138">nsdialogs - Any way to override/get a callback on the &lt;Cancel&gt; button?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">22nd May 2008, 20:03</div></div><div class="posttext">Hi all,<br />
<br />
I was wondering if there was any &quot;new&quot; way of overriding or getting a callback on the button press of &lt;Cancel&gt; ?<br />
<br />
The old method was to provide an override to the Abort function, specifically:<br />
<br />
!define MUI_CUSTOMFUNCTION_ABORT &quot;CustomAbort&quot;<br />
<br />
However, I was hoping that maybe now with nsdialog, we might be able to register a Abort callback on a per page basis, rather than a global Abort function that would get called from any page when the user presses &lt;Cancel&gt; ...<br />
<br />
I have some code that I use to override the text &lt;Cancel&gt; to &lt;Skip&gt; on a specific page, and if they press &lt;Skip&gt; (Cancel), I skip forward a page, rather than Abort the whole Installer...<br />
<br />
I was hoping things might have changed so that I don't have to install a global handler for &lt;Cancel&gt;...<br />
<br />
Thanks!<br />
Scott</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">22nd May 2008, 22:15</div></div><div class="posttext">I guess we need a function nsDialogs::OnCancel here. I wonder if it's possible...<br />
In the meantime this workaround should do the trick:<br />
<br />
EDIT: In order to work even if a control has triggered before the cancel button, it needs a pop in every function that is called by the controls, see bellow the edited scenario.<br />
<br />
showinstdetails show<br />
outfile test.exe<br />
<br />
!include nsdialogs.nsh<br />
<br />
page license<br />
page custom  myFirstCustomPage<br />
page custom  mySecondCustomPage<br />
page directory<br />
page instfiles<br />
<br />
<br />
var myFirstCustomPage<br />
var mySecondCustomPage<br />
<br />
<br />
Function myFirstCustomPage<br />
<br />
    nsDialogs::Create /NOUNLOAD 1018<br />
        Pop $myFirstCustomPage<br />
<br />
    ${IfThen} $myFirstCustomPage == error ${|} Abort ${|}<br />
<br />
    ${NSD_CreateGroupBox}    0u 10u 100% 50% &quot;This is my first custom page:&quot;<br />
        Pop $0<br />
<br />
    ${NSD_CreateRadioButton} 10 25u 40% 12u &quot;button 1&quot;<br />
        Pop $R0<br />
<br />
    ${NSD_CreateRadioButton} 10 45u 40% 12u &quot;button 2&quot;<br />
        Pop $R1<br />
<br />
    ${NSD_AddStyle} $R0 ${WS_GROUP}<br />
    <br />
    ${NSD_SetState} $R0 ${BST_CHECKED}<br />
    <br />
    ${NSD_OnClick} $R0 myfunc<br />
    <br />
    ${NSD_OnClick} $R1 myfunc<br />
<br />
    GetDlgItem $myFirstCustomPage $myFirstCustomPage 1200<br />
<br />
    nsDialogs::Show<br />
<br />
FunctionEnd<br />
<br />
<br />
Function mySecondCustomPage<br />
<br />
    nsDialogs::Create /NOUNLOAD 1018<br />
        Pop $mySecondCustomPage<br />
<br />
    ${IfThen} $mySecondCustomPage == error ${|} Abort ${|}<br />
<br />
    ${NSD_CreateGroupBox}    0u 10u 100% 50% &quot;This is my second custom page:&quot;<br />
        Pop $0<br />
<br />
    ${NSD_CreateCheckBox} 10 25u 40% 12u &quot;checkbox 1&quot;<br />
        Pop $R0<br />
<br />
    ${NSD_CreateCheckBox} 10 45u 40% 12u &quot;checkbox 2&quot;<br />
        Pop $R1<br />
<br />
    ${NSD_SetState} $R0 ${BST_CHECKED}<br />
    <br />
    ${NSD_SetState} $R1 ${BST_CHECKED}<br />
<br />
    ${NSD_OnClick} $R0 myfunc<br />
<br />
    ${NSD_OnClick} $R1 myfunc<br />
<br />
    GetDlgItem $mySecondCustomPage $mySecondCustomPage 1200<br />
<br />
    nsDialogs::Show<br />
<br />
FunctionEnd<br />
<br />
<br />
Function myfunc<br />
<br />
     pop $1<br />
<br />
FunctionEnd<br />
<br />
<br />
Function .onUserAbort<br />
<br />
        Pop $0<br />
        ${If} $0 = $myFirstCustomPage<br />
        MessageBox MB_OK &quot;I'm gonna do crazy things now...&quot;<br />
        ${ElseIf} $0 = $mySecondCustomPage<br />
        MessageBox MB_OK &quot;Now what?&quot;<br />
        ${EndIf}<br />
<br />
FunctionEnd<br />
<br />
<br />
section<br />
<br />
sectionend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">23rd May 2008, 01:20</div></div><div class="posttext">Can't edit the damn thing above :(<br />
The function .onUserAbort:<br />
Function .onUserAbort<br />
<br />
        Pop $0<br />
        ${Unless} $0 == &quot;&quot;<br />
        ${If} $0 = $myFirstCustomPage<br />
        MessageBox MB_OK &quot;I'm gonna do crazy things now...&quot;<br />
        ${ElseIf} $0 = $mySecondCustomPage<br />
        MessageBox MB_OK &quot;Now what?&quot;<br />
        ${EndIf}<br />
        ${EndUnless}<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">23rd May 2008, 03:39</div></div><div class="posttext">Thanks RedWine.<br />
<br />
Yeah, I was hoping we could do away with the whole global function to trap Cancel events on any page.<br />
<br />
It would really be nice to be able to register a &quot;cancel_function&quot; callback per page, like we can with the &quot;leave_function&quot; when we call the &quot;Page&quot; function.<br />
ie, maybe we could change:<br />
<br />
4.5.4 Page<br />
custom [creator_function] [leave_function] [caption] [/ENABLECANCEL]<br />
<br />
to:<br />
<br />
4.5.4 Page<br />
custom [creator_function] [leave_function] [cancel_function][caption] [/ENABLECANCEL]</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">23rd May 2008, 04:12</div></div><div class="posttext">Hmmm, just looking at the nsdialog code, this should actually be pretty trival to do!<br />
<br />
There is already code to trap the &lt;Back&gt; button with &quot;onBack&quot;.<br />
<br />
Surely we can add one to trap the &lt;Cancel&gt; button as well.<br />
<br />
Assuming I can get NSIS to compile, I will try adding this code tonight/tomorrow.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">23rd May 2008, 15:34</div></div><div class="posttext">Well, I got it half done.<br />
I can get the callback into OnCancel, but there is some stuff in exehead/Ui.c that causes NSIS to bail regardless if we Abort the Cancel or not.<br />
But here is a small patch for the half I did get done so far:<br />
<br />
===================================================================<br />
RCS file: /cvsroot/nsis/NSIS/Contrib/nsDialogs/nsDialogs.c,v<br />
retrieving revision 1.5<br />
diff -r1.5 nsDialogs.c<br />
36a37,43<br />
&gt;     if (wParam == (WPARAM) 120)<br />
&gt;     {<br />
&gt;       if (g_pluginParms-&gt;ExecuteCodeSegment(g_dialog.callbacks.onCancel - 1, 0))<br />
&gt;       {<br />
&gt;         return 0;<br />
&gt;       }<br />
&gt;     }<br />
390a398,402<br />
&gt; void __declspec(dllexport) OnCancel(HWND hwndParent, int string_size, char *variables, stack_t **stacktop, extra_parameters *extra)<br />
&gt; {<br />
&gt;   SetDialogCallback(DLG_CALLBACK_IDX(onCancel));<br />
&gt; }<br />
&gt; <br />
<br />
<br />
===================================================================<br />
RCS file: /cvsroot/nsis/NSIS/Contrib/nsDialogs/defs.h,v<br />
retrieving revision 1.2<br />
diff -r1.2 defs.h<br />
25a26<br />
&gt;   nsFunction onCancel;</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>