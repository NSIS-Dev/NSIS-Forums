<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" All Users Write Access, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  All Users Write Access NSIS Discussion" />
	
	<title> All Users Write Access [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  All Users Write Access</div>
<hr />
<div class="pda"><a href="t-273936.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=273936">All Users Write Access</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">aspestrand</div><div class="date">6th July 2007, 02:32</div></div><div class="posttext">I hope I'm not repeating a post here but I couldn't find what I was looking for here on the forum.<br />
<br />
In my installer I'm creating a directory under &quot;All Users&quot; by doing the following:<br />
<br />
  SetShellVarContext all<br />
  CreateDirectory $APPDATA\Foo<br />
<br />
This works fine in XP but under Vista I do not have write permissions to the folder or any sub folders or files. When my application creates a file in $APPDATA\Foo it actually ends up being a virtualized file.<br />
<br />
Is it true that if I change the permissions of the folder with  the AccessControl plugin to allow writing that all sub-folders and files created after will then not be virtualized and actually be writable in the real $APPDATA\Foo and not the virtualized path C:\Users\THEUSERNAME\AppData\Local\VirtualStore\ProgramData\Foo\...?<br />
<br />
Thanks for your time</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th July 2007, 09:18</div></div><div class="posttext">You should never do that. If you allow every user to write to the same folder you allow each user to affect other users. If you want an administrator to be able to change global settings, you should create a separate elevated application or dialog to do that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aspestrand</div><div class="date">6th July 2007, 17:48</div></div><div class="posttext">We actually just have a database stored there that needs to be accessed by all of our users. That's why it's in the All Users folder. That, as I understand it, is what the All Users folder is for is it not?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aspestrand</div><div class="date">6th July 2007, 17:50</div></div><div class="posttext">So will the AccessControl plugin do what I explained earlier?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th July 2007, 18:24</div></div><div class="posttext">The AccessControl plug-in can change the permissions of that folder, but you shouldn't give users a write permission to a common folder. Every change one user makes will affect all other users. That change doesn't have to be with your program. A user can completely delete that database or even corrupt it in a way that your program will crash.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aspestrand</div><div class="date">6th July 2007, 18:27</div></div><div class="posttext">That's OK. This is just a temporary situation where the DB is shared between users. In the meantime, this is the route we've decided.<br />
<br />
So, what about virtualization? Will the AccessControl plugin solve that issue as well?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th July 2007, 18:32</div></div><div class="posttext">No, that probably happens due to Vista compatibility trick. Adding a manifest should make it go away. If the problem is with the installer, use RequestExecutionLevel. If it's the application itself, you'll have to do it manually. You can copy the installer's manifest and modify it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aspestrand</div><div class="date">6th July 2007, 18:36</div></div><div class="posttext">Sorry. Both Vista and NSIS are fairly new to me. Are we talking about the Windows Manifest file? As in foo.exe.manifest? Or is there an NSIS manifest file? If it's the former, I'm not quite sure what you mean.<br />
<br />
Thanks for the help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th July 2007, 19:11</div></div><div class="posttext">We're talking about the Windows manifest file which can also be embedded in the executable as a resource. That's what NSIS does - it embeds the manifest as a resource when you use RequestExecutionLevel. You can copy that manifest using a resource editor.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aspestrand</div><div class="date">6th July 2007, 19:32</div></div><div class="posttext">Ah I see. So what your saying is I could modify the manifest to give our application Admin level privileges? If that's the case, wouldn't the UAC prompt come up asking permission to run the application?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th July 2007, 19:51</div></div><div class="posttext">No, that's not what I'm saying.<br />
<br />
The manifest has one more &quot;feature&quot; up its sleeve. It tells Vista the application knows what Vista is and so handles all sorts of cases like this one. Vista therefore turns off all sorts of compatibility tricks it has for older applications.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aspestrand</div><div class="date">6th July 2007, 19:54</div></div><div class="posttext">I understand now. Sorry for the confusion. Do you have a snippet I can add to my manifest to produce these effects? Or perhaps a link I could check out?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th July 2007, 19:57</div></div><div class="posttext">The manifest that the installer uses has all you need. The following goes under &lt;assembly&gt;&lt;trustInfo xmlns=&quot;urn:schemas-microsoft-com:asm.v3&quot;&gt;<br />
&lt;security&gt;<br />
&lt;requestedPrivileges&gt;<br />
&lt;requestedExecutionLevel level=&quot;asInvoker&quot; uiAccess=&quot;false&quot;/&gt;<br />
&lt;/requestedPrivileges&gt;<br />
&lt;/security&gt;<br />
&lt;/trustInfo&gt;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aspestrand</div><div class="date">6th July 2007, 20:03</div></div><div class="posttext">Thank you very much. I'll give this a try and see if it solves our problem.<br />
<br />
Your help is very much appreciated and thank you for your quick replies.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>