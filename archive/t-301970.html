<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Do it the â€œ7-Zip wayâ€ (request admin _not_ on launch, but later)?!, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Do it the â€œ7-Zip wayâ€ (request admin _not_ on launch, but later)?! NSIS Discussion" />
	
	<title> Do it the â€œ7-Zip wayâ€ (request admin _not_ on launch, but later)?! [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Do it the â€œ7-Zip wayâ€ (request admin _not_ on launch, but later)?!</div>
<hr />
<div class="pda"><a href="t-301970.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=301970">Do it the â€œ7-Zip wayâ€ (request admin _not_ on launch, but later)?!</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">eagle3386</div><div class="date">11th January 2009, 23:02</div></div><div class="posttext">Hey guys,<br />
<br />
since I switched to a specific 7-Zip version I donâ€™t really remember, I noticed 7-Zipâ€™s installer requesting administrative rights when it gets to the step where it copies/registers itâ€™s context-menu DLL.<br />
<br />
I also know that thereâ€™s the UAC-plugin available, but after having a look at 7-Zipâ€™s NSIS-file (included within its source code-archive, but attached to this post for your pleasure ;)), I couldnâ€™t find such a call anywhere?!<br />
<br />
So, how does 7-Zip do it then?<br />
<br />
Any help would be greatly appreciated! :)<br />
<br />
/Martin..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">11th January 2009, 23:04</div></div><div class="posttext">Maybe nsis is not involved in the registration</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eagle3386</div><div class="date">11th January 2009, 23:34</div></div><div class="posttext">Well, since there are paragraphs like # set &quot;all users&quot; mode<br />
SetShellVarContext all<br />
!insertmacro InstallLib DLL NOTSHARED REBOOT_NOTPROTECTED 7-zip.dll $INSTDIR\7-zip.dll $INSTDIR and/or WriteRegStr HKCR &quot;Drive\shellex\DragDropHandlers\7-Zip&quot; &quot;&quot; &quot;${CLSID_CONTEXT_MENU}&quot;<br />
<br />
WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Approved&quot; &quot;${CLSID_CONTEXT_MENU}&quot; &quot;7-Zip Shell Extension&quot; I do believe NSIS is used.. ;)<br />
<br />
Or is it because of these lines !ifdef WIN64<br />
ExecWait 'regsvr32 /s &quot;$INSTDIR\7-zip.dll&quot;'<br />
!endif within the script?<br />
<br />
Iâ€™m asking all these questions, because I want to request administrative rights _only_ in case the user has not enough â€œpowerâ€ to write to an UAC-protected folder â€” in all other cases, the installer shall run fine with the user-level.. ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">12th January 2009, 00:06</div></div><div class="posttext">what do the details in the UAC dialog say? (command line etc)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eagle3386</div><div class="date">12th January 2009, 00:47</div></div><div class="posttext">Iâ€™m sorry, but I donâ€™t know what you mean with â€œUAC dialogâ€.. :(<br />
Could you explain that in more detail, please?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">12th January 2009, 01:46</div></div><div class="posttext">requesting administrative rights, elevation dialog or whatever you wanna call it http://img.tomshardware.com/uk/2007/06/24/uac_meldung.png</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eagle3386</div><div class="date">12th January 2009, 18:38</div></div><div class="posttext">Right, now I got it.. ;)<br />
<br />
The details only show path + filename and look like this:<br />
C:\Users\&lt;User&gt;\Desktop\7z464-x64.msi<br />
<br />
And thatâ€™s where I should apologize for being so dumb (again).. :rolleyes:<br />
Itâ€™s actually an MSI-setup, not a NSIS-one..</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>