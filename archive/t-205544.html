<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Detecting DirectX 9.0c, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Detecting DirectX 9.0c NSIS Discussion" />
	
	<title> Detecting DirectX 9.0c [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Detecting DirectX 9.0c</div>
<hr />
<div class="pda"><a href="t-205544.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=205544">Detecting DirectX 9.0c</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Gato Muerto</div><div class="date">21st January 2005, 18:04</div></div><div class="posttext">I have a program that needs to have directx 9.0c (no boo-hiss, please) installed in order to function.  I tried monkeying around with the function that was on the board, but it doesn't quite work the way I want it to.  <br />
My registry shows directx &quot;version&quot; as 4.09.00.0904, so I based my script-piddling around that.<br />
<br />
<br />
    StrCpy $2 $0 8 4    ; get the alpha version : ie 9.0(c)<br />
    StrCpy $1 $0 5 5    ; get the minor version<br />
    StrCpy $0 $0 2 2    ; get the major version<br />
    StrCpy &quot;$DirectXMajorVersion&quot; $0<br />
    StrCpy &quot;$DirectXMinorVersion&quot; $1<br />
    StrCpy &quot;$DirectXAlphaVersion&quot; $2<br />
    IntOp $0 $0 * 100   ; $0 = major * 100 + minor<br />
    IntOp $0 $0 + $1<br />
    IntOp $0 $0 * 10000 ; $0 = major + minor * 10000 + alpha<br />
    IntOp $0 $0 + $2<br />
<br />
<br />
Later there is a portion that has:<br />
<br />
  # If version &gt;= 9.0c, then we're golden.<br />
  IntCmp $DirectXVersionDetected 9000904 DXOK DXIsOld DXOK<br />
<br />
<br />
However, I run the installation, it still attempts to install directx, no matter what.  Before tinkering with things I don't understand fully (I can't bend me mind 'round the string calls), I thought to ask here.<br />
<br />
Thanks in advance for anyone who can help this n00b out.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st January 2005, 18:13</div></div><div class="posttext">To compare version numbers use one of the version compare functions from the Archive (this one for example (http://nsis.sourceforge.net/archive/nsisweb.php?page=643)). It's not safe to assume the length of the numbers between the dots as in your script.<br />
<br />
It'll be easier to understand why your script isn't working as should with the entire script. The forum accepts attachment of .nsi files.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Gato Muerto</div><div class="date">21st January 2005, 20:26</div></div><div class="posttext">The entire code is rather messy, a work in progress, but the entire part that deals with the directx is here:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st January 2005, 20:43</div></div><div class="posttext">The problem is with the StrCpy lines. It doesn't copy what is documented that it should. Add DetailPrint lines with $0, $1 and $2 to see what they return.<br />
<br />
Try using the function I linked to, it should be simpler. You just give it the two version numbers and it tells you which is newer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Gato Muerto</div><div class="date">21st January 2005, 21:59</div></div><div class="posttext">Where does the DetailPrint show the output?  I know that just plugging in the code will work, but I am trying to learn about this, and am not sure why it isn't working.  =P<br />
<br />
Curse of those who try to learn.<br />
<br />
I added<br />
DetailPrint $0 right after each variable is declared, but don't know where it will end up.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Gato Muerto</div><div class="date">24th January 2005, 17:44</div></div><div class="posttext">I figured out what was causing my problem... mixed the two input string variables by accident.  Put the offset and the string length swapped.<br />
<br />
Thanks again for the help on the forum.  ^_^</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th January 2005, 21:24</div></div><div class="posttext">You should note that your code will fail if the version string changes in length or structure (ie the ranges will be changed).<br />
It's easy to think now that it's probably not going to happen, but when or if it does...<br />
<br />
e.g.<br />
4.09.00.0904 could become 4.09.00.10 in future.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Gato Muerto</div><div class="date">11th February 2005, 02:07</div></div><div class="posttext">Problems elsewhere in the software pushed back the release, so I have the time to do some more tinkering/ understanding of this program.  For the idea of future updates, I am trying to integrate the code posted into the installer, but I don't quite understand it.  What is the exact output of OutVar?  Is it a true/false statement, or is it the greater of the two variables?  IE, I make the comparison by using:<br />
ReadRegStr $Ver1 HKLM &quot;Software\Microsoft\DirectX&quot; &quot;Version&quot;<br />
!define Ver2 &quot;4.09.00.0904&quot;<br />
!macro VersionCheckNew2 $Ver1 Ver2 OutVar<br />
<br />
<br />
I need to know what is being returned, or in what format, and I still can't wrap my head around the strings.  I guess I just can visualize/keep what in/out/pop/push straight in my head.  Ugh.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th February 2005, 11:20</div></div><div class="posttext">The output variable can be 0, 1 or 2 as described in the Archive page.<br />
<br />
There is an example for calling the function on the top of the Archive page. Use it instead of what you've just posted.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th February 2005, 11:31</div></div><div class="posttext">ReadRegStr $R0 HKLM &quot;Software\Microsoft\DirectX&quot; &quot;Version&quot;<br />
!define Ver2 &quot;4.09.00.0904&quot;<br />
${VersionCheckNew} &quot;$R0&quot; &quot;${Ver2}&quot; &quot;$R1&quot;<br />
DetailPrint $R1 # 0, 1, 2<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th February 2005, 11:38</div></div><div class="posttext">I just noticed a small typo in the macro. I've fixed it and changed function name back to VersionCheckNew (not VersionCheckNew2).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Gato Muerto</div><div class="date">11th February 2005, 19:50</div></div><div class="posttext">Ah, K.  That explains why I was confused with the reference to both VCheckNew/VCheckNew2.  hehe.<br />
<br />
Would anyone have a reference they can point me towards that would assist a neophyte in uderstanding how these stacks/ vars work?  I started taking programming classes in pascal and C back in '95, before stopping school for undisclosed reasons.  3+ dimensional arrays make my head hurt.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th February 2005, 20:32</div></div><div class="posttext">The stack:<br />
http://nsis.sourceforge.net/archive/viewpage.php?pageid=216<br />
<br />
Variables store data. As simple as that.<br />
Variables are $var. $var can be $R0-$R9 or $0-$9, or you can create a custom variable with the Var command:<br />
Var myVar ; creates $myVar<br />
<br />
Then there's !defines. A !define is used on compile-time and it's value doesn't change (unlike a variable):<br />
!define myDefine &quot;blah&quot;<br />
MessageBox MB_OK &quot;${myDefine}&quot;<br />
This would be the same as using :<br />
MessageBox MB_OK &quot;blah&quot;<br />
<br />
The benefit of using !defines is that you can use the value of the define many times in the same script, and you'd then have to only change the define's value once if necessary.<br />
<br />
People get confused about variables and defines. Variables are used on run-time, therefore, they will only have a value (e.g. from using StrCpy) when people run your installer.<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>