<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" ${DisableX64FSRedirection} brings to crash the installer, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  ${DisableX64FSRedirection} brings to crash the installer NSIS Discussion" />
	
	<title> ${DisableX64FSRedirection} brings to crash the installer [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  ${DisableX64FSRedirection} brings to crash the installer</div>
<hr />
<div class="pda"><a href="t-302845.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=302845">${DisableX64FSRedirection} brings to crash the installer</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">monti0505</div><div class="date">6th February 2009, 13:03</div></div><div class="posttext">Hi,<br />
<br />
I have compiled a installer which I am testing on a x64bit XP SP2 maschine.<br />
<br />
But when I want to disable the FSRedirection of XP so that the programm is installed in &quot;program files&quot; and not &quot;program files(x86)&quot; the installer crashes and Visual Studio Debugger wants to start.<br />
<br />
<br />
Function .onInit<br />
  !insertmacro MULTIUSER_INIT<br />
  !insertmacro MUI_LANGDLL_DISPLAY<br />
 <br />
<br />
    ${If} ${RunningX64}<br />
      ${DisableX64FSRedirection}<br />
      strcpy $INSTDIR $PROGRAMFILES<br />
    ${EndIf}<br />
<br />
FunctionEnd<br />
<br />
<br />
Someone has an idea why that is happening?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th February 2009, 14:05</div></div><div class="posttext">What are the details of the crash?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">monti0505</div><div class="date">9th February 2009, 08:48</div></div><div class="posttext">Hi,<br />
<br />
I attached a pic. It shows that the installer freezes and the VS debugger starts.<br />
It freezes direct after the Welcome screen, when I click on &quot;next&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th February 2009, 01:14</div></div><div class="posttext">Did you remember to re-enable the redirection after .onInit?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">monti0505</div><div class="date">12th February 2009, 08:39</div></div><div class="posttext">Hi,<br />
<br />
you are right I did not re-enabled but I did not know that it would be nessacary. Beacause the redirection is just off for this thread. Whatever...  I have done that now:<br />
<br />
<br />
${If} ${RunningX64}<br />
      ${DisableX64FSRedirection}<br />
      strcpy $INSTDIR $PROGRAMFILES<br />
      ${EnableX64FSRedirection}  //Added<br />
${EndIf}]<br />
<br />
<br />
<br />
I did not freeze here now<br />
but now the $INSTDIR just redirects to C:\Program Files(x86) :(<br />
<br />
I tried to add  ${EnableX64FSRedirection} in the Main Section of my installer because at this point (code above) the redirection is enabled to early. In the main section I add some entries to registry and this entries are written in the WOW6432 folder.<br />
<br />
In the main section I wrote that:<br />
<br />
<br />
  ${EnableX64FSRedirection}  //Added before here<br />
SetRegView 64<br />
DeleteRegKey HKLM &quot;SOFTWARE\Program\Addins\{fb43cf20-ef35-48ce-b08e-46f9bd4507ec}&quot;<br />
SetRegView 32<br />
DeleteRegKey HKLM &quot;SOFTWARE\Progam\Addins\{fb43cf20-ef35-48ce-b08e-46f9bd4507ec}&quot;<br />
<br />
<br />
But here the installer freezed again :(<br />
Any idea what I can do to redirect correctly?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th February 2009, 11:41</div></div><div class="posttext">You must always disable redirection immediately after you're done using it for files. What's the complete code now?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">monti0505</div><div class="date">17th February 2009, 14:41</div></div><div class="posttext">Originally posted by kichik <br />
You must always disable redirection immediately after you're done using it for files. What's the complete code now?  <br />
<br />
Hi, <br />
<br />
as i showed in my post before I disable the Redirection after I used it. The installer does not freeze even but the folder redirects to the x86 folder and thats what I excactly not want.<br />
Here the code again<br />
<br />
<br />
${If} ${RunningX64}<br />
      ${DisableX64FSRedirection}  <br />
'Disabled redirection because I want to redirect to Program Files and not to Program files x86<br />
<br />
      strcpy $INSTDIR $PROGRAMFILES <br />
      ${EnableX64FSRedirection}  //enabled redirection again<br />
${EndIf}]<br />
<br />
<br />
<br />
<br />
This is my whole onInit function:<br />
<br />
<br />
Function .onInit<br />
<br />
${If} ${RunningX64}<br />
<br />
      ${DisableX64FSRedirection}<br />
      strcpy $INSTDIR $PROGRAMFILES<br />
       ${EnableX64FSRedirection}<br />
${EndIf}<br />
<br />
  !insertmacro MULTIUSER_INIT<br />
  !insertmacro MUI_LANGDLL_DISPLAY<br />
  !insertmacro INSTALLOPTIONS_EXTRACT &quot;licInfoDlg.ini&quot;<br />
  !insertmacro INSTALLOPTIONS_EXTRACT &quot;bit_question.ini&quot;<br />
  ;!insertmacro INSTALLOPTIONS_EXTRACT &quot;NetInstDlg.ini&quot;<br />
<br />
<br />
<br />
FunctionEnd<br />
<br />
<br />
<br />
I want that on a x64bit the programm is extracet to the Program Files folder not the x86 program files folder.<br />
<br />
<br />
Why the $PROGRAMFILES links to x86 folder although the redirection is disabled?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th February 2009, 20:44</div></div><div class="posttext">Try $PROGRAMFILES64.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>