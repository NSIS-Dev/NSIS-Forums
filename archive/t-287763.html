<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" [AccessControl] Set only file permissions?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  [AccessControl] Set only file permissions? NSIS Discussion" />
	
	<title> [AccessControl] Set only file permissions? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  [AccessControl] Set only file permissions?</div>
<hr />
<div class="pda"><a href="t-287763.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=287763">[AccessControl] Set only file permissions?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">BSOD2600</div><div class="date">29th February 2008, 05:45</div></div><div class="posttext">I'm trying to set both folder and file NTFS permissions<br />
<br />
This is what I've tried so far:<br />
<br />
        AccessControl::GrantOnFile &quot;$INSTDIR\PHP&quot; $WebUser &quot;GenericRead + GenericExecute&quot;<br />
        AccessControl::GrantOnFile &quot;$INSTDIR\PHP&quot; &quot;Everyone&quot; &quot;GenericRead + GenericExecute&quot;   <br />
        AccessControl::GrantOnFile &quot;$INSTDIR\PHP\uploadtemp&quot; $WebUser &quot;GenericRead&quot;<br />
        AccessControl::GrantOnFile &quot;$INSTDIR\PHP\uploadtemp&quot; $WebUser &quot;ReadData + WriteData + Execute&quot;<br />
        AccessControl::GrantOnFile &quot;$INSTDIR\PHP\sessiondata&quot; $WebUser &quot;GenericRead&quot;<br />
        AccessControl::GrantOnFile &quot;$INSTDIR\PHP\sessiondata&quot; $WebUser &quot;ReadData + WriteData + Execute&quot;  <br />
<br />
<br />
Unfortunately, the resulting permissions are not what I want.    I want the  $WebUser / Everyone accounts to have Read access to all folders/files in $INSTDIR\PHP -- this is done properly.<br />
<br />
I also want only the $WebUser account (i.e. IUSR_TEST2) to have ONLY have GenericRead permissions to the $INSTDIR\PHP\uploadtemp directory. Additionally, I want it to have Read/Write/Execute rights ONLY on files in that directory. It seems the AccessControl plugin always uses an &quot;Apply To&quot; of This folder, subfolders, and files.  For the $INSTDIR\PHP\uploadtemp folder I want an &quot;Apply To&quot; of Files only.<br />
<br />
Here is a detailed listing of the relevant applied permissions from the script above [sessiondata omitted] (used Sysinternals Accesschk tool):<br />
<br />
c:\php\sessiondata<br />
  RW TEST2\IUSR_TEST2<br />
        FILE_ADD_FILE<br />
        FILE_ADD_SUBDIRECTORY<br />
        FILE_APPEND_DATA<br />
        FILE_EXECUTE<br />
        FILE_LIST_DIRECTORY<br />
        FILE_READ_ATTRIBUTES<br />
        FILE_READ_DATA<br />
        FILE_READ_EA<br />
        FILE_TRAVERSE<br />
        FILE_WRITE_DATA<br />
        SYNCHRONIZE<br />
        READ_CONTROL<br />
  R  Everyone<br />
        FILE_EXECUTE<br />
        FILE_LIST_DIRECTORY<br />
        FILE_READ_ATTRIBUTES<br />
        FILE_READ_DATA<br />
        FILE_READ_EA<br />
        FILE_TRAVERSE<br />
        SYNCHRONIZE<br />
        READ_CONTROL<br />
<br />
<br />
While it's not a really big deal they're not applied as granular as I want, it would be a good idea to apply them correctly for security reasons.<br />
<br />
Any ideas on how to accomplish what I'm after?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">29th February 2008, 08:35</div></div><div class="posttext">from the simple test I did CreateDirectory &quot;$instdir\uploadtemp&quot;<br />
WriteIniStr &quot;$instdir\uploadtemp\file.ini&quot; a b c<br />
AccessControl::GrantOnFile &quot;$INSTDIR\uploadtemp\&quot; $WebUser &quot;GenericRead|GenericWrite&quot;<br />
pop $0<br />
DetailPrint $0<br />
AccessControl::DenyOnFile /NOINHERIT &quot;$INSTDIR\uploadtemp&quot; $WebUser &quot;DeleteChild|AddFile|AddSubdirectory&quot;<br />
pop $0<br />
DetailPrint $0 seems to work (I can edit file.ini, but not create new files, not sure if this is what you wanted, but you should be able to tweak this a bit, but from what I can tell, you have to specify the permissions for the folder/files first, then strip off permissions for just the parent folder)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BSOD2600</div><div class="date">29th February 2008, 09:55</div></div><div class="posttext">Ah, that /NOINHERIT switch should be documented more.  If one doesn't use that, security isn't applied/removed correct at all on single files.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th February 2008, 10:41</div></div><div class="posttext">Use SetOnFile not GrantOnFile to overwrite existing access control entries of a trustee.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BSOD2600</div><div class="date">2nd March 2008, 04:26</div></div><div class="posttext">Just ran across this for another project... it would be helpful if you referenced this MSDN page in your readme / wiki<br />
<br />
SID Strings (http://msdn2.microsoft.com/en-us/library/aa379602.aspx)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd March 2008, 17:52</div></div><div class="posttext">This page would be a better example:<br />
Well-known security identifiers in Windows operating systems (http://support.microsoft.com/kb/243330)<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BSOD2600</div><div class="date">4th March 2008, 00:40</div></div><div class="posttext">While thats true, in your examples you use &quot;BU&quot;.  That &quot;Well-known security identifiers in Windows operating systems&quot; page doesn't make any reference to what BU is.  The page I linked to explains / lists all the options.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>