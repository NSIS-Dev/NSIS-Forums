<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to write Multiple INI String, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to write Multiple INI String NSIS Discussion" />
	
	<title> How to write Multiple INI String [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to write Multiple INI String</div>
<hr />
<div class="pda"><a href="t-167252.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=167252">How to write Multiple INI String</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">playwin</div><div class="date">29th January 2004, 23:15</div></div><div class="posttext">Hello,<br />
I'm having trouble to write multiple INI Strings in a single INI file and in same INI_SECTION, for examp...<br />
<br />
WriteINIStr &quot;$INSTDIR\somename.ini&quot; &quot;MySec&quot; &quot;val1&quot; &quot;data1&quot;<br />
WriteINIStr &quot;$INSTDIR\somename.ini&quot; &quot;MySec&quot; &quot;val2&quot; &quot;data2&quot;<br />
....and so on<br />
<br />
In this case only the last line actually copied to the INI file. But I need atleast 6 lines to go there.<br />
<br />
I allready tried INIFlush filename between lines, but it's not working.<br />
<br />
So if you guys know anything about it, please share...<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rainmanp7</div><div class="date">30th January 2004, 01:11</div></div><div class="posttext">Make sure you check the data and Varialbes your sending<br />
through<br />
Nsis may pick them up as a Function or Ect ?<br />
I would check what changed and the data being sent<br />
That's my best guess.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">playwin</div><div class="date">30th January 2004, 08:03</div></div><div class="posttext">Sorry I don't understand what you mean,<br />
What I intend to know is how I could insert more than one line in a particular INI file in the same INI section:<br />
For example below is a sample INI file...<br />
<br />
[MYSECTION]<br />
val1=C:\Windows\temp\t.bmp<br />
val2=C:\Windows\temp\t2.bmp<br />
<br />
and so on...<br />
<br />
How to create that sort of INI from NSIS.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">30th January 2004, 11:35</div></div><div class="posttext">Is it a label? If it is you can use &quot;\r\n&quot; to create a new line. Example:<br />
<br />
&quot;Test\r\nTest2&quot;<br />
<br />
But just for Install Options INI Files.<br />
<br />
Read more the Install Options Readme...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th January 2004, 14:07</div></div><div class="posttext">The code in the first post should work fine. If it doesn't, attach the entire script so we can take a look and see what's wrong.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">playwin</div><div class="date">30th January 2004, 15:01</div></div><div class="posttext">Script is attached.<br />
<br />
Goto the end of Uninstall Section....<br />
<br />
Here is sample of the INI in question:<br />
<br />
[Rename]<br />
NUL=C:\WINDOWS\TEMP\nst4245.TMP\modern-header.bmp<br />
NUL=C:\WINDOWS\TEMP\NST4245.TMP<br />
<br />
---As you see there is only 2 lines, but it should have 5 lines.<br />
<br />
Note: Data would varry on every run...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th January 2004, 15:11</div></div><div class="posttext">You can't assign more than one value to a certain entry in an INI section. If that was possible you couldn't have changed entries.<br />
<br />
Use Delete /REBOOTOK.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">playwin</div><div class="date">30th January 2004, 15:19</div></div><div class="posttext">Ahha! Well I got it.<br />
<br />
But delete /REBOOTOK won't do here<br />
If I use that it will delete the file imdt. so user cann't see the FINISH page at all.<br />
<br />
OHHH! this is getting into my previous post....(BUG $PLUGINS FOLDER)<br />
Well now the only way to solve both problem is,,,,<br />
<br />
IS THERE ANY WAY TO REMOVE CERTAIN FILES/DIRS AFTER REBOOT?<br />
NSIS WILL NEVER ATTEPT DELETE THOSE IN CURRENT RUN. BUT ONLY AFTER REBOOT!!?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th January 2004, 15:23</div></div><div class="posttext">Lose the caps, no need to shout.<br />
<br />
You can lock the file manually so Delete won't be able to delete and will therefore use delete on reboot. To lock a file, simply open it using FileOpen. Don't forget to close it using FileClose after you don't need it locked.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">playwin</div><div class="date">30th January 2004, 15:28</div></div><div class="posttext">Allright then there is a way!<br />
<br />
Okay, one request, as you allready downloaded my script,<br />
so if you please modify the script to avail this functonality and attach it back, I'll be verry verry grateful.<br />
<br />
PLEASE!<br />
<br />
If that not possible, then , a short sample perhaps...<br />
Don't deny this....<br />
<br />
please please....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th January 2004, 15:30</div></div><div class="posttext">Too busy.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">playwin</div><div class="date">30th January 2004, 15:34</div></div><div class="posttext">Hey Come on<br />
Don't do this to me...<br />
<br />
Okay, tell you what take your time, I'm in no hurry.<br />
So when you are free please do this small work for me and mail it to me at auddy@gawab.com or dipak@myrealbox.com<br />
<br />
Okay! I hope this suits you...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">30th January 2004, 16:24</div></div><div class="posttext">You are not paying anything for this service. It's doesn't work like &quot;this is my script&quot; and &quot;please add 1 and 2 and 3&quot;.<br />
<br />
We have explained you how you get the  things you want.<br />
<br />
Now you should read the manual and integrate this in your script.<br />
<br />
If you have written the code and still have problems, we will be happy to give you some advice.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rainmanp7</div><div class="date">30th January 2004, 19:28</div></div><div class="posttext">Here is a Example that I use for my ini file<br />
at Install time and I can do it at uninstall time<br />
<br />
; this writes a new section and creates a cetion under it<br />
WriteINIStr $WINDIR\my.ini Blip &quot;#Cracker&quot; &quot;$INSTDIR\fido\language$\r$\n&quot;<br />
<br />
;This takes the same section and writes 6 Difern't Entries in Same section<br />
;By adding the $\r$\n at the End it Writes the LINE ! :)<br />
;without the line your would editing the entrie that was already there in the ini section.<br />
<br />
WriteINIStr &quot;$WINDIR\my.ini Blip &quot;#Cracker&quot; &quot;Flipper1$\r$\n&quot;<br />
WriteINIStr &quot;$WINDIR\my.ini Blip &quot;#Cracker&quot; &quot;Flipper2$\r$\n&quot;<br />
WriteINIStr &quot;$WINDIR\my.ini Blip &quot;#Cracker&quot; &quot;Flipper3$\r$\n&quot;<br />
WriteINIStr &quot;$WINDIR\my.ini Blip &quot;#Cracker&quot; &quot;Flipper4$\r$\n&quot;<br />
WriteINIStr &quot;$WINDIR\my.ini Blip &quot;#Cracker&quot; &quot;Flipper5$\r$\n&quot;<br />
WriteINIStr &quot;$WINDIR\my.ini Blip &quot;#Cracker&quot; &quot;Flipper6$\r$\n&quot;<br />
<br />
From what I have noticed is without the $\r$\n<br />
it rewrites the same lines but with it will modify the current line being targeted ,or create a new line with the $\r$\n if the line isn't already there if ya know what I mean.<br />
<br />
I hope this helps :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">playwin</div><div class="date">30th January 2004, 21:17</div></div><div class="posttext">Thank you rainmanp7, I don't yet test your code but i will now.<br />
<br />
And to Kichik and Joost, you guys are absolutely right.<br />
I'm verry sorry for my behaviour.<br />
<br />
However, acording to Kichik's suggestion I studied the manual again, and tried to write my own version(FileOpen)<br />
,but it's not working again...<br />
The revised script I'll about to attach, But in short this is happenning...<br />
<br />
If I use FileOpen with append access the fies removed instantly, same, user cann't see the FinishPage.<br />
<br />
If I use FileOpen with read only access user cann't see the FinishPage. Surprisngly after the (Un)InstallPage the WelcomePage(un) pops-up with a close button.<br />
<br />
I have no idea what is going on</div></div><hr />


<div class="post"><div class="posttop"><div class="username">playwin</div><div class="date">30th January 2004, 21:26</div></div><div class="posttext">The revised script...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">30th January 2004, 21:50</div></div><div class="posttext">I have no idea why you are trying to find a workaround for the plug-ins folder bug. It has already been fixed in the latest CVS version. You can get the development snapshot for the fix.<br />
<br />
If the compilation is a problem, I'll upload a new binary.<br />
<br />
The weird behavior is normal, because your are locking files the finish page needs (if you would really want to delete them on reboot, it should be done after the finish page).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">playwin</div><div class="date">30th January 2004, 21:55</div></div><div class="posttext">I allready visited NSIS home page to download CVS version.<br />
But I could not manage how to get it.<br />
If you just give me a link or expain how to download and install CVS pack.., that will be great.<br />
<br />
Please forgive my foolishness, I am just a verry new user for Internet too.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th January 2004, 22:08</div></div><div class="posttext">Under development snapshot:<br />
<br />
http://nsis.sourceforge.net/development<br />
<br />
As for FileOpen and FileClose, you should open the file just before you delete and close it just after you delete it. You don't want to lock it for other things, just the delete line. For example:<br />
<br />
FileOpen $0 C:\bla w<br />
Delete C:\bla<br />
FileClose $0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">playwin</div><div class="date">31st January 2004, 16:44</div></div><div class="posttext">Thanks to everyone, now it's working.<br />
<br />
I'm now using RunOnce(registry), to do the cleanup for me.<br />
Using INI (which I'm trying so far) is also possible with the FileWrite function.<br />
<br />
But, for the both cases, I have to switch-back to zLib comp.<br />
<br />
When I tried to use LZMA comp.(it's result in smaller file size, you know..), the TEMP-FILES($PLUGINS) do clear, but an another temp file, yes file not folder, with a name like..nsn????.tmp (84kb) appears in the machine's temp folder.<br />
<br />
Verry verry strange!Isn't it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mrsdonovan</div><div class="date">27th July 2004, 06:54</div></div><div class="posttext">Originally posted by rainmanp7 <br />
;This takes the same section and writes 6 Difern't Entries in Same section<br />
;By adding the $\r$\n at the End it Writes the LINE ! :)<br />
;without the line your would editing the entrie that was already there in the ini section.<br />
<br />
WriteINIStr &quot;$WINDIR\my.ini Blip &quot;#Cracker&quot; &quot;Flipper1$\r$\n&quot;<br />
WriteINIStr &quot;$WINDIR\my.ini Blip &quot;#Cracker&quot; &quot;Flipper2$\r$\n&quot;<br />
WriteINIStr &quot;$WINDIR\my.ini Blip &quot;#Cracker&quot; &quot;Flipper3$\r$\n&quot;<br />
<br />
<br />
In the event anyone else finds this thread looking to do something like the above, I figured out another way to do it:<br />
<br />
My case is a bit different because the ini file I am editing, UT2004.ini, already has existing &quot;Paths&quot; in the &quot;[Core.System]&quot; section.  The problem is that writeINIstr over-writes the first instance of &quot;Paths&quot; repeatly. The fix was to do the following:<br />
<br />
  WriteINIStr &quot;$INSTDIR\UT2004.ini&quot; &quot;Core.System&quot; &quot;Paths&quot; &quot;../mymod/*.utx$\r$\nPaths=../mymod/*.uax$\r$\nPaths=../mymod/*.umx$\r$\nPaths=../System/*.u&quot;<br />
<br />
In other words, it replaces what happens to be the first &quot;Path=../System/*.u&quot; with a bunch of &quot;Paths=../mymod/&lt;etc&gt;&quot; and appends the &quot;System&quot; path back onto the end.<br />
<br />
The great thing is that in the uninstaller, you can just pop the top paths off (like a stack) with multiple:<br />
   DeleteINIStr &quot;$INSTDIR\UT2004.ini&quot; &quot;Core.System&quot; &quot;Paths&quot;<br />
<br />
Before the install the section looks like:<br />
<br />
  [Core.System]<br />
  blah here<br />
  Paths=../System/*.u<br />
  Paths=etc<br />
  Paths=etc<br />
<br />
After the install the section then looks like:<br />
<br />
  [Core.System]<br />
  blah here<br />
  Paths=../mymod/etc<br />
  Paths=../mymod/etc<br />
  Paths=../System/*.u<br />
  Paths=etc<br />
  Paths=etc<br />
<br />
Of course, before you overwrite the first &quot;Paths&quot; you should read it to make sure you are writing the same value back.  Also, to do the uninstall right, it should check if the first &quot;Paths&quot; has not been modified and only then delete them.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>