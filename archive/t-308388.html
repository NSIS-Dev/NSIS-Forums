<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" remote installer - using signed/encrypted packages, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  remote installer - using signed/encrypted packages NSIS Discussion" />
	
	<title> remote installer - using signed/encrypted packages [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  remote installer - using signed/encrypted packages</div>
<hr />
<div class="pda"><a href="t-308388.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=308388">remote installer - using signed/encrypted packages</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">romca</div><div class="date">15th July 2009, 22:36</div></div><div class="posttext">Hi,<br />
someone might find this useful - it is a automatic, remote installer. It downloads packages from some locations, verifies and install them. If you have comments on how to improve it, make it suck less, please share them. Thanx!<br />
<br />
roman<br />
<br />
<br />
here  from readme:<br />
<br />
Remote installer components:<br />
----------------------------<br />
<br />
installer: installs the two components in their place<br />
checker: run in the background, periodically starts updater as a background process<br />
updater: when started, checks urls as given in the updater.ini file<br />
<br />
What it does:<br />
    1. updater has a configuration file installer.ini which lives in the same directory<br />
        - it holds section &quot;Download locations&quot;<br />
        - there up to 50 url links (http, ftp (not tested) and file:///)<br />
        - file:/// can be relative or absolute path<br />
            - e.g. file:///components.txt.asc<br />
            <br />
    2. updater consults installer.ini <br />
        - downloads the &quot;manifest&quot; from the first valid url into a temporary location<br />
            - it should be signed with a private key of a TRUSTED_SIGNATORY (see source)<br />
            - the downloaded file is verified, if the signature is not recognized, downloader tries next url(s)<br />
        - if no valid manifest is downloaded, program aborts<br />
        <br />
    3. the downloaded manifest contains &quot;changesets&quot; in the ini structure<br />
        - name of the section is the name of the feature<br />
            - eg. [001 - Silent changes]<br />
            - it is a good idea to put numbers, sections are sorted alphabetically<br />
        - each section should contain: url, md5, args, onfailure keys<br />
            - url: where to download the new/changed feature<br />
            - md5: checksum of the downloaded file<br />
            - args: instructions how to execute the downloaded file, in case of 7z, it is a directory where it will be unpacked<br />
            - onfailure: continue|stop|retry<br />
    4. updater first sorts sections alphabetically and starts from the first<br />
        - if already installed (it will be skipped)<br />
            - records of the installed features are kept in a separate ini: updated.ini<br />
        - if not installed:<br />
            - url is downloaded into temporary location<br />
            - downloaded file is checked against the md5 checksum<br />
            - if the file has .gpg suffix, it is decrypted<br />
                - e.g. &quot;program.exe.gpg&quot; will become &quot;program.exe&quot;<br />
                - decryption uses gpg and a private key of the program<br />
                    - package should be encrypted for ID of the installer<br />
                    - installer also checks if the file was encrypted by TRUSTED_SIGNATORY<br />
            - &quot;args&quot; are expanded (ie. args=%(DOWNLOADED_FILE)s /S becomes &quot;some_path\ns6984.exe /S&quot;)<br />
            - file is in a temporary location is executed (based on the suffix)<br />
                - exe files: run using ExecTimeout<br />
                - 7z files: output dir is set to the path in &quot;args&quot; and run Extract<br />
                - more actions could be added later<br />
        - if everything goes fine, package name is added into the updated.ini<br />
	    - ID = date (eg. 001 - Silent changes=07.07.2009 22:41:28)<br />
        - if anything went wrong:<br />
            - package installation is ended<br />
            - no records is written in the updated.ini<br />
            - based on the onfailure value, installation stops or continuew with a next package<br />
	    - it is up to you to solve the failure states<br />
	    <br />
	    <br />
How to make a distribution:<br />
---------------------------<br />
<br />
1. prepare a manifest:<br />
	- e.g. .\tests\components.0.01.txt<br />
2. sign the manifest with gpg<br />
	- e.g. .\gpg\gpg.exe --homedir .\gpg_local_side --clearsign .\tests\components.0.01.txt<br />
3. check the updater.ini file<br />
	- it must contain valid future URL locations of the manifest<br />
4. check the installer.ini file<br />
	- it must have a valid args in the section [Checker]<br />
	- this tells installer what to put in the Run section of the registry<br />
	- and also how to start checker after the installation<br />
5. compile the scripts, in this order:<br />
	a) checker.nsi --&gt; semanchk.exe<br />
	b) updater.nsi --&gt; updater.win32.0.01.exe<br />
	c) installer.nsi --&gt; installer.win32.0.01.exe<br />
<br />
	<br />
To encrypt a file:<br />
------------------<br />
- you have to encrypt and sign it<br />
- the SIGNATORY must be known to the updater<br />
	- see updater.nsi, search for TRUSTED_SIGNATORY <br />
- the file must be addressed to the updater<br />
	- you must have the public key of the recipient in the keyring<br />
	<br />
example:<br />
.\gpg\gpg.exe --homedir .\gpg_local_side -r &quot;John the Recipient&quot; -se .\tests\program.exe</div></div><hr />


<div class="post"><div class="posttop"><div class="username">romca</div><div class="date">15th July 2009, 22:37</div></div><div class="posttext">yeaahh, i forgot... big thanks to you nsis developers! nsis is great</div></div><hr />


<div class="post"><div class="posttop"><div class="username">romca</div><div class="date">16th July 2009, 22:56</div></div><div class="posttext">probably tired, i didnt attach the files. sorry</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th July 2009, 14:15</div></div><div class="posttext">Thanks for your contribution. You should create a page for it on the Wiki so it lives forever.<br />
<br />
http://nsis.sourceforge.net/Starting_a_new_page<br />
http://nsis.sourceforge.net/Uploading_files</div></div><hr />


<div class="post"><div class="posttop"><div class="username">romca</div><div class="date">22nd July 2009, 19:36</div></div><div class="posttext">Hi, added here: http://nsis.sourceforge.net/Remote_Secure_Installer<br />
<br />
(nsis at sourceforge dot net /Remote_Secure_Installer)<br />
<br />
I dont have an account for the wiki (and reluctant to create another one), but I hope somebody with editors' rights can put the page into the category &quot;Real world examples&quot;<br />
Best,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">logue</div><div class="date">29th July 2009, 03:05</div></div><div class="posttext">It is a tool which seems to be mutch useful. However, it is rather unclear.<br />
Isn't there any example which can be compiled immediately?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>