<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" String arrays, sort of, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  String arrays, sort of NSIS Discussion" />
	
	<title> String arrays, sort of [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  String arrays, sort of</div>
<hr />
<div class="pda"><a href="t-327297.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=327297">String arrays, sort of</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">DrBonzo</div><div class="date">14th February 2011, 13:07</div></div><div class="posttext">Several times, I've wanted to do the same body of script code, just changing one string.  Without some sort of string array, I've just made the body a function and called it several times.<br />
<br />
It finally occurred to me, looking at StrStr, that if I just had a special delimiter character, I could get the  same effect by separating the string elements with that delimiter.  So here's an implementation using &quot;$\n&quot; as the delimiter.  I hope someone finds it useful:<br />
<br />
-------- PerLine.nsh<br />
<br />
<br />
!include LogicLib.nsh<br />
<br />
;;;;;;;<br />
;<br />
;  global vars for loop<br />
;<br />
var /global PerLineArray<br />
var /global PerLineCount<br />
var /global PerLineChars<br />
<br />
!macro _PerLine lineArray loopVar<br />
    StrCpy $PerLineArray ${lineArray}<br />
    StrLen $PerLineChars $PerLineArray<br />
    StrCpy $PerLineCount 1<br />
    ${DoWhile} $PerLineChars &gt; 1<br />
        Push $PerLineArray<br />
        Call leadingLine<br />
        Pop ${loopVar}<br />
        Push $r0<br />
        StrLen $r0 ${loopVar}<br />
        IntOp $r0 $r0 + 1<br />
        StrCpy $PerLineArray $PerLineArray &quot;&quot; $r0<br />
        Pop $r0<br />
        StrLen $PerLineChars $PerLineArray<br />
!macroend<br />
!define PerLine `!insertmacro _PerLine`<br />
<br />
;;;;;;;;;;<br />
;<br />
;  usage, for example:<br />
;<br />
;   StrCpy $1 1 ;  line number<br />
;   StrCpy $2 &quot;&quot;    ; accumulating message<br />
;   ${PerLine} &quot;line1$\nline2$\n$line3&quot; $line<br />
;       ;  body does something with $line 3 times<br />
;       StrCpy $2 &quot;$2$\n$1 - $line&quot;<br />
;       IntOp $1 $1 + 1<br />
;   ${Loop}<br />
;   MessageBox MB_OK $2<br />
;<br />
<br />
;;;;;;;;;;<br />
;<br />
;  helper function to strip off leading line<br />
;<br />
Function LeadingLine<br />
	 ;  input - top of stack contains string, possibly containing &quot;$\n&quot;<br />
	 ;  output - top of stack contains string up to 1st &quot;$\n&quot;<br />
	 ;  r0 - working copy of input &amp; result<br />
	 ;  r1 - char index<br />
	 ;  r2 - length of input<br />
	 ;  r3 - nth char of input<br />
	 Exch $r0<br />
	 Push $r1<br />
	 Push $r2<br />
	 Push $r3<br />
	 StrCpy $r1 0<br />
	 StrLen $r2 $r0<br />
   _leadLoop:<br />
	 IntCmp $r1 $r2 _leadDone<br />
	 StrCpy $r3 $r0 1 $r1<br />
     StrCmp $r3 &quot;$\n&quot; _leadDone<br />
     IntOp $r1 $r1 + 1<br />
     Goto _leadLoop<br />
<br />
   _leadDone:<br />
	 StrCpy $r0 $r0 $r1<br />
	 Pop $r3<br />
	 Pop $r2<br />
	 Pop $r1<br />
	 Exch $r0<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">17th February 2011, 13:52</div></div><div class="posttext">This is one way but it is much easier (and cleaner) to use a plug-in (such as NSISArray) or use INI files/registry to store multiple values (i.e. by index or value name). You do not need to worry about the delimiter being in your array elements then.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>