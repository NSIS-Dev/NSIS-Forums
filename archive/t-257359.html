<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" problem related to files and directories, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  problem related to files and directories NSIS Discussion" />
	
	<title> problem related to files and directories [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  problem related to files and directories</div>
<hr />
<div class="pda"><a href="t-257359.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=257359">problem related to files and directories</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Lucky49</div><div class="date">11th October 2006, 18:40</div></div><div class="posttext">Hello all,<br />
I have a directory called Dlls which is having some dll files. I need to copy all these files on client directory and also register them. The problem is that the number of dll files in the  Dlls directory is not fixed and so I can't hardcode there names. I am wondering if there is a way to copy and register each file one by one from the directory without hard coding anything.<br />
Right now my code is <br />
<br />
File &quot;Dlls\ms.dll&quot;<br />
File &quot;UTSDlls\msis.dll&quot;<br />
â€¦â€¦â€¦<br />
<br />
 Copyfiles /silent $INSTDIR\ms.dll &quot;C:\Program Files\DLLS&quot;<br />
Copyfiles /silent $INSTDIR\msis.dll &quot;C:\Program Files\DLLS&quot;<br />
<br />
â€¦â€¦â€¦â€¦â€¦â€¦â€¦<br />
       <br />
 RegDLL &quot;C:\Program Files\DLLS\ms.dll&quot;<br />
RegDLL &quot;C:\Program Files\DLLS\msis.dll&quot;<br />
 â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦.<br />
<br />
As you can see all the files in Dlls directory are copied by hard coding there names. <br />
<br />
I would really appreciate if someone can help me out.<br />
Thanks, <br />
Lucky</div></div><hr />


<div class="post"><div class="posttop"><div class="username">goldy1064</div><div class="date">11th October 2006, 19:02</div></div><div class="posttext">Take a look at Locate in the NSIS Manual (http://nsis.sourceforge.net/Docs/AppendixE.html#E.1.2) .  You may use it to find all *.dll in a directory and then register each dll.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Lucky49</div><div class="date">11th October 2006, 21:36</div></div><div class="posttext">Thanks dude,<br />
I can now copy all files but I am still not sure how to register dlls without hard coding there names.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">goldy1064</div><div class="date">11th October 2006, 22:02</div></div><div class="posttext">Within the callback function that you pass to Locate, copy the file there and then register the file after copying it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Lucky49</div><div class="date">11th October 2006, 23:31</div></div><div class="posttext">i didn't get what you wrote. Following is my code now<br />
 <br />
File &quot;Dlls\*.dll&quot;<br />
Copyfiles /silent $INSTDIR\*.dll &quot;C:\Program Files\DLLs&quot;<br />
<br />
My prob is what to write in <br />
RegDLL &quot;C:\Program Files\DLLs\?&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">goldy1064</div><div class="date">11th October 2006, 23:46</div></div><div class="posttext">What you need to do is to look at Locate.  Locate will allow you to search a directory (at runtime of your installer) for specific files and each time a file is found, you would just need to run RegDLL.<br />
<br />
<br />
!include 'FileFunc.nsh'<br />
!insertmacro Locate<br />
...<br />
Section Blah<br />
    CopyFiles /silent $INSTDIR\*.dll &quot;C:\Program Files\DLLs&quot;<br />
<br />
    #locates all dll's in C:\Program Files\DLLs<br />
    ${Locate} &quot;C:\Program Files\DLLs&quot; &quot;/L=F /G=0 /M=*.dll&quot; LocateCallback<br />
SectionEnd<br />
<br />
Function LocateCallback<br />
    #$R9 holds the absolute path of the file found<br />
    #register the DLL<br />
FunctionEnd<br />
<br />
If more than just your DLL's will be in the output directory, than do the locate on the directory you were copying from and than just copy each file as Locate finds them and then register each.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Lucky49</div><div class="date">12th October 2006, 02:06</div></div><div class="posttext">Thanks goldy1064<br />
Now I have one last prob i guess. Following is my code now -<br />
<br />
File &quot;Dlls\*.dll&quot;<br />
${Locate} &quot;$INSTDIR\&quot; &quot;/L=F /G=0 /M=*.dll&quot; LocateCallback<br />
<br />
Function &quot;LocateCallback&quot;<br />
Copyfiles /silent $R9 &quot;C:\DLLs&quot;<br />
RegDLL $R9<br />
FunctionEnd<br />
<br />
I have more then one dll files but this function is called I guess only one time so only one dll gets copied and registered. Can you help me understand whatâ€™s going wrong.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">goldy1064</div><div class="date">12th October 2006, 16:28</div></div><div class="posttext">The below code can be used to continue searching until no more files/directories are found.<br />
<br />
Function LocateCallback<br />
   ...<br />
   StrCmp $R9 &quot;&quot; 0 stop_locate<br />
      Push &quot;&quot;<br />
      goto end<br />
   stop_locate:<br />
      Push &quot;StopLocate&quot;<br />
   end:<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Lucky49</div><div class="date">12th October 2006, 23:20</div></div><div class="posttext">Thanks a lot dude.....</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>